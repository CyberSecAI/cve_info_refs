=== Content from bugzilla.mozilla.org_b1d22bc5_20250125_035840.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/552255)
* [XML](/show_bug.cgi?ctype=xml&id=552255)

Closed
[Bug 552255](/show_bug.cgi?id=552255)
(CVE-2010-1125)

Opened 15 years ago
Closed 15 years ago

# focus() behavior may be used to inject, maybe steal keystrokes

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

focus() behavior may be used to inject, maybe steal keystrokes

## Categories

### (Core :: DOM: UI Events & Focus Handling, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20UI%20Events%20%26%20Focus%20Handling#DOM%3A%20UI%20Events%20%26%20Focus%20Handling)

DOM: UI Events & Focus Handling
▾

Core :: DOM: UI Events & Focus Handling
This component includes bugs for user input events, for example <https://w3c.github.io/uievents>, focus handling from <https://html.spec.whatwg.org>, and access key handling on a page.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20UI%20Events%20%26%20Focus%20Handling&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20UI%20Events%20%26%20Focus%20Handling&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20UI%20Events%20%26%20Focus%20Handling)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

1.9.2 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| blocking1.9.2 | --- | [needed](/buglist.cgi?f1=cf_blocking_192&o1=equals&v1=needed) |
| status1.9.2 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=.4-fixed) |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| blocking1.9.2 |  |  |
| status1.9.2 |  | .4-fixed |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: lcamtuf, Assigned: smaug)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/2ffdf44e5f0f5d0391e4631d41e3c956?d=mm&size=40)  [lcamtuf](/user_profile?user_id=253619)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[clickjacking](/show_bug.cgi?id=457011 "RESOLVED WORKSFORME - [meta] Ideas for preventing clickjacking (aka forced navigation, UI redressing)")

Dependency [tree](/showdependencytree.cgi?id=552255&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=552255)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: verified1.9.2, Whiteboard: [sg:moderate])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2010-1125

[Keywords:](/describekeywords.cgi)

[verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:moderate]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [a patch](/attachment.cgi?id=433110)  [15 years ago](#c5)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   6.71 KB, patch | enndeakin : [review+](#a1318708_6102 "15 years ago")  jst : [superreview+](#a1515149_12352 "15 years ago")  enndeakin : [feedback+](#c8 "15 years ago") | [Details](/attachment.cgi?id=433110&action=edit) | [Diff](/attachment.cgi?id=433110&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=433110) |
| --- | --- | --- |
| [a testcase](/attachment.cgi?id=435617)  [15 years ago](#c15)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   451 bytes, text/html |  | [Details](/attachment.cgi?id=435617&action=edit) |
| [the same for 1.9.2](/attachment.cgi?id=440774)  [15 years ago](#c21)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   6.74 KB, patch | beltzner : [approval1.9.2.4+](#c28 "15 years ago")  beltzner : [approval1.9.2.5-](#c28 "15 years ago") | [Details](/attachment.cgi?id=440774&action=edit) | [Diff](/attachment.cgi?id=440774&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=440774) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=552255#c0)• 15 years ago |
|  | |

Hi folks,
I originally thought this only applies to WebKit, but realized it can be tweaked to work with Firefox only after making this proof-of-concept public. Sorry for that - it's fairly low risk, but probably interesting:
<http://lcamtuf.coredump.cx/focus-webkit/>
This PoC is probably Windows-specific. Unlike clickjacking, this permits a fairly high degree of sophistication in interacting with third-party sites.
An obvious way to mitigate the risk is to mimic the behavior of MSIE / Opera - that is:
1) Forbid or defer focus changes between onkeydown and onkeyup, so that a malicious page can't see what's being pressed, but deliver the result elsewhere,
2) When focus is grabbed by another document in an IFRAME, and then returned, we should probably not attempt to restore it to the last known editing location, but reset it instead.
Now, the more interesting part. NOTE: THIS PART OF THE BUG IS NOT PUBLIC. We also noticed that the following is possible in WebKit browsers, and to a more limited extent and with some tweaks, in MSIE:
<http://lcamtuf.coredump.cx/focus-webkit/toplevel.html>
In essence, the same attack can be reversed, and allow cross-domain IFRAME gadgets to steal keystrokes (including password field entries) transparently.
This attack does not work on Firefox as-is, but this seems to be due to a conjunction of what I presume are two bugs; and not a conscious security decision:
1) Calling top.focus() always seem to be silently ignored, even if the current browser window is, in fact, in focus, and the call is being made from a currently in-focus IFRAME on that page. In other browsers, this simply returns focus to the top-level document. In Firefox, it does not, presumably because of an overzealous anti-annoyance filter meant to prevent pop-ups from doing setInterval('focus()',1).
2) The other way to approach this would be to call <iframedwindow>.blur(), but counterintuitively, this blurs the entire browser window (and amusingly, doing setInterval('blur()',1) from within an IFRAME makes the browser unusable). This looks like something that may eventually get fixed by accident.
I suspect there might be some other way to restore focus to the top-level doc, but I have no obvious ideas. Even if not, it is a more compelling argument to implement the aforementioned changes to focus behavior.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a26924_3881)• 15 years ago |

Component: Security → Event HandlingProduct: Firefox → CoreQA Contact: firefox → eventsVersion: 3.6 Branch → 1.9.2 Branch

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=552255#c1)• 15 years ago |
|  | |

(In reply to [comment #0](/show_bug.cgi?id=552255#c0 "RESOLVED FIXED - focus() behavior may be used to inject, maybe steal keystrokes"))
> 1) Forbid or defer focus changes between onkeydown and onkeyup, so that a
> malicious page can't see what's being pressed, but deliver the result
> elsewhere,
Need to be careful with a change like this. I believe some services
depend on changing focus between keydown and keyup if IME is involved.
Or something like that. I don't have any examples.
> 2) When focus is grabbed by another document in an IFRAME, and then returned,
> we should probably not attempt to restore it to the last known editing
> location, but reset it instead.
I believe when returning user does expect focus to be restored to the last known
editing location. What does "reset" even mean in this context?
But still, perhaps we could handle this so that if focus changes between
keydown and keyup, the focus wouldn't return to the original editing location.
Though, even that could break web apps.

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=552255#c2)• 15 years ago |
|  | |

The behaviors described are, as far as I can tell, already present in MSIE and Opera to some extent, so I am not very concerned about breakage (though testing would be prudent).

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a55556_11608)• 15 years ago |

Blocks: [clickjacking](/show_bug.cgi?id=457011 "RESOLVED WORKSFORME - [meta] Ideas for preventing clickjacking (aka forced navigation, UI redressing)")Whiteboard: [sg:moderate][do not disclose until webkit is also fixed]

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=552255#c3)• 15 years ago |
|  | |

I am always \*very\* concerned about breakage when changing focus handling code.
Taking for investigation. I'll try to find time to look at this tomorrow.Assignee: nobody → Olli.Pettay

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=552255#c4)• 15 years ago |
|  | |

My current plan is to prevent focusing not-same-origin window during user initiated key events. Or make that kind of focusing asynchronous.
Need to test both approaches.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=552255#c5)• 15 years ago |
|  | |

Attached patch

[a patch](attachment.cgi?id=433110&action=diff)
— [Details](attachment.cgi?id=433110&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=433110)

This is one option.
I don't quite understand why the first testcase is really a security bug at all.
The second one is more serious and trickier, fortunately it doesn't apply to
gecko at the moment.
Need to test this on windows (tested only Linux).
[Attachment #433110](/attachment.cgi?id=433110&action=edit "a patch") -
Flags: feedback?(enndeakin)

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=552255#c6)• 15 years ago |
|  | |

The first test case is a problem similar to clickjacking:
<http://code.google.com/p/browsersec/wiki/Part2#Arbitrary_page_mashups_(UI_redressing>)
It allows UI actions to be carried out across domains in a matter that defies the usual cross-site request forgery defenses (<http://en.wikipedia.org/wiki/XSRF>). The provided example is obviously harmless, and since Google Search is not XSRF-protected, it could be achieved by just doing <iframe src="<http://www.google.com/search?q=porn>"></iframe>; but consider an XSRF-protected page on Facebook that changes your privacy settings, or adds someone as your friend, or deletes your account.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=552255#c7)• 15 years ago |
|  | |

Ok, thanks for clarification.
The patch should fix the first test case, and yet it doesn't break
tabbing through iframes.

|  | [Neil Deakin](/user_profile?user_id=6102) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=552255#c8)• 15 years ago |
|  | |

Comment on [attachment 433110](/attachment.cgi?id=433110 "a patch") [[details]](/attachment.cgi?id=433110&action=edit "a patch") [[diff]](/attachment.cgi?id=433110&action=diff "a patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=433110)
a patch
The approach looks ok.
>+ if (!focusedPrincipal || !newPrincipal) {
>+ return;
>+ }
>+ PRBool subsumes = PR\_FALSE;
>+ focusedPrincipal->Subsumes(newPrincipal, &subsumes);
Don't you mean for the principals to be the other way around?
[Attachment #433110](/attachment.cgi?id=433110&action=edit "a patch") -
Flags: feedback?(enndeakin) → feedback+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=552255#c9)• 15 years ago |
|  | |

First I had it other way around, but then thinking for example the case
when focus is atm in chrome, it should be able to focus whatever it wants.
Or am I thinking wrong here.
Excluding the chrome case, if the pages aren't from same domain, subsumes
should be false either way.

|  | [Neil Deakin](/user_profile?user_id=6102) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=552255#c10)• 15 years ago |
|  | |

When focus is in chrome, the page should not be able to grab the focus. Although it can shift the currently focused element within the page, it shouldn't be able to shift the current window. That's already the case, see [bug 125282](/show_bug.cgi?id=125282 "RESOLVED FIXED - Webpage-JS can steal focus from URLbar / chrome") for that. Maybe the two code blocks could be combined as well.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=552255#c11)• 15 years ago |
|  | |

In the first testcase it is the currently focused window which tries to
focus iframe. That is what I'm trying to prevent.
(I can't access the testcase atm.)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=552255#c12)• 15 years ago |
|  | |

I think the two blocks work quite well together. They are not for the same thing.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=552255#c13)• 15 years ago |
|  | |

Comment on [attachment 433110](/attachment.cgi?id=433110 "a patch") [[details]](/attachment.cgi?id=433110&action=edit "a patch") [[diff]](/attachment.cgi?id=433110&action=diff "a patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=433110)
a patch
Seems like I need to rewrite the testcase, since the original one isn't reliably available.
So Neil, do you want some changes to this.
Need to figure out a fix for 1.9.1.x
[Attachment #433110](/attachment.cgi?id=433110&action=edit "a patch") -
Flags: review?(enndeakin)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a1196873_159758)• 15 years ago |

Alias: CVE-2010-1125

|  | [Neil Deakin](/user_profile?user_id=6102) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=552255#c14)• 15 years ago |
|  | |

(In reply to [comment #11](/show_bug.cgi?id=552255#c11 "RESOLVED FIXED - focus() behavior may be used to inject, maybe steal keystrokes"))
> In the first testcase it is the currently focused window which tries to
> focus iframe. That is what I'm trying to prevent.
>
> (I can't access the testcase atm.)
I think I need to see the testcase again before I can understand what the issue is here. Is the security issue only relevant when the new frame is from a different source, and that switching to another frame that can be accessed during a key event is ok? If so, the patch looks ok.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=552255#c15)• 15 years ago |
|  | |

Attached file
[a testcase](attachment.cgi?id=435617)
— [Details](attachment.cgi?id=435617&action=edit)

Here is a testcase. This doesn't do the key event filtering the original
testcase was doing, but should still show where the problem is.

|  | [Neil Deakin](/user_profile?user_id=6102) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a1318708_6102)• 15 years ago |

[Attachment #433110](/attachment.cgi?id=433110&action=edit "a patch") -
Flags: review?(enndeakin) → review+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=552255#c16)• 15 years ago |
|  | |

My testcase doesn't show the problem on 1.9.1.x and I wonder if
the original testcase worked there either.
Michal, any chance to get your testcases attached to this bug?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=552255#c17)• 15 years ago |
|  | |

Comment on [attachment 433110](/attachment.cgi?id=433110 "a patch") [[details]](/attachment.cgi?id=433110&action=edit "a patch") [[diff]](/attachment.cgi?id=433110&action=diff "a patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=433110)
a patch
this needs sr.
I'm still hoping to get the original testcase online, so that I could verify
whether the patch fixes that also on 1.9.2 branch, and whether to fix something
on 1.9.1.x.
[Attachment #433110](/attachment.cgi?id=433110&action=edit "a patch") -
Flags: superreview?(jst)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a1515149_12352)• 15 years ago |

[Attachment #433110](/attachment.cgi?id=433110&action=edit "a patch") -
Flags: superreview?(jst) → superreview+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=552255#c18)• 15 years ago |
|  | |

Michal, Reed, do you think it would be possible to get the original
testcase somewhere.blocking1.9.2: --- → ?blocking2.0: --- → ?

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=552255#c19)• 15 years ago |
|  | |

Sorry for the trouble. My homepage is now up.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a3323512_137548)• 15 years ago |

blocking1.9.2: ? → needed

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=552255#c20)• 15 years ago |
|  | |

Ok, I can't reproduce the bug on 3.5. (1.9.1 branch)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=552255#c21)• 15 years ago |
|  | |

Attached patch

[the same for 1.9.2](attachment.cgi?id=440774&action=diff)
— [Details](attachment.cgi?id=440774&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=440774)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=552255#c22)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/bb175d10ce90>
Waiting for some days before asking approval for 1.9.2Status: NEW → RESOLVEDClosed: 15 years agoResolution: --- → FIXED

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=552255#c23)• 15 years ago |
|  | |

When do you expect this to be approved & released?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=552255#c24)• 15 years ago |
|  | |

Comment on [attachment 440774](/attachment.cgi?id=440774 "the same for 1.9.2") [[details]](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") [[diff]](/attachment.cgi?id=440774&action=diff "the same for 1.9.2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=440774)
the same for 1.9.2
I assume not 1.9.2.4, but hopefully 1.9.2.5.
[Attachment #440774](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") -
Flags: approval1.9.2.5?
[Attachment #440774](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") -
Flags: approval1.9.2.4?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=552255#c25)• 15 years ago |
|  | |

I don't know the timeframe

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=552255#c26)• 15 years ago |
|  | |

Comment on [attachment 440774](/attachment.cgi?id=440774 "the same for 1.9.2") [[details]](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") [[diff]](/attachment.cgi?id=440774&action=diff "the same for 1.9.2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=440774)
the same for 1.9.2
Too late to take this for Firefox 3.6.4, we'll get it for Firefox 3.6.5
[Attachment #440774](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") -
Flags: approval1.9.2.4? → approval1.9.2.4-

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=552255#c27)• 15 years ago |
|  | |

My understanding is that while this bug is security-sensitive, most of the issue itself is public ([CVE-2010-1125](https://www.cve.org/CVERecord?id=CVE-2010-1125)) with a public testcase (see <http://www.securityfocus.com/archive/1/archive/1/510070/100/0/threaded>). There seems to be a few parts in [comment #0](/show_bug.cgi?id=552255#c0 "RESOLVED FIXED - focus() behavior may be used to inject, maybe steal keystrokes") that aren't yet public, but MITRE felt this affected Firefox enough to assign it a CVE already, so if we can go ahead and get this into 1.9.2.4 which hasn't started building yet, it would be better than waiting another 6 weeks.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=552255#c28)• 15 years ago |
|  | |

Comment on [attachment 440774](/attachment.cgi?id=440774 "the same for 1.9.2") [[details]](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") [[diff]](/attachment.cgi?id=440774&action=diff "the same for 1.9.2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552255&attachment=440774)
the same for 1.9.2
I agree with Reed; we need to respond with agility if this is disclosed and public
a=beltzner for 1.9.2, please land on default and GECKO1924\_20100413\_RELBRANCH
[Attachment #440774](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") -
Flags: approval1.9.2.5?
[Attachment #440774](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") -
Flags: approval1.9.2.5-
[Attachment #440774](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") -
Flags: approval1.9.2.4-
[Attachment #440774](/attachment.cgi?id=440774&action=edit "the same for 1.9.2") -
Flags: approval1.9.2.4+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=552255#c29)• 15 years ago |
|  | |

(In reply to [comment #20](/show_bug.cgi?id=552255#c20 "RESOLVED FIXED - focus() behavior may be used to inject, maybe steal keystrokes"))
> Ok, I can't reproduce the bug on 3.5. (1.9.1 branch)
We're sure that this won't affect 1.9.1?

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=552255#c30)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/99846558f1fb>
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/5c2487b51933>blocking2.0: ? → ---
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [.4-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=.4-fixed)

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=552255#c31)• 15 years ago |
|  | |

The original PoC definitely works on 3.5 on Windows, not sure if that's what you mean.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=552255#c32)• 15 years ago |
|  | |

The original PoC works on 1.9.1 but we don't think we need to patch it on 1.9.1? Can someone explain this with clarity?

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=552255#c33)• 15 years ago |
|  | |

I can't get the original PoC to work on Firefox 3.5.9 (mozilla-1.9.1) under Windows.
In Firefox 3.6.3 it captures some (but not all) text.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=552255#c34)• 15 years ago |
|  | |

If someone can reproduce this on 1.9.1.3, please remove the unaffected and request blocking.
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=552255#c35)• 15 years ago |
|  | |

Arrgh, actually, true. Sorry for the confusion. 3.5.x looks OK.
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) → ---

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=552255#c36)• 15 years ago |
|  | |

...and fixing edit collision.
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=552255#c37)• 15 years ago |
|  | |

Am I missing something? When I go to <http://lcamtuf.coredump.cx/focus-webkit/toplevel.html> with 3.5.9 on Win7 and type "Whatever" in the search box it instead goes into the evil gadget. Doesn't that mean 1.9.1 is affected?

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=552255#c38)• 15 years ago |
|  | |

I was referring to the PoC at <http://lcamtuf.coredump.ca/focus-webkit> - the more complicated case you refer to seems to do strange things on Firefox 3.5.x, but jumps cursor focus out of the box, which isn't really keystroke-stealing, it's focus-stealing :)

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=552255#c39)• 15 years ago |
|  | |

Yeah, the second test case does not work as-is, but this seems to be because of unrelated focus() / blur() quirks that will probably get fixed at some point (see my original message), so looks like it's worth keeping in mind anyway.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=552255#c40)• 15 years ago |
|  | |

Verified for 1.9.2 using the PoC and Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.5pre) Gecko/20100429 Namoroka/3.6.5pre (.NET CLR 3.5.30729).Keywords: [verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)

|  | [Brandon Sterne (:bsterne)](/user_profile?user_id=296777) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=552255#c41)• 15 years ago |
|  | |

Michal, this is fixed in the next shipping version of Firefox 3.6. Has the issue been fixed in WebKit yet? I'm trying to coordinate our advisories and need to know if this issue has to remain embargoed. Thanks.

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=552255#c42)• 15 years ago |
|  | |

WebKit is still thinking. I think it's OK to mention this in release notes, just not unlock this bug. I will update this bug as soon as they're done.

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=552255#c43)• 15 years ago |
|  | |

OK, WebKit is done:
<https://bugs.webkit.org/show_bug.cgi?id=26824>
<http://trac.webkit.org/changeset/58829>
Given the fact it's moderate risk, I suspect it's going to be several months for all the vendors to pick it up, though; I will probably discuss the additional details before then, given the low risk of things going wrong.

|  | [Michal Zalewski](/user_profile?user_id=253619)  Reporter |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=552255#c44)• 15 years ago |
|  | |

Apple and everybody else just went public with this. When do you plan to ship 3.6.4?

|  | [LegNeato](/user_profile?user_id=482154) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=552255#c45)• 15 years ago |
|  | |

"Early June" (<https://wiki.mozilla.org/Releases>). Likely in the coming week, though that is not set in stone.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a8689323_1689)• 15 years ago |

Group: core-security

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a8689893_159758)• 15 years ago |

Whiteboard: [sg:moderate][do not disclose until webkit is also fixed] → [sg:moderate]

|  | [Alexandra (retired)](/user_profile?user_id=373802) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=552255#c46)• 15 years ago |
|  | |

Why use JS at all: <http://pastie.org/1054910> and with HTML5's Boolean attribute 'autofocus' it becomes even easier to create a script-less keystroke stealer: <http://pastie.org/1054917>

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a283928297_1)• 6 years ago |

Component: Event Handling → User events and focus handling

|  | [Edgar Chen [:edgar]](/user_profile?user_id=455480) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552255#a337439410_455480)• 4 years ago |

[Attachment #435617](/attachment.cgi?id=435617&action=edit "a testcase") -
Attachment mime type: text/plain → text/html
You need to [log in](/show_bug.cgi?id=552255&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


