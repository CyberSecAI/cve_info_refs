```
Message-ID: <AANLkTilq8EW00nhZGLFCpwuw2o76UepmEMJirMc_eYq6@mail.gmail.com>
Date: Wed, 21 Jul 2010 09:36:57 -0400
From: Dan Rosenberg <dan.j.rosenberg@...il.com>
To: oss-security@...ts.openwall.com
Subject: CVE request: kernel: btrfs

Fixes for two issues in btrfs were committed upstream:

1.  The BTRFS_IOC_CLONE and BTRFS_IOC_CLONE_RANGE ioctls allowed a
local user to overwrite append-only files.

2.  The BTRFS_IOC_CLONE_RANGE ioctl was subject to an integer overflow
in specifying offsets to copy from a file, which potentially allows a
local user to read sensitive filesystem data.

Reference:
<http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=2ebc3464781ad24474abcbd2274e6254689853b5>

-Dan
```
- **Root cause of vulnerability**: Integer overflow in the BTRFS_IOC_CLONE_RANGE ioctl when specifying offsets to copy from a file.
- **Weaknesses/vulnerabilities present**: Integer overflow in offset calculation during clone range operation.
- **Impact of exploitation**: A local user can potentially read sensitive filesystem data by specifying an out-of-bounds range to copy from the source file.
- **Attack vectors**: Exploiting the BTRFS_IOC_CLONE_RANGE ioctl with crafted offset values.
- **Required attacker capabilities/position**: Local user access is required.

```
Message-ID: <2104881042.1128801279735912713.JavaMail.root@zmail01.collab.prod.int.phx2.redhat.com>
Date: Wed, 21 Jul 2010 14:11:52 -0400 (EDT)
From: Josh Bressers <bressers@...hat.com>
To: oss-security@...ts.openwall.com
Cc: dan.j.rosenberg@...il.com, coley <coley@...re.org>
Subject: Re: CVE request: kernel: btrfs

----- "Dan Rosenberg" <dan.j.rosenberg@...il.com> wrote:

> Fixes for two issues in btrfs were committed upstream:
>
> 1.  The BTRFS_IOC_CLONE and BTRFS_IOC_CLONE_RANGE ioctls allowed a
> local user to overwrite append-only files.

Please use CVE-2010-2537.

>
> 2.  The BTRFS_IOC_CLONE_RANGE ioctl was subject to an integer
> overflow
> in specifying offsets to copy from a file, which potentially allows a
> local user to read sensitive filesystem data.

Please use CVE-2010-2538

>
> Reference:
> <http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=2ebc3464781ad24474abcbd2274e6254689853b5>
>

Thanks.

--
    JB
```
This message confirms that CVE-2010-2538 is assigned to the integer overflow issue in BTRFS_IOC_CLONE_RANGE ioctl.

```
# [security-announce] SUSE Security Announcement: Linux kernel (SUSE-SA:2010:040)

...
Following security issues were fixed:
...
CVE-2010-2538: a local user could read kernel memory of a btrfs
file system
...
```
- **Root cause of vulnerability**: Integer overflow in the BTRFS_IOC_CLONE_RANGE ioctl.
- **Weaknesses/vulnerabilities present**: Integer overflow in offset calculation during clone range operation.
- **Impact of exploitation**: A local user can read kernel memory of a btrfs filesystem.
- **Attack vectors**: Exploiting the BTRFS_IOC_CLONE_RANGE ioctl with crafted offset values.
- **Required attacker capabilities/position**: Local user access.

```
[**BugÂ 616998**](show_bug.cgi?id=616998)
(CVE-2010-2537, CVE-2010-2538)
- [CVE-2010-2537](https://access.redhat.com/security/cve/CVE-2010-2537) [CVE-2010-2538](https://access.redhat.com/security/cve/CVE-2010-2538) kernel: btrfs: fix checks in BTRFS\_IOC\_CLONE\_RANGE
...
Description of problem:
1.  [CVE-2010-2537](https://access.redhat.com/security/cve/CVE-2010-2537) - The BTRFS_IOC_CLONE and BTRFS_IOC_CLONE_RANGE ioctls should check whether the donor file is append-only before writing to it.
2.  [CVE-2010-2538](https://access.redhat.com/security/cve/CVE-2010-2538) - The BTRFS_IOC_CLONE_RANGE ioctl appears to have an integer overflow that allows a user to specify an out-of-bounds range to copy from the source file (if off + len wraps around).
...
```
- **Root cause of vulnerability**: Integer overflow when calculating the range to copy in the `BTRFS_IOC_CLONE_RANGE` ioctl.
- **Weaknesses/vulnerabilities present**: Integer overflow leading to out-of-bounds access.
- **Impact of exploitation**: A local user can read sensitive data.
- **Attack vectors**: Crafting specific offset and length values in the `BTRFS_IOC_CLONE_RANGE` ioctl.
- **Required attacker capabilities/position**: Local user access.
```
USN-1041-1: Linux kernel vulnerabilities
...
Dan Rosenberg discovered that the btrfs filesystem did not correctly
validate permissions when using the clone function. A local attacker could
overwrite the contents of file handles that were opened for append-only, or
potentially read arbitrary contents, leading to a loss of privacy.
([CVE-2010-2537](/security/CVE-2010-2537), [CVE-2010-2538](/security/CVE-2010-2538))
...
```
- **Root cause of vulnerability**: Integer overflow when calculating the range to copy in the `BTRFS_IOC_CLONE_RANGE` ioctl.
- **Weaknesses/vulnerabilities present**: Integer overflow in offset calculation.
- **Impact of exploitation**: A local attacker could read arbitrary file contents.
- **Attack vectors**: Using the `BTRFS_IOC_CLONE_RANGE` ioctl with crafted offset values.
- **Required attacker capabilities/position**: Local user access.