=== Content from bugzilla.redhat.com_e6f59997_20250125_063609.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D642465)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D642465)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D642465)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 642465

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 642465**](show_bug.cgi?id=642465)
(CVE-2010-2963)
- [CVE-2010-2963](https://access.redhat.com/security/cve/CVE-2010-2963) kernel: v4l: VIDIOCSMICROCODE arbitrary write

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2010-2963 kernel: v4l: VIDIOCSMICROCODE arbitrary write

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2010-2963 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [642469](show_bug.cgi?id=642469 "CLOSED ERRATA - CVE-2010-2963 kernel: v4l: VIDIOCSMICROCODE arbitrary write [mrg-1.3]") [642470](show_bug.cgi?id=642470 "CLOSED ERRATA - CVE-2010-2963 kernel: v4l: VIDIOCSMICROCODE arbitrary write [rhel-5.5.z]") [642471](show_bug.cgi?id=642471) [642472](show_bug.cgi?id=642472) [642473](show_bug.cgi?id=642473) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=642465&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=642465&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2010-10-13 02:20 UTC by Eugene Teo (Security Response) | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2024-08-27 08:59 UTC ([History](show_activity.cgi?id=642465)) | | [CC List:](page.cgi?id=fields.html#cclist) | 12 users (show)  arozansk bhu dhoward fhrbata jkacur lgoncalv mjc peterm plyons rkhan security-response-team williams | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: | A vulnerability was discovered in the 32-bit compatibility code for the VIDIOCSMICROCODE IOCTL (Input/Output Control) in the Video4Linux implementation. It does not affect Red Hat Enterprise Linux 5, but as a preventive measure, this update removes the code. Red Hat would like to thank Kees Cook for reporting this vulnerability. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2021-10-19 09:15:11 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2010:0839](https://access.redhat.com/errata/RHSA-2010%3A0839) | 0 | normal | SHIPPED\_LIVE | Moderate: kernel security and bug fix update | 2010-11-09 18:06:20 UTC | | Red Hat Product Errata | [RHSA-2010:0842](https://access.redhat.com/errata/RHSA-2010%3A0842) | 0 | normal | SHIPPED\_LIVE | Important: kernel security and bug fix update | 2010-11-22 19:34:20 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=642465#c0)  Eugene Teo (Security Response)    2010-10-13 02:20:55 UTC  ``` The ioctl32 v4l1 compat code for VIDIOCSMICROCODE does not check the destination buffer for a copy_from_user() call, which allows anyone with access to a v4l device to write to arbitrary kernel memory locations. This allocates the memory and uses a compat pointer for the copy.  Acknowledgements:  Red Hat would like to thank Kees Cook for reporting this issue.   ```  [Comment 1](show_bug.cgi?id=642465#c1)  Eugene Teo (Security Response)    2010-10-13 02:23:48 UTC  ``` Introduced in eb4eeccc (v2.6.18-rc4), also see in 92f45bad (v2.6.29-rc1).   ```  [Comment 4](show_bug.cgi?id=642465#c4)  Eugene Teo (Security Response)    2010-10-13 07:09:43 UTC  ``` Public demo..: <http://www.youtube.com/watch?v=CLxpae-M7Js>   ```  [Comment 5](show_bug.cgi?id=642465#c5)  Mauro Carvalho Chehab    2010-10-13 16:47:04 UTC  ``` Ok, only Stradis driver actually uses it. I doubt that stradis still work nowadays, and it is not compiled on RHEL5/RHEL6. Need to check mrg. Patch is as simple as remove the compat bits for this ioctl.   ```  [Comment 8](show_bug.cgi?id=642465#c8)  Eugene Teo (Security Response)    2010-10-14 04:23:34 UTC  ``` Statement:  This issue did not affect the versions of the Linux kernel as shipped with Red Hat Enterprise Linux 3 and 4 as they did not include the upstream commit eb4eeccc that introduced the problem. It did not affect Red Hat Enterprise Linux 5 and Red Hat Enterprise MRG as they did not provide support for the Stradis driver that uses the vulnerable compat code for VIDIOCSMICROCODE. As a preventive measure, we have removed the vulnerable code in Red Hat Enterprise Linux 5 via <https://rhn.redhat.com/errata/RHSA-2010-0839.html>. We plan to remove the vulnerable code in a future kernel update in Red Hat Enterprise MRG.   ```  [Comment 10](show_bug.cgi?id=642465#c10)  Eugene Teo (Security Response)    2010-10-20 03:47:46 UTC  ``` <http://www.outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/>   ```  [Comment 11](show_bug.cgi?id=642465#c11)  Eugene Teo (Security Response)    2010-11-08 05:19:09 UTC  ``` Upstream commit: <http://git.kernel.org/linus/3e645d6b485446c54c6745c5e2cf5c528fe4deec>   ```  [Comment 12](show_bug.cgi?id=642465#c12)  errata-xmlrpc    2010-11-09 18:06:40 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 5  Via RHSA-2010:0839 <https://rhn.redhat.com/errata/RHSA-2010-0839.html>   ```  [Comment 14](show_bug.cgi?id=642465#c14)  errata-xmlrpc    2010-11-10 19:09:47 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 6  Via RHSA-2010:0842 <https://rhn.redhat.com/errata/RHSA-2010-0842.html>   ```  [Comment 15](show_bug.cgi?id=642465#c15)  Martin Prpič    2010-11-11 14:09:30 UTC  ```      Technical note added. If any revisions are required, please edit the "Technical Notes" field     accordingly. All revisions will be proofread by the Engineering Content Services team.          New Contents: A vulnerability was discovered in the 32-bit compatibility code for the VIDIOCSMICROCODE IOCTL (Input/Output Control) in the Video4Linux implementation. It does not affect Red Hat Enterprise Linux 5, but as a preventive measure, this update removes the code. Red Hat would like to thank Kees Cook for reporting this vulnerability.   ```  [Comment 16](show_bug.cgi?id=642465#c16)  errata-xmlrpc    2010-11-22 19:35:42 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 6  Via RHSA-2010:0842 <https://rhn.redhat.com/errata/RHSA-2010-0842.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=642465&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from www.debian.org_9dc02099_20250125_063554.html ===


---

[[Date Prev](msg00176.html)][[Date Next](msg00178.html)]
[[Thread Prev](msg00176.html)][[Thread Next](msg00178.html)]
[[Date Index](maillist.html#00177)]
[[Thread Index](threads.html#00177)]

# [SECURITY] [DSA 2126-1] New Linux 2.6.26 packages fix several issues

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 2126-1] New Linux 2.6.26 packages fix several issues
* *From*: dann frazier <dannf@debian.org>
* *Date*: Fri, 26 Nov 2010 21:49:43 -0700
* *Message-id*: <[[🔎]](/msgid-search/20101127044941.GA8941%40dannf.org) [20101127044941.GA8941@dannf.org](msg00177.html)>
* *Reply-to*: debian-security@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- ----------------------------------------------------------------------
Debian Security Advisory DSA-2126-1                security@debian.org
<http://www.debian.org/security/>                           dann frazier
November 26, 2010                   <http://www.debian.org/security/faq>
- ----------------------------------------------------------------------

Package        : linux-2.6
Vulnerability  : privilege escalation/denial of service/information leak
Problem type   : local/remote
Debian-specific: no
CVE Id(s)      : CVE-2010-2963 CVE-2010-3067 CVE-2010-3296 CVE-2010-3297
                 CVE-2010-3310 CVE-2010-3432 CVE-2010-3437 CVE-2010-3442
                 CVE-2010-3448 CVE-2010-3477 CVE-2010-3705 CVE-2010-3848
                 CVE-2010-3849 CVE-2010-3850 CVE-2010-3858 CVE-2010-3859
                 CVE-2010-3873 CVE-2010-3874 CVE-2010-3875 CVE-2010-3876
                 CVE-2010-3877 CVE-2010-3880 CVE-2010-4072 CVE-2010-4073
                 CVE-2010-4074 CVE-2010-4078 CVE-2010-4079 CVE-2010-4080
                 CVE-2010-4081 CVE-2010-4083 CVE-2010-4164
Debian Bug(s)  :

Several vulnerabilities have been discovered in the Linux kernel that may lead
to a privilege escalation, denial of service or information leak.  The Common
Vulnerabilities and Exposures project identifies the following problems:

CVE-2010-2963

    Kees Cook discovered an issue in the v4l 32-bit compatibility layer for
    64-bit systems that allows local users with /dev/video write permission to
    overwrite arbitrary kernel memory, potentially leading to a privilege
    escalation. On Debian systems, access to /dev/video devices is restricted to
    members of the 'video' group by default.

CVE-2010-3067

    Tavis Ormandy discovered an issue in the io_submit system call. Local users
    can cause an integer overflow resulting in a denial of service.

CVE-2010-3296

    Dan Rosenberg discovered an issue in the cxgb network driver that allows
    unprivileged users to obtain the contents of sensitive kernel memory.

CVE-2010-3297

    Dan Rosenberg discovered an issue in the eql network driver that allows
    local users to obtain the contents of sensitive kernel memory.

CVE-2010-3310

    Dan Rosenberg discovered an issue in the ROSE socket implementation. On
    systems with a rose device, local users can cause a denial of service
    (kernel memory corruption).

CVE-2010-3432

    Thomas Dreibholz discovered an issue in the SCTP protocol that permits a
    remote user to cause a denial of service (kernel panic).

CVE-2010-3437

    Dan Rosenberg discovered an issue in the pktcdvd driver. Local users with
    permission to open /dev/pktcdvd/control can obtain the contents of sensitive
    kernel memory or cause a denial of service. By default on Debian systems,
    this access is restricted to members of the group 'cdrom'.

CVE-2010-3442

    Dan Rosenberg discovered an issue in the ALSA sound system. Local users with
    permission to open /dev/snd/controlC0 can create an integer overflow
    condition that causes a denial of service. By default on Debian systems,
    this access is restricted to members of the group 'audio'.

CVE-2010-3448

    Dan Jacobson reported an issue in the thinkpad-acpi driver. On certain
    Thinkpad systems, local users can cause a denial of service (X.org crash) by
    reading /proc/acpi/ibm/video.

CVE-2010-3477

    Jeff Mahoney discovered an issue in the Traffic Policing (act_police) module
    that allows local users to obtain the contents of sensitive kernel memory.

CVE-2010-3705

    Dan Rosenberg reported an issue in the HMAC processing code in the SCTP
    protocol that allows remote users to create a denial of service (memory
    corruption).

CVE-2010-3848

    Nelson Elhage discovered an issue in the Econet protocol. Local users can
    cause a stack overflow condition with large msg->msgiovlen values that can
    result in a denial of service or privilege escalation.

CVE-2010-3849

    Nelson Elhage discovered an issue in the Econet protocol. Local users can
    cause a denial of service (oops) if a NULL remote addr value is passed as a
    parameter to sendmsg().

CVE-2010-3850

    Nelson Elhage discovered an issue in the Econet protocol. Local users can
    assign econet addresses to arbitrary interfaces due to a missing
    capabilities check.

CVE-2010-3858

    Brad Spengler reported an issue in the setup_arg_pages() function. Due to a
    bounds-checking failure, local users can create a denial of service (kernel
    oops).

CVE-2010-3859

    Dan Rosenberg reported an issue in the TIPC protocol. When the tipc module
    is loaded, local users can gain elevated privileges via the sendmsg() system
    call.

CVE-2010-3873

    Dan Rosenberg reported an issue in the X.25 network protocol. Local users
    can cause heap corruption, resulting in a denial of service (kernel panic).

CVE-2010-3874

    Dan Rosenberg discovered an issue in the Control Area Network (CAN)
    subsystem on 64-bit systems. Local users may be able to cause a denial of
    service (heap corruption).

CVE-2010-3875

    Vasiliy Kulikov discovered an issue in the AX.25 protocol. Local users can
    obtain the contents of sensitive kernel memory.

CVE-2010-3876

    Vasiliy Kulikov discovered an issue in the Packet protocol. Local users can
    obtain the contents of sensitive kernel memory.

CVE-2010-3877

    Vasiliy Kulikov discovered an issue in the TIPC protocol. Local users can
    obtain the contents of sensitive kernel memory.

CVE-2010-3880

    Nelson Elhage discovered an issue in the INET_DIAG subsystem. Local users
    can cause the kernel to execute unaudited INET_DIAG bytecode, resulting in a
    denial of service.

CVE-2010-4072

    Kees Cook discovered an issue in the System V shared memory subsystem.
    Local users can obtain the contents of sensitive kernel memory.

CVE-2010-4073

    Dan Rosenberg discovered an issue in the System V shared memory subsystem.
    Local users on 64-bit system can obtain the contents of sensitive kernel
    memory via the 32-bit compatible semctl() system call.

CVE-2010-4074

    Dan Rosenberg reported issues in the mos7720 and mos7840 drivers for USB
    serial converter devices. Local users with access to these devices can
    obtain the contents of sensitive kernel memory.

CVE-2010-4078

    Dan Rosenberg reported an issue in the framebuffer driver for SiS graphics
    chipesets (sisfb). Local users with access to the framebuffer device can
    obtain the contents of sensitive kernel memory via the FBIOGET_VBLANK ioctl.

CVE-2010-4079

    Dan Rosenberg reported an issue in the ivtvfb driver used for the Hauppauge
    PVR-350 card. Local users with access to the framebuffer device can obtain
    the contents of sensitive kernel memory via the FBIOGET_VBLANK ioctl.

CVE-2010-4080

    Dan Rosenberg discovered an issue in the ALSA driver for RME Hammerfall DSP
    audio devices. Local users with access to the audio device can obtain the
    contents of sensitive kernel memory via the SNDRV_HDSP_IOCTL_GET_CONFIG_INFO
    ioctl.

CVE-2010-4081

    Dan Rosenberg discovered an issue in the ALSA driver for RME Hammerfall DSP
    MADI audio devices. Local users with access to the audio device can obtain
    the contents of sensitive kernel memory via the
    SNDRV_HDSP_IOCTL_GET_CONFIG_INFO ioctl.

CVE-2010-4083

    Dan Rosenberg discovered an issue in the semctl system call. Local users can
    obtain the contents of sensitive kernel memory through usage of the semid_ds
    structure.

CVE-2010-4164

    Dan Rosenberg discovered an issue in the X.25 network protocol. Remote users
    can achieve a denial of service (infinite loop) by taking advantage of an
    integer underflow in the facility parsing code.

For the stable distribution (lenny), this problem has been fixed in version
2.6.26-26lenny1.

We recommend that you upgrade your linux-2.6 and user-mode-linux packages.

The following matrix lists additional source packages that were rebuilt for
compatibility with or to take advantage of this update:

                                             Debian 5.0 (lenny)
     user-mode-linux                         2.6.26-1um-2+26lenny1

Upgrade instructions
- --------------------

wget url
        will fetch the file for you
dpkg -i file.deb
        will install the referenced file.

If you are using the apt-get package manager, use the line for
sources.list as given below:

apt-get update
        will update the internal database
apt-get upgrade
        will install corrected packages

You may use an automated update by adding the resources from the
footer to the proper configuration.

Debian GNU/Linux 5.0 alias lenny
- --------------------------------

Stable updates are available for alpha, amd64, arm, armel, hppa, i386, ia64,
mipsel, powerpc, s390 and sparc. The update for mips will be released once it
becomes available.

Source archives:

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-2.6_2.6.26-26lenny1.dsc>
    Size/MD5 checksum:     6426 25d46333cc7f2b28b4312df096d875a8
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-2.6_2.6.26.orig.tar.gz>
    Size/MD5 checksum: 61818969 85e039c2588d5bf3cb781d1c9218bbcb
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-2.6_2.6.26-26lenny1.diff.gz>
    Size/MD5 checksum:  8002336 26391b13d5a39afdb2591dc888a568b8

Architecture independent packages:

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-doc-2.6.26_2.6.26-26lenny1_all.deb>
    Size/MD5 checksum:  4850414 de2ec8da8f7dab48ce65014401ae52e7
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-tree-2.6.26_2.6.26-26lenny1_all.deb>
    Size/MD5 checksum:   113254 e8f1973916d469640345a1c21421dfdf
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-manual-2.6.26_2.6.26-26lenny1_all.deb>
    Size/MD5 checksum:  1808942 ee7d18519868ee02f56fef2341c527ea
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-support-2.6.26-2_2.6.26-26lenny1_all.deb>
    Size/MD5 checksum:   128506 065f966fa5f38283d8c5add43a952d0e
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-patch-debian-2.6.26_2.6.26-26lenny1_all.deb>
    Size/MD5 checksum:  3006772 e94a5e6a2f144c31d88db997c2db8e1f
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-source-2.6.26_2.6.26-26lenny1_all.deb>
    Size/MD5 checksum: 49471548 0ec635ad97a262914262a7812e9e2ce6

alpha architecture (DEC Alpha)

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum:   747090 97fac497384d4e23463efd91f4cc6e0d
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-alpha-generic_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum:   368956 4f6d2e6c5535f0b64836b094178b259e
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum:  3551142 ed27877320f4ab66757cad34462b4df1
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-alpha-legacy_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum: 28539060 62095485cb584ea9775c038247c8453e
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-alpha-smp_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum: 29258774 36a1eccda8a1a6f330ad0707a07695b4
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum:   112660 9eadae84e38579f69ac8415995aff91d
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-alpha-generic_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum: 28560146 6f671d59c6761eb6a91b667d8859ebf4
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-alpha-legacy_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum:   369490 1b21492f700e66406ddf902b4cfd1fff
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-alpha_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum:   112682 5669ed2b63dfd7e25f1bed3f3c557e8b
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-alpha-smp_2.6.26-26lenny1_alpha.deb>
    Size/MD5 checksum:   370732 744a8a3bb0751181a11b909b7f2c8741

amd64 architecture (AMD x86_64 (AMD64))

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:   755464 a76803db0471a09013fcc410e2bd1a7c
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-xen-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:   391070 2af9113ceb56dd2a79a448ec1eb74452
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-xen-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:  1812222 800310a26af8edc580fc57d8da9b14ae
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:  3727512 5cadd7b974521b7c5ccc278968631e57
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-xen_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:  3859380 6fd2da7ef7a274fd0aed9701374533a5
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:   112652 ceed8afd8da64b6cb39f4619b7faa310
  <http://security.debian.org/pool/updates/main/l/linux-2.6/xen-linux-system-2.6.26-2-xen-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:   112640 ff01f002d79cc143476afa6d907127a4
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-openvz_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:  3783174 1822a9f0434abafe5e2dd84718c7e6bc
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum: 20937036 2a5fa1622b4747705e74348ce23baa5b
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-openvz-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:   401434 9288349bcf9919e8be6fbb21ff3a8f66
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-openvz-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum: 21104766 7719bc85bb26d356f24620924a8c4283
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:   393366 91d81407ad8be69d8f65b4f850ba5b1a
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-vserver-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum: 20956050 f9e8825e29f45d42627cfa1dd62569ea
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:   112686 c5110416ee580c5cfe71c58eadef2a22
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-vserver_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:  3759946 08746b9bc1d832b52f245269440b2bd6
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-modules-2.6.26-2-xen-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum: 19322068 48031c2d9ce732ed6bf79103050166dd
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-vserver-amd64_2.6.26-26lenny1_amd64.deb>
    Size/MD5 checksum:   394064 ddaa87681b7f3e9c0d155ead5302de4a

arm architecture (ARM)

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-arm_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum:   112776 769f5204e3edc4a3dd501f0254e97e5b
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum:   752794 6b11a353eddc1de6463615f0c5f69701
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-iop32x_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum:   371914 5eece356f6b47bab5afdbd0d3c724240
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-iop32x_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum: 12487514 b6a0886ca511e0dd2b7cd61319923edd
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-footbridge_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum:   356688 d62c6595ced0b11b0c2dc906254a5bd2
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-ixp4xx_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum: 11722022 82ee74470a3bfd7448da7ea9a092cf80
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum:  4146542 0b20edfd5914b550d21c035dab0146b4
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-orion5x_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum: 11434794 d8e4c25a2b94a7dc1c43226f80572203
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-orion5x_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum:   366896 69fc71b9d4a6d1926975f22160a6ca95
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum:   112736 78f106b38803939df3cacdebf280b5e1
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-ixp4xx_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum:   369740 61f68bbd18a0ac4f23e4d9aeb649a4a9
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-footbridge_2.6.26-26lenny1_arm.deb>
    Size/MD5 checksum: 10288198 15384b7d3708de3ffa1e9c17849db12f

armel architecture (ARM EABI)

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-ixp4xx_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum: 11684250 7d6165f32980b4bdf9174d0603a4e914
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-ixp4xx_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum:   367986 0fa930045394fa7bf2f1660edea036a8
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum:   112734 3291126b417654ea56968e2369a54879
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-orion5x_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum:   366188 d58ece9a482933c133e6a31fffbdaf4b
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-versatile_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum:   339524 728cced0ac92768f5fe216d23a2cc223
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-orion5x_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum: 11396252 9bf2717abad67374cc197d25956f0c11
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-iop32x_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum:   369858 736c45757463cc47d12daa64d13627fa
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum:  4145910 5f10aec830d3c114d1d600cc4ed25ef8
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum:   754724 8da96ea4780a69374788ac140e85298c
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-armel_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum:   112772 f158d96c80dd4c903be325d11a1a2704
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-versatile_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum:  9609544 c1a690b822e8a9d94336aa9146df21b2
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-iop32x_2.6.26-26lenny1_armel.deb>
    Size/MD5 checksum: 12448536 2bc10e5d383940aff2f7b54e5ca84267

hppa architecture (HP PA RISC)

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-parisc-smp_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum: 16390762 49ae803109f72ecc5f65cc0ab2a274d2
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-parisc64_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum:   305004 4447819b9e77572ea89388395dc328c8
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-parisc_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum:   303956 c54d283e4148b3eb1aed0e9e2f9b4135
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-parisc64-smp_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum:   307006 92fe6b41bd11a836c273ed0736396a18
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-hppa_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum:   112760 10bdcd03154924f5afb34dc670886eb8
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-parisc_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum: 15796706 c530209aab49e2068f14e484b6db59fd
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum:  3601768 e804a1671f76f3b35bfac3bbecc4b1a8
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum:   112728 d95be16830e352fbdf8f4250f762003b
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-parisc64-smp_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum: 17689704 2ce0de928b0de084a5ee21da0a58407e
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-parisc64_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum: 17137918 750e28de7bb1e261f636ccba8fcab308
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum:   764742 dbc6af80dc674736661b498edfc3a5e4
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-parisc-smp_2.6.26-26lenny1_hppa.deb>
    Size/MD5 checksum:   305576 58916c39063873b84cf419379053b5e2

i386 architecture (Intel ia32)

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-xen-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:  1598590 dc693b0a5fd1594615de4c5bfb51e3a2
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-amd64_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   401634 19b303053ef842f9dbcb05fbf9079c86
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   412706 9a6dc9914b57224d41697dd85251ad74
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-686-bigmem_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   414016 fbd71b61ce54978f4df2b3e851fa7c28
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-vserver-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   414584 2ebea5008b5a724ecdb19079e8f86e9d
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-modules-2.6.26-2-xen-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum: 18216302 86ea992d0efbd38a88f5b7fc9465f38d
  <http://security.debian.org/pool/updates/main/l/linux-2.6/xen-linux-system-2.6.26-2-xen-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   112640 68e5cb0e49e3b0e2beb8075edf84a357
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   770174 317eaad69bb2d30be37fffe2ba516ebc
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-openvz_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:  3870582 20d8147847c2ee48b5b8e186c5aa2dd8
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum: 20407918 b98e78be196bcfdd8395341c517d68a4
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:  3811776 d2e42bd89a509d9a3f9cd57ba7699195
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-686-bigmem_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum: 20528204 19e4258f60a0fd94691f21dd3bef8804
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-vserver-686-bigmem_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum: 20546188 e9dc6af2f445e672b6d80e8391402cc6
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-vserver-686-bigmem_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   413080 5a5160ce3a4308aa477d091a1fe8127a
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-i386_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   112706 9ada4ab06b22be004eee1160b21d1f2a
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-xen_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:  3950190 ca68b70d434125f799c5208161e105b9
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-openvz-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   418434 28870494c0609b93b67808c043a62dfb
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-vserver-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum: 20428344 2137508d1b187b0b364bedbaf46e1ea9
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-vserver_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:  3846426 73b6b13e86bac670f3073c5a8b2943f7
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-xen-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   399948 ba847a3f96345613a25f839972e6f0ed
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-amd64_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum: 21049612 7af7a78a4c5964620a476ad5c6066887
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-486_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum: 20369056 721ee6c463d845e9d6f8013ac38ba1d7
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-openvz-686_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum: 20705350 fc2fc201e24a62fd2574d51999195182
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   112654 80a1bd5e7cf38414cc184ac3645ce5da
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-486_2.6.26-26lenny1_i386.deb>
    Size/MD5 checksum:   412120 2f95a4695398f1e4ce933b0fb018e6f5

ia64 architecture (Intel ia64)

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-ia64_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum:   112688 0951a8f0fcf20010b4fd72e8794454ea
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-vserver-mckinley_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum:   361828 fa942ddabe46359a026caee5ff78cf94
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-vserver-itanium_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum: 34255886 885360588d0a9d8519164b605b884384
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-itanium_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum:   361400 17899521a5c8690a0d316797d15b9a5d
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-vserver_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum:  3694882 3f8c27edf54fa2af2593b786138d5aa6
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-vserver-mckinley_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum: 34440396 f8f45a9dd6e8d05bb29ba21f4100b271
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum:  3662038 7e20eabb6a01ceafb2b934e09743209b
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-mckinley_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum: 34380728 c245751f72228c02f40706c0754dc4bc
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum:   112654 0dda61d2b3dc3529995059957ba8d523
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-itanium_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum: 34192832 89c734c816323509cb81a8c06d503775
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-mckinley_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum:   362186 3de48033c683c0b0723845ba52d97311
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum:   754152 8f457306ee6f9f6a0dde6a85b60ba28e
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-vserver-itanium_2.6.26-26lenny1_ia64.deb>
    Size/MD5 checksum:   361772 ab078e4b7347c34373294d7bd48f5f77

mipsel architecture (MIPS (Little Endian))

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-r5k-cobalt_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum: 15061864 c0c33ea0339f836d537deea40041ebbf
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-5kc-malta_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum:   362194 4307fcc7be5e03bf84e65542ee773896
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-5kc-malta_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum: 28579670 e8f6dbeb2b27ecaa64a7648102068197
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-sb1-bcm91250a_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum:   305764 5f9c8534fd78687ee198c3c9575423ac
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum:   112730 62463422f9e70ee2f54d09ebc429c47d
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-mipsel_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum:   112784 22de96fa5ed52cfaba506f0f4c7c085c
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum:  3970148 e494271e4f18315b4c5e3f8692bedadd
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-sb1-bcm91250a_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum: 19686560 5a1734bb17cfd9ee65a411c3801ccf6d
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-4kc-malta_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum:   362326 f79daf88f7b6813c7c005b8b9dd87460
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-r5k-cobalt_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum:   300858 3775978c2a2c713ac1b15b9fb62dc021
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-sb1a-bcm91480b_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum:   306226 c23551d6d68208c7adebb3acf2523ca6
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-4kc-malta_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum: 23078776 0d0cf1ded5d13ab9ab1b7563ded158a3
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-sb1a-bcm91480b_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum: 19681376 5a4951e8708a86af494f4038d9a32eca
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_mipsel.deb>
    Size/MD5 checksum:   763218 a434c9b6829adb49282e1f50edbc8024

powerpc architecture (PowerPC)

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:  3785444 6e5a16d27250c50d7db3bb10e0fb0254
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-vserver-powerpc_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum: 23590652 148679b5cb6bfed70c84dc3f1128f77b
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-powerpc_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:   366624 253c73347bea4dfb6867aceeb66a758b
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-powerpc-smp_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:   367926 4c79229ecaf6ec2f64a79842101313c2
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-vserver-powerpc_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:   367420 e98a64747b70a7fc4b96dc5c3a984d9c
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:   749102 0398a006ed76f440b23c9e6f31274756
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-powerpc64_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:   373602 d35a94e121b4835db9c8935269966669
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-powerpc_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum: 23160128 24bc9e9bb6ad333636effdab5d34288c
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-powerpc-smp_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum: 23564700 0f2a1dda40f8c7de0e82f5f6de29f9a1
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:   112660 629d68ca03f2477c95da86870aa023e2
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-vserver_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:  3817674 565cee7c648e4f13df99144664bf190f
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-vserver-powerpc64_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:   375258 291bf04c8df940c91a46662980ac6465
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-powerpc64_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum: 23425562 36274877b4bd887a757def9494cc7adc
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-vserver-powerpc64_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum: 23482334 a467fd6e79497aacc73e59334c59b6a6
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-powerpc_2.6.26-26lenny1_powerpc.deb>
    Size/MD5 checksum:   112700 665500b5f7af3e53f23a703198f855d7

s390 architecture (IBM S/390)

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-vserver_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:  3570228 561ea2d62add917cb1e60678e2f17c61
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:  3537872 78fb9e63d73e11bd712a33f97bca0944
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-s390x_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:   235500 e229f77bbb800763ce13f19d7a2a4d11
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-s390x_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:  7785146 534a269198bc118b178d26c164fc8293
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-s390-tape_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:  1635456 c2d7e85eb8a011fc9234ab6a70001575
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:   747430 9c445557fac2df3194cb798eb71d1bee
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-s390_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:   234894 2178ac16ec7024918552f6ebd85aedd3
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:   112654 1610747370c332f27faae88f0a1ec939
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-s390_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:  7495176 816fcfd7bc444538d77c2c3f6c12157e
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-vserver-s390x_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:  7846266 40b261d1b256db145d7040e1909d915c
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-vserver-s390x_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:   236538 cb7f28a2a97f7d9ff3538bb4bcc87698
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-s390_2.6.26-26lenny1_s390.deb>
    Size/MD5 checksum:   112670 7455f2dcbb8ca1b9dfacf7c16436b34b

sparc architecture (Sun SPARC/UltraSPARC)

  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all-sparc_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum:   112678 65a66260c80f6159a91baf145d247e73
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-vserver-sparc64_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum: 14635110 c06723fccef45d3a020ca459ceb9f563
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-sparc64_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum:   305254 4a86ed1ca9373e7039fb5c2721080024
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-vserver-sparc64_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum:   306952 8290985574053c62b656c105ef31d4ec
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-libc-dev_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum:   803152 7945838b907ff50d35b0695640c3e387
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common-vserver_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum:  3823362 d8828a0ae77cdd0c37548d503dd53359
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-sparc64-smp_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum:   306648 dad43f6b5944e37931ea645be76ad560
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-sparc64_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum: 14295956 0441024e85b3bf3a402d18004be74f6a
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-image-2.6.26-2-sparc64-smp_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum: 14616366 45a1f5c59b0376b3fa77e07d8058e0e7
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-common_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum:  3788552 c2aa5e3bf20bb154f2876bdd3a5211f0
  <http://security.debian.org/pool/updates/main/l/linux-2.6/linux-headers-2.6.26-2-all_2.6.26-26lenny1_sparc.deb>
    Size/MD5 checksum:   112660 953336bb8af079d2e42fdbc9141b6d4b

  These files will probably be moved into the stable distribution on
  its next update.

- ---------------------------------------------------------------------------------
For apt-get: deb <http://security.debian.org/> stable/updates main
For dpkg-ftp: ftp://security.debian.org/debian-security dists/stable/updates/main
Mailing list: debian-security-announce@lists.debian.org
Package info: `apt-cache show <pkg>' and <http://packages.debian.org/><pkg>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iQIcBAEBCAAGBQJM8Iz7AAoJEBv4PF5U/IZAmxgQAKZnNnl12BAo2vfE/mUkrJD4
jVWZNPR6f1og5c9qOqL4hoPNfwTo5I8w2PNG1RoDswg5GkJyJ7fxvKNKBIdIveHx
p1sjHhHBQYgskM1livzrq/7YD6KnkZtKjy6kmbK2v3L/jYMY5BNyrbsCoJatMoOX
Ob5S3Y/Ke11QZ8K3dctFtcky8qvhB5NxqYrOhoU4H63MjPlCIkN4hgN2Ioolmu17
KKQdGtX36zKwaK24ouYiCfhkaIl8bA3qlZz0TtyTuEedTsvF6f6gj3nS/oqnTerN
hKaw9n1nKsPj1s4y9PFmYsDBNYPWWjfGZRc4Slf23Tqq4UjkH7AIvV3p9XJ9jZPR
hWlXu5xHLi4+qDKK16/959bmEfUd7hxjvJB7Fa7zB002JHyIp8rF+7U7L29eAjKb
Dz1sErp5W3e5TIGZJ1nwK/zPw4YlOihJehzN3bUDkBHrIWtISDKQOHTS3Jvte3Aq
wk13GU+3kq/OwFcoz9fwmmKABOilYKNkGLtHePhiNEX3hYcvQ8qJaDn8yECvNjA6
4AdZW+3/vazLCth8xS1cjinFy4Np3uV3DaUNw23po4V7LkrBpavgmAHpl9hEbLvH
VKYAlFQA1S/VVH7sWVMQWvumOITxjp6rbAWs5ZfyJSqi8sVEUjNnl/+cMNXt8RNZ
FknbJ4nNZutx8NS7w1Wx
=DDxb
-----END PGP SIGNATURE-----

```

---



=== Content from www.ubuntu.com_f92d25f8_20250125_063602.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1000-1: Linux kernel vulnerabilities

19 October 2010

Multiple security issues fixed.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 10.10](/security/notices?release=maverick)
* [Ubuntu 10.04](/security/notices?release=lucid)
* [Ubuntu 9.10](/security/notices?release=karmic)
* [Ubuntu 9.04](/security/notices?release=jaunty)
* [Ubuntu 8.04](/security/notices?release=hardy)
* [Ubuntu 6.06](/security/notices?release=dapper)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-ec2](/security/cves?package=linux-ec2) - Linux kernel for EC2
* [linux-source-2.6.15](/security/cves?package=linux-source-2.6.15) - Linux kernel

## Details

Dan Rosenberg discovered that the RDS network protocol did not correctly

check certain parameters. A local attacker could exploit this gain root

privileges. ([CVE-2010-3904](/security/CVE-2010-3904))

Al Viro discovered a race condition in the TTY driver. A local attacker

could exploit this to crash the system, leading to a denial of service.

([CVE-2009-4895](/security/CVE-2009-4895))

Dan Rosenberg discovered that the MOVE\_EXT ext4 ioctl did not correctly

check file permissions. A local attacker could overwrite append-only files,

leading to potential data loss. ([CVE-2010-2066](/security/CVE-2010-2066))

Dan Rosenberg discovered that the swapexit xfs ioctl did not correctly

check file permissions. A local attacker could exploit this to read from

write-only files, leading to a loss of privacy. ([CVE-2010-2226](/security/CVE-2010-2226))

Suresh Jayaraman discovered that CIFS did not correctly validate certain

response packats. A remote attacker could send specially crafted traffic

that would crash the system, leading to a denial of service.

([CVE-2010-2248](/security/CVE-2010-2248))

Ben Hutchings discovered that the ethtool interface did not correctly check

certain sizes. A local attacker could perform malicious ioctl calls that

could crash the system, leading to a denial of service. ([CVE-2010-2478](/security/CVE-2010-2478),

[CVE-2010-3084](/security/CVE-2010-3084))

James Chapman discovered that L2TP did not correctly evaluate checksum

capabilities. If an attacker could make malicious routing changes, they

could crash the system, leading to a denial of service. ([CVE-2010-2495](/security/CVE-2010-2495))

Neil Brown discovered that NFSv4 did not correctly check certain write

requests. A remote attacker could send specially crafted traffic that could

crash the system or possibly gain root privileges. ([CVE-2010-2521](/security/CVE-2010-2521))

David Howells discovered that DNS resolution in CIFS could be spoofed. A

local attacker could exploit this to control DNS replies, leading to a loss

of privacy and possible privilege escalation. ([CVE-2010-2524](/security/CVE-2010-2524))

Dan Rosenberg discovered a flaw in gfs2 file system's handling of acls

(access control lists). An unprivileged local attacker could exploit this

flaw to gain access or execute any file stored in the gfs2 file system.

([CVE-2010-2525](/security/CVE-2010-2525))

Bob Peterson discovered that GFS2 rename operations did not correctly

validate certain sizes. A local attacker could exploit this to crash the

system, leading to a denial of service. ([CVE-2010-2798](/security/CVE-2010-2798))

Eric Dumazet discovered that many network functions could leak kernel stack

contents. A local attacker could exploit this to read portions of kernel

memory, leading to a loss of privacy. ([CVE-2010-2942](/security/CVE-2010-2942), [CVE-2010-3477](/security/CVE-2010-3477))

Sergey Vlasov discovered that JFS did not correctly handle certain extended

attributes. A local attacker could bypass namespace access rules, leading

to a loss of privacy. ([CVE-2010-2946](/security/CVE-2010-2946))

Tavis Ormandy discovered that the IRDA subsystem did not correctly shut

down. A local attacker could exploit this to cause the system to crash or

possibly gain root privileges. ([CVE-2010-2954](/security/CVE-2010-2954))

Tavis Ormandy discovered that the session keyring did not correctly check

for its parent. On systems without a default session keyring, a local

attacker could exploit this to crash the system, leading to a denial of

service. ([CVE-2010-2960](/security/CVE-2010-2960))

Kees Cook discovered that the V4L1 32bit compat interface did not correctly

validate certain parameters. A local attacker on a 64bit system with access

to a video device could exploit this to gain root privileges.

([CVE-2010-2963](/security/CVE-2010-2963))

Toshiyuki Okajima discovered that ext4 did not correctly check certain

parameters. A local attacker could exploit this to crash the system or

overwrite the last block of large files. ([CVE-2010-3015](/security/CVE-2010-3015))

Tavis Ormandy discovered that the AIO subsystem did not correctly validate

certain parameters. A local attacker could exploit this to crash the system

or possibly gain root privileges. ([CVE-2010-3067](/security/CVE-2010-3067))

Dan Rosenberg discovered that certain XFS ioctls leaked kernel stack

contents. A local attacker could exploit this to read portions of kernel

memory, leading to a loss of privacy. ([CVE-2010-3078](/security/CVE-2010-3078))

Tavis Ormandy discovered that the OSS sequencer device did not correctly

shut down. A local attacker could exploit this to crash the system or

possibly gain root privileges. ([CVE-2010-3080](/security/CVE-2010-3080))

Dan Rosenberg discovered that the ROSE driver did not correctly check

parameters. A local attacker with access to a ROSE network device could

exploit this to crash the system or possibly gain root privileges.

([CVE-2010-3310](/security/CVE-2010-3310))

Thomas Dreibholz discovered that SCTP did not correctly handle appending

packet chunks. A remote attacker could send specially crafted traffic to

crash the system, leading to a denial of service. ([CVE-2010-3432](/security/CVE-2010-3432))

Dan Rosenberg discovered that the CD driver did not correctly check

parameters. A local attacker could exploit this to read arbitrary kernel

memory, leading to a loss of privacy. ([CVE-2010-3437](/security/CVE-2010-3437))

Dan Rosenberg discovered that the Sound subsystem did not correctly

validate parameters. A local attacker could exploit this to crash the

system, leading to a denial of service. ([CVE-2010-3442](/security/CVE-2010-3442))

Dan Rosenberg discovered that SCTP did not correctly handle HMAC

calculations. A remote attacker could send specially crafted traffic that

would crash the system, leading to a denial of service. ([CVE-2010-3705](/security/CVE-2010-3705))

Joel Becker discovered that OCFS2 did not correctly validate on-disk

symlink structures. If an attacker were able to trick a user or automated

system into mounting a specially crafted filesystem, it could crash the

system or expose kernel memory, leading to a loss of privacy.

(CVE-2010-NNN2)

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 9.10

* [linux-image-2.6.31-22-server](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-ia64](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-307-ec2](https://launchpad.net/ubuntu/%2Bsource/linux-ec2)
  -
  [2.6.31-307.21](https://launchpad.net/ubuntu/%2Bsource/linux-ec2/2.6.31-307.21)
* [linux-image-2.6.31-22-generic-pae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-386](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-powerpc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-sparc64](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-sparc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-virtual](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)
* [linux-image-2.6.31-22-lpia](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.31-22.67](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.31-22.67)

##### Ubuntu 9.04

* [linux-image-2.6.28-19-lpia](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.28-19.66](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.28-19.66)
* [linux-image-2.6.28-19-versatile](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.28-19.66](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.28-19.66)
* [linux-image-2.6.28-19-imx51](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.28-19.66](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.28-19.66)
* [linux-image-2.6.28-19-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.28-19.66](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.28-19.66)
* [linux-image-2.6.28-19-server](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.28-19.66](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.28-19.66)
* [linux-image-2.6.28-19-ixp4xx](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.28-19.66](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.28-19.66)
* [linux-image-2.6.28-19-virtual](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.28-19.66](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.28-19.66)
* [linux-image-2.6.28-19-iop32x](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.28-19.66](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.28-19.66)

##### Ubuntu 8.04

* [linux-image-2.6.24-28-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-hppa32](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-powerpc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-sparc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-itanium](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-openvz](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-virtual](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-rt](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-lpia](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-hppa64](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-mckinley](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-server](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-386](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-lpiacompat](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-sparc64](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)
* [linux-image-2.6.24-28-xen](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.24-28.80](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.24-28.80)

##### Ubuntu 6.06

* [linux-image-2.6.15-55-hppa64](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-mckinley](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-hppa32-smp](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-686](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-amd64-k8](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-amd64-server](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-386](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-sparc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-k7](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-sparc64](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-server](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-hppa32](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-mckinley-smp](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-server-bigiron](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-itanium-smp](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-amd64-xeon](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-powerpc](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-amd64-generic](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-hppa64-smp](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)
* [linux-image-2.6.15-55-itanium](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15)
  -
  [2.6.15-55.89](https://launchpad.net/ubuntu/%2Bsource/linux-source-2.6.15/2.6.15-55.89)

##### Ubuntu 10.10

* [linux-image-2.6.35-22-generic-pae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.35-22.35](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.35-22.35)
* [linux-image-2.6.35-22-powerpc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.35-22.35](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.35-22.35)
* [linux-image-2.6.35-22-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.35-22.35](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.35-22.35)
* [linux-image-2.6.35-22-versatile](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.35-22.35](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.35-22.35)
* [linux-image-2.6.35-22-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.35-22.35](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.35-22.35)
* [linux-image-2.6.35-22-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.35-22.35](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.35-22.35)
* [linux-image-2.6.35-22-virtual](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.35-22.35](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.35-22.35)
* [linux-image-2.6.35-22-server](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.35-22.35](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.35-22.35)
* [linux-image-2.6.35-22-omap](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.35-22.35](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.35-22.35)

##### Ubuntu 10.04

* [linux-image-2.6.32-25-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-lpia](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-386](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-sparc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-powerpc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-sparc64](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-generic-pae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-virtual](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-server](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-ia64](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-preempt](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-25-versatile](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)
* [linux-image-2.6.32-309-ec2](https://launchpad.net/ubuntu/%2Bsource/linux-ec2)
  -
  [2.6.32-309.18](https://launchpad.net/ubuntu/%2Bsource/linux-ec2/2.6.32-309.18)
* [linux-image-2.6.32-25-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [2.6.32-25.45](https://launchpad.net/ubuntu/%2Bsource/linux/2.6.32-25.45)

After a standard system update you need to reboot your computer to make

all the necessary changes.

## References

* [CVE-2010-2525](/security/CVE-2010-2525)
* [CVE-2009-4895](/security/CVE-2009-4895)
* [CVE-2010-2066](/security/CVE-2010-2066)
* [CVE-2010-2226](/security/CVE-2010-2226)
* [CVE-2010-2248](/security/CVE-2010-2248)
* [CVE-2010-2478](/security/CVE-2010-2478)
* [CVE-2010-2495](/security/CVE-2010-2495)
* [CVE-2010-2521](/security/CVE-2010-2521)
* [CVE-2010-2524](/security/CVE-2010-2524)
* [CVE-2010-2798](/security/CVE-2010-2798)
* [CVE-2010-2942](/security/CVE-2010-2942)
* [CVE-2010-2946](/security/CVE-2010-2946)
* [CVE-2010-2954](/security/CVE-2010-2954)
* [CVE-2010-2960](/security/CVE-2010-2960)
* [CVE-2010-2963](/security/CVE-2010-2963)
* [CVE-2010-3015](/security/CVE-2010-3015)
* [CVE-2010-3067](/security/CVE-2010-3067)
* [CVE-2010-3078](/security/CVE-2010-3078)
* [CVE-2010-3080](/security/CVE-2010-3080)
* [CVE-2010-3084](/security/CVE-2010-3084)
* [CVE-2010-3310](/security/CVE-2010-3310)
* [CVE-2010-3432](/security/CVE-2010-3432)
* [CVE-2010-3437](/security/CVE-2010-3437)
* [CVE-2010-3442](/security/CVE-2010-3442)
* [CVE-2010-3477](/security/CVE-2010-3477)
* [CVE-2010-3705](/security/CVE-2010-3705)
* [CVE-2010-3904](/security/CVE-2010-3904)
* <CVE-2010-NNN2>

## Related notices

* [USN-1074-1](/security/notices/USN-1074-1)
* [USN-1083-1](/security/notices/USN-1083-1)
* [USN-1074-2](/security/notices/USN-1074-2)
* [USN-1093-1](/security/notices/USN-1093-1)
* [USN-1119-1](/security/notices/USN-1119-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from lists.opensuse.org_f6f84250_20250125_063551.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/UDMH6BQEYPWE2HAWMSUDVWHLOVCMF7ER/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/UDMH6BQEYPWE2HAWMSUDVWHLOVCMF7ER/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/UDMH6BQEYPWE2HAWMSUDVWHLOVCMF7ER/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/UDMH6BQEYPWE2HAWMSUDVWHLOVCMF7ER/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/UDMH6BQEYPWE2HAWMSUDVWHLOVCMF7ER/#UDMH6BQEYPWE2HAWMSUDVWHLOVCMF7ER)

# [security-announce] SUSE Security Announcement: Linux kernel (SUSE-SA:2010:057)

![](https://seccdn.libravatar.org/avatar/bff0c215e01f23fcee6fe49e65fae458.jpg?s=120&d=mm&r=g)
## [Marcus Meissner](/archives/users/7f6ceefc1eac47b3aa8bbc0c4e1230fe/ "See the profile for Marcus Meissner")

11 Nov
2010

11 Nov
'10

14:47

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
SUSE Security Announcement
Package: kernel
Announcement ID: SUSE-SA:2010:057
Date: Thu, 11 Nov 2010 13:00:00 +0000
Affected Products: SUSE Linux Enterprise High Availability Extension 11 SP1
SUSE Linux Enterprise Desktop 11 SP1
SUSE Linux Enterprise Server 11 SP1
Vulnerability Type: local privilege escalation
CVSS v2 Base Score: 7.2 (AV:L/AC:L/Au:N/C:C/I:C/A:C)
SUSE Default Package: yes
Cross-References: CVE-2010-2963, CVE-2010-3865, CVE-2010-3904
Content of This Advisory:
1) Security Vulnerability Resolved:
Linux kernel security update
Problem Description
2) Solution or Work-Around
3) Special Instructions and Notes
4) Package Location and Checksums
5) Pending Vulnerabilities, Solutions, and Work-Arounds:
See SUSE Security Summary Report.
6) Authenticity Verification and Additional Information
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
1) Problem Description and Brief Discussion
This update of the SUSE Linux Enterprise 11 SP1 fixes three critical
security issues and some bugs.
Following security issues were fixed:
CVE-2010-3904: A local privilege escalation in RDS sockets allowed
local attackers to gain root privileges.
CVE-2010-2963: A problem in the compat ioctl handling in video4linux
allowed local attackers with a video device plugged in to gain root
privileges on x86\_64 systems.
Please note that the net/rds socket protocol module only lives in the
-extra kernel package, which is not installed by default on the SUSE
Linux Enterprise Server 11.
CVE-2010-2963: A problem in the compat ioctl handling in video4linux
allowed local attackers with a video device plugged in to gain
privileges on x86\_64 systems.
2) Solution or Work-Around
There is no known workaround, please install the update packages.
3) Special Instructions and Notes
Please reboot the machine after installing the update.
4) Package Location and Checksums
The preferred method for installing security updates is to use the YaST
"Online Update" module or the "zypper" commandline tool. The package and
patch management stack will detect which updates are required and
automatically perform the necessary steps to verify and install them.
Alternatively, download the update packages for your distribution manually
and verify their integrity by the methods listed in Section 6 of this
announcement. Then install the packages using the command
rpm -Fhv <file.rpm>
to apply the update, replacing <file.rpm> with the filename of the
downloaded RPM package.
Our maintenance customers are notified individually. The packages are
offered for installation from the maintenance web:
SUSE Linux Enterprise Desktop 11 SP1
[http://download.novell.com/patch/finder/?keywords=f01275198337ab5cb5d84d49e7...](http://download.novell.com/patch/finder/?keywords=f01275198337ab5cb5d84d49e735536a)
[http://download.novell.com/patch/finder/?keywords=4b53dedac262e9445a17875eb5...](http://download.novell.com/patch/finder/?keywords=4b53dedac262e9445a17875eb5c427c1)
SUSE Linux Enterprise High Availability Extension 11 SP1
[http://download.novell.com/patch/finder/?keywords=f01275198337ab5cb5d84d49e7...](http://download.novell.com/patch/finder/?keywords=f01275198337ab5cb5d84d49e735536a)
[http://download.novell.com/patch/finder/?keywords=62e204eb8d1d000a79827a7025...](http://download.novell.com/patch/finder/?keywords=62e204eb8d1d000a79827a7025517cb0)
[http://download.novell.com/patch/finder/?keywords=adc9683d6a609c0277de95be53...](http://download.novell.com/patch/finder/?keywords=adc9683d6a609c0277de95be53889718)
[http://download.novell.com/patch/finder/?keywords=eeac7bc3f9cb557c84227f368f...](http://download.novell.com/patch/finder/?keywords=eeac7bc3f9cb557c84227f368fc501dd)
[http://download.novell.com/patch/finder/?keywords=4b53dedac262e9445a17875eb5...](http://download.novell.com/patch/finder/?keywords=4b53dedac262e9445a17875eb5c427c1)
SUSE Linux Enterprise Server 11 SP1
[http://download.novell.com/patch/finder/?keywords=f01275198337ab5cb5d84d49e7...](http://download.novell.com/patch/finder/?keywords=f01275198337ab5cb5d84d49e735536a)
[http://download.novell.com/patch/finder/?keywords=62e204eb8d1d000a79827a7025...](http://download.novell.com/patch/finder/?keywords=62e204eb8d1d000a79827a7025517cb0)
[http://download.novell.com/patch/finder/?keywords=adc9683d6a609c0277de95be53...](http://download.novell.com/patch/finder/?keywords=adc9683d6a609c0277de95be53889718)
[http://download.novell.com/patch/finder/?keywords=eeac7bc3f9cb557c84227f368f...](http://download.novell.com/patch/finder/?keywords=eeac7bc3f9cb557c84227f368fc501dd)
[http://download.novell.com/patch/finder/?keywords=4b53dedac262e9445a17875eb5...](http://download.novell.com/patch/finder/?keywords=4b53dedac262e9445a17875eb5c427c1)
[http://download.novell.com/patch/finder/?keywords=368f948d6daf9ef61742659841...](http://download.novell.com/patch/finder/?keywords=368f948d6daf9ef617426598410ee91b)
[http://download.novell.com/patch/finder/?keywords=b754e974a6256476bb650664f4...](http://download.novell.com/patch/finder/?keywords=b754e974a6256476bb650664f4a62cee)
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
5) Pending Vulnerabilities, Solutions, and Work-Arounds:
See SUSE Security Summary Report.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
6) Authenticity Verification and Additional Information
- Announcement authenticity verification:
SUSE security announcements are published via mailing lists and on Web
sites. The authenticity and integrity of a SUSE security announcement is
guaranteed by a cryptographic signature in each announcement. All SUSE
security announcements are published with a valid signature.
To verify the signature of the announcement, save it as text into a file
and run the command
gpg --verify <file>
replacing <file> with the name of the file where you saved the
announcement. The output for a valid signature looks like:
gpg: Signature made <DATE> using RSA key ID 3D25D3D9
gpg: Good signature from "SuSE Security Team <security@suse.de>"
where <DATE> is replaced by the date the document was signed.
If the security team's key is not contained in your key ring, you can
import it from the first installation CD. To import the key, use the
command
gpg --import gpg-pubkey-3d25d3d9-36e12d04.asc
- Package authenticity verification:
SUSE update packages are available on many mirror FTP servers all over the
world. While this service is considered valuable and important to the free
and open source software community, the authenticity and the integrity of
a package needs to be verified to ensure that it has not been tampered
with.
The internal rpm package signatures provide an easy way to verify the
authenticity of an RPM package. Use the command
rpm -v --checksig <file.rpm>
to verify the signature of the package, replacing <file.rpm> with the
filename of the RPM package downloaded. The package is unmodified if it
contains a valid signature from build@suse.de with the key ID 9C800ACA.
This key is automatically imported into the RPM database (on
RPMv4-based distributions) and the gpg key ring of 'root' during
installation. You can also find it on the first installation CD and at
the end of this announcement.
- SUSE runs two security mailing lists to which any interested party may
subscribe:
opensuse-security@opensuse.org
- General Linux and SUSE security discussion.
All SUSE security announcements are sent to this list.
To subscribe, send an e-mail to
<opensuse-security+subscribe@opensuse.org>.
opensuse-security-announce@opensuse.org
- SUSE's announce-only mailing list.
Only SUSE's security announcements are sent to this list.
To subscribe, send an e-mail to
<opensuse-security-announce+subscribe@opensuse.org>.
=====================================================================
SUSE's security contact is <security@suse.com> or <security@suse.de>.
The <security@suse.de> public key is listed below.
=====================================================================
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
The information in this advisory may be distributed or reproduced,
provided that the advisory is not modified in any way. In particular, the
clear text signature should show proof of the authenticity of the text.
SUSE Linux Products GmbH provides no warranties of any kind whatsoever
with respect to the information contained in this security advisory.
Type Bits/KeyID Date User ID
pub 2048R/3D25D3D9 1999-03-06 SuSE Security Team <security@suse.de>
pub 1024D/9C800ACA 2000-10-19 SuSE Package Signing Key <build@suse.de>
- -----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.2 (GNU/Linux)
mQENAzbhLQQAAAEIAKAkXHe0lWRBXLpn38hMHy03F0I4Sszmoc8aaKJrhfhyMlOA
BqvklPLE2f9UrI4Xc860gH79ZREwAgPt0pi6+SleNFLNcNFAuuHMLQOOsaMFatbz
JR9i4m/lf6q929YROu5zB48rBAlcfTm+IBbijaEdnqpwGib45wE/Cfy6FAttBHQh
1Kp+r/jPbf1mYAvljUfHKuvbg8t2EIQz/5yGp+n5trn9pElfQO2cRBq8LFpf1l+U
P7EKjFmlOq+Gs/fF98/dP3DfniSd78LQPq5vp8RL8nr/o2i7jkAQ33m4f1wOBWd+
cZovrKXYlXiR+Bf7m2hpZo+/sAzhd7LmAD0l09kABRG0JVN1U0UgU2VjdXJpdHkg
VGVhbSA8c2VjdXJpdHlAc3VzZS5kZT6JARUDBRA24S1H5Fiyh7HKPEUBAVcOB/9b
yHYji1/+4Xc2GhvXK0FSJN0MGgeXgW47yxDL7gmR4mNgjlIOUHZj0PEpVjWepOJ7
tQS3L9oP6cpj1Fj/XxuLbkp5VCQ61hpt54coQAvYrnT9rtWEGN+xmwejT1WmYmDJ
xG+EGBXKr+XP69oIUl1E2JO3rXeklulgjqRKos4cdXKgyjWZ7CP9V9daRXDtje63
Om8gwSdU/nCvhdRIWp/Vwbf7Ia8iZr9OJ5YuQl0DBG4qmGDDrvImgPAFkYFzwlqo
choXFQ9y0YVCV41DnR+GYhwl2qBd81T8aXhihEGPIgaw3g8gd8B5o6mPVgl+nJqI
BkEYGBusiag2pS6qwznZiQEVAwUQNuEtBHey5gA9JdPZAQFtOAf+KVh939b0J94u
v/kpg4xs1LthlhquhbHcKNoVTNspugiC3qMPyvSX4XcBr2PC0cVkS4Z9PY9iCfT+
x9WM96g39dAF+le2CCx7XISk9XXJ4ApEy5g4AuK7NYgAJd39PPbERgWnxjxir9g0
Ix30dS30bW39D+3NPU5Ho9TD/B7UDFvYT5AWHl3MGwo3a1RhTs6sfgL7yQ3U+mvq
MkTExZb5mfN1FeaYKMopoI4VpzNVeGxQWIz67VjJHVyUlF20ekOz4kWVgsxkc8G2
saqZd6yv2EwqYTi8BDAduweP33KrQc4KDDommQNDOXxaKOeCoESIdM4p7Esdjq1o
L0oixF12CohGBBARAgAGBQI7HmHDAAoJEJ5A4xAACqukTlQAoI4QzP9yjPohY7OU
F7J3eKBTzp25AJ42BmtSd3pvm5ldmognWF3Trhp+GYkAlQMFEDe3O8IWkDf+zvyS
FQEBAfkD/3GG5UgJj18UhYmh1gfjIlDcPAeqMwSytEHDENmHC+vlZQ/p0mT9tPiW
tp34io54mwr+bLPN8l6B5GJNkbGvH6M+mO7R8Lj4nHL6pyAv3PQr83WyLHcaX7It
Klj371/4yzKV6qpz43SGRK4MacLo2rNZ/dNej7lwPCtzCcFYwqkiiEYEEBECAAYF
AjoaQqQACgkQx1KqMrDf94ArewCfWnTUDG5gNYkmHG4bYL8fQcizyA4An2eVo/n+
3J2KRWSOhpAMsnMxtPbBmQGiBDnu9IERBACT8Y35+2vv4MGVKiLEMOl9GdST6MCk
YS3yEKeueNWc+z/0Kvff4JctBsgs47tjmiI9sl0eHjm3gTR8rItXMN6sJEUHWzDP
+Y0PFPboMvKx0FXl/A0dM+HFrruCgBlWt6FA+okRySQiliuI5phwqkXefl9AhkwR
8xocQSVCFxcwvwCglVcOQliHu8jwRQHxlRE0tkwQQI0D+wfQwKdvhDplxHJ5nf7U
8c/yE/vdvpN6lF0tmFrKXBUX+K7u4ifrZlQvj/81M4INjtXreqDiJtr99Rs6xa0S
cZqITuZC4CWxJa9GynBED3+D2t1V/f8l0smsuYoFOF7Ib49IkTdbtwAThlZp8bEh
ELBeGaPdNCcmfZ66rKUdG5sRA/9ovnc1krSQF2+sqB9/o7w5/q2qiyzwOSTnkjtB
UVKn4zLUOf6aeBAoV6NMCC3Kj9aZHfA+ND0ehPaVGJgjaVNFhPi4x0e7BULdvgOo
AqajLfvkURHAeSsxXIoEmyW/xC1sBbDkDUIBSx5oej73XCZgnj/inphRqGpsb+1n
KFvF+rQoU3VTRSBQYWNrYWdlIFNpZ25pbmcgS2V5IDxidWlsZEBzdXNlLmRlPohi
BBMRAgAiBQJA2AY+AhsDBQkObd+9BAsHAwIDFQIDAxYCAQIeAQIXgAAKCRCoTtro
nIAKypCfAJ9RuZ6ZSV7QW4pTgTIxQ+ABPp0sIwCffG9bCNnrETPlgOn+dGEkAWeg
KL+IRgQQEQIABgUCOnBeUgAKCRCeQOMQAAqrpNzOAKCL512FZvv4VZx94TpbA9lx
yoAejACeOO1HIbActAevk5MUBhNeLZa/qM2JARUDBRA6cGBvd7LmAD0l09kBATWn
B/9An5vfiUUE1VQnt+T/EYklES3tXXaJJp9pHMa4fzFa8jPVtv5UBHGee3XoUNDV
wM2OgSEISZxbzdXGnqIlcT08TzBUD9i579uifklLsnr35SJDZ6ram51/CWOnnaVh
UzneOA9gTPSr+/fT3WeVnwJiQCQ30kNLWVXWATMnsnT486eAOlT6UNBPYQLpUprF
5Yryk23pQUPAgJENDEqeU6iIO9Ot1ZPtB0lniw+/xCi13D360o1tZDYOp0hHHJN3
D3EN8C1yPqZd5CvvznYvB6bWBIpWcRgdn2DUVMmpU661jwqGlRz1F84JG/xe4jGu
zgpJt9IXSzyohEJB6XG5+D0BuQINBDnu9JIQCACEkdBN6Mxf5WvqDWkcMRy6wnrd
9DYJ8UUTmIT2iQf07tRUKJJ9v0JXfx2Z4d08IQSMNRaq4VgSe+PdYgIy0fbj23Vi
a5/gO7fJEpD2hd2f+pMnOWvH2rOOIbeYfuhzAc6BQjAKtmgR0ERUTafTM9Wb6F13
CNZZNZfDqnFDP6L12w3z3F7FFXkz07Rs3AIto1ZfYZd4sCSpMr/0S5nLrHbIvGLp
271hhQBeRmmoGEKO2JRelGgUJ2CUzOdtwDIKT0LbCpvaP8PVnYF5IFoYJIWRHqlE
t5ucTXstZy7vYjL6vTP4l5xs+LIOkNmPhqmfsgLzVo0UaLt80hOwc4NvDCOLAAMG
B/9g+9V3ORzw4LvO1pwRYJqfDKUq/EJ0rNMMD4N8RLpZRhKHKJUm9nNHLbksnlZw
rbSTM5LpC/U6sheLP+l0bLVoq0lmsCcUSyh+mY6PxWirLIWCn/IAZAGnXb6Zd6Tt
IJlGG6pqUN8QxGJYQnonl0uTJKHJENbI9sWHQdcTtBMc34gorHFCo1Bcvpnc1LFL
rWn7mfoGx6INQjf3HGQpMXAWuSBQhzkazY6vaWFpa8bBJ+gKbBuySWzNm3rFtT5H
RKMWpO+M9bHp4d+puY0L1YwN1OMatcMMpcWnZpiWiR83oi32+xtWUY2U7Ae38mMa
g8zFbpeqPQUsDv9V7CAJ1dbriEwEGBECAAwFAkDYBnoFCQ5t3+gACgkQqE7a6JyA
CspnpgCfRbYwxT3iq+9l/PgNTUNTZOlof2oAn25y0eGi0371jap9kOV6uq71sUuO
=ypVs
- -----END PGP PUBLIC KEY BLOCK-----
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.15 (GNU/Linux)
iQEVAwUBTNwB7ney5gA9JdPZAQLJqwgAnhfE9W8sAk0qhB+1aE8OWNYKaSPONTnd
o/YrhNWzRiF34wtojVOcrRbeSjnGHBfn5iSgwjAJ59MSpqkTTaXcBuMqEmkfxpNC
WgDTGTqOPyYEmIDz0nPCrd+0vmzTFobklb/ytbpeXdz47WAxDaQVt+1aKW+ylMDQ
zuVXvOp5b+8V+vvMrS5Snit8jbAId9bqRPdORrmUkZeQ88C7wJ5o/AuZVjVqxwKO
Y9WYTXFydez7HeEHjo4ziPcxADHE3ZWXk277YvV+M1Uhks4TdnJ2cYZDMccXnjZM
/t1+HjwFdF4FCI3c36K8EwzvYE+/9/bBcdjCgsZVsEeSlcveEyWqfQ==
=Gm1l
-----END PGP SIGNATURE-----
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/UDMH6BQEYPWE2HAWMSUDVWHLOVCMF7ER/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/UDMH6BQEYPWE2HAWMSUDVWHLOVCMF7ER/#UDMH6BQEYPWE2HAWMSUDVWHLOVCMF7ER)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from outflux.net_4523324d_20250126_064447.html ===

# [codeblog](https://outflux.net/blog/) code is freedom — patching my itch

## October 26, 2023

### [Enable MTE on Pixel 8](https://outflux.net/blog/archives/2023/10/26/enable-mte-on-pixel-8/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/) — kees @ 12:19 pm

The Pixel 8 hardware ([Tensor G3](https://www.androidpolice.com/google-tensor-g3/)) supports the ARM [Memory Tagging Extension (MTE)](https://source.android.com/docs/security/test/memory-safety/arm-mte), and software support is available both in Android userspace and the Linux kernel. This feature is a powerful defense against linear buffer overflows and many types of use-after-free flaws. I’m extremely happy to see this hardware finally available in the real world.

Turning it on for userspace is already wired up the Android UI: `Settings / System / Developer options / Memory Tagging Extension / Enable MTE until you turn if off`. Once enabled it will internally change an Android “system property” named “[`arm64.memtag.bootctl`](https://source.android.com/docs/security/test/memory-safety/bootloader-support)” by adding the option “`memtag`“.

Turning it on for the kernel is slightly more involved, but not difficult at all. This requires manually setting the “`arm64.memtag.bootctl`” property mentioned above to include “`memtag-kernel`” as well:

* Plug your phone into a system that can run the `adb` tool
* If not already installed, install `adb`. For example on Debian/Ubuntu: `sudo apt install adb`
* Turn on “USB Debugging” in the phone’s “Developer options” menu, and accept the debugging session confirmation that will pop up when you first run `adb`
* Verify the current setting: `adb shell getprop | grep memtag.bootctl`

`[arm64.memtag.bootctl]: [memtag]`

* Enable kernel MTE: `adb shell setprop arm64.memtag.bootctl memtag,memtag-kernel`
* Check the results: `adb shell getprop | grep memtag.bootctl`

`[arm64.memtag.bootctl]: [memtag,memtag-kernel]`

* Reboot your phone

To check that MTE is enabled for the kernel (which is implemented using [Kernel Address Sanitizer’s Hardware Tagging](https://docs.kernel.org/dev-tools/kasan.html#hardware-tag-based-kasan) mode), you can check the kernel command line after rebooting:

```

$ mkdir foo && cd foo
$ adb bugreport
...
$ mkdir unpacked && cd unpacked
$ unzip ../bugreport*.zip
...
$ grep kasan= bugreport*.txt
...: Command line: ... kasan=off ... kasan=on ...

```

The latter “`kasan=on`” overrides the earlier “`kasan=off`“.

Enjoy!

© 2023, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on Enable MTE on Pixel 8
## June 24, 2022

### [finding binary differences](https://outflux.net/blog/archives/2022/06/24/finding-binary-differences/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 1:11 pm

As part of the continuing work to [replace 1-element arrays in the Linux kernel](https://github.com/KSPP/linux/issues/79), it’s very handy to show that a source change has had no executable code difference. For example, if you started with this:

```

struct foo {
    unsigned long flags;
    u32 length;
    u32 data[1];
};

void foo_init(int count)
{
    struct foo *instance;
    size_t bytes = sizeof(*instance) + sizeof(u32) * (count - 1);
    ...
    instance = kmalloc(bytes, GFP_KERNEL);
    ...
};

```

And you changed only the struct definition:

```

-    u32 data[1];
+    u32 data[];

```

The `bytes` calculation is going to be incorrect, since it is still subtracting 1 element’s worth of space from the desired count. (And let’s ignore for the moment the open-coded calculation that may end up with an arithmetic over/underflow here; that can be solved separately by using the `struct_size()` helper or the `size_mul()`, `size_add()`, etc family of helpers.)

The missed adjustment to the size calculation is relatively easy to find in this example, but sometimes it’s much less obvious how structure sizes might be woven into the code. I’ve been checking for issues by using the fantastic [diffoscope](https://diffoscope.org/) tool. It can produce a LOT of noise if you try to compare builds without keeping in mind the issues solved by [reproducible builds](https://docs.kernel.org/kbuild/reproducible-builds.html), with some additional notes. I prepare my build with the “known to disrupt code layout” options disabled, but with debug info enabled:

```

$ KBF="KBUILD_BUILD_TIMESTAMP=1980-01-01 KBUILD_BUILD_USER=user KBUILD_BUILD_HOST=host KBUILD_BUILD_VERSION=1"
$ OUT=gcc
$ make $KBF O=$OUT allmodconfig
$ ./scripts/config --file $OUT/.config \
        -d GCOV_KERNEL -d KCOV -d GCC_PLUGINS -d IKHEADERS -d KASAN -d UBSAN \
        -d DEBUG_INFO_NONE -e DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT
$ make $KBF O=$OUT olddefconfig

```

Then I build a stock target, saving the output in “before”. In this case, I’m examining `drivers/scsi/megaraid/`:

```

$ make -jN $KBF O=$OUT drivers/scsi/megaraid/
$ mkdir -p $OUT/before
$ cp $OUT/drivers/scsi/megaraid/*.o $OUT/before/

```

Then I patch and build a modified target, saving the output in “after”:

```

$ vi the/source/code.c
$ make -jN $KBF O=$OUT drivers/scsi/megaraid/
$ mkdir -p $OUT/after
$ cp $OUT/drivers/scsi/megaraid/*.o $OUT/after/

```

And then run `diffoscope`:

```

$ diffoscope $OUT/before/ $OUT/after/

```

If `diffoscope` output reports nothing, then we’re done. 🥳

Usually, though, when source lines move around other stuff will shift too (e.g. `WARN` macros rely on line numbers, so the bug table may change contents a bit, etc), and `diffoscope` output will look noisy. To examine just the executable code, the command that `diffoscope` used is reported in the output, and we can run it directly, but with possibly shifted line numbers not reported. i.e. running `objdump` without `--line-numbers`:

```

$ ARGS="--disassemble --demangle --reloc --no-show-raw-insn --section=.text"
$ for i in $(cd $OUT/before && echo *.o); do
        echo $i
        diff -u <(objdump $ARGS $OUT/before/$i | sed "0,/^Disassembly/d") \
                <(objdump $ARGS $OUT/after/$i  | sed "0,/^Disassembly/d")
done

```

If I see an unexpected difference, for example:

```

-    c120:      movq   $0x0,0x800(%rbx)
+    c120:      movq   $0x0,0x7f8(%rbx)

```

Then I'll search for the pattern with line numbers added to the `objdump` output:

```

$ vi <(objdump --line-numbers $ARGS $OUT/after/megaraid_sas_fp.o)

```

I'd search for "0x0,0x7f8", find the source file and line number above it, open that source file at that position, and look to see where something was being miscalculated:

```

$ vi drivers/scsi/megaraid/megaraid_sas_fp.c +329

```

Once tracked down, I'd start over at the "patch and build a modified target" step above, repeating until there were no differences. For example, in the starting example, I'd also need to make this change:

```

-    size_t bytes = sizeof(*instance) + sizeof(u32) * (count - 1);
+    size_t bytes = sizeof(*instance) + sizeof(u32) * count;

```

Though, as hinted earlier, better yet would be:

```

-    size_t bytes = sizeof(*instance) + sizeof(u32) * (count - 1);
+    size_t bytes = struct_size(instance, data, count);

```

But sometimes adding the helper usage will add binary output differences since they're performing overflow checking that might saturate at `SIZE_MAX`. To help with patch clarity, those changes can be done separately from fixing the array declaration.

© 2022 - 2023, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on finding binary differences
## April 4, 2022

### [security things in Linux v5.10](https://outflux.net/blog/archives/2022/04/04/security-things-in-linux-v5-10/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 5:01 pm

Previously: [v5.9](/blog/archives/2021/04/05/security-things-in-linux-v5-9/)

Linux [v5.10 was released in December, 2020](https://lore.kernel.org/lkml/CAHk-%3DwhCKhxNyKn1Arut8xUDKTwp3fWcCj_jbL5dbzkUmo45gQ%40mail.gmail.com). Here’s my summary of various security things that I found interesting:

**AMD SEV-ES**

While guest VM memory encryption with AMD SEV has been supported for a while, Joerg Roedel, Thomas Lendacky, and others added [register state encryption (SEV-ES)](https://git.kernel.org/linus/da9803dfd3955bd2f9909d55e23f188ad76dbe58). This means it’s even harder for a VM host to reconstruct a guest VM’s state.

**x86 static calls**

Josh Poimboeuf and Peter Zijlstra implemented [static calls](https://git.kernel.org/linus/dd502a81077a5f3b3e19fa9a1accffdcab5ad5bc) for x86, which operates very similarly to the “static branch” infrastructure in the kernel. With static branches, an `if`/`else` choice can be hard-coded, instead of being run-time evaluated every time. Such branches can be updated too (the kernel just rewrites the code to switch around the “branch”). All these principles apply to static calls as well, but they’re for replacing indirect function calls (i.e. a call through a function pointer) with a direct call (i.e. a hard-coded call address). This eliminates the need for Spectre mitigations (e.g. RETPOLINE) for these indirect calls, and avoids a memory lookup for the pointer. For hot-path code (like the scheduler), this has a measurable performance impact. It also serves as a kind of Control Flow Integrity implementation: an indirect call got removed, and the potential destinations have been explicitly identified at compile-time.

**network RNG improvements**

In an effort to improve the pseudo-random number generator used by the network subsystem (for things like port numbers and packet sequence numbers), Linux’s home-grown [pRNG has been replaced by the SipHash round function](https://git.kernel.org/linus/c51f8f88d705e06bd696d7510aff22b33eb8e638), and [perturbed](https://git.kernel.org/linus/3744741adab6d9195551ce30e65e726c7a408421) by (hopefully) hard-to-predict internal kernel states. This should make it very hard to brute force the internal state of the pRNG and make predictions about future random numbers just from examining network traffic. Similarly, [ICMP’s global rate limiter](https://git.kernel.org/linus/b38e7819cae946e2edf869e604af1e65a5d241c5) was adjusted to avoid leaking details of network state, as a start to fixing recent [DNS Cache Poisoning](https://www.saddns.net/) attacks.

**SafeSetID handles GID**

Thomas Cedeno improved the [SafeSetID LSM](https://www.kernel.org/doc/html/latest/admin-guide/LSM/SafeSetID.html) to [handle group IDs](https://git.kernel.org/linus/5294bac97e12bdabbb97e9adf44d388612a700b8) (which required teaching the kernel about which syscalls were [actually performing setgid](https://git.kernel.org/linus/5294bac97e12bdabbb97e9adf44d388612a700b8).) Like the earlier [setuid policy](/blog/archives/2019/05/27/security-things-in-linux-v5-1/#v5.1-safesetid), this lets the system owner define an explicit list of allowed group ID transitions under `CAP_SETGID` (instead of to just any group), providing a way to keep the power of granting this capability much more limited. (This isn’t complete yet, though, since handling `setgroups()` is still needed.)

**improve kernel’s internal checking of file contents**

The kernel provides LSMs (like the Integrity subsystem) with details about files as they’re loaded. (For example, loading modules, new kernel images for kexec, and firmware.) There wasn’t very good coverage for cases where the contents were coming from things that weren’t files. To deal with this, [new hooks were added](https://git.kernel.org/linus/b64fcae74b6d6940d14243c963ab0089e8f0d82d) that allow the LSMs to introspect the contents directly, and to do partial reads. This will give the LSMs much finer grain visibility into these kinds of operations.

**set\_fs removal continues**

With the [earlier work](/blog/archives/2021/02/08/security-things-in-linux-v5-8/#v5.8-set_fs) landed to free the core kernel code from `set_fs()`, Christoph Hellwig made it possible for [set\_fs() to be optional for an architecture](https://git.kernel.org/linus/3c57fa13f6bf3906643034c57736c778ce63fa55). Subsequently, he then removed `set_fs()` entirely for [x86](https://git.kernel.org/linus/47058bb54b57962b3958a936ddbc59355e4c5504), [riscv](https://git.kernel.org/linus/e8d444d3e98c255f91d228984abc46cfdfaf48b4), and [powerpc](https://git.kernel.org/linus/5ae4998b5d6fc703a16c9fa935fb7d335843bf22). These architectures will now be free from the entire class of “kernel address limit” attacks that only needed to corrupt a single value in `struct thead_info`.

**sysfs\_emit() replaces sprintf() in /sys**

Joe Perches tackled one of the most common bug classes with `sprintf()` and `snprintf()` in `/sys` handlers by creating a new helper, [`sysfs_emit()`](https://git.kernel.org/linus/2efc459d06f1630001e3984854848a5647086232). This will handle the cases where kernel code was not correctly dealing with the length results from `sprintf()` calls, which might lead to buffer overflows in the `PAGE_SIZE` buffer that `/sys` handlers operate on. With the helper in place, it was possible to [start the refactoring](https://git.kernel.org/linus/aa838896d87af561a33ecefea1caa4c15a68bc47) of the many `sprintf()` callers.

**nosymfollow mount option**

Mattias Nissler and Ross Zwisler implemented the [`nosymfollow` mount option](https://git.kernel.org/linus/dab741e0e02bd3c4f5e2e97be74b39df2523fc6e). This entirely disables symlink resolution for the given filesystem, similar to other mount options where `noexec` disallows `execve()`, `nosuid` disallows setid bits, and `nodev` disallows device files. Quoting the patch, it is “useful as a defensive measure for systems that need to deal with untrusted file systems in privileged contexts.” (i.e. for when `/proc/sys/fs/protected_symlinks` isn’t a big enough hammer.) Chrome OS uses this option for its stateful filesystem, as symlink traversal as been a [common attack-persistence vector](https://sites.google.com/a/chromium.org/dev/chromium-os/chromiumos-design-docs/hardening-against-malicious-stateful-data#TOC-Restricting-symlink-traversal).

**ARMv8.5 Memory Tagging Extension support**

Vincenzo Frascino added support to arm64 for the coming Memory Tagging Extension, which will be available for ARMv8.5 and later chips. It provides 4 bits of tags (covering multiples of 16 byte spans of the address space). This is enough to deterministically eliminate all linear heap buffer overflow flaws (1 tag for “free”, and then rotate even values and odd values for neighboring allocations), which is probably one of the most common bugs being currently exploited. It also makes use-after-free and over/under indexing much more difficult for attackers (but still possible if the target’s tag bits can be exposed). Maybe some day we can switch to 128 bit virtual memory addresses and have fully versioned allocations. But for now, 16 tag values is better than none, though we do still need to wait for anyone to actually be shipping ARMv8.5 hardware.

**fixes for flaws found by UBSAN**

The work to make [UBSAN generally usable](/blog/archives/2020/09/21/security-things-in-linux-v5-7/#v5.7-array-bounds) under [syzkaller](https://syzkaller.appspot.com/upstream#open) continues to bear fruit, with various [fixes](https://git.kernel.org/linus/2c334e12f957) all over the kernel for stuff like [shift](https://git.kernel.org/linus/eb2667b34336)-out-of-[bounds](https://git.kernel.org/linus/0425e7badbdc), [divide-by-zero](https://git.kernel.org/linus/22f760941844), and [integer overflow](https://git.kernel.org/linus/cb47755725da). Seeing these kinds of patches land reinforces the the rationale of shifting the burden of these kinds of checks to the toolchain: these run-time bugs continue to pop up.

**flexible array conversions**

The work on [flexible array conversions](/blog/archives/2021/04/05/security-things-in-linux-v5-9/) continues. Gustavo A. R. Silva and others continued to grind on the [conversions](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.10&qt=grep&q=flex.*array), getting the kernel ever closer to being able to enable the `-Warray-bounds` compiler flag and clear the path for saner bounds checking of array indexes and `memcpy()` usage.

That’s it for now! Please let me know if you think anything else needs some attention. Next up is Linux v5.11.

© 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (4)](https://outflux.net/blog/archives/2022/04/04/security-things-in-linux-v5-10/#comments)
## April 5, 2021

### [security things in Linux v5.9](https://outflux.net/blog/archives/2021/04/05/security-things-in-linux-v5-9/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:24 pm

Previously: [v5.8](/blog/archives/2021/02/08/security-things-in-linux-v5-8/)

Linux [v5.9 was released in October, 2020](https://lore.kernel.org/lkml/CAHk-%3Dwi-u86%2B%2Bnp80GQvgDuARdt9xpBNho6SjHLmYgm8jibGag%40mail.gmail.com). Here’s my summary of various security things that I found interesting:

**seccomp user\_notif file descriptor injection**

Sargun Dhillon added the ability for `SECCOMP_RET_USER_NOTIF` filters to [inject file descriptors into the target process](https://git.kernel.org/linus/7cf97b12545503992020796c74bd84078eb39299) using `SECCOMP_IOCTL_NOTIF_ADDFD`. This lets container managers fully emulate syscalls like `open()` and `connect()`, where an actual file descriptor is expected to be available after a successful syscall. In the process I [fixed](https://git.kernel.org/linus/d9539752d23283db4692384a634034f451261e29) a couple [bugs](https://git.kernel.org/linus/4969f8a073977123504609d7310b42a588297aa4) and [refactored](https://git.kernel.org/linus/c0029de50982c1fb215330a5f9d433cec0cfd8cc) the file descriptor receiving code.

**zero-initialize stack variables with Clang**

When Alexander Potapenko landed support for Clang’s [automatic variable initialization](/blog/archives/2019/07/17/security-things-in-linux-v5-2/#v5.2-var-init), it did so with a byte pattern designed to really stand out in kernel crashes. Now he’s added support for doing [zero initialization](https://git.kernel.org/linus/f0fe00d4972a8cd4b98cc2c29758615e4d51cdfe) via `CONFIG_INIT_STACK_ALL_ZERO`, which besides actually being faster, has a few behavior benefits as well. “Unlike pattern initialization, which has a higher chance of triggering existing bugs, zero initialization provides safe defaults for strings, pointers, indexes, and sizes.” Like the pattern initialization, this feature stops entire classes of uninitialized stack variable flaws.

**common syscall entry/exit routines**

Thomas Gleixner created [architecture-independent code to do syscall entry/exit](https://git.kernel.org/linus/fc4177be963dccad73b98d7db3a8a38911f952b7), since much of the kernel’s work during a syscall entry and exit is the same. There was no need to repeat this in each architecture, and having it implemented separately meant bugs (or features) might only get fixed (or implemented) in a handful of architectures. It means that features like seccomp become much easier to build since it wouldn’t need per-architecture implementations any more. Presently only [x86 has switched over to the common routines](https://git.kernel.org/linus/27d6b4d14f5c3ab21c4aef87dd04055a2d7adf14).

**SLAB `kfree()` hardening**

To reach `CONFIG_SLAB_FREELIST_HARDENED` feature-parity with the SLUB heap allocator, I added [naive double-free detection](https://git.kernel.org/linus/dabc3e291d56e3125113101bc6d53d1a1738294d) and the ability to [detect cross-cache freeing](https://git.kernel.org/linus/3404be67bf73515babd74acd8525d09dafe4234d) in the SLAB allocator. This should keep a class of type-confusion bugs from biting kernels using SLAB. (Most distro kernels use SLUB, but some smaller devices prefer the slightly more compact SLAB, so this hardening is mostly aimed at those systems.)

**new `CAP_CHECKPOINT_RESTORE` capability**

Adrian Reber added the [new `CAP_CHECKPOINT_RESTORE` capability](https://git.kernel.org/linus/124ea650d3072b005457faed69909221c2905a1f), splitting this functionality off of `CAP_SYS_ADMIN`. The needs for the kernel to correctly checkpoint and restore a process (e.g. used to move processes between containers) continues to grow, and it became clear that the security implications were lower than those of `CAP_SYS_ADMIN` yet distinct from other capabilities. Using this capability is now the preferred method for doing things like [changing `/proc/self/exe`](https://git.kernel.org/linus/ebd6de6812387a2db9a52842cfbe004da1dd3be8).

**`debugfs` boot-time visibility restriction**

Peter Enderborg added the [`debugfs` boot parameter](https://git.kernel.org/linus/a24c6f7bc923d5e2f3139855eb09b0d480d6b410) to control the visibility of the kernel’s debug filesystem. The contents of debugfs continue to be a common area of sensitive information being exposed to attackers. While this was effectively possible by unsetting `CONFIG_DEBUG_FS`, that wasn’t a great approach for system builders needing a single set of kernel configs (e.g. a distro kernel), so now it can be disabled at boot time.

**more seccomp architecture support**

Michael Karcher implemented the [SuperH seccomp hooks](https://git.kernel.org/linus/0bb605c2c7f2b4b314b91510810b226de7f34fa1), Guo Ren implemented the [C-SKY seccomp hooks](https://git.kernel.org/linus/e95a4f8cb985e759648b32ed0b721a472deb86a5), and Max Filippov implemented the [xtensa seccomp hooks](https://git.kernel.org/linus/da94a40f72859ce24dc72de9292981513a33e427). Each of these included the ever-important updates to the seccomp regression testing suite in the kernel selftests.

**stack protector support for RISC-V**

Guo Ren implemented [`-fstack-protector` (and `-fstack-protector-strong`) support for RISC-V](https://git.kernel.org/linus/f2c9699f65557a31fed4ddb9e5b4d9489b1bf32f). This is the initial global-canary support while the patches to GCC to support per-task canaries is getting finished (similar to the per-task canaries done for arm64). This will mean nearly all stack frame write overflows are no longer useful to attackers on this architecture. It’s nice to see this finally land for RISC-V, which is quickly approaching architecture feature parity with the other major architectures in the kernel.

**new `tasklet` API**

Romain Perier and Allen Pais [introduced a new `tasklet` API](https://git.kernel.org/linus/12cc923f1ccc1df467e046b02a72c2b3b321b6a2) to make their use safer. Much like the [`timer_list` refactoring](/blog/archives/2018/02/05/security-things-in-linux-v4-15/#v4.15-timer_list) work done earlier, the `tasklet` API is also a potential source of simple function-pointer-and-first-argument controlled exploits via linear heap overwrites. It’s a smaller attack surface since it’s used much less in the kernel, but it is the same weak design, making it a sensible thing to replace. While the use of the `tasklet` API is [considered deprecated](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/interrupt.h?h=v5.9#n588) (replaced by [threaded IRQs](https://lore.kernel.org/lkml/20200716081538.2sivhkj4hcyrusem%40linutronix.de)), it’s not always a simple mechanical refactoring, so the old API still needs refactoring (since that CAN be done mechanically is most cases).

**x86 `FSGSBASE` implementation**

Sasha Levin, Andy Lutomirski, Chang S. Bae, Andi Kleen, Tony Luck, Thomas Gleixner, and others landed the long-awaited [`FSGSBASE` series](https://git.kernel.org/linus/4da9f3302615f4191814f826054846bf843e24fa). This provides task switching performance improvements while keeping the kernel safe from modules accidentally (or maliciously) trying to use the features directly (which exposed an [unprivileged direct kernel access hole](https://lwn.net/Articles/821723/)).

**filter x86 MSR writes**

While it’s been long understood that writing to CPU Model-Specific Registers (MSRs) from userspace was a [bad idea](https://lore.kernel.org/lkml/20130208191213.GA25081%40www.outflux.net/), it has been left enabled for things like [`MSR_IA32_ENERGY_PERF_BIAS`](http://manpages.ubuntu.com/manpages/xenial/man8/x86_energy_perf_policy.8.html). Boris Petkov has decided enough is enough and has now enabled logging and kernel tainting (`TAINT_CPU_OUT_OF_SPEC`) by default and a way to [disable MSR writes](https://git.kernel.org/linus/a7e1f67ed29f0c339e2aa7483d13b085127566ab) at runtime. (However, since this is controlled by a normal module parameter and the root user can just turn writes back on, I continue to recommend that people build with `CONFIG_X86_MSR=n`.) The expectation is that userspace MSR writes will be entirely removed in future kernels.

**`uninitialized_var()` macro removed**

I made [treewide changes](https://git.kernel.org/linus/3f649ab728cda8038259d8f14492fe400fbab911) to [remove the `uninitialized_var()` macro](https://git.kernel.org/linus/63a0895d960aa3d3653ef0ecad5bd8579388f14b), which had been used to silence compiler warnings. The rationale for this macro was weak to begin with (“the compiler is reporting an uninitialized variable that is clearly initialized”) since it was mainly papering over compiler bugs. However, it creates a much more fragile situation in the kernel since now such uses can actually [disable automatic stack variable initialization](https://lore.kernel.org/lkml/20200603174714.192027-1-glider%40google.com/), as well as mask legitimate “unused variable” warnings. The proper solution is to just initialize variables the compiler warns about.

**function pointer cast removals**

Oscar Carter has started [removing](https://git.kernel.org/linus/5cdfbdce5de6b5b56e104676409762fc1289a9c2) function pointer [casts](https://git.kernel.org/linus/875102ea4b7700330a33c0db71555d91dafa9c82) from the kernel, in an effort to allow the kernel to build with `-Wcast-function-type`. The future use of Control Flow Integrity checking (which does validation of function prototypes matching between the caller and the target) tends not to work well with function casts, so it’d be [nice to get rid of these](https://github.com/KSPP/linux/issues/20) before CFI lands.

**flexible array conversions**

As part of Gustavo A. R. Silva’s [on-going work](/blog/archives/2021/02/08/security-things-in-linux-v5-8/#v5.8-flex-array) to replace [zero-length](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.9&qt=grep&q=zero-length+array) and [one-element](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.9&qt=grep&q=one-element+array) arrays with flexible arrays, he has [documented the details of the flexible array conversions](https://git.kernel.org/linus/68e4cd17e218971a2fd60c30fe14078dc0d8a68e), and the [various helpers](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.9&qt=grep&q=flex_array_size) to be used in kernel code. Every commit gets the kernel closer to building with `-Warray-bounds`, which catches a lot of potential buffer overflows at compile time.

That’s it for now! Please let me know if you think anything else needs some attention. Next up is Linux [v5.10](/blog/archives/2022/04/04/security-things-in-linux-v5-10/).

© 2021 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (3)](https://outflux.net/blog/archives/2021/04/05/security-things-in-linux-v5-9/#comments)
## February 8, 2021

### [security things in Linux v5.8](https://outflux.net/blog/archives/2021/02/08/security-things-in-linux-v5-8/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:47 pm

Previously: [v5.7](/blog/archives/2020/09/21/security-things-in-linux-v5-7/)

Linux [v5.8 was released in August, 2020](https://lore.kernel.org/lkml/CAHk-%3Dwj%2BmDPbj8hXspXRAksh%2B1TmPjubc9RNEbu8EVpYyypX%3Dw%40mail.gmail.com). Here’s my summary of various security things that caught my attention:

**arm64 Branch Target Identification**

Dave Martin [added support for ARMv8.5’s Branch Target Instructions](https://git.kernel.org/linus/8ef8f360cf30be12382f89ff48a57fbbd9b31c14) ([BTI](https://developer.arm.com/architectures/learn-the-architecture/providing-protection-for-complex-software/single-page)), which are enabled in [userspace at execve()](https://git.kernel.org/linus/ab7876a98a2160092133de4c648e94b18bc3f139) time, and all the time [in the kernel](https://git.kernel.org/linus/92e2294d870bc9e77592c2454f565c3bd6bb79ad) (which required manually marking up a lot of non-C code, like assembly and [JIT code](https://git.kernel.org/linus/fa76cfe65c1d748ef418e930a4b631a03b28f04c)).

With this in place, Jump-Oriented Programming (JOP, where code gadgets are chained together with jumps and calls) is no longer available to the attacker. An attacker’s code must make direct function calls. This basically reduces the “usable” code available to an attacker from every word in the kernel text to only function entries (or jump targets). This is a “low granularity” forward-edge Control Flow Integrity (CFI) feature, which is important (since it greatly reduces the potential targets that can be used in an attack) and cheap (implemented in hardware). It’s a good first step to strong CFI, but (as we’ve seen with things like CFG) it isn’t usually strong enough to stop a motivated attacker. “High granularity” CFI (which uses a more specific branch-target characteristic, like function prototypes, to track expected call sites) is not yet a hardware supported feature, but the software version will be coming in the future by way of [Clang’s CFI implementation](https://github.com/samitolvanen/linux/commits/clang-cfi).

**arm64 Shadow Call Stack**

Sami Tolvanen landed the [kernel implementation of Clang’s Shadow Call Stack](https://git.kernel.org/linus/5287569a790d2546a06db07e391bf84b8bd6cf51) ([SCS](https://clang.llvm.org/docs/ShadowCallStack.html)), which protects the kernel against Return-Oriented Programming (ROP) attacks (where code gadgets are chained together with returns). This backward-edge CFI protection is implemented by keeping a second dedicated stack pointer register (`x18`) and keeping a copy of the return addresses stored in a separate “shadow stack”. In this way, manipulating the regular stack’s return addresses will have no effect. (And since a copy of the return address continues to live in the regular stack, no changes are needed for back trace dumps, etc.)

It’s worth noting that unlike BTI (which is hardware based), this is a software defense that relies on the location of the Shadow Stack (i.e. the value of `x18`) staying secret, since the memory could be written to directly. Intel’s hardware ROP defense (CET) uses a hardware shadow stack that isn’t directly writable. ARM’s hardware defense against ROP is [PAC](/blog/archives/2020/09/21/security-things-in-linux-v5-7/#v5.7-pac) (which is actually designed as an arbitrary CFI defense — it can be used for forward-edge too), but that depends on having ARMv8.3 hardware. The expectation is that SCS will be used until PAC is available.

**Kernel Concurrency Sanitizer infrastructure added**

Marco Elver landed support for the [Kernel Concurrency Sanitizer](https://git.kernel.org/linus/dfd402a4c4baae42398ce9180ff424d589b8bffc), which is a new debugging infrastructure to find data races in the kernel, via `CONFIG_KCSAN`. This immediately found real bugs, with some fixes having [already](https://git.kernel.org/linus/d6c1f098f2a7ba62627c9bc17cda28f534ef9e4a) [landed](https://git.kernel.org/linus/68ace460c5b2a96a82ee49ab0b589ceed8abd000) too. For more details, see the [KCSAN documentation](https://www.kernel.org/doc/html/latest/dev-tools/kcsan.html).

**new capabilities**

Alexey Budankov [added `CAP_PERFMON`](https://git.kernel.org/linus/980737282232b752bb14dab96d77665c15889c36/), which is designed to allow access to `perf()`. The idea is that this capability gives a process access to only read aspects of the running kernel and system. No longer will access be needed through the much more powerful abilities of `CAP_SYS_ADMIN`, which has many ways to change kernel internals. This allows for a split between controls over the confidentiality (read access via CAP\_PERFMON) of the kernel vs control over integrity (write access via CAP\_SYS\_ADMIN).

Alexei Starovoitov [added `CAP_BPF`](https://git.kernel.org/linus/a17b53c4a4b55ec322c132b6670743612229ee9c/), which is designed to separate BPF access from the all-powerful `CAP_SYS_ADMIN`. It is designed to be used in combination with `CAP_PERFMON` for tracing-like activities and `CAP_NET_ADMIN` for networking-related activities. For things that could change kernel integrity (i.e. write access), `CAP_SYS_ADMIN` is still required.

**network random number generator improvements**

Willy Tarreau made the [network code’s random number generator less predictable](https://git.kernel.org/linus/f227e3ec3b5cad859ad15666874405e8c1bbc1d4). This will further frustrate any attacker’s attempts to recover the state of the RNG externally, which might lead to the ability to hijack network sessions (by correctly guessing packet states).

**fix various kernel address exposures to non-`CAP_SYSLOG`**

I fixed several situations where kernel addresses were still being exposed to unprivileged (i.e. non-`CAP_SYSLOG`) users, though usually only through odd corner cases. After [refactoring how capabilities were being checked](https://git.kernel.org/linus/60f7bb66b88b649433bf700acfc60c3f24953871) for files in `/sys` and `/proc`, the [kernel modules sections](https://git.kernel.org/linus/b25a7c5af9051850d4f3d93ca500056ab6ec724b), [kprobes](https://git.kernel.org/linus/60f7bb66b88b649433bf700acfc60c3f24953871), and [BPF](https://git.kernel.org/linus/63960260457a02af2a6cb35d75e6bdb17299c882) exposures got fixed. (Though in doing so, I briefly made things much worse before getting it [properly fixed](https://git.kernel.org/linus/11990a5bd7e558e9203c1070fc52fb6f0488e75b). Yikes!)

**RISCV W^X detection**

Following up on his recent work to [enable strict kernel memory protections on RISCV](/blog/archives/2020/09/21/security-things-in-linux-v5-7/#v5.7-wx-riscv), Zong Li has now added [support for `CONFIG_DEBUG_WX`](https://git.kernel.org/linus/b422d28b21773bbfc9e84dbb5579a8ce355279ca) as seen for other architectures. Any writable and executable memory regions in the kernel (which are lovely targets for attackers) will be loudly noted at boot so they can get corrected.

**`execve()` refactoring continues**

Eric W. Biederman continued working on [`execve()` refactoring](https://git.kernel.org/linus/56305aa9b6fab91a5555a45796b79c1b0a6353d1), including getting rid of the [frequently problematic recursion](https://git.kernel.org/linus/bc2bf338d54b7aadaed49bb45b9e10d4592b2a46) used to locate binary handlers. I used the opportunity to dust off some old [`binfmt_script` regression tests](https://git.kernel.org/linus/b081320f0693cce0394f7c8bad9fba0b25982186) and get them into the kernel selftests.

**multiple `/proc` instances**

Alexey Gladkov modernized `/proc` internals and provided a way to have [multiple `/proc` instances](https://git.kernel.org/linus/fa10fed30f2550313a8284365b3e2398526eb42c) mounted in the same PID namespace. This allows for having multiple views of `/proc`, with different features enabled. (Including the newly added [hidepid=4](https://git.kernel.org/linus/24a71ce5c47f6b1b3cdacf544cb24220f5c3b7ef) and [subset=pid](https://git.kernel.org/linus/6814ef2d992af09451bbeda4770daa204461329e) mount [options](https://www.kernel.org/doc/html/latest/filesystems/proc.html#mount-options).)

**`set_fs()` removal continues**

Christoph Hellwig, with Eric W. Biederman, Arnd Bergmann, and others, have been diligently working to entirely remove the kernel’s `set_fs()` interface, which has long been a source of security flaws due to weird confusions about which address space the kernel thought it should be accessing. Beyond things like the lower-level per-architecture [signal handling](https://git.kernel.org/linus/c3b3f52476412a3899f2c65b220075aceb18dd2c) code, this has needed to touch various [parts](https://git.kernel.org/linus/fa4751f454e6b51ef93babfd8b6c8b43a65c9db2) of the [ELF](https://git.kernel.org/linus/d2530b436f114dfbd1adc70c59d8d31038318726) loader, and [networking](https://git.kernel.org/linus/1f466e1f15cf1dac7c86798d694649fc42cd868a) code too.

**`READ_IMPLIES_EXEC` is no more for native 64-bit**

The `READ_IMPLIES_EXEC` flag was a work-around for dealing with the addition of non-executable (NX) memory when x86\_64 was introduced. It was designed as a way to mark a memory region as “well, since we don’t know if this memory region was expected to be executable, we must assume that if we need to read it, we need to be allowed to execute it too”. It was designed mostly for stack memory (where trampoline code might live), but it would carry over into all `mmap()` allocations, which would mean sometimes exposing a large attack surface to an attacker looking to find executable memory. While normally this didn’t cause problems on modern systems that correctly marked their ELF sections as NX, there were still some awkward corner-cases. I fixed this by splitting `READ_IMPLIES_EXEC` from the ELF `PT_GNU_STACK` marking on [x86](https://git.kernel.org/linus/122306117afe4ba202b5e57c61dfbeffc5c41387) and [arm/arm64](https://git.kernel.org/linus/eaf3f9e61887332d5097dbf0b327b8377546adc5), and declaring that a native 64-bit process would never gain `READ_IMPLIES_EXEC` on [x86\_64](https://git.kernel.org/linus/9fccc5c0c99f238aa1b0460fccbdb30a887e7036) and [arm64](https://git.kernel.org/linus/6e0d6ac5f3d9d90271899f6d340872360fe1caee), which matches the behavior of other native 64-bit architectures that correctly didn’t ever implement `READ_IMPLIES_EXEC` in the first place.

**array index bounds checking continues**

As part of the ongoing work to use modern flexible arrays in the kernel, Gustavo A. R. Silva added the [`flex_array_size()` helper](https://git.kernel.org/linus/b19d57d0f3cc6f1022edf94daf1d70506a09e3c2) (as a cousin to `struct_size()`). The [zero/one-member into flex array conversions](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.8&qt=grep&q=with+flexible-array) continue with over a hundred commits as we slowly get closer to being able to build with `-Warray-bounds`.

**`scnprintf()` replacement continues**

Chen Zhou joined Takashi Iwai in [continuing](/blog/archives/2020/09/21/security-things-in-linux-v5-7/#v5.7-scnprintf) to replace potentially unsafe uses of `sprintf()` with `scnprintf()`. Fixing all of these will make sure the kernel avoids nasty buffer concatenation surprises.

That’s it for now! Let me know if there is anything else you think I should mention here. Next up: Linux [v5.9](/blog/archives/2021/04/05/security-things-in-linux-v5-9/).

© 2021 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v5.8
## October 30, 2020

### [combining “apt install” and “get dist-upgrade”?](https://outflux.net/blog/archives/2020/10/30/combining-apt-install-and-get-dist-upgrade/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 12:07 pm

I frequently see a pattern in image build/refresh scripts where a set of packages is installed, and then all packages are updated:

```

apt update
apt install -y pkg1 pkg2 pkg2
apt dist-upgrade -y

```

While it’s not much, this results in redundant work. For example reading/writing package database, potentially running triggers (man-page refresh, ldconfig, etc). The internal package dependency resolution stuff isn’t actually different: “install” will also do upgrades of needed packages, etc. Combining them should be entirely possible, but I haven’t found a clean way to do this yet.

The best I’ve got so far is:

```

apt update
apt-cache dumpavail | dpkg --merge-avail -
(for i in pkg1 pkg2 pkg3; do echo "$i install") | dpkg --set-selections
apt-get dselect-upgrade

```

This gets me the effect of running “install” and “upgrade” at the same time, but not “dist-upgrade” (which has slightly different resolution logic that’d I’d prefer to use). Also, it includes the overhead of what should be an unnecessary update of dpkg’s database. Anyone know a better way to do this?

**Update**: [Julian Andres Klode pointed out that `dist-upgrade` actually takes package arguments too](https://mobile.twitter.com/JulianKlode/status/1322294691430281218) just like `install`. \*face palm\* I didn’t even try it — I believed the man-page and the `-h` output. It works perfectly!

© 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on combining “apt install” and “get dist-upgrade”?
## September 21, 2020

### [security things in Linux v5.7](https://outflux.net/blog/archives/2020/09/21/security-things-in-linux-v5-7/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:32 pm

Previously: [v5.6](/blog/archives/2020/09/02/security-things-in-linux-v5-6/)

Linux [v5.7 was released at the end of May](https://lore.kernel.org/lkml/CAHk-%3DwiZGrCkiBB1V7bxp8NZH6yWi9mPM4ptMW16OzOiNprBFA%40mail.gmail.com). Here’s my summary of various security things that caught my attention:

**arm64 kernel pointer authentication**

While the ARMv8.3 CPU “Pointer Authentication” (PAC) feature [landed for userspace already](/blog/archives/2019/03/12/security-things-in-linux-v5-0/), Kristina Martsenko has now [landed PAC support in kernel mode](https://git.kernel.org/linus/74afda4016a7437e6e425c3370e4b93b47be8ddf). The current implementation uses `PACIASP` which protects the saved stack pointer, similar to the existing `CONFIG_STACKPROTECTOR` feature, only faster. This also paves the way to sign and check pointers stored in the heap, as a way to defeat function pointer overwrites in those memory regions too. Since the behavior is different from the traditional stack protector, Amit Daniel Kachhap added an [LKDTM test for PAC](https://git.kernel.org/linus/6cb6982f42cbfaf5e50af1069451a8828231ffb9) as well.

**BPF LSM**

The kernel’s Linux Security Module (LSM) API provide a way to write security modules that have traditionally implemented various Mandatory Access Control (MAC) systems like SELinux, AppArmor, etc. The LSM hooks are numerous and no one LSM uses them all, as some hooks are much more specialized (like those used by IMA, Yama, LoadPin, etc). There was not, however, any way to externally attach to these hooks (not even through a regular loadable kernel module) nor build fully dynamic security policy, until KP Singh landed the API for [building LSM policy using BPF](https://git.kernel.org/linus/4dece7f3b9258e812795443b4bf64ff9454a0411). With `CONFIG_BPF_LSM=y`, it is possible (for a privileged process) to write kernel LSM hooks in BPF, allowing for totally custom security policy (and reporting).

**`execve()` deadlock refactoring**

There have been a number of long-standing races in the kernel’s process launching code where ptrace could deadlock. Fixing these has been attempted several times over the last many years, but Eric W. Biederman and Ernd Edlinger decided to dive in, and successfully landed the a series of refactorings, [splitting up the problematic locking](https://git.kernel.org/linus/eea9673250db4e854e9998ef9da6d4584857f0ea) and refactoring their uses to [remove the deadlocks](https://git.kernel.org/linus/3e74fabd39710ee29fa25618d2c2b40cfa7d76c7). While he was at it, Eric also [extended the `exec_id` counter to 64 bits](https://git.kernel.org/linus/d1e7fd6462ca9fc76650fbe6ca800e35b24267da) to avoid the possibility of the counter wrapping and allowing an attacker to send arbitrary signals to processes they normally shouldn’t be able to.

**slub freelist obfuscation improvements**

After Silvio Cesare observed some weaknesses in the implementation of `CONFIG_SLAB_FREELIST_HARDENED`‘s freelist pointer content obfuscation, I [improved their bit diffusion](https://git.kernel.org/linus/1ad53d9fa3f6168ebcf48a50e08b170432da2257), which makes attacks require significantly more memory content exposures to defeat the obfuscation. As part of the conversation, Vitaly Nikolenko pointed out that the freelist pointer’s *location* made it relatively easy to target too (for either disclosures or overwrites), so I [moved it away from the edge of the slab](https://git.kernel.org/linus/3202fa62fb43087387c65bfa9c100feffac74aa6), making it harder to reach through small-sized overflows (which usually target the freelist pointer). As it turns out, there were a few assumptions in the kernel about the location of the freelist pointer, which had to also get [cleaned](https://git.kernel.org/linus/cbfc35a48609ceac978791e3ab9dde0c01f8cb20) [up](https://git.kernel.org/linus/89b83f282d8ba380cf2124f88106c57df49c538c).

**RISCV strict kernel memory protections**

Zong Li [implemented `STRICT_KERNEL_RWX` support for RISCV](https://git.kernel.org/linus/d27c3c90817e4c5ea655714065a725b4abd576f9). And to validate the results, following v5.6’s [generic page table dumping work](/blog/archives/2020/09/02/security-things-in-linux-v5-6/), he landed the [RISCV page dumping code](https://git.kernel.org/linus/59c4da8640ccf4721d54d36835706f3eefb521a4). This means it’s much easier to examine the kernel’s page table layout when running a debug kernel (built with `PTDUMP_DEBUGFS`), visible in `/sys/kernel/debug/kernel_page_tables`.

**array index bounds checking**

This is a pretty large area of work that touches a lot of overlapping elements (and history) in the Linux kernel. The short version is: C is bad at noticing when it uses an array index beyond the bounds of the declared array, and we need to fix that. For example, don’t do this:

```

int foo[5];
...
foo[8] = bar;

```

The long version gets complicated by the evolution of [“flexible array” structure members](https://en.wikipedia.org/wiki/Flexible_array_member), so we’ll pause for a moment and skim the surface of this topic. While things like `CONFIG_FORTIFY_SOURCE` try to catch these kinds of cases in the `memcpy()` and `strcpy()` family of functions, it doesn’t catch it in open-coded array indexing, as seen in the code above. GCC has a warning (`-Warray-bounds`) for these cases, but it was [disabled by Linus](https://git.kernel.org/linus/44720996e2d79e47d508b0abe99b931a726a3197) because of all the false positives seen due to “fake” flexible array members. Before flexible arrays were standardized, GNU C supported “zero sized” array members. And before that, C code would use a 1-element array. These were all designed so that some structure could be the “header” in front of some data blob that could be addressable through the last structure member:

```

/* 1-element array */
struct foo {
    ...
    char contents[1];
};

/* GNU C extension: 0-element array */
struct foo {
    ...
    char contents[0];
};

/* C standard: flexible array */
struct foo {
    ...
    char contents[];
};

instance = kmalloc(sizeof(struct foo) + content_size);

```

Converting all the zero- and one-element array members to flexible arrays is one of Gustavo A. R. Silva’s goals, and [hundreds of these changes started landing](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.7&qt=grep&q=flexible+array). Once fixed, `-Warray-bounds` can be re-enabled. Much more detail can be found in the kernel’s [deprecation](https://www.kernel.org/doc/html/latest/process/deprecated.html#zero-length-and-one-element-arrays) docs.

However, that will only catch the “visible at compile time” cases. For runtime checking, the Undefined Behavior Sanitizer has an option for adding runtime array bounds checking for catching things like this where the compiler cannot perform a static analysis of the index values:

```

int foo[5];
...
for (i = 0; i < some_argument; i++) {
    ...
    foo[i] = bar;
    ...
}

```

It was, however, not separate (via kernel Kconfig) until Elena Petrova and I [split it out into `CONFIG_UBSAN_BOUNDS`](https://git.kernel.org/linus/277a10850f9f4cb3429faf59293e2c89b1a320be), which is fast enough for production kernel use. With this enabled, it's now possible to instrument the kernel to catch these conditions, which seem to come up with some regularity in Wi-Fi and Bluetooth drivers for some reason. Since UBSAN (and the other Sanitizers) only `WARN()` by default, system owners need to set `panic_on_warn=1` too if they want to defend against attacks targeting these kinds of flaws. Because of this, and to avoid bloating the kernel image with all the warning messages, I [introduced `CONFIG_UBSAN_TRAP`](https://git.kernel.org/linus/0887a7ebc97770c7870abf3075a2e8cd502a7f52) which effectively turns these conditions into a `BUG()` without needing additional sysctl settings.

**Fixing "additive" `snprintf()` usage**

A common idiom in C for building up strings is to use `sprintf()`'s return value to increment a pointer into a string, and build a string with more `sprintf()` calls:

```

/* safe if strlen(foo) + 1 < sizeof(string) */
wrote  = sprintf(string, "Foo: %s\n", foo);
/* overflows if strlen(foo) + strlen(bar) > sizeof(string) */
wrote += sprintf(string + wrote, "Bar: %s\n", bar);
/* writing way beyond the end of "string" now ... */
wrote += sprintf(string + wrote, "Baz: %s\n", baz);

```

The risk is that if these calls eventually walk off the end of the `string` buffer, it will start writing into other memory and create some bad situations. Switching these to `snprintf()` does not, however, make anything safer, since `snprintf()` returns how much it *would* have written:

```

/* safe, assuming available <= sizeof(string), and for this example
 * assume strlen(foo) < sizeof(string) */
wrote  = snprintf(string, available, "Foo: %s\n", foo);
/* if (strlen(bar) > available - wrote), this is still safe since the
 * write into "string" will be truncated, but now "wrote" has been
 * incremented by how much snprintf() *would* have written, so "wrote"
 * is now larger than "available". */
wrote += snprintf(string + wrote, available - wrote, "Bar: %s\n", bar);
/* string + wrote is beyond the end of string, and availabe - wrote wraps
 * around to a giant positive value, making the write effectively
 * unbounded. */
wrote += snprintf(string + wrote, available - wrote, "Baz: %s\n", baz);

```

So while the first overflowing call would be safe, the next one would be targeting beyond the end of the array and the size calculation will have wrapped around to a giant limit. Replacing this idiom with `scnprintf()` solves the issue because it only reports what was *actually* written. To this end, Takashi Iwai has been [landing a bunch scnprintf() fixes](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.7&qt=grep&q=Use+scnprintf).

That's it for now! Let me know if there is anything else you think I should mention here. Next up: Linux [v5.8](/blog/archives/2021/02/08/security-things-in-linux-v5-8/).

© 2020 - 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v5.7
## September 2, 2020

### [security things in Linux v5.6](https://outflux.net/blog/archives/2020/09/02/security-things-in-linux-v5-6/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:22 pm

Previously: [v5.5](/blog/archives/2020/05/27/security-things-in-linux-v5-5/).

Linux [v5.6 was released back in March](https://lore.kernel.org/lkml/CAHk-%3Dwi9ZT7Stg-uSpX0UWQzam6OP9Jzz6Xu1CkYu1cicpD5OA%40mail.gmail.com/). Here’s my quick summary of various features that caught my attention:

**WireGuard**

The widely used [WireGuard VPN](https://www.wireguard.com/) has been out-of-tree for a very long time. After 3 1/2 years since its initial [upstream RFC](https://lore.kernel.org/lkml/CAHmME9q-6ioctzcB8gLdYOsMFqHVGY8GUsVGFisKv%3DwGdVqi2A%40mail.gmail.com/), Ard Biesheuvel and Jason Donenfeld finished the work getting all the [crypto prerequisites sorted out](https://lore.kernel.org/linux-crypto/20191108122240.28479-1-ardb%40kernel.org/) for the v5.5 kernel. For this release, Jason has gotten [WireGuard itself landed](https://git.kernel.org/linus/e7096c131e5161fa3b8e52a650d7719d2857adfd). It was a twisty road, and I’m grateful to everyone involved for sticking it out and navigating the compromises and alternative solutions.

**`openat2()` syscall and `RESOLVE_*` flags**

Aleksa Sarai has added a number of important path resolution “scoping” options to the kernel’s `open()` handling, covering things like not walking above a specific point in a path hierarchy ([`RESOLVE_BENEATH`](https://git.kernel.org/linus/adb21d2b526f7f196b2f3fdca97d80ba05dd14a0)), disabling the resolution of various “magic links” ([`RESOLVE_NO_MAGICLINKS`](https://git.kernel.org/linus/4b99d4996979d582859c5a49072e92de124bf691)) in procfs (e.g. `/proc/$pid/exe`) and other pseudo-filesystems, and treating a given lookup as happening relative to a different root directory (as if it were in a chroot, [`RESOLVE_IN_ROOT`](https://git.kernel.org/linus/8db52c7e7ee1bd861b6096fcafc0fe7d0f24a994)). As part of this, it became clear that there wasn’t a way to correctly extend the existing `openat()` syscall, so he [added `openat2()`](https://git.kernel.org/linus/fddb5d430ad9fa91b49b1d34d0202ffe2fa0e179) (which is a good example of the efforts being made to codify [“Extensible Syscall” arguments](https://lwn.net/Articles/822256/)). The `RESOLVE_*` set of flags also cover prior behaviors like `RESOLVE_NO_XDEV` and `RESOLVE_NO_SYMLINKS`.

**`pidfd_getfd()` syscall**

In the continuing growth of the much-needed pidfd APIs, Sargun Dhillon has added the [`pidfd_getfd()` syscall](https://git.kernel.org/linus/8649c322f75c96e7ced2fec201e123b2b073bf09) which is a way to gain access to file descriptors of a process in a race-less way (or when `/proc` is not mounted). Before, it wasn’t always possible make sure that opening file descriptors via `/proc/$pid/fd/$N` was actually going to be associated with the correct PID. Much more detail about this has been [written up at LWN](https://lwn.net/Articles/808997/).

**`openat()` via io\_uring**

With my “attack surface reduction” hat on, I remain personally suspicious of the `io_uring()` family of APIs, but I can’t deny their utility for certain kinds of workloads. Being able to pipeline reads and writes without the overhead of actually making syscalls is pretty great for performance. Jens Axboe has [added the IORING\_OP\_OPENAT command](https://git.kernel.org/linus/15b71abe7b52df214785dde0de9f581cc0216d17) so that existing io\_urings can open files to be added on the fly to the mapping of available read/write targets of a given io\_uring. While LSMs are still happily able to intercept these actions, I remain wary of the growing “syscall multiplexer” that io\_uring is becoming. I am, of course, glad to see that it has a comprehensive (if “out of tree”) [test suite as part of `liburing`](https://github.com/axboe/liburing/tree/master/test).

**removal of blocking random pool**

After making algorithmic changes to obviate separate entropy pools for random numbers, Andy Lutomirski [removed the blocking random pool](https://git.kernel.org/linus/90ea1c6436d26e62496616fb5891e00819ff4849). This simplifies the kernel pRNG code significantly without compromising the userspace interfaces designed to fetch “cryptographically secure” random numbers. To quote Andy, “This series should not break any existing programs. `/dev/urandom` is unchanged. `/dev/random` will still block just after booting, but it will block less than it used to.” See LWN for more details on the [history and discussion of the series](https://lwn.net/Articles/808575/).

**arm64 support for on-chip RNG**

Mark Brown added [support for the future ARMv8.5’s RNG](https://git.kernel.org/linus/2e8e1ea88cbcb19a77b7acb67f6ffe39cc15740c) (`SYS_RNDR_EL0`), which is, from the kernel’s perspective, similar to x86’s `RDRAND` instruction. This will provide a bootloader-independent way to add entropy to the kernel’s pRNG for early boot randomness (e.g. stack canary values, memory ASLR offsets, etc). Until folks are running on ARMv8.5 systems, they can continue to depend on the bootloader for randomness (via the [UEFI RNG interface](/blog/archives/2017/02/27/security-things-in-linux-v4-10/)) on arm64.

**arm64 E0PD**

Mark Brown added [support for the future ARMv8.5’s E0PD feature](https://git.kernel.org/linus/3e6c69a058deaa50d33c3dac36cde80b4ce590e8) (`TCR_E0PD1`), which causes all memory accesses from userspace into kernel space to fault in constant time. This is an attempt to remove any possible timing side-channel signals when probing kernel memory layout from userspace, as an alternative way to protect against Meltdown-style attacks. The expectation is that E0PD would be used instead of the more expensive Kernel Page Table Isolation (KPTI) features on arm64.

**powerpc32 VMAP\_STACK**

Christophe Leroy added [VMAP\_STACK support to powerpc32](https://git.kernel.org/linus/cd08f109e26231b279bcc0388428afcac6408ec6), joining x86, arm64, and s390. This helps protect against the various classes of attacks that depend on exhausting the kernel stack in order to collide with neighboring kernel stacks. (Another common target, the sensitive `thread_info`, had already been [moved away from the bottom of the stack](https://git.kernel.org/linus/ed1cd6deb013a11959d17a94e35ce159197632da) by Christophe Leroy in Linux v5.1.)

**generic Page Table dumping**

Related to RISCV’s work to add page table dumping (via `/sys/fs/debug/kernel_page_tables`), Steven Price extracted the existing implementations from multiple architectures and created a [common page table dumping framework](https://git.kernel.org/linus/30d621f6723b1c98a142861f7a52849d286bc7fa) (and then [refactored all the other architectures to use it](https://lore.kernel.org/linux-arm-kernel/20191218162402.45610-1-steven.price%40arm.com/)). I’m delighted to have this because I still remember when not having a working page table dumper for ARM delayed me for a while when trying to implement upstream kernel memory protections there. Anything that makes it easier for architectures to get their kernel memory protection working correctly makes me happy.

That’s in for now; let me know if there’s anything you think I missed. Next up: Linux [v5.7](/blog/archives/2020/09/21/security-things-in-linux-v5-7/).

© 2020 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2020/09/02/security-things-in-linux-v5-6/#comments)
## May 27, 2020

### [security things in Linux v5.5](https://outflux.net/blog/archives/2020/05/27/security-things-in-linux-v5-5/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 1:04 pm

Previously: [v5.4](/blog/archives/2020/02/18/security-things-in-linux-v5-4/).

I got a bit behind on this blog post series! Let’s get caught up. Here are a bunch of security things I found interesting in the [Linux kernel v5.5 release](https://lore.kernel.org/lkml/CAHk-%3DwigRZ6TSJU09bMk3Df2DiOw83B7TrQUq%2BiXroQCK5EVAQ%40mail.gmail.com/):

**restrict `perf_event_open()` from LSM**

Given the recurring flaws in the perf subsystem, there has been a strong desire to be able to entirely disable the interface. While the `kernel.perf_event_paranoid` sysctl knob has existed for a while, attempts to extend its control to “block all `perf_event_open()` calls” have [failed in the past](https://lwn.net/Articles/696216/). Distribution kernels have carried the rejected sysctl patch for many years, but now Joel Fernandes has implemented a solution that was deemed acceptable: instead of extending the sysctl, [add LSM hooks](https://git.kernel.org/linus/da97e18458fb42d7c00fac5fd1c56a3896ec666e) so that LSMs (e.g. SELinux, Apparmor, etc) can make these choices as part of their overall system policy.

**generic fast full `refcount_t`**

Will Deacon took the recent `refcount_t` hardening work for both x86 and arm64 and distilled the implementations into a [single architecture-agnostic C version](https://git.kernel.org/linus/dcb786493f3e48da3272b710028d42ec608cfda1). The result was almost as fast as the x86 assembly version, but it covered more cases (e.g. increment-from-zero), and is now available by [default for all architectures](https://git.kernel.org/linus/fb041bb7c0a918b95c6889fc965cdc4a75b4c0ca). (There is no longer any Kconfig associated with `refcount_t`; the use of the primitive provides full coverage.)

**linker script cleanup for exception tables**

When Rick Edgecombe [presented](https://www.youtube.com/watch?v=BkRI9TFS8Eo&list=PLVsQ_xZBEyN2Ol7y8axxhbTsG47Va3Se2&index=10&t=0s) his work on building [Execute-Only memory under a hypervisor](https://linuxplumbersconf.org/event/4/contributions/283/), he noted a region of memory that the kernel was attempting to read directly (instead of execute). He rearranged things for his x86-only patch series to [work around](https://github.com/redgecombe/linux/commit/428f889a5c52ca85b763cf484ed666a33259b6ef) the issue. Since I’d just been working in this area, I realized the root cause of this problem was the location of the exception table (which is strictly a lookup table and is never executed) and built a [fix for the issue](https://git.kernel.org/linus/b8c2f776164c8f74ac31c5e370ca3f029be0aa19) and applied it to [all architectures](https://lore.kernel.org/linux-arm-kernel/20191029211351.13243-1-keescook%40chromium.org/#r), since it turns out the exception tables for almost all architectures are just a data table. Hopefully this will help clear the path for more Execute-Only memory work on all architectures. In the process of this, I also updated the [section fill bytes on x86 to be a trap](https://git.kernel.org/linus/7705dc8557973d8ad8f10840f61d8ec805695e9e) (0xCC, int3), instead of a NOP instruction so functions would need to be targeted more precisely by attacks.

**KASLR for 32-bit PowerPC**

Joining many other architectures, Jason Yan added kernel text base-address offset randomization [(KASLR) to 32-bit PowerPC](https://git.kernel.org/linus/2b0e86cc5de6dabadc2d64cefa429fc227c8a756).

**seccomp for RISC-V**

After a bit of long road, David Abdurachmanov has added [seccomp support to the RISC-V architecture](https://git.kernel.org/linus/5340627e3fe08030988bdda46dd86cd5d5fb7517). The series uncovered some more corner cases in the seccomp self tests code, which is always nice since then we get to make it more robust for the future!

**seccomp `USER_NOTIF` continuation**

When the [seccomp `SECCOMP_RET_USER_NOTIF` interface](/blog/archives/2019/03/12/security-things-in-linux-v5-0/) was added, it seemed like it would only be used in very limited conditions, so the idea of needing to handle “normal” requests didn’t seem very onerous. However, since then, it has become clear that the overhead of a monitor process needing to perform lots of “normal” `open()` calls on behalf of the monitored process started to look more and more slow and fragile. To deal with this, it became clear that there needed to be a way for the `USER_NOTIF` interface to indicate that seccomp should just continue as normal and allow the syscall without any special handling. Christian Brauner [implemented `SECCOMP_USER_NOTIF_FLAG_CONTINUE`](https://git.kernel.org/linus/fb3c5386b382d4097476ce9647260fc89b34afdb) to get this done. It comes with a bit of a disclaimer due to the chance that monitors may use it in places where ToCToU is a risk, and for possible conflicts with `SECCOMP_RET_TRACE`. But overall, this is a net win for container monitoring tools.

**`EFI_RNG_PROTOCOL` for x86**

Some EFI systems provide a Random Number Generator interface, which is useful for gaining some entropy in the kernel during very early boot. The arm64 boot stub has been using this for a while now, but Dominik Brodowski has now added support for [x86 to do the same](https://git.kernel.org/linus/0d95981438c3bdb53cc99b0fb656d24d7a80e1f3). This entropy is useful for kernel subsystems performing very earlier initialization whre random numbers are needed (like [randomizing aspects of the SLUB memory allocator](https://lore.kernel.org/lkml/202003051623.AF4F8CB%40keescook/)).

**`FORTIFY_SOURCE` for MIPS**

As has been enabled on many other architectures, Dmitry Korotin got [MIPS building with `CONFIG_FORTIFY_SOURCE`](https://git.kernel.org/linus/a2ecb233e3e759730269b31b7d8add823cf196ba), so compile-time (and some run-time) buffer overflows during calls to the `memcpy()` and `strcpy()` families of functions will be [detected](/blog/archives/2017/09/05/security-things-in-linux-v4-13/).

**limit `copy_{to,from}_user()` size to `INT_MAX`**

As done for VFS, `vsnprintf()`, and [`strscpy()`](/blog/archives/2020/02/18/security-things-in-linux-v5-4/), I went ahead and [limited the size](https://git.kernel.org/linus/6d13de1489b6bf539695f96d945de3860e6d5e17) of `copy_to_user()` and `copy_from_user()` calls to `INT_MAX` in order to catch any weird overflows in size calculations.

**Other things**

[Alexander Popov pointed out some more v5.5 features](https://twitter.com/a13xp0p0v/status/1270109939474804740) that I missed in this blog post. I’m repeating them here, with some minor edits/clarifications. Thank you Alexander!

* [KASan support for vmap memory](https://git.kernel.org/linus/3c5c3cfb9ef4da957e3357a2bd36f76ee34c0862) expands KASan’s features to include analysis of memory allocated with `vmalloc()`. More specifically, this means KASan can examine the stack again, since it can be in that region since `CONFIG_VMAP_STACK` was introduced.
* [MIPS can build with GCC plugins and KCOV](https://git.kernel.org/linus/dcf78ee660888d8302a0f0888bf746a164d267fa) now, providing those systems with the associated features like stack wiping, coverage analysis, etc.
* [userfaultfd requires CAP\_SYS\_PTRACE for UFFD\_FEATURE\_EVENT\_FORK](https://git.kernel.org/linus/3c1c24d91ffd536de0a64688a9df7f49e58fadbc). This was done to block unprivileged users from abusing the userfaultfd feature, as it is implemented in a way that provides the ability to [inject file descriptors into unsuspecting processes](https://lore.kernel.org/linux-api/CALCETrWY%2B5ynDct7eU_nDUqx%3DokQvjm%3DY5wJvA4ahBja%3DCQXGw%40mail.gmail.com/).

*Edit: added Alexander Popov’s notes*

That’s it for v5.5! Let me know if there’s anything else that I should call out here. Next up: Linux [v5.6](/blog/archives/2020/09/02/security-things-in-linux-v5-6/).

© 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2020/05/27/security-things-in-linux-v5-5/#comments)
## February 18, 2020

### [security things in Linux v5.4](https://outflux.net/blog/archives/2020/02/18/security-things-in-linux-v5-4/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:37 pm

Previously: [v5.3](/blog/archives/2019/11/14/security-things-in-linux-v5-3/).

Linux kernel [v5.4 was released](https://lore.kernel.org/lkml/CAHk-%3DwjmzaD%3DBZ1hjUYu%2BRTnSGDLfCRwCdg99GeQpCjEwo9uzw%40mail.gmail.com/) in late November. The holidays got the best of me, but better late than never! ;) Here are some security-related things I found interesting:

**`waitid()` gains `P_PIDFD`**

Christian Brauner has continued his [`pidfd` work](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) by [adding a critical mode to `waitid()`: `P_PIDFD`](https://git.kernel.org/linus/3695eae5fee0605f316fbaad0b9e3de791d7dfaf). This makes it possible to reap child processes via a `pidfd`, and completes the interfaces needed for the bulk of programs performing process lifecycle management. (i.e. a `pidfd` can come from `/proc` or `clone()`, and can be waited on with `waitid()`.)

**kernel lockdown**

After something on the order of [8 years](https://lwn.net/Articles/514985/), Linux can now [draw a bright line](https://git.kernel.org/linus/000d388ed3bbed745f366ce71b2bb7c2ee70f449) between “ring 0” (kernel memory) and “uid 0” (highest privilege level in userspace). The “kernel lockdown” feature, which has been an out-of-tree patch series in most Linux distros for almost as many years, attempts to enumerate all the *intentional* ways (i.e. interfaces not flaws) userspace might be able to read or modify kernel memory (or execute in kernel space), and disable them. While Matthew Garrett made the internal details fine-grained controllable, the basic lockdown LSM can be set to either disabled, “integrity” (kernel memory can be read but not written), or “confidentiality” (no kernel memory reads or writes). Beyond closing the many holes between userspace and the kernel, if new interfaces are added to the kernel that might violate kernel integrity or confidentiality, now there is a place to put the access control to make everyone happy and there doesn’t need to be a rehashing of the age old fight between “but root has full kernel access” vs “not in some system configurations”.

**tagged memory relaxed syscall ABI**

Andrey Konovalov (with Catalin Marinas and others) introduced a way to enable a [“relaxed” tagged memory syscall ABI](https://git.kernel.org/linus/63f0c60379650d82250f22e4cf4137ef3dc4f43d) in the kernel. This means programs running on hardware that supports [memory tags](https://www.linuxplumbersconf.org/event/4/contributions/571/attachments/399/642/MTE_LPC.pdf) (or “versioning”, or “coloring”) in the upper (non-VMA) bits of a pointer address can use these addresses with the kernel without things going crazy. This is effectively teaching the kernel to ignore these high bits in places where they make no sense (i.e. mathematical comparisons) and keeping them in place where they have meaning (i.e. pointer dereferences).

As an example, if a userspace memory allocator had returned the address 0x0**f**00000010000000 (VMA address 0x10000000, with, say, a “high bits” tag of 0x0f), and a program used this range during a syscall that ultimately called `copy_from_user()` on it, the initial range check would fail if the tag bits were left in place: “that’s not a userspace address; it is greater than `TASK_SIZE` (0x0000800000000000)!”, so they are stripped for that check. During the actual copy into kernel memory, the tag is left in place so that when the hardware dereferences the pointer, the pointer tag can be checked against the expected tag assigned to referenced memory region. If there is a mismatch, the hardware will trigger the memory tagging protection.

Right now programs running on Sparc M7 CPUs with ADI (Application Data Integrity) can use this for hardware tagged memory, ARMv8 CPUs can use TBI (Top Byte Ignore) for software memory tagging, and eventually there will be ARMv8.5-A CPUs with MTE (Memory Tagging Extension).

**boot entropy improvement**

Thomas Gleixner got fed up with poor boot-time entropy and [trolled](https://lore.kernel.org/lkml/alpine.DEB.2.21.1909290010500.2636%40nanos.tec.linutronix.de/) Linus into coming up with reasonable way to [add entropy on modern CPUs](https://git.kernel.org/linus/50ee7529ec4500c88f8664560770a7a1b65db72b), taking advantage of timing noise, cycle counter jitter, and perhaps even the variability of speculative execution. This means that there shouldn’t be mysterious multi-second (or multi-minute!) [hangs at boot](https://lwn.net/Articles/800509/) when some systems don’t have enough entropy to service `getrandom()` syscalls from `systemd` or the like.

**userspace writes to swap files blocked**

From the department of “how did this go unnoticed for so long?”, Darrick J. Wong fixed the kernel to not allow writes from userspace to active swap files. Without this, it was possible for a user (usually root) with write access to a swap file to modify its contents, thereby changing memory contents of a process once it got paged back in. While root normally could just use `CAP_PTRACE` to modify a running process directly, this was a loophole that allowed lesser-privileged users (e.g. anyone in the “disk” group) without the needed capabilities to still bypass ptrace restrictions.

**limit `strscpy()` sizes to `INT_MAX`**

Generally speaking, if a size variable ends up larger than `INT_MAX`, some calculation somewhere has overflowed. And even if not, it’s probably going to hit code somewhere nearby that won’t deal well with the result. As already done in the VFS core, and `vsprintf()`, I added a check to `strscpy()` to [reject sizes larger than `INT_MAX`](https://git.kernel.org/linus/9a156466147b61504f4cbe97ea503e67c21e117a).

**`ld.gold` support removed**

Thomas Gleixner [removed support for the gold linker](https://git.kernel.org/linus/75959d44f9dc8e44410667009724e4e238515502). While this isn’t providing a direct security benefit, `ld.gold` has been a constant source of weird bugs. Specifically where I’ve noticed, it had been pain while developing KASLR, and has more recently been causing problems while stabilizing building the kernel with Clang. Having this linker support removed makes things much easier going forward. There are enough weird bugs to fix in Clang and `ld.lld`. ;)

**Intel TSX disabled**

Given the use of Intel’s Transactional Synchronization Extensions (TSX) CPU feature by attackers to exploit speculation flaws, Pawan Gupta [disabled the feature by default](https://git.kernel.org/linus/95c5824f75f3ba4c9e8e5a4b1a623c95390ac266) on CPUs that support disabling TSX.

That’s all I have for this version. Let me know if I missed anything. :) Next up is [Linux v5.5](/blog/archives/2020/05/27/security-things-in-linux-v5-5/)!

© 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (2)](https://outflux.net/blog/archives/2020/02/18/security-things-in-linux-v5-4/#comments)
## November 20, 2019

### [experimenting with Clang CFI on upstream Linux](https://outflux.net/blog/archives/2019/11/20/experimenting-with-clang-cfi-on-upstream-linux/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 9:09 pm

While much of the work on kernel Control Flow Integrity (CFI) is focused on arm64 (since [kernel CFI is available on Android](https://source.android.com/devices/tech/debug/kcfi)), a significant portion is in the core kernel itself (and especially the build system). Recently I got a sane build and boot on x86 with everything enabled, and I’ve been picking through some of the remaining pieces. I figured now would be a good time to document everything I do to get a build working in case other people want to play with it and find stuff that needs fixing.

First, everything is based on [Sami Tolvanen’s upstream port of Clang’s forward-edge CFI](https://github.com/samitolvanen/linux/commits/clang-cfi), which includes his Link Time Optimization (LTO) work, which CFI requires. This tree also includes his backward-edge CFI work on arm64 with Clang’s Shadow Call Stack (SCS).

On top of that, I’ve got a few x86-specific patches that get me far enough to boot a kernel without warnings pouring across the console. Along with that are general linker script cleanups, CFI cast fixes, and x86 crypto fixes, all in various states of getting upstreamed. The resulting tree is [here](https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git/log/?h=kspp/cfi/x86).

On the compiler side, you need a very recent Clang and LLD (i.e. “Clang 10”, or what I do is build from the latest git). For example, here’s how to get started. First, checkout, configure, and build Clang (leave out “`--depth=1`” if you want the full git history):

```

# Check out latest LLVM
mkdir -p $HOME/src
cd $HOME/src
git clone --depth=1 https://github.com/llvm/llvm-project.git
mkdir -p llvm-build
cd llvm-build
# Configure
mkdir -p $HOME/bin/clang-release
cmake -G Ninja \
      -DCMAKE_BUILD_TYPE=Release \
      -DLLVM_ENABLE_PROJECTS='clang;lld;compiler-rt' \
      -DCMAKE_INSTALL_PREFIX="$HOME/bin/clang-release" \
      ../llvm-project/llvm
# Build!
ninja install

```

Then checkout, configure, and build the CFI tree. (This assumes you’ve already got a checkout of Linus’s tree.)

```

# Check out my branch
cd ../linux
git remote add kees https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git
git fetch kees
git checkout kees/kspp/cfi/x86 -b test/cfi
# Use the above built Clang path first for the needed binaries: clang, ld.lld, and llvm-ar.
PATH="$HOME/bin/clang-release/bin:$PATH"
# Configure (this uses "defconfig" but you could use "menuconfig"), but you must
# include CC and LD in the make args or your .config won't know about Clang.
make defconfig CC=clang LD=ld.lld
# Enable LTO and CFI.
scripts/config \
     -e CONFIG_LTO \
     -e CONFIG_THINLTO \
     -d CONFIG_LTO_NONE \
     -e CONFIG_LTO_CLANG \
     -e CONFIG_CFI_CLANG \
     -e CONFIG_CFI_PERMISSIVE \
     -e CONFIG_CFI_CLANG_SHADOW
# Enable LKDTM if you want runtime fault testing:
scripts/config -e CONFIG_LKDTM
# Build!
make -j$(getconf _NPROCESSORS_ONLN) CC=clang LD=ld.lld

```

Do not be alarmed by various warnings, such as:

```

ld.lld: warning: cannot find entry symbol _start; defaulting to 0x1000
llvm-ar: error: unable to load 'arch/x86/kernel/head_64.o': file too small to be an archive
llvm-ar: error: unable to load 'arch/x86/kernel/head64.o': file too small to be an archive
llvm-ar: error: unable to load 'arch/x86/kernel/ebda.o': file too small to be an archive
llvm-ar: error: unable to load 'arch/x86/kernel/platform-quirks.o': file too small to be an archive
WARNING: EXPORT symbol "page_offset_base" [vmlinux] version generation failed, symbol will not be versioned.
WARNING: EXPORT symbol "vmalloc_base" [vmlinux] version generation failed, symbol will not be versioned.
WARNING: EXPORT symbol "vmemmap_base" [vmlinux] version generation failed, symbol will not be versioned.
WARNING: "__memcat_p" [vmlinux] is a static (unknown)
no symbols

```

Adjust your `.config` as you want (but, again, make sure the CC and LD args are pointed at Clang and LLD respectively). This should(!) result in a happy bootable x86 CFI-enabled kernel. If you want to see what a CFI failure looks like, you can poke LKDTM:

```

# Log into the booted system as root, then:
cat <(echo CFI_FORWARD_PROTO) >/sys/kernel/debug/provoke-crash/DIRECT
dmesg

```

Here’s the CFI splat I see on the console:

```

[   16.288372] lkdtm: Performing direct entry CFI_FORWARD_PROTO
[   16.290563] lkdtm: Calling matched prototype ...
[   16.292367] lkdtm: Calling mismatched prototype ...
[   16.293696] ------------[ cut here ]------------
[   16.294581] CFI failure (target: lkdtm_increment_int$53641d38e2dc4a151b75cbe816cbb86b.cfi_jt+0x0/0x10):
[   16.296288] WARNING: CPU: 3 PID: 2612 at kernel/cfi.c:29 __cfi_check_fail+0x38/0x40
...
[   16.346873] ---[ end trace 386b3874d294d2f7 ]---
[   16.347669] lkdtm: Fail: survived mismatched prototype function call!

```

The claim of “Fail: survived …” is due to `CONFIG_CFI_PERMISSIVE=y`. This allows the kernel to warn but continue with the bad call anyway. This is handy for debugging. In a production kernel that would be removed and the offending kernel thread would be killed. If you run this again with the config disabled, there will be no continuation from LKDTM. :)

Enjoy! And if you can figure out before me why there is still CFI instrumentation in the KPTI entry handler, please let me know and help us [fix it](https://github.com/KSPP/linux/issues/23). ;)

© 2019 – 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (2)](https://outflux.net/blog/archives/2019/11/20/experimenting-with-clang-cfi-on-upstream-linux/#comments)
## November 14, 2019

### [security things in Linux v5.3](https://outflux.net/blog/archives/2019/11/14/security-things-in-linux-v5-3/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 5:36 pm

Previously: [v5.2](/blog/archives/2019/07/17/security-things-in-linux-v5-2/).

Linux kernel [v5.3 was released](https://lore.kernel.org/lkml/CAHk-%3DwiP4K8DRJWsCo%3D20hn_6054xBamGKF2kPgUzpB5aMaofA%40mail.gmail.com/)! I let this blog post get away from me, but it’s up now! :) Here are some security-related things I found interesting:

**heap variable initialization**

In the continuing work to [remove “uninitialized” variables](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) from the kernel, Alexander Potapenko added new [“`init_on_alloc`” and “`init_on_free`” boot parameters](https://git.kernel.org/linus/6471384af2a6530696fc0203bafe4de41a23c9ef) (with associated Kconfig defaults) to perform zeroing of heap memory either at allocation time (i.e. all `kmalloc()`s effectively become `kzalloc()`s), at free time (i.e. all `kfree()`s effectively become `kzfree()`s), or both. The performance impact of the former under most workloads appears to be under 1%, if it’s measurable at all. The “init\_on\_free” option, however, is more costly but adds the benefit of reducing the lifetime of heap contents after they have been freed (which might be useful for some use-after-free attacks or side-channel attacks). Everyone should enable `CONFIG_INIT_ON_ALLOC_DEFAULT_ON=1` (or boot with “`init_on_alloc=1`“), and the more paranoid system builders should add `CONFIG_INIT_ON_FREE_DEFAULT_ON=1` (or “`init_on_free=1`” at boot). As workloads are found that cause performance concerns, tweaks to the initialization coverage can be added.

**`pidfd_open()` added**

Christian Brauner has continued his [`pidfd` work](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) by [creating the next needed syscall: `pidfd_open()`](https://git.kernel.org/linus/32fcb426ec001cb6d5a4a195091a8486ea77e2df), which takes a `pid` and returns a `pidfd`. This is useful for cases where process creation isn’t yet using `CLONE_PIDFD`, and where `/proc` may not be mounted.

**`-Wimplicit-fallthrough` enabled globally**

Gustavo A.R. Silva landed the last handful of [implicit fallthrough](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) fixes left in the kernel, which allows for [`-Wimplicit-fallthrough` to be globally enabled](https://git.kernel.org/linus/88c5083442454e5e8a505b11fa16f32d2879651e) for all kernel builds. This will keep any new instances of this bad code pattern from entering the kernel again. With several hundred implicit fallthroughs identified and fixed, something like 1 in 10 were missing breaks, which is way higher than I was expecting, making this work even more well justified.

**x86 CR4 & CR0 pinning**

In [recent exploits](https://googleprojectzero.blogspot.com/2017/05/exploiting-linux-kernel-via-packet.html), one of the steps for making the attacker’s life easier is to disable CPU protections like Supervisor Mode Access (and Execute) Prevention (SMAP and SMEP) by finding a way to write to CPU control registers to disable these features. For example, CR4 controls SMAP and SMEP, where disabling those would let an attacker access and execute userspace memory from kernel code again, opening up the attack to much greater flexibility. CR0 controls Write Protect (WP), which when disabled would allow an attacker to write to read-only memory like the kernel code itself. Attacks have been using the kernel’s CR4 and CR0 writing functions to make these changes (since it’s easier to gain that level of execute control), but now the kernel will attempt to [“pin” sensitive bits in CR4](https://git.kernel.org/linus/873d50d58f67ef15d2777b5e7f7a5268bb1fbae2) and [CR0](https://git.kernel.org/linus/8dbec27a242cd3e2816eeb98d3237b9f57cf6232) to avoid them getting disabled. This forces attacks to do more work to enact such register changes going forward. (I’d like to see KVM enforce this too, which would actually protect guest kernels from all attempts to change protected register bits.)

**additional `kfree()` sanity checking**

In order to avoid corrupted pointers doing crazy things when they’re freed (as seen in [recent exploits](https://github.com/ThomasKing2014/slides/raw/master/Building%20universal%20Android%20rooting%20with%20a%20type%20confusion%20vulnerability.pdf)), I added additional sanity checks to [verify kmem cache membership](https://git.kernel.org/linus/598a0717a816abc8f5d3c4598628338b9190d127) and to make sure that [objects actually belong to the kernel slab heap](https://git.kernel.org/linus/a64b53780ec35b77daf817210c88aa42d172c98f). As a reminder, everyone should be building with `CONFIG_SLAB_FREELIST_HARDENED=1`.

**KASLR enabled by default on arm64**

Just as Kernel Address Space Layout Randomization (KASLR) was [enabled by default on x86](/blog/archives/2017/07/10/security-things-in-linux-v4-12/), now [KASLR has been enabled by default on arm64](https://git.kernel.org/linus/8049672bb17a53f2545fbeaa6cfbb48055f51cde) too. It’s worth noting, though, that in order to benefit from this setting, the bootloader used for such arm64 systems needs to either support the UEFI RNG function or provide entropy via the “`/chosen/kaslr-seed`” Device Tree property.

**hardware security embargo documentation**

As there continues to be a long tail of hardware flaws that need to be reported to the Linux kernel community under embargo, a well-defined [process has been documented](https://git.kernel.org/linus/ddaedbbece90add970faeac87f7d7d40341936ce). This will let vendors unfamiliar with how to handle things follow the established best practices for interacting with the Linux kernel community in a way that lets mitigations get developed before embargoes are lifted. The latest (and HTML rendered) version of this process should always be available [here](https://www.kernel.org/doc/html/latest/process/embargoed-hardware-issues.html).

Those are the things I had on my radar. Please let me know if there are other things I should add! [Linux v5.4](/blog/archives/2020/02/18/security-things-in-linux-v5-4/) is almost here…

© 2019 – 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (6)](https://outflux.net/blog/archives/2019/11/14/security-things-in-linux-v5-3/#comments)
## July 17, 2019

### [security things in Linux v5.2](https://outflux.net/blog/archives/2019/07/17/security-things-in-linux-v5-2/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 5:07 pm

Previously: [v5.1](/blog/archives/2019/05/27/security-things-in-linux-v5-1/).

Linux kernel [v5.2 was released](https://lore.kernel.org/lkml/CAHk-%3DwhtW3FdruS-q2zehJPSan1SKtHoFHKX28A3J_1gfTFUMw%40mail.gmail.com/) last week! Here are some security-related things I found interesting:

**page allocator freelist randomization**

While the SLUB and SLAB allocator [freelists have been randomized for a while now](/blog/archives/2016/10/03/security-things-in-linux-v4-7/), the overarching page allocator itself wasn’t. This meant that anything doing allocation outside of the `kmem_cache`/`kmalloc()` would have deterministic placement in memory. This is bad both for security and for some cache management cases. Dan Williams [implemented this randomization under CONFIG\_SHUFFLE\_PAGE\_ALLOCATOR](https://git.kernel.org/linus/e900a918b0984ec8f2eb150b8477a47b75d17692) now, which provides additional uncertainty to memory layouts, though at a rather low granularity of 4MB (see `SHUFFLE_ORDER`). Also note that this feature needs to be enabled at boot time with `page_alloc.shuffle=1` unless you have direct-mapped memory-side-cache (you can check the state at `/sys/module/page_alloc/parameters/shuffle`).

**stack variable initialization with Clang**

Alexander Potapenko [added support via CONFIG\_INIT\_STACK\_ALL](https://git.kernel.org/linus/709a972efb01efaeb97cad1adc87fe400119c8ab) for Clang’s `-ftrivial-auto-var-init=pattern` option that enables [automatic initialization of stack variables](https://reviews.llvm.org/D54604). This provides even greater coverage than the prior [GCC plugin for stack variable initialization](/blog/archives/2019/05/27/security-things-in-linux-v5-1/), as Clang’s implementation also covers variables not passed by reference. (In theory, the kernel build should still warn about these instances, but even if they exist, Clang will initialize them.) Another notable difference between the GCC plugins and Clang’s implementation is that Clang initializes with a repeating 0xAA byte pattern, rather than zero. (Though this changes under certain situations, like for 32-bit pointers which are initialized with 0x000000AA.) As with the GCC plugin, the benefit is that the entire class of uninitialized stack variable flaws goes away.

**Kernel Userspace Access Prevention on powerpc**

Like SMAP on x86 and PAN on ARM, Michael Ellerman and Russell Currey have landed support for disallowing access to userspace without explicit markings in the kernel [(KUAP) on Power9](https://git.kernel.org/linus/890274c2dc4c0a57ae5a12d6a76fa6d05b599d98) and later PPC CPUs under `CONFIG_PPC_RADIX_MMU=y` (which is the default). This is the continuation of the execute protection [(KUEP) in v4.10](/blog/archives/2017/02/27/security-things-in-linux-v4-10/). Now if an attacker tries to trick the kernel into any kind of unexpected access from userspace (not just executing code), the kernel will fault.

**Microarchitectural Data Sampling mitigations on x86**

Another set of cache memory side-channel attacks came to light, and were consolidated together under the name [Microarchitectural Data Sampling](https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/mds.html) (MDS). MDS is weaker than other cache side-channels (less control over target address), but memory contents can still be exposed. Much like [L1TF](https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/l1tf.html), when one’s threat model includes untrusted code running under Symmetric Multi Threading (SMT: more logical cores than physical cores), the only full mitigation is to disable hyperthreading (boot with “`nosmt`“). For all the other variations of the MDS family, Andi Kleen (and others) [implemented various flushing mechanisms](https://git.kernel.org/linus/ed5194c2732c8084af9fd159c146ea92bf137128) to avoid cache leakage.

**unprivileged userfaultfd sysctl knob**

Both FUSE and userfaultfd provide attackers with a way to stall a kernel thread in the middle of memory accesses from userspace by initiating an access on an unmapped page. While FUSE is usually behind some kind of access controls, userfaultfd hadn’t been. To avoid various [heap grooming](https://cyseclabs.com/blog/cve-2016-6187-heap-off-by-one-exploit) and [heap spraying](https://duasynt.com/blog/linux-kernel-heap-spray) techniques for exploiting Use-after-Free flaws, Peter Xu added the new “`[vm.unprivileged_userfaultfd](https://git.kernel.org/linus/cefdca0a86be517bc390fc4541e3674b8e7803b0)`” sysctl knob to disallow unprivileged access to the userfaultfd syscall.

**temporary mm for text poking on x86**

The kernel regularly performs self-modification with things like `text_poke()` (during stuff like alternatives, ftrace, etc). Before, this was done with fixed mappings (“fixmap”) where a specific fixed address at the high end of memory was used to map physical pages as needed. However, this resulted in some temporal risks: other CPUs could write to the fixmap, or there might be stale TLB entries on removal that other CPUs might still be able to write through to change the target contents. Instead, Nadav Amit has created a [separate memory map for kernel text writes](https://git.kernel.org/linus/b3fd8e83ada0d51b71a84297480187e2d40e5ded), as if the kernel is trying to make writes to userspace. This mapping ends up staying local to the current CPU, and the [poking address is randomized](https://git.kernel.org/linus/4fc19708b165c1c152fa1f12f6600e66184b7786), unlike the old fixmap.

**ongoing: implicit fall-through removal**

Gustavo A. R. Silva is nearly done with [marking](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.2&qt=grep&q=expect.*fall.*through) (and [fixing](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.2&qt=grep&q=missing+break)) all the [implicit fall-through cases](https://outflux.net/blog/archives/2019/03/12/security-things-in-linux-v5-0/) in the kernel. Based on the [pull request from Gustavo](https://lore.kernel.org/lkml/20190506180521.GA30749%40embeddedor/), it looks very much like v5.3 will see `-Wimplicit-fallthrough` added to the global build flags and then this class of bug should stay extinct in the kernel.

**CLONE\_PIDFD added**

Christian Brauner added the new [`CLONE_PIDFD` flag](https://git.kernel.org/linus/b3e5838252665ee4cfa76b82bdf1198dca81e5be) to the `clone()` system call, which complements the [pidfd work in v5.1](/blog/archives/2019/05/27/security-things-in-linux-v5-1/) so that programs can now gain a handle for a process ID right at `fork()` (actually `clone()`) time, instead of needing to get the handle from `/proc` after process creation. With signals and forking now enabled, the next major piece (already in linux-next) will be adding `P_PIDFD` to the `waitid()` system call, and common process management can be done entirely with pidfd.

**Other things**

[Alexander Popov pointed out some more v5.2 features](https://twitter.com/a13xp0p0v/status/1164935830319828992) that I missed in this blog post. I’m repeating them here, with some minor edits/clarifications. Thank you Alexander!

* [x86-64 IRQ/exception/debug stack now has guard pages](https://git.kernel.org/linus/8f147727030bf9e81331ab9b8f42d4611bb6a3d9) to detect stack overflows immediately and deterministically from those contexts.
* [mincore(2) is made more conservative](https://git.kernel.org/linus/134fca9063ad4851de767d1768180e5dede9a881) to avoid information exposures about memory cache states and similar.
* [x86’s `objtool` can now validate callers of uaccess helpers to make sure SMAP is not left disabled](https://git.kernel.org/linus/6ec62961e6de9506e8b8620dc19897d8cfd41c2e).
* [powerpc/32 now supports KASAN](https://git.kernel.org/linus/2edb16efc899f9c232e2d880930b855e4cf55df4).
* [powerpc now warns if W+X pages are found on boot](https://git.kernel.org/linus/453d87f6a8aed827f5ebb1708a4cea458fd68d23).

*Edit: added CLONE\_PIDFD notes, as reminded by Christian Brauner. :)*

*Edit: added Alexander Popov’s notes*

That’s it for now; let me know if you think I should add anything here. We’re almost to -rc1 for [v5.3](/blog/archives/2019/11/14/security-things-in-linux-v5-3/)!

© 2019 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (4)](https://outflux.net/blog/archives/2019/07/17/security-things-in-linux-v5-2/#comments)
## June 27, 2019

### [package hardening asymptote](https://outflux.net/blog/archives/2019/06/27/package-hardening-asymptote/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 3:35 pm

Forever ago I set up tooling to generate graphs representing the adoption of various [hardening features in Ubuntu packaging](https://outflux.net/ubuntu/hardening/amd64/). These were very interesting in 2006 when stack protector was making its way into the package archive. Similarly in 2008 and 2009 as FORTIFY\_SOURCE and read-only relocations made their way through the archive. It took a while to really catch hold, but finally PIE-by-default started to take off in 2016 through 2018:

![Graph of Ubuntu hardening feature adoption over 20 years](/illustrations/hardening/ubuntu-hardening-20years.png)

Around 2012 when Debian started in earnest to enable hardening features for their archive, I realized this was going to be a long road. I added the above “20 year view” for Ubuntu and then started similarly graphing [hardening features in Debian packages](https://outflux.net/debian/hardening/) too (the blip on PIE here was a tooling glitch, IIRC):

![Graph of Debian hardening feature adoption over 10 years](/illustrations/hardening/debian-hardening-10years.png)

Today I realized that my Ubuntu tooling broke back in January and no one noticed, including me. And really, why should anyone notice? The “near term” (weekly, monthly) graphs have been basically flat for years:

![The last month of Debian hardening stats](/illustrations/hardening/debian-hardening-month.png)

In the long-term view the measurements have a distinctly asymptotic appearance and the graphs are maybe only good for their historical curves now. But then I wonder, what’s next? What new compiler feature adoption could be measured? I think there are still a few good candidates…

How about enabling `-fstack-clash-protection` (only in [GCC](https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html#index-fstack-clash-protection), [Clang still hasn’t implemented it](https://bugs.llvm.org/show_bug.cgi?id=40802)).

Or how about getting serious and using forward-edge Control Flow Integrity? (Clang has `[-fsanitize=cfi](https://clang.llvm.org/docs/ControlFlowIntegrity.html)` for general purpose function prototype based enforcement, and GCC has the more limited `[-fvtable-verify](https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html#index-fvtable-verify)` for C++ objects.)

Where is backward-edge CFI? (Is everyone waiting for [CET](https://software.intel.com/en-us/blogs/2016/06/09/intel-release-new-technology-specifications-protect-rop-attacks)?)

Does anyone see something meaningful that needs adoption tracking?

© 2019, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2019/06/27/package-hardening-asymptote/#comments)
## May 27, 2019

### [security things in Linux v5.1](https://outflux.net/blog/archives/2019/05/27/security-things-in-linux-v5-1/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 8:49 pm

Previously: [v5.0](/blog/archives/2019/03/12/security-things-in-linux-v5-0/).

Linux kernel [v5.1 has been released](https://lkml.kernel.org/r/CAHk-%3DwhsbDxdapMJGvy9OkVSrKMsKRJBTrH-Qj-qTbkMUGnWUw%40mail.gmail.com)! Here are some security-related things that stood out to me:

**introduction of pidfd**

Christian Brauner landed the first portion of his work to remove pid races from the kernel: using a [file descriptor to reference a process](https://git.kernel.org/linus/3eb39f47934f9d5a3027fe00d906a45fe3a15fad) (“pidfd”). Now `/proc/$pid` can be opened and used as an argument for sending signals with the new `pidfd_send_signal()` syscall. This handle will only refer to the original process at the time the `open()` happened, and not to any later “reused” pid if the process dies and a new process is assigned the same pid. Using this method, it’s now possible to racelessly send signals to exactly the intended process without having to worry about pid reuse. (BTW, this commit wins the 2019 award for Most Well Documented Commit Log Justification.)

**explicitly test for userspace mappings of heap memory**

During [Linux Conf AU 2019 Kernel Hardening BoF](https://2019.linux.conf.au/wiki/Kernel_Hardening_BoF), Matthew Wilcox noted that there wasn’t anything in the kernel actually sanity-checking when userspace mappings were being applied to kernel heap memory (which would allow attackers to bypass the `copy_{to,from}_user()` infrastructure). Driver bugs or attackers able to confuse mappings wouldn’t get caught, so he added checks. To quote the commit logs: [“It’s never appropriate to map a page allocated by SLAB into userspace”](https://git.kernel.org/linus/2d432cb7091e99881af803cdd67a31969b863005) and [“Pages which use page\_type must never be mapped to userspace as it would destroy their page type”](https://git.kernel.org/linus/0ee930e6cafa048c1925893d0ca89918b2814f2c). The latter check almost [immediately caught a bad case](https://lkml.kernel.org/r/20190312171421.GJ19508%40bombadil.infradead.org), which was [quickly fixed](https://git.kernel.org/linus/0266def913771e718fd0c998eecb072e0685e2c9) to avoid page type corruption.

**LSM stacking: shared security blobs**

Casey Schaufler has landed one of the major pieces of getting multiple Linux Security Modules (LSMs) running at the same time (called “stacking”). It is now possible for LSMs to [share the security-specific storage “blobs”](https://git.kernel.org/linus/f4ad8f2c40769b3cc9497ba0883bbaf823f7752f) associated with various core structures (e.g. inodes, tasks, etc) that LSMs can use for saving their state (e.g. storing which profile a given task confined under). The kernel originally gave only the single active “major” LSM (e.g. SELinux, Apprmor, etc) full control over the entire blob of storage. With “shared” security blobs, the LSM infrastructure does the allocation and management of the memory, and LSMs use an offset for reading/writing their portion of it. This unblocks the way for “medium sized” LSMs (like [SARA](https://sara.smeso.it/en/latest/) and [Landlock](https://landlock.io)) to get stacked with a “major” LSM as they need to store much more state than the “minor” LSMs (e.g. Yama, LoadPin) which could already stack because they didn’t need blob storage.

**SafeSetID LSM**

Micah Morton [added](https://git.kernel.org/linus/aeca4e2ca65c1aeacfbe520684e6421719d99417) the new [SafeSetID LSM](https://www.kernel.org/doc/html/latest/admin-guide/LSM/SafeSetID.html), which provides a way to narrow the power associated with the `CAP_SETUID` capability. Normally a process with `CAP_SETUID` can become any user on the system, including root, which makes it a meaningless capability to hand out to non-root users in order for them to “drop privileges” to some less powerful user. There are trees of processes under Chrome OS that need to operate under different user IDs and other methods of accomplishing these transitions safely weren’t sufficient. Instead, this provides a way to create a system-wide policy for user ID transitions via `setuid()` (and group transitions via `setgid()`) when a process has the `CAP_SETUID` capability, making it a much more useful capability to hand out to non-root processes that need to make uid or gid transitions.

**ongoing: refcount\_t conversions**

Elena Reshetova [continued landing](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.1&qt=grep&q=onvert.*refcount_t) more [`refcount_t` conversions](/blog/archives/2017/09/05/security-things-in-linux-v4-13/) in core kernel code (e.g. scheduler, futex, perf), with an additional conversion in btrfs from Anand Jain. The existing conversions, mainly when combined with syzkaller, continue to show their utility at [finding](https://git.kernel.org/linus/357798909164bf423eac6a78ff7da7e98d2d7f7f) [bugs](https://git.kernel.org/linus/b987222654f84f7b4ca95b3a55eca784cb30235b) [all](https://git.kernel.org/linus/a622b40035d16196bf19b2b33b854862595245fc) [over](https://git.kernel.org/linus/b3098121c42caaf3aea239b8655cf52d45be116f) the kernel.

**ongoing: implicit fall-through removal**

Gustavo A. R. Silva continued to make [progress on marking](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.1&qt=grep&q=expect.*fall.*through) more [implicit fall-through](/blog/archives/2019/03/12/security-things-in-linux-v5-0/) cases. What’s so impressive to me about this work, like `refcount_t`, is how many bugs it has been finding (see all the “[missing break](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.1&qt=grep&q=missing+break)” patches). It really shows how quickly the kernel benefits from adding `-Wimplicit-fallthrough` to keep this class of bug from ever returning.

**stack variable initialization includes scalars**

The structleak gcc plugin (originally [ported from PaX](/blog/archives/2017/05/02/security-things-in-linux-v4-11/)) had its [“by reference” coverage](https://outflux.net/blog/archives/2017/11/14/security-things-in-linux-v4-14/) improved to [initialize scalar types](https://git.kernel.org/linus/81a56f6dcd20325607d6008f4bb560c96f4c821a) as well (making “structleak” a bit of a misnomer: it now stops leaks from more than structs). Barring compiler bugs, this means that all stack variables in the kernel can be initialized before use at function entry. For variables not passed to functions by reference, the `-Wuninitialized` compiler flag (enabled via `-Wall`) already makes sure the kernel isn’t building with local-only uninitialized stack variables. And now with `CONFIG_GCC_PLUGIN_STRUCTLEAK_BYREF_ALL` enabled, all variables passed by reference will be initialized as well. This should eliminate most, if not all, uninitialized stack flaws with very minimal performance cost (for most workloads it is lost in the noise), though it does not have the stack data lifetime reduction benefits of [`GCC_PLUGIN_STACKLEAK`](/blog/archives/2018/12/24/security-things-in-linux-v4-20/), which wipes the stack at syscall exit. Clang has recently gained similar [automatic stack initialization support](https://reviews.llvm.org/D54604), and I’d love to this feature in native gcc. To evaluate the coverage of the various stack auto-initialization features, I also wrote regression tests in [lib/test\_stackinit.c](https://git.kernel.org/linus/50ceaa95ea09703722b30b4afa617c972071cd7f).

That’s it for now; please let me know if I missed anything. The [v5.2](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) kernel development cycle is off and running already. :)

© 2019 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v5.1
## March 12, 2019

### [security things in Linux v5.0](https://outflux.net/blog/archives/2019/03/12/security-things-in-linux-v5-0/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:04 pm

Previously: [v4.20](/blog/archives/2018/12/24/security-things-in-linux-v4-20/).

Linux kernel [v5.0 was released last week](https://lkml.kernel.org/r/CAHk-%3DwjuG6HiGbD7DCGfvDvhr_1WZUR-eYF2qWGbYyn9k6unvg%40mail.gmail.com)! Looking through the changes, here are some security-related things I found interesting:

**read-only linear mapping, arm64**

While x86 has had a read-only linear mapping (or “Low Kernel Mapping” as shown in `/sys/kernel/debug/page_tables/kernel` under `CONFIG_X86_PTDUMP=y`) for a while, Ard Biesheuvel has [added them to arm64 now](https://git.kernel.org/linus/c55191e96caa9d787e8f682c5e525b7f8172a3b4). This means that ranges in the linear mapping that contain executable code (e.g. modules, JIT, etc), are not directly writable any more by attackers. On arm64, this is visible as “Linear mapping” in `/sys/kernel/debug/kernel_page_tables` under `CONFIG_ARM64_PTDUMP=y`, where you can now see the page-level granularity:

> ```
>
> ---[ Linear mapping ]---
> ...
> 0xffffb07cfc402000-0xffffb07cfc403000    4K PTE   ro NX SHD AF NG    UXN MEM/NORMAL
> 0xffffb07cfc403000-0xffffb07cfc4d0000  820K PTE   RW NX SHD AF NG    UXN MEM/NORMAL
> 0xffffb07cfc4d0000-0xffffb07cfc4d1000    4K PTE   ro NX SHD AF NG    UXN MEM/NORMAL
> 0xffffb07cfc4d1000-0xffffb07cfc79d000 2864K PTE   RW NX SHD AF NG    UXN MEM/NORMAL
>
> ```

**per-task stack canary, arm**

ARM has supported stack buffer overflow protection for a long time (currently via the compiler’s `-fstack-protector-strong` option). However, on ARM, the compiler uses a global variable for comparing the canary value, `__stack_chk_guard`. This meant that everywhere in the kernel needed to use the same canary value. If an attacker could expose a canary value in one task, it could be spoofed during a buffer overflow in another task. On x86, the canary is in Thread Local Storage (TLS, defined as `%gs:20` on 32-bit and `%gs:40` on 64-bit), which means it’s possible to have a different canary for every task since the `%gs` segment points to per-task structures. To solve this for ARM, Ard Biesheuvel built a GCC plugin to [replace the global canary checking code with a per-task relative reference](https://git.kernel.org/linus/189af4657186da08a2e79fb8e906cfd82b2ccddc) to a new canary in `struct thread_info`. As he describes in his [blog post](http://www.workofard.com/2018/01/per-task-stack-canaries-for-arm64/), the plugin results in replacing:

> ```
>
> 8010fad8:       e30c4488        movw    r4, #50312      ; 0xc488
> 8010fadc:       e34840d0        movt    r4, #32976      ; 0x80d0
> ...
> 8010fb1c:       e51b2030        ldr     r2, [fp, #-48]  ; 0xffffffd0
> 8010fb20:       e5943000        ldr     r3, [r4]
> 8010fb24:       e1520003        cmp     r2, r3
> 8010fb28:       1a000020        bne     8010fbb0
> ...
> 8010fbb0:       eb006738        bl      80129898 <__stack_chk_fail>
>
> ```

with:

> ```
>
> 8010fc18:       e1a0300d        mov     r3, sp
> 8010fc1c:       e3c34d7f        bic     r4, r3, #8128   ; 0x1fc0
> ...
> 8010fc60:       e51b2030        ldr     r2, [fp, #-48]  ; 0xffffffd0
> 8010fc64:       e5943018        ldr     r3, [r4, #24]
> 8010fc68:       e1520003        cmp     r2, r3
> 8010fc6c:       1a000020        bne     8010fcf4
> ...
> 8010fcf4:       eb006757        bl      80129a58 <__stack_chk_fail>
>
> ```

`r2` holds the canary saved on the stack and `r3` the known-good canary to check against. In the former, `r3` is loaded through `r4` at a fixed address (0x80d0c488, which “`readelf -s vmlinux`” confirms is the global `__stack_chk_guard`). In the latter, it’s coming from offset 0x24 in `struct thread_info` (which “`pahole -C thread_info vmlinux`” confirms is the “`stack_canary`” field).

**per-task stack canary, arm64**

The lack of per-task canary existed on arm64 too. Ard Biesheuvel solved this differently by coordinating with GCC developer Ramana Radhakrishnan to add support for a [register-based offset option](https://gcc.gnu.org/git/?p=gcc.git;a=commitdiff;h=359c1bf35e3109d2f3882980b47a5eae46123259) (specifically “`-mstack-protector-guard=sysreg -mstack-protector-guard-reg=sp_el0 -mstack-protector-guard-offset=...`“). With this feature, the [canary can be found relative to `sp_el0`](https://git.kernel.org/linus/0a1213fa7432778b71a1c0166bf56660a3aab030), since that register holds the pointer to the `struct task_struct`, which contains the canary. I’m hoping there will be a workable Clang solution soon too (for this and 32-bit ARM). (And it’s also worth noting that, unfortunately, this support isn’t yet in a released version of GCC. It’s expected for 9.0, likely this coming May.)

**top-byte-ignore, arm64**

Andrey Konovalov has been [laying the groundwork](https://git.kernel.org/linus/21696c1613244f2ad4e9216c4f6e7804831a992c) with his Top Byte Ignore (TBI) series which will also help support [ARMv8.3’s Pointer Authentication](https://lwn.net/Articles/718888/) (PAC) and [ARMv8.5’s Memory Tagging](https://llvm.org/devmtg/2018-10/slides/Serebryany-Stepanov-Tsyrklevich-Memory-Tagging-Slides-LLVM-2018.pdf) (MTE). While TBI technically conflicts with PAC, both rely on using “non-VA-space” (Virtual Address) bits in memory addresses, and getting the kernel ready to deal with ignoring non-VA bits. PAC stores signatures for checking things like return addresses on the stack or stored function pointers on heap, both to stop overwrites of control flow information. MTE stores a “tag” (or, depending on your dialect, a “color” or “version”) to mark separate memory allocation regions to stop use-after-tree and linear overflows. For either of these to work, the CPU has to be put into some form of the TBI addressing mode (though for MTE, it’ll be a “check the tag” mode), otherwise the addresses would resolve into totally the wrong place in memory. Even without PAC and MTE, this byte can be used to store bits that can be checked by software (which is what the rest of Andrey’s series does: adding this logic to speed up KASan).

**ongoing: implicit fall-through removal**

An area of active work in the kernel is the removal of all implicit fall-through in `switch` statements. While the C language has a statement to indicate the end of a switch case (“`break`“), it doesn’t have a statement to indicate that execution should fall through to the next case statement (just the lack of a “`break`” is used to indicate it should fall through — but this is not always the case), and such “implicit fall-through” may lead to bugs. Gustavo Silva has been the driving force behind fixing these since at least v4.14, with [well over 300 patches](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.0&qt=grep&q=expect.*fall.*through) on the topic alone (and over 20 missing break statements found and fixed as a result of the work). The goal is to be able to add `-Wimplicit-fallthrough` to the build so that the kernel will stay entirely free of this class of bug going forward. From roughly 2300 warnings, the kernel is now down to about 200. It’s also worth noting that with Stephen Rothwell’s help, this bug has been kept out of linux-next by him [sending warning emails](https://lkml.kernel.org/r/20190222120644.0bdc4da8%40canb.auug.org.au) to any tree maintainers where a new instance is introduced (for example, here’s a bug introduced on [Feb 20th](https://git.kernel.org/linus/93700458ff63836ff73d3301e5e98d2e0bb01e98) and fixed on [Feb 21st](https://git.kernel.org/linus/7a25c6c0aac85bbc50d3ce49cd08888adb14508b)).

**ongoing: refcount\_t conversions**

There also continues to be work converting reference counters from `atomic_t` to `refcount_t` so they can gain [overflow protections](/blog/archives/2017/09/05/security-things-in-linux-v4-13/). There have been [18 more conversions since v4.15](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.0&qt=grep&q=onvert.*refcount_t) from Elena Reshetova, Trond Myklebust, Kirill Tkhai, Eric Biggers, and Björn Töpel. While there are more complex cases, the minimum goal is to reduce the [Coccinelle warnings](https://www.kernel.org/doc/html/latest/dev-tools/coccinelle.html) from `scripts/coccinelle/api/atomic_as_refcounter.cocci` to zero. As of v5.0, there are 131 warnings, with the bulk of the remaining areas in `fs/` (49), `drivers/` (41), and `kernel/` (21).

**userspace PAC, arm64**

Mark Rutland and Kristina Martsenko enabled kernel support for ARMv8.3 [PAC in userspace](https://git.kernel.org/linus/750319756256). As mentioned earlier about PAC, this will give userspace the ability to block a wide variety of function pointer overwrites by “signing” function pointers before storing them to memory. The kernel manages the keys (i.e. selects random keys and sets them up), but it’s up to userspace to detect and use the new CPU instructions. The “paca” and “pacg” flags will be visible in `/proc/cpuinfo` for CPUs that support it.

**platform keyring**

Nayna Jain introduced the [trusted platform keyring](https://git.kernel.org/linus/9dc92c45177ab70e20ae94baa2f2e558da63a9c7), which cannot be updated by userspace. This can be used to verify platform or boot-time things like firmware, initramfs, or kexec kernel signatures, etc.

**`SECCOMP_RET_USER_NOTIF`**

Tycho Andersen added the new [`SECCOMP_RET_USER_NOTIF` return type to seccomp](https://git.kernel.org/linus/6a21cc50f0c7f87dae5259f6cfefe024412313f6) which allows process monitors to receive notifications over a file descriptor when a seccomp filter has been hit. This is a much more light-weight method than ptrace for performing tasks on behalf of a process. It is especially useful for performing various admin-only tasks for unprivileged containers (like mounting filesystems). The process monitor can perform the requested task (after doing some ToCToU dances to read process memory for syscall arguments), or reject the syscall.

*Edit: added userspace PAC and platform keyring, suggested by Alexander Popov*

*Edit: tried to clarify TBI vs PAC vs MTE*

*Edit: added details on SECCOMP\_RET\_USER\_NOTIF*

That’s it for now; please let me know if I missed anything. The [v5.1](/blog/archives/2019/05/27/security-things-in-linux-v5-1/) merge window is open, so off we go! :)

© 2019 – 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v5.0
## December 24, 2018

### [security things in Linux v4.20](https://outflux.net/blog/archives/2018/12/24/security-things-in-linux-v4-20/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 3:59 pm

Previously: [v4.19](https://outflux.net/blog/archives/2018/10/22/security-things-in-linux-v4-19/).

Linux kernel v4.20 has been released today! Looking through the changes, here are some security-related things I found interesting:

**stackleak plugin**

Alexander Popov’s work to port the grsecurity STACKLEAK plugin to the upstream kernel came to fruition. While it had received Acks from x86 (and arm64) maintainers, it has been [rejected a few times by Linus](https://www.youtube.com/watch?v=5wIniiWSgUc). With everything matching Linus’s expectations now, it and the x86 glue [have landed](https://git.kernel.org/linus/10e9ae9fabaf96c8e5227c1cd4827d58b3aa406d). (The arch-specific portions for arm64 from Laura Abbott actually [landed in v4.19](https://git.kernel.org/linus/0b3e336601b82c6afa0e9cf21db9cb8793e25399).) The plugin tracks function calls (with a sufficiently large stack usage) to mark the maximum depth of the stack used during a syscall. With this information, at the end of a syscall, the stack can be efficiently poisoned (i.e. instead of clearing the entire stack, only the portion that was actually used during the syscall needs to be written). There are two main benefits from the stack getting wiped after every syscall. First, there are no longer “uninitialized” values left over on the stack that an attacker [might be able to use in the next syscall](https://outflux.net/slides/2011/defcon/kernel-exploitation.pdf). Next, the lifetime of any sensitive data on the stack is reduced to only being live during the syscall itself. This is mainly interesting because any information exposures or side-channel attacks from other kernel threads need to be much more carefully timed to catch the stack data before it gets wiped.

Enabling `CONFIG_GCC_PLUGIN_STACKLEAK=y` means almost all uninitialized variable flaws go away, with only a very minor performance hit (it appears to be under 1% for most workloads). It’s still possible that, within a single syscall, a later buggy function call could use “uninitialized” bytes from the stack from an earlier function. Fixing this will need compiler support for pre-initialization (this is [under development already for Clang](http://lists.llvm.org/pipermail/cfe-dev/2018-November/060172.html), for example), but that may have larger performance implications.

**raise faults for kernel addresses in copy\_\*\_user()**

Jann Horn reworked x86 memory exception handling to [loudly notice](https://git.kernel.org/linus/9da3f2b74054406f87dff7101a569217ffceb29b) when `copy_{to,from}_user()` tries to access unmapped kernel memory. Prior this, those accesses would result in a silent error (usually visible to callers as `EFAULT`), making it indistinguishable from a “regular” userspace memory exception. The purpose of this is to catch cases where, for example, the unchecked `__copy_to_user()` is called against a kernel address. Fuzzers like [syzcaller](https://github.com/google/syzkaller/commit/e8dd2c6713522707b3b89884eb95601cdf9bc9be) weren’t able to notice very nasty bugs because writes to kernel addresses would either corrupt memory (which may or may not get detected at a later time) or return an `EFAULT` that looked like things were operating normally. With this change, it’s now possible to much more easily [notice missing `access_ok()` checks](https://git.kernel.org/linus/96ca579a1ecc943b75beba58bebb0356f6cc4b51). This has already caught two other corner cases even during v4.20 in [HID](https://git.kernel.org/linus/8c01db7619f07c85c5cd81ec5eb83608b56c88f5) and [Xen](https://git.kernel.org/linus/1457d8cf7664f34c4ba534c1073821a559a2f6f9).

**spectre v2 userspace mitigation**

The support for Single Thread Indirect Branch Predictors (STIBP) [has been merged](https://git.kernel.org/linus/53c613fe6349994f023245519265999eed75957f). This allowed CPUs that support STIBP to effectively disable Hyper-Threading to avoid indirect branch prediction side-channels to expose information between userspace threads on the same physical CPU. Since this was a very expensive solution, this protection was [made opt-in](https://git.kernel.org/linus/fa1202ef224391b6f5b26cdd44cc50495e8fab54) (via explicit `prctl()` or implicitly under `seccomp()`). LWN has a nice [write-up of the details](https://lwn.net/Articles/773118/).

**jump labels read-only after init**

Ard Biesheuvel noticed that jump labels don’t need to be writable after initialization, so their data structures were [made read-only](https://git.kernel.org/linus/e872267b8bcbb179e21ccc7118f258873d6e7a59). Since they point to kernel code, they might be used by attackers to manipulate the jump targets as a way to change kernel code that wasn’t intended to be changed. Better to just move everything into the read-only memory region to remove it from the possible kernel targets for attackers.

**VLA removal finished**

As detailed earlier for [v4.17](/blog/archives/2018/06/14/security-things-in-linux-v4-17/), [v4.18](/blog/archives/2018/08/20/security-things-in-linux-v4-18/), and [v4.19](/blog/archives/2018/10/22/security-things-in-linux-v4-19/), a whole bunch of people answered [my call to remove Variable Length Arrays](https://twitter.com/kees_cook/status/971491095736537088) (VLAs) from the kernel. I count at least 153 commits having been added to the kernel since v4.16 to remove VLAs, with a big thanks to Gustavo A. R. Silva, Laura Abbott, Salvatore Mesoraca, Kyle Spiers, Tobin C. Harding, Stephen Kitt, Geert Uytterhoeven, Arnd Bergmann, Takashi Iwai, Suraj Jitindar Singh, Tycho Andersen, Thomas Gleixner, Stefan Wahren, Prashant Bhole, Nikolay Borisov, Nicolas Pitre, Martin Schwidefsky, Martin KaFai Lau, Lorenzo Bianconi, Himanshu Jha, Chris Wilson, Christian Lamparter, Boris Brezillon, Ard Biesheuvel, and Antoine Tenart. With all that done, “`-Wvla`” has been [added](https://git.kernel.org/linus/0bb95f80a38f82884693194ea720e9cca5e12ada) to the top-level Makefile so we don’t get any more added back in the future.

**per-task stack canaries, powerpc**

For a long time, only x86 has had per-task kernel stack canaries. Other architectures would generate a single canary for the life of the boot and use it in every task. This meant that exposing a canary from one task would give an attacker everything they needed to spoof a canary in a separate attack in a different task. Christophe Leroy has [solved this on powerpc](https://git.kernel.org/linus/06ec27aea9fc84d9c6d879eb64b5bcf28a8a1eb7) now, integrating the new GCC support for the `-mstack-protector-guard-reg` and `-mstack-protector-guard-offset` options.

Given the holidays, Linus opened the merge window before v4.20 was released, letting everyone send in pull requests in the week leading up to the release. v4.21 is in the making. :) Happy New Year everyone!

*Edit: clarified stackleak details, thanks to Alexander Popov. Added per-task canaries note too.*

© 2018 – 2019, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2018/12/24/security-things-in-linux-v4-20/#comments)
## October 22, 2018

### [security things in Linux v4.19](https://outflux.net/blog/archives/2018/10/22/security-things-in-linux-v4-19/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:17 pm

Previously: [v4.18](/blog/archives/2018/08/20/security-things-in-linux-v4-18/).

Linux kernel [v4.19 was released today](https://lore.kernel.org/lkml/20181022073224.GA5658%40kroah.com). Here are some security-related things I found interesting:

**L1 Terminal Fault (L1TF)**

While it seems like ages ago, the [fixes for L1TF](https://git.kernel.org/linus/958f338e96f874a0d29442396d6adf9c1e17aa2d) actually landed at the start of the v4.19 merge window. As with the other speculation flaw fixes, lots of people were involved, and the scope was pretty wide: bare metal machines, virtualized machines, etc. LWN has a [great write-up on the L1TF flaw](https://lwn.net/Articles/762570/) and the kernel’s [documentation on L1TF defenses](https://www.kernel.org/doc/html/latest/admin-guide/l1tf.html) is equally detailed. I like how clean the solution is for bare-metal machines: when a page table entry should be marked invalid, instead of only changing the “Present” flag, it also inverts the address portion so even a speculative lookup ignoring the “Present” flag will land in an unmapped area.

**protected regular and fifo files**

Salvatore Mesoraca implemented an `O_CREAT` restriction in `/tmp` directories for [FIFOs and regular files](https://git.kernel.org/linus/30aba6656f61ed44cba445a3c0d38b296fa9e8f5). This is similar to the existing [symlink restrictions](https://git.kernel.org/linus/800179c9b8a1e796e441674776d11cd4c05d61d7), which take effect in sticky world-writable directories (e.g. `/tmp`) when the opening user does not match the owner of the existing file (or directory). When a program opens a FIFO or regular file with `O_CREAT` and this kind of user mismatch, it is treated like it was also opened with `O_EXCL`: it gets rejected because there is already a file there, and the kernel wants to protect the program from writing possibly sensitive contents to a file owned by a different user. This has become a more common attack vector now that symlink and hardlink races have been eliminated.

**syscall register clearing, arm64**

One of the ways attackers can influence potential speculative execution flaws in the kernel is to leak information into the kernel via “unused” register contents. Most syscalls take only a few arguments, so all the other [calling-convention-defined registers](http://man7.org/linux/man-pages/man2/syscall.2.html#NOTES) can be cleared instead of just left with whatever contents they had in userspace. As it turns out, clearing registers is very fast. Similar to what was done on [x86](/blog/archives/2018/06/14/security-things-in-linux-v4-17/), Mark Rutland implemented a full [register-clearing syscall wrapper on arm64](https://git.kernel.org/linus/4378a7d4be30ec6994702b19936f7d1465193541).

**Variable Length Array removals, part 3**

As mentioned in [part 1](/blog/archives/2018/06/14/security-things-in-linux-v4-17/) and [part 2](/blog/archives/2018/08/20/security-things-in-linux-v4-18/), VLAs continue to be removed from the kernel. While `CONFIG_THREAD_INFO_IN_TASK` and `CONFIG_VMAP_STACK` cover most issues with stack exhaustion attacks, not all architectures have those features, so getting rid of VLAs makes sure we keep a few classes of flaws out of all kernel architectures and configurations. It’s been a long road, and it’s shaping up to be a 4-part saga with the remaining VLA removals landing in the next kernel. For v4.19, several folks continued to help [grind away at the problem](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v4.19&qt=grep&q=VLA+usage): Arnd Bergmann, Kyle Spiers, Laura Abbott, Martin Schwidefsky, Salvatore Mesoraca, and myself.

**shift overflow helper**

Jason Gunthorpe noticed that while the kernel [recently gained add/sub/mul/div helpers to check for arithmetic overflow](/blog/archives/2018/08/20/security-things-in-linux-v4-18/), we didn’t have anything for shift-left. He added [check\_shl\_overflow()](https://git.kernel.org/linus/0c66847793d1982d1083dc6f7adad60fa265ce9c) to round out the toolbox and Leon Romanovsky immediately put it to use to [solve an overflow in RDMA](https://git.kernel.org/linus/0dfe452241f4904de497aef01ad2f609ccb9be90).

*Edit: I forgot to mention this next feature when I first posted:*

**trusted architecture-supported RNG initialization**

The Random Number Generator in the kernel seeds its pools from many entropy sources, including any architecture-specific sources (e.g. x86’s `RDRAND`). Due to many people not wanting to trust the architecture-specific source due to the inability to audit its operation, entropy from those sources was not credited to RNG initialization, which wants to gather “enough” entropy before claiming to be initialized. However, because some systems don’t generate enough entropy at boot time, it was taking a while to gather enough system entropy (e.g. from interrupts) before the RNG became usable, which might block userspace from starting (e.g. `systemd` wants to get early entropy). To help these cases, Ted T’so introduced a [toggle to trust the architecture-specific entropy completely](https://git.kernel.org/linus/39a8883a2b989d1d21bd8dd99f5557f0c5e89694) (i.e. RNG is considered fully initialized as soon as it gets the architecture-specific entropy). To use this, the kernel can be built with `CONFIG_RANDOM_TRUST_CPU=y` (or booted with “`random.trust_cpu=on`“).

That’s it for now; thanks for reading. The merge window is open for [v4.20](/blog/archives/2018/12/24/security-things-in-linux-v4-20/)! Wish us luck. :)

© 2018 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v4.19
## August 30, 2017

### [GRUB and LUKS](https://outflux.net/blog/archives/2017/08/30/grub-and-luks/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 10:27 am

I got myself stuck yesterday with GRUB running from an ext4 `/boot/grub`, but with `/boot` inside my LUKS LVM root partition, which meant GRUB couldn’t load the initramfs and kernel.

Luckily, it turns out that GRUB does know how to mount LUKS volumes (and LVM volumes), but all the [instructions](http://www.pavelkogan.com/2014/05/23/luks-full-disk-encryption/) I could find talk about setting this up ahead of time (“Add `GRUB_ENABLE_CRYPTODISK=y` to `/etc/default/grub`“), rather than what the correct manual GRUB commands are to get things running on a failed boot.

These are my notes on that, in case I ever need to do this again, since there was one specific gotcha with using GRUB’s `cryptomount` command (noted below).

Available devices were the raw disk `(hd0)`, the `/boot/grub` partition `(hd0,msdos1)`, and the LUKS volume `(hd0,msdos5)`:

> ```
>
> grub> ls
> (hd0) (hd0,msdos1) (hd0,msdos5)
>
> ```

Used `cryptomount` to open the LUKS volume (but without `()`s! It says it works if you use parens, but then you can’t use the resulting `(crypto0)`):

> ```
>
> grub> insmod luks
> grub> cryptomount hd0,msdos5
> Enter password...
> Slot 0 opened.
>
> ```

Then you can load LVM and it’ll see inside the LUKS volume:

> ```
>
> grub> insmod lvm
> grub> ls
> (crypto0) (hd0) (hd0,msdos1) (hd0,msdos5) (lvm/rootvg-rootlv)
>
> ```

And then I could boot normally:

> ```
>
> grub> configfile $prefix/grub.cfg
>
> ```

After booting, I added `GRUB_ENABLE_CRYPTODISK=y` to `/etc/default/grub` and ran `update-grub`. I could boot normally after that, though I’d be prompted twice for the LUKS passphrase (once by GRUB, then again by the initramfs).

To avoid this, it’s possible to add a second LUKS passphrase, contained in a file in the initramfs, as described [here](http://www.pavelkogan.com/2015/01/25/linux-mint-encryption/) and works for Ubuntu and Debian too. The quick summary is:

Create the keyfile and add it to LUKS:

> ```
>
> # dd bs=512 count=4 if=/dev/urandom of=/crypto_keyfile.bin
> # chmod 0400 /crypto_keyfile.bin
> # cryptsetup luksAddKey /dev/sda5 /crypto_keyfile.bin
> *enter original password*
>
> ```

Adjust the `/etc/crypttab` to include passing the file via `/bin/cat`:

> ```
>
> sda5_crypt UUID=4aa5da72-8da6-11e7-8ac9-001cc008534d /crypto_keyfile.bin luks,keyscript=/bin/cat
>
> ```

Add an initramfs hook to copy the key file into the initramfs, keep non-root users from being able to read your initramfs, and trigger a rebuild:

> ```
>
> # cat > /etc/initramfs-tools/hooks/crypto_keyfile <<EOF
> #!/bin/bash
> if [ "$1" = "prereqs" ] ; then
>     cp /crypto_keyfile.bin "${DESTDIR}"
> fi
> EOF
> # chmod a+x /etc/initramfs-tools/hooks/crypto_keyfile
> # chmod 0700 /boot
> # update-initramfs -u
>
> ```

This has the downside of leaving a LUKS passphrase “in the clear” while you’re booted, but if someone has root, they can just get your `dm-crypt` encryption key directly anyway:

> ```
>
> # dmsetup table --showkeys sda5_crypt
> 0 155797496 crypt aes-cbc-essiv:sha256 e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855 0 8:5 2056
>
> ```

And of course if you’re worried about Evil Maid attacks, you’ll need a real static root of trust instead of doing full disk encryption passphrase prompting from an unverified `/boot` partition. :)

© 2017, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (6)](https://outflux.net/blog/archives/2017/08/30/grub-and-luks/#comments)
## July 27, 2015

### [3D printing Poe](https://outflux.net/blog/archives/2015/07/27/3d-printing-poe/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/) — kees @ 3:08 pm

I helped print this statue of Edgar Allan Poe, through “[We the Builders](http://www.wethebuilders.com/projects/6 "We the Builders")“, who coordinate large-scale crowd-sourced 3D print jobs:

![Poe's Face](/illustrations/2015/poe-face.jpg)

You can see one of my parts [here](https://www.flickr.com/photos/schmarty/19997080192/in/album-72157656325652972 "Hair construction") on top, with “-Kees” on the piece with the funky hair strand:

![Poe's Hair](/illustrations/2015/poe-hair.jpg)

The MakerWare I run on Ubuntu works well. I wish they were correctly signing their repositories. Even if I use non-SSL to fetch their key, [as their Ubuntu/Debian instructions recommend](https://www.makerbot.com/support/new/04_Desktop/Knowledge_Base/How_to_Install_MakerBot_Desktop_for_Linux "insecure MakerWare install instructions"), it still doesn’t match the packages:

```

W: GPG error: http://downloads.makerbot.com trusty Release: The following signatures were invalid: BADSIG 3D019B838FB1487F MakerBot Industries dev team <dev@makerbot.com>

```

And it’s not just my APT configuration:

```

$ wget http://downloads.makerbot.com/makerware/ubuntu/dists/trusty/Release.gpg
$ wget http://downloads.makerbot.com/makerware/ubuntu/dists/trusty/Release
$ gpg --verify Release.gpg Release
gpg: Signature made Wed 11 Mar 2015 12:43:07 PM PDT using RSA key ID 8FB1487F
gpg: requesting key 8FB1487F from hkp server pgp.mit.edu
gpg: key 8FB1487F: public key "MakerBot Industries LLC (Software development team) <dev@makerbot.com>" imported
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)
gpg: BAD signature from "MakerBot Industries LLC (Software development team) <dev@makerbot.com>"
$ grep ^Date Release
Date: Tue, 09 Jun 2015 19:41:02 UTC

```

Looks like they’re updating their Release file without updating the signature file. (The signature is from March, but the Release file is from June. Oops!)

© 2015, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on 3D printing Poe
## January 13, 2015

### [barcode consolidation](https://outflux.net/blog/archives/2015/01/13/barcode-consolidation/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[General](https://outflux.net/blog/archives/category/general/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/) — kees @ 5:33 pm

I had a mess of loyalty cards filling my wallet. It kind of looked like this:

![Loyalty cards, from Flickr, joelogon](/illustrations/joelogon-2819512729.jpg)

They took up too much room, and I used them infrequently. The only thing of value on them are the barcodes they carry that identify my account with whatever organization they’re tied to. Other folks have talked about [doing consolidation](http://blog.joelogon.com/2008/09/making-my-wallet-thinner.html) in various ways like just scanning images of the cards and printing them all together. There was a site where you typed in card details and they generated barcodes for you, too. I didn’t want to hand my identifiers to a third party, and image scanning wasn’t flexible enough. I wanted to actually have the raw numbers, so I ended up using [barcode](http://www.gnu.org/software/barcode/). I didn’t use the Debian nor Ubuntu package, though, since it lacked SVG support, which was added in the latest (*cough* March 2013) version.

I used the Android [Barcode Scanner](https://play.google.com/store/apps/details?id=com.google.zxing.client.android) app, and just saved all the barcodes and their encoding details to a text file, noting which was which. For example:

```

Albertsons "035576322436","UPC_A"
Multnomah County Library "01237035218482","CODABAR"
Supportland "!0000005341632030145420","CODE_128"
...

```

I measured the barcode area, since some scanners can’t handle their expected barcodes being resized, (that’s another project: find out which CAN handle it), and then spat out SVG files. I compared the results to my actual cards, since some times encodings have different options (like dropping checksum characters, “`-c`” below):

```

barcode-svg -S -u in -g 1.5x0.5 -e upc-a      -b '035576322436' > albertsons.svg
barcode-svg -S -u in -g   2x0.5 -e codabar -c -b '01237035218482' > library.svg
barcode-svg -S -u cm -g 4.5x1   -e code128    -b '!0000005341632030145420' > supportland.svg
...

```

With [Inkscape](https://inkscape.org/), I opened them all and organized them onto a wallet-card-sized area, printed it, and laminated it. Now my wallet is 7 cards lighter. More room for [HID](https://en.wikipedia.org/wiki/HID_Global) cards or [other stuff](http://toool.us/equipment.html):

![Emergency Pick Card](/illustrations/equipment-emergency_card.jpg)

© 2015, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on barcode consolidation
## December 10, 2014

### [Open EVSE](https://outflux.net/blog/archives/2014/12/10/open-evse/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Networking](https://outflux.net/blog/archives/category/networking/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Vehicles](https://outflux.net/blog/archives/category/vehicles/) — kees @ 12:53 pm

Needing a new car, and wanting to never purchase another gas-fuelled motor, I bought a [Nissan LEAF](http://en.wikipedia.org/wiki/Nissan_Leaf). (Trivia: LEAF appears to be a backronym for “Leading, Environmentally friendly, Affordable, Family car”.)

![LEAF](/illustrations/leaf/leaf.jpg)

This vehicle has effectively a 22kWh battery and goes maybe 80 miles on a charge, which is more than enough for running errands.

The 15-Amp (“Level 1”) EVSE (Electric Vehicle Supply Equipment) that comes with the LEAF plugs into a standard wall socket. It tells the car’s charger to draw only 12A, so it doesn’t pop the house’s circuit. This will fully charge the batteries in about 20 hours, which is not sufficient for daily use.

![15A EVSE](/illustrations/leaf/15a-evse.png)

The thing on the end that plugs into the LEAF is the [J1772 connector](http://en.wikipedia.org/wiki/SAE_J1772). You’ll note it is not just an extension cord, even though it feeds the car AC power. The EVSE communicates with the vehicle to negotiate a charging current. Then the LEAF’s on-board charger takes the AC the EVSE makes available, converts it to DC, and stores it in the batteries. (My model LEAF also has a second plug for DC fast charging, which uses an entirely different connector: [CHAdeMO](http://en.wikipedia.org/wiki/CHAdeMO).)

Most folks with an Electric Vehicle end up installing a “Home Charger”. (Though calling it a “charger” is a misnomer since, as mentioned, the charger is *in* the car.) This is actually a “Level 2” wall-mounted EVSE, which uses a dedicated high-amperage circuit. Like the Level 1, it has communication logic to do the protocol negotiation with the vehicle. However, the price of Level 2 EVSEs is crazy high (low-end $1000, high-end $3000), and that doesn’t even include the cost of getting the dedicated circuit run by an electrician.

To make matters worse, none of the standard EVSEs are Open Source, and only the high-end ones have remote access, etc. Luckily, I am hardly the first person to notice this, and since I’m so “late” to the EV world, there are several Open projects for building one’s own EVSE.

I went with [OpenEVSE](http://store.openevse.com/products/openevse-30a-charge-station-combo), since I can build it (so I understand all the components in the system), and I can change/improve [the firmware](https://github.com/lincomatic/open_evse) (like adding a wifi board). Under Ubuntu, I was [up and running](https://code.google.com/p/open-evse/wiki/LoadingFirmware) after installing the `arduino` and `avrdude` packages.

Now I can charge from empty in under 8 hours, since the 30A unit charges at 24A nominal.

![30A EVSE](/illustrations/leaf/30a-evse.jpg)

While I was at it, I [3D printed a socket](http://www.thingiverse.com/thing%3A230595) to hold the J1772 plug when it’s not in the car.

![J1772 Holder](/illustrations/leaf/j1772-holder.jpg)

© 2014 – 2015, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on Open EVSE
## June 13, 2014

### [glibc select weakness fixed](https://outflux.net/blog/archives/2014/06/13/5-year-old-glibc-select-weakness-fixed/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[General](https://outflux.net/blog/archives/category/general/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 11:21 am

In 2009, I reported [this bug](https://sourceware.org/bugzilla/show_bug.cgi?id=10352) to glibc, describing the problem that exists when a program is using `select`, and has its open file descriptor resource limit raised above 1024 (`FD_SETSIZE`). If a network daemon starts using the `FD_SET`/`FD_CLR` glibc macros on `fdset` variables for descriptors larger than 1024, glibc will happily write beyond the end of the `fdset` variable, producing a buffer overflow condition. (This problem had existed since the introduction of the macros, so, for decades? I figured it was long over-due to have a report opened about it.)

At the time, I was told this wasn’t going to be fixed and “every program using [select] must be considered buggy.” 2 years later still more people kept asking for this feature and continued to be told “no”.

But, as it turns out, a few months later after the most recent “no”, it got silently fixed anyway, with the bug left open as “Won’t Fix”! I’m glad Florian did some house-cleaning on the glibc bug tracker, since I’d otherwise never have noticed that this protection had been added to the ever-growing list of `-D_FORTIFY_SOURCE=2` protections.

I’ll still recommend everyone use `poll` instead of `select`, but now I won’t be so worried when I see requests to raise the open descriptor limit above 1024.

© 2014, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on glibc select weakness fixed
## May 7, 2014

### [Linux Security Summit 2014](https://outflux.net/blog/archives/2014/05/07/linux-security-summit-2014/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[General](https://outflux.net/blog/archives/category/general/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 10:31 am

The [Linux Security Summit](http://kernsec.org/wiki/index.php/Linux_Security_Summit_2014) is happening in Chicago August 18th and 19th, just before [LinuxCon](https://events.linuxfoundation.org/events/linuxcon). Send us some presentation and topic proposals, and join the conversation with other like-minded people. :)

I’d love to see what people have been working on, and what they’d like to work on. Our general topics will hopefully include:

* System hardening
* Access control
* Cryptography
* Integrity control
* Hardware security
* Networking
* Storage
* Virtualization
* Desktop
* Tools
* Management
* Case studies
* Emerging technologies, threats & techniques

The Call For Participation closes June 6th, so you’ve got about a month, but earlier is better.

© 2014, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2014/05/07/linux-security-summit-2014/#comments)
## February 3, 2014

### [compiler hardening in Ubuntu and Debian](https://outflux.net/blog/archives/2014/02/03/compiler-hardening-in-ubuntu-and-debian/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 8:42 am

Back in 2006, the compiler in Ubuntu was [patched](https://wiki.ubuntu.com/ToolChain/CompilerFlags) to enable most build-time security-hardening features (relro, stack protector, fortify source). I wasn’t able to convince Debian to do the same, so Debian went the route of other distributions, adding security hardening flags during package builds only. I remain disappointed in this approach, because it means that someone who builds software without using the packaging tools on a non-Ubuntu system won’t get those hardening features. Think of a sysadmin trying the latest nginx, or a vendor like Valve building games for distribution. On Ubuntu, when you do that “./configure && make” you’ll get the features automatically.

Debian, at the time, didn’t have a good way forward even for package builds since it lacked a concept of “global package build flags”. Happily, a [solution (via dh)](http://manpages.ubuntu.com/dpkg-buildflags) was developed about [2 years ago](http://web.dodds.net/~vorlon/wiki/blog/Debian%3A_not_stale_just_hardened/), and Debian package maintainers have been working to adopt it ever since.

So, while I don’t think any distro can match Ubuntu’s method of security hardening compiler defaults, it is valuable to see the results of global package build flags in Debian on the package archive. I’ve had an on-going graph of the state of build hardening on both [Ubuntu](http://www.outflux.net/ubuntu/hardening) and [Debian](http://www.outflux.net/debian/hardening) for a while, but only recently did I put together a comparison of a default install. Very few people have all the packages in the archive installed, so it’s a bit silly to only look at the archive statistics. But let’s start there, just to describe what’s being measured.

Here’s today’s snapshot of Ubuntu’s development archive for the past year (you can see development “opening” after a release every 6 months with an influx of new packages):

![](/illustrations/ubuntu-hardening-year.png)

Here’s today’s snapshot of Debian’s unstable archive for the past year (at the start of May you can see the archive “unfreezing” after the Wheezy release; the gaps were my analysis tool failing):

![](/illustrations/debian-hardening-year.png)

Ubuntu’s lines are relatively flat because everything that can be built with hardening already is. Debian’s graph is on a slow upward trend as more packages get migrated to dh to gain knowledge of the global flags.

Each line in the graphs represents the count of source packages that contain binary packages that have at least 1 “hit” for a given category. “ELF” is just that: a source package that ultimately produces at least 1 binary package with at least 1 ELF binary in it (i.e. produces a compiled output). The “Read-only Relocations” (“relro”) hardening feature is almost always done for an ELF, excepting uncommon situations. As a result, the count of ELF and relro are close on Ubuntu. In fact, examining relro is a good indication of whether or not a source package got built with hardening of any kind. So, in Ubuntu, 91.5% of the archive is built with hardening, with Debian at 55.2%.

The “stack protector” and “fortify source” features depend on characteristics of the source itself, and may not always be present in package’s binaries even when hardening is enabled for the build (e.g. no functions got selected for stack protection, or no fortified glibc functions were used). Really these lines mostly indicate the count of packages that have a sufficiently high level of complexity that would trigger such protections.

The “PIE” and “immediate binding” (“bind\_now”) features are specifically enabled by a package maintainer. PIE can have a noticeable performance impact on CPU-register-starved architectures like i386 (ia32), so it is neither patched on in Ubuntu, nor part of the default flags in Debian. (And bind\_now doesn’t make much sense without PIE, so they usually go together.) It’s worth noting, however, that it probably **should** be the default on amd64 (x86\_64), which has plenty of available registers.

Here is a comparison of default installed packages between the most recent stable releases of Ubuntu ([13.10](/illustrations/saucy.txt)) and Debian ([Wheezy](/illustrations/wheezy.txt)). It’s clear that what the average user gets with a default fresh install is better than what the archive-to-archive comparison shows. Debian’s showing is better (74% built with hardening), though it is still clearly lagging behind Ubuntu (99%):

![](/illustrations/hardening-comparison.png)

© 2014, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (2)](https://outflux.net/blog/archives/2014/02/03/compiler-hardening-in-ubuntu-and-debian/#comments)
## January 27, 2014

### [-fstack-protector-strong](https://outflux.net/blog/archives/2014/01/27/fstack-protector-strong/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 2:28 pm

There will be a new option in gcc 4.9 named “`-fstack-protector-strong`“, which offers an improved version of “`-fstack-protector`” without going all the way to “`-fstack-protector-all`“. The stack protector feature itself adds a known canary to the stack during function preamble, and checks it when the function returns. If it changed, there was a stack overflow, and the program aborts. This is fine, but figuring out when to include it is the reason behind the various options.

Since traditionally stack overflows happen with string-based manipulations, the default (`-fstack-protector`), only includes the canary code when a function defines an 8 (`--param=ssp-buffer-size=N`, N=8 by default) or more byte local character array. This means just a few functions get the checking, but they’re probably the most likely to need it, so it’s an okay balance. Various distributions ended up lowering their default `--param=ssp-buffer-size` option down to 4, since there were still cases of functions that should have been protected but the conservative gcc upstream default of 8 wasn’t covering them.

However, even with the increased function coverage, there are rare cases when a stack overflow happens on other kinds of stack variables. To handle this more paranoid concern, `-fstack-protector-all` was defined to add the canary to **all** functions. This results in substantial use of stack space for saving the canary on deep stack users, and measurable (though surprisingly still relatively low) performance hit due to all the saving/checking. For a long time, Chrome OS used this, since we’re paranoid. :)

In the interest of gaining back some of the lost performance and not hitting our Chrome OS build images with such a giant stack-protector hammer, Han Shen from the Chrome OS compiler team [created](http://gcc.gnu.org/ml/gcc-patches/2012-06/msg00974.html) the new option `-fstack-protector-strong`, which enables the canary in many more [conditions](https://docs.google.com/a/google.com/document/d/1xXBH6rRZue4f296vGt9YQcuLVQHeE516stHwt8M9xyU):

* local variable’s address used as part of the right hand side of an assignment or function argument
* local variable is an array (or union containing an array), regardless of array type or length
* uses register local variables

This meant we were covering all the more paranoid conditions that might lead to a stack overflow. Chrome OS has been using this option instead of `-fstack-protector-all` for about 10 months now.

As a quick demonstration of the options, you can see this example program under various conditions. It tries to show off an example of shoving serialized data into a non-character variable, like might happen in some network address manipulations or streaming data parsing. Since I’m using `memcpy` here for clarity, the builds will need to turn off FORTIFY\_SOURCE, which would also notice the overflow.

```

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct no_chars {
    unsigned int len;
    unsigned int data;
};

int main(int argc, char * argv[])
{
    struct no_chars info = { };

    if (argc < 3) {
        fprintf(stderr, "Usage: %s LENGTH DATA...\n", argv[0]);
        return 1;
    }

    info.len = atoi(argv[1]);
    memcpy(&info.data, argv[2], info.len);

    return 0;
}

```

Built with everything disabled, this faults trying to return to an invalid VMA:

```

$ gcc -Wall -O2 -U_FORTIFY_SOURCE -fno-stack-protector /tmp/boom.c -o /tmp/boom
$ /tmp/boom 64 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Segmentation fault (core dumped)

```

Built with FORTIFY\_SOURCE enabled, we see the expected catch of the overflow in `memcpy`:

```

$ gcc -Wall -O2 -D_FORTIFY_SOURCE=2 -fno-stack-protector /tmp/boom.c -o /tmp/boom
$ /tmp/boom 64 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
*** buffer overflow detected ***: /tmp/boom terminated
...

```

So, we’ll leave FORTIFY\_SOURCE disabled for our comparisons. With pre-4.9 gcc, we can see that `-fstack-protector` does not get triggered to protect this function:

```

$ gcc -Wall -O2 -U_FORTIFY_SOURCE -fstack-protector /tmp/boom.c -o /tmp/boom
$ /tmp/boom 64 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Segmentation fault (core dumped)

```

However, using `-fstack-protector-all` does trigger the protection, as expected:

```

$ gcc -Wall -O2 -U_FORTIFY_SOURCE -fstack-protector-all /tmp/boom.c -o /tmp/boom
$ /tmp/boom 64 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
*** stack smashing detected ***: /tmp/boom terminated
Aborted (core dumped)

```

And finally, using the gcc snapshot of 4.9, here is `-fstack-protector-strong` doing its job:

```

$ /usr/lib/gcc-snapshot/bin/gcc -Wall -O2 -U_FORTIFY_SOURCE -fstack-protector-strong /tmp/boom.c -o /tmp/boom
$ /tmp/boom 64 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
*** stack smashing detected ***: /tmp/boom terminated
Aborted (core dumped)

```

For Linux 3.14, I’ve [added support](http://git.kernel.org/linus/8779657d29c0ebcc0c94ede4df2f497baf1b563f) for `-fstack-protector-strong` via the new `CONFIG_CC_STACKPROTECTOR_STRONG` option. The old `CONFIG_CC_STACKPROTECTOR` will be available as `CONFIG_CC_STACKPROTECTOR_REGULAR`. When comparing the results on builds via `size` and `objdump -d` analysis, here’s what I found with gcc 4.9:

A normal x86\_64 “defconfig” build, without stack protector had a kernel text size of 11430641 bytes with 36110 function bodies. Adding `CONFIG_CC_STACKPROTECTOR_REGULAR` increased the kernel text size to 11468490 (a +0.33% change), with 1015 of 36110 functions stack-protected (2.81%). Using `CONFIG_CC_STACKPROTECTOR_STRONG` increased the kernel text size to 11692790 (+2.24%), with 7401 of 36110 functions stack-protected (20.5%). And 20% is a far-cry from 100% if support for `-fstack-protector-all` was added back to the kernel.

The next bit of work will be figuring out the best way to detect the version of gcc in use when doing Debian package builds, and using `-fstack-protector-strong` instead of `-fstack-protector`. For Ubuntu, it’s much simpler because it’ll just be the compiler default.

© 2014 – 2017, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (33)](https://outflux.net/blog/archives/2014/01/27/fstack-protector-strong/#comments)
## December 20, 2013

### [DOM scraping](https://outflux.net/blog/archives/2013/12/20/dom-scraping/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[General](https://outflux.net/blog/archives/category/general/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/),[Web](https://outflux.net/blog/archives/category/web/) — kees @ 11:16 pm

For a long time now I’ve used `mechanize` (via either [Perl](search.cpan.org/perldoc?WWW%3A%3AMechanize) or [Python](https://pypi.python.org/pypi/mechanize/)) for doing website interaction automation. Stuff like playing [web games](http://www.kingdomofloathing.com), checking [the weather](http://www.wunderground.com/global/stations/91765.html), or reviewing my balance at the [bank](https://www.mtgox.com/). However, as the use of javascript continues to increase, it’s getting harder and harder to screen-scrape without actually processing DOM events. To do that, really only browsers are doing the right thing, so getting attached to an actual browser DOM is generally the only way to do any kind of web interaction automation.

It seems the thing furthest along this path is [Selenium](http://www.seleniumhq.org/). Initially, I spent some time trying to make it work with Firefox, but gave up. Instead, this seems to work nicely with Chrome via the Chrome WebDriver. And even better, all of this works out of the box on Ubuntu 13.10 via `python-selenium` and `chromium-chromedriver`.

Running `/usr/lib/chromium-browser/chromedriver2_server` from `chromium-chromedriver` starts a network listener on port 9515. This is the [WebDriver API](http://docs.seleniumhq.org/docs/03_webdriver.jsp) that Selenium can talk to. When requests are made, `chromedriver2_server` spawns Chrome, and all the interactions happen against that browser.

Since I prefer Python, I avoided the Java interfaces and focused on the Python bindings:

```

#!/usr/bin/env python
import sys
from selenium import webdriver
from selenium.common.exceptions import NoSuchElementException
from selenium.webdriver.common.keys import Keys

caps = webdriver.DesiredCapabilities.CHROME

browser = webdriver.Remote("http://localhost:9515", caps)

browser.get("https://bank.example.com/")
assert "My Bank" in browser.title

try:
    elem = browser.find_element_by_name("userid")
    elem.send_keys("username")

    elem = browser.find_element_by_name("password")
    elem.send_keys("wheee my password" + Keys.RETURN)
except NoSuchElementException:
    print "Could not find login elements"
    sys.exit(1)

assert "Account Balances" in browser.title

xpath = "//div[text()='Balance']/../../td[2]/div[contains(text(),'$')]"
balance = browser.find_element_by_xpath(xpath).text

print balance

browser.close()

```

This would work pretty great, but if you need to save any state between sessions, you’ll want to be able to change where Chrome stores data (since by default in this configuration, it uses an empty temporary directory via `--user-data-dir=`). Happily, various things about the browser environment can be controlled, including the command line arguments. This is configurable by expanding the [“desired capabilities” variable](https://sites.google.com/a/chromium.org/chromedriver/capabilities):

```

caps = webdriver.DesiredCapabilities.CHROME
caps["chromeOptions"] = {
        "args": ["--user-data-dir=/home/user/somewhere/to/store/your/session"],
    }

```

A great thing about this is that you get to actually watch the browser do its work. However, in cases where this interaction is going to be fully automated, you likely won’t have a Xorg session running, so you’ll need to wrap the WebDriver in one (since it launches Chrome). I used Xvfb for this:

```

#!/bin/bash
# Start WebDriver under fake X and wait for it to be listening
xvfb-run /usr/lib/chromium-browser/chromedriver2_server &
pid=$!
while ! nc -q0 -w0 localhost 9515; do
    sleep 1
done

the-chrome-script
rc=$?

# Shut down WebDriver
kill $pid

exit $rc

```

Alternatively, all of this could be done in the python script too, but I figured it’s easier to keep the support infrastructure separate from the actual test script itself. I actually leave the `xvfb-run` call external too, so it’s easier to debug the browser in my own X session.

One bug I encountered was that the WebDriver’s cache of the browser’s DOM can sometimes get out of sync with the actual browser’s DOM. I didn’t find a solution to this, but managed to work around it. I’m hoping later versions fix this. :)

© 2013, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (2)](https://outflux.net/blog/archives/2013/12/20/dom-scraping/#comments)
## December 10, 2013

### [live patching the kernel](https://outflux.net/blog/archives/2013/12/10/live-patching-the-kernel/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 3:40 pm

A nice set of recent posts have done a great job detailing the remaining ways that a root user can get at kernel memory. Part of this is driven by the ideas behind UEFI Secure Boot, but they come from the same goal: making sure that the root user cannot directly subvert the running kernel. My perspective on this is toward making sure that an attacker who has gained access and then gained root privileges can’t continue to elevate their access and install invisible kernel rootkits.

An outline for possible attack vectors is spelled out by Matthew Gerrett’s continuing [“useful kernel lockdown” patch series](https://lkml.org/lkml/2013/9/9/532). The set of attacks was examined by Tyler Borland in [“Bypassing modules\_disabled security”](http://turbochaos.blogspot.com/2013/10/writing-linux-rootkits-301_31.html). His post describes each vector in detail, and he ultimately chooses MSR writing as the way to write kernel memory (and shows an example of how to re-enable module loading). One thing not mentioned is that many distros have MSR access as a module, and it’s rarely loaded. If `modules_disabled` is already set, an attacker won’t be able to load the MSR module to begin with. However, the other general-purpose vector, kexec, is still available. To prove out this method, Matthew wrote a [proof-of-concept for changing kernel memory via kexec](http://mjg59.dreamwidth.org/28746.html).

Chrome OS is several steps ahead here, since it has hibernation disabled, MSR writing disabled, kexec disabled, modules verified, root filesystem read-only and verified, kernel verified, and firmware verified. But since not all my machines are Chrome OS, I wanted to look at some additional protections against kexec on general-purpose distro kernels that have `CONFIG_KEXEC` enabled, especially those without UEFI Secure Boot and Matthew’s lockdown patch series.

My goal was to disable kexec without needing to rebuild my entire kernel. For future kernels, I have [proposed adding `/proc/sys/kernel/kexec_disabled`](https://lkml.org/lkml/2013/12/9/790), a partner to the existing `modules_disabled`, that will one-way toggle kexec off. For existing kernels, things got more ugly.

What options do I have for patching a running kernel?

First I looked back at what I’d done in the past with [fixing vulnerabilities with systemtap](http://www.outflux.net/blog/archives/2012/01/22/fixing-vulnerabilities-with-systemtap/). This ends up being a rather heavy-duty way to go about things, since you need all the distro kernel debug symbols, etc. It does work, but has a significant problem: since it uses kprobes, a root user can just turn off the probes, reverting the changes. So that’s not going to work.

Next I looked at ksplice. The [original upstream has gone away](https://oss.oracle.com/ksplice/software/), but there is still some [work being done by Jiri Slaby](https://github.com/jirislaby/ksplice). However, even with his updates which fixed various build problems, there were still more, even when building a 3.2 kernel (Ubuntu 12.04 LTS). So that’s out too, which is too bad, since ksplice does exactly what I want: modifies the running kernel’s functions via a module.

So, finally, I decided to just do it by hand, and wrote a friendly kernel rootkit. Instead of dealing with flipping page table permissions on the normally-unwritable kernel code memory, I borrowed from PaX’s KERNEXEC feature, and just turn off write protect checking on the CPU briefly to make the changes. The return values for functions on x86\_64 are stored in RAX, so I just need to stuff the `kexec_load` syscall with “`mov -1, %rax; ret`” (-1 is `EPERM`):

```

#define pr_fmt(fmt) KBUILD_MODNAME ": " fmt

#include <linux/init.h>
#include <linux/module.h>
#include <linux/slab.h>

static unsigned long long_target;
static char *target;
module_param_named(syscall, long_target, ulong, 0644);
MODULE_PARM_DESC(syscall, "Address of syscall");

/* mov $-1, %rax; ret */
unsigned const char bytes[] = { 0x48, 0xc7, 0xc0, 0xff, 0xff, 0xff, 0xff,
                                0xc3 };
unsigned char *orig;

/* Borrowed from PaX KERNEXEC */
static inline void disable_wp(void)
{
        unsigned long cr0;

        preempt_disable();
        barrier();
        cr0 = read_cr0();
        cr0 &= ~X86_CR0_WP;
        write_cr0(cr0);
}

static inline void enable_wp(void)
{
        unsigned long cr0;

        cr0 = read_cr0();
        cr0 |= X86_CR0_WP;
        write_cr0(cr0);
        barrier();
        preempt_enable_no_resched();
}

static int __init syscall_eperm_init(void)
{
        int i;
        target = (char *)long_target;

        if (target == NULL)
                return -EINVAL;

        /* save original */
        orig = kmalloc(sizeof(bytes), GFP_KERNEL);
        if (!orig)
                return -ENOMEM;
        for (i = 0; i < sizeof(bytes); i++) {
                orig[i] = target[i];
        }

        pr_info("writing %lu bytes at %p\n", sizeof(bytes), target);

        disable_wp();
        for (i = 0; i < sizeof(bytes); i++) {
                target[i] = bytes[i];
        }
        enable_wp();

        return 0;
}
module_init(syscall_eperm_init);

static void __exit syscall_eperm_exit(void)
{
        int i;

        pr_info("restoring %lu bytes at %p\n", sizeof(bytes), target);

        disable_wp();
        for (i = 0; i < sizeof(bytes); i++) {
                target[i] = orig[i];
        }
        enable_wp();

        kfree(orig);
}
module_exit(syscall_eperm_exit);

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Kees Cook <kees@outflux.net>");
MODULE_DESCRIPTION("makes target syscall always return EPERM");

```

If I didn’t want to leave an obvious indication that the kernel had been manipulated, the module could be changed to:

* not announce what it’s doing
* remove the exit route to not restore the changes on module unload
* error out at the end of the init function instead of staying resident

And with this in place, it’s just a matter of loading it with the address of `sys_kexec_load` (found via `/proc/kallsyms`) before I [disable module loading via modprobe](http://www.outflux.net/blog/archives/2012/11/28/clean-module-disabling/). Here’s my upstart script:

```

# modules-disable - disable modules after rc scripts are done
#
description "disable loading modules"

start on stopped module-init-tools and stopped rc

task
script
        cd /root/modules/syscall_eperm
        make clean
        make
        insmod ./syscall_eperm.ko \
                syscall=0x$(egrep ' T sys_kexec_load$' /proc/kallsyms | cut -d" " -f1)
        modprobe disable
end script

```

And now I’m safe from kexec before I have a kernel that contains `/proc/sys/kernel/kexec_disabled`.

© 2013, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (7)](https://outflux.net/blog/archives/2013/12/10/live-patching-the-kernel/#comments)
## November 26, 2013

### [Thanks UPS](https://outflux.net/blog/archives/2013/11/26/thanks-ups/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Networking](https://outflux.net/blog/archives/category/networking/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 8:25 pm

My UPS has decided that every two weeks when it performs a self-test that my 116V mains power isn’t good enough, so it drains the battery and shuts down my home network. Only took a month and a half for me to see on the network graphs that my outages were, to the minute, 2 weeks apart. :)

![APC Monitoring](/illustrations/apc-shutdown.png)

In theory, reducing the sensitivity will fix this…

© 2013 – 2015, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on Thanks UPS
## August 13, 2013

### [TPM providing /dev/hwrng](https://outflux.net/blog/archives/2013/08/13/tpm-providing-devhwrng/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 9:10 am

A while ago, I added [support for the TPM’s pRNG](http://www.outflux.net/blog/archives/2010/02/08/rng-tools-with-tpm/) to the [`rng-tools` package](http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=542599) in Ubuntu. Since then, Kent Yoder [added TPM support directly into the kernel’s `/dev/hwrng`](http://git.kernel.org/linus/578b016fdc91464c08c096f0c5952cae549fdb8f) device. This means there’s no need to carry the patch in `rng-tools` any more, since I can use `/dev/hwrng` directly now:

```

# modprobe tpm-rng
# echo tpm-rng >> /etc/modules
# grep -v ^# /etc/default/rng-tools
RNGDOPTIONS="--fill-watermark=90%"
# service rng-tools restart

```

And as before, once it’s been running a while (or you send `SIGUSR1` to `rngd`), you can see reporting in syslog:

```

# pkill -USR1 rngd
# tail -n 15 /var/log/syslog
Aug 13 09:51:01 linux rngd[39114]: stats: bits received from HRNG source: 260064
Aug 13 09:51:01 linux rngd[39114]: stats: bits sent to kernel pool: 216384
Aug 13 09:51:01 linux rngd[39114]: stats: entropy added to kernel pool: 216384
Aug 13 09:51:01 linux rngd[39114]: stats: FIPS 140-2 successes: 13
Aug 13 09:51:01 linux rngd[39114]: stats: FIPS 140-2 failures: 0
Aug 13 09:51:01 linux rngd[39114]: stats: FIPS 140-2(2001-10-10) Monobit: 0
Aug 13 09:51:01 linux rngd[39114]: stats: FIPS 140-2(2001-10-10) Poker: 0
Aug 13 09:51:01 linux rngd[39114]: stats: FIPS 140-2(2001-10-10) Runs: 0
Aug 13 09:51:01 linux rngd[39114]: stats: FIPS 140-2(2001-10-10) Long run: 0
Aug 13 09:51:01 linux rngd[39114]: stats: FIPS 140-2(2001-10-10) Continuous run: 0
Aug 13 09:51:01 linux rngd[39114]: stats: HRNG source speed: (min=10.433; avg=10.442; max=10.454)Kibits/s
Aug 13 09:51:01 linux rngd[39114]: stats: FIPS tests speed: (min=73.360; avg=75.504; max=86.305)Mibits/s
Aug 13 09:51:01 linux rngd[39114]: stats: Lowest ready-buffers level: 2
Aug 13 09:51:01 linux rngd[39114]: stats: Entropy starvations: 0
Aug 13 09:51:01 linux rngd[39114]: stats: Time spent starving for entropy: (min=0; avg=0.000; max=0)us

```

I’m pondering getting this running in Chrome OS too, but I want to make sure it doesn’t suck too much battery.

© 2013, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (9)](https://outflux.net/blog/archives/2013/08/13/tpm-providing-devhwrng/#comments)

[Older Posts »](https://outflux.net/blog/archives/category/blogging/page/2/)

* Categories
  + [Blogging](https://outflux.net/blog/archives/category/blogging/ "Blogging, and the software needed to get it done.") (152)
  + [Chrome OS](https://outflux.net/blog/archives/category/chromeos/ "Chrome OS distribution of Linux") (49)
  + [Debian](https://outflux.net/blog/archives/category/debian/ "Debian and SPI") (117)
  + [Embedded](https://outflux.net/blog/archives/category/embedded/ "Deep internals, programming, and designing of various hardware devices.") (8)
  + [General](https://outflux.net/blog/archives/category/general/ "I forgot to click a more specific topic.") (33)
  + [Health](https://outflux.net/blog/archives/category/health/ "My health, other people's health, or health in general.") (3)
  + [Inkscape](https://outflux.net/blog/archives/category/inkscape/ "Inkscape SVG editor software project.") (8)
  + [Kernel](https://outflux.net/blog/archives/category/kernel/) (37)
  + [kernel.org](https://outflux.net/blog/archives/category/kernelorg/ "My work on the kernel.org servers.") (6)
  + [Multimedia](https://outflux.net/blog/archives/category/multimedia/ "Software/things involved in audio/visual display, recording, and/or editing.") (33)
  + [Networking](https://outflux.net/blog/archives/category/networking/ "Networking and computer intercommunication, including wireless.") (27)
  + [Reverse Engineering](https://outflux.net/blog/archives/category/reverse-engineering/ "Trying to take something apart and see how it works, usually with improvements.") (15)
  + [Security](https://outflux.net/blog/archives/category/security/ "Security, penetration testing, and hardening.") (130)
  + [Ubuntu](https://outflux.net/blog/archives/category/ubuntu/ "Ubuntu and Canonical") (179)
  + [Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/ "Stuff happening with the Ubuntu Server Team.") (109)
  + [Vehicles](https://outflux.net/blog/archives/category/vehicles/ "Working on or drooling over various vehicles.") (2)
  + [Vulnerabilities](https://outflux.net/blog/archives/category/vulnerabilities/ "Vulnerability discovery announcements.") (12)
  + [Web](https://outflux.net/blog/archives/category/web/ "Websites, protocols, languages, etc.") (14)
* Search for:
* Links
  + [Outflux](http://outflux.net/ "homepage")
  + [#fediverse](https://fosstodon.org/%40kees "social media")
* Archives Archives
  Select Month
   October 2023  (1)
   June 2022  (1)
   April 2022  (1)
   April 2021  (1)
   February 2021  (1)
   October 2020  (1)
   September 2020  (2)
   May 2020  (1)
   February 2020  (1)
   November 2019  (2)
   July 2019  (1)
   June 2019  (1)
   May 2019  (1)
   March 2019  (1)
   December 2018  (1)
   October 2018  (1)
   August 2018  (1)
   June 2018  (1)
   April 2018  (2)
   February 2018  (1)
   January 2018  (1)
   November 2017  (1)
   September 2017  (1)
   August 2017  (1)
   July 2017  (1)
   May 2017  (1)
   February 2017  (1)
   December 2016  (1)
   October 2016  (4)
   September 2016  (4)
   November 2015  (1)
   July 2015  (1)
   January 2015  (1)
   December 2014  (1)
   June 2014  (1)
   May 2014  (1)
   February 2014  (1)
   January 2014  (1)
   December 2013  (2)
   November 2013  (1)
   August 2013  (1)
   May 2013  (1)
   January 2013  (1)
   November 2012  (3)
   October 2012  (1)
   May 2012  (1)
   March 2012  (2)
   February 2012  (3)
   January 2012  (1)
   December 2011  (5)
   November 2011  (1)
   September 2011  (1)
   July 2011  (1)
   April 2011  (2)
   February 2011  (3)
   December 2010  (1)
   November 2010  (2)
   October 2010  (3)
   September 2010  (3)
   August 2010  (1)
   July 2010  (3)
   June 2010  (1)
   May 2010  (4)
   April 2010  (2)
   March 2010  (3)
   February 2010  (5)
   January 2010  (2)
   December 2009  (3)
   November 2009  (1)
   October 2009  (3)
   September 2009  (2)
   July 2009  (2)
   May 2009  (1)
   April 2009  (3)
   February 2009  (1)
   January 2009  (3)
   December 2008  (1)
   November 2008  (6)
   October 2008  (5)
   September 2008  (4)
   August 2008  (3)
   July 2008  (1)
   June 2008  (4)
   April 2008  (2)
   March 2008  (4)
   February 2008  (3)
   January 2008  (1)
   December 2007  (4)
   September 2007  (5)
   August 2007  (1)
   April 2007  (2)
   March 2007  (1)
   February 2007  (1)
   January 2007  (2)
   December 2006  (6)
   October 2006  (1)
   September 2006  (2)
   August 2006  (3)
   July 2006  (5)
   June 2006  (1)
   May 2006  (8)
   April 2006  (9)
   March 2006  (4)
   January 2006  (6)
   December 2005  (4)
   October 2005  (9)
   September 2005  (8)
   August 2005  (12)
   July 2005  (3)
   June 2005  (6)
   May 2005  (6)
   April 2005  (4)
   March 2005  (2)
   February 2005  (3)
   January 2005  (11)
* Meta
  + [Log in](https://outflux.net/blog/wp-login.php)
  + [Entries RSS](https://outflux.net/blog/feed/)
  + [Comments RSS](https://outflux.net/blog/comments/feed/)
  + [WordPress.org](https://wordpress.org/ "Powered by WordPress, state-of-the-art semantic personal publishing platform.")

 Powered by [**WordPress**](http://wordpress.org/ "Powered by WordPress, state-of-the-art semantic personal publishing platform.")



=== Content from outflux.net_376ae6d7_20250126_064445.html ===

# [codeblog](https://outflux.net/blog/) code is freedom — patching my itch

## October 19, 2010

### [CVE-2010-2963 v4l compat exploit](https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/),[Vulnerabilities](https://outflux.net/blog/archives/category/vulnerabilities/) — kees @ 3:41 pm

If you’re running a 64bit system, and you’ve got users with access to a video device (`/dev/video*`), then be sure you update your kernels for [CVE-2010-2963](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=3e645d6b485446c54c6745c5e2cf5c528fe4deec). I’ve been slowly making my way through auditing the many uses in the Linux kernel of the `copy_from_user()` function, and ran into this vulnerability.

Here’s the kernel code from `drivers/media/video/v4l2-compat-ioctl32.c`:

```

static int get_microcode32(struct video_code *kp, struct video_code32 __user *up)
{
        if (!access_ok(VERIFY_READ, up, sizeof(struct video_code32)) ||
                copy_from_user(kp->loadwhat, up->loadwhat, sizeof(up->loadwhat)) ||
                get_user(kp->datasize, &up->datasize) ||
                copy_from_user(kp->data, up->data, up->datasize))
                        return -EFAULT;
        return 0;
}

```

Note that `kp->data` is being used as the target for `up->data` in the final `copy_from_user()` without actually verifying that `kp->data` is pointing anywhere safe. Here’s the caller of `get_microcode32`:

```

static long do_video_ioctl(struct file *file, unsigned int cmd, unsigned long arg)
{
        union {
                struct video_tuner vt;
                struct video_code vc;
...
        } karg;
        void __user *up = compat_ptr(arg);
...
        switch (cmd) {
...
        case VIDIOCSMICROCODE:
                err = get_microcode32(&karg.vc, up);
...

```

So, the contents of `up` are totally under control of the caller, and the contents of `karg` (in our case, the `video_code` structure) are *not initialized at all*. So, it seems like a call for `VIDIOCSMICROCODE` would write `video_code->datasize` bytes from `video_code->data` into some random kernel address, just causing an Oops, since we don’t control what is on the kernel’s stack.

But wait, who says we can’t control the contents of the kernel’s stack? In fact, this compat function makes it extremely easy. Let’s look back at the union. Notice the `struct video_tuner`? That gets populated from the caller’s `up` memory via this case of the `switch (cmd)` statement:

```

...
        case VIDIOCSTUNER:
        case VIDIOCGTUNER:
                err = get_video_tuner32(&karg.vt, up);
...

```

So, to control the kernel stack, we just need to call this `ioctl` twice in a row: once to populate the stack via `VIDIOCSTUNER` with the contents we want (including the future address for `video_code->data`, which starts at the same location as `video_tuner->name[20]`), and then again with `VIDIOCSMICROCODE`.

Tricks involved here are: the definition of the `VIDIOCSMICROCODE` case in the kernel is wrong, and calling the `ioctl`s without any preparation can trigger other kernel work (memory faults, etc) that may destroy the stack contents. First, we need the real value for the desired case statement. This turns out to be 0x4020761b. Next, we just repeatedly call the setup `ioctl` in an attempt to get incidental kernel work out of the way so that our last `ioctl` doing the stack preparation will stick, and then we call the buggy `ioctl` to trigger the vulnerability.

Since the ioctl already does a multi-byte copy, we can now copy arbitrary lengths of bytes into kernel memory. One method of turning an arbitrary kernel memory write into a privilege escalation is to overwrite a kernel function pointer, and trigger that function. Based on the [exploit for CVE-2010-3081](http://blog.ksplice.com/2010/09/anatomy-of-an-exploit-cve-2010-3081/), I opted to overwrite the `security_ops` function pointer table. Their use of `msg_queue_msgctl` wasn’t very good for the general case since it’s near the end of the table and its offset would depend on kernel versions. Initially I opted for `getcap`, but in the end used `ptrace_traceme`, both of which are very near the top the `security_ops` structure. (Though I need share credit here with [Dan Rosenberg](http://twitter.com/djrbliss) as we were working together on improving the reliability of the `security_ops` overwrite method. He used the same approach for his excellent [RDS exploit](http://www.vsecurity.com/resources/advisory/20101019-1/).)

Here are the steps for one way of taking an arbitrary kernel memory write and turning it into a root escalation:

* overwrite `security_ops` with `default_security_ops`, which will revert the LSM back to the capabilities-only security operations. This, however, means we can calculate where `cap_ptrace_traceme` is.
* overwrite `default_security_ops->ptrace_traceme` to point to our supplied function that will actually perform the privilege escalation (thanks to [Brad Spengler](http://www.grsecurity.net/~spender/) for his code from Enlightenment).
* trigger the function (in this case, call `ptrace(PTRACE_TRACEME, 0, NULL, NULL)`).
* restore `default_security_ops->ptrace_traceme` to point to `cap_ptrace_traceme` so the next caller doesn’t Oops the system (since userspace memory will be remapped).

Here’s the [source](http://outflux.net/exploits/exp_vyakarana.c) for [Vyakarana](http://twitter.com/kees_cook/status/27181373405) as seen [running in Enlightenment](http://www.youtube.com/watch?v=CLxpae-M7Js) using `cap_getcap` (which is pretty unstable, so you might want to switch it to use `ptrace_traceme`), and as a [stand-alone memory writer](http://outflux.net/exploits/vyakarana.c).

Conclusions: Keep auditing the kernel for more arbitrary writes; I think there are still many left. Reduce the exploitation surface within the kernel itself (which [PaX and grsecurity](http://grsecurity.net/features.php) have been doing for a while now), specifically:

* Block userspace memory access while in kernel mode. This would stop the ability to make the kernel start executing functions that live in userspace — a clear privilege violation. This protection would stop the current exploit above, but the exploit could be adjusted to use kernel memory instead.
* Keep function pointers read-only. There is no reason for these function pointer tables (`fops`, `IDT`, `security_ops`, etc) to be writable. These should all be marked correctly, with inline code exceptions being made for updating the global pointers to those tables, leaving the pointer read-only after it gets set. This would stop this particular exploit above, but there are still plenty more targets.
* Randomize the kernel stack location on a per-syscall basis. This will stop exploits that depend on a stable kernel stack location (as this exploit does).

© 2010, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (10)](https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comments)
## 10 Comments

1. ![](https://secure.gravatar.com/avatar/7b38f700e2103ebb94ddd3725c69016d?s=32&d=wavatar&r=r)

   Hi,

   I’ve seen mention of this elsewhere.

   It would be nice if you could elaborate on how, exactly, to fix these vulnerabilities. I have a couple in mind which I’m responsible for, but I’m unsure exactly how to fix them — and be sure I’ve done it right.

   The other mention I saw of this also failed to explain how to fix it, other than mentioning access\_ok() should be used. I could take a stab at it, but I’d like to know I was doing it right.

   Comment by SteveC — October 19, 2010 @ [4:28 pm](#comment-1037)
2. ![](https://secure.gravatar.com/avatar/7b6f70086cbcbddb1dca2ca162cb623a?s=32&d=wavatar&r=r)

   In general, it’s best to just verify every single use of copy\_to\_user(), copy\_from\_user(), get\_user(), and put\_user(), etc (or any memory copying for that matter). Make sure you know where you’re reading and writing from, and how large those accesses are. (For example, are you sure a length can’t be negative, or larger than you’re expecting?) Calling access\_ok() is already done inside the copy\_\*\_user() functions, so it usually isn’t needed. You’ll note that in this particular case, it was the kernel destination that was unchecked. Everything was fine about the userspace reads — nothing was out of bounds. But nothing actually defined where or how large the kernel destination buffer was.

   Comment by [kees](http://www.outflux.net/blog/) — October 19, 2010 @ [4:38 pm](#comment-1039)
3. ![](https://secure.gravatar.com/avatar/ccd9a9e8456cbf0610cb217a43e1ed1e?s=32&d=wavatar&r=r)

   Thanks for this detailed post!

   Comment by JohnTaylor — October 19, 2010 @ [11:49 pm](#comment-1042)
4. ![](https://secure.gravatar.com/avatar/7b38f700e2103ebb94ddd3725c69016d?s=32&d=wavatar&r=r)

   Actually, it turns out I was thinking of a different issue now that I’m looking at it again, CVS-2010-3081

   <http://sota.gen.nz/compat1/>

   also related to the compat stuff, but to compat\_alloc\_user\_space().

   Comment by SteveC — October 20, 2010 @ [5:14 am](#comment-1043)
5. ![](https://secure.gravatar.com/avatar/139362c4bf92ea747eb6e0a448bff8ac?s=32&d=wavatar&r=r)

   That should trigger a sparse warning shouldn’t it? If someone dereferences a \_\_user pointer?

   I don’t have a 64 bit computer and so I don’t compile that file. But someone should have caught that.

   Comment by Dan Carpenter — October 23, 2010 @ [11:08 am](#comment-1047)
6. ![](https://secure.gravatar.com/avatar/7b6f70086cbcbddb1dca2ca162cb623a?s=32&d=wavatar&r=r)

   @Dan which part should have? Everything was syntactically correct except for the part where ->data wasn’t initialized.

   Comment by [kees](http://www.outflux.net/blog/) — October 23, 2010 @ [1:56 pm](#comment-1048)
7. ![](https://secure.gravatar.com/avatar/139362c4bf92ea747eb6e0a448bff8ac?s=32&d=wavatar&r=r)

   up is declared with the \_\_user attribute.

   So we’re not allowed to dereference it when we do the “up->datasize”. Calling access\_ok() doesn’t mean we can dereference it, it just means that we use \_\_get\_user() instead of get\_user(). User memory can be in a different address space or it can be swapped out.

   Btw up->loadwhat is an array so that doesn’t actually dereference “up”.

   Of course, the datasize isn’t capped as well as you point out. It seems like someone could write a Smatch script to detect these places automatically. Stuff like:

   get\_user(size, &user\_ptr);

   <– no cap on size here.

   copy\_from\_user(dest, src, size);

   I'll poke at this on Monday.

   Comment by Dan Carpenter — October 23, 2010 @ [8:57 pm](#comment-1049)
8. ![](https://secure.gravatar.com/avatar/139362c4bf92ea747eb6e0a448bff8ac?s=32&d=wavatar&r=r)

   Actually, I just read more thouroughly and that’s not what you were pointing out at all. :P Ha ha. It’s amazing this crap works at all.

   Comment by Dan Carpenter — October 23, 2010 @ [10:00 pm](#comment-1050)
9. ![](https://secure.gravatar.com/avatar/c15e88cb370e3acf3be902f01101c7cc?s=32&d=wavatar&r=r)

   “Next, we just repeatedly call the setup ioctl in an attempt to get incidental kernel work out of the way so that our last ioctl doing the stack preparation will stick, and then we call the buggy ioctl to trigger the vulnerability.”

   Can you give me an example when stack preparation will not stick?

   I wrote my own exploit for this vulnerability and I call only one time the setup ioctl and it always works..

   Comment by madara — August 7, 2011 @ [7:03 am](#comment-1119)
10. ![](https://secure.gravatar.com/avatar/7b6f70086cbcbddb1dca2ca162cb623a?s=32&d=wavatar&r=r)

    @madara I didn’t try it with just 1 stack prep, but I figured a bunch wouldn’t hurt. :)

    Comment by [kees](http://www.outflux.net/blog/) — August 8, 2011 @ [10:32 am](#comment-1120)

* Categories
  + [Blogging](https://outflux.net/blog/archives/category/blogging/ "Blogging, and the software needed to get it done.") (152)
  + [Chrome OS](https://outflux.net/blog/archives/category/chromeos/ "Chrome OS distribution of Linux") (49)
  + [Debian](https://outflux.net/blog/archives/category/debian/ "Debian and SPI") (117)
  + [Embedded](https://outflux.net/blog/archives/category/embedded/ "Deep internals, programming, and designing of various hardware devices.") (8)
  + [General](https://outflux.net/blog/archives/category/general/ "I forgot to click a more specific topic.") (33)
  + [Health](https://outflux.net/blog/archives/category/health/ "My health, other people's health, or health in general.") (3)
  + [Inkscape](https://outflux.net/blog/archives/category/inkscape/ "Inkscape SVG editor software project.") (8)
  + [Kernel](https://outflux.net/blog/archives/category/kernel/) (37)
  + [kernel.org](https://outflux.net/blog/archives/category/kernelorg/ "My work on the kernel.org servers.") (6)
  + [Multimedia](https://outflux.net/blog/archives/category/multimedia/ "Software/things involved in audio/visual display, recording, and/or editing.") (33)
  + [Networking](https://outflux.net/blog/archives/category/networking/ "Networking and computer intercommunication, including wireless.") (27)
  + [Reverse Engineering](https://outflux.net/blog/archives/category/reverse-engineering/ "Trying to take something apart and see how it works, usually with improvements.") (15)
  + [Security](https://outflux.net/blog/archives/category/security/ "Security, penetration testing, and hardening.") (130)
  + [Ubuntu](https://outflux.net/blog/archives/category/ubuntu/ "Ubuntu and Canonical") (179)
  + [Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/ "Stuff happening with the Ubuntu Server Team.") (109)
  + [Vehicles](https://outflux.net/blog/archives/category/vehicles/ "Working on or drooling over various vehicles.") (2)
  + [Vulnerabilities](https://outflux.net/blog/archives/category/vulnerabilities/ "Vulnerability discovery announcements.") (12)
  + [Web](https://outflux.net/blog/archives/category/web/ "Websites, protocols, languages, etc.") (14)
* Search for:
* Links
  + [Outflux](http://outflux.net/ "homepage")
  + [#fediverse](https://fosstodon.org/%40kees "social media")
* Archives Archives
  Select Month
   October 2023  (1)
   June 2022  (1)
   April 2022  (1)
   April 2021  (1)
   February 2021  (1)
   October 2020  (1)
   September 2020  (2)
   May 2020  (1)
   February 2020  (1)
   November 2019  (2)
   July 2019  (1)
   June 2019  (1)
   May 2019  (1)
   March 2019  (1)
   December 2018  (1)
   October 2018  (1)
   August 2018  (1)
   June 2018  (1)
   April 2018  (2)
   February 2018  (1)
   January 2018  (1)
   November 2017  (1)
   September 2017  (1)
   August 2017  (1)
   July 2017  (1)
   May 2017  (1)
   February 2017  (1)
   December 2016  (1)
   October 2016  (4)
   September 2016  (4)
   November 2015  (1)
   July 2015  (1)
   January 2015  (1)
   December 2014  (1)
   June 2014  (1)
   May 2014  (1)
   February 2014  (1)
   January 2014  (1)
   December 2013  (2)
   November 2013  (1)
   August 2013  (1)
   May 2013  (1)
   January 2013  (1)
   November 2012  (3)
   October 2012  (1)
   May 2012  (1)
   March 2012  (2)
   February 2012  (3)
   January 2012  (1)
   December 2011  (5)
   November 2011  (1)
   September 2011  (1)
   July 2011  (1)
   April 2011  (2)
   February 2011  (3)
   December 2010  (1)
   November 2010  (2)
   October 2010  (3)
   September 2010  (3)
   August 2010  (1)
   July 2010  (3)
   June 2010  (1)
   May 2010  (4)
   April 2010  (2)
   March 2010  (3)
   February 2010  (5)
   January 2010  (2)
   December 2009  (3)
   November 2009  (1)
   October 2009  (3)
   September 2009  (2)
   July 2009  (2)
   May 2009  (1)
   April 2009  (3)
   February 2009  (1)
   January 2009  (3)
   December 2008  (1)
   November 2008  (6)
   October 2008  (5)
   September 2008  (4)
   August 2008  (3)
   July 2008  (1)
   June 2008  (4)
   April 2008  (2)
   March 2008  (4)
   February 2008  (3)
   January 2008  (1)
   December 2007  (4)
   September 2007  (5)
   August 2007  (1)
   April 2007  (2)
   March 2007  (1)
   February 2007  (1)
   January 2007  (2)
   December 2006  (6)
   October 2006  (1)
   September 2006  (2)
   August 2006  (3)
   July 2006  (5)
   June 2006  (1)
   May 2006  (8)
   April 2006  (9)
   March 2006  (4)
   January 2006  (6)
   December 2005  (4)
   October 2005  (9)
   September 2005  (8)
   August 2005  (12)
   July 2005  (3)
   June 2005  (6)
   May 2005  (6)
   April 2005  (4)
   March 2005  (2)
   February 2005  (3)
   January 2005  (11)
* Meta
  + [Log in](https://outflux.net/blog/wp-login.php)
  + [Entries RSS](https://outflux.net/blog/feed/)
  + [Comments RSS](https://outflux.net/blog/comments/feed/)
  + [WordPress.org](https://wordpress.org/ "Powered by WordPress, state-of-the-art semantic personal publishing platform.")

 Powered by [**WordPress**](http://wordpress.org/ "Powered by WordPress, state-of-the-art semantic personal publishing platform.")



=== Content from access.redhat.com_347dabce_20250126_064433.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.outflux.net_7f616ecf_20250125_063600.html ===

# [codeblog](https://outflux.net/blog/) code is freedom — patching my itch

## October 19, 2010

### [CVE-2010-2963 v4l compat exploit](https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/),[Vulnerabilities](https://outflux.net/blog/archives/category/vulnerabilities/) — kees @ 3:41 pm

If you’re running a 64bit system, and you’ve got users with access to a video device (`/dev/video*`), then be sure you update your kernels for [CVE-2010-2963](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=3e645d6b485446c54c6745c5e2cf5c528fe4deec). I’ve been slowly making my way through auditing the many uses in the Linux kernel of the `copy_from_user()` function, and ran into this vulnerability.

Here’s the kernel code from `drivers/media/video/v4l2-compat-ioctl32.c`:

```

static int get_microcode32(struct video_code *kp, struct video_code32 __user *up)
{
        if (!access_ok(VERIFY_READ, up, sizeof(struct video_code32)) ||
                copy_from_user(kp->loadwhat, up->loadwhat, sizeof(up->loadwhat)) ||
                get_user(kp->datasize, &up->datasize) ||
                copy_from_user(kp->data, up->data, up->datasize))
                        return -EFAULT;
        return 0;
}

```

Note that `kp->data` is being used as the target for `up->data` in the final `copy_from_user()` without actually verifying that `kp->data` is pointing anywhere safe. Here’s the caller of `get_microcode32`:

```

static long do_video_ioctl(struct file *file, unsigned int cmd, unsigned long arg)
{
        union {
                struct video_tuner vt;
                struct video_code vc;
...
        } karg;
        void __user *up = compat_ptr(arg);
...
        switch (cmd) {
...
        case VIDIOCSMICROCODE:
                err = get_microcode32(&karg.vc, up);
...

```

So, the contents of `up` are totally under control of the caller, and the contents of `karg` (in our case, the `video_code` structure) are *not initialized at all*. So, it seems like a call for `VIDIOCSMICROCODE` would write `video_code->datasize` bytes from `video_code->data` into some random kernel address, just causing an Oops, since we don’t control what is on the kernel’s stack.

But wait, who says we can’t control the contents of the kernel’s stack? In fact, this compat function makes it extremely easy. Let’s look back at the union. Notice the `struct video_tuner`? That gets populated from the caller’s `up` memory via this case of the `switch (cmd)` statement:

```

...
        case VIDIOCSTUNER:
        case VIDIOCGTUNER:
                err = get_video_tuner32(&karg.vt, up);
...

```

So, to control the kernel stack, we just need to call this `ioctl` twice in a row: once to populate the stack via `VIDIOCSTUNER` with the contents we want (including the future address for `video_code->data`, which starts at the same location as `video_tuner->name[20]`), and then again with `VIDIOCSMICROCODE`.

Tricks involved here are: the definition of the `VIDIOCSMICROCODE` case in the kernel is wrong, and calling the `ioctl`s without any preparation can trigger other kernel work (memory faults, etc) that may destroy the stack contents. First, we need the real value for the desired case statement. This turns out to be 0x4020761b. Next, we just repeatedly call the setup `ioctl` in an attempt to get incidental kernel work out of the way so that our last `ioctl` doing the stack preparation will stick, and then we call the buggy `ioctl` to trigger the vulnerability.

Since the ioctl already does a multi-byte copy, we can now copy arbitrary lengths of bytes into kernel memory. One method of turning an arbitrary kernel memory write into a privilege escalation is to overwrite a kernel function pointer, and trigger that function. Based on the [exploit for CVE-2010-3081](http://blog.ksplice.com/2010/09/anatomy-of-an-exploit-cve-2010-3081/), I opted to overwrite the `security_ops` function pointer table. Their use of `msg_queue_msgctl` wasn’t very good for the general case since it’s near the end of the table and its offset would depend on kernel versions. Initially I opted for `getcap`, but in the end used `ptrace_traceme`, both of which are very near the top the `security_ops` structure. (Though I need share credit here with [Dan Rosenberg](http://twitter.com/djrbliss) as we were working together on improving the reliability of the `security_ops` overwrite method. He used the same approach for his excellent [RDS exploit](http://www.vsecurity.com/resources/advisory/20101019-1/).)

Here are the steps for one way of taking an arbitrary kernel memory write and turning it into a root escalation:

* overwrite `security_ops` with `default_security_ops`, which will revert the LSM back to the capabilities-only security operations. This, however, means we can calculate where `cap_ptrace_traceme` is.
* overwrite `default_security_ops->ptrace_traceme` to point to our supplied function that will actually perform the privilege escalation (thanks to [Brad Spengler](http://www.grsecurity.net/~spender/) for his code from Enlightenment).
* trigger the function (in this case, call `ptrace(PTRACE_TRACEME, 0, NULL, NULL)`).
* restore `default_security_ops->ptrace_traceme` to point to `cap_ptrace_traceme` so the next caller doesn’t Oops the system (since userspace memory will be remapped).

Here’s the [source](http://outflux.net/exploits/exp_vyakarana.c) for [Vyakarana](http://twitter.com/kees_cook/status/27181373405) as seen [running in Enlightenment](http://www.youtube.com/watch?v=CLxpae-M7Js) using `cap_getcap` (which is pretty unstable, so you might want to switch it to use `ptrace_traceme`), and as a [stand-alone memory writer](http://outflux.net/exploits/vyakarana.c).

Conclusions: Keep auditing the kernel for more arbitrary writes; I think there are still many left. Reduce the exploitation surface within the kernel itself (which [PaX and grsecurity](http://grsecurity.net/features.php) have been doing for a while now), specifically:

* Block userspace memory access while in kernel mode. This would stop the ability to make the kernel start executing functions that live in userspace — a clear privilege violation. This protection would stop the current exploit above, but the exploit could be adjusted to use kernel memory instead.
* Keep function pointers read-only. There is no reason for these function pointer tables (`fops`, `IDT`, `security_ops`, etc) to be writable. These should all be marked correctly, with inline code exceptions being made for updating the global pointers to those tables, leaving the pointer read-only after it gets set. This would stop this particular exploit above, but there are still plenty more targets.
* Randomize the kernel stack location on a per-syscall basis. This will stop exploits that depend on a stable kernel stack location (as this exploit does).

© 2010, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (10)](https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comments)
## 10 Comments

1. ![](https://secure.gravatar.com/avatar/7b38f700e2103ebb94ddd3725c69016d?s=32&d=wavatar&r=r)

   Hi,

   I’ve seen mention of this elsewhere.

   It would be nice if you could elaborate on how, exactly, to fix these vulnerabilities. I have a couple in mind which I’m responsible for, but I’m unsure exactly how to fix them — and be sure I’ve done it right.

   The other mention I saw of this also failed to explain how to fix it, other than mentioning access\_ok() should be used. I could take a stab at it, but I’d like to know I was doing it right.

   Comment by SteveC — October 19, 2010 @ [4:28 pm](#comment-1037)
2. ![](https://secure.gravatar.com/avatar/7b6f70086cbcbddb1dca2ca162cb623a?s=32&d=wavatar&r=r)

   In general, it’s best to just verify every single use of copy\_to\_user(), copy\_from\_user(), get\_user(), and put\_user(), etc (or any memory copying for that matter). Make sure you know where you’re reading and writing from, and how large those accesses are. (For example, are you sure a length can’t be negative, or larger than you’re expecting?) Calling access\_ok() is already done inside the copy\_\*\_user() functions, so it usually isn’t needed. You’ll note that in this particular case, it was the kernel destination that was unchecked. Everything was fine about the userspace reads — nothing was out of bounds. But nothing actually defined where or how large the kernel destination buffer was.

   Comment by [kees](http://www.outflux.net/blog/) — October 19, 2010 @ [4:38 pm](#comment-1039)
3. ![](https://secure.gravatar.com/avatar/ccd9a9e8456cbf0610cb217a43e1ed1e?s=32&d=wavatar&r=r)

   Thanks for this detailed post!

   Comment by JohnTaylor — October 19, 2010 @ [11:49 pm](#comment-1042)
4. ![](https://secure.gravatar.com/avatar/7b38f700e2103ebb94ddd3725c69016d?s=32&d=wavatar&r=r)

   Actually, it turns out I was thinking of a different issue now that I’m looking at it again, CVS-2010-3081

   <http://sota.gen.nz/compat1/>

   also related to the compat stuff, but to compat\_alloc\_user\_space().

   Comment by SteveC — October 20, 2010 @ [5:14 am](#comment-1043)
5. ![](https://secure.gravatar.com/avatar/139362c4bf92ea747eb6e0a448bff8ac?s=32&d=wavatar&r=r)

   That should trigger a sparse warning shouldn’t it? If someone dereferences a \_\_user pointer?

   I don’t have a 64 bit computer and so I don’t compile that file. But someone should have caught that.

   Comment by Dan Carpenter — October 23, 2010 @ [11:08 am](#comment-1047)
6. ![](https://secure.gravatar.com/avatar/7b6f70086cbcbddb1dca2ca162cb623a?s=32&d=wavatar&r=r)

   @Dan which part should have? Everything was syntactically correct except for the part where ->data wasn’t initialized.

   Comment by [kees](http://www.outflux.net/blog/) — October 23, 2010 @ [1:56 pm](#comment-1048)
7. ![](https://secure.gravatar.com/avatar/139362c4bf92ea747eb6e0a448bff8ac?s=32&d=wavatar&r=r)

   up is declared with the \_\_user attribute.

   So we’re not allowed to dereference it when we do the “up->datasize”. Calling access\_ok() doesn’t mean we can dereference it, it just means that we use \_\_get\_user() instead of get\_user(). User memory can be in a different address space or it can be swapped out.

   Btw up->loadwhat is an array so that doesn’t actually dereference “up”.

   Of course, the datasize isn’t capped as well as you point out. It seems like someone could write a Smatch script to detect these places automatically. Stuff like:

   get\_user(size, &user\_ptr);

   <– no cap on size here.

   copy\_from\_user(dest, src, size);

   I'll poke at this on Monday.

   Comment by Dan Carpenter — October 23, 2010 @ [8:57 pm](#comment-1049)
8. ![](https://secure.gravatar.com/avatar/139362c4bf92ea747eb6e0a448bff8ac?s=32&d=wavatar&r=r)

   Actually, I just read more thouroughly and that’s not what you were pointing out at all. :P Ha ha. It’s amazing this crap works at all.

   Comment by Dan Carpenter — October 23, 2010 @ [10:00 pm](#comment-1050)
9. ![](https://secure.gravatar.com/avatar/c15e88cb370e3acf3be902f01101c7cc?s=32&d=wavatar&r=r)

   “Next, we just repeatedly call the setup ioctl in an attempt to get incidental kernel work out of the way so that our last ioctl doing the stack preparation will stick, and then we call the buggy ioctl to trigger the vulnerability.”

   Can you give me an example when stack preparation will not stick?

   I wrote my own exploit for this vulnerability and I call only one time the setup ioctl and it always works..

   Comment by madara — August 7, 2011 @ [7:03 am](#comment-1119)
10. ![](https://secure.gravatar.com/avatar/7b6f70086cbcbddb1dca2ca162cb623a?s=32&d=wavatar&r=r)

    @madara I didn’t try it with just 1 stack prep, but I figured a bunch wouldn’t hurt. :)

    Comment by [kees](http://www.outflux.net/blog/) — August 8, 2011 @ [10:32 am](#comment-1120)

* Categories
  + [Blogging](https://outflux.net/blog/archives/category/blogging/ "Blogging, and the software needed to get it done.") (152)
  + [Chrome OS](https://outflux.net/blog/archives/category/chromeos/ "Chrome OS distribution of Linux") (49)
  + [Debian](https://outflux.net/blog/archives/category/debian/ "Debian and SPI") (117)
  + [Embedded](https://outflux.net/blog/archives/category/embedded/ "Deep internals, programming, and designing of various hardware devices.") (8)
  + [General](https://outflux.net/blog/archives/category/general/ "I forgot to click a more specific topic.") (33)
  + [Health](https://outflux.net/blog/archives/category/health/ "My health, other people's health, or health in general.") (3)
  + [Inkscape](https://outflux.net/blog/archives/category/inkscape/ "Inkscape SVG editor software project.") (8)
  + [Kernel](https://outflux.net/blog/archives/category/kernel/) (37)
  + [kernel.org](https://outflux.net/blog/archives/category/kernelorg/ "My work on the kernel.org servers.") (6)
  + [Multimedia](https://outflux.net/blog/archives/category/multimedia/ "Software/things involved in audio/visual display, recording, and/or editing.") (33)
  + [Networking](https://outflux.net/blog/archives/category/networking/ "Networking and computer intercommunication, including wireless.") (27)
  + [Reverse Engineering](https://outflux.net/blog/archives/category/reverse-engineering/ "Trying to take something apart and see how it works, usually with improvements.") (15)
  + [Security](https://outflux.net/blog/archives/category/security/ "Security, penetration testing, and hardening.") (130)
  + [Ubuntu](https://outflux.net/blog/archives/category/ubuntu/ "Ubuntu and Canonical") (179)
  + [Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/ "Stuff happening with the Ubuntu Server Team.") (109)
  + [Vehicles](https://outflux.net/blog/archives/category/vehicles/ "Working on or drooling over various vehicles.") (2)
  + [Vulnerabilities](https://outflux.net/blog/archives/category/vulnerabilities/ "Vulnerability discovery announcements.") (12)
  + [Web](https://outflux.net/blog/archives/category/web/ "Websites, protocols, languages, etc.") (14)
* Search for:
* Links
  + [Outflux](http://outflux.net/ "homepage")
  + [#fediverse](https://fosstodon.org/%40kees "social media")
* Archives Archives
  Select Month
   October 2023  (1)
   June 2022  (1)
   April 2022  (1)
   April 2021  (1)
   February 2021  (1)
   October 2020  (1)
   September 2020  (2)
   May 2020  (1)
   February 2020  (1)
   November 2019  (2)
   July 2019  (1)
   June 2019  (1)
   May 2019  (1)
   March 2019  (1)
   December 2018  (1)
   October 2018  (1)
   August 2018  (1)
   June 2018  (1)
   April 2018  (2)
   February 2018  (1)
   January 2018  (1)
   November 2017  (1)
   September 2017  (1)
   August 2017  (1)
   July 2017  (1)
   May 2017  (1)
   February 2017  (1)
   December 2016  (1)
   October 2016  (4)
   September 2016  (4)
   November 2015  (1)
   July 2015  (1)
   January 2015  (1)
   December 2014  (1)
   June 2014  (1)
   May 2014  (1)
   February 2014  (1)
   January 2014  (1)
   December 2013  (2)
   November 2013  (1)
   August 2013  (1)
   May 2013  (1)
   January 2013  (1)
   November 2012  (3)
   October 2012  (1)
   May 2012  (1)
   March 2012  (2)
   February 2012  (3)
   January 2012  (1)
   December 2011  (5)
   November 2011  (1)
   September 2011  (1)
   July 2011  (1)
   April 2011  (2)
   February 2011  (3)
   December 2010  (1)
   November 2010  (2)
   October 2010  (3)
   September 2010  (3)
   August 2010  (1)
   July 2010  (3)
   June 2010  (1)
   May 2010  (4)
   April 2010  (2)
   March 2010  (3)
   February 2010  (5)
   January 2010  (2)
   December 2009  (3)
   November 2009  (1)
   October 2009  (3)
   September 2009  (2)
   July 2009  (2)
   May 2009  (1)
   April 2009  (3)
   February 2009  (1)
   January 2009  (3)
   December 2008  (1)
   November 2008  (6)
   October 2008  (5)
   September 2008  (4)
   August 2008  (3)
   July 2008  (1)
   June 2008  (4)
   April 2008  (2)
   March 2008  (4)
   February 2008  (3)
   January 2008  (1)
   December 2007  (4)
   September 2007  (5)
   August 2007  (1)
   April 2007  (2)
   March 2007  (1)
   February 2007  (1)
   January 2007  (2)
   December 2006  (6)
   October 2006  (1)
   September 2006  (2)
   August 2006  (3)
   July 2006  (5)
   June 2006  (1)
   May 2006  (8)
   April 2006  (9)
   March 2006  (4)
   January 2006  (6)
   December 2005  (4)
   October 2005  (9)
   September 2005  (8)
   August 2005  (12)
   July 2005  (3)
   June 2005  (6)
   May 2005  (6)
   April 2005  (4)
   March 2005  (2)
   February 2005  (3)
   January 2005  (11)
* Meta
  + [Log in](https://outflux.net/blog/wp-login.php)
  + [Entries RSS](https://outflux.net/blog/feed/)
  + [Comments RSS](https://outflux.net/blog/comments/feed/)
  + [WordPress.org](https://wordpress.org/ "Powered by WordPress, state-of-the-art semantic personal publishing platform.")

 Powered by [**WordPress**](http://wordpress.org/ "Powered by WordPress, state-of-the-art semantic personal publishing platform.")



=== Content from secunia.com_639b5060_20250125_063553.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from lists.opensuse.org_95961913_20250125_063551.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/FTLSHLX5ONFIBW3H2QBEV4KSNX7YANJL/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/FTLSHLX5ONFIBW3H2QBEV4KSNX7YANJL/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/FTLSHLX5ONFIBW3H2QBEV4KSNX7YANJL/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/FTLSHLX5ONFIBW3H2QBEV4KSNX7YANJL/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/FTLSHLX5ONFIBW3H2QBEV4KSNX7YANJL/#FTLSHLX5ONFIBW3H2QBEV4KSNX7YANJL)

# [security-announce] SUSE Security Announcement: Linux kernel (SUSE-SA:2010:053)

![](https://seccdn.libravatar.org/avatar/bff0c215e01f23fcee6fe49e65fae458.jpg?s=120&d=mm&r=g)
## [Marcus Meissner](/archives/users/7f6ceefc1eac47b3aa8bbc0c4e1230fe/ "See the profile for Marcus Meissner")

28 Oct
2010

28 Oct
'10

14:14

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
SUSE Security Announcement
Package: kernel
Announcement ID: SUSE-SA:2010:053
Date: Thu, 28 Oct 2010 13:00:00 +0000
Affected Products: openSUSE 11.2
openSUSE 11.3
Vulnerability Type: local privilege escalation
CVSS v2 Base Score: 7.2 (AV:L/AC:L/Au:N/C:C/I:C/A:C)
SUSE Default Package: yes
Cross-References: CVE-2010-2963, CVE-2010-3904
Content of This Advisory:
1) Security Vulnerability Resolved:
Linux kernel security problems
Problem Description
2) Solution or Work-Around
3) Special Instructions and Notes
4) Package Location and Checksums
5) Pending Vulnerabilities, Solutions, and Work-Arounds:
See SUSE Security Summary Report.
6) Authenticity Verification and Additional Information
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
1) Problem Description and Brief Discussion
The openSUSE 11.2 and 11.3 kernels were updated to fix 2 critical
security issues and some small bugs.
Following security issues were fixed:
CVE-2010-3904: A local privilege escalation in RDS sockets allowed
local attackers to gain root privileges.
We thank Dan Rosenberg for reporting this problem.
CVE-2010-2963: A problem in the compat ioctl handling in video4linux
allowed local attackers with a video device plugged in to gain root
privileges on x86\_64 systems.
We thank Kees Cook for reporting this problem.
2) Solution or Work-Around
There is no known workaround, please install the update packages.
3) Special Instructions and Notes
Please reboot the machine after installing the update.
4) Package Location and Checksums
The preferred method for installing security updates is to use the YaST
"Online Update" module or the "zypper" commandline tool. The package and
patch management stack will detect which updates are required and
automatically perform the necessary steps to verify and install them.
Alternatively, download the update packages for your distribution manually
and verify their integrity by the methods listed in Section 6 of this
announcement. Then install the packages using the command
rpm -Fhv <file.rpm>
to apply the update, replacing <file.rpm> with the filename of the
downloaded RPM package.
x86 Platform:
openSUSE 11.3:
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-debug-2.6.34.7-0.5....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-debug-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-debug-base-2.6.34.7...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-debug-base-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-debug-devel-2.6.34....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-debug-devel-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-default-2.6.34.7-0....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-default-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-default-base-2.6.34...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-default-base-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-default-devel-2.6.3...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-default-devel-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-desktop-2.6.34.7-0....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-desktop-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-desktop-base-2.6.34...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-desktop-base-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-desktop-devel-2.6.3...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-desktop-devel-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-ec2-2.6.34.7-0.5.1....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-ec2-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-ec2-base-2.6.34.7-0...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-ec2-base-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-ec2-devel-2.6.34.7-...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-ec2-devel-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-ec2-extra-2.6.34.7-...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-ec2-extra-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-pae-2.6.34.7-0.5.1....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-pae-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-pae-base-2.6.34.7-0...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-pae-base-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-pae-devel-2.6.34.7-...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-pae-devel-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-syms-2.6.34.7-0.5.1...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-syms-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-trace-2.6.34.7-0.5....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-trace-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-trace-base-2.6.34.7...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-trace-base-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-trace-devel-2.6.34....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-trace-devel-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-vanilla-2.6.34.7-0....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-vanilla-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-vanilla-base-2.6.34...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-vanilla-base-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-vanilla-devel-2.6.3...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-vanilla-devel-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-vmi-2.6.34.7-0.5.1....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-vmi-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-vmi-base-2.6.34.7-0...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-vmi-base-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-vmi-devel-2.6.34.7-...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-vmi-devel-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-xen-2.6.34.7-0.5.1....](http://download.opensuse.org/update/11.3/rpm/i586/kernel-xen-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-xen-base-2.6.34.7-0...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-xen-base-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/kernel-xen-devel-2.6.34.7-...](http://download.opensuse.org/update/11.3/rpm/i586/kernel-xen-devel-2.6.34.7-0.5.1.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/preload-kmp-default-1.1\_k2...](http://download.opensuse.org/update/11.3/rpm/i586/preload-kmp-default-1.1_k2.6.34.7_0.5-19.1.8.i586.rpm)
[http://download.opensuse.org/update/11.3/rpm/i586/preload-kmp-desktop-1.1\_k2...](http://download.opensuse.org/update/11.3/rpm/i586/preload-kmp-desktop-1.1_k2.6.34.7_0.5-19.1.8.i586.rpm)
openSUSE 11.2:
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-debug-2.6.31.14-0.4...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-debug-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-debug-base-2.6.31.1...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-debug-base-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-debug-devel-2.6.31....](http://download.opensuse.org/update/11.2/rpm/i586/kernel-debug-devel-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-default-2.6.31.14-0...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-default-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-default-base-2.6.31...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-default-base-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-default-devel-2.6.3...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-default-devel-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-desktop-2.6.31.14-0...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-desktop-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-desktop-base-2.6.31...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-desktop-base-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-desktop-devel-2.6.3...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-desktop-devel-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-pae-2.6.31.14-0.4.1...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-pae-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-pae-base-2.6.31.14-...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-pae-base-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-pae-devel-2.6.31.14...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-pae-devel-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-syms-2.6.31.14-0.4....](http://download.opensuse.org/update/11.2/rpm/i586/kernel-syms-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-trace-2.6.31.14-0.4...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-trace-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-trace-base-2.6.31.1...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-trace-base-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-trace-devel-2.6.31....](http://download.opensuse.org/update/11.2/rpm/i586/kernel-trace-devel-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-vanilla-2.6.31.14-0...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-vanilla-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-vanilla-base-2.6.31...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-vanilla-base-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-vanilla-devel-2.6.3...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-vanilla-devel-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-xen-2.6.31.14-0.4.1...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-xen-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-xen-base-2.6.31.14-...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-xen-base-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/kernel-xen-devel-2.6.31.14...](http://download.opensuse.org/update/11.2/rpm/i586/kernel-xen-devel-2.6.31.14-0.4.1.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/preload-kmp-default-1.1\_2....](http://download.opensuse.org/update/11.2/rpm/i586/preload-kmp-default-1.1_2.6.31.14_0.4-6.9.32.i586.rpm)
[http://download.opensuse.org/update/11.2/rpm/i586/preload-kmp-desktop-1.1\_2....](http://download.opensuse.org/update/11.2/rpm/i586/preload-kmp-desktop-1.1_2.6.31.14_0.4-6.9.32.i586.rpm)
Platform Independent:
openSUSE 11.3:
[http://download.opensuse.org/update/11.3/rpm/noarch/kernel-devel-2.6.34.7-0....](http://download.opensuse.org/update/11.3/rpm/noarch/kernel-devel-2.6.34.7-0.5.1.noarch.rpm)
[http://download.opensuse.org/update/11.3/rpm/noarch/kernel-source-2.6.34.7-0...](http://download.opensuse.org/update/11.3/rpm/noarch/kernel-source-2.6.34.7-0.5.1.noarch.rpm)
[http://download.opensuse.org/update/11.3/rpm/noarch/kernel-source-vanilla-2....](http://download.opensuse.org/update/11.3/rpm/noarch/kernel-source-vanilla-2.6.34.7-0.5.1.noarch.rpm)
openSUSE 11.2:
[http://download.opensuse.org/update/11.2/rpm/noarch/kernel-source-2.6.31.14-...](http://download.opensuse.org/update/11.2/rpm/noarch/kernel-source-2.6.31.14-0.4.1.noarch.rpm)
[http://download.opensuse.org/update/11.2/rpm/noarch/kernel-source-vanilla-2....](http://download.opensuse.org/update/11.2/rpm/noarch/kernel-source-vanilla-2.6.31.14-0.4.1.noarch.rpm)
x86-64 Platform:
openSUSE 11.3:
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-debug-2.6.34.7-0....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-debug-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-debug-base-2.6.34...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-debug-base-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-debug-devel-2.6.3...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-debug-devel-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-default-2.6.34.7-...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-default-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-default-base-2.6....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-default-base-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-default-devel-2.6...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-default-devel-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-desktop-2.6.34.7-...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-desktop-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-desktop-base-2.6....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-desktop-base-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-desktop-devel-2.6...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-desktop-devel-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-ec2-2.6.34.7-0.5....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-ec2-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-ec2-base-2.6.34.7...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-ec2-base-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-ec2-devel-2.6.34....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-ec2-devel-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-ec2-extra-2.6.34....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-ec2-extra-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-syms-2.6.34.7-0.5...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-syms-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-trace-2.6.34.7-0....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-trace-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-trace-base-2.6.34...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-trace-base-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-trace-devel-2.6.3...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-trace-devel-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-vanilla-2.6.34.7-...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-vanilla-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-vanilla-base-2.6....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-vanilla-base-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-vanilla-devel-2.6...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-vanilla-devel-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-xen-2.6.34.7-0.5....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-xen-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-xen-base-2.6.34.7...](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-xen-base-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/kernel-xen-devel-2.6.34....](http://download.opensuse.org/update/11.3/rpm/x86_64/kernel-xen-devel-2.6.34.7-0.5.1.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/preload-kmp-default-1.1\_...](http://download.opensuse.org/update/11.3/rpm/x86_64/preload-kmp-default-1.1_k2.6.34.7_0.5-19.1.8.x86_64.rpm)
[http://download.opensuse.org/update/11.3/rpm/x86\_64/preload-kmp-desktop-1.1\_...](http://download.opensuse.org/update/11.3/rpm/x86_64/preload-kmp-desktop-1.1_k2.6.34.7_0.5-19.1.8.x86_64.rpm)
openSUSE 11.2:
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-debug-2.6.31.14-0...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-debug-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-debug-base-2.6.31...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-debug-base-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-debug-devel-2.6.3...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-debug-devel-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-default-2.6.31.14...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-default-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-default-base-2.6....](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-default-base-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-default-devel-2.6...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-default-devel-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-desktop-2.6.31.14...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-desktop-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-desktop-base-2.6....](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-desktop-base-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-desktop-devel-2.6...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-desktop-devel-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-syms-2.6.31.14-0....](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-syms-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-trace-2.6.31.14-0...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-trace-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-trace-base-2.6.31...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-trace-base-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-trace-devel-2.6.3...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-trace-devel-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-vanilla-2.6.31.14...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-vanilla-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-vanilla-base-2.6....](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-vanilla-base-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-vanilla-devel-2.6...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-vanilla-devel-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-xen-2.6.31.14-0.4...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-xen-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-xen-base-2.6.31.1...](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-xen-base-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/kernel-xen-devel-2.6.31....](http://download.opensuse.org/update/11.2/rpm/x86_64/kernel-xen-devel-2.6.31.14-0.4.1.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/preload-kmp-default-1.1\_...](http://download.opensuse.org/update/11.2/rpm/x86_64/preload-kmp-default-1.1_2.6.31.14_0.4-6.9.32.x86_64.rpm)
[http://download.opensuse.org/update/11.2/rpm/x86\_64/preload-kmp-desktop-1.1\_...](http://download.opensuse.org/update/11.2/rpm/x86_64/preload-kmp-desktop-1.1_2.6.31.14_0.4-6.9.32.x86_64.rpm)
Sources:
openSUSE 11.3:
[http://download.opensuse.org/update/11.3/rpm/src/kernel-debug-2.6.34.7-0.5.1...](http://download.opensuse.org/update/11.3/rpm/src/kernel-debug-2.6.34.7-0.5.1.nosrc.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-default-2.6.34.7-0.5...](http://download.opensuse.org/update/11.3/rpm/src/kernel-default-2.6.34.7-0.5.1.nosrc.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-desktop-2.6.34.7-0.5...](http://download.opensuse.org/update/11.3/rpm/src/kernel-desktop-2.6.34.7-0.5.1.nosrc.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-ec2-2.6.34.7-0.5.1.n...](http://download.opensuse.org/update/11.3/rpm/src/kernel-ec2-2.6.34.7-0.5.1.nosrc.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-pae-2.6.34.7-0.5.1.n...](http://download.opensuse.org/update/11.3/rpm/src/kernel-pae-2.6.34.7-0.5.1.nosrc.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-source-2.6.34.7-0.5....](http://download.opensuse.org/update/11.3/rpm/src/kernel-source-2.6.34.7-0.5.1.src.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-syms-2.6.34.7-0.5.1....](http://download.opensuse.org/update/11.3/rpm/src/kernel-syms-2.6.34.7-0.5.1.src.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-trace-2.6.34.7-0.5.1...](http://download.opensuse.org/update/11.3/rpm/src/kernel-trace-2.6.34.7-0.5.1.nosrc.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-vanilla-2.6.34.7-0.5...](http://download.opensuse.org/update/11.3/rpm/src/kernel-vanilla-2.6.34.7-0.5.1.nosrc.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-vmi-2.6.34.7-0.5.1.n...](http://download.opensuse.org/update/11.3/rpm/src/kernel-vmi-2.6.34.7-0.5.1.nosrc.rpm)
[http://download.opensuse.org/update/11.3/rpm/src/kernel-xen-2.6.34.7-0.5.1.n...](http://download.opensuse.org/update/11.3/rpm/src/kernel-xen-2.6.34.7-0.5.1.nosrc.rpm)
openSUSE 11.2:
[http://download.opensuse.org/update/11.2/rpm/src/kernel-debug-2.6.31.14-0.4....](http://download.opensuse.org/update/11.2/rpm/src/kernel-debug-2.6.31.14-0.4.1.nosrc.rpm)
[http://download.opensuse.org/update/11.2/rpm/src/kernel-default-2.6.31.14-0....](http://download.opensuse.org/update/11.2/rpm/src/kernel-default-2.6.31.14-0.4.1.nosrc.rpm)
[http://download.opensuse.org/update/11.2/rpm/src/kernel-desktop-2.6.31.14-0....](http://download.opensuse.org/update/11.2/rpm/src/kernel-desktop-2.6.31.14-0.4.1.nosrc.rpm)
[http://download.opensuse.org/update/11.2/rpm/src/kernel-pae-2.6.31.14-0.4.1....](http://download.opensuse.org/update/11.2/rpm/src/kernel-pae-2.6.31.14-0.4.1.nosrc.rpm)
[http://download.opensuse.org/update/11.2/rpm/src/kernel-source-2.6.31.14-0.4...](http://download.opensuse.org/update/11.2/rpm/src/kernel-source-2.6.31.14-0.4.1.src.rpm)
[http://download.opensuse.org/update/11.2/rpm/src/kernel-syms-2.6.31.14-0.4.1...](http://download.opensuse.org/update/11.2/rpm/src/kernel-syms-2.6.31.14-0.4.1.src.rpm)
[http://download.opensuse.org/update/11.2/rpm/src/kernel-trace-2.6.31.14-0.4....](http://download.opensuse.org/update/11.2/rpm/src/kernel-trace-2.6.31.14-0.4.1.nosrc.rpm)
[http://download.opensuse.org/update/11.2/rpm/src/kernel-vanilla-2.6.31.14-0....](http://download.opensuse.org/update/11.2/rpm/src/kernel-vanilla-2.6.31.14-0.4.1.nosrc.rpm)
[http://download.opensuse.org/update/11.2/rpm/src/kernel-xen-2.6.31.14-0.4.1....](http://download.opensuse.org/update/11.2/rpm/src/kernel-xen-2.6.31.14-0.4.1.nosrc.rpm)
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
5) Pending Vulnerabilities, Solutions, and Work-Arounds:
See SUSE Security Summary Report.
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
6) Authenticity Verification and Additional Information
- Announcement authenticity verification:
SUSE security announcements are published via mailing lists and on Web
sites. The authenticity and integrity of a SUSE security announcement is
guaranteed by a cryptographic signature in each announcement. All SUSE
security announcements are published with a valid signature.
To verify the signature of the announcement, save it as text into a file
and run the command
gpg --verify <file>
replacing <file> with the name of the file where you saved the
announcement. The output for a valid signature looks like:
gpg: Signature made <DATE> using RSA key ID 3D25D3D9
gpg: Good signature from "SuSE Security Team <security@suse.de>"
where <DATE> is replaced by the date the document was signed.
If the security team's key is not contained in your key ring, you can
import it from the first installation CD. To import the key, use the
command
gpg --import gpg-pubkey-3d25d3d9-36e12d04.asc
- Package authenticity verification:
SUSE update packages are available on many mirror FTP servers all over the
world. While this service is considered valuable and important to the free
and open source software community, the authenticity and the integrity of
a package needs to be verified to ensure that it has not been tampered
with.
The internal rpm package signatures provide an easy way to verify the
authenticity of an RPM package. Use the command
rpm -v --checksig <file.rpm>
to verify the signature of the package, replacing <file.rpm> with the
filename of the RPM package downloaded. The package is unmodified if it
contains a valid signature from build@suse.de with the key ID 9C800ACA.
This key is automatically imported into the RPM database (on
RPMv4-based distributions) and the gpg key ring of 'root' during
installation. You can also find it on the first installation CD and at
the end of this announcement.
- SUSE runs two security mailing lists to which any interested party may
subscribe:
opensuse-security@opensuse.org
- General Linux and SUSE security discussion.
All SUSE security announcements are sent to this list.
To subscribe, send an e-mail to
<opensuse-security+subscribe@opensuse.org>.
opensuse-security-announce@opensuse.org
- SUSE's announce-only mailing list.
Only SUSE's security announcements are sent to this list.
To subscribe, send an e-mail to
<opensuse-security-announce+subscribe@opensuse.org>.
=====================================================================
SUSE's security contact is <security@suse.com> or <security@suse.de>.
The <security@suse.de> public key is listed below.
=====================================================================
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
The information in this advisory may be distributed or reproduced,
provided that the advisory is not modified in any way. In particular, the
clear text signature should show proof of the authenticity of the text.
SUSE Linux Products GmbH provides no warranties of any kind whatsoever
with respect to the information contained in this security advisory.
Type Bits/KeyID Date User ID
pub 2048R/3D25D3D9 1999-03-06 SuSE Security Team <security@suse.de>
pub 1024D/9C800ACA 2000-10-19 SuSE Package Signing Key <build@suse.de>
- -----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.2 (GNU/Linux)
mQENAzbhLQQAAAEIAKAkXHe0lWRBXLpn38hMHy03F0I4Sszmoc8aaKJrhfhyMlOA
BqvklPLE2f9UrI4Xc860gH79ZREwAgPt0pi6+SleNFLNcNFAuuHMLQOOsaMFatbz
JR9i4m/lf6q929YROu5zB48rBAlcfTm+IBbijaEdnqpwGib45wE/Cfy6FAttBHQh
1Kp+r/jPbf1mYAvljUfHKuvbg8t2EIQz/5yGp+n5trn9pElfQO2cRBq8LFpf1l+U
P7EKjFmlOq+Gs/fF98/dP3DfniSd78LQPq5vp8RL8nr/o2i7jkAQ33m4f1wOBWd+
cZovrKXYlXiR+Bf7m2hpZo+/sAzhd7LmAD0l09kABRG0JVN1U0UgU2VjdXJpdHkg
VGVhbSA8c2VjdXJpdHlAc3VzZS5kZT6JARUDBRA24S1H5Fiyh7HKPEUBAVcOB/9b
yHYji1/+4Xc2GhvXK0FSJN0MGgeXgW47yxDL7gmR4mNgjlIOUHZj0PEpVjWepOJ7
tQS3L9oP6cpj1Fj/XxuLbkp5VCQ61hpt54coQAvYrnT9rtWEGN+xmwejT1WmYmDJ
xG+EGBXKr+XP69oIUl1E2JO3rXeklulgjqRKos4cdXKgyjWZ7CP9V9daRXDtje63
Om8gwSdU/nCvhdRIWp/Vwbf7Ia8iZr9OJ5YuQl0DBG4qmGDDrvImgPAFkYFzwlqo
choXFQ9y0YVCV41DnR+GYhwl2qBd81T8aXhihEGPIgaw3g8gd8B5o6mPVgl+nJqI
BkEYGBusiag2pS6qwznZiQEVAwUQNuEtBHey5gA9JdPZAQFtOAf+KVh939b0J94u
v/kpg4xs1LthlhquhbHcKNoVTNspugiC3qMPyvSX4XcBr2PC0cVkS4Z9PY9iCfT+
x9WM96g39dAF+le2CCx7XISk9XXJ4ApEy5g4AuK7NYgAJd39PPbERgWnxjxir9g0
Ix30dS30bW39D+3NPU5Ho9TD/B7UDFvYT5AWHl3MGwo3a1RhTs6sfgL7yQ3U+mvq
MkTExZb5mfN1FeaYKMopoI4VpzNVeGxQWIz67VjJHVyUlF20ekOz4kWVgsxkc8G2
saqZd6yv2EwqYTi8BDAduweP33KrQc4KDDommQNDOXxaKOeCoESIdM4p7Esdjq1o
L0oixF12CohGBBARAgAGBQI7HmHDAAoJEJ5A4xAACqukTlQAoI4QzP9yjPohY7OU
F7J3eKBTzp25AJ42BmtSd3pvm5ldmognWF3Trhp+GYkAlQMFEDe3O8IWkDf+zvyS
FQEBAfkD/3GG5UgJj18UhYmh1gfjIlDcPAeqMwSytEHDENmHC+vlZQ/p0mT9tPiW
tp34io54mwr+bLPN8l6B5GJNkbGvH6M+mO7R8Lj4nHL6pyAv3PQr83WyLHcaX7It
Klj371/4yzKV6qpz43SGRK4MacLo2rNZ/dNej7lwPCtzCcFYwqkiiEYEEBECAAYF
AjoaQqQACgkQx1KqMrDf94ArewCfWnTUDG5gNYkmHG4bYL8fQcizyA4An2eVo/n+
3J2KRWSOhpAMsnMxtPbBmQGiBDnu9IERBACT8Y35+2vv4MGVKiLEMOl9GdST6MCk
YS3yEKeueNWc+z/0Kvff4JctBsgs47tjmiI9sl0eHjm3gTR8rItXMN6sJEUHWzDP
+Y0PFPboMvKx0FXl/A0dM+HFrruCgBlWt6FA+okRySQiliuI5phwqkXefl9AhkwR
8xocQSVCFxcwvwCglVcOQliHu8jwRQHxlRE0tkwQQI0D+wfQwKdvhDplxHJ5nf7U
8c/yE/vdvpN6lF0tmFrKXBUX+K7u4ifrZlQvj/81M4INjtXreqDiJtr99Rs6xa0S
cZqITuZC4CWxJa9GynBED3+D2t1V/f8l0smsuYoFOF7Ib49IkTdbtwAThlZp8bEh
ELBeGaPdNCcmfZ66rKUdG5sRA/9ovnc1krSQF2+sqB9/o7w5/q2qiyzwOSTnkjtB
UVKn4zLUOf6aeBAoV6NMCC3Kj9aZHfA+ND0ehPaVGJgjaVNFhPi4x0e7BULdvgOo
AqajLfvkURHAeSsxXIoEmyW/xC1sBbDkDUIBSx5oej73XCZgnj/inphRqGpsb+1n
KFvF+rQoU3VTRSBQYWNrYWdlIFNpZ25pbmcgS2V5IDxidWlsZEBzdXNlLmRlPohi
BBMRAgAiBQJA2AY+AhsDBQkObd+9BAsHAwIDFQIDAxYCAQIeAQIXgAAKCRCoTtro
nIAKypCfAJ9RuZ6ZSV7QW4pTgTIxQ+ABPp0sIwCffG9bCNnrETPlgOn+dGEkAWeg
KL+IRgQQEQIABgUCOnBeUgAKCRCeQOMQAAqrpNzOAKCL512FZvv4VZx94TpbA9lx
yoAejACeOO1HIbActAevk5MUBhNeLZa/qM2JARUDBRA6cGBvd7LmAD0l09kBATWn
B/9An5vfiUUE1VQnt+T/EYklES3tXXaJJp9pHMa4fzFa8jPVtv5UBHGee3XoUNDV
wM2OgSEISZxbzdXGnqIlcT08TzBUD9i579uifklLsnr35SJDZ6ram51/CWOnnaVh
UzneOA9gTPSr+/fT3WeVnwJiQCQ30kNLWVXWATMnsnT486eAOlT6UNBPYQLpUprF
5Yryk23pQUPAgJENDEqeU6iIO9Ot1ZPtB0lniw+/xCi13D360o1tZDYOp0hHHJN3
D3EN8C1yPqZd5CvvznYvB6bWBIpWcRgdn2DUVMmpU661jwqGlRz1F84JG/xe4jGu
zgpJt9IXSzyohEJB6XG5+D0BuQINBDnu9JIQCACEkdBN6Mxf5WvqDWkcMRy6wnrd
9DYJ8UUTmIT2iQf07tRUKJJ9v0JXfx2Z4d08IQSMNRaq4VgSe+PdYgIy0fbj23Vi
a5/gO7fJEpD2hd2f+pMnOWvH2rOOIbeYfuhzAc6BQjAKtmgR0ERUTafTM9Wb6F13
CNZZNZfDqnFDP6L12w3z3F7FFXkz07Rs3AIto1ZfYZd4sCSpMr/0S5nLrHbIvGLp
271hhQBeRmmoGEKO2JRelGgUJ2CUzOdtwDIKT0LbCpvaP8PVnYF5IFoYJIWRHqlE
t5ucTXstZy7vYjL6vTP4l5xs+LIOkNmPhqmfsgLzVo0UaLt80hOwc4NvDCOLAAMG
B/9g+9V3ORzw4LvO1pwRYJqfDKUq/EJ0rNMMD4N8RLpZRhKHKJUm9nNHLbksnlZw
rbSTM5LpC/U6sheLP+l0bLVoq0lmsCcUSyh+mY6PxWirLIWCn/IAZAGnXb6Zd6Tt
IJlGG6pqUN8QxGJYQnonl0uTJKHJENbI9sWHQdcTtBMc34gorHFCo1Bcvpnc1LFL
rWn7mfoGx6INQjf3HGQpMXAWuSBQhzkazY6vaWFpa8bBJ+gKbBuySWzNm3rFtT5H
RKMWpO+M9bHp4d+puY0L1YwN1OMatcMMpcWnZpiWiR83oi32+xtWUY2U7Ae38mMa
g8zFbpeqPQUsDv9V7CAJ1dbriEwEGBECAAwFAkDYBnoFCQ5t3+gACgkQqE7a6JyA
CspnpgCfRbYwxT3iq+9l/PgNTUNTZOlof2oAn25y0eGi0371jap9kOV6uq71sUuO
=ypVs
- -----END PGP PUBLIC KEY BLOCK-----
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.15 (GNU/Linux)
iQEVAwUBTMmFL3ey5gA9JdPZAQKMIwf/a34dO52kYoFPpU+2viYmqwpLbZlMBHWI
sNbf7WxfaDPs3h56B+4da9QJItPRB7p4J1+RicEEXqA8d4Y+pRnTpcTgriKes8vX
sL4gWGpTzi+mJoxEwSfsja/fbwtmW1lujmarnhWKbE1CuArFpccmzx/U+4UgK6rQ
YwNa3MHtoirJfIY5j4Ll6N5iycp13RR/drS34k2sZM9+bi/WabGJpEgfF7pDLrzG
2te2RNCuJbNO1OVb1Hefdx6Ods+cjNAff6FiZM/xCOhrV7wPn6HaOb5zbhUzTw3Y
Jz9yOxXVjts3tXpqIaRQQIgKjqXT6isK0UONpHu4bNZtye++VmVK8g==
=xSb/
-----END PGP SIGNATURE-----
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/FTLSHLX5ONFIBW3H2QBEV4KSNX7YANJL/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/FTLSHLX5ONFIBW3H2QBEV4KSNX7YANJL/#FTLSHLX5ONFIBW3H2QBEV4KSNX7YANJL)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from www.vupen.com_43fde3fd_20250125_063608.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61



=== Content from outflux.net_5d939fb3_20250126_064449.html ===

# [codeblog](https://outflux.net/blog/) code is freedom — patching my itch

## October 26, 2023

### [Enable MTE on Pixel 8](https://outflux.net/blog/archives/2023/10/26/enable-mte-on-pixel-8/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/) — kees @ 12:19 pm

The Pixel 8 hardware ([Tensor G3](https://www.androidpolice.com/google-tensor-g3/)) supports the ARM [Memory Tagging Extension (MTE)](https://source.android.com/docs/security/test/memory-safety/arm-mte), and software support is available both in Android userspace and the Linux kernel. This feature is a powerful defense against linear buffer overflows and many types of use-after-free flaws. I’m extremely happy to see this hardware finally available in the real world.

Turning it on for userspace is already wired up the Android UI: `Settings / System / Developer options / Memory Tagging Extension / Enable MTE until you turn if off`. Once enabled it will internally change an Android “system property” named “[`arm64.memtag.bootctl`](https://source.android.com/docs/security/test/memory-safety/bootloader-support)” by adding the option “`memtag`“.

Turning it on for the kernel is slightly more involved, but not difficult at all. This requires manually setting the “`arm64.memtag.bootctl`” property mentioned above to include “`memtag-kernel`” as well:

* Plug your phone into a system that can run the `adb` tool
* If not already installed, install `adb`. For example on Debian/Ubuntu: `sudo apt install adb`
* Turn on “USB Debugging” in the phone’s “Developer options” menu, and accept the debugging session confirmation that will pop up when you first run `adb`
* Verify the current setting: `adb shell getprop | grep memtag.bootctl`

`[arm64.memtag.bootctl]: [memtag]`

* Enable kernel MTE: `adb shell setprop arm64.memtag.bootctl memtag,memtag-kernel`
* Check the results: `adb shell getprop | grep memtag.bootctl`

`[arm64.memtag.bootctl]: [memtag,memtag-kernel]`

* Reboot your phone

To check that MTE is enabled for the kernel (which is implemented using [Kernel Address Sanitizer’s Hardware Tagging](https://docs.kernel.org/dev-tools/kasan.html#hardware-tag-based-kasan) mode), you can check the kernel command line after rebooting:

```

$ mkdir foo && cd foo
$ adb bugreport
...
$ mkdir unpacked && cd unpacked
$ unzip ../bugreport*.zip
...
$ grep kasan= bugreport*.txt
...: Command line: ... kasan=off ... kasan=on ...

```

The latter “`kasan=on`” overrides the earlier “`kasan=off`“.

Enjoy!

© 2023, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on Enable MTE on Pixel 8
## June 24, 2022

### [finding binary differences](https://outflux.net/blog/archives/2022/06/24/finding-binary-differences/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 1:11 pm

As part of the continuing work to [replace 1-element arrays in the Linux kernel](https://github.com/KSPP/linux/issues/79), it’s very handy to show that a source change has had no executable code difference. For example, if you started with this:

```

struct foo {
    unsigned long flags;
    u32 length;
    u32 data[1];
};

void foo_init(int count)
{
    struct foo *instance;
    size_t bytes = sizeof(*instance) + sizeof(u32) * (count - 1);
    ...
    instance = kmalloc(bytes, GFP_KERNEL);
    ...
};

```

And you changed only the struct definition:

```

-    u32 data[1];
+    u32 data[];

```

The `bytes` calculation is going to be incorrect, since it is still subtracting 1 element’s worth of space from the desired count. (And let’s ignore for the moment the open-coded calculation that may end up with an arithmetic over/underflow here; that can be solved separately by using the `struct_size()` helper or the `size_mul()`, `size_add()`, etc family of helpers.)

The missed adjustment to the size calculation is relatively easy to find in this example, but sometimes it’s much less obvious how structure sizes might be woven into the code. I’ve been checking for issues by using the fantastic [diffoscope](https://diffoscope.org/) tool. It can produce a LOT of noise if you try to compare builds without keeping in mind the issues solved by [reproducible builds](https://docs.kernel.org/kbuild/reproducible-builds.html), with some additional notes. I prepare my build with the “known to disrupt code layout” options disabled, but with debug info enabled:

```

$ KBF="KBUILD_BUILD_TIMESTAMP=1980-01-01 KBUILD_BUILD_USER=user KBUILD_BUILD_HOST=host KBUILD_BUILD_VERSION=1"
$ OUT=gcc
$ make $KBF O=$OUT allmodconfig
$ ./scripts/config --file $OUT/.config \
        -d GCOV_KERNEL -d KCOV -d GCC_PLUGINS -d IKHEADERS -d KASAN -d UBSAN \
        -d DEBUG_INFO_NONE -e DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT
$ make $KBF O=$OUT olddefconfig

```

Then I build a stock target, saving the output in “before”. In this case, I’m examining `drivers/scsi/megaraid/`:

```

$ make -jN $KBF O=$OUT drivers/scsi/megaraid/
$ mkdir -p $OUT/before
$ cp $OUT/drivers/scsi/megaraid/*.o $OUT/before/

```

Then I patch and build a modified target, saving the output in “after”:

```

$ vi the/source/code.c
$ make -jN $KBF O=$OUT drivers/scsi/megaraid/
$ mkdir -p $OUT/after
$ cp $OUT/drivers/scsi/megaraid/*.o $OUT/after/

```

And then run `diffoscope`:

```

$ diffoscope $OUT/before/ $OUT/after/

```

If `diffoscope` output reports nothing, then we’re done. 🥳

Usually, though, when source lines move around other stuff will shift too (e.g. `WARN` macros rely on line numbers, so the bug table may change contents a bit, etc), and `diffoscope` output will look noisy. To examine just the executable code, the command that `diffoscope` used is reported in the output, and we can run it directly, but with possibly shifted line numbers not reported. i.e. running `objdump` without `--line-numbers`:

```

$ ARGS="--disassemble --demangle --reloc --no-show-raw-insn --section=.text"
$ for i in $(cd $OUT/before && echo *.o); do
        echo $i
        diff -u <(objdump $ARGS $OUT/before/$i | sed "0,/^Disassembly/d") \
                <(objdump $ARGS $OUT/after/$i  | sed "0,/^Disassembly/d")
done

```

If I see an unexpected difference, for example:

```

-    c120:      movq   $0x0,0x800(%rbx)
+    c120:      movq   $0x0,0x7f8(%rbx)

```

Then I'll search for the pattern with line numbers added to the `objdump` output:

```

$ vi <(objdump --line-numbers $ARGS $OUT/after/megaraid_sas_fp.o)

```

I'd search for "0x0,0x7f8", find the source file and line number above it, open that source file at that position, and look to see where something was being miscalculated:

```

$ vi drivers/scsi/megaraid/megaraid_sas_fp.c +329

```

Once tracked down, I'd start over at the "patch and build a modified target" step above, repeating until there were no differences. For example, in the starting example, I'd also need to make this change:

```

-    size_t bytes = sizeof(*instance) + sizeof(u32) * (count - 1);
+    size_t bytes = sizeof(*instance) + sizeof(u32) * count;

```

Though, as hinted earlier, better yet would be:

```

-    size_t bytes = sizeof(*instance) + sizeof(u32) * (count - 1);
+    size_t bytes = struct_size(instance, data, count);

```

But sometimes adding the helper usage will add binary output differences since they're performing overflow checking that might saturate at `SIZE_MAX`. To help with patch clarity, those changes can be done separately from fixing the array declaration.

© 2022 - 2023, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on finding binary differences
## April 4, 2022

### [security things in Linux v5.10](https://outflux.net/blog/archives/2022/04/04/security-things-in-linux-v5-10/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 5:01 pm

Previously: [v5.9](/blog/archives/2021/04/05/security-things-in-linux-v5-9/)

Linux [v5.10 was released in December, 2020](https://lore.kernel.org/lkml/CAHk-%3DwhCKhxNyKn1Arut8xUDKTwp3fWcCj_jbL5dbzkUmo45gQ%40mail.gmail.com). Here’s my summary of various security things that I found interesting:

**AMD SEV-ES**

While guest VM memory encryption with AMD SEV has been supported for a while, Joerg Roedel, Thomas Lendacky, and others added [register state encryption (SEV-ES)](https://git.kernel.org/linus/da9803dfd3955bd2f9909d55e23f188ad76dbe58). This means it’s even harder for a VM host to reconstruct a guest VM’s state.

**x86 static calls**

Josh Poimboeuf and Peter Zijlstra implemented [static calls](https://git.kernel.org/linus/dd502a81077a5f3b3e19fa9a1accffdcab5ad5bc) for x86, which operates very similarly to the “static branch” infrastructure in the kernel. With static branches, an `if`/`else` choice can be hard-coded, instead of being run-time evaluated every time. Such branches can be updated too (the kernel just rewrites the code to switch around the “branch”). All these principles apply to static calls as well, but they’re for replacing indirect function calls (i.e. a call through a function pointer) with a direct call (i.e. a hard-coded call address). This eliminates the need for Spectre mitigations (e.g. RETPOLINE) for these indirect calls, and avoids a memory lookup for the pointer. For hot-path code (like the scheduler), this has a measurable performance impact. It also serves as a kind of Control Flow Integrity implementation: an indirect call got removed, and the potential destinations have been explicitly identified at compile-time.

**network RNG improvements**

In an effort to improve the pseudo-random number generator used by the network subsystem (for things like port numbers and packet sequence numbers), Linux’s home-grown [pRNG has been replaced by the SipHash round function](https://git.kernel.org/linus/c51f8f88d705e06bd696d7510aff22b33eb8e638), and [perturbed](https://git.kernel.org/linus/3744741adab6d9195551ce30e65e726c7a408421) by (hopefully) hard-to-predict internal kernel states. This should make it very hard to brute force the internal state of the pRNG and make predictions about future random numbers just from examining network traffic. Similarly, [ICMP’s global rate limiter](https://git.kernel.org/linus/b38e7819cae946e2edf869e604af1e65a5d241c5) was adjusted to avoid leaking details of network state, as a start to fixing recent [DNS Cache Poisoning](https://www.saddns.net/) attacks.

**SafeSetID handles GID**

Thomas Cedeno improved the [SafeSetID LSM](https://www.kernel.org/doc/html/latest/admin-guide/LSM/SafeSetID.html) to [handle group IDs](https://git.kernel.org/linus/5294bac97e12bdabbb97e9adf44d388612a700b8) (which required teaching the kernel about which syscalls were [actually performing setgid](https://git.kernel.org/linus/5294bac97e12bdabbb97e9adf44d388612a700b8).) Like the earlier [setuid policy](/blog/archives/2019/05/27/security-things-in-linux-v5-1/#v5.1-safesetid), this lets the system owner define an explicit list of allowed group ID transitions under `CAP_SETGID` (instead of to just any group), providing a way to keep the power of granting this capability much more limited. (This isn’t complete yet, though, since handling `setgroups()` is still needed.)

**improve kernel’s internal checking of file contents**

The kernel provides LSMs (like the Integrity subsystem) with details about files as they’re loaded. (For example, loading modules, new kernel images for kexec, and firmware.) There wasn’t very good coverage for cases where the contents were coming from things that weren’t files. To deal with this, [new hooks were added](https://git.kernel.org/linus/b64fcae74b6d6940d14243c963ab0089e8f0d82d) that allow the LSMs to introspect the contents directly, and to do partial reads. This will give the LSMs much finer grain visibility into these kinds of operations.

**set\_fs removal continues**

With the [earlier work](/blog/archives/2021/02/08/security-things-in-linux-v5-8/#v5.8-set_fs) landed to free the core kernel code from `set_fs()`, Christoph Hellwig made it possible for [set\_fs() to be optional for an architecture](https://git.kernel.org/linus/3c57fa13f6bf3906643034c57736c778ce63fa55). Subsequently, he then removed `set_fs()` entirely for [x86](https://git.kernel.org/linus/47058bb54b57962b3958a936ddbc59355e4c5504), [riscv](https://git.kernel.org/linus/e8d444d3e98c255f91d228984abc46cfdfaf48b4), and [powerpc](https://git.kernel.org/linus/5ae4998b5d6fc703a16c9fa935fb7d335843bf22). These architectures will now be free from the entire class of “kernel address limit” attacks that only needed to corrupt a single value in `struct thead_info`.

**sysfs\_emit() replaces sprintf() in /sys**

Joe Perches tackled one of the most common bug classes with `sprintf()` and `snprintf()` in `/sys` handlers by creating a new helper, [`sysfs_emit()`](https://git.kernel.org/linus/2efc459d06f1630001e3984854848a5647086232). This will handle the cases where kernel code was not correctly dealing with the length results from `sprintf()` calls, which might lead to buffer overflows in the `PAGE_SIZE` buffer that `/sys` handlers operate on. With the helper in place, it was possible to [start the refactoring](https://git.kernel.org/linus/aa838896d87af561a33ecefea1caa4c15a68bc47) of the many `sprintf()` callers.

**nosymfollow mount option**

Mattias Nissler and Ross Zwisler implemented the [`nosymfollow` mount option](https://git.kernel.org/linus/dab741e0e02bd3c4f5e2e97be74b39df2523fc6e). This entirely disables symlink resolution for the given filesystem, similar to other mount options where `noexec` disallows `execve()`, `nosuid` disallows setid bits, and `nodev` disallows device files. Quoting the patch, it is “useful as a defensive measure for systems that need to deal with untrusted file systems in privileged contexts.” (i.e. for when `/proc/sys/fs/protected_symlinks` isn’t a big enough hammer.) Chrome OS uses this option for its stateful filesystem, as symlink traversal as been a [common attack-persistence vector](https://sites.google.com/a/chromium.org/dev/chromium-os/chromiumos-design-docs/hardening-against-malicious-stateful-data#TOC-Restricting-symlink-traversal).

**ARMv8.5 Memory Tagging Extension support**

Vincenzo Frascino added support to arm64 for the coming Memory Tagging Extension, which will be available for ARMv8.5 and later chips. It provides 4 bits of tags (covering multiples of 16 byte spans of the address space). This is enough to deterministically eliminate all linear heap buffer overflow flaws (1 tag for “free”, and then rotate even values and odd values for neighboring allocations), which is probably one of the most common bugs being currently exploited. It also makes use-after-free and over/under indexing much more difficult for attackers (but still possible if the target’s tag bits can be exposed). Maybe some day we can switch to 128 bit virtual memory addresses and have fully versioned allocations. But for now, 16 tag values is better than none, though we do still need to wait for anyone to actually be shipping ARMv8.5 hardware.

**fixes for flaws found by UBSAN**

The work to make [UBSAN generally usable](/blog/archives/2020/09/21/security-things-in-linux-v5-7/#v5.7-array-bounds) under [syzkaller](https://syzkaller.appspot.com/upstream#open) continues to bear fruit, with various [fixes](https://git.kernel.org/linus/2c334e12f957) all over the kernel for stuff like [shift](https://git.kernel.org/linus/eb2667b34336)-out-of-[bounds](https://git.kernel.org/linus/0425e7badbdc), [divide-by-zero](https://git.kernel.org/linus/22f760941844), and [integer overflow](https://git.kernel.org/linus/cb47755725da). Seeing these kinds of patches land reinforces the the rationale of shifting the burden of these kinds of checks to the toolchain: these run-time bugs continue to pop up.

**flexible array conversions**

The work on [flexible array conversions](/blog/archives/2021/04/05/security-things-in-linux-v5-9/) continues. Gustavo A. R. Silva and others continued to grind on the [conversions](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.10&qt=grep&q=flex.*array), getting the kernel ever closer to being able to enable the `-Warray-bounds` compiler flag and clear the path for saner bounds checking of array indexes and `memcpy()` usage.

That’s it for now! Please let me know if you think anything else needs some attention. Next up is Linux v5.11.

© 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (4)](https://outflux.net/blog/archives/2022/04/04/security-things-in-linux-v5-10/#comments)
## April 5, 2021

### [security things in Linux v5.9](https://outflux.net/blog/archives/2021/04/05/security-things-in-linux-v5-9/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:24 pm

Previously: [v5.8](/blog/archives/2021/02/08/security-things-in-linux-v5-8/)

Linux [v5.9 was released in October, 2020](https://lore.kernel.org/lkml/CAHk-%3Dwi-u86%2B%2Bnp80GQvgDuARdt9xpBNho6SjHLmYgm8jibGag%40mail.gmail.com). Here’s my summary of various security things that I found interesting:

**seccomp user\_notif file descriptor injection**

Sargun Dhillon added the ability for `SECCOMP_RET_USER_NOTIF` filters to [inject file descriptors into the target process](https://git.kernel.org/linus/7cf97b12545503992020796c74bd84078eb39299) using `SECCOMP_IOCTL_NOTIF_ADDFD`. This lets container managers fully emulate syscalls like `open()` and `connect()`, where an actual file descriptor is expected to be available after a successful syscall. In the process I [fixed](https://git.kernel.org/linus/d9539752d23283db4692384a634034f451261e29) a couple [bugs](https://git.kernel.org/linus/4969f8a073977123504609d7310b42a588297aa4) and [refactored](https://git.kernel.org/linus/c0029de50982c1fb215330a5f9d433cec0cfd8cc) the file descriptor receiving code.

**zero-initialize stack variables with Clang**

When Alexander Potapenko landed support for Clang’s [automatic variable initialization](/blog/archives/2019/07/17/security-things-in-linux-v5-2/#v5.2-var-init), it did so with a byte pattern designed to really stand out in kernel crashes. Now he’s added support for doing [zero initialization](https://git.kernel.org/linus/f0fe00d4972a8cd4b98cc2c29758615e4d51cdfe) via `CONFIG_INIT_STACK_ALL_ZERO`, which besides actually being faster, has a few behavior benefits as well. “Unlike pattern initialization, which has a higher chance of triggering existing bugs, zero initialization provides safe defaults for strings, pointers, indexes, and sizes.” Like the pattern initialization, this feature stops entire classes of uninitialized stack variable flaws.

**common syscall entry/exit routines**

Thomas Gleixner created [architecture-independent code to do syscall entry/exit](https://git.kernel.org/linus/fc4177be963dccad73b98d7db3a8a38911f952b7), since much of the kernel’s work during a syscall entry and exit is the same. There was no need to repeat this in each architecture, and having it implemented separately meant bugs (or features) might only get fixed (or implemented) in a handful of architectures. It means that features like seccomp become much easier to build since it wouldn’t need per-architecture implementations any more. Presently only [x86 has switched over to the common routines](https://git.kernel.org/linus/27d6b4d14f5c3ab21c4aef87dd04055a2d7adf14).

**SLAB `kfree()` hardening**

To reach `CONFIG_SLAB_FREELIST_HARDENED` feature-parity with the SLUB heap allocator, I added [naive double-free detection](https://git.kernel.org/linus/dabc3e291d56e3125113101bc6d53d1a1738294d) and the ability to [detect cross-cache freeing](https://git.kernel.org/linus/3404be67bf73515babd74acd8525d09dafe4234d) in the SLAB allocator. This should keep a class of type-confusion bugs from biting kernels using SLAB. (Most distro kernels use SLUB, but some smaller devices prefer the slightly more compact SLAB, so this hardening is mostly aimed at those systems.)

**new `CAP_CHECKPOINT_RESTORE` capability**

Adrian Reber added the [new `CAP_CHECKPOINT_RESTORE` capability](https://git.kernel.org/linus/124ea650d3072b005457faed69909221c2905a1f), splitting this functionality off of `CAP_SYS_ADMIN`. The needs for the kernel to correctly checkpoint and restore a process (e.g. used to move processes between containers) continues to grow, and it became clear that the security implications were lower than those of `CAP_SYS_ADMIN` yet distinct from other capabilities. Using this capability is now the preferred method for doing things like [changing `/proc/self/exe`](https://git.kernel.org/linus/ebd6de6812387a2db9a52842cfbe004da1dd3be8).

**`debugfs` boot-time visibility restriction**

Peter Enderborg added the [`debugfs` boot parameter](https://git.kernel.org/linus/a24c6f7bc923d5e2f3139855eb09b0d480d6b410) to control the visibility of the kernel’s debug filesystem. The contents of debugfs continue to be a common area of sensitive information being exposed to attackers. While this was effectively possible by unsetting `CONFIG_DEBUG_FS`, that wasn’t a great approach for system builders needing a single set of kernel configs (e.g. a distro kernel), so now it can be disabled at boot time.

**more seccomp architecture support**

Michael Karcher implemented the [SuperH seccomp hooks](https://git.kernel.org/linus/0bb605c2c7f2b4b314b91510810b226de7f34fa1), Guo Ren implemented the [C-SKY seccomp hooks](https://git.kernel.org/linus/e95a4f8cb985e759648b32ed0b721a472deb86a5), and Max Filippov implemented the [xtensa seccomp hooks](https://git.kernel.org/linus/da94a40f72859ce24dc72de9292981513a33e427). Each of these included the ever-important updates to the seccomp regression testing suite in the kernel selftests.

**stack protector support for RISC-V**

Guo Ren implemented [`-fstack-protector` (and `-fstack-protector-strong`) support for RISC-V](https://git.kernel.org/linus/f2c9699f65557a31fed4ddb9e5b4d9489b1bf32f). This is the initial global-canary support while the patches to GCC to support per-task canaries is getting finished (similar to the per-task canaries done for arm64). This will mean nearly all stack frame write overflows are no longer useful to attackers on this architecture. It’s nice to see this finally land for RISC-V, which is quickly approaching architecture feature parity with the other major architectures in the kernel.

**new `tasklet` API**

Romain Perier and Allen Pais [introduced a new `tasklet` API](https://git.kernel.org/linus/12cc923f1ccc1df467e046b02a72c2b3b321b6a2) to make their use safer. Much like the [`timer_list` refactoring](/blog/archives/2018/02/05/security-things-in-linux-v4-15/#v4.15-timer_list) work done earlier, the `tasklet` API is also a potential source of simple function-pointer-and-first-argument controlled exploits via linear heap overwrites. It’s a smaller attack surface since it’s used much less in the kernel, but it is the same weak design, making it a sensible thing to replace. While the use of the `tasklet` API is [considered deprecated](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/interrupt.h?h=v5.9#n588) (replaced by [threaded IRQs](https://lore.kernel.org/lkml/20200716081538.2sivhkj4hcyrusem%40linutronix.de)), it’s not always a simple mechanical refactoring, so the old API still needs refactoring (since that CAN be done mechanically is most cases).

**x86 `FSGSBASE` implementation**

Sasha Levin, Andy Lutomirski, Chang S. Bae, Andi Kleen, Tony Luck, Thomas Gleixner, and others landed the long-awaited [`FSGSBASE` series](https://git.kernel.org/linus/4da9f3302615f4191814f826054846bf843e24fa). This provides task switching performance improvements while keeping the kernel safe from modules accidentally (or maliciously) trying to use the features directly (which exposed an [unprivileged direct kernel access hole](https://lwn.net/Articles/821723/)).

**filter x86 MSR writes**

While it’s been long understood that writing to CPU Model-Specific Registers (MSRs) from userspace was a [bad idea](https://lore.kernel.org/lkml/20130208191213.GA25081%40www.outflux.net/), it has been left enabled for things like [`MSR_IA32_ENERGY_PERF_BIAS`](http://manpages.ubuntu.com/manpages/xenial/man8/x86_energy_perf_policy.8.html). Boris Petkov has decided enough is enough and has now enabled logging and kernel tainting (`TAINT_CPU_OUT_OF_SPEC`) by default and a way to [disable MSR writes](https://git.kernel.org/linus/a7e1f67ed29f0c339e2aa7483d13b085127566ab) at runtime. (However, since this is controlled by a normal module parameter and the root user can just turn writes back on, I continue to recommend that people build with `CONFIG_X86_MSR=n`.) The expectation is that userspace MSR writes will be entirely removed in future kernels.

**`uninitialized_var()` macro removed**

I made [treewide changes](https://git.kernel.org/linus/3f649ab728cda8038259d8f14492fe400fbab911) to [remove the `uninitialized_var()` macro](https://git.kernel.org/linus/63a0895d960aa3d3653ef0ecad5bd8579388f14b), which had been used to silence compiler warnings. The rationale for this macro was weak to begin with (“the compiler is reporting an uninitialized variable that is clearly initialized”) since it was mainly papering over compiler bugs. However, it creates a much more fragile situation in the kernel since now such uses can actually [disable automatic stack variable initialization](https://lore.kernel.org/lkml/20200603174714.192027-1-glider%40google.com/), as well as mask legitimate “unused variable” warnings. The proper solution is to just initialize variables the compiler warns about.

**function pointer cast removals**

Oscar Carter has started [removing](https://git.kernel.org/linus/5cdfbdce5de6b5b56e104676409762fc1289a9c2) function pointer [casts](https://git.kernel.org/linus/875102ea4b7700330a33c0db71555d91dafa9c82) from the kernel, in an effort to allow the kernel to build with `-Wcast-function-type`. The future use of Control Flow Integrity checking (which does validation of function prototypes matching between the caller and the target) tends not to work well with function casts, so it’d be [nice to get rid of these](https://github.com/KSPP/linux/issues/20) before CFI lands.

**flexible array conversions**

As part of Gustavo A. R. Silva’s [on-going work](/blog/archives/2021/02/08/security-things-in-linux-v5-8/#v5.8-flex-array) to replace [zero-length](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.9&qt=grep&q=zero-length+array) and [one-element](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.9&qt=grep&q=one-element+array) arrays with flexible arrays, he has [documented the details of the flexible array conversions](https://git.kernel.org/linus/68e4cd17e218971a2fd60c30fe14078dc0d8a68e), and the [various helpers](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.9&qt=grep&q=flex_array_size) to be used in kernel code. Every commit gets the kernel closer to building with `-Warray-bounds`, which catches a lot of potential buffer overflows at compile time.

That’s it for now! Please let me know if you think anything else needs some attention. Next up is Linux [v5.10](/blog/archives/2022/04/04/security-things-in-linux-v5-10/).

© 2021 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (3)](https://outflux.net/blog/archives/2021/04/05/security-things-in-linux-v5-9/#comments)
## February 8, 2021

### [security things in Linux v5.8](https://outflux.net/blog/archives/2021/02/08/security-things-in-linux-v5-8/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:47 pm

Previously: [v5.7](/blog/archives/2020/09/21/security-things-in-linux-v5-7/)

Linux [v5.8 was released in August, 2020](https://lore.kernel.org/lkml/CAHk-%3Dwj%2BmDPbj8hXspXRAksh%2B1TmPjubc9RNEbu8EVpYyypX%3Dw%40mail.gmail.com). Here’s my summary of various security things that caught my attention:

**arm64 Branch Target Identification**

Dave Martin [added support for ARMv8.5’s Branch Target Instructions](https://git.kernel.org/linus/8ef8f360cf30be12382f89ff48a57fbbd9b31c14) ([BTI](https://developer.arm.com/architectures/learn-the-architecture/providing-protection-for-complex-software/single-page)), which are enabled in [userspace at execve()](https://git.kernel.org/linus/ab7876a98a2160092133de4c648e94b18bc3f139) time, and all the time [in the kernel](https://git.kernel.org/linus/92e2294d870bc9e77592c2454f565c3bd6bb79ad) (which required manually marking up a lot of non-C code, like assembly and [JIT code](https://git.kernel.org/linus/fa76cfe65c1d748ef418e930a4b631a03b28f04c)).

With this in place, Jump-Oriented Programming (JOP, where code gadgets are chained together with jumps and calls) is no longer available to the attacker. An attacker’s code must make direct function calls. This basically reduces the “usable” code available to an attacker from every word in the kernel text to only function entries (or jump targets). This is a “low granularity” forward-edge Control Flow Integrity (CFI) feature, which is important (since it greatly reduces the potential targets that can be used in an attack) and cheap (implemented in hardware). It’s a good first step to strong CFI, but (as we’ve seen with things like CFG) it isn’t usually strong enough to stop a motivated attacker. “High granularity” CFI (which uses a more specific branch-target characteristic, like function prototypes, to track expected call sites) is not yet a hardware supported feature, but the software version will be coming in the future by way of [Clang’s CFI implementation](https://github.com/samitolvanen/linux/commits/clang-cfi).

**arm64 Shadow Call Stack**

Sami Tolvanen landed the [kernel implementation of Clang’s Shadow Call Stack](https://git.kernel.org/linus/5287569a790d2546a06db07e391bf84b8bd6cf51) ([SCS](https://clang.llvm.org/docs/ShadowCallStack.html)), which protects the kernel against Return-Oriented Programming (ROP) attacks (where code gadgets are chained together with returns). This backward-edge CFI protection is implemented by keeping a second dedicated stack pointer register (`x18`) and keeping a copy of the return addresses stored in a separate “shadow stack”. In this way, manipulating the regular stack’s return addresses will have no effect. (And since a copy of the return address continues to live in the regular stack, no changes are needed for back trace dumps, etc.)

It’s worth noting that unlike BTI (which is hardware based), this is a software defense that relies on the location of the Shadow Stack (i.e. the value of `x18`) staying secret, since the memory could be written to directly. Intel’s hardware ROP defense (CET) uses a hardware shadow stack that isn’t directly writable. ARM’s hardware defense against ROP is [PAC](/blog/archives/2020/09/21/security-things-in-linux-v5-7/#v5.7-pac) (which is actually designed as an arbitrary CFI defense — it can be used for forward-edge too), but that depends on having ARMv8.3 hardware. The expectation is that SCS will be used until PAC is available.

**Kernel Concurrency Sanitizer infrastructure added**

Marco Elver landed support for the [Kernel Concurrency Sanitizer](https://git.kernel.org/linus/dfd402a4c4baae42398ce9180ff424d589b8bffc), which is a new debugging infrastructure to find data races in the kernel, via `CONFIG_KCSAN`. This immediately found real bugs, with some fixes having [already](https://git.kernel.org/linus/d6c1f098f2a7ba62627c9bc17cda28f534ef9e4a) [landed](https://git.kernel.org/linus/68ace460c5b2a96a82ee49ab0b589ceed8abd000) too. For more details, see the [KCSAN documentation](https://www.kernel.org/doc/html/latest/dev-tools/kcsan.html).

**new capabilities**

Alexey Budankov [added `CAP_PERFMON`](https://git.kernel.org/linus/980737282232b752bb14dab96d77665c15889c36/), which is designed to allow access to `perf()`. The idea is that this capability gives a process access to only read aspects of the running kernel and system. No longer will access be needed through the much more powerful abilities of `CAP_SYS_ADMIN`, which has many ways to change kernel internals. This allows for a split between controls over the confidentiality (read access via CAP\_PERFMON) of the kernel vs control over integrity (write access via CAP\_SYS\_ADMIN).

Alexei Starovoitov [added `CAP_BPF`](https://git.kernel.org/linus/a17b53c4a4b55ec322c132b6670743612229ee9c/), which is designed to separate BPF access from the all-powerful `CAP_SYS_ADMIN`. It is designed to be used in combination with `CAP_PERFMON` for tracing-like activities and `CAP_NET_ADMIN` for networking-related activities. For things that could change kernel integrity (i.e. write access), `CAP_SYS_ADMIN` is still required.

**network random number generator improvements**

Willy Tarreau made the [network code’s random number generator less predictable](https://git.kernel.org/linus/f227e3ec3b5cad859ad15666874405e8c1bbc1d4). This will further frustrate any attacker’s attempts to recover the state of the RNG externally, which might lead to the ability to hijack network sessions (by correctly guessing packet states).

**fix various kernel address exposures to non-`CAP_SYSLOG`**

I fixed several situations where kernel addresses were still being exposed to unprivileged (i.e. non-`CAP_SYSLOG`) users, though usually only through odd corner cases. After [refactoring how capabilities were being checked](https://git.kernel.org/linus/60f7bb66b88b649433bf700acfc60c3f24953871) for files in `/sys` and `/proc`, the [kernel modules sections](https://git.kernel.org/linus/b25a7c5af9051850d4f3d93ca500056ab6ec724b), [kprobes](https://git.kernel.org/linus/60f7bb66b88b649433bf700acfc60c3f24953871), and [BPF](https://git.kernel.org/linus/63960260457a02af2a6cb35d75e6bdb17299c882) exposures got fixed. (Though in doing so, I briefly made things much worse before getting it [properly fixed](https://git.kernel.org/linus/11990a5bd7e558e9203c1070fc52fb6f0488e75b). Yikes!)

**RISCV W^X detection**

Following up on his recent work to [enable strict kernel memory protections on RISCV](/blog/archives/2020/09/21/security-things-in-linux-v5-7/#v5.7-wx-riscv), Zong Li has now added [support for `CONFIG_DEBUG_WX`](https://git.kernel.org/linus/b422d28b21773bbfc9e84dbb5579a8ce355279ca) as seen for other architectures. Any writable and executable memory regions in the kernel (which are lovely targets for attackers) will be loudly noted at boot so they can get corrected.

**`execve()` refactoring continues**

Eric W. Biederman continued working on [`execve()` refactoring](https://git.kernel.org/linus/56305aa9b6fab91a5555a45796b79c1b0a6353d1), including getting rid of the [frequently problematic recursion](https://git.kernel.org/linus/bc2bf338d54b7aadaed49bb45b9e10d4592b2a46) used to locate binary handlers. I used the opportunity to dust off some old [`binfmt_script` regression tests](https://git.kernel.org/linus/b081320f0693cce0394f7c8bad9fba0b25982186) and get them into the kernel selftests.

**multiple `/proc` instances**

Alexey Gladkov modernized `/proc` internals and provided a way to have [multiple `/proc` instances](https://git.kernel.org/linus/fa10fed30f2550313a8284365b3e2398526eb42c) mounted in the same PID namespace. This allows for having multiple views of `/proc`, with different features enabled. (Including the newly added [hidepid=4](https://git.kernel.org/linus/24a71ce5c47f6b1b3cdacf544cb24220f5c3b7ef) and [subset=pid](https://git.kernel.org/linus/6814ef2d992af09451bbeda4770daa204461329e) mount [options](https://www.kernel.org/doc/html/latest/filesystems/proc.html#mount-options).)

**`set_fs()` removal continues**

Christoph Hellwig, with Eric W. Biederman, Arnd Bergmann, and others, have been diligently working to entirely remove the kernel’s `set_fs()` interface, which has long been a source of security flaws due to weird confusions about which address space the kernel thought it should be accessing. Beyond things like the lower-level per-architecture [signal handling](https://git.kernel.org/linus/c3b3f52476412a3899f2c65b220075aceb18dd2c) code, this has needed to touch various [parts](https://git.kernel.org/linus/fa4751f454e6b51ef93babfd8b6c8b43a65c9db2) of the [ELF](https://git.kernel.org/linus/d2530b436f114dfbd1adc70c59d8d31038318726) loader, and [networking](https://git.kernel.org/linus/1f466e1f15cf1dac7c86798d694649fc42cd868a) code too.

**`READ_IMPLIES_EXEC` is no more for native 64-bit**

The `READ_IMPLIES_EXEC` flag was a work-around for dealing with the addition of non-executable (NX) memory when x86\_64 was introduced. It was designed as a way to mark a memory region as “well, since we don’t know if this memory region was expected to be executable, we must assume that if we need to read it, we need to be allowed to execute it too”. It was designed mostly for stack memory (where trampoline code might live), but it would carry over into all `mmap()` allocations, which would mean sometimes exposing a large attack surface to an attacker looking to find executable memory. While normally this didn’t cause problems on modern systems that correctly marked their ELF sections as NX, there were still some awkward corner-cases. I fixed this by splitting `READ_IMPLIES_EXEC` from the ELF `PT_GNU_STACK` marking on [x86](https://git.kernel.org/linus/122306117afe4ba202b5e57c61dfbeffc5c41387) and [arm/arm64](https://git.kernel.org/linus/eaf3f9e61887332d5097dbf0b327b8377546adc5), and declaring that a native 64-bit process would never gain `READ_IMPLIES_EXEC` on [x86\_64](https://git.kernel.org/linus/9fccc5c0c99f238aa1b0460fccbdb30a887e7036) and [arm64](https://git.kernel.org/linus/6e0d6ac5f3d9d90271899f6d340872360fe1caee), which matches the behavior of other native 64-bit architectures that correctly didn’t ever implement `READ_IMPLIES_EXEC` in the first place.

**array index bounds checking continues**

As part of the ongoing work to use modern flexible arrays in the kernel, Gustavo A. R. Silva added the [`flex_array_size()` helper](https://git.kernel.org/linus/b19d57d0f3cc6f1022edf94daf1d70506a09e3c2) (as a cousin to `struct_size()`). The [zero/one-member into flex array conversions](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.8&qt=grep&q=with+flexible-array) continue with over a hundred commits as we slowly get closer to being able to build with `-Warray-bounds`.

**`scnprintf()` replacement continues**

Chen Zhou joined Takashi Iwai in [continuing](/blog/archives/2020/09/21/security-things-in-linux-v5-7/#v5.7-scnprintf) to replace potentially unsafe uses of `sprintf()` with `scnprintf()`. Fixing all of these will make sure the kernel avoids nasty buffer concatenation surprises.

That’s it for now! Let me know if there is anything else you think I should mention here. Next up: Linux [v5.9](/blog/archives/2021/04/05/security-things-in-linux-v5-9/).

© 2021 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v5.8
## October 30, 2020

### [combining “apt install” and “get dist-upgrade”?](https://outflux.net/blog/archives/2020/10/30/combining-apt-install-and-get-dist-upgrade/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 12:07 pm

I frequently see a pattern in image build/refresh scripts where a set of packages is installed, and then all packages are updated:

```

apt update
apt install -y pkg1 pkg2 pkg2
apt dist-upgrade -y

```

While it’s not much, this results in redundant work. For example reading/writing package database, potentially running triggers (man-page refresh, ldconfig, etc). The internal package dependency resolution stuff isn’t actually different: “install” will also do upgrades of needed packages, etc. Combining them should be entirely possible, but I haven’t found a clean way to do this yet.

The best I’ve got so far is:

```

apt update
apt-cache dumpavail | dpkg --merge-avail -
(for i in pkg1 pkg2 pkg3; do echo "$i install") | dpkg --set-selections
apt-get dselect-upgrade

```

This gets me the effect of running “install” and “upgrade” at the same time, but not “dist-upgrade” (which has slightly different resolution logic that’d I’d prefer to use). Also, it includes the overhead of what should be an unnecessary update of dpkg’s database. Anyone know a better way to do this?

**Update**: [Julian Andres Klode pointed out that `dist-upgrade` actually takes package arguments too](https://mobile.twitter.com/JulianKlode/status/1322294691430281218) just like `install`. \*face palm\* I didn’t even try it — I believed the man-page and the `-h` output. It works perfectly!

© 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on combining “apt install” and “get dist-upgrade”?
## September 21, 2020

### [security things in Linux v5.7](https://outflux.net/blog/archives/2020/09/21/security-things-in-linux-v5-7/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:32 pm

Previously: [v5.6](/blog/archives/2020/09/02/security-things-in-linux-v5-6/)

Linux [v5.7 was released at the end of May](https://lore.kernel.org/lkml/CAHk-%3DwiZGrCkiBB1V7bxp8NZH6yWi9mPM4ptMW16OzOiNprBFA%40mail.gmail.com). Here’s my summary of various security things that caught my attention:

**arm64 kernel pointer authentication**

While the ARMv8.3 CPU “Pointer Authentication” (PAC) feature [landed for userspace already](/blog/archives/2019/03/12/security-things-in-linux-v5-0/), Kristina Martsenko has now [landed PAC support in kernel mode](https://git.kernel.org/linus/74afda4016a7437e6e425c3370e4b93b47be8ddf). The current implementation uses `PACIASP` which protects the saved stack pointer, similar to the existing `CONFIG_STACKPROTECTOR` feature, only faster. This also paves the way to sign and check pointers stored in the heap, as a way to defeat function pointer overwrites in those memory regions too. Since the behavior is different from the traditional stack protector, Amit Daniel Kachhap added an [LKDTM test for PAC](https://git.kernel.org/linus/6cb6982f42cbfaf5e50af1069451a8828231ffb9) as well.

**BPF LSM**

The kernel’s Linux Security Module (LSM) API provide a way to write security modules that have traditionally implemented various Mandatory Access Control (MAC) systems like SELinux, AppArmor, etc. The LSM hooks are numerous and no one LSM uses them all, as some hooks are much more specialized (like those used by IMA, Yama, LoadPin, etc). There was not, however, any way to externally attach to these hooks (not even through a regular loadable kernel module) nor build fully dynamic security policy, until KP Singh landed the API for [building LSM policy using BPF](https://git.kernel.org/linus/4dece7f3b9258e812795443b4bf64ff9454a0411). With `CONFIG_BPF_LSM=y`, it is possible (for a privileged process) to write kernel LSM hooks in BPF, allowing for totally custom security policy (and reporting).

**`execve()` deadlock refactoring**

There have been a number of long-standing races in the kernel’s process launching code where ptrace could deadlock. Fixing these has been attempted several times over the last many years, but Eric W. Biederman and Ernd Edlinger decided to dive in, and successfully landed the a series of refactorings, [splitting up the problematic locking](https://git.kernel.org/linus/eea9673250db4e854e9998ef9da6d4584857f0ea) and refactoring their uses to [remove the deadlocks](https://git.kernel.org/linus/3e74fabd39710ee29fa25618d2c2b40cfa7d76c7). While he was at it, Eric also [extended the `exec_id` counter to 64 bits](https://git.kernel.org/linus/d1e7fd6462ca9fc76650fbe6ca800e35b24267da) to avoid the possibility of the counter wrapping and allowing an attacker to send arbitrary signals to processes they normally shouldn’t be able to.

**slub freelist obfuscation improvements**

After Silvio Cesare observed some weaknesses in the implementation of `CONFIG_SLAB_FREELIST_HARDENED`‘s freelist pointer content obfuscation, I [improved their bit diffusion](https://git.kernel.org/linus/1ad53d9fa3f6168ebcf48a50e08b170432da2257), which makes attacks require significantly more memory content exposures to defeat the obfuscation. As part of the conversation, Vitaly Nikolenko pointed out that the freelist pointer’s *location* made it relatively easy to target too (for either disclosures or overwrites), so I [moved it away from the edge of the slab](https://git.kernel.org/linus/3202fa62fb43087387c65bfa9c100feffac74aa6), making it harder to reach through small-sized overflows (which usually target the freelist pointer). As it turns out, there were a few assumptions in the kernel about the location of the freelist pointer, which had to also get [cleaned](https://git.kernel.org/linus/cbfc35a48609ceac978791e3ab9dde0c01f8cb20) [up](https://git.kernel.org/linus/89b83f282d8ba380cf2124f88106c57df49c538c).

**RISCV strict kernel memory protections**

Zong Li [implemented `STRICT_KERNEL_RWX` support for RISCV](https://git.kernel.org/linus/d27c3c90817e4c5ea655714065a725b4abd576f9). And to validate the results, following v5.6’s [generic page table dumping work](/blog/archives/2020/09/02/security-things-in-linux-v5-6/), he landed the [RISCV page dumping code](https://git.kernel.org/linus/59c4da8640ccf4721d54d36835706f3eefb521a4). This means it’s much easier to examine the kernel’s page table layout when running a debug kernel (built with `PTDUMP_DEBUGFS`), visible in `/sys/kernel/debug/kernel_page_tables`.

**array index bounds checking**

This is a pretty large area of work that touches a lot of overlapping elements (and history) in the Linux kernel. The short version is: C is bad at noticing when it uses an array index beyond the bounds of the declared array, and we need to fix that. For example, don’t do this:

```

int foo[5];
...
foo[8] = bar;

```

The long version gets complicated by the evolution of [“flexible array” structure members](https://en.wikipedia.org/wiki/Flexible_array_member), so we’ll pause for a moment and skim the surface of this topic. While things like `CONFIG_FORTIFY_SOURCE` try to catch these kinds of cases in the `memcpy()` and `strcpy()` family of functions, it doesn’t catch it in open-coded array indexing, as seen in the code above. GCC has a warning (`-Warray-bounds`) for these cases, but it was [disabled by Linus](https://git.kernel.org/linus/44720996e2d79e47d508b0abe99b931a726a3197) because of all the false positives seen due to “fake” flexible array members. Before flexible arrays were standardized, GNU C supported “zero sized” array members. And before that, C code would use a 1-element array. These were all designed so that some structure could be the “header” in front of some data blob that could be addressable through the last structure member:

```

/* 1-element array */
struct foo {
    ...
    char contents[1];
};

/* GNU C extension: 0-element array */
struct foo {
    ...
    char contents[0];
};

/* C standard: flexible array */
struct foo {
    ...
    char contents[];
};

instance = kmalloc(sizeof(struct foo) + content_size);

```

Converting all the zero- and one-element array members to flexible arrays is one of Gustavo A. R. Silva’s goals, and [hundreds of these changes started landing](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.7&qt=grep&q=flexible+array). Once fixed, `-Warray-bounds` can be re-enabled. Much more detail can be found in the kernel’s [deprecation](https://www.kernel.org/doc/html/latest/process/deprecated.html#zero-length-and-one-element-arrays) docs.

However, that will only catch the “visible at compile time” cases. For runtime checking, the Undefined Behavior Sanitizer has an option for adding runtime array bounds checking for catching things like this where the compiler cannot perform a static analysis of the index values:

```

int foo[5];
...
for (i = 0; i < some_argument; i++) {
    ...
    foo[i] = bar;
    ...
}

```

It was, however, not separate (via kernel Kconfig) until Elena Petrova and I [split it out into `CONFIG_UBSAN_BOUNDS`](https://git.kernel.org/linus/277a10850f9f4cb3429faf59293e2c89b1a320be), which is fast enough for production kernel use. With this enabled, it's now possible to instrument the kernel to catch these conditions, which seem to come up with some regularity in Wi-Fi and Bluetooth drivers for some reason. Since UBSAN (and the other Sanitizers) only `WARN()` by default, system owners need to set `panic_on_warn=1` too if they want to defend against attacks targeting these kinds of flaws. Because of this, and to avoid bloating the kernel image with all the warning messages, I [introduced `CONFIG_UBSAN_TRAP`](https://git.kernel.org/linus/0887a7ebc97770c7870abf3075a2e8cd502a7f52) which effectively turns these conditions into a `BUG()` without needing additional sysctl settings.

**Fixing "additive" `snprintf()` usage**

A common idiom in C for building up strings is to use `sprintf()`'s return value to increment a pointer into a string, and build a string with more `sprintf()` calls:

```

/* safe if strlen(foo) + 1 < sizeof(string) */
wrote  = sprintf(string, "Foo: %s\n", foo);
/* overflows if strlen(foo) + strlen(bar) > sizeof(string) */
wrote += sprintf(string + wrote, "Bar: %s\n", bar);
/* writing way beyond the end of "string" now ... */
wrote += sprintf(string + wrote, "Baz: %s\n", baz);

```

The risk is that if these calls eventually walk off the end of the `string` buffer, it will start writing into other memory and create some bad situations. Switching these to `snprintf()` does not, however, make anything safer, since `snprintf()` returns how much it *would* have written:

```

/* safe, assuming available <= sizeof(string), and for this example
 * assume strlen(foo) < sizeof(string) */
wrote  = snprintf(string, available, "Foo: %s\n", foo);
/* if (strlen(bar) > available - wrote), this is still safe since the
 * write into "string" will be truncated, but now "wrote" has been
 * incremented by how much snprintf() *would* have written, so "wrote"
 * is now larger than "available". */
wrote += snprintf(string + wrote, available - wrote, "Bar: %s\n", bar);
/* string + wrote is beyond the end of string, and availabe - wrote wraps
 * around to a giant positive value, making the write effectively
 * unbounded. */
wrote += snprintf(string + wrote, available - wrote, "Baz: %s\n", baz);

```

So while the first overflowing call would be safe, the next one would be targeting beyond the end of the array and the size calculation will have wrapped around to a giant limit. Replacing this idiom with `scnprintf()` solves the issue because it only reports what was *actually* written. To this end, Takashi Iwai has been [landing a bunch scnprintf() fixes](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.7&qt=grep&q=Use+scnprintf).

That's it for now! Let me know if there is anything else you think I should mention here. Next up: Linux [v5.8](/blog/archives/2021/02/08/security-things-in-linux-v5-8/).

© 2020 - 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v5.7
## September 2, 2020

### [security things in Linux v5.6](https://outflux.net/blog/archives/2020/09/02/security-things-in-linux-v5-6/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:22 pm

Previously: [v5.5](/blog/archives/2020/05/27/security-things-in-linux-v5-5/).

Linux [v5.6 was released back in March](https://lore.kernel.org/lkml/CAHk-%3Dwi9ZT7Stg-uSpX0UWQzam6OP9Jzz6Xu1CkYu1cicpD5OA%40mail.gmail.com/). Here’s my quick summary of various features that caught my attention:

**WireGuard**

The widely used [WireGuard VPN](https://www.wireguard.com/) has been out-of-tree for a very long time. After 3 1/2 years since its initial [upstream RFC](https://lore.kernel.org/lkml/CAHmME9q-6ioctzcB8gLdYOsMFqHVGY8GUsVGFisKv%3DwGdVqi2A%40mail.gmail.com/), Ard Biesheuvel and Jason Donenfeld finished the work getting all the [crypto prerequisites sorted out](https://lore.kernel.org/linux-crypto/20191108122240.28479-1-ardb%40kernel.org/) for the v5.5 kernel. For this release, Jason has gotten [WireGuard itself landed](https://git.kernel.org/linus/e7096c131e5161fa3b8e52a650d7719d2857adfd). It was a twisty road, and I’m grateful to everyone involved for sticking it out and navigating the compromises and alternative solutions.

**`openat2()` syscall and `RESOLVE_*` flags**

Aleksa Sarai has added a number of important path resolution “scoping” options to the kernel’s `open()` handling, covering things like not walking above a specific point in a path hierarchy ([`RESOLVE_BENEATH`](https://git.kernel.org/linus/adb21d2b526f7f196b2f3fdca97d80ba05dd14a0)), disabling the resolution of various “magic links” ([`RESOLVE_NO_MAGICLINKS`](https://git.kernel.org/linus/4b99d4996979d582859c5a49072e92de124bf691)) in procfs (e.g. `/proc/$pid/exe`) and other pseudo-filesystems, and treating a given lookup as happening relative to a different root directory (as if it were in a chroot, [`RESOLVE_IN_ROOT`](https://git.kernel.org/linus/8db52c7e7ee1bd861b6096fcafc0fe7d0f24a994)). As part of this, it became clear that there wasn’t a way to correctly extend the existing `openat()` syscall, so he [added `openat2()`](https://git.kernel.org/linus/fddb5d430ad9fa91b49b1d34d0202ffe2fa0e179) (which is a good example of the efforts being made to codify [“Extensible Syscall” arguments](https://lwn.net/Articles/822256/)). The `RESOLVE_*` set of flags also cover prior behaviors like `RESOLVE_NO_XDEV` and `RESOLVE_NO_SYMLINKS`.

**`pidfd_getfd()` syscall**

In the continuing growth of the much-needed pidfd APIs, Sargun Dhillon has added the [`pidfd_getfd()` syscall](https://git.kernel.org/linus/8649c322f75c96e7ced2fec201e123b2b073bf09) which is a way to gain access to file descriptors of a process in a race-less way (or when `/proc` is not mounted). Before, it wasn’t always possible make sure that opening file descriptors via `/proc/$pid/fd/$N` was actually going to be associated with the correct PID. Much more detail about this has been [written up at LWN](https://lwn.net/Articles/808997/).

**`openat()` via io\_uring**

With my “attack surface reduction” hat on, I remain personally suspicious of the `io_uring()` family of APIs, but I can’t deny their utility for certain kinds of workloads. Being able to pipeline reads and writes without the overhead of actually making syscalls is pretty great for performance. Jens Axboe has [added the IORING\_OP\_OPENAT command](https://git.kernel.org/linus/15b71abe7b52df214785dde0de9f581cc0216d17) so that existing io\_urings can open files to be added on the fly to the mapping of available read/write targets of a given io\_uring. While LSMs are still happily able to intercept these actions, I remain wary of the growing “syscall multiplexer” that io\_uring is becoming. I am, of course, glad to see that it has a comprehensive (if “out of tree”) [test suite as part of `liburing`](https://github.com/axboe/liburing/tree/master/test).

**removal of blocking random pool**

After making algorithmic changes to obviate separate entropy pools for random numbers, Andy Lutomirski [removed the blocking random pool](https://git.kernel.org/linus/90ea1c6436d26e62496616fb5891e00819ff4849). This simplifies the kernel pRNG code significantly without compromising the userspace interfaces designed to fetch “cryptographically secure” random numbers. To quote Andy, “This series should not break any existing programs. `/dev/urandom` is unchanged. `/dev/random` will still block just after booting, but it will block less than it used to.” See LWN for more details on the [history and discussion of the series](https://lwn.net/Articles/808575/).

**arm64 support for on-chip RNG**

Mark Brown added [support for the future ARMv8.5’s RNG](https://git.kernel.org/linus/2e8e1ea88cbcb19a77b7acb67f6ffe39cc15740c) (`SYS_RNDR_EL0`), which is, from the kernel’s perspective, similar to x86’s `RDRAND` instruction. This will provide a bootloader-independent way to add entropy to the kernel’s pRNG for early boot randomness (e.g. stack canary values, memory ASLR offsets, etc). Until folks are running on ARMv8.5 systems, they can continue to depend on the bootloader for randomness (via the [UEFI RNG interface](/blog/archives/2017/02/27/security-things-in-linux-v4-10/)) on arm64.

**arm64 E0PD**

Mark Brown added [support for the future ARMv8.5’s E0PD feature](https://git.kernel.org/linus/3e6c69a058deaa50d33c3dac36cde80b4ce590e8) (`TCR_E0PD1`), which causes all memory accesses from userspace into kernel space to fault in constant time. This is an attempt to remove any possible timing side-channel signals when probing kernel memory layout from userspace, as an alternative way to protect against Meltdown-style attacks. The expectation is that E0PD would be used instead of the more expensive Kernel Page Table Isolation (KPTI) features on arm64.

**powerpc32 VMAP\_STACK**

Christophe Leroy added [VMAP\_STACK support to powerpc32](https://git.kernel.org/linus/cd08f109e26231b279bcc0388428afcac6408ec6), joining x86, arm64, and s390. This helps protect against the various classes of attacks that depend on exhausting the kernel stack in order to collide with neighboring kernel stacks. (Another common target, the sensitive `thread_info`, had already been [moved away from the bottom of the stack](https://git.kernel.org/linus/ed1cd6deb013a11959d17a94e35ce159197632da) by Christophe Leroy in Linux v5.1.)

**generic Page Table dumping**

Related to RISCV’s work to add page table dumping (via `/sys/fs/debug/kernel_page_tables`), Steven Price extracted the existing implementations from multiple architectures and created a [common page table dumping framework](https://git.kernel.org/linus/30d621f6723b1c98a142861f7a52849d286bc7fa) (and then [refactored all the other architectures to use it](https://lore.kernel.org/linux-arm-kernel/20191218162402.45610-1-steven.price%40arm.com/)). I’m delighted to have this because I still remember when not having a working page table dumper for ARM delayed me for a while when trying to implement upstream kernel memory protections there. Anything that makes it easier for architectures to get their kernel memory protection working correctly makes me happy.

That’s in for now; let me know if there’s anything you think I missed. Next up: Linux [v5.7](/blog/archives/2020/09/21/security-things-in-linux-v5-7/).

© 2020 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2020/09/02/security-things-in-linux-v5-6/#comments)
## May 27, 2020

### [security things in Linux v5.5](https://outflux.net/blog/archives/2020/05/27/security-things-in-linux-v5-5/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 1:04 pm

Previously: [v5.4](/blog/archives/2020/02/18/security-things-in-linux-v5-4/).

I got a bit behind on this blog post series! Let’s get caught up. Here are a bunch of security things I found interesting in the [Linux kernel v5.5 release](https://lore.kernel.org/lkml/CAHk-%3DwigRZ6TSJU09bMk3Df2DiOw83B7TrQUq%2BiXroQCK5EVAQ%40mail.gmail.com/):

**restrict `perf_event_open()` from LSM**

Given the recurring flaws in the perf subsystem, there has been a strong desire to be able to entirely disable the interface. While the `kernel.perf_event_paranoid` sysctl knob has existed for a while, attempts to extend its control to “block all `perf_event_open()` calls” have [failed in the past](https://lwn.net/Articles/696216/). Distribution kernels have carried the rejected sysctl patch for many years, but now Joel Fernandes has implemented a solution that was deemed acceptable: instead of extending the sysctl, [add LSM hooks](https://git.kernel.org/linus/da97e18458fb42d7c00fac5fd1c56a3896ec666e) so that LSMs (e.g. SELinux, Apparmor, etc) can make these choices as part of their overall system policy.

**generic fast full `refcount_t`**

Will Deacon took the recent `refcount_t` hardening work for both x86 and arm64 and distilled the implementations into a [single architecture-agnostic C version](https://git.kernel.org/linus/dcb786493f3e48da3272b710028d42ec608cfda1). The result was almost as fast as the x86 assembly version, but it covered more cases (e.g. increment-from-zero), and is now available by [default for all architectures](https://git.kernel.org/linus/fb041bb7c0a918b95c6889fc965cdc4a75b4c0ca). (There is no longer any Kconfig associated with `refcount_t`; the use of the primitive provides full coverage.)

**linker script cleanup for exception tables**

When Rick Edgecombe [presented](https://www.youtube.com/watch?v=BkRI9TFS8Eo&list=PLVsQ_xZBEyN2Ol7y8axxhbTsG47Va3Se2&index=10&t=0s) his work on building [Execute-Only memory under a hypervisor](https://linuxplumbersconf.org/event/4/contributions/283/), he noted a region of memory that the kernel was attempting to read directly (instead of execute). He rearranged things for his x86-only patch series to [work around](https://github.com/redgecombe/linux/commit/428f889a5c52ca85b763cf484ed666a33259b6ef) the issue. Since I’d just been working in this area, I realized the root cause of this problem was the location of the exception table (which is strictly a lookup table and is never executed) and built a [fix for the issue](https://git.kernel.org/linus/b8c2f776164c8f74ac31c5e370ca3f029be0aa19) and applied it to [all architectures](https://lore.kernel.org/linux-arm-kernel/20191029211351.13243-1-keescook%40chromium.org/#r), since it turns out the exception tables for almost all architectures are just a data table. Hopefully this will help clear the path for more Execute-Only memory work on all architectures. In the process of this, I also updated the [section fill bytes on x86 to be a trap](https://git.kernel.org/linus/7705dc8557973d8ad8f10840f61d8ec805695e9e) (0xCC, int3), instead of a NOP instruction so functions would need to be targeted more precisely by attacks.

**KASLR for 32-bit PowerPC**

Joining many other architectures, Jason Yan added kernel text base-address offset randomization [(KASLR) to 32-bit PowerPC](https://git.kernel.org/linus/2b0e86cc5de6dabadc2d64cefa429fc227c8a756).

**seccomp for RISC-V**

After a bit of long road, David Abdurachmanov has added [seccomp support to the RISC-V architecture](https://git.kernel.org/linus/5340627e3fe08030988bdda46dd86cd5d5fb7517). The series uncovered some more corner cases in the seccomp self tests code, which is always nice since then we get to make it more robust for the future!

**seccomp `USER_NOTIF` continuation**

When the [seccomp `SECCOMP_RET_USER_NOTIF` interface](/blog/archives/2019/03/12/security-things-in-linux-v5-0/) was added, it seemed like it would only be used in very limited conditions, so the idea of needing to handle “normal” requests didn’t seem very onerous. However, since then, it has become clear that the overhead of a monitor process needing to perform lots of “normal” `open()` calls on behalf of the monitored process started to look more and more slow and fragile. To deal with this, it became clear that there needed to be a way for the `USER_NOTIF` interface to indicate that seccomp should just continue as normal and allow the syscall without any special handling. Christian Brauner [implemented `SECCOMP_USER_NOTIF_FLAG_CONTINUE`](https://git.kernel.org/linus/fb3c5386b382d4097476ce9647260fc89b34afdb) to get this done. It comes with a bit of a disclaimer due to the chance that monitors may use it in places where ToCToU is a risk, and for possible conflicts with `SECCOMP_RET_TRACE`. But overall, this is a net win for container monitoring tools.

**`EFI_RNG_PROTOCOL` for x86**

Some EFI systems provide a Random Number Generator interface, which is useful for gaining some entropy in the kernel during very early boot. The arm64 boot stub has been using this for a while now, but Dominik Brodowski has now added support for [x86 to do the same](https://git.kernel.org/linus/0d95981438c3bdb53cc99b0fb656d24d7a80e1f3). This entropy is useful for kernel subsystems performing very earlier initialization whre random numbers are needed (like [randomizing aspects of the SLUB memory allocator](https://lore.kernel.org/lkml/202003051623.AF4F8CB%40keescook/)).

**`FORTIFY_SOURCE` for MIPS**

As has been enabled on many other architectures, Dmitry Korotin got [MIPS building with `CONFIG_FORTIFY_SOURCE`](https://git.kernel.org/linus/a2ecb233e3e759730269b31b7d8add823cf196ba), so compile-time (and some run-time) buffer overflows during calls to the `memcpy()` and `strcpy()` families of functions will be [detected](/blog/archives/2017/09/05/security-things-in-linux-v4-13/).

**limit `copy_{to,from}_user()` size to `INT_MAX`**

As done for VFS, `vsnprintf()`, and [`strscpy()`](/blog/archives/2020/02/18/security-things-in-linux-v5-4/), I went ahead and [limited the size](https://git.kernel.org/linus/6d13de1489b6bf539695f96d945de3860e6d5e17) of `copy_to_user()` and `copy_from_user()` calls to `INT_MAX` in order to catch any weird overflows in size calculations.

**Other things**

[Alexander Popov pointed out some more v5.5 features](https://twitter.com/a13xp0p0v/status/1270109939474804740) that I missed in this blog post. I’m repeating them here, with some minor edits/clarifications. Thank you Alexander!

* [KASan support for vmap memory](https://git.kernel.org/linus/3c5c3cfb9ef4da957e3357a2bd36f76ee34c0862) expands KASan’s features to include analysis of memory allocated with `vmalloc()`. More specifically, this means KASan can examine the stack again, since it can be in that region since `CONFIG_VMAP_STACK` was introduced.
* [MIPS can build with GCC plugins and KCOV](https://git.kernel.org/linus/dcf78ee660888d8302a0f0888bf746a164d267fa) now, providing those systems with the associated features like stack wiping, coverage analysis, etc.
* [userfaultfd requires CAP\_SYS\_PTRACE for UFFD\_FEATURE\_EVENT\_FORK](https://git.kernel.org/linus/3c1c24d91ffd536de0a64688a9df7f49e58fadbc). This was done to block unprivileged users from abusing the userfaultfd feature, as it is implemented in a way that provides the ability to [inject file descriptors into unsuspecting processes](https://lore.kernel.org/linux-api/CALCETrWY%2B5ynDct7eU_nDUqx%3DokQvjm%3DY5wJvA4ahBja%3DCQXGw%40mail.gmail.com/).

*Edit: added Alexander Popov’s notes*

That’s it for v5.5! Let me know if there’s anything else that I should call out here. Next up: Linux [v5.6](/blog/archives/2020/09/02/security-things-in-linux-v5-6/).

© 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2020/05/27/security-things-in-linux-v5-5/#comments)
## February 18, 2020

### [security things in Linux v5.4](https://outflux.net/blog/archives/2020/02/18/security-things-in-linux-v5-4/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:37 pm

Previously: [v5.3](/blog/archives/2019/11/14/security-things-in-linux-v5-3/).

Linux kernel [v5.4 was released](https://lore.kernel.org/lkml/CAHk-%3DwjmzaD%3DBZ1hjUYu%2BRTnSGDLfCRwCdg99GeQpCjEwo9uzw%40mail.gmail.com/) in late November. The holidays got the best of me, but better late than never! ;) Here are some security-related things I found interesting:

**`waitid()` gains `P_PIDFD`**

Christian Brauner has continued his [`pidfd` work](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) by [adding a critical mode to `waitid()`: `P_PIDFD`](https://git.kernel.org/linus/3695eae5fee0605f316fbaad0b9e3de791d7dfaf). This makes it possible to reap child processes via a `pidfd`, and completes the interfaces needed for the bulk of programs performing process lifecycle management. (i.e. a `pidfd` can come from `/proc` or `clone()`, and can be waited on with `waitid()`.)

**kernel lockdown**

After something on the order of [8 years](https://lwn.net/Articles/514985/), Linux can now [draw a bright line](https://git.kernel.org/linus/000d388ed3bbed745f366ce71b2bb7c2ee70f449) between “ring 0” (kernel memory) and “uid 0” (highest privilege level in userspace). The “kernel lockdown” feature, which has been an out-of-tree patch series in most Linux distros for almost as many years, attempts to enumerate all the *intentional* ways (i.e. interfaces not flaws) userspace might be able to read or modify kernel memory (or execute in kernel space), and disable them. While Matthew Garrett made the internal details fine-grained controllable, the basic lockdown LSM can be set to either disabled, “integrity” (kernel memory can be read but not written), or “confidentiality” (no kernel memory reads or writes). Beyond closing the many holes between userspace and the kernel, if new interfaces are added to the kernel that might violate kernel integrity or confidentiality, now there is a place to put the access control to make everyone happy and there doesn’t need to be a rehashing of the age old fight between “but root has full kernel access” vs “not in some system configurations”.

**tagged memory relaxed syscall ABI**

Andrey Konovalov (with Catalin Marinas and others) introduced a way to enable a [“relaxed” tagged memory syscall ABI](https://git.kernel.org/linus/63f0c60379650d82250f22e4cf4137ef3dc4f43d) in the kernel. This means programs running on hardware that supports [memory tags](https://www.linuxplumbersconf.org/event/4/contributions/571/attachments/399/642/MTE_LPC.pdf) (or “versioning”, or “coloring”) in the upper (non-VMA) bits of a pointer address can use these addresses with the kernel without things going crazy. This is effectively teaching the kernel to ignore these high bits in places where they make no sense (i.e. mathematical comparisons) and keeping them in place where they have meaning (i.e. pointer dereferences).

As an example, if a userspace memory allocator had returned the address 0x0**f**00000010000000 (VMA address 0x10000000, with, say, a “high bits” tag of 0x0f), and a program used this range during a syscall that ultimately called `copy_from_user()` on it, the initial range check would fail if the tag bits were left in place: “that’s not a userspace address; it is greater than `TASK_SIZE` (0x0000800000000000)!”, so they are stripped for that check. During the actual copy into kernel memory, the tag is left in place so that when the hardware dereferences the pointer, the pointer tag can be checked against the expected tag assigned to referenced memory region. If there is a mismatch, the hardware will trigger the memory tagging protection.

Right now programs running on Sparc M7 CPUs with ADI (Application Data Integrity) can use this for hardware tagged memory, ARMv8 CPUs can use TBI (Top Byte Ignore) for software memory tagging, and eventually there will be ARMv8.5-A CPUs with MTE (Memory Tagging Extension).

**boot entropy improvement**

Thomas Gleixner got fed up with poor boot-time entropy and [trolled](https://lore.kernel.org/lkml/alpine.DEB.2.21.1909290010500.2636%40nanos.tec.linutronix.de/) Linus into coming up with reasonable way to [add entropy on modern CPUs](https://git.kernel.org/linus/50ee7529ec4500c88f8664560770a7a1b65db72b), taking advantage of timing noise, cycle counter jitter, and perhaps even the variability of speculative execution. This means that there shouldn’t be mysterious multi-second (or multi-minute!) [hangs at boot](https://lwn.net/Articles/800509/) when some systems don’t have enough entropy to service `getrandom()` syscalls from `systemd` or the like.

**userspace writes to swap files blocked**

From the department of “how did this go unnoticed for so long?”, Darrick J. Wong fixed the kernel to not allow writes from userspace to active swap files. Without this, it was possible for a user (usually root) with write access to a swap file to modify its contents, thereby changing memory contents of a process once it got paged back in. While root normally could just use `CAP_PTRACE` to modify a running process directly, this was a loophole that allowed lesser-privileged users (e.g. anyone in the “disk” group) without the needed capabilities to still bypass ptrace restrictions.

**limit `strscpy()` sizes to `INT_MAX`**

Generally speaking, if a size variable ends up larger than `INT_MAX`, some calculation somewhere has overflowed. And even if not, it’s probably going to hit code somewhere nearby that won’t deal well with the result. As already done in the VFS core, and `vsprintf()`, I added a check to `strscpy()` to [reject sizes larger than `INT_MAX`](https://git.kernel.org/linus/9a156466147b61504f4cbe97ea503e67c21e117a).

**`ld.gold` support removed**

Thomas Gleixner [removed support for the gold linker](https://git.kernel.org/linus/75959d44f9dc8e44410667009724e4e238515502). While this isn’t providing a direct security benefit, `ld.gold` has been a constant source of weird bugs. Specifically where I’ve noticed, it had been pain while developing KASLR, and has more recently been causing problems while stabilizing building the kernel with Clang. Having this linker support removed makes things much easier going forward. There are enough weird bugs to fix in Clang and `ld.lld`. ;)

**Intel TSX disabled**

Given the use of Intel’s Transactional Synchronization Extensions (TSX) CPU feature by attackers to exploit speculation flaws, Pawan Gupta [disabled the feature by default](https://git.kernel.org/linus/95c5824f75f3ba4c9e8e5a4b1a623c95390ac266) on CPUs that support disabling TSX.

That’s all I have for this version. Let me know if I missed anything. :) Next up is [Linux v5.5](/blog/archives/2020/05/27/security-things-in-linux-v5-5/)!

© 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (2)](https://outflux.net/blog/archives/2020/02/18/security-things-in-linux-v5-4/#comments)
## November 20, 2019

### [experimenting with Clang CFI on upstream Linux](https://outflux.net/blog/archives/2019/11/20/experimenting-with-clang-cfi-on-upstream-linux/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 9:09 pm

While much of the work on kernel Control Flow Integrity (CFI) is focused on arm64 (since [kernel CFI is available on Android](https://source.android.com/devices/tech/debug/kcfi)), a significant portion is in the core kernel itself (and especially the build system). Recently I got a sane build and boot on x86 with everything enabled, and I’ve been picking through some of the remaining pieces. I figured now would be a good time to document everything I do to get a build working in case other people want to play with it and find stuff that needs fixing.

First, everything is based on [Sami Tolvanen’s upstream port of Clang’s forward-edge CFI](https://github.com/samitolvanen/linux/commits/clang-cfi), which includes his Link Time Optimization (LTO) work, which CFI requires. This tree also includes his backward-edge CFI work on arm64 with Clang’s Shadow Call Stack (SCS).

On top of that, I’ve got a few x86-specific patches that get me far enough to boot a kernel without warnings pouring across the console. Along with that are general linker script cleanups, CFI cast fixes, and x86 crypto fixes, all in various states of getting upstreamed. The resulting tree is [here](https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git/log/?h=kspp/cfi/x86).

On the compiler side, you need a very recent Clang and LLD (i.e. “Clang 10”, or what I do is build from the latest git). For example, here’s how to get started. First, checkout, configure, and build Clang (leave out “`--depth=1`” if you want the full git history):

```

# Check out latest LLVM
mkdir -p $HOME/src
cd $HOME/src
git clone --depth=1 https://github.com/llvm/llvm-project.git
mkdir -p llvm-build
cd llvm-build
# Configure
mkdir -p $HOME/bin/clang-release
cmake -G Ninja \
      -DCMAKE_BUILD_TYPE=Release \
      -DLLVM_ENABLE_PROJECTS='clang;lld;compiler-rt' \
      -DCMAKE_INSTALL_PREFIX="$HOME/bin/clang-release" \
      ../llvm-project/llvm
# Build!
ninja install

```

Then checkout, configure, and build the CFI tree. (This assumes you’ve already got a checkout of Linus’s tree.)

```

# Check out my branch
cd ../linux
git remote add kees https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git
git fetch kees
git checkout kees/kspp/cfi/x86 -b test/cfi
# Use the above built Clang path first for the needed binaries: clang, ld.lld, and llvm-ar.
PATH="$HOME/bin/clang-release/bin:$PATH"
# Configure (this uses "defconfig" but you could use "menuconfig"), but you must
# include CC and LD in the make args or your .config won't know about Clang.
make defconfig CC=clang LD=ld.lld
# Enable LTO and CFI.
scripts/config \
     -e CONFIG_LTO \
     -e CONFIG_THINLTO \
     -d CONFIG_LTO_NONE \
     -e CONFIG_LTO_CLANG \
     -e CONFIG_CFI_CLANG \
     -e CONFIG_CFI_PERMISSIVE \
     -e CONFIG_CFI_CLANG_SHADOW
# Enable LKDTM if you want runtime fault testing:
scripts/config -e CONFIG_LKDTM
# Build!
make -j$(getconf _NPROCESSORS_ONLN) CC=clang LD=ld.lld

```

Do not be alarmed by various warnings, such as:

```

ld.lld: warning: cannot find entry symbol _start; defaulting to 0x1000
llvm-ar: error: unable to load 'arch/x86/kernel/head_64.o': file too small to be an archive
llvm-ar: error: unable to load 'arch/x86/kernel/head64.o': file too small to be an archive
llvm-ar: error: unable to load 'arch/x86/kernel/ebda.o': file too small to be an archive
llvm-ar: error: unable to load 'arch/x86/kernel/platform-quirks.o': file too small to be an archive
WARNING: EXPORT symbol "page_offset_base" [vmlinux] version generation failed, symbol will not be versioned.
WARNING: EXPORT symbol "vmalloc_base" [vmlinux] version generation failed, symbol will not be versioned.
WARNING: EXPORT symbol "vmemmap_base" [vmlinux] version generation failed, symbol will not be versioned.
WARNING: "__memcat_p" [vmlinux] is a static (unknown)
no symbols

```

Adjust your `.config` as you want (but, again, make sure the CC and LD args are pointed at Clang and LLD respectively). This should(!) result in a happy bootable x86 CFI-enabled kernel. If you want to see what a CFI failure looks like, you can poke LKDTM:

```

# Log into the booted system as root, then:
cat <(echo CFI_FORWARD_PROTO) >/sys/kernel/debug/provoke-crash/DIRECT
dmesg

```

Here’s the CFI splat I see on the console:

```

[   16.288372] lkdtm: Performing direct entry CFI_FORWARD_PROTO
[   16.290563] lkdtm: Calling matched prototype ...
[   16.292367] lkdtm: Calling mismatched prototype ...
[   16.293696] ------------[ cut here ]------------
[   16.294581] CFI failure (target: lkdtm_increment_int$53641d38e2dc4a151b75cbe816cbb86b.cfi_jt+0x0/0x10):
[   16.296288] WARNING: CPU: 3 PID: 2612 at kernel/cfi.c:29 __cfi_check_fail+0x38/0x40
...
[   16.346873] ---[ end trace 386b3874d294d2f7 ]---
[   16.347669] lkdtm: Fail: survived mismatched prototype function call!

```

The claim of “Fail: survived …” is due to `CONFIG_CFI_PERMISSIVE=y`. This allows the kernel to warn but continue with the bad call anyway. This is handy for debugging. In a production kernel that would be removed and the offending kernel thread would be killed. If you run this again with the config disabled, there will be no continuation from LKDTM. :)

Enjoy! And if you can figure out before me why there is still CFI instrumentation in the KPTI entry handler, please let me know and help us [fix it](https://github.com/KSPP/linux/issues/23). ;)

© 2019 – 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (2)](https://outflux.net/blog/archives/2019/11/20/experimenting-with-clang-cfi-on-upstream-linux/#comments)
## November 14, 2019

### [security things in Linux v5.3](https://outflux.net/blog/archives/2019/11/14/security-things-in-linux-v5-3/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 5:36 pm

Previously: [v5.2](/blog/archives/2019/07/17/security-things-in-linux-v5-2/).

Linux kernel [v5.3 was released](https://lore.kernel.org/lkml/CAHk-%3DwiP4K8DRJWsCo%3D20hn_6054xBamGKF2kPgUzpB5aMaofA%40mail.gmail.com/)! I let this blog post get away from me, but it’s up now! :) Here are some security-related things I found interesting:

**heap variable initialization**

In the continuing work to [remove “uninitialized” variables](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) from the kernel, Alexander Potapenko added new [“`init_on_alloc`” and “`init_on_free`” boot parameters](https://git.kernel.org/linus/6471384af2a6530696fc0203bafe4de41a23c9ef) (with associated Kconfig defaults) to perform zeroing of heap memory either at allocation time (i.e. all `kmalloc()`s effectively become `kzalloc()`s), at free time (i.e. all `kfree()`s effectively become `kzfree()`s), or both. The performance impact of the former under most workloads appears to be under 1%, if it’s measurable at all. The “init\_on\_free” option, however, is more costly but adds the benefit of reducing the lifetime of heap contents after they have been freed (which might be useful for some use-after-free attacks or side-channel attacks). Everyone should enable `CONFIG_INIT_ON_ALLOC_DEFAULT_ON=1` (or boot with “`init_on_alloc=1`“), and the more paranoid system builders should add `CONFIG_INIT_ON_FREE_DEFAULT_ON=1` (or “`init_on_free=1`” at boot). As workloads are found that cause performance concerns, tweaks to the initialization coverage can be added.

**`pidfd_open()` added**

Christian Brauner has continued his [`pidfd` work](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) by [creating the next needed syscall: `pidfd_open()`](https://git.kernel.org/linus/32fcb426ec001cb6d5a4a195091a8486ea77e2df), which takes a `pid` and returns a `pidfd`. This is useful for cases where process creation isn’t yet using `CLONE_PIDFD`, and where `/proc` may not be mounted.

**`-Wimplicit-fallthrough` enabled globally**

Gustavo A.R. Silva landed the last handful of [implicit fallthrough](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) fixes left in the kernel, which allows for [`-Wimplicit-fallthrough` to be globally enabled](https://git.kernel.org/linus/88c5083442454e5e8a505b11fa16f32d2879651e) for all kernel builds. This will keep any new instances of this bad code pattern from entering the kernel again. With several hundred implicit fallthroughs identified and fixed, something like 1 in 10 were missing breaks, which is way higher than I was expecting, making this work even more well justified.

**x86 CR4 & CR0 pinning**

In [recent exploits](https://googleprojectzero.blogspot.com/2017/05/exploiting-linux-kernel-via-packet.html), one of the steps for making the attacker’s life easier is to disable CPU protections like Supervisor Mode Access (and Execute) Prevention (SMAP and SMEP) by finding a way to write to CPU control registers to disable these features. For example, CR4 controls SMAP and SMEP, where disabling those would let an attacker access and execute userspace memory from kernel code again, opening up the attack to much greater flexibility. CR0 controls Write Protect (WP), which when disabled would allow an attacker to write to read-only memory like the kernel code itself. Attacks have been using the kernel’s CR4 and CR0 writing functions to make these changes (since it’s easier to gain that level of execute control), but now the kernel will attempt to [“pin” sensitive bits in CR4](https://git.kernel.org/linus/873d50d58f67ef15d2777b5e7f7a5268bb1fbae2) and [CR0](https://git.kernel.org/linus/8dbec27a242cd3e2816eeb98d3237b9f57cf6232) to avoid them getting disabled. This forces attacks to do more work to enact such register changes going forward. (I’d like to see KVM enforce this too, which would actually protect guest kernels from all attempts to change protected register bits.)

**additional `kfree()` sanity checking**

In order to avoid corrupted pointers doing crazy things when they’re freed (as seen in [recent exploits](https://github.com/ThomasKing2014/slides/raw/master/Building%20universal%20Android%20rooting%20with%20a%20type%20confusion%20vulnerability.pdf)), I added additional sanity checks to [verify kmem cache membership](https://git.kernel.org/linus/598a0717a816abc8f5d3c4598628338b9190d127) and to make sure that [objects actually belong to the kernel slab heap](https://git.kernel.org/linus/a64b53780ec35b77daf817210c88aa42d172c98f). As a reminder, everyone should be building with `CONFIG_SLAB_FREELIST_HARDENED=1`.

**KASLR enabled by default on arm64**

Just as Kernel Address Space Layout Randomization (KASLR) was [enabled by default on x86](/blog/archives/2017/07/10/security-things-in-linux-v4-12/), now [KASLR has been enabled by default on arm64](https://git.kernel.org/linus/8049672bb17a53f2545fbeaa6cfbb48055f51cde) too. It’s worth noting, though, that in order to benefit from this setting, the bootloader used for such arm64 systems needs to either support the UEFI RNG function or provide entropy via the “`/chosen/kaslr-seed`” Device Tree property.

**hardware security embargo documentation**

As there continues to be a long tail of hardware flaws that need to be reported to the Linux kernel community under embargo, a well-defined [process has been documented](https://git.kernel.org/linus/ddaedbbece90add970faeac87f7d7d40341936ce). This will let vendors unfamiliar with how to handle things follow the established best practices for interacting with the Linux kernel community in a way that lets mitigations get developed before embargoes are lifted. The latest (and HTML rendered) version of this process should always be available [here](https://www.kernel.org/doc/html/latest/process/embargoed-hardware-issues.html).

Those are the things I had on my radar. Please let me know if there are other things I should add! [Linux v5.4](/blog/archives/2020/02/18/security-things-in-linux-v5-4/) is almost here…

© 2019 – 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (6)](https://outflux.net/blog/archives/2019/11/14/security-things-in-linux-v5-3/#comments)
## July 17, 2019

### [security things in Linux v5.2](https://outflux.net/blog/archives/2019/07/17/security-things-in-linux-v5-2/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 5:07 pm

Previously: [v5.1](/blog/archives/2019/05/27/security-things-in-linux-v5-1/).

Linux kernel [v5.2 was released](https://lore.kernel.org/lkml/CAHk-%3DwhtW3FdruS-q2zehJPSan1SKtHoFHKX28A3J_1gfTFUMw%40mail.gmail.com/) last week! Here are some security-related things I found interesting:

**page allocator freelist randomization**

While the SLUB and SLAB allocator [freelists have been randomized for a while now](/blog/archives/2016/10/03/security-things-in-linux-v4-7/), the overarching page allocator itself wasn’t. This meant that anything doing allocation outside of the `kmem_cache`/`kmalloc()` would have deterministic placement in memory. This is bad both for security and for some cache management cases. Dan Williams [implemented this randomization under CONFIG\_SHUFFLE\_PAGE\_ALLOCATOR](https://git.kernel.org/linus/e900a918b0984ec8f2eb150b8477a47b75d17692) now, which provides additional uncertainty to memory layouts, though at a rather low granularity of 4MB (see `SHUFFLE_ORDER`). Also note that this feature needs to be enabled at boot time with `page_alloc.shuffle=1` unless you have direct-mapped memory-side-cache (you can check the state at `/sys/module/page_alloc/parameters/shuffle`).

**stack variable initialization with Clang**

Alexander Potapenko [added support via CONFIG\_INIT\_STACK\_ALL](https://git.kernel.org/linus/709a972efb01efaeb97cad1adc87fe400119c8ab) for Clang’s `-ftrivial-auto-var-init=pattern` option that enables [automatic initialization of stack variables](https://reviews.llvm.org/D54604). This provides even greater coverage than the prior [GCC plugin for stack variable initialization](/blog/archives/2019/05/27/security-things-in-linux-v5-1/), as Clang’s implementation also covers variables not passed by reference. (In theory, the kernel build should still warn about these instances, but even if they exist, Clang will initialize them.) Another notable difference between the GCC plugins and Clang’s implementation is that Clang initializes with a repeating 0xAA byte pattern, rather than zero. (Though this changes under certain situations, like for 32-bit pointers which are initialized with 0x000000AA.) As with the GCC plugin, the benefit is that the entire class of uninitialized stack variable flaws goes away.

**Kernel Userspace Access Prevention on powerpc**

Like SMAP on x86 and PAN on ARM, Michael Ellerman and Russell Currey have landed support for disallowing access to userspace without explicit markings in the kernel [(KUAP) on Power9](https://git.kernel.org/linus/890274c2dc4c0a57ae5a12d6a76fa6d05b599d98) and later PPC CPUs under `CONFIG_PPC_RADIX_MMU=y` (which is the default). This is the continuation of the execute protection [(KUEP) in v4.10](/blog/archives/2017/02/27/security-things-in-linux-v4-10/). Now if an attacker tries to trick the kernel into any kind of unexpected access from userspace (not just executing code), the kernel will fault.

**Microarchitectural Data Sampling mitigations on x86**

Another set of cache memory side-channel attacks came to light, and were consolidated together under the name [Microarchitectural Data Sampling](https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/mds.html) (MDS). MDS is weaker than other cache side-channels (less control over target address), but memory contents can still be exposed. Much like [L1TF](https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/l1tf.html), when one’s threat model includes untrusted code running under Symmetric Multi Threading (SMT: more logical cores than physical cores), the only full mitigation is to disable hyperthreading (boot with “`nosmt`“). For all the other variations of the MDS family, Andi Kleen (and others) [implemented various flushing mechanisms](https://git.kernel.org/linus/ed5194c2732c8084af9fd159c146ea92bf137128) to avoid cache leakage.

**unprivileged userfaultfd sysctl knob**

Both FUSE and userfaultfd provide attackers with a way to stall a kernel thread in the middle of memory accesses from userspace by initiating an access on an unmapped page. While FUSE is usually behind some kind of access controls, userfaultfd hadn’t been. To avoid various [heap grooming](https://cyseclabs.com/blog/cve-2016-6187-heap-off-by-one-exploit) and [heap spraying](https://duasynt.com/blog/linux-kernel-heap-spray) techniques for exploiting Use-after-Free flaws, Peter Xu added the new “`[vm.unprivileged_userfaultfd](https://git.kernel.org/linus/cefdca0a86be517bc390fc4541e3674b8e7803b0)`” sysctl knob to disallow unprivileged access to the userfaultfd syscall.

**temporary mm for text poking on x86**

The kernel regularly performs self-modification with things like `text_poke()` (during stuff like alternatives, ftrace, etc). Before, this was done with fixed mappings (“fixmap”) where a specific fixed address at the high end of memory was used to map physical pages as needed. However, this resulted in some temporal risks: other CPUs could write to the fixmap, or there might be stale TLB entries on removal that other CPUs might still be able to write through to change the target contents. Instead, Nadav Amit has created a [separate memory map for kernel text writes](https://git.kernel.org/linus/b3fd8e83ada0d51b71a84297480187e2d40e5ded), as if the kernel is trying to make writes to userspace. This mapping ends up staying local to the current CPU, and the [poking address is randomized](https://git.kernel.org/linus/4fc19708b165c1c152fa1f12f6600e66184b7786), unlike the old fixmap.

**ongoing: implicit fall-through removal**

Gustavo A. R. Silva is nearly done with [marking](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.2&qt=grep&q=expect.*fall.*through) (and [fixing](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.2&qt=grep&q=missing+break)) all the [implicit fall-through cases](https://outflux.net/blog/archives/2019/03/12/security-things-in-linux-v5-0/) in the kernel. Based on the [pull request from Gustavo](https://lore.kernel.org/lkml/20190506180521.GA30749%40embeddedor/), it looks very much like v5.3 will see `-Wimplicit-fallthrough` added to the global build flags and then this class of bug should stay extinct in the kernel.

**CLONE\_PIDFD added**

Christian Brauner added the new [`CLONE_PIDFD` flag](https://git.kernel.org/linus/b3e5838252665ee4cfa76b82bdf1198dca81e5be) to the `clone()` system call, which complements the [pidfd work in v5.1](/blog/archives/2019/05/27/security-things-in-linux-v5-1/) so that programs can now gain a handle for a process ID right at `fork()` (actually `clone()`) time, instead of needing to get the handle from `/proc` after process creation. With signals and forking now enabled, the next major piece (already in linux-next) will be adding `P_PIDFD` to the `waitid()` system call, and common process management can be done entirely with pidfd.

**Other things**

[Alexander Popov pointed out some more v5.2 features](https://twitter.com/a13xp0p0v/status/1164935830319828992) that I missed in this blog post. I’m repeating them here, with some minor edits/clarifications. Thank you Alexander!

* [x86-64 IRQ/exception/debug stack now has guard pages](https://git.kernel.org/linus/8f147727030bf9e81331ab9b8f42d4611bb6a3d9) to detect stack overflows immediately and deterministically from those contexts.
* [mincore(2) is made more conservative](https://git.kernel.org/linus/134fca9063ad4851de767d1768180e5dede9a881) to avoid information exposures about memory cache states and similar.
* [x86’s `objtool` can now validate callers of uaccess helpers to make sure SMAP is not left disabled](https://git.kernel.org/linus/6ec62961e6de9506e8b8620dc19897d8cfd41c2e).
* [powerpc/32 now supports KASAN](https://git.kernel.org/linus/2edb16efc899f9c232e2d880930b855e4cf55df4).
* [powerpc now warns if W+X pages are found on boot](https://git.kernel.org/linus/453d87f6a8aed827f5ebb1708a4cea458fd68d23).

*Edit: added CLONE\_PIDFD notes, as reminded by Christian Brauner. :)*

*Edit: added Alexander Popov’s notes*

That’s it for now; let me know if you think I should add anything here. We’re almost to -rc1 for [v5.3](/blog/archives/2019/11/14/security-things-in-linux-v5-3/)!

© 2019 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (4)](https://outflux.net/blog/archives/2019/07/17/security-things-in-linux-v5-2/#comments)
## June 27, 2019

### [package hardening asymptote](https://outflux.net/blog/archives/2019/06/27/package-hardening-asymptote/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 3:35 pm

Forever ago I set up tooling to generate graphs representing the adoption of various [hardening features in Ubuntu packaging](https://outflux.net/ubuntu/hardening/amd64/). These were very interesting in 2006 when stack protector was making its way into the package archive. Similarly in 2008 and 2009 as FORTIFY\_SOURCE and read-only relocations made their way through the archive. It took a while to really catch hold, but finally PIE-by-default started to take off in 2016 through 2018:

![Graph of Ubuntu hardening feature adoption over 20 years](/illustrations/hardening/ubuntu-hardening-20years.png)

Around 2012 when Debian started in earnest to enable hardening features for their archive, I realized this was going to be a long road. I added the above “20 year view” for Ubuntu and then started similarly graphing [hardening features in Debian packages](https://outflux.net/debian/hardening/) too (the blip on PIE here was a tooling glitch, IIRC):

![Graph of Debian hardening feature adoption over 10 years](/illustrations/hardening/debian-hardening-10years.png)

Today I realized that my Ubuntu tooling broke back in January and no one noticed, including me. And really, why should anyone notice? The “near term” (weekly, monthly) graphs have been basically flat for years:

![The last month of Debian hardening stats](/illustrations/hardening/debian-hardening-month.png)

In the long-term view the measurements have a distinctly asymptotic appearance and the graphs are maybe only good for their historical curves now. But then I wonder, what’s next? What new compiler feature adoption could be measured? I think there are still a few good candidates…

How about enabling `-fstack-clash-protection` (only in [GCC](https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html#index-fstack-clash-protection), [Clang still hasn’t implemented it](https://bugs.llvm.org/show_bug.cgi?id=40802)).

Or how about getting serious and using forward-edge Control Flow Integrity? (Clang has `[-fsanitize=cfi](https://clang.llvm.org/docs/ControlFlowIntegrity.html)` for general purpose function prototype based enforcement, and GCC has the more limited `[-fvtable-verify](https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html#index-fvtable-verify)` for C++ objects.)

Where is backward-edge CFI? (Is everyone waiting for [CET](https://software.intel.com/en-us/blogs/2016/06/09/intel-release-new-technology-specifications-protect-rop-attacks)?)

Does anyone see something meaningful that needs adoption tracking?

© 2019, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2019/06/27/package-hardening-asymptote/#comments)
## May 27, 2019

### [security things in Linux v5.1](https://outflux.net/blog/archives/2019/05/27/security-things-in-linux-v5-1/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 8:49 pm

Previously: [v5.0](/blog/archives/2019/03/12/security-things-in-linux-v5-0/).

Linux kernel [v5.1 has been released](https://lkml.kernel.org/r/CAHk-%3DwhsbDxdapMJGvy9OkVSrKMsKRJBTrH-Qj-qTbkMUGnWUw%40mail.gmail.com)! Here are some security-related things that stood out to me:

**introduction of pidfd**

Christian Brauner landed the first portion of his work to remove pid races from the kernel: using a [file descriptor to reference a process](https://git.kernel.org/linus/3eb39f47934f9d5a3027fe00d906a45fe3a15fad) (“pidfd”). Now `/proc/$pid` can be opened and used as an argument for sending signals with the new `pidfd_send_signal()` syscall. This handle will only refer to the original process at the time the `open()` happened, and not to any later “reused” pid if the process dies and a new process is assigned the same pid. Using this method, it’s now possible to racelessly send signals to exactly the intended process without having to worry about pid reuse. (BTW, this commit wins the 2019 award for Most Well Documented Commit Log Justification.)

**explicitly test for userspace mappings of heap memory**

During [Linux Conf AU 2019 Kernel Hardening BoF](https://2019.linux.conf.au/wiki/Kernel_Hardening_BoF), Matthew Wilcox noted that there wasn’t anything in the kernel actually sanity-checking when userspace mappings were being applied to kernel heap memory (which would allow attackers to bypass the `copy_{to,from}_user()` infrastructure). Driver bugs or attackers able to confuse mappings wouldn’t get caught, so he added checks. To quote the commit logs: [“It’s never appropriate to map a page allocated by SLAB into userspace”](https://git.kernel.org/linus/2d432cb7091e99881af803cdd67a31969b863005) and [“Pages which use page\_type must never be mapped to userspace as it would destroy their page type”](https://git.kernel.org/linus/0ee930e6cafa048c1925893d0ca89918b2814f2c). The latter check almost [immediately caught a bad case](https://lkml.kernel.org/r/20190312171421.GJ19508%40bombadil.infradead.org), which was [quickly fixed](https://git.kernel.org/linus/0266def913771e718fd0c998eecb072e0685e2c9) to avoid page type corruption.

**LSM stacking: shared security blobs**

Casey Schaufler has landed one of the major pieces of getting multiple Linux Security Modules (LSMs) running at the same time (called “stacking”). It is now possible for LSMs to [share the security-specific storage “blobs”](https://git.kernel.org/linus/f4ad8f2c40769b3cc9497ba0883bbaf823f7752f) associated with various core structures (e.g. inodes, tasks, etc) that LSMs can use for saving their state (e.g. storing which profile a given task confined under). The kernel originally gave only the single active “major” LSM (e.g. SELinux, Apprmor, etc) full control over the entire blob of storage. With “shared” security blobs, the LSM infrastructure does the allocation and management of the memory, and LSMs use an offset for reading/writing their portion of it. This unblocks the way for “medium sized” LSMs (like [SARA](https://sara.smeso.it/en/latest/) and [Landlock](https://landlock.io)) to get stacked with a “major” LSM as they need to store much more state than the “minor” LSMs (e.g. Yama, LoadPin) which could already stack because they didn’t need blob storage.

**SafeSetID LSM**

Micah Morton [added](https://git.kernel.org/linus/aeca4e2ca65c1aeacfbe520684e6421719d99417) the new [SafeSetID LSM](https://www.kernel.org/doc/html/latest/admin-guide/LSM/SafeSetID.html), which provides a way to narrow the power associated with the `CAP_SETUID` capability. Normally a process with `CAP_SETUID` can become any user on the system, including root, which makes it a meaningless capability to hand out to non-root users in order for them to “drop privileges” to some less powerful user. There are trees of processes under Chrome OS that need to operate under different user IDs and other methods of accomplishing these transitions safely weren’t sufficient. Instead, this provides a way to create a system-wide policy for user ID transitions via `setuid()` (and group transitions via `setgid()`) when a process has the `CAP_SETUID` capability, making it a much more useful capability to hand out to non-root processes that need to make uid or gid transitions.

**ongoing: refcount\_t conversions**

Elena Reshetova [continued landing](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.1&qt=grep&q=onvert.*refcount_t) more [`refcount_t` conversions](/blog/archives/2017/09/05/security-things-in-linux-v4-13/) in core kernel code (e.g. scheduler, futex, perf), with an additional conversion in btrfs from Anand Jain. The existing conversions, mainly when combined with syzkaller, continue to show their utility at [finding](https://git.kernel.org/linus/357798909164bf423eac6a78ff7da7e98d2d7f7f) [bugs](https://git.kernel.org/linus/b987222654f84f7b4ca95b3a55eca784cb30235b) [all](https://git.kernel.org/linus/a622b40035d16196bf19b2b33b854862595245fc) [over](https://git.kernel.org/linus/b3098121c42caaf3aea239b8655cf52d45be116f) the kernel.

**ongoing: implicit fall-through removal**

Gustavo A. R. Silva continued to make [progress on marking](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.1&qt=grep&q=expect.*fall.*through) more [implicit fall-through](/blog/archives/2019/03/12/security-things-in-linux-v5-0/) cases. What’s so impressive to me about this work, like `refcount_t`, is how many bugs it has been finding (see all the “[missing break](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.1&qt=grep&q=missing+break)” patches). It really shows how quickly the kernel benefits from adding `-Wimplicit-fallthrough` to keep this class of bug from ever returning.

**stack variable initialization includes scalars**

The structleak gcc plugin (originally [ported from PaX](/blog/archives/2017/05/02/security-things-in-linux-v4-11/)) had its [“by reference” coverage](https://outflux.net/blog/archives/2017/11/14/security-things-in-linux-v4-14/) improved to [initialize scalar types](https://git.kernel.org/linus/81a56f6dcd20325607d6008f4bb560c96f4c821a) as well (making “structleak” a bit of a misnomer: it now stops leaks from more than structs). Barring compiler bugs, this means that all stack variables in the kernel can be initialized before use at function entry. For variables not passed to functions by reference, the `-Wuninitialized` compiler flag (enabled via `-Wall`) already makes sure the kernel isn’t building with local-only uninitialized stack variables. And now with `CONFIG_GCC_PLUGIN_STRUCTLEAK_BYREF_ALL` enabled, all variables passed by reference will be initialized as well. This should eliminate most, if not all, uninitialized stack flaws with very minimal performance cost (for most workloads it is lost in the noise), though it does not have the stack data lifetime reduction benefits of [`GCC_PLUGIN_STACKLEAK`](/blog/archives/2018/12/24/security-things-in-linux-v4-20/), which wipes the stack at syscall exit. Clang has recently gained similar [automatic stack initialization support](https://reviews.llvm.org/D54604), and I’d love to this feature in native gcc. To evaluate the coverage of the various stack auto-initialization features, I also wrote regression tests in [lib/test\_stackinit.c](https://git.kernel.org/linus/50ceaa95ea09703722b30b4afa617c972071cd7f).

That’s it for now; please let me know if I missed anything. The [v5.2](/blog/archives/2019/07/17/security-things-in-linux-v5-2/) kernel development cycle is off and running already. :)

© 2019 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v5.1
## March 12, 2019

### [security things in Linux v5.0](https://outflux.net/blog/archives/2019/03/12/security-things-in-linux-v5-0/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:04 pm

Previously: [v4.20](/blog/archives/2018/12/24/security-things-in-linux-v4-20/).

Linux kernel [v5.0 was released last week](https://lkml.kernel.org/r/CAHk-%3DwjuG6HiGbD7DCGfvDvhr_1WZUR-eYF2qWGbYyn9k6unvg%40mail.gmail.com)! Looking through the changes, here are some security-related things I found interesting:

**read-only linear mapping, arm64**

While x86 has had a read-only linear mapping (or “Low Kernel Mapping” as shown in `/sys/kernel/debug/page_tables/kernel` under `CONFIG_X86_PTDUMP=y`) for a while, Ard Biesheuvel has [added them to arm64 now](https://git.kernel.org/linus/c55191e96caa9d787e8f682c5e525b7f8172a3b4). This means that ranges in the linear mapping that contain executable code (e.g. modules, JIT, etc), are not directly writable any more by attackers. On arm64, this is visible as “Linear mapping” in `/sys/kernel/debug/kernel_page_tables` under `CONFIG_ARM64_PTDUMP=y`, where you can now see the page-level granularity:

> ```
>
> ---[ Linear mapping ]---
> ...
> 0xffffb07cfc402000-0xffffb07cfc403000    4K PTE   ro NX SHD AF NG    UXN MEM/NORMAL
> 0xffffb07cfc403000-0xffffb07cfc4d0000  820K PTE   RW NX SHD AF NG    UXN MEM/NORMAL
> 0xffffb07cfc4d0000-0xffffb07cfc4d1000    4K PTE   ro NX SHD AF NG    UXN MEM/NORMAL
> 0xffffb07cfc4d1000-0xffffb07cfc79d000 2864K PTE   RW NX SHD AF NG    UXN MEM/NORMAL
>
> ```

**per-task stack canary, arm**

ARM has supported stack buffer overflow protection for a long time (currently via the compiler’s `-fstack-protector-strong` option). However, on ARM, the compiler uses a global variable for comparing the canary value, `__stack_chk_guard`. This meant that everywhere in the kernel needed to use the same canary value. If an attacker could expose a canary value in one task, it could be spoofed during a buffer overflow in another task. On x86, the canary is in Thread Local Storage (TLS, defined as `%gs:20` on 32-bit and `%gs:40` on 64-bit), which means it’s possible to have a different canary for every task since the `%gs` segment points to per-task structures. To solve this for ARM, Ard Biesheuvel built a GCC plugin to [replace the global canary checking code with a per-task relative reference](https://git.kernel.org/linus/189af4657186da08a2e79fb8e906cfd82b2ccddc) to a new canary in `struct thread_info`. As he describes in his [blog post](http://www.workofard.com/2018/01/per-task-stack-canaries-for-arm64/), the plugin results in replacing:

> ```
>
> 8010fad8:       e30c4488        movw    r4, #50312      ; 0xc488
> 8010fadc:       e34840d0        movt    r4, #32976      ; 0x80d0
> ...
> 8010fb1c:       e51b2030        ldr     r2, [fp, #-48]  ; 0xffffffd0
> 8010fb20:       e5943000        ldr     r3, [r4]
> 8010fb24:       e1520003        cmp     r2, r3
> 8010fb28:       1a000020        bne     8010fbb0
> ...
> 8010fbb0:       eb006738        bl      80129898 <__stack_chk_fail>
>
> ```

with:

> ```
>
> 8010fc18:       e1a0300d        mov     r3, sp
> 8010fc1c:       e3c34d7f        bic     r4, r3, #8128   ; 0x1fc0
> ...
> 8010fc60:       e51b2030        ldr     r2, [fp, #-48]  ; 0xffffffd0
> 8010fc64:       e5943018        ldr     r3, [r4, #24]
> 8010fc68:       e1520003        cmp     r2, r3
> 8010fc6c:       1a000020        bne     8010fcf4
> ...
> 8010fcf4:       eb006757        bl      80129a58 <__stack_chk_fail>
>
> ```

`r2` holds the canary saved on the stack and `r3` the known-good canary to check against. In the former, `r3` is loaded through `r4` at a fixed address (0x80d0c488, which “`readelf -s vmlinux`” confirms is the global `__stack_chk_guard`). In the latter, it’s coming from offset 0x24 in `struct thread_info` (which “`pahole -C thread_info vmlinux`” confirms is the “`stack_canary`” field).

**per-task stack canary, arm64**

The lack of per-task canary existed on arm64 too. Ard Biesheuvel solved this differently by coordinating with GCC developer Ramana Radhakrishnan to add support for a [register-based offset option](https://gcc.gnu.org/git/?p=gcc.git;a=commitdiff;h=359c1bf35e3109d2f3882980b47a5eae46123259) (specifically “`-mstack-protector-guard=sysreg -mstack-protector-guard-reg=sp_el0 -mstack-protector-guard-offset=...`“). With this feature, the [canary can be found relative to `sp_el0`](https://git.kernel.org/linus/0a1213fa7432778b71a1c0166bf56660a3aab030), since that register holds the pointer to the `struct task_struct`, which contains the canary. I’m hoping there will be a workable Clang solution soon too (for this and 32-bit ARM). (And it’s also worth noting that, unfortunately, this support isn’t yet in a released version of GCC. It’s expected for 9.0, likely this coming May.)

**top-byte-ignore, arm64**

Andrey Konovalov has been [laying the groundwork](https://git.kernel.org/linus/21696c1613244f2ad4e9216c4f6e7804831a992c) with his Top Byte Ignore (TBI) series which will also help support [ARMv8.3’s Pointer Authentication](https://lwn.net/Articles/718888/) (PAC) and [ARMv8.5’s Memory Tagging](https://llvm.org/devmtg/2018-10/slides/Serebryany-Stepanov-Tsyrklevich-Memory-Tagging-Slides-LLVM-2018.pdf) (MTE). While TBI technically conflicts with PAC, both rely on using “non-VA-space” (Virtual Address) bits in memory addresses, and getting the kernel ready to deal with ignoring non-VA bits. PAC stores signatures for checking things like return addresses on the stack or stored function pointers on heap, both to stop overwrites of control flow information. MTE stores a “tag” (or, depending on your dialect, a “color” or “version”) to mark separate memory allocation regions to stop use-after-tree and linear overflows. For either of these to work, the CPU has to be put into some form of the TBI addressing mode (though for MTE, it’ll be a “check the tag” mode), otherwise the addresses would resolve into totally the wrong place in memory. Even without PAC and MTE, this byte can be used to store bits that can be checked by software (which is what the rest of Andrey’s series does: adding this logic to speed up KASan).

**ongoing: implicit fall-through removal**

An area of active work in the kernel is the removal of all implicit fall-through in `switch` statements. While the C language has a statement to indicate the end of a switch case (“`break`“), it doesn’t have a statement to indicate that execution should fall through to the next case statement (just the lack of a “`break`” is used to indicate it should fall through — but this is not always the case), and such “implicit fall-through” may lead to bugs. Gustavo Silva has been the driving force behind fixing these since at least v4.14, with [well over 300 patches](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.0&qt=grep&q=expect.*fall.*through) on the topic alone (and over 20 missing break statements found and fixed as a result of the work). The goal is to be able to add `-Wimplicit-fallthrough` to the build so that the kernel will stay entirely free of this class of bug going forward. From roughly 2300 warnings, the kernel is now down to about 200. It’s also worth noting that with Stephen Rothwell’s help, this bug has been kept out of linux-next by him [sending warning emails](https://lkml.kernel.org/r/20190222120644.0bdc4da8%40canb.auug.org.au) to any tree maintainers where a new instance is introduced (for example, here’s a bug introduced on [Feb 20th](https://git.kernel.org/linus/93700458ff63836ff73d3301e5e98d2e0bb01e98) and fixed on [Feb 21st](https://git.kernel.org/linus/7a25c6c0aac85bbc50d3ce49cd08888adb14508b)).

**ongoing: refcount\_t conversions**

There also continues to be work converting reference counters from `atomic_t` to `refcount_t` so they can gain [overflow protections](/blog/archives/2017/09/05/security-things-in-linux-v4-13/). There have been [18 more conversions since v4.15](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.0&qt=grep&q=onvert.*refcount_t) from Elena Reshetova, Trond Myklebust, Kirill Tkhai, Eric Biggers, and Björn Töpel. While there are more complex cases, the minimum goal is to reduce the [Coccinelle warnings](https://www.kernel.org/doc/html/latest/dev-tools/coccinelle.html) from `scripts/coccinelle/api/atomic_as_refcounter.cocci` to zero. As of v5.0, there are 131 warnings, with the bulk of the remaining areas in `fs/` (49), `drivers/` (41), and `kernel/` (21).

**userspace PAC, arm64**

Mark Rutland and Kristina Martsenko enabled kernel support for ARMv8.3 [PAC in userspace](https://git.kernel.org/linus/750319756256). As mentioned earlier about PAC, this will give userspace the ability to block a wide variety of function pointer overwrites by “signing” function pointers before storing them to memory. The kernel manages the keys (i.e. selects random keys and sets them up), but it’s up to userspace to detect and use the new CPU instructions. The “paca” and “pacg” flags will be visible in `/proc/cpuinfo` for CPUs that support it.

**platform keyring**

Nayna Jain introduced the [trusted platform keyring](https://git.kernel.org/linus/9dc92c45177ab70e20ae94baa2f2e558da63a9c7), which cannot be updated by userspace. This can be used to verify platform or boot-time things like firmware, initramfs, or kexec kernel signatures, etc.

**`SECCOMP_RET_USER_NOTIF`**

Tycho Andersen added the new [`SECCOMP_RET_USER_NOTIF` return type to seccomp](https://git.kernel.org/linus/6a21cc50f0c7f87dae5259f6cfefe024412313f6) which allows process monitors to receive notifications over a file descriptor when a seccomp filter has been hit. This is a much more light-weight method than ptrace for performing tasks on behalf of a process. It is especially useful for performing various admin-only tasks for unprivileged containers (like mounting filesystems). The process monitor can perform the requested task (after doing some ToCToU dances to read process memory for syscall arguments), or reject the syscall.

*Edit: added userspace PAC and platform keyring, suggested by Alexander Popov*

*Edit: tried to clarify TBI vs PAC vs MTE*

*Edit: added details on SECCOMP\_RET\_USER\_NOTIF*

That’s it for now; please let me know if I missed anything. The [v5.1](/blog/archives/2019/05/27/security-things-in-linux-v5-1/) merge window is open, so off we go! :)

© 2019 – 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v5.0
## December 24, 2018

### [security things in Linux v4.20](https://outflux.net/blog/archives/2018/12/24/security-things-in-linux-v4-20/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 3:59 pm

Previously: [v4.19](https://outflux.net/blog/archives/2018/10/22/security-things-in-linux-v4-19/).

Linux kernel v4.20 has been released today! Looking through the changes, here are some security-related things I found interesting:

**stackleak plugin**

Alexander Popov’s work to port the grsecurity STACKLEAK plugin to the upstream kernel came to fruition. While it had received Acks from x86 (and arm64) maintainers, it has been [rejected a few times by Linus](https://www.youtube.com/watch?v=5wIniiWSgUc). With everything matching Linus’s expectations now, it and the x86 glue [have landed](https://git.kernel.org/linus/10e9ae9fabaf96c8e5227c1cd4827d58b3aa406d). (The arch-specific portions for arm64 from Laura Abbott actually [landed in v4.19](https://git.kernel.org/linus/0b3e336601b82c6afa0e9cf21db9cb8793e25399).) The plugin tracks function calls (with a sufficiently large stack usage) to mark the maximum depth of the stack used during a syscall. With this information, at the end of a syscall, the stack can be efficiently poisoned (i.e. instead of clearing the entire stack, only the portion that was actually used during the syscall needs to be written). There are two main benefits from the stack getting wiped after every syscall. First, there are no longer “uninitialized” values left over on the stack that an attacker [might be able to use in the next syscall](https://outflux.net/slides/2011/defcon/kernel-exploitation.pdf). Next, the lifetime of any sensitive data on the stack is reduced to only being live during the syscall itself. This is mainly interesting because any information exposures or side-channel attacks from other kernel threads need to be much more carefully timed to catch the stack data before it gets wiped.

Enabling `CONFIG_GCC_PLUGIN_STACKLEAK=y` means almost all uninitialized variable flaws go away, with only a very minor performance hit (it appears to be under 1% for most workloads). It’s still possible that, within a single syscall, a later buggy function call could use “uninitialized” bytes from the stack from an earlier function. Fixing this will need compiler support for pre-initialization (this is [under development already for Clang](http://lists.llvm.org/pipermail/cfe-dev/2018-November/060172.html), for example), but that may have larger performance implications.

**raise faults for kernel addresses in copy\_\*\_user()**

Jann Horn reworked x86 memory exception handling to [loudly notice](https://git.kernel.org/linus/9da3f2b74054406f87dff7101a569217ffceb29b) when `copy_{to,from}_user()` tries to access unmapped kernel memory. Prior this, those accesses would result in a silent error (usually visible to callers as `EFAULT`), making it indistinguishable from a “regular” userspace memory exception. The purpose of this is to catch cases where, for example, the unchecked `__copy_to_user()` is called against a kernel address. Fuzzers like [syzcaller](https://github.com/google/syzkaller/commit/e8dd2c6713522707b3b89884eb95601cdf9bc9be) weren’t able to notice very nasty bugs because writes to kernel addresses would either corrupt memory (which may or may not get detected at a later time) or return an `EFAULT` that looked like things were operating normally. With this change, it’s now possible to much more easily [notice missing `access_ok()` checks](https://git.kernel.org/linus/96ca579a1ecc943b75beba58bebb0356f6cc4b51). This has already caught two other corner cases even during v4.20 in [HID](https://git.kernel.org/linus/8c01db7619f07c85c5cd81ec5eb83608b56c88f5) and [Xen](https://git.kernel.org/linus/1457d8cf7664f34c4ba534c1073821a559a2f6f9).

**spectre v2 userspace mitigation**

The support for Single Thread Indirect Branch Predictors (STIBP) [has been merged](https://git.kernel.org/linus/53c613fe6349994f023245519265999eed75957f). This allowed CPUs that support STIBP to effectively disable Hyper-Threading to avoid indirect branch prediction side-channels to expose information between userspace threads on the same physical CPU. Since this was a very expensive solution, this protection was [made opt-in](https://git.kernel.org/linus/fa1202ef224391b6f5b26cdd44cc50495e8fab54) (via explicit `prctl()` or implicitly under `seccomp()`). LWN has a nice [write-up of the details](https://lwn.net/Articles/773118/).

**jump labels read-only after init**

Ard Biesheuvel noticed that jump labels don’t need to be writable after initialization, so their data structures were [made read-only](https://git.kernel.org/linus/e872267b8bcbb179e21ccc7118f258873d6e7a59). Since they point to kernel code, they might be used by attackers to manipulate the jump targets as a way to change kernel code that wasn’t intended to be changed. Better to just move everything into the read-only memory region to remove it from the possible kernel targets for attackers.

**VLA removal finished**

As detailed earlier for [v4.17](/blog/archives/2018/06/14/security-things-in-linux-v4-17/), [v4.18](/blog/archives/2018/08/20/security-things-in-linux-v4-18/), and [v4.19](/blog/archives/2018/10/22/security-things-in-linux-v4-19/), a whole bunch of people answered [my call to remove Variable Length Arrays](https://twitter.com/kees_cook/status/971491095736537088) (VLAs) from the kernel. I count at least 153 commits having been added to the kernel since v4.16 to remove VLAs, with a big thanks to Gustavo A. R. Silva, Laura Abbott, Salvatore Mesoraca, Kyle Spiers, Tobin C. Harding, Stephen Kitt, Geert Uytterhoeven, Arnd Bergmann, Takashi Iwai, Suraj Jitindar Singh, Tycho Andersen, Thomas Gleixner, Stefan Wahren, Prashant Bhole, Nikolay Borisov, Nicolas Pitre, Martin Schwidefsky, Martin KaFai Lau, Lorenzo Bianconi, Himanshu Jha, Chris Wilson, Christian Lamparter, Boris Brezillon, Ard Biesheuvel, and Antoine Tenart. With all that done, “`-Wvla`” has been [added](https://git.kernel.org/linus/0bb95f80a38f82884693194ea720e9cca5e12ada) to the top-level Makefile so we don’t get any more added back in the future.

**per-task stack canaries, powerpc**

For a long time, only x86 has had per-task kernel stack canaries. Other architectures would generate a single canary for the life of the boot and use it in every task. This meant that exposing a canary from one task would give an attacker everything they needed to spoof a canary in a separate attack in a different task. Christophe Leroy has [solved this on powerpc](https://git.kernel.org/linus/06ec27aea9fc84d9c6d879eb64b5bcf28a8a1eb7) now, integrating the new GCC support for the `-mstack-protector-guard-reg` and `-mstack-protector-guard-offset` options.

Given the holidays, Linus opened the merge window before v4.20 was released, letting everyone send in pull requests in the week leading up to the release. v4.21 is in the making. :) Happy New Year everyone!

*Edit: clarified stackleak details, thanks to Alexander Popov. Added per-task canaries note too.*

© 2018 – 2019, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2018/12/24/security-things-in-linux-v4-20/#comments)
## October 22, 2018

### [security things in Linux v4.19](https://outflux.net/blog/archives/2018/10/22/security-things-in-linux-v4-19/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:17 pm

Previously: [v4.18](/blog/archives/2018/08/20/security-things-in-linux-v4-18/).

Linux kernel [v4.19 was released today](https://lore.kernel.org/lkml/20181022073224.GA5658%40kroah.com). Here are some security-related things I found interesting:

**L1 Terminal Fault (L1TF)**

While it seems like ages ago, the [fixes for L1TF](https://git.kernel.org/linus/958f338e96f874a0d29442396d6adf9c1e17aa2d) actually landed at the start of the v4.19 merge window. As with the other speculation flaw fixes, lots of people were involved, and the scope was pretty wide: bare metal machines, virtualized machines, etc. LWN has a [great write-up on the L1TF flaw](https://lwn.net/Articles/762570/) and the kernel’s [documentation on L1TF defenses](https://www.kernel.org/doc/html/latest/admin-guide/l1tf.html) is equally detailed. I like how clean the solution is for bare-metal machines: when a page table entry should be marked invalid, instead of only changing the “Present” flag, it also inverts the address portion so even a speculative lookup ignoring the “Present” flag will land in an unmapped area.

**protected regular and fifo files**

Salvatore Mesoraca implemented an `O_CREAT` restriction in `/tmp` directories for [FIFOs and regular files](https://git.kernel.org/linus/30aba6656f61ed44cba445a3c0d38b296fa9e8f5). This is similar to the existing [symlink restrictions](https://git.kernel.org/linus/800179c9b8a1e796e441674776d11cd4c05d61d7), which take effect in sticky world-writable directories (e.g. `/tmp`) when the opening user does not match the owner of the existing file (or directory). When a program opens a FIFO or regular file with `O_CREAT` and this kind of user mismatch, it is treated like it was also opened with `O_EXCL`: it gets rejected because there is already a file there, and the kernel wants to protect the program from writing possibly sensitive contents to a file owned by a different user. This has become a more common attack vector now that symlink and hardlink races have been eliminated.

**syscall register clearing, arm64**

One of the ways attackers can influence potential speculative execution flaws in the kernel is to leak information into the kernel via “unused” register contents. Most syscalls take only a few arguments, so all the other [calling-convention-defined registers](http://man7.org/linux/man-pages/man2/syscall.2.html#NOTES) can be cleared instead of just left with whatever contents they had in userspace. As it turns out, clearing registers is very fast. Similar to what was done on [x86](/blog/archives/2018/06/14/security-things-in-linux-v4-17/), Mark Rutland implemented a full [register-clearing syscall wrapper on arm64](https://git.kernel.org/linus/4378a7d4be30ec6994702b19936f7d1465193541).

**Variable Length Array removals, part 3**

As mentioned in [part 1](/blog/archives/2018/06/14/security-things-in-linux-v4-17/) and [part 2](/blog/archives/2018/08/20/security-things-in-linux-v4-18/), VLAs continue to be removed from the kernel. While `CONFIG_THREAD_INFO_IN_TASK` and `CONFIG_VMAP_STACK` cover most issues with stack exhaustion attacks, not all architectures have those features, so getting rid of VLAs makes sure we keep a few classes of flaws out of all kernel architectures and configurations. It’s been a long road, and it’s shaping up to be a 4-part saga with the remaining VLA removals landing in the next kernel. For v4.19, several folks continued to help [grind away at the problem](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v4.19&qt=grep&q=VLA+usage): Arnd Bergmann, Kyle Spiers, Laura Abbott, Martin Schwidefsky, Salvatore Mesoraca, and myself.

**shift overflow helper**

Jason Gunthorpe noticed that while the kernel [recently gained add/sub/mul/div helpers to check for arithmetic overflow](/blog/archives/2018/08/20/security-things-in-linux-v4-18/), we didn’t have anything for shift-left. He added [check\_shl\_overflow()](https://git.kernel.org/linus/0c66847793d1982d1083dc6f7adad60fa265ce9c) to round out the toolbox and Leon Romanovsky immediately put it to use to [solve an overflow in RDMA](https://git.kernel.org/linus/0dfe452241f4904de497aef01ad2f609ccb9be90).

*Edit: I forgot to mention this next feature when I first posted:*

**trusted architecture-supported RNG initialization**

The Random Number Generator in the kernel seeds its pools from many entropy sources, including any architecture-specific sources (e.g. x86’s `RDRAND`). Due to many people not wanting to trust the architecture-specific source due to the inability to audit its operation, entropy from those sources was not credited to RNG initialization, which wants to gather “enough” entropy before claiming to be initialized. However, because some systems don’t generate enough entropy at boot time, it was taking a while to gather enough system entropy (e.g. from interrupts) before the RNG became usable, which might block userspace from starting (e.g. `systemd` wants to get early entropy). To help these cases, Ted T’so introduced a [toggle to trust the architecture-specific entropy completely](https://git.kernel.org/linus/39a8883a2b989d1d21bd8dd99f5557f0c5e89694) (i.e. RNG is considered fully initialized as soon as it gets the architecture-specific entropy). To use this, the kernel can be built with `CONFIG_RANDOM_TRUST_CPU=y` (or booted with “`random.trust_cpu=on`“).

That’s it for now; thanks for reading. The merge window is open for [v4.20](/blog/archives/2018/12/24/security-things-in-linux-v4-20/)! Wish us luck. :)

© 2018 – 2022, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v4.19
## August 20, 2018

### [security things in Linux v4.18](https://outflux.net/blog/archives/2018/08/20/security-things-in-linux-v4-18/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 11:29 am

Previously: [v4.17](/blog/archives/2018/06/14/security-things-in-linux-v4-17/).

Linux kernel [v4.18 was released last week](https://lkml.kernel.org/r/CA%2B55aFzos7tr%3DOLju10Oe-z7r%3DeB2dSaFa7vwz2ApGO13B%3Dz_g%40mail.gmail.com). Here are details on some of the security things I found interesting:

**allocation overflow detection helpers**

One of the many ways C can be dangerous to use is that it lacks strong primitives to deal with arithmetic overflow. A developer can’t just wrap a series of calculations in a `try`/`catch` block to trap any calculations that might overflow (or underflow). Instead, C will happily wrap values back around, causing all kinds of flaws. Some time ago GCC added a set of [single-operation helpers](https://gcc.gnu.org/onlinedocs/gcc/Integer-Overflow-Builtins.html) that will efficiently detect overflow, so Rasmus Villemoes suggested [implementing these (with fallbacks)](https://git.kernel.org/linus/f0907827a8a9152aedac2833ed1b674a7b2a44f2) in the kernel. While it still requires explicit use by developers, it’s much more fool-proof than doing open-coded type-sensitive bounds checking before every calculation. As a first-use of these routines, Matthew Wilcox created [wrappers for common size calculations](https://git.kernel.org/linus/610b15c50e86eb1e4b77274fabcaea29ac72d6a8), mainly for use during memory allocations.

**removing open-coded multiplication from memory allocation arguments**

A common flaw in the kernel is integer overflow during memory allocation size calculations. As mentioned above, C doesn’t provide much in the way of protection, so it’s on the developer to get it right. In an effort to reduce the frequency of these bugs, and inspired by a [couple](https://git.kernel.org/linus/353748a359f1821ee934afc579cf04572406b420) [flaws](https://git.kernel.org/linus/9f645bcc566a1e9f921bdae7528a01ced5bc3713) found by Silvio Cesare, I did a first-pass sweep of the kernel to move from open-coded multiplications during memory allocations into either [their 2-factor API counterparts](https://git.kernel.org/linus/6da2ec56059c3c7a7e5f729e6349e74ace1e5c57) (e.g. `kmalloc(a * b, GFP...) -> kmalloc_array(a, b, GFP...)`), or to [use the new overflow-checking helpers](https://git.kernel.org/linus/42bc47b35320e0e587a88e437e18f80f9c5bcbb2) (e.g. `vmalloc(a * b) -> vmalloc(array_size(a, b))`). There’s still lots more work to be done here, since frequently an allocation size will be calculated earlier in a variable rather than in the allocation arguments, and overflows happen in way more places than just memory allocation. Better yet would be to have exceptions raised on overflows where no wrap-around was expected (e.g. [Emese Revfy’s size\_overflow GCC plugin](https://forums.grsecurity.net/viewtopic.php?f=7&t=3043)).

**Variable Length Array removals, part 2**

As [discussed previously](/blog/archives/2018/06/14/security-things-in-linux-v4-17/), VLAs continue to get [removed from the kernel](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v4.18&qt=grep&q=VLA+usage). For v4.18, we continued to get help from a bunch of lovely folks: Andreas Christoforou, Antoine Tenart, Chris Wilson, Gustavo A. R. Silva, Kyle Spiers, Laura Abbott, Salvatore Mesoraca, Stephan Wahren, Thomas Gleixner, Tobin C. Harding, and Tycho Andersen. Almost all the rest of the VLA removals have been queued for v4.19, but it looks like the very last of them (deep in the crypto subsystem) won’t land until v4.20. I’m so looking forward to being able to add `-Wvla` globally to the kernel build so we can be free from the classes of flaws that VLAs enable, like stack exhaustion and stack guard page jumping. Eliminating VLAs also [simplifies the porting work of the stackleak GCC plugin](https://marc.info/?l=kernel-hardening&m=153445789810476) from grsecurity, since it no longer has to hook and check VLA creation.

**Kconfig compiler detection**

While not *strictly* a security thing, Masahiro Yamada made giant improvements to the kernel’s Kconfig subsystem so that kernel build configuration now [knows what compiler you’re using](https://git.kernel.org/linus/2a61f4747eeaa85ce26ca9fbd81421b15facd018) (among other things) so that configuration is no longer separate from the compiler features. For example, in the past, one could select `CONFIG_CC_STACKPROTECTOR_STRONG` even if the compiler didn’t support it, and later the build would fail. Or in other cases, configurations would silently down-grade to what *was* available, potentially leading to confusing kernel images where the compiler would change the meaning of a configuration. Going forward now, configurations that aren’t available to the compiler will simply be unselectable in Kconfig. This makes configuration much more consistent, though in some cases, it makes it harder to discover *why* some configuration is missing (e.g. `CONFIG_GCC_PLUGINS` no longer gives you a hint about needing to install the plugin development packages).

That’s it for now! Please let me know if you think I missed anything. Stay tuned for v4.19; the merge window is open. :)

© 2018, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (2)](https://outflux.net/blog/archives/2018/08/20/security-things-in-linux-v4-18/#comments)
## June 14, 2018

### [security things in Linux v4.17](https://outflux.net/blog/archives/2018/06/14/security-things-in-linux-v4-17/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:23 pm

Previously: [v4.16](/blog/archives/2018/04/12/security-things-in-linux-v4-16/).

Linux kernel [v4.17 was released last week](https://lkml.org/lkml/2018/6/3/142), and here are some of the security things I think are interesting:

**Jailhouse hypervisor**

Jan Kiszka [landed](https://git.kernel.org/linus/cea061e455c88312b86142e68c8fc5b8e1294ca2) [Jailhouse hypervisor](https://github.com/siemens/jailhouse) support, which uses static partitioning (i.e. no resource over-committing), where the root “cell” spawns new jails by shrinking its own CPU/memory/etc resources and hands them over to the new jail. There’s a nice write-up of the hypervisor [on LWN from 2014](https://lwn.net/Articles/578295/).

**Sparc ADI**

Khalid Aziz [landed](https://git.kernel.org/linus/4608f064532c28c0ea3c03fe26a3a5909852811a) the userspace support for Sparc [Application Data Integrity](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/sparc/adi.txt) (ADI or SSM: Silicon Secured Memory), which is the hardware memory coloring (tagging) feature in Sparc M7. I’d love to see this extended into the kernel itself, as it would kill linear overflows between allocations, since the base pointer being used is tagged to belong to only a certain allocation (sized to a multiple of cache lines). Any attempt to increment beyond, into memory with a different tag, raises an exception. Enrico Perla has some great write-ups on [using ADI in allocators](https://lazytyped.blogspot.com/2016/12/hardening-allocators-with-adi.html) and a [comparison of ADI to Intel’s MPX](https://lazytyped.blogspot.com/2016/12/hardware-buffer-overflow-defenses.html).

**new kernel stacks cleared on fork**

It was possible that old memory contents would live in a new process’s kernel stack. While normally not visible, “uninitialized” memory read flaws or read overflows could expose these contents (especially stuff “deeper” in the stack that may never get overwritten for the life of the process). To avoid this, I made sure that [new stacks were always zeroed](https://git.kernel.org/linus/e01e80634ecdde1dd113ac43b3adad21b47f3957). Oddly, this “priming” of the cache appeared to actually improve performance, though it was mostly in the noise.

**MAP\_FIXED\_NOREPLACE**

As part of further defense in depth against attacks like [Stack Clash](https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash), Michal Hocko [created `MAP_FIXED_NOREPLACE`](https://git.kernel.org/linus/a4ff8e8620d3f4f50ac4b41e8067b7d395056843). The regular `MAP_FIXED` has a subtle behavior not normally noticed (but used by some, so it couldn’t just be fixed): it will *replace* any overlapping portion of a pre-existing mapping. This means the kernel would silently overlap the stack into mmap or text regions, since `MAP_FIXED` was being used to build a new process’s memory layout. Instead, `MAP_FIXED_NOREPLACE` has all the features of `MAP_FIXED` *without* the replacement behavior: it will fail if a pre-existing mapping overlaps with the newly requested one. The ELF loader has been switched to use `MAP_FIXED_NOREPLACE`, and it’s available to userspace too, for similar use-cases.

**pin stack limit during exec**

I used a big hammer and [pinned the `RLIMIT_STACK` values during exec](https://git.kernel.org/linus/c31dbb146dd44af44bc60780ce8fa7a9f5f746df). There were multiple methods to change the limit (through at least `setrlimit()` and `prlimit()`), and there were multiple places the limit got used to make decisions, so it seemed best to just pin the values for the life of the exec so no games could get played with them. Too much assumed the value wasn’t changing, so better to make that assumption actually true. Hopefully this is the last of the [fixes](https://git.kernel.org/linus/04e35f4495dd560db30c25efca4eecae8ec8c375) for these bad interactions between stack limits and memory layouts during exec (which have all been defensive measures against flaws like [Stack Clash](https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash)).

**Variable Length Array removals start**

Following some discussion over [Alexander Popov’s ongoing port of the stackleak GCC plugin](https://patchwork.kernel.org/project/kernel-hardening/list/?submitter=134511), Linus declared that [Variable Length Arrays (VLAs) should be eliminated from the kernel entirely](https://lkml.kernel.org/r/CA%2B55aFzCG-zNmZwX4A2FQpadafLfEzK6CC%3DqPXydAacU1RqZWA%40mail.gmail.com). This is great because it kills several stack exhaustion attacks, including weird stuff like stepping over guard pages with giant stack allocations. However, with several hundred uses in the kernel, this wasn’t going to be an easy job. Thankfully, a whole bunch of people stepped up to [help out](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v4.17&qt=grep&q=VLA+usage): Gustavo A. R. Silva, Himanshu Jha, Joern Engel, Kyle Spiers, Laura Abbott, Lorenzo Bianconi, Nikolay Borisov, Salvatore Mesoraca, Stephen Kitt, Takashi Iwai, Tobin C. Harding, and Tycho Andersen. With Linus Torvalds and Martin Uecker, I also helped [rewrite the `max()` macro](https://lwn.net/Articles/749064/) to [eliminate false positives](https://git.kernel.org/linus/3c8ba0d61d04ced9f8d9ff93977995a9e4e96e91) seen by the `-Wvla` compiler option. Overall, about 1/3rd of the VLA instances were solved for v4.17, with many more coming for v4.18. I’m hoping we’ll have entirely eliminated VLAs by the time v4.19 ships.

*Edit: I missed this next feature when I first published this post:*

**syscall register clearing, x86**

One of the ways attackers can influence potential speculative execution flaws in the kernel is to leak information into the kernel via “unused” register contents. Most syscalls take only a few arguments, so all the other [calling-convention-defined registers](http://man7.org/linux/man-pages/man2/syscall.2.html#NOTES) can be cleared instead of just left with whatever contents they had in userspace. As it turns out, clearing registers is very fast. Dominik Brodowski expanded a proof-of-concept from Linus Torvalds into a full [register-clearing syscall wrapper on x86](https://git.kernel.org/linus/fa697140f9a20119a9ec8fd7460cc4314fbdaff3).

That’s it for now! Please let me know if you think I missed anything. Stay tuned for [v4.18](/blog/archives/2018/08/20/security-things-in-linux-v4-18/); the merge window is open. :)

© 2018, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v4.17
## April 19, 2018

### [UEFI booting and RAID1](https://outflux.net/blog/archives/2018/04/19/uefi-booting-and-raid1/)

Filed under: [Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 5:34 pm

I spent some time yesterday building out a UEFI server that didn’t have on-board hardware RAID for its system drives. In these situations, I always use Linux’s `md` RAID1 for the root filesystem (and/or `/boot`). This worked well for BIOS booting since BIOS just transfers control blindly to the MBR of whatever disk it sees (modulo finding a “bootable partition” flag, etc, etc). This means that BIOS doesn’t really care what’s on the drive, it’ll hand over control to the GRUB code in the MBR.

With UEFI, the boot firmware is actually examining the GPT partition table, looking for the partition marked with the “EFI System Partition” (ESP) UUID. Then it looks for a FAT32 filesystem there, and does more things like looking at NVRAM boot entries, or just running `BOOT/EFI/BOOTX64.EFI` from the FAT32. Under Linux, this `.EFI` code is either GRUB itself, or Shim which loads GRUB.

So, if I want RAID1 for my root filesystem, that’s fine (GRUB will read `md`, LVM, etc), but how do I handle `/boot/efi` (the UEFI ESP)? In everything I found answering this question, the answer was “oh, just manually make an ESP on each drive in your RAID and copy the files around, add a separate NVRAM entry (with `efibootmgr`) for each drive, and you’re fine!” I did not like this one bit since it meant things could get out of sync between the copies, etc.

The current implementation of Linux’s `md` RAID puts metadata at the *front* of a partition. This solves more problems than it creates, but it means the RAID isn’t “invisible” to something that doesn’t know about the metadata. In fact, `mdadm` warns about this pretty loudly:

```

> # mdadm --create /dev/md0 --level 1 --raid-disks 2 /dev/sda1 /dev/sdb1
> mdadm: Note: this array has metadata at the start and
>     may not be suitable as a boot device.  If you plan to
>     store '/boot' on this device please ensure that
>     your boot-loader understands md/v1.x metadata, or use
>     --metadata=0.90

```

Reading from the mdadm man page:

```

> -e, --metadata=
> ...
>           1, 1.0, 1.1, 1.2 default
>                  Use  the new version-1 format superblock.  This has fewer
>                  restrictions.  It can easily be moved between hosts  with
>                  different  endian-ness,  and  a recovery operation can be
>                  checkpointed and restarted.  The  different  sub-versions
>                  store  the  superblock  at  different  locations  on  the
>                  device, either at the end (for 1.0), at  the  start  (for
>                  1.1)  or  4K from the start (for 1.2).  "1" is equivalent
>                  to "1.2" (the commonly preferred 1.x format).   "default"
>                  is equivalent to "1.2".

```

First we toss a FAT32 on the RAID (`mkfs.fat -F32 /dev/md0`), and looking at the results, the first 4K is entirely zeros, and `file` doesn’t see a filesystem:

```

> # dd if=/dev/sda1 bs=1K count=5 status=none | hexdump -C
> 00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
> *
> 00001000  fc 4e 2b a9 01 00 00 00  00 00 00 00 00 00 00 00  |.N+.............|
> ...
> # file -s /dev/sda1
> /dev/sda1: Linux Software RAID version 1.2 ...

```

So, instead, we’ll use `--metadata 1.0` to put the RAID metadata at the end:

```

> # mdadm --create /dev/md0 --level 1 --raid-disks 2 --metadata 1.0 /dev/sda1 /dev/sdb1
> ...
> # mkfs.fat -F32 /dev/md0
> # dd if=/dev/sda1 bs=1 skip=80 count=16 status=none | xxd
> 00000000: 2020 4641 5433 3220 2020 0e1f be77 7cac    FAT32   ...w|.
> # file -s /dev/sda1
> /dev/sda1: ... FAT (32 bit)

```

Now we have a visible FAT32 filesystem on the ESP. UEFI should be able to boot whatever disk hasn’t failed, and `grub-install` will write to the RAID mounted at `/boot/efi`.

However, we’re left with a new problem: on (at least) Debian and Ubuntu, `grub-install` attempts to run `efibootmgr` to record which disk UEFI should boot from. This fails, though, since it [expects a single disk](https://bugs.launchpad.net/ubuntu/%2Bsource/grub2/%2Bbug/1765484), not a RAID set. In fact, it returns *nothing*, and tries to run `efibootmgr` with an empty `-d` argument:

```

> Installing for x86_64-efi platform.
> efibootmgr: option requires an argument -- 'd'
> ...
> grub-install: error: efibootmgr failed to register the boot entry: Operation not permitted.
> Failed: grub-install --target=x86_64-efi
> WARNING: Bootloader is not properly installed, system may not be bootable

```

Luckily my UEFI boots without NVRAM entries, and I can disable the NVRAM writing via the “Update NVRAM variables to automatically boot into Debian?” debconf prompt when running: `dpkg-reconfigure -p low grub-efi-amd64`

So, now my system will boot with both or either drive present, and updates from Linux to `/boot/efi` are visible on all RAID members at boot-time. **HOWEVER** there is one nasty risk with this setup: if UEFI writes anything to one of the drives (which this firmware *did* when it wrote out a “boot variable cache” file), it may lead to corrupted results once Linux mounts the RAID (since the member drives won’t have identical block-level copies of the FAT32 any more).

To deal with this “external write” situation, I see some solutions:

* Make the partition read-only when not under Linux. (I don’t think this is a thing.)
* Create higher-level knowledge of the root-filesystem RAID configuration is needed to keep a collection of filesystems manually synchronized instead of doing block-level RAID. (Seems like a lot of work and would need redesign of `/boot/efi` into something like `/boot/efi/booted`, `/boot/efi/spare1`, `/boot/efi/spare2`, etc)
* Prefer one RAID member’s copy of `/boot/efi` and rebuild the RAID at every boot. If there were no external writes, there’s no issue. (Though what’s really the right way to pick the copy to prefer?)

Since `mdadm` has the “`--update=resync`” assembly option, I can actually do the latter option. This required updating `/etc/mdadm/mdadm.conf` to add [`<ignore>` on the RAID’s `ARRAY` line](https://manpages.ubuntu.com/mdadm.conf) to keep it from auto-starting:

```

> ARRAY <ignore> metadata=1.0 UUID=123...

```

(Since it’s ignored, I’ve chosen `/dev/md100` for the manual assembly below.) Then I added the `noauto` option to the `/boot/efi` entry in `/etc/fstab`:

```

> /dev/md100 /boot/efi vfat noauto,defaults 0 0

```

And finally I added a `systemd` oneshot service that assembles the RAID with resync and mounts it:

```

> [Unit]
> Description=Resync /boot/efi RAID
> DefaultDependencies=no
> After=local-fs.target
>
> [Service]
> Type=oneshot
> ExecStart=/sbin/mdadm -A /dev/md100 --uuid=123... --update=resync
> ExecStart=/bin/mount /boot/efi
> RemainAfterExit=yes
>
> [Install]
> WantedBy=sysinit.target

```

(And don’t forget to run “`update-initramfs -u`” so the initramfs has an updated copy of `/dev/mdadm/mdadm.conf`.)

If `mdadm.conf` supported an “`update=`” option for `ARRAY` lines, this would have been trivial. Looking at the source, though, that kind of change doesn’t look easy. I can dream!

And if I wanted to keep a “pristine” version of `/boot/efi` that UEFI couldn’t update I could rearrange things more dramatically to keep the primary RAID member as a loopback device on a file in the root filesystem (e.g. `/boot/efi.img`). This would make all external changes in the real ESPs disappear after resync. Something like:

```

> # truncate --size 512M /boot/efi.img
> # losetup -f --show /boot/efi.img
> /dev/loop0
> # mdadm --create /dev/md100 --level 1 --raid-disks 3 --metadata 1.0 /dev/loop0 /dev/sda1 /dev/sdb1

```

And at boot just rebuild it from `/dev/loop0`, though I’m not sure how to “prefer” that partition…

Notes: commands I used to muck with grub-install:

* `echo "grub-pc grub2/update_nvram boolean false" | debconf-set-selections`
* `echo "grub-pc grub-efi/install_devices multiselect /dev/md0" | debconf-set-selections && dpkg-reconfigure -p low grub-efi-amd64-signed`

Update: Ubuntu Focal 20.04 now provides a way for GRUB to install to an arbitrary collection of devices, so no RAID needed. Whew.

© 2018 – 2020, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (5)](https://outflux.net/blog/archives/2018/04/19/uefi-booting-and-raid1/#comments)
## April 12, 2018

### [security things in Linux v4.16](https://outflux.net/blog/archives/2018/04/12/security-things-in-linux-v4-16/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 5:04 pm

Previously: [v4.15](/blog/archives/2018/02/05/security-things-in-linux-v4-15/).

￼

Linux kernel [v4.16 was released](https://lkml.org/lkml/2018/4/1/175) last week. I really should write these posts in advance, otherwise I get distracted by the merge window. Regardless, here are some of the security things I think are interesting:

**KPTI on arm64**

Will Deacon, Catalin Marinas, and several other folks brought [Kernel Page Table Isolation](/blog/archives/2018/02/05/security-things-in-linux-v4-15/) (via [`CONFIG_UNMAP_KERNEL_AT_EL0`](https://git.kernel.org/linus/0aebc6a440b942df6221a7765f077f02217e0114)) to arm64. While most ARMv8+ CPUs were not vulnerable to the primary Meltdown flaw, the [Cortex-A75](https://developer.arm.com/support/security-update) does need KPTI to be safe from memory content leaks. It’s worth noting, though, that KPTI does protect other ARMv8+ CPU models from having [privileged register contents exposed](https://github.com/lgeek/spec_poc_arm). So, whatever your threat model, it’s very nice to have this clean isolation between kernel and userspace page tables for all ARMv8+ CPUs.

**hardened usercopy whitelisting**

While whole-object bounds checking was implemented in [CONFIG\_HARDENED\_USERCOPY already](/blog/archives/2016/10/04/security-things-in-linux-v4-8/), David Windsor and I finished another part of the porting work of grsecurity’s PAX\_USERCOPY protection: [usercopy whitelisting](https://git.kernel.org/linus/afcc90f8621e289cd082ba97900e76f01afe778c). This further tightens the scope of slab allocations that can be copied to/from userspace. Now, instead of allowing all objects in slab memory to be copied, only the whitelisted areas (where a subsystem has specifically marked the memory region allowed) can be copied. For example, only the [auxv array out of the larger mm\_struct](https://git.kernel.org/linus/07dcd7fe89938934ddad65f738bc5aac89b8e54d).

As mentioned in the [first commit from the series](https://git.kernel.org/linus/8eb8284b412906181357c2b0110d879d5af95e52), this reduces the scope of slab memory that could be copied out of the kernel in the face of a bug to under 15%. As can be seen, one area of work remaining are the `kmalloc` regions. Those are regularly used for copying things in and out of userspace, but they’re also used for small simple allocations that aren’t meant to be exposed to userspace. Working to separate these `kmalloc` users needs some careful auditing.

```

> Total Slab Memory:           48074720
> Usercopyable Memory:          6367532  13.2%
>          task_struct                    0.2%         4480/1630720
>          RAW                            0.3%            300/96000
>          RAWv6                          2.1%           1408/64768
>          ext4_inode_cache               3.0%       269760/8740224
>          dentry                        11.1%       585984/5273856
>          mm_struct                     29.1%         54912/188448
>          kmalloc-8                    100.0%          24576/24576
>          kmalloc-16                   100.0%          28672/28672
>          kmalloc-32                   100.0%          81920/81920
>          kmalloc-192                  100.0%          96768/96768
>          kmalloc-128                  100.0%        143360/143360
>          names_cache                  100.0%        163840/163840
>          kmalloc-64                   100.0%        167936/167936
>          kmalloc-256                  100.0%        339968/339968
>          kmalloc-512                  100.0%        350720/350720
>          kmalloc-96                   100.0%        455616/455616
>          kmalloc-8192                 100.0%        655360/655360
>          kmalloc-1024                 100.0%        812032/812032
>          kmalloc-4096                 100.0%        819200/819200
>          kmalloc-2048                 100.0%      1310720/1310720

```

This series took quite a while to land (you can see David’s original patch date as back in June of last year). Partly this was due to having to spend a lot of time researching the code paths so that each whitelist could be explained for commit logs, partly due to making various adjustments from maintainer feedback, and partly due to the short merge window in v4.15 (when it was originally proposed for merging) combined with some last-minute glitches that made Linus nervous. After baking in `linux-next` for almost two full development cycles, it finally landed. (Though be sure to *disable* `CONFIG_HARDENED_USERCOPY_FALLBACK` to gain enforcement of the whitelists — by default it only warns and falls back to the full-object checking.)

**automatic stack-protector**

While the stack-protector features of the kernel have existed for quite some time, it has never been enabled by default. This was mainly due to needing to evaluate compiler support for the feature, and `Kconfig` didn’t have a way to check the compiler features before offering `CONFIG_*` options. As a defense technology, the stack protector is pretty mature. Having it on by default would have greatly reduced the impact of things like the [BlueBorne](https://www.armis.com/blueborne/) attack (CVE-2017-1000251), as fewer systems would have lacked the defense.

After spending quite a bit of time [fighting](https://patchwork.kernel.org/patch/10012347/) with ancient compiler versions (\*cough\*GCC 4.4.4\*cough\*), I landed [`CONFIG_CC_STACKPROTECTOR_AUTO`](https://git.kernel.org/linus/44c6dc940b190cf22b044a784f3e00a7e7f08b2f), which is default on, and tries to use the stack protector if it is available. The implementation of the solution, however, did not please Linus, though he allowed it to be merged. In the future, [Kconfig will gain the knowledge to make better decisions](https://patchwork.kernel.org/patch/10309269/) which lets the kernel expose the availability of (the now default) stack protector directly in `Kconfig`, rather than depending on rather ugly `Makefile` hacks.

**execute-only memory for PowerPC**

Similar to the Protection Keys ([pkeys](http://man7.org/linux/man-pages/man7/pkeys.7.html)) hardware support that landed in [v4.6 for x86](/blog/archives/2016/09/30/security-things-in-linux-v4-6/), Ram Pai landed [pkeys support for Power7/8/9](https://git.kernel.org/linus/03f51d4efa2287cc628bb20b0c032036d2a9e66a). This should expand the scope of what’s possible in the dynamic loader to avoid having arbitrary read flaws allow an exploit to read out all of executable memory in order to find ROP gadgets.

That’s it for now; let me know if you think I should add anything! The [v4.17](https://outflux.net/blog/archives/2018/06/14/security-things-in-linux-v4-17/) merge window is open. :)

*Edit*: added details on ARM register leaks, thanks to Daniel Micay.

*Edit*: added section on protection keys for POWER, thanks to Florian Weimer.

© 2018 – 2019, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (2)](https://outflux.net/blog/archives/2018/04/12/security-things-in-linux-v4-16/#comments)
## February 5, 2018

### [security things in Linux v4.15](https://outflux.net/blog/archives/2018/02/05/security-things-in-linux-v4-15/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 3:45 pm

Previously: [v4.14](/blog/archives/2017/11/14/security-things-in-linux-v4-14/).

Linux kernel [v4.15 was released](https://lkml.org/lkml/2018/1/28/173) last week, and there’s a bunch of security things I think are interesting:

**Kernel Page Table Isolation**

[PTI](https://git.kernel.org/linus/385ce0ea4c078517fa51c261882c4e72fba53005) has already gotten [plenty](https://lwn.net/Articles/744287/) of [reporting](http://kroah.com/log/blog/2018/01/06/meltdown-status/), but to summarize, it is mainly to protect against CPU cache timing side-channel attacks that can expose kernel memory contents to userspace ([CVE-2017-5754](https://googleprojectzero.blogspot.com/2018/01/reading-privileged-memory-with-side.html), the speculative execution “rogue data cache load” or “Meltdown” flaw).

Even for just x86\_64 (as `CONFIG_PAGE_TABLE_ISOLATION`), this was a giant amount of work, and [tons of people helped with it](https://lkml.org/lkml/2018/1/8/42) over several months. PowerPC also had [mitigations land](https://git.kernel.org/linus/aa8a5e0062ac940f7659394f4817c948dc8c0667), and [arm64 (as `CONFIG_UNMAP_KERNEL_AT_EL0`) will have PTI in v4.16](https://git.kernel.org/linus/0aebc6a440b942df6221a7765f077f02217e0114) (though only the [Cortex-A75 is vulnerable](https://developer.arm.com/support/security-update)). For anyone with *really* old hardware, [x86\_32](https://lkml.org/lkml/2018/1/16/668) is under development, too.

An additional benefit of the x86\_64 PTI is that since there are now two copies of the page tables, the kernel-mode copy of the userspace mappings can be [marked entirely non-executable](/blog/archives/2018/01/04/smep-emulation-in-pti/), which means pre-SMEP hardware now gains SMEP emulation. Kernel exploits that try to jump into userspace memory to continue running malicious code are dead (even if the attacker manages to turn SMEP off first). With some more work, SMAP emulation could also be introduced (to stop even just *reading* malicious userspace memory), which would close the door on these common attack vectors. It’s worth noting that arm64 has had the equivalent (PAN emulation) since [v4.10](/blog/archives/2017/02/27/security-things-in-linux-v4-10/).

**retpoline**

In addition to the PTI work above, the [retpoline](https://support.google.com/faqs/answer/7625886) kernel [mitigations](https://git.kernel.org/linus/40548c6b6c134275c750eb372dc2cf8ee1bbc3d4) for [CVE-2017-5715](https://googleprojectzero.blogspot.com/2018/01/reading-privileged-memory-with-side.html) (“branch target injection” or “Spectre variant 2”) started landing. (Note that to gain full retpoline support, you’ll need a patched compiler, as appearing in [gcc 7.3/8+](https://gcc.gnu.org/ml/gcc-patches/2018-01/msg00422.html), and currently queued for release in [clang](https://reviews.llvm.org/D41723).)

This work continues to evolve, and clean-ups are continuing into v4.16. Also in v4.16 we’ll start to see [mitigations](https://git.kernel.org/linus/35277995e17919ab838beae765f440674e8576eb) for the other speculative execution variant (i.e. [CVE-2017-5753](https://googleprojectzero.blogspot.com/2018/01/reading-privileged-memory-with-side.html), “bounds check bypass” or “Spectre variant 1”).

**x86 fast refcount\_t overflow protection**

In v4.13 the [`CONFIG_REFCOUNT_FULL`](/blog/archives/2017/09/05/security-things-in-linux-v4-13/) code was added to stop many types of reference counting flaws (with a tiny performance loss). In v4.14 the [infrastructure for a fast overflow-only `refcount_t` protection on x86](https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git/commit/?id=7a46ec0e2f4850407de5e1d19a44edee6efa58ec) (based on grsecurity’s PAX\_REFCOUNT) landed, but it was disabled at the last minute due to a bug that was finally [fixed in v4.15](https://git.kernel.org/linus/564c9cc84e2adf8a6671c1937f0a9fe3da2a4b0e). Since it was a tiny change, the fast `refcount_t` protection was backported and enabled for the [Longterm maintenance kernel](https://www.kernel.org/category/releases.html) in [v4.14.5](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git/commit/?id=bef9bcf53789a454f54adf01c654650189628ab0). Conversions from `atomic_t` to `refcount_t` have also continued, and are now [above 168](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v4.15&qt=grep&q=refcount_t), with a handful remaining.

**%p hashing**

One of the many sources of kernel information exposures has been the use of the `%p` [format string](https://en.wikipedia.org/wiki/Printf_format_string) specifier. The strings end up in all kinds of places (`dmesg`, `/sys` files, `/proc` files, etc), and usage is scattered through-out the kernel, which had made it a very hard exposure to fix. [Earlier efforts](https://lwn.net/Articles/420403/) like `kptr_restrict`‘s `%pK` didn’t really work since it was opt-in. While a few recent attempts (by William C Roberts, Greg KH, and others) had been made to provide toggles for `%p` to act like `%pK`, Linus finally stepped in and declared that `%p` should be used so rarely that it shouldn’t used at all, and Tobin Harding took on the task of finding the right path forward, which resulted in [%p output getting hashed with a per-boot secret](https://git.kernel.org/linus/ad67b74d2469d9b82aaa572d76474c95bc484d57). The result is that simple debugging continues to work (two reports of the same hash value can confirm the same address without saying what the address actually is) but frustrates attacker’s ability to use such information exposures as building blocks for exploits.

For developers needing an unhashed `%p`, [`%px` was introduced](https://git.kernel.org/linus/7b1924a1d930eb27fc79c4e4e2a6c1c970623e68) but, as [Linus cautioned](https://www.spinics.net/lists/kernel/msg2671068.html), either your `%p` remains useful when hashed, your `%p` was never actually useful to begin with and should be removed, or you need to strongly justify using `%px` with sane permissions.

It remains to be seen if we’ve just kicked the information exposure can down the road and in 5 years we’ll be fighting with `%px` and `%lx`, but hopefully the attitudes about such exposures will have changed enough to better guide developers and their code.

**struct timer\_list refactoring**

The kernel’s timer (`struct timer_list`) infrastructure is, unsurprisingly, used to create callbacks that execute after a certain amount of time. They are one of the more fundamental pieces of the kernel, and as such have existed for a very long time, with over 1000 call sites. Improvements to the API have been made over time, but old ways of doing things have stuck around. Modern callbacks in the kernel take an argument pointing to the structure associated with the callback, so that a callback has context for which instance of the callback has been triggered. The timer callbacks didn’t, and took an `unsigned long` that was cast back to whatever arbitrary context the code setting up the timer wanted to associate with the callback, and this variable was stored in `struct timer_list` along with the function pointer for the callback. This creates an opportunity for an attacker looking to exploit a memory corruption vulnerability (e.g. heap overflow), where they’re able to overwrite not only the function pointer, but also the argument, as stored in memory. This elevates the attack into a weak ROP, and has been used as the basis for [disabling SMEP in modern exploits (see `retire_blk_timer`)](https://googleprojectzero.blogspot.com/2017/05/exploiting-linux-kernel-via-packet.html). To remove this weakness in the kernel’s design, I [refactored the timer callback API](https://git.kernel.org/linus/c1eba5bcb6430868427e0b9d1cd1205a07302f06) and [and all its callers](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v4.15&qt=grep&q=Convert+timers+to+use+timer_setup), for a whopping:

> 1128 files changed, 4834 insertions(+), 5926 deletions(-)

Another benefit of the refactoring is that once the kernel starts getting built by compilers with [Control Flow Integrity](https://en.wikipedia.org/wiki/Control-flow_integrity) support, timer callbacks won’t be lumped together with all the other functions that take a single `unsigned long` argument. (In other words, some CFI implementations wouldn’t have caught the kind of attack described above since the attacker’s target function still matched its original prototype.)

That’s it for now; please let me know if I missed anything. The [v4.16](/blog/archives/2018/04/12/security-things-in-linux-v4-16/) merge window is now open!

© 2018 – 2021, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (3)](https://outflux.net/blog/archives/2018/02/05/security-things-in-linux-v4-15/#comments)
## January 4, 2018

### [SMEP emulation in PTI](https://outflux.net/blog/archives/2018/01/04/smep-emulation-in-pti/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 1:43 pm

An nice additional benefit of the recent [Kernel Page Table Isolation](https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git/commit/?h=x86/pti&id=385ce0ea4c078517fa51c261882c4e72fba53005) (`CONFIG_PAGE_TABLE_ISOLATION`) patches (to defend against [CVE-2017-5754](https://googleprojectzero.blogspot.com/2018/01/reading-privileged-memory-with-side.html), the speculative execution “rogue data cache load” or “Meltdown” flaw) is that the userspace page tables visible while running in kernel mode [lack the executable bit](https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git/commit/?h=x86/pti&id=1c4de1ff4fe50453b968579ee86fac3da80dd783). As a result, systems without the SMEP CPU feature (before Ivy-Bridge) get it emulated for “free”.

Here’s a non-SMEP system with PTI disabled (booted with “`pti=off`“), running the `EXEC_USERSPACE` LKDTM test:

> ```
>
> # grep smep /proc/cpuinfo
> # dmesg -c | grep isolation
> [    0.000000] Kernel/User page tables isolation: disabled on command line.
> # cat <(echo EXEC_USERSPACE) > /sys/kernel/debug/provoke-crash/DIRECT
> # dmesg
> [   17.883754] lkdtm: Performing direct entry EXEC_USERSPACE
> [   17.885149] lkdtm: attempting ok execution at ffffffff9f6293a0
> [   17.886350] lkdtm: attempting bad execution at 00007f6a2f84d000
>
> ```

No crash! The kernel was happily executing userspace memory.

But with PTI enabled:

> ```
>
> # grep smep /proc/cpuinfo
> # dmesg -c | grep isolation
> [    0.000000] Kernel/User page tables isolation: enabled
> # cat <(echo EXEC_USERSPACE) > /sys/kernel/debug/provoke-crash/DIRECT
> Killed
> # dmesg
> [   33.657695] lkdtm: Performing direct entry EXEC_USERSPACE
> [   33.658800] lkdtm: attempting ok execution at ffffffff926293a0
> [   33.660110] lkdtm: attempting bad execution at 00007f7c64546000
> [   33.661301] BUG: unable to handle kernel paging request at 00007f7c64546000
> [   33.662554] IP: 0x7f7c64546000
> ...
>
> ```

It should only take a little more work to leave the userspace page tables entirely unmapped while in kernel mode, and only map them in during `copy_to_user()`/`copy_from_user()` as ARM already does with `ARM64_SW_TTBR0_PAN` (or `CONFIG_CPU_SW_DOMAIN_PAN` on arm32).

© 2018, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (3)](https://outflux.net/blog/archives/2018/01/04/smep-emulation-in-pti/#comments)
## November 14, 2017

### [security things in Linux v4.14](https://outflux.net/blog/archives/2017/11/14/security-things-in-linux-v4-14/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 9:23 pm

Previously: [v4.13](/blog/archives/2017/09/05/security-things-in-linux-v4-13/).

Linux kernel v4.14 was [released](https://lkml.org/lkml/2017/11/12/123) this last Sunday, and there’s a bunch of security things I think are interesting:

**vmapped kernel stack on arm64**

Similar to the [same feature on x86](/blog/archives/2016/12/12/security-things-in-linux-v4-9/), Mark Rutland and Ard Biesheuvel [implemented](https://git.kernel.org/linus/872d8327ce8982883b8237b2c320c8666f14e561) `CONFIG_VMAP_STACK` for arm64, which moves the kernel stack to an isolated and guard-paged vmap area. With traditional stacks, there were two major risks when exhausting the stack: overwriting the `thread_info` structure (which contained the `addr_limit` field which is checked during `copy_to/from_user()`), and overwriting neighboring stacks (or other things allocated next to the stack). While arm64 [previously moved its thread\_info off the stack](/blog/archives/2017/02/27/security-things-in-linux-v4-10/) to deal with the former issue, this vmap change adds the last bit of protection by nature of the vmap guard pages. If the kernel tries to write past the end of the stack, it will hit the guard page and fault. (Testing for this is now possible via LKDTM’s [`STACK_GUARD_PAGE_LEADING/TRAILING` tests](https://git.kernel.org/linus/7b25a85c9d9f796c5be7ad3fb8b9553d3e2ed958).)

One aspect of the guard page protection that will need further attention (on all architectures) is that if the stack grew because of a giant Variable Length Array on the stack (effectively an implicit `alloca()` call), it might be possible to jump over the guard page entirely (as seen in the userspace [Stack Clash](https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash) attacks). Thankfully the use of VLAs is rare in the kernel. In the future, hopefully we’ll see the addition of [PaX/grsecurity’s STACKLEAK](http://www.openwall.com/lists/kernel-hardening/2017/10/22/1) plugin which, in addition to its primary purpose of clearing the kernel stack on return to userspace, makes sure stack expansion cannot skip over guard pages. This “stack probing” ability will [likely also become directly available from the compiler](https://developers.redhat.com/blog/2017/09/25/stack-clash-mitigation-gcc-background/) as well.

**`set_fs()` balance checking**

Related to the `addr_limit` field mentioned above, another class of bug is finding a way to force the kernel into accidentally leaving `addr_limit` open to kernel memory through an unbalanced call to `set_fs()`. In some areas of the kernel, in order to reuse userspace routines (usually VFS or compat related), code will do something like: `set_fs(KERNEL_DS); ...some code here...; set_fs(USER_DS);`. When the `USER_DS` call goes missing (usually due to a buggy [error path](https://bugs.chromium.org/p/project-zero/issues/detail?id=990) or [exception](http://vulnfactory.org/exploits/full-nelson.c)), subsequent system calls can suddenly start writing into kernel memory via `copy_to_user` (where the “to user” really means “within the `addr_limit` range”).

Thomas Garnier [implemented USER\_DS checking](https://git.kernel.org/linus/5ea0727b163cb5575e36397a12eade68a1f35f24) at syscall exit time for x86, [arm](https://git.kernel.org/linus/e33f8d32677fa4f4f8996ef46748f86aac81ccff), and [arm64](https://git.kernel.org/linus/cf7de27ab35172a9240f079477cae3146a182998) (with a small [fix](https://git.kernel.org/linus/a2048e34d4655c06d31400646ae495bbfeb16b27)). This means that a broken `set_fs()` setting will not extend beyond the buggy syscall that fails to set it back to `USER_DS`. Additionally, as part of the discussion on the best way to deal with this feature, Christoph Hellwig and Al Viro (and others) have been making [extensive changes](https://git.kernel.org/linus/581bfce969cbfc7ce43ee92273be9cb7c3fdfa61) to avoid the need for `set_fs()` being used at all, which should greatly reduce the number of places where it might be possible to introduce such a bug in the future.

**SLUB freelist hardening**

A common class of heap attacks is [overwriting the freelist pointers](http://resources.infosecinstitute.com/exploiting-linux-kernel-heap-corruptions-slub-allocator/) stored inline in the unallocated SLUB cache objects. PaX/grsecurity developed an inexpensive defense that XORs the freelist pointer with a global random value (and the storage address). Daniel Micay improved on this by using a per-cache random value, and I refactored the code a bit more. The [resulting feature](https://git.kernel.org/linus/2482ddec670fb83717d129012bc558777cb159f7), enabled with `CONFIG_SLAB_FREELIST_HARDENED`, makes freelist pointer overwrites very hard to exploit unless an attacker has found a way to expose both the random value and the pointer location. This should render blind heap overflow bugs much more difficult to exploit.

Additionally, Alexander Popov implemented a [simple double-free defense](https://git.kernel.org/linus/ce6fa91b93630396ca220c33dd38ffc62686d499), similar to the [“fasttop”](https://sourceware.org/git/?p=glibc.git;a=blob;f=malloc/malloc.c;h=be472b2ba3885b194f55c29474c4ad5d6a61b729;hb=eefa3be8e4c2c721a9f277d8ea2e11180231829f#l3817) check in the GNU C library, which will catch sequential `free()`s of the same pointer. (And has already [uncovered a bug](https://bugzilla.kernel.org/show_bug.cgi?id=197515).)

Future work would be to provide similar metadata protections to the SLAB allocator (though [SLAB doesn’t store its freelist within the individual unused objects](http://events.linuxfoundation.org/sites/events/files/slides/slaballocators.pdf), so it has a different set of exposures compared to SLUB).

**setuid-exec stack limitation**

Continuing the various additional defenses to protect against future problems related to userspace memory layout manipulation (as shown most recently in the [Stack Clash](https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash) attacks), I implemented [an 8MiB stack limit](https://git.kernel.org/linus/64701dee4178eb4a771b8b36cd86560f5b0e2460) for privileged (i.e. setuid) execs, inspired by a similar protection in grsecurity, after reworking the secureexec handling by LSMs. This complements the [unconditional limit to the size of exec arguments](https://git.kernel.org/linus/da029c11e6b12f321f36dac8771e833b65cec962) that landed in v4.13.

**randstruct automatic struct selection**

While the bulk of the port of the [randstruct gcc plugin](/blog/archives/2017/09/05/security-things-in-linux-v4-13/) from grsecurity landed in v4.13, the last of the work needed to [enable automatic struct selection](https://git.kernel.org/linus/9225331b310821760f39ba55b00b8973602adbb5) landed in v4.14. This means that the coverage of randomized structures, via `CONFIG_GCC_PLUGIN_RANDSTRUCT`, now includes one of the major targets of exploits: function pointer structures. Without knowing the build-randomized location of a callback pointer an attacker needs to overwrite in a structure, exploits become much less reliable.

**structleak passed-by-reference variable initialization**

Ard Biesheuvel [enhanced the structleak gcc plugin](https://git.kernel.org/linus/f7dd2507893cc3425d3ffc2369559619960befb0) to initialize all variables on the stack that are passed by reference when built with `CONFIG_GCC_PLUGIN_STRUCTLEAK_BYREF_ALL`. Normally the compiler will yell if a variable is used before being initialized, but it silences this warning if the variable’s address is passed into a function call first, as it has no way to tell if the function did actually initialize the contents. So the plugin now zero-initializes such variables (if they hadn’t already been initialized) before the function call that takes their address. Enabling this feature has a small performance impact, but solves many stack content exposure flaws. (In fact at least [one such flaw](https://lkml.org/lkml/2017/10/31/609) reported during the v4.15 development cycle was mitigated by this plugin.)

**improved boot entropy**

Laura Abbott and Daniel Micay improved early boot entropy available to the stack protector by both [moving the stack protector setup later in the boot](https://git.kernel.org/linus/121388a31362b0d3176dc1190ac8064b98a61b20), and including the [kernel command line in boot entropy collection](https://git.kernel.org/linus/33d72f3822d7ff8a9e45bd7413c811085cb87aa5) (since with some devices it changes on each boot).

**eBPF JIT for 32-bit ARM**

The ARM BPF JIT had been around a while, but it didn’t support eBPF (and, as a result, did not provide [constant value blinding](/blog/archives/2016/10/03/security-things-in-linux-v4-7/), which meant it was exposed to being used by an attacker to build arbitrary machine code with BPF constant values). Shubham Bansal spent a bunch of time building a [full eBPF JIT for 32-bit ARM](https://git.kernel.org/linus/39c13c204bb1150d401e27d41a9d8b332be47c49) which both speeds up eBPF and brings it up to date on JIT exploit defenses in the kernel.

**seccomp improvements**

Tyler Hicks addressed a long-standing deficiency in how seccomp could log action results. In addition to creating a way to [mark a specific seccomp filter](https://git.kernel.org/linus/e66a39977985b1e69e17c4042cb290768eca9b02) as needing to be logged with `SECCOMP_FILTER_FLAG_LOG`, he added a new action result, [`SECCOMP_RET_LOG`](https://git.kernel.org/linus/59f5cf44a38284eb9e76270c786fb6cc62ef8ac4). With these changes in place, it should be much easier for developers to inspect the results of seccomp filters, and for process launchers to generate logs for their child processes operating under a seccomp filter.

Additionally, I finally found a way to implement an often-requested feature for seccomp, which was to kill an entire process instead of just the offending thread. This was done by creating the `SECCOMP_RET_ACTION_FULL` mask (née `SECCOMP_RET_ACTION`) and implementing [`SECCOMP_RET_KILL_PROCESS`](https://git.kernel.org/linus/0466bdb99e8744bc9befa8d62a317f0fd7fd7421).

That’s it for now; please let me know if I missed anything. The [v4.15](/blog/archives/2018/02/05/security-things-in-linux-v4-15/) merge window is now open!

© 2017 – 2019, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

Comments Off on security things in Linux v4.14
## September 5, 2017

### [security things in Linux v4.13](https://outflux.net/blog/archives/2017/09/05/security-things-in-linux-v4-13/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 4:01 pm

Previously: [v4.12](/blog/archives/2017/07/10/security-things-in-linux-v4-12/).

Here’s a short summary of some of interesting security things in Sunday’s v4.13 release of the Linux kernel:

**security documentation ReSTification**

The kernel has been switching to formatting documentation with [ReST](https://www.kernel.org/doc/html/latest/doc-guide/sphinx.html), and I noticed that none of the `Documentation/security/` tree had been converted yet. I [took the opportunity](https://git.kernel.org/linus/c2ed6743434d1d9ef49b044c6bdfd6ac1ce140a2) to take a few passes at formatting the existing documentation and, at Jon Corbet’s recommendation, split it up between [end-user documentation](https://www.kernel.org/doc/html/latest/admin-guide/LSM/index.html) (which is mainly how to use LSMs) and [developer documentation](https://www.kernel.org/doc/html/latest/security/index.html) (which is mainly how to use various internal APIs). A bunch of these docs need some updating, so maybe with the improved visibility, they’ll get some extra attention.

**CONFIG\_REFCOUNT\_FULL**

Since Peter Zijlstra implemented the [`refcount_t` API](/blog/archives/2017/05/02/security-things-in-linux-v4-11/) in v4.11, Elena Reshetova (with Hans Liljestrand and David Windsor) has been systematically replacing `atomic_t` reference counters with `refcount_t`. As of v4.13, there are now [close to 125 conversions](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v4.13&qt=grep&q=refcount_t) with many more to come. However, there were concerns over the performance characteristics of the `refcount_t` implementation from the maintainers of the net, mm, and block subsystems. In order to assuage these concerns and help the conversion progress continue, I added an “unchecked” `refcount_t` implementation (identical to the earlier `atomic_t` implementation) as the default, with the fully checked implementation now available under `CONFIG_REFCOUNT_FULL`. The plan is that for v4.14 and beyond, the kernel can grow [per-architecture implementations of `refcount_t`](https://git.kernel.org/pub/scm/linux/kernel/git/tip/tip.git/commit/?id=7a46ec0e2f4850407de5e1d19a44edee6efa58ec) that have performance characteristics on par with `atomic_t` (as done in grsecurity’s PAX\_REFCOUNT).

**CONFIG\_FORTIFY\_SOURCE**

Daniel Micay [created a version](https://git.kernel.org/linus/6974f0c4555e285ab217cee58b6e874f776ff409) of glibc’s `FORTIFY_SOURCE` compile-time and run-time protection for finding overflows in the common string (e.g. `strcpy`, `strcmp`) and memory (e.g. `memcpy`, `memcmp`) functions. The idea is that since the compiler already knows the size of many of the buffer arguments used by these functions, it can already build in checks for buffer overflows. When all the sizes are known at compile time, this can actually allow the compiler to fail the build instead of continuing with a proven overflow. When only some of the sizes are known (e.g. destination size is known at compile-time, but source size is only known at run-time) run-time checks are added to catch any cases where an overflow might happen. Adding this [found](https://git.kernel.org/linus/4c93496f18ce5044d78e4f7f9e018682a4f44b3d) [several](https://git.kernel.org/linus/e2ae8ab4b571e2e4094a28acb60649bc2732c67f) [places](https://git.kernel.org/linus/3e2c044a54e6b6373606f8ffad42a4a0759fcf3d) [where](https://git.kernel.org/linus/c0944883c97c0ddc71da67cc731590a7c878a1a2) [minor](https://git.kernel.org/linus/42c335f7e67029d2e01711f2f2bc6252277c8993) [leaks](https://git.kernel.org/linus/dbbb08f500d6146398b794fdc68a8e811366b451) [were](https://git.kernel.org/linus/12e3c0433e8a3b817fbb978a1be973a04cd5d6f3) [happening](https://git.kernel.org/linus/e48d661eb13f2f83861428f001c567fdb3f317e8), and Daniel and I chased down fixes for them.

One interesting note about this protection is that is only examines the [size of the whole object](https://gcc.gnu.org/onlinedocs/gcc/Object-Size-Checking.html) for its size (via `__builtin_object_size(..., 0)`). If you have a string within a structure, `CONFIG_FORTIFY_SOURCE` as currently implemented will make sure only that you can’t copy beyond the structure (but therefore, you *can* still overflow the string within the structure). The next step in enhancing this protection is to switch from 0 (above) to 1, which will use the closest surrounding subobject (e.g. the string). However, there are a lot of cases where the kernel intentionally copies across multiple structure fields, which means more fixes before this higher level can be enabled.

**NULL-prefixed stack canary**

Rik van Riel and Daniel Micay changed how the stack canary is defined on 64-bit systems to always make sure that the [leading byte is zero](https://git.kernel.org/linus/022c204040f3fd22d6445bc35517786195b7ae80). This provides a deterministic defense against overflowing string functions (e.g. `strcpy`), since they will either stop an overflowing read at the NULL byte, or be unable to write a NULL byte, thereby always triggering the canary check. This does reduce the entropy from 64 bits to 56 bits for overflow cases where NULL bytes can be written (e.g. `memcpy`), but the trade-off is worth it. (Besdies, x86\_64’s canary was 32-bits [until recently](/blog/archives/2017/07/10/security-things-in-linux-v4-12/).)

**IPC refactoring**

Partially in support of allowing IPC structure layouts to be randomized by the randstruct plugin, Manfred Spraul and I reorganized the [internal layout](https://git.kernel.org/linus/1a23395672658969a4035dcc518ea6cab835c579) of how IPC is tracked in the kernel. The resulting allocations are smaller and much easier to deal with, even if I initially missed a [few needed container\_of() uses](https://git.kernel.org/linus/ade9f91b32b964e83d294f4973d50083b08ef6fc).

**randstruct gcc plugin**

I ported grsecurity’s clever [randstruct gcc plugin to upstream](https://git.kernel.org/linus/313dd1b629219db50cad532dba6a3b3b22ffe622). This plugin allows structure layouts to be randomized on a per-build basis, providing a probabilistic defense against attacks that need to know the location of sensitive structure fields in kernel memory (which is most attacks). By moving things around in this fashion, attackers need to perform much more work to determine the resulting layout before they can mount a reliable attack.

Unfortunately, due to the timing of the development cycle, only the “manual” mode of randstruct landed in upstream (i.e. [marking structures with `__randomize_layout`](https://git.kernel.org/linus/3859a271a003aba01e45b85c9d8b355eb7bf25f9)). v4.14 will also have the [automatic mode enabled](https://git.kernel.org/pub/scm/linux/kernel/git/kees/linux.git/commit/?id=9225331b310821760f39ba55b00b8973602adbb5), which randomizes all structures that contain only function pointers.

A large number of fixes to support randstruct have been landing from [v4.10 through v4.13](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v4.13&qt=grep&q=designated+init), most of which were already identified and fixed by grsecurity, but many were novel, either in newly added drivers, as [whitelisted cross-structure casts](https://git.kernel.org/linus/1854c19cae0d108637c40f90ee0bb9b7c1adbc0a), [refactorings](https://git.kernel.org/linus/3e2e857f9c3a19d55ee0ba7b428b8be5008960bf) (like IPC noted above), or in a [corner case on ARM](https://git.kernel.org/linus/ffa47aa678cfaa9b88e8a26cfb115b4768325121) found during upstream testing.

**lower ELF\_ET\_DYN\_BASE**

One of the issues identified from the [Stack Clash](https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash) set of vulnerabilities was that it was possible to collide stack memory with the highest portion of a PIE program’s text memory since the default `ELF_ET_DYN_BASE` (the lowest possible random position of a PIE executable in memory) was already so high in the memory layout (specifically, 2/3rds of the way through the address space). Fixing this required [teaching the ELF loader](http://git.kernel.org/linus/eab09532d40090698b05a07c1c87f39fdbc5fab5) how to load interpreters as shared objects in the mmap region instead of as a PIE executable (to avoid potentially colliding with the binary it was loading). As a result, the PIE default could be moved down to ET\_EXEC (0x400000) on 32-bit, entirely avoiding the subset of Stack Clash attacks. 64-bit could be moved to just above the 32-bit address space (0x100000000), leaving the entire 32-bit region open for VMs to do 32-bit addressing, but late in the cycle it was discovered that [Address Sanitizer couldn’t handle it moving](https://git.kernel.org/linus/c715b72c1ba406f133217b509044c38d8e714a37). With most of the Stack Clash risk only applicable to 32-bit, fixing 64-bit has been deferred until there is a way to teach Address Sanitizer how to load itself as a shared object instead of as a PIE binary.

**early device randomness**

I noticed that early device randomness wasn’t actually getting added to the kernel entropy pools, so I [fixed that](https://git.kernel.org/linus/ee7998c50c2697737c6530431709f77c852bf0d6) to improve the effectiveness of the latent\_entropy gcc plugin.

That’s it for now; please let me know if I missed anything. As a side note, I was rather alarmed to discover that due to all my trivial ReSTification formatting, and tiny FORTIFY\_SOURCE and randstruct fixes, I made it into the [most active 4.13 developers](https://lwn.net/Articles/731794/) list (by patch count) at LWN with 76 patches: a whopping 0.6% of the cycle’s patches. ;)

Anyway, the [v4.14](/blog/archives/2017/11/14/security-things-in-linux-v4-14/) merge window is open!

© 2017, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2017/09/05/security-things-in-linux-v4-13/#comments)
## August 30, 2017

### [GRUB and LUKS](https://outflux.net/blog/archives/2017/08/30/grub-and-luks/)

Filed under: [Blogging](https://outflux.net/blog/archives/category/blogging/),[Debian](https://outflux.net/blog/archives/category/debian/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 10:27 am

I got myself stuck yesterday with GRUB running from an ext4 `/boot/grub`, but with `/boot` inside my LUKS LVM root partition, which meant GRUB couldn’t load the initramfs and kernel.

Luckily, it turns out that GRUB does know how to mount LUKS volumes (and LVM volumes), but all the [instructions](http://www.pavelkogan.com/2014/05/23/luks-full-disk-encryption/) I could find talk about setting this up ahead of time (“Add `GRUB_ENABLE_CRYPTODISK=y` to `/etc/default/grub`“), rather than what the correct manual GRUB commands are to get things running on a failed boot.

These are my notes on that, in case I ever need to do this again, since there was one specific gotcha with using GRUB’s `cryptomount` command (noted below).

Available devices were the raw disk `(hd0)`, the `/boot/grub` partition `(hd0,msdos1)`, and the LUKS volume `(hd0,msdos5)`:

> ```
>
> grub> ls
> (hd0) (hd0,msdos1) (hd0,msdos5)
>
> ```

Used `cryptomount` to open the LUKS volume (but without `()`s! It says it works if you use parens, but then you can’t use the resulting `(crypto0)`):

> ```
>
> grub> insmod luks
> grub> cryptomount hd0,msdos5
> Enter password...
> Slot 0 opened.
>
> ```

Then you can load LVM and it’ll see inside the LUKS volume:

> ```
>
> grub> insmod lvm
> grub> ls
> (crypto0) (hd0) (hd0,msdos1) (hd0,msdos5) (lvm/rootvg-rootlv)
>
> ```

And then I could boot normally:

> ```
>
> grub> configfile $prefix/grub.cfg
>
> ```

After booting, I added `GRUB_ENABLE_CRYPTODISK=y` to `/etc/default/grub` and ran `update-grub`. I could boot normally after that, though I’d be prompted twice for the LUKS passphrase (once by GRUB, then again by the initramfs).

To avoid this, it’s possible to add a second LUKS passphrase, contained in a file in the initramfs, as described [here](http://www.pavelkogan.com/2015/01/25/linux-mint-encryption/) and works for Ubuntu and Debian too. The quick summary is:

Create the keyfile and add it to LUKS:

> ```
>
> # dd bs=512 count=4 if=/dev/urandom of=/crypto_keyfile.bin
> # chmod 0400 /crypto_keyfile.bin
> # cryptsetup luksAddKey /dev/sda5 /crypto_keyfile.bin
> *enter original password*
>
> ```

Adjust the `/etc/crypttab` to include passing the file via `/bin/cat`:

> ```
>
> sda5_crypt UUID=4aa5da72-8da6-11e7-8ac9-001cc008534d /crypto_keyfile.bin luks,keyscript=/bin/cat
>
> ```

Add an initramfs hook to copy the key file into the initramfs, keep non-root users from being able to read your initramfs, and trigger a rebuild:

> ```
>
> # cat > /etc/initramfs-tools/hooks/crypto_keyfile <<EOF
> #!/bin/bash
> if [ "$1" = "prereqs" ] ; then
>     cp /crypto_keyfile.bin "${DESTDIR}"
> fi
> EOF
> # chmod a+x /etc/initramfs-tools/hooks/crypto_keyfile
> # chmod 0700 /boot
> # update-initramfs -u
>
> ```

This has the downside of leaving a LUKS passphrase “in the clear” while you’re booted, but if someone has root, they can just get your `dm-crypt` encryption key directly anyway:

> ```
>
> # dmsetup table --showkeys sda5_crypt
> 0 155797496 crypt aes-cbc-essiv:sha256 e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855 0 8:5 2056
>
> ```

And of course if you’re worried about Evil Maid attacks, you’ll need a real static root of trust instead of doing full disk encryption passphrase prompting from an unverified `/boot` partition. :)

© 2017, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (6)](https://outflux.net/blog/archives/2017/08/30/grub-and-luks/#comments)
## July 10, 2017

### [security things in Linux v4.12](https://outflux.net/blog/archives/2017/07/10/security-things-in-linux-v4-12/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 1:24 am

Previously: [v4.11](/blog/archives/2017/05/02/security-things-in-linux-v4-11/).

Here’s a quick summary of some of the interesting security things in last week’s v4.12 release of the Linux kernel:

**x86 read-only and fixed-location GDT**

With [kernel memory base randomization](/blog/archives/2016/10/04/security-things-in-linux-v4-8/), it was stil possible to figure out the per-cpu base address via the “sgdt” instruction, since it would reveal the per-cpu GDT location. To solve this, Thomas Garnier moved the GDT to a [fixed location](https://git.kernel.org/linus/69218e47994da614e7af600bf06887750ab6657a). And to solve the risk of an attacker targeting the GDT directly with a kernel bug, he also made it [read-only](https://git.kernel.org/linus/45fc8757d1d2128e342b4e7ef39adedf7752faac).

**usercopy consolidation**

After [hardened usercopy](/blog/archives/2016/10/04/security-things-in-linux-v4-8/) landed, Al Viro decided to take a closer look at all the usercopy routines and then [consolidated the per-architecture uaccess code](https://git.kernel.org/linus/eea86b637a15bc4d4bd518b11330ac96baa6b73d) into a single implementation. The per-architecture code was functionally very similar to each other, so it made sense to remove the redundancy. In the process, he uncovered a number of unhandled corner cases in various architectures (that got fixed by the consolidation), and made [hardened usercopy available on all remaining architectures](https://git.kernel.org/linus/2fefc97b2180518bac923fba3f79fdca1f41dc15).

**ASLR entropy sysctl on PowerPC**

Continuing to expand architecture support for the [ASLR entropy sysctl](/blog/archives/2016/09/28/security-things-in-linux-v4-5/), Michael Ellerman implemented the [calculations needed for PowerPC](https://git.kernel.org/linus/9fea59bd7ca541e5d0851f0b6dbca83c60ea90cd). This lets userspace choose to crank up the entropy used for memory layouts.

**LSM structures read-only**

James Morris used [`__ro_after_init`](/blog/archives/2016/09/30/security-things-in-linux-v4-6/) to make the [LSM structures read-only after boot](https://git.kernel.org/linus/ca97d939db114c8d1619e10a3b82af8615372dae). This removes them as a desirable target for attackers. Since the hooks are called from all kinds of places in the kernel this was a favorite method for attackers to use to hijack execution of the kernel. (A similar target used to be the system call table, but that has long since been made read-only.) Be wary that `CONFIG_SECURITY_SELINUX_DISABLE` removes this protection, so make sure that config stays disabled.

**KASLR enabled by default on x86**

With many distros already enabling [KASLR](/blog/archives/2016/10/04/security-things-in-linux-v4-8/) on x86 with `CONFIG_RANDOMIZE_BASE` and `CONFIG_RANDOMIZE_MEMORY`, Ingo Molnar felt the feature was mature enough to be [enabled by default](https://git.kernel.org/linus/6807c84652b0b7e2e198e50a9ad47ef41b236e59).

**Expand stack canary to 64 bits on 64-bit systems**

The stack canary values used by [`CONFIG_CC_STACKPROTECTOR`](/blog/archives/2014/01/27/fstack-protector-strong/) is most powerful on x86 since it is different per task. (Other architectures run with a single canary for all tasks.) While the first canary chosen on x86 (and other architectures) was a full `unsigned long`, the subsequent canaries chosen per-task for x86 were being truncated to 32-bits. Daniel Micay [fixed this](https://git.kernel.org/linus/5ea30e4e58040cfd6434c2f33dc3ea76e2c15b05) so now x86 (and future architectures that gain per-task canary support) have significantly increased entropy for stack-protector.

**Expanded stack/heap gap**

Hugh Dickens, with input from many other folks, [improved the kernel’s mitigation](https://git.kernel.org/linus/1be7107fbe18eed3e319a6c3e83c78254b693acb) against having the stack and heap crash into each other. This is a stop-gap measure to help defend against the [Stack Clash](https://www.qualys.com/2017/06/19/stack-clash/stack-clash.txt) attacks. Additional hardening needs to come from the compiler to produce “stack probes” when doing large stack expansions. Any Variable Length Arrays on the stack or `alloca()` usage needs to have machine code generated to touch each page of memory within those areas to let the kernel know that the stack is expanding, but with single-page granularity.

That’s it for now; please let me know if I missed anything. The [v4.13](/blog/archives/2017/09/05/security-things-in-linux-v4-13/) merge window is open!

Edit: Brad Spengler pointed out that I failed to mention the `CONFIG_SECURITY_SELINUX_DISABLE` issue with read-only LSM structures. This has been added now.

© 2017, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (3)](https://outflux.net/blog/archives/2017/07/10/security-things-in-linux-v4-12/#comments)
## May 2, 2017

### [security things in Linux v4.11](https://outflux.net/blog/archives/2017/05/02/security-things-in-linux-v4-11/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 2:17 pm

Previously: [v4.10](/blog/archives/2017/02/27/security-things-in-linux-v4-10/).

Here’s a quick summary of some of the interesting security things in this week’s v4.11 release of the Linux kernel:

**refcount\_t infrastructure**

Building on the [efforts](http://www.openwall.com/lists/kernel-hardening/2017/01/18/4) of Elena Reshetova, Hans Liljestrand, and David Windsor to port [PaX’s PAX\_REFCOUNT protection](https://forums.grsecurity.net/viewtopic.php?f=7&t=4173), Peter Zijlstra implemented a new [kernel API for reference counting](https://git.kernel.org/linus/f405df5de3170c00e5c54f8b7cf4766044a032ba) with the addition of the `refcount_t` type. Until now, all reference counters were implemented in the kernel using the `atomic_t` type, but it has a wide and general-purpose API that offers no reasonable way to provide protection against reference counter overflow vulnerabilities. With a dedicated type, a specialized API can be designed so that reference counting can be sanity-checked and provide a way to block overflows. With 2016 alone seeing at least a couple public exploitable reference counting vulnerabilities (e.g. [CVE-2016-0728](http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/), [CVE-2016-4558](https://bugs.chromium.org/p/project-zero/issues/detail?id=809)), this is going to be a welcome addition to the kernel. The arduous task of converting all the `atomic_t` reference counters to `refcount_t` will continue for a while to come.

**CONFIG\_DEBUG\_RODATA renamed to CONFIG\_STRICT\_KERNEL\_RWX**

Laura Abbott landed changes to [rename the kernel memory protection feature](https://git.kernel.org/linus/0f5bf6d0afe4be6e1391908ff2d6dc9730e91550). The protection hadn’t been “debug” for over a decade, and it covers all kernel memory sections, not just “rodata”. Getting it consolidated under the top-level arch Kconfig file also brings some sanity to what was a per-architecture config, and signals that this is a fundamental kernel protection needed to be enabled on all architectures.

**read-only usermodehelper**

A common way attackers use to escape confinement is by rewriting the user-mode helper sysctls (e.g. `/proc/sys/kernel/modprobe`) to run something of their choosing in the init namespace. To reduce attack surface within the kernel, Greg KH [introduced CONFIG\_STATIC\_USERMODEHELPER](https://git.kernel.org/linus/64e90a8acb8590c2468c919f803652f081e3a4bf), which switches all user-mode helper binaries to a single read-only path (which defaults to `/sbin/usermode-helper`). Userspace will need to support this with a new helper tool that can demultiplex the kernel request to a set of known binaries.

**seccomp coredumps**

Mike Frysinger noticed that it wasn’t possible to get coredumps out of processes killed by seccomp, which could make debugging frustrating, especially for automated crash dump analysis tools. In keeping with the [existing documentation for SIGSYS](http://man7.org/linux/man-pages/man7/signal.7.html), which says a coredump should be generated, he added [support to dump core on seccomp SECCOMP\_RET\_KILL](https://git.kernel.org/linus/b25e67161c295c98acda92123b2dd1e7d8642901) results.

**structleak plugin**

Ported from PaX, I landed the [structleak plugin](https://git.kernel.org/linus/c61f13eaa1ee17728c41370100d2d45c254ce76f) which enforces that any structure containing a `__user` annotation is fully initialized to 0 so that stack content exposures of these kinds of structures are entirely eliminated from the kernel. This was originally designed to stop a [specific vulnerability](https://git.kernel.org/linus/b9e146d8eb3b9ecae5086d373b50fa0c1f3e7f0f), and will now continue to block similar exposures.

**ASLR entropy sysctl on MIPS**

Matt Redfearn implemented the [ASLR entropy sysctl for MIPS](https://git.kernel.org/linus/109c32ffd89d64dd99a775f2f50443bee38b63e9), letting userspace choose to crank up the entropy used for memory layouts.

**NX brk on powerpc**

Denys Vlasenko [fixed a long standing bug](https://git.kernel.org/linus/16e72e9b30986ee15f17fbb68189ca842c32af58) where the kernel made assumptions about ELF memory layouts and defaulted the the brk section on powerpc to be executable. Now it’s not, and that’ll keep process heap from being abused.

That’s it for now; please let me know if I missed anything. The [v4.12](/blog/archives/2017/07/10/security-things-in-linux-v4-12/) merge window is open!

© 2017, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (2)](https://outflux.net/blog/archives/2017/05/02/security-things-in-linux-v4-11/#comments)
## February 27, 2017

### [security things in Linux v4.10](https://outflux.net/blog/archives/2017/02/27/security-things-in-linux-v4-10/)

Filed under: [Chrome OS](https://outflux.net/blog/archives/category/chromeos/),[Debian](https://outflux.net/blog/archives/category/debian/),[Kernel](https://outflux.net/blog/archives/category/kernel/),[Security](https://outflux.net/blog/archives/category/security/),[Ubuntu](https://outflux.net/blog/archives/category/ubuntu/),[Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/) — kees @ 10:31 pm

Previously: [v4.9](/blog/archives/2016/12/12/security-things-in-linux-v4-9/).

Here’s a quick summary of some of the interesting security things in last week’s v4.10 release of the Linux kernel:

**PAN emulation on arm64**

Catalin Marinas introduced [`ARM64_SW_TTBR0_PAN`](https://git.kernel.org/linus/ba42822af1c287f038aa550f3578c61c212a892e), which is functionally the arm64 equivalent of arm’s [`CONFIG_CPU_SW_DOMAIN_PAN`](https://outflux.net/blog/archives/2016/09/26/security-things-in-linux-v4-3/). While Privileged eXecute Never (PXN) has been available in ARM hardware for a while now, Privileged Access Never (PAN) will only be available in hardware once vendors start manufacturing ARMv8.1 or later CPUs. Right now, everything is still ARMv8.0, which left a bit of a gap in security flaw mitigations on ARM since `CONFIG_CPU_SW_DOMAIN_PAN` can only provide PAN coverage on ARMv7 systems, but nothing existed on ARMv8.0. This solves that problem and closes a common exploitation method for arm64 systems.

**thread\_info relocation on arm64**

As [done earlier for x86](/blog/archives/2016/12/12/security-things-in-linux-v4-9/), Mark Rutland has [moved `thread_info` off the kernel stack on arm64](https://git.kernel.org/linus/c02433dd6de32f042cf3ffe476746b1115b8c096). With `thread_info` no longer on the stack, it’s more difficult for attackers to find it, which makes it harder to subvert the very sensitive `addr_limit` field.

**linked list hardening**

I added `CONFIG_BUG_ON_DATA_CORRUPTION` to [restore the original `CONFIG_DEBUG_LIST` behavior](https://git.kernel.org/linus/de54ebbe26bb371a6f1fbc0593372232f04e3107) that existed prior to v2.6.27 (9 years ago): if list metadata corruption is detected, the kernel refuses to perform the operation, rather than just `WARN`ing and continuing with the corrupted operation anyway. Since linked list corruption (usually via heap overflows) are a common method for attackers to gain a [write-what-where primitive](https://git.kernel.org/linus/6819d101dd739dd4e8cbe60a98c9ebb224ecc992), it’s important to stop the list add/del operation if the metadata is obviously corrupted.

**seeding kernel RNG from UEFI**

A problem for many architectures is finding a viable source of early boot entropy to initialize the kernel Random Number Generator. For x86, this is mainly solved with the `RDRAND` instruction. On ARM, however, the solutions continue to be very vendor-specific. As it turns out, UEFI is supposed to hide various vendor-specific things behind a common set of APIs. The `EFI_RNG_PROTOCOL` call is designed to provide entropy, but it can’t be called when the kernel is running. To get entropy into the kernel, Ard Biesheuvel created a UEFI config table (`LINUX_EFI_RANDOM_SEED_TABLE_GUID`) that is [populated](https://git.kernel.org/linus/568bc4e87033d232c5fd00d5b0cd22a2ccc04944) during the UEFI boot stub and [fed into the kernel entropy pool](https://git.kernel.org/linus/636259880a7e7d3446a707dddebc799da94bdd0b) during early boot.

**arm64 W^X detection**

As [done earlier for x86](/blog/archives/2016/09/27/security-things-in-linux-v4-4/), Laura Abbott implemented [CONFIG\_DEBUG\_WX on arm64](https://git.kernel.org/linus/1404d6f13e47c42f155e3c6a611b1bf4dd35dde9). Now any dangerous arm64 kernel memory protections will be loudly reported at boot time.

**64-bit `get_user()` zeroing fix on arm**

While the [fix itself is pretty minor](https://git.kernel.org/linus/9e3440481845b2ec22508f60837ee2cab2b6054f), I like that this bug was found through a combined improvement to the usercopy test code in `lib/test_user_copy.c`. Hoeun Ryu added [zeroing-on-failure testing](https://git.kernel.org/linus/4fbfeb8bd684d564bddeff1e3723d3d9f99aa5de), and I expanded the [get\_user()/put\_user() tests to include all sizes](https://git.kernel.org/linus/4c5d7bc63775b40631b75f6c59a3a3005455262d). Neither improvement alone would have found the ARM bug, but together they uncovered a typo in a corner case.

**no-new-privs visible in `/proc/$pid/status`**

This is a tiny change, but I like being able to introspect processes externally. Prior to this, I wasn’t able to trivially answer the question “is that process setting the no-new-privs flag?” To address this, I [exposed the flag in `/proc/$pid/status`](https://git.kernel.org/linus/af884cd4a5ae62fcf5e321fecf0ec1014730353d), as `NoNewPrivs`.

**Kernel Userspace Execute Prevention on powerpc**

Like SMEP on x86 and PXN on ARM, Balbir Singh [implemented the protection on Power9](https://git.kernel.org/linus/3b10d0095a1e2d6ce11f6537e04806ff8aba9cdd) and later PPC CPUs under `CONFIG_PPC_RADIX_MMU=y` (which is the default). This means that if the kernel has a function pointer overwritten, it can no longer point into arbitrary code in userspace memory. An attacker’s ability is reduced to only using executable kernel memory, which is much less under their control (and has more limited visibility).

That’s all for now! Please let me know if you saw anything else you think needs to be called out. :) I’m already excited about the [v4.11](/blog/archives/2017/05/02/security-things-in-linux-v4-11/) merge window opening…

*Edit: Added note about SMEP on Power9*

© 2017 – 2019, [Kees Cook](https://outflux.net/blog/). This work is licensed under a [Creative Commons Attribution-ShareAlike 4.0 License](http://creativecommons.org/licenses/by-sa/4.0/).
[![CC BY-SA 4.0](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

[Comments (1)](https://outflux.net/blog/archives/2017/02/27/security-things-in-linux-v4-10/#comments)

[Older Posts »](https://outflux.net/blog/page/2/)

* Categories
  + [Blogging](https://outflux.net/blog/archives/category/blogging/ "Blogging, and the software needed to get it done.") (152)
  + [Chrome OS](https://outflux.net/blog/archives/category/chromeos/ "Chrome OS distribution of Linux") (49)
  + [Debian](https://outflux.net/blog/archives/category/debian/ "Debian and SPI") (117)
  + [Embedded](https://outflux.net/blog/archives/category/embedded/ "Deep internals, programming, and designing of various hardware devices.") (8)
  + [General](https://outflux.net/blog/archives/category/general/ "I forgot to click a more specific topic.") (33)
  + [Health](https://outflux.net/blog/archives/category/health/ "My health, other people's health, or health in general.") (3)
  + [Inkscape](https://outflux.net/blog/archives/category/inkscape/ "Inkscape SVG editor software project.") (8)
  + [Kernel](https://outflux.net/blog/archives/category/kernel/) (37)
  + [kernel.org](https://outflux.net/blog/archives/category/kernelorg/ "My work on the kernel.org servers.") (6)
  + [Multimedia](https://outflux.net/blog/archives/category/multimedia/ "Software/things involved in audio/visual display, recording, and/or editing.") (33)
  + [Networking](https://outflux.net/blog/archives/category/networking/ "Networking and computer intercommunication, including wireless.") (27)
  + [Reverse Engineering](https://outflux.net/blog/archives/category/reverse-engineering/ "Trying to take something apart and see how it works, usually with improvements.") (15)
  + [Security](https://outflux.net/blog/archives/category/security/ "Security, penetration testing, and hardening.") (130)
  + [Ubuntu](https://outflux.net/blog/archives/category/ubuntu/ "Ubuntu and Canonical") (179)
  + [Ubuntu-Server](https://outflux.net/blog/archives/category/ubuntu-server/ "Stuff happening with the Ubuntu Server Team.") (109)
  + [Vehicles](https://outflux.net/blog/archives/category/vehicles/ "Working on or drooling over various vehicles.") (2)
  + [Vulnerabilities](https://outflux.net/blog/archives/category/vulnerabilities/ "Vulnerability discovery announcements.") (12)
  + [Web](https://outflux.net/blog/archives/category/web/ "Websites, protocols, languages, etc.") (14)
* Search for:
* Links
  + [Outflux](http://outflux.net/ "homepage")
  + [#fediverse](https://fosstodon.org/%40kees "social media")
* Archives Archives
  Select Month
   October 2023  (1)
   June 2022  (1)
   April 2022  (1)
   April 2021  (1)
   February 2021  (1)
   October 2020  (1)
   September 2020  (2)
   May 2020  (1)
   February 2020  (1)
   November 2019  (2)
   July 2019  (1)
   June 2019  (1)
   May 2019  (1)
   March 2019  (1)
   December 2018  (1)
   October 2018  (1)
   August 2018  (1)
   June 2018  (1)
   April 2018  (2)
   February 2018  (1)
   January 2018  (1)
   November 2017  (1)
   September 2017  (1)
   August 2017  (1)
   July 2017  (1)
   May 2017  (1)
   February 2017  (1)
   December 2016  (1)
   October 2016  (4)
   September 2016  (4)
   November 2015  (1)
   July 2015  (1)
   January 2015  (1)
   December 2014  (1)
   June 2014  (1)
   May 2014  (1)
   February 2014  (1)
   January 2014  (1)
   December 2013  (2)
   November 2013  (1)
   August 2013  (1)
   May 2013  (1)
   January 2013  (1)
   November 2012  (3)
   October 2012  (1)
   May 2012  (1)
   March 2012  (2)
   February 2012  (3)
   January 2012  (1)
   December 2011  (5)
   November 2011  (1)
   September 2011  (1)
   July 2011  (1)
   April 2011  (2)
   February 2011  (3)
   December 2010  (1)
   November 2010  (2)
   October 2010  (3)
   September 2010  (3)
   August 2010  (1)
   July 2010  (3)
   June 2010  (1)
   May 2010  (4)
   April 2010  (2)
   March 2010  (3)
   February 2010  (5)
   January 2010  (2)
   December 2009  (3)
   November 2009  (1)
   October 2009  (3)
   September 2009  (2)
   July 2009  (2)
   May 2009  (1)
   April 2009  (3)
   February 2009  (1)
   January 2009  (3)
   December 2008  (1)
   November 2008  (6)
   October 2008  (5)
   September 2008  (4)
   August 2008  (3)
   July 2008  (1)
   June 2008  (4)
   April 2008  (2)
   March 2008  (4)
   February 2008  (3)
   January 2008  (1)
   December 2007  (4)
   September 2007  (5)
   August 2007  (1)
   April 2007  (2)
   March 2007  (1)
   February 2007  (1)
   January 2007  (2)
   December 2006  (6)
   October 2006  (1)
   September 2006  (2)
   August 2006  (3)
   July 2006  (5)
   June 2006  (1)
   May 2006  (8)
   April 2006  (9)
   March 2006  (4)
   January 2006  (6)
   December 2005  (4)
   October 2005  (9)
   September 2005  (8)
   August 2005  (12)
   July 2005  (3)
   June 2005  (6)
   May 2005  (6)
   April 2005  (4)
   March 2005  (2)
   February 2005  (3)
   January 2005  (11)
* Meta
  + [Log in](https://outflux.net/blog/wp-login.php)
  + [Entries RSS](https://outflux.net/blog/feed/)
  + [Comments RSS](https://outflux.net/blog/comments/feed/)
  + [WordPress.org](https://wordpress.org/ "Powered by WordPress, state-of-the-art semantic personal publishing platform.")

 Powered by [**WordPress**](http://wordpress.org/ "Powered by WordPress, state-of-the-art semantic personal publishing platform.")



=== Content from www.mandriva.com_220dd14b_20250125_063556.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us


