Based on the provided content, here's an analysis of CVE-2010-2020:

**Root Cause of Vulnerability:**
The vulnerability lies in the insufficient input validation within the `nfs_mount()` and `mountnfs()` functions of the FreeBSD NFS client. These functions do not properly validate the size of the file handle (`fh`) passed from user space to the kernel within the `nfs_args` structure.

**Weaknesses/Vulnerabilities Present:**
- **Insufficient Input Validation:** The kernel fails to validate the size of the file handle (`nfs_args.fhsize`) and the file handle itself (`nfs_args.fh`) provided by the user.
- **Stack Overflow:** In `nfs_mount()`, an overly large `fh` can cause a stack-based buffer overflow when copied into the kernel stack.
- **Heap Overflow:** In `mountnfs()`, an overly large `fh` can cause a heap-based buffer overflow when copied to a memory location allocated in the `nfsmount_zone` UMA zone.

**Impact of Exploitation:**
- **Privilege Escalation (FreeBSD 7.2/7.3):** A local unprivileged user, if `vfs.usermount` is enabled, can exploit the stack overflow in `nfs_mount()` to execute arbitrary code with kernel privileges, thereby escalating to root.
- **Kernel Crash/Denial of Service (FreeBSD 8.0):** The stack overflow protection in FreeBSD 8.0 prevents code execution but results in a kernel crash and denial of service.
- **Kernel Crash/Denial of Service (All versions):** The heap overflow vulnerability in `mountnfs()` can lead to a kernel crash and denial of service.

**Attack Vectors:**
- **Local Exploitation:** The vulnerability is triggered locally via the `mount(2)` or `nmount(2)` system calls.
- **User-Supplied Input:** The attacker controls the contents of the `nfs_args` structure, specifically the `fh` and `fhsize` fields.
- **Sysctl Dependency:** The attack typically requires `vfs.usermount` to be enabled (set to a non-zero value). This is not the default configuration, but if set, allows unprivileged users to attempt the exploit.

**Required Attacker Capabilities/Position:**
- **Local User Access:** The attacker must have local access to the system.
- **Ability to call mount(2)/nmount(2):** The user must be able to call `mount(2)` or `nmount(2)` system calls. If `vfs.usermount` is not set to non-zero only root can do this.

**Additional Notes:**
- The vulnerability was introduced in FreeBSD 7.2.
- FreeBSD 7.1 and earlier are not vulnerable.
- Patches were released for FreeBSD 7.2, 7.3, and 8.0 to fix this issue.
- There are two exploits, one demonstrating privilege escalation through stack overflow and one demonstrating a heap overflow denial of service.
- The exploit code provided demonstrates how to trigger the stack overflow in `nfs_mount()` and provides a shellcode to achieve privilege escalation.
- The provided code also shows how to trigger the heap overflow in `mountnfs()` for a denial of service.