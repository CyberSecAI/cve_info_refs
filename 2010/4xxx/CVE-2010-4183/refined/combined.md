=== Content from htmlpurifier.org_157ff2bb_20250125_181628.html ===


[HTML Purifier](/)
## Navigation

1. [News](/news/)
2. [Compare](/comparison)
3. [Demo](/demo.php)
4. [Download](/download)
5. [Docs](/docs)
6. [Forum](/phorum/)
7. [Contact](/contact)

# CSS Quoting Full Disclosure

Non-standard parsing behavior of strings in CSS expressions in
Internet Explorer could allow a clever attacker to escape the string
and execute arbitrary JavaScript via CSS. The three CSS properties
that HTML Purifier enabled that take strings as inputs are
`background-image`, `background` and
`font-family`; instances of HTML Purifier that did not
enable these properties were not vulnerable.

This vulnerability was reported privately to the vendor by
[Mario Heiderich](http://mario.heideri.ch/).
[Takeshi Terada](http://d.hatena.ne.jp/teracc/)
was consulted during the construction of the fix. David Ross of
the Internet Explorer team was separately informed of this class of
exploits. Shortly prior to the release of 4.1.1, a post
to [sla.ckers.org](http://sla.ckers.org/forum/read.php?2,34579)
was made to sanity check the new proposed fix. No active exploits are
currently known.

## Fix

There are several quirks in Internet Explorer's parsing of string-like
expressions in CSS that caused this security vulnerability. They are as
follows:

1. Internet Explorer treats the second instance of an unprotected
   exclamation mark as a valid ending delimiter for its CSS parser (no
   semicolon is necessary in this case), and
2. Internet Explorer does not recognize CSS escape characters
   `\"` and `\'` in strings.

Thus, the original implementation of `url()` in
`background-image` and friends was vulnerable
because it did not use quoting and relied on character escaping, and
the original implementation of `font-family` was vulnerable
because it expected to be able to escape internal apostrophes in its
string. The initial fix merely added quoting to `url()`
but failed to address Internet Explorer's broken character escaping.

At this point, there appeared to be a problem: it seemed impossible to
express the full range of permitted URLs and font names: the
characters that Internet Explorer did not seem to be able to escape
were also valid characters in URLs and font names.

URLs were resolved in the following manner: while a single quote was a
valid character for a URL, a double quote was not. A backslash was
never a valid character. Thus, if the `url("...")` form
was used, no escaping would be necessary.

Font names were resolved in a similar fashion (apostrophes are far
more common in font names than double quotes), but with an extra
observation made by Takeshi Terada: while Internet Explorer did not
support `\"` style character escapes, it did support
hexadecimal character escapes. Thus, quotes and backslashes could be
portably preserved in font names.

## History

The vulnerability was reported on April 25, 2010 via email. The first
incorrect patch was committed to the public repository on [April 26, 2010](http://repo.or.cz/w/htmlpurifier.git/commit/da94d3d6acdf417ac890426eb1fd239ba62b042d)
with the summary: âAlways quote the contents of url() in CSS.â
HTML Purifier 4.1.0 was released on April 26, 2010.

On April 27, 2010, Mario Heiderich realized that the fix was
insufficient. A long private discussion ensued on possible fixes, but
we were unable to determine a solution that would not invalidate
previously valid CSS expressions.

On May 20, 2010, I contacted Takeshi Terada and we came up with a
feasible solution. A patch was committed on [June 1, 2010](http://repo.or.cz/w/htmlpurifier.git/commit/d3abcb90e30592c619047d878cf9c72b7c5836a3)
with the summary âRewrite CSS url() and font-family output
logic.â HTML Purifier 4.1.1 was released on June 1, 2010.

The HTML Purifier team realizes that the month long interval between
the discovery of the second security vulnerability and the fix was not
ideal, and hopes to maintain a fast turnaround for security
vulnerabilities in the future.



=== Content from htmlpurifier.org_11e11ffd_20250125_181628.html ===


[HTML Purifier](/)
## Navigation

1. [News](/news/)
2. [Compare](/comparison)
3. [Demo](/demo.php)
4. [Download](/download)
5. [Docs](/docs)
6. [Forum](/phorum/)
7. [Contact](/contact)

# HTML Purifier 4.2.0 released

Posted 3:40 AM EDT on Wednesday, September 15, 2010

HTML Purifier 4.2.0 is a minor release that implements a number of
feature requests accumulated over half a year. New configuration
options include %Core.RemoveProcessingInstructions,
%CSS.ForbiddenProperties, %HTML.FlashAllowFullScreen and
%Core.NormalizeNewlines. Additionally,%URI.DisableResources is
now functional and file: is an optionally supported URI scheme.
There are also some minor bugfixes, usability improvements and
documentation updates.

See [NEWS](http://repo.or.cz/w/htmlpurifier.git/blob/882ffed9babb9ddc20bfb0979b14bb52d64c96c4%3A/NEWS)
for a complete changelog.

Along with this release, we would like to announce full disclosure
on the security vulnerability patched in 4.1.0 and 4.1.1. Please
see the [CSS
Quoting](/security/2010/css-quoting) full disclosure page.

[Previous](/news/2010/0531-4.1.1-released.html)[Next](/news/2011/0327-4.3.0-released.html)

