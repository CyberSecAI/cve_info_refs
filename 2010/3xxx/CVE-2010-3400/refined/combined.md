=== Content from bugzilla.mozilla.org_3ea30140_20250124_132944.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/475585)
* [XML](/show_bug.cgi?ctype=xml&id=475585)

Closed
[Bug 475585](/show_bug.cgi?id=475585)
(CVE-2008-5913)

Opened 16 years ago
Closed 15 years ago

# Re-seed Math.random() for each window/frame/context

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Re-seed Math.random() for each window/frame/context

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.3a5

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| blocking1.9.2 | --- | [needed](/buglist.cgi?f1=cf_blocking_192&o1=equals&v1=needed) |
| status1.9.2 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=.4-fixed) |
| blocking1.9.1 | --- | [needed](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=needed) |
| status1.9.1 | --- | [.10-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.10-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| blocking1.9.2 |  |  |
| status1.9.2 |  | .4-fixed |
| blocking1.9.1 |  | needed |
| relnote-firefox |  | --- |
| status1.9.1 |  | .10-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: johnath, Assigned: gal)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/86d014603512abf3c5966ea995551a53?d=mm&size=40)  [gal](/user_profile?user_id=310943)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/57c4d202970ce02ce9ade7755a4cbc13?d=mm&size=40)  [johnath](/user_profile?user_id=210757)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[511328](/show_bug.cgi?id=511328 "RESOLVED FIXED - TM: make Math.random threadlocal")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[464071](/show_bug.cgi?id=464071 "RESOLVED FIXED - User tracking via Math.random output and multipart/form-data boundary string")

Dependency [tree](/showdependencytree.cgi?id=475585&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=475585)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: privacy, Whiteboard: [sg:low], fixed-in-tracemonkey)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2008-5913

[Keywords:](/describekeywords.cgi)

[privacy](/buglist.cgi?keywords=privacy&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:low], fixed-in-tracemonkey

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

1

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [patch](/attachment.cgi?id=400900)  [15 years ago](#c1)  [Andreas Gal :gal](/user_profile?user_id=310943)   5.93 KB, patch | Waldo : [review+](#c5 "15 years ago")  Dolske : [review+](#a20051551_27780 "15 years ago")  beltzner : [approval1.9.2.4+](#a37400415_137548 "15 years ago")  beltzner : [approval1.9.1.10+](#a37400415_137548 "15 years ago") | [Details](/attachment.cgi?id=400900&action=edit) | [Diff](/attachment.cgi?id=400900&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=400900) |
| --- | --- | --- |
| [Backport for 1.9.0](/attachment.cgi?id=453755)  [15 years ago](#c28)  [Mike Hommey [:glandium]](/user_profile?user_id=47192)   5.64 KB, patch | Waldo : [review+](#a45961219_83595 "15 years ago")  gal : [review+](#c30 "15 years ago")  dveditz : [approval1.9.0.next+](#c33 "15 years ago") | [Details](/attachment.cgi?id=453755&action=edit) | [Diff](/attachment.cgi?id=453755&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=453755) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=475585#c0)• 16 years ago |
|  | |

After discussion today, we agreed that it would be nice if each context got its own Math.random() seed, to reduce the risk of things like cross-site tracking based on randomness seed.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a95586_11608)• 16 years ago |

Blocks: [464071](/show_bug.cgi?id=464071 "RESOLVED FIXED - User tracking via Math.random output and multipart/form-data boundary string")Whiteboard: [sg:low]

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=475585#c1)• 15 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=400900&action=diff)
— [Details](attachment.cgi?id=400900&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=400900)

Assignee: general → gal

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=475585#c2)• 15 years ago |
|  | |

The attached patch makes the RNG context-local and seeds it when the context is created. In addition to time the context pointer and its successor pointer are used for the seed, in case we bring up a number of contexts at the same time.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a19970176_310943)• 15 years ago |

[Attachment #400900](/attachment.cgi?id=400900&action=edit "patch") -
Flags: review?(jwalden+bmo)
[Attachment #400900](/attachment.cgi?id=400900&action=edit "patch") -
Flags: review?(dolske)

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=475585#c3)• 15 years ago |
|  | |

Fly-by reviews welcome too.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=475585#c4)• 15 years ago |
|  | |

dmandelin suggested seeding with the context pointer. dolske suggested making sure we don't just seed with one pointer.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=475585#c5)• 15 years ago |
|  | |

Comment on [attachment 400900](/attachment.cgi?id=400900 "patch") [[details]](/attachment.cgi?id=400900&action=edit "patch") [[diff]](/attachment.cgi?id=400900&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=400900)
patch
>+js\_InitRandom(JSContext \*cx)
> {
>- /\* Finally, set the seed from current time. \*/
>- random\_setSeed(data, PRMJ\_Now() / 1000);
>+ /\*
>+ \* Set the seed from current time. Since we have a RNG per context and we often bring
>+ \* up several contexts at the same time, we xor in some additional values, namely
>+ \* the context and its successor. We don't just use the context because it might be
>+ \* possible to reverse engineer the context pointer if one guesses the time right.
>+ \*/
>+ random\_setSeed(cx,
>+ (PRMJ\_Now() / 1000) ^
>+ int64(cx) ^
>+ int64(cx->link.next));
> }
For the first context, |cx == cx->link.next| as I understand it, so the seed is thus |timeSecs ^ (a ^ a)|, which collapses to |(timeSecs ^ 0) == timeSecs|. The first context in the browser is apparently for the JS component loader, so it's going to be long-lived. If we're really worried about pages snooping on each other in this way, we should be worried about pages snooping on components which might possibly take user-affected inputs (foxyproxy would be one such component) and which use Math.random() (fewer still, but not out of the question). The first context even runs privileged code, making it more interesting to attack. I suggest making the last piece of this int64(JS\_LIKELY(cx->link.next != cx) ? cx->link.next : 0) as a precaution in this case so we'll actually do a small amount of fudging to an otherwise time-based seed in that case.
[Attachment #400900](/attachment.cgi?id=400900&action=edit "patch") -
Flags: review?(jwalden+bmo) → review+

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=475585#c6)• 15 years ago |
|  | |

Although, I suppose in that case the reverse-engineer-the-JSContext\* attack is then feasible again; that probably doesn't matter that much, but if it does we could always use |cx->runtime| instead.
We really need to decide on a cryptographically-secure random number generation API, propose it for ES6, and implement it. This half-concern, half-you're-doing-it-wrong attitude we have is just making more and more work for us.

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=475585#c7)• 15 years ago |
|  | |

(In reply to [comment #5](/show_bug.cgi?id=475585#c5 "RESOLVED FIXED - Re-seed Math.random() for each window/frame/context"))
> (From update of [attachment 400900](/attachment.cgi?id=400900 "patch") [[details]](/attachment.cgi?id=400900&action=edit "patch") [[diff]](/attachment.cgi?id=400900&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=400900))
> >+js\_InitRandom(JSContext \*cx)
> > {
> >- /\* Finally, set the seed from current time. \*/
> >- random\_setSeed(data, PRMJ\_Now() / 1000);
> >+ /\*
> >+ \* Set the seed from current time. Since we have a RNG per context and we often bring
> >+ \* up several contexts at the same time, we xor in some additional values, namely
> >+ \* the context and its successor. We don't just use the context because it might be
> >+ \* possible to reverse engineer the context pointer if one guesses the time right.
> >+ \*/
> >+ random\_setSeed(cx,
> >+ (PRMJ\_Now() / 1000) ^
> >+ int64(cx) ^
> >+ int64(cx->link.next));
> > }
>
> For the first context, |cx == cx->link.next| as I understand it,
No, there's a header, rt->contextList.
/be

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=475585#c8)• 15 years ago |
|  | |

(In reply to [comment #6](/show_bug.cgi?id=475585#c6 "RESOLVED FIXED - Re-seed Math.random() for each window/frame/context"))
> We really need to decide on a cryptographically-secure random number generation
> API, propose it for ES6, and implement it. This half-concern,
> half-you're-doing-it-wrong attitude we have is just making more and more work
> for us.
No one is going to use a new API (especially one that can't be emulated if not supplied by older browsers) for years.
Anyway [bug 322529](/show_bug.cgi?id=322529 "RESOLVED FIXED - Upgrade Math.random() to the better XorShift128+ algorithm") proposes to strengthen Math.random() sufficiently. Then the only fear is stupid ND benchmarketing noticing the regression.
/be

|  | [Justin Dolske [:Dolske]](/user_profile?user_id=27780) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a20051551_27780)• 15 years ago |

[Attachment #400900](/attachment.cgi?id=400900&action=edit "patch") -
Flags: review?(dolske) → review+

|  | [Justin Dolske [:Dolske]](/user_profile?user_id=27780) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=475585#c9)• 15 years ago |
|  | |

Comment on [attachment 400900](/attachment.cgi?id=400900 "patch") [[details]](/attachment.cgi?id=400900&action=edit "patch") [[diff]](/attachment.cgi?id=400900&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=400900)
patch
>+ random\_setSeed(cx,
>+ (PRMJ\_Now() / 1000) ^
>+ int64(cx) ^
>+ int64(cx->link.next));
The only nit I might add is that cx ^ cx->link.next won't give you many bits if they're close to each other.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=475585#c11)• 15 years ago |
|  | |

We should try to get this into the beta since this is observable. I will land the patch shortly.Flags: wanted1.9.2?

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=475585#c12)• 15 years ago |
|  | |

Hey - did this ever make it in? If not, can it?

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=475585#c13)• 15 years ago |
|  | |

[bug 511328](/show_bug.cgi?id=511328 "RESOLVED FIXED - TM: make Math.random threadlocal") took over a large part of this (making rngSeed thread local). Will land the rest.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=475585#c14)• 15 years ago |
|  | |

I take that back. This patch wants the seed in the context. So its just a simple re-basing.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=475585#c15)• 15 years ago |
|  | |

Seriously lame that it took so long. Sorry. Jonathan, if you need this for any of the product branches, could you twiddle the flags and request approval accordingly? Otherwise this will flow into m-c with the next TM merge.
<http://hg.mozilla.org/tracemonkey/rev/2851cb841760>Whiteboard: [sg:low] → [sg:low], fixed-in-tracemonkey

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=475585#c16)• 15 years ago |
|  | |

No sweat - let's see whether nightly testers uncover any excitement - feels pretty safe to take on branch, but I'm not clamoring for it yet, either. I'll tweak the flag anyhow, so that we get to it in the next triage pass.

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=475585#c17)• 15 years ago |
|  | |

Comment on [attachment 400900](/attachment.cgi?id=400900 "patch") [[details]](/attachment.cgi?id=400900&action=edit "patch") [[diff]](/attachment.cgi?id=400900&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=400900)
patch
Assuming this bakes on trunk without incident, it is a minor security fix and I think I understand Andreas to believe it's pretty safe as well.
[Attachment #400900](/attachment.cgi?id=400900&action=edit "patch") -
Flags: approval1.9.2.3?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a35945272_1689)• 15 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted)Flags: wanted1.9.2?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=475585#c18)• 15 years ago |
|  | |

has this landed on trunk yet?blocking1.9.1: --- → neededblocking1.9.2: --- → needed

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=475585#c19)• 15 years ago |
|  | |

Not on trunk yet afaict. sayrer, can you lend a hand? Should be easy to cherry-pick without conflicts if needed.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=475585#c20)• 15 years ago |
|  | |

I'm fine with this landing on mozilla-central and mozilla-1.9.2 and mozilla-1.9.1 at the same time, as long as it does land at the same time :)
a=beltzner for 1.9.2.4 and 1.9.1.10

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a37400415_137548)• 15 years ago |

[Attachment #400900](/attachment.cgi?id=400900&action=edit "patch") -
Flags: approval1.9.2.4?
[Attachment #400900](/attachment.cgi?id=400900&action=edit "patch") -
Flags: approval1.9.2.4+
[Attachment #400900](/attachment.cgi?id=400900&action=edit "patch") -
Flags: approval1.9.1.10+

|  | [Robert Sayre](/user_profile?user_id=180188) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=475585#c21)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/2851cb841760>Status: NEW → RESOLVEDClosed: 15 years agoResolution: --- → FIXED

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a38045983_159758)• 15 years ago |

Alias: CVE-2008-5913Keywords: [privacy](/buglist.cgi?keywords=privacy&resolution=---)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=475585#c22)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/23e155b902ac>
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=.4-fixed)Target Milestone: --- → mozilla1.9.3a5

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a38046076_159758)• 15 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a38049343_159758)• 15 years ago |

Depends on: [511328](/show_bug.cgi?id=511328 "RESOLVED FIXED - TM: make Math.random threadlocal")

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=475585#c23)• 15 years ago |
|  | |

Can't land this on 1.9.1 until [bug 511328](/show_bug.cgi?id=511328 "RESOLVED FIXED - TM: make Math.random threadlocal") lands there first...Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=475585#c24)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/5c5efa71e43a>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.10-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.10-fixed)

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=475585#c25)• 15 years ago |
|  | |

I don't know yet if third party software use these APIs, but this patch breaks ABI on 1.9.2. On 1.9.1, it also slightly unbreaks ABI from the changes from [bug 511328](/show_bug.cgi?id=511328 "RESOLVED FIXED - TM: make Math.random threadlocal").

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=475585#c26)• 15 years ago |
|  | |

Good news, none of the third party software using libmozjs in debian use the js\_LeaveTrace and js\_CanLeaveTrace functions which binary compatibility is broken by this change.

|  | [Mike Shaver (:shaver emeritus)](/user_profile?user_id=422) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=475585#c27)• 15 years ago |
|  | |

You should probably audit that 3rd-party software to make sure that none of it uses js\_\* (contra JS\_\*), because those aren't API.

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=475585#c28)• 15 years ago |
|  | |

Attached patch

[Backport for 1.9.0](attachment.cgi?id=453755&action=diff)
— [Details](attachment.cgi?id=453755&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=453755)

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=475585#c29)• 15 years ago |
|  | |

Comment on [attachment 453755](/attachment.cgi?id=453755 "Backport for 1.9.0") [[details]](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") [[diff]](/attachment.cgi?id=453755&action=diff "Backport for 1.9.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=453755)
Backport for 1.9.0
This is a backport of the Math.random() changes (both [bug 511328](/show_bug.cgi?id=511328 "RESOLVED FIXED - TM: make Math.random threadlocal") and this bug) from 1.9.1.10 on 1.9.0.x. We need that on Debian for our stable users, even though Mozilla dropped support for that branch. This backport seems to work properly, though I haven't tested if it does what it is supposed to (is there a known exploit or testcase, btw?)
Anyways, I'd appreciate some more eyes taking a look at this patch.
[Attachment #453755](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") -
Flags: review?(dolske)

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a44310135_47192)• 15 years ago |

[Attachment #453755](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") -
Flags: review?(jwalden+bmo)

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=475585#c30)• 15 years ago |
|  | |

Comment on [attachment 453755](/attachment.cgi?id=453755 "Backport for 1.9.0") [[details]](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") [[diff]](/attachment.cgi?id=453755&action=diff "Backport for 1.9.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=453755)
Backport for 1.9.0
Looks good to me.
[Attachment #453755](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") -
Flags: review+

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=475585#a45961219_83595)• 15 years ago |

[Attachment #453755](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") -
Flags: review?(jwalden+bmo) → review+

|  | [Smokey Ardisson (offline for a while; not following bugs - do not email)](/user_profile?user_id=155027) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=475585#c31)• 15 years ago |
|  | |

Comment on [attachment 453755](/attachment.cgi?id=453755 "Backport for 1.9.0") [[details]](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") [[diff]](/attachment.cgi?id=453755&action=diff "Backport for 1.9.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=453755)
Backport for 1.9.0
Since Mike posted the backport here and got reviews, I'm going to go ahead and request approval1.9.0.next on his patch so that we can get it in CVS for future non-MoCo-driven 1.9.0-based security releases.
Ordinarily I'd volunteer to check it in, too, except that AFAIK /js is still a restricted partition in CVS, so if this gets approval, I'll need to ask someone with access to the /js partition and who hasn't forgotten how to use CVS to check the backport in there. :(
[Attachment #453755](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") -
Flags: approval1.9.0.next?

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=475585#c32)• 15 years ago |
|  | |

In addition to this bug and [bug 511328](/show_bug.cgi?id=511328 "RESOLVED FIXED - TM: make Math.random threadlocal"), there's also [bug 577512](/show_bug.cgi?id=577512 "RESOLVED FIXED - (more) cross-domain information leakage with Math.random()") and [bug 464071](/show_bug.cgi?id=464071 "RESOLVED FIXED - User tracking via Math.random output and multipart/form-data boundary string") to consider in the backport.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=475585#c33)• 15 years ago |
|  | |

Comment on [attachment 453755](/attachment.cgi?id=453755 "Backport for 1.9.0") [[details]](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") [[diff]](/attachment.cgi?id=453755&action=diff "Backport for 1.9.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=453755)
Backport for 1.9.0
Approved for 1.9.0.20, a=dveditz
[Attachment #453755](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") -
Flags: approval1.9.0.next? → approval1.9.0.next+

|  | [Justin Dolske [:Dolske]](/user_profile?user_id=27780) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=475585#c34)• 14 years ago |
|  | |

Comment on [attachment 453755](/attachment.cgi?id=453755 "Backport for 1.9.0") [[details]](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") [[diff]](/attachment.cgi?id=453755&action=diff "Backport for 1.9.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=453755)
Backport for 1.9.0
The r+ from waldo and gal were sufficient here.
[Attachment #453755](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") -
Flags: review?(dolske)

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=475585#c35)• 14 years ago |
|  | |

(In reply to [comment #33](/show_bug.cgi?id=475585#c33 "RESOLVED FIXED - Re-seed Math.random() for each window/frame/context"))
> Comment on [attachment 453755](/attachment.cgi?id=453755 "Backport for 1.9.0") [[details]](/attachment.cgi?id=453755&action=edit "Backport for 1.9.0") [[diff]](/attachment.cgi?id=453755&action=diff "Backport for 1.9.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=475585&attachment=453755)
Don't think there's much point in taking this on 1.9.0 without its followup, [bug 577512](/show_bug.cgi?id=577512 "RESOLVED FIXED - (more) cross-domain information leakage with Math.random()").
You need to [log in](/show_bug.cgi?id=475585&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Andreas Gal :gal](/user_profile?user_id=310943)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


