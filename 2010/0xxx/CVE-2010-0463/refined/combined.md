=== Content from secure.grepular.com_e1a1fda1_20250124_173806.html ===

# [Grepular](./ "Take me Home Mike")

[Log in](./login?redirect=%2FDNS_Prefetch_Exposure_on_Thunderbird_and_Webmail)[Home](./)[Projects](./projects/)[Blog](./blog/)
## DNS Pre-fetch Exposure on Thunderbird and Webmail

*Written 15 years ago by Mike Cardwell*

When you view an email in [Mozilla Thunderbird](http://getthunderbird.com/), it looks at each of the URLs in the body, and does a DNS lookup on each of the domains. It does this so the page loads faster if you click on the link. It doesn’t just happen on HTML emails, it also happens for plain text emails. Viewing the body in “Plain Text” mode rather than the “Original HTML” or “Simple HTML” modes doesn’t prevent it either. This also happens when using webmail clients like GMail and Hotmail and I will discuss that further down the article.

Email clients tend to have a configuration option to prevent remote images from being loaded, and on sane clients this is set by default. If a remote image is fetched to be displayed inside an email, the sender can determine that the email has been read, when it was read, and the IP address it was read from. Even if remote images are disabled in Thunderbird, the DNS prefetching **still** takes place.

A spammer with the domain “example.com,” could send out a mail-shot to all of their addresses, with each email containing a URL with a unique domain. Eg:

```
http://emailaddressX.mailshotY.example.com/

```

They could configure the DNS server on example.com to log all DNS queries. This is simple to do using the [Bind DNS server](https://www.isc.org/software/bind):

```
logging {
    channel query_logging {
        file "/var/log/bind/query" versions 3 size 100M;
        print-time yes;
    };
    category queries {
        query_logging;
    };
};

```

They would then write a simple script for tailing the log file at /var/log/bind/query looking for DNS lookups containing “mailshotY.example.com”.

I tested this on the very latest version of Thunderbird (3.0.1), on both OSX (Snow Leopard) and Windows XP; both were affected. I also tested on Apple Mail and Outlook 2007, neither of which were affected. I didn’t bother testing Mutt or Pine.

This issue seems to have been [discussed](https://bugzilla.mozilla.org/show_bug.cgi?id=492196) back in May, but they don’t seem to have done anything about it.

Worryingly, this issue also affects viewing email in webmail clients. I tested it using hotmail and gmail and both did DNS prefetching on the URLs in the email body. Using HTTPS rather than HTTP disables DNS prefetching. Luckily for GMail users, they recently made all requests HTTPS by default. This would be easily fixed in webmail clients by using X-DNS-Prefetch-Control. In the HTML just before the email is displayed, you would put the following tag to disable prefetching:

```
<meta http-equiv="x-dns-prefetch-control" content="off">

```

In the HTML immediately after the email you would turn DNS prefetching back on with:

```
<meta http-equiv="x-dns-prefetch-control" content="on">

```

**Update:**

Patches for the Webmail clients [IMP](http://www.horde.org/imp/) ([ref](http://bugs.horde.org/ticket/8836)) and [RoundCube](http://www.roundcube.net/) ([ref](http://trac.roundcube.net/ticket/1486449)) have been produced. If you’re serving Webmail with Apache, you can patch this problem in the web server it’s self by adding some mod\_headers config like this:

```
Header set X-DNS-Prefetch-Control "off"

```

If you’re using Thunderbird, you can fix the problem locally by going into the advanced config editor and adding a preference named “network.dns.disablePrefetch” with a boolean value of “true”

Want to leave a tip?![Bitcoin](./images/bitcoin.png)![Monero](./images/monero.svg)![Zcash](./images/zcash.png)[![Paypal](./images/paypal.png)](//www.paypal.me/grepular "Donate via Paypal")You can follow this Blog using [RSS](./rss) or [Mastodon](//mastodon.social/%40grepular). To read more, visit my [blog index](./blog).

Website design, production and hosting by Mike Cardwell

[![Digital Ocean](./images/digitalocean-badge-white.png)](//www.digitalocean.com/?refcode=2529a7adf896 "This Blog, hosted on Digital Ocean - Fast, Cheap, Reliable VPS hosting (affiliate link)")![Bitcoin](./images/bitcoin.png)![Monero](./images/monero.svg)![Zcash](./images/zcash.png)[![Paypal](./images/paypal.png)](//www.paypal.me/grepular "Leave a Paypal tip")[![RSS Feed](./images/icon/rss-26x26.png)](./rss "RSS Feed")

=== Content from bugs.horde.org_9c3476e5_20250124_173805.html ===


6.0.0-git

* [▾
  Tasks](https://tasks.horde.org/)
  + [New Task](https://tasks.horde.org/task.php?actionID=add_task)
  + [Search](https://tasks.horde.org/search.php)

* [Photos](/h/ansel/)

* [Wiki](https://wiki.horde.org/)

* [▾
  Tickets](https://bugs.horde.org/)
  + [New Ticket](https://bugs.horde.org/ticket/create.php)
  + [Search](https://bugs.horde.org/search.php)

* + Toggle Alerts Log
  + [Help](/h/services/help/?module=whups)

2025-01-24

* [History](https://bugs.horde.org/ticket/8836)
* [Attachments](https://bugs.horde.org/ticket/8836/attachments)
* [Comment](https://bugs.horde.org/ticket/8836/comment)
* [Watch](https://bugs.horde.org/ticket/8836/watch)
* [Download](/h/services/download/?app=whups&actionID=ticket&id=8836&fn=%2Fticket8836.html)

[#8836] Signal the browser to turn off DNS prefetching when displaying untrusted content

| **Summary** | Signal the browser to turn off DNS prefetching when displaying untrusted content |
| --- | --- |
| **Queue** | IMP |
| **Queue Version** | Git master |
| **Type** | Enhancement |
| **State** | Resolved |
| **Priority** | 1. Low |
| **Owners** | slusarz (at) horde (dot) org |
| **Requester** | chuck (at) horde (dot) org |
| **Created** | 2010-01-24 (5479 days ago) |
| **Due** |  |
| **Updated** | 2010-07-01 (5321 days ago) |
| **Assigned** | 2010-07-01 (5321 days ago) |
| **Resolved** | 2010-07-01 (5321 days ago) |
| **Milestone** |  |
| **Patch** | No |

History

| 2010-07-01 20:03:56 | Michael Slusarz | [Comment #14](#c14)State ⇒ Resolved | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=59298) |
| --- | --- | --- | --- |
| Fixed in IMP 4.3.8 and DIMP 1.1.5 (MIMP does not need this fix because   MIMP 1.x does not generate links in message content). | | | |

| 2010-07-01 20:03:21 | Git Commit | [Comment #13](#c13) | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=59297) |
| --- | --- | --- | --- |
| Changes have been made in Git for this ticket:  ~~**[Bug #8836](https://bugs.horde.org/ticket/8836 "View Bug #8836")**~~: Fix attribute name  <http://git.horde.org/diff.php/framework/Text_Filter/lib/Horde/Text/Filter/Xss.php?rt=horde-git&r1=2effd3ce519011db72737c32c437f9c6364a23f0&r2=b942953b7b196c16a2f7777bbc55ac8e1661b655> | | | |

| 2010-07-01 20:00:29 | CVS Commit | [Comment #12](#c12) | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=59296) |
| --- | --- | --- | --- |
| Changes have been made in CVS for this ticket:  ~~**[Bug: 8836](https://bugs.horde.org/ticket/8836 "View Bug: 8836")**~~ Merge from git: disable DNS prefetching. <http://cvs.horde.org/diff.php/dimp/docs/CHANGES?rt=horde&r1=1.69.2.83&r2=1.69.2.84&ty=u> <http://cvs.horde.org/diff.php/dimp/index.php?rt=horde&r1=1.59.2.13&r2=1.59.2.14&ty=u> <http://cvs.horde.org/diff.php/dimp/lib/DIMP.php?rt=horde&r1=1.110.2.38&r2=1.110.2.39&ty=u> <http://cvs.horde.org/diff.php/dimp/message.php?rt=horde&r1=1.52.2.17&r2=1.52.2.18&ty=u> <http://cvs.horde.org/diff.php/imp/message.php?rt=horde&r1=2.560.4.61&r2=2.560.4.62&ty=u> <http://cvs.horde.org/diff.php/imp/templates/common-header.inc?rt=horde&r1=2.78.2.11&r2=2.78.2.12&ty=u> <http://cvs.horde.org/diff.php/imp/thread.php?rt=horde&r1=2.10.2.29&r2=2.10.2.30&ty=u> | | | |

| 2010-07-01 18:41:27 | Michael Slusarz | [Comment #11](#c11)State ⇒ Assigned | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=59295) |
| --- | --- | --- | --- |
| Altered how we do this (see commit message below).  Note that we disable DNS prefetching page-wide in the following cases: Message view (DIMP/IMP/MIMP) - this takes care of links that may be in   the subject/list headers and any inline viewable parts Thread view (IMP)  We do (will) NOT disable prefetching in the following cases: Viewing the contents of a part directly (i.e. view in a popup window).     If the user proactively takes the step of wanting to view a   particular message part, that is sufficient to indicate that they are   vouching for the integrity of the message. Print view (see above) Compose view - I have no clue if links that appear in Ckeditor are   prefetched or not, but the same reasoning applies - if you are   replying/forwarding to a message, you are vouching for integrity of   message. | | | |

| 2010-07-01 18:34:41 | Git Commit | [Comment #10](#c10) | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=59294) |
| --- | --- | --- | --- |
| Changes have been made in Git for this ticket:  ~~**[Bug #8836](https://bugs.horde.org/ticket/8836 "View Bug #8836")**~~: Rework DNS Prefetch disable META tags must be in HEAD tag to be correct HTML/XHTML. So we need to disable prefetching for the entire page - but only on pages where we are working with mail data.  <http://git.horde.org/diff.php/framework/Core/lib/Horde.php?rt=horde-git&r1=4f3bc19eac444e3d99b7e56b188bd9f99db3686d&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/framework/Mime/lib/Horde/Mime/Viewer/Enriched.php?rt=horde-git&r1=add5b9f9b63d81d29085a9615c30c4c9b4163e5d&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/framework/Mime/lib/Horde/Mime/Viewer/Html.php?rt=horde-git&r1=504e55792175710c0992a3ae3a5a4b62f43f8356&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/framework/Text_Filter/lib/Horde/Text/Filter/Xss.php?rt=horde-git&r1=23c8ed79dd7c65bca75f984646522f01fbec467b&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/imp/index-dimp.php?rt=horde-git&r1=76c1c091e8c027ce77dea8d76ceb2fef5d4cecb4&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/imp/lib/Mime/Viewer/Html.php?rt=horde-git&r1=c976326cfd1ee61836b14cfdfc223cea86053683&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/imp/lib/Mime/Viewer/Plain.php?rt=horde-git&r1=bf4719ffd4d666e00287a27dc1f42085a36ccb0e&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/imp/lib/Ui/Message.php?rt=horde-git&r1=bf4719ffd4d666e00287a27dc1f42085a36ccb0e&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/imp/message-dimp.php?rt=horde-git&r1=3da6a8d9e7f54b76cf39a34cf677521e419aa940&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/imp/message-mimp.php?rt=horde-git&r1=bf4719ffd4d666e00287a27dc1f42085a36ccb0e&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/imp/message.php?rt=horde-git&r1=bf4719ffd4d666e00287a27dc1f42085a36ccb0e&r2=2effd3ce519011db72737c32c437f9c6364a23f0> <http://git.horde.org/diff.php/imp/thread.php?rt=horde-git&r1=bf4719ffd4d666e00287a27dc1f42085a36ccb0e&r2=2effd3ce519011db72737c32c437f9c6364a23f0> | | | |

| 2010-05-22 14:54:51 | reg (at) debian (dot) org | [Comment #9](#c9) | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=58945) |
| --- | --- | --- | --- |
| Hello,  Do you plan to fix Horde 3 / IMP 4 ?  Regards, -- Gregory Colpart | | | |

| 2010-01-30 17:50:24 | Michael Slusarz | [Comment #8](#c8)Assigned to Michael SlusarzState ⇒ Resolved | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=57808) |
| --- | --- | --- | --- |
| Marking as resolved. | | | |

| 2010-01-30 17:49:56 | CVS Commit | [Comment #7](#c7) | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=57807) |
| --- | --- | --- | --- |
| Changes have been made in Git for this ticket:  ~~**[Ticket #8836](https://bugs.horde.org/ticket/8836 "View Ticket #8836")**~~: changelog  <http://git.horde.org/diff.php/horde/docs/CHANGES?rt=horde-git&r1=084e1f3eb2d91e32f3d74b70cf69a63202aee52f&r2=f7352a17a24e05b79e17b37d42d5ea5162f37658> | | | |

| 2010-01-26 23:42:13 | CVS Commit | [Comment #6](#c6) | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=57779) |
| --- | --- | --- | --- |
| Changes have been made in Git for this ticket:  ~~**[Ticket #8836](https://bugs.horde.org/ticket/8836 "View Ticket #8836")**~~: Add 'noprefetch' option to linkurls  <http://git.horde.org/diff.php/framework/Mime/lib/Horde/Mime/Viewer/Enriched.php?rt=horde-git&r1=1a310b2de34193b3f984e4506d87b32de412a65e&r2=add5b9f9b63d81d29085a9615c30c4c9b4163e5d> <http://git.horde.org/diff.php/framework/Mime/lib/Horde/Mime/Viewer/Plain.php?rt=horde-git&r1=eecbfcce7d795c9e0651a163b66e5628ac571d8e&r2=add5b9f9b63d81d29085a9615c30c4c9b4163e5d> <http://git.horde.org/diff.php/framework/Text_Filter/lib/Horde/Text/Filter/Linkurls.php?rt=horde-git&r1=1a310b2de34193b3f984e4506d87b32de412a65e&r2=add5b9f9b63d81d29085a9615c30c4c9b4163e5d> <http://git.horde.org/diff.php/framework/Text_Filter/lib/Horde/Text/Filter/Text2html.php?rt=horde-git&r1=1a310b2de34193b3f984e4506d87b32de412a65e&r2=add5b9f9b63d81d29085a9615c30c4c9b4163e5d> <http://git.horde.org/diff.php/imp/lib/Ajax/Application.php?rt=horde-git&r1=0b323e03586865781592a52370148f23636239b9&r2=add5b9f9b63d81d29085a9615c30c4c9b4163e5d> <http://git.horde.org/diff.php/imp/lib/Mime/Viewer/Plain.php?rt=horde-git&r1=1a310b2de34193b3f984e4506d87b32de412a65e&r2=add5b9f9b63d81d29085a9615c30c4c9b4163e5d> <http://git.horde.org/diff.php/imp/lib/Ui/Message.php?rt=horde-git&r1=518f99048e2a7a0d8fd8deb1ff4fb096474b02d8&r2=add5b9f9b63d81d29085a9615c30c4c9b4163e5d> <http://git.horde.org/diff.php/imp/mailbox.php?rt=horde-git&r1=b23cc31ca5d964fd8f9be807871eb0595aee63d9&r2=add5b9f9b63d81d29085a9615c30c4c9b4163e5d> | | | |

| 2010-01-26 22:40:49 | Michael Slusarz | [Comment #5](#c5) | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=57772) |
| --- | --- | --- | --- |
| Unfortunately, this also needs to be added to places where we convert   text -> links (i.e. text/plain parts). | | | |

| 2010-01-26 22:39:46 | CVS Commit | [Comment #4](#c4) | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=57770) |
| --- | --- | --- | --- |
| Changes have been made in Git for this ticket:  ~~**[Ticket #8836](https://bugs.horde.org/ticket/8836 "View Ticket #8836")**~~: Add 'noprefetch' option to XSS filter  <http://git.horde.org/diff.php/framework/Mime/lib/Horde/Mime/Viewer/Html.php?rt=horde-git&r1=206ebd97f0d6932358ca8ebdc7c8e06d4c5169b8&r2=504e55792175710c0992a3ae3a5a4b62f43f8356> <http://git.horde.org/diff.php/framework/Text_Filter/lib/Horde/Text/Filter/Xss.php?rt=horde-git&r1=ce64aa00d9d1e9f5b7183af9bdde35adbe38f4b4&r2=504e55792175710c0992a3ae3a5a4b62f43f8356> <http://git.horde.org/diff.php/framework/Text_Filter/package.xml?rt=horde-git&r1=14d802ae6bf6ae4e7d8721deeb3fd7ffab66a97a&r2=504e55792175710c0992a3ae3a5a4b62f43f8356> | | | |

| 2010-01-24 14:55:48 | Chuck Hagenbuch | [Comment #3](#c3) | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=57755) |
| --- | --- | --- | --- |
| It could apply anywhere we use the xss filter, I think. | | | |

| 2010-01-24 11:09:01 | Jan Schneider | [Comment #2](#c2)State ⇒ Feedback | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=57753) |
| --- | --- | --- | --- |
| Reading the article it should be sufficient to add this meta tag in   the message view of IMP, if not using HTTPS. Or do we have any other   place where personally targeted data from the outside with links are   being displayed? | | | |

| 2010-01-24 01:53:32 | Chuck Hagenbuch | [Comment #1](#c1)Type ⇒ EnhancementState ⇒ NewPriority ⇒ 1. LowSummary ⇒ Signal the browser to turn off DNS prefetching when displaying untrusted contentQueue ⇒ IMPMilestone ⇒ Patch ⇒ No | [Reply to this comment](https://bugs.horde.org/ticket/comment.php?id=8836&transaction=57752) |
| --- | --- | --- | --- |
| <https://secure.grepular.com/DNS_Prefetch_Exposure_on_Thunderbird_and_Webmail> | | | |

[New Ticket](https://bugs.horde.org/ticket/create.php "New Ticket (Accesskey N)")

[My Tickets](https://bugs.horde.org/mybugs.php)

[Search](https://bugs.horde.org/search.php)

[Query Builder](https://bugs.horde.org/query/index.php)

[Reports](https://bugs.horde.org/reports.php)

### Saved Queries

[Open Bugs](https://bugs.horde.org/query/bugs)

[Bugs waiting for Feedback](https://bugs.horde.org/query/feedback)

[Open Bugs in Releases](https://bugs.horde.org/query/releases)

[Open Enhancements](https://bugs.horde.org/query/enhancements)

[Enhancements waiting for Feedback](https://bugs.horde.org/query/263)

[Bugs with Patches](https://bugs.horde.org/query/277)

[Enhancements with Patches](https://bugs.horde.org/query/278)

[Release Showstoppers](https://bugs.horde.org/query/showstoppers)

[Stalled Tickets](https://bugs.horde.org/query/stalled)

[New Tickets](https://bugs.horde.org/query/new)

[Horde 5 Showstoppers](https://bugs.horde.org/query/showstoppers5)


