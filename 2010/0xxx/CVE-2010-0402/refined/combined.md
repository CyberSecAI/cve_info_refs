=== Content from github.com_79d6f844_20250126_074313.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenTTD%2FOpenTTD%2Fissues%2F3748)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenTTD%2FOpenTTD%2Fissues%2F3748)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=OpenTTD%2FOpenTTD)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenTTD](/OpenTTD)
/
**[OpenTTD](/OpenTTD/OpenTTD)**
Public

* [Notifications](/login?return_to=%2FOpenTTD%2FOpenTTD) You must be signed in to change notification settings
* [Fork
  930](/login?return_to=%2FOpenTTD%2FOpenTTD)
* [Star
   6.6k](/login?return_to=%2FOpenTTD%2FOpenTTD)

* [Code](/OpenTTD/OpenTTD)
* [Issues
  181](/OpenTTD/OpenTTD/issues)
* [Pull requests
  145](/OpenTTD/OpenTTD/pulls)
* [Discussions](/OpenTTD/OpenTTD/discussions)
* [Actions](/OpenTTD/OpenTTD/actions)
* [Security](/OpenTTD/OpenTTD/security)
* [Insights](/OpenTTD/OpenTTD/pulse)

Additional navigation options

* [Code](/OpenTTD/OpenTTD)
* [Issues](/OpenTTD/OpenTTD/issues)
* [Pull requests](/OpenTTD/OpenTTD/pulls)
* [Discussions](/OpenTTD/OpenTTD/discussions)
* [Actions](/OpenTTD/OpenTTD/actions)
* [Security](/OpenTTD/OpenTTD/security)
* [Insights](/OpenTTD/OpenTTD/pulse)

# problems with invalid commands #3748

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[problems with invalid commands](#top)#3748Copy linkLabels[flysprayThis issue is imported from FlySpray (https://bugs.openttd.org/)](https://github.com/OpenTTD/OpenTTD/issues?q=state%3Aopen%20label%3A%22flyspray%22)This issue is imported from FlySpray (https://bugs.openttd.org/)[![@DorpsGek](https://avatars.githubusercontent.com/u/16524860?u=bc99de718bbd1eca702f44f4fba5c55a342458a8&v=4&size=80)](/DorpsGek)
## Description

[![@DorpsGek](https://avatars.githubusercontent.com/u/16524860?u=bc99de718bbd1eca702f44f4fba5c55a342458a8&v=4&size=48)](/DorpsGek)[DorpsGek](https://github.com/DorpsGek)opened [on Apr 10, 2010](https://github.com/OpenTTD/OpenTTD/issues/3748#issue-312179279)

***SmatZ* opened the ticket and wrote:**

> Attached file sends random commands when connected as client to network server. Server crashes in few seconds.
>
> There is a chance there will be more recent version of the patch:
>
> <http://devs.openttd.org/~smatz/private/problem.diff>
>
> Known broken commands:
>
> CmdSend\*ToDepot
>
> CmdMassStartStopVehicle
>
> generally commands that need to build vehicle list
>
> Example backtrace:
>
> # 3 0x00000000005cdb8d in Pool<Vehicle, unsigned short, 512ul, 64000ul, false, true>::Get (this=0xe77520, index=1958905846)
>
> at /home/smatz/openttd/rev/src/ai/api/../../core/pool\_type.hpp:53
>
> \_*PRETTY\_FUNCTION*\_ = "Titem\* Pool<Titem, Tindex, Tgrowth\_step, Tmax\_size, Tcache, Tzero>::Get(size\_t) [with Titem = Vehicle, Tindex = short unsigned int, long unsigned int Tgrowth\_step = 512ul, long unsigned int Tmax\_size "...
>
> # 4 0x00000000005cdb39 in Pool<Vehicle, unsigned short, 512ul, 64000ul, false, true>::PoolItem<&\_vehicle\_pool>::Get (index=1958905846)
>
> at /home/smatz/openttd/rev/src/ai/api/../../core/pool\_type.hpp:183
>
> No locals.
>
> # 5 0x0000000000846f6f in GenerateVehicleSortList (list=0x7fffffffd700, type=VEH\_AIRCRAFT, owner=OWNER\_BEGIN, index=1958905846, window\_type=256)
>
> at /home/smatz/openttd/rev/src/vehiclelist.cpp:104
>
> v = 0x86793f
>
> # 6 0x000000000083574c in SendAllVehiclesToDepot (type=VEH\_AIRCRAFT, flags=DC\_NONE, service=true, owner=OWNER\_BEGIN, vlw\_flag=256, id=1958905846)
>
> at /home/smatz/openttd/rev/src/vehicle\_cmd.cpp:593
>
> list = {data = 0x0, items = 0, capacity = 0}
>
> had\_success = 255
>
> # 7 0x00000000005de3b2 in CmdSendAircraftToHangar (tile=56363, flags=DC\_NONE, p1=1958905846, p2=3490025887, text=0x10f4518 "")
>
> at /home/smatz/openttd/rev/src/aircraft\_cmd.cpp:446
>
> v = 0xe75330
>
> NOTE: unprivate [#3747](https://github.com/OpenTTD/OpenTTD/issues/3747) when this is done :) (ask Rubidium as it needs some DB messing)

**Attachments**

* [problem.diff](https://bugs.openttd.org/task/3748/getfile/5936/problem.diff) (1.60 KiB)

**Reported version**: *trunk*

**Operating system**: *All*

---

###### *This issue was imported from FlySpray: <https://bugs.openttd.org/task/3748>*

## Metadata

### Assignees

No one assigned

### Labels

[flysprayThis issue is imported from FlySpray (https://bugs.openttd.org/)](https://github.com/OpenTTD/OpenTTD/issues?q=state%3Aopen%20label%3A%22flyspray%22)This issue is imported from FlySpray (https://bugs.openttd.org/)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4d589567_20250126_074312.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenTTD%2FOpenTTD%2Fcommit%2F2365a4d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenTTD%2FOpenTTD%2Fcommit%2F2365a4d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenTTD%2FOpenTTD)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenTTD](/OpenTTD)
/
**[OpenTTD](/OpenTTD/OpenTTD)**
Public

* [Notifications](/login?return_to=%2FOpenTTD%2FOpenTTD) You must be signed in to change notification settings
* [Fork
  930](/login?return_to=%2FOpenTTD%2FOpenTTD)
* [Star
   6.6k](/login?return_to=%2FOpenTTD%2FOpenTTD)

* [Code](/OpenTTD/OpenTTD)
* [Issues
  181](/OpenTTD/OpenTTD/issues)
* [Pull requests
  145](/OpenTTD/OpenTTD/pulls)
* [Discussions](/OpenTTD/OpenTTD/discussions)
* [Actions](/OpenTTD/OpenTTD/actions)
* [Security](/OpenTTD/OpenTTD/security)
* [Insights](/OpenTTD/OpenTTD/pulse)

Additional navigation options

* [Code](/OpenTTD/OpenTTD)
* [Issues](/OpenTTD/OpenTTD/issues)
* [Pull requests](/OpenTTD/OpenTTD/pulls)
* [Discussions](/OpenTTD/OpenTTD/discussions)
* [Actions](/OpenTTD/OpenTTD/actions)
* [Security](/OpenTTD/OpenTTD/security)
* [Insights](/OpenTTD/OpenTTD/pulse)

## Commit

[Permalink](/OpenTTD/OpenTTD/commit/2365a4dea0ffa0eac31193c70680368c4774903d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

(svn r19657) -Fix: Add saneness checks for front vehicles.

[Browse files](/OpenTTD/OpenTTD/tree/2365a4dea0ffa0eac31193c70680368c4774903d)
Browse the repository at this point in the history

* Loading branch information

[![@frosch123](https://avatars.githubusercontent.com/u/23150643?s=40&v=4)](/frosch123)

[frosch123](/OpenTTD/OpenTTD/commits?author=frosch123 "View all commits by frosch123")
committed
Apr 17, 2010

1 parent
[5ecf2f7](/OpenTTD/OpenTTD/commit/5ecf2f7f8cb157d959c42b3396398f03d3f3fffb)

commit 2365a4d

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**15 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + src/order\_cmd.cpp
    [order\_cmd.cpp](#diff-380d4603b56ad2da06966f31208648ab85be2f6729594c2b703482e3ce66ac97)
  + src/vehicle\_cmd.cpp
    [vehicle\_cmd.cpp](#diff-bc9cddc00e8fc4a5743f7aa66e0bb0cff02c4853cc203b0d4be7389d45fae795)

## There are no files selected for viewing

24 changes: 12 additions & 12 deletions

24
[src/order\_cmd.cpp](#diff-380d4603b56ad2da06966f31208648ab85be2f6729594c2b703482e3ce66ac97 "src/order_cmd.cpp")

Show comments

[View file](/OpenTTD/OpenTTD/blob/2365a4dea0ffa0eac31193c70680368c4774903d/src/order_cmd.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -469,7 +469,7 @@ CommandCost CmdInsertOrder(TileIndex tile, DoCommandFlag flags, uint32 p1, uint3 |
|  |  | Order new\_order(p2); |
|  |  |  |
|  |  | Vehicle \*v = Vehicle::GetIfValid(veh); |
|  |  | if (v == NULL) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(v->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down  Expand Up | | @@ -560,8 +560,6 @@ CommandCost CmdInsertOrder(TileIndex tile, DoCommandFlag flags, uint32 p1, uint3 |
|  |  | default: return CMD\_ERROR; |
|  |  | } |
|  |  | } |
|  |  | } else { |
|  |  | if (!IsCompanyBuildableVehicleType(v)) return CMD\_ERROR; |
|  |  | } |
|  |  |  |
|  |  | if (new\_order.GetNonStopType() != ONSF\_STOP\_EVERYWHERE && v->type != VEH\_TRAIN && v->type != VEH\_ROAD) return CMD\_ERROR; |
| Expand Down  Expand Up | | @@ -748,7 +746,7 @@ CommandCost CmdDeleteOrder(TileIndex tile, DoCommandFlag flags, uint32 p1, uint3 |
|  |  |  |
|  |  | Vehicle \*v = Vehicle::GetIfValid(veh\_id); |
|  |  |  |
|  |  | if (v == NULL) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(v->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down  Expand Up | | @@ -817,7 +815,7 @@ CommandCost CmdSkipToOrder(TileIndex tile, DoCommandFlag flags, uint32 p1, uint3 |
|  |  |  |
|  |  | Vehicle \*v = Vehicle::GetIfValid(veh\_id); |
|  |  |  |
|  |  | if (v == NULL || sel\_ord == v->cur\_order\_index || sel\_ord >= v->GetNumOrders() || v->GetNumOrders() < 2) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle() || sel\_ord == v->cur\_order\_index || sel\_ord >= v->GetNumOrders() || v->GetNumOrders() < 2) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(v->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down  Expand Up | | @@ -857,7 +855,7 @@ CommandCost CmdMoveOrder(TileIndex tile, DoCommandFlag flags, uint32 p1, uint32 |
|  |  | VehicleOrderID target\_order = GB(p2, 16, 16); |
|  |  |  |
|  |  | Vehicle \*v = Vehicle::GetIfValid(veh); |
|  |  | if (v == NULL) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(v->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down  Expand Up | | @@ -940,7 +938,7 @@ CommandCost CmdModifyOrder(TileIndex tile, DoCommandFlag flags, uint32 p1, uint3 |
|  |  | if (mof >= MOF\_END) return CMD\_ERROR; |
|  |  |  |
|  |  | Vehicle \*v = Vehicle::GetIfValid(veh); |
|  |  | if (v == NULL) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(v->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down  Expand Up | | @@ -1166,7 +1164,7 @@ CommandCost CmdCloneOrder(TileIndex tile, DoCommandFlag flags, uint32 p1, uint32 |
|  |  | VehicleID veh\_dst = GB(p1, 0, 16); |
|  |  |  |
|  |  | Vehicle \*dst = Vehicle::GetIfValid(veh\_dst); |
|  |  | if (dst == NULL) return CMD\_ERROR; |
|  |  | if (dst == NULL || !dst->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(dst->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand All | | @@ -1176,7 +1174,7 @@ CommandCost CmdCloneOrder(TileIndex tile, DoCommandFlag flags, uint32 p1, uint32 |
|  |  | Vehicle \*src = Vehicle::GetIfValid(veh\_src); |
|  |  |  |
|  |  | /\* Sanity checks \*/ |
|  |  | if (src == NULL || dst->type != src->type || dst == src) return CMD\_ERROR; |
|  |  | if (src == NULL || !src->IsPrimaryVehicle() || dst->type != src->type || dst == src) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(src->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down  Expand Up | | @@ -1218,7 +1216,7 @@ CommandCost CmdCloneOrder(TileIndex tile, DoCommandFlag flags, uint32 p1, uint32 |
|  |  | Vehicle \*src = Vehicle::GetIfValid(veh\_src); |
|  |  |  |
|  |  | /\* Sanity checks \*/ |
|  |  | if (src == NULL || dst->type != src->type || dst == src) return CMD\_ERROR; |
|  |  | if (src == NULL || !src->IsPrimaryVehicle() || dst->type != src->type || dst == src) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(src->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down  Expand Up | | @@ -1294,8 +1292,10 @@ CommandCost CmdOrderRefit(TileIndex tile, DoCommandFlag flags, uint32 p1, uint32 |
|  |  | CargoID cargo = GB(p2, 0, 8); |
|  |  | byte subtype = GB(p2, 8, 8); |
|  |  |  |
|  |  | if (cargo >= NUM\_CARGO) return CMD\_ERROR; |
|  |  |  |
|  |  | const Vehicle \*v = Vehicle::GetIfValid(veh); |
|  |  | if (v == NULL) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(v->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down  Expand Up | | @@ -1450,7 +1450,7 @@ CommandCost CmdRestoreOrderIndex(TileIndex tile, DoCommandFlag flags, uint32 p1, |
|  |  |  |
|  |  | Vehicle \*v = Vehicle::GetIfValid(p1); |
|  |  | /\* Check the vehicle type and ownership, and if the service interval and order are in range \*/ |
|  |  | if (v == NULL) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(v->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down | |  |

6 changes: 3 additions & 3 deletions

6
[src/vehicle\_cmd.cpp](#diff-bc9cddc00e8fc4a5743f7aa66e0bb0cff02c4853cc203b0d4be7389d45fae795 "src/vehicle_cmd.cpp")

Show comments

[View file](/OpenTTD/OpenTTD/blob/2365a4dea0ffa0eac31193c70680368c4774903d/src/vehicle_cmd.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -410,7 +410,7 @@ CommandCost CmdCloneVehicle(TileIndex tile, DoCommandFlag flags, uint32 p1, uint |
|  |  | uint32 build\_argument = 2; |
|  |  |  |
|  |  | Vehicle \*v = Vehicle::GetIfValid(p1); |
|  |  | if (v == NULL) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  | Vehicle \*v\_front = v; |
|  |  | Vehicle \*w = NULL; |
|  |  | Vehicle \*w\_front = NULL; |
| Expand Down  Expand Up | | @@ -629,7 +629,7 @@ CommandCost SendAllVehiclesToDepot(VehicleType type, DoCommandFlag flags, bool s |
|  |  | CommandCost CmdRenameVehicle(TileIndex tile, DoCommandFlag flags, uint32 p1, uint32 p2, const char \*text) |
|  |  | { |
|  |  | Vehicle \*v = Vehicle::GetIfValid(p1); |
|  |  | if (v == NULL) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(v->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down  Expand Up | | @@ -663,7 +663,7 @@ CommandCost CmdRenameVehicle(TileIndex tile, DoCommandFlag flags, uint32 p1, uin |
|  |  | CommandCost CmdChangeServiceInt(TileIndex tile, DoCommandFlag flags, uint32 p1, uint32 p2, const char \*text) |
|  |  | { |
|  |  | Vehicle \*v = Vehicle::GetIfValid(p1); |
|  |  | if (v == NULL) return CMD\_ERROR; |
|  |  | if (v == NULL || !v->IsPrimaryVehicle()) return CMD\_ERROR; |
|  |  |  |
|  |  | CommandCost ret = CheckOwnership(v->owner); |
|  |  | if (ret.Failed()) return ret; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2365a4d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenTTD%2FOpenTTD%2Fcommit%2F2365a4d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.openttd.org_37068323_20250125_091329.html ===


* [Download stable (14.1)](/downloads/openttd-releases/latest.html)
* [Download testing (15.0-beta1)](/downloads/openttd-releases/testing.html)
* [Download nightly (20250122)](/downloads/openttd-nightlies/latest.html)

[![OpenTTD](/static/img/layout/openttd-logo.png)](/)

* [Security tracker](/security.html)

### CVE-2010-0402 (vulnerable 0.3.5 - fixed 1.0.1)

Short description: Denial of service via improperly validated commands

[Official CVE-2010-0402 entry at cve.mitre.org.](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-0402)

Related bug reports:

* [GitHub Issue #3748](https://github.com/OpenTTD/OpenTTD/issues/3748)
* [GitHub Issue #3747](https://github.com/OpenTTD/OpenTTD/issues/3747)

Related commits:

* [1f28e23](https://github.com/OpenTTD/OpenTTD/commit/1f28e23)
* [a929ab0](https://github.com/OpenTTD/OpenTTD/commit/a929ab0)
* [0f65601](https://github.com/OpenTTD/OpenTTD/commit/0f65601)
* [75d4bc9](https://github.com/OpenTTD/OpenTTD/commit/75d4bc9)
* [2a5ddd0](https://github.com/OpenTTD/OpenTTD/commit/2a5ddd0)
* [5ecf2f7](https://github.com/OpenTTD/OpenTTD/commit/5ecf2f7)
* [2365a4d](https://github.com/OpenTTD/OpenTTD/commit/2365a4d)

Patches: (sometimes more fuzz is needed to apply them)

* [For version 1.0.0 up to including 1.0.0](/security/CVE-2010-0402/1.0.0%20-%201.0.0.patch)
* [For version 0.7.0 up to including 0.7.5](/security/CVE-2010-0402/0.7.0%20-%200.7.5.patch)
* [For version 0.6.0 up to including 0.6.3](/security/CVE-2010-0402/0.6.0%20-%200.6.3.patch)

In multiple places in-game commands are not properly validated that allow
remote attackers to cause a denial of service (crash) and possibly execute
arbitrary code via unspecified vectors.

The bug is exploitable only in-game so the attacker must have access to
the server: his IP must not be banned, he must know the password if it
has been set and the server must not be full.

The one root cause of this problem is a generalised “pool” system that uses
size\_t to store/access indices, but has typed validation checks to check
indices. Some of these checks use 16 bit integers, which means that a 32 bit
“command parameter” gets silently (by the compiler) truncated to 16 bits before
being checked after which the 32 bit number is used to access items in the
pool.

For example item 0 exists, the pool has that one item and the command parameter
is 65536. The validation function would be checking 0, as the high 16 bits of
the parameter would be (silently) discarded, and as such the check returns that
it is a valid item. This then results in trying to get item 65536 which is way
outside of the valid range of the pool.

However, it is not solely confined to pooled items; there are a few cases where
a not-yet-validated value is used.

Attached are patches for all vulnerable versions since 0.6.0. Note that this is
in essence a partial backport of trunk r19657, r19656, r19655, r19654, r19637,
r19633 and r19621. The “in essence” is because those patches change the whole
handling of command parameters which is 90% changing to conform to the new
policy or standard and 10% actually fixes the crashes. Therefor we chose to
make one minimalistic patch for each of the stable series since 0.6 that solves
all issues we are aware of, without ending up with a ten times larger diff with
many unrelated unneeded changes. Also earlier releases were more vulnerable
than the later ones due to improvements in the pool system and some rewrites.

Due to the time needed for assembling these patches and because we are unaware
of any Linux distribution shipping OpenTTD from before the 0.6 series in a
still supported release we have not made patches for those. They are vulnerable
though.

This fix maintains network compatability of patched and unpatched OpenTTD’s
except the cases where the unpatched version would crash, but then the crash
would be the cause of the disconnection and not that they are incompatible
on that part of the network communication.

* [Privacy Policy](/policy.html)
* [Content Creation Guidelines](/content-creators.html)
* [Contact](/contact.html)

Copyright © 2005-2025 OpenTTD Team



=== Content from github.com_ad633540_20250126_074315.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenTTD%2FOpenTTD%2Fissues%2F3747)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenTTD%2FOpenTTD%2Fissues%2F3747)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=OpenTTD%2FOpenTTD)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenTTD](/OpenTTD)
/
**[OpenTTD](/OpenTTD/OpenTTD)**
Public

* [Notifications](/login?return_to=%2FOpenTTD%2FOpenTTD) You must be signed in to change notification settings
* [Fork
  930](/login?return_to=%2FOpenTTD%2FOpenTTD)
* [Star
   6.6k](/login?return_to=%2FOpenTTD%2FOpenTTD)

* [Code](/OpenTTD/OpenTTD)
* [Issues
  181](/OpenTTD/OpenTTD/issues)
* [Pull requests
  145](/OpenTTD/OpenTTD/pulls)
* [Discussions](/OpenTTD/OpenTTD/discussions)
* [Actions](/OpenTTD/OpenTTD/actions)
* [Security](/OpenTTD/OpenTTD/security)
* [Insights](/OpenTTD/OpenTTD/pulse)

Additional navigation options

* [Code](/OpenTTD/OpenTTD)
* [Issues](/OpenTTD/OpenTTD/issues)
* [Pull requests](/OpenTTD/OpenTTD/pulls)
* [Discussions](/OpenTTD/OpenTTD/discussions)
* [Actions](/OpenTTD/OpenTTD/actions)
* [Security](/OpenTTD/OpenTTD/security)
* [Insights](/OpenTTD/OpenTTD/pulse)

# DoS: company 0 and effect vehicles #3747

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[DoS: company 0 and effect vehicles](#top)#3747Copy linkLabels[flysprayThis issue is imported from FlySpray (https://bugs.openttd.org/)](https://github.com/OpenTTD/OpenTTD/issues?q=state%3Aopen%20label%3A%22flyspray%22)This issue is imported from FlySpray (https://bugs.openttd.org/)[![@DorpsGek](https://avatars.githubusercontent.com/u/16524860?u=bc99de718bbd1eca702f44f4fba5c55a342458a8&v=4&size=80)](/DorpsGek)
## Description

[![@DorpsGek](https://avatars.githubusercontent.com/u/16524860?u=bc99de718bbd1eca702f44f4fba5c55a342458a8&v=4&size=48)](/DorpsGek)[DorpsGek](https://github.com/DorpsGek)opened [on Apr 9, 2010](https://github.com/OpenTTD/OpenTTD/issues/3747#issue-312179277)

***Rubidium* opened the ticket and wrote:**

> Company 0 is owner of effect vehicles, so quite a lot of vehicle validity checks will gladly allow execution of commands for effect vehicles. E.g. order insertion, which will then NOT\_REACHED() crash when updating some window.

**Reported version**: *1.0.0*

**Operating system**: *All*

---

###### *This issue was imported from FlySpray: <https://bugs.openttd.org/task/3747>*

## Metadata

### Assignees

No one assigned

### Labels

[flysprayThis issue is imported from FlySpray (https://bugs.openttd.org/)](https://github.com/OpenTTD/OpenTTD/issues?q=state%3Aopen%20label%3A%22flyspray%22)This issue is imported from FlySpray (https://bugs.openttd.org/)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


