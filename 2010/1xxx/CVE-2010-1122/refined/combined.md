=== Content from www.mandriva.com_2b6fb0a2_20250125_133042.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from bugzilla.mozilla.org_384306f8_20250125_133044.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/552216)
* [XML](/show_bug.cgi?ctype=xml&id=552216)

Closed
[Bug 552216](/show_bug.cgi?id=552216)
(CVE-2010-1028)

Opened 15 years ago
Closed 15 years ago

# WOFF heap corruption due to integer overflow

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

WOFF heap corruption due to integer overflow

## Categories

### (Core :: Layout: Text and Fonts, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts#Layout%3A%20Text%20and%20Fonts)

Layout: Text and Fonts
▾

Core :: Layout: Text and Fonts

Issues with CSS font selection, font loading, text shaping and glyph selection, breaking, text decorations, bidirectional text processing, and white space processing. For issues with glyph rendering and font format support, see the Graphics: Text component.

Example bugs:

* line-breaking code does not handle supplementary-plane characters properly
* double or wavy decoration lines are not repainted correctly if specified on floating first letter

Specifications covered:

* CSS Fonts
* CSS Size Adjustment
* CSS Text
* CSS Text Decoration

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.3a4

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| blocking1.9.2 | --- | [.2+](/buglist.cgi?f1=cf_blocking_192&o1=equals&v1=.2%2B) |
| status1.9.2 | --- | [.2-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=.2-fixed) |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| blocking1.9.2 |  |  |
| status1.9.2 |  | .2-fixed |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bsterne, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/e79a0c577aa716ea632e557a0f1b2da8?d=mm&size=40)  [bsterne](/user_profile?user_id=296777)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

26 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[554189](/show_bug.cgi?id=554189 "RESOLVED DUPLICATE - WOFF Font Format dirEntry Remote Code Execution Vulnerability (ZDI-CAN-741)")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, verified1.9.2, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2010-1028

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | [in-testsuite](#a59496_5168 "15 years ago") | ? |
| --- | --- | --- |
| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 2 obsolete files)

| [check for potential arithmetic overflow](/attachment.cgi?id=432363)  [15 years ago](#c13)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   924 bytes, patch | roc : [review+](#c13 "15 years ago") | [Details](/attachment.cgi?id=432363&action=edit) | [Diff](/attachment.cgi?id=432363&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432363) |
| --- | --- | --- |
| [use 64-bit arithmetic to avoid risk of overflow](/attachment.cgi?id=432405)  [15 years ago](#c14)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   1.62 KB, patch | roc : [review+](#a51399_5038 "15 years ago")  dveditz : [superreview+](#a587016_1689 "15 years ago") | [Details](/attachment.cgi?id=432405&action=edit) | [Diff](/attachment.cgi?id=432405&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432405) |
| [patch for 1.9.2 branch, includes followup windows bustage fix](/attachment.cgi?id=432408)  [15 years ago](#c16)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   2.39 KB, patch |  | [Details](/attachment.cgi?id=432408&action=edit) | [Diff](/attachment.cgi?id=432408&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432408) |
| [patch for 1.9.2 branch, includes followups](/attachment.cgi?id=432409)  [15 years ago](#c18)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   2.53 KB, patch | dveditz : [superreview+](#c27 "15 years ago")  beltzner : [approval1.9.2.2+](#c20 "15 years ago") | [Details](/attachment.cgi?id=432409&action=edit) | [Diff](/attachment.cgi?id=432409&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432409) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Brandon Sterne (:bsterne)](/user_profile?user_id=296777)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=552216#c0)• 15 years ago |
|  | |

Attached file
[Proof of concept](attachment.cgi?id=432357)
— [Details](attachment.cgi?id=432357&action=edit)

Evgeny L. from Vulndisco reported a crash due to a buffer overflow in our WOFF parser. I am able to reproduce the crash, but the stack I get doesn't appear to be in font parser code. I'll try it in a debug build shortly to see if it looks any different. Here's the crash report where it looks like we're calling null:
0bc35855-ee77-4c61-b469-c7c482100313
To reproduce, run the attached python script ff1.py and load
<http://localhost:8080/1.html>

|  | [Brandon Sterne (:bsterne)](/user_profile?user_id=296777)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a43_296777)• 15 years ago |

OS: Mac OS X → AllWhiteboard: [sg:critical?]

|  | [Brandon Sterne (:bsterne)](/user_profile?user_id=296777)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=552216#c1)• 15 years ago |
|  | |

More useful link to crash report:
<http://crash-stats.mozilla.com/report/index/0bc35855-ee77-4c61-b469-c7c482100313>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=552216#c2)• 15 years ago |
|  | |

On windows I see [bp-37919069-18f3-4289-aa5d-33b6a2100313](https://crash-stats.mozilla.org/report/index/37919069-18f3-4289-aa5d-33b6a2100313) which makes a little more sense -- at least the crash address looks like it came from the bogus server data.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=552216#c3)• 15 years ago |
|  | |

Also slightly different [bp-4119d51b-c798-4c23-82f4-7aa652100313](https://crash-stats.mozilla.org/report/index/4119d51b-c798-4c23-82f4-7aa652100313)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a5805_329583)• 15 years ago |

Assignee: nobody → jfkthame
[Attachment #432363](/attachment.cgi?id=432363&action=edit "check for potential arithmetic overflow") -
Flags: review?(jdaggett)

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=552216#c5)• 15 years ago |
|  | |

we should try and squeeze this in to fx 3.6.2.
We need to confirm but it's possible this is the zeroday reported by Evgeny and Secunia at <http://secunia.com/advisories/38608/>blocking1.9.1: --- → ?

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=552216#c6)• 15 years ago |
|  | |

Switching the blocking request to 1.9.2, woff is not supported in 1.9.1 (Fx 3.5).blocking1.9.1: ? → ---blocking1.9.2: --- → ?

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=552216#c7)• 15 years ago |
|  | |

I wonder what is causing a few crash reports with the same signature as in [comment 2](/show_bug.cgi?id=552216#c2 "RESOLVED FIXED - WOFF heap corruption due to integer overflow") to show up for fx3.5.8
nsCOMPtr\_base::assign\_assuming\_AddRef(nsISupports\*) | nsInputStreamPump::OnStateStop()
<http://crash-stats.mozilla.com/report/index/b1ab0b18-0e4a-4545-8be4-382692100301>
[http://crash-stats.mozilla.com/report/list?product=Firefox&query\_search=signature&query\_type=contains&query=nsCOMPtr\_base%3A%3Aassign\_assuming\_AddRef%28nsISupports\*%29%20|%20nsInputStreamPump%3A%3AOnStateStop%28%29&date=&range\_value=8&range\_unit=weeks&process\_type=all&plugin\_field=&plugin\_query\_type=&plugin\_query=&do\_query=1&signature=nsCOMPtr\_base%3A%3Aassign\_assuming\_AddRef%28nsISupports\*%29%20|%20nsInputStreamPump%3A%3AOnStateStop%28%29](http://crash-stats.mozilla.com/report/list?product=Firefox&query_search=signature&query_type=contains&query=nsCOMPtr_base%3A%3Aassign_assuming_AddRef%28nsISupports*%29%20|%20nsInputStreamPump%3A%3AOnStateStop%28%29&date=&range_value=8&range_unit=weeks&process_type=all&plugin_field=&plugin_query_type=&plugin_query=&do_query=1&signature=nsCOMPtr_base%3A%3Aassign_assuming_AddRef%28nsISupports*%29%20|%20nsInputStreamPump%3A%3AOnStateStop%28%29)
there are also some 3.5.8 and 3.5.3 reports on the signature in [comment 3](/show_bug.cgi?id=552216#c3 "RESOLVED FIXED - WOFF heap corruption due to integer overflow")
nsStreamListenerTee::OnStopRequest(nsIRequest\*, nsISupports\*, unsigned int)
[http://crash-stats.mozilla.com/report/list?product=Firefox&query\_search=signature&query\_type=contains&query=nsStreamListenerTee%3A%3AOnStopRequest%28nsIRequest\*%2C%20nsISupports\*%2C%20unsigned%20int%29&date=&range\_value=2&range\_unit=weeks&process\_type=all&plugin\_field=&plugin\_query\_type=&plugin\_query=&do\_query=1&signature=nsStreamListenerTee%3A%3AOnStopRequest%28nsIRequest\*%2C%20nsISupports\*%2C%20unsigned%20int%29](http://crash-stats.mozilla.com/report/list?product=Firefox&query_search=signature&query_type=contains&query=nsStreamListenerTee%3A%3AOnStopRequest%28nsIRequest*%2C%20nsISupports*%2C%20unsigned%20int%29&date=&range_value=2&range_unit=weeks&process_type=all&plugin_field=&plugin_query_type=&plugin_query=&do_query=1&signature=nsStreamListenerTee%3A%3AOnStopRequest%28nsIRequest*%2C%20nsISupports*%2C%20unsigned%20int%29)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=552216#c8)• 15 years ago |
|  | |

Note that none of these crash signatures are closely associated with the woff-decoder bug (even though on 3.6, they may be caused by it). The bug is such that we end up using zlib to decompress into a too-small buffer; we therefore overwrite some other chunk of memory with the decomressed data; and subsequently crash when another part of the code makes use of its now-damaged data. So similar crash signatures could occur as a result of more or less any memory-stomping bug.
So all this tells us is that there must be something in 3.5.x that can trash memory in a vaguely similar way. It's certainly not the woff code in that case, as it isn't even present in the 1.9.1 tree. Maybe there's some other compressed-format decoder such as jpeg or png that can be fooled in a similar way? If we had a proof-of-concept that triggers the crashes on 3.5.x we could probably locate the problem there.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=552216#c9)• 15 years ago |
|  | |

Do we need to allow orig length anywhere near 4G-3? Even given machines that can handle it that's a ridiculous font size -- no reasonable font will be anything close to that by several orders of magnitude and it allows an unreasonable font to suck up huge amounts of your resources. On OS X 10.5 the biggest font I have is 华文细黑.ttf at 17.4 Mb, followed by AppleGothic at 15. Half of 'em are under 1Mb.
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted)Summary: Investigate reported WOFF parser buffer overflow → WOFF heap corruption due to integer overflow

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=552216#c10)• 15 years ago |
|  | |

CC'ing the reporter

|  | [Evgeny L.](/user_profile?user_id=376485) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=552216#c11)• 15 years ago |
|  | |

(In reply to [comment #5](/show_bug.cgi?id=552216#c5 "RESOLVED FIXED - WOFF heap corruption due to integer overflow"))
> we should try and squeeze this in to fx 3.6.2.
>
> We need to confirm but it's possible this is the zeroday reported by Evgeny and
> Secunia at <http://secunia.com/advisories/38608/>
Exactly, this is the bug i've found.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=552216#c12)• 15 years ago |
|  | |

(In reply to [comment #9](/show_bug.cgi?id=552216#c9 "RESOLVED FIXED - WOFF heap corruption due to integer overflow"))
> Do we need to allow orig length anywhere near 4G-3?
Well, of course that's a ridiculous size; I'm not sure how we would pick an appropriate smaller limit, though. And if orig length of an individual table is that large, the file as a whole will fail sanityCheck a moment later as the total size will be excessive.

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=552216#c13)• 15 years ago |
|  | |

Comment on [attachment 432363](/attachment.cgi?id=432363 "check for potential arithmetic overflow") [[details]](/attachment.cgi?id=432363&action=edit "check for potential arithmetic overflow") [[diff]](/attachment.cgi?id=432363&action=diff "check for potential arithmetic overflow") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432363)
check for potential arithmetic overflow
This patch is OK but I'd prefer a patch that just made offs, orig and comp all uint64\_t. That's a lot more robust.
[Attachment #432363](/attachment.cgi?id=432363&action=edit "check for potential arithmetic overflow") -
Flags: review?(jdaggett) → review+

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=552216#c14)• 15 years ago |
|  | |

Attached patch

[use 64-bit arithmetic to avoid risk of overflow](attachment.cgi?id=432405&action=diff)
— [Details](attachment.cgi?id=432405&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432405)

[Attachment #432405](/attachment.cgi?id=432405&action=edit "use 64-bit arithmetic to avoid risk of overflow") -
Flags: review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a51399_5038)• 15 years ago |

[Attachment #432405](/attachment.cgi?id=432405&action=edit "use 64-bit arithmetic to avoid risk of overflow") -
Flags: review?(roc) → review+

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=552216#c15)• 15 years ago |
|  | |

Pushed:
<http://hg.mozilla.org/mozilla-central/rev/aaf4b4f00941>
plus Windows bustage fix:
<http://hg.mozilla.org/mozilla-central/rev/30267b65a901>

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a53150_329583)• 15 years ago |

[Attachment #432363](/attachment.cgi?id=432363&action=edit "check for potential arithmetic overflow") -
Attachment is obsolete: true

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=552216#c16)• 15 years ago |
|  | |

Attached patch

[patch for 1.9.2 branch, includes followup windows bustage fix](attachment.cgi?id=432408&action=diff) (obsolete)
— [Details](attachment.cgi?id=432408&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432408)

[Attachment #432408](/attachment.cgi?id=432408&action=edit "patch for 1.9.2 branch, includes followup windows bustage fix") -
Flags: approval1.9.2.3?
[Attachment #432408](/attachment.cgi?id=432408&action=edit "patch for 1.9.2 branch, includes followup windows bustage fix") -
Flags: approval1.9.2.2?

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=552216#c17)• 15 years ago |
|  | |

Argh, additional bustage fix:
<http://hg.mozilla.org/mozilla-central/rev/ba99b3a279cf>

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=552216#c18)• 15 years ago |
|  | |

Attached patch

[patch for 1.9.2 branch, includes followups](attachment.cgi?id=432409&action=diff)
— [Details](attachment.cgi?id=432409&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432409)

[Attachment #432408](/attachment.cgi?id=432408&action=edit "patch for 1.9.2 branch, includes followup windows bustage fix") -
Attachment is obsolete: true
[Attachment #432409](/attachment.cgi?id=432409&action=edit "patch for 1.9.2 branch, includes followups") -
Flags: approval1.9.2.3?
[Attachment #432409](/attachment.cgi?id=432409&action=edit "patch for 1.9.2 branch, includes followups") -
Flags: approval1.9.2.2?
[Attachment #432408](/attachment.cgi?id=432408&action=edit "patch for 1.9.2 branch, includes followup windows bustage fix") -
Flags: approval1.9.2.3?
[Attachment #432408](/attachment.cgi?id=432408&action=edit "patch for 1.9.2 branch, includes followup windows bustage fix") -
Flags: approval1.9.2.2?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=552216#c19)• 15 years ago |
|  | |

Attached patch

[crashtest.diff](attachment.cgi?id=432419&action=diff)
— [Details](attachment.cgi?id=432419&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432419)

Here's a crashtest. Please land after the fix has shipped on the 1.9.2 branch.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a59496_5168)• 15 years ago |

Flags: in-testsuite?

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=552216#c20)• 15 years ago |
|  | |

Comment on [attachment 432409](/attachment.cgi?id=432409 "patch for 1.9.2 branch, includes followups") [[details]](/attachment.cgi?id=432409&action=edit "patch for 1.9.2 branch, includes followups") [[diff]](/attachment.cgi?id=432409&action=diff "patch for 1.9.2 branch, includes followups") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432409)
patch for 1.9.2 branch, includes followups
a1922=beltzner, please land on mozilla1.9.2 immediately and follow up here with changeset.
Evgeny, thanks for confirming that this is the bug.
[Attachment #432409](/attachment.cgi?id=432409&action=edit "patch for 1.9.2 branch, includes followups") -
Flags: approval1.9.2.3?
[Attachment #432409](/attachment.cgi?id=432409&action=edit "patch for 1.9.2 branch, includes followups") -
Flags: approval1.9.2.2?
[Attachment #432409](/attachment.cgi?id=432409&action=edit "patch for 1.9.2 branch, includes followups") -
Flags: approval1.9.2.2+

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=552216#c21)• 15 years ago |
|  | |

(marking blocking - also, is this now FIXED on trunk?)blocking1.9.2: ? → .2+

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=552216#c22)• 15 years ago |
|  | |

Pushed to 1.9.2
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/827a6883442f>Status: NEW → RESOLVEDClosed: 15 years ago
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_192&o1=equals&v1=wanted) → [.2-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=.2-fixed)Resolution: --- → FIXED

|  | [Robert Kaiser](/user_profile?user_id=5189) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=552216#c23)• 15 years ago |
|  | |

Does this apply to 1.9.1 branch as well? Might not be good to ship this fix on 1.9.2 while leaving 1.9.1 vulnerable, if so.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=552216#c24)• 15 years ago |
|  | |

1.9.1 is unaffected (see flags above).

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=552216#c25)• 15 years ago |
|  | |

Since this is a security fix, shouldn't the patch be super-reviewed, as per our review policy (<http://www.mozilla.org/hacking/reviewers.html>)?

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a159290_11608)• 15 years ago |

Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=552216#c26)• 15 years ago |
|  | |

I verified the problem and the fix with the attached PoC using Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.2pre) Gecko/20100315 Namoroka/3.6.2pre and Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.2pre) Gecko/20100315 Namoroka/3.6.2pre (.NET CLR 3.5.30729).Keywords: [verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a513687_159758)• 15 years ago |

Alias: CVE-2010-1028

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a587016_1689)• 15 years ago |

[Attachment #432405](/attachment.cgi?id=432405&action=edit "use 64-bit arithmetic to avoid risk of overflow") -
Flags: superreview+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=552216#c27)• 15 years ago |
|  | |

Comment on [attachment 432409](/attachment.cgi?id=432409 "patch for 1.9.2 branch, includes followups") [[details]](/attachment.cgi?id=432409&action=edit "patch for 1.9.2 branch, includes followups") [[diff]](/attachment.cgi?id=432409&action=diff "patch for 1.9.2 branch, includes followups") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432409)
patch for 1.9.2 branch, includes followups
sr=dveditz (for reed). this patch had many many eyes on it before it landed (including mine) but if a formal marker makes people happy then here it is.
[Attachment #432409](/attachment.cgi?id=432409&action=edit "patch for 1.9.2 branch, includes followups") -
Flags: superreview+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a795630_1689)• 15 years ago |

Group: core-security

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=552216#a831234_76551)• 15 years ago |

Target Milestone: --- → mozilla1.9.3a4

|  | [Daniel C](/user_profile?user_id=185959) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=552216#c30)• 15 years ago |
|  | |

(In reply to [comment #27](/show_bug.cgi?id=552216#c27 "RESOLVED FIXED - WOFF heap corruption due to integer overflow"))
> (From update of [attachment 432409](/attachment.cgi?id=432409 "patch for 1.9.2 branch, includes followups") [[details]](/attachment.cgi?id=432409&action=edit "patch for 1.9.2 branch, includes followups") [[diff]](/attachment.cgi?id=432409&action=diff "patch for 1.9.2 branch, includes followups") [[review]](/page.cgi?id=splinter.html&ignore=&bug=552216&attachment=432409))
> sr=dveditz (for reed). this patch had many many eyes on it before it landed
> (including mine) but if a formal marker makes people happy then here it is.
So many that they all failed to notice the obvious flaw below before it landed (fixed in [comment 17](/show_bug.cgi?id=552216#c17 "RESOLVED FIXED - WOFF heap corruption due to integer overflow"))?
- if (tableTotal > 0xffffffffU - orig) {
+ tableTotal += orig;
+ if (tableTotal > 0xffffffffU) {
return eWOFF\_invalid;
}
tableTotal += orig;

|  | [inikakinache](/user_profile?user_id=377499) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=552216#c31)• 15 years ago |
|  | |

It could be patched much more easy without inc of a bit's:
uint32\_t tableTotal = 0;
//...
uint32\_t orig = READ32BE(dirEntry->origLen);
//...
#define MAX(x,y) ((x)>(y)?(x):(y))
if ( tableTotal + orig < MAX(tableTotal,orig) )
{
return eWOFF\_invalid;
}
else
{
tableTotal += orig;
}

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=552216#c32)• 15 years ago |
|  | |

Any remaining issues suggested in [comment 7](/show_bug.cgi?id=552216#c7 "RESOLVED FIXED - WOFF heap corruption due to integer overflow") and 8 are now being tracked in [Bug 555139](/show_bug.cgi?id=555139 "RESOLVED WORKSFORME - non-WOFF crashes [@ nsCOMPtr_base::assign_assuming_AddRef(nsISupports*) | nsInputStreamPump::OnStateStop() ]") - ([CVE-2010-1122](https://www.cve.org/CVERecord?id=CVE-2010-1122))

|  | [Aakash Desai [:aakashd]](/user_profile?user_id=339035) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=552216#c33)• 15 years ago |
|  | |

verified FIXED on build:
Mozilla/5.0 (X11; U; Linux armv7l; Nokia N900; en-US; rv:1.9.2.1) Gecko/20100330 Namoroka/3.6.1 Fennec/1.0.1
You need to [log in](/show_bug.cgi?id=552216&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


