=== Content from metacpan.org_52057a91_20250114_195053.html ===


* [About](/about)
* [Sponsor](/about/sponsors)
* [grep::cpan](https://grep.metacpan.org/)
* [Recent](/recent)
* [FAQ](/about/faq)
* [Tools](/tools)
* [API](https://fastapi.metacpan.org/)

* + [Identities](/account/identities)
  + [Profile](/account/profile)
  + [Favorites](/account/favorite/list)
  + Logout
* + [GitHub](/login/github)
  + [Twitter](/login/twitter)
  + [Google](/login/google)

* Tools
* [Release Info](/release/KGRENNAN/Net-OAuth-0.28)
* [Module Documentation](/pod/Net%3A%3AOAuth%3A%3AClient)
* [Author](/author/KGRENNAN)
* [Raw code](https://fastapi.metacpan.org/source/KGRENNAN/Net-OAuth-0.28/lib/Net/OAuth/Client.pm)
* [Permalink](/release/KGRENNAN/Net-OAuth-0.28/source/lib/Net/OAuth/Client.pm)
* [Download](/release/KGRENNAN/Net-OAuth-0.28/raw/lib/Net/OAuth/Client.pm?download=1)
* HideShow Pod
* Info
* 181 lines of code
* 68 lines of pod
* 7.54K bytes

[KGRENNAN / Net-OAuth-0.28](/release/KGRENNAN/Net-OAuth-0.28/source)
/ [lib](/release/KGRENNAN/Net-OAuth-0.28/source/lib)
/ [Net](/release/KGRENNAN/Net-OAuth-0.28/source/lib/Net)
/ [OAuth](/release/KGRENNAN/Net-OAuth-0.28/source/lib/Net/OAuth)
/ Client.pm

```
package Net::OAuth::Client;
use warnings;
use strict;
use base qw(Class::Accessor::Fast);
__PACKAGE__->mk_accessors(qw/id secret callback is_v1a user_agent site debug session/);
use LWP::UserAgent;
use URI;
use Net::OAuth;
use Net::OAuth::Message;
use Net::OAuth::AccessToken;
use Carp;

=head1 NAME

Net::OAuth::Client - OAuth 1.0A Client

=head1 SYNOPSIS

  # Web Server Example (Dancer)

  # This example is simplified for illustrative purposes, see the complete code in /demo

  # Note that client_id is the Consumer Key and client_secret is the Consumer Secret

  use Dancer;
  use Net::OAuth::Client;

  sub client {
  	Net::OAuth::Client->new(
  		config->{client_id},
  		config->{client_secret},
  		site => 'https://www.google.com/',
  		request_token_path => '/accounts/OAuthGetRequestToken?scope=https%3A%2F%2Fwww.google.com%2Fm8%2Ffeeds%2F',
  		authorize_path => '/accounts/OAuthAuthorizeToken',
  		access_token_path => '/accounts/OAuthGetAccessToken',
  		callback => uri_for("/auth/google/callback"),
  		session => \&session,
  	);
  }

  # Send user to authorize with service provider
  get '/auth/google' => sub {
  	redirect client->authorize_url;
  };

  # User has returned with token and verifier appended to the URL.
  get '/auth/google/callback' => sub {

  	# Use the auth code to fetch the access token
  	my $access_token =  client->get_access_token(params->{oauth_token}, params->{oauth_verifier});

  	# Use the access token to fetch a protected resource
  	my $response = $access_token->get('/m8/feeds/contacts/default/full');

  	# Do something with said resource...

  	if ($response->is_success) {
  	  return "Yay, it worked: " . $response->decoded_content;
  	}
  	else {
  	  return "Error: " . $response->status_line;
  	}
  };

  dance;

=head1 DESCRIPTION

Net::OAuth::Client represents an OAuth client or consumer.

WARNING: Net::OAuth::Client is alpha code.  The rest of Net::OAuth is quite
stable but this particular module is new, and is under-documented and under-tested.

=head1 METHODS

=over

=item new($client_id, $client_secret, %params)

Create a new Client

=over

=item * $client_id

AKA Consumer Key - you get this from the service provider when you register your application.

=item * $client_secret

AKA Consumer Secret - you get this from the service provider when you register your application.

=item * $params{site}

=item * $params{request_token_path}

=item * $params{authorize_path}

=item * $params{access_token_path}

=item * $params{callback}

=item * $params{session}

=back

=back

=cut

sub new {
  my $class = shift;
  my $client_id = shift;
  my $client_secret = shift;
  my %opts = @_;
  $opts{user_agent} ||= LWP::UserAgent->new;
  $opts{id} = $client_id;
  $opts{secret} = $client_secret;
  $opts{is_v1a} = defined $opts{callback};
  my $self = bless \%opts, $class;
  return $self;
}

sub request {
  my $self = shift;
  my $response = $self->user_agent->request(@_);
}

sub _parse_oauth_response {
  my $self = shift;
  my $do_what = shift;
  my $http_res = shift;
  my $msg = "Unable to $do_what: Request for " . $http_res->request->uri . " failed";
  unless ($http_res->is_success) {
    if ($self->debug) {
      $msg .= "," . $http_res->as_string . " ";
    }
    elsif (
      $http_res->content_type eq 'application/x-www-form-urlencoded'
      and $http_res->decoded_content =~ /\boauth_problem=(\w+)/
      ) {
      $msg .= ", reason: " . $1;
    }
    else {
      $msg .= ": " . $http_res->status_line . " (pass debug=>1 to Net::OAuth::Client->new to dump the entire response)";
    }
    croak $msg;
  }
  my $oauth_res = _parse_url_encoding($http_res->decoded_content);
  foreach my $k (qw/token token_secret/) {
    croak "Unable to $do_what: server response is missing '$k'" unless defined $oauth_res->{$k};
  }
  return $oauth_res;

}

sub _parse_url_encoding {
  my $str = shift;
  my @pairs = split '&', $str;
  my %params;
	foreach my $pair (@pairs) {
        my ($k,$v) = split /=/, $pair;
        if (defined $k and defined $v) {
            $v =~ s/(^"|"$)//g;
            ($k,$v) = map Net::OAuth::Message::decode($_), $k, $v;
            $k =~ s/^oauth_//;
            $params{$k} = $v;
        }
    }
	return \%params;
}

sub get_request_token {
  my $self = shift;
  my %params = @_;
  my $oauth_req = $self->_make_request(
    "request token",
    request_method => $self->request_token_method,
    request_url => $self->_make_url("request_token"),
    %params
  );
  $oauth_req->sign;
  my $http_res = $self->request(HTTP::Request->new(
    $self->request_token_method => $oauth_req->to_url
  ));
  my $oauth_res = $self->_parse_oauth_response('get a request token', $http_res);
  $self->is_v1a(0) unless defined $oauth_res->{callback_confirmed};
  return $oauth_res;
}

sub authorize_url {
  my $self = shift;
  my %params = @_;
  # allow user to get request token their own way
  unless (defined $params{token} and defined $params{token_secret}) {
    my $request_token = $self->get_request_token;
    $params{token} = $request_token->{token};
    $params{token_secret} = $request_token->{token_secret};
  }
  if (defined $self->session) {
    $self->session->($params{token} => $params{token_secret});
  }
  my $oauth_req = $self->_make_request(
    'user auth',
    %params
  );
  return $oauth_req->to_url($self->_make_url('authorize'));
}

sub get_access_token {
  my $self = shift;
  my $token = shift;
  my $verifier = shift;
  my %params = @_;

  if (defined $self->session) {
    $params{token_secret} = $self->session->($token);
  }

  my $oauth_req = $self->_make_request(
    'access token',
    request_method => $self->access_token_method,
    request_url => $self->_make_url('access_token'),
    token => $token,
    verifier => $verifier,
    %params
  );
  $oauth_req->sign;

  my $http_res = $self->request(HTTP::Request->new(
    $self->access_token_method => $oauth_req->to_url
  ));

  my $oauth_res = $self->_parse_oauth_response('get an access token', $http_res);

  return Net::OAuth::AccessToken->new(%$oauth_res, client => $self);
}

sub access_token_url {
  return shift->_make_url('access_token', @_);
}

sub request_token_url {
  return shift->_make_url('request_token', @_);
}

sub access_token_method {
  return shift->{access_token_method} || 'GET';
}

sub request_token_method {
  return shift->{request_token_method} || 'GET';
}

sub _make_request {
  my $self = shift;
  my $type = shift;
  my %params = @_;
  my %defaults = (
    nonce => int( rand( 2**32 ) ),
    timestamp => time,
    consumer_key => $self->id,
    consumer_secret => $self->secret,
    callback => $self->callback,
    signature_method => 'HMAC-SHA1',
    request_method => 'GET',
  );
  $defaults{protocol_version} = Net::OAuth::PROTOCOL_VERSION_1_0A if $self->is_v1a;
  my $req = Net::OAuth->request($type)->new(
    %defaults,
    %params
  );
  return $req;
}

sub _make_url {
  my $self = shift;
  my $thing = shift;
  my $path = $self->{"${thing}_url"} || $self->{"${thing}_path"} || "/oauth/${thing}";
  return $self->site_url($path, @_);
}

sub site_url {
  my $self = shift;
  my $path = shift;
  my %params = @_;
  my $url;
  if (defined $self->{site}) {
    $url = URI->new_abs($path, $self->{site});
  }
  else {
    $url = URI->new($path);
  }
  if (@_) {
    $url->query_form($url->query_form , %params);
  }
  return $url;
}

=head1 LICENSE AND COPYRIGHT

Copyright 2011 Keith Grennan.

This program is free software; you can redistribute it and/or modify it
under the terms of either: the GNU General Public License as published
by the Free Software Foundation; or the Artistic License.

See http://dev.perl.org/licenses/ for more information.

=cut

1;

1;

```

[![MetaCPAN](/static/images/metacpan-logo.svg)](/)

[About](/about)

[Sponsor](/about/sponsors)

[grep::cpan](https://grep.metacpan.org)

[Recent](/recent)

[FAQ](/about/faq)

[Tools](/tools)

[API](https://fastapi.metacpan.org/)

[Perl.org](https://www.perl.org/)

[![Bytemark logo](/static/images/sponsors/bytemark_logo.svg)](https://www.bytemark.co.uk/)
[![liquidweb logo](/static/images/sponsors/liquidweb_logo.png)](https://www.liquidweb.com/)
[![Deriv logo](/static/images/sponsors/deriv.svg)](https://deriv.com/careers/)
[![Geocode logo](/static/images/sponsors/geocodelogo.svg)](https://geocode.xyz)
[![Fastly logo](/static/images/sponsors/fastly_logo.svg)](https://www.fastly.com/)
[![OpenCage logo](/static/images/sponsors/open-cage.svg)](https://opencagedata.com)

[![Elastic logo](/static/images/sponsors/elastic.svg)](https://www.elastic.co/)

[![Route4Me logo](/static/images/sponsors/route4me.png)](https://route4me.com/)

×
#### Keyboard Shortcuts

|  | Global |
| --- | --- |
| `s` | Focus search bar |
| `?` | Bring up this help dialog |

|  | GitHub |
| --- | --- |
| `g` `p` | Go to pull requests |
| `g` `i` | go to github issues (only if github is preferred repository) |

|  | POD |
| --- | --- |
| `g` `a` | Go to author |
| `g` `c` | Go to changes |
| `g` `i` | Go to issues |
| `g` `d` | Go to dist |
| `g` `r` | Go to repository/SCM |
| `g` `s` | Go to source |
| `g` `b` | Go to file browse |

|  | Search terms |
| --- | --- |
| *module:* (e.g. [module:Plugin](/search?q=module%3APlugin)) |
| *distribution:* (e.g. [distribution:Dancer auth](/search?q=distribution%3ADancer+auth)) |
| *author:* (e.g. [author:SONGMU Redis](/search?q=author%3ASONGMU+Redis)) |
| *version:* (e.g. [version:1.00](/search?q=version%3A1.00)) |



=== Content from metacpan.org_8e28e589_20250114_195053.html ===


* [About](/about)
* [Sponsor](/about/sponsors)
* [grep::cpan](https://grep.metacpan.org/)
* [Recent](/recent)
* [FAQ](/about/faq)
* [Tools](/tools)
* [API](https://fastapi.metacpan.org/)

* + [Identities](/account/identities)
  + [Profile](/account/profile)
  + [Favorites](/account/favorite/list)
  + Logout
* + [GitHub](/login/github)
  + [Twitter](/login/twitter)
  + [Google](/login/google)

* Tools
* [Release Info](/release/RRWO/Net-OAuth-0.29)
* [Author](/author/RRWO)
* [Raw code](https://fastapi.metacpan.org/source/RRWO/Net-OAuth-0.29/Changes)
* [Permalink](/release/RRWO/Net-OAuth-0.29/source/Changes)
* [Download](/release/RRWO/Net-OAuth-0.29/raw/Changes?download=1)
* HideShow Pod
* Info
* 110 lines of code
* 0 lines of pod
* 5.92K bytes

[RRWO / Net-OAuth-0.29](/release/RRWO/Net-OAuth-0.29/source)
/ Changes

```
Revision history for Net-OAuth

0.29   Fri, 03 Jan 2025 09:15 GMT
       [Security]
       - Net::OAuth::Client uses a better source of randomness for generating the nonce

       [Bug Fixes]
       - Removed unnecessary prerequisite RT#69810 GH#4 GH#6
       - Fix broken dependency for URI::Escape GH#4 (thanks oiami)
       - Fix handling of uri_escape_utf RT#73705 (thanks Tomaž Šolc)

       [Documentation]
       - Reorganised Changes to almost follow CPAN::Changes::Spec
       - Updated author and maintainer information
       - Changed to consistent copyright information
       - Fixed typo RT#125292 RT#90007 GH#6 (thanks Gregor Herrmann)
       - Added a Security Policy (SECURITY.md) to the distribution

       [Tests]
       - Fixed randomly failing t/02-rsa.t test RT#125291 RT#125482 (thanks Gregor Herrmann)

       [Other]
       - Maintenance taken over by Robert Rothenberg <rrwo@cpan.org>
       - Added .mailmap to the repo
       - Distribution metadata now has the git repository (thanks Sergey Romanov) GH#6
       - Set up config_requires in Build.PL
       - Updated Build.PL configuration
       - Updated MANIFEST.SKIP rules

0.28   Fri, 06 Jan 2012 05:51:04 UTC
       - Added HMAC-SHA256 support

0.27   Wed, 16 Jun 2010 20:39:59 UTC
       - Added class for Yahoo! access token refresh request (thanks Marc Mims)

0.26   Wed, 16 Jun 2010 19:59:04 UTC
       - Message::encode no longer tries fix potential 'double-encoding' (in any case it appeared to be doing it wrong).
         Now it just complains if you try to pass in undecoded strings. (thanks Daisuke Maki and KATOU Akira)

0.25   Sun, 21 Mar 2010 03:50:40 UTC
       - Gah, $VERSION lameness

0.24   Sun, 21 Mar 2010 03:39:40 UTC
       - Fix test breakage in 0.23

0.23   Thu, 18 Mar 2010 17:23:36 UTC
       - Removed UNIVERSAL::require dependency
       - Net::OAuth->request constructor now dies if module fails to load (thanks Mike Schleif)
       - Fixed RT#55635 Incorrect dependencies (thanks Jens Rehsack)
       - Replaced die() with croak()

0.22   Thu, 11 Mar 2010 00:21:26 UTC
       - Renamed xAuthAccessTokenRequest to XauthAccessTokenRequest for CamelCaseConsistency
       - Added a couple tests for XauthAccessTokenRequest

0.21   Wed, 10 Mar 2010 22:20:49 UTC
       - Added xAuth support with xAuthAccessTokenRequest (thanks Masayoshi Sekimura and Simon Wistow)
       - Added performance patch to decrease stat() system calls when requiring modules (thanks Brad Whitaker)

0.20   Fri, 13 Nov 2009 18:56:55 UTC
       - Fixed RT#48867 - error in synopsis - thanks Adam Taylor!
       - Removed UTF8 double-encoding warning.  Now Net::OAuth::Message::encode() uses Encode::is_utf8() to determine if
         the input is already UTF-8 encoded.  If so, it runs decode_utf8() on it before sending it to uri_escape_utf8().
         Thanks Hector Garcia Alvarez!
       - Potentially fixed an issue found by Marc Mims, where HMAC_SHA1 was failing to load, breaking some CPAN tests.
         Build.PL now explicitly requires Digest::SHA1 and Encode.  Hopefully that fixes it.

0.19   Fri, 26 Jun 2009 17:30:06 UTC
       [Bug Fixes]
       - Fixed RT#47369 - Don't automatically set oauth_version parameter when message is created via from_hash (or
         from_url, from_post_body, etc).  Thanks COSIMO!

0.18   Thu, 25 Jun 2009 17:18:04 UTC
       [Bug Fixes]
       - Fixed accidental (though probably harmless) regression in 0.17

0.17   Thu, 25 Jun 2009 16:59:50 UTC
       [Bug Fixes]
       - Fixed RT#47293 - Message->from_hash was validating using the incorrect class, causing a 'Parameter X not valid
         for a message of type Y' message on V1.0a messages.  Thanks Jeff Dairiki!

0.16    Mon, 15 Jun 2009 18:36:17 UTC
        [Enhancements]
        - Added support for OAuth 1.0A - see POD section 'OAUTH 1.0A' for details - Net::OAuth still defaults to 1.0 for
          now

0.15    Fri, 05 Jun 2009 00:48:07 UTC
	- Added Twitter demo consumer
	- Warn if message parameter is already UTF-8 that it will be double-encoded; see I18N section of Net::OAuth manpage
	- Better handling of missing 'realm' parameter in Authorization header methods
	- Better handling of request_url parameter; see REQUEST_URL PARAMETER section of Net::OAuth manpage
	- Fixed RT#44699 - encode spaces to %20 rather than + in $message->to_url()

0.14    Sat, 13 Dec 2008 17:29:36 UTC
	- Add POD for consumer requests

0.13    Thu, 13 Nov 2008 22:45:46 UTC
	- Added support for Consumer Request (token-less / two-legged) message type

0.12    Fri, 04 Jul 2008 22:58:23 UTC
	- Added support for extensions - Net::OpenMicroBlogging in particular

0.11    Wed, 04 Jun 2008 16:50:14 UTC
	- Doc edits

0.1     Wed, 04 Jun 2008 16:27:50 UTC
        - Added demo, fixed docs

0.09    Tue, 03 Jun 2008 03:46:32 UTC
	- Fixed another annoying test failure

0.08   	Mon, 02 Jun 2008 17:41:52 UTC
  	- Fixed test failures found in 0.07.
        - More docs.
        - Added more deserialization methods.
        - Changed factory invocation from message('foo') to message('foo')->new(), to allow
          deserialization methods to be used instead of new().

0.07    Sun, 01 Jun 2008 16:04:26 UTC
        - Added a factory class, Net::OAuth
        - Added several 'Response' classes
        - Added UserAuthRequest and UserAuthResponse
        - Created a Message base class from which Request and Response inherit
        - Added some introductory documentation
        - Added more tests

0.06    Sat, 08 Mar 2008 00:57:40 UTC
        - Removed live test that stopped working

0.05    Mon, 19 Nov 2007 03:30:05 UTC
        - Integrated patch from Nobuo Danjou, for Draft 6 spec compliance

0.04    Fri, 19 Oct 2007 16:45:03 UTC
        - Integrated patch from SARTAK, fixing signature for RequestTokenRequest with HMAC-SHA1

0.03    Mon, 15 Oct 2007 01:35:17 UTC
        - Fixed header parsing

0.02    Tue, 02 Oct 2007 07:35:17 UTC
        - Added RSA-SHA1 support

0.01    Sun, 30 Sep 2007 13:35:06 UTC
        - First version, released on an unsuspecting world.

```

[![MetaCPAN](/static/images/metacpan-logo.svg)](/)

[About](/about)

[Sponsor](/about/sponsors)

[grep::cpan](https://grep.metacpan.org)

[Recent](/recent)

[FAQ](/about/faq)

[Tools](/tools)

[API](https://fastapi.metacpan.org/)

[Perl.org](https://www.perl.org/)

[![Bytemark logo](/static/images/sponsors/bytemark_logo.svg)](https://www.bytemark.co.uk/)
[![liquidweb logo](/static/images/sponsors/liquidweb_logo.png)](https://www.liquidweb.com/)
[![Deriv logo](/static/images/sponsors/deriv.svg)](https://deriv.com/careers/)
[![Geocode logo](/static/images/sponsors/geocodelogo.svg)](https://geocode.xyz)
[![Fastly logo](/static/images/sponsors/fastly_logo.svg)](https://www.fastly.com/)
[![OpenCage logo](/static/images/sponsors/open-cage.svg)](https://opencagedata.com)

[![Elastic logo](/static/images/sponsors/elastic.svg)](https://www.elastic.co/)

[![Route4Me logo](/static/images/sponsors/route4me.png)](https://route4me.com/)

×
#### Keyboard Shortcuts

|  | Global |
| --- | --- |
| `s` | Focus search bar |
| `?` | Bring up this help dialog |

|  | GitHub |
| --- | --- |
| `g` `p` | Go to pull requests |
| `g` `i` | go to github issues (only if github is preferred repository) |

|  | POD |
| --- | --- |
| `g` `a` | Go to author |
| `g` `c` | Go to changes |
| `g` `i` | Go to issues |
| `g` `d` | Go to dist |
| `g` `r` | Go to repository/SCM |
| `g` `s` | Go to source |
| `g` `b` | Go to file browse |

|  | Search terms |
| --- | --- |
| *module:* (e.g. [module:Plugin](/search?q=module%3APlugin)) |
| *distribution:* (e.g. [distribution:Dancer auth](/search?q=distribution%3ADancer+auth)) |
| *author:* (e.g. [author:SONGMU Redis](/search?q=author%3ASONGMU+Redis)) |
| *version:* (e.g. [version:1.00](/search?q=version%3A1.00)) |


