=== Content from rhn.redhat.com_c2b1586d_20250125_074925.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2016:0155 - Security Advisory

Issued:
2016-02-09
Updated:
2016-02-09
# RHSA-2016:0155 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: openstack-swift security update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2016%3A0155)

## Topic

Updated openstack-swift packages that fix two security issues are now
available for Red Hat Enterprise Linux OpenStack Platform 7.0.

Red Hat Product Security has rated this update as having Moderate
security impact. A Common Vulnerability Scoring System (CVSS) base
score, which gives a detailed severity rating, is available from the
CVE link in the References section.

## Description

OpenStack Object Storage (swift) provides object storage in virtual
containers, which allows users to store and retrieve files (arbitrary
data). The service's distributed architecture supports horizontal scaling;
redundancy as failure-proofing is provided through software-based data
replication. Because Object Storage supports asynchronous eventual
consistency replication, it is well suited to multiple data-center
deployment.

A memory-leak issue was found in OpenStack Object Storage (swift), in the
proxy-to-server connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0738)

A memory-leak issue was found in OpenStack Object Storage (swift), in the
client-to-proxy connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0737)

Red Hat would like to thank the OpenStack project for reporting these
issues. Upstream acknowledges Romain Le Disez from OVH and Örjan Persson
from Kiliaro as the original reporters.

All users of openstack-swift are advised to upgrade to these updated
packages, which correct these issues. After installing this update, the
OpenStack Object Storage services will be restarted automatically.

## Solution

Before applying this update, ensure all previously released errata
relevant to your system have been applied.

For details on how to apply this update, refer to:

<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat OpenStack 7 x86\_64

## Fixes

* [BZ - 1298905](https://bugzilla.redhat.com/show_bug.cgi?id=1298905)
  - CVE-2016-0738 openstack-swift: Proxy to server DoS through Large Objects
* [BZ - 1298924](https://bugzilla.redhat.com/show_bug.cgi?id=1298924)
  - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects

## CVEs

* [CVE-2016-0737](https://www.redhat.com/security/data/cve/CVE-2016-0737.html)
* [CVE-2016-0738](https://www.redhat.com/security/data/cve/CVE-2016-0738.html)

## References

* <http://www.redhat.com/security/updates/classification/#normal>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat OpenStack 7

| SRPM | |
| --- | --- |
| openstack-swift-2.3.0-3.el7ost.src.rpm | SHA-256: cf145d99d1e6281c1d1b1c44bcfe47c2c4df14e9c4c5270b572efaec1dcabd68 |
| x86\_64 | |
| openstack-swift-2.3.0-3.el7ost.noarch.rpm | SHA-256: 91a0ffa995c5ce73b19c97342bcc0d1e285c05caae74cca796e83a211110044e |
| openstack-swift-account-2.3.0-3.el7ost.noarch.rpm | SHA-256: db7e0e6cfc45206006425b9fbc810bc3ec465da269b78bea3815168885a5b1f9 |
| openstack-swift-container-2.3.0-3.el7ost.noarch.rpm | SHA-256: 92d863aa237f9e765cc796d77f364ad71bc6dd2b4016e8ebe0ce6aed56019659 |
| openstack-swift-doc-2.3.0-3.el7ost.noarch.rpm | SHA-256: f9ab915bdbeeec1f30984ad109c4d47af6ff3e1ae55facb9f1b4a7be8d864410 |
| openstack-swift-object-2.3.0-3.el7ost.noarch.rpm | SHA-256: da4c6000edcd0837dbbacba9d20811b36ffbfc4255484ad6c84e5512d4b6b2db |
| openstack-swift-proxy-2.3.0-3.el7ost.noarch.rpm | SHA-256: e294a98787d174535b64df77efd47a6973218d7eebd6de325ebae0f693426bc8 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugs.launchpad.net_e7cbd54a_20250126_072240.html ===

[Log in / Register](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Blogin)

[![](https://launchpadlibrarian.net/52141984/os64.png)](https://launchpad.net/swift)

## [OpenStack Object Storage (swift)](https://launchpad.net/swift)

* [Overview](https://launchpad.net/swift)
* [Code](https://code.launchpad.net/swift)
* [Bugs](https://bugs.launchpad.net/swift)
* [Blueprints](https://blueprints.launchpad.net/swift)
* [Translations](https://translations.launchpad.net/swift)
* [Answers](https://answers.launchpad.net/swift)

# [OSSA 2016-004] Download DLO objects leak connections when client kill connection (CVE-2016-0737)

Bug #1466549 reported by
[Romain LE DISEZ](https://launchpad.net/~rledisez)
on 2015-06-18

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Object Storage (swift)](https://bugs.launchpad.net/swift) | Fix Released | Undecided | Unassigned | [OpenStack Object Storage (swift) 2.4.0](https://launchpad.net/swift/%2Bmilestone/2.4.0) |
| Nominated for Juno by [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | | | | | |
| Nominated for Kilo by [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | | | | | |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |

### Bug Description

When a client is downloading a DLO object, if it interrupts its connection, the proxy does not close the connection to the object server

From my test, this bug impacts versions 1.10, 2.2.2 and master.

I flag this bug security vulnerability because it makes it easy to do a DoS on a proxy-server. It's actually what's happening to us because one of our user do VoD. It uses DLO a lot and close connections when his customers stop watching video.

How to reproduce on a fresh SAIO, with processes just started:

1. Upload an object in DLO

    $ dd if=/dev/zero of=2x1G bs=1M count=2048

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing post test

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing upload test -S 1073741824 2x1G

2. In an other terminal, watch connections between proxy-server and object-server:

   $ watch -n 1 "netstat -tapn | grep -E ':60[1-4]0' | grep ESTA"

(For now, you should see no connections)

3. Start to download the object, but stop it before the end (eg: CTRL+C)

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing download test 2x1G --no-download

(Now, you should see one connection)

4. Repeat step 3 and observe the connections stacking

Tags:

[in-feature-crypto](/swift/%2Bbugs?field.tag=in-feature-crypto)
[in-feature-hummingbird](/swift/%2Bbugs?field.tag=in-feature-hummingbird)
[in-stable-kilo](/swift/%2Bbugs?field.tag=in-stable-kilo)

## CVE References

* [2016-0737](/bugs/cve/2016-0737 "OpenStack Object Storage (Swift) befo...")
* [2016-0738](/bugs/cve/2016-0738 "OpenStack Object Storage (Swift) befo...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-18: |  |  | [#1](/swift/%2Bbug/1466549/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-06-18: |  |  | [#2](/swift/%2Bbug/1466549/comments/2) |
| --- | --- | --- | --- |

Based on <https://www.python.org/dev/peps/pep-0333/#specification-details>

"If the iterable returned by the application has a close() method, the server or gateway must call that method upon completion of the current request, whether the request was completed normally, or terminated early due to an error. (This is to support resource release by the application. This protocol is intended to complement PEP 325 's generator support, and other common iterables with close() methods."

here is a fix proposal : <https://review.openstack.org/#/c/193192/>

It passes all tests, but I'm not very familiar with wsgi. So i don't know all the implications of adding a close() method.

Based on https://www.python.org/dev/peps/pep-0333/#specification-details
"If the iterable returned by the application has a close() method, the server or gateway must call that method upon completion of the current request, whether the request was completed normally, or terminated early due to an error. (This is to support resource release by the application. This protocol is intended to complement PEP 325 's generator support, and other common iterables with close() methods."
here is a fix proposal : https://review.openstack.org/#/c/193192/
It passes all tests, but I'm not very familiar with wsgi. So i don't know all the implications of adding a close() method.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-06-18: |  |  | [#3](/swift/%2Bbug/1466549/comments/3) |
| --- | --- | --- | --- |

Eventually the object server will time out the connection, right? I mean, immediately after killing the client -> proxy connection, you'll see what appears to be a leaked connection from proxy -> obj, but if you wait a few minutes, the object server will time out and close the connection from its end.

Eventually the object server will time out the connection, right? I mean, immediately after killing the client -> proxy connection, you'll see what appears to be a leaked connection from proxy -> obj, but if you wait a few minutes, the object server will time out and close the connection from its end.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-06-18: |  |  | [#4](/swift/%2Bbug/1466549/comments/4) |
| --- | --- | --- | --- |

It might need more testing, but i didn't observe any connection timeout-ing.

On production, we see that leaked connections continue increasing for many hours, until the proxy cannot treat connections anymore. On my SAIO, after more than 20 minutes, connections were still not closed.

It might need more testing, but i didn't observe any connection timeout-ing.
On production, we see that leaked connections continue increasing for many hours, until the proxy cannot treat connections anymore. On my SAIO, after more than 20 minutes, connections were still not closed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-06-18: |  |  | [#5](/swift/%2Bbug/1466549/comments/5) |
| --- | --- | --- | --- |

This bug report should probably be marked as public since there's a patch in Gerrit referencing it.

For reference, when filing a security bug, attach patches to the LP bug, not in Gerrit. This is probably the only case where attaching patches to LP bugs is better than filing in Gerrit.

This bug report should probably be marked as public since there's a patch in Gerrit referencing it.
For reference, when filing a security bug, attach patches to the LP bug, not in Gerrit. This is probably the only case where attaching patches to LP bugs is better than filing in Gerrit.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-19: |  |  | [#6](/swift/%2Bbug/1466549/comments/6) |
| --- | --- | --- | --- |

Opening this bug now, does it affect stable releases ?

Opening this bug now, does it affect stable releases ?

| **information type**: | Private Security → Public Security |
| --- | --- |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-06-23

| Changed in swift: | |
| --- | --- |
| **status**: | New → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-07-06: |  |  | [#7](/swift/%2Bbug/1466549/comments/7) |
| --- | --- | --- | --- |

For the record, the patch which was eventually merged to address this (I think) seems to be <https://review.openstack.org/193303> . Does that mean that the issue described here is confirmed to be reproducible under most deployments?

For the record, the patch which was eventually merged to address this (I think) seems to be https://review.openstack.org/193303 . Does that mean that the issue described here is confirmed to be reproducible under most deployments?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-13:  [**Fix proposed to swift (master)**](/swift/%2Bbug/1466549/comments/8) |  |  | [#8](/swift/%2Bbug/1466549/comments/8) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: <https://review.openstack.org/201269>

Fix proposed to branch: master
Review: https://review.openstack.org/201269

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-13:  [**Change abandoned on swift (master)**](/swift/%2Bbug/1466549/comments/9) |  |  | [#9](/swift/%2Bbug/1466549/comments/9) |
| --- | --- | --- | --- |

Change abandoned by paul luse (<email address hidden>) on branch: master

Review: <https://review.openstack.org/201269>

Reason: going to redo this w/o the dependencies

Change abandoned by paul luse (paul.e.luse@intel.com) on branch: master
Review: https://review.openstack.org/201269
Reason: going to redo this w/o the dependencies

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Fix proposed to swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/10) |  |  | [#10](/swift/%2Bbug/1466549/comments/10) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/202227>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/202227

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Change abandoned on swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/11) |  |  | [#11](/swift/%2Bbug/1466549/comments/11) |
| --- | --- | --- | --- |

Change abandoned by Michael Barton (<email address hidden>) on branch: feature/hummingbird

Review: <https://review.openstack.org/202227>

Reason: Apparently I did this wrong.

Change abandoned by Michael Barton (mike@weirdlooking.com) on branch: feature/hummingbird
Review: https://review.openstack.org/202227
Reason: Apparently I did this wrong.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Fix proposed to swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/12) |  |  | [#12](/swift/%2Bbug/1466549/comments/12) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/202230>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/202230

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Fix merged to swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/13) |  |  | [#13](/swift/%2Bbug/1466549/comments/13) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/swift/%2Bbug/1466549/comments/13/%2Bdownload) (72.8 KiB)

Reviewed: <https://review.openstack.org/202230>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=f7cb1777e1b514b3345b9e516ed8f89ad1a4ae87>

Submitter: Jenkins

Branch: feature/hummingbird

commit 51f806d3e3d3a1fcbc80d2f7d7ddbe5cc4c024c9

Author: John Dickinson <email address hidden>

Date: Tue Jul 14 20:49:08 2015 -0700

remove Python 2.6 from the classifier

Change-Id: I67233e9c7b69826242546bd6bd98c24b81070579

commit 278adf5c20101a191979ce1e4d6277e5f209149e

Author: Hisashi Osanai <email address hidden>

Date: Tue Jul 14 15:33:45 2015 +0900

Make logic of unit tests responsive to the method names

The two methods, test\_authorize\_succeeds\_for\_tenant\_name\_in\_roles and

    test\_authorize\_succeeds\_for\_tenant\_id\_in\_roles, have names that don't

    match what they are testing. tenant\_name and tenant\_id need to be

    switched.

Change-Id: I7cb0a7d2b2111127fd5d6b55f2da6a3eadf2235d

commit 1cc3eff958fdd4fb07c2b74c52df7829d3125466

Author: Victor Stinner <email address hidden>

Date: Fri Jul 10 13:04:44 2015 +0200

Fixes for mock 1.1

The new release of mock 1.1 is more strict. It helped to find bugs in

    tests.

Closes-Bug: #1473369

    Change-Id: Id179513c6010d827cbcbdda7692a920e29213bcb

commit ff192cfe5705324497a389aa2f22227d75dc0f8e

Author: janonymous <email address hidden>

Date: Wed Jul 8 18:38:22 2015 +0530

Replace reduce and unichr , these are no longer available in py3

\* Replace reduce() with six.moves.reduce()

    \* Replace unichr with six.unichr

Change-Id: I2038e47e0a6522dd992fd2a4aeff981cf7750fe0

commit 4beceab4f4be99f14025815cf7ed4510ea77f460

Author: OpenStack Proposal Bot <email address hidden>

Date: Thu Jul 9 06:14:56 2015 +0000

Imported Translations from Transifex

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I9ff1dde06be45fc7d6c441a1e1c07221f839a9a1

commit 56ee39a7e13417203c5e1816d7a3184a07f85826

Author: Matthew Oliver <email address hidden>

Date: Thu Jul 9 15:19:32 2015 +1000

Ring builder code clean up follow up patch

This is a simple change that cleans up a NIT from Sam's 'stop moving

    partitions unnecessarily when overload is on' patch.

Change-Id: I9d9f1cc23e2bb625d8e158f4d3f64e10973176a1

commit 6cafd0a4c0bb8f311fc59df580b42e801214effd

Author: Oshrit Feder <email address hidden>

Date: Wed Jul 8 15:18:22 2015 +0300

Fix Container Sync example

Container-sync realm uses cluster\_ as a prefix to specify clusters'

    names. At use, the prefix should not be included. Fixing the examples

    and sample conf to make it clearer that only the name of the cluster

    should be passed.

Change-Id: I2e521d86faffb59e1b45d3f039987ee023c5e939

commit 125238612f58481316db68d7087252bb7729f447

Author: Janie Richling <email address hidden>

Date: Sat Jul 4 17:08:32 2015 -0500

Add CORS unit tests to base

In earlier versions of swift when a request was made with an

    existing origin, but without any CORS settings in the container,

    it was possible to get an u...

Reviewed: https://review.openstack.org/202230
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=f7cb1777e1b514b3345b9e516ed8f89ad1a4ae87
Submitter: Jenkins
Branch: feature/hummingbird
commit 51f806d3e3d3a1fcbc80d2f7d7ddbe5cc4c024c9
Author: John Dickinson <me@not.mn>
Date: Tue Jul 14 20:49:08 2015 -0700
remove Python 2.6 from the classifier
Change-Id: I67233e9c7b69826242546bd6bd98c24b81070579
commit 278adf5c20101a191979ce1e4d6277e5f209149e
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jul 14 15:33:45 2015 +0900
Make logic of unit tests responsive to the method names
The two methods, test\_authorize\_succeeds\_for\_tenant\_name\_in\_roles and
test\_authorize\_succeeds\_for\_tenant\_id\_in\_roles, have names that don't
match what they are testing. tenant\_name and tenant\_id need to be
switched.
Change-Id: I7cb0a7d2b2111127fd5d6b55f2da6a3eadf2235d
commit 1cc3eff958fdd4fb07c2b74c52df7829d3125466
Author: Victor Stinner <vstinner@redhat.com>
Date: Fri Jul 10 13:04:44 2015 +0200
Fixes for mock 1.1
The new release of mock 1.1 is more strict. It helped to find bugs in
tests.
Closes-Bug: #1473369
Change-Id: Id179513c6010d827cbcbdda7692a920e29213bcb
commit ff192cfe5705324497a389aa2f22227d75dc0f8e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jul 8 18:38:22 2015 +0530
Replace reduce and unichr , these are no longer available in py3
\* Replace reduce() with six.moves.reduce()
\* Replace unichr with six.unichr
Change-Id: I2038e47e0a6522dd992fd2a4aeff981cf7750fe0
commit 4beceab4f4be99f14025815cf7ed4510ea77f460
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 9 06:14:56 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9ff1dde06be45fc7d6c441a1e1c07221f839a9a1
commit 56ee39a7e13417203c5e1816d7a3184a07f85826
Author: Matthew Oliver <matt@oliver.net.au>
Date: Thu Jul 9 15:19:32 2015 +1000
Ring builder code clean up follow up patch
This is a simple change that cleans up a NIT from Sam's 'stop moving
partitions unnecessarily when overload is on' patch.
Change-Id: I9d9f1cc23e2bb625d8e158f4d3f64e10973176a1
commit 6cafd0a4c0bb8f311fc59df580b42e801214effd
Author: Oshrit Feder <oshritf@il.ibm.com>
Date: Wed Jul 8 15:18:22 2015 +0300
Fix Container Sync example
Container-sync realm uses cluster\_ as a prefix to specify clusters'
names. At use, the prefix should not be included. Fixing the examples
and sample conf to make it clearer that only the name of the cluster
should be passed.
Change-Id: I2e521d86faffb59e1b45d3f039987ee023c5e939
commit 125238612f58481316db68d7087252bb7729f447
Author: Janie Richling <jrichli@us.ibm.com>
Date: Sat Jul 4 17:08:32 2015 -0500
Add CORS unit tests to base
In earlier versions of swift when a request was made with an
existing origin, but without any CORS settings in the container,
it was possible to get an unhandled exception due to a method call
on the "None" return of cors.get('allow\_origin', '').
Unit tests have been added to assert that this problem cannot go
undetected again.
Change-Id: Ia74896dabe1cf5a307c551b15a43ab1fd789c213
Fixes: bug 1468782
commit e87a74695e2f55dbb0e01721de9d46e230e36008
Author: John Dickinson <me@not.mn>
Date: Sat Jun 6 13:03:15 2015 -0700
add domain\_remap to /info
Also added the value of default\_reseller\_prefix to /info. I did not
add the reseller\_prefixes value to /info because deployers may not
want to expose all of the resellers that are available.
Change-Id: I9ca2f002dc395913bb646390d6908dfb8f554df1
commit 12473104f005b76ebe4b6dbe118a5ac37518eb52
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 7 18:02:53 2015 -0700
Cleanup error messages in ECDiskFileWriter.commit
I think the error messages make better sense and it's more obvious what the
error handling code was trying to bring to the surface for operators.
If you run this test with nosetests --verbose --nocapture
test\_diskfile.py:TestECDiskFile.test\_commit\_fsync\_dir\_raises\_DiskFileErrors
... you can review most of the potential log output
Change-Id: I40c9d77f44e087ee61d9642e924b0a4039d6ca9a
commit bd3717df65f57da9e7f06292ba349442d17fc939
Author: John Dickinson <me@not.mn>
Date: Thu Jul 2 09:54:30 2015 -0700
update AUTHORS file
Change-Id: I509ceeb522bd83c407beb40c22c2924a1d92b8ff
commit cd20961abd20f01a14554c14d4f61a7f0d8deb88
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Jul 5 10:59:50 2015 +0530
Replace dict.iteritems() with dict.items() in bin directory of swift.
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3.
Change-Id: I4bdc064c90bab56cd60f2dca2a5a78426ffbb31c
commit 8eca02d3a1db1e0ed68b15ed41bc62e6c89870c7
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:45:58 2015 +0530
Replace xrange() with six.moves.range()
xrange is no longer available in py3.
replacing xrange with range from six.moves
Change-Id: Ib863c316a0724bd9c4f53c2e5a8d1bcd42c4dc5a
commit 10f367224d5f30c3398169ffe3087f225f3343fc
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:05:36 2015 +0530
Fix Python 3 issues
\* Replace long with six.integer\_type
six.integer\_type :In Python 2, this is long and int, and in Python 3,
just int.
'long' is an undefined variable in py3.
Change-Id: Ibe4c5d0d81fe883f4fe33be93a68d814a228ad28
commit 2328983b7535d24d08942e62095b4346f2626566
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jun 24 17:07:32 2015 -0700
Stop moving partitions unnecessarily when overload is on.
When overload was on and in use, the ring builder was unnecessarily
moving partitions. It would converge on a good solution and settle
down eventually, but it moved more partitions than necessary along the
way.
There are three partition gatherers used in the ring builder:
dev-removed, dispersion, and weight, in that order. The dev-removed
gatherer will pick up all partitions on removed devices. The
dispersion gatherer picks up replicas of partitions that are
suboptimally dispersed. The weight gatherer picks up partitions on
devices which are overweight.
The weight gatherer was not overload-aware, so it would pick up
partitions that did not need to move. Consider a device that would
normally have 100 partitions assigned, assume we set overload to 0.1
so that this device will hold up to 110 (10 extra) for the sake of
dispersion, and assume the device actually has 104 partitions assigned
to it. The correct behavior is to gather nothing from this device
because it has fewer than the maximum. Prior to this commit, the
weight gatherer would remove 4 partitions from this device; they would
subsequently be reassigned by the overload-aware partition placer
(\_reassign\_parts()). In a ring with multiple overloaded devices, the
builder would pick up some partitions from each, shuffle them, and
then assign them back to those same devices. Obviously, this just
created extra replication work for no benefit.
Now, the weight gatherer takes overload into account, and will no
longer needlessly gather partitions.
That's not all, though; this change worsened the behavior of a ring
with more overload than necessary. Before, the ring would balance as
best it could, using the minimal amount of overload. With the
weight-gatherer change, the ring builder will stop gathering
partitions once a device reaches its maximum-permissible assignment
including overload.
For example, imagine a 3-replica, 4-zone ring with overload=0.2 and
weights:
z1: 100
z2: 60
z3: 60
z4: 60
Since z1 has more than 1/3 of the weight, z2, z3, and z4 must take
more than their fair share for the sake of dispersion.
Now, turn up the weights some:
z1: 100
z2: 80
z3: 80
z4: 80
Overload is no longer needed; this ring can balance. However, z2, z3,
and z4 would end up keeping more than their fair share since (a) they
already had extra due to earlier conditions, and (b) the weight
gatherer won't pick up partitions from them since they're not
overburdened once it takes overload into account.
To fix this, we compute the minimum overload factor required for
optimal dispersion and then use min(user-input-overload,
minimum-overload) during rebalance. This way, we don't overload
devices more than the user says, but if the user sets overload higher
than necessary, we'll still give the best balance possible.
Change-Id: If5666ba654ee25da54f9144f3b78840273a49627
commit ccf0758ef1f362312a6197f86455f680ebd990d3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 11 15:40:28 2015 -0700
Add ring-builder analyzer.
This is a tool to help developers quantify changes to the ring
builder. It takes a scenario (JSON file) describing the builder's
basic parameters (part\_power, replicas, etc.) and a number of
"rounds", where each round is a set of operations to perform on the
builder. For each round, the operations are applied, and then the
builder is rebalanced until it reaches a steady state.
The idea is that a developer observes the ring builder behaving
suboptimally, writes a scenario to reproduce the behavior, modifies
the ring builder to fix it, and references the scenario with the
commit so that others can see that things have improved.
I decided to write this after writing my fourth or fifth hacky one-off
script to reproduce some bad behavior in the ring builder.
Change-Id: I114242748368f142304aab90a6d99c1337bced4c
commit e860ec138913dc4c450725766a77e76a7101d06e
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 29 10:11:44 2015 +0000
Ignore invalid PIDs in swift-init
While reviewing ab9f6340 I recognized that invalid pids in the pid files raise
an exceptions (in case it is not a number), and also accept a 0 that is
impossible to use as a pid for any Swift process. In the latter case the process
was recognized as runnning, even if it did not - and thus restarting didn't
worked.
This patch ensures a better handling of any non-numeric value and also removes a
pid file if it uses 0 as the pid.
Change-Id: I09c415c7a75e4b9a0574a08f46f48fff5bb11d02
commit 0a6f2ab870a868e3036dbb212c0e7dd8375a39eb
Author: asettle <alexandra.settle@rackspace.com>
Date: Fri Jun 26 10:57:35 2015 +1000
Correcting minor grammatical errors
1. Removing unnecessary semi colon
2. Removing unnecessary content
Change-Id: Ie95403a4d96db2b8465e75495061fc059098c922
commit 4d4db054d35c7e9de9ed28ac24965e8408dd9f82
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Mon May 18 14:08:25 2015 -0500
After the .durable has been written, fsync the directory.
Added try-except statements in \_finalize\_durable() to fsync the directory
after a successful fsync of the .durable file.
Added test\_commit\_fsync\_dir\_raises\_DiskFileErrors() for testing whether
certain assertions hold for the change to include fsync\_dir().
Some more error details have been included in the logger.
Closes-Bug: #1470651
Change-Id: I4791d75ade8542678369ba0811ef39af6e955cc6
commit d4d7c0e1b11af8f20f965f410901a56e1f8ee69e
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jun 30 17:24:13 2015 -0700
Fix race in test\_server.TestObjectController.test\_PUT\_ssync\_multi\_frag
If the test ran across a one second boundary it would fail because while
the timestamp normalization was doing some rounding it was making no
attempt to reuse the same timestamp on subsequent requests.
Change-Id: Ic560032bcfacd6f0d10cfc0f4f10e5d6c2bc8dd5
commit a88bd6e6b9253b6488a2bf1a354ce29b51f37fe1
Author: ZhiQiang Fan <aji.zqfan@gmail.com>
Date: Sun Jun 28 22:04:46 2015 -0700
fix api overview document
The content about Object Storage HTTP requests constraints seems to
be a table but broken, this patch fixes it into correct rst table format.
Change-Id: I1b4c62da3e6d91add3ee0218707c1628c8f04b33
commit c95a0efe7973a660f4abcd13f4ea6211d72c4baa
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:44:10 2015 -0700
Make ssync\_sender a better HTTP client
When a server responses with an error - if that error includes a body - the
client should read the body. This cleans up some ugly eventlet/wsgi.server log
output related to chunked transfer disconnect (invalid literal for int() with
base 16).
Change-Id: Ibd06ddee9f216fce07fa33c3a7d8306b59eb6d77
Closes-Bug: #1466138
commit 44b76a1b1b83ac9563010f1ddfca5fca76e567bf
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Thu Jun 18 14:21:06 2015 -0500
EC Reconstructor: Do not reconstruct existing fragments.
The EC reconstructor needs to verify that the fragment needing to
be reconstructed does not reside in the collection of node responses.
Otherwise, resources will be spent unnecessarily reconstructing
the fragment. Moreover, this could cause a segfault on some backends.
This change adds the necessary verification steps to make sure
that a fragment will only be rebuilt in the case it is missing from
the other fragment archives.
Added some tests to provide coverage for these scenarios.
Change-Id: I91f3d4af52cbc66c9f7ce00726f247b5462e66f9
Closes-Bug: #1452553
commit d124ce5792d93e1efcdb083211ecef381f7b7173
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:35:07 2015 -0700
Fix ValueError in ssync\_receiver
httplib's putheader method will cast whatever you give it to a string.
where we allow the default dict.get default of None to be passed to
putheader unmodified ssync\_receiver is surpised that the non-empty
string isn't able to be converted to an integer.
We can avoid surprising the ssync\_receiver in this way by sending the
empty string as a better default.
Change-Id: Ie9df9927ff4d3dd3f334647f883b2937d0d81030
commit edfca861b6fa39972df276fb1f37aa81583a605d
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri Jun 26 08:54:22 2015 +0000
Increase httplib.\_MAXHEADERS
Python 2.7.9+ and 3.2.6+ limits the number of maximum headers in httplib to 100
[1,2,3]. This setting is too low for Swift.
By default the maximum number of allowed headers depends on the number of max
allowed metadata settings plus a default value of 32 for regular http headers.
If for some reason this is not enough (custom middleware for example) it can be
increased with the extra\_header\_count constraint.
[1] https://bugs.python.org/issue16037
[2] https://hg.python.org/cpython/raw-file/15c95b7d81dc/Misc/NEWS
[3] https://hg.python.org/cpython/raw-file/v3.2.6/Misc/NEWS
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Co-Authored-By: Thomas Herve <therve@redhat.com>
Change-Id: I388fd697ec88476024b0e9f1ae75ba35ff765282
commit 81ceee056de604d81a921280f453731eadf7be09
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jun 22 23:24:19 2015 -0700
Add one more test for ssync\_receiver
To prevent 409 conflict on a primary node during ssyncing,
ssync-receiver should add x-ssync-backend-frag-index generated from
x-ssync-backend-node-index of the SSYNC replication request header.
The change is done by previous work[1], but we need more test for that.
This patch addes one more assertion if the x-ssync-backend-frag-index
is in the ssync subrequest correctly.
\*BONUS\*
Fix some weird mock and add some sanities.
1: https://review.openstack.org/#/c/191521/
Change-Id: I27aff713c69017c0bc4c60b4833184e1285595d7
commit c2c1366b0794bcdbbbaef7fedaef2cab19cd8db8
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jun 24 21:07:16 2015 +0530
Fixed Errors in Swift-Form Post middleware section rst.
Inline markup cannot be nested in RST.
Fixing markups by using a single option for the whole line and making
some minor error corrections.
Change-Id: I42bfd7dfe5c93a69436ecc5d154f2e61ca83fa82
commit 514daea6317edc02587f7abfaae8770e1ef9cc4b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jun 12 23:40:51 2015 +0530
Fixed Formatting Error in Swift -Form Post middleware section.
Fixed Formatting error in ``action=”SWIFT\_URL``” => action=”``SWIFT\_URL``”
Change-Id: Id461129ef7f5b6412f94d36920c942a4181c0eb7
Closes-Bug: #1464740
commit e70b66586e13718e7ac0078c2f2cd1135c61a1f1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed Jun 24 09:36:37 2015 +0200
Replace dict.iteritems() with dict.items()
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3. According to a discussion on the openstack-dev mailing list,
the overhead of creating a temporary list using dict.items() on Python 2
is very low because most dictionaries are small:
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066391.html
Patch generated by the following command:
sed -i 's,iteritems,items,g' \
$(find swift -name "\*.py") \
$(find test -name "\*.py")
Change-Id: I6070bb6c684be76e8e77222a7d280ec6edd43496
commit e6165a7879d796efd3992260ef23a7f95ceeab32
Author: paul luse <paul.e.luse@intel.com>
Date: Mon May 25 14:41:42 2015 -0700
Add policy support to dispersion tools
Doesn't work for anything other than policy 0. updated to allow user
to specify policy name on cmd line (as with object-info) which
then makes populate/report work with 3x, 2x, or EC style policies
Change-Id: Ib7c298f0f6d666b1ecca25315b88539f45cf9f95
Closes-Bug: 1458688
commit e5c962a28ce99f01c6cd0b68b7434ddcd0e55f62
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon May 25 18:28:02 2015 +0200
Replace xrange() with six.moves.range()
Patch generated by the xrange operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Manual changes:
\* Fix indentation for pep8 checks
\* Fix TestGreenthreadSafeIterator.test\_access\_is\_serialized of
test.unit.common.test\_utils:
replace range(1, 11) with list(range(1, 11))
\* Fix UnsafeXrange docstring, revert change
Change-Id: Icb7e26135c5e57b5302b8bfe066b33cafe69fe4d
commit 4a5b851207c98a380a32e27a183dd98022be9d16
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 22 14:48:41 2015 +0200
Add note about updatedb to the docs
Change-Id: Ia1aa0bb1f93ee487e2f7ddf76a7a08efa8f3ba41
commit ac8a76958510646c369df9ffc2bf22005e43d153
Author: paul luse <paul.e.luse@intel.com>
Date: Sat Jun 13 11:03:56 2015 -0700
EC Ssync: Update parms to include node and frag indices
Previously we sent the ssync backend frag index based on the node
index. We need to be more specific for ssync to handle both sync
and revert cases so now we send the frag index based on the job
contents (as determined by the ec recon)) and the node index
as a new header based on, well, the node index.
The rcvr can now validate the incoming pair to reject (400) when
a primary node is being asked to accept fragments that don't
belong to it. Additionally, by having the frag index the
rcvr can reject (409) an attempt to accept a fragment when its
a handoff and already has one that needs to be reverted.
Fixes-bug: #1452619
Change-Id: I8287b274bbbd00903c1975fe49375590af697be4
commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
Closes-Bug: #1466549
commit df134df901a13c2261a8205826ea1aa8d75dc283
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu May 14 22:14:15 2015 -0700
Allow 1+ object-servers-per-disk deployment
Enabled by a new > 0 integer config value, "servers\_per\_port" in the
[DEFAULT] config section for object-server and/or replication server
configs. The setting's integer value determines how many different
object-server workers handle requests for any single unique local port
in the ring. In this mode, the parent swift-object-server process
continues to run as the original user (i.e. root if low-port binding
is required), binds to all ports as defined in the ring, and forks off
the specified number of workers per listen socket. The child, per-port
servers drop privileges and behave pretty much how object-server workers
always have, except that because the ring has unique ports per disk, the
object-servers will only be handling requests for a single disk. The
parent process detects dead servers and restarts them (with the correct
listen socket), starts missing servers when an updated ring file is
found with a device on the server with a new port, and kills extraneous
servers when their port is found to no longer be in the ring. The ring
files are stat'ed at most every "ring\_check\_interval" seconds, as
configured in the object-server config (same default of 15s).
Immediately stopping all swift-object-worker processes still works by
sending the parent a SIGTERM. Likewise, a SIGHUP to the parent process
still causes the parent process to close all listen sockets and exit,
allowing existing children to finish serving their existing requests.
The drop\_privileges helper function now has an optional param to
suppress the setsid() call, which otherwise screws up the child workers'
process management.
The class method RingData.load() can be told to only load the ring
metadata (i.e. everything except replica2part2dev\_id) with the optional
kwarg, header\_only=True. This is used to keep the parent and all
forked off workers from unnecessarily having full copies of all storage
policy rings in memory.
A new helper class, swift.common.storage\_policy.BindPortsCache,
provides a method to return a set of all device ports in all rings for
the server on which it is instantiated (identified by its set of IP
addresses). The BindPortsCache instance will track mtimes of ring
files, so they are not opened more frequently than necessary.
This patch includes enhancements to the probe tests and
object-replicator/object-reconstructor config plumbing to allow the
probe tests to work correctly both in the "normal" config (same IP but
unique ports for each SAIO "server") and a server-per-port setup where
each SAIO "server" must have a unique IP address and unique port per
disk within each "server". The main probe tests only work with 4
servers and 4 disks, but you can see the difference in the rings for the
EC probe tests where there are 2 disks per server for a total of 8
disks. Specifically, swift.common.ring.utils.is\_local\_device() will
ignore the ports when the "my\_port" argument is None. Then,
object-replicator and object-reconstructor both set self.bind\_port to
None if server\_per\_port is enabled. Bonus improvement for IPv6
addresses in is\_local\_device().
This PR for vagrant-swift-all-in-one will aid in testing this patch:
https://github.com/swiftstack/vagrant-swift-all-in-one/pull/16/
Also allow SAIO to answer is\_local\_device() better; common SAIO setups
have multiple "servers" all on the same host with different ports for
the different "servers" (which happen to match the IPs specified in the
rings for the devices on each of those "servers").
However, you can configure the SAIO to have different localhost IP
addresses (e.g. 127.0.0.1, 127.0.0.2, etc.) in the ring and in the
servers' config files' bind\_ip setting.
This new whataremyips() implementation combined with a little plumbing
allows is\_local\_device() to accurately answer, even on an SAIO.
In the default case (an unspecified bind\_ip defaults to '0.0.0.0') as
well as an explict "bind to everything" like '0.0.0.0' or '::',
whataremyips() behaves as it always has, returning all IP addresses for
the server.
Also updated probe tests to handle each "server" in the SAIO having a
unique IP address.
For some (noisy) benchmarks that show servers\_per\_port=X is at least as
good as the same number of "normal" workers:
https://gist.github.com/dbishop/c214f89ca708a6b1624a#file-summary-md
Benchmarks showing the benefits of I/O isolation with a small number of
slow disks:
https://gist.github.com/dbishop/fd0ab067babdecfb07ca#file-results-md
If you were wondering what the overhead of threads\_per\_disk looks like:
https://gist.github.com/dbishop/1d14755fedc86a161718#file-tabular\_results-md
DocImpact
Change-Id: I2239a4000b41a7e7cc53465ce794af49d44796c6
commit af72881d1dcc46486d8d652b92a0ec9aa9ca2bfa
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jun 15 13:36:36 2015 -0700
Use just IP, not port, when determining partition placement
In the ring builder, we place partitions with maximum possible
dispersion across tiers, where a "tier" is region, then zone, then
IP/port,then device. Now, instead of IP/port, just use IP. The port
wasn't really getting us anything; two different object servers on two
different ports on one machine aren't separate failure
domains. However, if someone has only a few machines and is using one
object server on its own port per disk, then the ring builder would
end up with every disk in its own IP/port tier, resulting in bad (with
respect to durability) partition placement.
For example: assume 1 region, 1 zone, 4 machines, 48 total disks (12
per machine), and one object server (and hence one port) per
disk. With the old behavior, partition replicas will all go in the one
region, then the one zone, then pick one of 48 IP/port pairs, then
pick the one disk therein. This gives the same result as randomly
picking 3 disks (without replacement) to store data on; it completely
ignores machine boundaries.
With the new behavior, the replica placer will pick the one region,
then the one zone, then one of 4 IPs, then one of 12 disks
therein. This gives the optimal placement with respect to durability.
The same applies to Ring.get\_more\_nodes().
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ibbd740c51296b7e360845b5309d276d7383a3742
commit 09e7477a391e7425af62a6516f43c69bc98b7080
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jun 15 22:10:45 2015 +0530
Replace it.next() with next(it) for py3 compat
The Python 2 next() method of iterators was renamed to \_\_next\_\_() on
Python 3. Use the builtin next() function instead which works on Python
2 and Python 3.
Change-Id: Ic948bc574b58f1d28c5c58e3985906dee17fa51d
commit 5ad369c1cb0f480b164a5b5e7eb194081835c266
Author: Victor Stinner <vstinner@redhat.com>
Date: Tue Jun 9 00:22:12 2015 +0200
Add six requirement
The six module is needed to add Python 3 support to Swift.
Change-Id: Ie637ed3458c7ff56c26834bca73203ed55604d74
commit 037a0c5dbe01a57b741d34988e21f4f763b6204b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jun 6 17:42:41 2015 +0530
Object are sorted and concatenated by swift in cardinal order.
Modified values in example in decimal to be more precise,
added a small description on Object are sorted and concatenated
by swift in cardinal order as a small phrase would be sufficient.
Change-Id: I914ded4e5726e50bb93b05759c3bfb76edda53ab
backport: none
Closes-Bug: #1383893
commit 11e5c4adf0e02c8fdab0d8584fc943d96e1165cd
Author: Koert van der Veer <koert@cloudvps.com>
Date: Tue Dec 16 11:15:19 2014 +0100
Allow default reseller prefix in domain\_remap middleware
Previously, the reseller prefix needed to be provided in the host name
even when the domain was unique to that reseller. With the
default\_reseller\_prefix, any domain which matches in this middleware,
will will be passed on with a reseller prefix, whether or not it was
provided.
Change-Id: I5aa5ce78ad1ee2e3660cce4c3e07306f8999f02a
Implements: blueprint domainremap-reseller-domains
commit c953e8cc9049e94cd01239d5e4a30a56f26a97d3
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Tue Apr 28 13:18:32 2015 -0500
The hash\_cleanup\_listdir function should only be called when necessary.
Introduced a conditional that will specify to \_finalize\_put() whether
the put() method is being called within the context of ECDiskFileWriter.
Included some unit tests that will test the number of calls to
hash\_cleanup\_listdir() during put(), commit(), and delete()
operations.
Change-Id: I287b2648591fdbf686898dc9047beda80a64da0c
commit 93de6c73e587a672663fa0997f439b73b336769c
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jun 2 17:00:42 2015 +0900
Add metadata size tests on the border
This patch adds a test for a 204 when a single metadata item in a POST causes
the backend aggregate constraints check to be on the border.
Background:
Overall metadata size constraint is enforced in the container and
account backends as well as in the proxy controllers.
Whereas the proxy controller can check that constraints are not exceeded
by a single PUT or POST request, the backend checks that constraints are not
exceeded by the aggregate of all PUTs and POSTs.
The change [1] added a test for a 400 when a single metadata item in
a POST causes the backend aggregate constraints check to go over limit.
[1] I1489e29686013cbd3d70283d8756b548aea3c2e1
Change-Id: Iac86ea71240ddde177e625c279c21aef67659d10
commit af734b3fb6fdbc11b8a0b775256e7642eb485b8d
Author: Mark Seger <Mark.Seger@hp.com>
Date: Wed Jun 3 08:16:06 2015 -0400
Change usage help and Attention messages to warnings
Change-Id: I1396aaffe36e739606f15f7fef37b11bd83f1fc1
commit 4f2ed8bcd0468f3b69d5fded274d8d6b02ac3d10
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri Mar 20 09:56:30 2015 -0700
EC: support multiple ranges for GET requests
This commit lets clients receive multipart/byteranges responses (see
RFC 7233, Appendix A) for erasure-coded objects. Clients can already
do this for replicated objects, so this brings EC closer to feature
parity (ha!).
GetOrHeadHandler got a base class extracted from it that treats an
HTTP response as a sequence of byte-range responses. This way, it can
continue to yield whole fragments, not just N-byte pieces of the raw
HTTP response, since an N-byte piece of a multipart/byteranges
response is pretty much useless.
There are a couple of bonus fixes in here, too. For starters, download
resuming now works on multipart/byteranges responses. Before, it only
worked on 200 responses or 206 responses for a single byte
range. Also, BufferedHTTPResponse grew a readline() method.
Also, the MIME response for replicated objects got tightened up a
little. Before, it had some leading and trailing CRLFs which, while
allowed by RFC 7233, provide no benefit. Now, both replicated and EC
multipart/byteranges avoid extraneous bytes. This let me re-use the
Content-Length calculation in swob instead of having to either hack
around it or add extraneous whitespace to match.
Change-Id: I16fc65e0ec4e356706d327bdb02a3741e36330a0
commit f1f4bb30cd8ad930ddb7a232b2744b48e35a0480
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Jun 2 19:51:39 2015 +0000
Fix testing issues
When functional tests are run in tox and an exception is raised when connecting
to Swift (for example: Swift not running, missing python-keystoneclient package
used by python-swiftclient) 0 tests are executed, but tox returns a success.
An exception is raised during tests, caused by a missing python-keystoneclient
in python-swiftclient. Instead of adding python-keystoneclient as a dependency
in python-swiftclient the package is added to the test-requirements.txt in Swift
itself. Note that adding python-keystoneclient to the test-requirements in
python-swiftclient is not sufficient (it's already in there).
The exception in setup\_package() is catched by the openstack.nose\_plugin, thus
disabling this plugin for now as well.
Also fixing two test errors seen on the gate regarding the tempurl middleware.
There was also an update to tox, environment variables were no longer passed
with versions >= 2.0 (http://tox.readthedocs.org/en/latest/changelog.html).
Swift test environment variables have been added to the passenv to re-enable the
former behavior, as well as environment variables required to pass proxy
settings.
This also led to skipped tempauth tests, and together with the missing
python-keystoneclient no tests were executed.
Related-Bug: 1461440
Related-Bug: 1455102
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Ideea071017d04912c60ed0bc76532adbb446c31d
commit 2759a6f159d4a90e4ad4c8e9e479085d195f8d14
Author: Pradeep Kumar Singh <pradeep.singh@nectechnologies.in>
Date: Wed May 13 21:18:02 2015 +0530
Handle Disk IO error Exception in swift account auditor
Swift account auditor fails to quarantine corrupt db due to
Disk IO error. This patch fixes that by handling Disk IO Error
Exception.
Closes-Bug:1169189
Change-Id: I031ee2a5775e4a88d4fb00d972d553936147c42e
commit 1bef06eec8f5f780914ac701d63f9c498b29119b
Author: Michael Barton <mike@weirdlooking.com>
Date: Sun May 31 23:10:15 2015 +0000
Don't quarantine on read\_metadata ENOENT
An operation that removes an existing .ts or .meta out from under another
concurrent operation at the right point can cause the whole object to be
needlessly quarantined.
Closes-Bug: #1451520
Change-Id: I37d660199e54411d0610889f9ee230b13747244b
commit 8b4af92dac813d707d124b3be37df586260fe74a
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Jun 1 17:57:25 2015 +0100
Tighten up overall metadata size tests
Overall metadata size constraint is enforced in the container and account
backends as well as in the proxy controllers. Whereas the proxy controller
can check that constraints are not exceeded by a single PUT or POST request,
the backend checks that constraints are not exceeded by the aggregate of all
PUTs and POSTs.
The current functional tests only exercise the proxy controller checks, since
they test for a 400 when sending excessive metadata in a single POST. This patch
adds a test for a 400 when a single metadata item in a POST causes the backend
aggregate constraints check to go over limit.
The extra coverage of the new assertions can be seen by modifying
swift/common/db.DatabasBroker.validate\_metadata() to always return None
immediately - only the new assertions fail when functests are run.
Change-Id: I1489e29686013cbd3d70283d8756b548aea3c2e1
commit b4c1d73ad56e0705d1c5dd1fc4f1d89b09fceff1
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 1 06:50:33 2015 +0000
Make swift-recon compatible for servers without storage policies
Swift recon introduced a new key for storage policies, and the CLI expected this
key in the server response. However, if one updates the CLI but not yet the
server an exception will be raised, because there is no default value and no
check if the key is included in the response.
This change checks if the policies key is included in the response and updates
one test to ensure backward compability.
Closes-Bug: 1453599
Change-Id: I7c7a90f9933bec2ab45595df9dc600a6cba65666
commit 38787d0fb5102e41b153e4629d2ef374a02965e9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:19:54 2015 -0700
Remove simplejson from staticweb
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This lets us get rid of some redundant Unicode encoding. Before, we
would take the container-listing response off the wire,
JSON-deserialize it (str -> unicode), then pass each of several fields
from each entry to get\_valid\_utf8\_str(), which would encode it,
(unicode -> str), decode it (str -> unicode), and then encode it again
(unicode -> str) for good measure.
The net effect was that each object's name would, in the proxy server,
go str -> unicode -> str -> unicode -> str.
By replacing simplejson with stdlib json, we get a guarantee that each
container-listing entry's name, hash, content\_type, and last\_modified
are unicodes, so we can stop worrying about them being valid UTF-8 or
not. This takes an encode and decode out of the path, so we just have
str -> unicode -> str. While it'd be ideal to avoid this, the first
transform (str -> unicode) happens when we decode the
container-listing response body (json.loads()), so there's no way out.
Change-Id: I00aedf952d691a809c23025b89131ea0f02b6431
commit 736cf54adf3ee85d2f473e5e5374f9833422967c
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu May 28 15:30:47 2015 -0700
Remove simplejson from tests
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This commit just takes simplejson out of the unit and functional
tests. They still pass.
Change-Id: I96f17df81fa5d265395a938b19213d2638682106
commit 68c30b80b47c281c549d101c43d79e718e91d21d
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu May 28 06:08:12 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I0c7b2bdb0edcc3bb3fa06903ec8457ca5e2dd688
commit 5374ba3a80a5b895542196502eac4d9300ba53d2
Author: John Dickinson <me@not.mn>
Date: Wed May 27 12:28:04 2015 -0700
drop Python 2.6 testing support
Change-Id: I78f21e5794e8ba7a095f03d279247516a241f555
commit 191f2a00bd9121fddc03d8f07f15e5e34790541e
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 16:39:23 2015 +0100
Remove \_ensure\_flush() from SSYNC receiver
The Receiver.\_ensure\_flush() method in ssync\_receiver.py has
the following comment:
Sends a blank line sufficient to flush buffers.
This is to ensure Eventlet versions that don't support
eventlet.minimum\_write\_chunk\_size will send any previous data
buffered.
If https://bitbucket.org/eventlet/eventlet/pull-request/37
ever gets released in an Eventlet version, we should make
this yield only for versions older than that.
The reference pull request was included with eventlet 0.14 [1] and
swift now requires >=0.16.1 so it is safe to remove \_ensure\_flush()
and save > 8k bytes per SSYNC response.
[1] https://bitbucket.org/eventlet/eventlet/commits/4bd654205a4217970a57a7c4802fed7ff2c8b770
Change-Id: I367e9a6e92b7ea75fe7e5795cded212657de57ed
commit 3aa06f185ac4256a8883c565bdc90b1ffbd519ca
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 09:17:46 2015 +0100
Make SSYNC receiver return a reponse when initial checks fail
The ssync Receiver performs some checks on request parameters
in initialize\_request() before starting the exchange of missing
hashes and updates e.g. the destination device must be available;
the policy must be valid. Currently if any of these checks fails
then the receiver just closes the connection, so the Sender gets
no useful response code and noise is generated in logs by httplib
and wsgi Exceptions.
This change moves the request parameter checks to the Receiver
constructor so that the HTTPExceptions raised are actually sent
as responses. (The 'connection close' exception handling still
applies once the 'missing\_check' and 'updates' handshakes are in
progress.)
Moving initialize\_request() revealed the following lurking bug:
\* initialize\_request() sets
req.environ['eventlet.minimum\_write\_chunk\_size'] = 0
\* this was previously ineffective because the Response environ
had already been copied from Request environ before this value
was set, so the Response never used the value :/
\* Now that it is effective (a good thing) it causes the empty string
yielded by the receiver when there are no missing hashes in
missing\_checks() to be sent to the sender immediately. This makes
the Sender.readline() think there has been an early disconnect
and raise an Exception (a bad thing), as revealed by
test/unit/obj/test\_ssync\_sender.py:TestSsync.test\_nothing\_to\_sync
The fix for this is to simply make the receiver skip sending the empty
string if there are no missing object\_hashes.
Change-Id: I036a6919fead6e970505dccbb0da7bfbdf8cecc3
commit bb716573ab5c8455348ec013feb894421e0e1f1c
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed May 20 00:39:41 2015 -0700
Allow SLO PUTs to forgo per-segment integrity checks
While manifests still require 'etag' and 'size\_bytes' fields for each
segment (to catch user errors like 'etaf' or 'size\_btyes'), an explicit
null for either will skip that particular integrity check and instead
use whatever value is retrieved when HEADing the segment. So, if a user
uploads a manifest like:
[{"path": "/con/obj\_seg\_1", "etag": null, "size\_bytes": 1048576},
{"path": "/con/obj\_seg\_2", "etag": "etag2", "size\_bytes": null},
{"path": "/con/obj\_seg\_3", "etag": null, "size\_bytes": null}]
then the etag will only be verified for the /con/obj\_seg\_2 segment,
and the segment size will only be verified for the /con/obj\_seg\_1
segment. However, the manifest that's ultimately stored (and can be
retrieved with a ?multipart-manifest=get query-string) will still look
like:
[{"name": "/con/obj\_seg\_1", "hash": "etag1", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_2", "hash": "etag2", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_3", "hash": "etag3", "bytes": 1234, ...}]
This allows the middleware to continue performing integrity checks on
object GET.
Change-Id: I2c4e585221387dd02a8679a50398d6b614407b12
DocImpact
commit a1c327022c70907ccc159d6203de26b37c3a4586
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:43:55 2015 -0700
Remove simplejson from swift-recon
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
All swift-recon was doing with json was decoding a JSON response (from
the recon middleware) and printing it to the terminal. This still
works just fine.
Change-Id: I28cf25a7c2856f230d4642c62fb8bf9c4d37e9e5
commit a3559edc2342e2cf92a5188336ab263ffd038554
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Apr 17 16:30:30 2015 -0700
Exclude local\_dev from sync partners on failure
If the primary left or right hand partners are down, the next best thing
is to validate the rest of the primary nodes. Where the rest should
exclude not just the left and right hand partners - but ourself as well.
This fixes a accidental noop when partner node is unavailable and
another node is missing data.
Validation:
Add probetests to cover ssync failures for the primary sync\_to nodes for
sync jobs.
Drive-by:
Make additional plumbing for the check\_mount and check\_dir constraints into
the remaining daemons.
Change-Id: I4d1c047106c242bca85c94b569d98fd59bb255f4
commit 666bf06c26bc9e0d6256d054835386e50e67b8a2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed May 6 16:29:06 2015 -0700
EC: don't 503 on marginally-successful PUT
On EC PUT in an M+K scheme, we require M+1 fragment archives to
durably land on disk. If we get that, then we go ahead and ask the
object servers to "commit" the object by writing out .durable
files. We only require 2 of those.
When we got exactly M+1 fragment archives on disk, and then one
connection timed out while writing .durable files, we should still be
okay (provided M is at least 3). However, we'd take our M > 2
remaining successful responses and pass that off to best\_response()
with a quorum size of M+1, thus getting a 503 even though everything
worked well enough.
Now we pass 2 to best\_response() to avoid that false negative.
There was also a spot where we were getting the quorum size wrong. If
we wrote out 3 fragment archives for a 2+1 policy, we were only
requiring 2 successful backend PUTs. That's wrong; the right number is
3, which is what the policy's .quorum() method says. There was a spot
where the right number wasn't getting plumbed through, but it is now.
Change-Id: Ic658a199e952558db329268f4d7b4009f47c6d03
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Closes-Bug: 1452468
commit e7c8c578d9e5b0aa7e56b02bd9c39baa99d2d6ae
Author: Michael MATUR <michael.matur@gmail.com>
Date: Mon May 25 15:13:01 2015 +0200
fixup!Patch of "parse\_content\_disposition" method to meet RFC2183
The spec of Content-Disposition does not require a space character after
comma: http://www.ietf.org/rfc/rfc2183.txt
Change-Id: Iff438dc36ce78c6a79bb66ab3d889a8dae7c0e1f
Closes-Bug: #1458497
commit af8d842076ba269fed7f4128d0c7503ab5d1a94a
Author: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Date: Tue Oct 21 09:24:25 2014 +0000
Replaced setting run\_pause with standard interval
The deprecated directive `run\_pause` should be replaced with the more
standard one `interval`. The `run\_pause` should be still supported for
backward compatibility. This patch updates object replicator to use
`interval` and support `run\_pause`. It also updates its sample config
and documentation.
Co-Authored-By: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Co-Authored-By: Kamil Rykowski <kamil.rykowski@intel.com>
Change-Id: Ie2a3414a96a94efb9273ff53a80b9d90c74fff09
Closes-Bug: #1364735
commit f11d92d566757a54ff1e3800ec0bfac098347a68
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri May 22 16:58:04 2015 -0700
Add swift-durability-calculator line to docs
This commits add a line (link and small doc) for
swift-durability-calculator which provides a browser based
durability calculation tool to docs as an associated project.
Change-Id: I4ea8015f512616dc25072080bef79b8734971ccf
commit f864092455ebcd40b3568633c3524cc5c64d3309
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed May 20 17:50:07 2015 -0700
Add Swift Inspector to assoicated projects
Change-Id: I5b5448674ea455119a51509ab5e7cd11a764b5a7
commit e54781a2aa29808aff654861d8a0aafd24b6620c
Author: Thiago da Silva <thiago@redhat.com>
Date: Tue May 19 20:27:06 2015 +0000
add object post and delete methods to BaseObjectController
Adding post and delete methods to BaseObjectController that can
be overriden by ObjectCOntroller subclasses. These methods are
similar to the PUT and GET methods that were introduced as part
of the EC work
Change-Id: I197364bc3e2f2287c0afc8948863e3cdeab90383
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit ab9f63402de6d554528699a02955854ac28264c5
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Mon Nov 24 21:44:03 2014 +0900
Add process name checking into swift-init
Swift-init uses pid files to detect existing swift processes by pid.
However, it mistakes an unrelated process for a swift process and makes
a wrong decision, when the unrelated process is running with pid written
in swift pid files.
This patch adds process name checking into swift-init and enable it to remove
invalid pid files in such situation.
Change-Id: Ibca026bdfbdacdd92c8763e1eb15d98293c70656
Closes-Bug: #1327106
commit aa4866eb6014d7fbb8531eb5d927d5611ebfd06d
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed May 13 20:10:59 2015 +0000
move replication code to ReplicatedObjectController
Moving \_connect\_put\_node, send\_file, \_transfer\_data and \_store\_object
methods to ReplicatedObjectController. Each one of these methods are
specific to replication policy. EC policy implements their own
version of them.
Of these four methods, only \_store\_object and \_connect\_put\_node are
required to be implemented by the policy specific Object Controllers.
Change-Id: Ifc72461b77dbfdaae9d63417f1286e8b5da3ca4e
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit 025c4c4339e7ace2f5be8cb3a3cddf6c38ceff37
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Apr 24 02:15:36 2015 -0700
Remove confusable query string on post as copy
Current post as copy routine (i.e. POST object with post\_as\_copy option
turned on) on Object Controller uses "multipart-manifest" query string
which is feeded to env['copy\_hook'] to decide which data (the manifest or
object pointed by the manifest) should be copied.
However, the way using the query string will confuse operators looking at
logging system (or analyzing the log) because whole POST object requests
have 'multipart-manifest=get' like as:
POST /v1/AUTH\_test/d4c816b24d38489082f5118599a67920/manifest-abcde%3Fmultipart-manifest%3Dget
We cannot know whether the query string was added by hand
(from user) or not. In addition, the query isn't needed by the
backend conversation between proxy-server and object-server.
(Just needed by "copy\_hook" on the proxy controller!)
To remove the confusable query string and to keep the log to be clean,
this patch introduces new environment variable "swift.post\_as\_copy"
and changes proxy controller and the copy\_hook to use the new env.
This item was originally discussed at
https://review.openstack.org/#/c/177132/
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: I0cd37520eea1825a10ebd27ccdc7e9162647233e
commit 98b725fec639c5501c645ce4e4dc9d12c686f91d
Author: Alistair Coles <alistair.coles@hp.com>
Date: Fri May 1 13:02:29 2015 +0100
Cleanup and extend end to end ssync tests
Extends the existing end to end ssync tests with
a test using replication policy.
Also some cleanup and improvements to the test framework e.g. rather
than faking the connection between sender and receiver, use a real
connection and wrap it to capture traffic for verification.
Change-Id: Id71d2eb3fb8fa15c016ef151aacf95f97196a902
commit 518262ab6ecd8faa2b915df118ffc70a30112a18
Author: paul luse <paul.e.luse@intel.com>
Date: Tue May 12 15:21:13 2015 -0700
Remove 1 line of dead code from EC reconstructor
Assuming nobody intentionally left this in here for some reason...
Change-Id: I4bf43bb3828e062c0342557243076ed62d6790f4
commit 29f4393d88426fd6c34f2cfe43a8c434bfad8d47
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri May 8 15:55:14 2015 -0700
Remove workaround for old eventlet version
Swift now requires eventlet >= 0.16.1, so we can get rid of this
workaround for a bug in eventlet 0.9.16.
Change-Id: I4a1200b9bd9266896a704a840fda0d1b720bc86d
commit 90b84d3a699811a99c97ebbe4f71a14d2f76a0e5
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri May 8 11:45:12 2015 -0700
Properly re-raise exceptions in proxy\_logging
Previously, this could encounter TypeErrors, presumably because
sys.exc\_clear() was called somewhere in the block of code between
catching the exception and re-raising.
Related-Bug: 1181146
Change-Id: Iadeea3f61e70bf83dc0eb063fdb27edd16f3ca32
commit 664a632c01f8c5c80826b223b9ade774bfe2ed9a
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 8 08:41:39 2015 +0200
Update my mailmap entry
Change-Id: I5d21a55d0fa4cab6eaa6ff426819aa1dc997de2f
commit 0b20a18e5216b991855c461e41e9ef32e17fadb4
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Thu May 7 13:16:15 2015 -0600
Spell "rebalance" right in swift-ring-builder.1
See Red Hat bug #1218269.
Change-Id: I814eb4b3c0821f5a8df5feea2bda3a964aace536
commit 1faad248f833735585aa8f6135babceb46fbb6f8
Author: Emmanuel Cazenave <contact@emcaz.fr>
Date: Tue May 5 12:31:22 2015 +0200
X-Auth-Token should be a bytestring.
Change-Id: I2aa941d74883e17e9548b0144a4a2e2db33aba95
Closes-Bug: 1451773
commit 55dd705a863c4500330cbd2b8c2fec46d618dc71
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Wed May 6 19:53:09 2015 +0200
Add missing statsd metrics section for object-reconstructor
Change-Id: Id3f98e5f637ff537a387262b40f21c05876fca91
commit c77c79b2c9b9ca7790c29577341cf36c5e9012cf
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue May 5 06:08:09 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9b0156c7fc315182d80604bf353586455bbc34d1
commit 94215049fd37f810ddf4e6b8122cce02aea3e6e3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon May 4 15:08:51 2015 -0700
Bump up a timeout in a test
Got a slow crappy VM like I do? You might see this fail
occasionally. Bump up the timeout a little to help it out.
Change-Id: I8c0e5b99012830ea3525fa55b0811268db3da2a2
commit 03536dbb55c219b94389e635babec2df2e2759fa
Author: Prashanth Pai <ppai@redhat.com>
Date: Wed Apr 29 12:11:59 2015 +0530
Fix incorrect passing of file object to fsync()
swift.common.utils.fsync() requires a file descriptor as argument
but file object handle was being passed.
Change-Id: I316b58f6bc37de0945eff551e4e50565653664f5
Signed-off-by: Prashanth Pai <ppai@redhat.com>
commit bfbc94c3cb34eb9ff288fb817dee667cc870d9eb
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Apr 28 10:45:50 2015 +0100
Fix intermittent container replicator test failure
Intermittent failure of this test could be due to
insufficient time elapsing between either the local
and remote db's being created or during the
debug\_timing calls. This patch forces greater timestamp
separation and forces debug\_timing to always log timings.
Also add message to the failign assertion so if this does
fail again we get some clue as to why.
Closes-Bug: 1369663
Change-Id: I4b69b2e759d586a14abd0931a68dbdf256d57c32
commit dbb9d4b7938f24ee588d260c9b51ca65d5095749
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Mon Apr 27 08:52:18 2015 +0200
Add missing docstring in direct\_client
Added a missing docstring to the direct\_delete\_container method.
Also checked other docstrings in the same file and fixed a wrong docstring
element in direct\_delete\_object. Added raises: docstring entry to all methods
that raise an Exception.
Change-Id: If463a0f9ddff3fe2d13f6d97fcfa955e91d0f01f
commit 8cdf0fdebe9eb782322fccfc11253dc959cf321d
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Apr 27 13:29:50 2015 -0700
Fix account replication during pre-storage-policy upgrade
Old account schemas don't send the storage\_policy\_index key for container rows
during replication, and if the recieving end is already running an upgraded
server it is surprised with a KeyError. Normally this would work itself out
if the old schema recieved any updates from container layer, or a new
container is created, or requires a row sync from another account database -
but if the account databases have rows out of sync and there's no activity in
the account otherwise, there's nothing to force the old schemas to be
upgraded.
Rather than force the old schema that already has a complete set of container
rows to migrate even in the absense of activity we can just fill in default
legacy value for the storage policy index and allow the accounts to get back
in sync and migrate the next time a container update occurs.
FWIW, I never able to get a cluster upgrade to get stuck in this state without
some sort of account failure that forced them to get their rows out of sync
(in my cause I just unlinked a pending and then made sure to force all my
account datbases to commit pending files before upgrading - leading to an
upgraded cluster that absolutly needed account-replication to solve a row
mismatch for inactive accounts with old schemas)
Closes-Bug #1424108
Change-Id: Iaf4ef834eb24f0e11a52cc22b93a864574fabf83
commit 03380380efb5d5c0b2a3acfaa64b486ee2cb6e64
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Apr 23 19:39:16 2015 -0700
Simplify ring.builder.RingBuilder.\_\_deepcopy\_\_
Only container classes (lists, sets, dicts, graphs, collections,
etc) need to track objects they deepcopy in the memo dict -
particularly when they may contain other containers! As they
recreate a new container with the same items as themselves, they'll
reference the memo for each item they contain before making a
deepcopy of it, and place a reference to the copied item into memo
after they do. Trying to help out some other container class in
this endeavor by attempting to add ourselves to the memo dict in
some useful manor on their behalf however; is not helpful.
All we need to do to make sure we're being a good \_\_deepcopy\_\_
implementation is make sure we pass on memo to our calls of deepcopy
so that other container classes can avoid making additional
deepcopy's of our containers if they already have a memorized copy
(which would be odd since unique instances of RingBuilders aren't
expected to share state, but hey - python doesn't have private
attributes so you never know!)
Change-Id: Ifac444dffbf79d650b2d858f6282e05d8ea741a0
commit 43ace3c62893364b6e3c130df56438995627598d
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 12:17:56 2015 -0700
Make RingBuilders deep-copy-able
We used to be able to deep-copy RingBuilder objects, but the addition
of debug logging (8d3b3b2) broke that since you can't deep-copy a
Python logger. This commit fixes that.
Swift doesn't really deep-copy RingBuilders anywhere, but third-party
code might.
Change-Id: If8bdadd93d9980db3d8a093f32d76ca604de9301
commit 215cd551df8be066edafd2a1e16d0bd143ec214b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Apr 21 17:38:04 2015 -0700
Bulk upload: treat user xattrs as object metadata
Currently, if you PUT a single object, then you can also associate
metadata with it by putting it in the request headers, prefixed with
"X-Object-Meta". However, if you're bulk-uploading objects, then you
have no way to assign any metadata.
The tar file format\* allows for arbitrary UTF-8 key/value pairs to be
associated with each file in an archive (as well as with the archive
itself, but we don't care about that here). If a file has extended
attributes, then tar will store those as key/value pairs.
This commit makes bulk upload read those extended attributes, if
present, and convert those to Swift object metadata. Attributes
starting with "user.meta" are converted to object metadata, and
"user.mime\_type"\*\* is converted to Content-Type.
For example, if you have a file "setup.py":
$ setfattr -n user.mime\_type -v "application/python-setup" setup.py
$ setfattr -n user.meta.lunch -v "burger and fries" setup.py
$ setfattr -n user.meta.dinner -v "baked ziti" setup.py
$ setfattr -n user.stuff -v "whee" setup.py
This will get translated to headers:
Content-Type: application/python-setup
X-Object-Meta-Lunch: burger and fries
X-Object-Meta-Dinner: baked ziti
Swift will handle xattrs stored by both GNU and BSD tar\*\*\*. Only
xattrs user.mime\_type and user.meta.\* are processed; others are
ignored.
This brings bulk upload much closer to feature-parity with non-bulk upload.
\* The POSIX 1003.1-2001 (pax) format, at least. There are a few
different, mutually-incompatible tar formats out there, because of
course there are. This is the default format on GNU tar 1.27.1 or
later.
\*\* http://standards.freedesktop.org/shared-mime-info-spec/latest/ar01s02.html#idm140622087713936
\*\*\* Even with pax-format tarballs, different encoders store xattrs
slightly differently; for example, GNU tar stores the xattr
"user.rubberducky" as pax header "SCHILY.xattr.user.rubberducky",
while BSD tar (which uses libarchive) stores it as
"LIBARCHIVE.xattr.user.rubberducky". One might wonder if this is
some programmer's attempt at job security.
Change-Id: I5e3ce87d31054f5239e86d47c45adbde2bb93640
commit f8dee761bd36f857aa1288c27e095907032fad68
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:15:35 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Note: This is part of importing of translations, there are no new
translations for this project, thus only the pot file gets updated.
Change-Id: I0cbfdae3bd1662da54c58e91a13f49419eba9b2d
commit cd7c58e93690fd25f5266754d0593c656dd51e2e
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Closes-Bug: 1446801
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 281cb1c210f0292bad190cabaae447145fa5eade
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Closes-Bug: 1446727
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit 51e31c5c7147f3ba61437e132b12b491ca718ce4
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Apr 15 15:31:06 2015 -0700
Don't apply the wrong Etag validation to rebuilt fragments
Because of the object-server's interaction with ssync sender's
X-Backend-Replication-Headers when a object (or fragment archive) is
pushed unmodified to another node it's ETag value is duped into the
recieving ends metadata as Etag. This interacts poorly with the
reconstructor's RebuildingECDiskFileStream which can not know ahead of
time the ETag of the fragment archive being rebuilt.
Don't send the Etag from the local source fragment archive being used as
the basis for the rebuilt fragent archive's metadata along to ssync.
Closes-Bug: 1446800
Change-Id: Ie59ad93a67a7f439c9a84cd9cff31540f97f334a
commit 2080f7dbd897d6130542dbf88e37641a41625eb5
Author: Alistair Coles <alistair.coles@hp.com>
Date: Thu Feb 26 15:16:22 2015 +0000
Fix tempauth acl checks when simplejson has no speedups
As documented in linked bug report, tempauth unit tests
were seen to fail on a system where simplejson was
installed but without the speedups extension. This
is because the tempauth account acl validation checks
that values are type str, but without the speedups
extension the json parser is returning unicode objects.
Fix is to have the acl validator tolerate those objects
being unicode or str.
Also change common/bufferedhttp.py to coerce ring device
to type str when constructing a path, in order to avoid
a UnicodeDecodeError when httplib sends a message that
has non-ascii header values.
Change-Id: I01524282cbaa25dc4b6dfa09f3f4723516cdba99
Closes-Bug: 1425776
commit 27f6fba5c3b9e0461d52c1deffe32130e7e9af51
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 0c391d6daffe1943f6def803db42e08e6d6846d2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 16:47:10 2015 -0700
SAIO instructions: ensure ~/bin exists before copying into it
Change-Id: I16cd211b00b529ccc4b46f6b10497c32b6741896
commit c5c281ba6dd97a301ba80511e3356d6ca536d701
Author: Minwoo B <minwoob@us.ibm.com>
Date: Mon Apr 20 17:03:25 2015 -0500
Included step in development\_saio.rst for installing dependencies in requirements.txt.
Change-Id: I6ed1704148e5ae1e3164d10080c350d81856f7a9
commit 2203b46e3f14ef68a090aaea284f0a0442bbb86f
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit f6482bdece27144ee083a53d696469528d7940c2
Author: Thierry Carrez <thierry@openstack.org>
Date: Thu Apr 16 22:08:47 2015 +0200
Set default branch to stable/kilo
Open stable/kilo branch by setting defaultbranch for git-review.
Change-Id: I81bcda30f99173416eaaa3f1d42da32f3ab5b6d2
commit a2a5b6aa6664b61fa31d25f329426ff089372f17
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Apr 16 11:42:12 2015 -0700
Functional test for SLO PUT overwriting one of its own segments
Change-Id: I4855816848f4fdb148d0b82735cf79bc68429617
commit e4d326b5a7dd186d762726faa45733ff2900343d
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Thu Feb 19 17:38:10 2015 +0900
Fix conflict SLO reponse
This patch fixes Swift to respond "409 Conflict"
when a segment object path of the manifest on PUT SLO
is same as requested object path. It is because
the request will overwrite the segment and then it
will absolutely cause "409 Conflict" on GET SLO.
e.g.:
request:
PUT "http://hostname/v1/AUTH\_account/container/segment\_object\_00?multipart-manifest=put"
manifest file:
[{"path" : "container/segment\_object\_00", "etag" : "<etag of segment\_object\_00>", "size\_bytes" : <size of segment\_object\_00>},
{"path" : "container/segment\_object\_01", "etag" : "<etag of segment\_object\_01>", "size\_bytes" : <size of segment\_object\_01>},
{"path" : "container/segment\_object\_02", "etag" : "<etag of segment\_object\_02>", "size\_bytes" : <size of segment\_object\_02>}]
Change-Id: I4f4f7b9dbeb6a7c355b801c7e0ae560aa19a70b4
Closes-Bug: 1417936
commit 38ae7bb89c95292c171cb89c1d62859cee0cc24f
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Apr 15 23:03:21 2015 +0100
Make the reaper use same timestamp for replica deletes
The account reaper is using a unique timestamp when deleting
replicas of the same resource. This will result in unnecessary
replication traffic after reaping.
This patch makes the reaper use a single timestamp per resource.
Probe test is modified to check that delete times are equal
across replicas before replicators run.
test\_direct\_client.py is modified to check that it uses explicit
timestamp when passed to direct\_delete\_[object|container]
methods.
Drive-by bug fixes in the probe test e.g. it was not sending
X-Backend-Storage-Policy-Index when doing a direct GET to check
object state, so the 404s being verified could in fact be due
to diskfile not existing rather than diskfile being deleted.
Closes-Bug: 1442879
Change-Id: I8bab22d66308bb9d3294e1e0def017c784228423
commit 9c33bbde6923b26f111572ae967a3b97a8ab12f2
Author: Prashanth Pai <ppai@redhat.com>
Date: Tue Jan 20 12:14:32 2015 +0530
Allow rsync to use compression
From rsync's man page:
-z, --compress
With this option, rsync compresses the file data as it is sent to the
destination machine, which reduces the amount of data being transmitted --
something that is useful over a slow connection.
A configurable option has been added to allow rsync to compress, but only
if the remote node is in a different region than the local one.
NOTE: Objects that are already compressed (for example: .tar.gz, .mp3)
might slow down the syncing process.
On wire compression can also be extended to ssync later in a different
change if required. In case of ssync, we could explore faster
compression libraries like lz4. rsync uses zlib which is slow but offers
higher compression ratio.
Change-Id: Ic9b9cbff9b5e68bef8257b522cc352fc3544db3c
Signed-off-by: Prashanth Pai <ppai@redhat.com>

| **tags**: | added: in-feature-hummingbird |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-24:  [**Fix proposed to swift (feature/crypto)**](/swift/%2Bbug/1466549/comments/14) |  |  | [#14](/swift/%2Bbug/1466549/comments/14) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/205579>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/205579

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-24:  [**Fix merged to swift (feature/crypto)**](/swift/%2Bbug/1466549/comments/15) |  |  | [#15](/swift/%2Bbug/1466549/comments/15) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/swift/%2Bbug/1466549/comments/15/%2Bdownload) (80.5 KiB)

Reviewed: <https://review.openstack.org/205579>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=8ab46b64365b8eab80680f2562f81e8adb3032a3>

Submitter: Jenkins

Branch: feature/crypto

commit 89f705e8aab144092d40a13fc4ef19ffef5f3eba

Author: OpenStack Proposal Bot <email address hidden>

Date: Thu Jul 23 06:11:27 2015 +0000

Imported Translations from Transifex

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I94cf347564cb33977f33b1e64259bcb39a8cf809

commit a65e9db8752793ec37b594dc9eca5066171825db

Author: Christian Schwede <email address hidden>

Date: Wed Jul 22 10:43:17 2015 +0000

Removing commented out code in test/unit/account/test\_backend.py

Noticed this while reviewing another change. Looks like the test itself already

    ensures correct functionality of the reclaim() method in AccountBroker without

    the commented code, thus removing this stale code.

Change-Id: I6a26a7591adef9fd794ca68a4e9c493d1127f93c

commit 99d052772a9585e0befdfd292fd03aefde77180a

Author: Kota Tsuyuzaki <email address hidden>

Date: Mon Jul 13 01:12:43 2015 -0700

Fix 499 client disconnected on COPY EC object

Currently, a COPY request for an EC object might go to fail as 499 Client

    disconnected because of the difference between destination request content

    length and actual transferred bytes.

That is because the conditional response status and content length for

    an EC object range GET is handled at calling the response instance on

    proxy server. Therefore the calling response instance (resp()) will change

    the conditional status from 200 (HTTP\_OK) to 206 (PartialContent) and will

    change the content length for the range GET.

In EC case, sometimes Swift needs whole stored contents to decode a segment.

    It will make 200 HTTP OK response from object-server and proxy-server

    will unfortunately set whole content length to the destination content

    length and it makes the [bug 1467677](/bugs/1467677).

This patch introduces a new method "fix\_conditional\_response" for

    swift.common.swob.Response that calling \_response\_iter() and cached the

    iter in the Response instance. By calling it, Swift can set correct condtional

    response any time after setting whole content\_length to the response

    instance like EC case.

Change-Id: If85826243f955d2f03c6ad395215c73daab509b1

    Closes-Bug: #1467677

commit 62ed4f81ef80440550633eaaaa962a4f9383c2d3

Author: Timur Alperovich <email address hidden>

Date: Tue Jul 14 16:56:44 2015 -0700

Add two functional tests for delimiter.

The first test verifies that a delimiter will trim entries beyond the

    first matching instance of delimiter (after the given matching prefix,

    if any) and squash duplicates. So, when setting the delimiter

    to "-", given blobs "test", "test-foo" and "test-bar-baz", we expect

    only "test" (no matching delim) and "test-" (trim all characters after

    the first "-", and squash duplicates).

The second test verifies that when a prefix is provid...

Reviewed: https://review.openstack.org/205579
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=8ab46b64365b8eab80680f2562f81e8adb3032a3
Submitter: Jenkins
Branch: feature/crypto
commit 89f705e8aab144092d40a13fc4ef19ffef5f3eba
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 23 06:11:27 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I94cf347564cb33977f33b1e64259bcb39a8cf809
commit a65e9db8752793ec37b594dc9eca5066171825db
Author: Christian Schwede <cschwede@redhat.com>
Date: Wed Jul 22 10:43:17 2015 +0000
Removing commented out code in test/unit/account/test\_backend.py
Noticed this while reviewing another change. Looks like the test itself already
ensures correct functionality of the reclaim() method in AccountBroker without
the commented code, thus removing this stale code.
Change-Id: I6a26a7591adef9fd794ca68a4e9c493d1127f93c
commit 99d052772a9585e0befdfd292fd03aefde77180a
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jul 13 01:12:43 2015 -0700
Fix 499 client disconnected on COPY EC object
Currently, a COPY request for an EC object might go to fail as 499 Client
disconnected because of the difference between destination request content
length and actual transferred bytes.
That is because the conditional response status and content length for
an EC object range GET is handled at calling the response instance on
proxy server. Therefore the calling response instance (resp()) will change
the conditional status from 200 (HTTP\_OK) to 206 (PartialContent) and will
change the content length for the range GET.
In EC case, sometimes Swift needs whole stored contents to decode a segment.
It will make 200 HTTP OK response from object-server and proxy-server
will unfortunately set whole content length to the destination content
length and it makes the bug 1467677.
This patch introduces a new method "fix\_conditional\_response" for
swift.common.swob.Response that calling \_response\_iter() and cached the
iter in the Response instance. By calling it, Swift can set correct condtional
response any time after setting whole content\_length to the response
instance like EC case.
Change-Id: If85826243f955d2f03c6ad395215c73daab509b1
Closes-Bug: #1467677
commit 62ed4f81ef80440550633eaaaa962a4f9383c2d3
Author: Timur Alperovich <timur.alperovich@gmail.com>
Date: Tue Jul 14 16:56:44 2015 -0700
Add two functional tests for delimiter.
The first test verifies that a delimiter will trim entries beyond the
first matching instance of delimiter (after the given matching prefix,
if any) and squash duplicates. So, when setting the delimiter
to "-", given blobs "test", "test-foo" and "test-bar-baz", we expect
only "test" (no matching delim) and "test-" (trim all characters after
the first "-", and squash duplicates).
The second test verifies that when a prefix is provided, the delimiter
will trim entries beyond the first matching instance of the delimiter
\*after the given prefix\*. So "bar, "bazar" which both match the
prefix "ba" will be returned as "bar" (no delimiter after the matching
prefix) and "baza" (after matching the prefix the remainder after the
the \*next\* matching delimiter "a" is trimmed).
Change-Id: I49a2aa8722f83e87b7d211e5c26827e93963d92a
commit 2d6c5fe2afde382edb8f04c91fca1911601b61d9
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 21 09:56:13 2015 -0700
Fix Associated Projects link on Getting Started
Change-Id: I50be656bc5868242489f97c96a1feaef171933e0
commit cd7b2db550e41412281da0256b468c90ebcf3e8b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 21 19:23:00 2015 +0530
unit tests: Replace "self.assert\_" by "self.assertTrue"
The assert\_() method is deprecated and can be safely replaced by assertTrue().
This patch makes sure that running the tests does not create undesired
warnings.
Change-Id: I0602ba39ef93263386644ee68088d5f65fcb4a71
commit c3cc98b2c918476f1b54924e0c54e4c746eba4ac
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jul 20 17:03:20 2015 -0700
Add comment about ResumingGetter.used\_source\_etag
This confused a couple developers and took about ten minutes to
unravel in IRC; let's leave a clue for the next person.
Change-Id: I356c8c7a44de23f02eaf68d23a39c9eb4c203ff1
commit 06326d74657a8796439988115002298e4a5f4630
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jul 20 21:41:58 2015 +0530
Metaclass Python 3.x Compatibility
use "six.add\_metaclass" instead of "\_\_metaclass\_\_"
Change-Id: I57390fec40afe3a965be3215db8f79b9cf862a70
commit 317fa1af49d72ecaf7a9a499d8cdf00a086b4c6f
Author: Azhagu Selvan SP <tamizhgeek@gmail.com>
Date: Sat Jul 18 14:37:16 2015 +0530
Minor change in development saio setup doc
Make the test-requirements install command uniform with the rest of the
setup commands in the page by using the $HOME, instead of hardcoding
the folder path.
Change-Id: I8da7a191a301601e27f894f8268238d77b150ede
commit faff98efd47fd59e28b1adb3e7ad4bc3dc6dd781
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Thu Jul 9 07:35:47 2015 +0530
Replace python print operator with print function (pep H233, py33)
'print' function is compatible with 2.x and 3.x python versions
Link : https://www.python.org/dev/peps/pep-3105/
Python 2.6 has a \_\_future\_\_ import that removes print as language syntax,
letting you use the functional form instead
Change-Id: I9d9ca5766a2773a7b4071e280f00361d16b85383
commit 8753e452b04b0af6d6b444184b628724e14fbbb1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed May 27 18:01:37 2015 +0200
Replace StringIO with BytesIO for WSGI input
wsgi.input is a binary stream (bytes), not a text stream (unicode).
\* Replace StringIO with BytesIO for WSGI input
\* Replace StringIO('') with StringIO() and replace WsgiStringIO('') with
WsgiStringIO(): an empty string is already the default value
Change-Id: I09c9527be2265a6847189aeeb74a17261ddc781a
commit 6e70f3fa322da70c2a65fb919d200e52fc5add8a
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed May 27 17:27:47 2015 +0200
Get StringIO and cStringIO from six.moves
\* replace "from cStringIO import StringIO"
with "from six.moves import cStringIO as StringIO"
\* replace "from StringIO import StringIO"
with "from six import StringIO"
\* replace "import cStringIO" and "cStringIO.StringIO()"
with "from six import moves" and "moves.cStringIO()"
\* replace "import StringIO" and "StringIO.StringIO()"
with "import six" and "six.StringIO()"
This patch was generated by the stringio operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Change-Id: Iacba77fec3045f96773d1090c0bd48613729a561
commit 51f806d3e3d3a1fcbc80d2f7d7ddbe5cc4c024c9
Author: John Dickinson <me@not.mn>
Date: Tue Jul 14 20:49:08 2015 -0700
remove Python 2.6 from the classifier
Change-Id: I67233e9c7b69826242546bd6bd98c24b81070579
commit 278adf5c20101a191979ce1e4d6277e5f209149e
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jul 14 15:33:45 2015 +0900
Make logic of unit tests responsive to the method names
The two methods, test\_authorize\_succeeds\_for\_tenant\_name\_in\_roles and
test\_authorize\_succeeds\_for\_tenant\_id\_in\_roles, have names that don't
match what they are testing. tenant\_name and tenant\_id need to be
switched.
Change-Id: I7cb0a7d2b2111127fd5d6b55f2da6a3eadf2235d
commit 1cc3eff958fdd4fb07c2b74c52df7829d3125466
Author: Victor Stinner <vstinner@redhat.com>
Date: Fri Jul 10 13:04:44 2015 +0200
Fixes for mock 1.1
The new release of mock 1.1 is more strict. It helped to find bugs in
tests.
Closes-Bug: #1473369
Change-Id: Id179513c6010d827cbcbdda7692a920e29213bcb
commit ff192cfe5705324497a389aa2f22227d75dc0f8e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jul 8 18:38:22 2015 +0530
Replace reduce and unichr , these are no longer available in py3
\* Replace reduce() with six.moves.reduce()
\* Replace unichr with six.unichr
Change-Id: I2038e47e0a6522dd992fd2a4aeff981cf7750fe0
commit 4beceab4f4be99f14025815cf7ed4510ea77f460
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 9 06:14:56 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9ff1dde06be45fc7d6c441a1e1c07221f839a9a1
commit 56ee39a7e13417203c5e1816d7a3184a07f85826
Author: Matthew Oliver <matt@oliver.net.au>
Date: Thu Jul 9 15:19:32 2015 +1000
Ring builder code clean up follow up patch
This is a simple change that cleans up a NIT from Sam's 'stop moving
partitions unnecessarily when overload is on' patch.
Change-Id: I9d9f1cc23e2bb625d8e158f4d3f64e10973176a1
commit 6cafd0a4c0bb8f311fc59df580b42e801214effd
Author: Oshrit Feder <oshritf@il.ibm.com>
Date: Wed Jul 8 15:18:22 2015 +0300
Fix Container Sync example
Container-sync realm uses cluster\_ as a prefix to specify clusters'
names. At use, the prefix should not be included. Fixing the examples
and sample conf to make it clearer that only the name of the cluster
should be passed.
Change-Id: I2e521d86faffb59e1b45d3f039987ee023c5e939
commit 125238612f58481316db68d7087252bb7729f447
Author: Janie Richling <jrichli@us.ibm.com>
Date: Sat Jul 4 17:08:32 2015 -0500
Add CORS unit tests to base
In earlier versions of swift when a request was made with an
existing origin, but without any CORS settings in the container,
it was possible to get an unhandled exception due to a method call
on the "None" return of cors.get('allow\_origin', '').
Unit tests have been added to assert that this problem cannot go
undetected again.
Change-Id: Ia74896dabe1cf5a307c551b15a43ab1fd789c213
Fixes: bug 1468782
commit e87a74695e2f55dbb0e01721de9d46e230e36008
Author: John Dickinson <me@not.mn>
Date: Sat Jun 6 13:03:15 2015 -0700
add domain\_remap to /info
Also added the value of default\_reseller\_prefix to /info. I did not
add the reseller\_prefixes value to /info because deployers may not
want to expose all of the resellers that are available.
Change-Id: I9ca2f002dc395913bb646390d6908dfb8f554df1
commit 12473104f005b76ebe4b6dbe118a5ac37518eb52
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 7 18:02:53 2015 -0700
Cleanup error messages in ECDiskFileWriter.commit
I think the error messages make better sense and it's more obvious what the
error handling code was trying to bring to the surface for operators.
If you run this test with nosetests --verbose --nocapture
test\_diskfile.py:TestECDiskFile.test\_commit\_fsync\_dir\_raises\_DiskFileErrors
... you can review most of the potential log output
Change-Id: I40c9d77f44e087ee61d9642e924b0a4039d6ca9a
commit bd3717df65f57da9e7f06292ba349442d17fc939
Author: John Dickinson <me@not.mn>
Date: Thu Jul 2 09:54:30 2015 -0700
update AUTHORS file
Change-Id: I509ceeb522bd83c407beb40c22c2924a1d92b8ff
commit cd20961abd20f01a14554c14d4f61a7f0d8deb88
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Jul 5 10:59:50 2015 +0530
Replace dict.iteritems() with dict.items() in bin directory of swift.
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3.
Change-Id: I4bdc064c90bab56cd60f2dca2a5a78426ffbb31c
commit 8eca02d3a1db1e0ed68b15ed41bc62e6c89870c7
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:45:58 2015 +0530
Replace xrange() with six.moves.range()
xrange is no longer available in py3.
replacing xrange with range from six.moves
Change-Id: Ib863c316a0724bd9c4f53c2e5a8d1bcd42c4dc5a
commit 10f367224d5f30c3398169ffe3087f225f3343fc
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:05:36 2015 +0530
Fix Python 3 issues
\* Replace long with six.integer\_type
six.integer\_type :In Python 2, this is long and int, and in Python 3,
just int.
'long' is an undefined variable in py3.
Change-Id: Ibe4c5d0d81fe883f4fe33be93a68d814a228ad28
commit 2328983b7535d24d08942e62095b4346f2626566
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jun 24 17:07:32 2015 -0700
Stop moving partitions unnecessarily when overload is on.
When overload was on and in use, the ring builder was unnecessarily
moving partitions. It would converge on a good solution and settle
down eventually, but it moved more partitions than necessary along the
way.
There are three partition gatherers used in the ring builder:
dev-removed, dispersion, and weight, in that order. The dev-removed
gatherer will pick up all partitions on removed devices. The
dispersion gatherer picks up replicas of partitions that are
suboptimally dispersed. The weight gatherer picks up partitions on
devices which are overweight.
The weight gatherer was not overload-aware, so it would pick up
partitions that did not need to move. Consider a device that would
normally have 100 partitions assigned, assume we set overload to 0.1
so that this device will hold up to 110 (10 extra) for the sake of
dispersion, and assume the device actually has 104 partitions assigned
to it. The correct behavior is to gather nothing from this device
because it has fewer than the maximum. Prior to this commit, the
weight gatherer would remove 4 partitions from this device; they would
subsequently be reassigned by the overload-aware partition placer
(\_reassign\_parts()). In a ring with multiple overloaded devices, the
builder would pick up some partitions from each, shuffle them, and
then assign them back to those same devices. Obviously, this just
created extra replication work for no benefit.
Now, the weight gatherer takes overload into account, and will no
longer needlessly gather partitions.
That's not all, though; this change worsened the behavior of a ring
with more overload than necessary. Before, the ring would balance as
best it could, using the minimal amount of overload. With the
weight-gatherer change, the ring builder will stop gathering
partitions once a device reaches its maximum-permissible assignment
including overload.
For example, imagine a 3-replica, 4-zone ring with overload=0.2 and
weights:
z1: 100
z2: 60
z3: 60
z4: 60
Since z1 has more than 1/3 of the weight, z2, z3, and z4 must take
more than their fair share for the sake of dispersion.
Now, turn up the weights some:
z1: 100
z2: 80
z3: 80
z4: 80
Overload is no longer needed; this ring can balance. However, z2, z3,
and z4 would end up keeping more than their fair share since (a) they
already had extra due to earlier conditions, and (b) the weight
gatherer won't pick up partitions from them since they're not
overburdened once it takes overload into account.
To fix this, we compute the minimum overload factor required for
optimal dispersion and then use min(user-input-overload,
minimum-overload) during rebalance. This way, we don't overload
devices more than the user says, but if the user sets overload higher
than necessary, we'll still give the best balance possible.
Change-Id: If5666ba654ee25da54f9144f3b78840273a49627
commit ccf0758ef1f362312a6197f86455f680ebd990d3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 11 15:40:28 2015 -0700
Add ring-builder analyzer.
This is a tool to help developers quantify changes to the ring
builder. It takes a scenario (JSON file) describing the builder's
basic parameters (part\_power, replicas, etc.) and a number of
"rounds", where each round is a set of operations to perform on the
builder. For each round, the operations are applied, and then the
builder is rebalanced until it reaches a steady state.
The idea is that a developer observes the ring builder behaving
suboptimally, writes a scenario to reproduce the behavior, modifies
the ring builder to fix it, and references the scenario with the
commit so that others can see that things have improved.
I decided to write this after writing my fourth or fifth hacky one-off
script to reproduce some bad behavior in the ring builder.
Change-Id: I114242748368f142304aab90a6d99c1337bced4c
commit e860ec138913dc4c450725766a77e76a7101d06e
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 29 10:11:44 2015 +0000
Ignore invalid PIDs in swift-init
While reviewing ab9f6340 I recognized that invalid pids in the pid files raise
an exceptions (in case it is not a number), and also accept a 0 that is
impossible to use as a pid for any Swift process. In the latter case the process
was recognized as runnning, even if it did not - and thus restarting didn't
worked.
This patch ensures a better handling of any non-numeric value and also removes a
pid file if it uses 0 as the pid.
Change-Id: I09c415c7a75e4b9a0574a08f46f48fff5bb11d02
commit 0a6f2ab870a868e3036dbb212c0e7dd8375a39eb
Author: asettle <alexandra.settle@rackspace.com>
Date: Fri Jun 26 10:57:35 2015 +1000
Correcting minor grammatical errors
1. Removing unnecessary semi colon
2. Removing unnecessary content
Change-Id: Ie95403a4d96db2b8465e75495061fc059098c922
commit 4d4db054d35c7e9de9ed28ac24965e8408dd9f82
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Mon May 18 14:08:25 2015 -0500
After the .durable has been written, fsync the directory.
Added try-except statements in \_finalize\_durable() to fsync the directory
after a successful fsync of the .durable file.
Added test\_commit\_fsync\_dir\_raises\_DiskFileErrors() for testing whether
certain assertions hold for the change to include fsync\_dir().
Some more error details have been included in the logger.
Closes-Bug: #1470651
Change-Id: I4791d75ade8542678369ba0811ef39af6e955cc6
commit d4d7c0e1b11af8f20f965f410901a56e1f8ee69e
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jun 30 17:24:13 2015 -0700
Fix race in test\_server.TestObjectController.test\_PUT\_ssync\_multi\_frag
If the test ran across a one second boundary it would fail because while
the timestamp normalization was doing some rounding it was making no
attempt to reuse the same timestamp on subsequent requests.
Change-Id: Ic560032bcfacd6f0d10cfc0f4f10e5d6c2bc8dd5
commit a88bd6e6b9253b6488a2bf1a354ce29b51f37fe1
Author: ZhiQiang Fan <aji.zqfan@gmail.com>
Date: Sun Jun 28 22:04:46 2015 -0700
fix api overview document
The content about Object Storage HTTP requests constraints seems to
be a table but broken, this patch fixes it into correct rst table format.
Change-Id: I1b4c62da3e6d91add3ee0218707c1628c8f04b33
commit c95a0efe7973a660f4abcd13f4ea6211d72c4baa
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:44:10 2015 -0700
Make ssync\_sender a better HTTP client
When a server responses with an error - if that error includes a body - the
client should read the body. This cleans up some ugly eventlet/wsgi.server log
output related to chunked transfer disconnect (invalid literal for int() with
base 16).
Change-Id: Ibd06ddee9f216fce07fa33c3a7d8306b59eb6d77
Closes-Bug: #1466138
commit 44b76a1b1b83ac9563010f1ddfca5fca76e567bf
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Thu Jun 18 14:21:06 2015 -0500
EC Reconstructor: Do not reconstruct existing fragments.
The EC reconstructor needs to verify that the fragment needing to
be reconstructed does not reside in the collection of node responses.
Otherwise, resources will be spent unnecessarily reconstructing
the fragment. Moreover, this could cause a segfault on some backends.
This change adds the necessary verification steps to make sure
that a fragment will only be rebuilt in the case it is missing from
the other fragment archives.
Added some tests to provide coverage for these scenarios.
Change-Id: I91f3d4af52cbc66c9f7ce00726f247b5462e66f9
Closes-Bug: #1452553
commit d124ce5792d93e1efcdb083211ecef381f7b7173
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:35:07 2015 -0700
Fix ValueError in ssync\_receiver
httplib's putheader method will cast whatever you give it to a string.
where we allow the default dict.get default of None to be passed to
putheader unmodified ssync\_receiver is surpised that the non-empty
string isn't able to be converted to an integer.
We can avoid surprising the ssync\_receiver in this way by sending the
empty string as a better default.
Change-Id: Ie9df9927ff4d3dd3f334647f883b2937d0d81030
commit edfca861b6fa39972df276fb1f37aa81583a605d
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri Jun 26 08:54:22 2015 +0000
Increase httplib.\_MAXHEADERS
Python 2.7.9+ and 3.2.6+ limits the number of maximum headers in httplib to 100
[1,2,3]. This setting is too low for Swift.
By default the maximum number of allowed headers depends on the number of max
allowed metadata settings plus a default value of 32 for regular http headers.
If for some reason this is not enough (custom middleware for example) it can be
increased with the extra\_header\_count constraint.
[1] https://bugs.python.org/issue16037
[2] https://hg.python.org/cpython/raw-file/15c95b7d81dc/Misc/NEWS
[3] https://hg.python.org/cpython/raw-file/v3.2.6/Misc/NEWS
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Co-Authored-By: Thomas Herve <therve@redhat.com>
Change-Id: I388fd697ec88476024b0e9f1ae75ba35ff765282
commit 81ceee056de604d81a921280f453731eadf7be09
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jun 22 23:24:19 2015 -0700
Add one more test for ssync\_receiver
To prevent 409 conflict on a primary node during ssyncing,
ssync-receiver should add x-ssync-backend-frag-index generated from
x-ssync-backend-node-index of the SSYNC replication request header.
The change is done by previous work[1], but we need more test for that.
This patch addes one more assertion if the x-ssync-backend-frag-index
is in the ssync subrequest correctly.
\*BONUS\*
Fix some weird mock and add some sanities.
1: https://review.openstack.org/#/c/191521/
Change-Id: I27aff713c69017c0bc4c60b4833184e1285595d7
commit c2c1366b0794bcdbbbaef7fedaef2cab19cd8db8
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jun 24 21:07:16 2015 +0530
Fixed Errors in Swift-Form Post middleware section rst.
Inline markup cannot be nested in RST.
Fixing markups by using a single option for the whole line and making
some minor error corrections.
Change-Id: I42bfd7dfe5c93a69436ecc5d154f2e61ca83fa82
commit 514daea6317edc02587f7abfaae8770e1ef9cc4b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jun 12 23:40:51 2015 +0530
Fixed Formatting Error in Swift -Form Post middleware section.
Fixed Formatting error in ``action=”SWIFT\_URL``” => action=”``SWIFT\_URL``”
Change-Id: Id461129ef7f5b6412f94d36920c942a4181c0eb7
Closes-Bug: #1464740
commit e70b66586e13718e7ac0078c2f2cd1135c61a1f1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed Jun 24 09:36:37 2015 +0200
Replace dict.iteritems() with dict.items()
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3. According to a discussion on the openstack-dev mailing list,
the overhead of creating a temporary list using dict.items() on Python 2
is very low because most dictionaries are small:
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066391.html
Patch generated by the following command:
sed -i 's,iteritems,items,g' \
$(find swift -name "\*.py") \
$(find test -name "\*.py")
Change-Id: I6070bb6c684be76e8e77222a7d280ec6edd43496
commit e6165a7879d796efd3992260ef23a7f95ceeab32
Author: paul luse <paul.e.luse@intel.com>
Date: Mon May 25 14:41:42 2015 -0700
Add policy support to dispersion tools
Doesn't work for anything other than policy 0. updated to allow user
to specify policy name on cmd line (as with object-info) which
then makes populate/report work with 3x, 2x, or EC style policies
Change-Id: Ib7c298f0f6d666b1ecca25315b88539f45cf9f95
Closes-Bug: 1458688
commit e5c962a28ce99f01c6cd0b68b7434ddcd0e55f62
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon May 25 18:28:02 2015 +0200
Replace xrange() with six.moves.range()
Patch generated by the xrange operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Manual changes:
\* Fix indentation for pep8 checks
\* Fix TestGreenthreadSafeIterator.test\_access\_is\_serialized of
test.unit.common.test\_utils:
replace range(1, 11) with list(range(1, 11))
\* Fix UnsafeXrange docstring, revert change
Change-Id: Icb7e26135c5e57b5302b8bfe066b33cafe69fe4d
commit 4a5b851207c98a380a32e27a183dd98022be9d16
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 22 14:48:41 2015 +0200
Add note about updatedb to the docs
Change-Id: Ia1aa0bb1f93ee487e2f7ddf76a7a08efa8f3ba41
commit ac8a76958510646c369df9ffc2bf22005e43d153
Author: paul luse <paul.e.luse@intel.com>
Date: Sat Jun 13 11:03:56 2015 -0700
EC Ssync: Update parms to include node and frag indices
Previously we sent the ssync backend frag index based on the node
index. We need to be more specific for ssync to handle both sync
and revert cases so now we send the frag index based on the job
contents (as determined by the ec recon)) and the node index
as a new header based on, well, the node index.
The rcvr can now validate the incoming pair to reject (400) when
a primary node is being asked to accept fragments that don't
belong to it. Additionally, by having the frag index the
rcvr can reject (409) an attempt to accept a fragment when its
a handoff and already has one that needs to be reverted.
Fixes-bug: #1452619
Change-Id: I8287b274bbbd00903c1975fe49375590af697be4
commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
Closes-Bug: #1466549
commit df134df901a13c2261a8205826ea1aa8d75dc283
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu May 14 22:14:15 2015 -0700
Allow 1+ object-servers-per-disk deployment
Enabled by a new > 0 integer config value, "servers\_per\_port" in the
[DEFAULT] config section for object-server and/or replication server
configs. The setting's integer value determines how many different
object-server workers handle requests for any single unique local port
in the ring. In this mode, the parent swift-object-server process
continues to run as the original user (i.e. root if low-port binding
is required), binds to all ports as defined in the ring, and forks off
the specified number of workers per listen socket. The child, per-port
servers drop privileges and behave pretty much how object-server workers
always have, except that because the ring has unique ports per disk, the
object-servers will only be handling requests for a single disk. The
parent process detects dead servers and restarts them (with the correct
listen socket), starts missing servers when an updated ring file is
found with a device on the server with a new port, and kills extraneous
servers when their port is found to no longer be in the ring. The ring
files are stat'ed at most every "ring\_check\_interval" seconds, as
configured in the object-server config (same default of 15s).
Immediately stopping all swift-object-worker processes still works by
sending the parent a SIGTERM. Likewise, a SIGHUP to the parent process
still causes the parent process to close all listen sockets and exit,
allowing existing children to finish serving their existing requests.
The drop\_privileges helper function now has an optional param to
suppress the setsid() call, which otherwise screws up the child workers'
process management.
The class method RingData.load() can be told to only load the ring
metadata (i.e. everything except replica2part2dev\_id) with the optional
kwarg, header\_only=True. This is used to keep the parent and all
forked off workers from unnecessarily having full copies of all storage
policy rings in memory.
A new helper class, swift.common.storage\_policy.BindPortsCache,
provides a method to return a set of all device ports in all rings for
the server on which it is instantiated (identified by its set of IP
addresses). The BindPortsCache instance will track mtimes of ring
files, so they are not opened more frequently than necessary.
This patch includes enhancements to the probe tests and
object-replicator/object-reconstructor config plumbing to allow the
probe tests to work correctly both in the "normal" config (same IP but
unique ports for each SAIO "server") and a server-per-port setup where
each SAIO "server" must have a unique IP address and unique port per
disk within each "server". The main probe tests only work with 4
servers and 4 disks, but you can see the difference in the rings for the
EC probe tests where there are 2 disks per server for a total of 8
disks. Specifically, swift.common.ring.utils.is\_local\_device() will
ignore the ports when the "my\_port" argument is None. Then,
object-replicator and object-reconstructor both set self.bind\_port to
None if server\_per\_port is enabled. Bonus improvement for IPv6
addresses in is\_local\_device().
This PR for vagrant-swift-all-in-one will aid in testing this patch:
https://github.com/swiftstack/vagrant-swift-all-in-one/pull/16/
Also allow SAIO to answer is\_local\_device() better; common SAIO setups
have multiple "servers" all on the same host with different ports for
the different "servers" (which happen to match the IPs specified in the
rings for the devices on each of those "servers").
However, you can configure the SAIO to have different localhost IP
addresses (e.g. 127.0.0.1, 127.0.0.2, etc.) in the ring and in the
servers' config files' bind\_ip setting.
This new whataremyips() implementation combined with a little plumbing
allows is\_local\_device() to accurately answer, even on an SAIO.
In the default case (an unspecified bind\_ip defaults to '0.0.0.0') as
well as an explict "bind to everything" like '0.0.0.0' or '::',
whataremyips() behaves as it always has, returning all IP addresses for
the server.
Also updated probe tests to handle each "server" in the SAIO having a
unique IP address.
For some (noisy) benchmarks that show servers\_per\_port=X is at least as
good as the same number of "normal" workers:
https://gist.github.com/dbishop/c214f89ca708a6b1624a#file-summary-md
Benchmarks showing the benefits of I/O isolation with a small number of
slow disks:
https://gist.github.com/dbishop/fd0ab067babdecfb07ca#file-results-md
If you were wondering what the overhead of threads\_per\_disk looks like:
https://gist.github.com/dbishop/1d14755fedc86a161718#file-tabular\_results-md
DocImpact
Change-Id: I2239a4000b41a7e7cc53465ce794af49d44796c6
commit af72881d1dcc46486d8d652b92a0ec9aa9ca2bfa
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jun 15 13:36:36 2015 -0700
Use just IP, not port, when determining partition placement
In the ring builder, we place partitions with maximum possible
dispersion across tiers, where a "tier" is region, then zone, then
IP/port,then device. Now, instead of IP/port, just use IP. The port
wasn't really getting us anything; two different object servers on two
different ports on one machine aren't separate failure
domains. However, if someone has only a few machines and is using one
object server on its own port per disk, then the ring builder would
end up with every disk in its own IP/port tier, resulting in bad (with
respect to durability) partition placement.
For example: assume 1 region, 1 zone, 4 machines, 48 total disks (12
per machine), and one object server (and hence one port) per
disk. With the old behavior, partition replicas will all go in the one
region, then the one zone, then pick one of 48 IP/port pairs, then
pick the one disk therein. This gives the same result as randomly
picking 3 disks (without replacement) to store data on; it completely
ignores machine boundaries.
With the new behavior, the replica placer will pick the one region,
then the one zone, then one of 4 IPs, then one of 12 disks
therein. This gives the optimal placement with respect to durability.
The same applies to Ring.get\_more\_nodes().
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ibbd740c51296b7e360845b5309d276d7383a3742
commit 09e7477a391e7425af62a6516f43c69bc98b7080
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jun 15 22:10:45 2015 +0530
Replace it.next() with next(it) for py3 compat
The Python 2 next() method of iterators was renamed to \_\_next\_\_() on
Python 3. Use the builtin next() function instead which works on Python
2 and Python 3.
Change-Id: Ic948bc574b58f1d28c5c58e3985906dee17fa51d
commit 5ad369c1cb0f480b164a5b5e7eb194081835c266
Author: Victor Stinner <vstinner@redhat.com>
Date: Tue Jun 9 00:22:12 2015 +0200
Add six requirement
The six module is needed to add Python 3 support to Swift.
Change-Id: Ie637ed3458c7ff56c26834bca73203ed55604d74
commit 037a0c5dbe01a57b741d34988e21f4f763b6204b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jun 6 17:42:41 2015 +0530
Object are sorted and concatenated by swift in cardinal order.
Modified values in example in decimal to be more precise,
added a small description on Object are sorted and concatenated
by swift in cardinal order as a small phrase would be sufficient.
Change-Id: I914ded4e5726e50bb93b05759c3bfb76edda53ab
backport: none
Closes-Bug: #1383893
commit 11e5c4adf0e02c8fdab0d8584fc943d96e1165cd
Author: Koert van der Veer <koert@cloudvps.com>
Date: Tue Dec 16 11:15:19 2014 +0100
Allow default reseller prefix in domain\_remap middleware
Previously, the reseller prefix needed to be provided in the host name
even when the domain was unique to that reseller. With the
default\_reseller\_prefix, any domain which matches in this middleware,
will will be passed on with a reseller prefix, whether or not it was
provided.
Change-Id: I5aa5ce78ad1ee2e3660cce4c3e07306f8999f02a
Implements: blueprint domainremap-reseller-domains
commit c953e8cc9049e94cd01239d5e4a30a56f26a97d3
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Tue Apr 28 13:18:32 2015 -0500
The hash\_cleanup\_listdir function should only be called when necessary.
Introduced a conditional that will specify to \_finalize\_put() whether
the put() method is being called within the context of ECDiskFileWriter.
Included some unit tests that will test the number of calls to
hash\_cleanup\_listdir() during put(), commit(), and delete()
operations.
Change-Id: I287b2648591fdbf686898dc9047beda80a64da0c
commit 93de6c73e587a672663fa0997f439b73b336769c
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jun 2 17:00:42 2015 +0900
Add metadata size tests on the border
This patch adds a test for a 204 when a single metadata item in a POST causes
the backend aggregate constraints check to be on the border.
Background:
Overall metadata size constraint is enforced in the container and
account backends as well as in the proxy controllers.
Whereas the proxy controller can check that constraints are not exceeded
by a single PUT or POST request, the backend checks that constraints are not
exceeded by the aggregate of all PUTs and POSTs.
The change [1] added a test for a 400 when a single metadata item in
a POST causes the backend aggregate constraints check to go over limit.
[1] I1489e29686013cbd3d70283d8756b548aea3c2e1
Change-Id: Iac86ea71240ddde177e625c279c21aef67659d10
commit af734b3fb6fdbc11b8a0b775256e7642eb485b8d
Author: Mark Seger <Mark.Seger@hp.com>
Date: Wed Jun 3 08:16:06 2015 -0400
Change usage help and Attention messages to warnings
Change-Id: I1396aaffe36e739606f15f7fef37b11bd83f1fc1
commit 4f2ed8bcd0468f3b69d5fded274d8d6b02ac3d10
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri Mar 20 09:56:30 2015 -0700
EC: support multiple ranges for GET requests
This commit lets clients receive multipart/byteranges responses (see
RFC 7233, Appendix A) for erasure-coded objects. Clients can already
do this for replicated objects, so this brings EC closer to feature
parity (ha!).
GetOrHeadHandler got a base class extracted from it that treats an
HTTP response as a sequence of byte-range responses. This way, it can
continue to yield whole fragments, not just N-byte pieces of the raw
HTTP response, since an N-byte piece of a multipart/byteranges
response is pretty much useless.
There are a couple of bonus fixes in here, too. For starters, download
resuming now works on multipart/byteranges responses. Before, it only
worked on 200 responses or 206 responses for a single byte
range. Also, BufferedHTTPResponse grew a readline() method.
Also, the MIME response for replicated objects got tightened up a
little. Before, it had some leading and trailing CRLFs which, while
allowed by RFC 7233, provide no benefit. Now, both replicated and EC
multipart/byteranges avoid extraneous bytes. This let me re-use the
Content-Length calculation in swob instead of having to either hack
around it or add extraneous whitespace to match.
Change-Id: I16fc65e0ec4e356706d327bdb02a3741e36330a0
commit f1f4bb30cd8ad930ddb7a232b2744b48e35a0480
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Jun 2 19:51:39 2015 +0000
Fix testing issues
When functional tests are run in tox and an exception is raised when connecting
to Swift (for example: Swift not running, missing python-keystoneclient package
used by python-swiftclient) 0 tests are executed, but tox returns a success.
An exception is raised during tests, caused by a missing python-keystoneclient
in python-swiftclient. Instead of adding python-keystoneclient as a dependency
in python-swiftclient the package is added to the test-requirements.txt in Swift
itself. Note that adding python-keystoneclient to the test-requirements in
python-swiftclient is not sufficient (it's already in there).
The exception in setup\_package() is catched by the openstack.nose\_plugin, thus
disabling this plugin for now as well.
Also fixing two test errors seen on the gate regarding the tempurl middleware.
There was also an update to tox, environment variables were no longer passed
with versions >= 2.0 (http://tox.readthedocs.org/en/latest/changelog.html).
Swift test environment variables have been added to the passenv to re-enable the
former behavior, as well as environment variables required to pass proxy
settings.
This also led to skipped tempauth tests, and together with the missing
python-keystoneclient no tests were executed.
Related-Bug: 1461440
Related-Bug: 1455102
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Ideea071017d04912c60ed0bc76532adbb446c31d
commit 2759a6f159d4a90e4ad4c8e9e479085d195f8d14
Author: Pradeep Kumar Singh <pradeep.singh@nectechnologies.in>
Date: Wed May 13 21:18:02 2015 +0530
Handle Disk IO error Exception in swift account auditor
Swift account auditor fails to quarantine corrupt db due to
Disk IO error. This patch fixes that by handling Disk IO Error
Exception.
Closes-Bug:1169189
Change-Id: I031ee2a5775e4a88d4fb00d972d553936147c42e
commit 1bef06eec8f5f780914ac701d63f9c498b29119b
Author: Michael Barton <mike@weirdlooking.com>
Date: Sun May 31 23:10:15 2015 +0000
Don't quarantine on read\_metadata ENOENT
An operation that removes an existing .ts or .meta out from under another
concurrent operation at the right point can cause the whole object to be
needlessly quarantined.
Closes-Bug: #1451520
Change-Id: I37d660199e54411d0610889f9ee230b13747244b
commit 8b4af92dac813d707d124b3be37df586260fe74a
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Jun 1 17:57:25 2015 +0100
Tighten up overall metadata size tests
Overall metadata size constraint is enforced in the container and account
backends as well as in the proxy controllers. Whereas the proxy controller
can check that constraints are not exceeded by a single PUT or POST request,
the backend checks that constraints are not exceeded by the aggregate of all
PUTs and POSTs.
The current functional tests only exercise the proxy controller checks, since
they test for a 400 when sending excessive metadata in a single POST. This patch
adds a test for a 400 when a single metadata item in a POST causes the backend
aggregate constraints check to go over limit.
The extra coverage of the new assertions can be seen by modifying
swift/common/db.DatabasBroker.validate\_metadata() to always return None
immediately - only the new assertions fail when functests are run.
Change-Id: I1489e29686013cbd3d70283d8756b548aea3c2e1
commit b4c1d73ad56e0705d1c5dd1fc4f1d89b09fceff1
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 1 06:50:33 2015 +0000
Make swift-recon compatible for servers without storage policies
Swift recon introduced a new key for storage policies, and the CLI expected this
key in the server response. However, if one updates the CLI but not yet the
server an exception will be raised, because there is no default value and no
check if the key is included in the response.
This change checks if the policies key is included in the response and updates
one test to ensure backward compability.
Closes-Bug: 1453599
Change-Id: I7c7a90f9933bec2ab45595df9dc600a6cba65666
commit 38787d0fb5102e41b153e4629d2ef374a02965e9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:19:54 2015 -0700
Remove simplejson from staticweb
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This lets us get rid of some redundant Unicode encoding. Before, we
would take the container-listing response off the wire,
JSON-deserialize it (str -> unicode), then pass each of several fields
from each entry to get\_valid\_utf8\_str(), which would encode it,
(unicode -> str), decode it (str -> unicode), and then encode it again
(unicode -> str) for good measure.
The net effect was that each object's name would, in the proxy server,
go str -> unicode -> str -> unicode -> str.
By replacing simplejson with stdlib json, we get a guarantee that each
container-listing entry's name, hash, content\_type, and last\_modified
are unicodes, so we can stop worrying about them being valid UTF-8 or
not. This takes an encode and decode out of the path, so we just have
str -> unicode -> str. While it'd be ideal to avoid this, the first
transform (str -> unicode) happens when we decode the
container-listing response body (json.loads()), so there's no way out.
Change-Id: I00aedf952d691a809c23025b89131ea0f02b6431
commit 736cf54adf3ee85d2f473e5e5374f9833422967c
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu May 28 15:30:47 2015 -0700
Remove simplejson from tests
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This commit just takes simplejson out of the unit and functional
tests. They still pass.
Change-Id: I96f17df81fa5d265395a938b19213d2638682106
commit 68c30b80b47c281c549d101c43d79e718e91d21d
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu May 28 06:08:12 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I0c7b2bdb0edcc3bb3fa06903ec8457ca5e2dd688
commit 5374ba3a80a5b895542196502eac4d9300ba53d2
Author: John Dickinson <me@not.mn>
Date: Wed May 27 12:28:04 2015 -0700
drop Python 2.6 testing support
Change-Id: I78f21e5794e8ba7a095f03d279247516a241f555
commit 191f2a00bd9121fddc03d8f07f15e5e34790541e
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 16:39:23 2015 +0100
Remove \_ensure\_flush() from SSYNC receiver
The Receiver.\_ensure\_flush() method in ssync\_receiver.py has
the following comment:
Sends a blank line sufficient to flush buffers.
This is to ensure Eventlet versions that don't support
eventlet.minimum\_write\_chunk\_size will send any previous data
buffered.
If https://bitbucket.org/eventlet/eventlet/pull-request/37
ever gets released in an Eventlet version, we should make
this yield only for versions older than that.
The reference pull request was included with eventlet 0.14 [1] and
swift now requires >=0.16.1 so it is safe to remove \_ensure\_flush()
and save > 8k bytes per SSYNC response.
[1] https://bitbucket.org/eventlet/eventlet/commits/4bd654205a4217970a57a7c4802fed7ff2c8b770
Change-Id: I367e9a6e92b7ea75fe7e5795cded212657de57ed
commit 3aa06f185ac4256a8883c565bdc90b1ffbd519ca
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 09:17:46 2015 +0100
Make SSYNC receiver return a reponse when initial checks fail
The ssync Receiver performs some checks on request parameters
in initialize\_request() before starting the exchange of missing
hashes and updates e.g. the destination device must be available;
the policy must be valid. Currently if any of these checks fails
then the receiver just closes the connection, so the Sender gets
no useful response code and noise is generated in logs by httplib
and wsgi Exceptions.
This change moves the request parameter checks to the Receiver
constructor so that the HTTPExceptions raised are actually sent
as responses. (The 'connection close' exception handling still
applies once the 'missing\_check' and 'updates' handshakes are in
progress.)
Moving initialize\_request() revealed the following lurking bug:
\* initialize\_request() sets
req.environ['eventlet.minimum\_write\_chunk\_size'] = 0
\* this was previously ineffective because the Response environ
had already been copied from Request environ before this value
was set, so the Response never used the value :/
\* Now that it is effective (a good thing) it causes the empty string
yielded by the receiver when there are no missing hashes in
missing\_checks() to be sent to the sender immediately. This makes
the Sender.readline() think there has been an early disconnect
and raise an Exception (a bad thing), as revealed by
test/unit/obj/test\_ssync\_sender.py:TestSsync.test\_nothing\_to\_sync
The fix for this is to simply make the receiver skip sending the empty
string if there are no missing object\_hashes.
Change-Id: I036a6919fead6e970505dccbb0da7bfbdf8cecc3
commit bb716573ab5c8455348ec013feb894421e0e1f1c
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed May 20 00:39:41 2015 -0700
Allow SLO PUTs to forgo per-segment integrity checks
While manifests still require 'etag' and 'size\_bytes' fields for each
segment (to catch user errors like 'etaf' or 'size\_btyes'), an explicit
null for either will skip that particular integrity check and instead
use whatever value is retrieved when HEADing the segment. So, if a user
uploads a manifest like:
[{"path": "/con/obj\_seg\_1", "etag": null, "size\_bytes": 1048576},
{"path": "/con/obj\_seg\_2", "etag": "etag2", "size\_bytes": null},
{"path": "/con/obj\_seg\_3", "etag": null, "size\_bytes": null}]
then the etag will only be verified for the /con/obj\_seg\_2 segment,
and the segment size will only be verified for the /con/obj\_seg\_1
segment. However, the manifest that's ultimately stored (and can be
retrieved with a ?multipart-manifest=get query-string) will still look
like:
[{"name": "/con/obj\_seg\_1", "hash": "etag1", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_2", "hash": "etag2", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_3", "hash": "etag3", "bytes": 1234, ...}]
This allows the middleware to continue performing integrity checks on
object GET.
Change-Id: I2c4e585221387dd02a8679a50398d6b614407b12
DocImpact
commit a1c327022c70907ccc159d6203de26b37c3a4586
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:43:55 2015 -0700
Remove simplejson from swift-recon
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
All swift-recon was doing with json was decoding a JSON response (from
the recon middleware) and printing it to the terminal. This still
works just fine.
Change-Id: I28cf25a7c2856f230d4642c62fb8bf9c4d37e9e5
commit a3559edc2342e2cf92a5188336ab263ffd038554
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Apr 17 16:30:30 2015 -0700
Exclude local\_dev from sync partners on failure
If the primary left or right hand partners are down, the next best thing
is to validate the rest of the primary nodes. Where the rest should
exclude not just the left and right hand partners - but ourself as well.
This fixes a accidental noop when partner node is unavailable and
another node is missing data.
Validation:
Add probetests to cover ssync failures for the primary sync\_to nodes for
sync jobs.
Drive-by:
Make additional plumbing for the check\_mount and check\_dir constraints into
the remaining daemons.
Change-Id: I4d1c047106c242bca85c94b569d98fd59bb255f4
commit 666bf06c26bc9e0d6256d054835386e50e67b8a2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed May 6 16:29:06 2015 -0700
EC: don't 503 on marginally-successful PUT
On EC PUT in an M+K scheme, we require M+1 fragment archives to
durably land on disk. If we get that, then we go ahead and ask the
object servers to "commit" the object by writing out .durable
files. We only require 2 of those.
When we got exactly M+1 fragment archives on disk, and then one
connection timed out while writing .durable files, we should still be
okay (provided M is at least 3). However, we'd take our M > 2
remaining successful responses and pass that off to best\_response()
with a quorum size of M+1, thus getting a 503 even though everything
worked well enough.
Now we pass 2 to best\_response() to avoid that false negative.
There was also a spot where we were getting the quorum size wrong. If
we wrote out 3 fragment archives for a 2+1 policy, we were only
requiring 2 successful backend PUTs. That's wrong; the right number is
3, which is what the policy's .quorum() method says. There was a spot
where the right number wasn't getting plumbed through, but it is now.
Change-Id: Ic658a199e952558db329268f4d7b4009f47c6d03
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Closes-Bug: 1452468
commit e7c8c578d9e5b0aa7e56b02bd9c39baa99d2d6ae
Author: Michael MATUR <michael.matur@gmail.com>
Date: Mon May 25 15:13:01 2015 +0200
fixup!Patch of "parse\_content\_disposition" method to meet RFC2183
The spec of Content-Disposition does not require a space character after
comma: http://www.ietf.org/rfc/rfc2183.txt
Change-Id: Iff438dc36ce78c6a79bb66ab3d889a8dae7c0e1f
Closes-Bug: #1458497
commit af8d842076ba269fed7f4128d0c7503ab5d1a94a
Author: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Date: Tue Oct 21 09:24:25 2014 +0000
Replaced setting run\_pause with standard interval
The deprecated directive `run\_pause` should be replaced with the more
standard one `interval`. The `run\_pause` should be still supported for
backward compatibility. This patch updates object replicator to use
`interval` and support `run\_pause`. It also updates its sample config
and documentation.
Co-Authored-By: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Co-Authored-By: Kamil Rykowski <kamil.rykowski@intel.com>
Change-Id: Ie2a3414a96a94efb9273ff53a80b9d90c74fff09
Closes-Bug: #1364735
commit f11d92d566757a54ff1e3800ec0bfac098347a68
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri May 22 16:58:04 2015 -0700
Add swift-durability-calculator line to docs
This commits add a line (link and small doc) for
swift-durability-calculator which provides a browser based
durability calculation tool to docs as an associated project.
Change-Id: I4ea8015f512616dc25072080bef79b8734971ccf
commit f864092455ebcd40b3568633c3524cc5c64d3309
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed May 20 17:50:07 2015 -0700
Add Swift Inspector to assoicated projects
Change-Id: I5b5448674ea455119a51509ab5e7cd11a764b5a7
commit e54781a2aa29808aff654861d8a0aafd24b6620c
Author: Thiago da Silva <thiago@redhat.com>
Date: Tue May 19 20:27:06 2015 +0000
add object post and delete methods to BaseObjectController
Adding post and delete methods to BaseObjectController that can
be overriden by ObjectCOntroller subclasses. These methods are
similar to the PUT and GET methods that were introduced as part
of the EC work
Change-Id: I197364bc3e2f2287c0afc8948863e3cdeab90383
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit ab9f63402de6d554528699a02955854ac28264c5
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Mon Nov 24 21:44:03 2014 +0900
Add process name checking into swift-init
Swift-init uses pid files to detect existing swift processes by pid.
However, it mistakes an unrelated process for a swift process and makes
a wrong decision, when the unrelated process is running with pid written
in swift pid files.
This patch adds process name checking into swift-init and enable it to remove
invalid pid files in such situation.
Change-Id: Ibca026bdfbdacdd92c8763e1eb15d98293c70656
Closes-Bug: #1327106
commit aa4866eb6014d7fbb8531eb5d927d5611ebfd06d
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed May 13 20:10:59 2015 +0000
move replication code to ReplicatedObjectController
Moving \_connect\_put\_node, send\_file, \_transfer\_data and \_store\_object
methods to ReplicatedObjectController. Each one of these methods are
specific to replication policy. EC policy implements their own
version of them.
Of these four methods, only \_store\_object and \_connect\_put\_node are
required to be implemented by the policy specific Object Controllers.
Change-Id: Ifc72461b77dbfdaae9d63417f1286e8b5da3ca4e
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit 025c4c4339e7ace2f5be8cb3a3cddf6c38ceff37
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Apr 24 02:15:36 2015 -0700
Remove confusable query string on post as copy
Current post as copy routine (i.e. POST object with post\_as\_copy option
turned on) on Object Controller uses "multipart-manifest" query string
which is feeded to env['copy\_hook'] to decide which data (the manifest or
object pointed by the manifest) should be copied.
However, the way using the query string will confuse operators looking at
logging system (or analyzing the log) because whole POST object requests
have 'multipart-manifest=get' like as:
POST /v1/AUTH\_test/d4c816b24d38489082f5118599a67920/manifest-abcde%3Fmultipart-manifest%3Dget
We cannot know whether the query string was added by hand
(from user) or not. In addition, the query isn't needed by the
backend conversation between proxy-server and object-server.
(Just needed by "copy\_hook" on the proxy controller!)
To remove the confusable query string and to keep the log to be clean,
this patch introduces new environment variable "swift.post\_as\_copy"
and changes proxy controller and the copy\_hook to use the new env.
This item was originally discussed at
https://review.openstack.org/#/c/177132/
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: I0cd37520eea1825a10ebd27ccdc7e9162647233e
commit 98b725fec639c5501c645ce4e4dc9d12c686f91d
Author: Alistair Coles <alistair.coles@hp.com>
Date: Fri May 1 13:02:29 2015 +0100
Cleanup and extend end to end ssync tests
Extends the existing end to end ssync tests with
a test using replication policy.
Also some cleanup and improvements to the test framework e.g. rather
than faking the connection between sender and receiver, use a real
connection and wrap it to capture traffic for verification.
Change-Id: Id71d2eb3fb8fa15c016ef151aacf95f97196a902
commit 518262ab6ecd8faa2b915df118ffc70a30112a18
Author: paul luse <paul.e.luse@intel.com>
Date: Tue May 12 15:21:13 2015 -0700
Remove 1 line of dead code from EC reconstructor
Assuming nobody intentionally left this in here for some reason...
Change-Id: I4bf43bb3828e062c0342557243076ed62d6790f4
commit 29f4393d88426fd6c34f2cfe43a8c434bfad8d47
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri May 8 15:55:14 2015 -0700
Remove workaround for old eventlet version
Swift now requires eventlet >= 0.16.1, so we can get rid of this
workaround for a bug in eventlet 0.9.16.
Change-Id: I4a1200b9bd9266896a704a840fda0d1b720bc86d
commit 90b84d3a699811a99c97ebbe4f71a14d2f76a0e5
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri May 8 11:45:12 2015 -0700
Properly re-raise exceptions in proxy\_logging
Previously, this could encounter TypeErrors, presumably because
sys.exc\_clear() was called somewhere in the block of code between
catching the exception and re-raising.
Related-Bug: 1181146
Change-Id: Iadeea3f61e70bf83dc0eb063fdb27edd16f3ca32
commit 664a632c01f8c5c80826b223b9ade774bfe2ed9a
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 8 08:41:39 2015 +0200
Update my mailmap entry
Change-Id: I5d21a55d0fa4cab6eaa6ff426819aa1dc997de2f
commit 0b20a18e5216b991855c461e41e9ef32e17fadb4
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Thu May 7 13:16:15 2015 -0600
Spell "rebalance" right in swift-ring-builder.1
See Red Hat bug #1218269.
Change-Id: I814eb4b3c0821f5a8df5feea2bda3a964aace536
commit 1faad248f833735585aa8f6135babceb46fbb6f8
Author: Emmanuel Cazenave <contact@emcaz.fr>
Date: Tue May 5 12:31:22 2015 +0200
X-Auth-Token should be a bytestring.
Change-Id: I2aa941d74883e17e9548b0144a4a2e2db33aba95
Closes-Bug: 1451773
commit 55dd705a863c4500330cbd2b8c2fec46d618dc71
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Wed May 6 19:53:09 2015 +0200
Add missing statsd metrics section for object-reconstructor
Change-Id: Id3f98e5f637ff537a387262b40f21c05876fca91
commit c77c79b2c9b9ca7790c29577341cf36c5e9012cf
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue May 5 06:08:09 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9b0156c7fc315182d80604bf353586455bbc34d1
commit 94215049fd37f810ddf4e6b8122cce02aea3e6e3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon May 4 15:08:51 2015 -0700
Bump up a timeout in a test
Got a slow crappy VM like I do? You might see this fail
occasionally. Bump up the timeout a little to help it out.
Change-Id: I8c0e5b99012830ea3525fa55b0811268db3da2a2
commit 03536dbb55c219b94389e635babec2df2e2759fa
Author: Prashanth Pai <ppai@redhat.com>
Date: Wed Apr 29 12:11:59 2015 +0530
Fix incorrect passing of file object to fsync()
swift.common.utils.fsync() requires a file descriptor as argument
but file object handle was being passed.
Change-Id: I316b58f6bc37de0945eff551e4e50565653664f5
Signed-off-by: Prashanth Pai <ppai@redhat.com>
commit bfbc94c3cb34eb9ff288fb817dee667cc870d9eb
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Apr 28 10:45:50 2015 +0100
Fix intermittent container replicator test failure
Intermittent failure of this test could be due to
insufficient time elapsing between either the local
and remote db's being created or during the
debug\_timing calls. This patch forces greater timestamp
separation and forces debug\_timing to always log timings.
Also add message to the failign assertion so if this does
fail again we get some clue as to why.
Closes-Bug: 1369663
Change-Id: I4b69b2e759d586a14abd0931a68dbdf256d57c32
commit dbb9d4b7938f24ee588d260c9b51ca65d5095749
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Mon Apr 27 08:52:18 2015 +0200
Add missing docstring in direct\_client
Added a missing docstring to the direct\_delete\_container method.
Also checked other docstrings in the same file and fixed a wrong docstring
element in direct\_delete\_object. Added raises: docstring entry to all methods
that raise an Exception.
Change-Id: If463a0f9ddff3fe2d13f6d97fcfa955e91d0f01f
commit 8cdf0fdebe9eb782322fccfc11253dc959cf321d
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Apr 27 13:29:50 2015 -0700
Fix account replication during pre-storage-policy upgrade
Old account schemas don't send the storage\_policy\_index key for container rows
during replication, and if the recieving end is already running an upgraded
server it is surprised with a KeyError. Normally this would work itself out
if the old schema recieved any updates from container layer, or a new
container is created, or requires a row sync from another account database -
but if the account databases have rows out of sync and there's no activity in
the account otherwise, there's nothing to force the old schemas to be
upgraded.
Rather than force the old schema that already has a complete set of container
rows to migrate even in the absense of activity we can just fill in default
legacy value for the storage policy index and allow the accounts to get back
in sync and migrate the next time a container update occurs.
FWIW, I never able to get a cluster upgrade to get stuck in this state without
some sort of account failure that forced them to get their rows out of sync
(in my cause I just unlinked a pending and then made sure to force all my
account datbases to commit pending files before upgrading - leading to an
upgraded cluster that absolutly needed account-replication to solve a row
mismatch for inactive accounts with old schemas)
Closes-Bug #1424108
Change-Id: Iaf4ef834eb24f0e11a52cc22b93a864574fabf83
commit 03380380efb5d5c0b2a3acfaa64b486ee2cb6e64
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Apr 23 19:39:16 2015 -0700
Simplify ring.builder.RingBuilder.\_\_deepcopy\_\_
Only container classes (lists, sets, dicts, graphs, collections,
etc) need to track objects they deepcopy in the memo dict -
particularly when they may contain other containers! As they
recreate a new container with the same items as themselves, they'll
reference the memo for each item they contain before making a
deepcopy of it, and place a reference to the copied item into memo
after they do. Trying to help out some other container class in
this endeavor by attempting to add ourselves to the memo dict in
some useful manor on their behalf however; is not helpful.
All we need to do to make sure we're being a good \_\_deepcopy\_\_
implementation is make sure we pass on memo to our calls of deepcopy
so that other container classes can avoid making additional
deepcopy's of our containers if they already have a memorized copy
(which would be odd since unique instances of RingBuilders aren't
expected to share state, but hey - python doesn't have private
attributes so you never know!)
Change-Id: Ifac444dffbf79d650b2d858f6282e05d8ea741a0
commit 43ace3c62893364b6e3c130df56438995627598d
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 12:17:56 2015 -0700
Make RingBuilders deep-copy-able
We used to be able to deep-copy RingBuilder objects, but the addition
of debug logging (8d3b3b2) broke that since you can't deep-copy a
Python logger. This commit fixes that.
Swift doesn't really deep-copy RingBuilders anywhere, but third-party
code might.
Change-Id: If8bdadd93d9980db3d8a093f32d76ca604de9301
commit 215cd551df8be066edafd2a1e16d0bd143ec214b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Apr 21 17:38:04 2015 -0700
Bulk upload: treat user xattrs as object metadata
Currently, if you PUT a single object, then you can also associate
metadata with it by putting it in the request headers, prefixed with
"X-Object-Meta". However, if you're bulk-uploading objects, then you
have no way to assign any metadata.
The tar file format\* allows for arbitrary UTF-8 key/value pairs to be
associated with each file in an archive (as well as with the archive
itself, but we don't care about that here). If a file has extended
attributes, then tar will store those as key/value pairs.
This commit makes bulk upload read those extended attributes, if
present, and convert those to Swift object metadata. Attributes
starting with "user.meta" are converted to object metadata, and
"user.mime\_type"\*\* is converted to Content-Type.
For example, if you have a file "setup.py":
$ setfattr -n user.mime\_type -v "application/python-setup" setup.py
$ setfattr -n user.meta.lunch -v "burger and fries" setup.py
$ setfattr -n user.meta.dinner -v "baked ziti" setup.py
$ setfattr -n user.stuff -v "whee" setup.py
This will get translated to headers:
Content-Type: application/python-setup
X-Object-Meta-Lunch: burger and fries
X-Object-Meta-Dinner: baked ziti
Swift will handle xattrs stored by both GNU and BSD tar\*\*\*. Only
xattrs user.mime\_type and user.meta.\* are processed; others are
ignored.
This brings bulk upload much closer to feature-parity with non-bulk upload.
\* The POSIX 1003.1-2001 (pax) format, at least. There are a few
different, mutually-incompatible tar formats out there, because of
course there are. This is the default format on GNU tar 1.27.1 or
later.
\*\* http://standards.freedesktop.org/shared-mime-info-spec/latest/ar01s02.html#idm140622087713936
\*\*\* Even with pax-format tarballs, different encoders store xattrs
slightly differently; for example, GNU tar stores the xattr
"user.rubberducky" as pax header "SCHILY.xattr.user.rubberducky",
while BSD tar (which uses libarchive) stores it as
"LIBARCHIVE.xattr.user.rubberducky". One might wonder if this is
some programmer's attempt at job security.
Change-Id: I5e3ce87d31054f5239e86d47c45adbde2bb93640
commit f8dee761bd36f857aa1288c27e095907032fad68
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:15:35 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Note: This is part of importing of translations, there are no new
translations for this project, thus only the pot file gets updated.
Change-Id: I0cbfdae3bd1662da54c58e91a13f49419eba9b2d
commit cd7c58e93690fd25f5266754d0593c656dd51e2e
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Closes-Bug: 1446801
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 281cb1c210f0292bad190cabaae447145fa5eade
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Closes-Bug: 1446727
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit 51e31c5c7147f3ba61437e132b12b491ca718ce4
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Apr 15 15:31:06 2015 -0700
Don't apply the wrong Etag validation to rebuilt fragments
Because of the object-server's interaction with ssync sender's
X-Backend-Replication-Headers when a object (or fragment archive) is
pushed unmodified to another node it's ETag value is duped into the
recieving ends metadata as Etag. This interacts poorly with the
reconstructor's RebuildingECDiskFileStream which can not know ahead of
time the ETag of the fragment archive being rebuilt.
Don't send the Etag from the local source fragment archive being used as
the basis for the rebuilt fragent archive's metadata along to ssync.
Closes-Bug: 1446800
Change-Id: Ie59ad93a67a7f439c9a84cd9cff31540f97f334a
commit 2080f7dbd897d6130542dbf88e37641a41625eb5
Author: Alistair Coles <alistair.coles@hp.com>
Date: Thu Feb 26 15:16:22 2015 +0000
Fix tempauth acl checks when simplejson has no speedups
As documented in linked bug report, tempauth unit tests
were seen to fail on a system where simplejson was
installed but without the speedups extension. This
is because the tempauth account acl validation checks
that values are type str, but without the speedups
extension the json parser is returning unicode objects.
Fix is to have the acl validator tolerate those objects
being unicode or str.
Also change common/bufferedhttp.py to coerce ring device
to type str when constructing a path, in order to avoid
a UnicodeDecodeError when httplib sends a message that
has non-ascii header values.
Change-Id: I01524282cbaa25dc4b6dfa09f3f4723516cdba99
Closes-Bug: 1425776
commit 27f6fba5c3b9e0461d52c1deffe32130e7e9af51
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 0c391d6daffe1943f6def803db42e08e6d6846d2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 16:47:10 2015 -0700
SAIO instructions: ensure ~/bin exists before copying into it
Change-Id: I16cd211b00b529ccc4b46f6b10497c32b6741896
commit c5c281ba6dd97a301ba80511e3356d6ca536d701
Author: Minwoo B <minwoob@us.ibm.com>
Date: Mon Apr 20 17:03:25 2015 -0500
Included step in development\_saio.rst for installing dependencies in requirements.txt.
Change-Id: I6ed1704148e5ae1e3164d10080c350d81856f7a9
commit 2203b46e3f14ef68a090aaea284f0a0442bbb86f
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit f6482bdece27144ee083a53d696469528d7940c2
Author: Thierry Carrez <thierry@openstack.org>
Date: Thu Apr 16 22:08:47 2015 +0200
Set default branch to stable/kilo
Open stable/kilo branch by setting defaultbranch for git-review.
Change-Id: I81bcda30f99173416eaaa3f1d42da32f3ab5b6d2
commit a2a5b6aa6664b61fa31d25f329426ff089372f17
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Apr 16 11:42:12 2015 -0700
Functional test for SLO PUT overwriting one of its own segments
Change-Id: I4855816848f4fdb148d0b82735cf79bc68429617
commit e4d326b5a7dd186d762726faa45733ff2900343d
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Thu Feb 19 17:38:10 2015 +0900
Fix conflict SLO reponse
This patch fixes Swift to respond "409 Conflict"
when a segment object path of the manifest on PUT SLO
is same as requested object path. It is because
the request will overwrite the segment and then it
will absolutely cause "409 Conflict" on GET SLO.
e.g.:
request:
PUT "http://hostname/v1/AUTH\_account/container/segment\_object\_00?multipart-manifest=put"
manifest file:
[{"path" : "container/segment\_object\_00", "etag" : "<etag of segment\_object\_00>", "size\_bytes" : <size of segment\_object\_00>},
{"path" : "container/segment\_object\_01", "etag" : "<etag of segment\_object\_01>", "size\_bytes" : <size of segment\_object\_01>},
{"path" : "container/segment\_object\_02", "etag" : "<etag of segment\_object\_02>", "size\_bytes" : <size of segment\_object\_02>}]
Change-Id: I4f4f7b9dbeb6a7c355b801c7e0ae560aa19a70b4
Closes-Bug: 1417936
commit 38ae7bb89c95292c171cb89c1d62859cee0cc24f
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Apr 15 23:03:21 2015 +0100
Make the reaper use same timestamp for replica deletes
The account reaper is using a unique timestamp when deleting
replicas of the same resource. This will result in unnecessary
replication traffic after reaping.
This patch makes the reaper use a single timestamp per resource.
Probe test is modified to check that delete times are equal
across replicas before replicators run.
test\_direct\_client.py is modified to check that it uses explicit
timestamp when passed to direct\_delete\_[object|container]
methods.
Drive-by bug fixes in the probe test e.g. it was not sending
X-Backend-Storage-Policy-Index when doing a direct GET to check
object state, so the 404s being verified could in fact be due
to diskfile not existing rather than diskfile being deleted.
Closes-Bug: 1442879
Change-Id: I8bab22d66308bb9d3294e1e0def017c784228423
commit 7bdb8266d4b926526acdea22e8c9c634855eeecc
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed Mar 25 13:19:36 2015 +0000
Select policy when running functional test
Add ability to select a storage policy when running
the functional tests by defining the environment variable
SWIFT\_TEST\_POLICY.
This patch was first introduced by Janie Richling in
feature/ec: https://review.openstack.org/#/c/166097
Co-Authored-By: Janie Richling <jrichli@us.ibm.com>
Co-Authored-By: Christian Schwede <christian.schwede@enovance.com>
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Id96354546088df137def0ae7fd434baf64ed0c51
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit 9c33bbde6923b26f111572ae967a3b97a8ab12f2
Author: Prashanth Pai <ppai@redhat.com>
Date: Tue Jan 20 12:14:32 2015 +0530
Allow rsync to use compression
From rsync's man page:
-z, --compress
With this option, rsync compresses the file data as it is sent to the
destination machine, which reduces the amount of data being transmitted --
something that is useful over a slow connection.
A configurable option has been added to allow rsync to compress, but only
if the remote node is in a different region than the local one.
NOTE: Objects that are already compressed (for example: .tar.gz, .mp3)
might slow down the syncing process.
On wire compression can also be extended to ssync later in a different
change if required. In case of ssync, we could explore faster
compression libraries like lz4. rsync uses zlib which is slow but offers
higher compression ratio.
Change-Id: Ic9b9cbff9b5e68bef8257b522cc352fc3544db3c
Signed-off-by: Prashanth Pai <ppai@redhat.com>

| **tags**: | added: in-feature-crypto |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-05:  [**Re: Download DLO objects leak connections when client kill connection**](/swift/%2Bbug/1466549/comments/16) |  |  | [#16](/swift/%2Bbug/1466549/comments/16) |
| --- | --- | --- | --- |

Swift cores, can you answer comment #7 please ?

Swift cores, can you answer comment #7 please ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [clayg (clay-gerrard)](https://launchpad.net/~clay-gerrard) wrote on 2015-08-06: |  |  | [#17](/swift/%2Bbug/1466549/comments/17) |
| --- | --- | --- | --- |

yeah, <https://review.openstack.org/#/c/193303/> was the fix.

But it's really about the same as [https://bugs.launchpad.net/swift/+bug/667956](https://bugs.launchpad.net/swift/%2Bbug/667956) (i.e. slow resource exhaustion depending on your clients access patterns) and that was open for ages. I'm glad we fixed both of them...

So yeah, people that need to support a bunch of VOD clients that disconnect reading \*LO's should upgrade to the latest Swift or they will probably encounter this bug.

yeah, https://review.openstack.org/#/c/193303/ was the fix.
But it's really about the same as https://bugs.launchpad.net/swift/+bug/667956 (i.e. slow resource exhaustion depending on your clients access patterns) and that was open for ages. I'm glad we fixed both of them...
So yeah, people that need to support a bunch of VOD clients that disconnect reading \*LO's should upgrade to the latest Swift or they will probably encounter this bug.

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-08-26

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#18](/swift/%2Bbug/1466549/comments/18) |
| --- | --- | --- | --- |

Thanks clayg, so this issue can be abused, the fix should be backported and an OSSA issued.

Here is the proposed impact description:

Title: Swift proxy-server DoS through Large Object

Reporter: Romain LE DISEZ (OVH)

Products: Swift

Affects: versions through 2.3.0

Description:

Romain LE DISEZ from OVH reported a vulnerability in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. All Swift setup are affected.

Thanks clayg, so this issue can be abused, the fix should be backported and an OSSA issued.
Here is the proposed impact description:
Title: Swift proxy-server DoS through Large Object
Reporter: Romain LE DISEZ (OVH)
Products: Swift
Affects: versions through 2.3.0
Description:
Romain LE DISEZ from OVH reported a vulnerability in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. All Swift setup are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-08-27:  [**Fix proposed to swift (stable/kilo)**](/swift/%2Bbug/1466549/comments/19) |  |  | [#19](/swift/%2Bbug/1466549/comments/19) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/217750>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/217750

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-09-01

| Changed in swift: | |
| --- | --- |
| **milestone**: | none → 2.4.0 |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-09-23:  [**Re: Download DLO objects leak connections when client kill connection**](/swift/%2Bbug/1466549/comments/20) |  |  | [#20](/swift/%2Bbug/1466549/comments/20) |
| --- | --- | --- | --- |

It seems the bug is not really fixed but it is "moved". I know have sockets leak when a client stops a DLO download. Each interrupted DLO download leak one TCP socket. It applies on Linux, don't know if others OS are impacted.

How to reproduce, on a fresh SAIO on master, with processes just started:

1. Upload an object in DLO

    $ dd if=/dev/zero of=2x1G bs=1M count=2048

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing post test

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing upload test -S 1073741824 2x1G

2. In an other terminal, watch socket stats:

   $ while [ 1 ]; do grep ^TCP /proc/net/sockstat; sleep 1; done

(For now, you should see that the number of allocated sockets is stable, for me: alloc 45)

3. Start to download the object, but stop it before the end (eg: CTRL+C)

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing download test 2x1G --no-download

(Now, you should see one more allocated socket)

4. Repeat step 3 and observe the socket stacking

So, no more connections leak, but socket leak. Instead of few hours, it takes few days to exhaust server resources.

It seems the bug is not really fixed but it is "moved". I know have sockets leak when a client stops a DLO download. Each interrupted DLO download leak one TCP socket. It applies on Linux, don't know if others OS are impacted.
How to reproduce, on a fresh SAIO on master, with processes just started:
1. Upload an object in DLO
$ dd if=/dev/zero of=2x1G bs=1M count=2048
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing post test
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing upload test -S 1073741824 2x1G
2. In an other terminal, watch socket stats:
$ while [ 1 ]; do grep ^TCP /proc/net/sockstat; sleep 1; done
(For now, you should see that the number of allocated sockets is stable, for me: alloc 45)
3. Start to download the object, but stop it before the end (eg: CTRL+C)
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing download test 2x1G --no-download
(Now, you should see one more allocated socket)
4. Repeat step 3 and observe the socket stacking
So, no more connections leak, but socket leak. Instead of few hours, it takes few days to exhaust server resources.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-10-20:  [**Change abandoned on swift (stable/kilo)**](/swift/%2Bbug/1466549/comments/21) |  |  | [#21](/swift/%2Bbug/1466549/comments/21) |
| --- | --- | --- | --- |

Change abandoned by John Dickinson (<email address hidden>) on branch: stable/kilo

Review: <https://review.openstack.org/217750>

Reason: Abanoning based on the lack of activity since the last negative review. If you want to continue working on this, please reopen this patch.

Change abandoned by John Dickinson (me@not.mn) on branch: stable/kilo
Review: https://review.openstack.org/217750
Reason: Abanoning based on the lack of activity since the last negative review. If you want to continue working on this, please reopen this patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [clayg (clay-gerrard)](https://launchpad.net/~clay-gerrard) wrote on 2015-11-03:  [**Re: Download DLO objects leak connections when client kill connection**](/swift/%2Bbug/1466549/comments/22) |  |  | [#22](/swift/%2Bbug/1466549/comments/22) |
| --- | --- | --- | --- |

so is this the same as the lp [bug #1361360](/bugs/1361360) ?

so is this the same as the lp bug #1361360 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-11-04: |  |  | [#23](/swift/%2Bbug/1466549/comments/23) |
| --- | --- | --- | --- |

I don't think it is the same. [Bug #1361360](/bugs/1361360) describe the slowloris attack, where TCP connections are kept open for a long time if the client does not close the connection.

The behavior i'm observing is that when client close the connection, the TCP connection is closed, but the socket is not released. Also, it does not apply on standard downloads, but only on DLO downloads.

To be sure, i tried to set keepalive=False (and socket\_timeout=10): it didn't fix the problem.

I don't think it is the same. Bug #1361360 describe the slowloris attack, where TCP connections are kept open for a long time if the client does not close the connection.
The behavior i'm observing is that when client close the connection, the TCP connection is closed, but the socket is not released. Also, it does not apply on standard downloads, but only on DLO downloads.
To be sure, i tried to set keepalive=False (and socket\_timeout=10): it didn't fix the problem.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Grant Murphy (gmurphy)](https://launchpad.net/~gmurphy) wrote on 2015-11-17: |  |  | [#24](/swift/%2Bbug/1466549/comments/24) |
| --- | --- | --- | --- |

+1 impact description in comment #18

+1 impact description in comment #18

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-14:  [**Fix merged to swift (stable/kilo)**](/swift/%2Bbug/1466549/comments/25) |  |  | [#25](/swift/%2Bbug/1466549/comments/25) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/217750>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=036c2f348d24c01c7a4deba3e44889c45270b46d>

Submitter: Jenkins

Branch: stable/kilo

commit 036c2f348d24c01c7a4deba3e44889c45270b46d

Author: Samuel Merritt <email address hidden>

Date: Thu Jun 18 12:58:03 2015 -0700

Get better at closing WSGI iterables.

PEP 333 (WSGI) says: "If the iterable returned by the application has

    a close() method, the server or gateway must call that method upon

    completion of the current request[.]"

There's a bunch of places where we weren't doing that; some of them

    matter more than others. Calling .close() can prevent a connection

    leak in some cases. In others, it just provides a certain pedantic

    smugness. Either way, we should do what WSGI requires.

Noteworthy goofs include:

\* If a client is downloading a large object and disconnects halfway

        through, a proxy -> obj connection may be leaked. In this case,

        the WSGI iterable is a SegmentedIterable, which lacked a close()

        method. Thus, when the WSGI server noticed the client disconnect,

        it had no way of telling the SegmentedIterable about it, and so

        the underlying iterable for the segment's data didn't get

        closed.

Here, it seems likely (though unproven) that the object server

        would time out and kill the connection, or that a

        ChunkWriteTimeout would fire down in the proxy server, so the

        leaked connection would eventually go away. However, a flurry of

        client disconnects could leave a big pile of useless connections.

\* If a conditional request receives a 304 or 412, the underlying

        app\_iter is not closed. This mostly affects conditional requests

        for large objects.

The leaked connections were noticed by this patch's co-author, who

    made the changes to SegmentedIterable. Those changes helped, but did

    not completely fix, the issue. The rest of the patch is an attempt to

    plug the rest of the holes.

Co-Authored-By: Romain LE DISEZ <email address hidden>

Closes-Bug: #1466549

Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937

    (cherry picked from commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9

    with fixed import conflicts)

Reviewed: https://review.openstack.org/217750
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=036c2f348d24c01c7a4deba3e44889c45270b46d
Submitter: Jenkins
Branch: stable/kilo
commit 036c2f348d24c01c7a4deba3e44889c45270b46d
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Closes-Bug: #1466549
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
(cherry picked from commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
with fixed import conflicts)

| **tags**: | added: in-stable-kilo |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-14

| **summary**: | Download DLO objects leak connections when client kill connection+ (CVE-2016-0737) |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-20

| **summary**: | - Download DLO objects leak connections when client kill connection- (CVE-2016-0737)+ [OSSA 2016-004] Download DLO objects leak connections when client kill+ connection (CVE-2016-0737) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Related fix proposed to ossa (master)**](/swift/%2Bbug/1466549/comments/26) |  |  | [#26](/swift/%2Bbug/1466549/comments/26) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: <https://review.openstack.org/270241>

Related fix proposed to branch: master
Review: https://review.openstack.org/270241

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-20

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-28:  [**Related fix merged to ossa (master)**](/swift/%2Bbug/1466549/comments/27) |  |  | [#27](/swift/%2Bbug/1466549/comments/27) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270241>

Committed: <https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d>

Submitter: Jenkins

Branch: master

commit 606a18e718aed329a9d42d298e3119f0f1974e3d

Author: Tristan Cacqueray <email address hidden>

Date: Wed Jan 20 10:19:30 2016 -0500

Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)

Related-Bug: #1466549

    Related-Bug: #1493303

    Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

Reviewed: https://review.openstack.org/270241
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d
Submitter: Jenkins
Branch: master
commit 606a18e718aed329a9d42d298e3119f0f1974e3d
Author: Tristan Cacqueray <tdecacqu@redhat.com>
Date: Wed Jan 20 10:19:30 2016 -0500
Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)
Related-Bug: #1466549
Related-Bug: #1493303
Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

[See full activity log](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/swift/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/swift/%2Bbug/1466549/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

* [python-roundup #16037](http://bugs.python.org/issue16037)

  [2:3]
  [Edit](/bugs/1466549/%2Bwatch/116735 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from answers.launchpad.net_a1429db3_20250126_072226.html ===

[Log in / Register](https://answers.launchpad.net/swift/%2Blogin)

[![](https://launchpadlibrarian.net/52141984/os64.png)](https://launchpad.net/swift)

## [OpenStack Object Storage (swift)](https://launchpad.net/swift)

* [Overview](https://launchpad.net/swift)
* [Code](https://code.launchpad.net/swift)
* [Bugs](https://bugs.launchpad.net/swift)
* [Blueprints](https://blueprints.launchpad.net/swift)
* [Translations](https://translations.launchpad.net/swift)
* Answers

# Questions for OpenStack Object Storage (swift)

**Launchpad does not know where
OpenStack Object Storage (swift)
tracks support requests.**

OpenStack Object Storage (swift) questions are
tracked in:
[swift in Ubuntu](/ubuntu/%2Bsource/swift).

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_fd34c631_20250125_074928.html ===

[Log in / Register](https://launchpad.net/swift/%2Bmilestone/2.4.0/%2Blogin)

[![](https://launchpadlibrarian.net/52141984/os64.png)](https://launchpad.net/swift)

## [OpenStack Object Storage (swift)](https://launchpad.net/swift)

* [Overview](https://launchpad.net/swift)
* [Code](https://code.launchpad.net/swift)
* [Bugs](https://bugs.launchpad.net/swift)
* [Blueprints](https://blueprints.launchpad.net/swift)
* [Translations](https://translations.launchpad.net/swift)
* [Answers](https://answers.launchpad.net/swift)

# OpenStack Object Storage (swift) 2.4.0

## Milestone information

Project:
[OpenStack Object Storage (swift)](/swift)

Series:
[liberty](/swift/liberty)

Version:
2.4.0

Released:
2015-09-01

Registrant:
[Thierry Carrez](/~ttx)

Release registered:
2015-09-01

Active:
No. Drivers cannot target bugs and blueprints to this milestone.

[Download RDF metadata](https://launchpad.net/swift/liberty/2.4.0/%2Brdf)

## Activities

Assigned to you:
No blueprints or bugs assigned to you.

Assignees:
**2** [Alistair Coles](/~alistair-coles),
**1** [Andreas Jaeger](/~jaegerandi),
**1** [Andy McCrae](/~andrew-mccrae),
**1** [Atsushi SAKAI](/~sakaia),
**1** [Ben Martin](/~blmartin),
**1** [Bill Huber](/~wbhuber),
**1** [Charles Hsu](/~charles0126),
**4** [Christian Schwede](/~cschwede),
**1** [Clément Contini](/~ccontini),
**1** [Daisuke Morita](/~morita-daisuke),
**1** [Falk Reimann](/~falk-reimann),
**1** [Janie Richling](/~jrichli),
**1** [Jiri Suchomel](/~jsuchome),
**2** [Kamil Rykowski](/~kamil-rykowski),
**1** [Kazuhiro MIYAHARA](/~miyahara-kazuhiro),
**3** [Kota Tsuyuzaki](/~tsuyuzaki-kota),
**1** [Michael MATUR](/~michael-matur),
**2** [Minwoo Bae](/~minwoob),
**2** [Pradeep Kumar Singh](/~pradeep-singh-u),
**1** [Samuel Merritt](/~torgomatic),
**1** [Takashi Kajinami](/~kajinamit),
**1** [Victor Stinner](/~vstinner),
**3** [clayg](/~clay-gerrard),
**1** [kenichiro matsuda](/~matsuda-kenichi),
**1** [paul luse](/~paul-e-luse)

Blueprints:
No blueprints are targeted to this milestone.

Bugs:
**50**
Fix Released

## Download files for this release

After you've downloaded a file, you can verify its authenticity
using its MD5 sum or signature.
([How do I
verify a download?](/%2Bhelp-registry/verify-downloads.html))

| File | Description | Downloads |
| --- | --- | --- |
| download icon **[swift-2.4.0.tar.gz](https://launchpad.net/swift/liberty/2.4.0/%2Bdownload/swift-2.4.0.tar.gz "Swift 2.4.0 release (1.4 MiB)")** ([md5](https://launchpad.net/swift/liberty/2.4.0/%2Bdownload/swift-2.4.0.tar.gz/%2Bmd5), [sig](https://launchpad.net/swift/liberty/2.4.0/%2Bdownload/swift-2.4.0.tar.gz.asc)) | Swift 2.4.0 release | 209  last downloaded **9 days ago** |
| Total downloads: | | 209 |
| --- | --- | --- |

## Release notes

This is Swift 2.4.0 release.

## Changelog

*This release does not have a changelog.*

## 0 blueprints and 50 bugs targeted

| Bug report | | | | Importance | Assignee | Status |
| --- | --- | --- | --- | --- | --- | --- |
| 1424108 | #1424108 | [KeyError: 'storage\_policy\_index' in \_really\_merge\_items swift/account/backend.py](https://bugs.launchpad.net/bugs/1424108) |  | 2 Critical | [clayg](/~clay-gerrard) | 10 Fix Released |
| 1449212 | #1449212 | [Container level temp URLs can unintentionally leak data.](https://bugs.launchpad.net/bugs/1449212) |  | 2 Critical |  | 10 Fix Released |
| 1452553 | #1452553 | [Skip over extra fragments that are not useful to reconstruct](https://bugs.launchpad.net/bugs/1452553) |  | 2 Critical | [Minwoo Bae](/~minwoob) | 10 Fix Released |
| 1453948 | #1453948 | [[OSSA 2015-016] all PUT tempurls leak existence via DLO manifest attack (CVE-2015-5223)](https://bugs.launchpad.net/bugs/1453948) |  | 2 Critical |  | 10 Fix Released |
| 1467677 | #1467677 | [Server side copy with Single Ranged read not working with Erasure Coded Data](https://bugs.launchpad.net/bugs/1467677) |  | 2 Critical | [Kota Tsuyuzaki](/~tsuyuzaki-kota) | 10 Fix Released |
| 1446727 | #1446727 | [Bump PyECLib version from 1.0.3 to 1.0.7](https://bugs.launchpad.net/bugs/1446727) |  | 3 High |  | 10 Fix Released |
| 1466138 | #1466138 | [EC reconstructor (ssync\_sender) got exceptions while send request to object-server and disk already umount](https://bugs.launchpad.net/bugs/1466138) |  | 3 High | [clayg](/~clay-gerrard) | 10 Fix Released |
| 1181146 | #1181146 | [TypeError: exceptions must be old-style classes or derived from BaseException, not NoneType](https://bugs.launchpad.net/bugs/1181146) |  | 4 Medium | [Samuel Merritt](/~torgomatic) | 10 Fix Released |
| 1446801 | #1446801 | [Use reconstruct insetad of decode/encode](https://bugs.launchpad.net/bugs/1446801) |  | 4 Medium |  | 10 Fix Released |
| 1464142 | #1464142 | [when ssync or the object-server get disconnected it should warn with a more ascetically pleasing message instead of a traceback](https://bugs.launchpad.net/bugs/1464142) |  | 4 Medium | [clayg](/~clay-gerrard) | 10 Fix Released |
| 1470576 | #1470576 | [mount\_check does not prevent writing to root mount](https://bugs.launchpad.net/bugs/1470576) |  | 4 Medium | [Ben Martin](/~blmartin) | 10 Fix Released |
| 1489587 | #1489587 | [Reconstruction error](https://bugs.launchpad.net/bugs/1489587) |  | 4 Medium |  | 10 Fix Released |
| 1468298 | #1468298 | [Reconstructor remaining time is incorrect, because total jobs number is increase continually](https://bugs.launchpad.net/bugs/1468298) |  | 5 Low | [Charles Hsu](/~charles0126) | 10 Fix Released |
| 1428866 | #1428866 | [swift-object-info display for sysmeta](https://bugs.launchpad.net/bugs/1428866) |  | 6 Wishlist | [Kamil Rykowski](/~kamil-rykowski) | 10 Fix Released |
| 1169189 | #1169189 | [Swift account auditor fails to quarantine corrupt db](https://bugs.launchpad.net/bugs/1169189) |  | 1 Undecided | [Pradeep Kumar Singh](/~pradeep-singh-u) | 10 Fix Released |
| 1258392 | #1258392 | [swift list --total is running without -l or without --ls](https://bugs.launchpad.net/bugs/1258392) |  | 1 Undecided | [Jiri Suchomel](/~jsuchome) | 10 Fix Released |
| 1327106 | #1327106 | [Swift-init mistakes an unrelated process for a swift process, which starts with the same pid](https://bugs.launchpad.net/bugs/1327106) |  | 1 Undecided | [Takashi Kajinami](/~kajinamit) | 10 Fix Released |
| 1364735 | #1364735 | [change run\_pause setting to interval where applicable](https://bugs.launchpad.net/bugs/1364735) |  | 1 Undecided | [Kamil Rykowski](/~kamil-rykowski) | 10 Fix Released |
| 1369663 | #1369663 | [test\_sync\_remote\_with\_timings fails with missing debug](https://bugs.launchpad.net/bugs/1369663) |  | 1 Undecided | [Alistair Coles](/~alistair-coles) | 10 Fix Released |
| 1383893 | #1383893 | [Documentation bug on Dynamic Large Object Support - Direct API section](https://bugs.launchpad.net/bugs/1383893) |  | 1 Undecided |  | 10 Fix Released |
| 1417936 | #1417936 | ["201 Created" PUT response when a SLO segment is overwritten by the manifest](https://bugs.launchpad.net/bugs/1417936) |  | 1 Undecided | [Kazuhiro MIYAHARA](/~miyahara-kazuhiro) | 10 Fix Released |
| 1425776 | #1425776 | [ACL tests fails on fresh Ubuntu 14.04](https://bugs.launchpad.net/bugs/1425776) |  | 1 Undecided | [Christian Schwede](/~cschwede) | 10 Fix Released |
| 1439816 | #1439816 | [If PID file becomes empty, swift-init throws exception](https://bugs.launchpad.net/bugs/1439816) |  | 1 Undecided |  | 10 Fix Released |
| 1442879 | #1442879 | [reaper doesn't use the same tombstone timestamp](https://bugs.launchpad.net/bugs/1442879) |  | 1 Undecided | [Alistair Coles](/~alistair-coles) | 10 Fix Released |
| 1444327 | #1444327 | [String not translatable in swift/common/manager.py](https://bugs.launchpad.net/bugs/1444327) |  | 1 Undecided | [Andreas Jaeger](/~jaegerandi) | 10 Fix Released |
| 1451520 | #1451520 | [race condition quarantines valid objects](https://bugs.launchpad.net/bugs/1451520) |  | 1 Undecided |  | 10 Fix Released |
| 1451773 | #1451773 | [UnicodeDecodeError in functional tests with python 2.6 and keystone v2](https://bugs.launchpad.net/bugs/1451773) |  | 1 Undecided |  | 10 Fix Released |
| 1452468 | #1452468 | [ec PUT post commit response is to quick](https://bugs.launchpad.net/bugs/1452468) |  | 1 Undecided |  | 10 Fix Released |
| 1452619 | #1452619 | [object-reconstructor crash in ssync\_sender](https://bugs.launchpad.net/bugs/1452619) |  | 1 Undecided |  | 10 Fix Released |
| 1453599 | #1453599 | [Swift recon does not work in kilo (quarantine check)](https://bugs.launchpad.net/bugs/1453599) |  | 1 Undecided | [Andy McCrae](/~andrew-mccrae) | 10 Fix Released |
| 1453807 | #1453807 | [Post (not as copy) to SLO manifest destroys its state as a manifest](https://bugs.launchpad.net/bugs/1453807) |  | 1 Undecided | [Kota Tsuyuzaki](/~tsuyuzaki-kota) | 10 Fix Released |
| 1455102 | #1455102 | [some test jobs broken by tox 2.0 not passing env variables](https://bugs.launchpad.net/bugs/1455102) |  | 1 Undecided | [Christian Schwede](/~cschwede) | 10 Fix Released |
| 1457262 | #1457262 | [handoffs\_first should log warning](https://bugs.launchpad.net/bugs/1457262) |  | 1 Undecided | [Pradeep Kumar Singh](/~pradeep-singh-u) | 10 Fix Released |
| 1458497 | #1458497 | [Withspace after comma in parse\_content\_disposition method](https://bugs.launchpad.net/bugs/1458497) |  | 1 Undecided | [Michael MATUR](/~michael-matur) | 10 Fix Released |
| 1458688 | #1458688 | [dispersion populate/report is not policy aware](https://bugs.launchpad.net/bugs/1458688) |  | 1 Undecided | [paul luse](/~paul-e-luse) | 10 Fix Released |
| 1461440 | #1461440 | [Tests are not run, but reported as success](https://bugs.launchpad.net/bugs/1461440) |  | 1 Undecided | [Christian Schwede](/~cschwede) | 10 Fix Released |
| 1466549 | #1466549 | [[OSSA 2016-004] Download DLO objects leak connections when client kill connection (CVE-2016-0737)](https://bugs.launchpad.net/bugs/1466549) |  | 1 Undecided |  | 10 Fix Released |
| 1468374 | #1468374 | [swift dispersion does not support keystone auth v3](https://bugs.launchpad.net/bugs/1468374) |  | 1 Undecided | [Falk Reimann](/~falk-reimann) | 10 Fix Released |
| 1468782 | #1468782 | [Swift proxy crashes on CORS request](https://bugs.launchpad.net/bugs/1468782) |  | 1 Undecided | [Janie Richling](/~jrichli) | 10 Fix Released |
| 1469951 | #1469951 | [swift-object-info uses wrong policy for calculating while no full data path in the coomand](https://bugs.launchpad.net/bugs/1469951) |  | 1 Undecided | [Daisuke Morita](/~morita-daisuke) | 10 Fix Released |
| 1470651 | #1470651 | [Directory needs to be fsync'd, after .durable has been written.](https://bugs.launchpad.net/bugs/1470651) |  | 1 Undecided | [Minwoo Bae](/~minwoob) | 10 Fix Released |
| 1472201 | #1472201 | [EC GET makes a "Client disconnected on read" warning](https://bugs.launchpad.net/bugs/1472201) |  | 1 Undecided | [Kota Tsuyuzaki](/~tsuyuzaki-kota) | 10 Fix Released |
| 1473369 | #1473369 | [new mock release broke a bunch of unit tests](https://bugs.launchpad.net/bugs/1473369) |  | 1 Undecided | [Victor Stinner](/~vstinner) | 10 Fix Released |
| 1477283 | #1477283 | [project\_id and user\_id are empty in ceilometer storage.objects.outgoing.bytes for dlo objects](https://bugs.launchpad.net/bugs/1477283) |  | 1 Undecided | [Clément Contini](/~ccontini) | 10 Fix Released |
| 1477877 | #1477877 | [Fix six typos on swift documentation](https://bugs.launchpad.net/bugs/1477877) |  | 1 Undecided | [Atsushi SAKAI](/~sakaia) | 10 Fix Released |
| 1479972 | #1479972 | [HUP signal doesn't shutdown wsgi servers](https://bugs.launchpad.net/bugs/1479972) |  | 1 Undecided |  | 10 Fix Released |
| 1481623 | #1481623 | [Shebang of several commands is "#!/usr/bin/python"](https://bugs.launchpad.net/bugs/1481623) |  | 1 Undecided | [kenichiro matsuda](/~matsuda-kenichi) | 10 Fix Released |
| 1482096 | #1482096 | [swift-ring-builder sometimes uses .builder file when given .ring.gz and vice versa](https://bugs.launchpad.net/bugs/1482096) |  | 1 Undecided | [Christian Schwede](/~cschwede) | 10 Fix Released |
| 1483705 | #1483705 | [testCopyDestinationSlashProblems functional test fails](https://bugs.launchpad.net/bugs/1483705) |  | 1 Undecided |  | 10 Fix Released |
| 1484565 | #1484565 | ["Quorum" on durable response is too low](https://bugs.launchpad.net/bugs/1484565) |  | 1 Undecided | [Bill Huber](/~wbhuber) | 10 Fix Released |

## Related milestones and releases

* [View
  milestones for
  OpenStack Object Storage (swift)](https://launchpad.net/swift/%2Bmilestones)
* [View
  milestones for
  OpenStack](https://launchpad.net/openstack/%2Bmilestones)
* [View
  releases for the
  OpenStack Object Storage (swift)
  liberty
  series](/swift/liberty)

This milestone
contains **Public** information
Everyone can see this information.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugs.launchpad.net_d8fa4600_20250125_074927.html ===

[Log in / Register](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Blogin)

[![](https://launchpadlibrarian.net/52141984/os64.png)](https://launchpad.net/swift)

## [OpenStack Object Storage (swift)](https://launchpad.net/swift)

* [Overview](https://launchpad.net/swift)
* [Code](https://code.launchpad.net/swift)
* [Bugs](https://bugs.launchpad.net/swift)
* [Blueprints](https://blueprints.launchpad.net/swift)
* [Translations](https://translations.launchpad.net/swift)
* [Answers](https://answers.launchpad.net/swift)

# [OSSA 2016-004] Download DLO objects leak connections when client kill connection (CVE-2016-0737)

Bug #1466549 reported by
[Romain LE DISEZ](https://launchpad.net/~rledisez)
on 2015-06-18

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Object Storage (swift)](https://bugs.launchpad.net/swift) | Fix Released | Undecided | Unassigned | [OpenStack Object Storage (swift) 2.4.0](https://launchpad.net/swift/%2Bmilestone/2.4.0) |
| Nominated for Juno by [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | | | | | |
| Nominated for Kilo by [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | | | | | |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |

### Bug Description

When a client is downloading a DLO object, if it interrupts its connection, the proxy does not close the connection to the object server

From my test, this bug impacts versions 1.10, 2.2.2 and master.

I flag this bug security vulnerability because it makes it easy to do a DoS on a proxy-server. It's actually what's happening to us because one of our user do VoD. It uses DLO a lot and close connections when his customers stop watching video.

How to reproduce on a fresh SAIO, with processes just started:

1. Upload an object in DLO

    $ dd if=/dev/zero of=2x1G bs=1M count=2048

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing post test

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing upload test -S 1073741824 2x1G

2. In an other terminal, watch connections between proxy-server and object-server:

   $ watch -n 1 "netstat -tapn | grep -E ':60[1-4]0' | grep ESTA"

(For now, you should see no connections)

3. Start to download the object, but stop it before the end (eg: CTRL+C)

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing download test 2x1G --no-download

(Now, you should see one connection)

4. Repeat step 3 and observe the connections stacking

Tags:

[in-feature-crypto](/swift/%2Bbugs?field.tag=in-feature-crypto)
[in-feature-hummingbird](/swift/%2Bbugs?field.tag=in-feature-hummingbird)
[in-stable-kilo](/swift/%2Bbugs?field.tag=in-stable-kilo)

## CVE References

* [2016-0737](/bugs/cve/2016-0737 "OpenStack Object Storage (Swift) befo...")
* [2016-0738](/bugs/cve/2016-0738 "OpenStack Object Storage (Swift) befo...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-18: |  |  | [#1](/swift/%2Bbug/1466549/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-06-18: |  |  | [#2](/swift/%2Bbug/1466549/comments/2) |
| --- | --- | --- | --- |

Based on <https://www.python.org/dev/peps/pep-0333/#specification-details>

"If the iterable returned by the application has a close() method, the server or gateway must call that method upon completion of the current request, whether the request was completed normally, or terminated early due to an error. (This is to support resource release by the application. This protocol is intended to complement PEP 325 's generator support, and other common iterables with close() methods."

here is a fix proposal : <https://review.openstack.org/#/c/193192/>

It passes all tests, but I'm not very familiar with wsgi. So i don't know all the implications of adding a close() method.

Based on https://www.python.org/dev/peps/pep-0333/#specification-details
"If the iterable returned by the application has a close() method, the server or gateway must call that method upon completion of the current request, whether the request was completed normally, or terminated early due to an error. (This is to support resource release by the application. This protocol is intended to complement PEP 325 's generator support, and other common iterables with close() methods."
here is a fix proposal : https://review.openstack.org/#/c/193192/
It passes all tests, but I'm not very familiar with wsgi. So i don't know all the implications of adding a close() method.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-06-18: |  |  | [#3](/swift/%2Bbug/1466549/comments/3) |
| --- | --- | --- | --- |

Eventually the object server will time out the connection, right? I mean, immediately after killing the client -> proxy connection, you'll see what appears to be a leaked connection from proxy -> obj, but if you wait a few minutes, the object server will time out and close the connection from its end.

Eventually the object server will time out the connection, right? I mean, immediately after killing the client -> proxy connection, you'll see what appears to be a leaked connection from proxy -> obj, but if you wait a few minutes, the object server will time out and close the connection from its end.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-06-18: |  |  | [#4](/swift/%2Bbug/1466549/comments/4) |
| --- | --- | --- | --- |

It might need more testing, but i didn't observe any connection timeout-ing.

On production, we see that leaked connections continue increasing for many hours, until the proxy cannot treat connections anymore. On my SAIO, after more than 20 minutes, connections were still not closed.

It might need more testing, but i didn't observe any connection timeout-ing.
On production, we see that leaked connections continue increasing for many hours, until the proxy cannot treat connections anymore. On my SAIO, after more than 20 minutes, connections were still not closed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-06-18: |  |  | [#5](/swift/%2Bbug/1466549/comments/5) |
| --- | --- | --- | --- |

This bug report should probably be marked as public since there's a patch in Gerrit referencing it.

For reference, when filing a security bug, attach patches to the LP bug, not in Gerrit. This is probably the only case where attaching patches to LP bugs is better than filing in Gerrit.

This bug report should probably be marked as public since there's a patch in Gerrit referencing it.
For reference, when filing a security bug, attach patches to the LP bug, not in Gerrit. This is probably the only case where attaching patches to LP bugs is better than filing in Gerrit.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-19: |  |  | [#6](/swift/%2Bbug/1466549/comments/6) |
| --- | --- | --- | --- |

Opening this bug now, does it affect stable releases ?

Opening this bug now, does it affect stable releases ?

| **information type**: | Private Security → Public Security |
| --- | --- |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-06-23

| Changed in swift: | |
| --- | --- |
| **status**: | New → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-07-06: |  |  | [#7](/swift/%2Bbug/1466549/comments/7) |
| --- | --- | --- | --- |

For the record, the patch which was eventually merged to address this (I think) seems to be <https://review.openstack.org/193303> . Does that mean that the issue described here is confirmed to be reproducible under most deployments?

For the record, the patch which was eventually merged to address this (I think) seems to be https://review.openstack.org/193303 . Does that mean that the issue described here is confirmed to be reproducible under most deployments?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-13:  [**Fix proposed to swift (master)**](/swift/%2Bbug/1466549/comments/8) |  |  | [#8](/swift/%2Bbug/1466549/comments/8) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: <https://review.openstack.org/201269>

Fix proposed to branch: master
Review: https://review.openstack.org/201269

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-13:  [**Change abandoned on swift (master)**](/swift/%2Bbug/1466549/comments/9) |  |  | [#9](/swift/%2Bbug/1466549/comments/9) |
| --- | --- | --- | --- |

Change abandoned by paul luse (<email address hidden>) on branch: master

Review: <https://review.openstack.org/201269>

Reason: going to redo this w/o the dependencies

Change abandoned by paul luse (paul.e.luse@intel.com) on branch: master
Review: https://review.openstack.org/201269
Reason: going to redo this w/o the dependencies

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Fix proposed to swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/10) |  |  | [#10](/swift/%2Bbug/1466549/comments/10) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/202227>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/202227

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Change abandoned on swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/11) |  |  | [#11](/swift/%2Bbug/1466549/comments/11) |
| --- | --- | --- | --- |

Change abandoned by Michael Barton (<email address hidden>) on branch: feature/hummingbird

Review: <https://review.openstack.org/202227>

Reason: Apparently I did this wrong.

Change abandoned by Michael Barton (mike@weirdlooking.com) on branch: feature/hummingbird
Review: https://review.openstack.org/202227
Reason: Apparently I did this wrong.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Fix proposed to swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/12) |  |  | [#12](/swift/%2Bbug/1466549/comments/12) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/202230>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/202230

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Fix merged to swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/13) |  |  | [#13](/swift/%2Bbug/1466549/comments/13) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/swift/%2Bbug/1466549/comments/13/%2Bdownload) (72.8 KiB)

Reviewed: <https://review.openstack.org/202230>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=f7cb1777e1b514b3345b9e516ed8f89ad1a4ae87>

Submitter: Jenkins

Branch: feature/hummingbird

commit 51f806d3e3d3a1fcbc80d2f7d7ddbe5cc4c024c9

Author: John Dickinson <email address hidden>

Date: Tue Jul 14 20:49:08 2015 -0700

remove Python 2.6 from the classifier

Change-Id: I67233e9c7b69826242546bd6bd98c24b81070579

commit 278adf5c20101a191979ce1e4d6277e5f209149e

Author: Hisashi Osanai <email address hidden>

Date: Tue Jul 14 15:33:45 2015 +0900

Make logic of unit tests responsive to the method names

The two methods, test\_authorize\_succeeds\_for\_tenant\_name\_in\_roles and

    test\_authorize\_succeeds\_for\_tenant\_id\_in\_roles, have names that don't

    match what they are testing. tenant\_name and tenant\_id need to be

    switched.

Change-Id: I7cb0a7d2b2111127fd5d6b55f2da6a3eadf2235d

commit 1cc3eff958fdd4fb07c2b74c52df7829d3125466

Author: Victor Stinner <email address hidden>

Date: Fri Jul 10 13:04:44 2015 +0200

Fixes for mock 1.1

The new release of mock 1.1 is more strict. It helped to find bugs in

    tests.

Closes-Bug: #1473369

    Change-Id: Id179513c6010d827cbcbdda7692a920e29213bcb

commit ff192cfe5705324497a389aa2f22227d75dc0f8e

Author: janonymous <email address hidden>

Date: Wed Jul 8 18:38:22 2015 +0530

Replace reduce and unichr , these are no longer available in py3

\* Replace reduce() with six.moves.reduce()

    \* Replace unichr with six.unichr

Change-Id: I2038e47e0a6522dd992fd2a4aeff981cf7750fe0

commit 4beceab4f4be99f14025815cf7ed4510ea77f460

Author: OpenStack Proposal Bot <email address hidden>

Date: Thu Jul 9 06:14:56 2015 +0000

Imported Translations from Transifex

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I9ff1dde06be45fc7d6c441a1e1c07221f839a9a1

commit 56ee39a7e13417203c5e1816d7a3184a07f85826

Author: Matthew Oliver <email address hidden>

Date: Thu Jul 9 15:19:32 2015 +1000

Ring builder code clean up follow up patch

This is a simple change that cleans up a NIT from Sam's 'stop moving

    partitions unnecessarily when overload is on' patch.

Change-Id: I9d9f1cc23e2bb625d8e158f4d3f64e10973176a1

commit 6cafd0a4c0bb8f311fc59df580b42e801214effd

Author: Oshrit Feder <email address hidden>

Date: Wed Jul 8 15:18:22 2015 +0300

Fix Container Sync example

Container-sync realm uses cluster\_ as a prefix to specify clusters'

    names. At use, the prefix should not be included. Fixing the examples

    and sample conf to make it clearer that only the name of the cluster

    should be passed.

Change-Id: I2e521d86faffb59e1b45d3f039987ee023c5e939

commit 125238612f58481316db68d7087252bb7729f447

Author: Janie Richling <email address hidden>

Date: Sat Jul 4 17:08:32 2015 -0500

Add CORS unit tests to base

In earlier versions of swift when a request was made with an

    existing origin, but without any CORS settings in the container,

    it was possible to get an u...

Reviewed: https://review.openstack.org/202230
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=f7cb1777e1b514b3345b9e516ed8f89ad1a4ae87
Submitter: Jenkins
Branch: feature/hummingbird
commit 51f806d3e3d3a1fcbc80d2f7d7ddbe5cc4c024c9
Author: John Dickinson <me@not.mn>
Date: Tue Jul 14 20:49:08 2015 -0700
remove Python 2.6 from the classifier
Change-Id: I67233e9c7b69826242546bd6bd98c24b81070579
commit 278adf5c20101a191979ce1e4d6277e5f209149e
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jul 14 15:33:45 2015 +0900
Make logic of unit tests responsive to the method names
The two methods, test\_authorize\_succeeds\_for\_tenant\_name\_in\_roles and
test\_authorize\_succeeds\_for\_tenant\_id\_in\_roles, have names that don't
match what they are testing. tenant\_name and tenant\_id need to be
switched.
Change-Id: I7cb0a7d2b2111127fd5d6b55f2da6a3eadf2235d
commit 1cc3eff958fdd4fb07c2b74c52df7829d3125466
Author: Victor Stinner <vstinner@redhat.com>
Date: Fri Jul 10 13:04:44 2015 +0200
Fixes for mock 1.1
The new release of mock 1.1 is more strict. It helped to find bugs in
tests.
Closes-Bug: #1473369
Change-Id: Id179513c6010d827cbcbdda7692a920e29213bcb
commit ff192cfe5705324497a389aa2f22227d75dc0f8e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jul 8 18:38:22 2015 +0530
Replace reduce and unichr , these are no longer available in py3
\* Replace reduce() with six.moves.reduce()
\* Replace unichr with six.unichr
Change-Id: I2038e47e0a6522dd992fd2a4aeff981cf7750fe0
commit 4beceab4f4be99f14025815cf7ed4510ea77f460
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 9 06:14:56 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9ff1dde06be45fc7d6c441a1e1c07221f839a9a1
commit 56ee39a7e13417203c5e1816d7a3184a07f85826
Author: Matthew Oliver <matt@oliver.net.au>
Date: Thu Jul 9 15:19:32 2015 +1000
Ring builder code clean up follow up patch
This is a simple change that cleans up a NIT from Sam's 'stop moving
partitions unnecessarily when overload is on' patch.
Change-Id: I9d9f1cc23e2bb625d8e158f4d3f64e10973176a1
commit 6cafd0a4c0bb8f311fc59df580b42e801214effd
Author: Oshrit Feder <oshritf@il.ibm.com>
Date: Wed Jul 8 15:18:22 2015 +0300
Fix Container Sync example
Container-sync realm uses cluster\_ as a prefix to specify clusters'
names. At use, the prefix should not be included. Fixing the examples
and sample conf to make it clearer that only the name of the cluster
should be passed.
Change-Id: I2e521d86faffb59e1b45d3f039987ee023c5e939
commit 125238612f58481316db68d7087252bb7729f447
Author: Janie Richling <jrichli@us.ibm.com>
Date: Sat Jul 4 17:08:32 2015 -0500
Add CORS unit tests to base
In earlier versions of swift when a request was made with an
existing origin, but without any CORS settings in the container,
it was possible to get an unhandled exception due to a method call
on the "None" return of cors.get('allow\_origin', '').
Unit tests have been added to assert that this problem cannot go
undetected again.
Change-Id: Ia74896dabe1cf5a307c551b15a43ab1fd789c213
Fixes: bug 1468782
commit e87a74695e2f55dbb0e01721de9d46e230e36008
Author: John Dickinson <me@not.mn>
Date: Sat Jun 6 13:03:15 2015 -0700
add domain\_remap to /info
Also added the value of default\_reseller\_prefix to /info. I did not
add the reseller\_prefixes value to /info because deployers may not
want to expose all of the resellers that are available.
Change-Id: I9ca2f002dc395913bb646390d6908dfb8f554df1
commit 12473104f005b76ebe4b6dbe118a5ac37518eb52
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 7 18:02:53 2015 -0700
Cleanup error messages in ECDiskFileWriter.commit
I think the error messages make better sense and it's more obvious what the
error handling code was trying to bring to the surface for operators.
If you run this test with nosetests --verbose --nocapture
test\_diskfile.py:TestECDiskFile.test\_commit\_fsync\_dir\_raises\_DiskFileErrors
... you can review most of the potential log output
Change-Id: I40c9d77f44e087ee61d9642e924b0a4039d6ca9a
commit bd3717df65f57da9e7f06292ba349442d17fc939
Author: John Dickinson <me@not.mn>
Date: Thu Jul 2 09:54:30 2015 -0700
update AUTHORS file
Change-Id: I509ceeb522bd83c407beb40c22c2924a1d92b8ff
commit cd20961abd20f01a14554c14d4f61a7f0d8deb88
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Jul 5 10:59:50 2015 +0530
Replace dict.iteritems() with dict.items() in bin directory of swift.
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3.
Change-Id: I4bdc064c90bab56cd60f2dca2a5a78426ffbb31c
commit 8eca02d3a1db1e0ed68b15ed41bc62e6c89870c7
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:45:58 2015 +0530
Replace xrange() with six.moves.range()
xrange is no longer available in py3.
replacing xrange with range from six.moves
Change-Id: Ib863c316a0724bd9c4f53c2e5a8d1bcd42c4dc5a
commit 10f367224d5f30c3398169ffe3087f225f3343fc
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:05:36 2015 +0530
Fix Python 3 issues
\* Replace long with six.integer\_type
six.integer\_type :In Python 2, this is long and int, and in Python 3,
just int.
'long' is an undefined variable in py3.
Change-Id: Ibe4c5d0d81fe883f4fe33be93a68d814a228ad28
commit 2328983b7535d24d08942e62095b4346f2626566
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jun 24 17:07:32 2015 -0700
Stop moving partitions unnecessarily when overload is on.
When overload was on and in use, the ring builder was unnecessarily
moving partitions. It would converge on a good solution and settle
down eventually, but it moved more partitions than necessary along the
way.
There are three partition gatherers used in the ring builder:
dev-removed, dispersion, and weight, in that order. The dev-removed
gatherer will pick up all partitions on removed devices. The
dispersion gatherer picks up replicas of partitions that are
suboptimally dispersed. The weight gatherer picks up partitions on
devices which are overweight.
The weight gatherer was not overload-aware, so it would pick up
partitions that did not need to move. Consider a device that would
normally have 100 partitions assigned, assume we set overload to 0.1
so that this device will hold up to 110 (10 extra) for the sake of
dispersion, and assume the device actually has 104 partitions assigned
to it. The correct behavior is to gather nothing from this device
because it has fewer than the maximum. Prior to this commit, the
weight gatherer would remove 4 partitions from this device; they would
subsequently be reassigned by the overload-aware partition placer
(\_reassign\_parts()). In a ring with multiple overloaded devices, the
builder would pick up some partitions from each, shuffle them, and
then assign them back to those same devices. Obviously, this just
created extra replication work for no benefit.
Now, the weight gatherer takes overload into account, and will no
longer needlessly gather partitions.
That's not all, though; this change worsened the behavior of a ring
with more overload than necessary. Before, the ring would balance as
best it could, using the minimal amount of overload. With the
weight-gatherer change, the ring builder will stop gathering
partitions once a device reaches its maximum-permissible assignment
including overload.
For example, imagine a 3-replica, 4-zone ring with overload=0.2 and
weights:
z1: 100
z2: 60
z3: 60
z4: 60
Since z1 has more than 1/3 of the weight, z2, z3, and z4 must take
more than their fair share for the sake of dispersion.
Now, turn up the weights some:
z1: 100
z2: 80
z3: 80
z4: 80
Overload is no longer needed; this ring can balance. However, z2, z3,
and z4 would end up keeping more than their fair share since (a) they
already had extra due to earlier conditions, and (b) the weight
gatherer won't pick up partitions from them since they're not
overburdened once it takes overload into account.
To fix this, we compute the minimum overload factor required for
optimal dispersion and then use min(user-input-overload,
minimum-overload) during rebalance. This way, we don't overload
devices more than the user says, but if the user sets overload higher
than necessary, we'll still give the best balance possible.
Change-Id: If5666ba654ee25da54f9144f3b78840273a49627
commit ccf0758ef1f362312a6197f86455f680ebd990d3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 11 15:40:28 2015 -0700
Add ring-builder analyzer.
This is a tool to help developers quantify changes to the ring
builder. It takes a scenario (JSON file) describing the builder's
basic parameters (part\_power, replicas, etc.) and a number of
"rounds", where each round is a set of operations to perform on the
builder. For each round, the operations are applied, and then the
builder is rebalanced until it reaches a steady state.
The idea is that a developer observes the ring builder behaving
suboptimally, writes a scenario to reproduce the behavior, modifies
the ring builder to fix it, and references the scenario with the
commit so that others can see that things have improved.
I decided to write this after writing my fourth or fifth hacky one-off
script to reproduce some bad behavior in the ring builder.
Change-Id: I114242748368f142304aab90a6d99c1337bced4c
commit e860ec138913dc4c450725766a77e76a7101d06e
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 29 10:11:44 2015 +0000
Ignore invalid PIDs in swift-init
While reviewing ab9f6340 I recognized that invalid pids in the pid files raise
an exceptions (in case it is not a number), and also accept a 0 that is
impossible to use as a pid for any Swift process. In the latter case the process
was recognized as runnning, even if it did not - and thus restarting didn't
worked.
This patch ensures a better handling of any non-numeric value and also removes a
pid file if it uses 0 as the pid.
Change-Id: I09c415c7a75e4b9a0574a08f46f48fff5bb11d02
commit 0a6f2ab870a868e3036dbb212c0e7dd8375a39eb
Author: asettle <alexandra.settle@rackspace.com>
Date: Fri Jun 26 10:57:35 2015 +1000
Correcting minor grammatical errors
1. Removing unnecessary semi colon
2. Removing unnecessary content
Change-Id: Ie95403a4d96db2b8465e75495061fc059098c922
commit 4d4db054d35c7e9de9ed28ac24965e8408dd9f82
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Mon May 18 14:08:25 2015 -0500
After the .durable has been written, fsync the directory.
Added try-except statements in \_finalize\_durable() to fsync the directory
after a successful fsync of the .durable file.
Added test\_commit\_fsync\_dir\_raises\_DiskFileErrors() for testing whether
certain assertions hold for the change to include fsync\_dir().
Some more error details have been included in the logger.
Closes-Bug: #1470651
Change-Id: I4791d75ade8542678369ba0811ef39af6e955cc6
commit d4d7c0e1b11af8f20f965f410901a56e1f8ee69e
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jun 30 17:24:13 2015 -0700
Fix race in test\_server.TestObjectController.test\_PUT\_ssync\_multi\_frag
If the test ran across a one second boundary it would fail because while
the timestamp normalization was doing some rounding it was making no
attempt to reuse the same timestamp on subsequent requests.
Change-Id: Ic560032bcfacd6f0d10cfc0f4f10e5d6c2bc8dd5
commit a88bd6e6b9253b6488a2bf1a354ce29b51f37fe1
Author: ZhiQiang Fan <aji.zqfan@gmail.com>
Date: Sun Jun 28 22:04:46 2015 -0700
fix api overview document
The content about Object Storage HTTP requests constraints seems to
be a table but broken, this patch fixes it into correct rst table format.
Change-Id: I1b4c62da3e6d91add3ee0218707c1628c8f04b33
commit c95a0efe7973a660f4abcd13f4ea6211d72c4baa
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:44:10 2015 -0700
Make ssync\_sender a better HTTP client
When a server responses with an error - if that error includes a body - the
client should read the body. This cleans up some ugly eventlet/wsgi.server log
output related to chunked transfer disconnect (invalid literal for int() with
base 16).
Change-Id: Ibd06ddee9f216fce07fa33c3a7d8306b59eb6d77
Closes-Bug: #1466138
commit 44b76a1b1b83ac9563010f1ddfca5fca76e567bf
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Thu Jun 18 14:21:06 2015 -0500
EC Reconstructor: Do not reconstruct existing fragments.
The EC reconstructor needs to verify that the fragment needing to
be reconstructed does not reside in the collection of node responses.
Otherwise, resources will be spent unnecessarily reconstructing
the fragment. Moreover, this could cause a segfault on some backends.
This change adds the necessary verification steps to make sure
that a fragment will only be rebuilt in the case it is missing from
the other fragment archives.
Added some tests to provide coverage for these scenarios.
Change-Id: I91f3d4af52cbc66c9f7ce00726f247b5462e66f9
Closes-Bug: #1452553
commit d124ce5792d93e1efcdb083211ecef381f7b7173
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:35:07 2015 -0700
Fix ValueError in ssync\_receiver
httplib's putheader method will cast whatever you give it to a string.
where we allow the default dict.get default of None to be passed to
putheader unmodified ssync\_receiver is surpised that the non-empty
string isn't able to be converted to an integer.
We can avoid surprising the ssync\_receiver in this way by sending the
empty string as a better default.
Change-Id: Ie9df9927ff4d3dd3f334647f883b2937d0d81030
commit edfca861b6fa39972df276fb1f37aa81583a605d
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri Jun 26 08:54:22 2015 +0000
Increase httplib.\_MAXHEADERS
Python 2.7.9+ and 3.2.6+ limits the number of maximum headers in httplib to 100
[1,2,3]. This setting is too low for Swift.
By default the maximum number of allowed headers depends on the number of max
allowed metadata settings plus a default value of 32 for regular http headers.
If for some reason this is not enough (custom middleware for example) it can be
increased with the extra\_header\_count constraint.
[1] https://bugs.python.org/issue16037
[2] https://hg.python.org/cpython/raw-file/15c95b7d81dc/Misc/NEWS
[3] https://hg.python.org/cpython/raw-file/v3.2.6/Misc/NEWS
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Co-Authored-By: Thomas Herve <therve@redhat.com>
Change-Id: I388fd697ec88476024b0e9f1ae75ba35ff765282
commit 81ceee056de604d81a921280f453731eadf7be09
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jun 22 23:24:19 2015 -0700
Add one more test for ssync\_receiver
To prevent 409 conflict on a primary node during ssyncing,
ssync-receiver should add x-ssync-backend-frag-index generated from
x-ssync-backend-node-index of the SSYNC replication request header.
The change is done by previous work[1], but we need more test for that.
This patch addes one more assertion if the x-ssync-backend-frag-index
is in the ssync subrequest correctly.
\*BONUS\*
Fix some weird mock and add some sanities.
1: https://review.openstack.org/#/c/191521/
Change-Id: I27aff713c69017c0bc4c60b4833184e1285595d7
commit c2c1366b0794bcdbbbaef7fedaef2cab19cd8db8
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jun 24 21:07:16 2015 +0530
Fixed Errors in Swift-Form Post middleware section rst.
Inline markup cannot be nested in RST.
Fixing markups by using a single option for the whole line and making
some minor error corrections.
Change-Id: I42bfd7dfe5c93a69436ecc5d154f2e61ca83fa82
commit 514daea6317edc02587f7abfaae8770e1ef9cc4b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jun 12 23:40:51 2015 +0530
Fixed Formatting Error in Swift -Form Post middleware section.
Fixed Formatting error in ``action=”SWIFT\_URL``” => action=”``SWIFT\_URL``”
Change-Id: Id461129ef7f5b6412f94d36920c942a4181c0eb7
Closes-Bug: #1464740
commit e70b66586e13718e7ac0078c2f2cd1135c61a1f1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed Jun 24 09:36:37 2015 +0200
Replace dict.iteritems() with dict.items()
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3. According to a discussion on the openstack-dev mailing list,
the overhead of creating a temporary list using dict.items() on Python 2
is very low because most dictionaries are small:
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066391.html
Patch generated by the following command:
sed -i 's,iteritems,items,g' \
$(find swift -name "\*.py") \
$(find test -name "\*.py")
Change-Id: I6070bb6c684be76e8e77222a7d280ec6edd43496
commit e6165a7879d796efd3992260ef23a7f95ceeab32
Author: paul luse <paul.e.luse@intel.com>
Date: Mon May 25 14:41:42 2015 -0700
Add policy support to dispersion tools
Doesn't work for anything other than policy 0. updated to allow user
to specify policy name on cmd line (as with object-info) which
then makes populate/report work with 3x, 2x, or EC style policies
Change-Id: Ib7c298f0f6d666b1ecca25315b88539f45cf9f95
Closes-Bug: 1458688
commit e5c962a28ce99f01c6cd0b68b7434ddcd0e55f62
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon May 25 18:28:02 2015 +0200
Replace xrange() with six.moves.range()
Patch generated by the xrange operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Manual changes:
\* Fix indentation for pep8 checks
\* Fix TestGreenthreadSafeIterator.test\_access\_is\_serialized of
test.unit.common.test\_utils:
replace range(1, 11) with list(range(1, 11))
\* Fix UnsafeXrange docstring, revert change
Change-Id: Icb7e26135c5e57b5302b8bfe066b33cafe69fe4d
commit 4a5b851207c98a380a32e27a183dd98022be9d16
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 22 14:48:41 2015 +0200
Add note about updatedb to the docs
Change-Id: Ia1aa0bb1f93ee487e2f7ddf76a7a08efa8f3ba41
commit ac8a76958510646c369df9ffc2bf22005e43d153
Author: paul luse <paul.e.luse@intel.com>
Date: Sat Jun 13 11:03:56 2015 -0700
EC Ssync: Update parms to include node and frag indices
Previously we sent the ssync backend frag index based on the node
index. We need to be more specific for ssync to handle both sync
and revert cases so now we send the frag index based on the job
contents (as determined by the ec recon)) and the node index
as a new header based on, well, the node index.
The rcvr can now validate the incoming pair to reject (400) when
a primary node is being asked to accept fragments that don't
belong to it. Additionally, by having the frag index the
rcvr can reject (409) an attempt to accept a fragment when its
a handoff and already has one that needs to be reverted.
Fixes-bug: #1452619
Change-Id: I8287b274bbbd00903c1975fe49375590af697be4
commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
Closes-Bug: #1466549
commit df134df901a13c2261a8205826ea1aa8d75dc283
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu May 14 22:14:15 2015 -0700
Allow 1+ object-servers-per-disk deployment
Enabled by a new > 0 integer config value, "servers\_per\_port" in the
[DEFAULT] config section for object-server and/or replication server
configs. The setting's integer value determines how many different
object-server workers handle requests for any single unique local port
in the ring. In this mode, the parent swift-object-server process
continues to run as the original user (i.e. root if low-port binding
is required), binds to all ports as defined in the ring, and forks off
the specified number of workers per listen socket. The child, per-port
servers drop privileges and behave pretty much how object-server workers
always have, except that because the ring has unique ports per disk, the
object-servers will only be handling requests for a single disk. The
parent process detects dead servers and restarts them (with the correct
listen socket), starts missing servers when an updated ring file is
found with a device on the server with a new port, and kills extraneous
servers when their port is found to no longer be in the ring. The ring
files are stat'ed at most every "ring\_check\_interval" seconds, as
configured in the object-server config (same default of 15s).
Immediately stopping all swift-object-worker processes still works by
sending the parent a SIGTERM. Likewise, a SIGHUP to the parent process
still causes the parent process to close all listen sockets and exit,
allowing existing children to finish serving their existing requests.
The drop\_privileges helper function now has an optional param to
suppress the setsid() call, which otherwise screws up the child workers'
process management.
The class method RingData.load() can be told to only load the ring
metadata (i.e. everything except replica2part2dev\_id) with the optional
kwarg, header\_only=True. This is used to keep the parent and all
forked off workers from unnecessarily having full copies of all storage
policy rings in memory.
A new helper class, swift.common.storage\_policy.BindPortsCache,
provides a method to return a set of all device ports in all rings for
the server on which it is instantiated (identified by its set of IP
addresses). The BindPortsCache instance will track mtimes of ring
files, so they are not opened more frequently than necessary.
This patch includes enhancements to the probe tests and
object-replicator/object-reconstructor config plumbing to allow the
probe tests to work correctly both in the "normal" config (same IP but
unique ports for each SAIO "server") and a server-per-port setup where
each SAIO "server" must have a unique IP address and unique port per
disk within each "server". The main probe tests only work with 4
servers and 4 disks, but you can see the difference in the rings for the
EC probe tests where there are 2 disks per server for a total of 8
disks. Specifically, swift.common.ring.utils.is\_local\_device() will
ignore the ports when the "my\_port" argument is None. Then,
object-replicator and object-reconstructor both set self.bind\_port to
None if server\_per\_port is enabled. Bonus improvement for IPv6
addresses in is\_local\_device().
This PR for vagrant-swift-all-in-one will aid in testing this patch:
https://github.com/swiftstack/vagrant-swift-all-in-one/pull/16/
Also allow SAIO to answer is\_local\_device() better; common SAIO setups
have multiple "servers" all on the same host with different ports for
the different "servers" (which happen to match the IPs specified in the
rings for the devices on each of those "servers").
However, you can configure the SAIO to have different localhost IP
addresses (e.g. 127.0.0.1, 127.0.0.2, etc.) in the ring and in the
servers' config files' bind\_ip setting.
This new whataremyips() implementation combined with a little plumbing
allows is\_local\_device() to accurately answer, even on an SAIO.
In the default case (an unspecified bind\_ip defaults to '0.0.0.0') as
well as an explict "bind to everything" like '0.0.0.0' or '::',
whataremyips() behaves as it always has, returning all IP addresses for
the server.
Also updated probe tests to handle each "server" in the SAIO having a
unique IP address.
For some (noisy) benchmarks that show servers\_per\_port=X is at least as
good as the same number of "normal" workers:
https://gist.github.com/dbishop/c214f89ca708a6b1624a#file-summary-md
Benchmarks showing the benefits of I/O isolation with a small number of
slow disks:
https://gist.github.com/dbishop/fd0ab067babdecfb07ca#file-results-md
If you were wondering what the overhead of threads\_per\_disk looks like:
https://gist.github.com/dbishop/1d14755fedc86a161718#file-tabular\_results-md
DocImpact
Change-Id: I2239a4000b41a7e7cc53465ce794af49d44796c6
commit af72881d1dcc46486d8d652b92a0ec9aa9ca2bfa
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jun 15 13:36:36 2015 -0700
Use just IP, not port, when determining partition placement
In the ring builder, we place partitions with maximum possible
dispersion across tiers, where a "tier" is region, then zone, then
IP/port,then device. Now, instead of IP/port, just use IP. The port
wasn't really getting us anything; two different object servers on two
different ports on one machine aren't separate failure
domains. However, if someone has only a few machines and is using one
object server on its own port per disk, then the ring builder would
end up with every disk in its own IP/port tier, resulting in bad (with
respect to durability) partition placement.
For example: assume 1 region, 1 zone, 4 machines, 48 total disks (12
per machine), and one object server (and hence one port) per
disk. With the old behavior, partition replicas will all go in the one
region, then the one zone, then pick one of 48 IP/port pairs, then
pick the one disk therein. This gives the same result as randomly
picking 3 disks (without replacement) to store data on; it completely
ignores machine boundaries.
With the new behavior, the replica placer will pick the one region,
then the one zone, then one of 4 IPs, then one of 12 disks
therein. This gives the optimal placement with respect to durability.
The same applies to Ring.get\_more\_nodes().
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ibbd740c51296b7e360845b5309d276d7383a3742
commit 09e7477a391e7425af62a6516f43c69bc98b7080
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jun 15 22:10:45 2015 +0530
Replace it.next() with next(it) for py3 compat
The Python 2 next() method of iterators was renamed to \_\_next\_\_() on
Python 3. Use the builtin next() function instead which works on Python
2 and Python 3.
Change-Id: Ic948bc574b58f1d28c5c58e3985906dee17fa51d
commit 5ad369c1cb0f480b164a5b5e7eb194081835c266
Author: Victor Stinner <vstinner@redhat.com>
Date: Tue Jun 9 00:22:12 2015 +0200
Add six requirement
The six module is needed to add Python 3 support to Swift.
Change-Id: Ie637ed3458c7ff56c26834bca73203ed55604d74
commit 037a0c5dbe01a57b741d34988e21f4f763b6204b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jun 6 17:42:41 2015 +0530
Object are sorted and concatenated by swift in cardinal order.
Modified values in example in decimal to be more precise,
added a small description on Object are sorted and concatenated
by swift in cardinal order as a small phrase would be sufficient.
Change-Id: I914ded4e5726e50bb93b05759c3bfb76edda53ab
backport: none
Closes-Bug: #1383893
commit 11e5c4adf0e02c8fdab0d8584fc943d96e1165cd
Author: Koert van der Veer <koert@cloudvps.com>
Date: Tue Dec 16 11:15:19 2014 +0100
Allow default reseller prefix in domain\_remap middleware
Previously, the reseller prefix needed to be provided in the host name
even when the domain was unique to that reseller. With the
default\_reseller\_prefix, any domain which matches in this middleware,
will will be passed on with a reseller prefix, whether or not it was
provided.
Change-Id: I5aa5ce78ad1ee2e3660cce4c3e07306f8999f02a
Implements: blueprint domainremap-reseller-domains
commit c953e8cc9049e94cd01239d5e4a30a56f26a97d3
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Tue Apr 28 13:18:32 2015 -0500
The hash\_cleanup\_listdir function should only be called when necessary.
Introduced a conditional that will specify to \_finalize\_put() whether
the put() method is being called within the context of ECDiskFileWriter.
Included some unit tests that will test the number of calls to
hash\_cleanup\_listdir() during put(), commit(), and delete()
operations.
Change-Id: I287b2648591fdbf686898dc9047beda80a64da0c
commit 93de6c73e587a672663fa0997f439b73b336769c
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jun 2 17:00:42 2015 +0900
Add metadata size tests on the border
This patch adds a test for a 204 when a single metadata item in a POST causes
the backend aggregate constraints check to be on the border.
Background:
Overall metadata size constraint is enforced in the container and
account backends as well as in the proxy controllers.
Whereas the proxy controller can check that constraints are not exceeded
by a single PUT or POST request, the backend checks that constraints are not
exceeded by the aggregate of all PUTs and POSTs.
The change [1] added a test for a 400 when a single metadata item in
a POST causes the backend aggregate constraints check to go over limit.
[1] I1489e29686013cbd3d70283d8756b548aea3c2e1
Change-Id: Iac86ea71240ddde177e625c279c21aef67659d10
commit af734b3fb6fdbc11b8a0b775256e7642eb485b8d
Author: Mark Seger <Mark.Seger@hp.com>
Date: Wed Jun 3 08:16:06 2015 -0400
Change usage help and Attention messages to warnings
Change-Id: I1396aaffe36e739606f15f7fef37b11bd83f1fc1
commit 4f2ed8bcd0468f3b69d5fded274d8d6b02ac3d10
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri Mar 20 09:56:30 2015 -0700
EC: support multiple ranges for GET requests
This commit lets clients receive multipart/byteranges responses (see
RFC 7233, Appendix A) for erasure-coded objects. Clients can already
do this for replicated objects, so this brings EC closer to feature
parity (ha!).
GetOrHeadHandler got a base class extracted from it that treats an
HTTP response as a sequence of byte-range responses. This way, it can
continue to yield whole fragments, not just N-byte pieces of the raw
HTTP response, since an N-byte piece of a multipart/byteranges
response is pretty much useless.
There are a couple of bonus fixes in here, too. For starters, download
resuming now works on multipart/byteranges responses. Before, it only
worked on 200 responses or 206 responses for a single byte
range. Also, BufferedHTTPResponse grew a readline() method.
Also, the MIME response for replicated objects got tightened up a
little. Before, it had some leading and trailing CRLFs which, while
allowed by RFC 7233, provide no benefit. Now, both replicated and EC
multipart/byteranges avoid extraneous bytes. This let me re-use the
Content-Length calculation in swob instead of having to either hack
around it or add extraneous whitespace to match.
Change-Id: I16fc65e0ec4e356706d327bdb02a3741e36330a0
commit f1f4bb30cd8ad930ddb7a232b2744b48e35a0480
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Jun 2 19:51:39 2015 +0000
Fix testing issues
When functional tests are run in tox and an exception is raised when connecting
to Swift (for example: Swift not running, missing python-keystoneclient package
used by python-swiftclient) 0 tests are executed, but tox returns a success.
An exception is raised during tests, caused by a missing python-keystoneclient
in python-swiftclient. Instead of adding python-keystoneclient as a dependency
in python-swiftclient the package is added to the test-requirements.txt in Swift
itself. Note that adding python-keystoneclient to the test-requirements in
python-swiftclient is not sufficient (it's already in there).
The exception in setup\_package() is catched by the openstack.nose\_plugin, thus
disabling this plugin for now as well.
Also fixing two test errors seen on the gate regarding the tempurl middleware.
There was also an update to tox, environment variables were no longer passed
with versions >= 2.0 (http://tox.readthedocs.org/en/latest/changelog.html).
Swift test environment variables have been added to the passenv to re-enable the
former behavior, as well as environment variables required to pass proxy
settings.
This also led to skipped tempauth tests, and together with the missing
python-keystoneclient no tests were executed.
Related-Bug: 1461440
Related-Bug: 1455102
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Ideea071017d04912c60ed0bc76532adbb446c31d
commit 2759a6f159d4a90e4ad4c8e9e479085d195f8d14
Author: Pradeep Kumar Singh <pradeep.singh@nectechnologies.in>
Date: Wed May 13 21:18:02 2015 +0530
Handle Disk IO error Exception in swift account auditor
Swift account auditor fails to quarantine corrupt db due to
Disk IO error. This patch fixes that by handling Disk IO Error
Exception.
Closes-Bug:1169189
Change-Id: I031ee2a5775e4a88d4fb00d972d553936147c42e
commit 1bef06eec8f5f780914ac701d63f9c498b29119b
Author: Michael Barton <mike@weirdlooking.com>
Date: Sun May 31 23:10:15 2015 +0000
Don't quarantine on read\_metadata ENOENT
An operation that removes an existing .ts or .meta out from under another
concurrent operation at the right point can cause the whole object to be
needlessly quarantined.
Closes-Bug: #1451520
Change-Id: I37d660199e54411d0610889f9ee230b13747244b
commit 8b4af92dac813d707d124b3be37df586260fe74a
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Jun 1 17:57:25 2015 +0100
Tighten up overall metadata size tests
Overall metadata size constraint is enforced in the container and account
backends as well as in the proxy controllers. Whereas the proxy controller
can check that constraints are not exceeded by a single PUT or POST request,
the backend checks that constraints are not exceeded by the aggregate of all
PUTs and POSTs.
The current functional tests only exercise the proxy controller checks, since
they test for a 400 when sending excessive metadata in a single POST. This patch
adds a test for a 400 when a single metadata item in a POST causes the backend
aggregate constraints check to go over limit.
The extra coverage of the new assertions can be seen by modifying
swift/common/db.DatabasBroker.validate\_metadata() to always return None
immediately - only the new assertions fail when functests are run.
Change-Id: I1489e29686013cbd3d70283d8756b548aea3c2e1
commit b4c1d73ad56e0705d1c5dd1fc4f1d89b09fceff1
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 1 06:50:33 2015 +0000
Make swift-recon compatible for servers without storage policies
Swift recon introduced a new key for storage policies, and the CLI expected this
key in the server response. However, if one updates the CLI but not yet the
server an exception will be raised, because there is no default value and no
check if the key is included in the response.
This change checks if the policies key is included in the response and updates
one test to ensure backward compability.
Closes-Bug: 1453599
Change-Id: I7c7a90f9933bec2ab45595df9dc600a6cba65666
commit 38787d0fb5102e41b153e4629d2ef374a02965e9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:19:54 2015 -0700
Remove simplejson from staticweb
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This lets us get rid of some redundant Unicode encoding. Before, we
would take the container-listing response off the wire,
JSON-deserialize it (str -> unicode), then pass each of several fields
from each entry to get\_valid\_utf8\_str(), which would encode it,
(unicode -> str), decode it (str -> unicode), and then encode it again
(unicode -> str) for good measure.
The net effect was that each object's name would, in the proxy server,
go str -> unicode -> str -> unicode -> str.
By replacing simplejson with stdlib json, we get a guarantee that each
container-listing entry's name, hash, content\_type, and last\_modified
are unicodes, so we can stop worrying about them being valid UTF-8 or
not. This takes an encode and decode out of the path, so we just have
str -> unicode -> str. While it'd be ideal to avoid this, the first
transform (str -> unicode) happens when we decode the
container-listing response body (json.loads()), so there's no way out.
Change-Id: I00aedf952d691a809c23025b89131ea0f02b6431
commit 736cf54adf3ee85d2f473e5e5374f9833422967c
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu May 28 15:30:47 2015 -0700
Remove simplejson from tests
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This commit just takes simplejson out of the unit and functional
tests. They still pass.
Change-Id: I96f17df81fa5d265395a938b19213d2638682106
commit 68c30b80b47c281c549d101c43d79e718e91d21d
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu May 28 06:08:12 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I0c7b2bdb0edcc3bb3fa06903ec8457ca5e2dd688
commit 5374ba3a80a5b895542196502eac4d9300ba53d2
Author: John Dickinson <me@not.mn>
Date: Wed May 27 12:28:04 2015 -0700
drop Python 2.6 testing support
Change-Id: I78f21e5794e8ba7a095f03d279247516a241f555
commit 191f2a00bd9121fddc03d8f07f15e5e34790541e
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 16:39:23 2015 +0100
Remove \_ensure\_flush() from SSYNC receiver
The Receiver.\_ensure\_flush() method in ssync\_receiver.py has
the following comment:
Sends a blank line sufficient to flush buffers.
This is to ensure Eventlet versions that don't support
eventlet.minimum\_write\_chunk\_size will send any previous data
buffered.
If https://bitbucket.org/eventlet/eventlet/pull-request/37
ever gets released in an Eventlet version, we should make
this yield only for versions older than that.
The reference pull request was included with eventlet 0.14 [1] and
swift now requires >=0.16.1 so it is safe to remove \_ensure\_flush()
and save > 8k bytes per SSYNC response.
[1] https://bitbucket.org/eventlet/eventlet/commits/4bd654205a4217970a57a7c4802fed7ff2c8b770
Change-Id: I367e9a6e92b7ea75fe7e5795cded212657de57ed
commit 3aa06f185ac4256a8883c565bdc90b1ffbd519ca
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 09:17:46 2015 +0100
Make SSYNC receiver return a reponse when initial checks fail
The ssync Receiver performs some checks on request parameters
in initialize\_request() before starting the exchange of missing
hashes and updates e.g. the destination device must be available;
the policy must be valid. Currently if any of these checks fails
then the receiver just closes the connection, so the Sender gets
no useful response code and noise is generated in logs by httplib
and wsgi Exceptions.
This change moves the request parameter checks to the Receiver
constructor so that the HTTPExceptions raised are actually sent
as responses. (The 'connection close' exception handling still
applies once the 'missing\_check' and 'updates' handshakes are in
progress.)
Moving initialize\_request() revealed the following lurking bug:
\* initialize\_request() sets
req.environ['eventlet.minimum\_write\_chunk\_size'] = 0
\* this was previously ineffective because the Response environ
had already been copied from Request environ before this value
was set, so the Response never used the value :/
\* Now that it is effective (a good thing) it causes the empty string
yielded by the receiver when there are no missing hashes in
missing\_checks() to be sent to the sender immediately. This makes
the Sender.readline() think there has been an early disconnect
and raise an Exception (a bad thing), as revealed by
test/unit/obj/test\_ssync\_sender.py:TestSsync.test\_nothing\_to\_sync
The fix for this is to simply make the receiver skip sending the empty
string if there are no missing object\_hashes.
Change-Id: I036a6919fead6e970505dccbb0da7bfbdf8cecc3
commit bb716573ab5c8455348ec013feb894421e0e1f1c
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed May 20 00:39:41 2015 -0700
Allow SLO PUTs to forgo per-segment integrity checks
While manifests still require 'etag' and 'size\_bytes' fields for each
segment (to catch user errors like 'etaf' or 'size\_btyes'), an explicit
null for either will skip that particular integrity check and instead
use whatever value is retrieved when HEADing the segment. So, if a user
uploads a manifest like:
[{"path": "/con/obj\_seg\_1", "etag": null, "size\_bytes": 1048576},
{"path": "/con/obj\_seg\_2", "etag": "etag2", "size\_bytes": null},
{"path": "/con/obj\_seg\_3", "etag": null, "size\_bytes": null}]
then the etag will only be verified for the /con/obj\_seg\_2 segment,
and the segment size will only be verified for the /con/obj\_seg\_1
segment. However, the manifest that's ultimately stored (and can be
retrieved with a ?multipart-manifest=get query-string) will still look
like:
[{"name": "/con/obj\_seg\_1", "hash": "etag1", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_2", "hash": "etag2", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_3", "hash": "etag3", "bytes": 1234, ...}]
This allows the middleware to continue performing integrity checks on
object GET.
Change-Id: I2c4e585221387dd02a8679a50398d6b614407b12
DocImpact
commit a1c327022c70907ccc159d6203de26b37c3a4586
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:43:55 2015 -0700
Remove simplejson from swift-recon
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
All swift-recon was doing with json was decoding a JSON response (from
the recon middleware) and printing it to the terminal. This still
works just fine.
Change-Id: I28cf25a7c2856f230d4642c62fb8bf9c4d37e9e5
commit a3559edc2342e2cf92a5188336ab263ffd038554
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Apr 17 16:30:30 2015 -0700
Exclude local\_dev from sync partners on failure
If the primary left or right hand partners are down, the next best thing
is to validate the rest of the primary nodes. Where the rest should
exclude not just the left and right hand partners - but ourself as well.
This fixes a accidental noop when partner node is unavailable and
another node is missing data.
Validation:
Add probetests to cover ssync failures for the primary sync\_to nodes for
sync jobs.
Drive-by:
Make additional plumbing for the check\_mount and check\_dir constraints into
the remaining daemons.
Change-Id: I4d1c047106c242bca85c94b569d98fd59bb255f4
commit 666bf06c26bc9e0d6256d054835386e50e67b8a2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed May 6 16:29:06 2015 -0700
EC: don't 503 on marginally-successful PUT
On EC PUT in an M+K scheme, we require M+1 fragment archives to
durably land on disk. If we get that, then we go ahead and ask the
object servers to "commit" the object by writing out .durable
files. We only require 2 of those.
When we got exactly M+1 fragment archives on disk, and then one
connection timed out while writing .durable files, we should still be
okay (provided M is at least 3). However, we'd take our M > 2
remaining successful responses and pass that off to best\_response()
with a quorum size of M+1, thus getting a 503 even though everything
worked well enough.
Now we pass 2 to best\_response() to avoid that false negative.
There was also a spot where we were getting the quorum size wrong. If
we wrote out 3 fragment archives for a 2+1 policy, we were only
requiring 2 successful backend PUTs. That's wrong; the right number is
3, which is what the policy's .quorum() method says. There was a spot
where the right number wasn't getting plumbed through, but it is now.
Change-Id: Ic658a199e952558db329268f4d7b4009f47c6d03
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Closes-Bug: 1452468
commit e7c8c578d9e5b0aa7e56b02bd9c39baa99d2d6ae
Author: Michael MATUR <michael.matur@gmail.com>
Date: Mon May 25 15:13:01 2015 +0200
fixup!Patch of "parse\_content\_disposition" method to meet RFC2183
The spec of Content-Disposition does not require a space character after
comma: http://www.ietf.org/rfc/rfc2183.txt
Change-Id: Iff438dc36ce78c6a79bb66ab3d889a8dae7c0e1f
Closes-Bug: #1458497
commit af8d842076ba269fed7f4128d0c7503ab5d1a94a
Author: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Date: Tue Oct 21 09:24:25 2014 +0000
Replaced setting run\_pause with standard interval
The deprecated directive `run\_pause` should be replaced with the more
standard one `interval`. The `run\_pause` should be still supported for
backward compatibility. This patch updates object replicator to use
`interval` and support `run\_pause`. It also updates its sample config
and documentation.
Co-Authored-By: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Co-Authored-By: Kamil Rykowski <kamil.rykowski@intel.com>
Change-Id: Ie2a3414a96a94efb9273ff53a80b9d90c74fff09
Closes-Bug: #1364735
commit f11d92d566757a54ff1e3800ec0bfac098347a68
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri May 22 16:58:04 2015 -0700
Add swift-durability-calculator line to docs
This commits add a line (link and small doc) for
swift-durability-calculator which provides a browser based
durability calculation tool to docs as an associated project.
Change-Id: I4ea8015f512616dc25072080bef79b8734971ccf
commit f864092455ebcd40b3568633c3524cc5c64d3309
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed May 20 17:50:07 2015 -0700
Add Swift Inspector to assoicated projects
Change-Id: I5b5448674ea455119a51509ab5e7cd11a764b5a7
commit e54781a2aa29808aff654861d8a0aafd24b6620c
Author: Thiago da Silva <thiago@redhat.com>
Date: Tue May 19 20:27:06 2015 +0000
add object post and delete methods to BaseObjectController
Adding post and delete methods to BaseObjectController that can
be overriden by ObjectCOntroller subclasses. These methods are
similar to the PUT and GET methods that were introduced as part
of the EC work
Change-Id: I197364bc3e2f2287c0afc8948863e3cdeab90383
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit ab9f63402de6d554528699a02955854ac28264c5
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Mon Nov 24 21:44:03 2014 +0900
Add process name checking into swift-init
Swift-init uses pid files to detect existing swift processes by pid.
However, it mistakes an unrelated process for a swift process and makes
a wrong decision, when the unrelated process is running with pid written
in swift pid files.
This patch adds process name checking into swift-init and enable it to remove
invalid pid files in such situation.
Change-Id: Ibca026bdfbdacdd92c8763e1eb15d98293c70656
Closes-Bug: #1327106
commit aa4866eb6014d7fbb8531eb5d927d5611ebfd06d
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed May 13 20:10:59 2015 +0000
move replication code to ReplicatedObjectController
Moving \_connect\_put\_node, send\_file, \_transfer\_data and \_store\_object
methods to ReplicatedObjectController. Each one of these methods are
specific to replication policy. EC policy implements their own
version of them.
Of these four methods, only \_store\_object and \_connect\_put\_node are
required to be implemented by the policy specific Object Controllers.
Change-Id: Ifc72461b77dbfdaae9d63417f1286e8b5da3ca4e
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit 025c4c4339e7ace2f5be8cb3a3cddf6c38ceff37
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Apr 24 02:15:36 2015 -0700
Remove confusable query string on post as copy
Current post as copy routine (i.e. POST object with post\_as\_copy option
turned on) on Object Controller uses "multipart-manifest" query string
which is feeded to env['copy\_hook'] to decide which data (the manifest or
object pointed by the manifest) should be copied.
However, the way using the query string will confuse operators looking at
logging system (or analyzing the log) because whole POST object requests
have 'multipart-manifest=get' like as:
POST /v1/AUTH\_test/d4c816b24d38489082f5118599a67920/manifest-abcde%3Fmultipart-manifest%3Dget
We cannot know whether the query string was added by hand
(from user) or not. In addition, the query isn't needed by the
backend conversation between proxy-server and object-server.
(Just needed by "copy\_hook" on the proxy controller!)
To remove the confusable query string and to keep the log to be clean,
this patch introduces new environment variable "swift.post\_as\_copy"
and changes proxy controller and the copy\_hook to use the new env.
This item was originally discussed at
https://review.openstack.org/#/c/177132/
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: I0cd37520eea1825a10ebd27ccdc7e9162647233e
commit 98b725fec639c5501c645ce4e4dc9d12c686f91d
Author: Alistair Coles <alistair.coles@hp.com>
Date: Fri May 1 13:02:29 2015 +0100
Cleanup and extend end to end ssync tests
Extends the existing end to end ssync tests with
a test using replication policy.
Also some cleanup and improvements to the test framework e.g. rather
than faking the connection between sender and receiver, use a real
connection and wrap it to capture traffic for verification.
Change-Id: Id71d2eb3fb8fa15c016ef151aacf95f97196a902
commit 518262ab6ecd8faa2b915df118ffc70a30112a18
Author: paul luse <paul.e.luse@intel.com>
Date: Tue May 12 15:21:13 2015 -0700
Remove 1 line of dead code from EC reconstructor
Assuming nobody intentionally left this in here for some reason...
Change-Id: I4bf43bb3828e062c0342557243076ed62d6790f4
commit 29f4393d88426fd6c34f2cfe43a8c434bfad8d47
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri May 8 15:55:14 2015 -0700
Remove workaround for old eventlet version
Swift now requires eventlet >= 0.16.1, so we can get rid of this
workaround for a bug in eventlet 0.9.16.
Change-Id: I4a1200b9bd9266896a704a840fda0d1b720bc86d
commit 90b84d3a699811a99c97ebbe4f71a14d2f76a0e5
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri May 8 11:45:12 2015 -0700
Properly re-raise exceptions in proxy\_logging
Previously, this could encounter TypeErrors, presumably because
sys.exc\_clear() was called somewhere in the block of code between
catching the exception and re-raising.
Related-Bug: 1181146
Change-Id: Iadeea3f61e70bf83dc0eb063fdb27edd16f3ca32
commit 664a632c01f8c5c80826b223b9ade774bfe2ed9a
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 8 08:41:39 2015 +0200
Update my mailmap entry
Change-Id: I5d21a55d0fa4cab6eaa6ff426819aa1dc997de2f
commit 0b20a18e5216b991855c461e41e9ef32e17fadb4
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Thu May 7 13:16:15 2015 -0600
Spell "rebalance" right in swift-ring-builder.1
See Red Hat bug #1218269.
Change-Id: I814eb4b3c0821f5a8df5feea2bda3a964aace536
commit 1faad248f833735585aa8f6135babceb46fbb6f8
Author: Emmanuel Cazenave <contact@emcaz.fr>
Date: Tue May 5 12:31:22 2015 +0200
X-Auth-Token should be a bytestring.
Change-Id: I2aa941d74883e17e9548b0144a4a2e2db33aba95
Closes-Bug: 1451773
commit 55dd705a863c4500330cbd2b8c2fec46d618dc71
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Wed May 6 19:53:09 2015 +0200
Add missing statsd metrics section for object-reconstructor
Change-Id: Id3f98e5f637ff537a387262b40f21c05876fca91
commit c77c79b2c9b9ca7790c29577341cf36c5e9012cf
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue May 5 06:08:09 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9b0156c7fc315182d80604bf353586455bbc34d1
commit 94215049fd37f810ddf4e6b8122cce02aea3e6e3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon May 4 15:08:51 2015 -0700
Bump up a timeout in a test
Got a slow crappy VM like I do? You might see this fail
occasionally. Bump up the timeout a little to help it out.
Change-Id: I8c0e5b99012830ea3525fa55b0811268db3da2a2
commit 03536dbb55c219b94389e635babec2df2e2759fa
Author: Prashanth Pai <ppai@redhat.com>
Date: Wed Apr 29 12:11:59 2015 +0530
Fix incorrect passing of file object to fsync()
swift.common.utils.fsync() requires a file descriptor as argument
but file object handle was being passed.
Change-Id: I316b58f6bc37de0945eff551e4e50565653664f5
Signed-off-by: Prashanth Pai <ppai@redhat.com>
commit bfbc94c3cb34eb9ff288fb817dee667cc870d9eb
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Apr 28 10:45:50 2015 +0100
Fix intermittent container replicator test failure
Intermittent failure of this test could be due to
insufficient time elapsing between either the local
and remote db's being created or during the
debug\_timing calls. This patch forces greater timestamp
separation and forces debug\_timing to always log timings.
Also add message to the failign assertion so if this does
fail again we get some clue as to why.
Closes-Bug: 1369663
Change-Id: I4b69b2e759d586a14abd0931a68dbdf256d57c32
commit dbb9d4b7938f24ee588d260c9b51ca65d5095749
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Mon Apr 27 08:52:18 2015 +0200
Add missing docstring in direct\_client
Added a missing docstring to the direct\_delete\_container method.
Also checked other docstrings in the same file and fixed a wrong docstring
element in direct\_delete\_object. Added raises: docstring entry to all methods
that raise an Exception.
Change-Id: If463a0f9ddff3fe2d13f6d97fcfa955e91d0f01f
commit 8cdf0fdebe9eb782322fccfc11253dc959cf321d
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Apr 27 13:29:50 2015 -0700
Fix account replication during pre-storage-policy upgrade
Old account schemas don't send the storage\_policy\_index key for container rows
during replication, and if the recieving end is already running an upgraded
server it is surprised with a KeyError. Normally this would work itself out
if the old schema recieved any updates from container layer, or a new
container is created, or requires a row sync from another account database -
but if the account databases have rows out of sync and there's no activity in
the account otherwise, there's nothing to force the old schemas to be
upgraded.
Rather than force the old schema that already has a complete set of container
rows to migrate even in the absense of activity we can just fill in default
legacy value for the storage policy index and allow the accounts to get back
in sync and migrate the next time a container update occurs.
FWIW, I never able to get a cluster upgrade to get stuck in this state without
some sort of account failure that forced them to get their rows out of sync
(in my cause I just unlinked a pending and then made sure to force all my
account datbases to commit pending files before upgrading - leading to an
upgraded cluster that absolutly needed account-replication to solve a row
mismatch for inactive accounts with old schemas)
Closes-Bug #1424108
Change-Id: Iaf4ef834eb24f0e11a52cc22b93a864574fabf83
commit 03380380efb5d5c0b2a3acfaa64b486ee2cb6e64
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Apr 23 19:39:16 2015 -0700
Simplify ring.builder.RingBuilder.\_\_deepcopy\_\_
Only container classes (lists, sets, dicts, graphs, collections,
etc) need to track objects they deepcopy in the memo dict -
particularly when they may contain other containers! As they
recreate a new container with the same items as themselves, they'll
reference the memo for each item they contain before making a
deepcopy of it, and place a reference to the copied item into memo
after they do. Trying to help out some other container class in
this endeavor by attempting to add ourselves to the memo dict in
some useful manor on their behalf however; is not helpful.
All we need to do to make sure we're being a good \_\_deepcopy\_\_
implementation is make sure we pass on memo to our calls of deepcopy
so that other container classes can avoid making additional
deepcopy's of our containers if they already have a memorized copy
(which would be odd since unique instances of RingBuilders aren't
expected to share state, but hey - python doesn't have private
attributes so you never know!)
Change-Id: Ifac444dffbf79d650b2d858f6282e05d8ea741a0
commit 43ace3c62893364b6e3c130df56438995627598d
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 12:17:56 2015 -0700
Make RingBuilders deep-copy-able
We used to be able to deep-copy RingBuilder objects, but the addition
of debug logging (8d3b3b2) broke that since you can't deep-copy a
Python logger. This commit fixes that.
Swift doesn't really deep-copy RingBuilders anywhere, but third-party
code might.
Change-Id: If8bdadd93d9980db3d8a093f32d76ca604de9301
commit 215cd551df8be066edafd2a1e16d0bd143ec214b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Apr 21 17:38:04 2015 -0700
Bulk upload: treat user xattrs as object metadata
Currently, if you PUT a single object, then you can also associate
metadata with it by putting it in the request headers, prefixed with
"X-Object-Meta". However, if you're bulk-uploading objects, then you
have no way to assign any metadata.
The tar file format\* allows for arbitrary UTF-8 key/value pairs to be
associated with each file in an archive (as well as with the archive
itself, but we don't care about that here). If a file has extended
attributes, then tar will store those as key/value pairs.
This commit makes bulk upload read those extended attributes, if
present, and convert those to Swift object metadata. Attributes
starting with "user.meta" are converted to object metadata, and
"user.mime\_type"\*\* is converted to Content-Type.
For example, if you have a file "setup.py":
$ setfattr -n user.mime\_type -v "application/python-setup" setup.py
$ setfattr -n user.meta.lunch -v "burger and fries" setup.py
$ setfattr -n user.meta.dinner -v "baked ziti" setup.py
$ setfattr -n user.stuff -v "whee" setup.py
This will get translated to headers:
Content-Type: application/python-setup
X-Object-Meta-Lunch: burger and fries
X-Object-Meta-Dinner: baked ziti
Swift will handle xattrs stored by both GNU and BSD tar\*\*\*. Only
xattrs user.mime\_type and user.meta.\* are processed; others are
ignored.
This brings bulk upload much closer to feature-parity with non-bulk upload.
\* The POSIX 1003.1-2001 (pax) format, at least. There are a few
different, mutually-incompatible tar formats out there, because of
course there are. This is the default format on GNU tar 1.27.1 or
later.
\*\* http://standards.freedesktop.org/shared-mime-info-spec/latest/ar01s02.html#idm140622087713936
\*\*\* Even with pax-format tarballs, different encoders store xattrs
slightly differently; for example, GNU tar stores the xattr
"user.rubberducky" as pax header "SCHILY.xattr.user.rubberducky",
while BSD tar (which uses libarchive) stores it as
"LIBARCHIVE.xattr.user.rubberducky". One might wonder if this is
some programmer's attempt at job security.
Change-Id: I5e3ce87d31054f5239e86d47c45adbde2bb93640
commit f8dee761bd36f857aa1288c27e095907032fad68
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:15:35 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Note: This is part of importing of translations, there are no new
translations for this project, thus only the pot file gets updated.
Change-Id: I0cbfdae3bd1662da54c58e91a13f49419eba9b2d
commit cd7c58e93690fd25f5266754d0593c656dd51e2e
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Closes-Bug: 1446801
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 281cb1c210f0292bad190cabaae447145fa5eade
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Closes-Bug: 1446727
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit 51e31c5c7147f3ba61437e132b12b491ca718ce4
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Apr 15 15:31:06 2015 -0700
Don't apply the wrong Etag validation to rebuilt fragments
Because of the object-server's interaction with ssync sender's
X-Backend-Replication-Headers when a object (or fragment archive) is
pushed unmodified to another node it's ETag value is duped into the
recieving ends metadata as Etag. This interacts poorly with the
reconstructor's RebuildingECDiskFileStream which can not know ahead of
time the ETag of the fragment archive being rebuilt.
Don't send the Etag from the local source fragment archive being used as
the basis for the rebuilt fragent archive's metadata along to ssync.
Closes-Bug: 1446800
Change-Id: Ie59ad93a67a7f439c9a84cd9cff31540f97f334a
commit 2080f7dbd897d6130542dbf88e37641a41625eb5
Author: Alistair Coles <alistair.coles@hp.com>
Date: Thu Feb 26 15:16:22 2015 +0000
Fix tempauth acl checks when simplejson has no speedups
As documented in linked bug report, tempauth unit tests
were seen to fail on a system where simplejson was
installed but without the speedups extension. This
is because the tempauth account acl validation checks
that values are type str, but without the speedups
extension the json parser is returning unicode objects.
Fix is to have the acl validator tolerate those objects
being unicode or str.
Also change common/bufferedhttp.py to coerce ring device
to type str when constructing a path, in order to avoid
a UnicodeDecodeError when httplib sends a message that
has non-ascii header values.
Change-Id: I01524282cbaa25dc4b6dfa09f3f4723516cdba99
Closes-Bug: 1425776
commit 27f6fba5c3b9e0461d52c1deffe32130e7e9af51
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 0c391d6daffe1943f6def803db42e08e6d6846d2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 16:47:10 2015 -0700
SAIO instructions: ensure ~/bin exists before copying into it
Change-Id: I16cd211b00b529ccc4b46f6b10497c32b6741896
commit c5c281ba6dd97a301ba80511e3356d6ca536d701
Author: Minwoo B <minwoob@us.ibm.com>
Date: Mon Apr 20 17:03:25 2015 -0500
Included step in development\_saio.rst for installing dependencies in requirements.txt.
Change-Id: I6ed1704148e5ae1e3164d10080c350d81856f7a9
commit 2203b46e3f14ef68a090aaea284f0a0442bbb86f
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit f6482bdece27144ee083a53d696469528d7940c2
Author: Thierry Carrez <thierry@openstack.org>
Date: Thu Apr 16 22:08:47 2015 +0200
Set default branch to stable/kilo
Open stable/kilo branch by setting defaultbranch for git-review.
Change-Id: I81bcda30f99173416eaaa3f1d42da32f3ab5b6d2
commit a2a5b6aa6664b61fa31d25f329426ff089372f17
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Apr 16 11:42:12 2015 -0700
Functional test for SLO PUT overwriting one of its own segments
Change-Id: I4855816848f4fdb148d0b82735cf79bc68429617
commit e4d326b5a7dd186d762726faa45733ff2900343d
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Thu Feb 19 17:38:10 2015 +0900
Fix conflict SLO reponse
This patch fixes Swift to respond "409 Conflict"
when a segment object path of the manifest on PUT SLO
is same as requested object path. It is because
the request will overwrite the segment and then it
will absolutely cause "409 Conflict" on GET SLO.
e.g.:
request:
PUT "http://hostname/v1/AUTH\_account/container/segment\_object\_00?multipart-manifest=put"
manifest file:
[{"path" : "container/segment\_object\_00", "etag" : "<etag of segment\_object\_00>", "size\_bytes" : <size of segment\_object\_00>},
{"path" : "container/segment\_object\_01", "etag" : "<etag of segment\_object\_01>", "size\_bytes" : <size of segment\_object\_01>},
{"path" : "container/segment\_object\_02", "etag" : "<etag of segment\_object\_02>", "size\_bytes" : <size of segment\_object\_02>}]
Change-Id: I4f4f7b9dbeb6a7c355b801c7e0ae560aa19a70b4
Closes-Bug: 1417936
commit 38ae7bb89c95292c171cb89c1d62859cee0cc24f
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Apr 15 23:03:21 2015 +0100
Make the reaper use same timestamp for replica deletes
The account reaper is using a unique timestamp when deleting
replicas of the same resource. This will result in unnecessary
replication traffic after reaping.
This patch makes the reaper use a single timestamp per resource.
Probe test is modified to check that delete times are equal
across replicas before replicators run.
test\_direct\_client.py is modified to check that it uses explicit
timestamp when passed to direct\_delete\_[object|container]
methods.
Drive-by bug fixes in the probe test e.g. it was not sending
X-Backend-Storage-Policy-Index when doing a direct GET to check
object state, so the 404s being verified could in fact be due
to diskfile not existing rather than diskfile being deleted.
Closes-Bug: 1442879
Change-Id: I8bab22d66308bb9d3294e1e0def017c784228423
commit 9c33bbde6923b26f111572ae967a3b97a8ab12f2
Author: Prashanth Pai <ppai@redhat.com>
Date: Tue Jan 20 12:14:32 2015 +0530
Allow rsync to use compression
From rsync's man page:
-z, --compress
With this option, rsync compresses the file data as it is sent to the
destination machine, which reduces the amount of data being transmitted --
something that is useful over a slow connection.
A configurable option has been added to allow rsync to compress, but only
if the remote node is in a different region than the local one.
NOTE: Objects that are already compressed (for example: .tar.gz, .mp3)
might slow down the syncing process.
On wire compression can also be extended to ssync later in a different
change if required. In case of ssync, we could explore faster
compression libraries like lz4. rsync uses zlib which is slow but offers
higher compression ratio.
Change-Id: Ic9b9cbff9b5e68bef8257b522cc352fc3544db3c
Signed-off-by: Prashanth Pai <ppai@redhat.com>

| **tags**: | added: in-feature-hummingbird |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-24:  [**Fix proposed to swift (feature/crypto)**](/swift/%2Bbug/1466549/comments/14) |  |  | [#14](/swift/%2Bbug/1466549/comments/14) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/205579>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/205579

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-24:  [**Fix merged to swift (feature/crypto)**](/swift/%2Bbug/1466549/comments/15) |  |  | [#15](/swift/%2Bbug/1466549/comments/15) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/swift/%2Bbug/1466549/comments/15/%2Bdownload) (80.5 KiB)

Reviewed: <https://review.openstack.org/205579>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=8ab46b64365b8eab80680f2562f81e8adb3032a3>

Submitter: Jenkins

Branch: feature/crypto

commit 89f705e8aab144092d40a13fc4ef19ffef5f3eba

Author: OpenStack Proposal Bot <email address hidden>

Date: Thu Jul 23 06:11:27 2015 +0000

Imported Translations from Transifex

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I94cf347564cb33977f33b1e64259bcb39a8cf809

commit a65e9db8752793ec37b594dc9eca5066171825db

Author: Christian Schwede <email address hidden>

Date: Wed Jul 22 10:43:17 2015 +0000

Removing commented out code in test/unit/account/test\_backend.py

Noticed this while reviewing another change. Looks like the test itself already

    ensures correct functionality of the reclaim() method in AccountBroker without

    the commented code, thus removing this stale code.

Change-Id: I6a26a7591adef9fd794ca68a4e9c493d1127f93c

commit 99d052772a9585e0befdfd292fd03aefde77180a

Author: Kota Tsuyuzaki <email address hidden>

Date: Mon Jul 13 01:12:43 2015 -0700

Fix 499 client disconnected on COPY EC object

Currently, a COPY request for an EC object might go to fail as 499 Client

    disconnected because of the difference between destination request content

    length and actual transferred bytes.

That is because the conditional response status and content length for

    an EC object range GET is handled at calling the response instance on

    proxy server. Therefore the calling response instance (resp()) will change

    the conditional status from 200 (HTTP\_OK) to 206 (PartialContent) and will

    change the content length for the range GET.

In EC case, sometimes Swift needs whole stored contents to decode a segment.

    It will make 200 HTTP OK response from object-server and proxy-server

    will unfortunately set whole content length to the destination content

    length and it makes the [bug 1467677](/bugs/1467677).

This patch introduces a new method "fix\_conditional\_response" for

    swift.common.swob.Response that calling \_response\_iter() and cached the

    iter in the Response instance. By calling it, Swift can set correct condtional

    response any time after setting whole content\_length to the response

    instance like EC case.

Change-Id: If85826243f955d2f03c6ad395215c73daab509b1

    Closes-Bug: #1467677

commit 62ed4f81ef80440550633eaaaa962a4f9383c2d3

Author: Timur Alperovich <email address hidden>

Date: Tue Jul 14 16:56:44 2015 -0700

Add two functional tests for delimiter.

The first test verifies that a delimiter will trim entries beyond the

    first matching instance of delimiter (after the given matching prefix,

    if any) and squash duplicates. So, when setting the delimiter

    to "-", given blobs "test", "test-foo" and "test-bar-baz", we expect

    only "test" (no matching delim) and "test-" (trim all characters after

    the first "-", and squash duplicates).

The second test verifies that when a prefix is provid...

Reviewed: https://review.openstack.org/205579
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=8ab46b64365b8eab80680f2562f81e8adb3032a3
Submitter: Jenkins
Branch: feature/crypto
commit 89f705e8aab144092d40a13fc4ef19ffef5f3eba
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 23 06:11:27 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I94cf347564cb33977f33b1e64259bcb39a8cf809
commit a65e9db8752793ec37b594dc9eca5066171825db
Author: Christian Schwede <cschwede@redhat.com>
Date: Wed Jul 22 10:43:17 2015 +0000
Removing commented out code in test/unit/account/test\_backend.py
Noticed this while reviewing another change. Looks like the test itself already
ensures correct functionality of the reclaim() method in AccountBroker without
the commented code, thus removing this stale code.
Change-Id: I6a26a7591adef9fd794ca68a4e9c493d1127f93c
commit 99d052772a9585e0befdfd292fd03aefde77180a
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jul 13 01:12:43 2015 -0700
Fix 499 client disconnected on COPY EC object
Currently, a COPY request for an EC object might go to fail as 499 Client
disconnected because of the difference between destination request content
length and actual transferred bytes.
That is because the conditional response status and content length for
an EC object range GET is handled at calling the response instance on
proxy server. Therefore the calling response instance (resp()) will change
the conditional status from 200 (HTTP\_OK) to 206 (PartialContent) and will
change the content length for the range GET.
In EC case, sometimes Swift needs whole stored contents to decode a segment.
It will make 200 HTTP OK response from object-server and proxy-server
will unfortunately set whole content length to the destination content
length and it makes the bug 1467677.
This patch introduces a new method "fix\_conditional\_response" for
swift.common.swob.Response that calling \_response\_iter() and cached the
iter in the Response instance. By calling it, Swift can set correct condtional
response any time after setting whole content\_length to the response
instance like EC case.
Change-Id: If85826243f955d2f03c6ad395215c73daab509b1
Closes-Bug: #1467677
commit 62ed4f81ef80440550633eaaaa962a4f9383c2d3
Author: Timur Alperovich <timur.alperovich@gmail.com>
Date: Tue Jul 14 16:56:44 2015 -0700
Add two functional tests for delimiter.
The first test verifies that a delimiter will trim entries beyond the
first matching instance of delimiter (after the given matching prefix,
if any) and squash duplicates. So, when setting the delimiter
to "-", given blobs "test", "test-foo" and "test-bar-baz", we expect
only "test" (no matching delim) and "test-" (trim all characters after
the first "-", and squash duplicates).
The second test verifies that when a prefix is provided, the delimiter
will trim entries beyond the first matching instance of the delimiter
\*after the given prefix\*. So "bar, "bazar" which both match the
prefix "ba" will be returned as "bar" (no delimiter after the matching
prefix) and "baza" (after matching the prefix the remainder after the
the \*next\* matching delimiter "a" is trimmed).
Change-Id: I49a2aa8722f83e87b7d211e5c26827e93963d92a
commit 2d6c5fe2afde382edb8f04c91fca1911601b61d9
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 21 09:56:13 2015 -0700
Fix Associated Projects link on Getting Started
Change-Id: I50be656bc5868242489f97c96a1feaef171933e0
commit cd7b2db550e41412281da0256b468c90ebcf3e8b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 21 19:23:00 2015 +0530
unit tests: Replace "self.assert\_" by "self.assertTrue"
The assert\_() method is deprecated and can be safely replaced by assertTrue().
This patch makes sure that running the tests does not create undesired
warnings.
Change-Id: I0602ba39ef93263386644ee68088d5f65fcb4a71
commit c3cc98b2c918476f1b54924e0c54e4c746eba4ac
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jul 20 17:03:20 2015 -0700
Add comment about ResumingGetter.used\_source\_etag
This confused a couple developers and took about ten minutes to
unravel in IRC; let's leave a clue for the next person.
Change-Id: I356c8c7a44de23f02eaf68d23a39c9eb4c203ff1
commit 06326d74657a8796439988115002298e4a5f4630
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jul 20 21:41:58 2015 +0530
Metaclass Python 3.x Compatibility
use "six.add\_metaclass" instead of "\_\_metaclass\_\_"
Change-Id: I57390fec40afe3a965be3215db8f79b9cf862a70
commit 317fa1af49d72ecaf7a9a499d8cdf00a086b4c6f
Author: Azhagu Selvan SP <tamizhgeek@gmail.com>
Date: Sat Jul 18 14:37:16 2015 +0530
Minor change in development saio setup doc
Make the test-requirements install command uniform with the rest of the
setup commands in the page by using the $HOME, instead of hardcoding
the folder path.
Change-Id: I8da7a191a301601e27f894f8268238d77b150ede
commit faff98efd47fd59e28b1adb3e7ad4bc3dc6dd781
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Thu Jul 9 07:35:47 2015 +0530
Replace python print operator with print function (pep H233, py33)
'print' function is compatible with 2.x and 3.x python versions
Link : https://www.python.org/dev/peps/pep-3105/
Python 2.6 has a \_\_future\_\_ import that removes print as language syntax,
letting you use the functional form instead
Change-Id: I9d9ca5766a2773a7b4071e280f00361d16b85383
commit 8753e452b04b0af6d6b444184b628724e14fbbb1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed May 27 18:01:37 2015 +0200
Replace StringIO with BytesIO for WSGI input
wsgi.input is a binary stream (bytes), not a text stream (unicode).
\* Replace StringIO with BytesIO for WSGI input
\* Replace StringIO('') with StringIO() and replace WsgiStringIO('') with
WsgiStringIO(): an empty string is already the default value
Change-Id: I09c9527be2265a6847189aeeb74a17261ddc781a
commit 6e70f3fa322da70c2a65fb919d200e52fc5add8a
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed May 27 17:27:47 2015 +0200
Get StringIO and cStringIO from six.moves
\* replace "from cStringIO import StringIO"
with "from six.moves import cStringIO as StringIO"
\* replace "from StringIO import StringIO"
with "from six import StringIO"
\* replace "import cStringIO" and "cStringIO.StringIO()"
with "from six import moves" and "moves.cStringIO()"
\* replace "import StringIO" and "StringIO.StringIO()"
with "import six" and "six.StringIO()"
This patch was generated by the stringio operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Change-Id: Iacba77fec3045f96773d1090c0bd48613729a561
commit 51f806d3e3d3a1fcbc80d2f7d7ddbe5cc4c024c9
Author: John Dickinson <me@not.mn>
Date: Tue Jul 14 20:49:08 2015 -0700
remove Python 2.6 from the classifier
Change-Id: I67233e9c7b69826242546bd6bd98c24b81070579
commit 278adf5c20101a191979ce1e4d6277e5f209149e
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jul 14 15:33:45 2015 +0900
Make logic of unit tests responsive to the method names
The two methods, test\_authorize\_succeeds\_for\_tenant\_name\_in\_roles and
test\_authorize\_succeeds\_for\_tenant\_id\_in\_roles, have names that don't
match what they are testing. tenant\_name and tenant\_id need to be
switched.
Change-Id: I7cb0a7d2b2111127fd5d6b55f2da6a3eadf2235d
commit 1cc3eff958fdd4fb07c2b74c52df7829d3125466
Author: Victor Stinner <vstinner@redhat.com>
Date: Fri Jul 10 13:04:44 2015 +0200
Fixes for mock 1.1
The new release of mock 1.1 is more strict. It helped to find bugs in
tests.
Closes-Bug: #1473369
Change-Id: Id179513c6010d827cbcbdda7692a920e29213bcb
commit ff192cfe5705324497a389aa2f22227d75dc0f8e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jul 8 18:38:22 2015 +0530
Replace reduce and unichr , these are no longer available in py3
\* Replace reduce() with six.moves.reduce()
\* Replace unichr with six.unichr
Change-Id: I2038e47e0a6522dd992fd2a4aeff981cf7750fe0
commit 4beceab4f4be99f14025815cf7ed4510ea77f460
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 9 06:14:56 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9ff1dde06be45fc7d6c441a1e1c07221f839a9a1
commit 56ee39a7e13417203c5e1816d7a3184a07f85826
Author: Matthew Oliver <matt@oliver.net.au>
Date: Thu Jul 9 15:19:32 2015 +1000
Ring builder code clean up follow up patch
This is a simple change that cleans up a NIT from Sam's 'stop moving
partitions unnecessarily when overload is on' patch.
Change-Id: I9d9f1cc23e2bb625d8e158f4d3f64e10973176a1
commit 6cafd0a4c0bb8f311fc59df580b42e801214effd
Author: Oshrit Feder <oshritf@il.ibm.com>
Date: Wed Jul 8 15:18:22 2015 +0300
Fix Container Sync example
Container-sync realm uses cluster\_ as a prefix to specify clusters'
names. At use, the prefix should not be included. Fixing the examples
and sample conf to make it clearer that only the name of the cluster
should be passed.
Change-Id: I2e521d86faffb59e1b45d3f039987ee023c5e939
commit 125238612f58481316db68d7087252bb7729f447
Author: Janie Richling <jrichli@us.ibm.com>
Date: Sat Jul 4 17:08:32 2015 -0500
Add CORS unit tests to base
In earlier versions of swift when a request was made with an
existing origin, but without any CORS settings in the container,
it was possible to get an unhandled exception due to a method call
on the "None" return of cors.get('allow\_origin', '').
Unit tests have been added to assert that this problem cannot go
undetected again.
Change-Id: Ia74896dabe1cf5a307c551b15a43ab1fd789c213
Fixes: bug 1468782
commit e87a74695e2f55dbb0e01721de9d46e230e36008
Author: John Dickinson <me@not.mn>
Date: Sat Jun 6 13:03:15 2015 -0700
add domain\_remap to /info
Also added the value of default\_reseller\_prefix to /info. I did not
add the reseller\_prefixes value to /info because deployers may not
want to expose all of the resellers that are available.
Change-Id: I9ca2f002dc395913bb646390d6908dfb8f554df1
commit 12473104f005b76ebe4b6dbe118a5ac37518eb52
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 7 18:02:53 2015 -0700
Cleanup error messages in ECDiskFileWriter.commit
I think the error messages make better sense and it's more obvious what the
error handling code was trying to bring to the surface for operators.
If you run this test with nosetests --verbose --nocapture
test\_diskfile.py:TestECDiskFile.test\_commit\_fsync\_dir\_raises\_DiskFileErrors
... you can review most of the potential log output
Change-Id: I40c9d77f44e087ee61d9642e924b0a4039d6ca9a
commit bd3717df65f57da9e7f06292ba349442d17fc939
Author: John Dickinson <me@not.mn>
Date: Thu Jul 2 09:54:30 2015 -0700
update AUTHORS file
Change-Id: I509ceeb522bd83c407beb40c22c2924a1d92b8ff
commit cd20961abd20f01a14554c14d4f61a7f0d8deb88
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Jul 5 10:59:50 2015 +0530
Replace dict.iteritems() with dict.items() in bin directory of swift.
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3.
Change-Id: I4bdc064c90bab56cd60f2dca2a5a78426ffbb31c
commit 8eca02d3a1db1e0ed68b15ed41bc62e6c89870c7
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:45:58 2015 +0530
Replace xrange() with six.moves.range()
xrange is no longer available in py3.
replacing xrange with range from six.moves
Change-Id: Ib863c316a0724bd9c4f53c2e5a8d1bcd42c4dc5a
commit 10f367224d5f30c3398169ffe3087f225f3343fc
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:05:36 2015 +0530
Fix Python 3 issues
\* Replace long with six.integer\_type
six.integer\_type :In Python 2, this is long and int, and in Python 3,
just int.
'long' is an undefined variable in py3.
Change-Id: Ibe4c5d0d81fe883f4fe33be93a68d814a228ad28
commit 2328983b7535d24d08942e62095b4346f2626566
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jun 24 17:07:32 2015 -0700
Stop moving partitions unnecessarily when overload is on.
When overload was on and in use, the ring builder was unnecessarily
moving partitions. It would converge on a good solution and settle
down eventually, but it moved more partitions than necessary along the
way.
There are three partition gatherers used in the ring builder:
dev-removed, dispersion, and weight, in that order. The dev-removed
gatherer will pick up all partitions on removed devices. The
dispersion gatherer picks up replicas of partitions that are
suboptimally dispersed. The weight gatherer picks up partitions on
devices which are overweight.
The weight gatherer was not overload-aware, so it would pick up
partitions that did not need to move. Consider a device that would
normally have 100 partitions assigned, assume we set overload to 0.1
so that this device will hold up to 110 (10 extra) for the sake of
dispersion, and assume the device actually has 104 partitions assigned
to it. The correct behavior is to gather nothing from this device
because it has fewer than the maximum. Prior to this commit, the
weight gatherer would remove 4 partitions from this device; they would
subsequently be reassigned by the overload-aware partition placer
(\_reassign\_parts()). In a ring with multiple overloaded devices, the
builder would pick up some partitions from each, shuffle them, and
then assign them back to those same devices. Obviously, this just
created extra replication work for no benefit.
Now, the weight gatherer takes overload into account, and will no
longer needlessly gather partitions.
That's not all, though; this change worsened the behavior of a ring
with more overload than necessary. Before, the ring would balance as
best it could, using the minimal amount of overload. With the
weight-gatherer change, the ring builder will stop gathering
partitions once a device reaches its maximum-permissible assignment
including overload.
For example, imagine a 3-replica, 4-zone ring with overload=0.2 and
weights:
z1: 100
z2: 60
z3: 60
z4: 60
Since z1 has more than 1/3 of the weight, z2, z3, and z4 must take
more than their fair share for the sake of dispersion.
Now, turn up the weights some:
z1: 100
z2: 80
z3: 80
z4: 80
Overload is no longer needed; this ring can balance. However, z2, z3,
and z4 would end up keeping more than their fair share since (a) they
already had extra due to earlier conditions, and (b) the weight
gatherer won't pick up partitions from them since they're not
overburdened once it takes overload into account.
To fix this, we compute the minimum overload factor required for
optimal dispersion and then use min(user-input-overload,
minimum-overload) during rebalance. This way, we don't overload
devices more than the user says, but if the user sets overload higher
than necessary, we'll still give the best balance possible.
Change-Id: If5666ba654ee25da54f9144f3b78840273a49627
commit ccf0758ef1f362312a6197f86455f680ebd990d3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 11 15:40:28 2015 -0700
Add ring-builder analyzer.
This is a tool to help developers quantify changes to the ring
builder. It takes a scenario (JSON file) describing the builder's
basic parameters (part\_power, replicas, etc.) and a number of
"rounds", where each round is a set of operations to perform on the
builder. For each round, the operations are applied, and then the
builder is rebalanced until it reaches a steady state.
The idea is that a developer observes the ring builder behaving
suboptimally, writes a scenario to reproduce the behavior, modifies
the ring builder to fix it, and references the scenario with the
commit so that others can see that things have improved.
I decided to write this after writing my fourth or fifth hacky one-off
script to reproduce some bad behavior in the ring builder.
Change-Id: I114242748368f142304aab90a6d99c1337bced4c
commit e860ec138913dc4c450725766a77e76a7101d06e
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 29 10:11:44 2015 +0000
Ignore invalid PIDs in swift-init
While reviewing ab9f6340 I recognized that invalid pids in the pid files raise
an exceptions (in case it is not a number), and also accept a 0 that is
impossible to use as a pid for any Swift process. In the latter case the process
was recognized as runnning, even if it did not - and thus restarting didn't
worked.
This patch ensures a better handling of any non-numeric value and also removes a
pid file if it uses 0 as the pid.
Change-Id: I09c415c7a75e4b9a0574a08f46f48fff5bb11d02
commit 0a6f2ab870a868e3036dbb212c0e7dd8375a39eb
Author: asettle <alexandra.settle@rackspace.com>
Date: Fri Jun 26 10:57:35 2015 +1000
Correcting minor grammatical errors
1. Removing unnecessary semi colon
2. Removing unnecessary content
Change-Id: Ie95403a4d96db2b8465e75495061fc059098c922
commit 4d4db054d35c7e9de9ed28ac24965e8408dd9f82
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Mon May 18 14:08:25 2015 -0500
After the .durable has been written, fsync the directory.
Added try-except statements in \_finalize\_durable() to fsync the directory
after a successful fsync of the .durable file.
Added test\_commit\_fsync\_dir\_raises\_DiskFileErrors() for testing whether
certain assertions hold for the change to include fsync\_dir().
Some more error details have been included in the logger.
Closes-Bug: #1470651
Change-Id: I4791d75ade8542678369ba0811ef39af6e955cc6
commit d4d7c0e1b11af8f20f965f410901a56e1f8ee69e
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jun 30 17:24:13 2015 -0700
Fix race in test\_server.TestObjectController.test\_PUT\_ssync\_multi\_frag
If the test ran across a one second boundary it would fail because while
the timestamp normalization was doing some rounding it was making no
attempt to reuse the same timestamp on subsequent requests.
Change-Id: Ic560032bcfacd6f0d10cfc0f4f10e5d6c2bc8dd5
commit a88bd6e6b9253b6488a2bf1a354ce29b51f37fe1
Author: ZhiQiang Fan <aji.zqfan@gmail.com>
Date: Sun Jun 28 22:04:46 2015 -0700
fix api overview document
The content about Object Storage HTTP requests constraints seems to
be a table but broken, this patch fixes it into correct rst table format.
Change-Id: I1b4c62da3e6d91add3ee0218707c1628c8f04b33
commit c95a0efe7973a660f4abcd13f4ea6211d72c4baa
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:44:10 2015 -0700
Make ssync\_sender a better HTTP client
When a server responses with an error - if that error includes a body - the
client should read the body. This cleans up some ugly eventlet/wsgi.server log
output related to chunked transfer disconnect (invalid literal for int() with
base 16).
Change-Id: Ibd06ddee9f216fce07fa33c3a7d8306b59eb6d77
Closes-Bug: #1466138
commit 44b76a1b1b83ac9563010f1ddfca5fca76e567bf
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Thu Jun 18 14:21:06 2015 -0500
EC Reconstructor: Do not reconstruct existing fragments.
The EC reconstructor needs to verify that the fragment needing to
be reconstructed does not reside in the collection of node responses.
Otherwise, resources will be spent unnecessarily reconstructing
the fragment. Moreover, this could cause a segfault on some backends.
This change adds the necessary verification steps to make sure
that a fragment will only be rebuilt in the case it is missing from
the other fragment archives.
Added some tests to provide coverage for these scenarios.
Change-Id: I91f3d4af52cbc66c9f7ce00726f247b5462e66f9
Closes-Bug: #1452553
commit d124ce5792d93e1efcdb083211ecef381f7b7173
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:35:07 2015 -0700
Fix ValueError in ssync\_receiver
httplib's putheader method will cast whatever you give it to a string.
where we allow the default dict.get default of None to be passed to
putheader unmodified ssync\_receiver is surpised that the non-empty
string isn't able to be converted to an integer.
We can avoid surprising the ssync\_receiver in this way by sending the
empty string as a better default.
Change-Id: Ie9df9927ff4d3dd3f334647f883b2937d0d81030
commit edfca861b6fa39972df276fb1f37aa81583a605d
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri Jun 26 08:54:22 2015 +0000
Increase httplib.\_MAXHEADERS
Python 2.7.9+ and 3.2.6+ limits the number of maximum headers in httplib to 100
[1,2,3]. This setting is too low for Swift.
By default the maximum number of allowed headers depends on the number of max
allowed metadata settings plus a default value of 32 for regular http headers.
If for some reason this is not enough (custom middleware for example) it can be
increased with the extra\_header\_count constraint.
[1] https://bugs.python.org/issue16037
[2] https://hg.python.org/cpython/raw-file/15c95b7d81dc/Misc/NEWS
[3] https://hg.python.org/cpython/raw-file/v3.2.6/Misc/NEWS
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Co-Authored-By: Thomas Herve <therve@redhat.com>
Change-Id: I388fd697ec88476024b0e9f1ae75ba35ff765282
commit 81ceee056de604d81a921280f453731eadf7be09
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jun 22 23:24:19 2015 -0700
Add one more test for ssync\_receiver
To prevent 409 conflict on a primary node during ssyncing,
ssync-receiver should add x-ssync-backend-frag-index generated from
x-ssync-backend-node-index of the SSYNC replication request header.
The change is done by previous work[1], but we need more test for that.
This patch addes one more assertion if the x-ssync-backend-frag-index
is in the ssync subrequest correctly.
\*BONUS\*
Fix some weird mock and add some sanities.
1: https://review.openstack.org/#/c/191521/
Change-Id: I27aff713c69017c0bc4c60b4833184e1285595d7
commit c2c1366b0794bcdbbbaef7fedaef2cab19cd8db8
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jun 24 21:07:16 2015 +0530
Fixed Errors in Swift-Form Post middleware section rst.
Inline markup cannot be nested in RST.
Fixing markups by using a single option for the whole line and making
some minor error corrections.
Change-Id: I42bfd7dfe5c93a69436ecc5d154f2e61ca83fa82
commit 514daea6317edc02587f7abfaae8770e1ef9cc4b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jun 12 23:40:51 2015 +0530
Fixed Formatting Error in Swift -Form Post middleware section.
Fixed Formatting error in ``action=”SWIFT\_URL``” => action=”``SWIFT\_URL``”
Change-Id: Id461129ef7f5b6412f94d36920c942a4181c0eb7
Closes-Bug: #1464740
commit e70b66586e13718e7ac0078c2f2cd1135c61a1f1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed Jun 24 09:36:37 2015 +0200
Replace dict.iteritems() with dict.items()
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3. According to a discussion on the openstack-dev mailing list,
the overhead of creating a temporary list using dict.items() on Python 2
is very low because most dictionaries are small:
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066391.html
Patch generated by the following command:
sed -i 's,iteritems,items,g' \
$(find swift -name "\*.py") \
$(find test -name "\*.py")
Change-Id: I6070bb6c684be76e8e77222a7d280ec6edd43496
commit e6165a7879d796efd3992260ef23a7f95ceeab32
Author: paul luse <paul.e.luse@intel.com>
Date: Mon May 25 14:41:42 2015 -0700
Add policy support to dispersion tools
Doesn't work for anything other than policy 0. updated to allow user
to specify policy name on cmd line (as with object-info) which
then makes populate/report work with 3x, 2x, or EC style policies
Change-Id: Ib7c298f0f6d666b1ecca25315b88539f45cf9f95
Closes-Bug: 1458688
commit e5c962a28ce99f01c6cd0b68b7434ddcd0e55f62
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon May 25 18:28:02 2015 +0200
Replace xrange() with six.moves.range()
Patch generated by the xrange operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Manual changes:
\* Fix indentation for pep8 checks
\* Fix TestGreenthreadSafeIterator.test\_access\_is\_serialized of
test.unit.common.test\_utils:
replace range(1, 11) with list(range(1, 11))
\* Fix UnsafeXrange docstring, revert change
Change-Id: Icb7e26135c5e57b5302b8bfe066b33cafe69fe4d
commit 4a5b851207c98a380a32e27a183dd98022be9d16
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 22 14:48:41 2015 +0200
Add note about updatedb to the docs
Change-Id: Ia1aa0bb1f93ee487e2f7ddf76a7a08efa8f3ba41
commit ac8a76958510646c369df9ffc2bf22005e43d153
Author: paul luse <paul.e.luse@intel.com>
Date: Sat Jun 13 11:03:56 2015 -0700
EC Ssync: Update parms to include node and frag indices
Previously we sent the ssync backend frag index based on the node
index. We need to be more specific for ssync to handle both sync
and revert cases so now we send the frag index based on the job
contents (as determined by the ec recon)) and the node index
as a new header based on, well, the node index.
The rcvr can now validate the incoming pair to reject (400) when
a primary node is being asked to accept fragments that don't
belong to it. Additionally, by having the frag index the
rcvr can reject (409) an attempt to accept a fragment when its
a handoff and already has one that needs to be reverted.
Fixes-bug: #1452619
Change-Id: I8287b274bbbd00903c1975fe49375590af697be4
commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
Closes-Bug: #1466549
commit df134df901a13c2261a8205826ea1aa8d75dc283
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu May 14 22:14:15 2015 -0700
Allow 1+ object-servers-per-disk deployment
Enabled by a new > 0 integer config value, "servers\_per\_port" in the
[DEFAULT] config section for object-server and/or replication server
configs. The setting's integer value determines how many different
object-server workers handle requests for any single unique local port
in the ring. In this mode, the parent swift-object-server process
continues to run as the original user (i.e. root if low-port binding
is required), binds to all ports as defined in the ring, and forks off
the specified number of workers per listen socket. The child, per-port
servers drop privileges and behave pretty much how object-server workers
always have, except that because the ring has unique ports per disk, the
object-servers will only be handling requests for a single disk. The
parent process detects dead servers and restarts them (with the correct
listen socket), starts missing servers when an updated ring file is
found with a device on the server with a new port, and kills extraneous
servers when their port is found to no longer be in the ring. The ring
files are stat'ed at most every "ring\_check\_interval" seconds, as
configured in the object-server config (same default of 15s).
Immediately stopping all swift-object-worker processes still works by
sending the parent a SIGTERM. Likewise, a SIGHUP to the parent process
still causes the parent process to close all listen sockets and exit,
allowing existing children to finish serving their existing requests.
The drop\_privileges helper function now has an optional param to
suppress the setsid() call, which otherwise screws up the child workers'
process management.
The class method RingData.load() can be told to only load the ring
metadata (i.e. everything except replica2part2dev\_id) with the optional
kwarg, header\_only=True. This is used to keep the parent and all
forked off workers from unnecessarily having full copies of all storage
policy rings in memory.
A new helper class, swift.common.storage\_policy.BindPortsCache,
provides a method to return a set of all device ports in all rings for
the server on which it is instantiated (identified by its set of IP
addresses). The BindPortsCache instance will track mtimes of ring
files, so they are not opened more frequently than necessary.
This patch includes enhancements to the probe tests and
object-replicator/object-reconstructor config plumbing to allow the
probe tests to work correctly both in the "normal" config (same IP but
unique ports for each SAIO "server") and a server-per-port setup where
each SAIO "server" must have a unique IP address and unique port per
disk within each "server". The main probe tests only work with 4
servers and 4 disks, but you can see the difference in the rings for the
EC probe tests where there are 2 disks per server for a total of 8
disks. Specifically, swift.common.ring.utils.is\_local\_device() will
ignore the ports when the "my\_port" argument is None. Then,
object-replicator and object-reconstructor both set self.bind\_port to
None if server\_per\_port is enabled. Bonus improvement for IPv6
addresses in is\_local\_device().
This PR for vagrant-swift-all-in-one will aid in testing this patch:
https://github.com/swiftstack/vagrant-swift-all-in-one/pull/16/
Also allow SAIO to answer is\_local\_device() better; common SAIO setups
have multiple "servers" all on the same host with different ports for
the different "servers" (which happen to match the IPs specified in the
rings for the devices on each of those "servers").
However, you can configure the SAIO to have different localhost IP
addresses (e.g. 127.0.0.1, 127.0.0.2, etc.) in the ring and in the
servers' config files' bind\_ip setting.
This new whataremyips() implementation combined with a little plumbing
allows is\_local\_device() to accurately answer, even on an SAIO.
In the default case (an unspecified bind\_ip defaults to '0.0.0.0') as
well as an explict "bind to everything" like '0.0.0.0' or '::',
whataremyips() behaves as it always has, returning all IP addresses for
the server.
Also updated probe tests to handle each "server" in the SAIO having a
unique IP address.
For some (noisy) benchmarks that show servers\_per\_port=X is at least as
good as the same number of "normal" workers:
https://gist.github.com/dbishop/c214f89ca708a6b1624a#file-summary-md
Benchmarks showing the benefits of I/O isolation with a small number of
slow disks:
https://gist.github.com/dbishop/fd0ab067babdecfb07ca#file-results-md
If you were wondering what the overhead of threads\_per\_disk looks like:
https://gist.github.com/dbishop/1d14755fedc86a161718#file-tabular\_results-md
DocImpact
Change-Id: I2239a4000b41a7e7cc53465ce794af49d44796c6
commit af72881d1dcc46486d8d652b92a0ec9aa9ca2bfa
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jun 15 13:36:36 2015 -0700
Use just IP, not port, when determining partition placement
In the ring builder, we place partitions with maximum possible
dispersion across tiers, where a "tier" is region, then zone, then
IP/port,then device. Now, instead of IP/port, just use IP. The port
wasn't really getting us anything; two different object servers on two
different ports on one machine aren't separate failure
domains. However, if someone has only a few machines and is using one
object server on its own port per disk, then the ring builder would
end up with every disk in its own IP/port tier, resulting in bad (with
respect to durability) partition placement.
For example: assume 1 region, 1 zone, 4 machines, 48 total disks (12
per machine), and one object server (and hence one port) per
disk. With the old behavior, partition replicas will all go in the one
region, then the one zone, then pick one of 48 IP/port pairs, then
pick the one disk therein. This gives the same result as randomly
picking 3 disks (without replacement) to store data on; it completely
ignores machine boundaries.
With the new behavior, the replica placer will pick the one region,
then the one zone, then one of 4 IPs, then one of 12 disks
therein. This gives the optimal placement with respect to durability.
The same applies to Ring.get\_more\_nodes().
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ibbd740c51296b7e360845b5309d276d7383a3742
commit 09e7477a391e7425af62a6516f43c69bc98b7080
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jun 15 22:10:45 2015 +0530
Replace it.next() with next(it) for py3 compat
The Python 2 next() method of iterators was renamed to \_\_next\_\_() on
Python 3. Use the builtin next() function instead which works on Python
2 and Python 3.
Change-Id: Ic948bc574b58f1d28c5c58e3985906dee17fa51d
commit 5ad369c1cb0f480b164a5b5e7eb194081835c266
Author: Victor Stinner <vstinner@redhat.com>
Date: Tue Jun 9 00:22:12 2015 +0200
Add six requirement
The six module is needed to add Python 3 support to Swift.
Change-Id: Ie637ed3458c7ff56c26834bca73203ed55604d74
commit 037a0c5dbe01a57b741d34988e21f4f763b6204b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jun 6 17:42:41 2015 +0530
Object are sorted and concatenated by swift in cardinal order.
Modified values in example in decimal to be more precise,
added a small description on Object are sorted and concatenated
by swift in cardinal order as a small phrase would be sufficient.
Change-Id: I914ded4e5726e50bb93b05759c3bfb76edda53ab
backport: none
Closes-Bug: #1383893
commit 11e5c4adf0e02c8fdab0d8584fc943d96e1165cd
Author: Koert van der Veer <koert@cloudvps.com>
Date: Tue Dec 16 11:15:19 2014 +0100
Allow default reseller prefix in domain\_remap middleware
Previously, the reseller prefix needed to be provided in the host name
even when the domain was unique to that reseller. With the
default\_reseller\_prefix, any domain which matches in this middleware,
will will be passed on with a reseller prefix, whether or not it was
provided.
Change-Id: I5aa5ce78ad1ee2e3660cce4c3e07306f8999f02a
Implements: blueprint domainremap-reseller-domains
commit c953e8cc9049e94cd01239d5e4a30a56f26a97d3
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Tue Apr 28 13:18:32 2015 -0500
The hash\_cleanup\_listdir function should only be called when necessary.
Introduced a conditional that will specify to \_finalize\_put() whether
the put() method is being called within the context of ECDiskFileWriter.
Included some unit tests that will test the number of calls to
hash\_cleanup\_listdir() during put(), commit(), and delete()
operations.
Change-Id: I287b2648591fdbf686898dc9047beda80a64da0c
commit 93de6c73e587a672663fa0997f439b73b336769c
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jun 2 17:00:42 2015 +0900
Add metadata size tests on the border
This patch adds a test for a 204 when a single metadata item in a POST causes
the backend aggregate constraints check to be on the border.
Background:
Overall metadata size constraint is enforced in the container and
account backends as well as in the proxy controllers.
Whereas the proxy controller can check that constraints are not exceeded
by a single PUT or POST request, the backend checks that constraints are not
exceeded by the aggregate of all PUTs and POSTs.
The change [1] added a test for a 400 when a single metadata item in
a POST causes the backend aggregate constraints check to go over limit.
[1] I1489e29686013cbd3d70283d8756b548aea3c2e1
Change-Id: Iac86ea71240ddde177e625c279c21aef67659d10
commit af734b3fb6fdbc11b8a0b775256e7642eb485b8d
Author: Mark Seger <Mark.Seger@hp.com>
Date: Wed Jun 3 08:16:06 2015 -0400
Change usage help and Attention messages to warnings
Change-Id: I1396aaffe36e739606f15f7fef37b11bd83f1fc1
commit 4f2ed8bcd0468f3b69d5fded274d8d6b02ac3d10
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri Mar 20 09:56:30 2015 -0700
EC: support multiple ranges for GET requests
This commit lets clients receive multipart/byteranges responses (see
RFC 7233, Appendix A) for erasure-coded objects. Clients can already
do this for replicated objects, so this brings EC closer to feature
parity (ha!).
GetOrHeadHandler got a base class extracted from it that treats an
HTTP response as a sequence of byte-range responses. This way, it can
continue to yield whole fragments, not just N-byte pieces of the raw
HTTP response, since an N-byte piece of a multipart/byteranges
response is pretty much useless.
There are a couple of bonus fixes in here, too. For starters, download
resuming now works on multipart/byteranges responses. Before, it only
worked on 200 responses or 206 responses for a single byte
range. Also, BufferedHTTPResponse grew a readline() method.
Also, the MIME response for replicated objects got tightened up a
little. Before, it had some leading and trailing CRLFs which, while
allowed by RFC 7233, provide no benefit. Now, both replicated and EC
multipart/byteranges avoid extraneous bytes. This let me re-use the
Content-Length calculation in swob instead of having to either hack
around it or add extraneous whitespace to match.
Change-Id: I16fc65e0ec4e356706d327bdb02a3741e36330a0
commit f1f4bb30cd8ad930ddb7a232b2744b48e35a0480
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Jun 2 19:51:39 2015 +0000
Fix testing issues
When functional tests are run in tox and an exception is raised when connecting
to Swift (for example: Swift not running, missing python-keystoneclient package
used by python-swiftclient) 0 tests are executed, but tox returns a success.
An exception is raised during tests, caused by a missing python-keystoneclient
in python-swiftclient. Instead of adding python-keystoneclient as a dependency
in python-swiftclient the package is added to the test-requirements.txt in Swift
itself. Note that adding python-keystoneclient to the test-requirements in
python-swiftclient is not sufficient (it's already in there).
The exception in setup\_package() is catched by the openstack.nose\_plugin, thus
disabling this plugin for now as well.
Also fixing two test errors seen on the gate regarding the tempurl middleware.
There was also an update to tox, environment variables were no longer passed
with versions >= 2.0 (http://tox.readthedocs.org/en/latest/changelog.html).
Swift test environment variables have been added to the passenv to re-enable the
former behavior, as well as environment variables required to pass proxy
settings.
This also led to skipped tempauth tests, and together with the missing
python-keystoneclient no tests were executed.
Related-Bug: 1461440
Related-Bug: 1455102
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Ideea071017d04912c60ed0bc76532adbb446c31d
commit 2759a6f159d4a90e4ad4c8e9e479085d195f8d14
Author: Pradeep Kumar Singh <pradeep.singh@nectechnologies.in>
Date: Wed May 13 21:18:02 2015 +0530
Handle Disk IO error Exception in swift account auditor
Swift account auditor fails to quarantine corrupt db due to
Disk IO error. This patch fixes that by handling Disk IO Error
Exception.
Closes-Bug:1169189
Change-Id: I031ee2a5775e4a88d4fb00d972d553936147c42e
commit 1bef06eec8f5f780914ac701d63f9c498b29119b
Author: Michael Barton <mike@weirdlooking.com>
Date: Sun May 31 23:10:15 2015 +0000
Don't quarantine on read\_metadata ENOENT
An operation that removes an existing .ts or .meta out from under another
concurrent operation at the right point can cause the whole object to be
needlessly quarantined.
Closes-Bug: #1451520
Change-Id: I37d660199e54411d0610889f9ee230b13747244b
commit 8b4af92dac813d707d124b3be37df586260fe74a
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Jun 1 17:57:25 2015 +0100
Tighten up overall metadata size tests
Overall metadata size constraint is enforced in the container and account
backends as well as in the proxy controllers. Whereas the proxy controller
can check that constraints are not exceeded by a single PUT or POST request,
the backend checks that constraints are not exceeded by the aggregate of all
PUTs and POSTs.
The current functional tests only exercise the proxy controller checks, since
they test for a 400 when sending excessive metadata in a single POST. This patch
adds a test for a 400 when a single metadata item in a POST causes the backend
aggregate constraints check to go over limit.
The extra coverage of the new assertions can be seen by modifying
swift/common/db.DatabasBroker.validate\_metadata() to always return None
immediately - only the new assertions fail when functests are run.
Change-Id: I1489e29686013cbd3d70283d8756b548aea3c2e1
commit b4c1d73ad56e0705d1c5dd1fc4f1d89b09fceff1
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 1 06:50:33 2015 +0000
Make swift-recon compatible for servers without storage policies
Swift recon introduced a new key for storage policies, and the CLI expected this
key in the server response. However, if one updates the CLI but not yet the
server an exception will be raised, because there is no default value and no
check if the key is included in the response.
This change checks if the policies key is included in the response and updates
one test to ensure backward compability.
Closes-Bug: 1453599
Change-Id: I7c7a90f9933bec2ab45595df9dc600a6cba65666
commit 38787d0fb5102e41b153e4629d2ef374a02965e9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:19:54 2015 -0700
Remove simplejson from staticweb
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This lets us get rid of some redundant Unicode encoding. Before, we
would take the container-listing response off the wire,
JSON-deserialize it (str -> unicode), then pass each of several fields
from each entry to get\_valid\_utf8\_str(), which would encode it,
(unicode -> str), decode it (str -> unicode), and then encode it again
(unicode -> str) for good measure.
The net effect was that each object's name would, in the proxy server,
go str -> unicode -> str -> unicode -> str.
By replacing simplejson with stdlib json, we get a guarantee that each
container-listing entry's name, hash, content\_type, and last\_modified
are unicodes, so we can stop worrying about them being valid UTF-8 or
not. This takes an encode and decode out of the path, so we just have
str -> unicode -> str. While it'd be ideal to avoid this, the first
transform (str -> unicode) happens when we decode the
container-listing response body (json.loads()), so there's no way out.
Change-Id: I00aedf952d691a809c23025b89131ea0f02b6431
commit 736cf54adf3ee85d2f473e5e5374f9833422967c
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu May 28 15:30:47 2015 -0700
Remove simplejson from tests
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This commit just takes simplejson out of the unit and functional
tests. They still pass.
Change-Id: I96f17df81fa5d265395a938b19213d2638682106
commit 68c30b80b47c281c549d101c43d79e718e91d21d
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu May 28 06:08:12 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I0c7b2bdb0edcc3bb3fa06903ec8457ca5e2dd688
commit 5374ba3a80a5b895542196502eac4d9300ba53d2
Author: John Dickinson <me@not.mn>
Date: Wed May 27 12:28:04 2015 -0700
drop Python 2.6 testing support
Change-Id: I78f21e5794e8ba7a095f03d279247516a241f555
commit 191f2a00bd9121fddc03d8f07f15e5e34790541e
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 16:39:23 2015 +0100
Remove \_ensure\_flush() from SSYNC receiver
The Receiver.\_ensure\_flush() method in ssync\_receiver.py has
the following comment:
Sends a blank line sufficient to flush buffers.
This is to ensure Eventlet versions that don't support
eventlet.minimum\_write\_chunk\_size will send any previous data
buffered.
If https://bitbucket.org/eventlet/eventlet/pull-request/37
ever gets released in an Eventlet version, we should make
this yield only for versions older than that.
The reference pull request was included with eventlet 0.14 [1] and
swift now requires >=0.16.1 so it is safe to remove \_ensure\_flush()
and save > 8k bytes per SSYNC response.
[1] https://bitbucket.org/eventlet/eventlet/commits/4bd654205a4217970a57a7c4802fed7ff2c8b770
Change-Id: I367e9a6e92b7ea75fe7e5795cded212657de57ed
commit 3aa06f185ac4256a8883c565bdc90b1ffbd519ca
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 09:17:46 2015 +0100
Make SSYNC receiver return a reponse when initial checks fail
The ssync Receiver performs some checks on request parameters
in initialize\_request() before starting the exchange of missing
hashes and updates e.g. the destination device must be available;
the policy must be valid. Currently if any of these checks fails
then the receiver just closes the connection, so the Sender gets
no useful response code and noise is generated in logs by httplib
and wsgi Exceptions.
This change moves the request parameter checks to the Receiver
constructor so that the HTTPExceptions raised are actually sent
as responses. (The 'connection close' exception handling still
applies once the 'missing\_check' and 'updates' handshakes are in
progress.)
Moving initialize\_request() revealed the following lurking bug:
\* initialize\_request() sets
req.environ['eventlet.minimum\_write\_chunk\_size'] = 0
\* this was previously ineffective because the Response environ
had already been copied from Request environ before this value
was set, so the Response never used the value :/
\* Now that it is effective (a good thing) it causes the empty string
yielded by the receiver when there are no missing hashes in
missing\_checks() to be sent to the sender immediately. This makes
the Sender.readline() think there has been an early disconnect
and raise an Exception (a bad thing), as revealed by
test/unit/obj/test\_ssync\_sender.py:TestSsync.test\_nothing\_to\_sync
The fix for this is to simply make the receiver skip sending the empty
string if there are no missing object\_hashes.
Change-Id: I036a6919fead6e970505dccbb0da7bfbdf8cecc3
commit bb716573ab5c8455348ec013feb894421e0e1f1c
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed May 20 00:39:41 2015 -0700
Allow SLO PUTs to forgo per-segment integrity checks
While manifests still require 'etag' and 'size\_bytes' fields for each
segment (to catch user errors like 'etaf' or 'size\_btyes'), an explicit
null for either will skip that particular integrity check and instead
use whatever value is retrieved when HEADing the segment. So, if a user
uploads a manifest like:
[{"path": "/con/obj\_seg\_1", "etag": null, "size\_bytes": 1048576},
{"path": "/con/obj\_seg\_2", "etag": "etag2", "size\_bytes": null},
{"path": "/con/obj\_seg\_3", "etag": null, "size\_bytes": null}]
then the etag will only be verified for the /con/obj\_seg\_2 segment,
and the segment size will only be verified for the /con/obj\_seg\_1
segment. However, the manifest that's ultimately stored (and can be
retrieved with a ?multipart-manifest=get query-string) will still look
like:
[{"name": "/con/obj\_seg\_1", "hash": "etag1", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_2", "hash": "etag2", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_3", "hash": "etag3", "bytes": 1234, ...}]
This allows the middleware to continue performing integrity checks on
object GET.
Change-Id: I2c4e585221387dd02a8679a50398d6b614407b12
DocImpact
commit a1c327022c70907ccc159d6203de26b37c3a4586
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:43:55 2015 -0700
Remove simplejson from swift-recon
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
All swift-recon was doing with json was decoding a JSON response (from
the recon middleware) and printing it to the terminal. This still
works just fine.
Change-Id: I28cf25a7c2856f230d4642c62fb8bf9c4d37e9e5
commit a3559edc2342e2cf92a5188336ab263ffd038554
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Apr 17 16:30:30 2015 -0700
Exclude local\_dev from sync partners on failure
If the primary left or right hand partners are down, the next best thing
is to validate the rest of the primary nodes. Where the rest should
exclude not just the left and right hand partners - but ourself as well.
This fixes a accidental noop when partner node is unavailable and
another node is missing data.
Validation:
Add probetests to cover ssync failures for the primary sync\_to nodes for
sync jobs.
Drive-by:
Make additional plumbing for the check\_mount and check\_dir constraints into
the remaining daemons.
Change-Id: I4d1c047106c242bca85c94b569d98fd59bb255f4
commit 666bf06c26bc9e0d6256d054835386e50e67b8a2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed May 6 16:29:06 2015 -0700
EC: don't 503 on marginally-successful PUT
On EC PUT in an M+K scheme, we require M+1 fragment archives to
durably land on disk. If we get that, then we go ahead and ask the
object servers to "commit" the object by writing out .durable
files. We only require 2 of those.
When we got exactly M+1 fragment archives on disk, and then one
connection timed out while writing .durable files, we should still be
okay (provided M is at least 3). However, we'd take our M > 2
remaining successful responses and pass that off to best\_response()
with a quorum size of M+1, thus getting a 503 even though everything
worked well enough.
Now we pass 2 to best\_response() to avoid that false negative.
There was also a spot where we were getting the quorum size wrong. If
we wrote out 3 fragment archives for a 2+1 policy, we were only
requiring 2 successful backend PUTs. That's wrong; the right number is
3, which is what the policy's .quorum() method says. There was a spot
where the right number wasn't getting plumbed through, but it is now.
Change-Id: Ic658a199e952558db329268f4d7b4009f47c6d03
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Closes-Bug: 1452468
commit e7c8c578d9e5b0aa7e56b02bd9c39baa99d2d6ae
Author: Michael MATUR <michael.matur@gmail.com>
Date: Mon May 25 15:13:01 2015 +0200
fixup!Patch of "parse\_content\_disposition" method to meet RFC2183
The spec of Content-Disposition does not require a space character after
comma: http://www.ietf.org/rfc/rfc2183.txt
Change-Id: Iff438dc36ce78c6a79bb66ab3d889a8dae7c0e1f
Closes-Bug: #1458497
commit af8d842076ba269fed7f4128d0c7503ab5d1a94a
Author: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Date: Tue Oct 21 09:24:25 2014 +0000
Replaced setting run\_pause with standard interval
The deprecated directive `run\_pause` should be replaced with the more
standard one `interval`. The `run\_pause` should be still supported for
backward compatibility. This patch updates object replicator to use
`interval` and support `run\_pause`. It also updates its sample config
and documentation.
Co-Authored-By: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Co-Authored-By: Kamil Rykowski <kamil.rykowski@intel.com>
Change-Id: Ie2a3414a96a94efb9273ff53a80b9d90c74fff09
Closes-Bug: #1364735
commit f11d92d566757a54ff1e3800ec0bfac098347a68
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri May 22 16:58:04 2015 -0700
Add swift-durability-calculator line to docs
This commits add a line (link and small doc) for
swift-durability-calculator which provides a browser based
durability calculation tool to docs as an associated project.
Change-Id: I4ea8015f512616dc25072080bef79b8734971ccf
commit f864092455ebcd40b3568633c3524cc5c64d3309
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed May 20 17:50:07 2015 -0700
Add Swift Inspector to assoicated projects
Change-Id: I5b5448674ea455119a51509ab5e7cd11a764b5a7
commit e54781a2aa29808aff654861d8a0aafd24b6620c
Author: Thiago da Silva <thiago@redhat.com>
Date: Tue May 19 20:27:06 2015 +0000
add object post and delete methods to BaseObjectController
Adding post and delete methods to BaseObjectController that can
be overriden by ObjectCOntroller subclasses. These methods are
similar to the PUT and GET methods that were introduced as part
of the EC work
Change-Id: I197364bc3e2f2287c0afc8948863e3cdeab90383
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit ab9f63402de6d554528699a02955854ac28264c5
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Mon Nov 24 21:44:03 2014 +0900
Add process name checking into swift-init
Swift-init uses pid files to detect existing swift processes by pid.
However, it mistakes an unrelated process for a swift process and makes
a wrong decision, when the unrelated process is running with pid written
in swift pid files.
This patch adds process name checking into swift-init and enable it to remove
invalid pid files in such situation.
Change-Id: Ibca026bdfbdacdd92c8763e1eb15d98293c70656
Closes-Bug: #1327106
commit aa4866eb6014d7fbb8531eb5d927d5611ebfd06d
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed May 13 20:10:59 2015 +0000
move replication code to ReplicatedObjectController
Moving \_connect\_put\_node, send\_file, \_transfer\_data and \_store\_object
methods to ReplicatedObjectController. Each one of these methods are
specific to replication policy. EC policy implements their own
version of them.
Of these four methods, only \_store\_object and \_connect\_put\_node are
required to be implemented by the policy specific Object Controllers.
Change-Id: Ifc72461b77dbfdaae9d63417f1286e8b5da3ca4e
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit 025c4c4339e7ace2f5be8cb3a3cddf6c38ceff37
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Apr 24 02:15:36 2015 -0700
Remove confusable query string on post as copy
Current post as copy routine (i.e. POST object with post\_as\_copy option
turned on) on Object Controller uses "multipart-manifest" query string
which is feeded to env['copy\_hook'] to decide which data (the manifest or
object pointed by the manifest) should be copied.
However, the way using the query string will confuse operators looking at
logging system (or analyzing the log) because whole POST object requests
have 'multipart-manifest=get' like as:
POST /v1/AUTH\_test/d4c816b24d38489082f5118599a67920/manifest-abcde%3Fmultipart-manifest%3Dget
We cannot know whether the query string was added by hand
(from user) or not. In addition, the query isn't needed by the
backend conversation between proxy-server and object-server.
(Just needed by "copy\_hook" on the proxy controller!)
To remove the confusable query string and to keep the log to be clean,
this patch introduces new environment variable "swift.post\_as\_copy"
and changes proxy controller and the copy\_hook to use the new env.
This item was originally discussed at
https://review.openstack.org/#/c/177132/
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: I0cd37520eea1825a10ebd27ccdc7e9162647233e
commit 98b725fec639c5501c645ce4e4dc9d12c686f91d
Author: Alistair Coles <alistair.coles@hp.com>
Date: Fri May 1 13:02:29 2015 +0100
Cleanup and extend end to end ssync tests
Extends the existing end to end ssync tests with
a test using replication policy.
Also some cleanup and improvements to the test framework e.g. rather
than faking the connection between sender and receiver, use a real
connection and wrap it to capture traffic for verification.
Change-Id: Id71d2eb3fb8fa15c016ef151aacf95f97196a902
commit 518262ab6ecd8faa2b915df118ffc70a30112a18
Author: paul luse <paul.e.luse@intel.com>
Date: Tue May 12 15:21:13 2015 -0700
Remove 1 line of dead code from EC reconstructor
Assuming nobody intentionally left this in here for some reason...
Change-Id: I4bf43bb3828e062c0342557243076ed62d6790f4
commit 29f4393d88426fd6c34f2cfe43a8c434bfad8d47
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri May 8 15:55:14 2015 -0700
Remove workaround for old eventlet version
Swift now requires eventlet >= 0.16.1, so we can get rid of this
workaround for a bug in eventlet 0.9.16.
Change-Id: I4a1200b9bd9266896a704a840fda0d1b720bc86d
commit 90b84d3a699811a99c97ebbe4f71a14d2f76a0e5
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri May 8 11:45:12 2015 -0700
Properly re-raise exceptions in proxy\_logging
Previously, this could encounter TypeErrors, presumably because
sys.exc\_clear() was called somewhere in the block of code between
catching the exception and re-raising.
Related-Bug: 1181146
Change-Id: Iadeea3f61e70bf83dc0eb063fdb27edd16f3ca32
commit 664a632c01f8c5c80826b223b9ade774bfe2ed9a
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 8 08:41:39 2015 +0200
Update my mailmap entry
Change-Id: I5d21a55d0fa4cab6eaa6ff426819aa1dc997de2f
commit 0b20a18e5216b991855c461e41e9ef32e17fadb4
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Thu May 7 13:16:15 2015 -0600
Spell "rebalance" right in swift-ring-builder.1
See Red Hat bug #1218269.
Change-Id: I814eb4b3c0821f5a8df5feea2bda3a964aace536
commit 1faad248f833735585aa8f6135babceb46fbb6f8
Author: Emmanuel Cazenave <contact@emcaz.fr>
Date: Tue May 5 12:31:22 2015 +0200
X-Auth-Token should be a bytestring.
Change-Id: I2aa941d74883e17e9548b0144a4a2e2db33aba95
Closes-Bug: 1451773
commit 55dd705a863c4500330cbd2b8c2fec46d618dc71
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Wed May 6 19:53:09 2015 +0200
Add missing statsd metrics section for object-reconstructor
Change-Id: Id3f98e5f637ff537a387262b40f21c05876fca91
commit c77c79b2c9b9ca7790c29577341cf36c5e9012cf
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue May 5 06:08:09 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9b0156c7fc315182d80604bf353586455bbc34d1
commit 94215049fd37f810ddf4e6b8122cce02aea3e6e3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon May 4 15:08:51 2015 -0700
Bump up a timeout in a test
Got a slow crappy VM like I do? You might see this fail
occasionally. Bump up the timeout a little to help it out.
Change-Id: I8c0e5b99012830ea3525fa55b0811268db3da2a2
commit 03536dbb55c219b94389e635babec2df2e2759fa
Author: Prashanth Pai <ppai@redhat.com>
Date: Wed Apr 29 12:11:59 2015 +0530
Fix incorrect passing of file object to fsync()
swift.common.utils.fsync() requires a file descriptor as argument
but file object handle was being passed.
Change-Id: I316b58f6bc37de0945eff551e4e50565653664f5
Signed-off-by: Prashanth Pai <ppai@redhat.com>
commit bfbc94c3cb34eb9ff288fb817dee667cc870d9eb
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Apr 28 10:45:50 2015 +0100
Fix intermittent container replicator test failure
Intermittent failure of this test could be due to
insufficient time elapsing between either the local
and remote db's being created or during the
debug\_timing calls. This patch forces greater timestamp
separation and forces debug\_timing to always log timings.
Also add message to the failign assertion so if this does
fail again we get some clue as to why.
Closes-Bug: 1369663
Change-Id: I4b69b2e759d586a14abd0931a68dbdf256d57c32
commit dbb9d4b7938f24ee588d260c9b51ca65d5095749
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Mon Apr 27 08:52:18 2015 +0200
Add missing docstring in direct\_client
Added a missing docstring to the direct\_delete\_container method.
Also checked other docstrings in the same file and fixed a wrong docstring
element in direct\_delete\_object. Added raises: docstring entry to all methods
that raise an Exception.
Change-Id: If463a0f9ddff3fe2d13f6d97fcfa955e91d0f01f
commit 8cdf0fdebe9eb782322fccfc11253dc959cf321d
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Apr 27 13:29:50 2015 -0700
Fix account replication during pre-storage-policy upgrade
Old account schemas don't send the storage\_policy\_index key for container rows
during replication, and if the recieving end is already running an upgraded
server it is surprised with a KeyError. Normally this would work itself out
if the old schema recieved any updates from container layer, or a new
container is created, or requires a row sync from another account database -
but if the account databases have rows out of sync and there's no activity in
the account otherwise, there's nothing to force the old schemas to be
upgraded.
Rather than force the old schema that already has a complete set of container
rows to migrate even in the absense of activity we can just fill in default
legacy value for the storage policy index and allow the accounts to get back
in sync and migrate the next time a container update occurs.
FWIW, I never able to get a cluster upgrade to get stuck in this state without
some sort of account failure that forced them to get their rows out of sync
(in my cause I just unlinked a pending and then made sure to force all my
account datbases to commit pending files before upgrading - leading to an
upgraded cluster that absolutly needed account-replication to solve a row
mismatch for inactive accounts with old schemas)
Closes-Bug #1424108
Change-Id: Iaf4ef834eb24f0e11a52cc22b93a864574fabf83
commit 03380380efb5d5c0b2a3acfaa64b486ee2cb6e64
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Apr 23 19:39:16 2015 -0700
Simplify ring.builder.RingBuilder.\_\_deepcopy\_\_
Only container classes (lists, sets, dicts, graphs, collections,
etc) need to track objects they deepcopy in the memo dict -
particularly when they may contain other containers! As they
recreate a new container with the same items as themselves, they'll
reference the memo for each item they contain before making a
deepcopy of it, and place a reference to the copied item into memo
after they do. Trying to help out some other container class in
this endeavor by attempting to add ourselves to the memo dict in
some useful manor on their behalf however; is not helpful.
All we need to do to make sure we're being a good \_\_deepcopy\_\_
implementation is make sure we pass on memo to our calls of deepcopy
so that other container classes can avoid making additional
deepcopy's of our containers if they already have a memorized copy
(which would be odd since unique instances of RingBuilders aren't
expected to share state, but hey - python doesn't have private
attributes so you never know!)
Change-Id: Ifac444dffbf79d650b2d858f6282e05d8ea741a0
commit 43ace3c62893364b6e3c130df56438995627598d
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 12:17:56 2015 -0700
Make RingBuilders deep-copy-able
We used to be able to deep-copy RingBuilder objects, but the addition
of debug logging (8d3b3b2) broke that since you can't deep-copy a
Python logger. This commit fixes that.
Swift doesn't really deep-copy RingBuilders anywhere, but third-party
code might.
Change-Id: If8bdadd93d9980db3d8a093f32d76ca604de9301
commit 215cd551df8be066edafd2a1e16d0bd143ec214b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Apr 21 17:38:04 2015 -0700
Bulk upload: treat user xattrs as object metadata
Currently, if you PUT a single object, then you can also associate
metadata with it by putting it in the request headers, prefixed with
"X-Object-Meta". However, if you're bulk-uploading objects, then you
have no way to assign any metadata.
The tar file format\* allows for arbitrary UTF-8 key/value pairs to be
associated with each file in an archive (as well as with the archive
itself, but we don't care about that here). If a file has extended
attributes, then tar will store those as key/value pairs.
This commit makes bulk upload read those extended attributes, if
present, and convert those to Swift object metadata. Attributes
starting with "user.meta" are converted to object metadata, and
"user.mime\_type"\*\* is converted to Content-Type.
For example, if you have a file "setup.py":
$ setfattr -n user.mime\_type -v "application/python-setup" setup.py
$ setfattr -n user.meta.lunch -v "burger and fries" setup.py
$ setfattr -n user.meta.dinner -v "baked ziti" setup.py
$ setfattr -n user.stuff -v "whee" setup.py
This will get translated to headers:
Content-Type: application/python-setup
X-Object-Meta-Lunch: burger and fries
X-Object-Meta-Dinner: baked ziti
Swift will handle xattrs stored by both GNU and BSD tar\*\*\*. Only
xattrs user.mime\_type and user.meta.\* are processed; others are
ignored.
This brings bulk upload much closer to feature-parity with non-bulk upload.
\* The POSIX 1003.1-2001 (pax) format, at least. There are a few
different, mutually-incompatible tar formats out there, because of
course there are. This is the default format on GNU tar 1.27.1 or
later.
\*\* http://standards.freedesktop.org/shared-mime-info-spec/latest/ar01s02.html#idm140622087713936
\*\*\* Even with pax-format tarballs, different encoders store xattrs
slightly differently; for example, GNU tar stores the xattr
"user.rubberducky" as pax header "SCHILY.xattr.user.rubberducky",
while BSD tar (which uses libarchive) stores it as
"LIBARCHIVE.xattr.user.rubberducky". One might wonder if this is
some programmer's attempt at job security.
Change-Id: I5e3ce87d31054f5239e86d47c45adbde2bb93640
commit f8dee761bd36f857aa1288c27e095907032fad68
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:15:35 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Note: This is part of importing of translations, there are no new
translations for this project, thus only the pot file gets updated.
Change-Id: I0cbfdae3bd1662da54c58e91a13f49419eba9b2d
commit cd7c58e93690fd25f5266754d0593c656dd51e2e
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Closes-Bug: 1446801
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 281cb1c210f0292bad190cabaae447145fa5eade
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Closes-Bug: 1446727
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit 51e31c5c7147f3ba61437e132b12b491ca718ce4
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Apr 15 15:31:06 2015 -0700
Don't apply the wrong Etag validation to rebuilt fragments
Because of the object-server's interaction with ssync sender's
X-Backend-Replication-Headers when a object (or fragment archive) is
pushed unmodified to another node it's ETag value is duped into the
recieving ends metadata as Etag. This interacts poorly with the
reconstructor's RebuildingECDiskFileStream which can not know ahead of
time the ETag of the fragment archive being rebuilt.
Don't send the Etag from the local source fragment archive being used as
the basis for the rebuilt fragent archive's metadata along to ssync.
Closes-Bug: 1446800
Change-Id: Ie59ad93a67a7f439c9a84cd9cff31540f97f334a
commit 2080f7dbd897d6130542dbf88e37641a41625eb5
Author: Alistair Coles <alistair.coles@hp.com>
Date: Thu Feb 26 15:16:22 2015 +0000
Fix tempauth acl checks when simplejson has no speedups
As documented in linked bug report, tempauth unit tests
were seen to fail on a system where simplejson was
installed but without the speedups extension. This
is because the tempauth account acl validation checks
that values are type str, but without the speedups
extension the json parser is returning unicode objects.
Fix is to have the acl validator tolerate those objects
being unicode or str.
Also change common/bufferedhttp.py to coerce ring device
to type str when constructing a path, in order to avoid
a UnicodeDecodeError when httplib sends a message that
has non-ascii header values.
Change-Id: I01524282cbaa25dc4b6dfa09f3f4723516cdba99
Closes-Bug: 1425776
commit 27f6fba5c3b9e0461d52c1deffe32130e7e9af51
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 0c391d6daffe1943f6def803db42e08e6d6846d2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 16:47:10 2015 -0700
SAIO instructions: ensure ~/bin exists before copying into it
Change-Id: I16cd211b00b529ccc4b46f6b10497c32b6741896
commit c5c281ba6dd97a301ba80511e3356d6ca536d701
Author: Minwoo B <minwoob@us.ibm.com>
Date: Mon Apr 20 17:03:25 2015 -0500
Included step in development\_saio.rst for installing dependencies in requirements.txt.
Change-Id: I6ed1704148e5ae1e3164d10080c350d81856f7a9
commit 2203b46e3f14ef68a090aaea284f0a0442bbb86f
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit f6482bdece27144ee083a53d696469528d7940c2
Author: Thierry Carrez <thierry@openstack.org>
Date: Thu Apr 16 22:08:47 2015 +0200
Set default branch to stable/kilo
Open stable/kilo branch by setting defaultbranch for git-review.
Change-Id: I81bcda30f99173416eaaa3f1d42da32f3ab5b6d2
commit a2a5b6aa6664b61fa31d25f329426ff089372f17
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Apr 16 11:42:12 2015 -0700
Functional test for SLO PUT overwriting one of its own segments
Change-Id: I4855816848f4fdb148d0b82735cf79bc68429617
commit e4d326b5a7dd186d762726faa45733ff2900343d
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Thu Feb 19 17:38:10 2015 +0900
Fix conflict SLO reponse
This patch fixes Swift to respond "409 Conflict"
when a segment object path of the manifest on PUT SLO
is same as requested object path. It is because
the request will overwrite the segment and then it
will absolutely cause "409 Conflict" on GET SLO.
e.g.:
request:
PUT "http://hostname/v1/AUTH\_account/container/segment\_object\_00?multipart-manifest=put"
manifest file:
[{"path" : "container/segment\_object\_00", "etag" : "<etag of segment\_object\_00>", "size\_bytes" : <size of segment\_object\_00>},
{"path" : "container/segment\_object\_01", "etag" : "<etag of segment\_object\_01>", "size\_bytes" : <size of segment\_object\_01>},
{"path" : "container/segment\_object\_02", "etag" : "<etag of segment\_object\_02>", "size\_bytes" : <size of segment\_object\_02>}]
Change-Id: I4f4f7b9dbeb6a7c355b801c7e0ae560aa19a70b4
Closes-Bug: 1417936
commit 38ae7bb89c95292c171cb89c1d62859cee0cc24f
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Apr 15 23:03:21 2015 +0100
Make the reaper use same timestamp for replica deletes
The account reaper is using a unique timestamp when deleting
replicas of the same resource. This will result in unnecessary
replication traffic after reaping.
This patch makes the reaper use a single timestamp per resource.
Probe test is modified to check that delete times are equal
across replicas before replicators run.
test\_direct\_client.py is modified to check that it uses explicit
timestamp when passed to direct\_delete\_[object|container]
methods.
Drive-by bug fixes in the probe test e.g. it was not sending
X-Backend-Storage-Policy-Index when doing a direct GET to check
object state, so the 404s being verified could in fact be due
to diskfile not existing rather than diskfile being deleted.
Closes-Bug: 1442879
Change-Id: I8bab22d66308bb9d3294e1e0def017c784228423
commit 7bdb8266d4b926526acdea22e8c9c634855eeecc
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed Mar 25 13:19:36 2015 +0000
Select policy when running functional test
Add ability to select a storage policy when running
the functional tests by defining the environment variable
SWIFT\_TEST\_POLICY.
This patch was first introduced by Janie Richling in
feature/ec: https://review.openstack.org/#/c/166097
Co-Authored-By: Janie Richling <jrichli@us.ibm.com>
Co-Authored-By: Christian Schwede <christian.schwede@enovance.com>
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Id96354546088df137def0ae7fd434baf64ed0c51
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit 9c33bbde6923b26f111572ae967a3b97a8ab12f2
Author: Prashanth Pai <ppai@redhat.com>
Date: Tue Jan 20 12:14:32 2015 +0530
Allow rsync to use compression
From rsync's man page:
-z, --compress
With this option, rsync compresses the file data as it is sent to the
destination machine, which reduces the amount of data being transmitted --
something that is useful over a slow connection.
A configurable option has been added to allow rsync to compress, but only
if the remote node is in a different region than the local one.
NOTE: Objects that are already compressed (for example: .tar.gz, .mp3)
might slow down the syncing process.
On wire compression can also be extended to ssync later in a different
change if required. In case of ssync, we could explore faster
compression libraries like lz4. rsync uses zlib which is slow but offers
higher compression ratio.
Change-Id: Ic9b9cbff9b5e68bef8257b522cc352fc3544db3c
Signed-off-by: Prashanth Pai <ppai@redhat.com>

| **tags**: | added: in-feature-crypto |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-05:  [**Re: Download DLO objects leak connections when client kill connection**](/swift/%2Bbug/1466549/comments/16) |  |  | [#16](/swift/%2Bbug/1466549/comments/16) |
| --- | --- | --- | --- |

Swift cores, can you answer comment #7 please ?

Swift cores, can you answer comment #7 please ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [clayg (clay-gerrard)](https://launchpad.net/~clay-gerrard) wrote on 2015-08-06: |  |  | [#17](/swift/%2Bbug/1466549/comments/17) |
| --- | --- | --- | --- |

yeah, <https://review.openstack.org/#/c/193303/> was the fix.

But it's really about the same as [https://bugs.launchpad.net/swift/+bug/667956](https://bugs.launchpad.net/swift/%2Bbug/667956) (i.e. slow resource exhaustion depending on your clients access patterns) and that was open for ages. I'm glad we fixed both of them...

So yeah, people that need to support a bunch of VOD clients that disconnect reading \*LO's should upgrade to the latest Swift or they will probably encounter this bug.

yeah, https://review.openstack.org/#/c/193303/ was the fix.
But it's really about the same as https://bugs.launchpad.net/swift/+bug/667956 (i.e. slow resource exhaustion depending on your clients access patterns) and that was open for ages. I'm glad we fixed both of them...
So yeah, people that need to support a bunch of VOD clients that disconnect reading \*LO's should upgrade to the latest Swift or they will probably encounter this bug.

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-08-26

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#18](/swift/%2Bbug/1466549/comments/18) |
| --- | --- | --- | --- |

Thanks clayg, so this issue can be abused, the fix should be backported and an OSSA issued.

Here is the proposed impact description:

Title: Swift proxy-server DoS through Large Object

Reporter: Romain LE DISEZ (OVH)

Products: Swift

Affects: versions through 2.3.0

Description:

Romain LE DISEZ from OVH reported a vulnerability in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. All Swift setup are affected.

Thanks clayg, so this issue can be abused, the fix should be backported and an OSSA issued.
Here is the proposed impact description:
Title: Swift proxy-server DoS through Large Object
Reporter: Romain LE DISEZ (OVH)
Products: Swift
Affects: versions through 2.3.0
Description:
Romain LE DISEZ from OVH reported a vulnerability in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. All Swift setup are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-08-27:  [**Fix proposed to swift (stable/kilo)**](/swift/%2Bbug/1466549/comments/19) |  |  | [#19](/swift/%2Bbug/1466549/comments/19) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/217750>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/217750

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-09-01

| Changed in swift: | |
| --- | --- |
| **milestone**: | none → 2.4.0 |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-09-23:  [**Re: Download DLO objects leak connections when client kill connection**](/swift/%2Bbug/1466549/comments/20) |  |  | [#20](/swift/%2Bbug/1466549/comments/20) |
| --- | --- | --- | --- |

It seems the bug is not really fixed but it is "moved". I know have sockets leak when a client stops a DLO download. Each interrupted DLO download leak one TCP socket. It applies on Linux, don't know if others OS are impacted.

How to reproduce, on a fresh SAIO on master, with processes just started:

1. Upload an object in DLO

    $ dd if=/dev/zero of=2x1G bs=1M count=2048

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing post test

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing upload test -S 1073741824 2x1G

2. In an other terminal, watch socket stats:

   $ while [ 1 ]; do grep ^TCP /proc/net/sockstat; sleep 1; done

(For now, you should see that the number of allocated sockets is stable, for me: alloc 45)

3. Start to download the object, but stop it before the end (eg: CTRL+C)

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing download test 2x1G --no-download

(Now, you should see one more allocated socket)

4. Repeat step 3 and observe the socket stacking

So, no more connections leak, but socket leak. Instead of few hours, it takes few days to exhaust server resources.

It seems the bug is not really fixed but it is "moved". I know have sockets leak when a client stops a DLO download. Each interrupted DLO download leak one TCP socket. It applies on Linux, don't know if others OS are impacted.
How to reproduce, on a fresh SAIO on master, with processes just started:
1. Upload an object in DLO
$ dd if=/dev/zero of=2x1G bs=1M count=2048
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing post test
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing upload test -S 1073741824 2x1G
2. In an other terminal, watch socket stats:
$ while [ 1 ]; do grep ^TCP /proc/net/sockstat; sleep 1; done
(For now, you should see that the number of allocated sockets is stable, for me: alloc 45)
3. Start to download the object, but stop it before the end (eg: CTRL+C)
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing download test 2x1G --no-download
(Now, you should see one more allocated socket)
4. Repeat step 3 and observe the socket stacking
So, no more connections leak, but socket leak. Instead of few hours, it takes few days to exhaust server resources.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-10-20:  [**Change abandoned on swift (stable/kilo)**](/swift/%2Bbug/1466549/comments/21) |  |  | [#21](/swift/%2Bbug/1466549/comments/21) |
| --- | --- | --- | --- |

Change abandoned by John Dickinson (<email address hidden>) on branch: stable/kilo

Review: <https://review.openstack.org/217750>

Reason: Abanoning based on the lack of activity since the last negative review. If you want to continue working on this, please reopen this patch.

Change abandoned by John Dickinson (me@not.mn) on branch: stable/kilo
Review: https://review.openstack.org/217750
Reason: Abanoning based on the lack of activity since the last negative review. If you want to continue working on this, please reopen this patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [clayg (clay-gerrard)](https://launchpad.net/~clay-gerrard) wrote on 2015-11-03:  [**Re: Download DLO objects leak connections when client kill connection**](/swift/%2Bbug/1466549/comments/22) |  |  | [#22](/swift/%2Bbug/1466549/comments/22) |
| --- | --- | --- | --- |

so is this the same as the lp [bug #1361360](/bugs/1361360) ?

so is this the same as the lp bug #1361360 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-11-04: |  |  | [#23](/swift/%2Bbug/1466549/comments/23) |
| --- | --- | --- | --- |

I don't think it is the same. [Bug #1361360](/bugs/1361360) describe the slowloris attack, where TCP connections are kept open for a long time if the client does not close the connection.

The behavior i'm observing is that when client close the connection, the TCP connection is closed, but the socket is not released. Also, it does not apply on standard downloads, but only on DLO downloads.

To be sure, i tried to set keepalive=False (and socket\_timeout=10): it didn't fix the problem.

I don't think it is the same. Bug #1361360 describe the slowloris attack, where TCP connections are kept open for a long time if the client does not close the connection.
The behavior i'm observing is that when client close the connection, the TCP connection is closed, but the socket is not released. Also, it does not apply on standard downloads, but only on DLO downloads.
To be sure, i tried to set keepalive=False (and socket\_timeout=10): it didn't fix the problem.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Grant Murphy (gmurphy)](https://launchpad.net/~gmurphy) wrote on 2015-11-17: |  |  | [#24](/swift/%2Bbug/1466549/comments/24) |
| --- | --- | --- | --- |

+1 impact description in comment #18

+1 impact description in comment #18

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-14:  [**Fix merged to swift (stable/kilo)**](/swift/%2Bbug/1466549/comments/25) |  |  | [#25](/swift/%2Bbug/1466549/comments/25) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/217750>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=036c2f348d24c01c7a4deba3e44889c45270b46d>

Submitter: Jenkins

Branch: stable/kilo

commit 036c2f348d24c01c7a4deba3e44889c45270b46d

Author: Samuel Merritt <email address hidden>

Date: Thu Jun 18 12:58:03 2015 -0700

Get better at closing WSGI iterables.

PEP 333 (WSGI) says: "If the iterable returned by the application has

    a close() method, the server or gateway must call that method upon

    completion of the current request[.]"

There's a bunch of places where we weren't doing that; some of them

    matter more than others. Calling .close() can prevent a connection

    leak in some cases. In others, it just provides a certain pedantic

    smugness. Either way, we should do what WSGI requires.

Noteworthy goofs include:

\* If a client is downloading a large object and disconnects halfway

        through, a proxy -> obj connection may be leaked. In this case,

        the WSGI iterable is a SegmentedIterable, which lacked a close()

        method. Thus, when the WSGI server noticed the client disconnect,

        it had no way of telling the SegmentedIterable about it, and so

        the underlying iterable for the segment's data didn't get

        closed.

Here, it seems likely (though unproven) that the object server

        would time out and kill the connection, or that a

        ChunkWriteTimeout would fire down in the proxy server, so the

        leaked connection would eventually go away. However, a flurry of

        client disconnects could leave a big pile of useless connections.

\* If a conditional request receives a 304 or 412, the underlying

        app\_iter is not closed. This mostly affects conditional requests

        for large objects.

The leaked connections were noticed by this patch's co-author, who

    made the changes to SegmentedIterable. Those changes helped, but did

    not completely fix, the issue. The rest of the patch is an attempt to

    plug the rest of the holes.

Co-Authored-By: Romain LE DISEZ <email address hidden>

Closes-Bug: #1466549

Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937

    (cherry picked from commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9

    with fixed import conflicts)

Reviewed: https://review.openstack.org/217750
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=036c2f348d24c01c7a4deba3e44889c45270b46d
Submitter: Jenkins
Branch: stable/kilo
commit 036c2f348d24c01c7a4deba3e44889c45270b46d
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Closes-Bug: #1466549
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
(cherry picked from commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
with fixed import conflicts)

| **tags**: | added: in-stable-kilo |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-14

| **summary**: | Download DLO objects leak connections when client kill connection+ (CVE-2016-0737) |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-20

| **summary**: | - Download DLO objects leak connections when client kill connection- (CVE-2016-0737)+ [OSSA 2016-004] Download DLO objects leak connections when client kill+ connection (CVE-2016-0737) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Related fix proposed to ossa (master)**](/swift/%2Bbug/1466549/comments/26) |  |  | [#26](/swift/%2Bbug/1466549/comments/26) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: <https://review.openstack.org/270241>

Related fix proposed to branch: master
Review: https://review.openstack.org/270241

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-20

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-28:  [**Related fix merged to ossa (master)**](/swift/%2Bbug/1466549/comments/27) |  |  | [#27](/swift/%2Bbug/1466549/comments/27) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270241>

Committed: <https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d>

Submitter: Jenkins

Branch: master

commit 606a18e718aed329a9d42d298e3119f0f1974e3d

Author: Tristan Cacqueray <email address hidden>

Date: Wed Jan 20 10:19:30 2016 -0500

Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)

Related-Bug: #1466549

    Related-Bug: #1493303

    Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

Reviewed: https://review.openstack.org/270241
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d
Submitter: Jenkins
Branch: master
commit 606a18e718aed329a9d42d298e3119f0f1974e3d
Author: Tristan Cacqueray <tdecacqu@redhat.com>
Date: Wed Jan 20 10:19:30 2016 -0500
Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)
Related-Bug: #1466549
Related-Bug: #1493303
Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

[See full activity log](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/swift/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/swift/%2Bbug/1466549/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

* [python-roundup #16037](http://bugs.python.org/issue16037)

  [2:3]
  [Edit](/bugs/1466549/%2Bwatch/116735 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugs.launchpad.net_0b94dd55_20250126_072222.html ===

[Log in / Register](https://bugs.launchpad.net/swift/%2Bbug/1468374/%2Blogin)

[![](https://launchpadlibrarian.net/52141984/os64.png)](https://launchpad.net/swift)

## [OpenStack Object Storage (swift)](https://launchpad.net/swift)

* [Overview](https://launchpad.net/swift)
* [Code](https://code.launchpad.net/swift)
* [Bugs](https://bugs.launchpad.net/swift)
* [Blueprints](https://blueprints.launchpad.net/swift)
* [Translations](https://translations.launchpad.net/swift)
* [Answers](https://answers.launchpad.net/swift)

# swift dispersion does not support keystone auth v3

Bug #1468374 reported by
[Falk Reimann](https://launchpad.net/~falk-reimann)
on 2015-06-24

[26](/%2Bhelp-bugs/bug-heat.html)

This bug affects 6 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Object Storage (swift)](https://bugs.launchpad.net/swift) | Fix Released | Undecided | [Falk Reimann](https://launchpad.net/~falk-reimann) | [OpenStack Object Storage (swift) 2.4.0](https://launchpad.net/swift/%2Bmilestone/2.4.0) |

### Bug Description

The swift dispersion tools swift-dispersion-populate and swift-dispersion-report do not fully support keystone auth version 3. If the project which should be used for the dispersion account is not in the default domain, there is no chance to specify the domain in the config file /etc/swift/dispersion, although the swiftclient, if installed, used by swift-dispersion is capable to handle this.

I have already prepared a patch, I will submit for review in the next hours.

Tags:

[in-feature-crypto](/swift/%2Bbugs?field.tag=in-feature-crypto)
[in-feature-hummingbird](/swift/%2Bbugs?field.tag=in-feature-hummingbird)

## CVE References

* [2015-5223](/bugs/cve/2015-5223 "OpenStack Object Storage (Swift) befo...")

[Falk Reimann (falk-reimann)](https://launchpad.net/~falk-reimann)
on 2015-06-24

| Changed in swift: | |
| --- | --- |
| **assignee**: | nobody → Falk Reimann (falk-reimann) |
| **assignee**: | Falk Reimann (falk-reimann) → nobody |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Falk Reimann (falk-reimann)](https://launchpad.net/~falk-reimann) wrote on 2015-06-24: |  |  | [#1](/swift/%2Bbug/1468374/comments/1) |
| --- | --- | --- | --- |

Patch for review provided:

<https://review.openstack.org/#/c/195131/>

Patch for review provided:
https://review.openstack.org/#/c/195131/

[John Dickinson (notmyname)](https://launchpad.net/~notmyname)
on 2015-07-06

| Changed in swift: | |
| --- | --- |
| **status**: | New → In Progress |

[John Dickinson (notmyname)](https://launchpad.net/~notmyname)
on 2015-07-06

| Changed in swift: | |
| --- | --- |
| **assignee**: | nobody → Falk Reimann (falk-reimann) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-31:  [**Fix merged to swift (master)**](/swift/%2Bbug/1468374/comments/2) |  |  | [#2](/swift/%2Bbug/1468374/comments/2) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/195131>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=363a256e58ee0f3e9f059352c2de968e3dc398e3>

Submitter: Jenkins

Branch: master

commit 363a256e58ee0f3e9f059352c2de968e3dc398e3

Author: Falk Reimann <email address hidden>

Date: Wed Jun 24 16:54:02 2015 +0200

Support keystone v3 domains in swift-dispersion

This provides the capability to specify a project\_name,

    project\_domain\_name and user\_domain\_name in /etc/swift/dispersion.conf.

    If this values are set in dispersion.conf they get populated to the

    swift-client. With this it is possible to have a specific dispersion

    project specified, which is not the keystone default domain. Changes

    were applied to swift-dispersion-populate and swift-dispersion-report.

    Relevant man pages, the example dispersion.conf and the admin guide were

    updated accordingly.

DocImpact

    Closes-Bug: #1468374

Change-Id: I0e716f8d281b4d0f510bc568bcee4a13fc480ff7

Reviewed: https://review.openstack.org/195131
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=363a256e58ee0f3e9f059352c2de968e3dc398e3
Submitter: Jenkins
Branch: master
commit 363a256e58ee0f3e9f059352c2de968e3dc398e3
Author: Falk Reimann <falk.reimann@sap.com>
Date: Wed Jun 24 16:54:02 2015 +0200
Support keystone v3 domains in swift-dispersion
This provides the capability to specify a project\_name,
project\_domain\_name and user\_domain\_name in /etc/swift/dispersion.conf.
If this values are set in dispersion.conf they get populated to the
swift-client. With this it is possible to have a specific dispersion
project specified, which is not the keystone default domain. Changes
were applied to swift-dispersion-populate and swift-dispersion-report.
Relevant man pages, the example dispersion.conf and the admin guide were
updated accordingly.
DocImpact
Closes-Bug: #1468374
Change-Id: I0e716f8d281b4d0f510bc568bcee4a13fc480ff7

| Changed in swift: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-08-03:  [**Fix proposed to swift (feature/crypto)**](/swift/%2Bbug/1468374/comments/3) |  |  | [#3](/swift/%2Bbug/1468374/comments/3) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/208513>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/208513

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-08-04:  [**Fix merged to swift (feature/crypto)**](/swift/%2Bbug/1468374/comments/4) |  |  | [#4](/swift/%2Bbug/1468374/comments/4) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/swift/%2Bbug/1468374/comments/4/%2Bdownload) (17.4 KiB)

Reviewed: <https://review.openstack.org/208513>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=942c9bb45c6b8124bcaa407eb9b9ac7f0589c743>

Submitter: Jenkins

Branch: feature/crypto

commit 207dd9b49d7d53a9faa4849af2c40bb875416fce

Author: Darrell Bishop <email address hidden>

Date: Thu Jul 30 14:32:08 2015 -0700

Fix regression in WSGI server SIGHUP behavior

The SIGHUP receipt used to pop us out of an os.wait() where now, it's in

    a "green" wait() and Timeout() combo, some part of which eats the signal

    receipt. This causes the while loop condition to never get checked and

    SIGHUP no longer works as a server reload command.

The fix is to loop at least every 0.5 seconds, as a trade-off between

    not busy-waiting and checking the "keep running" condition often enough

    to feel responsive.

Change-Id: I95283b8b7cfc2998ab5813e0ad3ca1fa231696c8

    Closes-Bug: #1479972

commit bcd00d9461603db1477c5f1e9f8dd6405a319eb9

Author: Alistair Coles <email address hidden>

Date: Mon Jun 8 19:40:56 2015 +0100

Refactor diskfile

This patch mostly eliminates the duplicate code that was

    deliberately left in place during EC review to avoid major

    churn of the diskfile module prior to the kilo release.

This focuses on obvious de-duplication and shuffling code

    between classes. It deliberately does not attempt to

    hammer out every last piece of de-duplication where that

    would introduce more complex changes - that can come later.

Code is moved from the module level and from ECDiskFile\*

    classes into new BaseDiskFile\* classes.

Concrete classes for replication and EC policy retain their

    existing names i.e. DiskFile[Manager|Writer|Reader|] and

    ECDiskFile[Manager|Writer|Reader|] respectively.

Knock-on changes:

- fix bug whereby get\_hashes was ignoring self.reclaim\_age

      and always using the default arg value.

- replication diskfile manager now deletes a tombstone that is older

      than reclaim\_age even when there is a newer .meta file.

- replication diskfile manager will no longer raise an

      AssertionError if only a .meta file is found during

      hash\_cleanup\_listdir.

- fix stale test in test\_auditor.py: test\_with\_tombstone test

      setup was convoluted (probably dates back to when object puts

      did not clean up the object dir). Now that they do you have to

      try harder to create a dir with a tombstone and a data file.

Change-Id: I963e0d0ae0d6569ad1de605034c529529cbb4f9a

commit 9cb7eb4a4b6cdab8a5f16b3dc800b39ab4068522

Author: Victor Stinner <email address hidden>

Date: Mon Jul 27 11:34:07 2015 +0200

Update hacking to 0.10.0

Replace the whitelist of flake8 checks (select) with a blacklist

    (ignore). It makes possible to disable a single check, which was not

    possible before. This new approach permits to enable new tests more

    easily and see which checks are currently disabled.

Only new checks are disabled, this change doesn't run less checks than

    before. Currently, many checks are disabled, but following changes will

    ...

Reviewed: https://review.openstack.org/208513
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=942c9bb45c6b8124bcaa407eb9b9ac7f0589c743
Submitter: Jenkins
Branch: feature/crypto
commit 207dd9b49d7d53a9faa4849af2c40bb875416fce
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu Jul 30 14:32:08 2015 -0700
Fix regression in WSGI server SIGHUP behavior
The SIGHUP receipt used to pop us out of an os.wait() where now, it's in
a "green" wait() and Timeout() combo, some part of which eats the signal
receipt. This causes the while loop condition to never get checked and
SIGHUP no longer works as a server reload command.
The fix is to loop at least every 0.5 seconds, as a trade-off between
not busy-waiting and checking the "keep running" condition often enough
to feel responsive.
Change-Id: I95283b8b7cfc2998ab5813e0ad3ca1fa231696c8
Closes-Bug: #1479972
commit bcd00d9461603db1477c5f1e9f8dd6405a319eb9
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Jun 8 19:40:56 2015 +0100
Refactor diskfile
This patch mostly eliminates the duplicate code that was
deliberately left in place during EC review to avoid major
churn of the diskfile module prior to the kilo release.
This focuses on obvious de-duplication and shuffling code
between classes. It deliberately does not attempt to
hammer out every last piece of de-duplication where that
would introduce more complex changes - that can come later.
Code is moved from the module level and from ECDiskFile\*
classes into new BaseDiskFile\* classes.
Concrete classes for replication and EC policy retain their
existing names i.e. DiskFile[Manager|Writer|Reader|] and
ECDiskFile[Manager|Writer|Reader|] respectively.
Knock-on changes:
- fix bug whereby get\_hashes was ignoring self.reclaim\_age
and always using the default arg value.
- replication diskfile manager now deletes a tombstone that is older
than reclaim\_age even when there is a newer .meta file.
- replication diskfile manager will no longer raise an
AssertionError if only a .meta file is found during
hash\_cleanup\_listdir.
- fix stale test in test\_auditor.py: test\_with\_tombstone test
setup was convoluted (probably dates back to when object puts
did not clean up the object dir). Now that they do you have to
try harder to create a dir with a tombstone and a data file.
Change-Id: I963e0d0ae0d6569ad1de605034c529529cbb4f9a
commit 9cb7eb4a4b6cdab8a5f16b3dc800b39ab4068522
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Jul 27 11:34:07 2015 +0200
Update hacking to 0.10.0
Replace the whitelist of flake8 checks (select) with a blacklist
(ignore). It makes possible to disable a single check, which was not
possible before. This new approach permits to enable new tests more
easily and see which checks are currently disabled.
Only new checks are disabled, this change doesn't run less checks than
before. Currently, many checks are disabled, but following changes will
fix these new warnings.
When the "select" option of flake8 is used in tox.ini, the "ignore"
option is ignored. It is not possible to use "select" and "ignore"
options at the same time. See the code in pep8 (flake8 is based on
pep8):
https://github.com/PyCQA/pep8/blob/d48eef071003952ed0f98445dc3dc6bc29618f9c/pep8.py#L1808
The purpose of flake8 is to enhance the coding style, but also to help
to detect common bugs. Blacklisting checks permits to detect new bugs
when upgrading the tools. For example, new checks were recently added to
help porting code to Python 3.
This change permits to use pbr 1.0 and newer which is required to
support Python 3. Previously, hacking 0.8.1 was used, but hacking 0.8 is
incompatible with pbr 1.0 and newer (hacking 0.8 requires pbr<1.0).
pbr 1.0 is required to use environment markers on requirements to
install dnspython on Python 2 and dnspython3 on Python 3.
Change-Id: I41d63b9467083d7606ad18aaa398ca7738b27fae
commit 389a97e3526df68121cecfaf1909343b5d381cbc
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed Jul 29 23:46:58 2015 +0200
Fix pep8 E warning for hacking 0.10
Fix pep8 warnings of the E category of hacking 0.10:
\* E113: unexpected indentation
\* E121: continuation line under-indented for hanging indent
\* E122: continuation line missing indentation or outdented
\* E123: closing bracket does not match indentation of opening bracket's
line
\* E126: continuation line over-indented for hanging indent
\* E251: unexpected spaces around keyword / parameter equals
Change-Id: I0b24eebdf1a37dc1b572b6c9a3d3d4832d050237
commit d719064e788ec5fa70305fadaa46affcb603a9bb
Author: Victor Stinner <vstinner@redhat.com>
Date: Thu Jul 30 00:28:44 2015 +0200
Fix warning pep8 E128 warning of hacking 0.10
Fix the warning E128: "continuation line under-indented for visual
indent" of pep8.
Change-Id: Ie6c6ae341fe3d6281f2095c1d756d552fa5937f9
commit a0db56dcde83096708e6fe64ae9338098e0ba98a
Author: Victor Stinner <vstinner@redhat.com>
Date: Thu Jul 30 00:16:06 2015 +0200
Fix pep8 E265 warning of hacking 0.10
Fix the warning E265 "block comment should start with '# '" added in pep
1.5.
Change-Id: Ib57282e958be9c7cddffc7bca34fbbf1d4c460fd
commit 345785837f1caa01fec5bca091c70481d7069bea
Author: Charles Hsu <charles0126@gmail.com>
Date: Thu Jul 30 13:11:00 2015 +0800
Remove error\_suppression\_interval, error\_suppression\_limit options.
These two options is belong to proxy-server, not account-replicator.
Change-Id: Ie030ecffd213e56db32df77c69b847479d96308f
commit 5a7383313b1c555df5fd47050f7ee3810b5e31fc
Author: Carlos Cavanna <ccavanna@ca.ibm.com>
Date: Tue Jul 28 19:15:25 2015 -0400
Swift documentation for first-time contributors.
In this change, there are proposed improvement to Swift documentation aimed at
first-time contributors. They include a simplification of the Getting
Started page and a new page with some basic instructions/commands that the
first-time contributor should know. In addition, it shows some common errors
that the first-time contributor may find when executing git rebase and
information on how to track your changes.
Change-Id: I704202955093736b2f3b4102a649690a0392c6b0
commit 5b5c8820024141bc6ae49d7646a92fb53667ea9b
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Jul 29 12:36:35 2015 +0100
Remove unused code in swift/obj/server.py
keep\_cache was defined twice
Change-Id: I5f775f618669e3dabfc3bc54dd7bd2cd7f00b2f0
commit 0c27cb07caf1027cd9734e8bd34d9759da33e667
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Wed Jul 29 06:36:01 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Ic30cb1dc8f12280a52cc1f07a1cf516397ed680e
commit 117b61976fbf14d8a0d2157256f9a3230421ee72
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jul 22 15:40:55 2015 -0700
functests: use assertIn and assertNotIn
We have a bunch of assertions like
self.assertTrue(resp.status in (200, 204))
Sometimes we get smart about failure messages and have something like
self.assertTrue(resp.status in (200, 204), resp.status)
so we can see what the status was when it failed.
Since we don't have to support Python 2.6 any more, we can use
assertIn/assertNotIn and get nice failure messages for free.
Change-Id: I2d46c9969d41207a89e01017b4c2bc533c3d744f
commit 8fe8bee7e0c5c9d34d7a8e6ab090c8d65c5ca78e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 21 18:06:32 2015 +0530
test/(functional, probe): Replace "self.assert\_" by "self.assertTrue"
The assert\_() method is deprecated and can be safely replaced by assertTrue().
This patch makes sure that running the tests does not generate warnings
all over the screen.
Change-Id: I74705c6498249337bfdf955d62e0ad972035bc1f
commit 4a6e0ccc69302a5384b988149e294656323d7f20
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jul 20 11:58:35 2015 -0700
Rename WsgiStringIO -> WsgiBytesIO.
If we're going to have a subclass of BytesIO, having "StringIO" in its
name is just asking for confusion.
Change-Id: I695ab3105b1a02eb158dcf0399ae91888bc1c0ac
commit 5ee742c17d9ea92ca7332cb67db0cce64b7a0d8f
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 24 21:19:47 2015 +0530
Modifying Lambda function tuple usage for python3
Current tuple unpacking is not supported in python3
Change-Id: I15a8e977684d19154cf2233caf1174f6983ac9e2
commit 6f89f71f9ba11f7b4126b80076a0f13792332e1e
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Apr 15 16:17:23 2015 +0100
Filter Etag key from ssync replication-headers
ssync rx sends a header X-Backend-Replication-Headers whose value is a
list of headers that the source object has. This list extends the list
of allowed headers on the target object server, so that the target
object metadata is faithfully reconstructed to match the source.
Unfortunately the combination of lower() and title() operations on
header keys results in the source 'ETag' value being added to the target
metadata under the key 'Etag' in addition to the 'ETag' key that the
receiving server adds (note different capitilization), both having
the same value.
The spurious 'Etag' metadata is potentially confusing for humans
inspecting the object metadata and complicates tests that wish to
assert the equality of two object metadata dicts. See for example the
test in test\_ssync\_sender.py that this patch cleans up.
Furthermore, the possibility of having both Etag and ETag keys has
required a workaround in the EC reconstructor [1].
[1] reconstructor fix change id: Ie59ad93a67a7f439c9a84cd9cff31540f97f334a
Change-Id: I0c89cf7924a4471bb6d268b5ef3884e2d2cb4286
commit e2f69138bf5fcdd84ac23be6b0bec1bb006b41f5
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jul 23 16:46:48 2015 -0700
Fix string formatting in dispersion cli command
... and add a basic test that would have prevented the regression
Change-Id: I4c5f643ee291dcc1397ca951450459d8b8ad0bbd
commit 83025ff38dfea3d4e3f27dc045128a7aa4ba11e4
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jul 24 11:09:10 2015 -0700
Use right most occurrence object dir in diskfile.extract\_policy
I like using the rightmost one more; it's basically
/operator-defined/mountpoint/objects/part/suffix/hash/ts.data, so I
don't see any opportunity for other things named "objects" to creep in on the
right of the real objects-N dir; but I could see some admin using
/srv/object-storage/ or something
-- Torgomatic The Wise
Change-Id: I0a63a3e02df091a5ee2e110a345183012e357a2f
commit 363a256e58ee0f3e9f059352c2de968e3dc398e3
Author: Falk Reimann <falk.reimann@sap.com>
Date: Wed Jun 24 16:54:02 2015 +0200
Support keystone v3 domains in swift-dispersion
This provides the capability to specify a project\_name,
project\_domain\_name and user\_domain\_name in /etc/swift/dispersion.conf.
If this values are set in dispersion.conf they get populated to the
swift-client. With this it is possible to have a specific dispersion
project specified, which is not the keystone default domain. Changes
were applied to swift-dispersion-populate and swift-dispersion-report.
Relevant man pages, the example dispersion.conf and the admin guide were
updated accordingly.
DocImpact
Closes-Bug: #1468374
Change-Id: I0e716f8d281b4d0f510bc568bcee4a13fc480ff7
commit 3d9b2d077a157279fb6cd107a0c83727106af3ef
Author: Daisuke Morita <morita.daisuke@lab.ntt.co.jp>
Date: Fri Jul 24 10:42:10 2015 +0900
Fix swift-object-info to show policy index at deep working directory
If swift-object-info command is executed at deeper working directory
than 'objects-\*' directory, it cannot parse policy index from file path
so it does not show appropriate policy index. This patch fixes this
problem by simply extracting the full path of a target object file.
Change-Id: Idb734106a44b6121119c9b1dc8cdaaf4c6c28c31
Closes-Bug: 1469951
commit e24d7c36fa9758618ef88ed1a8e19f4d7bb0404f
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon May 25 18:26:38 2015 +0200
Use six to fix imports on Python 3
Get configparser, queue, http\_client modules from six.moves.
Patch generated by the six\_moves operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Change-Id: I666241ab50101b8cc6f992dd80134ce27327bd7d
commit 964869accce8836bd2587c4b07559fb05fe580b2
Author: Atsushi SAKAI <sakaia@jp.fujitsu.com>
Date: Fri Jul 24 17:09:48 2015 +0900
Fix six typos on swift documentation
mechanisim => mechanism
http://docs.openstack.org/developer/swift/cors.html
overridde => override
http://docs.openstack.org/developer/swift/deployment\_guide.html
extentsions => extensions
http://docs.openstack.org/developer/swift/development\_ondisk\_backends.html
reuqest => request
http://docs.openstack.org/developer/swift/logs.html
suport => support
http://docs.openstack.org/developer/swift/overview\_architecture.html
mininum => minimum
http://docs.openstack.org/developer/swift/overview\_erasure\_code.html
$ git diff | diffstat
cors.rst | 2 +-
deployment\_guide.rst | 2 +-
development\_ondisk\_backends.rst | 2 +-
logs.rst | 2 +-
overview\_architecture.rst | 2 +-
overview\_erasure\_code.rst | 2 +-
6 files changed, 6 insertions(+), 6 deletions(-)
Change-Id: I8e095f4c216b2cfae48dff1e17d387048349f73c
Closes-Bug: #1477877
commit f563a423bf2534268c2e785094d58dbbe0ebd390
Author: Hamdi Roumani <roumani@ca.ibm.com>
Date: Wed Jul 22 15:27:26 2015 -0400
Updated tox setup instructions on Development Guidelines
The instructions suggest updating the ownership of the swift.egg-info
directory may be required and provide a cmd to do so. Said cmd assumes user
'swift' exists, but tox will require the current user to have access to the
directory to perform updates, moreover user swift may not exist at all.
Change-Id: I63951970553c086ff4f1ac65a81559ba69166494
commit 39621b8629c7f378fc197f6ab1ddc8e2e797d1fa
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jul 18 14:12:58 2015 +0530
Deprecated xreadlines() usage fixed
Change-Id: Iadf42c2f86f78c11259e21c88b4aef51db3441ad
commit dde34c4b442a27761f2e6eca46ed9ec47a110392
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jul 11 22:46:41 2015 +0530
Modify zip usage for python3 where necessary.
py2 zip() is eager but py3 zip() and six.moves.zip() are lazy,
changing ones that require eager evaluation.
Change-Id: Ic9f6bccd7f57772158581905794f8d23b05f4223
commit c366ecf5c85c2797582bf79f7faab1d75b99a70e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jul 13 00:07:13 2015 +0530
Fix a minor python issue related with string.split
Replacing string.split(value, ',') with value.split(','):
the string.split() function was removed in Python 3
Change-Id: I9ed241a894ac698da33df75a774a56ae2824fadf
commit 39b6ef6e4fd515d81e688ef365d26d5e0499be7c
Author: Charles Hsu <charles0126@gmail.com>
Date: Thu Jun 25 02:06:54 2015 +0800
Fix reconstructor stats mssage.
Calculate reconstruction job count and remaining time that
would be inappropriate for user. Use real partition count would
be suitable for user.
Change-Id: I6b025854baf4757dddf9d7fe7bc2cece58a49157
Closes-Bug: #1468298
commit bfbda38db999ccd881509c68f0319c3d3dae4274
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 7 15:13:20 2015 -0700
Add save command to ring-builder-analyzer
\* cleanup command => ring builder function mapping
\* cleanup ParseCommandError/ValueError message building
Change-Id: I4be2aa963ce4f43035f02371d8388abd7a76536c
commit c907107fe4eacb378a92799de915234bd72d5d7c
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 7 22:46:37 2015 +0530
cPickle is deprecated in py3, replacing it from six.moves
cPickle is deprecated and should be replaced with six.moves
to provide py2 and py3 compatibility.
Change-Id: Ibad990708722360d188c641e61444d50a16a1e93
commit 86033ba4dcd7b86670306b6e66345ae464caca9d
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Jun 30 18:56:23 2015 +0100
EC tests should use ECDiskFileManager
Some EC tests in proxy/test\_server.py use the replication
DiskFileManager to open diskfiles. That works because it
turns out that DiskFileManager is robust to the frag index
being stitched onto the end of the timestamp in filenames,
but it would be better to test using the ECDiskFileManager
for EC diskfiles.
Also, drive-by deletion of some duplicated lines.
Change-Id: Ie3adb607d8c34a469df7d0f6f542ed5ba9a2dac0

| **tags**: | added: in-feature-crypto |
| --- | --- |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-09-01

| Changed in swift: | |
| --- | --- |
| **milestone**: | none → 2.4.0 |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix proposed to swift (feature/hummingbird)**](/swift/%2Bbug/1468374/comments/5) |  |  | [#5](/swift/%2Bbug/1468374/comments/5) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/221410>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/221410

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-09-08:  [**Fix merged to swift (feature/hummingbird)**](/swift/%2Bbug/1468374/comments/6) |  |  | [#6](/swift/%2Bbug/1468374/comments/6) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/swift/%2Bbug/1468374/comments/6/%2Bdownload) (70.7 KiB)

Reviewed: <https://review.openstack.org/221410>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=eb8f1f83f1cfc63d8452bc30096fd1c145781527>

Submitter: Jenkins

Branch: feature/hummingbird

commit cb683d391cb66d0f52830de16760c80fd2afedf9

Author: OpenStack Proposal Bot <email address hidden>

Date: Sat Sep 5 06:17:51 2015 +0000

Imported Translations from Transifex

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I2d92b8e34a665fb0bb4c048cfb0c59de295dfce6

commit e4542455c8a07b7981c247df8b737816062c1655

Author: Emett Speer <email address hidden>

Date: Wed Sep 2 17:18:03 2015 -0700

[Labs] Update links to Cloud Admin Guide

Update links to the Cloud Admin Guide after the

    RST conversion of that book altered URLs.

Change-Id: I899f8938498b744e62887968a65e58c00ef27f1b

commit 58fcc07523978306cd3889ada73af5d9e664cf59

Author: Christian Schwede <email address hidden>

Date: Wed Sep 2 10:52:34 2015 +0000

Test if container\_sweep is executed on unmounted devices

This change ensures that container\_sweep is not run if a device is not mounted

    and mount\_check is set to True.

Change-Id: I823083c8431d9e61fd426508033ec9188503957b

commit e02609c66a804845672413b06830b87395afef31

Author: Samuel Merritt <email address hidden>

Date: Tue Sep 1 15:19:50 2015 -0700

Preserve traceback in swift-dispersion-report

Commit c690bcb fixed a bug in the dispersion report, but changed this

    from a bare "raise" to "raise err", which loses the traceback. Not a

    big deal, but worth putting back IMO.

Change-Id: Id5b72153a4b8df8e3faaf1fa3fb2040e28ba85cc

commit d06d4ad0fd2dfe69da8008e729651264522c6c06

Author: Minwoo Bae <email address hidden>

Date: Tue Sep 1 15:08:44 2015 -0500

Included reference in swift.obj.diskfile to enumerate the string

    used for data file paths.

Change-Id: Ie22caa678bc00dfc43fabec7efbbb9f34490f1b5

commit 615c7a204b9386e05c5bab658bfe96766ad1e680

Author: Brian Cline <email address hidden>

Date: Tue Sep 1 10:51:20 2015 -0500

Adds useful dispersion info from changelog

Change-Id: I1a45088fc32620b02ff9a754b02ec1eb75a59d6e

commit 3b8755098a1786c5447abf158bd686293a82977c

Author: janonymous <email address hidden>

Date: Sun Aug 2 21:29:13 2015 +0530

Replace a / b with a // b to use integer division where needed

Change-Id: I72c81faa62786e140b0de00e3a04934bf1b5adbd

commit 524c89b7eeff037b8a6b421888771e15f98c2da2

Author: John Dickinson <email address hidden>

Date: Fri Aug 21 13:39:41 2015 -0700

Updated CHANGELOG, AUTHORS, and .mailmap for 2.4.0 release.

Change-Id: Ic6301146b839c9921bb85c4f4c1e585c9ab66661

commit 05de1305a903ee4ce9c8c50fde53c552d5b90d51

Author: Clay Gerrard <email address hidden>

Date: Thu Aug 27 18:35:09 2015 -0700

Make ssync\_sender send valid chunked requests

The connect method of ssync\_sender tells the remote connection that it's

    going to send a valid HTTP chunked request, but if the remote end needs

    to respond with an error of any kind sender th...

Reviewed: https://review.openstack.org/221410
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=eb8f1f83f1cfc63d8452bc30096fd1c145781527
Submitter: Jenkins
Branch: feature/hummingbird
commit cb683d391cb66d0f52830de16760c80fd2afedf9
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Sat Sep 5 06:17:51 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I2d92b8e34a665fb0bb4c048cfb0c59de295dfce6
commit e4542455c8a07b7981c247df8b737816062c1655
Author: Emett Speer <speer.emett@gmail.com>
Date: Wed Sep 2 17:18:03 2015 -0700
[Labs] Update links to Cloud Admin Guide
Update links to the Cloud Admin Guide after the
RST conversion of that book altered URLs.
Change-Id: I899f8938498b744e62887968a65e58c00ef27f1b
commit 58fcc07523978306cd3889ada73af5d9e664cf59
Author: Christian Schwede <cschwede@redhat.com>
Date: Wed Sep 2 10:52:34 2015 +0000
Test if container\_sweep is executed on unmounted devices
This change ensures that container\_sweep is not run if a device is not mounted
and mount\_check is set to True.
Change-Id: I823083c8431d9e61fd426508033ec9188503957b
commit e02609c66a804845672413b06830b87395afef31
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Sep 1 15:19:50 2015 -0700
Preserve traceback in swift-dispersion-report
Commit c690bcb fixed a bug in the dispersion report, but changed this
from a bare "raise" to "raise err", which loses the traceback. Not a
big deal, but worth putting back IMO.
Change-Id: Id5b72153a4b8df8e3faaf1fa3fb2040e28ba85cc
commit d06d4ad0fd2dfe69da8008e729651264522c6c06
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Tue Sep 1 15:08:44 2015 -0500
Included reference in swift.obj.diskfile to enumerate the string
used for data file paths.
Change-Id: Ie22caa678bc00dfc43fabec7efbbb9f34490f1b5
commit 615c7a204b9386e05c5bab658bfe96766ad1e680
Author: Brian Cline <bcline@softlayer.com>
Date: Tue Sep 1 10:51:20 2015 -0500
Adds useful dispersion info from changelog
Change-Id: I1a45088fc32620b02ff9a754b02ec1eb75a59d6e
commit 3b8755098a1786c5447abf158bd686293a82977c
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Aug 2 21:29:13 2015 +0530
Replace a / b with a // b to use integer division where needed
Change-Id: I72c81faa62786e140b0de00e3a04934bf1b5adbd
commit 524c89b7eeff037b8a6b421888771e15f98c2da2
Author: John Dickinson <me@not.mn>
Date: Fri Aug 21 13:39:41 2015 -0700
Updated CHANGELOG, AUTHORS, and .mailmap for 2.4.0 release.
Change-Id: Ic6301146b839c9921bb85c4f4c1e585c9ab66661
commit 05de1305a903ee4ce9c8c50fde53c552d5b90d51
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Aug 27 18:35:09 2015 -0700
Make ssync\_sender send valid chunked requests
The connect method of ssync\_sender tells the remote connection that it's
going to send a valid HTTP chunked request, but if the remote end needs
to respond with an error of any kind sender throws HTTP right out the
window, picks up his ball, and closes the socket down hard - much to the
surprise of the eventlet.wsgi server who up to this point had been
playing along quite nicely with this 'SSYNC' nonsense assuming that
everyone here is consenting mature adults.
If you're going to make a "Transfer-Encoding: chunked" request have the
good decency to finish the job with a proper '0\r\n\r\n'. [1]
N.B. It might be possible to handle an error status during the
initialize\_request phase with some sort of 100-continue support, but
honestly it's not entirely clear to me when the server isn't going to
close the connection if the client is still expected to send the body
[2] - further if the error comes later during missing\_check or updates
we'll for sure want to send the chunk transfer termination line before
we close down the socket and this way we cover both.
1. Really, eventlet.wsgi shouldn't be so blasted brittle about this [3]
2. https://lists.w3.org/Archives/Public/ietf-http-wg/2005AprJun/0007.html
3. https://github.com/eventlet/eventlet/commit/c3ce3eef0b4d0dfdbfb1ec0186d4bb204fb8ecd5
Closes-Bug #1489587
Change-Id: Ic17c6c3075553f8cf6ef6213e62a00282f0d01cf
commit 993ee4e37af1961adba2047d5aa2eb210e423eb3
Author: nakagawamsa <nakagawamsa@nttdata.co.jp>
Date: Fri Aug 28 11:49:43 2015 +0900
Remove duplicate X-Backend-Storage-Policy-Index key
There is duplicate 'X-Backend-Storage-Policy-Index' dictionary key in unit.obj.test\_server.py.
One key has fixed policy index value, and another has random value.
Unittest should done with random policy index, so remove key which is set fixed value.
Change-Id: Ic91fcf44d48297d0feee33c928ca682def9790a3
commit 893f30c61d280804e417790dd34ba7bc3fb4f6fc
Author: paul luse <paul.e.luse@intel.com>
Date: Wed Aug 12 13:32:50 2015 -0700
EC GET path: require fragments to be of same set
And if they are not, exhaust the node iter to go get more. The
problem without this implementation is a simple overwrite where
a GET follows before the handoff has put the newer obj back on
the 'alive again' node such that the proxy gets n-1 fragments
of the newest set and 1 of the older.
This patch bucketizes the fragments by etag and if it doesn't
have enough continues to exhaust the node iterator until it
has a large enough matching set.
Change-Id: Ib710a133ce1be278365067fd0d6610d80f1f7372
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Closes-Bug: 1457691
commit 58a10a5fffec69304d7bcce0f1c43bd2a9f9ff52
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Aug 26 16:30:23 2015 +0100
Add test that a tempurl POST cannot set a DLO manifest header
Follow up to [1] to add tests for tempurl POSTs not being allowed
to set a DLO manifest header.
[1] I11e68830009d3f6bff44ae4011a41b67139146f6
Change-Id: I7c0ad5a936f71e56c599b8495a586913d3334422
Related-Bug: 1453948
commit d4409c0a046c6ce0e14e18c95efe2cd16cf120e8
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Aug 11 09:10:13 2015 -0500
Better scoping for tempurls, especially container tempurls
It used to be that a GET of a tempurl referencing a large object would
let you download that large object regardless of where its segments
lived. However, this led to some violated user expectations around
container tempurls.
(Note on shorthand: all tempurls reference objects. However, "account
tempurl" and "container tempurl" are shorthand meaning tempurls
generated using a key on the account or container, respectively.)
Let's say an application is given tempurl keys to a particular
container, and it does all its work therein using those keys. The user
expects that, if the application is compromised, then the attacker
only gains access to the "compromised-container". However, with the old
behavior, the attacker could read data from \*any\* container like so:
1) Choose a "victim-container" to download
2) Create PUT and GET tempurl for any object name within the
"compromised-container". The object doesn't need to exist;
we'll create it.
3) Using the PUT tempurl, upload a DLO manifest with
"X-Object-Manifest: /victim-container/"
4) Using the GET tempurl, download the object created in step 3. The
result will be the concatenation of all objects in the
"victim-container".
Step 3 need not be for all objects in the "victim-container"; for
example, a value "X-Object-Manifest: /victim-container/abc" would only
be the concatenation of all objects whose names begin with "abc". By
probing for object names in this way, individual objects may be found
and extracted.
A similar bug would exist for manifests referencing other accounts
except that neither the X-Object-Manifest (DLO) nor the JSON manifest
document (SLO) have a way of specifying a different account.
This change makes it so that a container tempurl only grants access to
objects within its container, \*including\* large-object segments. This
breaks backward compatibility for container tempurls that may have
pointed to cross container \*LO's, but (a) there are security
implications, and (b) container tempurls are a relatively new feature.
This works by having the tempurl middleware install an authorization
callback ('swift.authorize' in the WSGI environment) that limits the
scope of any requests to the account or container from which the key
came.
This requires swift.authorize to persist for both the manifest request
and all segment requests; this is done by having the proxy server
restore it to the WSGI environment prior to returning from \_\_call\_\_.
[CVE-2015-5223]
Co-Authored-By: Clay Gerrard <clayg@swiftstack.com>
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Co-Authored-By: Christian Schwede <cschwede@redhat.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Change-Id: Ie6d52f7a07e87f6fec21ed8b0ec1d84be8b2b11c
Closes-Bug: 1449212
commit 10b2939b433a4a79b4f7b97640b3d208cacfeffb
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jul 23 22:36:21 2015 -0700
Disallow unsafe tempurl operations to point to unauthorized data
Do not allow PUT tempurls to create pointers to other data. Specifically
disallow the creation of DLO object manifests by returning an error if a
non-safe tempurl request includes an X-Object-Manifest header regardless of
the value of the header.
This prevents discoverability attacks which can use any PUT tempurl to probe
for private data by creating a DLO object manifest and then using the PUT
tempurl to head the object which would 404 if the prefix does not match any
object data or form a valid DLO HEAD response if it does.
This also prevents a tricky and potentially unexpected consequence of PUT
tempurls which would make it unsafe to allow a user to download objects
created by tempurl (even if they just created them) because the result of
reading the object created via tempurl may not be the data which was uploaded.
[CVE-2015-5223]
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: I11e68830009d3f6bff44ae4011a41b67139146f6
Closes-Bug: 1453948
commit c690bcb68331818a04c94741b25f40cc40f7b3c4
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Mon Aug 17 16:50:56 2015 +0900
Fix dispersion-reports error message
This patch fixes Swift to show message
"No objects to query. Has swift-dispersion-populate been run?"
for "swift-dispersion-report —object-only”
with no container for object dispersion.
Change-Id: I82da56709cfc296a27f5180681709bc56adbc13d
Closes-Bug: #1468120
commit 8086a0e53406dc95856df2d3e015d3eaaf81380a
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Tue Aug 18 07:24:19 2015 +0000
Restrict PyECLib version to 1.0.7
v1.0.9 rev of PyECLib replaces Jerasure with a native EC
implementation (liberasurecode\_rs\_vand) as the default
EC scheme. Going forward, Jerasure will not be bundled
with PyPI version of PyECLib as it used to be, until
v1.0.7.
This is an interim change to Swift requirements until we
get v1.0.9 PyECLib included into global-requirements and
ready patches that change Swift default ec\_type (for doc,
config samples and unit tests) from "jerasure\_rs\_vand"
to "liberasurecode\_rs\_vand."
Change-Id: Ica4fee2cdea2bc7f5edd0e51ad637a4457faf3b4
commit 17efa343c605d0361b3f423696babbab3f3d972d
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jul 6 13:21:40 2015 -0700
Fix EC GET backend stream iteration state
In EC case, When GET object requested, proxy-server always makes a log
line "Client disconnected on read" even though the request succeeded.
That is because ECAppIter class doesn't maintain a bunch of backend
stream when closing the app\_iter. It will cause unfortunately
GeneratorExit on backend stream ResumingGetter.
This patch fixes to set non\_client\_disconnected to propagate the state
to the backend streams when the range iteration stopped successful.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I77af9807816bea1444d66534a17e2a210bcf09f8
Closes-Bug: #1472201
commit 25dc7224b63b039cb3778cca7f9f81f954c6d94e
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Aug 25 11:05:41 2015 +0100
Fix swob.Range docstring
Bad ranges cause a ValueError to be raised, not an empty
ranges list.
Change-Id: I118bd2f7dc08ff5198870f4093c6eb350506c8ed
commit a7b84f4c51207608adc3a5de7f4f9a629053c0ab
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Aug 24 23:11:34 2015 -0700
Allow pep8 of a single file
Now you can run
$ tox -e pep8 path/to/file.py [path/to/file2.py [...]]
to run pep8 against just those files[1]. This is quite a bit faster
than a full pep8 run, and the faster feedback is nice when you're
fiddling with some formatting to placate pep8.
Of course, you can still run "tox -e pep8" to check the whole source
tree, just as before this commit.
[1] It'll still run against bin/swift\* as well, but that's still a lot
faster than running against all our .py files.
Change-Id: I81b4363fb95a34ff0f5c346b2b24f2047154f502
commit 6a35d479e8952c854fee6fbef9fe0397a289a6e5
Author: Matthew Oliver <matt@oliver.net.au>
Date: Tue Aug 25 11:24:49 2015 +1000
Follow up patch to fix a multiline import NITPIC
This change cleans up test/unit/obj/test\_replicator.py's imports
to use only 1 version of multiline import syntaxes (' \' vs '()').
I don't really mind which, but we should be consistant, at least
in the same file.
This is a follow up for patch 215857.
Change-Id: Ie2d328c25865b19092c493981a803ee246a9d7a5
commit edde5584affaa983d8db1d294bf1e20a2d4bbb50
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Aug 25 07:52:18 2015 +0900
Fix typo of a comment in replicator
The typo was introduced by patch 138342 (sorry) so I fix it.
Change-Id: Id5126802d281ef7ee9be128bd2152c0d2584160e
commit 6151c6c45da481c0ea9a4fb876d14b39c1e347bf
Author: Tim Burke <tim.burke@gmail.com>
Date: Mon Aug 24 20:36:22 2015 +0000
Fix use of delimiter in account listings
Previously, account listings that used the delimiter query param could
omit some containers if they ended with the character that follows the
delimiter.
See If196e3075612b121ef8da4a9128167d00a248c27 for the corresponding fix
for container listings.
Change-Id: I57fcb97e51f653f5f4e306a632fcb3a0fb148c4e
commit a38f63e1c6b8b85b1675aa900e239a2e9906811e
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Aug 21 18:14:55 2015 -0700
Use correct Storage-Policy header for REPLICATE requests
Under some concurrency the object-replicator could potentially send the
wrong X-Backed-Storage-Policy-Index header to it's partner nodes during
replication if there were multiple storage policies on the same node
because of a race where multiple jobs being processed concurrently would
mutate some shared state on the ObjectReplicator instance.
Instead of using shared stated on the ObjectReplicator instance when
mutating the default headers send with REPLICATION requests each job
will copy them into a local where they can safely be updated.
Change-Id: I5522db57af7e308b1f9d4181f14ea14e386a71fd
commit ae129bf5e8c918efd8ee66279f98ee85e7c97b24
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri May 15 06:44:12 2015 -0700
eventlet.posthook related code needn't anymore
In the past, older Swift seemed to use eventlet.posthooks scheme for the
logging on proxy with posthooklogger method. However, for now, Swift
attaches no method to eventlet.posthooks everywhere so we don't have
to maintain the posthooks anymore.
Change-Id: Ie63941a202d448532d980252a4d25575f8edab9c
commit 4500ff340f021e4e5f6fd53960de03cb3c207925
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Wed May 13 00:43:59 2015 -0700
Fix the missing SLO state on fast-post
When using fast-post and POST (i.e. metadata update) is requested to
a SLO manifest files, current Swift drops the 'X-Static-Large-Object'
header from the existing metadata. It results in breaking the SLO
state because the manifest missing the 'X-Static-Large-Object' metadata
will be maintained as a normal files.
This patch fixes object-server to keep the existing
'X-Static-Large-Object' flag and then keep the SLO state.
Change-Id: Ib1eb569071372c322dd105c52baeeb094003291e
Closes-bug: #1453807
commit 69e7424d3cb6c59341d739c3d41f42397031d96a
Author: Eran Rom <eranr@il.ibm.com>
Date: Tue Jul 28 09:41:12 2015 +0300
Add container sync probe test to SAIO default set
SAIO Configuration and documentation changes enabling to run the
container sync probe test by default
Change-Id: Iccf59533d0d4fe72549d318339ab125d04dde006
Related-Bug: #1476623
commit 8b1df9918bf6c22b49b161a402199b532bfd8266
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Aug 21 14:04:46 2015 -0700
Minor cleanup handoff mode warnings
\* message is a little clearer
\* test is a little stronger
Change-Id: I745cde7f4a46dafc80ab42d39e6ccc92aa3b746e
commit a1ceab5a92dfdafd5abffed272ac2cece5302f32
Author: Carlos Cavanna <ccavanna@ca.ibm.com>
Date: Fri Aug 21 14:14:31 2015 -0400
New troubleshooting case in documentation.
Added a new troubleshooting case for the "First Contribution to Swift"
documentation page.
Change-Id: I182ba702b49b28409fe56becae93326e5f63dcd0
commit ab163702de733be39ba5e7024c7a8dd4c86bc29b
Author: Pradeep Kumar Singh <pradeep.singh@nectechnologies.in>
Date: Tue Jul 14 10:03:18 2015 +0530
Emit warning log in object replicator
When the object-replicator encounters handoffs\_first and
handoff\_delete options as enabled it should emit a log
warning indicating that it should be changed back to the
default before the next "normal" rebalance.
Closes-Bug: #1457262
Change-Id: If9dc2796c18ed3cf13da920831e2d5c2ae9f12a0
commit be66aa8e76d2994eb8a0a944e0dea26ffbb3c159
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Aug 20 13:24:38 2015 -0700
Fix 500 for bogus Range request to 0-byte object.
The proxy was trying to pop a byterange off a Range header that didn't
contain syntactically-valid byteranges. This worked about as well as
you'd expect. Now we detect the bogus value and remove the header
entirely.
Change-Id: I24b92f900d33ec79880c7db2870378489d5a6810
commit 4b6836b3bc465e9c2c6d2974c193a49b973c4e4e
Author: Akihito Takai <takaiak@nttdata.co.jp>
Date: Thu Aug 20 18:40:52 2015 +0900
Fix the comment in [1].
(line 259) parameter(op) of object\_update method is 'PUT' or
'DELETE' not 'POST' or 'DELETE'.
[1]: swift/obj/updater.py
Change-Id: I876a620ba8e09e69fba7156b12e69445c229e160
commit 923238aa1ba0963c414ba5321cd3910b2910f4ed
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 28 20:35:25 2015 +0530
test/(functional/probe):Replace python print operator with print function (pep H233, py33)
'print' function is compatible with 2.x and 3.x python versions
Link : https://www.python.org/dev/peps/pep-3105/
Python 2.6 has a \_\_future\_\_ import that removes print as language syntax,
letting you use the functional form instead
Change-Id: I416c6ac21ccbfb91ec328ffb1ed21e492ef52d58
commit 47dc31940d64b0c87e99cc73eddcdd01dd8b3ad4
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Aug 19 10:42:28 2015 -0700
Add OpenStack release names to changelog
I can never remember the mapping of real version numbers to the
OpenStack names.
Change-Id: Ib7c5ae4ff2a33018364698eb34f8df1622719fab
commit 183508710d011ec30ebba2186c58fd28d449e4bb
Author: Victor Stinner <vstinner@redhat.com>
Date: Sun Aug 16 11:18:49 2015 +0200
pep8: Don't override '\_' symbol
Fix pep8 warning F402 "import '\_' from line 51 shadowed by loop
variable".
Change-Id: I139060ff5d298a8b0f0f8e529a5737478fb5daf5
commit c7eb589c6ca2fe4f2950cae22a18513e4dec6c46
Author: Victor Stinner <vstinner@redhat.com>
Date: Sun Aug 16 11:06:52 2015 +0200
pep8: Fix usage of the l10n \_('...') function
Fix the pep8 warning H702 "Formatting operation should be outside of
localization method call".
For the logger, pass parameters as indexed parameters instead of using
the string str%args operator, the logger is more reliable in case of
formatting error.
Change-Id: If418bc155f6a6c0a00f63e3d87ebe4addf4aae55
commit 7bea148d2fe22daa9d1fbbc5cd16ebd390b64b1b
Author: Victor Stinner <vstinner@redhat.com>
Date: Sun Aug 16 10:34:26 2015 +0200
pep8: replace deprecated calls to assert\_()
The TestCase.assert\_() has been deprecated in Python 2.7. Replace it
with assertTrue() or even better methods (assertIn, assertNotIn,
assertIsInstance) which provide better error messages.
Change-Id: I21c730351470031a2dabe5238693095eabdb8964
commit 8aaacbf88d9ea4432e58dd261b98ff95d7c69be6
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Jul 27 18:55:01 2015 +0200
pep8: Fix hacking H232 warnings (octal)
Fix warnings "H232: Python 3.x incompatible octal 000001234 should be
written as 0o1234".
Change-Id: I9a7bbb034357783885ac3e18fe1e9e32a5951616
commit 5b01c5eadc3a13607d2581a55007700fca0b00af
Author: Bill Huber <wbhuber@us.ibm.com>
Date: Fri Aug 7 16:24:28 2015 -0500
Add unit test for container\_update for unmounted device
This unit test case gains coverage for container/update.py
where a device (i.e. sda1) is not mounted and the code
responds with a warning logger that the device is not
mounted and continues. Coverage increases 2% as a result.
Change-Id: I33d247a930b28604093df4ade1ce7dbbd24aac54
commit d6267c1f95a7fcd2b0e4f15d5efc6bcfe2114de0
Author: Clément Contini <ccontini@cloudops.com>
Date: Wed Aug 12 15:00:45 2015 -0400
Keep user id and project id in subrequests env
Keep HTTP\_X\_USER\_ID and HTTP\_X\_PROJECT\_ID to be available as
user\_id and project\_id in storage.objects.outgoing.bytes in
ceilometer when downloading a multipart object.
Change-Id: I0f4734f021e5d6e84d48ed9bebeb321d7a9590ad
Closes-Bug: #1477283
commit eaa006464cb98a2f36809edfa13bd3dcaebc9952
Author: John Dickinson <me@not.mn>
Date: Mon Aug 17 22:13:42 2015 -0700
move global statement up a few lines
Change-Id: I190d2d530c6c0525d988cc88b0965b48a291fffb
commit 1a81cda8b7eba0d25ea7341da756bb588cae8d73
Author: Hamdi Roumani <roumani@ca.ibm.com>
Date: Mon Aug 3 17:45:56 2015 -0400
Doc instructions for post rebase steps
Improve the 'first\_contribution\_swift' by adding instructions for how to
rebuild swift following a rebase.
Change-Id: If5c91dc4e1e8d1712bbd8b326c675967fb4b8c15
commit 79ba4a85983641e539b620bd143e62673c98416e
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Wed Dec 3 06:15:16 2014 +0900
Enable Object Replicator's failure count in recon
This patch makes the count of object replication failure in recon.
And "failure\_nodes" is added to Account Replicator and
Container Replicator.
Recon shows the count of object repliction failure as follows:
$ curl http://<ip>:<port>/recon/replication/object
{
"replication\_last": 1416334368.60865,
"replication\_stats": {
"attempted": 13346,
"failure": 870,
"failure\_nodes": {
"192.168.0.1": {"sdb1": 3},
"192.168.0.2": {"sdb1": 851,
"sdc1": 1,
"sdd1": 8},
"192.168.0.3": {"sdb1": 3,
"sdc1": 4}
},
"hashmatch": 0,
"remove": 0,
"rsync": 0,
"start": 1416354240.9761429,
"success": 1908
},
"replication\_time": 2316.5563162644703,
"object\_replication\_last": 1416334368.60865,
"object\_replication\_time": 2316.5563162644703
}
Note that 'object\_replication\_last' and 'object\_replication\_time' are
considered to be transitional and will be removed in the subsequent
releases. Use 'replication\_last' and 'replication\_time' instead.
Additionaly this patch adds the count in swift-recon and it will be
showed as follows:
$ swift-recon object -r
========================================================================
=======
--> Starting reconnaissance on 4 hosts
========================================================================
=======
[2014-11-27 16:14:09] Checking on replication
[replication\_failure] low: 0, high: 0, avg: 0.0, total: 0, Failed: 0.0%,
no\_result: 0, reported: 4
[replication\_success] low: 3, high: 3, avg: 3.0, total: 12,
Failed: 0.0%, no\_result: 0, reported: 4
[replication\_time] low: 0, high: 0, avg: 0.0, total: 0, Failed: 0.0%,
no\_result: 0, reported: 4
[replication\_attempted] low: 1, high: 1, avg: 1.0, total: 4,
Failed: 0.0%, no\_result: 0, reported: 4
Oldest completion was 2014-11-27 16:09:45 (4 minutes ago) by
192.168.0.4:6002.
Most recent completion was 2014-11-27 16:14:19 (-10 seconds ago) by
192.168.0.1:6002.
========================================================================
=======
In case there is a cluster which has servers, a server runs with this
patch and the other servers run without this patch. If swift-recon
executes on the server which runs with this patch, there are unnecessary
information on the output such as [failure], [success] and [attempted].
Because other servers which run without this patch are not able to
send a response with information that this patch needs.
Therefore once you apply this patch, you also apply this patch to other
servers before you execute swift-recon.
DocImpact
Change-Id: Iecd33655ae2568482833131f422679996c374d78
Co-Authored-By: Kenichiro Matsuda <matsuda\_kenichi@jp.fujitsu.com>
Co-Authored-By: Brian Cline <bcline@softlayer.com>
Implements: blueprint enable-object-replication-failure-in-recon
commit eeb0fa40a19917e6548f95f0bd3c08736928449b
Author: Christian Schwede <cschwede@redhat.com>
Date: Thu Aug 6 07:21:15 2015 +0000
Make swift-ring-builder filename usage more consistent
Sometimes the given argument is internally altered and another filename is used
without a note to the operator. Even worse, a given .ring.gz filename is
sometimes written out as builder file, without updating the corresponding
.builder file.
There is already a method to parse the given argv and return the name of the
builder and ring file. However, it's rarely used and no warning is given to the
user if it is altered. This patch uses the already parsed builder and ring file
name instead of argv[1], and also adds a note to the user if the used filename
is differently to the one given as argument.
Closes-Bug: 1482096
Change-Id: I2f8ef23aeab8b07caaa799f7dcd57e684b4b2ad2
commit b75d2a4e37d4c86763a2cc56c6dd53ebe2e0de19
Author: Bill Huber <wbhuber@us.ibm.com>
Date: Mon Aug 17 13:54:44 2015 -0500
Quorum on durable response is too low
Increase the .durable quorum from 2 to "parity + 1" to guarantee
that we will never fail to rebuild an object. Otherwise, with
low durable responses back (< parity + 1), the putter objects
return with failed attribute set to true, thereby failing the
rebuild of fragments for an object.
Change-Id: I80d666f61273e589d0990baa78fd657b3470785d
Closes-Bug: 1484565
commit fa35e38c9f83f704eb087f80157cbe33b23b9db2
Author: Kai Zhang <zakir.exe@gmail.com>
Date: Fri Aug 14 16:46:35 2015 -0700
Fix some minor typos
Fixed some typos in function name and comments.
Change-Id: Ida76ab4b331a51b71e57650702acc136e66ba4b2
commit 5b246e875fe9ac3d764ea581ad52b04238f5bcc8
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Wed Jul 22 10:39:22 2015 -0700
Fix EC range GET/COPY handling
When range GET (or COPY) for an EC object requested, if the requested range
starts from more than last segments alignment (i.e.
ceil(object\_size/segment\_size) \* segment\_size), proxy server will return
the original content length w/o body, though Swift should return an error
massage as a body and the length of message as the content length.
The current behavior will cause stuck on some client. (e.g. curl)
This patch fixes that proxy enables to return correct response, even if such
an over range requested.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I21f81c842f563ac4dddc69011ed759b744bb20bd
Closes-Bug: #1475499
commit 7064706b2721c36c5181267f58704b9344ad4ac0
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Aug 11 10:17:20 2015 -0500
Fix 500 in versioned writes with bad Destination
When this code lived in the proxy, it was protected by an "except
HTTPException" clause in proxy.Application.handle\_request(). When it
moved to middleware, it lost that, and then things like
constraints.check\_name\_format that raised HTTPException would cause
500s. The HTTPException would make it all the way out to catch\_errors
and get translated to a 500.
This commit just wraps a couple try/excepts around the bits in
versioned writes that can raise HTTPException. I tried to make it use
wsgify so I could get that for free, but that wound up being a real
pain because env/start\_response are plumbed through pretty much the
whole versioned-writes middleware.
Closes-Bug: 1483705
Change-Id: Ife165bf709e64f313ed07c779b21914045e51f25
commit 035a411660ca02983cd486312266c67d78a2359c
Author: Thiago da Silva <thiago@redhat.com>
Date: Sun Nov 9 13:13:27 2014 -0500
versioned writes middleware
Rewrite object versioning as middleware to simplify the PUT method
in the object controller.
The functionality remains basically the
same with the only major difference being the ability to now
version slo manifest files. dlo manifests are still not
supported as part of this patch.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
DocImpact
Change-Id: Ie899290b3312e201979eafefb253d1a60b65b837
Signed-off-by: Thiago da Silva <thiago@redhat.com>
Signed-off-by: Prashanth Pai <ppai@redhat.com>
commit 968c91a465627bb9317ed6e2ae9ccd818c83c0c4
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Jul 28 10:31:54 2015 +0100
Replace assertTrue(not <condition>) with assertFalse(<condition>)
The replacement of assert\_ with assertTrue [1] resulted in a number of
tests using calls of the form assertTrue(not <condition>). This patch
replaces those with assertFalse(<condition>).
[1] change I74705c6498249337bfdf955d62e0ad972035bc1f
Change-Id: I78b49558f4425c2335df187b1793d1e4b3c514b1
commit 4ac1fea5d111c669ff827f4eb29c0735cbad6ba5
Author: Zhao Lei <zhaolei@cn.fujitsu.com>
Date: Fri Aug 7 22:07:01 2015 +0800
Fix some spelling typo in comments
s/overide/override for object-expirer.conf and sample.
s/automaticaly/automatically for swift/proxy/controllers/obj.py
Change-Id: Ife107c7a1005a5d4959288db50a7f8f33c522dd4
Signed-off-by: Zhao Lei <zhaolei@cn.fujitsu.com>
commit 9456af35a2832aeafc4a4e78ebd0d4142ead71cd
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Thu Aug 6 00:55:36 2015 +0530
pep8 fix: assertEquals -> assertEqual
assertEquals is deprecated in py3,changes in
dir:
\*test/unit/obj/\*
\*test/unit/test\_locale/\*
Change-Id: I3dd0c1107165ac529f1cd967363e5cf408a1d02b
commit 1952451ed7e97e2bfa3b11dfa5000cc39f712084
Author: Zhao Lei <zhaolei@cn.fujitsu.com>
Date: Fri Aug 7 21:57:08 2015 +0800
Fix a spelling typo in comment
s/automaticaly/automatically/ for swift/proxy/controllers/obj.py
Change-Id: I405441383739637e0b13746d6f4e2bad1c874b4d
Signed-off-by: Zhao Lei <zhaolei@cn.fujitsu.com>
commit c35cc13b8abeb97400632cbe8ec56fc1040d8210
Author: Bill Huber <wbhuber@us.ibm.com>
Date: Thu Aug 6 10:01:17 2015 -0500
pep8 fix: assertEquals -> assertEqual
assertEquals is deprecated in py3 in the following dir:
test/unit/proxy/\*
Change-Id: Ie2c7e73e1096233a10ee7fbf6f88386fa4d469d6
commit 239e94e62518f36601fb18119700269753d02a01
Author: Bill Huber <wbhuber@us.ibm.com>
Date: Thu Aug 6 09:28:51 2015 -0500
pep8 fix: assertEquals -> assertEqual
assertEquals is deprecated in py3 in the following dir:
test/probe/\*
Change-Id: Ie08dd7a8a6c48e3452dfe4f2b41676330ce455d5
commit 49b9ba37ac522502ccad66fba7bfef375eab145d
Author: Bill Huber <wbhuber@us.ibm.com>
Date: Wed Aug 5 14:51:32 2015 -0500
pep8 fix: assertEquals -> assertEqual
assertEquals is deprecated in py3 in the following dir:
test/functional/\*
Change-Id: Iee7f8ffca9838ccc521107180697d91ac9559405
commit 81816bebe6b3506af8cabaa7ebe265c70f3499cd
Author: kenichiro matsuda <matsuda\_kenichi@jp.fujitsu.com>
Date: Thu Aug 6 10:13:02 2015 +0900
Fix shebang of commands
Fix shebang of following commands.
$ grep '#!/usr/bin/python' swift/bin/\*
swift/bin/swift-account-info:#!/usr/bin/python
swift/bin/swift-container-info:#!/usr/bin/python
swift/bin/swift-container-sync:#!/usr/bin/python
swift/bin/swift-recon:#!/usr/bin/python
swift/bin/swift-ring-builder:#!/usr/bin/python
swift/bin/swift-ring-builder-analyzer:#!/usr/bin/python
Change-Id: I564d1d8abd76eba57730fc2f30263b0a0f809867
Closes-Bug: #1481623
commit 652f0f9da408e955843f87a504b3dab5be3cff80
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Wed Aug 5 15:33:29 2015 -0600
Having said H, I, J, we ought to say K
In the long run, we might want to stop these updates. But this
decision is above my pay grade.
Change-Id: I335558e1da8052be1b215fbad51244b47af3d81b
commit ed3aec2146b114c85bb3b196c999bf3f44fe159e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Thu Aug 6 00:18:52 2015 +0530
pep8 fix: assertEquals -> assertEqual
assertEquals is deprecated in py3 in
dir: test/unit/container/\*
Change-Id: I3333022ed63ce03198bc73147246d91d2442a440
commit f449e914728fdcaf0870c15b9fc5ebd16a9df916
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Aug 5 22:32:02 2015 +0530
pep8 fix: assertEquals -> assertEqual
assertEquals is deprecated in py3, fixing in:
dir: test/unit/cli/\*
Change-Id: I9a2fc1f717beafd5fa8408942046e310e8de0318
commit 6594bbebb582801c069c4966352fee19eadef2f8
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Aug 5 22:25:46 2015 +0530
pep8 fix: assertEquals -> assertEqual
assertEquals is deprecated in py3 in
dir : test/unit/account/\*
Change-Id: I70415197df1b0d58d4d6e219733c13a9c9cdfff7
commit 89f59062864e5cbfc839a6084c323ce35438aa57
Author: Ben Martin <blmartin@us.ibm.com>
Date: Mon Jul 27 14:19:09 2015 -0500
+Document method to avoid rsync filling root drive
When rsync pushes to a remote node with an unmounted drive and if
certain steps are not taken, rsync may attempt to write files to
the local drive at the location where the drive was mounted.
There are two suggested solutions for this issue:
1) Set the permissions for all mount points in /srv/node/
to root:root 755
2) Mount the drives elsewhere and symlink the drives to /srv/.../
The first method ensures that only root and not the swift user
can write in the /srv/.../ directories.
The second method will prompt a broken link issue if rsync
attempts to write to an unmounted drive.
Change-Id: I60ce4ed9ef8401768d5f78b6806cbb2e2a65303e
Closes-Bug: #1470576
commit f0d51882b921075f5309ed6ff07385dc6103d4dc
Author: Charles Hsu <charles0126@gmail.com>
Date: Wed Aug 5 22:09:40 2015 +0800
Add extra\_header\_count to document and config.
Change-Id: Iec86b488d71553c295afe7098822ce2046df9546
commit 7071762d3698c59fabdee76890e300f81417be74
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Aug 4 23:15:37 2015 -0700
Fix TypeError if backend response doesn't have expected headers
There was some debug logging mixed in with some error handling on PUTs
that was relying on a very specific edge would only encounter a set of
backend responses that included the expected set of headers to diagnoise
the failure.
But the backend responses may not always have the expected headers.
The proxy debug logging should be more robust to missing headers.
It's a little hard to follow, but if you look `\_connect\_put\_node` in
swift.proxy.controller.obj - you'll see that only a few connections can
make their way out of the initial put connection handling with a "resp"
attribute that is not None. In the happy path (e.g. 100-Continue) it's
explictly set to None, and in most errors (Timeout, 503, 413, etc) a new
connection will be established to the next node in the node iter.
Some status code will however allow a conn to be returned for validation
in `\_check\_failure\_put\_connections`, i.e.
\* 2XX (e.g. 0-byte PUT would not send Expect 100-Continue)
\* 409 - Conflict with another timestamp
\* 412 - If-None-Match that encounters another object
... so I added tests for those - fixing a TypeError along the way.
Change-Id: Ibdad5a90fa14ce62d081e6aaf40aacfca31b94d2
commit 01848c565e5821d2500cb234261c70871e562ebe
Author: David Goetz <dpgoetz@gmail.com>
Date: Fri Jun 26 17:27:31 2015 -0700
Speed up reaper for a big account delete and some better error handling
In run\_forever mode, run the reaper on all three copies of the account
DB instead of just the first one and shard the containers between them.
Change-Id: Id182e89dad70df9d6d9988523861b8085d74c765
commit 5b24b2249878e25ee702ee4237227c984036c6ec
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue Aug 4 06:29:11 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9f0e5fd25ec143fb87de1895794764dea4587f93
commit 8d06f56c1fac23bca463d3a93353da6b50ad5bed
Author: Takashi NATSUME <natsume.takashi@lab.ntt.co.jp>
Date: Tue Aug 4 10:14:25 2015 +0900
Fix typo of 'receive'
Change-Id: Ic01defa8d48ba4b7f4bd6cbe4d59b9bab468a36c
commit 310ac18d61b001bdf297505243d8aa62e8fde8fe
Author: Brian Reitz <brian.reitz@oracle.com>
Date: Mon Aug 3 16:28:31 2015 -0500
Convert docstring to a comment in test\_denied\_DELETE\_of\_versioned\_object unit test.
Docstrings cause issues for nose and created non standard test output for this test.
Change-Id: I91e6450480567de0ee0b18d3efae01a4b94f0a86
commit 21a7b4aaa6f991c0eeb8f74876b14fe22713586b
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Aug 3 14:58:24 2015 +0100
Test that get\_hashes ignores only removed hash dir
Add test for case not yet covered by unit tests: suffix dir
has two hash dirs, one with expired tombstone. That hash dir gets
removed and its hash is not included in the suffix hash, but the
remaining hash dir's hash is reported.
Change-Id: I031a022daed6b8a66dfd04bea1b4d5eebcb882b3
commit 44917c8a90e79a85cd6c6821d8b6d043f83b322d
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Jul 20 13:06:48 2015 -0700
Handle removed suffix dirs the same as empty suffix dirs
When hashes suffix dirs, the directory might have gotten cleaned up while
still appearing in hashes.pkl. It would even get cleaned up the next time.
For example, given this really old tombstone:
objects/846/3d0/d3a20154d0a828a032aba6860397c3d0/1432267961.41808.ts
Prior to this commit, a call to get\_hashes() would reap the old
tombstone and any empty containing dirs, but the resulting hashes.pkl
would still contain {'3d0': 'd41d8cd98f00b204e9800998ecf8427e'} even
though there's no such suffix dir any more.
("d41d8cd98f00b204e9800998ecf8427e" is the MD5 of the empty string.)
Then, a \*subsequent\* get\_hashes() call would omit 3d0 from the resulting
hash, so then hashes.pkl would no longer contain 3d0. This difference
would result in a little useless replication traffic while nodes without
a particular part/suffix pair, but who disagreed on how that showed up
in hashes.pkl, tried to push their version of nothing to one another.
Now, an empty suffix dir doesn't appear in hashes.pkl at all, whether
it's for replication or EC, or whether it's for the get\_hashes() call
that reaped the suffix dirs or not.
Co-Author: Samuel Merritt <sam@swiftstack.com>
Change-Id: Ie1bfb1cc56d0fc030c6db42f97b55d140695cf1f
commit cf4d50bd68b658d35759fb56446557858dcd9572
Author: Alistair Coles <alistair.coles@hp.com>
Date: Fri Jun 5 13:06:29 2015 +0100
Make test\_proxy work independent of env vars
test.unit.common.test\_internal\_client.TestSimpleClient.test\_proxy
will fail if the environment has http\_proxy set and does not have
no\_proxy=127.0.0.1 set. This seems to be because urllib overrides
any proxy arg passed to the Request with the env http\_proxy var,
unless the Request host is in no\_proxy.
We don't need to test urllib, so this patch changes the test to
simply ensure that swift code does pass the correct proxy arg to
urllib2.urlopen. That avoids testers having to make sure their
env vars are compliant to successfully run unit tests. While it is
reasonable to think that 127.0.0.1 is in the no\_proxy list, it
shouldn't be a requirement pass swift tests.
Change-Id: Iff91acdb76fabe7056b3e90e2756e27fe5105817
commit 67513fc17c23066f6547b5e3c4ab2dc852e4f7f0
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jun 27 23:26:47 2015 +0530
Adding bandit for security static analysis testing in swift
This change adds a basic bandit config for Swift. It can be invoked
by running the tox environment for bandit;
tox -e bandit
This is an initial step for using bandit with Swift
and it should be revisited to improve the testing as more is learned
about the specific needs of the Swift code base.As per now some tests
are excluded as they were used on purpose.
https://wiki.openstack.org/wiki/Security/Projects/Bandit
Implements: blueprint swift-bandit
Change-Id: I621be9a68ae9311f3a6eadd1636b05e646260cf2
commit 768d7ab074807175471d589de96d091e3239052e
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jul 30 15:30:35 2015 -0700
Add a probetest for HUP/reload
This would have been enough to catch the regression, and we can extend
them as we work on any future ehancements to our process management.
Change-Id: I9a1b57aa15663380c45cf783afc8212ab4ffbace
commit 207dd9b49d7d53a9faa4849af2c40bb875416fce
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu Jul 30 14:32:08 2015 -0700
Fix regression in WSGI server SIGHUP behavior
The SIGHUP receipt used to pop us out of an os.wait() where now, it's in
a "green" wait() and Timeout() combo, some part of which eats the signal
receipt. This causes the while loop condition to never get checked and
SIGHUP no longer works as a server reload command.
The fix is to loop at least every 0.5 seconds, as a trade-off between
not busy-waiting and checking the "keep running" condition often enough
to feel responsive.
Change-Id: I95283b8b7cfc2998ab5813e0ad3ca1fa231696c8
Closes-Bug: #1479972
commit bcd00d9461603db1477c5f1e9f8dd6405a319eb9
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Jun 8 19:40:56 2015 +0100
Refactor diskfile
This patch mostly eliminates the duplicate code that was
deliberately left in place during EC review to avoid major
churn of the diskfile module prior to the kilo release.
This focuses on obvious de-duplication and shuffling code
between classes. It deliberately does not attempt to
hammer out every last piece of de-duplication where that
would introduce more complex changes - that can come later.
Code is moved from the module level and from ECDiskFile\*
classes into new BaseDiskFile\* classes.
Concrete classes for replication and EC policy retain their
existing names i.e. DiskFile[Manager|Writer|Reader|] and
ECDiskFile[Manager|Writer|Reader|] respectively.
Knock-on changes:
- fix bug whereby get\_hashes was ignoring self.reclaim\_age
and always using the default arg value.
- replication diskfile manager now deletes a tombstone that is older
than reclaim\_age even when there is a newer .meta file.
- replication diskfile manager will no longer raise an
AssertionError if only a .meta file is found during
hash\_cleanup\_listdir.
- fix stale test in test\_auditor.py: test\_with\_tombstone test
setup was convoluted (probably dates back to when object puts
did not clean up the object dir). Now that they do you have to
try harder to create a dir with a tombstone and a data file.
Change-Id: I963e0d0ae0d6569ad1de605034c529529cbb4f9a
commit 9cb7eb4a4b6cdab8a5f16b3dc800b39ab4068522
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Jul 27 11:34:07 2015 +0200
Update hacking to 0.10.0
Replace the whitelist of flake8 checks (select) with a blacklist
(ignore). It makes possible to disable a single check, which was not
possible before. This new approach permits to enable new tests more
easily and see which checks are currently disabled.
Only new checks are disabled, this change doesn't run less checks than
before. Currently, many checks are disabled, but following changes will
fix these new warnings.
When the "select" option of flake8 is used in tox.ini, the "ignore"
option is ignored. It is not possible to use "select" and "ignore"
options at the same time. See the code in pep8 (flake8 is based on
pep8):
https://github.com/PyCQA/pep8/blob/d48eef071003952ed0f98445dc3dc6bc29618f9c/pep8.py#L1808
The purpose of flake8 is to enhance the coding style, but also to help
to detect common bugs. Blacklisting checks permits to detect new bugs
when upgrading the tools. For example, new checks were recently added to
help porting code to Python 3.
This change permits to use pbr 1.0 and newer which is required to
support Python 3. Previously, hacking 0.8.1 was used, but hacking 0.8 is
incompatible with pbr 1.0 and newer (hacking 0.8 requires pbr<1.0).
pbr 1.0 is required to use environment markers on requirements to
install dnspython on Python 2 and dnspython3 on Python 3.
Change-Id: I41d63b9467083d7606ad18aaa398ca7738b27fae
commit 389a97e3526df68121cecfaf1909343b5d381cbc
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed Jul 29 23:46:58 2015 +0200
Fix pep8 E warning for hacking 0.10
Fix pep8 warnings of the E category of hacking 0.10:
\* E113: unexpected indentation
\* E121: continuation line under-indented for hanging indent
\* E122: continuation line missing indentation or outdented
\* E123: closing bracket does not match indentation of opening bracket's
line
\* E126: continuation line over-indented for hanging indent
\* E251: unexpected spaces around keyword / parameter equals
Change-Id: I0b24eebdf1a37dc1b572b6c9a3d3d4832d050237
commit d719064e788ec5fa70305fadaa46affcb603a9bb
Author: Victor Stinner <vstinner@redhat.com>
Date: Thu Jul 30 00:28:44 2015 +0200
Fix warning pep8 E128 warning of hacking 0.10
Fix the warning E128: "continuation line under-indented for visual
indent" of pep8.
Change-Id: Ie6c6ae341fe3d6281f2095c1d756d552fa5937f9
commit a0db56dcde83096708e6fe64ae9338098e0ba98a
Author: Victor Stinner <vstinner@redhat.com>
Date: Thu Jul 30 00:16:06 2015 +0200
Fix pep8 E265 warning of hacking 0.10
Fix the warning E265 "block comment should start with '# '" added in pep
1.5.
Change-Id: Ib57282e958be9c7cddffc7bca34fbbf1d4c460fd
commit 345785837f1caa01fec5bca091c70481d7069bea
Author: Charles Hsu <charles0126@gmail.com>
Date: Thu Jul 30 13:11:00 2015 +0800
Remove error\_suppression\_interval, error\_suppression\_limit options.
These two options is belong to proxy-server, not account-replicator.
Change-Id: Ie030ecffd213e56db32df77c69b847479d96308f
commit 5a7383313b1c555df5fd47050f7ee3810b5e31fc
Author: Carlos Cavanna <ccavanna@ca.ibm.com>
Date: Tue Jul 28 19:15:25 2015 -0400
Swift documentation for first-time contributors.
In this change, there are proposed improvement to Swift documentation aimed at
first-time contributors. They include a simplification of the Getting
Started page and a new page with some basic instructions/commands that the
first-time contributor should know. In addition, it shows some common errors
that the first-time contributor may find when executing git rebase and
information on how to track your changes.
Change-Id: I704202955093736b2f3b4102a649690a0392c6b0
commit 5b5c8820024141bc6ae49d7646a92fb53667ea9b
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Jul 29 12:36:35 2015 +0100
Remove unused code in swift/obj/server.py
keep\_cache was defined twice
Change-Id: I5f775f618669e3dabfc3bc54dd7bd2cd7f00b2f0
commit 0c27cb07caf1027cd9734e8bd34d9759da33e667
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Wed Jul 29 06:36:01 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Ic30cb1dc8f12280a52cc1f07a1cf516397ed680e
commit c5b5cf91a984f80cc6cbe42735b242083d700542
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 28 21:03:05 2015 +0530
test/unit: Replace python print operator with print function (pep H233, py33)
'print' function is compatible with 2.x and 3.x python versions
Link : https://www.python.org/dev/peps/pep-3105/
Python 2.6 has a \_\_future\_\_ import that removes print as language syntax,
letting you use the functional form instead
Change-Id: I94e1bc6bd83ad6b05695c7ebdf7cbfd8f6d9f9af
commit 117b61976fbf14d8a0d2157256f9a3230421ee72
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jul 22 15:40:55 2015 -0700
functests: use assertIn and assertNotIn
We have a bunch of assertions like
self.assertTrue(resp.status in (200, 204))
Sometimes we get smart about failure messages and have something like
self.assertTrue(resp.status in (200, 204), resp.status)
so we can see what the status was when it failed.
Since we don't have to support Python 2.6 any more, we can use
assertIn/assertNotIn and get nice failure messages for free.
Change-Id: I2d46c9969d41207a89e01017b4c2bc533c3d744f
commit 8fe8bee7e0c5c9d34d7a8e6ab090c8d65c5ca78e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 21 18:06:32 2015 +0530
test/(functional, probe): Replace "self.assert\_" by "self.assertTrue"
The assert\_() method is deprecated and can be safely replaced by assertTrue().
This patch makes sure that running the tests does not generate warnings
all over the screen.
Change-Id: I74705c6498249337bfdf955d62e0ad972035bc1f
commit 4a6e0ccc69302a5384b988149e294656323d7f20
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jul 20 11:58:35 2015 -0700
Rename WsgiStringIO -> WsgiBytesIO.
If we're going to have a subclass of BytesIO, having "StringIO" in its
name is just asking for confusion.
Change-Id: I695ab3105b1a02eb158dcf0399ae91888bc1c0ac
commit 5ee742c17d9ea92ca7332cb67db0cce64b7a0d8f
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 24 21:19:47 2015 +0530
Modifying Lambda function tuple usage for python3
Current tuple unpacking is not supported in python3
Change-Id: I15a8e977684d19154cf2233caf1174f6983ac9e2
commit 6f89f71f9ba11f7b4126b80076a0f13792332e1e
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Apr 15 16:17:23 2015 +0100
Filter Etag key from ssync replication-headers
ssync rx sends a header X-Backend-Replication-Headers whose value is a
list of headers that the source object has. This list extends the list
of allowed headers on the target object server, so that the target
object metadata is faithfully reconstructed to match the source.
Unfortunately the combination of lower() and title() operations on
header keys results in the source 'ETag' value being added to the target
metadata under the key 'Etag' in addition to the 'ETag' key that the
receiving server adds (note different capitilization), both having
the same value.
The spurious 'Etag' metadata is potentially confusing for humans
inspecting the object metadata and complicates tests that wish to
assert the equality of two object metadata dicts. See for example the
test in test\_ssync\_sender.py that this patch cleans up.
Furthermore, the possibility of having both Etag and ETag keys has
required a workaround in the EC reconstructor [1].
[1] reconstructor fix change id: Ie59ad93a67a7f439c9a84cd9cff31540f97f334a
Change-Id: I0c89cf7924a4471bb6d268b5ef3884e2d2cb4286
commit e2f69138bf5fcdd84ac23be6b0bec1bb006b41f5
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jul 23 16:46:48 2015 -0700
Fix string formatting in dispersion cli command
... and add a basic test that would have prevented the regression
Change-Id: I4c5f643ee291dcc1397ca951450459d8b8ad0bbd
commit 83025ff38dfea3d4e3f27dc045128a7aa4ba11e4
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jul 24 11:09:10 2015 -0700
Use right most occurrence object dir in diskfile.extract\_policy
I like using the rightmost one more; it's basically
/operator-defined/mountpoint/objects/part/suffix/hash/ts.data, so I
don't see any opportunity for other things named "objects" to creep in on the
right of the real objects-N dir; but I could see some admin using
/srv/object-storage/ or something
-- Torgomatic The Wise
Change-Id: I0a63a3e02df091a5ee2e110a345183012e357a2f
commit 363a256e58ee0f3e9f059352c2de968e3dc398e3
Author: Falk Reimann <falk.reimann@sap.com>
Date: Wed Jun 24 16:54:02 2015 +0200
Support keystone v3 domains in swift-dispersion
This provides the capability to specify a project\_name,
project\_domain\_name and user\_domain\_name in /etc/swift/dispersion.conf.
If this values are set in dispersion.conf they get populated to the
swift-client. With this it is possible to have a specific dispersion
project specified, which is not the keystone default domain. Changes
were applied to swift-dispersion-populate and swift-dispersion-report.
Relevant man pages, the example dispersion.conf and the admin guide were
updated accordingly.
DocImpact
Closes-Bug: #1468374
Change-Id: I0e716f8d281b4d0f510bc568bcee4a13fc480ff7
commit 3d9b2d077a157279fb6cd107a0c83727106af3ef
Author: Daisuke Morita <morita.daisuke@lab.ntt.co.jp>
Date: Fri Jul 24 10:42:10 2015 +0900
Fix swift-object-info to show policy index at deep working directory
If swift-object-info command is executed at deeper working directory
than 'objects-\*' directory, it cannot parse policy index from file path
so it does not show appropriate policy index. This patch fixes this
problem by simply extracting the full path of a target object file.
Change-Id: Idb734106a44b6121119c9b1dc8cdaaf4c6c28c31
Closes-Bug: 1469951
commit e24d7c36fa9758618ef88ed1a8e19f4d7bb0404f
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon May 25 18:26:38 2015 +0200
Use six to fix imports on Python 3
Get configparser, queue, http\_client modules from six.moves.
Patch generated by the six\_moves operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Change-Id: I666241ab50101b8cc6f992dd80134ce27327bd7d
commit 964869accce8836bd2587c4b07559fb05fe580b2
Author: Atsushi SAKAI <sakaia@jp.fujitsu.com>
Date: Fri Jul 24 17:09:48 2015 +0900
Fix six typos on swift documentation
mechanisim => mechanism
http://docs.openstack.org/developer/swift/cors.html
overridde => override
http://docs.openstack.org/developer/swift/deployment\_guide.html
extentsions => extensions
http://docs.openstack.org/developer/swift/development\_ondisk\_backends.html
reuqest => request
http://docs.openstack.org/developer/swift/logs.html
suport => support
http://docs.openstack.org/developer/swift/overview\_architecture.html
mininum => minimum
http://docs.openstack.org/developer/swift/overview\_erasure\_code.html
$ git diff | diffstat
cors.rst | 2 +-
deployment\_guide.rst | 2 +-
development\_ondisk\_backends.rst | 2 +-
logs.rst | 2 +-
overview\_architecture.rst | 2 +-
overview\_erasure\_code.rst | 2 +-
6 files changed, 6 insertions(+), 6 deletions(-)
Change-Id: I8e095f4c216b2cfae48dff1e17d387048349f73c
Closes-Bug: #1477877
commit dd2f1be3b124d3901ebbc176a7adc462b6449667
Author: Ondrej Novy <ondrej.novy@firma.seznam.cz>
Date: Tue Jun 16 17:42:58 2015 +0200
Time synchronization check in recon.
This change add call time to recon middleware and param --time to
recon CLI. This is usefull for checking if time in cluster is
synchronized.
Change-Id: I62373e681f64d0bd71f4aeb287953dd3b2ea5662
commit 89f705e8aab144092d40a13fc4ef19ffef5f3eba
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 23 06:11:27 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I94cf347564cb33977f33b1e64259bcb39a8cf809
commit cbcfb74132aba4d5834dc9cf33dc4f664b82d39a
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Jul 22 19:32:46 2015 -0700
Cleanup nits from container\_update\_timeout
Change-Id: Ib17fc9a027db267350abc5a7db4e3172dfff7913
commit f563a423bf2534268c2e785094d58dbbe0ebd390
Author: Hamdi Roumani <roumani@ca.ibm.com>
Date: Wed Jul 22 15:27:26 2015 -0400
Updated tox setup instructions on Development Guidelines
The instructions suggest updating the ownership of the swift.egg-info
directory may be required and provide a cmd to do so. Said cmd assumes user
'swift' exists, but tox will require the current user to have access to the
directory to perform updates, moreover user swift may not exist at all.
Change-Id: I63951970553c086ff4f1ac65a81559ba69166494
commit a65e9db8752793ec37b594dc9eca5066171825db
Author: Christian Schwede <cschwede@redhat.com>
Date: Wed Jul 22 10:43:17 2015 +0000
Removing commented out code in test/unit/account/test\_backend.py
Noticed this while reviewing another change. Looks like the test itself already
ensures correct functionality of the reclaim() method in AccountBroker without
the commented code, thus removing this stale code.
Change-Id: I6a26a7591adef9fd794ca68a4e9c493d1127f93c
commit 99d052772a9585e0befdfd292fd03aefde77180a
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jul 13 01:12:43 2015 -0700
Fix 499 client disconnected on COPY EC object
Currently, a COPY request for an EC object might go to fail as 499 Client
disconnected because of the difference between destination request content
length and actual transferred bytes.
That is because the conditional response status and content length for
an EC object range GET is handled at calling the response instance on
proxy server. Therefore the calling response instance (resp()) will change
the conditional status from 200 (HTTP\_OK) to 206 (PartialContent) and will
change the content length for the range GET.
In EC case, sometimes Swift needs whole stored contents to decode a segment.
It will make 200 HTTP OK response from object-server and proxy-server
will unfortunately set whole content length to the destination content
length and it makes the bug 1467677.
This patch introduces a new method "fix\_conditional\_response" for
swift.common.swob.Response that calling \_response\_iter() and cached the
iter in the Response instance. By calling it, Swift can set correct condtional
response any time after setting whole content\_length to the response
instance like EC case.
Change-Id: If85826243f955d2f03c6ad395215c73daab509b1
Closes-Bug: #1467677
commit 2289137164231d7872731c2cf3d81b86f34f01a4
Author: John Dickinson <me@not.mn>
Date: Sat May 23 15:40:03 2015 -0700
do container listing updates in another (green)thread
The actual server-side changes are simple. The tests are a different
matter. Many changes were needed to the object server tests to
handle the now-async calls to the container server. In an effort to
test this properly, some drive-by changes were made to improve tests.
I tested this patch by doing zero-byte object writes to one container
as fast as possible. Then I did it again while also saturating 2 of the
container replica's disks. The results are linked below.
https://gist.github.com/notmyname/2bb85acfd8fbc7fc312a
DocImpact
Change-Id: I737bd0af3f124a4ce3e0862a155e97c1f0ac3e52
commit 62ed4f81ef80440550633eaaaa962a4f9383c2d3
Author: Timur Alperovich <timur.alperovich@gmail.com>
Date: Tue Jul 14 16:56:44 2015 -0700
Add two functional tests for delimiter.
The first test verifies that a delimiter will trim entries beyond the
first matching instance of delimiter (after the given matching prefix,
if any) and squash duplicates. So, when setting the delimiter
to "-", given blobs "test", "test-foo" and "test-bar-baz", we expect
only "test" (no matching delim) and "test-" (trim all characters after
the first "-", and squash duplicates).
The second test verifies that when a prefix is provided, the delimiter
will trim entries beyond the first matching instance of the delimiter
\*after the given prefix\*. So "bar, "bazar" which both match the
prefix "ba" will be returned as "bar" (no delimiter after the matching
prefix) and "baza" (after matching the prefix the remainder after the
the \*next\* matching delimiter "a" is trimmed).
Change-Id: I49a2aa8722f83e87b7d211e5c26827e93963d92a
commit 2d6c5fe2afde382edb8f04c91fca1911601b61d9
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 21 09:56:13 2015 -0700
Fix Associated Projects link on Getting Started
Change-Id: I50be656bc5868242489f97c96a1feaef171933e0
commit cd7b2db550e41412281da0256b468c90ebcf3e8b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 21 19:23:00 2015 +0530
unit tests: Replace "self.assert\_" by "self.assertTrue"
The assert\_() method is deprecated and can be safely replaced by assertTrue().
This patch makes sure that running the tests does not create undesired
warnings.
Change-Id: I0602ba39ef93263386644ee68088d5f65fcb4a71
commit c3cc98b2c918476f1b54924e0c54e4c746eba4ac
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jul 20 17:03:20 2015 -0700
Add comment about ResumingGetter.used\_source\_etag
This confused a couple developers and took about ten minutes to
unravel in IRC; let's leave a clue for the next person.
Change-Id: I356c8c7a44de23f02eaf68d23a39c9eb4c203ff1
commit 06326d74657a8796439988115002298e4a5f4630
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jul 20 21:41:58 2015 +0530
Metaclass Python 3.x Compatibility
use "six.add\_metaclass" instead of "\_\_metaclass\_\_"
Change-Id: I57390fec40afe3a965be3215db8f79b9cf862a70
commit 317fa1af49d72ecaf7a9a499d8cdf00a086b4c6f
Author: Azhagu Selvan SP <tamizhgeek@gmail.com>
Date: Sat Jul 18 14:37:16 2015 +0530
Minor change in development saio setup doc
Make the test-requirements install command uniform with the rest of the
setup commands in the page by using the $HOME, instead of hardcoding
the folder path.
Change-Id: I8da7a191a301601e27f894f8268238d77b150ede
commit 39621b8629c7f378fc197f6ab1ddc8e2e797d1fa
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jul 18 14:12:58 2015 +0530
Deprecated xreadlines() usage fixed
Change-Id: Iadf42c2f86f78c11259e21c88b4aef51db3441ad
commit dde34c4b442a27761f2e6eca46ed9ec47a110392
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jul 11 22:46:41 2015 +0530
Modify zip usage for python3 where necessary.
py2 zip() is eager but py3 zip() and six.moves.zip() are lazy,
changing ones that require eager evaluation.
Change-Id: Ic9f6bccd7f57772158581905794f8d23b05f4223
commit faff98efd47fd59e28b1adb3e7ad4bc3dc6dd781
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Thu Jul 9 07:35:47 2015 +0530
Replace python print operator with print function (pep H233, py33)
'print' function is compatible with 2.x and 3.x python versions
Link : https://www.python.org/dev/peps/pep-3105/
Python 2.6 has a \_\_future\_\_ import that removes print as language syntax,
letting you use the functional form instead
Change-Id: I9d9ca5766a2773a7b4071e280f00361d16b85383
commit 8753e452b04b0af6d6b444184b628724e14fbbb1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed May 27 18:01:37 2015 +0200
Replace StringIO with BytesIO for WSGI input
wsgi.input is a binary stream (bytes), not a text stream (unicode).
\* Replace StringIO with BytesIO for WSGI input
\* Replace StringIO('') with StringIO() and replace WsgiStringIO('') with
WsgiStringIO(): an empty string is already the default value
Change-Id: I09c9527be2265a6847189aeeb74a17261ddc781a
commit 6e70f3fa322da70c2a65fb919d200e52fc5add8a
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed May 27 17:27:47 2015 +0200
Get StringIO and cStringIO from six.moves
\* replace "from cStringIO import StringIO"
with "from six.moves import cStringIO as StringIO"
\* replace "from StringIO import StringIO"
with "from six import StringIO"
\* replace "import cStringIO" and "cStringIO.StringIO()"
with "from six import moves" and "moves.cStringIO()"
\* replace "import StringIO" and "StringIO.StringIO()"
with "import six" and "six.StringIO()"
This patch was generated by the stringio operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Change-Id: Iacba77fec3045f96773d1090c0bd48613729a561
commit c366ecf5c85c2797582bf79f7faab1d75b99a70e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jul 13 00:07:13 2015 +0530
Fix a minor python issue related with string.split
Replacing string.split(value, ',') with value.split(','):
the string.split() function was removed in Python 3
Change-Id: I9ed241a894ac698da33df75a774a56ae2824fadf
commit c8131c6abb17b00b043a9b95e65be819e1fd3c9d
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Jul 12 14:48:35 2015 +0530
sys.exc\_type/exc\_value/exc\_traceback are Deprecated
sys.exc\_info() contains a tuple of these three.
Change-Id: I530cbeb37c43da98b4924db41f6604871077bd47
commit 39b6ef6e4fd515d81e688ef365d26d5e0499be7c
Author: Charles Hsu <charles0126@gmail.com>
Date: Thu Jun 25 02:06:54 2015 +0800
Fix reconstructor stats mssage.
Calculate reconstruction job count and remaining time that
would be inappropriate for user. Use real partition count would
be suitable for user.
Change-Id: I6b025854baf4757dddf9d7fe7bc2cece58a49157
Closes-Bug: #1468298
commit bfbda38db999ccd881509c68f0319c3d3dae4274
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 7 15:13:20 2015 -0700
Add save command to ring-builder-analyzer
\* cleanup command => ring builder function mapping
\* cleanup ParseCommandError/ValueError message building
Change-Id: I4be2aa963ce4f43035f02371d8388abd7a76536c
commit c907107fe4eacb378a92799de915234bd72d5d7c
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 7 22:46:37 2015 +0530
cPickle is deprecated in py3, replacing it from six.moves
cPickle is deprecated and should be replaced with six.moves
to provide py2 and py3 compatibility.
Change-Id: Ibad990708722360d188c641e61444d50a16a1e93
commit 86033ba4dcd7b86670306b6e66345ae464caca9d
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Jun 30 18:56:23 2015 +0100
EC tests should use ECDiskFileManager
Some EC tests in proxy/test\_server.py use the replication
DiskFileManager to open diskfiles. That works because it
turns out that DiskFileManager is robust to the frag index
being stitched onto the end of the timestamp in filenames,
but it would be better to test using the ECDiskFileManager
for EC diskfiles.
Also, drive-by deletion of some duplicated lines.
Change-Id: Ie3adb607d8c34a469df7d0f6f542ed5ba9a2dac0
commit 7bdb8266d4b926526acdea22e8c9c634855eeecc
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed Mar 25 13:19:36 2015 +0000
Select policy when running functional test
Add ability to select a storage policy when running
the functional tests by defining the environment variable
SWIFT\_TEST\_POLICY.
This patch was first introduced by Janie Richling in
feature/ec: https://review.openstack.org/#/c/166097
Co-Authored-By: Janie Richling <jrichli@us.ibm.com>
Co-Authored-By: Christian Schwede <christian.schwede@enovance.com>
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Id96354546088df137def0ae7fd434baf64ed0c51
Signed-off-by: Thiago da Silva <thiago@redhat.com>

| **tags**: | added: in-feature-hummingbird |
| --- | --- |

[See full activity log](https://bugs.launchpad.net/swift/%2Bbug/1468374/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/swift/%2Bfilebug)

This report contains
**Public**
information

Everyone can see this information.

You are
[not directly subscribed to this bug's notifications.](/swift/%2Bbug/1468374/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/swift/%2Bbug/1468374/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/swift/%2Bbug/1468374/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from www.redhat.com_ad877dc3_20250126_072235.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from review.openstack.org_08731f32_20250126_072244.html ===




=== Content from bugs.launchpad.net_ef25208a_20250126_072241.html ===

[Log in / Register](https://bugs.launchpad.net/bugs/%2Blogin)

![](/@@/launchpad-logo)

## Launchpad.net

* [Launchpad Home](https://launchpad.net/)
* [Code](https://code.launchpad.net/)
* [Bugs](https://bugs.launchpad.net/)
* [Blueprints](https://blueprints.launchpad.net/)
* [Translations](https://translations.launchpad.net/)
* [Answers](https://answers.launchpad.net/)

# Bug tracking

|  |  |
| --- | --- |
| All projects   One project:    (Find…) | |

Launchpad’s bug tracker helps software teams to
collaborate on bug reports and fixes.
([Read our guide](https://help.launchpad.net/Bugs) or
[take a tour](/%2Btour))

## Recently reported

* [Bug #2096721: Icon artifacts of other clipboard entrys show up when searching](/bugs/2096721)

  in
  [Ubuntu](/ubuntu),
  reported
  7 hours ago
* [Bug #2095169: [SRU] SIGILL on emulation of RISC-V Vector instructions](/bugs/2095169)

  in
  [Ubuntu](/ubuntu),
  reported
  on 2025-01-17
* [Bug #2096720: Mistype in RU - Total Gibibytes + Used](/bugs/2096720)

  in
  [openstack i18n](/openstack-i18n),
  reported
  8 hours ago
* [Bug #2096719: No description available. - message is not translated into other languages](/bugs/2096719)

  in
  [OpenStack Dashboard (Horizon)](/horizon),
  reported
  8 hours ago
* [Bug #2096718: Mistype in RU - Group which the new volume belongs to. Choose 'No group' if the new volume belongs to no group.](/bugs/2096718)

  in
  [openstack i18n](/openstack-i18n),
  reported
  8 hours ago

## Recently fixed

* [Bug #2035226: a warning of "awk" for generatepot jobs](/bugs/2035226)

  in
  [openstack i18n](/openstack-i18n),
  reported
  on 2023-09-12
* [Bug #2095417: jammy/linux-qcom: 6.8.0-1019.19 -proposed tracker](/bugs/2095417)

  in
  [Kernel SRU Workflow](/kernel-sru-workflow),
  [Ubuntu](/ubuntu),
  reported
  on 2025-01-21
* [Bug #2095291: kernel Patch to Fix Low and Inverted Brightness Value on AMD Devices](/bugs/2095291)

  in
  [Ubuntu](/ubuntu),
  reported
  on 2025-01-20
* [Bug #2095441: S390x build of openjdk crashes with the segmentation fault](/bugs/2095441)

  in
  [Ubuntu on IBM z Systems](/ubuntu-z-systems),
  [Ubuntu](/ubuntu),
  reported
  on 2025-01-21
* [Bug #2091226: openjdk-23 fails to build in jammy armhf with dtrace enabled](/bugs/2091226)

  in
  [Ubuntu](/ubuntu),
  reported
  on 2024-12-08

## Statistics

* **2096721** bugs reported
  across **13587**
  projects
* including **156078** links
  to **5273** [bug trackers](/bugs/bugtrackers)
* **173116** bugs are
  [shared
  across multiple projects](https://help.launchpad.net/CrossProjectBugTracking)
* and **114020**
  bugs are related to [CVE entries](/bugs/cve)

## Related pages

* [Bug trackers](https://bugs.launchpad.net/bugs/bugtrackers)
* [CVE tracker](https://bugs.launchpad.net/bugs/cve)

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from rhn.redhat.com_509031d4_20250125_074925.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2016:0128 - Security Advisory

Issued:
2016-02-08
Updated:
2016-02-08
# RHSA-2016:0128 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: openstack-swift security update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2016%3A0128)

## Topic

Updated openstack-swift packages that fix two security issues are now
available for Red Hat Enterprise Linux OpenStack Platform 6.0 for RHEL 7.

Red Hat Product Security has rated this update as having Moderate
security impact. A Common Vulnerability Scoring System (CVSS) base
score, which gives a detailed severity rating, is available from the
CVE link in the References section.

## Description

OpenStack Object Storage (swift) provides object storage in virtual
containers, which allows users to store and retrieve files (arbitrary
data). The service's distributed architecture supports horizontal scaling;
redundancy as failure-proofing is provided through software-based data
replication. Because Object Storage supports asynchronous eventual
consistency replication, it is well suited to multiple data-center
deployment.

A memory-leak issue was found in OpenStack Object Storage (swift), in the
proxy-to-server connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0738)

A memory-leak issue was found in OpenStack Object Storage (swift), in the
client-to-proxy connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0737)

Red Hat would like to thank the OpenStack project for reporting these
issues. Upstream acknowledges Romain Le Disez from OVH and Örjan Persson
from Kiliaro as the original reporters.

All users of openstack-swift are advised to upgrade to these updated
packages, which correct these issues. After installing this update, the
OpenStack Object Storage services will be restarted automatically.

## Solution

Before applying this update, ensure all previously released errata
relevant to your system have been applied.

For details on how to apply this update, refer to:

<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat OpenStack 6.0 x86\_64

## Fixes

* [BZ - 1298905](https://bugzilla.redhat.com/show_bug.cgi?id=1298905)
  - CVE-2016-0738 openstack-swift: Proxy to server DoS through Large Objects
* [BZ - 1298924](https://bugzilla.redhat.com/show_bug.cgi?id=1298924)
  - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects

## CVEs

* [CVE-2016-0737](https://www.redhat.com/security/data/cve/CVE-2016-0737.html)
* [CVE-2016-0738](https://www.redhat.com/security/data/cve/CVE-2016-0738.html)

## References

* <http://www.redhat.com/security/updates/classification/#normal>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat OpenStack 6.0

| SRPM | |
| --- | --- |
| openstack-swift-2.2.0-6.el7ost.src.rpm | SHA-256: 2786e50f053f4dcb53f0ae941d54f3f6ee6976d51de329a864eaa9b41ab216f4 |
| x86\_64 | |
| openstack-swift-2.2.0-6.el7ost.noarch.rpm | SHA-256: f80b255be42507f4fe10b7f1a0fd17de84942c8d3af95df1c1c20818a3c114fd |
| openstack-swift-account-2.2.0-6.el7ost.noarch.rpm | SHA-256: 97b03508f7edd6c432d26cd199b2765d3003cf84f3aaa212c729ce866e1c26cd |
| openstack-swift-container-2.2.0-6.el7ost.noarch.rpm | SHA-256: fffab203df81d30033f14c3b46ea5ba935518f5c2490190b7aaf43c1f793c66a |
| openstack-swift-doc-2.2.0-6.el7ost.noarch.rpm | SHA-256: ba5df2a953ad411fba328e32fc2474fe41a28c887cdefa03017b0e896cce67b1 |
| openstack-swift-object-2.2.0-6.el7ost.noarch.rpm | SHA-256: 701a203c8a81e92ac1a3ef22b4ca620ae225e1f74de0730469b24b4243ac8e72 |
| openstack-swift-proxy-2.2.0-6.el7ost.noarch.rpm | SHA-256: 07ba287ee3c90e8496fac3cdfd636ed229744f109da06f2850e353f510ffc6f1 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from review.openstack.org_4a96132c_20250125_074930.html ===




=== Content from bugs.launchpad.net_fc3085bd_20250126_072243.html ===

[Log in / Register](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/cloud-archive)

## [Ubuntu Cloud Archive](https://launchpad.net/cloud-archive)

* [Overview](https://launchpad.net/cloud-archive)
* [Code](https://code.launchpad.net/cloud-archive)
* [Bugs](https://bugs.launchpad.net/cloud-archive)
* [Blueprints](https://blueprints.launchpad.net/cloud-archive)
* [Translations](https://translations.launchpad.net/cloud-archive)
* [Answers](https://answers.launchpad.net/cloud-archive)

# [OSSA 2016-004] Swift proxy memory leak on unfinished read (CVE-2016-0738)

Bug #1493303 reported by
[Örjan Fors](https://launchpad.net/~orrriot)
on 2015-09-08

[288](/%2Bhelp-bugs/bug-heat.html)

This bug affects 4 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Object Storage (swift)](https://bugs.launchpad.net/swift) | Fix Released | Critical | Unassigned |  |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |
|  | [Ubuntu Cloud Archive](https://bugs.launchpad.net/cloud-archive) | Invalid | High | Unassigned |  |
|  | [Icehouse](https://bugs.launchpad.net/cloud-archive/icehouse) | Won't Fix | Undecided | Unassigned |  |
|  | [Kilo](https://bugs.launchpad.net/cloud-archive/kilo) | Won't Fix | Undecided | Unassigned |  |
|  | [Liberty](https://bugs.launchpad.net/cloud-archive/liberty) | Won't Fix | Undecided | Unassigned |  |
|  | [Mitaka](https://bugs.launchpad.net/cloud-archive/mitaka) | Fix Released | Undecided | Unassigned |  |
|  | [swift (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/swift "Latest release: 2.34.0+git2025011510.f95315b71-0ubuntu1, uploaded to main on 2025-01-21 10:50:10.706385+00:00 by Myles Penner (myles-penner), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | High | Unassigned |  |
|  | [Trusty](https://bugs.launchpad.net/ubuntu/trusty/%2Bsource/swift) | Fix Released | High | Unassigned |  |
|  | [Wily](https://bugs.launchpad.net/ubuntu/wily/%2Bsource/swift) | Won't Fix | Undecided | Unassigned |  |
|  | [Xenial](https://bugs.launchpad.net/ubuntu/xenial/%2Bsource/swift) | Fix Released | Undecided | Unassigned |  |
|  | [Yakkety](https://bugs.launchpad.net/ubuntu/yakkety/%2Bsource/swift) | Fix Released | High | Unassigned |  |

### Bug Description

It looks like the Swift proxy will leak memory if the connection is closed and the full response is not read. This opens for a potential DoS attacks.

Reproduce:

$ swift -A <http://localhost:8888/auth/v1.0> -U .. -K .. upload --use-slo --segment-size 1048576 <container> <big-file>

$ curl -H'X-Auth-Token: AUTH\_...' "<http://localhost:8888/v1/AUTH_../><container>/<big-file>" -m 0.001 > /dev/null

Repeat the curl command a couple of times and you will have more information in netstat and sockstat. The important part is the -m which sets the max time curl spends at downloading. After that point, it'll close the connection.

$ sudo netstat -ant -p | grep :6000

$ cat /proc/net/sockstat

tcp 0 0 127.0.0.1:6000 0.0.0.0:\* LISTEN 1358/python

tcp 0 43221 127.0.0.1:6000 127.0.0.1:48350 FIN\_WAIT1 -

tcp 0 43221 127.0.0.1:6000 127.0.0.1:48882 FIN\_WAIT1 -

tcp 939820 0 127.0.0.1:48350 127.0.0.1:6000 ESTABLISHED 17897/python

tcp 939820 0 127.0.0.1:48882 127.0.0.1:6000 ESTABLISHED 17890/python

tcp 983041 0 127.0.0.1:48191 127.0.0.1:6000 CLOSE\_WAIT 17897/python

tcp 983041 0 127.0.0.1:48948 127.0.0.1:6000 CLOSE\_WAIT 17892/python

Restarting the proxy frees up the lingering memory.

This problem did not exist in 2.2.0.

ProblemType: Bug

DistroRelease: Ubuntu 14.04

Package: swift 2.2.2-0ubuntu1~cloud0 [origin: Canonical]

ProcVersionSignature: Ubuntu 3.16.0-48.64~14.04.1-generic 3.16.7-ckt15

Uname: Linux 3.16.0-48-generic x86\_64

ApportVersion: 2.14.1-0ubuntu3.12

Architecture: amd64

CrashDB:

 {

                "impl": "launchpad",

                "project": "cloud-archive",

                "bug\_pattern\_url": "<http://people.canonical.com/~ubuntu-archive/bugpatterns/bugpatterns.xml>",

             }

Date: Tue Sep 8 09:55:05 2015

InstallationDate: Installed on 2015-06-22 (77 days ago)

InstallationMedia: Ubuntu-Server 14.04.2 LTS "Trusty Tahr" - Release amd64 (20150218.1)

PackageArchitecture: all

SourcePackage: swift

UpgradeStatus: No upgrade log present (probably fresh install)

See [original description](comments/0)

Tags:

[patch](/cloud-archive/%2Bbugs?field.tag=patch)
[amd64](/cloud-archive/%2Bbugs?field.tag=amd64)
[apport-bug](/cloud-archive/%2Bbugs?field.tag=apport-bug)
[in-feature-crypto](/cloud-archive/%2Bbugs?field.tag=in-feature-crypto)
[in-feature-hummingbird](/cloud-archive/%2Bbugs?field.tag=in-feature-hummingbird)
[in-stable-kilo](/cloud-archive/%2Bbugs?field.tag=in-stable-kilo)
[in-stable-liberty](/cloud-archive/%2Bbugs?field.tag=in-stable-liberty)
[third-party-packages](/cloud-archive/%2Bbugs?field.tag=third-party-packages)
[trusty](/cloud-archive/%2Bbugs?field.tag=trusty)

## CVE References

* [2015-5223](/bugs/cve/2015-5223 "OpenStack Object Storage (Swift) befo...")
* [2016-0737](/bugs/cve/2016-0737 "OpenStack Object Storage (Swift) befo...")
* [2016-0738](/bugs/cve/2016-0738 "OpenStack Object Storage (Swift) befo...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Örjan Fors (orrriot)](https://launchpad.net/~orrriot) wrote on 2015-09-08: |  |  | [#1](/cloud-archive/%2Bbug/1493303/comments/1) |
| --- | --- | --- | --- |

* [Dependencies.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459119/%2Bfiles/Dependencies.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459119)
  (2.3 KiB,
  text/plain; charset="utf-8")
* [ProcEnviron.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459120/%2Bfiles/ProcEnviron.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459120)
  (124 bytes,
  text/plain; charset="utf-8")

[James Page (james-page)](https://launchpad.net/~james-page)
on 2015-09-17

| Changed in cloud-archive: | |
| --- | --- |
| **importance**: | Undecided → Critical |
| **importance**: | Critical → High |
| Changed in swift (Ubuntu): | |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-17: |  |  | [#2](/cloud-archive/%2Bbug/1493303/comments/2) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |
| **description**: | updated |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-17: |  |  | [#3](/cloud-archive/%2Bbug/1493303/comments/3) |
| --- | --- | --- | --- |

From the description it sounds like this bug impacts the stable/kilo and master (liberty) branches, but not the stable/juno branch.

From the description it sounds like this bug impacts the stable/kilo and master (liberty) branches, but not the stable/juno branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-25: |  |  | [#4](/cloud-archive/%2Bbug/1493303/comments/4) |
| --- | --- | --- | --- |

@swift-coresec, is this a duplicate of [bug 1466549](/bugs/1466549) ?

@swift-coresec, is this a duplicate of bug 1466549 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-10-13: |  |  | [#5](/cloud-archive/%2Bbug/1493303/comments/5) |
| --- | --- | --- | --- |

@swift-coresec, can you triage this bug report please ?

@swift-coresec, can you triage this bug report please ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-10-14: |  |  | [#6](/cloud-archive/%2Bbug/1493303/comments/6) |
| --- | --- | --- | --- |

On commit fdc8828e8527b6fa4997072fb4795e4060c68cc0 (tip of master as of the time of this comment), I am unable to reproduce the behavior. I experimented with a variety of curl timeouts (the -m argument), including the proposed 0.001, but still could not reproduce this.

On a freshly-restarted VM, I did see a small jump in the number of non-TIME\_WAIT connections after the first request, but that jump did not occur on the second and subsequent requests, so it appears to be something warming up.

I also checked stable/liberty (47eb6a37) and was unable to reproduce the behavior there either.

I \*can\* reproduce this on stable/kilo (da428c4f).

I suspect that commit 12d8a53 fixed this, though I have no proof of that.

On commit fdc8828e8527b6fa4997072fb4795e4060c68cc0 (tip of master as of the time of this comment), I am unable to reproduce the behavior. I experimented with a variety of curl timeouts (the -m argument), including the proposed 0.001, but still could not reproduce this.
On a freshly-restarted VM, I did see a small jump in the number of non-TIME\_WAIT connections after the first request, but that jump did not occur on the second and subsequent requests, so it appears to be something warming up.
I also checked stable/liberty (47eb6a37) and was unable to reproduce the behavior there either.
I \*can\* reproduce this on stable/kilo (da428c4f).
I suspect that commit 12d8a53 fixed this, though I have no proof of that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Christian Schwede (cschwede)](https://launchpad.net/~cschwede) wrote on 2015-10-14: |  |  | [#7](/cloud-archive/%2Bbug/1493303/comments/7) |
| --- | --- | --- | --- |

I couldn't reproduce this on/after commit 12d8a53, but I could reproduce it on the commits before that.

I had to use a larger timeout to reproduce this (0.01 seconds). I used the following command:

for i in `seq 1 1000`; do curl -H 'X-Auth-Token: AUTH\_...' <http://127.0.0.1:8080/v1/AUTH_test/big/bigfile> -m 0.01 > /dev/null ; done

From my point of view this affects all releases before commit 12d8a53, and I would propose to backport 12d8a53 to stable/juno and stable/kilo.

I couldn't reproduce this on/after commit 12d8a53, but I could reproduce it on the commits before that.
I had to use a larger timeout to reproduce this (0.01 seconds). I used the following command:
for i in `seq 1 1000`; do curl -H 'X-Auth-Token: AUTH\_...' http://127.0.0.1:8080/v1/AUTH\_test/big/bigfile -m 0.01 > /dev/null ; done
From my point of view this affects all releases before commit 12d8a53, and I would propose to backport 12d8a53 to stable/juno and stable/kilo.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Christian Schwede (cschwede)](https://launchpad.net/~cschwede) wrote on 2015-10-14: |  |  | [#8](/cloud-archive/%2Bbug/1493303/comments/8) |
| --- | --- | --- | --- |

Just to add more light on this: most of the connections on pre-12d8a53 are still not closed after 50 minutes. That definetely does not happen on a branch on or after commit 12d8a53.

Just to add more light on this: most of the connections on pre-12d8a53 are still not closed after 50 minutes. That definetely does not happen on a branch on or after commit 12d8a53.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matthew Oliver (matt-0)](https://launchpad.net/~matt-0) wrote on 2015-10-14:  [**Re: [Bug 1493303] Re: Swift proxy memory leak on unfinished read**](/cloud-archive/%2Bbug/1493303/comments/9) |  |  | [#9](/cloud-archive/%2Bbug/1493303/comments/9) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/comments/9/%2Bdownload) (6.2 KiB)

Sam and Romain was the author of patch 12d8a53, the patch makes sure

connections are closed. Here is the commit message of the patch:

commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9

Author: Samuel Merritt <email address hidden>

Date: Thu Jun 18 12:58:03 2015 -0700

Get better at closing WSGI iterables.

PEP 333 (WSGI) says: "If the iterable returned by the application has

    a close() method, the server or gateway must call that method upon

    completion of the current request[.]"

There's a bunch of places where we weren't doing that; some of them

    matter more than others. Calling .close() can prevent a connection

    leak in some cases. In others, it just provides a certain pedantic

    smugness. Either way, we should do what WSGI requires.

Noteworthy goofs include:

\* If a client is downloading a large object and disconnects halfway

        through, a proxy -> obj connection may be leaked. In this case,

        the WSGI iterable is a SegmentedIterable, which lacked a close()

        method. Thus, when the WSGI server noticed the client disconnect,

        it had no way of telling the SegmentedIterable about it, and so

        the underlying iterable for the segment's data didn't get

        closed.

Here, it seems likely (though unproven) that the object server

        would time out and kill the connection, or that a

        ChunkWriteTimeout would fire down in the proxy server, so the

        leaked connection would eventually go away. However, a flurry of

        client disconnects could leave a big pile of useless connections.

\* If a conditional request receives a 304 or 412, the underlying

        app\_iter is not closed. This mostly affects conditional requests

        for large objects.

The leaked connections were noticed by this patch's co-author, who

    made the changes to SegmentedIterable. Those changes helped, but did

    not completely fix, the issue. The rest of the patch is an attempt to

    plug the rest of the holes.

Co-Authored-By: Romain LE DISEZ <email address hidden>

Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937

    Closes-Bug: #1466549

The first noteworthy goof looks like what we're seeing in this bug. This

patch is already in Liberty, but it was applied well after 2.2.0 (Juno) and

Kilo. So it only needs to be backported.

My 2 cents,

Matt

On Wed, Oct 14, 2015 at 7:59 PM, Christian Schwede <

<email address hidden>> wrote:

> Just to add more light on this: most of the connections on pre-12d8a53

> are still not closed after 50 minutes. That definetely does not happen

> on a branch on or after commit 12d8a53.

>

> --

> You received this bug notification because you are a member of Swift

> Core security contacts, which is subscribed to the bug report.

> <https://bugs.launchpad.net/bugs/1493303>

>

> Title:

> Swift proxy memory leak on unfinished read

>

> Status in ubuntu-cloud-archive:

> New

> Status in OpenStack Security Advisory:

> Incomplete

> Status in OpenStack Object Storage (swift):

> New

> Status in swift package in Ubuntu:

> New

>

> Bug description:

> This issue is being treated as a potential security risk under

> embargo. Pleas...

[Read more...](/cloud-archive/%2Bbug/1493303/comments/9)

Sam and Romain was the author of patch 12d8a53, the patch makes sure
connections are closed. Here is the commit message of the patch:
commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
Closes-Bug: #1466549
The first noteworthy goof looks like what we're seeing in this bug. This
patch is already in Liberty, but it was applied well after 2.2.0 (Juno) and
Kilo. So it only needs to be backported.
My 2 cents,
Matt
On Wed, Oct 14, 2015 at 7:59 PM, Christian Schwede <
1493303@bugs.launchpad.net> wrote:
> Just to add more light on this: most of the connections on pre-12d8a53
> are still not closed after 50 minutes. That definetely does not happen
> on a branch on or after commit 12d8a53.
>
> --
> You received this bug notification because you are a member of Swift
> Core security contacts, which is subscribed to the bug report.
> https://bugs.launchpad.net/bugs/1493303
>
> Title:
> Swift proxy memory leak on unfinished read
>
> Status in ubuntu-cloud-archive:
> New
> Status in OpenStack Security Advisory:
> Incomplete
> Status in OpenStack Object Storage (swift):
> New
> Status in swift package in Ubuntu:
> New
>
> Bug description:
> This issue is being treated as a potential security risk under
> embargo. Please do not make any public mention of embargoed (private)
> security vulnerabilities before their coordinated publication by the
> OpenStack Vulnerability Management Team in the form of an official
> OpenStack Security Advisory. This includes discussion of the bug or
> associated fixes in public forums such as mailing lists, code review
> systems and bug trackers. Please also avoid private disclosure to
> other individuals not already approved for access to this information,
> and provide this same reminder to those who are made aware of the
> issue prior to publication. All discussion should remain confined to
> this private bug report, and any proposed fixes should be added to the
> bug as attachments.
>
> It looks like the Swift proxy will leak memory if the connection is
> closed and the full response is not read. This opens for a potential
> DoS attacks.
>
> Reproduce:
>
> $ swift -A http://localhost:8888/auth/v1.0 -U .. -K .. upload --use-slo
> --segment-size 1048576 <container> <big-file>
> $ curl -H'X-Auth-Token: AUTH\_...' "http://localhost:8888/v1/AUTH\_../<container>/<big-file>"
> -m 0.001 > /dev/null
>
> Repeat the curl command a couple of times and you will have more
> information in netstat and sockstat. The important part is the -m
> which sets the max time curl spends at downloading. After that point,
> it'll close the connection.
>
> $ sudo netstat -ant -p | grep :6000
> $ cat /proc/net/sockstat
>
> tcp 0 0 127.0.0.1:6000 0.0.0.0:\*
> LISTEN 1358/python
> tcp 0 43221 127.0.0.1:6000 127.0.0.1:48350
> FIN\_WAIT1 -
> tcp 0 43221 127.0.0.1:6000 127.0.0.1:48882
> FIN\_WAIT1 -
> tcp 939820 0 127.0.0.1:48350 127.0.0.1:6000
> ESTABLISHED 17897/python
> tcp 939820 0 127.0.0.1:48882 127.0.0.1:6000
> ESTABLISHED 17890/python
> tcp 983041 0 127.0.0.1:48191 127.0.0.1:6000
> CLOSE\_WAIT 17897/python
> tcp 983041 0 127.0.0.1:48948 127.0.0.1:6000
> CLOSE\_WAIT 17892/python
>
> Restarting the proxy frees up the lingering memory.
>
> This problem did not exist in 2.2.0.
>
> ProblemType: Bug
> DistroRelease: Ubuntu 14.04
> Package: swift 2.2.2-0ubuntu1~cloud0 [origin: Canonical]
> ProcVersionSignature: Ubuntu 3.16.0-48.64~14.04.1-generic 3.16.7-ckt15
> Uname: Linux 3.16.0-48-generic x86\_64
> ApportVersion: 2.14.1-0ubuntu3.12
> Architecture: amd64
> CrashDB:
> {
> "impl": "launchpad",
> "project": "cloud-archive",
> "bug\_pattern\_url": "
> http://people.canonical.com/~ubuntu-archive/bugpatterns/bugpatterns.xml",
> }
> Date: Tue Sep 8 09:55:05 2015
> InstallationDate: Installed on 2015-06-22 (77 days ago)
> InstallationMedia: Ubuntu-Server 14.04.2 LTS "Trusty Tahr" - Release
> amd64 (20150218.1)
> PackageArchitecture: all
> SourcePackage: swift
> UpgradeStatus: No upgrade log present (probably fresh install)
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/cloud-archive/+bug/1493303/+subscriptions
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-16:  [**Re: Swift proxy memory leak on unfinished read**](/cloud-archive/%2Bbug/1493303/comments/10) |  |  | [#10](/cloud-archive/%2Bbug/1493303/comments/10) |
| --- | --- | --- | --- |

* [leakreproducer.sh](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4520199/%2Bfiles/leakreproducer.sh)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4520199)
  (1.1 KiB,
  text/x-sh)

This bug can still be reproduced in an easy and consistent manner. I've attached a script reproducing the leaks. It simply spins up a swift SAIO box in vagrant, and then runs the curl command mentioned in this issue. Every time the script is run, more memory is leaked. If the proxy-server is restared, the memory will be freed.

A small note: while the script was provisioning the vagrant box for the first time, apt failed. This was easily fixed:

$ cd vagrant-swift-all-in-one/

$ vagrant ssh -c "sudo apt-get -f install -y"

$ vagrant provision

Then just rerun the script:

$ cd ..

$ ./leakreproducer.sh

This bug can still be reproduced in an easy and consistent manner. I've attached a script reproducing the leaks. It simply spins up a swift SAIO box in vagrant, and then runs the curl command mentioned in this issue. Every time the script is run, more memory is leaked. If the proxy-server is restared, the memory will be freed.
A small note: while the script was provisioning the vagrant box for the first time, apt failed. This was easily fixed:
$ cd vagrant-swift-all-in-one/
$ vagrant ssh -c "sudo apt-get -f install -y"
$ vagrant provision
Then just rerun the script:
$ cd ..
$ ./leakreproducer.sh

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-18: |  |  | [#11](/cloud-archive/%2Bbug/1493303/comments/11) |
| --- | --- | --- | --- |

I was able to reproduce this on saio instance of 8Go of ram, deployed with openstack-swift-2.3.0-2.fc23.noarch (which doesn't have 12d8a53). However it didn't cause a noticeable effect since the process was killed and automatically restarted without causing disruption to other services. Also the leak was quickly limited by the maximum number of open file and it took about 42k connections until the process reserved all memory.

Anyway this seems like a duplicate of [bug 1466549](/bugs/1466549) which is already public, can we mark this bug as duplicate and open it ?

I was able to reproduce this on saio instance of 8Go of ram, deployed with openstack-swift-2.3.0-2.fc23.noarch (which doesn't have 12d8a53). However it didn't cause a noticeable effect since the process was killed and automatically restarted without causing disruption to other services. Also the leak was quickly limited by the maximum number of open file and it took about 42k connections until the process reserved all memory.
Anyway this seems like a duplicate of bug 1466549 which is already public, can we mark this bug as duplicate and open it ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-19: |  |  | [#12](/cloud-archive/%2Bbug/1493303/comments/12) |
| --- | --- | --- | --- |

The problem is not that the machine runs out of memory, the problem is that the kernel runs out of buffer space for the TCP stack. This renders the machine unable to do any form of network communication, including SSH. It will however not get the proxy process killed, as there's still plenty of memory left on the machine (just not for TCP). This effectively renders the machine completely unresponsive until it's rebooted, or the proxy process is restarted.

dmesg gets filled up with messages like these:

[ 276.495010] TCP: out of memory -- consider tuning tcp\_mem

[ 276.852703] TCP: out of memory -- consider tuning tcp\_mem

[ 277.996776] TCP: out of memory -- consider tuning tcp\_mem

[ 278.111035] TCP: out of memory -- consider tuning tcp\_mem

[ 279.840715] TCP: out of memory -- consider tuning tcp\_mem

[ 280.421439] TCP: out of memory -- consider tuning tcp\_mem

[ 281.435703] TCP: out of memory -- consider tuning tcp\_mem

[ 283.579847] TCP: out of memory -- consider tuning tcp\_mem

[ 283.616647] TCP: out of memory -- consider tuning tcp\_mem

[ 283.652761] TCP: out of memory -- consider tuning tcp\_mem

These symptons are easily reproduced with the script I posted above, just run it a few times, and the machine will become completely unresponsive. The following line should do the trick:

$ vagrant ssh -c 'for i in {1..100}; do /vagrant/leakconnections.sh; done'

The problem is not that the machine runs out of memory, the problem is that the kernel runs out of buffer space for the TCP stack. This renders the machine unable to do any form of network communication, including SSH. It will however not get the proxy process killed, as there's still plenty of memory left on the machine (just not for TCP). This effectively renders the machine completely unresponsive until it's rebooted, or the proxy process is restarted.
dmesg gets filled up with messages like these:
[ 276.495010] TCP: out of memory -- consider tuning tcp\_mem
[ 276.852703] TCP: out of memory -- consider tuning tcp\_mem
[ 277.996776] TCP: out of memory -- consider tuning tcp\_mem
[ 278.111035] TCP: out of memory -- consider tuning tcp\_mem
[ 279.840715] TCP: out of memory -- consider tuning tcp\_mem
[ 280.421439] TCP: out of memory -- consider tuning tcp\_mem
[ 281.435703] TCP: out of memory -- consider tuning tcp\_mem
[ 283.579847] TCP: out of memory -- consider tuning tcp\_mem
[ 283.616647] TCP: out of memory -- consider tuning tcp\_mem
[ 283.652761] TCP: out of memory -- consider tuning tcp\_mem
These symptons are easily reproduced with the script I posted above, just run it a few times, and the machine will become completely unresponsive. The following line should do the trick:
$ vagrant ssh -c 'for i in {1..100}; do /vagrant/leakconnections.sh; done'

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-19: |  |  | [#13](/cloud-archive/%2Bbug/1493303/comments/13) |
| --- | --- | --- | --- |

That behavior might be related to vagrant networking setup, using a nova instance with fedora kernel didn't broke ssh connection (active and new one). I run 5 parallel "while true; curl ...; done" using a public SLO object (no need for token).

Hence the question asked on [bug 1466549](/bugs/1466549) comment #7:

Does that mean that the issue described here is confirmed to be reproducible under most deployments?

That behavior might be related to vagrant networking setup, using a nova instance with fedora kernel didn't broke ssh connection (active and new one). I run 5 parallel "while true; curl ...; done" using a public SLO object (no need for token).
Hence the question asked on bug 1466549 comment #7:
Does that mean that the issue described here is confirmed to be reproducible under most deployments?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-19: |  |  | [#14](/cloud-archive/%2Bbug/1493303/comments/14) |
| --- | --- | --- | --- |

No, I don't think is related to vagrant, we get the same results in our production environment (that's why we filed the original ticket, our nodes we upgraded to 2.4.0 sunk after the upgrade). The production environment is running on bare metal, so it shouldn't be related to any form of virtualization.

We also tried 2.5.0 in production, and still get the same issues. The last good version for us was 2.2.x, after this we skipped straight to 2.4.0 (I don't think ubuntu packaged 2.3.0) and started having problems.

No, I don't think is related to vagrant, we get the same results in our production environment (that's why we filed the original ticket, our nodes we upgraded to 2.4.0 sunk after the upgrade). The production environment is running on bare metal, so it shouldn't be related to any form of virtualization.
We also tried 2.5.0 in production, and still get the same issues. The last good version for us was 2.2.x, after this we skipped straight to 2.4.0 (I don't think ubuntu packaged 2.3.0) and started having problems.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2015-11-19: |  |  | [#15](/cloud-archive/%2Bbug/1493303/comments/15) |
| --- | --- | --- | --- |

Status changed to 'Confirmed' because the bug affects multiple users.

Status changed to 'Confirmed' because the bug affects multiple users.

| Changed in swift (Ubuntu): | |
| --- | --- |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-19: |  |  | [#16](/cloud-archive/%2Bbug/1493303/comments/16) |
| --- | --- | --- | --- |

Hum, if this reproduce in 2.4.0 and 2.5.0 then it may be a different issue than [bug 1466549](/bugs/1466549) for which the fix (12d8a53) is included in those releases...

It seems like the leakreproducer.sh is stressing the proxy-server using localhost, would this be a different scenario compared to external connection ?

Hum, if this reproduce in 2.4.0 and 2.5.0 then it may be a different issue than bug 1466549 for which the fix (12d8a53) is included in those releases...
It seems like the leakreproducer.sh is stressing the proxy-server using localhost, would this be a different scenario compared to external connection ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-19: |  |  | [#17](/cloud-archive/%2Bbug/1493303/comments/17) |
| --- | --- | --- | --- |

No, it's not different compared to an external connection. If leakproducer.sh is run outside of the virtual machine (just change localhost to 192.168.8.80 in the script), the problem still persists.

Another thing which migth be interesting to note is that after the memory has leaked, it isn't freed even if the object-server is stopped. The proxy-server needs to be restarted in order for the memory to be freed.

No, it's not different compared to an external connection. If leakproducer.sh is run outside of the virtual machine (just change localhost to 192.168.8.80 in the script), the problem still persists.
Another thing which migth be interesting to note is that after the memory has leaked, it isn't freed even if the object-server is stopped. The proxy-server needs to be restarted in order for the memory to be freed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2015-11-19: |  |  | [#18](/cloud-archive/%2Bbug/1493303/comments/18) |
| --- | --- | --- | --- |

Andreas, what version of curl are you using?

I'm not able to see any issues when running leakconnections.sh from my mac (curl 7.43.0), but I did find something when running directly on my precise SAIO (curl 7.22).

Andreas, what version of curl are you using?
I'm not able to see any issues when running leakconnections.sh from my mac (curl 7.43.0), but I did find something when running directly on my precise SAIO (curl 7.22).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-20: |  |  | [#19](/cloud-archive/%2Bbug/1493303/comments/19) |
| --- | --- | --- | --- |

I'm running curl 7.43.0 on ubuntu 15.10. I don't think the issue is tied to the curl version though, this happens for us in our production environment when running ffmpeg to transcode videos. When ffmpeg is running it seeks a lot in the stream by opening a new socket with some offset, doing a short read, and then closing the socket. The read and close without consuming the whole object seems to be the key to the problem here.

When running curl from your mac, what output do you get? You should see a lot of lines like these:

curl: (28) Operation timed out after 102 milliseconds with 769995 out of 524288512 bytes received

These are due to curl closing the socket without consuming the whole object, triggering the bug.

I'm running curl 7.43.0 on ubuntu 15.10. I don't think the issue is tied to the curl version though, this happens for us in our production environment when running ffmpeg to transcode videos. When ffmpeg is running it seeks a lot in the stream by opening a new socket with some offset, doing a short read, and then closing the socket. The read and close without consuming the whole object seems to be the key to the problem here.
When running curl from your mac, what output do you get? You should see a lot of lines like these:
curl: (28) Operation timed out after 102 milliseconds with 769995 out of 524288512 bytes received
These are due to curl closing the socket without consuming the whole object, triggering the bug.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-23: |  |  | [#20](/cloud-archive/%2Bbug/1493303/comments/20) |
| --- | --- | --- | --- |

@notmyname, does your precise SAIO is running with 12d8a53 ?

@notmyname, does your precise SAIO is running with 12d8a53 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-12-01: |  |  | [#21](/cloud-archive/%2Bbug/1493303/comments/21) |
| --- | --- | --- | --- |

Any news on this? Can we consider this bug confirmed as it can be consistently reproduced?

Any news on this? Can we consider this bug confirmed as it can be consistently reproduced?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kota Tsuyuzaki (tsuyuzaki-kota)](https://launchpad.net/~tsuyuzaki-kota) wrote on 2015-12-02: |  |  | [#22](/cloud-archive/%2Bbug/1493303/comments/22) |
| --- | --- | --- | --- |

It seems that I can reproduce this with current master (exactly after 12d8a53 ) in 2 environment, one is ubuntu 14.04.02 (3.13.0-48-generic kernel) on AWS and the other is 14.04.01 (3.13.0-36-generic) on my laptop virtual machine.

I didn't look at the reason in detail yet but it looks like that we have an issue for that.

My procedure is:

1. upload a 50MB slo object via swift command (i.e. swift upload ---use-slo)

2. Download the slo object via curl, and then stop the download stream via -m (timeout) option

3. cat /proc/net/sockstat shows as follows:

sockets: used 314

TCP: inuse 20 orphan 0 tw 0 alloc 123 mem 3919 (<- I found the "mem" increased by the curl requests)

UDP: inuse 3 mem 0

UDPLITE: inuse 0

RAW: inuse 0

FRAG: inuse 0 memory 0

4. It looks also increase proxy-server memory usage (confilemed by ps and top command)

It looks that larger number of timeout increased the used memory rapidly. i.e. "-m 0.1" made proxy-server to spend more memory than "-m 0.01" (both of them killed the connections before the task finished)

However, I couldn't find CLOSE\_WAIT/FIN\_WAIT in netstat. (it might be related that I turned on tcp\_recycle in sysctl)

Right now I'm not sure but it might be depends on kernel version because I tested in closer version with reported environment so I'll try to make sure another environment if we can reproduce this anytime.

It seems that I can reproduce this with current master (exactly after 12d8a53 ) in 2 environment, one is ubuntu 14.04.02 (3.13.0-48-generic kernel) on AWS and the other is 14.04.01 (3.13.0-36-generic) on my laptop virtual machine.
I didn't look at the reason in detail yet but it looks like that we have an issue for that.
My procedure is:
1. upload a 50MB slo object via swift command (i.e. swift upload ---use-slo)
2. Download the slo object via curl, and then stop the download stream via -m (timeout) option
3. cat /proc/net/sockstat shows as follows:
sockets: used 314
TCP: inuse 20 orphan 0 tw 0 alloc 123 mem 3919 (<- I found the "mem" increased by the curl requests)
UDP: inuse 3 mem 0
UDPLITE: inuse 0
RAW: inuse 0
FRAG: inuse 0 memory 0
4. It looks also increase proxy-server memory usage (confilemed by ps and top command)
It looks that larger number of timeout increased the used memory rapidly. i.e. "-m 0.1" made proxy-server to spend more memory than "-m 0.01" (both of them killed the connections before the task finished)
However, I couldn't find CLOSE\_WAIT/FIN\_WAIT in netstat. (it might be related that I turned on tcp\_recycle in sysctl)
Right now I'm not sure but it might be depends on kernel version because I tested in closer version with reported environment so I'll try to make sure another environment if we can reproduce this anytime.

[John Dickinson (notmyname)](https://launchpad.net/~notmyname)
on 2015-12-02

| Changed in swift: | |
| --- | --- |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#23](/cloud-archive/%2Bbug/1493303/comments/23) |
| --- | --- | --- | --- |

This is weird. I was able to reproduce the problem; the proxy server accumulates a bunch of open filehandles for dead sockets.

I can see with strace that the sockets in question are used for client <--> proxy communication. We're not leaking connections to the storage backends. Also, it looks like someone is trying to clean them up, but is just bad at it. Check this out:

# we have a GET request from the client; the socket is fd 220

    accept(4, {sa\_family=AF\_INET, sin\_port=htons(38280), sin\_addr=inet\_addr("127.0.0.1")}, [16]) = 220

    fcntl(220, F\_GETFL) = 0x2 (flags O\_RDWR)

    fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0

    fcntl(220, F\_GETFL) = 0x802 (flags O\_RDWR|O\_NONBLOCK)

    fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0

    sendto(3, "<139>proxy-server: STDERR: (2834"..., 65, 0, NULL, 0) = 65

    accept(4, 0x7fffa0e778c0, [16]) = -1 EAGAIN (Resource temporarily unavailable)

    recvfrom(220, "GET /v1/AUTH\_test/test/largefile"..., 65536, 0, NULL, NULL) = 160

# ... removed stuff talking to memcached + storage backends

# then we try to send something and learn that it's shut down, so SIGPIPE

    sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)

    --- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---

    # stupidly, we try to send it again ang get another SIGPIPE

    sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)

    --- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---

# attempted cleanup...

    shutdown(220, SHUT\_RDWR) = -1 ENOTCONN (Transport endpoint is not connected)

# and now we completely forget about fd 220 and it's never mentioned again. there's the leak.

    poll([{fd=4, events=POLLIN|POLLPRI|POLLERR|POLLHUP}], 1, 13) = 1 ([{fd=4, revents=POLLIN}])

    # ...thousands more lines not mentioning fd 220

What's weird here is that eventlet is doing this at least somewhat intentionally. Here's an annotated eventlet.wsgi.HttpProtocol.finish():

def finish(self):

        try:

            # this tries to flush any buffers; this is probably what

            # causes the second sendto()/SIGPIPE pair, but I have not

            # verified that.

            BaseHTTPServer.BaseHTTPRequestHandler.finish(self)

        except socket.error as e:

            # Broken pipe, connection reset by peer

            if support.get\_errno(e) not in BROKEN\_SOCK:

                raise

        # This is responsible for the shutdown call. It executes every time;

        # the try/except above doesn't let any exceptions out that would

        # exit this method early.

        greenio.shutdown\_safe(self.connection)

# Here's the fun part: this method call gets executed, but it

        # doesn't make any syscalls. Something is causing this to be a no-op,

        # but I don't know what it is.

        self.connection.close()

Looks like it might be a bug in eventlet, maybe? I'm not convinced this bug is fixable from within Swift.

This is weird. I was able to reproduce the problem; the proxy server accumulates a bunch of open filehandles for dead sockets.
I can see with strace that the sockets in question are used for client <--> proxy communication. We're not leaking connections to the storage backends. Also, it looks like someone is trying to clean them up, but is just bad at it. Check this out:
# we have a GET request from the client; the socket is fd 220
accept(4, {sa\_family=AF\_INET, sin\_port=htons(38280), sin\_addr=inet\_addr("127.0.0.1")}, [16]) = 220
fcntl(220, F\_GETFL) = 0x2 (flags O\_RDWR)
fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0
fcntl(220, F\_GETFL) = 0x802 (flags O\_RDWR|O\_NONBLOCK)
fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0
sendto(3, "<139>proxy-server: STDERR: (2834"..., 65, 0, NULL, 0) = 65
accept(4, 0x7fffa0e778c0, [16]) = -1 EAGAIN (Resource temporarily unavailable)
recvfrom(220, "GET /v1/AUTH\_test/test/largefile"..., 65536, 0, NULL, NULL) = 160
# ... removed stuff talking to memcached + storage backends
# then we try to send something and learn that it's shut down, so SIGPIPE
sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)
--- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---
# stupidly, we try to send it again ang get another SIGPIPE
sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)
--- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---
# attempted cleanup...
shutdown(220, SHUT\_RDWR) = -1 ENOTCONN (Transport endpoint is not connected)
# and now we completely forget about fd 220 and it's never mentioned again. there's the leak.
poll([{fd=4, events=POLLIN|POLLPRI|POLLERR|POLLHUP}], 1, 13) = 1 ([{fd=4, revents=POLLIN}])
# ...thousands more lines not mentioning fd 220
What's weird here is that eventlet is doing this at least somewhat intentionally. Here's an annotated eventlet.wsgi.HttpProtocol.finish():
def finish(self):
try:
# this tries to flush any buffers; this is probably what
# causes the second sendto()/SIGPIPE pair, but I have not
# verified that.
BaseHTTPServer.BaseHTTPRequestHandler.finish(self)
except socket.error as e:
# Broken pipe, connection reset by peer
if support.get\_errno(e) not in BROKEN\_SOCK:
raise
# This is responsible for the shutdown call. It executes every time;
# the try/except above doesn't let any exceptions out that would
# exit this method early.
greenio.shutdown\_safe(self.connection)
# Here's the fun part: this method call gets executed, but it
# doesn't make any syscalls. Something is causing this to be a no-op,
# but I don't know what it is.
self.connection.close()
Looks like it might be a bug in eventlet, maybe? I'm not convinced this bug is fixable from within Swift.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#24](/cloud-archive/%2Bbug/1493303/comments/24) |
| --- | --- | --- | --- |

Also, there are two separate issues here. The first is fixed by commit 12d8a53 and concerns a leak of connections from proxy to storage server. This is the one being discussed for backporting. The second is a file descriptor leak for client-to-proxy connections. It is reproducible on master (418f9b21) and may be in Swift, eventlet, somewhere else, or the interaction between any two or more of those.

Also, there are two separate issues here. The first is fixed by commit 12d8a53 and concerns a leak of connections from proxy to storage server. This is the one being discussed for backporting. The second is a file descriptor leak for client-to-proxy connections. It is reproducible on master (418f9b21) and may be in Swift, eventlet, somewhere else, or the interaction between any two or more of those.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#25](/cloud-archive/%2Bbug/1493303/comments/25) |
| --- | --- | --- | --- |

never mind... it's only reproducible with SLOs and DLOs. Not even regular Swift objects. Something in our SegmentedIterable class is probably the culprit.

feh.

never mind... it's only reproducible with SLOs and DLOs. Not even regular Swift objects. Something in our SegmentedIterable class is probably the culprit.
feh.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#26](/cloud-archive/%2Bbug/1493303/comments/26) |
| --- | --- | --- | --- |

git bisect claims it's commit 5ca49ca92485b6ba868544f12fa524d9d7b666c6 that introduced the bug. conveniently, this commit changes a bunch of stuff in SegmentedIterable, validating the guess in comment #25.

git bisect claims it's commit 5ca49ca92485b6ba868544f12fa524d9d7b666c6 that introduced the bug. conveniently, this commit changes a bunch of stuff in SegmentedIterable, validating the guess in comment #25.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-04: |  |  | [#27](/cloud-archive/%2Bbug/1493303/comments/27) |
| --- | --- | --- | --- |

* [leakpatch-1.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4529331/%2Bfiles/leakpatch-1.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4529331)
  (496 bytes,
  text/plain)

Experimentally, this fixes the bug. Having a heck of a time writing a unit test, though. If anyone wants to jump in there, please feel free.

Experimentally, this fixes the bug. Having a heck of a time writing a unit test, though. If anyone wants to jump in there, please feel free.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kota Tsuyuzaki (tsuyuzaki-kota)](https://launchpad.net/~tsuyuzaki-kota) wrote on 2015-12-07: |  |  | [#28](/cloud-archive/%2Bbug/1493303/comments/28) |
| --- | --- | --- | --- |

* [security\_leak\_fix.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4530760/%2Bfiles/security_leak_fix.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4530760)
  (885 bytes,
  text/plain)

Awesome Sam!

SegmentItrable never closes its app\_iter handle and it causes the handler leak. It makes me sense and I confirmed the leakpatch-1.diff fixed the issue in my environment.

Plus, I tried to improve the fix to be intuitive a bit more (attached). In my patch, SegmentIterable.close will attempt to close self.app\_iter at first and it will emit GeneratorExit and then, it will close also backend request iter at current\_resp.

Anyways, nice work and thanks! :-)

Awesome Sam!
SegmentItrable never closes its app\_iter handle and it causes the handler leak. It makes me sense and I confirmed the leakpatch-1.diff fixed the issue in my environment.
Plus, I tried to improve the fix to be intuitive a bit more (attached). In my patch, SegmentIterable.close will attempt to close self.app\_iter at first and it will emit GeneratorExit and then, it will close also backend request iter at current\_resp.
Anyways, nice work and thanks! :-)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-12-07: |  |  | [#29](/cloud-archive/%2Bbug/1493303/comments/29) |
| --- | --- | --- | --- |

@tsuyuzaki-kota we've deployed your patch to some of our servers now. Everything seems to be fixed when running some simple tests that used to trigger the bug! I'll let it run for a day or two and see if everything is stable.

Thanks for the good work everybody! :D

@tsuyuzaki-kota we've deployed your patch to some of our servers now. Everything seems to be fixed when running some simple tests that used to trigger the bug! I'll let it run for a day or two and see if everything is stable.
Thanks for the good work everybody! :D

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-12-07

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-12-08: |  |  | [#30](/cloud-archive/%2Bbug/1493303/comments/30) |
| --- | --- | --- | --- |

Ok, so everything is still fine on our servers. It seems like the patch fixed the bug completely :)

Ok, so everything is still fine on our servers. It seems like the patch fixed the bug completely :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-09: |  |  | [#31](/cloud-archive/%2Bbug/1493303/comments/31) |
| --- | --- | --- | --- |

* [socket-leak-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4532159/%2Bfiles/socket-leak-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4532159)
  (5.1 KiB,
  text/plain)

Here is a slight modification of Kota's patch, plus a unit test.

The modification was only to change "except GeneratorExit:" to "finally:" so that GeneratorExit propagates to any generators enclosing SegmentedIterable. I don't know of any right now, but future middlewares could easily introduce them.

Now that we have a unit test, I believe this patch to be ready for review.

Here is a slight modification of Kota's patch, plus a unit test.
The modification was only to change "except GeneratorExit:" to "finally:" so that GeneratorExit propagates to any generators enclosing SegmentedIterable. I don't know of any right now, but future middlewares could easily introduce them.
Now that we have a unit test, I believe this patch to be ready for review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-09: |  |  | [#32](/cloud-archive/%2Bbug/1493303/comments/32) |
| --- | --- | --- | --- |

It seems like both leaks (proxy to server and client to proxy) have been reported on former [bug 1466549](/bugs/1466549). I've subscribed the original reporter.

Örjan, I can't find your affiliation, if you want to credit your current employer, please let me know.

Here is the impact description to cover both bugs (which will likely get two different CVE):

Title: Swift proxy-server DoS through Large Object

Reporter: Romain LE DISEZ (OVH), Örjan Persson

Products: Swift

Affects: client-proxy: < 2.4.0 (Liberty)

      proxy-server: =< 2.5.0 (Liberty included)

Description:

Romain LE DISEZ from OVH and Örjan Persson independently reported two vulnerabilities in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. Note that there are two distinct bugs that can exhaust proxy resources, one for client connection (client to proxy), one for servers connection (proxy to server). All Swift setup are affected.

It seems like both leaks (proxy to server and client to proxy) have been reported on former bug 1466549. I've subscribed the original reporter.
Örjan, I can't find your affiliation, if you want to credit your current employer, please let me know.
Here is the impact description to cover both bugs (which will likely get two different CVE):
Title: Swift proxy-server DoS through Large Object
Reporter: Romain LE DISEZ (OVH), Örjan Persson
Products: Swift
Affects: client-proxy: < 2.4.0 (Liberty)
proxy-server: =< 2.5.0 (Liberty included)
Description:
Romain LE DISEZ from OVH and Örjan Persson independently reported two vulnerabilities in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. Note that there are two distinct bugs that can exhaust proxy resources, one for client connection (client to proxy), one for servers connection (proxy to server). All Swift setup are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Örjan Fors (orrriot)](https://launchpad.net/~orrriot) wrote on 2015-12-09: |  |  | [#33](/cloud-archive/%2Bbug/1493303/comments/33) |
| --- | --- | --- | --- |

Great! Happy to hear that it has been resolved. Kiliaro is my employer.

Great! Happy to hear that it has been resolved. Kiliaro is my employer.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-10: |  |  | [#34](/cloud-archive/%2Bbug/1493303/comments/34) |
| --- | --- | --- | --- |

Thanks Örjan, next description will mention Kiliaro. I just need to figure out what swift release are going to be fixed...

The tip of stable/kilo (463fbe39fa1142d2bb9f7c738c6d88d9f77857f1) doesn't seems to be in any tags

There is no stable/liberty branch.

According to <http://docs.openstack.org/releases/>, it looks like the fix should land in 2.3.1 (for kilo) and 2.5.1 (for liberty).

@swift-coresec, is this following affect line correct ?

Affects: client to proxy: >=2.2.1, <= 2.3.0

                proxy to server: >=2.2.1, <= 2.3.0, >= 2.4.0, <= 2.5.0

Thanks Örjan, next description will mention Kiliaro. I just need to figure out what swift release are going to be fixed...
The tip of stable/kilo (463fbe39fa1142d2bb9f7c738c6d88d9f77857f1) doesn't seems to be in any tags
There is no stable/liberty branch.
According to http://docs.openstack.org/releases/, it looks like the fix should land in 2.3.1 (for kilo) and 2.5.1 (for liberty).
@swift-coresec, is this following affect line correct ?
Affects: client to proxy: >=2.2.1, <= 2.3.0
proxy to server: >=2.2.1, <= 2.3.0, >= 2.4.0, <= 2.5.0

[John Dickinson (notmyname)](https://launchpad.net/~notmyname)
on 2015-12-15

| Changed in swift: | |
| --- | --- |
| **importance**: | Undecided → Critical |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2015-12-17: |  |  | [#35](/cloud-archive/%2Bbug/1493303/comments/35) |
| --- | --- | --- | --- |

Sam, I think the patch is ok, but the test seems to only be testing the implementation of FakeSwift, not the actual change in SegmentedIterable. When only applying the changes from this patch in the test/ directory, unittests still pass.

Sam, I think the patch is ok, but the test seems to only be testing the implementation of FakeSwift, not the actual change in SegmentedIterable. When only applying the changes from this patch in the test/ directory, unittests still pass.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2016-01-06: |  |  | [#36](/cloud-archive/%2Bbug/1493303/comments/36) |
| --- | --- | --- | --- |

Sam what's the status of tests?

For everyone, it would be good to review the patch in #31 to see how the patch itself looks

Sam what's the status of tests?
For everyone, it would be good to review the patch in #31 to see how the patch itself looks

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-08: |  |  | [#37](/cloud-archive/%2Bbug/1493303/comments/37) |
| --- | --- | --- | --- |

* [socket-leak-3.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4545988/%2Bfiles/socket-leak-3.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4545988)
  (6.8 KiB,
  text/plain)

Here's a patch with a commit message explaining what's going on. Since it's a fix for a memory leak, the test is fairly crappy, but it's something.

Here's a patch with a commit message explaining what's going on. Since it's a fix for a memory leak, the test is fairly crappy, but it's something.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-08: |  |  | [#38](/cloud-archive/%2Bbug/1493303/comments/38) |
| --- | --- | --- | --- |

* [socket-leak-4.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4546358/%2Bfiles/socket-leak-4.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4546358)
  (6.8 KiB,
  text/plain)

Let's try this again, only without the leftover print statements.

Let's try this again, only without the leftover print statements.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-11: |  |  | [#39](/cloud-archive/%2Bbug/1493303/comments/39) |
| --- | --- | --- | --- |

@swift-coresec, please review proposed patch in comment #38. Thanks!

@swift-coresec, please review proposed patch in comment #38. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2016-01-12: |  |  | [#40](/cloud-archive/%2Bbug/1493303/comments/40) |
| --- | --- | --- | --- |

+2 from me

great work, Sam and Kota

+2 from me
great work, Sam and Kota

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matthew Oliver (matt-0)](https://launchpad.net/~matt-0) wrote on 2016-01-12: |  |  | [#41](/cloud-archive/%2Bbug/1493303/comments/41) |
| --- | --- | --- | --- |

+2 from me too, code looks good and test is working.

+2 from me too, code looks good and test is working.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-12: |  |  | [#42](/cloud-archive/%2Bbug/1493303/comments/42) |
| --- | --- | --- | --- |

The patch seems pretty trivial, would it be possible to get backports for stable/kilo and liberty release too ?

The patch seems pretty trivial, would it be possible to get backports for stable/kilo and liberty release too ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-13: |  |  | [#43](/cloud-archive/%2Bbug/1493303/comments/43) |
| --- | --- | --- | --- |

* [socket-leak-kilo-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548894/%2Bfiles/socket-leak-kilo-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548894)
  (6.6 KiB,
  text/plain)

kilo

kilo

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-13: |  |  | [#44](/cloud-archive/%2Bbug/1493303/comments/44) |
| --- | --- | --- | --- |

* [socket-leak-liberty-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548896/%2Bfiles/socket-leak-liberty-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548896)
  (6.8 KiB,
  text/plain)

liberty

liberty

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-13: |  |  | [#45](/cloud-archive/%2Bbug/1493303/comments/45) |
| --- | --- | --- | --- |

Thanks Samuel.

So iirc, the last three patches only fixe the proxy to server connection leak. For client to proxy leak ([bug 1466549](/bugs/1466549)) the fix only got merged for stable/liberty. The missing stable/kilo backport is proposed here: <https://review.openstack.org/#/c/217750/>

Thanks Samuel.
So iirc, the last three patches only fixe the proxy to server connection leak. For client to proxy leak (bug 1466549) the fix only got merged for stable/liberty. The missing stable/kilo backport is proposed here: https://review.openstack.org/#/c/217750/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-13: |  |  | [#46](/cloud-archive/%2Bbug/1493303/comments/46) |
| --- | --- | --- | --- |

@swift-coresec, any chance to get <https://review.openstack.org/#/c/217750/> merged before sending the advance notification ?

@swift-coresec, any chance to get https://review.openstack.org/#/c/217750/ merged before sending the advance notification ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-14: |  |  | [#47](/cloud-archive/%2Bbug/1493303/comments/47) |
| --- | --- | --- | --- |

Here is the final impact description for both [bug 1493303](/bugs/1493303) and [bug 1466549](/bugs/1466549),

If it's accurate, I'd like to send the advance notification asap with a disclosure date set to:

2016-01-20, 1500UTC

Title: Swift proxy-server DoS through Large Object

Reporter: Romain LE DISEZ (OVH), Örjan Persson (Kiliaro)

Products: Swift

Affects: client to proxy: >=2.2.1 <= 2.3.0

         proxy to server: >=2.2.1 <= 2.3.0, >= 2.4.0 <= 2.5.0

Description:

Romain LE DISEZ from OVH and Örjan Persson from Kiliaro independently

reported two vulnerabilities in Swift Large Object. By repeatedly

requesting and interrupting connections to a Large Object (Dynamic or

Static) URL, a remote attacker may exhausts Swift proxy-server

resources, potentially resulting in a denial of service. Note that there

are two distinct bugs that can exhaust proxy resources, one for client

connection (client to proxy), one for servers connection (proxy to

server). All Swift setup are affected.

Here is the final impact description for both bug 1493303 and bug 1466549,
If it's accurate, I'd like to send the advance notification asap with a disclosure date set to:
2016-01-20, 1500UTC
Title: Swift proxy-server DoS through Large Object
Reporter: Romain LE DISEZ (OVH), Örjan Persson (Kiliaro)
Products: Swift
Affects: client to proxy: >=2.2.1 <= 2.3.0
proxy to server: >=2.2.1 <= 2.3.0, >= 2.4.0 <= 2.5.0
Description:
Romain LE DISEZ from OVH and Örjan Persson from Kiliaro independently
reported two vulnerabilities in Swift Large Object. By repeatedly
requesting and interrupting connections to a Large Object (Dynamic or
Static) URL, a remote attacker may exhausts Swift proxy-server
resources, potentially resulting in a denial of service. Note that there
are two distinct bugs that can exhaust proxy resources, one for client
connection (client to proxy), one for servers connection (proxy to
server). All Swift setup are affected.

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → In Progress |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-14

| **summary**: | - Swift proxy memory leak on unfinished read+ Swift proxy memory leak on unfinished read (CVE-2016-0738) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alistair Coles (alistair-coles)](https://launchpad.net/~alistair-coles) wrote on 2016-01-14:  [**Re: Swift proxy memory leak on unfinished read (CVE-2016-0738)**](/cloud-archive/%2Bbug/1493303/comments/48) |  |  | [#48](/cloud-archive/%2Bbug/1493303/comments/48) |
| --- | --- | --- | --- |

+2 for patch at #38 applied to master. Verified that this fixes socket leak with early-terminated dlo and slo downloads (on SAIO on Ubuntu 14.04.2)

There's no test for DLO. Not a blocker and possibly redundant since ultimately it is the close call to SegmentedIterable that is being tested.

+2 for patch at #38 applied to master. Verified that this fixes socket leak with early-terminated dlo and slo downloads (on SAIO on Ubuntu 14.04.2)
There's no test for DLO. Not a blocker and possibly redundant since ultimately it is the close call to SegmentedIterable that is being tested.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alistair Coles (alistair-coles)](https://launchpad.net/~alistair-coles) wrote on 2016-01-14: |  |  | [#49](/cloud-archive/%2Bbug/1493303/comments/49) |
| --- | --- | --- | --- |

+2 for the liberty backport at #44

I could not apply the kilo backport at #43:

anc@u128:~/0dev/swift ((036c2f3...))$ git checkout origin/stable/kilo

HEAD is now at 036c2f3... Get better at closing WSGI iterables.

anc@u128:~/0dev/swift ((036c2f3...))$ git am ../patches/socket-leak-kilo-backport.diff

Applying: Fix memory/socket leak in proxy on truncated SLO/DLO GET

error: patch failed: swift/common/request\_helpers.py:431

error: swift/common/request\_helpers.py: patch does not apply

Patch failed at 0001 Fix memory/socket leak in proxy on truncated SLO/DLO GET

The copy of the patch that failed is found in:

   /home/anc/0dev/swift/.git/rebase-apply/patch

When you have resolved this problem, run "git am --continue".

If you prefer to skip this patch, run "git am --skip" instead.

To restore the original branch and stop patching, run "git am --abort".

+2 for the liberty backport at #44
I could not apply the kilo backport at #43:
anc@u128:~/0dev/swift ((036c2f3...))$ git checkout origin/stable/kilo
HEAD is now at 036c2f3... Get better at closing WSGI iterables.
anc@u128:~/0dev/swift ((036c2f3...))$ git am ../patches/socket-leak-kilo-backport.diff
Applying: Fix memory/socket leak in proxy on truncated SLO/DLO GET
error: patch failed: swift/common/request\_helpers.py:431
error: swift/common/request\_helpers.py: patch does not apply
Patch failed at 0001 Fix memory/socket leak in proxy on truncated SLO/DLO GET
The copy of the patch that failed is found in:
/home/anc/0dev/swift/.git/rebase-apply/patch
When you have resolved this problem, run "git am --continue".
If you prefer to skip this patch, run "git am --skip" instead.
To restore the original branch and stop patching, run "git am --abort".

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-14: |  |  | [#50](/cloud-archive/%2Bbug/1493303/comments/50) |
| --- | --- | --- | --- |

Oups, their is now a conflict for stable/kilo backport (proposed in comment #43).

This patch do: in swift/common/request\_helpers.py

+ def close(self):

+ """

+ Called when the client disconnect. Ensure that the connection to the

+ backend server is closed.

+ """

+ close\_if\_possible(self.app\_iter)

While current stable/kilo has:

    def close(self):

        """

        Called when the client disconnect. Ensure that the connection to the

        backend server is closed.

        """

        if self.current\_resp:

            close\_if\_possible(self.current\_resp.app\_iter)

Samuel, can you please fix that backport?

Oups, their is now a conflict for stable/kilo backport (proposed in comment #43).
This patch do: in swift/common/request\_helpers.py
+ def close(self):
+ """
+ Called when the client disconnect. Ensure that the connection to the
+ backend server is closed.
+ """
+ close\_if\_possible(self.app\_iter)
While current stable/kilo has:
def close(self):
"""
Called when the client disconnect. Ensure that the connection to the
backend server is closed.
"""
if self.current\_resp:
close\_if\_possible(self.current\_resp.app\_iter)
Samuel, can you please fix that backport?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alistair Coles (alistair-coles)](https://launchpad.net/~alistair-coles) wrote on 2016-01-14: |  |  | [#51](/cloud-archive/%2Bbug/1493303/comments/51) |
| --- | --- | --- | --- |

* [socket-leak-kilo-backport-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4549968/%2Bfiles/socket-leak-kilo-backport-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4549968)
  (6.3 KiB,
  text/plain)

I think I fixed the conflict with stable/kilo (at 036c2f3) in the attached patch

Sam had better take a look at it to be sure. 036c2f3 added stuff that seemed to allow this patch to be closer to the others i.e. self.current\_resp

I think I fixed the conflict with stable/kilo (at 036c2f3) in the attached patch
Sam had better take a look at it to be sure. 036c2f3 added stuff that seemed to allow this patch to be closer to the others i.e. self.current\_resp

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-14: |  |  | [#52](/cloud-archive/%2Bbug/1493303/comments/52) |
| --- | --- | --- | --- |

The patch in #51 looks good to me.

The patch in #51 looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-14: |  |  | [#53](/cloud-archive/%2Bbug/1493303/comments/53) |
| --- | --- | --- | --- |

The patch in comment #51 works for me. To sum-up, the upcoming advisory needs those patch to be applied:

- <https://review.openstack.org/#/c/217750/> (the stable/kilo backport for [bug 1466549](/bugs/1466549))

 - patch in comment #51 (the stable/kilo backport of this bug)

 - patch in comment #44 (the stable/liberty backport of this bug)

 - patch in comment #38 (the master/mitaka fix of this bug)

No need for stable/liberty or master/mitaka fix for [bug 1466549](/bugs/1466549) since liberty release already has this fix.

The patch in comment #51 works for me. To sum-up, the upcoming advisory needs those patch to be applied:
- https://review.openstack.org/#/c/217750/ (the stable/kilo backport for bug 1466549)
- patch in comment #51 (the stable/kilo backport of this bug)
- patch in comment #44 (the stable/liberty backport of this bug)
- patch in comment #38 (the master/mitaka fix of this bug)
No need for stable/liberty or master/mitaka fix for bug 1466549 since liberty release already has this fix.

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-14

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-20

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public Security |
| **summary**: | - Swift proxy memory leak on unfinished read (CVE-2016-0738)+ [OSSA 2016-004] Swift proxy memory leak on unfinished read+ (CVE-2016-0738) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Fix proposed to swift (stable/kilo)**](/cloud-archive/%2Bbug/1493303/comments/54) |  |  | [#54](/cloud-archive/%2Bbug/1493303/comments/54) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/270234>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/270234

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Fix proposed to swift (stable/liberty)**](/cloud-archive/%2Bbug/1493303/comments/55) |  |  | [#55](/cloud-archive/%2Bbug/1493303/comments/55) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/liberty

Review: <https://review.openstack.org/270235>

Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/270235

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Related fix proposed to ossa (master)**](/cloud-archive/%2Bbug/1493303/comments/56) |  |  | [#56](/cloud-archive/%2Bbug/1493303/comments/56) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: <https://review.openstack.org/270241>

Related fix proposed to branch: master
Review: https://review.openstack.org/270241

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Ubuntu Foundations Team Bug Bot (crichton)](https://launchpad.net/~crichton) wrote on 2016-01-20: |  |  | [#57](/cloud-archive/%2Bbug/1493303/comments/57) |
| --- | --- | --- | --- |

The attachment "leakpatch-1.diff" seems to be a patch. If it isn't, please remove the "patch" flag from the attachment, remove the "patch" tag, and if you are a member of the ~ubuntu-reviewers, unsubscribe the team.

[This is an automated message performed by a Launchpad user owned by ~brian-murray, for any issues please contact him.]

The attachment "leakpatch-1.diff" seems to be a patch. If it isn't, please remove the "patch" flag from the attachment, remove the "patch" tag, and if you are a member of the ~ubuntu-reviewers, unsubscribe the team.
[This is an automated message performed by a Launchpad user owned by ~brian-murray, for any issues please contact him.]

| **tags**: | added: patch |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-22:  [**Fix merged to swift (stable/kilo)**](/cloud-archive/%2Bbug/1493303/comments/58) |  |  | [#58](/cloud-archive/%2Bbug/1493303/comments/58) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270234>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=a4c1825a026655b7ed21d779824ae7c25318fd52>

Submitter: Jenkins

Branch: stable/kilo

commit a4c1825a026655b7ed21d779824ae7c25318fd52

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3.4, at least. See PEP 442.

\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also

       has\_finalizer() in Modules/gcmodule.c in Python.

\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See

        sock\_close() in the same file for the other half of the sad story.

This closes CVE-2016-0738.

Closes-Bug: 1493303

Change-Id: I9b617bfc152dca40d1750131d1d814d85c0a88dd

    Co-Authored-By: Kota Tsuyuzaki <email address hidden>

Reviewed: https://review.openstack.org/270234
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=a4c1825a026655b7ed21d779824ae7c25318fd52
Submitter: Jenkins
Branch: stable/kilo
commit a4c1825a026655b7ed21d779824ae7c25318fd52
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Change-Id: I9b617bfc152dca40d1750131d1d814d85c0a88dd
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>

| **tags**: | added: in-stable-kilo |
| --- | --- |
| **tags**: | added: in-stable-liberty |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-22:  [**Fix merged to swift (stable/liberty)**](/cloud-archive/%2Bbug/1493303/comments/59) |  |  | [#59](/cloud-archive/%2Bbug/1493303/comments/59) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270235>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=8c1976aa771f8c43c5dbe676bd9a5efc69f09eae>

Submitter: Jenkins

Branch: stable/liberty

commit 8c1976aa771f8c43c5dbe676bd9a5efc69f09eae

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3.4, at least. See PEP 442.

\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also

       has\_finalizer() in Modules/gcmodule.c in Python.

\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See

        sock\_close() in the same file for the other half of the sad story.

This closes CVE-2016-0738.

Closes-Bug: 1493303

Change-Id: I74ea49eaa7d5c372cdc2399148d5495d3007dbd0

    Co-Authored-By: Kota Tsuyuzaki <email address hidden>

Reviewed: https://review.openstack.org/270235
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=8c1976aa771f8c43c5dbe676bd9a5efc69f09eae
Submitter: Jenkins
Branch: stable/liberty
commit 8c1976aa771f8c43c5dbe676bd9a5efc69f09eae
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Change-Id: I74ea49eaa7d5c372cdc2399148d5495d3007dbd0
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>

| Changed in swift: | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-22:  [**Fix merged to swift (master)**](/cloud-archive/%2Bbug/1493303/comments/60) |  |  | [#60](/cloud-archive/%2Bbug/1493303/comments/60) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270233>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=58359269b0e971e52f0eb7f97221566ca2148014>

Submitter: Jenkins

Branch: master

commit 58359269b0e971e52f0eb7f97221566ca2148014

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3.4, at least. See PEP 442.

\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also

       has\_finalizer() in Modules/gcmodule.c in Python.

\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See

        sock\_close() in the same file for the other half of the sad story.

This closes CVE-2016-0738.

Closes-Bug: 1493303

Co-Authored-By: Kota Tsuyuzaki <email address hidden>

Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612

Reviewed: https://review.openstack.org/270233
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=58359269b0e971e52f0eb7f97221566ca2148014
Submitter: Jenkins
Branch: master
commit 58359269b0e971e52f0eb7f97221566ca2148014
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-25

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-01-25:  [**Fix included in openstack/swift 2.6.0**](/cloud-archive/%2Bbug/1493303/comments/61) |  |  | [#61](/cloud-archive/%2Bbug/1493303/comments/61) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/swift 2.6.0 release.

This issue was fixed in the openstack/swift 2.6.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-25:  [**Fix proposed to swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/62) |  |  | [#62](/cloud-archive/%2Bbug/1493303/comments/62) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/272201>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/272201

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-26:  [**Fix merged to swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/63) |  |  | [#63](/cloud-archive/%2Bbug/1493303/comments/63) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/comments/63/%2Bdownload) (30.2 KiB)

Reviewed: <https://review.openstack.org/272201>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=f9b7fd3074b5b0e5d6ea879d4144f7bfeec5d46b>

Submitter: Jenkins

Branch: feature/crypto

commit e13a03c379273ee10e678818078b9c40a96a7dc9

Author: Tim Burke <email address hidden>

Date: Wed Jan 20 16:06:26 2016 -0800

Stop overriding builtin range

Change-Id: I315f8b554bb9e96659b455f4158f074961bd6498

commit 0a404def7d54d1ef1c85c11a378052260c4fda4c

Author: John Dickinson <email address hidden>

Date: Wed Jan 20 15:19:35 2016 -0800

remove unneeded duplicate dict keys

Change-Id: I926d7aaa9df093418aaae54fe26e8f7bc8210645

commit 221f94fdd39fd2dcd9a2e5565adceab615d55913

Author: John Dickinson <email address hidden>

Date: Tue Jan 19 14:50:24 2016 -0800

authors and changelog updates for 2.6.0

Change-Id: Idd0ff9e70abc0773be183c37cd6125fe852da7c0

commit 58359269b0e971e52f0eb7f97221566ca2148014

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3...

Reviewed: https://review.openstack.org/272201
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=f9b7fd3074b5b0e5d6ea879d4144f7bfeec5d46b
Submitter: Jenkins
Branch: feature/crypto
commit e13a03c379273ee10e678818078b9c40a96a7dc9
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Jan 20 16:06:26 2016 -0800
Stop overriding builtin range
Change-Id: I315f8b554bb9e96659b455f4158f074961bd6498
commit 0a404def7d54d1ef1c85c11a378052260c4fda4c
Author: John Dickinson <me@not.mn>
Date: Wed Jan 20 15:19:35 2016 -0800
remove unneeded duplicate dict keys
Change-Id: I926d7aaa9df093418aaae54fe26e8f7bc8210645
commit 221f94fdd39fd2dcd9a2e5565adceab615d55913
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 14:50:24 2016 -0800
authors and changelog updates for 2.6.0
Change-Id: Idd0ff9e70abc0773be183c37cd6125fe852da7c0
commit 58359269b0e971e52f0eb7f97221566ca2148014
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612
commit bc4b298b6e208d3188641712c9d66ae82d172c14
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 19 15:33:13 2016 -0800
Fix a comment's indentation
Change-Id: I34514525b606cf82767ddce7769bc42fa5457717
commit 3a0486e532f22af0d3c8a5c5d78613c22e786ff6
Author: Sivasathurappan Radhakrishnan <siva.radhakrishnan@intel.com>
Date: Fri Dec 4 17:43:00 2015 +0000
Deleted comment about part power in FakeRing
Deleted comment about parameter part power in Class FakeRing as its
behavior got dropped in I8bfc388a04eff6491038991cdfd7686c9d961545.
Change-Id: Iec7d2565a77e48493b0056021066d8d8eab65d0b
Closes-Bug: #1488704
commit 999479f9b17b42ccc5da54ce01651960cf7cf970
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 10:30:30 2016 -0800
Bump eventlet min version to 0.17.4
IPv6 support in Swift is dependent on IPv6 support in eventlet.
eventlet itself only claims support for IPv6 post v0.17
(https://github.com/eventlet/eventlet/issues/8). This update matches
the OpenStack global requirements version.
Change-Id: I9d8433cdd3bf7d7a93b8f50b991cc21721a80d22
commit 133a3ea601a3fea84af36a42845f27b8182fd901
Author: Christopher Bartz <bartz@dkrz.de>
Date: Mon Dec 21 14:17:00 2015 +0100
Use the correct split\_path in handle\_request
Change-Id: I86d423309f0b2091ee2e82b2245caf925b6a75ef
Closes-Bug: #1528189
commit bf10974cdefffdaaebc58d21e8a9912638a0405a
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Dec 16 15:46:13 2015 -0800
Expose token expiration time in tempauth auth response
Previously, we gave no indication of when a token would expire. Users
would have to just use it until it stopped working, then re-auth.
Now, a successful auth response will include a new header,
X-Auth-Token-Expires, with the number of seconds remaining until the
token is invalid. This allows the client to attempt to re-auth before
sending a request that will definitely fail.
For comparison, swauth already uses the X-Auth-Token-Expires header with
identical semantics. Additionally, Keystone (v2 and v3) already exposes
expiration times in its JSON responses. The security impact should be
minimal.
Change-Id: I5a4a74276bc0df6dda94e4bc150065c0d77de0eb
commit 47e226418bad35ccad2a1525f392ba69f6165027
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Mon Jan 18 06:20:14 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Ic416c9afc8a1c76f552803a7c70fc905eda7b3cb
commit 5d449471b12c67b31ebb5a383d9bb35bace36213
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jan 14 17:26:01 2016 -0800
Remove some Python 2.6 leftovers
Change-Id: I798d08722c90327c66759aa0bb4526851ba38d41
commit 3c0cf549f1e822cce8f905b069b317e676cf306b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jan 13 18:08:45 2016 -0800
Speed up get\_more\_nodes() when there is an empty zone
The ring has some optimizations in get\_more\_nodes() so that it can
find handoffs that span all the regions/zones/et cetera and then stop
looking. The stopping is the important part.
Previously, it would quickly find a handoff in each unused region,
then spend way too long looking for more unused regions; the same was
true for zones, IPs, and so on. Thus, in commit 9cd7c6c, we started
counting regions and zones, then stopping when we found them all.
This count included all regions and zones in the ring, regardless of
whether or not there were actually any parts assigned or not. In rings
with an empty region, i.e. a region for which there are only
zero-weight devices, get\_more\_nodes() would be very slow.
This commit ignores devices with no assigned partitions when counting
regions, zones, and so forth, thus greatly speeding things up.
The output of get\_more\_nodes() is unchanged. This is purely an
optimization.
Closes-Bug: 1534303
Change-Id: I4a5c57205e87e1205d40fd5d9458d4114e524332
commit 70047709fc9885df7019f791e17a3240682cc6cb
Author: keliang <ke.liang@easystack.cn>
Date: Fri Jan 15 00:31:51 2016 +0800
Drop python 2.6 support
Change-Id: Id6329c863dacb189fccfc304453ed7b6f9607c14
commit a4c2fe95ab2fbe59379a69914ed0fac49c28efbb
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Jan 12 21:26:33 2016 +0100
Allow to change auditor sleep interval in config
Change-Id: Ic451c5e0b686509f8982ed1bf65a223a2d77b9a0
commit edc823e8030640184071fee4920d34f9a1cc6b3e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Nov 29 18:46:47 2015 +0100
Show UTC time in swift-recon.
It's not consistent now for example local time in replication part and
UTC time at begging of line. Use \_ptime in swift-recon for all time
printing and this function returns UTC now.
Change-Id: I732d9851db157130a08e825e8093b7e244b63e9c
commit fa5b32d27964478dfcccf71155d2aaa946c561f0
Author: Tim Burke <tim.burke@gmail.com>
Date: Tue Jan 12 14:18:30 2016 -0800
Make object-auditor storage-policy-aware
Previously, the object-auditor would always use a (replication)
DiskFileManager when walking through AuditLocations, which would cause
it to skip EC fragment archives with a warning like:
Unexpected file <hash\_path>/1452557187.03610#3.data:
Invalid Timestamp value in filename '1452557187.03610#3.data'
Now, the AuditLocation's policy will be used to find an appropriate
manager to get the diskfile. Additionally, several .commit()s were added
to the auditor tests so the .durable will be written, which is required
when auditing EC fragment archives.
Change-Id: I960e7d696fd9ad704ca1872b4ac821f9078838c7
Closes-Bug: 1533002
commit 33476460239c9cdb08dd8065d22d84a4717da7be
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jan 8 16:15:54 2016 -0800
fixups for ipv6 memcache\_servers docs
Change-Id: I20d91c1e276014eaf210fa9eb43788bc17f4e8df
commit d5ff5447be30b44bf4acc8b912b6241a44f710be
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 12 16:42:06 2016 -0800
Install liberasurecode packages in SAIO.
Change-Id: If673afa2b61a3e388612debf4860d561960963a3
commit 4ffc4ba411f67c8407ba38d082a3a51a96ad7e04
Author: Jonathan Hinson <jlhinson@us.ibm.com>
Date: Tue Jan 12 11:46:21 2016 -0600
Functional tests for if-match with multiple etags
Multiple etags can be provided on an if-match or if-none-match
request. This is currently being tested in the unit tests, but not
in the functional tests. Since these etags can be modified by
middleware, we need functional tests to assert multiple-etag
requests are handled correctly.
Change-Id: Idc409c85e8aa82b59dc2bc28af6ca2617de82699
commit e6194113a3c81563590eabf8f761ccb988bb917c
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri Jan 8 16:38:31 2016 -0800
Validate X-Timestamps
Previously, attempting to PUT a new object with an X-Timestamp header
less than or equal to zero (ie, for a timestamp on or before 1970-01-01
00:00:00) would cause the object-server to 500.
While we're at it, cap X-Timestamp at 9999999999 (2286-11-20 17:46:40)
so we don't get an eleventh digit before the decimal point.
Closes-Bug: 1532471
Change-Id: I23666ec8a067d829eaf9bfe54bd086c320b3429e
commit 1f3304c5153e01988b8f4493875b6489e93f76d0
Author: Ben Martin <blmartin@us.ibm.com>
Date: Mon Dec 14 15:28:17 2015 -0600
Print min\_part\_hours lockout time remaining
swift-ring-builder currently only displays min\_part\_hours and
not the amount of time remaining before a rebalance can occur.
This information is readily available and has been displayed
as a quality of life improvement.
Additionally, a bug where the time since the last rebalance
was always updated when rebalance was called regardless of
if any partitions were reassigned. This can lead to partitions
being unable to be reassigned as they never age according to
the time since last rebalance.
Change-Id: Ie0e2b5e25140cbac7465f31a26a4998beb3892e9
Closes-Bug: #1526017
commit 167bb5eeb82886d67c1b382417fb22b8ea85f0d3
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Wed Dec 16 12:07:27 2015 -0800
Fix IPv6 handling in MemcacheConnPool.
The patch removes the assumption of IPv4-only addresses in the
MemcacheConnPool. The changes are around address handling.
Namely, if a server is specified with an address
[<address>]:port (port is optional), it is assumed to be an IPv6
address [1]. If an IPv6 address is specified without "[]", an exception
is raised as it is impossible to parse such addresses correctly.
For testing, memcache can be configured to listen on the link-local,
unique-local, or ::1 (equivalent to 127.0.0.1) addresses. Link-local
addresses are assigned by default to each interface and are of the form
"fe80::dead:beef". These addresses require a scope ID, which would look
like "fe80::dead:beef%eth0" (replacing eth0 with the correct interface).
Unique-local addresses are any addresses in the fc00::/7 subnet. To add
a ULA to an interface use the "ip" utility. For example:
"ip -6 address add fc01::dead:beef dev eth0". Lastly, and probably
simplest, memcache can be configured to listen on "::1". The same
address would be used in the swift configuration, e.g. "[::1]:11211".
Note: only memcached version 1.4.25 or greater supports binding to an
IPv6 address.
Fixes #1526570
[1] IPv6 host literals:
https://tools.ietf.org/html/rfc3986#section-3.2.2
Change-Id: I8408143c1d47d24e70df56a08167c529825276a2
commit fb6751d8ba133c57e1ebb76be71a96f2f120b8ca
Author: Paul Dardeau <paul.dardeau@intel.com>
Date: Fri Jan 8 22:49:05 2016 +0000
Look for device holes that can be reused when adding new device.
Change-Id: I1980ebdd9dc89848173d8ca2fe2afb74029dcfa2
Closes-Bug: 1532276
commit b35f3c90bde8a7ccb50440bda5800cbb8274a5a1
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Jan 8 01:29:11 2016 -0800
Add note COPY with conditional headers
Swift now supports Range header for COPY (or PUT with X-Copy-From)
to make a partial copied object. This patch adds the note to show
it obviously supported in Swift community.
Change-Id: I6bf28f0932c90e7b305cd61aabce4ed028ae691e
Partial-Bug: #1532126
commit 23c7a58f8f1412c28b3a16b79be09c224c9f7d55
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Dec 11 18:26:34 2015 +0900
Fix ClientException handling in Container Sync
swift/container/sync.py uses swift.common.internal\_client.delete\_object
and put\_object and expected these methods raise ClientException.
But delete\_object and put\_object never raise the exception so this patch
raises ClientException when urllib2 library raises HTTPError.
Co-Authored-By: Eran Rom <eranr@il.ibm.com>
Closes-Bug: #1419901
Change-Id: I58cbf77988979a07998a46d9d81be84d29b0d9bf
commit 6786cdf036b4faabe3928c3d0dd9615d94834801
Author: Harshada Mangesh Kakad <harshadak@metsi.co.uk>
Date: Thu Dec 31 01:44:00 2015 -0800
Fixing the deprecated library function.
os.popen() is deprecated since version 2.6. Resolved with use of
subprocess module.
Change-Id: I4409cdd9edbc1a26d6f99c125c9100fadda5d758
Partial-Bug: #1529836
commit 85a0a6a28e166bc076cf8786de2b46248d8786a2
Author: Eran Rom <eranr@il.ibm.com>
Date: Sun Jul 26 13:31:17 2015 +0300
Container-Sync to iterate only over synced containers
This change introduces a sync\_store which holds only containers that
are enabled for sync. The store is implemented using a directory
structure that resembles that of the containers directory, but has
entries only for containers enabled for sync.
The store is maintained in two ways:
1. Preemptively by the container server when processing
PUT/POST/DELETE operations targeted at containers with
x-container-sync-key / x-container-sync-to
2. In the background using the containers replicator
whenever it processes a container set up for sync
The change updates [1]
[1] http://docs.openstack.org/developer/swift/overview\_container\_sync.html
Change-Id: I9ae4d4c7ff6336611df4122b7c753cc4fa46c0ff
Closes-Bug: #1476623
commit e75888b281d59df0889f28d0b32241dac3a34aa2
Author: HugoKuo <tonytkdk@gmail.com>
Date: Wed Jan 6 14:33:23 2016 +0800
Add more description for write\_affinity\_node\_count parameter in the doc.
Change-Id: Iad410a2be4f9a2cd5c53e860b9f91993aa7f2369
Closes-Bug: #1531173
commit f53cf1043d078451c4b9957027bf3af378aa0166
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Jan 5 20:20:15 2016 +0100
Fixed few misspellings in comments
Change-Id: I8479c85cb8821c48b5da197cac37c80e5c1c7f05
commit 3b1591f235f4b85796917507be5e7fd80365ff9e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Wed Sep 30 19:08:09 2015 +0200
swift-init: New option kill-after-timeout
This option send SIGKILL to daemon after kill\_wait period.
When daemon hangs and doesn't respond to SIGTERM/SIGHUP
there is no way to stop it using swift-init now. Classic
init scripts in Linux kills hanged process after grace
period and this patch add same behaviour. This is most
usefull when using "restart" on hanged daemon.
Change-Id: I8c932b673a0f51e52132df87ea2f4396f4bba9d8
commit 79222e327f9df6335b58e17a6c8dd0dc44b86c17
Author: ChangBo Guo(gcb) <eric.guo@easystack.cn>
Date: Sat Dec 26 13:13:37 2015 +0800
Fix AttributeError for LogAdapter
LogAdapter object has no attribute 'warn' but has attribute
'warning'.
Closes-Bug: #1529321
Change-Id: I0e0bd0a3dbc4bb5c1f0b343a8809e53491a1da5f
commit 684c4c04592278a280032002b5313b171ee7a4c0
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Aug 2 22:47:42 2015 +0530
Python 3 deprecated the logger.warn method in favor of warning
DeprecationWarning: The 'warn' method is deprecated, use 'warning'
instead
Change-Id: I35df44374c4521b1f06be7a96c0b873e8c3674d8
commit d0a026fcb8e8a9f5475699cc56e1998bdc4cd5ca
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Wed Dec 16 18:50:37 2015 +0900
Fix duplication for headers in Access-Control-Expose-Headers
There are following problems with Access-Control-Expose-Headers.
\* If headers in X-Container-Meta-Access-Control-Expose-Headers are
configured, the headers are kept with case-sensitive string.
Then a CORS request comes, the headers are merged into
Access-Control-Expose-Headers as case-sensitive string even if
there is a same header which is not case-sensitive string.
\* Access-Control-Expose-Headers is handled by a list.
If X-Container/Object-Meta-XXX is configured in container/object
and X-Container-Meta-Access-Control-Expose-Headers, same header
is listed in Access-Control-Expose-Headers.
This patch provides a fix for the problems.
Change-Id: Ifc1c14eb3833ec6a851631cfc23008648463bd81
commit 0bcd7fd50ec0763dcb366dbf43a9696ca3806f15
Author: Bill Huber <wbhuber@us.ibm.com>
Date: Fri Nov 20 12:09:26 2015 -0600
Update Erasure Coding Overview doc to remove Beta version
The major functionality of EC has been released for Liberty and
the beta version of the code has been removed since it is now
in production.
Change-Id: If60712045fb1af803093d6753fcd60434e637772
commit 84ba24a75640be4212e0f984c284faf4c894e7c6
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Dec 18 11:24:34 2015 +0000
Fix rst errors so that html docs are complete
rst table format errors don't break the gate job
but do cause sections of the documents to go missing
from the html output.
Change-Id: Ic8c9953c93d03dcdafd8f47b271d276c7b356dc3
commit 9fe0e25604dff35db7eab1bca312821a81db6c1d
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Dec 8 22:27:44 2015 -0800
Sleep enough for trampoline
When running unite test suite in local poor resource environment,
sometimes test/unit/proxy/test\_server.py fails due to a lack of
waiting time to trampoline of eventlet thread.
This patch enables to sleep 1 more second when it doesn't seem
to have enough time to tranpoline.
Change-Id: I0bbc8fc245919d3c0a071ff87ff6e20b8d58f9b8
commit 87f7e907ee412f5847f1f9ffca7a566fb148c6b1
Author: Matthew Oliver <matt@oliver.net.au>
Date: Wed Dec 16 17:19:24 2015 +1100
Pass HTTP\_REFERER down to subrequests
Currently a HTTP\_REFERER (Referer) header isn't passed down to
subrequests. This means \*LO subrequests to segment containers
return a 403 on a \*LO GET when accessed by requests using referer
ACLs.
Currently the only way around referer access to \*LO's is to make the
segments container world readable.
This change makes sure the referer header is passed into subrequests
allowing a segments container to only need to be locked down with
the same referer as the \*LO container.
This is a 1 line change to code, but also adds a unit and 2 functional
functional tests (one for DLO and one for SLO).
Change-Id: I1fa5328979302d9c8133aa739787c8dae6084f54
Closes-Bug: #1526575
commit e15960a5d86e00a7d420edc4af034b27da0af8fd
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Thu Dec 17 12:08:45 2015 +0000
Fix incorrect kwarg in auth middleware example
When calling memcache\_client.set(), timeout was deprecated
and is now removed as a keyword arg, use time instead.
Change-Id: Iedbd5b064853ef2b386963246f639fbcd3931cd3
commit 169a7c7f9e12ebc9933bd9ca4592e13b0de8b47b
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Dec 16 15:28:25 2015 +0000
Fix func test --until-failure and --no-discover options
This patch changes functional test classes to subclass
unittest2.TestCase rather than unittest.TestCase.
This fixes errors when attempting to use
tox -e func -- -n <test\_path\_including\_test\_method>
and
tox -e func -- --until-failure
Also migrate from using nose.SkipTest to unittest2.SkipTest
Change-Id: I903033f5e01833550b2f2b945894edca4233c4a2
Closes-Bug: 1526725
Co-Authored-By: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
commit b68311db95860ac1cab585a5ab66bd3b3abb765e
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Dec 15 18:55:41 2015 -0800
Fix reconciler test to calc lastmodified as UTC
Swift reconciler calculates the last-modified date as UTC but
current test calculates it as local time zone. It triggers unit
test failure in non-UTC environment.
This patch fixes the test to calculate the last-modified as UTC
as well.
Change-Id: Ia0053f350daf2cb8c61ac01a933924b6e4b0cb37
Closes-Bug: #1526588
commit 1bb665331af92422290fb585de7cb6a2497236e6
Author: Venkateswarlu Pallamala <p.venkatesh551@gmail.com>
Date: Mon Nov 9 19:22:38 2015 -0800
remove unused parameters in the method
make the helper methods as private by using convention
Change-Id: I73b9604f8d5a0e85d012aac42b7963b618f5ad97
commit 9d7f71d5754c8b45f8e7c6ab80202de09933afb8
Author: Richard Hawkins <hurricanerix@gmail.com>
Date: Fri Aug 7 18:14:13 2015 -0500
Modify functional tests to use ostestr/testr
Defcore uses Tempest, which uses Test Repository.
This change makes it easier for Defcore to pull functional
tests from Swift and run them. Additionally, using testr
allows tests to be run in parallel.
Concurrency set to 1 for now, >1 causes failures for
reasons that are still TBD.
With switch to ostestr all the server logs are being sent to stdout
which makes it completely unreadable. Suppressing the logs by default
now with a flag to enable it if desired.
Co-Authored-By: John Dickinson <me@not.mn>
Co-Authored-By: Robert Collins <rbtcollins@hpe.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Co-Authored-By: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
Change-Id: I53ef4a116996a772cf1f3abc2eb0ad60047322d5
Related-Bug: 1177924
commit 2f4b79233e30d42140bbc07059417443bf7a0757
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Tue Dec 15 15:49:42 2015 +0000
Minor cleanup of repeated identical test assertions
assertDictContainsSubset is being called multiple times with
same arguments in a loop. Since assertDictContainsSubset is
deprecated form python 3.2, replace it with checks on
individual key, value pairs.
Change-Id: I7089487710147021f26bd77c36accf5751855d68
commit 60b2e02905d57f55169e506f4874b2334a1a68a5
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Oct 5 16:15:29 2015 +0100
Make ECDiskFile report all fragments found on disk
Refactor the disk file get\_ondisk\_files logic to enable
ECDiskfile to gather \*all\* fragments found on disk (not just those
with a matching .durable file) and make the fragments available
via the DiskFile interface as a dict mapping:
Timestamp --> list of fragment indexes
Also, if a durable fragment has been found then the timestamp
of the durable file is exposed via the diskfile interface.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I55e20a999685b94023d47b231d51007045ac920e
commit 450737f886050e486f518cdce0c97596ccad848d
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Dec 15 11:33:56 2015 +0900
Fix a typo in development\_auth.rst
This patch uses correct name for "CORS".
Change-Id: I5fee5c581a2b3adb7596a273baf05708bfa97f79
commit 40476ea0797690d3a90a9ed91906d26103dfa058
Author: John Dickinson <me@not.mn>
Date: Mon Dec 14 10:52:22 2015 -0800
Document pretend\_min\_part\_hours\_passed
Added a docstring for the swift-ring-builder CLI command
"pretend\_min\_part\_hours\_passed". This is a dangerous operation, and
that's why it hasn't been documented, but it can be useful at times.
It should be made known to those who need it.
Change-Id: I45bdbaacbbdda64c7510453e6d93e6d8563e3ecd
commit 6ade2908cca696ce1b48a7a19f4d460081fa5b0a
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Dec 13 21:13:42 2015 +0100
Deprecated param timeout removed from memcached
Change-Id: Idf042a79f0db148bf9f28a9e360cb2a3c18d385a
commit 88c9aed7c846402355a3c7831f34f3e833bbdf11
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:19:28 2015 +0200
Port swift.common.utils.StatsdClient to Python 3
\* StatsdClient.\_send(): on Python 3, encode parts to UTF-8 and
replace '|' with b'|' to join parts.
\* timing\_stats(): replace func.func\_name with func.\_\_name\_\_. The
func\_name attribute of functions was removed on Python 3, whereas
the \_\_name\_\_ attribute is available on Python 2 and Python 3.
\* Fix unit tests to use bytes
Change-Id: Ic279c9b54e91aabcc52587eed7758e268ffb155e
commit ca2dcc371921aa1aded6161287cc03c0940bf198
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Fri Dec 11 18:21:28 2015 +0100
Deprecated tox -downloadcache option removed
Caching is enabled by default from pip version 6.0
More info:
https://testrun.org/tox/latest/config.html#confval-downloadcache=path
https://pip.pypa.io/en/stable/reference/pip\_install/#caching
Change-Id: I9451a0f0dee5c5a3c0ca0a52f58bd353602661a2
commit 211758f8cb02298fe16e59bf2954a146c6b24b83
Author: Catherine Northcott <catherine@northcott.nz>
Date: Thu Nov 5 23:04:14 2015 +1300
Add support for storage policies to have more than one name
This patch alters storage\_policy.py to allow storage policies
to have multiple names. Now users are able to add a number of
human-readable aliases for storage policies. Policies now have
a .name (the default name), .aliases (a string of comma
seperated aliases), and .aliases\_list (a list of all human
readable names). Policies will always have an .aliases value
if no aliases are set it will contain the default name.
The policy docs and tests have been updated to reflect changes
and policy.get\_policy\_info has been altered to display the
name and aliases
Change-Id: I02967ca8d7c790595e5ee551581196aa64552eea
commit 7f636a557296ecc6ae4727700cfcf9f82573bd16
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Nov 30 18:06:09 2015 -0800
Allow smaller segments in static large objects
The addition of range support for SLO segments (commit 25d5e68)
required the range size to be at least the SLO minimum segment size
(default 1 MiB). However, if you're doing something like assembling a
video of short clips out of a larger one, then you might not need a
full 1 MiB.
The reason for the 1 MiB restriction was to protect Swift from
resource overconsumption. It takes CPU, RAM, and internal bandwidth to
connect to an object server, so it's much cheaper to serve a 10 GiB
SLO if it has 10 MiB segments than if it has 10 B segments.
Instead of a strict limit, now we apply ratelimiting to small
segments. The threshold for "small" is configurable and defaults to 1
MiB. SLO segments may now be as small as 1 byte.
If a client makes SLOs as before, it'll still be able to download the
objects as fast as Swift can serve them. However, a SLO with a lot of
small ranges or segments will be slowed down to avoid resource
overconsumption. This is similar to how DLOs work, except that DLOs
ratelimit \*every\* segment, not just small ones.
UpgradeImpact
For operators: if your cluster has enabled ratelimiting for SLO, you
will want to set rate\_limit\_under\_size to a large number prior to
upgrade. This will preserve your existing behavior of ratelimiting all
SLO segments. 5368709123 is a good value, as that's 1 greater than the
default max object size. Alternately, hold down the 9 key until you
get bored.
If your cluster has not enabled ratelimiting for SLO (the default), no
action is needed.
Change-Id: Id1ff7742308ed816038a5c44ec548afa26612b95
commit 73d0f1620a269f990dbd3d2796abf27e9a05e227
Author: Béla Vancsics <vancsics@inf.u-szeged.hu>
Date: Tue Dec 8 10:17:08 2015 +0100
Not used parameter
The account variable was not used in the method.
Change-Id: I8e91d7616529f33b615bc52af76bfda01141d364

| **tags**: | added: in-feature-crypto |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-28:  [**Related fix merged to ossa (master)**](/cloud-archive/%2Bbug/1493303/comments/64) |  |  | [#64](/cloud-archive/%2Bbug/1493303/comments/64) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270241>

Committed: <https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d>

Submitter: Jenkins

Branch: master

commit 606a18e718aed329a9d42d298e3119f0f1974e3d

Author: Tristan Cacqueray <email address hidden>

Date: Wed Jan 20 10:19:30 2016 -0500

Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)

Related-Bug: #1466549

    Related-Bug: #1493303

    Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

Reviewed: https://review.openstack.org/270241
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d
Submitter: Jenkins
Branch: master
commit 606a18e718aed329a9d42d298e3119f0f1974e3d
Author: Tristan Cacqueray <tdecacqu@redhat.com>
Date: Wed Jan 20 10:19:30 2016 -0500
Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)
Related-Bug: #1466549
Related-Bug: #1493303
Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-02-09:  [**Fix proposed to swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/65) |  |  | [#65](/cloud-archive/%2Bbug/1493303/comments/65) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/277950>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/277950

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-02-10:  [**Change abandoned on swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/66) |  |  | [#66](/cloud-archive/%2Bbug/1493303/comments/66) |
| --- | --- | --- | --- |

Change abandoned by Alistair Coles (<email address hidden>) on branch: feature/crypto

Review: <https://review.openstack.org/277950>

Change abandoned by Alistair Coles (alistair.coles@hpe.com) on branch: feature/crypto
Review: https://review.openstack.org/277950

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-03-08:  [**Fix proposed to swift (feature/hummingbird)**](/cloud-archive/%2Bbug/1493303/comments/67) |  |  | [#67](/cloud-archive/%2Bbug/1493303/comments/67) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/290148>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/290148

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-03-08:  [**Fix merged to swift (feature/hummingbird)**](/cloud-archive/%2Bbug/1493303/comments/68) |  |  | [#68](/cloud-archive/%2Bbug/1493303/comments/68) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/comments/68/%2Bdownload) (71.7 KiB)

Reviewed: <https://review.openstack.org/290148>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=0f7f1de233919a0b046349a3e31ae7fc8675a1c5>

Submitter: Jenkins

Branch: feature/hummingbird

commit d6b4587a554b51ba733b151e0d924735b63d07e0

Author: Olga Saprycheva <email address hidden>

Date: Tue Mar 8 10:57:56 2016 -0600

Removed redundant file for flake8 check

Change-Id: I4322978aa20ee731391f7709bbd79dee140fc703

commit 643dbce134140530eef2ae62c42fef1107f905ed

Author: OpenStack Proposal Bot <email address hidden>

Date: Tue Mar 8 06:35:49 2016 +0000

Imported Translations from Zanata

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I96b8ff1287bf219c5f8d56a3a4868c1063a953f9

commit 83713d37f0331c5ce9d377f4b4e8724551ae30ca

Author: Daisuke Morita <email address hidden>

Date: Mon Mar 7 18:30:47 2016 -0800

Missing comments for storage policy parameter

There are missing comments about storege\_policy\_index so appropriate

    comments are added.

Change-Id: I3de3f0e6864e65918ca1a13cce70f19c23d295f5

commit 2cff2dec3d1c4588f5103e39679c43b3dded6dcb

Author: Olga Saprycheva <email address hidden>

Date: Fri Mar 4 15:19:39 2016 -0600

Fixed pep8 and flake8 errors in doc/source/conf.py and updated flake8 commands in tox.ini to test it.

Change-Id: I2add370e4cfb55d1388e3a8b41f688a7f3f2c621

commit 043fbca6d08648baa314ea2236f1ccdca8785f16

Author: Christian Schwede <email address hidden>

Date: Fri Mar 4 09:33:17 2016 +0000

Remove Erasure Coding beta status from docs

This removes notes stating support for Erasure coding as beta. Questions

    regarding the stability of EC are coming up regularly, and are often referring

    to the docs that state EC as still in beta.

Besides this, a note marking statsd support as beta has been removed as well.

Change-Id: If4fb6a5c4cb741d42953db3cee8cb17a1d774e15

commit 09c73b86e9255f28fbd4cf571a52c17d549a8f9a

Author: Pete Zaitcev <email address hidden>

Date: Thu Mar 3 10:24:28 2016 -0700

Fix a crash in exception printout

Says the number of arguments does not match the number of '%'.

Change-Id: I8b5e395a07328fb9d4ac7a19f8ed2ae1637bee3b

commit fad5fabe0a22e8a86635a66523dd3d3d3b1fa705

Author: Tim Burke <email address hidden>

Date: Thu Mar 3 15:07:08 2016 +0000

During functional tests, 404 response to a DELETE is successful

Previously, we would only consider 204 responses successful, which would

    cause some spurious gate failures, such as

<http://logs.openstack.org/66/287666/3/check/gate-swift-dsvm-functional/c6d2673/console.html#_2016-03-03_13_41_07_846>

Change-Id: Ic8c300647924352a297a2781b50064f7657038b4

commit e91de49d6864b3794f8dc5acd9c1bf0c2f7409d1

Author: Alistair Coles <email address hidden>

Date: Mon Aug 10 10:30:10 2015 -0500

Update container on fast-POST

This patch makes a number of changes to enable content-type

    metadata to be updated when using the fast-POST mode of

    operation, as proposed in the associated spec ...

Reviewed: https://review.openstack.org/290148
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=0f7f1de233919a0b046349a3e31ae7fc8675a1c5
Submitter: Jenkins
Branch: feature/hummingbird
commit d6b4587a554b51ba733b151e0d924735b63d07e0
Author: Olga Saprycheva <osapryc@us.ibm.com>
Date: Tue Mar 8 10:57:56 2016 -0600
Removed redundant file for flake8 check
Change-Id: I4322978aa20ee731391f7709bbd79dee140fc703
commit 643dbce134140530eef2ae62c42fef1107f905ed
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue Mar 8 06:35:49 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I96b8ff1287bf219c5f8d56a3a4868c1063a953f9
commit 83713d37f0331c5ce9d377f4b4e8724551ae30ca
Author: Daisuke Morita <morita.daisuke@ntti3.com>
Date: Mon Mar 7 18:30:47 2016 -0800
Missing comments for storage policy parameter
There are missing comments about storege\_policy\_index so appropriate
comments are added.
Change-Id: I3de3f0e6864e65918ca1a13cce70f19c23d295f5
commit 2cff2dec3d1c4588f5103e39679c43b3dded6dcb
Author: Olga Saprycheva <osapryc@us.ibm.com>
Date: Fri Mar 4 15:19:39 2016 -0600
Fixed pep8 and flake8 errors in doc/source/conf.py and updated flake8 commands in tox.ini to test it.
Change-Id: I2add370e4cfb55d1388e3a8b41f688a7f3f2c621
commit 043fbca6d08648baa314ea2236f1ccdca8785f16
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri Mar 4 09:33:17 2016 +0000
Remove Erasure Coding beta status from docs
This removes notes stating support for Erasure coding as beta. Questions
regarding the stability of EC are coming up regularly, and are often referring
to the docs that state EC as still in beta.
Besides this, a note marking statsd support as beta has been removed as well.
Change-Id: If4fb6a5c4cb741d42953db3cee8cb17a1d774e15
commit 09c73b86e9255f28fbd4cf571a52c17d549a8f9a
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Thu Mar 3 10:24:28 2016 -0700
Fix a crash in exception printout
Says the number of arguments does not match the number of '%'.
Change-Id: I8b5e395a07328fb9d4ac7a19f8ed2ae1637bee3b
commit fad5fabe0a22e8a86635a66523dd3d3d3b1fa705
Author: Tim Burke <tim.burke@gmail.com>
Date: Thu Mar 3 15:07:08 2016 +0000
During functional tests, 404 response to a DELETE is successful
Previously, we would only consider 204 responses successful, which would
cause some spurious gate failures, such as
http://logs.openstack.org/66/287666/3/check/gate-swift-dsvm-functional/c6d2673/console.html#\_2016-03-03\_13\_41\_07\_846
Change-Id: Ic8c300647924352a297a2781b50064f7657038b4
commit e91de49d6864b3794f8dc5acd9c1bf0c2f7409d1
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Aug 10 10:30:10 2015 -0500
Update container on fast-POST
This patch makes a number of changes to enable content-type
metadata to be updated when using the fast-POST mode of
operation, as proposed in the associated spec [1].
\* the object server and diskfile are modified to allow
content-type to be updated by a POST and the updated value
to be stored in .meta files.
\* the object server accepts PUTs and DELETEs with older
timestamps than existing .meta files. This is to be
consistent with replication that will leave a later .meta
file in place when replicating a .data file.
\* the diskfile interface is modified to provide accessor
methods for the content-type and its timestamp.
\* the naming of .meta files is modified to encode two
timestamps when the .meta file contains a content-type value
that was set prior to the latest metadata update; this
enables consistency to be achieved when rsync is used for
replication.
\* ssync is modified to sync meta files when content-type
differs between local and remote copies of objects.
\* the object server issues container updates when handling
POST requests, notifying the container server of the current
immutable metadata (etag, size, hash, swift\_bytes),
content-type with their respective timestamps, and the
mutable metadata timestamp.
\* the container server maintains the most recently reported
values for immutable metadata, content-type and mutable
metadata, each with their respective timestamps, in a single
db row.
\* new probe tests verify that replication achieves eventual
consistency of containers and objects after discrete updates
to content-type and mutable metadata, and that container-sync
sync's objects after fast-post updates.
[1] spec change-id: I60688efc3df692d3a39557114dca8c5490f7837e
Change-Id: Ia597cd460bb5fd40aa92e886e3e18a7542603d01
commit 3c61ab4678a7aa9ff256ace4bc97ab449607fd49
Author: asettle <alexandra.settle@rackspace.com>
Date: Wed Feb 10 17:58:05 2016 +1000
Operational procedures guide
This is the operational procedures guide that HPE used
to operate and monitor their public Swift systems.
It has been made publicly available.
Change-Id: Iefb484893056d28beb69265d99ba30c3c84add2b
commit 8e4347afd59aa30708ef03a78202652aaadda2e9
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Tue Nov 17 16:15:59 2015 +0900
Fix proxy-server's support for chunked transferring in GET object
Proxy-server now requires Content-Length in the response header
when getting object and does not support chunked transferring with
"Transfer-Encoding: chunked"
This doesn't matter in normal swift, but prohibits us from putting
any middelwares to execute something like streaming processing of
objects, which can't calculate the length of their response body
before they start to send their response.
Change-Id: I60fc6c86338d734e39b7e5f1e48a2647995045ef
commit 9dda1c9526c5b3e0ac905985921605d833bef3cc
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Fri Dec 25 10:30:01 2015 +0900
Update parameters about authtoken middleware in proxy-server.conf.sample
This patch replaces some configration parameters about authtoken
middleware in proxy-server.conf, which will be deprecated.
The following parameters are to be deprecated.
auth\_admin\_prefix, auth\_host, auth\_port, auth\_protocol,
identity\_uri, admin\_token, admin\_user, admin\_password,
admin\_tenant\_name
Change-Id: I373734933189c87c4094203b0752dd3762689034
commit 087fa4fa01fc36343f2ce0974d3b36ec0b98afc8
Author: Andreas Jaeger <aj@suse.com>
Date: Mon Feb 29 20:00:38 2016 +0100
Remove unused pngmath Sphinx extension
There's no RST file that uses ".. math" and thus
the pngmath Sphinx extension is not used and can
get removed.
Change-Id: I3ea4b529025c8ac3c4092f3720124647861e6668
commit 9c5b01e7c7699fbfd221e98ccde1afa9361c8119
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Wed Dec 9 08:08:22 2015 +0000
Add container quota functional test
This patch provides one container quota functional test.
Change-Id: I16354c15fc434d70f9bb6b9b1e18b09357195c83
commit efdc6ee8dbc434e9189a6b85b924c322c3ff6ae3
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Thu Dec 10 01:15:30 2015 +0000
Add X-Delete-After and X-Delete-At functional test
This patch provides functional tests for X-Delete-After and X-Delete-At.
Change-Id: I55b0d0584428413aa7a31f66defec55f9b1bbcd9
commit bd93d44bb46350f716f1dfb66fb43c2ab4ad8c50
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Sun Feb 28 13:41:19 2016 +0900
Make sure all temp files get deleted in test\_ringbuilder
This patch makes test\_ringbuilder create a temporal directory,
run ring builder commands under it, and delete it after testing
for each test cases, to fix temp file leaking.
Change-Id: I6f59fe095ea6485af0e60b5a8e8fc3892e0a0f90
commit 10b5765c60790f8a3ae2a94d6a51736ec2c99ce0
Author: benjkeller <bjkeller@us.ibm.com>
Date: Thu Feb 25 18:54:00 2016 -0600
Rename test\_object\_delete\_at\_aysnc
This renames test\_object\_delete\_at\_aysnc to
test\_object\_delete\_at\_async to match with the function
async\_update which it tests.
Change-Id: I726afcbf08a3449c7af2834e573b97be378a86cd
Closes-Bug: 1550067
commit 9e53bb47efa28983109da8ceca5d316925bc6804
Author: John Dickinson <me@not.mn>
Date: Wed Feb 24 09:36:40 2016 -0800
updated some weird whitespace character to a normal one
Change-Id: I187fb8fc8d10f950bbebc586999eced0bc117432
commit 54e53ae87b6e87229dc77cb7c814ab9733ea7013
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Feb 19 09:30:10 2016 +0000
Silence SkipTest noise in in-process test teardown
setup\_package and teardown\_package get called twice when
running functional tests using nose. With in-process mode
the first call to teardown\_package clears global config
which causes the test swiftclient to raise a SkipTest error
during the second call to teardown\_package.
To reproduce:
SWIFT\_TEST\_IN\_PROCESS=1 nosetests ./test/functional/test\_account.py
This patch simply tests for config existence before attempting
to create a test swiftclient in the teardown\_package function.
Also fix a related issue whereby in\_process flag would be reset to
False during second call to setup\_package, thus causing some of the
in process cleanup in teardown\_package to never be executed.
Change-Id: I074dcd3d39aa46b262632024b047556ca471e8b8
commit 076134784b4eb1c2e55b28218dc0d64a57795d63
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Feb 23 17:28:08 2016 -0800
Add warn method back to LogAdapter
The change in 684c4c04 to improve py3 support breaks older middleware
that consumes the SwiftLogger.
Good for Swift code to not to use warn because it's deprecated.
Bad for LogAdapter to not faithfully provide the current python logging
module API (deprecated or otherwise).
Change-Id: Ib0baf66b7f33f91562867076ff0526a287d8e5a6
commit eb7ca115e6501edd9225dce8784b8b3d3e094bb1
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Feb 23 14:00:34 2016 -0800
Fix StatsD tests to not use real DNS
In common/test\_utils.py, TestStatsdLogging had the majority of its
test cases calling the real socket.getaddrinfo(), which uses real
DNS. This is very slightly slower than using a mock getaddrinfo() when
the machine running the tests has functioning DNS, but on a machine
with no network connection at all, the tests are excruciatingly slow
due to timeouts.
This commit mocks things out as appropriate. There's still one user of
the real getaddrinfo(), but it's for ::1, so that's just local
resolution based on /etc/hosts.
Timing numbers for "./.unittests test.unit.common.test\_utils:TestStatsdLogging":
\* network, without this patch: 1.8s
\* no network, without this patch: 221.2s (ouch)
\* network, with this patch: 1.1s
\* no network, with this patch: 1.1s
Change-Id: I1a2d6f24fc9bb928894fb1fd8383516250e29e0c
commit b97adf70ade2982fea5354c55f1eea9f98442fa7
Author: Thiago da Silva <thiago@redhat.com>
Date: Tue Feb 23 16:23:51 2016 -0500
fix formatting of bulk operations doc
Change-Id: I247d2867c55d6bbf2288dfb74271f57c6f88b243
commit cfd50212358372694ba0713ff8c3bc313c6f1a92
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Feb 18 21:06:40 2016 -0800
dry out container unittests
Change Ifcc4392ffa4df485ce3c62a35d0fcc8c93de74aa introduced
TestContainerController4Replicas as a subclass of
TestContainerController. And there is duplicated code
block to override setUp method.
This patch removed the duplicated code block.
Change-Id: Iad0b64cba52554b89dbd959475a2ce7c0d9a20eb
commit 406e8996fb288e9851e02c3f3faa536a9919b28f
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Mon Feb 22 16:10:09 2016 +0900
Use 201 insted of 200 in PUT test case
There are some unit test cases which assumes 200 as the response
of PUT request, but 200 is never returned in PUT.
This patch replaces 200 in PUT by 201, and adapt unit test cases
to real case.
Change-Id: I35fc7a4fe7fcc5558a9e6c6371105793c2710f3e
commit 5b18455cef57d052df3cda3e9179c923d3aadcad
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Jan 22 07:06:45 2016 +0000
Add unit tests for checking responses in ContainerController
This patch provides unit tests to check responses for various situation
in three/four replicas env.
Change-Id: Ifcc4392ffa4df485ce3c62a35d0fcc8c93de74aa
commit 002513d21786df0d6c71e9772ec4688e2c14d8de
Author: Tim Burke <tim.burke@gmail.com>
Date: Thu Jan 7 11:56:33 2016 -0800
Make write-only container access consistent
Previously, if a user could write to (but not read from) a container,
the behavior for object POST would vary depending on whether
object\_post\_as\_copy was enabled (403 response) or disabled (202
response).
Now, POSTs will consistently be allowed, regardless of whether fast-POST
is enabled.
Change-Id: I1d6dcbc4f5034a322a1073850fc3b059ebb1c0fa
commit 9a6c6b55713f896609b7127560ae99fabbf759e7
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Thu Feb 18 17:38:42 2016 +0100
Fixed log format in object auditor
Change-Id: I218e08446c5ffda2db7c774ec8bb9d28ce9f63e7
commit 2d55960a221c9934680053873bf1355c4690bb19
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Thu Jan 14 18:31:21 2016 +0000
Fix inconsistent suffix hashes after ssync of tombstone
Consider two replicas of the same object whose ondisk files
have diverged due to failures:
A has t2.ts
B has t1.data, t4.meta
(The DELETE at t2 did not make it to B. The POST at t4 was
rejected by A.)
After ssync replication the two ondisk file sets will not be
consistent:
A has t2.ts (ssync cannot POST t4.meta to this node)
B has t2.ts, t4.meta (ssync should not delete t4.meta,
there may be a t3.data somewhere)
Consequenty the two nodes will report different hashes for the
object's suffix, and replication will repeat, always with the
inconsistent outcome. This scenario is reproduced by the probe
test added in this patch.
(Note that rsync replication does result in (t2.ts, t4.meta)
on both nodes.)
The solution is to change the way that suffix hashes are
calculated. Currently the names of \*all\* files found in each
object dir are added to the hash. With this patch the
timestamps of only those files that could be used to
construct a valid diskfile are added to the hash. File
extensions are appended to the timestamp so that in most
'normal' situations the result of the hashing is the same
as before this patch. That avoids a storm of hash mismatches
when this patch is deployed in an existing cluster.
In the problem case described above, t4.meta is no longer
added to the hash, since it is not useful for constructing
a diskfile. (Note that t4.meta is not deleted because it
may become useful should a t3.data be replicated in future).
Closes-Bug: 1534276
Change-Id: I99e88b8d5f5d9bc22b42112a99634ba942415e05
commit ddeb0cde9fc828fa79dce90df4975f66737ba054
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Wed Feb 17 21:17:34 2016 -0800
Fix object-server to handle newer ts file
Swift object-server will return 409 Conflict when the incomming
request X-Timestamp is older than the local disk file to prevent
wasted data transfer and disk space consumption. However, IFF,
the local disk file is a tombstone, current object-server will
write the data in the device and cleanup it according to timestamp
comparison result in hash\_cleanup\_list\_dir, and then return 201
Created. That's wasted and far from the semantics in the normal case.
This patch fixes object-server to catch the DiskFileDeleted exception
at PUT request, and then, set the timestamp from tombstone as
original\_timestamp to be able to compare with request timestamp.
Co-Authored-By: Kazuhiro Miyahara <miyahara.kazuhiro@lab.ntt.co.jp>
Change-Id: I078c9cb90707a3c320708e76ea42cbfa73e1ea4b
Closes-Bug: #1546865
commit 878688cae00576ec0bdb0a66eca7ada95e661c0a
Author: Béla Vancsics <vancsics@inf.u-szeged.hu>
Date: Mon Dec 7 17:02:40 2015 +0100
Reduce code duplication
Reduced source code by extracting duplicated code
(swift/common/direct\_client.py)
http://openqa.sed.hu/dashboard/index/5?did=1
Change-Id: I47fa6ae12c646e8e42fb0a46a017971f05d883fc
Closes-Bug: 1536067
commit c3201f256cf415988a3cb1c42e9c6b7835195fa3
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Fri Jan 8 18:03:33 2016 +0900
Remove execute permissions from doc files and swift.conf-sample
Some doc files and swift.conf-sample were added execute permissions in past changes.
This patch remove execute permissions from them.
Change-Id: Id8844989a8321578e9207566ebd6660f5b9523f0
commit e46d6b17251ab538595b1deb5581360a286b8fd1
Author: Christian Schwede <cschwede@redhat.com>
Date: Wed Feb 17 20:47:26 2016 +0100
Add note on using printable chars for swift\_hash\_path\_suffix/prefix
Using unprintable characters for swift\_hash\_path\_prefix/suffix might lead to
hard problems when parsing of these values changes, for example due to newer
Python versions or changes in the parsers itself. Let's avoid this and add a
note that deployers should use printable strings for these values.
Change-Id: I976982b753b6af831ab91d7190f50f8f15bf73bf
commit b8fa48080812ab0f6bac7ae19c0290da08f6a6e4
Author: Donagh McCabe <donagh.mccabe@hp.com>
Date: Thu Feb 4 16:19:13 2016 +0000
Added links to API reference and usage guides
Added a link to the API reference (where headers and query
strings are documented; click the "detail" button to see).
Also added a reference to Swift section of the OpenStack end
user guide. This contains some additional details about the API.
No attempt was made to reconcile duplicate information. Instead
this patch links documents that might otherwise be overlooked.
However, I fixed text, originally in a table, that had become
garbled in a prior patch.
Change-Id: I0910cbeb0c8bffc00e510f35585603e7b7a67790
commit aa7204d106ae33eba9219514f31f008510c9db53
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Fri Feb 12 20:48:34 2016 +0900
Remove '#! /usr/bin/env python' from unexecutable files
'cli/recon.py' and 'cli/ring\_builder\_analyzer.py' have '#! /usr/bin/env
python' in spite of they don't have execute permissions. This patch
removes '#! /usr/bin/env python' from them.
Change-Id: I1917ccc84b1673af3d862be1796f54595f94c5ca
commit db87a5a9889d436f2e2aacdc8923d55ca0d3d1ca
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Feb 16 10:52:01 2016 -0800
Mock sleep in direct\_client retry tests
... and fixup some assertions, and other mocks
Change-Id: Iadf839d1d3d735109fed24049fc3d829776b7b65
commit 8eb30afd7c39f6e6ba031f72c6a61f45b28d37f6
Author: Tim Burke <tim.burke@gmail.com>
Date: Tue Feb 16 10:25:39 2016 -0800
Static methods should be @staticmethods
Change-Id: Ifee5d68e00bbb3571aaac885cdd7490c79732985
commit 4a44e27e00795c5f12176ef346cd2249fca54fd8
Author: Chaozhe.Chen <chaozhe.chen@easystack.cn>
Date: Tue Feb 16 23:44:27 2016 +0800
Replace assertEqual(None, \*) with assertIsNone in tests
As swift no longer supports Python 2.6, replace assertEqual(None, \*)
with assertIsNone in tests to have more clear messages in case of
failure.
Change-Id: I94af3e8156ef40465d4f7a2cb79fb99fc7bbda56
Closes-Bug: #1280522
commit 42f4b3fc1e69a046c1e70e73afe847e4423fa2da
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Feb 16 10:08:55 2016 +0000
Add SwiftHLM to associated projects
Change-Id: I5ea3de34e61f22abec803b35fec8adde18a793e9
commit 025ebf2901d5a972796b73538bb306847d7d06b6
Author: Ankur Gupta <ankur.gupta@intel.com>
Date: Wed Feb 10 14:36:16 2016 -0600
Docstring omission in class BaseDiskFileManager.
Added documentation for missing Docstring variables.
Change-Id: I29a53b8141c5607815f234a6123e2289200bca34
commit 4906b4c431edc436f165b163a228b0a221950c79
Author: Janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jan 12 12:50:43 2016 +0530
Fix missing txn\_id logs in GreenAsyncPile's spawned functions
This commit ensures that the logger thread\_locals
value is passed to and set in \_get\_conn\_response methods
executed in a green thread.
Added partial bug tag because in bug description a more
relevant fix is suggested which would fix the bug completely
but for now this makes sense to add this commit for logging.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I13bbf174fdca89318d69bb0674ed23dc9ec25b9a
Partial-Bug: #1409302
commit 511a1b8698889c430bf673ed916ae41a96b99c5c
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Fri Feb 12 19:01:59 2016 +0900
Remove execute permission from swift/cli/ringbuilder.py
In Change-Id: Ia63f59a8faca1fad990784f27532ca07a2125454,
'bin/swift-ring-builder' is renamed to 'swift/cli/ringbuilder.py'.
However, execute permission and '#! /usr/bin/env python' are left on
the file.
This patch removes execute permission and '#! /usr/bin/env python'
from the file.
Change-Id: I66370f825ce9ed9a40ec21f2745aa6aff22c8709
commit 973d9358d2e6e029409d1902831b4680e02952c9
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Thu Feb 11 10:20:10 2016 +0100
Bump PyECLib requirement to >= 1.2.0
This was discussed at last Swift meeting [1] and conclusion was
to require newest PyECLib version.
[1] http://eavesdrop.openstack.org/meetings/swift/2016/swift.2016-02-10-21.00.log.html#l-268
Depends-On: I0fd58f26bc0a3e7715356ff74344981f22786152
Change-Id: I54e89d99b48e00e614d2d457814c00354763c83b
commit d3dd137cad896c7f741592e88f076acab2636a3c
Author: Tomas Matlocha <tomas.matlocha@firma.seznam.cz>
Date: Tue Jan 5 12:32:50 2016 +0100
Additional info log message for drive-audit
An additional info log message was added for case of
running drive-audit without failed device unmounting.
Change-Id: I11abee40a712b6c6de65e63626b6f7f0a9c9f4c7
commit c4158bd674f34c8a0648c98974ba474fcd1c2b7a
Author: Sarafraj Singh <Sarafraj.Singh@intel.com>
Date: Thu Feb 11 20:52:47 2016 +0000
Fixed params on autocreate\_account docstring
... in proxy.controllers.base
Change-Id: Ic5c27cbf0f19b65fcaa3e6587583f03e56d646a0
commit f56d18e143d0a38584e4c383ea9afe46e67a0af6
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Feb 11 10:59:43 2016 -0800
Fix typos in comments
Change-Id: I4f98d447bd2ddd8eeb2f4da66d069bd7d6f00dc6
commit cc8dc88b55b44ca2a1fd65c049f3cfec22eb5525
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Thu Feb 4 16:02:42 2016 +0100
Script for checking sanity of manpages
Change-Id: Ia27b0ecf6a3267eb51f8a6562721dca72f128915
commit bcada66b9065c94cd39498a5330c727cc575a6fe
Author: root <lr699s@att.com>
Date: Wed Feb 10 09:21:53 2016 -0600
Removed unused parameter in server.py
The variable max\_large\_object\_get\_time is no longer used and was
removed to reflect the change.
Change-Id: I43051181dcb38245de6d13fab63876e83f46fc39
Closes-Bug: #1538834
commit b5311f63dbf5787bda3495a58c8ef7a6a557daa4
Author: gh159m <gh159m@att.com>
Date: Wed Feb 10 10:36:59 2016 -0600
Removed default value for log\_statsd\_host
Multiple files and documents showed that log\_statsd\_host had
a default value, usually localhost. This was incorrect, instead
setting a value for log\_statsd\_host enables statsd logging.
Removed any reference of log\_statsd\_host having a default value.
Also changed descriptions to show setting a value enables logging.
Change-Id: I3ca5c0e8b8e4981de3aa6db0c476072b5a59723d
Closes-Bug: #1542227
commit b98c1c60f9c581c76677c19baae60ae720e3c7f3
Author: Christian Berendt <berendt@b1-systems.de>
Date: Tue Feb 9 07:32:48 2016 +0100
Remove executable flag from sample config file
swift.conf-sample should not be executbale
Change-Id: I960058e2af10b43efc6324a7534d9a23c810e39a
commit 81a4355c2d0907035805c300a9fa5aaa6d0e70c4
Author: Christopher Bartz <bartz@dkrz.de>
Date: Fri Feb 5 09:51:11 2016 +0100
Adds storage policy option to recon
With this patch, recon gets policy-aware in regard to the hosts to retrieve.
If no policy is passed and the server\_type is object,
all hosts of all policies are retrieved.
Previously, recon did only retrieve the hosts of the storage-policy 0.
Change-Id: If5735cd6721eac504aed8aaf3884cb91b6a0fcac
Closes-Bug: 1541491
commit 87fc21c7cfcce2a3e23a84fddcfd1309cd884716
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Mon Feb 8 15:31:42 2016 +0000
Speed up functional testing
test/functional/tests.py:TestObjectVersioningUTF8 does not clean
up the versions files it creates because the class's multiple
inheritance is such that it does not call the tearDown method in
TestObjectVersioning.
As a result, any attempt to clean up account containers wastes
time retrying container delete requests. This occurs either in
the setUp for TestSloEnv, if the TestSlo class is included in a
test run, or in the tests.py package tearDown method.
On the author's dev machine this patch reduces the execution
time of functional tests in tests.py by approx 30% or 1 minute.
Change-Id: I8194672bf2ca82435df5868720b6a55a79b94413
commit 3b94bd45406f9d457d37caa10c856a19c4cec22a
Author: Mingyu Li <li.mingyu@99cloud.net>
Date: Sun Feb 7 21:41:08 2016 +0800
Keep the Usage of exit()/sys.exit() Consistent
It's better to keep the usage of exit()/sys.exit() consistent
in one file. Furthermore, sys.exit() is considered good to be
used in production code, while exit is for interactive shell.
Change-Id: Ia3092853a648922588e2bc11db37d6decdec1b48
commit f05da4c8fa37a285bb2ca9b45a355dbe57f7add4
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Feb 6 16:59:57 2016 +0530
Changing the base version to python2.7 for pep8 checks
tox was taking python3 as it's base version which lead to
tox pep8 check failing on local env:
http://paste.openstack.org/show/486183/
Change-Id: Ia822ec5b5e12a1fc30b676f1e6d95e287b9b3368
commit 13edc9a865cd203ddf28a3f782426a1b3b94f7a1
Author: Sarafraj Singh <Sarafraj.Singh@intel.com>
Date: Fri Feb 5 17:28:26 2016 +0000
Improved test coverage of form\_signature
Added four new test cases to execute path of invalid arguments. This
improved test coverage of file specified from 80% to 91%.
Change-Id: I63c2e7bab3f01121301d78b687687208a58401c0
commit b173995666b026def3f6558d9a8c972b75449323
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Thu Feb 4 05:18:42 2016 -0800
Fix missing Accept-Ranges
Since commit 4f2ed8bcd0468f3b69d5fded274d8d6b02ac3d10, the response
header for GET EC object doesn't include the Accept-Ranges header.
This patch fixes it and also adds a few unittests to prevent regression.
Closes-Bug: #1542168
Change-Id: Ibafe56ac87b14bc0028953e620a653cd68dd3f84
commit d78e861d850db96989f4fb77ad31e3170034f15d
Author: Richard Hawkins <richard.hawkins@rackspace.com>
Date: Wed Jan 13 13:15:07 2016 -0600
Add option for label to static web listings
By default listings are rendered with a label of:
"Listing of /v1/account/container/path"
This change adds a new custom metadata key/value pair
"X-Container-Meta-Web-Listings-Label: <label>" that
when set, will cause the following:
"Listing of <label>/path" to be rendered instead.
Change-Id: I47c5d21834f47e566b380920196926882ff83abf
commit ae632abbd802228ef98a23c98ee49988e7e5b942
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Feb 2 21:58:52 2016 +0100
Fixed manpages errors.
account-server.conf.5
105: warning: numeric expression expected (got `)')
container-server.conf.5
111: warning: numeric expression expected (got `)')
object-expirer.conf.5
79: warning: numeric expression expected (got `)')
object-server.conf.5
114: warning: numeric expression expected (got `)')
proxy-server.conf.5
121: warning: numeric expression expected (got `)')
331: warning: numeric expression expected (got `[')
1005: warning: macro `\*' not defined
Change-Id: I203dcfde83035e3b1dcb91109b72b5d08bb7840e
commit f2fca9aafa17e45b668c6f76b256927681cc463a
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Tue Feb 2 11:43:44 2016 +0000
Fix time-shifting of objects PUT with container-sync
When container-sync PUTs an object to a destination container
it uses the timestamp from the container row rather than the
actual timestamp of the object being copied. The actual timestamp
of the object can be newer, so the sync'd object may end up with
the right content but at the wrong, older, timestamp.
This patch changes the timestamp sent with the sync'd object
to be that of the actual source object being sent.
Drive-by fix to make code more readable by removing a variable
rename mid-function, fix a typo and remove a redundant function
call.
Change-Id: I800e6de4cdeea289864414980a96f5929281da04
Closes-Bug: #1540884
commit 050e3b35dd88f7b31b6810d9ac88548ef371e3ce
Author: venkatamahesh <venkatamaheshkotha@gmail.com>
Date: Thu Feb 4 16:47:15 2016 +0530
Use uppercase 'S' in word "OpenStack"
Change-Id: I4692aa58b5173b1b662d5eee19fac770ae5aaed0
commit e47aaaacf15e8f0c7226400541a97238447a7f56
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Feb 3 12:52:29 2016 -0800
Stop nesting functions unnecessarily
Change-Id: Iff120d0bac8a075c37bbddcd2bb0fe85145f1749
commit 26327e1e8b1d37faa764ec586f5bee0e1560eea2
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu Jan 21 11:18:18 2016 -0800
Allow IPv6 addresses/hostnames in StatsD target
The log\_statsd\_host value can now be an IPv6 address or a hostname
which only resolves to an IPv6 address. In both cases, the new
behavior is to use an AF\_INET6 socket on which .sendto() is called
with the originally-configured hostname (or IP). This means the
Swift process is not caching a DNS resolution for the lifetime of
the process (a good thing).
If a hostname resolves to both an IPv6 or IPv4 address, an AF\_INET
socket is used (i.e. only the IPv4 address will receive the UDP
packet).
The old behavior is preserved: any invalid IP address literals and
failures in DNS resolution or actual StatsD packet sending do not
halt the process or bubble up; they are caught, logged, and
otherwise ignored.
Change-Id: Ibddddcf140e2e69b08edf3feed3e9a5fa17307cf
commit 2f8e6040470948cf17c5fc5fddd0991a415d2a4c
Author: Eran Rom <eranr@il.ibm.com>
Date: Wed Feb 3 08:59:53 2016 +0200
Fixing typo in unit test
The typo does not influence the correctness of the test
yet its ugly. bhhha.
Change-Id: I62e511bae23523892b87309dd3c50aea61742f2d
commit f27ad34e1d4e5dc306eed3ff620a294a4c301f31
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Feb 2 11:44:39 2016 -0800
Document use-case for slow option
Change-Id: Iec4087a896a2277179e3720d802cca101fa7ad54
commit 16976a0f14ee2b5f7abc76086f9abfb9f337a655
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Jan 31 10:30:06 2016 +0100
Changed EC backend from jerasure to liberasurecode in examples and docs
liberasurecode\_rs\_vand is build-in liberasurecode, so you don't need
another depedency libjerasure2.
liberasurecode\_rs\_vand is supported by pyeclib from 1.0.8
version, so bumping version up.
Closes-Bug: #1534325
Change-Id: If2d96875694df8fd48c5278395859aaa165cb566
commit 30d74af6534b754e6ad9bfdcbff4ec494277ca83
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 27 13:50:57 2016 +0000
Insert versioned\_writes in correct pipeline position
If not explicitly configured the versioned\_writes middleware
should be auto-inserted in the pipeline after slo and dlo, which
is where the versioned\_writes filter section's comments say it
should be in proxy-server.conf-sample. At the moment it can end up
being placed ahead of slo and dlo if they have been explicitly
configured, which results in the linked bug manifesting.
Closes-Bug: #1537042
Change-Id: I6ac95a331f4ef0d4887311940acc6f8bc00fb4eb
commit ccdf4a9f309af5fe1401a6e4b776b08c3f6a655c
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Feb 2 09:38:55 2016 +0100
Document slow option in etc/object-server.conf
Change-Id: Ic9940b0b830a468887878f7b0d7ca42c2cbbebd5
commit b19dc1ddecdc68760ca2f5a2b7b4bbdce2199b35
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Feb 1 15:30:59 2016 -0800
Always fix devices with multiple part-replica assignments
I've found that given a sufficiently bad replica2part2dev table we can
accidently not entirely fix palcement when more than two replicas of a
part are assigned to the duplicate devices.
It shows up most on > 3 replica rings when you have two \*different\*
devices both holding two replicas. But you can see it on a three
replica ring when all three replicas are assigned to the same device.
Change-Id: Ieb213c1a259815a2ed657291242919cda568c7b5
commit c722fa1ab318b233fc11f8e1bd8758dbe33e87bb
Author: dangming <dangming@unitedstack.com>
Date: Mon Feb 1 16:13:54 2016 +0800
Fix spelling error
Change-Id: I4a1400c4d383acd59727ada3661a8dffc67825fb
commit c7e5e125003de1a0f288f79783e9a41650e6f686
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Jan 29 14:22:19 2016 +0000
Enable in-process func tests to optionally use fast-post
Running functional tests in the in-process mode uses
the default value for proxy-server object\_post\_as\_copy,
which is True. This patch adds support for an environment
variable to change this value to False so that the fast-post
mode is tested when running in-process functional tests.
The patch also adds a new tox environment func-in-process-fast-post
which forces in-process functional testing with
object\_post\_as\_copy=False.
The motivation for this change, apart from enabling configurable
local testing, is to put support in place for an upstream CI job
that will actually functionally test the fast-post mode, which is
otherwise only covered by unit tests.
There are currently two gate jobs that run the functional tests:
- gate-swift-dsvm-functional runs the tests \*twice\* against a
devstack swift service, once using tempauth and once using
keystoneauth. The devstack swift service uses the default
object\_post\_as\_copy=True.
- gate-swift-tox-func runs the func tests in in-process mode
which also uses tempauth and object\_post\_as\_copy=True. This
duplicates one of the config scenarios above.
With this change either the gate-swift-tox-func job or a new job
could run the functional tests using object\_post\_as\_copy=False.
Change-Id: Ia37f6df1dc38e44ef7404fbf0a52f6fc22fae0c2
commit 4ba290bac19b1b6e8f709848fd35cda33b8bd1c4
Author: Qiaowei Ren <qiaowei.ren@intel.com>
Date: Mon Feb 1 16:44:52 2016 +0800
Replace exit() by sys.exit()
sys.exit() is considered good to use here.
Change-Id: I365b0dbb50c8f1953b41665ba49145ac6db1b24f
commit 9aff76bd18e609eb657db14f2d60e605ee28d472
Author: Qiaowei Ren <qiaowei.ren@intel.com>
Date: Mon Feb 1 17:15:32 2016 +0800
fix typo
informations -> information
Change-Id: I6bcb9bb9fd24b873b49de4a686b223550dd703ac
commit a8e0dc550bf35010595ce791433cd68c4b8d5287
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Sun Jan 31 06:15:17 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: If1cd20e187720f5ee02c6a1574f612c8a8e26e30
commit 02c06585e6e0403d1a983fccaba5093e3d3fa7c5
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Fri Jan 29 22:46:50 2016 +0100
Renamed variable for better code readability
Change-Id: I22d8db0dd9edc39672fc9997895a24f669975e15
commit 595ec464e3fdc5a766eee9baa06edd074576c73e
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Jan 29 15:28:56 2016 +0000
Trivial fix for sphinx warnings
Including a \* in the param name causes a sphinx warning,
messes up the html formatting, and strictly the \* isn't part of
the param name.
Change-Id: I6be6a7aa2a371eaae9f8e501435838c1e15f4a1c
commit cc90834a8ed7bd84440bf132a94978a47ee2f3da
Author: Mingyu Li <li.mingyu@99cloud.net>
Date: Fri Jan 29 03:48:47 2016 +0900
A minor modification of the Deployment Guide
In the section of General Service Tuning, there is a sentence
"Our Storage servers all run together on the same servers".
The word "servers" is used twice with different meanings, which
would be a little confusing. This patch makes it more understandable.
Change-Id: I6d806456aeb7d0ecf297c04dacbd271b94a0425c
Closes-Bug: #1526697
commit a1776b9c1f23fbd604114b377434e4269d2f1a2e
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Thu Jan 28 16:47:37 2016 +0000
Let equal Timestamps not be unequal
Make the result of Timestamp(x) != Timestamp(x) be False.
In python 2.7 this requires the \_\_ne\_\_ method to be defined [1].
"The truth of x==y does not imply that x!=y is false." The
functools.total\_ordering decorator does not autocreate a \_\_ne\_\_
method.
In python 3 the \_\_ne\_\_ method is not required [2]. "By default,
\_\_ne\_\_() delegates to \_\_eq\_\_() and inverts the result".
This patch puts back the \_\_ne\_\_ method removed in [3]. Whilst no tests
fail on master with python2.7, they do on this patch [4] and it seems
dangerous to have this absurd behaviour lurking.
[1] https://docs.python.org/2/reference/datamodel.html#object.\_\_ne\_\_
[2] https://docs.python.org/3.4/reference/datamodel.html#object.\_\_ne\_\_
[3] Change-Id: Id26777ac2c780316ff10ef7d954c48cc1fd480b5
[4] Change-Id: Ia597cd460bb5fd40aa92e886e3e18a7542603d01
Change-Id: I01fbfa310df3c74390f8e8c2e9ffff81bbf05e47
commit c3886eea15f11104764fb201e85202dd871c3027
Author: Thomas Goirand <thomas@goirand.fr>
Date: Thu Jan 28 09:15:28 2016 +0000
Fix a few English mistakes in man
These errors are producing lintian warnings, so fixing them
helps having less errors when checking for Debian packages.
Change-Id: Iff99a8d5f2276515f42d758d110a43cae757db28
commit 400cc707273bab0b70a3cdf5dec1c55c2edc4e22
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 27 15:35:40 2016 +0000
Remove a print statement from tests
Change-Id: I213b7e4bc4f9e6de76ebab572c377af61072d9c5
commit c871e423ef0bed6c774693af3d54750235d6ce1f
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Jan 22 05:19:06 2016 +0000
Add unit tests for checking responses in AccountController
This patch provides unit tests to check responses for various situation
in three/four replicas env.
Change-Id: I1af48728b28da9780a2a78f3110e1c7487047ff8
commit e45d30d6b7b596b80c63e75018ad07582d705ee1
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 27 10:18:37 2016 +0000
Remove unnecessary code from test\_account.py
Change-Id: Ia197ba08a606421244d5b94a900bdc39bc5da647
commit f39cffbb5f7f1853f7f67261c4652b9875d302be
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Jan 26 20:16:08 2016 -0800
Follow up mem\_server diskfile fixes
This is a follow-up patch for change
https://review.openstack.org/#/c/270422
That patch fixes POST behavior on object mem server and adds
some tests for last-modified. However, that one doesn't check
the POST updates the last-modified on object server.
This patch adds assertions to make sure the actual POST semantics.
\*bonus\* Add docs and cleanup variable name to fit actual instance
at mem diskfile.
Change-Id: I78185cdfb0ea604b2122821870ec34322236f48d
commit 9ef15453fadb847db0f0fb92e935785b544da3fc
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Thu Jan 21 14:18:31 2016 +0900
Fix handling of "Permission Denied" error from NamedTemporaryFile function
If "Permission Denied" has happen in NamedTemporaryFile function in
dump\_recon\_cache method, swift will log a message of reference to a variable
without assignment and not log a message of "Permission Denied".
This patch fixes the handling and add an unit test.
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Iafdd94905e9e9c81f5966a923324b50c18fcf592
commit 01410129dac6903ce7f486997a48e36072fa0401
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Aug 21 18:15:25 2015 -0700
Make handoffs\_first a more useful "mode"
Based on experience using handoffs\_first and feedback from other
operators it has become clear that handoffs\_first is only used during
periods of problematic cluster behavior (e.g. full disks) when
replication attempts are failing to quickly drain off the partitions
from the nodes which they have been rebalanced from.
In order to focus on the most important work (getting handoff partitions
off the node) handoffs\_first mode will abort the current replication
sweep before attempting any primary suffix syncing if any of the handoff
partitions were not removed for any reason - and start over with
replication of handoffs jobs as the highest priority.
Note that handoffs\_first being enabled will emit a warning on start up,
even if no handoff jobs fail, because of the negative impact it can have
during normal operations by dog piling on a node that was temporarily
unavailable.
Change-Id: Ia324728d42c606e2f9e7d29b4ab5fcbff6e47aea
commit 78cfb137d5d3d6f4770923a1fb086adaa9c0676f
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Nov 11 19:05:09 2015 -0800
Ring Overview updates
Change-Id: Ic5a8ec5be9fec7fa812fdb7b91890d5fc2fbf967
commit 24227e8bb0d4d369eeab61ab5c20730b4f84b36a
Author: Richard Hawkins <richard.hawkins@rackspace.com>
Date: Wed Jan 13 10:16:29 2016 -0600
\_get\_info\_cache should encode unicode metadata
Closes-Bug: 1533768
Change-Id: I67bbd0e8802d2a34cb3a0b0fafe26bbc62221032
commit fc9a3852e44b2bf1258fcb24a6c12ecfb2795f44
Author: Tim Burke <tim.burke@gmail.com>
Date: Mon Jan 25 09:25:20 2016 -0800
Don't .lower() a literal
It feels silly, and we don't do it for any of the other headers in
headers\_to\_container\_info.
While we're at it, clean up a stray '
Change-Id: I0745038cc3832a77d064e515c37cacbdcb97c4d9
Related-Change: Iea3d06de80210e9e504e296d4572583d7ffabeac
commit 5c6576d1eb3c4c042bb46dd48f23d2fd474eba07
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Mon Jan 25 18:20:45 2016 +0100
Fixed docs: Title underline too short
Change-Id: If96b0e799a4671e7b7f3f5bea2628db75afa9578
commit 9c403d5e1bb1f404445f1731e3ff1b5c034336a6
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:31:12 2015 +0200
Port swift.common.utils.Timestamp to Python 3
\* Fix Timestamp.isoformat(): on Python 3, round manually to use the
same rounding method than Python 2.
\* Use @functoos.total\_ordering on Timestamp instead of the \_\_cmp\_\_()
special method. On Python 3, the \_\_cmp\_\_() method is no more used,
and other special methods must be defined (\_\_eq\_\_, \_\_lt\_\_, etc.).
Only define \_\_eq\_\_() and \_\_lt\_\_() methods but use
@functools.total\_ordering to generate other methods.
\* Fix also a Python 3 issues in swift.common.swob.\_datetime\_property:
replace (float, int, long) with (float,) + six.integer\_types. The
long type was renamed to int in Python 3.
Change-Id: Id26777ac2c780316ff10ef7d954c48cc1fd480b5
commit c790db89369221473bcbfc23f301424ab8d30d60
Author: Andrew Welleck <awellec@us.ibm.com>
Date: Mon Jan 25 10:03:18 2016 -0600
Additional step for Debugging Issues in SAIO
Adding an additional debugging step for the SAIO "Debugging Issues"
section. Adding step to check if memcache is running and to start
it if its not.
Change-Id: I0bfa563f595dbefcf907494451fad45e6310db88
commit d47155af262d52c284f262bf6c303d0587000bba
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 17:22:24 2015 +0200
Add \_\_next\_\_() methods to utils iterators for py3
On Python 3, next(obj) calls obj.\_\_next\_\_(), not obj.next(). Add an
alias from \_\_next\_\_() to next() to be compatible with Python 2 and
Python 3.
Change-Id: Ida104d3bd7cdba557e523f18df43d56847060054
commit 0f8319dceb2d21a9d1ec74f78203b033f25c0969
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri Jan 22 13:31:34 2016 -0800
Use calendar.timegm not time.mktime
time.mktime produces a POSIX timestamp that takes into account the local
timezone, but we're parsing a Last-Modified header with a known (GMT)
timezone. As a result, if one proxy-server is configured with a timezone
other than GMT/UTC, we may have previous versions in the wrong order.
Change-Id: I320e2368b243f4245725e73bfabc7ad19bc5bacb
commit 72d972166ff66d3c5313356c1e1e3984fee9f012
Author: paul luse <paul.e.luse@intel.com>
Date: Thu Jan 21 13:30:15 2016 -0700
Update AUTHORS
+Luse core emeritus
Change-Id: Ie175f410ddc24a2d5e64bc191364418a3c450f3f
commit 2f8105e5fcf4ecee2202797ba1ab48fa8fb1a1f6
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 20 18:14:16 2016 +0000
Fix bug in mem\_diskfile write\_metadata method
The mem\_diskfile DiskFile.write\_metadata method was
apparently never called in any existing test, as if it
were it would blow up as reported in the bug.
This patch fixes the method and adds a test that
exercises it. The test addition itself should be useful
since it verifies the behaviour of Last-Modified after
POSTs to an object.
Drive-by fixes for bad docstring and undefined references
in the \_quarantine method.
Change-Id: I17fd62e5f02be5b48bfd9ba7fa25315e30a0a4bf
Closes-Bug: #1536037
commit e13a03c379273ee10e678818078b9c40a96a7dc9
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Jan 20 16:06:26 2016 -0800
Stop overriding builtin range
Change-Id: I315f8b554bb9e96659b455f4158f074961bd6498
commit 0a404def7d54d1ef1c85c11a378052260c4fda4c
Author: John Dickinson <me@not.mn>
Date: Wed Jan 20 15:19:35 2016 -0800
remove unneeded duplicate dict keys
Change-Id: I926d7aaa9df093418aaae54fe26e8f7bc8210645
commit 221f94fdd39fd2dcd9a2e5565adceab615d55913
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 14:50:24 2016 -0800
authors and changelog updates for 2.6.0
Change-Id: Idd0ff9e70abc0773be183c37cd6125fe852da7c0
commit 58359269b0e971e52f0eb7f97221566ca2148014
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612
commit d9b22ac51cca579e97ec7bd5a6df3ad7bf56c3bf
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:45:33 2015 +0200
Port parse\_mime\_headers() to Python 3
Port swift.common.utils.parse\_mime\_headers() to Python 3:
\* On Python 3, tries to decode headers from UTF-8. If an header was
was not encoded to UTF-8, decode the header from Latin1.
\* Update the parse\_mime\_headers() tests: on Python 3, HTTP header
values are Unicode strings.
This change is a follow-up of the change
Ia5ee2ead67e36e8c6416183667f64ae255887736.
Change-Id: I042dd13e9eb0e9844ccd832d538cdac84359ed42
commit cec2aa0b4dbf0e1bf2de62945f5abdf494925a8e
Author: Victor Stinner <vstinner@redhat.com>
Date: Fri Oct 9 17:56:39 2015 +0200
py3: Use the six module in the xprofile middleware
\* Replace bytes\_() with a isinstance(content, six.text\_type)
and content.encode('utf-8')
\* Get parse\_qs() from six.moves.urllib.parse
Change-Id: I4a506975814bff098ade25c950c154e50dc9626e
commit bc4b298b6e208d3188641712c9d66ae82d172c14
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 19 15:33:13 2016 -0800
Fix a comment's indentation
Change-Id: I34514525b606cf82767ddce7769bc42fa5457717
commit 6c32da14f48b435aa4e5efea48904bd288a532a2
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:38:24 2015 +0200
Port FileLikeIter to Python 3
Port FileLikeIter and \_MultipartMimeFileLikeObject and
swift.common.utils to Python 3:
\* Add a \_\_next\_\_() alias to the next() method. On Python 3, the
next() method is no more used, \_\_next\_\_() is required.
\* Use literal byte strings: FileLikeIter \_MultipartMimeFileLikeObject
are written to handle binary files.
\* test\_close(): replace .FileLikeIter('abcdef') with
FileLikeIter([b'a', b'b', b'c']). On Python 3, list(b'abc') returns
[97, 98, 99], whereas ['a', 'b', 'c'] is returned on Python 2.
\* Update unit FileLikeIter tests to use byte strings.
Change-Id: Ibacddb70b22f624ecd83e374749578feddf8bca8
commit caa127d59a63a25cc6d08e985e536f90300a6156
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Nov 12 11:34:44 2015 -0800
Monkeypatch everything the same
There's three spots in the code where eventlet monkeypatches
things. In one place, it was monkeypatching socket and thread; in the
other two, only socket. This commit monkeypatches socket and thread
everywhere.
Hopefully, this lets us avoid code that, for example, works in the
object server but fails in the object updater.
Change-Id: Ia30d069c5ac89f4bfbe52233d03d96738144b614
commit 3a0486e532f22af0d3c8a5c5d78613c22e786ff6
Author: Sivasathurappan Radhakrishnan <siva.radhakrishnan@intel.com>
Date: Fri Dec 4 17:43:00 2015 +0000
Deleted comment about part power in FakeRing
Deleted comment about parameter part power in Class FakeRing as its
behavior got dropped in I8bfc388a04eff6491038991cdfd7686c9d961545.
Change-Id: Iec7d2565a77e48493b0056021066d8d8eab65d0b
Closes-Bug: #1488704
commit 999479f9b17b42ccc5da54ce01651960cf7cf970
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 10:30:30 2016 -0800
Bump eventlet min version to 0.17.4
IPv6 support in Swift is dependent on IPv6 support in eventlet.
eventlet itself only claims support for IPv6 post v0.17
(https://github.com/eventlet/eventlet/issues/8). This update matches
the OpenStack global requirements version.
Change-Id: I9d8433cdd3bf7d7a93b8f50b991cc21721a80d22
commit 133a3ea601a3fea84af36a42845f27b8182fd901
Author: Christopher Bartz <bartz@dkrz.de>
Date: Mon Dec 21 14:17:00 2015 +0100
Use the correct split\_path in handle\_request
Change-Id: I86d423309f0b2091ee2e82b2245caf925b6a75ef
Closes-Bug: #1528189
commit 09b188f03c4a40838ea6b3e54e0714d93077b066
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Thu Jul 16 09:35:37 2015 +0900
Add functional test for access control (RBAC) with Keystone
This patch adds test cases for PUT, DELETE, GET, HEAD, POST and OPTIONS
requests to accounts, containers and objects using various combinations
of users/projects, roles and/or service tokens.
Change-Id: Iea8141ac74ad949a3ae7fa47fda3135d0f2612f6
commit bf10974cdefffdaaebc58d21e8a9912638a0405a
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Dec 16 15:46:13 2015 -0800
Expose token expiration time in tempauth auth response
Previously, we gave no indication of when a token would expire. Users
would have to just use it until it stopped working, then re-auth.
Now, a successful auth response will include a new header,
X-Auth-Token-Expires, with the number of seconds remaining until the
token is invalid. This allows the client to attempt to re-auth before
sending a request that will definitely fail.
For comparison, swauth already uses the X-Auth-Token-Expires header with
identical semantics. Additionally, Keystone (v2 and v3) already exposes
expiration times in its JSON responses. The security impact should be
minimal.
Change-Id: I5a4a74276bc0df6dda94e4bc150065c0d77de0eb
commit f56f29ef7a692b6c3204e25d41eace3d68dceece
Author: Peter Lisák <peter.lisak@firma.seznam.cz>
Date: Thu Dec 3 16:48:18 2015 +0100
Add info about state of ring file to default command.
Try to find ring file, load and compare it with builder file, then show result state.
Examples:
Ring file object.ring.gz not found, probably it hasn't been written yet
Ring file object.ring.gz is up-to-date
Ring file object.ring.gz is obsolete
Ring file object.ring.gz is invalid: ValueError('string length not a multiple of item size',)
Change-Id: I4d769aa5fe1c2b1167ec088aa372874f7d13ae48
commit 47e226418bad35ccad2a1525f392ba69f6165027
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Mon Jan 18 06:20:14 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Ic416c9afc8a1c76f552803a7c70fc905eda7b3cb
commit 165fa1fd40b5e4b13cf5188712593e2275bef821
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jan 15 11:44:21 2016 -0800
add test for zero weight region get\_more\_nodes
Change-Id: If537981e8deadd9c3528dcb30a15011c7781e334
commit 5d449471b12c67b31ebb5a383d9bb35bace36213
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jan 14 17:26:01 2016 -0800
Remove some Python 2.6 leftovers
Change-Id: I798d08722c90327c66759aa0bb4526851ba38d41
commit 3c0cf549f1e822cce8f905b069b317e676cf306b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jan 13 18:08:45 2016 -0800
Speed up get\_more\_nodes() when there is an empty zone
The ring has some optimizations in get\_more\_nodes() so that it can
find handoffs that span all the regions/zones/et cetera and then stop
looking. The stopping is the important part.
Previously, it would quickly find a handoff in each unused region,
then spend way too long looking for more unused regions; the same was
true for zones, IPs, and so on. Thus, in commit 9cd7c6c, we started
counting regions and zones, then stopping when we found them all.
This count included all regions and zones in the ring, regardless of
whether or not there were actually any parts assigned or not. In rings
with an empty region, i.e. a region for which there are only
zero-weight devices, get\_more\_nodes() would be very slow.
This commit ignores devices with no assigned partitions when counting
regions, zones, and so forth, thus greatly speeding things up.
The output of get\_more\_nodes() is unchanged. This is purely an
optimization.
Closes-Bug: 1534303
Change-Id: I4a5c57205e87e1205d40fd5d9458d4114e524332
commit 70047709fc9885df7019f791e17a3240682cc6cb
Author: keliang <ke.liang@easystack.cn>
Date: Fri Jan 15 00:31:51 2016 +0800
Drop python 2.6 support
Change-Id: Id6329c863dacb189fccfc304453ed7b6f9607c14
commit a4c2fe95ab2fbe59379a69914ed0fac49c28efbb
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Jan 12 21:26:33 2016 +0100
Allow to change auditor sleep interval in config
Change-Id: Ic451c5e0b686509f8982ed1bf65a223a2d77b9a0
commit edc823e8030640184071fee4920d34f9a1cc6b3e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Nov 29 18:46:47 2015 +0100
Show UTC time in swift-recon.
It's not consistent now for example local time in replication part and
UTC time at begging of line. Use \_ptime in swift-recon for all time
printing and this function returns UTC now.
Change-Id: I732d9851db157130a08e825e8093b7e244b63e9c
commit fa5b32d27964478dfcccf71155d2aaa946c561f0
Author: Tim Burke <tim.burke@gmail.com>
Date: Tue Jan 12 14:18:30 2016 -0800
Make object-auditor storage-policy-aware
Previously, the object-auditor would always use a (replication)
DiskFileManager when walking through AuditLocations, which would cause
it to skip EC fragment archives with a warning like:
Unexpected file <hash\_path>/1452557187.03610#3.data:
Invalid Timestamp value in filename '1452557187.03610#3.data'
Now, the AuditLocation's policy will be used to find an appropriate
manager to get the diskfile. Additionally, several .commit()s were added
to the auditor tests so the .durable will be written, which is required
when auditing EC fragment archives.
Change-Id: I960e7d696fd9ad704ca1872b4ac821f9078838c7
Closes-Bug: 1533002
commit 725a166ebd3fde2c34f2c9578ff6f9911cf206d7
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Fri Jan 8 18:42:33 2016 -0800
Make \_get\_addr() method a function in utils.
The patch moves the MemcacheConnPool.\_get\_addr() method a function in
swift.common.utils. The function is renamed to parse\_socket\_string()
and the documentation is updated accordingly. The test for it has also
been moved.
Change-Id: Ida65b2fded28d0a059e668646f5b89714298f348
commit 0647aea9c5fc95f0860758cc54bc23f965da460d
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Fri Jan 8 14:54:56 2016 -0800
Fail early if the memcache address is invalid.
In cases when the memcache address is invalid, we should fail early.
This patch addresses the cases when the IPv6 addresses are not
enclosed in "[]". It does not, however, fix the case of an invalid
hostname. These improvements could also be added to the \_get\_addr()
method.
Change-Id: I4743dcda45a1fc1640989325c4a2e1fea591fc69
commit 33476460239c9cdb08dd8065d22d84a4717da7be
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jan 8 16:15:54 2016 -0800
fixups for ipv6 memcache\_servers docs
Change-Id: I20d91c1e276014eaf210fa9eb43788bc17f4e8df
commit d5ff5447be30b44bf4acc8b912b6241a44f710be
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 12 16:42:06 2016 -0800
Install liberasurecode packages in SAIO.
Change-Id: If673afa2b61a3e388612debf4860d561960963a3
commit 4ffc4ba411f67c8407ba38d082a3a51a96ad7e04
Author: Jonathan Hinson <jlhinson@us.ibm.com>
Date: Tue Jan 12 11:46:21 2016 -0600
Functional tests for if-match with multiple etags
Multiple etags can be provided on an if-match or if-none-match
request. This is currently being tested in the unit tests, but not
in the functional tests. Since these etags can be modified by
middleware, we need functional tests to assert multiple-etag
requests are handled correctly.
Change-Id: Idc409c85e8aa82b59dc2bc28af6ca2617de82699
commit 1292361176aec385137dd5873c5cc9714de1fa17
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Jan 11 16:25:50 2016 -0800
functest for x-timestamp validation
Change-Id: I05af7d837af00cd1059a8912df05c131a52ffb90
commit e6194113a3c81563590eabf8f761ccb988bb917c
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri Jan 8 16:38:31 2016 -0800
Validate X-Timestamps
Previously, attempting to PUT a new object with an X-Timestamp header
less than or equal to zero (ie, for a timestamp on or before 1970-01-01
00:00:00) would cause the object-server to 500.
While we're at it, cap X-Timestamp at 9999999999 (2286-11-20 17:46:40)
so we don't get an eleventh digit before the decimal point.
Closes-Bug: 1532471
Change-Id: I23666ec8a067d829eaf9bfe54bd086c320b3429e
commit 1f3304c5153e01988b8f4493875b6489e93f76d0
Author: Ben Martin <blmartin@us.ibm.com>
Date: Mon Dec 14 15:28:17 2015 -0600
Print min\_part\_hours lockout time remaining
swift-ring-builder currently only displays min\_part\_hours and
not the amount of time remaining before a rebalance can occur.
This information is readily available and has been displayed
as a quality of life improvement.
Additionally, a bug where the time since the last rebalance
was always updated when rebalance was called regardless of
if any partitions were reassigned. This can lead to partitions
being unable to be reassigned as they never age according to
the time since last rebalance.
Change-Id: Ie0e2b5e25140cbac7465f31a26a4998beb3892e9
Closes-Bug: #1526017
commit 167bb5eeb82886d67c1b382417fb22b8ea85f0d3
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Wed Dec 16 12:07:27 2015 -0800
Fix IPv6 handling in MemcacheConnPool.
The patch removes the assumption of IPv4-only addresses in the
MemcacheConnPool. The changes are around address handling.
Namely, if a server is specified with an address
[<address>]:port (port is optional), it is assumed to be an IPv6
address [1]. If an IPv6 address is specified without "[]", an exception
is raised as it is impossible to parse such addresses correctly.
For testing, memcache can be configured to listen on the link-local,
unique-local, or ::1 (equivalent to 127.0.0.1) addresses. Link-local
addresses are assigned by default to each interface and are of the form
"fe80::dead:beef". These addresses require a scope ID, which would look
like "fe80::dead:beef%eth0" (replacing eth0 with the correct interface).
Unique-local addresses are any addresses in the fc00::/7 subnet. To add
a ULA to an interface use the "ip" utility. For example:
"ip -6 address add fc01::dead:beef dev eth0". Lastly, and probably
simplest, memcache can be configured to listen on "::1". The same
address would be used in the swift configuration, e.g. "[::1]:11211".
Note: only memcached version 1.4.25 or greater supports binding to an
IPv6 address.
Fixes #1526570
[1] IPv6 host literals:
https://tools.ietf.org/html/rfc3986#section-3.2.2
Change-Id: I8408143c1d47d24e70df56a08167c529825276a2
commit fb6751d8ba133c57e1ebb76be71a96f2f120b8ca
Author: Paul Dardeau <paul.dardeau@intel.com>
Date: Fri Jan 8 22:49:05 2016 +0000
Look for device holes that can be reused when adding new device.
Change-Id: I1980ebdd9dc89848173d8ca2fe2afb74029dcfa2
Closes-Bug: 1532276
commit b35f3c90bde8a7ccb50440bda5800cbb8274a5a1
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Jan 8 01:29:11 2016 -0800
Add note COPY with conditional headers
Swift now supports Range header for COPY (or PUT with X-Copy-From)
to make a partial copied object. This patch adds the note to show
it obviously supported in Swift community.
Change-Id: I6bf28f0932c90e7b305cd61aabce4ed028ae691e
Partial-Bug: #1532126
commit 23c7a58f8f1412c28b3a16b79be09c224c9f7d55
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Dec 11 18:26:34 2015 +0900
Fix ClientException handling in Container Sync
swift/container/sync.py uses swift.common.internal\_client.delete\_object
and put\_object and expected these methods raise ClientException.
But delete\_object and put\_object never raise the exception so this patch
raises ClientException when urllib2 library raises HTTPError.
Co-Authored-By: Eran Rom <eranr@il.ibm.com>
Closes-Bug: #1419901
Change-Id: I58cbf77988979a07998a46d9d81be84d29b0d9bf
commit 6786cdf036b4faabe3928c3d0dd9615d94834801
Author: Harshada Mangesh Kakad <harshadak@metsi.co.uk>
Date: Thu Dec 31 01:44:00 2015 -0800
Fixing the deprecated library function.
os.popen() is deprecated since version 2.6. Resolved with use of
subprocess module.
Change-Id: I4409cdd9edbc1a26d6f99c125c9100fadda5d758
Partial-Bug: #1529836
commit 85a0a6a28e166bc076cf8786de2b46248d8786a2
Author: Eran Rom <eranr@il.ibm.com>
Date: Sun Jul 26 13:31:17 2015 +0300
Container-Sync to iterate only over synced containers
This change introduces a sync\_store which holds only containers that
are enabled for sync. The store is implemented using a directory
structure that resembles that of the containers directory, but has
entries only for containers enabled for sync.
The store is maintained in two ways:
1. Preemptively by the container server when processing
PUT/POST/DELETE operations targeted at containers with
x-container-sync-key / x-container-sync-to
2. In the background using the containers replicator
whenever it processes a container set up for sync
The change updates [1]
[1] http://docs.openstack.org/developer/swift/overview\_container\_sync.html
Change-Id: I9ae4d4c7ff6336611df4122b7c753cc4fa46c0ff
Closes-Bug: #1476623
commit e75888b281d59df0889f28d0b32241dac3a34aa2
Author: HugoKuo <tonytkdk@gmail.com>
Date: Wed Jan 6 14:33:23 2016 +0800
Add more description for write\_affinity\_node\_count parameter in the doc.
Change-Id: Iad410a2be4f9a2cd5c53e860b9f91993aa7f2369
Closes-Bug: #1531173
commit 3b1591f235f4b85796917507be5e7fd80365ff9e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Wed Sep 30 19:08:09 2015 +0200
swift-init: New option kill-after-timeout
This option send SIGKILL to daemon after kill\_wait period.
When daemon hangs and doesn't respond to SIGTERM/SIGHUP
there is no way to stop it using swift-init now. Classic
init scripts in Linux kills hanged process after grace
period and this patch add same behaviour. This is most
usefull when using "restart" on hanged daemon.
Change-Id: I8c932b673a0f51e52132df87ea2f4396f4bba9d8
commit 4691d0592ff3deeea2713195312bf1effd5a7a7b
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Dec 25 14:00:16 2015 +0900
Add object replicator's succeeded and failed counts in log
account-replicator and container-replicator outputted the
following info in log.
info account-replicator: 17 successes, 4 failures
info container-replicator: 178 successes, 29 failures
But there is no output info for object-replicator. This info
is important to check replicator's status from log.
So this patch adds object-replicator's succeeded and failed
counts in log like account-replicator and container-replicator.
Change-Id: I7fbaf161540bdb06c0a65a1032aae83764bd970c
commit 9fe0e25604dff35db7eab1bca312821a81db6c1d
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Dec 8 22:27:44 2015 -0800
Sleep enough for trampoline
When running unite test suite in local poor resource environment,
sometimes test/unit/proxy/test\_server.py fails due to a lack of
waiting time to trampoline of eventlet thread.
This patch enables to sleep 1 more second when it doesn't seem
to have enough time to tranpoline.
Change-Id: I0bbc8fc245919d3c0a071ff87ff6e20b8d58f9b8
commit 7f636a557296ecc6ae4727700cfcf9f82573bd16
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Nov 30 18:06:09 2015 -0800
Allow smaller segments in static large objects
The addition of range support for SLO segments (commit 25d5e68)
required the range size to be at least the SLO minimum segment size
(default 1 MiB). However, if you're doing something like assembling a
video of short clips out of a larger one, then you might not need a
full 1 MiB.
The reason for the 1 MiB restriction was to protect Swift from
resource overconsumption. It takes CPU, RAM, and internal bandwidth to
connect to an object server, so it's much cheaper to serve a 10 GiB
SLO if it has 10 MiB segments than if it has 10 B segments.
Instead of a strict limit, now we apply ratelimiting to small
segments. The threshold for "small" is configurable and defaults to 1
MiB. SLO segments may now be as small as 1 byte.
If a client makes SLOs as before, it'll still be able to download the
objects as fast as Swift can serve them. However, a SLO with a lot of
small ranges or segments will be slowed down to avoid resource
overconsumption. This is similar to how DLOs work, except that DLOs
ratelimit \*every\* segment, not just small ones.
UpgradeImpact
For operators: if your cluster has enabled ratelimiting for SLO, you
will want to set rate\_limit\_under\_size to a large number prior to
upgrade. This will preserve your existing behavior of ratelimiting all
SLO segments. 5368709123 is a good value, as that's 1 greater than the
default max object size. Alternately, hold down the 9 key until you
get bored.
If your cluster has not enabled ratelimiting for SLO (the default), no
action is needed.
Change-Id: Id1ff7742308ed816038a5c44ec548afa26612b95

| **tags**: | added: in-feature-hummingbird |
| --- | --- |

[Pratap D (pratapd)](https://launchpad.net/~pratapd)
on 2016-06-03

| Changed in swift (Ubuntu): | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pratap D (pratapd)](https://launchpad.net/~pratapd) wrote on 2016-06-03: |  |  | [#69](/cloud-archive/%2Bbug/1493303/comments/69) |
| --- | --- | --- | --- |

Changed in swift (Ubuntu):

By mistake I changed the status to "Fix released".

Status needs to be changed to "Confirmed".

Please change the status to "Confirmed".

Sorry for the trouble.

Changed in swift (Ubuntu):
By mistake I changed the status to "Fix released".
Status needs to be changed to "Confirmed".
Please change the status to "Confirmed".
Sorry for the trouble.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-06-03: |  |  | [#70](/cloud-archive/%2Bbug/1493303/comments/70) |
| --- | --- | --- | --- |

@james-page, it seems like you are the one who can change the "swift (ubuntu)" task status. Please put it back to "confirmed"...

@james-page, it seems like you are the one who can change the "swift (ubuntu)" task status. Please put it back to "confirmed"...

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-06-03

| Changed in swift (Ubuntu): | |
| --- | --- |
| **status**: | Fix Released → Confirmed |

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-06-10

| Changed in swift (Ubuntu Yakkety): | |
| --- | --- |
| **status**: | Confirmed → Fix Released |
| Changed in swift (Ubuntu Xenial): | |
| **status**: | New → Fix Released |
| Changed in swift (Ubuntu Wily): | |
| **status**: | New → Triaged |
| Changed in swift (Ubuntu Vivid): | |
| **status**: | New → Won't Fix |
| Changed in swift (Ubuntu Trusty): | |
| **status**: | New → Triaged |

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-06-10

| **no longer affects**: | swift (Ubuntu Vivid) |
| --- | --- |

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-09-08

| Changed in cloud-archive: | |
| --- | --- |
| **status**: | New → Invalid |
| Changed in swift (Ubuntu Wily): | |
| **status**: | Triaged → Won't Fix |
| Changed in swift (Ubuntu Trusty): | |
| **status**: | Triaged → Won't Fix |
| **status**: | Won't Fix → New |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Eduardo Barretto (ebarretto)](https://launchpad.net/~ebarretto) wrote on 2020-07-06: |  |  | [#71](/cloud-archive/%2Bbug/1493303/comments/71) |
| --- | --- | --- | --- |

This bug was fixed in the package swift - 1.13.1-0ubuntu1.5

---------------

swift (1.13.1-0ubuntu1.5) trusty-security; urgency=medium

[ Jamie Strandboge ]

  \* SECURITY UPDATE: disallow unsafe tempurl operations to point to

    unauthorized data

    - debian/patches/CVE-2015-5223.patch: disallow creation of DLO object

      manifests if non-safe tempurl request includes X-Object-Manifest header

    - CVE-2015-5223

    - LP: [#1453948](/bugs/1453948)

[ Marc Deslauriers ]

  \* SECURITY UPDATE: DoS via incorrectly closed client connections

    - debian/patches/CVE-2016-0737.patch: get better at closing WSGI

      iterables in swift/common/middleware/dlo.py,

      swift/common/middleware/slo.py, swift/common/request\_helpers.py,

      swift/common/swob.py, swift/common/utils.py,

      test/unit/common/middleware/helpers.py,

      test/unit/common/middleware/test\_dlo.py,

      test/unit/common/middleware/test\_slo.py.

    - CVE-2016-0737

  \* SECURITY UPDATE: DoS via incorrectly closed server connections

    - debian/patches/CVE-2016-0738.patch: fix memory/socket leak in proxy

      on truncated SLO/DLO GET in swift/common/request\_helpers.py,

      test/unit/common/middleware/test\_slo.py.

    - CVE-2016-0738

  \* Thanks to Red Hat for the patch backports!

  \* debian/patches/fix-ubuntu-tests.patch: disable another test that no

    longer works on buildds.

-- Marc Deslauriers <email address hidden> Tue, 12 Sep 2017 07:36:43 -0400

This bug was fixed in the package swift - 1.13.1-0ubuntu1.5
---------------
swift (1.13.1-0ubuntu1.5) trusty-security; urgency=medium
[ Jamie Strandboge ]
\* SECURITY UPDATE: disallow unsafe tempurl operations to point to
unauthorized data
- debian/patches/CVE-2015-5223.patch: disallow creation of DLO object
manifests if non-safe tempurl request includes X-Object-Manifest header
- CVE-2015-5223
- LP: #1453948
[ Marc Deslauriers ]
\* SECURITY UPDATE: DoS via incorrectly closed client connections
- debian/patches/CVE-2016-0737.patch: get better at closing WSGI
iterables in swift/common/middleware/dlo.py,
swift/common/middleware/slo.py, swift/common/request\_helpers.py,
swift/common/swob.py, swift/common/utils.py,
test/unit/common/middleware/helpers.py,
test/unit/common/middleware/test\_dlo.py,
test/unit/common/middleware/test\_slo.py.
- CVE-2016-0737
\* SECURITY UPDATE: DoS via incorrectly closed server connections
- debian/patches/CVE-2016-0738.patch: fix memory/socket leak in proxy
on truncated SLO/DLO GET in swift/common/request\_helpers.py,
test/unit/common/middleware/test\_slo.py.
- CVE-2016-0738
\* Thanks to Red Hat for the patch backports!
\* debian/patches/fix-ubuntu-tests.patch: disable another test that no
longer works on buildds.
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Tue, 12 Sep 2017 07:36:43 -0400

| Changed in swift (Ubuntu Trusty): | |
| --- | --- |
| **status**: | New → Fix Released |

[See full activity log](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/cloud-archive/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/cloud-archive/%2Bbug/1493303/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [leakpatch-1.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4529331/%2Bfiles/leakpatch-1.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4529331 "Change patch details")
* [security\_leak\_fix.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4530760/%2Bfiles/security_leak_fix.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4530760 "Change patch details")
* [socket-leak-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4532159/%2Bfiles/socket-leak-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4532159 "Change patch details")
* [socket-leak-3.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4545988/%2Bfiles/socket-leak-3.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4545988 "Change patch details")
* [socket-leak-4.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4546358/%2Bfiles/socket-leak-4.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4546358 "Change patch details")
* [socket-leak-kilo-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548894/%2Bfiles/socket-leak-kilo-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548894 "Change patch details")
* [socket-leak-liberty-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548896/%2Bfiles/socket-leak-liberty-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548896 "Change patch details")
* [socket-leak-kilo-backport-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4549968/%2Bfiles/socket-leak-kilo-backport-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4549968 "Change patch details")

* [Add patch](/cloud-archive/%2Bbug/1493303/%2Baddcomment?field.patch=on)

## Bug attachments

* [Dependencies.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459119/%2Bfiles/Dependencies.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459119 "Change attachment details")
* [ProcEnviron.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459120/%2Bfiles/ProcEnviron.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459120 "Change attachment details")
* [leakreproducer.sh](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4520199/%2Bfiles/leakreproducer.sh)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4520199 "Change attachment details")

* [Add attachment](/cloud-archive/%2Bbug/1493303/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_9e50c715_20250126_072231.html ===

[Log in / Register](https://launchpad.net/~tristan-cacqueray/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~tristan-cacqueray)

## [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray)

* Overview
* [Code](https://code.launchpad.net/~tristan-cacqueray)
* [Bugs](https://bugs.launchpad.net/~tristan-cacqueray)
* [Blueprints](https://blueprints.launchpad.net/~tristan-cacqueray)
* [Translations](https://translations.launchpad.net/~tristan-cacqueray)
* [Answers](https://answers.launchpad.net/~tristan-cacqueray)

* [Related packages](https://launchpad.net/~tristan-cacqueray/%2Brelated-packages)
* [Related projects](https://launchpad.net/~tristan-cacqueray/%2Brelated-projects)

## User information

Launchpad Id:
tristan-cacqueray

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-10-25

[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)

Signed Ubuntu Code of Conduct:
Yes

Languages:

English

OpenPGP keys:

EB103DE8B5E69E631C6FF17922B9A05C925CC5D8

SSH keys:

[localadmin@controller](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~tristan-cacqueray/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**tristanC**
 on
**irc.freenode.net**

## [All memberships](https://launchpad.net/~tristan-cacqueray/%2Bparticipation) Latest memberships

| [Swiftsync dev](/~swiftsync-devteam)  Joined on 2014-02-13 | |
| --- | --- |
| [OpenStack Security SIG](/~openstack-ossg)  Joined on 2013-12-12 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from translations.launchpad.net_5415a748_20250126_072229.html ===

[Log in / Register](https://translations.launchpad.net/swift/%2Blogin)

[![](https://launchpadlibrarian.net/52141984/os64.png)](https://launchpad.net/swift)

## [OpenStack Object Storage (swift)](https://launchpad.net/swift)

* [Overview](https://launchpad.net/swift)
* [Code](https://code.launchpad.net/swift)
* [Bugs](https://bugs.launchpad.net/swift)
* [Blueprints](https://blueprints.launchpad.net/swift)
* Translations
* [Answers](https://answers.launchpad.net/swift)

# Translation overview

[Help for translations](https://help.launchpad.net/Translations)

### Translation details

Launchpad currently recommends translating
[OpenStack Object Storage (swift) trunk series](/swift/trunk).

To see all the translation files that are waiting to be
imported, please look at
[OpenStack Object Storage (swift) import queue](/swift/%2Bimports).

### Permissions

[OpenStack Object Storage (swift)](https://launchpad.net/swift) is translated
with [Open](/%2Bhelp-translations/permissions-policies.html)
permissions.

### All translatable series

* [OpenStack Object Storage (swift) trunk series](/swift/trunk/%2Btranslations)

### All translatable distribution packages

* [swift source package in Plucky](/ubuntu/plucky/%2Bsources/swift/%2Btranslations)
* [swift source package in Oracular](/ubuntu/oracular/%2Bsources/swift/%2Btranslations)
* [swift source package in Noble](/ubuntu/noble/%2Bsources/swift/%2Btranslations)
* [swift source package in Mantic](/ubuntu/mantic/%2Bsources/swift/%2Btranslations)
* [swift source package in Lunar](/ubuntu/lunar/%2Bsources/swift/%2Btranslations)
* [swift source package in Kinetic](/ubuntu/kinetic/%2Bsources/swift/%2Btranslations)
* [swift source package in Jammy](/ubuntu/jammy/%2Bsources/swift/%2Btranslations)
* [swift source package in Impish](/ubuntu/impish/%2Bsources/swift/%2Btranslations)
* [swift source package in Hirsute](/ubuntu/hirsute/%2Bsources/swift/%2Btranslations)
* [swift source package in Groovy](/ubuntu/groovy/%2Bsources/swift/%2Btranslations)
* [swift source package in Focal](/ubuntu/focal/%2Bsources/swift/%2Btranslations)
* [swift source package in Eoan](/ubuntu/eoan/%2Bsources/swift/%2Btranslations)
* [swift source package in Disco](/ubuntu/disco/%2Bsources/swift/%2Btranslations)
* [swift source package in Cosmic](/ubuntu/cosmic/%2Bsources/swift/%2Btranslations)
* [swift source package in Bionic](/ubuntu/bionic/%2Bsources/swift/%2Btranslations)
* [swift source package in Artful](/ubuntu/artful/%2Bsources/swift/%2Btranslations)
* [swift source package in Zesty](/ubuntu/zesty/%2Bsources/swift/%2Btranslations)
* [swift source package in Yakkety](/ubuntu/yakkety/%2Bsources/swift/%2Btranslations)
* [swift source package in Xenial](/ubuntu/xenial/%2Bsources/swift/%2Btranslations)
* [swift source package in Wily](/ubuntu/wily/%2Bsources/swift/%2Btranslations)
* [swift source package in Vivid](/ubuntu/vivid/%2Bsources/swift/%2Btranslations)
* [swift source package in Utopic](/ubuntu/utopic/%2Bsources/swift/%2Btranslations)
* [swift source package in Trusty](/ubuntu/trusty/%2Bsources/swift/%2Btranslations)
* [swift source package in Saucy](/ubuntu/saucy/%2Bsources/swift/%2Btranslations)
* [swift source package in Raring](/ubuntu/raring/%2Bsources/swift/%2Btranslations)
* [swift source package in Quantal](/ubuntu/quantal/%2Bsources/swift/%2Btranslations)
* [swift source package in Precise](/ubuntu/precise/%2Bsources/swift/%2Btranslations)

## Translation for trunk

| Language | Status | Untranslated | Needs review | Last Changed |
| --- | --- | --- | --- | --- |
| [Afrikaans](/swift/trunk/%2Bpots/swift/af/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/af/%2Btranslate?show=untranslated) | 196 [196](/swift/trunk/%2Bpots/swift/af/%2Btranslate?show=new_suggestions) | 2022-11-21 19:18:24 UTC 2022-11-21 |
| [Albanian](/swift/trunk/%2Bpots/swift/sq/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/sq/%2Btranslate?show=untranslated) | 3 [3](/swift/trunk/%2Bpots/swift/sq/%2Btranslate?show=new_suggestions) | 2012-02-25 15:12:23 UTC 2012-02-25 |
| [Belarusian](/swift/trunk/%2Bpots/swift/be/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/be/%2Btranslate?show=untranslated) | 27 [27](/swift/trunk/%2Bpots/swift/be/%2Btranslate?show=new_suggestions) | 2020-05-03 16:45:26 UTC 2020-05-03 |
| [Bosnian](/swift/trunk/%2Bpots/swift/bs/%2Btranslate) | 196 000.00  100.0% translated | 0 0 | 0 0 | 2012-12-12 20:23:19 UTC 2012-12-12 |
| [Brazilian Portuguese](/swift/trunk/%2Bpots/swift/pt_BR/%2Btranslate) | 144 026.53  73.46938775510205% translated  26.53061224489796% untranslated | 52 [52](/swift/trunk/%2Bpots/swift/pt_BR/%2Btranslate?show=untranslated) | 60 [60](/swift/trunk/%2Bpots/swift/pt_BR/%2Btranslate?show=new_suggestions) | 2012-04-01 03:15:49 UTC 2012-04-01 |
| [Chechen](/swift/trunk/%2Bpots/swift/ce/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/ce/%2Btranslate?show=untranslated) | 0 0 | 2014-08-13 08:13:41 UTC 2014-08-13 |
| [Chinese (Simplified)](/swift/trunk/%2Bpots/swift/zh_CN/%2Btranslate) | 196 000.00  100.0% translated | 0 0 | 90 [90](/swift/trunk/%2Bpots/swift/zh_CN/%2Btranslate?show=new_suggestions) | 2013-05-02 04:27:30 UTC 2013-05-02 |
| [Chinese (Traditional)](/swift/trunk/%2Bpots/swift/zh_TW/%2Btranslate) | 113 042.35  57.6530612244898% translated  42.3469387755102% untranslated | 83 [83](/swift/trunk/%2Bpots/swift/zh_TW/%2Btranslate?show=untranslated) | 21 [21](/swift/trunk/%2Bpots/swift/zh_TW/%2Btranslate?show=new_suggestions) | 2015-10-08 18:37:15 UTC 2015-10-08 |
| [Czech](/swift/trunk/%2Bpots/swift/cs/%2Btranslate) | 196 000.00  100.0% translated | 0 0 | 0 0 | 2012-07-08 19:46:11 UTC 2012-07-08 |
| [Dutch](/swift/trunk/%2Bpots/swift/nl/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/nl/%2Btranslate?show=untranslated) | 4 [4](/swift/trunk/%2Bpots/swift/nl/%2Btranslate?show=new_suggestions) | 2019-05-17 14:23:46 UTC 2019-05-17 |
| [English (Australia)](/swift/trunk/%2Bpots/swift/en_AU/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/en_AU/%2Btranslate?show=untranslated) | 196 [196](/swift/trunk/%2Bpots/swift/en_AU/%2Btranslate?show=new_suggestions) | 2012-02-02 12:37:39 UTC 2012-02-02 |
| [English (United Kingdom)](/swift/trunk/%2Bpots/swift/en_GB/%2Btranslate) | 84 057.14  42.857142857142854% translated  57.14285714285714% untranslated | 112 [112](/swift/trunk/%2Bpots/swift/en_GB/%2Btranslate?show=untranslated) | 112 [112](/swift/trunk/%2Bpots/swift/en_GB/%2Btranslate?show=new_suggestions) | 2012-12-26 23:32:50 UTC 2012-12-26 |
| [French](/swift/trunk/%2Bpots/swift/fr/%2Btranslate) | 136 030.61  69.38775510204081% translated  30.612244897959183% untranslated | 60 [60](/swift/trunk/%2Bpots/swift/fr/%2Btranslate?show=untranslated) | 102 [102](/swift/trunk/%2Bpots/swift/fr/%2Btranslate?show=new_suggestions) | 2013-02-14 06:49:01 UTC 2013-02-14 |
| [Galician](/swift/trunk/%2Bpots/swift/gl/%2Btranslate) | 26 086.73  13.26530612244898% translated  86.73469387755102% untranslated | 170 [170](/swift/trunk/%2Bpots/swift/gl/%2Btranslate?show=untranslated) | 10 [10](/swift/trunk/%2Bpots/swift/gl/%2Btranslate?show=new_suggestions) | 2013-07-10 19:50:03 UTC 2013-07-10 |
| [German](/swift/trunk/%2Bpots/swift/de/%2Btranslate) | 196 000.00  100.0% translated | 0 0 | 0 0 | 2013-03-13 09:30:18 UTC 2013-03-13 |
| [Greek](/swift/trunk/%2Bpots/swift/el/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/el/%2Btranslate?show=untranslated) | 108 [108](/swift/trunk/%2Bpots/swift/el/%2Btranslate?show=new_suggestions) | 2016-08-01 08:02:55 UTC 2016-08-01 |
| [Gujarati](/swift/trunk/%2Bpots/swift/gu/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/gu/%2Btranslate?show=untranslated) | 0 0 | 2012-02-27 11:00:53 UTC 2012-02-27 |
| [Hindi](/swift/trunk/%2Bpots/swift/hi/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/hi/%2Btranslate?show=untranslated) | 0 0 | 2011-11-22 03:08:28 UTC 2011-11-22 |
| [Indonesian](/swift/trunk/%2Bpots/swift/id/%2Btranslate) | 156 020.41  79.59183673469387% translated  20.408163265306122% untranslated | 40 [40](/swift/trunk/%2Bpots/swift/id/%2Btranslate?show=untranslated) | 30 [30](/swift/trunk/%2Bpots/swift/id/%2Btranslate?show=new_suggestions) | 2013-03-05 07:35:08 UTC 2013-03-05 |
| [Italian](/swift/trunk/%2Bpots/swift/it/%2Btranslate) | 114 041.84  58.16326530612245% translated  41.83673469387755% untranslated | 82 [82](/swift/trunk/%2Bpots/swift/it/%2Btranslate?show=untranslated) | 82 [82](/swift/trunk/%2Bpots/swift/it/%2Btranslate?show=new_suggestions) | 2011-12-21 14:12:36 UTC 2011-12-21 |
| [Japanese](/swift/trunk/%2Bpots/swift/ja/%2Btranslate) | 196 000.00  100.0% translated | 0 0 | 0 0 | 2011-05-05 13:19:23 UTC 2011-05-05 |
| [Kabyle](/swift/trunk/%2Bpots/swift/kab/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/kab/%2Btranslate?show=untranslated) | 0 0 | 2020-09-26 09:29:14 UTC 2020-09-26 |
| [Kazakh](/swift/trunk/%2Bpots/swift/kk/%2Btranslate) | 4 097.96  2.0408163265306123% translated  97.95918367346938% untranslated | 192 [192](/swift/trunk/%2Bpots/swift/kk/%2Btranslate?show=untranslated) | 0 0 | 2012-12-24 06:23:42 UTC 2012-12-24 |
| [Korean](/swift/trunk/%2Bpots/swift/ko/%2Btranslate) | 100 048.98  51.02040816326531% translated  48.97959183673469% untranslated | 96 [96](/swift/trunk/%2Bpots/swift/ko/%2Btranslate?show=untranslated) | 7 [7](/swift/trunk/%2Bpots/swift/ko/%2Btranslate?show=new_suggestions) | 2013-04-15 23:12:08 UTC 2013-04-15 |
| [Kurdish](/swift/trunk/%2Bpots/swift/ku/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/ku/%2Btranslate?show=untranslated) | 3 [3](/swift/trunk/%2Bpots/swift/ku/%2Btranslate?show=new_suggestions) | 2017-07-26 21:01:28 UTC 2017-07-26 |
| [Latvian](/swift/trunk/%2Bpots/swift/lv/%2Btranslate) | 1 099.49  0.5102040816326531% translated  99.48979591836735% untranslated | 195 [195](/swift/trunk/%2Bpots/swift/lv/%2Btranslate?show=untranslated) | 0 0 | 2013-03-07 16:08:25 UTC 2013-03-07 |
| [Malay](/swift/trunk/%2Bpots/swift/ms/%2Btranslate) | 196 000.00  100.0% translated | 0 0 | 0 0 | 2013-06-09 04:03:12 UTC 2013-06-09 |
| [Norwegian Bokmal](/swift/trunk/%2Bpots/swift/nb/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/nb/%2Btranslate?show=untranslated) | 1 [1](/swift/trunk/%2Bpots/swift/nb/%2Btranslate?show=new_suggestions) | 2014-01-16 13:09:36 UTC 2014-01-16 |
| [Occitan (post 1500)](/swift/trunk/%2Bpots/swift/oc/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/oc/%2Btranslate?show=untranslated) | 46 [46](/swift/trunk/%2Bpots/swift/oc/%2Btranslate?show=new_suggestions) | 2012-02-07 14:18:38 UTC 2012-02-07 |
| [Polish](/swift/trunk/%2Bpots/swift/pl/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/pl/%2Btranslate?show=untranslated) | 11 [11](/swift/trunk/%2Bpots/swift/pl/%2Btranslate?show=new_suggestions) | 2018-12-03 18:23:39 UTC 2018-12-03 |
| [Portuguese](/swift/trunk/%2Bpots/swift/pt/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/pt/%2Btranslate?show=untranslated) | 193 [193](/swift/trunk/%2Bpots/swift/pt/%2Btranslate?show=new_suggestions) | 2018-07-08 18:34:04 UTC 2018-07-08 |
| [Romanian](/swift/trunk/%2Bpots/swift/ro/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/ro/%2Btranslate?show=untranslated) | 10 [10](/swift/trunk/%2Bpots/swift/ro/%2Btranslate?show=new_suggestions) | 2020-03-14 17:38:36 UTC 2020-03-14 |
| [Russian](/swift/trunk/%2Bpots/swift/ru/%2Btranslate) | 121 038.27  61.73469387755102% translated  38.265306122448976% untranslated | 75 [75](/swift/trunk/%2Bpots/swift/ru/%2Btranslate?show=untranslated) | 52 [52](/swift/trunk/%2Bpots/swift/ru/%2Btranslate?show=new_suggestions) | 2012-12-24 06:28:21 UTC 2012-12-24 |
| [Spanish](/swift/trunk/%2Bpots/swift/es/%2Btranslate) | 196 000.00  100.0% translated | 0 0 | 5 [5](/swift/trunk/%2Bpots/swift/es/%2Btranslate?show=new_suggestions) | 2013-07-10 19:28:26 UTC 2013-07-10 |
| [Swedish](/swift/trunk/%2Bpots/swift/sv/%2Btranslate) | 6 096.94  3.061224489795918% translated  96.93877551020408% untranslated | 190 [190](/swift/trunk/%2Bpots/swift/sv/%2Btranslate?show=untranslated) | 190 [190](/swift/trunk/%2Bpots/swift/sv/%2Btranslate?show=new_suggestions) | 2013-01-15 19:54:17 UTC 2013-01-15 |
| [Tajik](/swift/trunk/%2Bpots/swift/tg/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/tg/%2Btranslate?show=untranslated) | 0 0 | 2020-07-23 06:12:29 UTC 2020-07-23 |
| [Thai](/swift/trunk/%2Bpots/swift/th/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/th/%2Btranslate?show=untranslated) | 28 [28](/swift/trunk/%2Bpots/swift/th/%2Btranslate?show=new_suggestions) | 2017-05-12 11:57:17 UTC 2017-05-12 |
| [Tibetan](/swift/trunk/%2Bpots/swift/bo/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/bo/%2Btranslate?show=untranslated) | 0 0 | 2019-12-12 02:01:45 UTC 2019-12-12 |
| [Turkish](/swift/trunk/%2Bpots/swift/tr/%2Btranslate) | 21 089.29  10.714285714285714% translated  89.28571428571429% untranslated | 175 [175](/swift/trunk/%2Bpots/swift/tr/%2Btranslate?show=untranslated) | 77 [77](/swift/trunk/%2Bpots/swift/tr/%2Btranslate?show=new_suggestions) | 2013-03-31 20:57:29 UTC 2013-03-31 |
| [Ukrainian](/swift/trunk/%2Bpots/swift/uk/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/uk/%2Btranslate?show=untranslated) | 196 [196](/swift/trunk/%2Bpots/swift/uk/%2Btranslate?show=new_suggestions) | 2013-09-20 17:58:38 UTC 2013-09-20 |
| [Uyghur](/swift/trunk/%2Bpots/swift/ug/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/ug/%2Btranslate?show=untranslated) | 1 [1](/swift/trunk/%2Bpots/swift/ug/%2Btranslate?show=new_suggestions) | 2012-03-18 09:34:30 UTC 2012-03-18 |
| [Vietnamese](/swift/trunk/%2Bpots/swift/vi/%2Btranslate) | 0 100.00  100.0% untranslated | 196 [196](/swift/trunk/%2Bpots/swift/vi/%2Btranslate?show=untranslated) | 1 [1](/swift/trunk/%2Bpots/swift/vi/%2Btranslate?show=new_suggestions) | 2012-11-23 04:10:25 UTC 2012-11-23 |

[ [Change your preferred languages...](/%2Beditmylanguages)
—
View all languages
]

![Key to this table: “Unchanged” means](/@@/green-bar)
Translated

![and “untranslated” means just that,](/@@/red-bar)
Untranslated

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from rhn.redhat.com_f571163a_20250125_074925.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2016:0329 - Security Advisory

Issued:
2016-03-01
Updated:
2016-03-01
# RHSA-2016:0329 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: openstack-swift security update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2016%3A0329)

## Topic

Updated openstack-swift packages that fix two security issues are now
available for Red Hat Gluster Storage 3.1 update 2 in Red Hat Enterprise
Linux 6.

Red Hat Product Security has rated this update as having Moderate security
impact. Common Vulnerability Scoring System (CVSS) base scores, which give
detailed severity ratings, are available for each vulnerability from the
CVE links in the References section.

## Description

OpenStack Object Storage (swift) provides object storage in virtual
containers, which allows users to store and retrieve files (arbitrary
data). The service's distributed architecture supports horizontal scaling;
redundancy as failure-proofing is provided through software-based data
replication. Because Object Storage supports asynchronous eventual
consistency replication, it is well suited to multiple data-center
deployment.

A memory-leak issue was found in OpenStack Object Storage (swift), in the
proxy-to-server connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0738)

A memory-leak issue was found in OpenStack Object Storage (swift), in the
client-to-proxy connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0737)

Red Hat would like to thank the OpenStack project for reporting these
issues. Upstream acknowledges Romain Le Disez from OVH and Örjan Persson
from Kiliaro as the original reporters.

All users of openstack-swift are advised to upgrade to these updated
packages, which correct these issues. After installing this update, the
OpenStack Object Storage services will be restarted automatically.

## Solution

Before applying this update, make sure all previously released errata
relevant to your system have been applied.

For details on how to apply this update, refer to:

<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat Gluster Storage Server for On-premise 3 for RHEL 6 x86\_64

## Fixes

* [BZ - 1298905](https://bugzilla.redhat.com/show_bug.cgi?id=1298905)
  - CVE-2016-0738 openstack-swift: Proxy to server DoS through Large Objects
* [BZ - 1298924](https://bugzilla.redhat.com/show_bug.cgi?id=1298924)
  - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects

## CVEs

* [CVE-2015-5223](https://www.redhat.com/security/data/cve/CVE-2015-5223.html)
* [CVE-2016-0737](https://www.redhat.com/security/data/cve/CVE-2016-0737.html)
* [CVE-2016-0738](https://www.redhat.com/security/data/cve/CVE-2016-0738.html)

## References

* <http://www.redhat.com/security/updates/classification/#normal>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat Gluster Storage Server for On-premise 3 for RHEL 6

| SRPM | |
| --- | --- |
| openstack-swift-1.13.1-8.el6ost.src.rpm | SHA-256: 18d3130ee4e4fda4bf4067c57d83c0f513e37de83bd298428b14ec26984ac9b9 |
| x86\_64 | |
| openstack-swift-1.13.1-8.el6ost.noarch.rpm | SHA-256: 1bec3aff2d0122a9c9088ef68164e93113d891b44a4110799708bf2d91d44392 |
| openstack-swift-account-1.13.1-8.el6ost.noarch.rpm | SHA-256: f1e5a8f9540e836d0b6f60b7ff0a0dac5278e77466bb5742b1dd5991bde45ea3 |
| openstack-swift-container-1.13.1-8.el6ost.noarch.rpm | SHA-256: a47257654d58de7501a7b61bbfb70d7c28ba0470abc3ac1304d43c879ba1b87c |
| openstack-swift-doc-1.13.1-8.el6ost.noarch.rpm | SHA-256: 2632773d6341f6a21e31687084f2ca85f29e6f0ae447ffa386df856735216682 |
| openstack-swift-object-1.13.1-8.el6ost.noarch.rpm | SHA-256: ecd7963389ef04e4a037bd362f25c5f63c4581d8e7f8044ea9a3c60412a517e4 |
| openstack-swift-proxy-1.13.1-8.el6ost.noarch.rpm | SHA-256: 69631a5077373b493fd9e0e00b43dd609aa5dd951eb0079850e8b9ed3b5a7091 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from review.openstack.org_d212d7b4_20250126_072225.html ===




=== Content from www.redhat.com_c9d4c12c_20250126_072235.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugs.launchpad.net_86f981b9_20250126_072231.html ===

[Log in / Register](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Bactivity/%2Blogin)

[![](https://launchpadlibrarian.net/52141984/os64.png)](https://launchpad.net/swift)

## [OpenStack Object Storage (swift)](https://launchpad.net/swift)

* [Overview](https://launchpad.net/swift)
* [Code](https://code.launchpad.net/swift)
* [Bugs](https://bugs.launchpad.net/swift)
* [Blueprints](https://blueprints.launchpad.net/swift)
* [Translations](https://translations.launchpad.net/swift)
* [Answers](https://answers.launchpad.net/swift)

1. [Bug #1466549](https://bugs.launchpad.net/swift/%2Bbug/1466549)
2. Activity log

# Activity log for bug #1466549

| Date | Who | What changed | Old value | New value | Message |
| --- | --- | --- | --- | --- | --- |
| 2015-06-18 15:12:19 | [Romain LE DISEZ](https://launchpad.net/~rledisez) | bug |  |  | added bug |
| 2015-06-18 15:23:09 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | bug task added |  | ossa |  |
| 2015-06-18 15:23:18 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | ossa: status | New | Incomplete |  |
| 2015-06-18 15:23:55 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | bug |  |  | added subscriber Swift Core security contacts |
| 2015-06-19 15:29:52 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | information type | Private Security | Public Security |  |
| 2015-06-23 08:16:20 | [OpenStack Infra](https://launchpad.net/~hudson-openstack) | swift: status | New | Fix Committed |  |
| 2015-07-15 21:16:43 | [OpenStack Infra](https://launchpad.net/~hudson-openstack) | tags |  | in-feature-hummingbird |  |
| 2015-07-15 21:16:44 | [OpenStack Infra](https://launchpad.net/~hudson-openstack) | bug watch added |  | http://bugs.python.org/issue16037 |  |
| 2015-07-24 23:48:27 | [OpenStack Infra](https://launchpad.net/~hudson-openstack) | tags | in-feature-hummingbird | in-feature-crypto in-feature-hummingbird |  |
| 2015-08-26 17:14:41 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | ossa: status | Incomplete | Confirmed |  |
| 2015-08-26 17:15:03 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | nominated for series |  | swift/juno |  |
| 2015-08-26 17:15:03 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | nominated for series |  | swift/kilo |  |
| 2015-09-01 12:27:29 | [Thierry Carrez](https://launchpad.net/~ttx) | swift: status | Fix Committed | Fix Released |  |
| 2015-09-01 12:27:29 | [Thierry Carrez](https://launchpad.net/~ttx) | swift: milestone |  | 2.4.0 |  |
| 2016-01-14 06:24:51 | [OpenStack Infra](https://launchpad.net/~hudson-openstack) | tags | in-feature-crypto in-feature-hummingbird | in-feature-crypto in-feature-hummingbird in-stable-kilo |  |
| 2016-01-14 14:58:19 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | summary | Download DLO objects leak connections when client kill connection | Download DLO objects leak connections when client kill connection (CVE-2016-0737) |  |
| 2016-01-14 14:58:26 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | cve linked |  | 2016-0737 |  |
| 2016-01-20 15:00:17 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | summary | Download DLO objects leak connections when client kill connection (CVE-2016-0737) | [OSSA 2016-004] Download DLO objects leak connections when client kill connection (CVE-2016-0737) |  |
| 2016-01-20 20:54:43 | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | ossa: status | Confirmed | Fix Released |  |
| 2016-01-28 16:41:17 | [OpenStack Infra](https://launchpad.net/~hudson-openstack) | cve linked |  | 2016-0738 |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from www.redhat.com_631761e0_20250126_072239.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.redhat.com_ab86f2ce_20250126_072237.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1298924)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1298924)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1298924)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1298924

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1298924**](show_bug.cgi?id=1298924)
(CVE-2016-0737)
- [CVE-2016-0737](https://access.redhat.com/security/cve/CVE-2016-0737) openstack-swift: Client to proxy DoS through Large Objects

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects

| | [Keywords](describekeywords.cgi): | Reopened  Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2016-0737 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1299668](show_bug.cgi?id=1299668) [1299669](show_bug.cgi?id=1299669) [1299670](show_bug.cgi?id=1299670) [1299671](show_bug.cgi?id=1299671) [1300607](show_bug.cgi?id=1300607) [1300608](show_bug.cgi?id=1300608 "CLOSED EOL - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects [fedora-all]") [1308476](show_bug.cgi?id=1308476) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1298929](show_bug.cgi?id=1298929) [1312737](show_bug.cgi?id=1312737) | | TreeView+ | [depends on](buglist.cgi?bug_id=1298924&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1298924&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2016-01-15 12:20 UTC by Adam Mariš | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-06-02 06:49 UTC ([History](show_activity.cgi?id=1298924)) | | [CC List:](page.cgi?id=fields.html#cclist) | 36 users (show)  aavati abaron aortega apevec ayoung chrisw dallan derekh gkotton gmollett jjoyce jrusnack jschluet kbasil lhh lpeer markmc mburns nlevinki osoukup rbryant rfortier sclewis security-response-team sgirijan sisharma slinaber slong smohan srevivo ssaha tdecacqu tshefi vbellur yeylon zaitcev | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: | A memory-leak issue was found in OpenStack Object Storage (swift), in the client-to-proxy connection. An OpenStack-authenticated attacker could remotely trigger this flaw to cause denial of service through excess memory consumption. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2016-03-01 10:31:37 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2016:0126](https://access.redhat.com/errata/RHSA-2016%3A0126) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-08 09:35:30 UTC | | Red Hat Product Errata | [RHSA-2016:0127](https://access.redhat.com/errata/RHSA-2016%3A0127) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-08 09:35:22 UTC | | Red Hat Product Errata | [RHSA-2016:0128](https://access.redhat.com/errata/RHSA-2016%3A0128) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-08 09:35:11 UTC | | Red Hat Product Errata | [RHSA-2016:0155](https://access.redhat.com/errata/RHSA-2016%3A0155) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-10 01:56:35 UTC | | Red Hat Product Errata | [RHSA-2016:0328](https://access.redhat.com/errata/RHSA-2016%3A0328) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-03-01 12:02:03 UTC | | Red Hat Product Errata | [RHSA-2016:0329](https://access.redhat.com/errata/RHSA-2016%3A0329) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-03-01 12:01:20 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1298924#c0)  Adam Mariš    2016-01-15 12:20:58 UTC  ``` A DoS vulnerability in openstack-swift was reported. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service.  Affects versions: >=2.2.1 <= 2.3.0  Upstream patch:  <https://review.openstack.org/#/c/217750/>  There are similar bugs [CVE-2016-0737](https://access.redhat.com/security/cve/CVE-2016-0737) and [CVE-2016-0738](https://access.redhat.com/security/cve/CVE-2016-0738). This ([CVE-2016-0737](https://access.redhat.com/security/cve/CVE-2016-0737)) is for client to proxy connection.   ```  [Comment 4](show_bug.cgi?id=1298924#c4)  Andrej Nemec    2016-01-21 09:35:14 UTC  ```  Created openstack-swift tracking bugs for this issue:  Affects: fedora-all [[bug 1300608](show_bug.cgi?id=1300608 "CLOSED EOL - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects [fedora-all]")]   ```  [Comment 5](show_bug.cgi?id=1298924#c5)  Andrej Nemec    2016-01-21 09:36:47 UTC  ``` This issue is now public.   ```  [Comment 6](show_bug.cgi?id=1298924#c6)  errata-xmlrpc    2016-02-08 04:35:56 UTC  ``` This issue has been addressed in the following products:    OpenStack 6 for RHEL 7  Via RHSA-2016:0128 <https://rhn.redhat.com/errata/RHSA-2016-0128.html>   ```  [Comment 7](show_bug.cgi?id=1298924#c7)  errata-xmlrpc    2016-02-08 04:36:41 UTC  ``` This issue has been addressed in the following products:    OpenStack 5 for RHEL 7  Via RHSA-2016:0127 <https://rhn.redhat.com/errata/RHSA-2016-0127.html>   ```  [Comment 8](show_bug.cgi?id=1298924#c8)  errata-xmlrpc    2016-02-08 04:37:51 UTC  ``` This issue has been addressed in the following products:    OpenStack 5 for RHEL 6  Via RHSA-2016:0126 <https://rhn.redhat.com/errata/RHSA-2016-0126.html>   ```  [Comment 9](show_bug.cgi?id=1298924#c9)  errata-xmlrpc    2016-02-09 20:56:58 UTC  ``` This issue has been addressed in the following products:    OpenStack 7 For RHEL 7  Via RHSA-2016:0155 <https://rhn.redhat.com/errata/RHSA-2016-0155.html>   ```  [Comment 11](show_bug.cgi?id=1298924#c11)  errata-xmlrpc    2016-03-01 07:02:33 UTC  ``` This issue has been addressed in the following products:    Red Hat Gluster Storage 3.1 for RHEL 6  Via RHSA-2016:0329 <https://rhn.redhat.com/errata/RHSA-2016-0329.html>   ```  [Comment 12](show_bug.cgi?id=1298924#c12)  errata-xmlrpc    2016-03-01 07:03:17 UTC  ``` This issue has been addressed in the following products:    Red Hat Gluster Storage 3.1 for RHEL 7  Via RHSA-2016:0328 <https://rhn.redhat.com/errata/RHSA-2016-0328.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1298924&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from security.openstack.org_6a0264c0_20250125_074931.html ===


Toggle navigation

 Search

* [Software](https://www.openstack.org/software/)
  + [Overview](https://www.openstack.org/software/)
  + [OpenStack Components](https://www.openstack.org/software/project-navigator/openstack-components)
  + [SDKs](https://www.openstack.org/software/project-navigator/sdks)
  + [Deployment Tools](https://www.openstack.org/software/project-navigator/deployment-tools)
  + [OpenStack Map](https://www.openstack.org/assets/software/projectmap/openstack-map.pdf)
  + [Sample Configs](https://www.openstack.org/software/sample-configs/)
* [Use Cases](https://www.openstack.org/use-cases/)
  + [Users in Production](https://www.openstack.org/use-cases/)
  + [Ironic Bare Metal](https://www.openstack.org/use-cases/bare-metal/)
  + [Edge Computing](https://www.openstack.org/use-cases/edge-computing/)
  + [Telecom & NFV](https://www.openstack.org/use-cases/telecoms-and-nfv/)
  + [Science and HPC](https://www.openstack.org/use-cases/science/)
  + [Containers](https://www.openstack.org/use-cases/containers/)
  + [Enterprise](https://www.openstack.org/use-cases/enterprise/)
  + [User Survey](https://www.openstack.org/surveys/landing)
* [Events](https://openinfra.dev/summit)
  + [OpenInfra Summit](https://openinfra.dev/summit)
  + [Project Teams Gathering](https://www.openstack.org/ptg/)
  + [OpenDev](https://www.openstack.org/events/opendev-2020/)
  + [Community Events](https://www.openstack.org/events/community-events/)
  + [OpenStack & OpenInfra Days](https://www.openstack.org/events/openstackdays)
  + [Summit Videos](https://www.openstack.org/videos/)
* [Community](https://www.openstack.org/community/)
  + [Welcome! Start Here](https://www.openstack.org/community/)
  + [OpenStack Technical Committee](https://www.openstack.org/community/tech-committee)
  + [Speakers Bureau](https://www.openstack.org/community/speakers/)
  + [OpenStack Wiki](http://wiki.openstack.org)
  + [Get Certified (COA)](https://www.openstack.org/coa/)
  + [Jobs](https://www.openstack.org/community/jobs/)
  + [Marketing Resources](https://www.openstack.org/marketing/)
  + [Community News](https://www.openstack.org/news/)
  + [Superuser Magazine](http://superuser.openstack.org)
  + [OpenInfra Foundation Supporting Organizations](https://www.openstack.org/community/supporting-organizations/)
  + [OpenInfra Foundation](https://openinfra.dev)
* [Marketplace](https://www.openstack.org/marketplace/)
  + [Training](https://www.openstack.org/marketplace/training/)
  + [Distros & Appliances](https://www.openstack.org/marketplace/distros/)
  + [Public Clouds](https://www.openstack.org/marketplace/public-clouds/)
  + [Hosted Private Clouds](https://www.openstack.org/marketplace/hosted-private-clouds/)
  + [Remotely Managed Private Clouds](https://www.openstack.org/marketplace/remotely-managed-private-clouds/)
  + [Consulting & Integrators](https://www.openstack.org/marketplace/consulting/)
  + [Drivers](https://www.openstack.org/marketplace/drivers/)
* [Blog](https://www.openstack.org/blog/)
* [Docs](http://docs.openstack.org/)
* [Join](https://openinfra.dev/join/)
  + [Sign up for Foundation Membership](https://openinfra.dev/join/)
  + [Sponsor the Foundation](https://openinfra.dev/join/)
  + [More about the Foundation](https://openinfra.dev)
* [Log In](https://www.openstack.org/Security/login/?BackURL=/home/)

# OSSA-2016-004: Swift proxy-server DoS through Large Object

# OSSA-2016-004: Swift proxy-server DoS through Large Object[Â¶](#ossa-2016-004-swift-proxy-server-dos-through-large-object "Link to this heading")

Date:

January 20, 2016

CVE:

CVE-2016-0737 (client to proxy),
CVE-2016-0738 (proxy to server)

## Affects[Â¶](#affects "Link to this heading")

* Swift: >=2.2.1 <= 2.3.0, >= 2.4.0 <= 2.5.0

## Description[Â¶](#description "Link to this heading")

Romain LE DISEZ from OVH and Ãrjan Persson from Kiliaro independently reported two vulnerabilities in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. Note that there are two distinct bugs that can exhaust proxy resources, one for client connection (client to proxy), one for servers connection (proxy to server). All Swift setup are affected.

## Patches[Â¶](#patches "Link to this heading")

* <https://review.openstack.org/270234> (proxy to server) (Kilo)
* <https://review.openstack.org/217750> (client to proxy) (Kilo)
* <https://review.openstack.org/270235> (proxy to server) (Liberty)
* <https://review.openstack.org/270233> (proxy to server) (Mitaka)

## Credits[Â¶](#credits "Link to this heading")

* Romain LE DISEZ from OVH (CVE-2016-0737)
* Ãrjan Persson from Kiliaro (CVE-2016-0738)

## References[Â¶](#references "Link to this heading")

* <https://bugs.launchpad.net/bugs/1466549> (client to proxy)
* <https://bugs.launchpad.net/bugs/1493303> (proxy to server)
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-0737> (client to proxy)
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-0738> (proxy to server)

## Notes[Â¶](#notes "Link to this heading")

* The client to proxy issue (CVE-2016-0737) is already fixed in Liberty
* The remaining fix will be included in future 2.3.1 (Kilo) and 2.5.1
  (Liberty) releases.

this page last updated: 2025-01-07 18:17:35

[![Creative Commons Attribution 3.0 License](../_static/images/docs/license.png)](https://creativecommons.org/licenses/by/3.0/)

Except where otherwise noted, this document is licensed under
[Creative Commons
Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/). See all [OpenStack Legal Documents](https://www.openstack.org/legal).

found an error? report a bug

OpenStack Documentation

* Guides
* [Install Guides](https://docs.openstack.org/index.html#install-guides)
* [User Guides](https://docs.openstack.org/index.html#user-guides)
* [Configuration Guides](https://docs.openstack.org/index.html#configuration-guides)
* [Operations and Administration Guides](https://docs.openstack.org/index.html#ops-and-admin-guides)
* [API Guides](https://docs.openstack.org/index.html#api-guides)
* [Contributor Guides](https://docs.openstack.org/index.html#contributor-guides)
* Languages
* [Deutsch (German)](https://docs.openstack.org/de/)
* [FranÃ§ais (French)](https://docs.openstack.org/fr/)
* [Bahasa Indonesia (Indonesian)](https://docs.openstack.org/id/)
* [Italiano (Italian)](https://docs.openstack.org/it/)
* [æ¥æ¬èª (Japanese)](https://docs.openstack.org/ja/)
* [íêµ­ì´ (Korean)](https://docs.openstack.org/ko_KR/)
* [PortuguÃªs (Portuguese)](https://docs.openstack.org/pt_BR/)
* [TÃ¼rkÃ§e (TÃ¼rkiye)](https://docs.openstack.org/tr_TR/)
* [ç®ä½ä¸­æ (Simplified Chinese)](https://docs.openstack.org/zh_CN/)

#### Contents

* OSSA-2016-004: Swift proxy-server DoS through Large Object
  + [Affects](#affects)
  + [Description](#description)
  + [Patches](#patches)
  + [Credits](#credits)
  + [References](#references)
  + [Notes](#notes)

### OpenStack

* [Projects](https://www.openstack.org/software/project-navigator/)
* [OpenStack Security](https://security.openstack.org/)
* [Blog](https://openstack.org/blog/)
* [News](https://openstack.org/news/)

### Community

* [User Groups](https://www.meetup.com/pro/openinfradev/)
* [Events](https://openstack.org/community/events/)
* [Jobs](https://openstack.org/community/jobs/)
* [Companies](https://openinfra.dev/members/)
* [Contribute](https://docs.openstack.org/contributors)

### Documentation

* [OpenStack Manuals](https://docs.openstack.org)
* [Getting Started](https://openstack.org/software/start/)
* [API Documentation](https://developer.openstack.org)
* [Wiki](https://wiki.openstack.org)

### Branding & Legal

* [Legal Docs](https://openinfra.dev/legal)
* [Logos & Guidelines](https://openstack.org/brand/)
* [Trademark Policy](https://openinfra.dev/legal/trademark-policy)
* [Privacy Policy](https://openinfra.dev/privacy-policy)
* [OpenInfra CLA](https://docs.openstack.org/contributors/common/setup-gerrit.html#individual-contributor-license-agreement)

### Stay In Touch

The OpenStack project is provided under the
[Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0). Docs.openstack.org is powered by
[Rackspace Cloud Computing](https://rackspace.com).



=== Content from launchpad.net_64cff20c_20250126_072229.html ===

[Log in / Register](https://launchpad.net/~rledisez/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~rledisez)

## [Romain LE DISEZ](https://launchpad.net/~rledisez)

* Overview
* [Code](https://code.launchpad.net/~rledisez)
* [Bugs](https://bugs.launchpad.net/~rledisez)
* [Blueprints](https://blueprints.launchpad.net/~rledisez)
* [Translations](https://translations.launchpad.net/~rledisez)
* [Answers](https://answers.launchpad.net/~rledisez)

* [Related packages](https://launchpad.net/~rledisez/%2Brelated-packages)
* [Related projects](https://launchpad.net/~rledisez/%2Brelated-projects)

## User information

Launchpad Id:
rledisez

Email:
[Log in](%2Blogin) for email information.

Member since:
2015-06-12

Languages:

English

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~rledisez/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All bugs in progress](https://launchpad.net/~rledisez/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1772988 [Upgrade procedure performance issues](https://bugs.launchpad.net/keystone/%2Bbug/1772988) |  |
| --- | --- | --- |
| in [OpenStack Identity (keystone)](/keystone) | | |

| --- | --- | --- | --- | --- | --- |
||  | #1669579 [servers\_per\_port will not bind to replication\_port](https://bugs.launchpad.net/swift/%2Bbug/1669579) |  |
| --- | --- | --- |
| in [OpenStack Object Storage (swift)](/swift) | | |

## Latest memberships

Romain LE DISEZ is not an
active member of any Launchpad teams.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_358978c3_20250126_072226.html ===

[Log in / Register](https://launchpad.net/~hudson-openstack/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~hudson-openstack)

## [OpenStack Infra](https://launchpad.net/~hudson-openstack)

* Overview
* [Code](https://code.launchpad.net/~hudson-openstack)
* [Bugs](https://bugs.launchpad.net/~hudson-openstack)
* [Blueprints](https://blueprints.launchpad.net/~hudson-openstack)
* [Translations](https://translations.launchpad.net/~hudson-openstack)
* [Answers](https://answers.launchpad.net/~hudson-openstack)

* [Related packages](https://launchpad.net/~hudson-openstack/%2Brelated-packages)
* [Related projects](https://launchpad.net/~hudson-openstack/%2Brelated-projects)

## User information

Launchpad Id:
hudson-openstack

Email:
[Log in](%2Blogin) for email information.

Member since:
2010-07-14

[![Icon of Burrow](https://launchpadlibrarian.net/67728214/os14.png "Member of Burrow")](/~burrow)
[![Icon of Citrix OpenStack development team](https://launchpadlibrarian.net/64472709/Citrix%2014.png "Member of Citrix OpenStack development team")](/~citrix-openstack)
[![Icon of (deprecated) OpenStack PPA maintainers](https://launchpadlibrarian.net/87891894/ppa.gif "Member of (deprecated) OpenStack PPA maintainers")](/~openstack-ppa)
[![Icon of Designate Core](https://launchpadlibrarian.net/360468328/designate_14.jpg "Member of Designate Core")](/~designate-core)
[![Icon of Designate Drivers](https://launchpadlibrarian.net/360468067/designate_14.jpg "Member of Designate Drivers")](/~designate-drivers)
[![Icon of MidoNet Bugs](https://launchpadlibrarian.net/228074955/midonet_14x14.png "Member of MidoNet Bugs")](/~midonet-bugs)
[![Icon of Nova Bug Team](https://launchpadlibrarian.net/108832444/bug.gif "Member of Nova Bug Team")](/~nova-bugs)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

OpenPGP keys:

72571ACC301E6FE900837F5CDF85501232EE128C

SSH keys:

[hudson@hudson](%2Bsshkeys)

[jenkins@vpcslave](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[6535](https://launchpad.net/~hudson-openstack/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All memberships](https://launchpad.net/~hudson-openstack/%2Bparticipation) Latest memberships

| [Compute Hyper-V Bugs](/~compute-hyperv-bugs)  Joined on 2019-08-28 | |
| --- | --- |
| [OS-Win Bugs](/~os-win-bugs)  Joined on 2019-08-28 | |
| [Networking Hyper-V Bugs](/~networking-hyperv-bugs)  Joined on 2019-08-28 | |
| [kolla-drivers](/~kolla-drivers)  Joined on 2019-05-20 | |
| [fixtures-git-bugs](/~fixtures-git-bugs)  Joined on 2018-03-25 | |

## [Recent activities](https://launchpad.net/~hudson-openstack/%2Bkarma) Most active in

| [StarlingX](/starlingx) |  |
| --- | --- |
| [kolla-ansible](/kolla-ansible) |  |
| [kolla](/kolla) |  |
| [kayobe](/kayobe) |  |
| [OpenStack Compute (nova)](/nova) |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


