=== Content from www.oracle.com_1aa3bc48_20250125_144123.html ===


* [Skip to content](#maincontent)
* [Accessibility Policy](https://www.oracle.com/corporate/accessibility/)

Products
Industries
Resources
Customers
Partners
Developers
Company

Close Search

Search Oracle.com

* QUICK LINKS
* [Oracle Cloud Infrastructure](/cloud/)
* [Oracle Fusion Cloud Applications](/applications/)
* [Oracle Database](/database/technologies/)
* [Download Java](/java/technologies/downloads/)
* [Careers at Oracle](/careers/)

Search

[Country
![]()](/countries-list.html#countries)

View Accounts

Back
Cloud Account
[Sign in to Cloud](/cloud/sign-in.html)
[Sign Up for Free Cloud Tier](/cloud/free/)

Oracle Account

* [Sign-In](https://www.oracle.com/webapps/redirect/signon?nexturl=)
* [Create an Account](https://profile.oracle.com/myprofile/account/create-account.jspx)

* [Help](/corporate/contact/help.html)
* Sign Out

[Contact Sales](/corporate/contact/ "Contact Sales")

[Menu

Menu](/global-menu-v2/)

* [Security Alerts](/security-alerts/)

# Oracle Solaris Third Party Bulletin - April 2016

## Oracle Solaris Third Party Bulletin - April 2016

### Description

The Oracle Solaris Third Party Bulletin announces patches for one or more security vulnerabilities fixed in third party software that is included in Oracle Solaris distributions. Starting January 20, 2015, Third Party Bulletins are released on the same day when Oracle Critical Patch Updates are released. These bulletins will also be updated on the Tuesday closest to the 17th of the following two months after their release (i.e. the two months between the normal quarterly Critical Patch Update publication dates). In addition, Third Party Bulletins may also be updated for vulnerability fixes deemed too critical to wait for the next monthly update.

**Due to the threat posed by a successful attack, Oracle strongly recommends that customers apply Third Party Bulletin fixes as soon as possible.**

### Patch Availability

Please see My Oracle Support Note [1448883.1](https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=98356520554156&id=1448883.1)

### Third Party Bulletin Schedule

Third Party Bulletins are released on the Tuesday closest to the 17th day of January, April, July and October. The next four dates are:

* 19 July 2016
* 18 October 2016
* 17 January 2017
* 18 April 2017

### References

* Oracle Critical Patch Updates and Security Alerts main page  [ [Oracle Technology Network](/security-alerts/) ]
* Oracle Critical Patch Updates and Security Alerts - Frequently Asked Questions [ [CPU FAQ](/security-alerts/cpufaq.html) ]
* Risk Matrix definitions   [ [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html) ]
* Use of Common Vulnerability Scoring System (CVSS) by Oracle   [ [Oracle CVSS Scoring](/security-alerts/cvssscoringsystem.html) ]

### Modification History

| 2017-October-16 | Rev 8. Added 11.3 as Supported Versions Affected for CVE-2016-2108 |
| --- | --- |
| 2016-September-21 | Rev 7. Added new CVEs fixed via Firefox upgrade |
| 2016-July-08 | Rev 6. Added NTP CVEs |
| 2016-June-27 | Rev 5. Added OpenSSL CVE-2016-2177, CVE-2016-2178 |
| 2016-June-20 | Rev 4. Added all CVEs fixed in Solaris 11.3 SRU9.4 |
| 2016-June-10 | Rev 3. Added OpenSSL CVEs |
| 2016-May-31 | Rev 2. Added all CVEs fixed in Solaris 11.3 SRU8.7 |
| 2016-April-19 | Rev 1. Initial Release |

### Oracle Solaris Executive Summary

This Third Party Bulletin contains 53 new security fixes for the Oracle Solaris.  41 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without the need for a username and password.

### Oracle Solaris Risk Matrix

#### Revision 7: Published on 2016-09-21

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2014-1545 | Solaris | Multiple | Firefox | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3 | See Note 13 |

#### Revision 6: Published on 2016-07-08

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-1548 | Solaris | NTP | NTP | Yes | 6.4 | Network | Low | None | None | Partial | Partial | 11.3, 10 | See Note 11 |
| CVE-2016-4957 | Solaris | NTP | NTP | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-4956 | Solaris | NTP | NTP | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-4953 | Solaris | NTP | NTP | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-4954 | Solaris | NTP | NTP | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-4955 | Solaris | NTP | NTP | Yes | 2.6 | Network | High | None | None | None | Partial | 11.3, 10 |  |

#### Revision 5: Published on 2016-06-27

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-2177 | Solaris | SSL/TLS | OpenSSL | Yes | 7.5 | Network | Low | None | Partial | Partial | Partial | 11.3, 10 |  |
| CVE-2016-2178 | Solaris | SSL/TLS | OpenSSL | No | 2.1 | Local | Low | None | Partial | None | None | 11.3, 10 |  |

#### Revision 4: Published on 2016-06-20

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2015-2806 | Solaris | Multiple | GNU Libtasn1 | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3 |  |
| CVE-2014-9679 | Solaris | Multiple | Common Unix Printing System (CUPS) | Yes | 6.8 | Network | Medium | None | Partial | Partial | Partial | 11.3 |  |
| CVE-2015-8786 | Solaris | Multiple | RabbitMQ | No | 6.8 | Network | Low | Single | None | None | Complete | 11.3 |  |
| CVE-2015-7546 | Solaris | Multiple | OpenStack Identity (Keystone) | No | 6.0 | Network | Medium | Single | Partial | Partial | Partial | 11.3 |  |
| CVE-2015-5295 | Solaris | Multiple | OpenStack Orchestration API (Heat) | No | 5.5 | Network | Low | Single | Partial | None | Partial | 11.3 |  |
| CVE-2016-3115 | Solaris | SSH | OpenSSH | No | 5.5 | Network | Low | Single | Partial | Partial | None | 11.3 |  |
| CVE-2015-5223 | Solaris | Multiple | OpenStack Object Storage (Swift) | Yes | 5.0 | Network | Low | None | Partial | None | None | 11.3 |  |
| CVE-2016-0738 | Solaris | Multiple | OpenStack Object Storage (Swift) | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3 | See Note 8 |
| CVE-2015-8853 | Solaris | Multiple | Perl | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3 |  |
| CVE-2015-8665 | Solaris | Multiple | LibTIFF | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3 |  |
| CVE-2015-8683 | Solaris | Multiple | LibTIFF | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3 |  |
| CVE-2015-8781 | Solaris | Multiple | LibTIFF | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3, 10 | See Note 9 |
| CVE-2015-1547 | Solaris | Multiple | LibTIFF | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3, 10 | See Note 10 |
| CVE-2016-2512 | Solaris | Multiple | Django Python web framework | Yes | 4.3 | Network | Medium | None | None | Partial | None | 11.3 |  |
| CVE-2016-4085 | Solaris | Multiple | Wireshark | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3 | See Note 12 |
| CVE-2016-2513 | Solaris | Multiple | Django Python web framework | Yes | 2.6 | Network | High | None | Partial | None | None | 11.3 |  |

#### Revision 3: Published on 2016-06-10

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-2108 | Solaris | SSL/TLS | OpenSSL | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3, 10 |  |
| CVE-2016-2109 | Solaris | SSL/TLS | OpenSSL | Yes | 7.8 | Network | Low | None | None | None | Complete | 11.3, 10 |  |
| CVE-2016-2176 | Solaris | SSL/TLS | OpenSSL | Yes | 6.4 | Network | Low | None | Partial | None | Partial | 11.3, 10 |  |
| CVE-2016-2105 | Solaris | SSL/TLS | OpenSSL | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-2106 | Solaris | SSL/TLS | OpenSSL | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-2107 | Solaris | SSL/TLS | OpenSSL | Yes | 2.6 | Network | High | None | Partial | None | None | 11.3, 10 | See Note 7 |

#### Revision 2: Published on 2016-05-31

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-2315 | Solaris | Multiple | Git | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3 | See Note 5 |
| CVE-2016-2342 | Solaris | Multiple | Quagga | Yes | 7.6 | Network | High | None | Complete | Complete | Complete | 11.3 |  |
| CVE-2015-7545 | Solaris | Multiple | Git | Yes | 7.5 | Network | Low | None | Partial | Partial | Partial | 11.3 |  |
| CVE-2015-2695 | Solaris | Kerberos | Kerberos | Yes | 7.1 | Network | Medium | None | None | None | Complete | 11.3 |  |
| CVE-2015-2697 | Solaris | Kerberos | Kerberos | No | 6.8 | Network | Low | Single | None | None | Complete | 11.3 |  |
| CVE-2016-3068 | Solaris | Multiple | Mercurial source code management | Yes | 6.8 | Network | Medium | None | Partial | Partial | Partial | 11.3 | See Note 4 |
| CVE-2016-3115 | Solaris | SSH | SSH | No | 5.5 | Network | Low | Single | Partial | Partial | None | 11.3, 10 |  |
| CVE-2014-3566 | Solaris | SSL | Evolution | Yes | 5.0 | Network | Low | None | Partial | None | None | 11.3 |  |
| CVE-2015-7551 | Solaris | None | Ruby | No | 4.6 | Local | Low | None | Partial | Partial | Partial | 11.3 |  |
| CVE-2015-8629 | Solaris | Kerberos | Kerberos | No | 2.1 | Network | High | Single | Partial | None | None | 11.3, 10 |  |

#### Revision 1: Published on 2016-04-19

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-0705 | Solaris | SSL/TLS | OpenSSL | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3, 10 |  |
| CVE-2016-0799 | Solaris | SSL/TLS | WanBoot | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 10 | See Note 1 |
| CVE-2016-0798 | Solaris | SSL/TLS | OpenSSL | Yes | 7.8 | Network | Low | None | None | None | Complete | 11.3, 10 |  |
| CVE-2015-3415 | Solaris | Multiple | SQLite3 | Yes | 7.5 | Network | Low | None | Partial | Partial | Partial | 11.3, 10 | See Note 3 |
| CVE-2015-5602 | Solaris | None | Sudo | No | 7.2 | Local | Low | None | Complete | Complete | Complete | 11.3, 10 |  |
| CVE-2015-4752 | Solaris | None | MySQL | No | 7.2 | Local | Low | None | Complete | Complete | Complete | 11.3 | See Note 2 |
| CVE-2016-2523 | Solaris | Multiple | Wireshark | Yes | 7.1 | Network | Medium | None | None | None | Complete | 11.3 |  |
| CVE-2016-1283 | Solaris | Multiple | PCRE | Yes | 6.8 | Network | Medium | None | Partial | Partial | Partial | 11.3 |  |
| CVE-2014-9766 | Solaris | Multiple | X.Org | Yes | 6.8 | Network | Medium | None | Partial | Partial | Partial | 11.3, 10 |  |
| CVE-2015-3885 | Solaris | Multiple | Dcraw | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3 |  |
| CVE-2007-6720 | Solaris | Multiple | Libmikmod | Yes | 2.6 | Network | High | None | None | None | Partial | 11.3 |  |
| CVE-2016-0702 | Solaris | None | OpenSSL | No | 1.9 | Local | Medium | None | Partial | None | None | 11.3, 10 | See Note 6 |

#### Notes:

1. This fix also addresses CVE-2016-0703 CVE-2016-0704 CVE-2016-0797 CVE-2016-0800.
2. This fix also addresses CVE-2014-6464 CVE-2014-6469 CVE-2014-6491 CVE-2014-6494 CVE-2014-6500 CVE-2014-6507 CVE-2014-6555 CVE-2014-6559 CVE-2014-6568 CVE-2015-0374 CVE-2015-0382 CVE-2015-0411 CVE-2015-0432 CVE-2015-0433 CVE-2015-0499 CVE-2015-0505 CVE-2015-2568 CVE-2015-2571 CVE-2015-2573 CVE-2015-2582 CVE-2015-2620 CVE-2015-2643 CVE-2015-2648 CVE-2015-4737 CVE-2015-4792 CVE-2015-4802 CVE-2015-4807 CVE-2015-4815 CVE-2015-4816 CVE-2015-4819 CVE-2015-4826 CVE-2015-4830 CVE-2015-4836 CVE-2015-4858 CVE-2015-4861 CVE-2015-4864 CVE-2015-4870 CVE-2015-4879 CVE-2015-4913 CVE-2015-7744 CVE-2016-0505 CVE-2016-0546 CVE-2016-0596 CVE-2016-0597 CVE-2016-0598 CVE-2016-0600 CVE-2016-0606 CVE-2016-0608 CVE-2016-0609 CVE-2016-0616.
3. This fix also addresses CVE-2015-3414 CVE-2015-3416.
4. This fix also addresses CVE-2016-3069 CVE-2016-3630.
5. This fix also addresses CVE-2016-2324.
6. This fix also addresses CVE-2016-0702 CVE-2016-0797 CVE-2016-0799.
7. This fix also addresses CVE-2016-2106 CVE-2016-2107 CVE-2016-2108 CVE-2016-2109 CVE-2016-2176.
8. This fix also addresses CVE-2016-0737.
9. This fix also addresses CVE-2015-8782 CVE-2015-8783.
10. This fix also addresses CVE-2015-8784.
11. This fix also addresses CVE-2016-1551 CVE-2016-1549 CVE-2016-2516 CVE-2016-2517 CVE-2016-2518 CVE-2016-2519 CVE-2016-1547 CVE-2015-7704 CVE-2015-8138 CVE-2016-1550.
12. This fix also addresses CVE-2016-4085.
13. This fix also addresses CVE-2013-5609 CVE-2013-5610 CVE-2013-5611 CVE-2013-5612 CVE-2013-5613 CVE-2013-5614 CVE-2013-5615 CVE-2013-5616 CVE-2013-5618 CVE-2013-5619 CVE-2013-6629 CVE-2013-6630 CVE-2013-6671 CVE-2013-6672 CVE-2013-6673 CVE-2014-1477 CVE-2014-1478 CVE-2014-1479 CVE-2014-1480 CVE-2014-1481 CVE-2014-1482 CVE-2014-1483 CVE-2014-1484 CVE-2014-1485 CVE-2014-1486 CVE-2014-1487 CVE-2014-1488 CVE-2014-1489 CVE-2014-1493 CVE-2014-1494 CVE-2014-1496 CVE-2014-1497 CVE-2014-1498 CVE-2014-1499 CVE-2014-1500 CVE-2014-1501 CVE-2014-1502 CVE-2014-1504 CVE-2014-1505 CVE-2014-1506 CVE-2014-1507 CVE-2014-1508 CVE-2014-1509 CVE-2014-1510 CVE-2014-1511 CVE-2014-1512 CVE-2014-1513 CVE-2014-1514 CVE-2014-1518 CVE-2014-1519 CVE-2014-1520 CVE-2014-1522 CVE-2014-1523 CVE-2014-1524 CVE-2014-1525 CVE-2014-1526 CVE-2014-1527 CVE-2014-1528 CVE-2014-1529 CVE-2014-1530 CVE-2014-1531 CVE-2014-1532 CVE-2014-1533 CVE-2014-1534 CVE-2014-1536 CVE-2014-1537 CVE-2014-1538 CVE-2014-1539 CVE-2014-1540 CVE-2014-1541 CVE-2014-1542 CVE-2014-1543 CVE-2014-1544 CVE-2014-1547 CVE-2014-1548 CVE-2014-1549 CVE-2014-1550 CVE-2014-1551 CVE-2014-1552 CVE-2014-1553 CVE-2014-1554 CVE-2014-1555 CVE-2014-1556 CVE-2014-1557 CVE-2014-1559 CVE-2014-1561 CVE-2014-1562 CVE-2014-1563 CVE-2014-1564 CVE-2014-1565 CVE-2014-1566 CVE-2014-1567 CVE-2014-1568 CVE-2014-1569 CVE-2014-1575 CVE-2014-1580 CVE-2014-1582 CVE-2014-1584 CVE-2014-1588 CVE-2014-1589 CVE-2014-1591 CVE-2014-1595 CVE-2014-2018 CVE-2014-8631 CVE-2014-8632 CVE-2014-8635 CVE-2014-8636 CVE-2014-8637 CVE-2014-8640 CVE-2014-8642 CVE-2014-8643 CVE-2015-0797 CVE-2015-0798 CVE-2015-0799 CVE-2015-0800 CVE-2015-0802 CVE-2015-0803 CVE-2015-0804 CVE-2015-0805 CVE-2015-0806 CVE-2015-0808 CVE-2015-0810 CVE-2015-0811 CVE-2015-0812 CVE-2015-0814 CVE-2015-0819 CVE-2015-0820 CVE-2015-0821 CVE-2015-0823 CVE-2015-0824 CVE-2015-0825 CVE-2015-0826 CVE-2015-0828 CVE-2015-0829 CVE-2015-0830 CVE-2015-0832 CVE-2015-0833 CVE-2015-0834 CVE-2015-0835 CVE-2015-2706 CVE-2015-2708 CVE-2015-2709 CVE-2015-2710 CVE-2015-2711 CVE-2015-2712 CVE-2015-2713 CVE-2015-2714 CVE-2015-2715 CVE-2015-2716 CVE-2015-2717 CVE-2015-2718 CVE-2015-2720 CVE-2015-2721 CVE-2015-2722 CVE-2015-2724 CVE-2015-2725 CVE-2015-2726 CVE-2015-2727 CVE-2015-2728 CVE-2015-2729 CVE-2015-2730 CVE-2015-2731 CVE-2015-2733 CVE-2015-2734 CVE-2015-2735 CVE-2015-2736 CVE-2015-2737 CVE-2015-2738 CVE-2015-2739 CVE-2015-2740 CVE-2015-2741 CVE-2015-2742 CVE-2015-2743 CVE-2015-4473 CVE-2015-4474 CVE-2015-4475 CVE-2015-4476 CVE-2015-4477 CVE-2015-4478 CVE-2015-4479 CVE-2015-4480 CVE-2015-4481 CVE-2015-4482 CVE-2015-4483 CVE-2015-4484 CVE-2015-4485 CVE-2015-4486 CVE-2015-4487 CVE-2015-4488 CVE-2015-4489 CVE-2015-4490 CVE-2015-4491 CVE-2015-4492 CVE-2015-4493 CVE-2015-4495 CVE-2015-4496 CVE-2015-4497 CVE-2015-4498 CVE-2015-4500 CVE-2015-4501 CVE-2015-4502 CVE-2015-4503 CVE-2015-4504 CVE-2015-4505 CVE-2015-4506 CVE-2015-4507 CVE-2015-4508 CVE-2015-4509 CVE-2015-4510 CVE-2015-4511 CVE-2015-4512 CVE-2015-4513 CVE-2015-4514 CVE-2015-4515 CVE-2015-4516 CVE-2015-4517 CVE-2015-4518 CVE-2015-4519 CVE-2015-4520 CVE-2015-4521 CVE-2015-4522 CVE-2015-7174 CVE-2015-7175 CVE-2015-7176 CVE-2015-7177 CVE-2015-7178 CVE-2015-7179 CVE-2015-7180 CVE-2015-7181 CVE-2015-7182 CVE-2015-7183 CVE-2015-7184 CVE-2015-7185 CVE-2015-7186 CVE-2015-7187 CVE-2015-7188 CVE-2015-7189 CVE-2015-7190 CVE-2015-7191 CVE-2015-7192 CVE-2015-7193 CVE-2015-7194 CVE-2015-7195 CVE-2015-7196 CVE-2015-7197 CVE-2015-7198 CVE-2015-7199 CVE-2015-7200.

Resources for

* [Careers](/careers/)
* [Developers](/developer/)
* [Investors](https://investor.oracle.com/home/default.aspx)
* [Partners](/partner/)
* [Researchers](/research/)
* [Students and Educators](https://academy.oracle.com/en/oa-web-overview.html)

Why Oracle

* [Analyst Reports](/corporate/analyst-reports/)
* [Best cloud-based
  ERP](/erp/what-is-erp/best-erp/)
* [Cloud Economics](/cloud/economics/)
* [Social Impact](/social-impact/)
* [Culture and Inclusion](/careers/diversity-inclusion/)
* [Security Practices](/corporate/security-practices/)

Learn

* [What is cloud
  computing?](/cloud/what-is-cloud-computing/)
* [What is CRM?](/cx/what-is-crm/)
* [What is
  Docker?](/cloud/cloud-native/container-registry/what-is-docker/)
* [What is
  Kubernetes?](/cloud/cloud-native/kubernetes-engine/what-is-kubernetes/)
* [What is
  Python?](/developer/what-is-python-for-developers/)
* [What is SaaS?](/applications/what-is-saas/)

News and Events

* [News](/news/)
* [Oracle CloudWorld](/cloudworld/)
* [Oracle CloudWorld Tour](/cloudworld-tour/)
* [Oracle Health Summit](/health/health-summit/)
* [Oracle Dev Tour](/developer/dev-tour/)
* [Search all events](https://search.oracle.com/events?q=&lang=english)

Contact Us

* US Sales: +1.800.633.0738
* [How can we help?](/corporate/contact/)
* [Subscribe to emails](https://go.oracle.com/subscribe/?l_code=en&src1=OW:O:FO)
* [Integrity Helpline](https://secure.ethicspoint.com/domain/media/en/gui/31053/index.html)
* [Accessibility](/corporate/accessibility/)

---

* [Country/Region](/universal-menu/#u10countrymenu)

* [© 2025 Oracle](/legal/copyright/)
* [Privacy](/legal/privacy/)/[Do Not Sell My
  Info](/legal/privacy/privacy-choices/)
* [Ad
  Choices](/legal/privacy/privacy-policy/#adchoices)
* [Careers](/corporate/careers/)



=== Content from review.openstack.org_c2d4408c_20250126_093634.html ===




=== Content from www.redhat.com_ad877dc3_20250126_093648.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from review.openstack.org_d212d7b4_20250126_093630.html ===




=== Content from review.openstack.org_6db25186_20250126_093634.html ===




=== Content from bugs.launchpad.net_fc3085bd_20250126_093655.html ===

[Log in / Register](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/cloud-archive)

## [Ubuntu Cloud Archive](https://launchpad.net/cloud-archive)

* [Overview](https://launchpad.net/cloud-archive)
* [Code](https://code.launchpad.net/cloud-archive)
* [Bugs](https://bugs.launchpad.net/cloud-archive)
* [Blueprints](https://blueprints.launchpad.net/cloud-archive)
* [Translations](https://translations.launchpad.net/cloud-archive)
* [Answers](https://answers.launchpad.net/cloud-archive)

# [OSSA 2016-004] Swift proxy memory leak on unfinished read (CVE-2016-0738)

Bug #1493303 reported by
[Örjan Fors](https://launchpad.net/~orrriot)
on 2015-09-08

[288](/%2Bhelp-bugs/bug-heat.html)

This bug affects 4 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Object Storage (swift)](https://bugs.launchpad.net/swift) | Fix Released | Critical | Unassigned |  |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |
|  | [Ubuntu Cloud Archive](https://bugs.launchpad.net/cloud-archive) | Invalid | High | Unassigned |  |
|  | [Icehouse](https://bugs.launchpad.net/cloud-archive/icehouse) | Won't Fix | Undecided | Unassigned |  |
|  | [Kilo](https://bugs.launchpad.net/cloud-archive/kilo) | Won't Fix | Undecided | Unassigned |  |
|  | [Liberty](https://bugs.launchpad.net/cloud-archive/liberty) | Won't Fix | Undecided | Unassigned |  |
|  | [Mitaka](https://bugs.launchpad.net/cloud-archive/mitaka) | Fix Released | Undecided | Unassigned |  |
|  | [swift (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/swift "Latest release: 2.34.0+git2025011510.f95315b71-0ubuntu1, uploaded to main on 2025-01-21 10:50:10.706385+00:00 by Myles Penner (myles-penner), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | High | Unassigned |  |
|  | [Trusty](https://bugs.launchpad.net/ubuntu/trusty/%2Bsource/swift) | Fix Released | High | Unassigned |  |
|  | [Wily](https://bugs.launchpad.net/ubuntu/wily/%2Bsource/swift) | Won't Fix | Undecided | Unassigned |  |
|  | [Xenial](https://bugs.launchpad.net/ubuntu/xenial/%2Bsource/swift) | Fix Released | Undecided | Unassigned |  |
|  | [Yakkety](https://bugs.launchpad.net/ubuntu/yakkety/%2Bsource/swift) | Fix Released | High | Unassigned |  |

### Bug Description

It looks like the Swift proxy will leak memory if the connection is closed and the full response is not read. This opens for a potential DoS attacks.

Reproduce:

$ swift -A <http://localhost:8888/auth/v1.0> -U .. -K .. upload --use-slo --segment-size 1048576 <container> <big-file>

$ curl -H'X-Auth-Token: AUTH\_...' "<http://localhost:8888/v1/AUTH_../><container>/<big-file>" -m 0.001 > /dev/null

Repeat the curl command a couple of times and you will have more information in netstat and sockstat. The important part is the -m which sets the max time curl spends at downloading. After that point, it'll close the connection.

$ sudo netstat -ant -p | grep :6000

$ cat /proc/net/sockstat

tcp 0 0 127.0.0.1:6000 0.0.0.0:\* LISTEN 1358/python

tcp 0 43221 127.0.0.1:6000 127.0.0.1:48350 FIN\_WAIT1 -

tcp 0 43221 127.0.0.1:6000 127.0.0.1:48882 FIN\_WAIT1 -

tcp 939820 0 127.0.0.1:48350 127.0.0.1:6000 ESTABLISHED 17897/python

tcp 939820 0 127.0.0.1:48882 127.0.0.1:6000 ESTABLISHED 17890/python

tcp 983041 0 127.0.0.1:48191 127.0.0.1:6000 CLOSE\_WAIT 17897/python

tcp 983041 0 127.0.0.1:48948 127.0.0.1:6000 CLOSE\_WAIT 17892/python

Restarting the proxy frees up the lingering memory.

This problem did not exist in 2.2.0.

ProblemType: Bug

DistroRelease: Ubuntu 14.04

Package: swift 2.2.2-0ubuntu1~cloud0 [origin: Canonical]

ProcVersionSignature: Ubuntu 3.16.0-48.64~14.04.1-generic 3.16.7-ckt15

Uname: Linux 3.16.0-48-generic x86\_64

ApportVersion: 2.14.1-0ubuntu3.12

Architecture: amd64

CrashDB:

 {

                "impl": "launchpad",

                "project": "cloud-archive",

                "bug\_pattern\_url": "<http://people.canonical.com/~ubuntu-archive/bugpatterns/bugpatterns.xml>",

             }

Date: Tue Sep 8 09:55:05 2015

InstallationDate: Installed on 2015-06-22 (77 days ago)

InstallationMedia: Ubuntu-Server 14.04.2 LTS "Trusty Tahr" - Release amd64 (20150218.1)

PackageArchitecture: all

SourcePackage: swift

UpgradeStatus: No upgrade log present (probably fresh install)

See [original description](comments/0)

Tags:

[patch](/cloud-archive/%2Bbugs?field.tag=patch)
[amd64](/cloud-archive/%2Bbugs?field.tag=amd64)
[apport-bug](/cloud-archive/%2Bbugs?field.tag=apport-bug)
[in-feature-crypto](/cloud-archive/%2Bbugs?field.tag=in-feature-crypto)
[in-feature-hummingbird](/cloud-archive/%2Bbugs?field.tag=in-feature-hummingbird)
[in-stable-kilo](/cloud-archive/%2Bbugs?field.tag=in-stable-kilo)
[in-stable-liberty](/cloud-archive/%2Bbugs?field.tag=in-stable-liberty)
[third-party-packages](/cloud-archive/%2Bbugs?field.tag=third-party-packages)
[trusty](/cloud-archive/%2Bbugs?field.tag=trusty)

## CVE References

* [2015-5223](/bugs/cve/2015-5223 "OpenStack Object Storage (Swift) befo...")
* [2016-0737](/bugs/cve/2016-0737 "OpenStack Object Storage (Swift) befo...")
* [2016-0738](/bugs/cve/2016-0738 "OpenStack Object Storage (Swift) befo...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Örjan Fors (orrriot)](https://launchpad.net/~orrriot) wrote on 2015-09-08: |  |  | [#1](/cloud-archive/%2Bbug/1493303/comments/1) |
| --- | --- | --- | --- |

* [Dependencies.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459119/%2Bfiles/Dependencies.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459119)
  (2.3 KiB,
  text/plain; charset="utf-8")
* [ProcEnviron.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459120/%2Bfiles/ProcEnviron.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459120)
  (124 bytes,
  text/plain; charset="utf-8")

[James Page (james-page)](https://launchpad.net/~james-page)
on 2015-09-17

| Changed in cloud-archive: | |
| --- | --- |
| **importance**: | Undecided → Critical |
| **importance**: | Critical → High |
| Changed in swift (Ubuntu): | |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-17: |  |  | [#2](/cloud-archive/%2Bbug/1493303/comments/2) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |
| **description**: | updated |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-17: |  |  | [#3](/cloud-archive/%2Bbug/1493303/comments/3) |
| --- | --- | --- | --- |

From the description it sounds like this bug impacts the stable/kilo and master (liberty) branches, but not the stable/juno branch.

From the description it sounds like this bug impacts the stable/kilo and master (liberty) branches, but not the stable/juno branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-25: |  |  | [#4](/cloud-archive/%2Bbug/1493303/comments/4) |
| --- | --- | --- | --- |

@swift-coresec, is this a duplicate of [bug 1466549](/bugs/1466549) ?

@swift-coresec, is this a duplicate of bug 1466549 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-10-13: |  |  | [#5](/cloud-archive/%2Bbug/1493303/comments/5) |
| --- | --- | --- | --- |

@swift-coresec, can you triage this bug report please ?

@swift-coresec, can you triage this bug report please ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-10-14: |  |  | [#6](/cloud-archive/%2Bbug/1493303/comments/6) |
| --- | --- | --- | --- |

On commit fdc8828e8527b6fa4997072fb4795e4060c68cc0 (tip of master as of the time of this comment), I am unable to reproduce the behavior. I experimented with a variety of curl timeouts (the -m argument), including the proposed 0.001, but still could not reproduce this.

On a freshly-restarted VM, I did see a small jump in the number of non-TIME\_WAIT connections after the first request, but that jump did not occur on the second and subsequent requests, so it appears to be something warming up.

I also checked stable/liberty (47eb6a37) and was unable to reproduce the behavior there either.

I \*can\* reproduce this on stable/kilo (da428c4f).

I suspect that commit 12d8a53 fixed this, though I have no proof of that.

On commit fdc8828e8527b6fa4997072fb4795e4060c68cc0 (tip of master as of the time of this comment), I am unable to reproduce the behavior. I experimented with a variety of curl timeouts (the -m argument), including the proposed 0.001, but still could not reproduce this.
On a freshly-restarted VM, I did see a small jump in the number of non-TIME\_WAIT connections after the first request, but that jump did not occur on the second and subsequent requests, so it appears to be something warming up.
I also checked stable/liberty (47eb6a37) and was unable to reproduce the behavior there either.
I \*can\* reproduce this on stable/kilo (da428c4f).
I suspect that commit 12d8a53 fixed this, though I have no proof of that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Christian Schwede (cschwede)](https://launchpad.net/~cschwede) wrote on 2015-10-14: |  |  | [#7](/cloud-archive/%2Bbug/1493303/comments/7) |
| --- | --- | --- | --- |

I couldn't reproduce this on/after commit 12d8a53, but I could reproduce it on the commits before that.

I had to use a larger timeout to reproduce this (0.01 seconds). I used the following command:

for i in `seq 1 1000`; do curl -H 'X-Auth-Token: AUTH\_...' <http://127.0.0.1:8080/v1/AUTH_test/big/bigfile> -m 0.01 > /dev/null ; done

From my point of view this affects all releases before commit 12d8a53, and I would propose to backport 12d8a53 to stable/juno and stable/kilo.

I couldn't reproduce this on/after commit 12d8a53, but I could reproduce it on the commits before that.
I had to use a larger timeout to reproduce this (0.01 seconds). I used the following command:
for i in `seq 1 1000`; do curl -H 'X-Auth-Token: AUTH\_...' http://127.0.0.1:8080/v1/AUTH\_test/big/bigfile -m 0.01 > /dev/null ; done
From my point of view this affects all releases before commit 12d8a53, and I would propose to backport 12d8a53 to stable/juno and stable/kilo.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Christian Schwede (cschwede)](https://launchpad.net/~cschwede) wrote on 2015-10-14: |  |  | [#8](/cloud-archive/%2Bbug/1493303/comments/8) |
| --- | --- | --- | --- |

Just to add more light on this: most of the connections on pre-12d8a53 are still not closed after 50 minutes. That definetely does not happen on a branch on or after commit 12d8a53.

Just to add more light on this: most of the connections on pre-12d8a53 are still not closed after 50 minutes. That definetely does not happen on a branch on or after commit 12d8a53.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matthew Oliver (matt-0)](https://launchpad.net/~matt-0) wrote on 2015-10-14:  [**Re: [Bug 1493303] Re: Swift proxy memory leak on unfinished read**](/cloud-archive/%2Bbug/1493303/comments/9) |  |  | [#9](/cloud-archive/%2Bbug/1493303/comments/9) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/comments/9/%2Bdownload) (6.2 KiB)

Sam and Romain was the author of patch 12d8a53, the patch makes sure

connections are closed. Here is the commit message of the patch:

commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9

Author: Samuel Merritt <email address hidden>

Date: Thu Jun 18 12:58:03 2015 -0700

Get better at closing WSGI iterables.

PEP 333 (WSGI) says: "If the iterable returned by the application has

    a close() method, the server or gateway must call that method upon

    completion of the current request[.]"

There's a bunch of places where we weren't doing that; some of them

    matter more than others. Calling .close() can prevent a connection

    leak in some cases. In others, it just provides a certain pedantic

    smugness. Either way, we should do what WSGI requires.

Noteworthy goofs include:

\* If a client is downloading a large object and disconnects halfway

        through, a proxy -> obj connection may be leaked. In this case,

        the WSGI iterable is a SegmentedIterable, which lacked a close()

        method. Thus, when the WSGI server noticed the client disconnect,

        it had no way of telling the SegmentedIterable about it, and so

        the underlying iterable for the segment's data didn't get

        closed.

Here, it seems likely (though unproven) that the object server

        would time out and kill the connection, or that a

        ChunkWriteTimeout would fire down in the proxy server, so the

        leaked connection would eventually go away. However, a flurry of

        client disconnects could leave a big pile of useless connections.

\* If a conditional request receives a 304 or 412, the underlying

        app\_iter is not closed. This mostly affects conditional requests

        for large objects.

The leaked connections were noticed by this patch's co-author, who

    made the changes to SegmentedIterable. Those changes helped, but did

    not completely fix, the issue. The rest of the patch is an attempt to

    plug the rest of the holes.

Co-Authored-By: Romain LE DISEZ <email address hidden>

Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937

    Closes-Bug: #1466549

The first noteworthy goof looks like what we're seeing in this bug. This

patch is already in Liberty, but it was applied well after 2.2.0 (Juno) and

Kilo. So it only needs to be backported.

My 2 cents,

Matt

On Wed, Oct 14, 2015 at 7:59 PM, Christian Schwede <

<email address hidden>> wrote:

> Just to add more light on this: most of the connections on pre-12d8a53

> are still not closed after 50 minutes. That definetely does not happen

> on a branch on or after commit 12d8a53.

>

> --

> You received this bug notification because you are a member of Swift

> Core security contacts, which is subscribed to the bug report.

> <https://bugs.launchpad.net/bugs/1493303>

>

> Title:

> Swift proxy memory leak on unfinished read

>

> Status in ubuntu-cloud-archive:

> New

> Status in OpenStack Security Advisory:

> Incomplete

> Status in OpenStack Object Storage (swift):

> New

> Status in swift package in Ubuntu:

> New

>

> Bug description:

> This issue is being treated as a potential security risk under

> embargo. Pleas...

[Read more...](/cloud-archive/%2Bbug/1493303/comments/9)

Sam and Romain was the author of patch 12d8a53, the patch makes sure
connections are closed. Here is the commit message of the patch:
commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
Closes-Bug: #1466549
The first noteworthy goof looks like what we're seeing in this bug. This
patch is already in Liberty, but it was applied well after 2.2.0 (Juno) and
Kilo. So it only needs to be backported.
My 2 cents,
Matt
On Wed, Oct 14, 2015 at 7:59 PM, Christian Schwede <
1493303@bugs.launchpad.net> wrote:
> Just to add more light on this: most of the connections on pre-12d8a53
> are still not closed after 50 minutes. That definetely does not happen
> on a branch on or after commit 12d8a53.
>
> --
> You received this bug notification because you are a member of Swift
> Core security contacts, which is subscribed to the bug report.
> https://bugs.launchpad.net/bugs/1493303
>
> Title:
> Swift proxy memory leak on unfinished read
>
> Status in ubuntu-cloud-archive:
> New
> Status in OpenStack Security Advisory:
> Incomplete
> Status in OpenStack Object Storage (swift):
> New
> Status in swift package in Ubuntu:
> New
>
> Bug description:
> This issue is being treated as a potential security risk under
> embargo. Please do not make any public mention of embargoed (private)
> security vulnerabilities before their coordinated publication by the
> OpenStack Vulnerability Management Team in the form of an official
> OpenStack Security Advisory. This includes discussion of the bug or
> associated fixes in public forums such as mailing lists, code review
> systems and bug trackers. Please also avoid private disclosure to
> other individuals not already approved for access to this information,
> and provide this same reminder to those who are made aware of the
> issue prior to publication. All discussion should remain confined to
> this private bug report, and any proposed fixes should be added to the
> bug as attachments.
>
> It looks like the Swift proxy will leak memory if the connection is
> closed and the full response is not read. This opens for a potential
> DoS attacks.
>
> Reproduce:
>
> $ swift -A http://localhost:8888/auth/v1.0 -U .. -K .. upload --use-slo
> --segment-size 1048576 <container> <big-file>
> $ curl -H'X-Auth-Token: AUTH\_...' "http://localhost:8888/v1/AUTH\_../<container>/<big-file>"
> -m 0.001 > /dev/null
>
> Repeat the curl command a couple of times and you will have more
> information in netstat and sockstat. The important part is the -m
> which sets the max time curl spends at downloading. After that point,
> it'll close the connection.
>
> $ sudo netstat -ant -p | grep :6000
> $ cat /proc/net/sockstat
>
> tcp 0 0 127.0.0.1:6000 0.0.0.0:\*
> LISTEN 1358/python
> tcp 0 43221 127.0.0.1:6000 127.0.0.1:48350
> FIN\_WAIT1 -
> tcp 0 43221 127.0.0.1:6000 127.0.0.1:48882
> FIN\_WAIT1 -
> tcp 939820 0 127.0.0.1:48350 127.0.0.1:6000
> ESTABLISHED 17897/python
> tcp 939820 0 127.0.0.1:48882 127.0.0.1:6000
> ESTABLISHED 17890/python
> tcp 983041 0 127.0.0.1:48191 127.0.0.1:6000
> CLOSE\_WAIT 17897/python
> tcp 983041 0 127.0.0.1:48948 127.0.0.1:6000
> CLOSE\_WAIT 17892/python
>
> Restarting the proxy frees up the lingering memory.
>
> This problem did not exist in 2.2.0.
>
> ProblemType: Bug
> DistroRelease: Ubuntu 14.04
> Package: swift 2.2.2-0ubuntu1~cloud0 [origin: Canonical]
> ProcVersionSignature: Ubuntu 3.16.0-48.64~14.04.1-generic 3.16.7-ckt15
> Uname: Linux 3.16.0-48-generic x86\_64
> ApportVersion: 2.14.1-0ubuntu3.12
> Architecture: amd64
> CrashDB:
> {
> "impl": "launchpad",
> "project": "cloud-archive",
> "bug\_pattern\_url": "
> http://people.canonical.com/~ubuntu-archive/bugpatterns/bugpatterns.xml",
> }
> Date: Tue Sep 8 09:55:05 2015
> InstallationDate: Installed on 2015-06-22 (77 days ago)
> InstallationMedia: Ubuntu-Server 14.04.2 LTS "Trusty Tahr" - Release
> amd64 (20150218.1)
> PackageArchitecture: all
> SourcePackage: swift
> UpgradeStatus: No upgrade log present (probably fresh install)
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/cloud-archive/+bug/1493303/+subscriptions
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-16:  [**Re: Swift proxy memory leak on unfinished read**](/cloud-archive/%2Bbug/1493303/comments/10) |  |  | [#10](/cloud-archive/%2Bbug/1493303/comments/10) |
| --- | --- | --- | --- |

* [leakreproducer.sh](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4520199/%2Bfiles/leakreproducer.sh)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4520199)
  (1.1 KiB,
  text/x-sh)

This bug can still be reproduced in an easy and consistent manner. I've attached a script reproducing the leaks. It simply spins up a swift SAIO box in vagrant, and then runs the curl command mentioned in this issue. Every time the script is run, more memory is leaked. If the proxy-server is restared, the memory will be freed.

A small note: while the script was provisioning the vagrant box for the first time, apt failed. This was easily fixed:

$ cd vagrant-swift-all-in-one/

$ vagrant ssh -c "sudo apt-get -f install -y"

$ vagrant provision

Then just rerun the script:

$ cd ..

$ ./leakreproducer.sh

This bug can still be reproduced in an easy and consistent manner. I've attached a script reproducing the leaks. It simply spins up a swift SAIO box in vagrant, and then runs the curl command mentioned in this issue. Every time the script is run, more memory is leaked. If the proxy-server is restared, the memory will be freed.
A small note: while the script was provisioning the vagrant box for the first time, apt failed. This was easily fixed:
$ cd vagrant-swift-all-in-one/
$ vagrant ssh -c "sudo apt-get -f install -y"
$ vagrant provision
Then just rerun the script:
$ cd ..
$ ./leakreproducer.sh

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-18: |  |  | [#11](/cloud-archive/%2Bbug/1493303/comments/11) |
| --- | --- | --- | --- |

I was able to reproduce this on saio instance of 8Go of ram, deployed with openstack-swift-2.3.0-2.fc23.noarch (which doesn't have 12d8a53). However it didn't cause a noticeable effect since the process was killed and automatically restarted without causing disruption to other services. Also the leak was quickly limited by the maximum number of open file and it took about 42k connections until the process reserved all memory.

Anyway this seems like a duplicate of [bug 1466549](/bugs/1466549) which is already public, can we mark this bug as duplicate and open it ?

I was able to reproduce this on saio instance of 8Go of ram, deployed with openstack-swift-2.3.0-2.fc23.noarch (which doesn't have 12d8a53). However it didn't cause a noticeable effect since the process was killed and automatically restarted without causing disruption to other services. Also the leak was quickly limited by the maximum number of open file and it took about 42k connections until the process reserved all memory.
Anyway this seems like a duplicate of bug 1466549 which is already public, can we mark this bug as duplicate and open it ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-19: |  |  | [#12](/cloud-archive/%2Bbug/1493303/comments/12) |
| --- | --- | --- | --- |

The problem is not that the machine runs out of memory, the problem is that the kernel runs out of buffer space for the TCP stack. This renders the machine unable to do any form of network communication, including SSH. It will however not get the proxy process killed, as there's still plenty of memory left on the machine (just not for TCP). This effectively renders the machine completely unresponsive until it's rebooted, or the proxy process is restarted.

dmesg gets filled up with messages like these:

[ 276.495010] TCP: out of memory -- consider tuning tcp\_mem

[ 276.852703] TCP: out of memory -- consider tuning tcp\_mem

[ 277.996776] TCP: out of memory -- consider tuning tcp\_mem

[ 278.111035] TCP: out of memory -- consider tuning tcp\_mem

[ 279.840715] TCP: out of memory -- consider tuning tcp\_mem

[ 280.421439] TCP: out of memory -- consider tuning tcp\_mem

[ 281.435703] TCP: out of memory -- consider tuning tcp\_mem

[ 283.579847] TCP: out of memory -- consider tuning tcp\_mem

[ 283.616647] TCP: out of memory -- consider tuning tcp\_mem

[ 283.652761] TCP: out of memory -- consider tuning tcp\_mem

These symptons are easily reproduced with the script I posted above, just run it a few times, and the machine will become completely unresponsive. The following line should do the trick:

$ vagrant ssh -c 'for i in {1..100}; do /vagrant/leakconnections.sh; done'

The problem is not that the machine runs out of memory, the problem is that the kernel runs out of buffer space for the TCP stack. This renders the machine unable to do any form of network communication, including SSH. It will however not get the proxy process killed, as there's still plenty of memory left on the machine (just not for TCP). This effectively renders the machine completely unresponsive until it's rebooted, or the proxy process is restarted.
dmesg gets filled up with messages like these:
[ 276.495010] TCP: out of memory -- consider tuning tcp\_mem
[ 276.852703] TCP: out of memory -- consider tuning tcp\_mem
[ 277.996776] TCP: out of memory -- consider tuning tcp\_mem
[ 278.111035] TCP: out of memory -- consider tuning tcp\_mem
[ 279.840715] TCP: out of memory -- consider tuning tcp\_mem
[ 280.421439] TCP: out of memory -- consider tuning tcp\_mem
[ 281.435703] TCP: out of memory -- consider tuning tcp\_mem
[ 283.579847] TCP: out of memory -- consider tuning tcp\_mem
[ 283.616647] TCP: out of memory -- consider tuning tcp\_mem
[ 283.652761] TCP: out of memory -- consider tuning tcp\_mem
These symptons are easily reproduced with the script I posted above, just run it a few times, and the machine will become completely unresponsive. The following line should do the trick:
$ vagrant ssh -c 'for i in {1..100}; do /vagrant/leakconnections.sh; done'

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-19: |  |  | [#13](/cloud-archive/%2Bbug/1493303/comments/13) |
| --- | --- | --- | --- |

That behavior might be related to vagrant networking setup, using a nova instance with fedora kernel didn't broke ssh connection (active and new one). I run 5 parallel "while true; curl ...; done" using a public SLO object (no need for token).

Hence the question asked on [bug 1466549](/bugs/1466549) comment #7:

Does that mean that the issue described here is confirmed to be reproducible under most deployments?

That behavior might be related to vagrant networking setup, using a nova instance with fedora kernel didn't broke ssh connection (active and new one). I run 5 parallel "while true; curl ...; done" using a public SLO object (no need for token).
Hence the question asked on bug 1466549 comment #7:
Does that mean that the issue described here is confirmed to be reproducible under most deployments?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-19: |  |  | [#14](/cloud-archive/%2Bbug/1493303/comments/14) |
| --- | --- | --- | --- |

No, I don't think is related to vagrant, we get the same results in our production environment (that's why we filed the original ticket, our nodes we upgraded to 2.4.0 sunk after the upgrade). The production environment is running on bare metal, so it shouldn't be related to any form of virtualization.

We also tried 2.5.0 in production, and still get the same issues. The last good version for us was 2.2.x, after this we skipped straight to 2.4.0 (I don't think ubuntu packaged 2.3.0) and started having problems.

No, I don't think is related to vagrant, we get the same results in our production environment (that's why we filed the original ticket, our nodes we upgraded to 2.4.0 sunk after the upgrade). The production environment is running on bare metal, so it shouldn't be related to any form of virtualization.
We also tried 2.5.0 in production, and still get the same issues. The last good version for us was 2.2.x, after this we skipped straight to 2.4.0 (I don't think ubuntu packaged 2.3.0) and started having problems.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2015-11-19: |  |  | [#15](/cloud-archive/%2Bbug/1493303/comments/15) |
| --- | --- | --- | --- |

Status changed to 'Confirmed' because the bug affects multiple users.

Status changed to 'Confirmed' because the bug affects multiple users.

| Changed in swift (Ubuntu): | |
| --- | --- |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-19: |  |  | [#16](/cloud-archive/%2Bbug/1493303/comments/16) |
| --- | --- | --- | --- |

Hum, if this reproduce in 2.4.0 and 2.5.0 then it may be a different issue than [bug 1466549](/bugs/1466549) for which the fix (12d8a53) is included in those releases...

It seems like the leakreproducer.sh is stressing the proxy-server using localhost, would this be a different scenario compared to external connection ?

Hum, if this reproduce in 2.4.0 and 2.5.0 then it may be a different issue than bug 1466549 for which the fix (12d8a53) is included in those releases...
It seems like the leakreproducer.sh is stressing the proxy-server using localhost, would this be a different scenario compared to external connection ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-19: |  |  | [#17](/cloud-archive/%2Bbug/1493303/comments/17) |
| --- | --- | --- | --- |

No, it's not different compared to an external connection. If leakproducer.sh is run outside of the virtual machine (just change localhost to 192.168.8.80 in the script), the problem still persists.

Another thing which migth be interesting to note is that after the memory has leaked, it isn't freed even if the object-server is stopped. The proxy-server needs to be restarted in order for the memory to be freed.

No, it's not different compared to an external connection. If leakproducer.sh is run outside of the virtual machine (just change localhost to 192.168.8.80 in the script), the problem still persists.
Another thing which migth be interesting to note is that after the memory has leaked, it isn't freed even if the object-server is stopped. The proxy-server needs to be restarted in order for the memory to be freed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2015-11-19: |  |  | [#18](/cloud-archive/%2Bbug/1493303/comments/18) |
| --- | --- | --- | --- |

Andreas, what version of curl are you using?

I'm not able to see any issues when running leakconnections.sh from my mac (curl 7.43.0), but I did find something when running directly on my precise SAIO (curl 7.22).

Andreas, what version of curl are you using?
I'm not able to see any issues when running leakconnections.sh from my mac (curl 7.43.0), but I did find something when running directly on my precise SAIO (curl 7.22).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-20: |  |  | [#19](/cloud-archive/%2Bbug/1493303/comments/19) |
| --- | --- | --- | --- |

I'm running curl 7.43.0 on ubuntu 15.10. I don't think the issue is tied to the curl version though, this happens for us in our production environment when running ffmpeg to transcode videos. When ffmpeg is running it seeks a lot in the stream by opening a new socket with some offset, doing a short read, and then closing the socket. The read and close without consuming the whole object seems to be the key to the problem here.

When running curl from your mac, what output do you get? You should see a lot of lines like these:

curl: (28) Operation timed out after 102 milliseconds with 769995 out of 524288512 bytes received

These are due to curl closing the socket without consuming the whole object, triggering the bug.

I'm running curl 7.43.0 on ubuntu 15.10. I don't think the issue is tied to the curl version though, this happens for us in our production environment when running ffmpeg to transcode videos. When ffmpeg is running it seeks a lot in the stream by opening a new socket with some offset, doing a short read, and then closing the socket. The read and close without consuming the whole object seems to be the key to the problem here.
When running curl from your mac, what output do you get? You should see a lot of lines like these:
curl: (28) Operation timed out after 102 milliseconds with 769995 out of 524288512 bytes received
These are due to curl closing the socket without consuming the whole object, triggering the bug.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-23: |  |  | [#20](/cloud-archive/%2Bbug/1493303/comments/20) |
| --- | --- | --- | --- |

@notmyname, does your precise SAIO is running with 12d8a53 ?

@notmyname, does your precise SAIO is running with 12d8a53 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-12-01: |  |  | [#21](/cloud-archive/%2Bbug/1493303/comments/21) |
| --- | --- | --- | --- |

Any news on this? Can we consider this bug confirmed as it can be consistently reproduced?

Any news on this? Can we consider this bug confirmed as it can be consistently reproduced?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kota Tsuyuzaki (tsuyuzaki-kota)](https://launchpad.net/~tsuyuzaki-kota) wrote on 2015-12-02: |  |  | [#22](/cloud-archive/%2Bbug/1493303/comments/22) |
| --- | --- | --- | --- |

It seems that I can reproduce this with current master (exactly after 12d8a53 ) in 2 environment, one is ubuntu 14.04.02 (3.13.0-48-generic kernel) on AWS and the other is 14.04.01 (3.13.0-36-generic) on my laptop virtual machine.

I didn't look at the reason in detail yet but it looks like that we have an issue for that.

My procedure is:

1. upload a 50MB slo object via swift command (i.e. swift upload ---use-slo)

2. Download the slo object via curl, and then stop the download stream via -m (timeout) option

3. cat /proc/net/sockstat shows as follows:

sockets: used 314

TCP: inuse 20 orphan 0 tw 0 alloc 123 mem 3919 (<- I found the "mem" increased by the curl requests)

UDP: inuse 3 mem 0

UDPLITE: inuse 0

RAW: inuse 0

FRAG: inuse 0 memory 0

4. It looks also increase proxy-server memory usage (confilemed by ps and top command)

It looks that larger number of timeout increased the used memory rapidly. i.e. "-m 0.1" made proxy-server to spend more memory than "-m 0.01" (both of them killed the connections before the task finished)

However, I couldn't find CLOSE\_WAIT/FIN\_WAIT in netstat. (it might be related that I turned on tcp\_recycle in sysctl)

Right now I'm not sure but it might be depends on kernel version because I tested in closer version with reported environment so I'll try to make sure another environment if we can reproduce this anytime.

It seems that I can reproduce this with current master (exactly after 12d8a53 ) in 2 environment, one is ubuntu 14.04.02 (3.13.0-48-generic kernel) on AWS and the other is 14.04.01 (3.13.0-36-generic) on my laptop virtual machine.
I didn't look at the reason in detail yet but it looks like that we have an issue for that.
My procedure is:
1. upload a 50MB slo object via swift command (i.e. swift upload ---use-slo)
2. Download the slo object via curl, and then stop the download stream via -m (timeout) option
3. cat /proc/net/sockstat shows as follows:
sockets: used 314
TCP: inuse 20 orphan 0 tw 0 alloc 123 mem 3919 (<- I found the "mem" increased by the curl requests)
UDP: inuse 3 mem 0
UDPLITE: inuse 0
RAW: inuse 0
FRAG: inuse 0 memory 0
4. It looks also increase proxy-server memory usage (confilemed by ps and top command)
It looks that larger number of timeout increased the used memory rapidly. i.e. "-m 0.1" made proxy-server to spend more memory than "-m 0.01" (both of them killed the connections before the task finished)
However, I couldn't find CLOSE\_WAIT/FIN\_WAIT in netstat. (it might be related that I turned on tcp\_recycle in sysctl)
Right now I'm not sure but it might be depends on kernel version because I tested in closer version with reported environment so I'll try to make sure another environment if we can reproduce this anytime.

[John Dickinson (notmyname)](https://launchpad.net/~notmyname)
on 2015-12-02

| Changed in swift: | |
| --- | --- |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#23](/cloud-archive/%2Bbug/1493303/comments/23) |
| --- | --- | --- | --- |

This is weird. I was able to reproduce the problem; the proxy server accumulates a bunch of open filehandles for dead sockets.

I can see with strace that the sockets in question are used for client <--> proxy communication. We're not leaking connections to the storage backends. Also, it looks like someone is trying to clean them up, but is just bad at it. Check this out:

# we have a GET request from the client; the socket is fd 220

    accept(4, {sa\_family=AF\_INET, sin\_port=htons(38280), sin\_addr=inet\_addr("127.0.0.1")}, [16]) = 220

    fcntl(220, F\_GETFL) = 0x2 (flags O\_RDWR)

    fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0

    fcntl(220, F\_GETFL) = 0x802 (flags O\_RDWR|O\_NONBLOCK)

    fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0

    sendto(3, "<139>proxy-server: STDERR: (2834"..., 65, 0, NULL, 0) = 65

    accept(4, 0x7fffa0e778c0, [16]) = -1 EAGAIN (Resource temporarily unavailable)

    recvfrom(220, "GET /v1/AUTH\_test/test/largefile"..., 65536, 0, NULL, NULL) = 160

# ... removed stuff talking to memcached + storage backends

# then we try to send something and learn that it's shut down, so SIGPIPE

    sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)

    --- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---

    # stupidly, we try to send it again ang get another SIGPIPE

    sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)

    --- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---

# attempted cleanup...

    shutdown(220, SHUT\_RDWR) = -1 ENOTCONN (Transport endpoint is not connected)

# and now we completely forget about fd 220 and it's never mentioned again. there's the leak.

    poll([{fd=4, events=POLLIN|POLLPRI|POLLERR|POLLHUP}], 1, 13) = 1 ([{fd=4, revents=POLLIN}])

    # ...thousands more lines not mentioning fd 220

What's weird here is that eventlet is doing this at least somewhat intentionally. Here's an annotated eventlet.wsgi.HttpProtocol.finish():

def finish(self):

        try:

            # this tries to flush any buffers; this is probably what

            # causes the second sendto()/SIGPIPE pair, but I have not

            # verified that.

            BaseHTTPServer.BaseHTTPRequestHandler.finish(self)

        except socket.error as e:

            # Broken pipe, connection reset by peer

            if support.get\_errno(e) not in BROKEN\_SOCK:

                raise

        # This is responsible for the shutdown call. It executes every time;

        # the try/except above doesn't let any exceptions out that would

        # exit this method early.

        greenio.shutdown\_safe(self.connection)

# Here's the fun part: this method call gets executed, but it

        # doesn't make any syscalls. Something is causing this to be a no-op,

        # but I don't know what it is.

        self.connection.close()

Looks like it might be a bug in eventlet, maybe? I'm not convinced this bug is fixable from within Swift.

This is weird. I was able to reproduce the problem; the proxy server accumulates a bunch of open filehandles for dead sockets.
I can see with strace that the sockets in question are used for client <--> proxy communication. We're not leaking connections to the storage backends. Also, it looks like someone is trying to clean them up, but is just bad at it. Check this out:
# we have a GET request from the client; the socket is fd 220
accept(4, {sa\_family=AF\_INET, sin\_port=htons(38280), sin\_addr=inet\_addr("127.0.0.1")}, [16]) = 220
fcntl(220, F\_GETFL) = 0x2 (flags O\_RDWR)
fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0
fcntl(220, F\_GETFL) = 0x802 (flags O\_RDWR|O\_NONBLOCK)
fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0
sendto(3, "<139>proxy-server: STDERR: (2834"..., 65, 0, NULL, 0) = 65
accept(4, 0x7fffa0e778c0, [16]) = -1 EAGAIN (Resource temporarily unavailable)
recvfrom(220, "GET /v1/AUTH\_test/test/largefile"..., 65536, 0, NULL, NULL) = 160
# ... removed stuff talking to memcached + storage backends
# then we try to send something and learn that it's shut down, so SIGPIPE
sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)
--- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---
# stupidly, we try to send it again ang get another SIGPIPE
sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)
--- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---
# attempted cleanup...
shutdown(220, SHUT\_RDWR) = -1 ENOTCONN (Transport endpoint is not connected)
# and now we completely forget about fd 220 and it's never mentioned again. there's the leak.
poll([{fd=4, events=POLLIN|POLLPRI|POLLERR|POLLHUP}], 1, 13) = 1 ([{fd=4, revents=POLLIN}])
# ...thousands more lines not mentioning fd 220
What's weird here is that eventlet is doing this at least somewhat intentionally. Here's an annotated eventlet.wsgi.HttpProtocol.finish():
def finish(self):
try:
# this tries to flush any buffers; this is probably what
# causes the second sendto()/SIGPIPE pair, but I have not
# verified that.
BaseHTTPServer.BaseHTTPRequestHandler.finish(self)
except socket.error as e:
# Broken pipe, connection reset by peer
if support.get\_errno(e) not in BROKEN\_SOCK:
raise
# This is responsible for the shutdown call. It executes every time;
# the try/except above doesn't let any exceptions out that would
# exit this method early.
greenio.shutdown\_safe(self.connection)
# Here's the fun part: this method call gets executed, but it
# doesn't make any syscalls. Something is causing this to be a no-op,
# but I don't know what it is.
self.connection.close()
Looks like it might be a bug in eventlet, maybe? I'm not convinced this bug is fixable from within Swift.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#24](/cloud-archive/%2Bbug/1493303/comments/24) |
| --- | --- | --- | --- |

Also, there are two separate issues here. The first is fixed by commit 12d8a53 and concerns a leak of connections from proxy to storage server. This is the one being discussed for backporting. The second is a file descriptor leak for client-to-proxy connections. It is reproducible on master (418f9b21) and may be in Swift, eventlet, somewhere else, or the interaction between any two or more of those.

Also, there are two separate issues here. The first is fixed by commit 12d8a53 and concerns a leak of connections from proxy to storage server. This is the one being discussed for backporting. The second is a file descriptor leak for client-to-proxy connections. It is reproducible on master (418f9b21) and may be in Swift, eventlet, somewhere else, or the interaction between any two or more of those.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#25](/cloud-archive/%2Bbug/1493303/comments/25) |
| --- | --- | --- | --- |

never mind... it's only reproducible with SLOs and DLOs. Not even regular Swift objects. Something in our SegmentedIterable class is probably the culprit.

feh.

never mind... it's only reproducible with SLOs and DLOs. Not even regular Swift objects. Something in our SegmentedIterable class is probably the culprit.
feh.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#26](/cloud-archive/%2Bbug/1493303/comments/26) |
| --- | --- | --- | --- |

git bisect claims it's commit 5ca49ca92485b6ba868544f12fa524d9d7b666c6 that introduced the bug. conveniently, this commit changes a bunch of stuff in SegmentedIterable, validating the guess in comment #25.

git bisect claims it's commit 5ca49ca92485b6ba868544f12fa524d9d7b666c6 that introduced the bug. conveniently, this commit changes a bunch of stuff in SegmentedIterable, validating the guess in comment #25.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-04: |  |  | [#27](/cloud-archive/%2Bbug/1493303/comments/27) |
| --- | --- | --- | --- |

* [leakpatch-1.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4529331/%2Bfiles/leakpatch-1.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4529331)
  (496 bytes,
  text/plain)

Experimentally, this fixes the bug. Having a heck of a time writing a unit test, though. If anyone wants to jump in there, please feel free.

Experimentally, this fixes the bug. Having a heck of a time writing a unit test, though. If anyone wants to jump in there, please feel free.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kota Tsuyuzaki (tsuyuzaki-kota)](https://launchpad.net/~tsuyuzaki-kota) wrote on 2015-12-07: |  |  | [#28](/cloud-archive/%2Bbug/1493303/comments/28) |
| --- | --- | --- | --- |

* [security\_leak\_fix.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4530760/%2Bfiles/security_leak_fix.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4530760)
  (885 bytes,
  text/plain)

Awesome Sam!

SegmentItrable never closes its app\_iter handle and it causes the handler leak. It makes me sense and I confirmed the leakpatch-1.diff fixed the issue in my environment.

Plus, I tried to improve the fix to be intuitive a bit more (attached). In my patch, SegmentIterable.close will attempt to close self.app\_iter at first and it will emit GeneratorExit and then, it will close also backend request iter at current\_resp.

Anyways, nice work and thanks! :-)

Awesome Sam!
SegmentItrable never closes its app\_iter handle and it causes the handler leak. It makes me sense and I confirmed the leakpatch-1.diff fixed the issue in my environment.
Plus, I tried to improve the fix to be intuitive a bit more (attached). In my patch, SegmentIterable.close will attempt to close self.app\_iter at first and it will emit GeneratorExit and then, it will close also backend request iter at current\_resp.
Anyways, nice work and thanks! :-)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-12-07: |  |  | [#29](/cloud-archive/%2Bbug/1493303/comments/29) |
| --- | --- | --- | --- |

@tsuyuzaki-kota we've deployed your patch to some of our servers now. Everything seems to be fixed when running some simple tests that used to trigger the bug! I'll let it run for a day or two and see if everything is stable.

Thanks for the good work everybody! :D

@tsuyuzaki-kota we've deployed your patch to some of our servers now. Everything seems to be fixed when running some simple tests that used to trigger the bug! I'll let it run for a day or two and see if everything is stable.
Thanks for the good work everybody! :D

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-12-07

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-12-08: |  |  | [#30](/cloud-archive/%2Bbug/1493303/comments/30) |
| --- | --- | --- | --- |

Ok, so everything is still fine on our servers. It seems like the patch fixed the bug completely :)

Ok, so everything is still fine on our servers. It seems like the patch fixed the bug completely :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-09: |  |  | [#31](/cloud-archive/%2Bbug/1493303/comments/31) |
| --- | --- | --- | --- |

* [socket-leak-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4532159/%2Bfiles/socket-leak-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4532159)
  (5.1 KiB,
  text/plain)

Here is a slight modification of Kota's patch, plus a unit test.

The modification was only to change "except GeneratorExit:" to "finally:" so that GeneratorExit propagates to any generators enclosing SegmentedIterable. I don't know of any right now, but future middlewares could easily introduce them.

Now that we have a unit test, I believe this patch to be ready for review.

Here is a slight modification of Kota's patch, plus a unit test.
The modification was only to change "except GeneratorExit:" to "finally:" so that GeneratorExit propagates to any generators enclosing SegmentedIterable. I don't know of any right now, but future middlewares could easily introduce them.
Now that we have a unit test, I believe this patch to be ready for review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-09: |  |  | [#32](/cloud-archive/%2Bbug/1493303/comments/32) |
| --- | --- | --- | --- |

It seems like both leaks (proxy to server and client to proxy) have been reported on former [bug 1466549](/bugs/1466549). I've subscribed the original reporter.

Örjan, I can't find your affiliation, if you want to credit your current employer, please let me know.

Here is the impact description to cover both bugs (which will likely get two different CVE):

Title: Swift proxy-server DoS through Large Object

Reporter: Romain LE DISEZ (OVH), Örjan Persson

Products: Swift

Affects: client-proxy: < 2.4.0 (Liberty)

      proxy-server: =< 2.5.0 (Liberty included)

Description:

Romain LE DISEZ from OVH and Örjan Persson independently reported two vulnerabilities in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. Note that there are two distinct bugs that can exhaust proxy resources, one for client connection (client to proxy), one for servers connection (proxy to server). All Swift setup are affected.

It seems like both leaks (proxy to server and client to proxy) have been reported on former bug 1466549. I've subscribed the original reporter.
Örjan, I can't find your affiliation, if you want to credit your current employer, please let me know.
Here is the impact description to cover both bugs (which will likely get two different CVE):
Title: Swift proxy-server DoS through Large Object
Reporter: Romain LE DISEZ (OVH), Örjan Persson
Products: Swift
Affects: client-proxy: < 2.4.0 (Liberty)
proxy-server: =< 2.5.0 (Liberty included)
Description:
Romain LE DISEZ from OVH and Örjan Persson independently reported two vulnerabilities in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. Note that there are two distinct bugs that can exhaust proxy resources, one for client connection (client to proxy), one for servers connection (proxy to server). All Swift setup are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Örjan Fors (orrriot)](https://launchpad.net/~orrriot) wrote on 2015-12-09: |  |  | [#33](/cloud-archive/%2Bbug/1493303/comments/33) |
| --- | --- | --- | --- |

Great! Happy to hear that it has been resolved. Kiliaro is my employer.

Great! Happy to hear that it has been resolved. Kiliaro is my employer.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-10: |  |  | [#34](/cloud-archive/%2Bbug/1493303/comments/34) |
| --- | --- | --- | --- |

Thanks Örjan, next description will mention Kiliaro. I just need to figure out what swift release are going to be fixed...

The tip of stable/kilo (463fbe39fa1142d2bb9f7c738c6d88d9f77857f1) doesn't seems to be in any tags

There is no stable/liberty branch.

According to <http://docs.openstack.org/releases/>, it looks like the fix should land in 2.3.1 (for kilo) and 2.5.1 (for liberty).

@swift-coresec, is this following affect line correct ?

Affects: client to proxy: >=2.2.1, <= 2.3.0

                proxy to server: >=2.2.1, <= 2.3.0, >= 2.4.0, <= 2.5.0

Thanks Örjan, next description will mention Kiliaro. I just need to figure out what swift release are going to be fixed...
The tip of stable/kilo (463fbe39fa1142d2bb9f7c738c6d88d9f77857f1) doesn't seems to be in any tags
There is no stable/liberty branch.
According to http://docs.openstack.org/releases/, it looks like the fix should land in 2.3.1 (for kilo) and 2.5.1 (for liberty).
@swift-coresec, is this following affect line correct ?
Affects: client to proxy: >=2.2.1, <= 2.3.0
proxy to server: >=2.2.1, <= 2.3.0, >= 2.4.0, <= 2.5.0

[John Dickinson (notmyname)](https://launchpad.net/~notmyname)
on 2015-12-15

| Changed in swift: | |
| --- | --- |
| **importance**: | Undecided → Critical |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2015-12-17: |  |  | [#35](/cloud-archive/%2Bbug/1493303/comments/35) |
| --- | --- | --- | --- |

Sam, I think the patch is ok, but the test seems to only be testing the implementation of FakeSwift, not the actual change in SegmentedIterable. When only applying the changes from this patch in the test/ directory, unittests still pass.

Sam, I think the patch is ok, but the test seems to only be testing the implementation of FakeSwift, not the actual change in SegmentedIterable. When only applying the changes from this patch in the test/ directory, unittests still pass.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2016-01-06: |  |  | [#36](/cloud-archive/%2Bbug/1493303/comments/36) |
| --- | --- | --- | --- |

Sam what's the status of tests?

For everyone, it would be good to review the patch in #31 to see how the patch itself looks

Sam what's the status of tests?
For everyone, it would be good to review the patch in #31 to see how the patch itself looks

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-08: |  |  | [#37](/cloud-archive/%2Bbug/1493303/comments/37) |
| --- | --- | --- | --- |

* [socket-leak-3.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4545988/%2Bfiles/socket-leak-3.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4545988)
  (6.8 KiB,
  text/plain)

Here's a patch with a commit message explaining what's going on. Since it's a fix for a memory leak, the test is fairly crappy, but it's something.

Here's a patch with a commit message explaining what's going on. Since it's a fix for a memory leak, the test is fairly crappy, but it's something.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-08: |  |  | [#38](/cloud-archive/%2Bbug/1493303/comments/38) |
| --- | --- | --- | --- |

* [socket-leak-4.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4546358/%2Bfiles/socket-leak-4.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4546358)
  (6.8 KiB,
  text/plain)

Let's try this again, only without the leftover print statements.

Let's try this again, only without the leftover print statements.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-11: |  |  | [#39](/cloud-archive/%2Bbug/1493303/comments/39) |
| --- | --- | --- | --- |

@swift-coresec, please review proposed patch in comment #38. Thanks!

@swift-coresec, please review proposed patch in comment #38. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2016-01-12: |  |  | [#40](/cloud-archive/%2Bbug/1493303/comments/40) |
| --- | --- | --- | --- |

+2 from me

great work, Sam and Kota

+2 from me
great work, Sam and Kota

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matthew Oliver (matt-0)](https://launchpad.net/~matt-0) wrote on 2016-01-12: |  |  | [#41](/cloud-archive/%2Bbug/1493303/comments/41) |
| --- | --- | --- | --- |

+2 from me too, code looks good and test is working.

+2 from me too, code looks good and test is working.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-12: |  |  | [#42](/cloud-archive/%2Bbug/1493303/comments/42) |
| --- | --- | --- | --- |

The patch seems pretty trivial, would it be possible to get backports for stable/kilo and liberty release too ?

The patch seems pretty trivial, would it be possible to get backports for stable/kilo and liberty release too ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-13: |  |  | [#43](/cloud-archive/%2Bbug/1493303/comments/43) |
| --- | --- | --- | --- |

* [socket-leak-kilo-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548894/%2Bfiles/socket-leak-kilo-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548894)
  (6.6 KiB,
  text/plain)

kilo

kilo

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-13: |  |  | [#44](/cloud-archive/%2Bbug/1493303/comments/44) |
| --- | --- | --- | --- |

* [socket-leak-liberty-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548896/%2Bfiles/socket-leak-liberty-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548896)
  (6.8 KiB,
  text/plain)

liberty

liberty

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-13: |  |  | [#45](/cloud-archive/%2Bbug/1493303/comments/45) |
| --- | --- | --- | --- |

Thanks Samuel.

So iirc, the last three patches only fixe the proxy to server connection leak. For client to proxy leak ([bug 1466549](/bugs/1466549)) the fix only got merged for stable/liberty. The missing stable/kilo backport is proposed here: <https://review.openstack.org/#/c/217750/>

Thanks Samuel.
So iirc, the last three patches only fixe the proxy to server connection leak. For client to proxy leak (bug 1466549) the fix only got merged for stable/liberty. The missing stable/kilo backport is proposed here: https://review.openstack.org/#/c/217750/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-13: |  |  | [#46](/cloud-archive/%2Bbug/1493303/comments/46) |
| --- | --- | --- | --- |

@swift-coresec, any chance to get <https://review.openstack.org/#/c/217750/> merged before sending the advance notification ?

@swift-coresec, any chance to get https://review.openstack.org/#/c/217750/ merged before sending the advance notification ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-14: |  |  | [#47](/cloud-archive/%2Bbug/1493303/comments/47) |
| --- | --- | --- | --- |

Here is the final impact description for both [bug 1493303](/bugs/1493303) and [bug 1466549](/bugs/1466549),

If it's accurate, I'd like to send the advance notification asap with a disclosure date set to:

2016-01-20, 1500UTC

Title: Swift proxy-server DoS through Large Object

Reporter: Romain LE DISEZ (OVH), Örjan Persson (Kiliaro)

Products: Swift

Affects: client to proxy: >=2.2.1 <= 2.3.0

         proxy to server: >=2.2.1 <= 2.3.0, >= 2.4.0 <= 2.5.0

Description:

Romain LE DISEZ from OVH and Örjan Persson from Kiliaro independently

reported two vulnerabilities in Swift Large Object. By repeatedly

requesting and interrupting connections to a Large Object (Dynamic or

Static) URL, a remote attacker may exhausts Swift proxy-server

resources, potentially resulting in a denial of service. Note that there

are two distinct bugs that can exhaust proxy resources, one for client

connection (client to proxy), one for servers connection (proxy to

server). All Swift setup are affected.

Here is the final impact description for both bug 1493303 and bug 1466549,
If it's accurate, I'd like to send the advance notification asap with a disclosure date set to:
2016-01-20, 1500UTC
Title: Swift proxy-server DoS through Large Object
Reporter: Romain LE DISEZ (OVH), Örjan Persson (Kiliaro)
Products: Swift
Affects: client to proxy: >=2.2.1 <= 2.3.0
proxy to server: >=2.2.1 <= 2.3.0, >= 2.4.0 <= 2.5.0
Description:
Romain LE DISEZ from OVH and Örjan Persson from Kiliaro independently
reported two vulnerabilities in Swift Large Object. By repeatedly
requesting and interrupting connections to a Large Object (Dynamic or
Static) URL, a remote attacker may exhausts Swift proxy-server
resources, potentially resulting in a denial of service. Note that there
are two distinct bugs that can exhaust proxy resources, one for client
connection (client to proxy), one for servers connection (proxy to
server). All Swift setup are affected.

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → In Progress |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-14

| **summary**: | - Swift proxy memory leak on unfinished read+ Swift proxy memory leak on unfinished read (CVE-2016-0738) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alistair Coles (alistair-coles)](https://launchpad.net/~alistair-coles) wrote on 2016-01-14:  [**Re: Swift proxy memory leak on unfinished read (CVE-2016-0738)**](/cloud-archive/%2Bbug/1493303/comments/48) |  |  | [#48](/cloud-archive/%2Bbug/1493303/comments/48) |
| --- | --- | --- | --- |

+2 for patch at #38 applied to master. Verified that this fixes socket leak with early-terminated dlo and slo downloads (on SAIO on Ubuntu 14.04.2)

There's no test for DLO. Not a blocker and possibly redundant since ultimately it is the close call to SegmentedIterable that is being tested.

+2 for patch at #38 applied to master. Verified that this fixes socket leak with early-terminated dlo and slo downloads (on SAIO on Ubuntu 14.04.2)
There's no test for DLO. Not a blocker and possibly redundant since ultimately it is the close call to SegmentedIterable that is being tested.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alistair Coles (alistair-coles)](https://launchpad.net/~alistair-coles) wrote on 2016-01-14: |  |  | [#49](/cloud-archive/%2Bbug/1493303/comments/49) |
| --- | --- | --- | --- |

+2 for the liberty backport at #44

I could not apply the kilo backport at #43:

anc@u128:~/0dev/swift ((036c2f3...))$ git checkout origin/stable/kilo

HEAD is now at 036c2f3... Get better at closing WSGI iterables.

anc@u128:~/0dev/swift ((036c2f3...))$ git am ../patches/socket-leak-kilo-backport.diff

Applying: Fix memory/socket leak in proxy on truncated SLO/DLO GET

error: patch failed: swift/common/request\_helpers.py:431

error: swift/common/request\_helpers.py: patch does not apply

Patch failed at 0001 Fix memory/socket leak in proxy on truncated SLO/DLO GET

The copy of the patch that failed is found in:

   /home/anc/0dev/swift/.git/rebase-apply/patch

When you have resolved this problem, run "git am --continue".

If you prefer to skip this patch, run "git am --skip" instead.

To restore the original branch and stop patching, run "git am --abort".

+2 for the liberty backport at #44
I could not apply the kilo backport at #43:
anc@u128:~/0dev/swift ((036c2f3...))$ git checkout origin/stable/kilo
HEAD is now at 036c2f3... Get better at closing WSGI iterables.
anc@u128:~/0dev/swift ((036c2f3...))$ git am ../patches/socket-leak-kilo-backport.diff
Applying: Fix memory/socket leak in proxy on truncated SLO/DLO GET
error: patch failed: swift/common/request\_helpers.py:431
error: swift/common/request\_helpers.py: patch does not apply
Patch failed at 0001 Fix memory/socket leak in proxy on truncated SLO/DLO GET
The copy of the patch that failed is found in:
/home/anc/0dev/swift/.git/rebase-apply/patch
When you have resolved this problem, run "git am --continue".
If you prefer to skip this patch, run "git am --skip" instead.
To restore the original branch and stop patching, run "git am --abort".

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-14: |  |  | [#50](/cloud-archive/%2Bbug/1493303/comments/50) |
| --- | --- | --- | --- |

Oups, their is now a conflict for stable/kilo backport (proposed in comment #43).

This patch do: in swift/common/request\_helpers.py

+ def close(self):

+ """

+ Called when the client disconnect. Ensure that the connection to the

+ backend server is closed.

+ """

+ close\_if\_possible(self.app\_iter)

While current stable/kilo has:

    def close(self):

        """

        Called when the client disconnect. Ensure that the connection to the

        backend server is closed.

        """

        if self.current\_resp:

            close\_if\_possible(self.current\_resp.app\_iter)

Samuel, can you please fix that backport?

Oups, their is now a conflict for stable/kilo backport (proposed in comment #43).
This patch do: in swift/common/request\_helpers.py
+ def close(self):
+ """
+ Called when the client disconnect. Ensure that the connection to the
+ backend server is closed.
+ """
+ close\_if\_possible(self.app\_iter)
While current stable/kilo has:
def close(self):
"""
Called when the client disconnect. Ensure that the connection to the
backend server is closed.
"""
if self.current\_resp:
close\_if\_possible(self.current\_resp.app\_iter)
Samuel, can you please fix that backport?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alistair Coles (alistair-coles)](https://launchpad.net/~alistair-coles) wrote on 2016-01-14: |  |  | [#51](/cloud-archive/%2Bbug/1493303/comments/51) |
| --- | --- | --- | --- |

* [socket-leak-kilo-backport-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4549968/%2Bfiles/socket-leak-kilo-backport-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4549968)
  (6.3 KiB,
  text/plain)

I think I fixed the conflict with stable/kilo (at 036c2f3) in the attached patch

Sam had better take a look at it to be sure. 036c2f3 added stuff that seemed to allow this patch to be closer to the others i.e. self.current\_resp

I think I fixed the conflict with stable/kilo (at 036c2f3) in the attached patch
Sam had better take a look at it to be sure. 036c2f3 added stuff that seemed to allow this patch to be closer to the others i.e. self.current\_resp

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-14: |  |  | [#52](/cloud-archive/%2Bbug/1493303/comments/52) |
| --- | --- | --- | --- |

The patch in #51 looks good to me.

The patch in #51 looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-14: |  |  | [#53](/cloud-archive/%2Bbug/1493303/comments/53) |
| --- | --- | --- | --- |

The patch in comment #51 works for me. To sum-up, the upcoming advisory needs those patch to be applied:

- <https://review.openstack.org/#/c/217750/> (the stable/kilo backport for [bug 1466549](/bugs/1466549))

 - patch in comment #51 (the stable/kilo backport of this bug)

 - patch in comment #44 (the stable/liberty backport of this bug)

 - patch in comment #38 (the master/mitaka fix of this bug)

No need for stable/liberty or master/mitaka fix for [bug 1466549](/bugs/1466549) since liberty release already has this fix.

The patch in comment #51 works for me. To sum-up, the upcoming advisory needs those patch to be applied:
- https://review.openstack.org/#/c/217750/ (the stable/kilo backport for bug 1466549)
- patch in comment #51 (the stable/kilo backport of this bug)
- patch in comment #44 (the stable/liberty backport of this bug)
- patch in comment #38 (the master/mitaka fix of this bug)
No need for stable/liberty or master/mitaka fix for bug 1466549 since liberty release already has this fix.

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-14

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-20

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public Security |
| **summary**: | - Swift proxy memory leak on unfinished read (CVE-2016-0738)+ [OSSA 2016-004] Swift proxy memory leak on unfinished read+ (CVE-2016-0738) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Fix proposed to swift (stable/kilo)**](/cloud-archive/%2Bbug/1493303/comments/54) |  |  | [#54](/cloud-archive/%2Bbug/1493303/comments/54) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/270234>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/270234

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Fix proposed to swift (stable/liberty)**](/cloud-archive/%2Bbug/1493303/comments/55) |  |  | [#55](/cloud-archive/%2Bbug/1493303/comments/55) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/liberty

Review: <https://review.openstack.org/270235>

Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/270235

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Related fix proposed to ossa (master)**](/cloud-archive/%2Bbug/1493303/comments/56) |  |  | [#56](/cloud-archive/%2Bbug/1493303/comments/56) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: <https://review.openstack.org/270241>

Related fix proposed to branch: master
Review: https://review.openstack.org/270241

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Ubuntu Foundations Team Bug Bot (crichton)](https://launchpad.net/~crichton) wrote on 2016-01-20: |  |  | [#57](/cloud-archive/%2Bbug/1493303/comments/57) |
| --- | --- | --- | --- |

The attachment "leakpatch-1.diff" seems to be a patch. If it isn't, please remove the "patch" flag from the attachment, remove the "patch" tag, and if you are a member of the ~ubuntu-reviewers, unsubscribe the team.

[This is an automated message performed by a Launchpad user owned by ~brian-murray, for any issues please contact him.]

The attachment "leakpatch-1.diff" seems to be a patch. If it isn't, please remove the "patch" flag from the attachment, remove the "patch" tag, and if you are a member of the ~ubuntu-reviewers, unsubscribe the team.
[This is an automated message performed by a Launchpad user owned by ~brian-murray, for any issues please contact him.]

| **tags**: | added: patch |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-22:  [**Fix merged to swift (stable/kilo)**](/cloud-archive/%2Bbug/1493303/comments/58) |  |  | [#58](/cloud-archive/%2Bbug/1493303/comments/58) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270234>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=a4c1825a026655b7ed21d779824ae7c25318fd52>

Submitter: Jenkins

Branch: stable/kilo

commit a4c1825a026655b7ed21d779824ae7c25318fd52

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3.4, at least. See PEP 442.

\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also

       has\_finalizer() in Modules/gcmodule.c in Python.

\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See

        sock\_close() in the same file for the other half of the sad story.

This closes CVE-2016-0738.

Closes-Bug: 1493303

Change-Id: I9b617bfc152dca40d1750131d1d814d85c0a88dd

    Co-Authored-By: Kota Tsuyuzaki <email address hidden>

Reviewed: https://review.openstack.org/270234
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=a4c1825a026655b7ed21d779824ae7c25318fd52
Submitter: Jenkins
Branch: stable/kilo
commit a4c1825a026655b7ed21d779824ae7c25318fd52
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Change-Id: I9b617bfc152dca40d1750131d1d814d85c0a88dd
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>

| **tags**: | added: in-stable-kilo |
| --- | --- |
| **tags**: | added: in-stable-liberty |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-22:  [**Fix merged to swift (stable/liberty)**](/cloud-archive/%2Bbug/1493303/comments/59) |  |  | [#59](/cloud-archive/%2Bbug/1493303/comments/59) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270235>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=8c1976aa771f8c43c5dbe676bd9a5efc69f09eae>

Submitter: Jenkins

Branch: stable/liberty

commit 8c1976aa771f8c43c5dbe676bd9a5efc69f09eae

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3.4, at least. See PEP 442.

\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also

       has\_finalizer() in Modules/gcmodule.c in Python.

\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See

        sock\_close() in the same file for the other half of the sad story.

This closes CVE-2016-0738.

Closes-Bug: 1493303

Change-Id: I74ea49eaa7d5c372cdc2399148d5495d3007dbd0

    Co-Authored-By: Kota Tsuyuzaki <email address hidden>

Reviewed: https://review.openstack.org/270235
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=8c1976aa771f8c43c5dbe676bd9a5efc69f09eae
Submitter: Jenkins
Branch: stable/liberty
commit 8c1976aa771f8c43c5dbe676bd9a5efc69f09eae
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Change-Id: I74ea49eaa7d5c372cdc2399148d5495d3007dbd0
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>

| Changed in swift: | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-22:  [**Fix merged to swift (master)**](/cloud-archive/%2Bbug/1493303/comments/60) |  |  | [#60](/cloud-archive/%2Bbug/1493303/comments/60) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270233>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=58359269b0e971e52f0eb7f97221566ca2148014>

Submitter: Jenkins

Branch: master

commit 58359269b0e971e52f0eb7f97221566ca2148014

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3.4, at least. See PEP 442.

\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also

       has\_finalizer() in Modules/gcmodule.c in Python.

\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See

        sock\_close() in the same file for the other half of the sad story.

This closes CVE-2016-0738.

Closes-Bug: 1493303

Co-Authored-By: Kota Tsuyuzaki <email address hidden>

Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612

Reviewed: https://review.openstack.org/270233
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=58359269b0e971e52f0eb7f97221566ca2148014
Submitter: Jenkins
Branch: master
commit 58359269b0e971e52f0eb7f97221566ca2148014
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-25

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-01-25:  [**Fix included in openstack/swift 2.6.0**](/cloud-archive/%2Bbug/1493303/comments/61) |  |  | [#61](/cloud-archive/%2Bbug/1493303/comments/61) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/swift 2.6.0 release.

This issue was fixed in the openstack/swift 2.6.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-25:  [**Fix proposed to swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/62) |  |  | [#62](/cloud-archive/%2Bbug/1493303/comments/62) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/272201>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/272201

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-26:  [**Fix merged to swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/63) |  |  | [#63](/cloud-archive/%2Bbug/1493303/comments/63) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/comments/63/%2Bdownload) (30.2 KiB)

Reviewed: <https://review.openstack.org/272201>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=f9b7fd3074b5b0e5d6ea879d4144f7bfeec5d46b>

Submitter: Jenkins

Branch: feature/crypto

commit e13a03c379273ee10e678818078b9c40a96a7dc9

Author: Tim Burke <email address hidden>

Date: Wed Jan 20 16:06:26 2016 -0800

Stop overriding builtin range

Change-Id: I315f8b554bb9e96659b455f4158f074961bd6498

commit 0a404def7d54d1ef1c85c11a378052260c4fda4c

Author: John Dickinson <email address hidden>

Date: Wed Jan 20 15:19:35 2016 -0800

remove unneeded duplicate dict keys

Change-Id: I926d7aaa9df093418aaae54fe26e8f7bc8210645

commit 221f94fdd39fd2dcd9a2e5565adceab615d55913

Author: John Dickinson <email address hidden>

Date: Tue Jan 19 14:50:24 2016 -0800

authors and changelog updates for 2.6.0

Change-Id: Idd0ff9e70abc0773be183c37cd6125fe852da7c0

commit 58359269b0e971e52f0eb7f97221566ca2148014

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3...

Reviewed: https://review.openstack.org/272201
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=f9b7fd3074b5b0e5d6ea879d4144f7bfeec5d46b
Submitter: Jenkins
Branch: feature/crypto
commit e13a03c379273ee10e678818078b9c40a96a7dc9
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Jan 20 16:06:26 2016 -0800
Stop overriding builtin range
Change-Id: I315f8b554bb9e96659b455f4158f074961bd6498
commit 0a404def7d54d1ef1c85c11a378052260c4fda4c
Author: John Dickinson <me@not.mn>
Date: Wed Jan 20 15:19:35 2016 -0800
remove unneeded duplicate dict keys
Change-Id: I926d7aaa9df093418aaae54fe26e8f7bc8210645
commit 221f94fdd39fd2dcd9a2e5565adceab615d55913
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 14:50:24 2016 -0800
authors and changelog updates for 2.6.0
Change-Id: Idd0ff9e70abc0773be183c37cd6125fe852da7c0
commit 58359269b0e971e52f0eb7f97221566ca2148014
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612
commit bc4b298b6e208d3188641712c9d66ae82d172c14
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 19 15:33:13 2016 -0800
Fix a comment's indentation
Change-Id: I34514525b606cf82767ddce7769bc42fa5457717
commit 3a0486e532f22af0d3c8a5c5d78613c22e786ff6
Author: Sivasathurappan Radhakrishnan <siva.radhakrishnan@intel.com>
Date: Fri Dec 4 17:43:00 2015 +0000
Deleted comment about part power in FakeRing
Deleted comment about parameter part power in Class FakeRing as its
behavior got dropped in I8bfc388a04eff6491038991cdfd7686c9d961545.
Change-Id: Iec7d2565a77e48493b0056021066d8d8eab65d0b
Closes-Bug: #1488704
commit 999479f9b17b42ccc5da54ce01651960cf7cf970
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 10:30:30 2016 -0800
Bump eventlet min version to 0.17.4
IPv6 support in Swift is dependent on IPv6 support in eventlet.
eventlet itself only claims support for IPv6 post v0.17
(https://github.com/eventlet/eventlet/issues/8). This update matches
the OpenStack global requirements version.
Change-Id: I9d8433cdd3bf7d7a93b8f50b991cc21721a80d22
commit 133a3ea601a3fea84af36a42845f27b8182fd901
Author: Christopher Bartz <bartz@dkrz.de>
Date: Mon Dec 21 14:17:00 2015 +0100
Use the correct split\_path in handle\_request
Change-Id: I86d423309f0b2091ee2e82b2245caf925b6a75ef
Closes-Bug: #1528189
commit bf10974cdefffdaaebc58d21e8a9912638a0405a
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Dec 16 15:46:13 2015 -0800
Expose token expiration time in tempauth auth response
Previously, we gave no indication of when a token would expire. Users
would have to just use it until it stopped working, then re-auth.
Now, a successful auth response will include a new header,
X-Auth-Token-Expires, with the number of seconds remaining until the
token is invalid. This allows the client to attempt to re-auth before
sending a request that will definitely fail.
For comparison, swauth already uses the X-Auth-Token-Expires header with
identical semantics. Additionally, Keystone (v2 and v3) already exposes
expiration times in its JSON responses. The security impact should be
minimal.
Change-Id: I5a4a74276bc0df6dda94e4bc150065c0d77de0eb
commit 47e226418bad35ccad2a1525f392ba69f6165027
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Mon Jan 18 06:20:14 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Ic416c9afc8a1c76f552803a7c70fc905eda7b3cb
commit 5d449471b12c67b31ebb5a383d9bb35bace36213
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jan 14 17:26:01 2016 -0800
Remove some Python 2.6 leftovers
Change-Id: I798d08722c90327c66759aa0bb4526851ba38d41
commit 3c0cf549f1e822cce8f905b069b317e676cf306b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jan 13 18:08:45 2016 -0800
Speed up get\_more\_nodes() when there is an empty zone
The ring has some optimizations in get\_more\_nodes() so that it can
find handoffs that span all the regions/zones/et cetera and then stop
looking. The stopping is the important part.
Previously, it would quickly find a handoff in each unused region,
then spend way too long looking for more unused regions; the same was
true for zones, IPs, and so on. Thus, in commit 9cd7c6c, we started
counting regions and zones, then stopping when we found them all.
This count included all regions and zones in the ring, regardless of
whether or not there were actually any parts assigned or not. In rings
with an empty region, i.e. a region for which there are only
zero-weight devices, get\_more\_nodes() would be very slow.
This commit ignores devices with no assigned partitions when counting
regions, zones, and so forth, thus greatly speeding things up.
The output of get\_more\_nodes() is unchanged. This is purely an
optimization.
Closes-Bug: 1534303
Change-Id: I4a5c57205e87e1205d40fd5d9458d4114e524332
commit 70047709fc9885df7019f791e17a3240682cc6cb
Author: keliang <ke.liang@easystack.cn>
Date: Fri Jan 15 00:31:51 2016 +0800
Drop python 2.6 support
Change-Id: Id6329c863dacb189fccfc304453ed7b6f9607c14
commit a4c2fe95ab2fbe59379a69914ed0fac49c28efbb
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Jan 12 21:26:33 2016 +0100
Allow to change auditor sleep interval in config
Change-Id: Ic451c5e0b686509f8982ed1bf65a223a2d77b9a0
commit edc823e8030640184071fee4920d34f9a1cc6b3e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Nov 29 18:46:47 2015 +0100
Show UTC time in swift-recon.
It's not consistent now for example local time in replication part and
UTC time at begging of line. Use \_ptime in swift-recon for all time
printing and this function returns UTC now.
Change-Id: I732d9851db157130a08e825e8093b7e244b63e9c
commit fa5b32d27964478dfcccf71155d2aaa946c561f0
Author: Tim Burke <tim.burke@gmail.com>
Date: Tue Jan 12 14:18:30 2016 -0800
Make object-auditor storage-policy-aware
Previously, the object-auditor would always use a (replication)
DiskFileManager when walking through AuditLocations, which would cause
it to skip EC fragment archives with a warning like:
Unexpected file <hash\_path>/1452557187.03610#3.data:
Invalid Timestamp value in filename '1452557187.03610#3.data'
Now, the AuditLocation's policy will be used to find an appropriate
manager to get the diskfile. Additionally, several .commit()s were added
to the auditor tests so the .durable will be written, which is required
when auditing EC fragment archives.
Change-Id: I960e7d696fd9ad704ca1872b4ac821f9078838c7
Closes-Bug: 1533002
commit 33476460239c9cdb08dd8065d22d84a4717da7be
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jan 8 16:15:54 2016 -0800
fixups for ipv6 memcache\_servers docs
Change-Id: I20d91c1e276014eaf210fa9eb43788bc17f4e8df
commit d5ff5447be30b44bf4acc8b912b6241a44f710be
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 12 16:42:06 2016 -0800
Install liberasurecode packages in SAIO.
Change-Id: If673afa2b61a3e388612debf4860d561960963a3
commit 4ffc4ba411f67c8407ba38d082a3a51a96ad7e04
Author: Jonathan Hinson <jlhinson@us.ibm.com>
Date: Tue Jan 12 11:46:21 2016 -0600
Functional tests for if-match with multiple etags
Multiple etags can be provided on an if-match or if-none-match
request. This is currently being tested in the unit tests, but not
in the functional tests. Since these etags can be modified by
middleware, we need functional tests to assert multiple-etag
requests are handled correctly.
Change-Id: Idc409c85e8aa82b59dc2bc28af6ca2617de82699
commit e6194113a3c81563590eabf8f761ccb988bb917c
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri Jan 8 16:38:31 2016 -0800
Validate X-Timestamps
Previously, attempting to PUT a new object with an X-Timestamp header
less than or equal to zero (ie, for a timestamp on or before 1970-01-01
00:00:00) would cause the object-server to 500.
While we're at it, cap X-Timestamp at 9999999999 (2286-11-20 17:46:40)
so we don't get an eleventh digit before the decimal point.
Closes-Bug: 1532471
Change-Id: I23666ec8a067d829eaf9bfe54bd086c320b3429e
commit 1f3304c5153e01988b8f4493875b6489e93f76d0
Author: Ben Martin <blmartin@us.ibm.com>
Date: Mon Dec 14 15:28:17 2015 -0600
Print min\_part\_hours lockout time remaining
swift-ring-builder currently only displays min\_part\_hours and
not the amount of time remaining before a rebalance can occur.
This information is readily available and has been displayed
as a quality of life improvement.
Additionally, a bug where the time since the last rebalance
was always updated when rebalance was called regardless of
if any partitions were reassigned. This can lead to partitions
being unable to be reassigned as they never age according to
the time since last rebalance.
Change-Id: Ie0e2b5e25140cbac7465f31a26a4998beb3892e9
Closes-Bug: #1526017
commit 167bb5eeb82886d67c1b382417fb22b8ea85f0d3
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Wed Dec 16 12:07:27 2015 -0800
Fix IPv6 handling in MemcacheConnPool.
The patch removes the assumption of IPv4-only addresses in the
MemcacheConnPool. The changes are around address handling.
Namely, if a server is specified with an address
[<address>]:port (port is optional), it is assumed to be an IPv6
address [1]. If an IPv6 address is specified without "[]", an exception
is raised as it is impossible to parse such addresses correctly.
For testing, memcache can be configured to listen on the link-local,
unique-local, or ::1 (equivalent to 127.0.0.1) addresses. Link-local
addresses are assigned by default to each interface and are of the form
"fe80::dead:beef". These addresses require a scope ID, which would look
like "fe80::dead:beef%eth0" (replacing eth0 with the correct interface).
Unique-local addresses are any addresses in the fc00::/7 subnet. To add
a ULA to an interface use the "ip" utility. For example:
"ip -6 address add fc01::dead:beef dev eth0". Lastly, and probably
simplest, memcache can be configured to listen on "::1". The same
address would be used in the swift configuration, e.g. "[::1]:11211".
Note: only memcached version 1.4.25 or greater supports binding to an
IPv6 address.
Fixes #1526570
[1] IPv6 host literals:
https://tools.ietf.org/html/rfc3986#section-3.2.2
Change-Id: I8408143c1d47d24e70df56a08167c529825276a2
commit fb6751d8ba133c57e1ebb76be71a96f2f120b8ca
Author: Paul Dardeau <paul.dardeau@intel.com>
Date: Fri Jan 8 22:49:05 2016 +0000
Look for device holes that can be reused when adding new device.
Change-Id: I1980ebdd9dc89848173d8ca2fe2afb74029dcfa2
Closes-Bug: 1532276
commit b35f3c90bde8a7ccb50440bda5800cbb8274a5a1
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Jan 8 01:29:11 2016 -0800
Add note COPY with conditional headers
Swift now supports Range header for COPY (or PUT with X-Copy-From)
to make a partial copied object. This patch adds the note to show
it obviously supported in Swift community.
Change-Id: I6bf28f0932c90e7b305cd61aabce4ed028ae691e
Partial-Bug: #1532126
commit 23c7a58f8f1412c28b3a16b79be09c224c9f7d55
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Dec 11 18:26:34 2015 +0900
Fix ClientException handling in Container Sync
swift/container/sync.py uses swift.common.internal\_client.delete\_object
and put\_object and expected these methods raise ClientException.
But delete\_object and put\_object never raise the exception so this patch
raises ClientException when urllib2 library raises HTTPError.
Co-Authored-By: Eran Rom <eranr@il.ibm.com>
Closes-Bug: #1419901
Change-Id: I58cbf77988979a07998a46d9d81be84d29b0d9bf
commit 6786cdf036b4faabe3928c3d0dd9615d94834801
Author: Harshada Mangesh Kakad <harshadak@metsi.co.uk>
Date: Thu Dec 31 01:44:00 2015 -0800
Fixing the deprecated library function.
os.popen() is deprecated since version 2.6. Resolved with use of
subprocess module.
Change-Id: I4409cdd9edbc1a26d6f99c125c9100fadda5d758
Partial-Bug: #1529836
commit 85a0a6a28e166bc076cf8786de2b46248d8786a2
Author: Eran Rom <eranr@il.ibm.com>
Date: Sun Jul 26 13:31:17 2015 +0300
Container-Sync to iterate only over synced containers
This change introduces a sync\_store which holds only containers that
are enabled for sync. The store is implemented using a directory
structure that resembles that of the containers directory, but has
entries only for containers enabled for sync.
The store is maintained in two ways:
1. Preemptively by the container server when processing
PUT/POST/DELETE operations targeted at containers with
x-container-sync-key / x-container-sync-to
2. In the background using the containers replicator
whenever it processes a container set up for sync
The change updates [1]
[1] http://docs.openstack.org/developer/swift/overview\_container\_sync.html
Change-Id: I9ae4d4c7ff6336611df4122b7c753cc4fa46c0ff
Closes-Bug: #1476623
commit e75888b281d59df0889f28d0b32241dac3a34aa2
Author: HugoKuo <tonytkdk@gmail.com>
Date: Wed Jan 6 14:33:23 2016 +0800
Add more description for write\_affinity\_node\_count parameter in the doc.
Change-Id: Iad410a2be4f9a2cd5c53e860b9f91993aa7f2369
Closes-Bug: #1531173
commit f53cf1043d078451c4b9957027bf3af378aa0166
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Jan 5 20:20:15 2016 +0100
Fixed few misspellings in comments
Change-Id: I8479c85cb8821c48b5da197cac37c80e5c1c7f05
commit 3b1591f235f4b85796917507be5e7fd80365ff9e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Wed Sep 30 19:08:09 2015 +0200
swift-init: New option kill-after-timeout
This option send SIGKILL to daemon after kill\_wait period.
When daemon hangs and doesn't respond to SIGTERM/SIGHUP
there is no way to stop it using swift-init now. Classic
init scripts in Linux kills hanged process after grace
period and this patch add same behaviour. This is most
usefull when using "restart" on hanged daemon.
Change-Id: I8c932b673a0f51e52132df87ea2f4396f4bba9d8
commit 79222e327f9df6335b58e17a6c8dd0dc44b86c17
Author: ChangBo Guo(gcb) <eric.guo@easystack.cn>
Date: Sat Dec 26 13:13:37 2015 +0800
Fix AttributeError for LogAdapter
LogAdapter object has no attribute 'warn' but has attribute
'warning'.
Closes-Bug: #1529321
Change-Id: I0e0bd0a3dbc4bb5c1f0b343a8809e53491a1da5f
commit 684c4c04592278a280032002b5313b171ee7a4c0
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Aug 2 22:47:42 2015 +0530
Python 3 deprecated the logger.warn method in favor of warning
DeprecationWarning: The 'warn' method is deprecated, use 'warning'
instead
Change-Id: I35df44374c4521b1f06be7a96c0b873e8c3674d8
commit d0a026fcb8e8a9f5475699cc56e1998bdc4cd5ca
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Wed Dec 16 18:50:37 2015 +0900
Fix duplication for headers in Access-Control-Expose-Headers
There are following problems with Access-Control-Expose-Headers.
\* If headers in X-Container-Meta-Access-Control-Expose-Headers are
configured, the headers are kept with case-sensitive string.
Then a CORS request comes, the headers are merged into
Access-Control-Expose-Headers as case-sensitive string even if
there is a same header which is not case-sensitive string.
\* Access-Control-Expose-Headers is handled by a list.
If X-Container/Object-Meta-XXX is configured in container/object
and X-Container-Meta-Access-Control-Expose-Headers, same header
is listed in Access-Control-Expose-Headers.
This patch provides a fix for the problems.
Change-Id: Ifc1c14eb3833ec6a851631cfc23008648463bd81
commit 0bcd7fd50ec0763dcb366dbf43a9696ca3806f15
Author: Bill Huber <wbhuber@us.ibm.com>
Date: Fri Nov 20 12:09:26 2015 -0600
Update Erasure Coding Overview doc to remove Beta version
The major functionality of EC has been released for Liberty and
the beta version of the code has been removed since it is now
in production.
Change-Id: If60712045fb1af803093d6753fcd60434e637772
commit 84ba24a75640be4212e0f984c284faf4c894e7c6
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Dec 18 11:24:34 2015 +0000
Fix rst errors so that html docs are complete
rst table format errors don't break the gate job
but do cause sections of the documents to go missing
from the html output.
Change-Id: Ic8c9953c93d03dcdafd8f47b271d276c7b356dc3
commit 9fe0e25604dff35db7eab1bca312821a81db6c1d
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Dec 8 22:27:44 2015 -0800
Sleep enough for trampoline
When running unite test suite in local poor resource environment,
sometimes test/unit/proxy/test\_server.py fails due to a lack of
waiting time to trampoline of eventlet thread.
This patch enables to sleep 1 more second when it doesn't seem
to have enough time to tranpoline.
Change-Id: I0bbc8fc245919d3c0a071ff87ff6e20b8d58f9b8
commit 87f7e907ee412f5847f1f9ffca7a566fb148c6b1
Author: Matthew Oliver <matt@oliver.net.au>
Date: Wed Dec 16 17:19:24 2015 +1100
Pass HTTP\_REFERER down to subrequests
Currently a HTTP\_REFERER (Referer) header isn't passed down to
subrequests. This means \*LO subrequests to segment containers
return a 403 on a \*LO GET when accessed by requests using referer
ACLs.
Currently the only way around referer access to \*LO's is to make the
segments container world readable.
This change makes sure the referer header is passed into subrequests
allowing a segments container to only need to be locked down with
the same referer as the \*LO container.
This is a 1 line change to code, but also adds a unit and 2 functional
functional tests (one for DLO and one for SLO).
Change-Id: I1fa5328979302d9c8133aa739787c8dae6084f54
Closes-Bug: #1526575
commit e15960a5d86e00a7d420edc4af034b27da0af8fd
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Thu Dec 17 12:08:45 2015 +0000
Fix incorrect kwarg in auth middleware example
When calling memcache\_client.set(), timeout was deprecated
and is now removed as a keyword arg, use time instead.
Change-Id: Iedbd5b064853ef2b386963246f639fbcd3931cd3
commit 169a7c7f9e12ebc9933bd9ca4592e13b0de8b47b
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Dec 16 15:28:25 2015 +0000
Fix func test --until-failure and --no-discover options
This patch changes functional test classes to subclass
unittest2.TestCase rather than unittest.TestCase.
This fixes errors when attempting to use
tox -e func -- -n <test\_path\_including\_test\_method>
and
tox -e func -- --until-failure
Also migrate from using nose.SkipTest to unittest2.SkipTest
Change-Id: I903033f5e01833550b2f2b945894edca4233c4a2
Closes-Bug: 1526725
Co-Authored-By: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
commit b68311db95860ac1cab585a5ab66bd3b3abb765e
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Dec 15 18:55:41 2015 -0800
Fix reconciler test to calc lastmodified as UTC
Swift reconciler calculates the last-modified date as UTC but
current test calculates it as local time zone. It triggers unit
test failure in non-UTC environment.
This patch fixes the test to calculate the last-modified as UTC
as well.
Change-Id: Ia0053f350daf2cb8c61ac01a933924b6e4b0cb37
Closes-Bug: #1526588
commit 1bb665331af92422290fb585de7cb6a2497236e6
Author: Venkateswarlu Pallamala <p.venkatesh551@gmail.com>
Date: Mon Nov 9 19:22:38 2015 -0800
remove unused parameters in the method
make the helper methods as private by using convention
Change-Id: I73b9604f8d5a0e85d012aac42b7963b618f5ad97
commit 9d7f71d5754c8b45f8e7c6ab80202de09933afb8
Author: Richard Hawkins <hurricanerix@gmail.com>
Date: Fri Aug 7 18:14:13 2015 -0500
Modify functional tests to use ostestr/testr
Defcore uses Tempest, which uses Test Repository.
This change makes it easier for Defcore to pull functional
tests from Swift and run them. Additionally, using testr
allows tests to be run in parallel.
Concurrency set to 1 for now, >1 causes failures for
reasons that are still TBD.
With switch to ostestr all the server logs are being sent to stdout
which makes it completely unreadable. Suppressing the logs by default
now with a flag to enable it if desired.
Co-Authored-By: John Dickinson <me@not.mn>
Co-Authored-By: Robert Collins <rbtcollins@hpe.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Co-Authored-By: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
Change-Id: I53ef4a116996a772cf1f3abc2eb0ad60047322d5
Related-Bug: 1177924
commit 2f4b79233e30d42140bbc07059417443bf7a0757
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Tue Dec 15 15:49:42 2015 +0000
Minor cleanup of repeated identical test assertions
assertDictContainsSubset is being called multiple times with
same arguments in a loop. Since assertDictContainsSubset is
deprecated form python 3.2, replace it with checks on
individual key, value pairs.
Change-Id: I7089487710147021f26bd77c36accf5751855d68
commit 60b2e02905d57f55169e506f4874b2334a1a68a5
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Oct 5 16:15:29 2015 +0100
Make ECDiskFile report all fragments found on disk
Refactor the disk file get\_ondisk\_files logic to enable
ECDiskfile to gather \*all\* fragments found on disk (not just those
with a matching .durable file) and make the fragments available
via the DiskFile interface as a dict mapping:
Timestamp --> list of fragment indexes
Also, if a durable fragment has been found then the timestamp
of the durable file is exposed via the diskfile interface.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I55e20a999685b94023d47b231d51007045ac920e
commit 450737f886050e486f518cdce0c97596ccad848d
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Dec 15 11:33:56 2015 +0900
Fix a typo in development\_auth.rst
This patch uses correct name for "CORS".
Change-Id: I5fee5c581a2b3adb7596a273baf05708bfa97f79
commit 40476ea0797690d3a90a9ed91906d26103dfa058
Author: John Dickinson <me@not.mn>
Date: Mon Dec 14 10:52:22 2015 -0800
Document pretend\_min\_part\_hours\_passed
Added a docstring for the swift-ring-builder CLI command
"pretend\_min\_part\_hours\_passed". This is a dangerous operation, and
that's why it hasn't been documented, but it can be useful at times.
It should be made known to those who need it.
Change-Id: I45bdbaacbbdda64c7510453e6d93e6d8563e3ecd
commit 6ade2908cca696ce1b48a7a19f4d460081fa5b0a
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Dec 13 21:13:42 2015 +0100
Deprecated param timeout removed from memcached
Change-Id: Idf042a79f0db148bf9f28a9e360cb2a3c18d385a
commit 88c9aed7c846402355a3c7831f34f3e833bbdf11
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:19:28 2015 +0200
Port swift.common.utils.StatsdClient to Python 3
\* StatsdClient.\_send(): on Python 3, encode parts to UTF-8 and
replace '|' with b'|' to join parts.
\* timing\_stats(): replace func.func\_name with func.\_\_name\_\_. The
func\_name attribute of functions was removed on Python 3, whereas
the \_\_name\_\_ attribute is available on Python 2 and Python 3.
\* Fix unit tests to use bytes
Change-Id: Ic279c9b54e91aabcc52587eed7758e268ffb155e
commit ca2dcc371921aa1aded6161287cc03c0940bf198
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Fri Dec 11 18:21:28 2015 +0100
Deprecated tox -downloadcache option removed
Caching is enabled by default from pip version 6.0
More info:
https://testrun.org/tox/latest/config.html#confval-downloadcache=path
https://pip.pypa.io/en/stable/reference/pip\_install/#caching
Change-Id: I9451a0f0dee5c5a3c0ca0a52f58bd353602661a2
commit 211758f8cb02298fe16e59bf2954a146c6b24b83
Author: Catherine Northcott <catherine@northcott.nz>
Date: Thu Nov 5 23:04:14 2015 +1300
Add support for storage policies to have more than one name
This patch alters storage\_policy.py to allow storage policies
to have multiple names. Now users are able to add a number of
human-readable aliases for storage policies. Policies now have
a .name (the default name), .aliases (a string of comma
seperated aliases), and .aliases\_list (a list of all human
readable names). Policies will always have an .aliases value
if no aliases are set it will contain the default name.
The policy docs and tests have been updated to reflect changes
and policy.get\_policy\_info has been altered to display the
name and aliases
Change-Id: I02967ca8d7c790595e5ee551581196aa64552eea
commit 7f636a557296ecc6ae4727700cfcf9f82573bd16
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Nov 30 18:06:09 2015 -0800
Allow smaller segments in static large objects
The addition of range support for SLO segments (commit 25d5e68)
required the range size to be at least the SLO minimum segment size
(default 1 MiB). However, if you're doing something like assembling a
video of short clips out of a larger one, then you might not need a
full 1 MiB.
The reason for the 1 MiB restriction was to protect Swift from
resource overconsumption. It takes CPU, RAM, and internal bandwidth to
connect to an object server, so it's much cheaper to serve a 10 GiB
SLO if it has 10 MiB segments than if it has 10 B segments.
Instead of a strict limit, now we apply ratelimiting to small
segments. The threshold for "small" is configurable and defaults to 1
MiB. SLO segments may now be as small as 1 byte.
If a client makes SLOs as before, it'll still be able to download the
objects as fast as Swift can serve them. However, a SLO with a lot of
small ranges or segments will be slowed down to avoid resource
overconsumption. This is similar to how DLOs work, except that DLOs
ratelimit \*every\* segment, not just small ones.
UpgradeImpact
For operators: if your cluster has enabled ratelimiting for SLO, you
will want to set rate\_limit\_under\_size to a large number prior to
upgrade. This will preserve your existing behavior of ratelimiting all
SLO segments. 5368709123 is a good value, as that's 1 greater than the
default max object size. Alternately, hold down the 9 key until you
get bored.
If your cluster has not enabled ratelimiting for SLO (the default), no
action is needed.
Change-Id: Id1ff7742308ed816038a5c44ec548afa26612b95
commit 73d0f1620a269f990dbd3d2796abf27e9a05e227
Author: Béla Vancsics <vancsics@inf.u-szeged.hu>
Date: Tue Dec 8 10:17:08 2015 +0100
Not used parameter
The account variable was not used in the method.
Change-Id: I8e91d7616529f33b615bc52af76bfda01141d364

| **tags**: | added: in-feature-crypto |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-28:  [**Related fix merged to ossa (master)**](/cloud-archive/%2Bbug/1493303/comments/64) |  |  | [#64](/cloud-archive/%2Bbug/1493303/comments/64) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270241>

Committed: <https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d>

Submitter: Jenkins

Branch: master

commit 606a18e718aed329a9d42d298e3119f0f1974e3d

Author: Tristan Cacqueray <email address hidden>

Date: Wed Jan 20 10:19:30 2016 -0500

Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)

Related-Bug: #1466549

    Related-Bug: #1493303

    Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

Reviewed: https://review.openstack.org/270241
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d
Submitter: Jenkins
Branch: master
commit 606a18e718aed329a9d42d298e3119f0f1974e3d
Author: Tristan Cacqueray <tdecacqu@redhat.com>
Date: Wed Jan 20 10:19:30 2016 -0500
Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)
Related-Bug: #1466549
Related-Bug: #1493303
Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-02-09:  [**Fix proposed to swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/65) |  |  | [#65](/cloud-archive/%2Bbug/1493303/comments/65) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/277950>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/277950

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-02-10:  [**Change abandoned on swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/66) |  |  | [#66](/cloud-archive/%2Bbug/1493303/comments/66) |
| --- | --- | --- | --- |

Change abandoned by Alistair Coles (<email address hidden>) on branch: feature/crypto

Review: <https://review.openstack.org/277950>

Change abandoned by Alistair Coles (alistair.coles@hpe.com) on branch: feature/crypto
Review: https://review.openstack.org/277950

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-03-08:  [**Fix proposed to swift (feature/hummingbird)**](/cloud-archive/%2Bbug/1493303/comments/67) |  |  | [#67](/cloud-archive/%2Bbug/1493303/comments/67) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/290148>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/290148

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-03-08:  [**Fix merged to swift (feature/hummingbird)**](/cloud-archive/%2Bbug/1493303/comments/68) |  |  | [#68](/cloud-archive/%2Bbug/1493303/comments/68) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/comments/68/%2Bdownload) (71.7 KiB)

Reviewed: <https://review.openstack.org/290148>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=0f7f1de233919a0b046349a3e31ae7fc8675a1c5>

Submitter: Jenkins

Branch: feature/hummingbird

commit d6b4587a554b51ba733b151e0d924735b63d07e0

Author: Olga Saprycheva <email address hidden>

Date: Tue Mar 8 10:57:56 2016 -0600

Removed redundant file for flake8 check

Change-Id: I4322978aa20ee731391f7709bbd79dee140fc703

commit 643dbce134140530eef2ae62c42fef1107f905ed

Author: OpenStack Proposal Bot <email address hidden>

Date: Tue Mar 8 06:35:49 2016 +0000

Imported Translations from Zanata

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I96b8ff1287bf219c5f8d56a3a4868c1063a953f9

commit 83713d37f0331c5ce9d377f4b4e8724551ae30ca

Author: Daisuke Morita <email address hidden>

Date: Mon Mar 7 18:30:47 2016 -0800

Missing comments for storage policy parameter

There are missing comments about storege\_policy\_index so appropriate

    comments are added.

Change-Id: I3de3f0e6864e65918ca1a13cce70f19c23d295f5

commit 2cff2dec3d1c4588f5103e39679c43b3dded6dcb

Author: Olga Saprycheva <email address hidden>

Date: Fri Mar 4 15:19:39 2016 -0600

Fixed pep8 and flake8 errors in doc/source/conf.py and updated flake8 commands in tox.ini to test it.

Change-Id: I2add370e4cfb55d1388e3a8b41f688a7f3f2c621

commit 043fbca6d08648baa314ea2236f1ccdca8785f16

Author: Christian Schwede <email address hidden>

Date: Fri Mar 4 09:33:17 2016 +0000

Remove Erasure Coding beta status from docs

This removes notes stating support for Erasure coding as beta. Questions

    regarding the stability of EC are coming up regularly, and are often referring

    to the docs that state EC as still in beta.

Besides this, a note marking statsd support as beta has been removed as well.

Change-Id: If4fb6a5c4cb741d42953db3cee8cb17a1d774e15

commit 09c73b86e9255f28fbd4cf571a52c17d549a8f9a

Author: Pete Zaitcev <email address hidden>

Date: Thu Mar 3 10:24:28 2016 -0700

Fix a crash in exception printout

Says the number of arguments does not match the number of '%'.

Change-Id: I8b5e395a07328fb9d4ac7a19f8ed2ae1637bee3b

commit fad5fabe0a22e8a86635a66523dd3d3d3b1fa705

Author: Tim Burke <email address hidden>

Date: Thu Mar 3 15:07:08 2016 +0000

During functional tests, 404 response to a DELETE is successful

Previously, we would only consider 204 responses successful, which would

    cause some spurious gate failures, such as

<http://logs.openstack.org/66/287666/3/check/gate-swift-dsvm-functional/c6d2673/console.html#_2016-03-03_13_41_07_846>

Change-Id: Ic8c300647924352a297a2781b50064f7657038b4

commit e91de49d6864b3794f8dc5acd9c1bf0c2f7409d1

Author: Alistair Coles <email address hidden>

Date: Mon Aug 10 10:30:10 2015 -0500

Update container on fast-POST

This patch makes a number of changes to enable content-type

    metadata to be updated when using the fast-POST mode of

    operation, as proposed in the associated spec ...

Reviewed: https://review.openstack.org/290148
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=0f7f1de233919a0b046349a3e31ae7fc8675a1c5
Submitter: Jenkins
Branch: feature/hummingbird
commit d6b4587a554b51ba733b151e0d924735b63d07e0
Author: Olga Saprycheva <osapryc@us.ibm.com>
Date: Tue Mar 8 10:57:56 2016 -0600
Removed redundant file for flake8 check
Change-Id: I4322978aa20ee731391f7709bbd79dee140fc703
commit 643dbce134140530eef2ae62c42fef1107f905ed
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue Mar 8 06:35:49 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I96b8ff1287bf219c5f8d56a3a4868c1063a953f9
commit 83713d37f0331c5ce9d377f4b4e8724551ae30ca
Author: Daisuke Morita <morita.daisuke@ntti3.com>
Date: Mon Mar 7 18:30:47 2016 -0800
Missing comments for storage policy parameter
There are missing comments about storege\_policy\_index so appropriate
comments are added.
Change-Id: I3de3f0e6864e65918ca1a13cce70f19c23d295f5
commit 2cff2dec3d1c4588f5103e39679c43b3dded6dcb
Author: Olga Saprycheva <osapryc@us.ibm.com>
Date: Fri Mar 4 15:19:39 2016 -0600
Fixed pep8 and flake8 errors in doc/source/conf.py and updated flake8 commands in tox.ini to test it.
Change-Id: I2add370e4cfb55d1388e3a8b41f688a7f3f2c621
commit 043fbca6d08648baa314ea2236f1ccdca8785f16
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri Mar 4 09:33:17 2016 +0000
Remove Erasure Coding beta status from docs
This removes notes stating support for Erasure coding as beta. Questions
regarding the stability of EC are coming up regularly, and are often referring
to the docs that state EC as still in beta.
Besides this, a note marking statsd support as beta has been removed as well.
Change-Id: If4fb6a5c4cb741d42953db3cee8cb17a1d774e15
commit 09c73b86e9255f28fbd4cf571a52c17d549a8f9a
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Thu Mar 3 10:24:28 2016 -0700
Fix a crash in exception printout
Says the number of arguments does not match the number of '%'.
Change-Id: I8b5e395a07328fb9d4ac7a19f8ed2ae1637bee3b
commit fad5fabe0a22e8a86635a66523dd3d3d3b1fa705
Author: Tim Burke <tim.burke@gmail.com>
Date: Thu Mar 3 15:07:08 2016 +0000
During functional tests, 404 response to a DELETE is successful
Previously, we would only consider 204 responses successful, which would
cause some spurious gate failures, such as
http://logs.openstack.org/66/287666/3/check/gate-swift-dsvm-functional/c6d2673/console.html#\_2016-03-03\_13\_41\_07\_846
Change-Id: Ic8c300647924352a297a2781b50064f7657038b4
commit e91de49d6864b3794f8dc5acd9c1bf0c2f7409d1
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Aug 10 10:30:10 2015 -0500
Update container on fast-POST
This patch makes a number of changes to enable content-type
metadata to be updated when using the fast-POST mode of
operation, as proposed in the associated spec [1].
\* the object server and diskfile are modified to allow
content-type to be updated by a POST and the updated value
to be stored in .meta files.
\* the object server accepts PUTs and DELETEs with older
timestamps than existing .meta files. This is to be
consistent with replication that will leave a later .meta
file in place when replicating a .data file.
\* the diskfile interface is modified to provide accessor
methods for the content-type and its timestamp.
\* the naming of .meta files is modified to encode two
timestamps when the .meta file contains a content-type value
that was set prior to the latest metadata update; this
enables consistency to be achieved when rsync is used for
replication.
\* ssync is modified to sync meta files when content-type
differs between local and remote copies of objects.
\* the object server issues container updates when handling
POST requests, notifying the container server of the current
immutable metadata (etag, size, hash, swift\_bytes),
content-type with their respective timestamps, and the
mutable metadata timestamp.
\* the container server maintains the most recently reported
values for immutable metadata, content-type and mutable
metadata, each with their respective timestamps, in a single
db row.
\* new probe tests verify that replication achieves eventual
consistency of containers and objects after discrete updates
to content-type and mutable metadata, and that container-sync
sync's objects after fast-post updates.
[1] spec change-id: I60688efc3df692d3a39557114dca8c5490f7837e
Change-Id: Ia597cd460bb5fd40aa92e886e3e18a7542603d01
commit 3c61ab4678a7aa9ff256ace4bc97ab449607fd49
Author: asettle <alexandra.settle@rackspace.com>
Date: Wed Feb 10 17:58:05 2016 +1000
Operational procedures guide
This is the operational procedures guide that HPE used
to operate and monitor their public Swift systems.
It has been made publicly available.
Change-Id: Iefb484893056d28beb69265d99ba30c3c84add2b
commit 8e4347afd59aa30708ef03a78202652aaadda2e9
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Tue Nov 17 16:15:59 2015 +0900
Fix proxy-server's support for chunked transferring in GET object
Proxy-server now requires Content-Length in the response header
when getting object and does not support chunked transferring with
"Transfer-Encoding: chunked"
This doesn't matter in normal swift, but prohibits us from putting
any middelwares to execute something like streaming processing of
objects, which can't calculate the length of their response body
before they start to send their response.
Change-Id: I60fc6c86338d734e39b7e5f1e48a2647995045ef
commit 9dda1c9526c5b3e0ac905985921605d833bef3cc
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Fri Dec 25 10:30:01 2015 +0900
Update parameters about authtoken middleware in proxy-server.conf.sample
This patch replaces some configration parameters about authtoken
middleware in proxy-server.conf, which will be deprecated.
The following parameters are to be deprecated.
auth\_admin\_prefix, auth\_host, auth\_port, auth\_protocol,
identity\_uri, admin\_token, admin\_user, admin\_password,
admin\_tenant\_name
Change-Id: I373734933189c87c4094203b0752dd3762689034
commit 087fa4fa01fc36343f2ce0974d3b36ec0b98afc8
Author: Andreas Jaeger <aj@suse.com>
Date: Mon Feb 29 20:00:38 2016 +0100
Remove unused pngmath Sphinx extension
There's no RST file that uses ".. math" and thus
the pngmath Sphinx extension is not used and can
get removed.
Change-Id: I3ea4b529025c8ac3c4092f3720124647861e6668
commit 9c5b01e7c7699fbfd221e98ccde1afa9361c8119
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Wed Dec 9 08:08:22 2015 +0000
Add container quota functional test
This patch provides one container quota functional test.
Change-Id: I16354c15fc434d70f9bb6b9b1e18b09357195c83
commit efdc6ee8dbc434e9189a6b85b924c322c3ff6ae3
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Thu Dec 10 01:15:30 2015 +0000
Add X-Delete-After and X-Delete-At functional test
This patch provides functional tests for X-Delete-After and X-Delete-At.
Change-Id: I55b0d0584428413aa7a31f66defec55f9b1bbcd9
commit bd93d44bb46350f716f1dfb66fb43c2ab4ad8c50
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Sun Feb 28 13:41:19 2016 +0900
Make sure all temp files get deleted in test\_ringbuilder
This patch makes test\_ringbuilder create a temporal directory,
run ring builder commands under it, and delete it after testing
for each test cases, to fix temp file leaking.
Change-Id: I6f59fe095ea6485af0e60b5a8e8fc3892e0a0f90
commit 10b5765c60790f8a3ae2a94d6a51736ec2c99ce0
Author: benjkeller <bjkeller@us.ibm.com>
Date: Thu Feb 25 18:54:00 2016 -0600
Rename test\_object\_delete\_at\_aysnc
This renames test\_object\_delete\_at\_aysnc to
test\_object\_delete\_at\_async to match with the function
async\_update which it tests.
Change-Id: I726afcbf08a3449c7af2834e573b97be378a86cd
Closes-Bug: 1550067
commit 9e53bb47efa28983109da8ceca5d316925bc6804
Author: John Dickinson <me@not.mn>
Date: Wed Feb 24 09:36:40 2016 -0800
updated some weird whitespace character to a normal one
Change-Id: I187fb8fc8d10f950bbebc586999eced0bc117432
commit 54e53ae87b6e87229dc77cb7c814ab9733ea7013
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Feb 19 09:30:10 2016 +0000
Silence SkipTest noise in in-process test teardown
setup\_package and teardown\_package get called twice when
running functional tests using nose. With in-process mode
the first call to teardown\_package clears global config
which causes the test swiftclient to raise a SkipTest error
during the second call to teardown\_package.
To reproduce:
SWIFT\_TEST\_IN\_PROCESS=1 nosetests ./test/functional/test\_account.py
This patch simply tests for config existence before attempting
to create a test swiftclient in the teardown\_package function.
Also fix a related issue whereby in\_process flag would be reset to
False during second call to setup\_package, thus causing some of the
in process cleanup in teardown\_package to never be executed.
Change-Id: I074dcd3d39aa46b262632024b047556ca471e8b8
commit 076134784b4eb1c2e55b28218dc0d64a57795d63
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Feb 23 17:28:08 2016 -0800
Add warn method back to LogAdapter
The change in 684c4c04 to improve py3 support breaks older middleware
that consumes the SwiftLogger.
Good for Swift code to not to use warn because it's deprecated.
Bad for LogAdapter to not faithfully provide the current python logging
module API (deprecated or otherwise).
Change-Id: Ib0baf66b7f33f91562867076ff0526a287d8e5a6
commit eb7ca115e6501edd9225dce8784b8b3d3e094bb1
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Feb 23 14:00:34 2016 -0800
Fix StatsD tests to not use real DNS
In common/test\_utils.py, TestStatsdLogging had the majority of its
test cases calling the real socket.getaddrinfo(), which uses real
DNS. This is very slightly slower than using a mock getaddrinfo() when
the machine running the tests has functioning DNS, but on a machine
with no network connection at all, the tests are excruciatingly slow
due to timeouts.
This commit mocks things out as appropriate. There's still one user of
the real getaddrinfo(), but it's for ::1, so that's just local
resolution based on /etc/hosts.
Timing numbers for "./.unittests test.unit.common.test\_utils:TestStatsdLogging":
\* network, without this patch: 1.8s
\* no network, without this patch: 221.2s (ouch)
\* network, with this patch: 1.1s
\* no network, with this patch: 1.1s
Change-Id: I1a2d6f24fc9bb928894fb1fd8383516250e29e0c
commit b97adf70ade2982fea5354c55f1eea9f98442fa7
Author: Thiago da Silva <thiago@redhat.com>
Date: Tue Feb 23 16:23:51 2016 -0500
fix formatting of bulk operations doc
Change-Id: I247d2867c55d6bbf2288dfb74271f57c6f88b243
commit cfd50212358372694ba0713ff8c3bc313c6f1a92
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Feb 18 21:06:40 2016 -0800
dry out container unittests
Change Ifcc4392ffa4df485ce3c62a35d0fcc8c93de74aa introduced
TestContainerController4Replicas as a subclass of
TestContainerController. And there is duplicated code
block to override setUp method.
This patch removed the duplicated code block.
Change-Id: Iad0b64cba52554b89dbd959475a2ce7c0d9a20eb
commit 406e8996fb288e9851e02c3f3faa536a9919b28f
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Mon Feb 22 16:10:09 2016 +0900
Use 201 insted of 200 in PUT test case
There are some unit test cases which assumes 200 as the response
of PUT request, but 200 is never returned in PUT.
This patch replaces 200 in PUT by 201, and adapt unit test cases
to real case.
Change-Id: I35fc7a4fe7fcc5558a9e6c6371105793c2710f3e
commit 5b18455cef57d052df3cda3e9179c923d3aadcad
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Jan 22 07:06:45 2016 +0000
Add unit tests for checking responses in ContainerController
This patch provides unit tests to check responses for various situation
in three/four replicas env.
Change-Id: Ifcc4392ffa4df485ce3c62a35d0fcc8c93de74aa
commit 002513d21786df0d6c71e9772ec4688e2c14d8de
Author: Tim Burke <tim.burke@gmail.com>
Date: Thu Jan 7 11:56:33 2016 -0800
Make write-only container access consistent
Previously, if a user could write to (but not read from) a container,
the behavior for object POST would vary depending on whether
object\_post\_as\_copy was enabled (403 response) or disabled (202
response).
Now, POSTs will consistently be allowed, regardless of whether fast-POST
is enabled.
Change-Id: I1d6dcbc4f5034a322a1073850fc3b059ebb1c0fa
commit 9a6c6b55713f896609b7127560ae99fabbf759e7
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Thu Feb 18 17:38:42 2016 +0100
Fixed log format in object auditor
Change-Id: I218e08446c5ffda2db7c774ec8bb9d28ce9f63e7
commit 2d55960a221c9934680053873bf1355c4690bb19
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Thu Jan 14 18:31:21 2016 +0000
Fix inconsistent suffix hashes after ssync of tombstone
Consider two replicas of the same object whose ondisk files
have diverged due to failures:
A has t2.ts
B has t1.data, t4.meta
(The DELETE at t2 did not make it to B. The POST at t4 was
rejected by A.)
After ssync replication the two ondisk file sets will not be
consistent:
A has t2.ts (ssync cannot POST t4.meta to this node)
B has t2.ts, t4.meta (ssync should not delete t4.meta,
there may be a t3.data somewhere)
Consequenty the two nodes will report different hashes for the
object's suffix, and replication will repeat, always with the
inconsistent outcome. This scenario is reproduced by the probe
test added in this patch.
(Note that rsync replication does result in (t2.ts, t4.meta)
on both nodes.)
The solution is to change the way that suffix hashes are
calculated. Currently the names of \*all\* files found in each
object dir are added to the hash. With this patch the
timestamps of only those files that could be used to
construct a valid diskfile are added to the hash. File
extensions are appended to the timestamp so that in most
'normal' situations the result of the hashing is the same
as before this patch. That avoids a storm of hash mismatches
when this patch is deployed in an existing cluster.
In the problem case described above, t4.meta is no longer
added to the hash, since it is not useful for constructing
a diskfile. (Note that t4.meta is not deleted because it
may become useful should a t3.data be replicated in future).
Closes-Bug: 1534276
Change-Id: I99e88b8d5f5d9bc22b42112a99634ba942415e05
commit ddeb0cde9fc828fa79dce90df4975f66737ba054
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Wed Feb 17 21:17:34 2016 -0800
Fix object-server to handle newer ts file
Swift object-server will return 409 Conflict when the incomming
request X-Timestamp is older than the local disk file to prevent
wasted data transfer and disk space consumption. However, IFF,
the local disk file is a tombstone, current object-server will
write the data in the device and cleanup it according to timestamp
comparison result in hash\_cleanup\_list\_dir, and then return 201
Created. That's wasted and far from the semantics in the normal case.
This patch fixes object-server to catch the DiskFileDeleted exception
at PUT request, and then, set the timestamp from tombstone as
original\_timestamp to be able to compare with request timestamp.
Co-Authored-By: Kazuhiro Miyahara <miyahara.kazuhiro@lab.ntt.co.jp>
Change-Id: I078c9cb90707a3c320708e76ea42cbfa73e1ea4b
Closes-Bug: #1546865
commit 878688cae00576ec0bdb0a66eca7ada95e661c0a
Author: Béla Vancsics <vancsics@inf.u-szeged.hu>
Date: Mon Dec 7 17:02:40 2015 +0100
Reduce code duplication
Reduced source code by extracting duplicated code
(swift/common/direct\_client.py)
http://openqa.sed.hu/dashboard/index/5?did=1
Change-Id: I47fa6ae12c646e8e42fb0a46a017971f05d883fc
Closes-Bug: 1536067
commit c3201f256cf415988a3cb1c42e9c6b7835195fa3
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Fri Jan 8 18:03:33 2016 +0900
Remove execute permissions from doc files and swift.conf-sample
Some doc files and swift.conf-sample were added execute permissions in past changes.
This patch remove execute permissions from them.
Change-Id: Id8844989a8321578e9207566ebd6660f5b9523f0
commit e46d6b17251ab538595b1deb5581360a286b8fd1
Author: Christian Schwede <cschwede@redhat.com>
Date: Wed Feb 17 20:47:26 2016 +0100
Add note on using printable chars for swift\_hash\_path\_suffix/prefix
Using unprintable characters for swift\_hash\_path\_prefix/suffix might lead to
hard problems when parsing of these values changes, for example due to newer
Python versions or changes in the parsers itself. Let's avoid this and add a
note that deployers should use printable strings for these values.
Change-Id: I976982b753b6af831ab91d7190f50f8f15bf73bf
commit b8fa48080812ab0f6bac7ae19c0290da08f6a6e4
Author: Donagh McCabe <donagh.mccabe@hp.com>
Date: Thu Feb 4 16:19:13 2016 +0000
Added links to API reference and usage guides
Added a link to the API reference (where headers and query
strings are documented; click the "detail" button to see).
Also added a reference to Swift section of the OpenStack end
user guide. This contains some additional details about the API.
No attempt was made to reconcile duplicate information. Instead
this patch links documents that might otherwise be overlooked.
However, I fixed text, originally in a table, that had become
garbled in a prior patch.
Change-Id: I0910cbeb0c8bffc00e510f35585603e7b7a67790
commit aa7204d106ae33eba9219514f31f008510c9db53
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Fri Feb 12 20:48:34 2016 +0900
Remove '#! /usr/bin/env python' from unexecutable files
'cli/recon.py' and 'cli/ring\_builder\_analyzer.py' have '#! /usr/bin/env
python' in spite of they don't have execute permissions. This patch
removes '#! /usr/bin/env python' from them.
Change-Id: I1917ccc84b1673af3d862be1796f54595f94c5ca
commit db87a5a9889d436f2e2aacdc8923d55ca0d3d1ca
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Feb 16 10:52:01 2016 -0800
Mock sleep in direct\_client retry tests
... and fixup some assertions, and other mocks
Change-Id: Iadf839d1d3d735109fed24049fc3d829776b7b65
commit 8eb30afd7c39f6e6ba031f72c6a61f45b28d37f6
Author: Tim Burke <tim.burke@gmail.com>
Date: Tue Feb 16 10:25:39 2016 -0800
Static methods should be @staticmethods
Change-Id: Ifee5d68e00bbb3571aaac885cdd7490c79732985
commit 4a44e27e00795c5f12176ef346cd2249fca54fd8
Author: Chaozhe.Chen <chaozhe.chen@easystack.cn>
Date: Tue Feb 16 23:44:27 2016 +0800
Replace assertEqual(None, \*) with assertIsNone in tests
As swift no longer supports Python 2.6, replace assertEqual(None, \*)
with assertIsNone in tests to have more clear messages in case of
failure.
Change-Id: I94af3e8156ef40465d4f7a2cb79fb99fc7bbda56
Closes-Bug: #1280522
commit 42f4b3fc1e69a046c1e70e73afe847e4423fa2da
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Feb 16 10:08:55 2016 +0000
Add SwiftHLM to associated projects
Change-Id: I5ea3de34e61f22abec803b35fec8adde18a793e9
commit 025ebf2901d5a972796b73538bb306847d7d06b6
Author: Ankur Gupta <ankur.gupta@intel.com>
Date: Wed Feb 10 14:36:16 2016 -0600
Docstring omission in class BaseDiskFileManager.
Added documentation for missing Docstring variables.
Change-Id: I29a53b8141c5607815f234a6123e2289200bca34
commit 4906b4c431edc436f165b163a228b0a221950c79
Author: Janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jan 12 12:50:43 2016 +0530
Fix missing txn\_id logs in GreenAsyncPile's spawned functions
This commit ensures that the logger thread\_locals
value is passed to and set in \_get\_conn\_response methods
executed in a green thread.
Added partial bug tag because in bug description a more
relevant fix is suggested which would fix the bug completely
but for now this makes sense to add this commit for logging.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I13bbf174fdca89318d69bb0674ed23dc9ec25b9a
Partial-Bug: #1409302
commit 511a1b8698889c430bf673ed916ae41a96b99c5c
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Fri Feb 12 19:01:59 2016 +0900
Remove execute permission from swift/cli/ringbuilder.py
In Change-Id: Ia63f59a8faca1fad990784f27532ca07a2125454,
'bin/swift-ring-builder' is renamed to 'swift/cli/ringbuilder.py'.
However, execute permission and '#! /usr/bin/env python' are left on
the file.
This patch removes execute permission and '#! /usr/bin/env python'
from the file.
Change-Id: I66370f825ce9ed9a40ec21f2745aa6aff22c8709
commit 973d9358d2e6e029409d1902831b4680e02952c9
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Thu Feb 11 10:20:10 2016 +0100
Bump PyECLib requirement to >= 1.2.0
This was discussed at last Swift meeting [1] and conclusion was
to require newest PyECLib version.
[1] http://eavesdrop.openstack.org/meetings/swift/2016/swift.2016-02-10-21.00.log.html#l-268
Depends-On: I0fd58f26bc0a3e7715356ff74344981f22786152
Change-Id: I54e89d99b48e00e614d2d457814c00354763c83b
commit d3dd137cad896c7f741592e88f076acab2636a3c
Author: Tomas Matlocha <tomas.matlocha@firma.seznam.cz>
Date: Tue Jan 5 12:32:50 2016 +0100
Additional info log message for drive-audit
An additional info log message was added for case of
running drive-audit without failed device unmounting.
Change-Id: I11abee40a712b6c6de65e63626b6f7f0a9c9f4c7
commit c4158bd674f34c8a0648c98974ba474fcd1c2b7a
Author: Sarafraj Singh <Sarafraj.Singh@intel.com>
Date: Thu Feb 11 20:52:47 2016 +0000
Fixed params on autocreate\_account docstring
... in proxy.controllers.base
Change-Id: Ic5c27cbf0f19b65fcaa3e6587583f03e56d646a0
commit f56d18e143d0a38584e4c383ea9afe46e67a0af6
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Feb 11 10:59:43 2016 -0800
Fix typos in comments
Change-Id: I4f98d447bd2ddd8eeb2f4da66d069bd7d6f00dc6
commit cc8dc88b55b44ca2a1fd65c049f3cfec22eb5525
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Thu Feb 4 16:02:42 2016 +0100
Script for checking sanity of manpages
Change-Id: Ia27b0ecf6a3267eb51f8a6562721dca72f128915
commit bcada66b9065c94cd39498a5330c727cc575a6fe
Author: root <lr699s@att.com>
Date: Wed Feb 10 09:21:53 2016 -0600
Removed unused parameter in server.py
The variable max\_large\_object\_get\_time is no longer used and was
removed to reflect the change.
Change-Id: I43051181dcb38245de6d13fab63876e83f46fc39
Closes-Bug: #1538834
commit b5311f63dbf5787bda3495a58c8ef7a6a557daa4
Author: gh159m <gh159m@att.com>
Date: Wed Feb 10 10:36:59 2016 -0600
Removed default value for log\_statsd\_host
Multiple files and documents showed that log\_statsd\_host had
a default value, usually localhost. This was incorrect, instead
setting a value for log\_statsd\_host enables statsd logging.
Removed any reference of log\_statsd\_host having a default value.
Also changed descriptions to show setting a value enables logging.
Change-Id: I3ca5c0e8b8e4981de3aa6db0c476072b5a59723d
Closes-Bug: #1542227
commit b98c1c60f9c581c76677c19baae60ae720e3c7f3
Author: Christian Berendt <berendt@b1-systems.de>
Date: Tue Feb 9 07:32:48 2016 +0100
Remove executable flag from sample config file
swift.conf-sample should not be executbale
Change-Id: I960058e2af10b43efc6324a7534d9a23c810e39a
commit 81a4355c2d0907035805c300a9fa5aaa6d0e70c4
Author: Christopher Bartz <bartz@dkrz.de>
Date: Fri Feb 5 09:51:11 2016 +0100
Adds storage policy option to recon
With this patch, recon gets policy-aware in regard to the hosts to retrieve.
If no policy is passed and the server\_type is object,
all hosts of all policies are retrieved.
Previously, recon did only retrieve the hosts of the storage-policy 0.
Change-Id: If5735cd6721eac504aed8aaf3884cb91b6a0fcac
Closes-Bug: 1541491
commit 87fc21c7cfcce2a3e23a84fddcfd1309cd884716
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Mon Feb 8 15:31:42 2016 +0000
Speed up functional testing
test/functional/tests.py:TestObjectVersioningUTF8 does not clean
up the versions files it creates because the class's multiple
inheritance is such that it does not call the tearDown method in
TestObjectVersioning.
As a result, any attempt to clean up account containers wastes
time retrying container delete requests. This occurs either in
the setUp for TestSloEnv, if the TestSlo class is included in a
test run, or in the tests.py package tearDown method.
On the author's dev machine this patch reduces the execution
time of functional tests in tests.py by approx 30% or 1 minute.
Change-Id: I8194672bf2ca82435df5868720b6a55a79b94413
commit 3b94bd45406f9d457d37caa10c856a19c4cec22a
Author: Mingyu Li <li.mingyu@99cloud.net>
Date: Sun Feb 7 21:41:08 2016 +0800
Keep the Usage of exit()/sys.exit() Consistent
It's better to keep the usage of exit()/sys.exit() consistent
in one file. Furthermore, sys.exit() is considered good to be
used in production code, while exit is for interactive shell.
Change-Id: Ia3092853a648922588e2bc11db37d6decdec1b48
commit f05da4c8fa37a285bb2ca9b45a355dbe57f7add4
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Feb 6 16:59:57 2016 +0530
Changing the base version to python2.7 for pep8 checks
tox was taking python3 as it's base version which lead to
tox pep8 check failing on local env:
http://paste.openstack.org/show/486183/
Change-Id: Ia822ec5b5e12a1fc30b676f1e6d95e287b9b3368
commit 13edc9a865cd203ddf28a3f782426a1b3b94f7a1
Author: Sarafraj Singh <Sarafraj.Singh@intel.com>
Date: Fri Feb 5 17:28:26 2016 +0000
Improved test coverage of form\_signature
Added four new test cases to execute path of invalid arguments. This
improved test coverage of file specified from 80% to 91%.
Change-Id: I63c2e7bab3f01121301d78b687687208a58401c0
commit b173995666b026def3f6558d9a8c972b75449323
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Thu Feb 4 05:18:42 2016 -0800
Fix missing Accept-Ranges
Since commit 4f2ed8bcd0468f3b69d5fded274d8d6b02ac3d10, the response
header for GET EC object doesn't include the Accept-Ranges header.
This patch fixes it and also adds a few unittests to prevent regression.
Closes-Bug: #1542168
Change-Id: Ibafe56ac87b14bc0028953e620a653cd68dd3f84
commit d78e861d850db96989f4fb77ad31e3170034f15d
Author: Richard Hawkins <richard.hawkins@rackspace.com>
Date: Wed Jan 13 13:15:07 2016 -0600
Add option for label to static web listings
By default listings are rendered with a label of:
"Listing of /v1/account/container/path"
This change adds a new custom metadata key/value pair
"X-Container-Meta-Web-Listings-Label: <label>" that
when set, will cause the following:
"Listing of <label>/path" to be rendered instead.
Change-Id: I47c5d21834f47e566b380920196926882ff83abf
commit ae632abbd802228ef98a23c98ee49988e7e5b942
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Feb 2 21:58:52 2016 +0100
Fixed manpages errors.
account-server.conf.5
105: warning: numeric expression expected (got `)')
container-server.conf.5
111: warning: numeric expression expected (got `)')
object-expirer.conf.5
79: warning: numeric expression expected (got `)')
object-server.conf.5
114: warning: numeric expression expected (got `)')
proxy-server.conf.5
121: warning: numeric expression expected (got `)')
331: warning: numeric expression expected (got `[')
1005: warning: macro `\*' not defined
Change-Id: I203dcfde83035e3b1dcb91109b72b5d08bb7840e
commit f2fca9aafa17e45b668c6f76b256927681cc463a
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Tue Feb 2 11:43:44 2016 +0000
Fix time-shifting of objects PUT with container-sync
When container-sync PUTs an object to a destination container
it uses the timestamp from the container row rather than the
actual timestamp of the object being copied. The actual timestamp
of the object can be newer, so the sync'd object may end up with
the right content but at the wrong, older, timestamp.
This patch changes the timestamp sent with the sync'd object
to be that of the actual source object being sent.
Drive-by fix to make code more readable by removing a variable
rename mid-function, fix a typo and remove a redundant function
call.
Change-Id: I800e6de4cdeea289864414980a96f5929281da04
Closes-Bug: #1540884
commit 050e3b35dd88f7b31b6810d9ac88548ef371e3ce
Author: venkatamahesh <venkatamaheshkotha@gmail.com>
Date: Thu Feb 4 16:47:15 2016 +0530
Use uppercase 'S' in word "OpenStack"
Change-Id: I4692aa58b5173b1b662d5eee19fac770ae5aaed0
commit e47aaaacf15e8f0c7226400541a97238447a7f56
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Feb 3 12:52:29 2016 -0800
Stop nesting functions unnecessarily
Change-Id: Iff120d0bac8a075c37bbddcd2bb0fe85145f1749
commit 26327e1e8b1d37faa764ec586f5bee0e1560eea2
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu Jan 21 11:18:18 2016 -0800
Allow IPv6 addresses/hostnames in StatsD target
The log\_statsd\_host value can now be an IPv6 address or a hostname
which only resolves to an IPv6 address. In both cases, the new
behavior is to use an AF\_INET6 socket on which .sendto() is called
with the originally-configured hostname (or IP). This means the
Swift process is not caching a DNS resolution for the lifetime of
the process (a good thing).
If a hostname resolves to both an IPv6 or IPv4 address, an AF\_INET
socket is used (i.e. only the IPv4 address will receive the UDP
packet).
The old behavior is preserved: any invalid IP address literals and
failures in DNS resolution or actual StatsD packet sending do not
halt the process or bubble up; they are caught, logged, and
otherwise ignored.
Change-Id: Ibddddcf140e2e69b08edf3feed3e9a5fa17307cf
commit 2f8e6040470948cf17c5fc5fddd0991a415d2a4c
Author: Eran Rom <eranr@il.ibm.com>
Date: Wed Feb 3 08:59:53 2016 +0200
Fixing typo in unit test
The typo does not influence the correctness of the test
yet its ugly. bhhha.
Change-Id: I62e511bae23523892b87309dd3c50aea61742f2d
commit f27ad34e1d4e5dc306eed3ff620a294a4c301f31
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Feb 2 11:44:39 2016 -0800
Document use-case for slow option
Change-Id: Iec4087a896a2277179e3720d802cca101fa7ad54
commit 16976a0f14ee2b5f7abc76086f9abfb9f337a655
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Jan 31 10:30:06 2016 +0100
Changed EC backend from jerasure to liberasurecode in examples and docs
liberasurecode\_rs\_vand is build-in liberasurecode, so you don't need
another depedency libjerasure2.
liberasurecode\_rs\_vand is supported by pyeclib from 1.0.8
version, so bumping version up.
Closes-Bug: #1534325
Change-Id: If2d96875694df8fd48c5278395859aaa165cb566
commit 30d74af6534b754e6ad9bfdcbff4ec494277ca83
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 27 13:50:57 2016 +0000
Insert versioned\_writes in correct pipeline position
If not explicitly configured the versioned\_writes middleware
should be auto-inserted in the pipeline after slo and dlo, which
is where the versioned\_writes filter section's comments say it
should be in proxy-server.conf-sample. At the moment it can end up
being placed ahead of slo and dlo if they have been explicitly
configured, which results in the linked bug manifesting.
Closes-Bug: #1537042
Change-Id: I6ac95a331f4ef0d4887311940acc6f8bc00fb4eb
commit ccdf4a9f309af5fe1401a6e4b776b08c3f6a655c
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Feb 2 09:38:55 2016 +0100
Document slow option in etc/object-server.conf
Change-Id: Ic9940b0b830a468887878f7b0d7ca42c2cbbebd5
commit b19dc1ddecdc68760ca2f5a2b7b4bbdce2199b35
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Feb 1 15:30:59 2016 -0800
Always fix devices with multiple part-replica assignments
I've found that given a sufficiently bad replica2part2dev table we can
accidently not entirely fix palcement when more than two replicas of a
part are assigned to the duplicate devices.
It shows up most on > 3 replica rings when you have two \*different\*
devices both holding two replicas. But you can see it on a three
replica ring when all three replicas are assigned to the same device.
Change-Id: Ieb213c1a259815a2ed657291242919cda568c7b5
commit c722fa1ab318b233fc11f8e1bd8758dbe33e87bb
Author: dangming <dangming@unitedstack.com>
Date: Mon Feb 1 16:13:54 2016 +0800
Fix spelling error
Change-Id: I4a1400c4d383acd59727ada3661a8dffc67825fb
commit c7e5e125003de1a0f288f79783e9a41650e6f686
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Jan 29 14:22:19 2016 +0000
Enable in-process func tests to optionally use fast-post
Running functional tests in the in-process mode uses
the default value for proxy-server object\_post\_as\_copy,
which is True. This patch adds support for an environment
variable to change this value to False so that the fast-post
mode is tested when running in-process functional tests.
The patch also adds a new tox environment func-in-process-fast-post
which forces in-process functional testing with
object\_post\_as\_copy=False.
The motivation for this change, apart from enabling configurable
local testing, is to put support in place for an upstream CI job
that will actually functionally test the fast-post mode, which is
otherwise only covered by unit tests.
There are currently two gate jobs that run the functional tests:
- gate-swift-dsvm-functional runs the tests \*twice\* against a
devstack swift service, once using tempauth and once using
keystoneauth. The devstack swift service uses the default
object\_post\_as\_copy=True.
- gate-swift-tox-func runs the func tests in in-process mode
which also uses tempauth and object\_post\_as\_copy=True. This
duplicates one of the config scenarios above.
With this change either the gate-swift-tox-func job or a new job
could run the functional tests using object\_post\_as\_copy=False.
Change-Id: Ia37f6df1dc38e44ef7404fbf0a52f6fc22fae0c2
commit 4ba290bac19b1b6e8f709848fd35cda33b8bd1c4
Author: Qiaowei Ren <qiaowei.ren@intel.com>
Date: Mon Feb 1 16:44:52 2016 +0800
Replace exit() by sys.exit()
sys.exit() is considered good to use here.
Change-Id: I365b0dbb50c8f1953b41665ba49145ac6db1b24f
commit 9aff76bd18e609eb657db14f2d60e605ee28d472
Author: Qiaowei Ren <qiaowei.ren@intel.com>
Date: Mon Feb 1 17:15:32 2016 +0800
fix typo
informations -> information
Change-Id: I6bcb9bb9fd24b873b49de4a686b223550dd703ac
commit a8e0dc550bf35010595ce791433cd68c4b8d5287
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Sun Jan 31 06:15:17 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: If1cd20e187720f5ee02c6a1574f612c8a8e26e30
commit 02c06585e6e0403d1a983fccaba5093e3d3fa7c5
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Fri Jan 29 22:46:50 2016 +0100
Renamed variable for better code readability
Change-Id: I22d8db0dd9edc39672fc9997895a24f669975e15
commit 595ec464e3fdc5a766eee9baa06edd074576c73e
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Jan 29 15:28:56 2016 +0000
Trivial fix for sphinx warnings
Including a \* in the param name causes a sphinx warning,
messes up the html formatting, and strictly the \* isn't part of
the param name.
Change-Id: I6be6a7aa2a371eaae9f8e501435838c1e15f4a1c
commit cc90834a8ed7bd84440bf132a94978a47ee2f3da
Author: Mingyu Li <li.mingyu@99cloud.net>
Date: Fri Jan 29 03:48:47 2016 +0900
A minor modification of the Deployment Guide
In the section of General Service Tuning, there is a sentence
"Our Storage servers all run together on the same servers".
The word "servers" is used twice with different meanings, which
would be a little confusing. This patch makes it more understandable.
Change-Id: I6d806456aeb7d0ecf297c04dacbd271b94a0425c
Closes-Bug: #1526697
commit a1776b9c1f23fbd604114b377434e4269d2f1a2e
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Thu Jan 28 16:47:37 2016 +0000
Let equal Timestamps not be unequal
Make the result of Timestamp(x) != Timestamp(x) be False.
In python 2.7 this requires the \_\_ne\_\_ method to be defined [1].
"The truth of x==y does not imply that x!=y is false." The
functools.total\_ordering decorator does not autocreate a \_\_ne\_\_
method.
In python 3 the \_\_ne\_\_ method is not required [2]. "By default,
\_\_ne\_\_() delegates to \_\_eq\_\_() and inverts the result".
This patch puts back the \_\_ne\_\_ method removed in [3]. Whilst no tests
fail on master with python2.7, they do on this patch [4] and it seems
dangerous to have this absurd behaviour lurking.
[1] https://docs.python.org/2/reference/datamodel.html#object.\_\_ne\_\_
[2] https://docs.python.org/3.4/reference/datamodel.html#object.\_\_ne\_\_
[3] Change-Id: Id26777ac2c780316ff10ef7d954c48cc1fd480b5
[4] Change-Id: Ia597cd460bb5fd40aa92e886e3e18a7542603d01
Change-Id: I01fbfa310df3c74390f8e8c2e9ffff81bbf05e47
commit c3886eea15f11104764fb201e85202dd871c3027
Author: Thomas Goirand <thomas@goirand.fr>
Date: Thu Jan 28 09:15:28 2016 +0000
Fix a few English mistakes in man
These errors are producing lintian warnings, so fixing them
helps having less errors when checking for Debian packages.
Change-Id: Iff99a8d5f2276515f42d758d110a43cae757db28
commit 400cc707273bab0b70a3cdf5dec1c55c2edc4e22
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 27 15:35:40 2016 +0000
Remove a print statement from tests
Change-Id: I213b7e4bc4f9e6de76ebab572c377af61072d9c5
commit c871e423ef0bed6c774693af3d54750235d6ce1f
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Jan 22 05:19:06 2016 +0000
Add unit tests for checking responses in AccountController
This patch provides unit tests to check responses for various situation
in three/four replicas env.
Change-Id: I1af48728b28da9780a2a78f3110e1c7487047ff8
commit e45d30d6b7b596b80c63e75018ad07582d705ee1
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 27 10:18:37 2016 +0000
Remove unnecessary code from test\_account.py
Change-Id: Ia197ba08a606421244d5b94a900bdc39bc5da647
commit f39cffbb5f7f1853f7f67261c4652b9875d302be
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Jan 26 20:16:08 2016 -0800
Follow up mem\_server diskfile fixes
This is a follow-up patch for change
https://review.openstack.org/#/c/270422
That patch fixes POST behavior on object mem server and adds
some tests for last-modified. However, that one doesn't check
the POST updates the last-modified on object server.
This patch adds assertions to make sure the actual POST semantics.
\*bonus\* Add docs and cleanup variable name to fit actual instance
at mem diskfile.
Change-Id: I78185cdfb0ea604b2122821870ec34322236f48d
commit 9ef15453fadb847db0f0fb92e935785b544da3fc
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Thu Jan 21 14:18:31 2016 +0900
Fix handling of "Permission Denied" error from NamedTemporaryFile function
If "Permission Denied" has happen in NamedTemporaryFile function in
dump\_recon\_cache method, swift will log a message of reference to a variable
without assignment and not log a message of "Permission Denied".
This patch fixes the handling and add an unit test.
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Iafdd94905e9e9c81f5966a923324b50c18fcf592
commit 01410129dac6903ce7f486997a48e36072fa0401
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Aug 21 18:15:25 2015 -0700
Make handoffs\_first a more useful "mode"
Based on experience using handoffs\_first and feedback from other
operators it has become clear that handoffs\_first is only used during
periods of problematic cluster behavior (e.g. full disks) when
replication attempts are failing to quickly drain off the partitions
from the nodes which they have been rebalanced from.
In order to focus on the most important work (getting handoff partitions
off the node) handoffs\_first mode will abort the current replication
sweep before attempting any primary suffix syncing if any of the handoff
partitions were not removed for any reason - and start over with
replication of handoffs jobs as the highest priority.
Note that handoffs\_first being enabled will emit a warning on start up,
even if no handoff jobs fail, because of the negative impact it can have
during normal operations by dog piling on a node that was temporarily
unavailable.
Change-Id: Ia324728d42c606e2f9e7d29b4ab5fcbff6e47aea
commit 78cfb137d5d3d6f4770923a1fb086adaa9c0676f
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Nov 11 19:05:09 2015 -0800
Ring Overview updates
Change-Id: Ic5a8ec5be9fec7fa812fdb7b91890d5fc2fbf967
commit 24227e8bb0d4d369eeab61ab5c20730b4f84b36a
Author: Richard Hawkins <richard.hawkins@rackspace.com>
Date: Wed Jan 13 10:16:29 2016 -0600
\_get\_info\_cache should encode unicode metadata
Closes-Bug: 1533768
Change-Id: I67bbd0e8802d2a34cb3a0b0fafe26bbc62221032
commit fc9a3852e44b2bf1258fcb24a6c12ecfb2795f44
Author: Tim Burke <tim.burke@gmail.com>
Date: Mon Jan 25 09:25:20 2016 -0800
Don't .lower() a literal
It feels silly, and we don't do it for any of the other headers in
headers\_to\_container\_info.
While we're at it, clean up a stray '
Change-Id: I0745038cc3832a77d064e515c37cacbdcb97c4d9
Related-Change: Iea3d06de80210e9e504e296d4572583d7ffabeac
commit 5c6576d1eb3c4c042bb46dd48f23d2fd474eba07
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Mon Jan 25 18:20:45 2016 +0100
Fixed docs: Title underline too short
Change-Id: If96b0e799a4671e7b7f3f5bea2628db75afa9578
commit 9c403d5e1bb1f404445f1731e3ff1b5c034336a6
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:31:12 2015 +0200
Port swift.common.utils.Timestamp to Python 3
\* Fix Timestamp.isoformat(): on Python 3, round manually to use the
same rounding method than Python 2.
\* Use @functoos.total\_ordering on Timestamp instead of the \_\_cmp\_\_()
special method. On Python 3, the \_\_cmp\_\_() method is no more used,
and other special methods must be defined (\_\_eq\_\_, \_\_lt\_\_, etc.).
Only define \_\_eq\_\_() and \_\_lt\_\_() methods but use
@functools.total\_ordering to generate other methods.
\* Fix also a Python 3 issues in swift.common.swob.\_datetime\_property:
replace (float, int, long) with (float,) + six.integer\_types. The
long type was renamed to int in Python 3.
Change-Id: Id26777ac2c780316ff10ef7d954c48cc1fd480b5
commit c790db89369221473bcbfc23f301424ab8d30d60
Author: Andrew Welleck <awellec@us.ibm.com>
Date: Mon Jan 25 10:03:18 2016 -0600
Additional step for Debugging Issues in SAIO
Adding an additional debugging step for the SAIO "Debugging Issues"
section. Adding step to check if memcache is running and to start
it if its not.
Change-Id: I0bfa563f595dbefcf907494451fad45e6310db88
commit d47155af262d52c284f262bf6c303d0587000bba
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 17:22:24 2015 +0200
Add \_\_next\_\_() methods to utils iterators for py3
On Python 3, next(obj) calls obj.\_\_next\_\_(), not obj.next(). Add an
alias from \_\_next\_\_() to next() to be compatible with Python 2 and
Python 3.
Change-Id: Ida104d3bd7cdba557e523f18df43d56847060054
commit 0f8319dceb2d21a9d1ec74f78203b033f25c0969
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri Jan 22 13:31:34 2016 -0800
Use calendar.timegm not time.mktime
time.mktime produces a POSIX timestamp that takes into account the local
timezone, but we're parsing a Last-Modified header with a known (GMT)
timezone. As a result, if one proxy-server is configured with a timezone
other than GMT/UTC, we may have previous versions in the wrong order.
Change-Id: I320e2368b243f4245725e73bfabc7ad19bc5bacb
commit 72d972166ff66d3c5313356c1e1e3984fee9f012
Author: paul luse <paul.e.luse@intel.com>
Date: Thu Jan 21 13:30:15 2016 -0700
Update AUTHORS
+Luse core emeritus
Change-Id: Ie175f410ddc24a2d5e64bc191364418a3c450f3f
commit 2f8105e5fcf4ecee2202797ba1ab48fa8fb1a1f6
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 20 18:14:16 2016 +0000
Fix bug in mem\_diskfile write\_metadata method
The mem\_diskfile DiskFile.write\_metadata method was
apparently never called in any existing test, as if it
were it would blow up as reported in the bug.
This patch fixes the method and adds a test that
exercises it. The test addition itself should be useful
since it verifies the behaviour of Last-Modified after
POSTs to an object.
Drive-by fixes for bad docstring and undefined references
in the \_quarantine method.
Change-Id: I17fd62e5f02be5b48bfd9ba7fa25315e30a0a4bf
Closes-Bug: #1536037
commit e13a03c379273ee10e678818078b9c40a96a7dc9
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Jan 20 16:06:26 2016 -0800
Stop overriding builtin range
Change-Id: I315f8b554bb9e96659b455f4158f074961bd6498
commit 0a404def7d54d1ef1c85c11a378052260c4fda4c
Author: John Dickinson <me@not.mn>
Date: Wed Jan 20 15:19:35 2016 -0800
remove unneeded duplicate dict keys
Change-Id: I926d7aaa9df093418aaae54fe26e8f7bc8210645
commit 221f94fdd39fd2dcd9a2e5565adceab615d55913
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 14:50:24 2016 -0800
authors and changelog updates for 2.6.0
Change-Id: Idd0ff9e70abc0773be183c37cd6125fe852da7c0
commit 58359269b0e971e52f0eb7f97221566ca2148014
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612
commit d9b22ac51cca579e97ec7bd5a6df3ad7bf56c3bf
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:45:33 2015 +0200
Port parse\_mime\_headers() to Python 3
Port swift.common.utils.parse\_mime\_headers() to Python 3:
\* On Python 3, tries to decode headers from UTF-8. If an header was
was not encoded to UTF-8, decode the header from Latin1.
\* Update the parse\_mime\_headers() tests: on Python 3, HTTP header
values are Unicode strings.
This change is a follow-up of the change
Ia5ee2ead67e36e8c6416183667f64ae255887736.
Change-Id: I042dd13e9eb0e9844ccd832d538cdac84359ed42
commit cec2aa0b4dbf0e1bf2de62945f5abdf494925a8e
Author: Victor Stinner <vstinner@redhat.com>
Date: Fri Oct 9 17:56:39 2015 +0200
py3: Use the six module in the xprofile middleware
\* Replace bytes\_() with a isinstance(content, six.text\_type)
and content.encode('utf-8')
\* Get parse\_qs() from six.moves.urllib.parse
Change-Id: I4a506975814bff098ade25c950c154e50dc9626e
commit bc4b298b6e208d3188641712c9d66ae82d172c14
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 19 15:33:13 2016 -0800
Fix a comment's indentation
Change-Id: I34514525b606cf82767ddce7769bc42fa5457717
commit 6c32da14f48b435aa4e5efea48904bd288a532a2
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:38:24 2015 +0200
Port FileLikeIter to Python 3
Port FileLikeIter and \_MultipartMimeFileLikeObject and
swift.common.utils to Python 3:
\* Add a \_\_next\_\_() alias to the next() method. On Python 3, the
next() method is no more used, \_\_next\_\_() is required.
\* Use literal byte strings: FileLikeIter \_MultipartMimeFileLikeObject
are written to handle binary files.
\* test\_close(): replace .FileLikeIter('abcdef') with
FileLikeIter([b'a', b'b', b'c']). On Python 3, list(b'abc') returns
[97, 98, 99], whereas ['a', 'b', 'c'] is returned on Python 2.
\* Update unit FileLikeIter tests to use byte strings.
Change-Id: Ibacddb70b22f624ecd83e374749578feddf8bca8
commit caa127d59a63a25cc6d08e985e536f90300a6156
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Nov 12 11:34:44 2015 -0800
Monkeypatch everything the same
There's three spots in the code where eventlet monkeypatches
things. In one place, it was monkeypatching socket and thread; in the
other two, only socket. This commit monkeypatches socket and thread
everywhere.
Hopefully, this lets us avoid code that, for example, works in the
object server but fails in the object updater.
Change-Id: Ia30d069c5ac89f4bfbe52233d03d96738144b614
commit 3a0486e532f22af0d3c8a5c5d78613c22e786ff6
Author: Sivasathurappan Radhakrishnan <siva.radhakrishnan@intel.com>
Date: Fri Dec 4 17:43:00 2015 +0000
Deleted comment about part power in FakeRing
Deleted comment about parameter part power in Class FakeRing as its
behavior got dropped in I8bfc388a04eff6491038991cdfd7686c9d961545.
Change-Id: Iec7d2565a77e48493b0056021066d8d8eab65d0b
Closes-Bug: #1488704
commit 999479f9b17b42ccc5da54ce01651960cf7cf970
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 10:30:30 2016 -0800
Bump eventlet min version to 0.17.4
IPv6 support in Swift is dependent on IPv6 support in eventlet.
eventlet itself only claims support for IPv6 post v0.17
(https://github.com/eventlet/eventlet/issues/8). This update matches
the OpenStack global requirements version.
Change-Id: I9d8433cdd3bf7d7a93b8f50b991cc21721a80d22
commit 133a3ea601a3fea84af36a42845f27b8182fd901
Author: Christopher Bartz <bartz@dkrz.de>
Date: Mon Dec 21 14:17:00 2015 +0100
Use the correct split\_path in handle\_request
Change-Id: I86d423309f0b2091ee2e82b2245caf925b6a75ef
Closes-Bug: #1528189
commit 09b188f03c4a40838ea6b3e54e0714d93077b066
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Thu Jul 16 09:35:37 2015 +0900
Add functional test for access control (RBAC) with Keystone
This patch adds test cases for PUT, DELETE, GET, HEAD, POST and OPTIONS
requests to accounts, containers and objects using various combinations
of users/projects, roles and/or service tokens.
Change-Id: Iea8141ac74ad949a3ae7fa47fda3135d0f2612f6
commit bf10974cdefffdaaebc58d21e8a9912638a0405a
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Dec 16 15:46:13 2015 -0800
Expose token expiration time in tempauth auth response
Previously, we gave no indication of when a token would expire. Users
would have to just use it until it stopped working, then re-auth.
Now, a successful auth response will include a new header,
X-Auth-Token-Expires, with the number of seconds remaining until the
token is invalid. This allows the client to attempt to re-auth before
sending a request that will definitely fail.
For comparison, swauth already uses the X-Auth-Token-Expires header with
identical semantics. Additionally, Keystone (v2 and v3) already exposes
expiration times in its JSON responses. The security impact should be
minimal.
Change-Id: I5a4a74276bc0df6dda94e4bc150065c0d77de0eb
commit f56f29ef7a692b6c3204e25d41eace3d68dceece
Author: Peter Lisák <peter.lisak@firma.seznam.cz>
Date: Thu Dec 3 16:48:18 2015 +0100
Add info about state of ring file to default command.
Try to find ring file, load and compare it with builder file, then show result state.
Examples:
Ring file object.ring.gz not found, probably it hasn't been written yet
Ring file object.ring.gz is up-to-date
Ring file object.ring.gz is obsolete
Ring file object.ring.gz is invalid: ValueError('string length not a multiple of item size',)
Change-Id: I4d769aa5fe1c2b1167ec088aa372874f7d13ae48
commit 47e226418bad35ccad2a1525f392ba69f6165027
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Mon Jan 18 06:20:14 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Ic416c9afc8a1c76f552803a7c70fc905eda7b3cb
commit 165fa1fd40b5e4b13cf5188712593e2275bef821
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jan 15 11:44:21 2016 -0800
add test for zero weight region get\_more\_nodes
Change-Id: If537981e8deadd9c3528dcb30a15011c7781e334
commit 5d449471b12c67b31ebb5a383d9bb35bace36213
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jan 14 17:26:01 2016 -0800
Remove some Python 2.6 leftovers
Change-Id: I798d08722c90327c66759aa0bb4526851ba38d41
commit 3c0cf549f1e822cce8f905b069b317e676cf306b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jan 13 18:08:45 2016 -0800
Speed up get\_more\_nodes() when there is an empty zone
The ring has some optimizations in get\_more\_nodes() so that it can
find handoffs that span all the regions/zones/et cetera and then stop
looking. The stopping is the important part.
Previously, it would quickly find a handoff in each unused region,
then spend way too long looking for more unused regions; the same was
true for zones, IPs, and so on. Thus, in commit 9cd7c6c, we started
counting regions and zones, then stopping when we found them all.
This count included all regions and zones in the ring, regardless of
whether or not there were actually any parts assigned or not. In rings
with an empty region, i.e. a region for which there are only
zero-weight devices, get\_more\_nodes() would be very slow.
This commit ignores devices with no assigned partitions when counting
regions, zones, and so forth, thus greatly speeding things up.
The output of get\_more\_nodes() is unchanged. This is purely an
optimization.
Closes-Bug: 1534303
Change-Id: I4a5c57205e87e1205d40fd5d9458d4114e524332
commit 70047709fc9885df7019f791e17a3240682cc6cb
Author: keliang <ke.liang@easystack.cn>
Date: Fri Jan 15 00:31:51 2016 +0800
Drop python 2.6 support
Change-Id: Id6329c863dacb189fccfc304453ed7b6f9607c14
commit a4c2fe95ab2fbe59379a69914ed0fac49c28efbb
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Jan 12 21:26:33 2016 +0100
Allow to change auditor sleep interval in config
Change-Id: Ic451c5e0b686509f8982ed1bf65a223a2d77b9a0
commit edc823e8030640184071fee4920d34f9a1cc6b3e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Nov 29 18:46:47 2015 +0100
Show UTC time in swift-recon.
It's not consistent now for example local time in replication part and
UTC time at begging of line. Use \_ptime in swift-recon for all time
printing and this function returns UTC now.
Change-Id: I732d9851db157130a08e825e8093b7e244b63e9c
commit fa5b32d27964478dfcccf71155d2aaa946c561f0
Author: Tim Burke <tim.burke@gmail.com>
Date: Tue Jan 12 14:18:30 2016 -0800
Make object-auditor storage-policy-aware
Previously, the object-auditor would always use a (replication)
DiskFileManager when walking through AuditLocations, which would cause
it to skip EC fragment archives with a warning like:
Unexpected file <hash\_path>/1452557187.03610#3.data:
Invalid Timestamp value in filename '1452557187.03610#3.data'
Now, the AuditLocation's policy will be used to find an appropriate
manager to get the diskfile. Additionally, several .commit()s were added
to the auditor tests so the .durable will be written, which is required
when auditing EC fragment archives.
Change-Id: I960e7d696fd9ad704ca1872b4ac821f9078838c7
Closes-Bug: 1533002
commit 725a166ebd3fde2c34f2c9578ff6f9911cf206d7
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Fri Jan 8 18:42:33 2016 -0800
Make \_get\_addr() method a function in utils.
The patch moves the MemcacheConnPool.\_get\_addr() method a function in
swift.common.utils. The function is renamed to parse\_socket\_string()
and the documentation is updated accordingly. The test for it has also
been moved.
Change-Id: Ida65b2fded28d0a059e668646f5b89714298f348
commit 0647aea9c5fc95f0860758cc54bc23f965da460d
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Fri Jan 8 14:54:56 2016 -0800
Fail early if the memcache address is invalid.
In cases when the memcache address is invalid, we should fail early.
This patch addresses the cases when the IPv6 addresses are not
enclosed in "[]". It does not, however, fix the case of an invalid
hostname. These improvements could also be added to the \_get\_addr()
method.
Change-Id: I4743dcda45a1fc1640989325c4a2e1fea591fc69
commit 33476460239c9cdb08dd8065d22d84a4717da7be
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jan 8 16:15:54 2016 -0800
fixups for ipv6 memcache\_servers docs
Change-Id: I20d91c1e276014eaf210fa9eb43788bc17f4e8df
commit d5ff5447be30b44bf4acc8b912b6241a44f710be
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 12 16:42:06 2016 -0800
Install liberasurecode packages in SAIO.
Change-Id: If673afa2b61a3e388612debf4860d561960963a3
commit 4ffc4ba411f67c8407ba38d082a3a51a96ad7e04
Author: Jonathan Hinson <jlhinson@us.ibm.com>
Date: Tue Jan 12 11:46:21 2016 -0600
Functional tests for if-match with multiple etags
Multiple etags can be provided on an if-match or if-none-match
request. This is currently being tested in the unit tests, but not
in the functional tests. Since these etags can be modified by
middleware, we need functional tests to assert multiple-etag
requests are handled correctly.
Change-Id: Idc409c85e8aa82b59dc2bc28af6ca2617de82699
commit 1292361176aec385137dd5873c5cc9714de1fa17
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Jan 11 16:25:50 2016 -0800
functest for x-timestamp validation
Change-Id: I05af7d837af00cd1059a8912df05c131a52ffb90
commit e6194113a3c81563590eabf8f761ccb988bb917c
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri Jan 8 16:38:31 2016 -0800
Validate X-Timestamps
Previously, attempting to PUT a new object with an X-Timestamp header
less than or equal to zero (ie, for a timestamp on or before 1970-01-01
00:00:00) would cause the object-server to 500.
While we're at it, cap X-Timestamp at 9999999999 (2286-11-20 17:46:40)
so we don't get an eleventh digit before the decimal point.
Closes-Bug: 1532471
Change-Id: I23666ec8a067d829eaf9bfe54bd086c320b3429e
commit 1f3304c5153e01988b8f4493875b6489e93f76d0
Author: Ben Martin <blmartin@us.ibm.com>
Date: Mon Dec 14 15:28:17 2015 -0600
Print min\_part\_hours lockout time remaining
swift-ring-builder currently only displays min\_part\_hours and
not the amount of time remaining before a rebalance can occur.
This information is readily available and has been displayed
as a quality of life improvement.
Additionally, a bug where the time since the last rebalance
was always updated when rebalance was called regardless of
if any partitions were reassigned. This can lead to partitions
being unable to be reassigned as they never age according to
the time since last rebalance.
Change-Id: Ie0e2b5e25140cbac7465f31a26a4998beb3892e9
Closes-Bug: #1526017
commit 167bb5eeb82886d67c1b382417fb22b8ea85f0d3
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Wed Dec 16 12:07:27 2015 -0800
Fix IPv6 handling in MemcacheConnPool.
The patch removes the assumption of IPv4-only addresses in the
MemcacheConnPool. The changes are around address handling.
Namely, if a server is specified with an address
[<address>]:port (port is optional), it is assumed to be an IPv6
address [1]. If an IPv6 address is specified without "[]", an exception
is raised as it is impossible to parse such addresses correctly.
For testing, memcache can be configured to listen on the link-local,
unique-local, or ::1 (equivalent to 127.0.0.1) addresses. Link-local
addresses are assigned by default to each interface and are of the form
"fe80::dead:beef". These addresses require a scope ID, which would look
like "fe80::dead:beef%eth0" (replacing eth0 with the correct interface).
Unique-local addresses are any addresses in the fc00::/7 subnet. To add
a ULA to an interface use the "ip" utility. For example:
"ip -6 address add fc01::dead:beef dev eth0". Lastly, and probably
simplest, memcache can be configured to listen on "::1". The same
address would be used in the swift configuration, e.g. "[::1]:11211".
Note: only memcached version 1.4.25 or greater supports binding to an
IPv6 address.
Fixes #1526570
[1] IPv6 host literals:
https://tools.ietf.org/html/rfc3986#section-3.2.2
Change-Id: I8408143c1d47d24e70df56a08167c529825276a2
commit fb6751d8ba133c57e1ebb76be71a96f2f120b8ca
Author: Paul Dardeau <paul.dardeau@intel.com>
Date: Fri Jan 8 22:49:05 2016 +0000
Look for device holes that can be reused when adding new device.
Change-Id: I1980ebdd9dc89848173d8ca2fe2afb74029dcfa2
Closes-Bug: 1532276
commit b35f3c90bde8a7ccb50440bda5800cbb8274a5a1
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Jan 8 01:29:11 2016 -0800
Add note COPY with conditional headers
Swift now supports Range header for COPY (or PUT with X-Copy-From)
to make a partial copied object. This patch adds the note to show
it obviously supported in Swift community.
Change-Id: I6bf28f0932c90e7b305cd61aabce4ed028ae691e
Partial-Bug: #1532126
commit 23c7a58f8f1412c28b3a16b79be09c224c9f7d55
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Dec 11 18:26:34 2015 +0900
Fix ClientException handling in Container Sync
swift/container/sync.py uses swift.common.internal\_client.delete\_object
and put\_object and expected these methods raise ClientException.
But delete\_object and put\_object never raise the exception so this patch
raises ClientException when urllib2 library raises HTTPError.
Co-Authored-By: Eran Rom <eranr@il.ibm.com>
Closes-Bug: #1419901
Change-Id: I58cbf77988979a07998a46d9d81be84d29b0d9bf
commit 6786cdf036b4faabe3928c3d0dd9615d94834801
Author: Harshada Mangesh Kakad <harshadak@metsi.co.uk>
Date: Thu Dec 31 01:44:00 2015 -0800
Fixing the deprecated library function.
os.popen() is deprecated since version 2.6. Resolved with use of
subprocess module.
Change-Id: I4409cdd9edbc1a26d6f99c125c9100fadda5d758
Partial-Bug: #1529836
commit 85a0a6a28e166bc076cf8786de2b46248d8786a2
Author: Eran Rom <eranr@il.ibm.com>
Date: Sun Jul 26 13:31:17 2015 +0300
Container-Sync to iterate only over synced containers
This change introduces a sync\_store which holds only containers that
are enabled for sync. The store is implemented using a directory
structure that resembles that of the containers directory, but has
entries only for containers enabled for sync.
The store is maintained in two ways:
1. Preemptively by the container server when processing
PUT/POST/DELETE operations targeted at containers with
x-container-sync-key / x-container-sync-to
2. In the background using the containers replicator
whenever it processes a container set up for sync
The change updates [1]
[1] http://docs.openstack.org/developer/swift/overview\_container\_sync.html
Change-Id: I9ae4d4c7ff6336611df4122b7c753cc4fa46c0ff
Closes-Bug: #1476623
commit e75888b281d59df0889f28d0b32241dac3a34aa2
Author: HugoKuo <tonytkdk@gmail.com>
Date: Wed Jan 6 14:33:23 2016 +0800
Add more description for write\_affinity\_node\_count parameter in the doc.
Change-Id: Iad410a2be4f9a2cd5c53e860b9f91993aa7f2369
Closes-Bug: #1531173
commit 3b1591f235f4b85796917507be5e7fd80365ff9e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Wed Sep 30 19:08:09 2015 +0200
swift-init: New option kill-after-timeout
This option send SIGKILL to daemon after kill\_wait period.
When daemon hangs and doesn't respond to SIGTERM/SIGHUP
there is no way to stop it using swift-init now. Classic
init scripts in Linux kills hanged process after grace
period and this patch add same behaviour. This is most
usefull when using "restart" on hanged daemon.
Change-Id: I8c932b673a0f51e52132df87ea2f4396f4bba9d8
commit 4691d0592ff3deeea2713195312bf1effd5a7a7b
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Dec 25 14:00:16 2015 +0900
Add object replicator's succeeded and failed counts in log
account-replicator and container-replicator outputted the
following info in log.
info account-replicator: 17 successes, 4 failures
info container-replicator: 178 successes, 29 failures
But there is no output info for object-replicator. This info
is important to check replicator's status from log.
So this patch adds object-replicator's succeeded and failed
counts in log like account-replicator and container-replicator.
Change-Id: I7fbaf161540bdb06c0a65a1032aae83764bd970c
commit 9fe0e25604dff35db7eab1bca312821a81db6c1d
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Dec 8 22:27:44 2015 -0800
Sleep enough for trampoline
When running unite test suite in local poor resource environment,
sometimes test/unit/proxy/test\_server.py fails due to a lack of
waiting time to trampoline of eventlet thread.
This patch enables to sleep 1 more second when it doesn't seem
to have enough time to tranpoline.
Change-Id: I0bbc8fc245919d3c0a071ff87ff6e20b8d58f9b8
commit 7f636a557296ecc6ae4727700cfcf9f82573bd16
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Nov 30 18:06:09 2015 -0800
Allow smaller segments in static large objects
The addition of range support for SLO segments (commit 25d5e68)
required the range size to be at least the SLO minimum segment size
(default 1 MiB). However, if you're doing something like assembling a
video of short clips out of a larger one, then you might not need a
full 1 MiB.
The reason for the 1 MiB restriction was to protect Swift from
resource overconsumption. It takes CPU, RAM, and internal bandwidth to
connect to an object server, so it's much cheaper to serve a 10 GiB
SLO if it has 10 MiB segments than if it has 10 B segments.
Instead of a strict limit, now we apply ratelimiting to small
segments. The threshold for "small" is configurable and defaults to 1
MiB. SLO segments may now be as small as 1 byte.
If a client makes SLOs as before, it'll still be able to download the
objects as fast as Swift can serve them. However, a SLO with a lot of
small ranges or segments will be slowed down to avoid resource
overconsumption. This is similar to how DLOs work, except that DLOs
ratelimit \*every\* segment, not just small ones.
UpgradeImpact
For operators: if your cluster has enabled ratelimiting for SLO, you
will want to set rate\_limit\_under\_size to a large number prior to
upgrade. This will preserve your existing behavior of ratelimiting all
SLO segments. 5368709123 is a good value, as that's 1 greater than the
default max object size. Alternately, hold down the 9 key until you
get bored.
If your cluster has not enabled ratelimiting for SLO (the default), no
action is needed.
Change-Id: Id1ff7742308ed816038a5c44ec548afa26612b95

| **tags**: | added: in-feature-hummingbird |
| --- | --- |

[Pratap D (pratapd)](https://launchpad.net/~pratapd)
on 2016-06-03

| Changed in swift (Ubuntu): | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pratap D (pratapd)](https://launchpad.net/~pratapd) wrote on 2016-06-03: |  |  | [#69](/cloud-archive/%2Bbug/1493303/comments/69) |
| --- | --- | --- | --- |

Changed in swift (Ubuntu):

By mistake I changed the status to "Fix released".

Status needs to be changed to "Confirmed".

Please change the status to "Confirmed".

Sorry for the trouble.

Changed in swift (Ubuntu):
By mistake I changed the status to "Fix released".
Status needs to be changed to "Confirmed".
Please change the status to "Confirmed".
Sorry for the trouble.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-06-03: |  |  | [#70](/cloud-archive/%2Bbug/1493303/comments/70) |
| --- | --- | --- | --- |

@james-page, it seems like you are the one who can change the "swift (ubuntu)" task status. Please put it back to "confirmed"...

@james-page, it seems like you are the one who can change the "swift (ubuntu)" task status. Please put it back to "confirmed"...

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-06-03

| Changed in swift (Ubuntu): | |
| --- | --- |
| **status**: | Fix Released → Confirmed |

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-06-10

| Changed in swift (Ubuntu Yakkety): | |
| --- | --- |
| **status**: | Confirmed → Fix Released |
| Changed in swift (Ubuntu Xenial): | |
| **status**: | New → Fix Released |
| Changed in swift (Ubuntu Wily): | |
| **status**: | New → Triaged |
| Changed in swift (Ubuntu Vivid): | |
| **status**: | New → Won't Fix |
| Changed in swift (Ubuntu Trusty): | |
| **status**: | New → Triaged |

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-06-10

| **no longer affects**: | swift (Ubuntu Vivid) |
| --- | --- |

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-09-08

| Changed in cloud-archive: | |
| --- | --- |
| **status**: | New → Invalid |
| Changed in swift (Ubuntu Wily): | |
| **status**: | Triaged → Won't Fix |
| Changed in swift (Ubuntu Trusty): | |
| **status**: | Triaged → Won't Fix |
| **status**: | Won't Fix → New |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Eduardo Barretto (ebarretto)](https://launchpad.net/~ebarretto) wrote on 2020-07-06: |  |  | [#71](/cloud-archive/%2Bbug/1493303/comments/71) |
| --- | --- | --- | --- |

This bug was fixed in the package swift - 1.13.1-0ubuntu1.5

---------------

swift (1.13.1-0ubuntu1.5) trusty-security; urgency=medium

[ Jamie Strandboge ]

  \* SECURITY UPDATE: disallow unsafe tempurl operations to point to

    unauthorized data

    - debian/patches/CVE-2015-5223.patch: disallow creation of DLO object

      manifests if non-safe tempurl request includes X-Object-Manifest header

    - CVE-2015-5223

    - LP: [#1453948](/bugs/1453948)

[ Marc Deslauriers ]

  \* SECURITY UPDATE: DoS via incorrectly closed client connections

    - debian/patches/CVE-2016-0737.patch: get better at closing WSGI

      iterables in swift/common/middleware/dlo.py,

      swift/common/middleware/slo.py, swift/common/request\_helpers.py,

      swift/common/swob.py, swift/common/utils.py,

      test/unit/common/middleware/helpers.py,

      test/unit/common/middleware/test\_dlo.py,

      test/unit/common/middleware/test\_slo.py.

    - CVE-2016-0737

  \* SECURITY UPDATE: DoS via incorrectly closed server connections

    - debian/patches/CVE-2016-0738.patch: fix memory/socket leak in proxy

      on truncated SLO/DLO GET in swift/common/request\_helpers.py,

      test/unit/common/middleware/test\_slo.py.

    - CVE-2016-0738

  \* Thanks to Red Hat for the patch backports!

  \* debian/patches/fix-ubuntu-tests.patch: disable another test that no

    longer works on buildds.

-- Marc Deslauriers <email address hidden> Tue, 12 Sep 2017 07:36:43 -0400

This bug was fixed in the package swift - 1.13.1-0ubuntu1.5
---------------
swift (1.13.1-0ubuntu1.5) trusty-security; urgency=medium
[ Jamie Strandboge ]
\* SECURITY UPDATE: disallow unsafe tempurl operations to point to
unauthorized data
- debian/patches/CVE-2015-5223.patch: disallow creation of DLO object
manifests if non-safe tempurl request includes X-Object-Manifest header
- CVE-2015-5223
- LP: #1453948
[ Marc Deslauriers ]
\* SECURITY UPDATE: DoS via incorrectly closed client connections
- debian/patches/CVE-2016-0737.patch: get better at closing WSGI
iterables in swift/common/middleware/dlo.py,
swift/common/middleware/slo.py, swift/common/request\_helpers.py,
swift/common/swob.py, swift/common/utils.py,
test/unit/common/middleware/helpers.py,
test/unit/common/middleware/test\_dlo.py,
test/unit/common/middleware/test\_slo.py.
- CVE-2016-0737
\* SECURITY UPDATE: DoS via incorrectly closed server connections
- debian/patches/CVE-2016-0738.patch: fix memory/socket leak in proxy
on truncated SLO/DLO GET in swift/common/request\_helpers.py,
test/unit/common/middleware/test\_slo.py.
- CVE-2016-0738
\* Thanks to Red Hat for the patch backports!
\* debian/patches/fix-ubuntu-tests.patch: disable another test that no
longer works on buildds.
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Tue, 12 Sep 2017 07:36:43 -0400

| Changed in swift (Ubuntu Trusty): | |
| --- | --- |
| **status**: | New → Fix Released |

[See full activity log](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/cloud-archive/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/cloud-archive/%2Bbug/1493303/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [leakpatch-1.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4529331/%2Bfiles/leakpatch-1.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4529331 "Change patch details")
* [security\_leak\_fix.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4530760/%2Bfiles/security_leak_fix.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4530760 "Change patch details")
* [socket-leak-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4532159/%2Bfiles/socket-leak-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4532159 "Change patch details")
* [socket-leak-3.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4545988/%2Bfiles/socket-leak-3.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4545988 "Change patch details")
* [socket-leak-4.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4546358/%2Bfiles/socket-leak-4.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4546358 "Change patch details")
* [socket-leak-kilo-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548894/%2Bfiles/socket-leak-kilo-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548894 "Change patch details")
* [socket-leak-liberty-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548896/%2Bfiles/socket-leak-liberty-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548896 "Change patch details")
* [socket-leak-kilo-backport-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4549968/%2Bfiles/socket-leak-kilo-backport-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4549968 "Change patch details")

* [Add patch](/cloud-archive/%2Bbug/1493303/%2Baddcomment?field.patch=on)

## Bug attachments

* [Dependencies.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459119/%2Bfiles/Dependencies.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459119 "Change attachment details")
* [ProcEnviron.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459120/%2Bfiles/ProcEnviron.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459120 "Change attachment details")
* [leakreproducer.sh](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4520199/%2Bfiles/leakreproducer.sh)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4520199 "Change attachment details")

* [Add attachment](/cloud-archive/%2Bbug/1493303/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from rhn.redhat.com_c2b1586d_20250125_144121.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2016:0155 - Security Advisory

Issued:
2016-02-09
Updated:
2016-02-09
# RHSA-2016:0155 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: openstack-swift security update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2016%3A0155)

## Topic

Updated openstack-swift packages that fix two security issues are now
available for Red Hat Enterprise Linux OpenStack Platform 7.0.

Red Hat Product Security has rated this update as having Moderate
security impact. A Common Vulnerability Scoring System (CVSS) base
score, which gives a detailed severity rating, is available from the
CVE link in the References section.

## Description

OpenStack Object Storage (swift) provides object storage in virtual
containers, which allows users to store and retrieve files (arbitrary
data). The service's distributed architecture supports horizontal scaling;
redundancy as failure-proofing is provided through software-based data
replication. Because Object Storage supports asynchronous eventual
consistency replication, it is well suited to multiple data-center
deployment.

A memory-leak issue was found in OpenStack Object Storage (swift), in the
proxy-to-server connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0738)

A memory-leak issue was found in OpenStack Object Storage (swift), in the
client-to-proxy connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0737)

Red Hat would like to thank the OpenStack project for reporting these
issues. Upstream acknowledges Romain Le Disez from OVH and Örjan Persson
from Kiliaro as the original reporters.

All users of openstack-swift are advised to upgrade to these updated
packages, which correct these issues. After installing this update, the
OpenStack Object Storage services will be restarted automatically.

## Solution

Before applying this update, ensure all previously released errata
relevant to your system have been applied.

For details on how to apply this update, refer to:

<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat OpenStack 7 x86\_64

## Fixes

* [BZ - 1298905](https://bugzilla.redhat.com/show_bug.cgi?id=1298905)
  - CVE-2016-0738 openstack-swift: Proxy to server DoS through Large Objects
* [BZ - 1298924](https://bugzilla.redhat.com/show_bug.cgi?id=1298924)
  - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects

## CVEs

* [CVE-2016-0737](https://www.redhat.com/security/data/cve/CVE-2016-0737.html)
* [CVE-2016-0738](https://www.redhat.com/security/data/cve/CVE-2016-0738.html)

## References

* <http://www.redhat.com/security/updates/classification/#normal>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat OpenStack 7

| SRPM | |
| --- | --- |
| openstack-swift-2.3.0-3.el7ost.src.rpm | SHA-256: cf145d99d1e6281c1d1b1c44bcfe47c2c4df14e9c4c5270b572efaec1dcabd68 |
| x86\_64 | |
| openstack-swift-2.3.0-3.el7ost.noarch.rpm | SHA-256: 91a0ffa995c5ce73b19c97342bcc0d1e285c05caae74cca796e83a211110044e |
| openstack-swift-account-2.3.0-3.el7ost.noarch.rpm | SHA-256: db7e0e6cfc45206006425b9fbc810bc3ec465da269b78bea3815168885a5b1f9 |
| openstack-swift-container-2.3.0-3.el7ost.noarch.rpm | SHA-256: 92d863aa237f9e765cc796d77f364ad71bc6dd2b4016e8ebe0ce6aed56019659 |
| openstack-swift-doc-2.3.0-3.el7ost.noarch.rpm | SHA-256: f9ab915bdbeeec1f30984ad109c4d47af6ff3e1ae55facb9f1b4a7be8d864410 |
| openstack-swift-object-2.3.0-3.el7ost.noarch.rpm | SHA-256: da4c6000edcd0837dbbacba9d20811b36ffbfc4255484ad6c84e5512d4b6b2db |
| openstack-swift-proxy-2.3.0-3.el7ost.noarch.rpm | SHA-256: e294a98787d174535b64df77efd47a6973218d7eebd6de325ebae0f693426bc8 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from launchpad.net_64551481_20250126_093646.html ===

[Log in / Register](https://launchpad.net/~alistair-coles/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~alistair-coles)

## [Alistair Coles](https://launchpad.net/~alistair-coles)

* Overview
* [Code](https://code.launchpad.net/~alistair-coles)
* [Bugs](https://bugs.launchpad.net/~alistair-coles)
* [Blueprints](https://blueprints.launchpad.net/~alistair-coles)
* [Translations](https://translations.launchpad.net/~alistair-coles)
* [Answers](https://answers.launchpad.net/~alistair-coles)

* [Related packages](https://launchpad.net/~alistair-coles/%2Brelated-packages)
* [Related projects](https://launchpad.net/~alistair-coles/%2Brelated-projects)

## User information

Launchpad Id:
alistair-coles

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-04-23

[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)
[![Icon of Swift](https://launchpadlibrarian.net/52560230/os14.png "Member of Swift")](/~swift)

Languages:

English

Time zone:

UTC
(UTC+0000)

Karma:
[32](https://launchpad.net/~alistair-coles/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**acoles**
 on
**freenode**

## [All bugs in progress](https://launchpad.net/~alistair-coles/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1719887 [deployment guide includes vendor names](https://bugs.launchpad.net/swift/%2Bbug/1719887) |  |
| --- | --- | --- |
| in [OpenStack Object Storage (swift)](/swift) | | |

| --- | --- | --- | --- | --- | --- |
||  | #1734740 [Deployment Guide in swift - bad link](https://bugs.launchpad.net/swift/%2Bbug/1734740) |  |
| --- | --- | --- |
| in [OpenStack Object Storage (swift)](/swift) | | |

||  | #1455102 [some test jobs broken by tox 2.0 not passing env variables](https://bugs.launchpad.net/python-swiftclient/%2Bbug/1455102) |  |
| --- | --- | --- |
| in [python-swiftclient](/python-swiftclient), [Magnum](/magnum), [neutron](/neutron), [OpenStack-Gate](/openstack-gate), [python-cinderclient](/python-cinderclient), [Glance Client](/python-glanceclient), [python-manilaclient](/python-manilaclient), [python-neutronclient](/python-neutronclient), [OpenStack Object Storage (swift)](/swift) | | |

## [All memberships](https://launchpad.net/~alistair-coles/%2Bparticipation) Latest memberships

| [Swift Core security contacts](/~swift-coresec)  Joined on 2014-03-31 | |
| --- | --- |

## [Recent activities](https://launchpad.net/~alistair-coles/%2Bkarma) Most active in

| [OpenStack Object Storage (swift)](/swift) |  |  |  |  |
| --- | --- | --- | --- | --- |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from rhn.redhat.com_f571163a_20250125_144122.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2016:0329 - Security Advisory

Issued:
2016-03-01
Updated:
2016-03-01
# RHSA-2016:0329 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: openstack-swift security update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2016%3A0329)

## Topic

Updated openstack-swift packages that fix two security issues are now
available for Red Hat Gluster Storage 3.1 update 2 in Red Hat Enterprise
Linux 6.

Red Hat Product Security has rated this update as having Moderate security
impact. Common Vulnerability Scoring System (CVSS) base scores, which give
detailed severity ratings, are available for each vulnerability from the
CVE links in the References section.

## Description

OpenStack Object Storage (swift) provides object storage in virtual
containers, which allows users to store and retrieve files (arbitrary
data). The service's distributed architecture supports horizontal scaling;
redundancy as failure-proofing is provided through software-based data
replication. Because Object Storage supports asynchronous eventual
consistency replication, it is well suited to multiple data-center
deployment.

A memory-leak issue was found in OpenStack Object Storage (swift), in the
proxy-to-server connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0738)

A memory-leak issue was found in OpenStack Object Storage (swift), in the
client-to-proxy connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0737)

Red Hat would like to thank the OpenStack project for reporting these
issues. Upstream acknowledges Romain Le Disez from OVH and Örjan Persson
from Kiliaro as the original reporters.

All users of openstack-swift are advised to upgrade to these updated
packages, which correct these issues. After installing this update, the
OpenStack Object Storage services will be restarted automatically.

## Solution

Before applying this update, make sure all previously released errata
relevant to your system have been applied.

For details on how to apply this update, refer to:

<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat Gluster Storage Server for On-premise 3 for RHEL 6 x86\_64

## Fixes

* [BZ - 1298905](https://bugzilla.redhat.com/show_bug.cgi?id=1298905)
  - CVE-2016-0738 openstack-swift: Proxy to server DoS through Large Objects
* [BZ - 1298924](https://bugzilla.redhat.com/show_bug.cgi?id=1298924)
  - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects

## CVEs

* [CVE-2015-5223](https://www.redhat.com/security/data/cve/CVE-2015-5223.html)
* [CVE-2016-0737](https://www.redhat.com/security/data/cve/CVE-2016-0737.html)
* [CVE-2016-0738](https://www.redhat.com/security/data/cve/CVE-2016-0738.html)

## References

* <http://www.redhat.com/security/updates/classification/#normal>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat Gluster Storage Server for On-premise 3 for RHEL 6

| SRPM | |
| --- | --- |
| openstack-swift-1.13.1-8.el6ost.src.rpm | SHA-256: 18d3130ee4e4fda4bf4067c57d83c0f513e37de83bd298428b14ec26984ac9b9 |
| x86\_64 | |
| openstack-swift-1.13.1-8.el6ost.noarch.rpm | SHA-256: 1bec3aff2d0122a9c9088ef68164e93113d891b44a4110799708bf2d91d44392 |
| openstack-swift-account-1.13.1-8.el6ost.noarch.rpm | SHA-256: f1e5a8f9540e836d0b6f60b7ff0a0dac5278e77466bb5742b1dd5991bde45ea3 |
| openstack-swift-container-1.13.1-8.el6ost.noarch.rpm | SHA-256: a47257654d58de7501a7b61bbfb70d7c28ba0470abc3ac1304d43c879ba1b87c |
| openstack-swift-doc-1.13.1-8.el6ost.noarch.rpm | SHA-256: 2632773d6341f6a21e31687084f2ca85f29e6f0ae447ffa386df856735216682 |
| openstack-swift-object-1.13.1-8.el6ost.noarch.rpm | SHA-256: ecd7963389ef04e4a037bd362f25c5f63c4581d8e7f8044ea9a3c60412a517e4 |
| openstack-swift-proxy-1.13.1-8.el6ost.noarch.rpm | SHA-256: 69631a5077373b493fd9e0e00b43dd609aa5dd951eb0079850e8b9ed3b5a7091 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.redhat.com_631761e0_20250126_093628.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugs.launchpad.net_9dd599a1_20250125_144126.html ===

[Log in / Register](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/cloud-archive)

## [Ubuntu Cloud Archive](https://launchpad.net/cloud-archive)

* [Overview](https://launchpad.net/cloud-archive)
* [Code](https://code.launchpad.net/cloud-archive)
* [Bugs](https://bugs.launchpad.net/cloud-archive)
* [Blueprints](https://blueprints.launchpad.net/cloud-archive)
* [Translations](https://translations.launchpad.net/cloud-archive)
* [Answers](https://answers.launchpad.net/cloud-archive)

# [OSSA 2016-004] Swift proxy memory leak on unfinished read (CVE-2016-0738)

Bug #1493303 reported by
[Örjan Fors](https://launchpad.net/~orrriot)
on 2015-09-08

[288](/%2Bhelp-bugs/bug-heat.html)

This bug affects 4 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Object Storage (swift)](https://bugs.launchpad.net/swift) | Fix Released | Critical | Unassigned |  |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |
|  | [Ubuntu Cloud Archive](https://bugs.launchpad.net/cloud-archive) | Invalid | High | Unassigned |  |
|  | [Icehouse](https://bugs.launchpad.net/cloud-archive/icehouse) | Won't Fix | Undecided | Unassigned |  |
|  | [Kilo](https://bugs.launchpad.net/cloud-archive/kilo) | Won't Fix | Undecided | Unassigned |  |
|  | [Liberty](https://bugs.launchpad.net/cloud-archive/liberty) | Won't Fix | Undecided | Unassigned |  |
|  | [Mitaka](https://bugs.launchpad.net/cloud-archive/mitaka) | Fix Released | Undecided | Unassigned |  |
|  | [swift (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/swift "Latest release: 2.34.0+git2025011510.f95315b71-0ubuntu1, uploaded to main on 2025-01-21 10:50:10.706385+00:00 by Myles Penner (myles-penner), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | High | Unassigned |  |
|  | [Trusty](https://bugs.launchpad.net/ubuntu/trusty/%2Bsource/swift) | Fix Released | High | Unassigned |  |
|  | [Wily](https://bugs.launchpad.net/ubuntu/wily/%2Bsource/swift) | Won't Fix | Undecided | Unassigned |  |
|  | [Xenial](https://bugs.launchpad.net/ubuntu/xenial/%2Bsource/swift) | Fix Released | Undecided | Unassigned |  |
|  | [Yakkety](https://bugs.launchpad.net/ubuntu/yakkety/%2Bsource/swift) | Fix Released | High | Unassigned |  |

### Bug Description

It looks like the Swift proxy will leak memory if the connection is closed and the full response is not read. This opens for a potential DoS attacks.

Reproduce:

$ swift -A <http://localhost:8888/auth/v1.0> -U .. -K .. upload --use-slo --segment-size 1048576 <container> <big-file>

$ curl -H'X-Auth-Token: AUTH\_...' "<http://localhost:8888/v1/AUTH_../><container>/<big-file>" -m 0.001 > /dev/null

Repeat the curl command a couple of times and you will have more information in netstat and sockstat. The important part is the -m which sets the max time curl spends at downloading. After that point, it'll close the connection.

$ sudo netstat -ant -p | grep :6000

$ cat /proc/net/sockstat

tcp 0 0 127.0.0.1:6000 0.0.0.0:\* LISTEN 1358/python

tcp 0 43221 127.0.0.1:6000 127.0.0.1:48350 FIN\_WAIT1 -

tcp 0 43221 127.0.0.1:6000 127.0.0.1:48882 FIN\_WAIT1 -

tcp 939820 0 127.0.0.1:48350 127.0.0.1:6000 ESTABLISHED 17897/python

tcp 939820 0 127.0.0.1:48882 127.0.0.1:6000 ESTABLISHED 17890/python

tcp 983041 0 127.0.0.1:48191 127.0.0.1:6000 CLOSE\_WAIT 17897/python

tcp 983041 0 127.0.0.1:48948 127.0.0.1:6000 CLOSE\_WAIT 17892/python

Restarting the proxy frees up the lingering memory.

This problem did not exist in 2.2.0.

ProblemType: Bug

DistroRelease: Ubuntu 14.04

Package: swift 2.2.2-0ubuntu1~cloud0 [origin: Canonical]

ProcVersionSignature: Ubuntu 3.16.0-48.64~14.04.1-generic 3.16.7-ckt15

Uname: Linux 3.16.0-48-generic x86\_64

ApportVersion: 2.14.1-0ubuntu3.12

Architecture: amd64

CrashDB:

 {

                "impl": "launchpad",

                "project": "cloud-archive",

                "bug\_pattern\_url": "<http://people.canonical.com/~ubuntu-archive/bugpatterns/bugpatterns.xml>",

             }

Date: Tue Sep 8 09:55:05 2015

InstallationDate: Installed on 2015-06-22 (77 days ago)

InstallationMedia: Ubuntu-Server 14.04.2 LTS "Trusty Tahr" - Release amd64 (20150218.1)

PackageArchitecture: all

SourcePackage: swift

UpgradeStatus: No upgrade log present (probably fresh install)

See [original description](comments/0)

Tags:

[patch](/cloud-archive/%2Bbugs?field.tag=patch)
[amd64](/cloud-archive/%2Bbugs?field.tag=amd64)
[apport-bug](/cloud-archive/%2Bbugs?field.tag=apport-bug)
[in-feature-crypto](/cloud-archive/%2Bbugs?field.tag=in-feature-crypto)
[in-feature-hummingbird](/cloud-archive/%2Bbugs?field.tag=in-feature-hummingbird)
[in-stable-kilo](/cloud-archive/%2Bbugs?field.tag=in-stable-kilo)
[in-stable-liberty](/cloud-archive/%2Bbugs?field.tag=in-stable-liberty)
[third-party-packages](/cloud-archive/%2Bbugs?field.tag=third-party-packages)
[trusty](/cloud-archive/%2Bbugs?field.tag=trusty)

## CVE References

* [2015-5223](/bugs/cve/2015-5223 "OpenStack Object Storage (Swift) befo...")
* [2016-0737](/bugs/cve/2016-0737 "OpenStack Object Storage (Swift) befo...")
* [2016-0738](/bugs/cve/2016-0738 "OpenStack Object Storage (Swift) befo...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Örjan Fors (orrriot)](https://launchpad.net/~orrriot) wrote on 2015-09-08: |  |  | [#1](/cloud-archive/%2Bbug/1493303/comments/1) |
| --- | --- | --- | --- |

* [Dependencies.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459119/%2Bfiles/Dependencies.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459119)
  (2.3 KiB,
  text/plain; charset="utf-8")
* [ProcEnviron.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459120/%2Bfiles/ProcEnviron.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459120)
  (124 bytes,
  text/plain; charset="utf-8")

[James Page (james-page)](https://launchpad.net/~james-page)
on 2015-09-17

| Changed in cloud-archive: | |
| --- | --- |
| **importance**: | Undecided → Critical |
| **importance**: | Critical → High |
| Changed in swift (Ubuntu): | |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-17: |  |  | [#2](/cloud-archive/%2Bbug/1493303/comments/2) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |
| **description**: | updated |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-09-17: |  |  | [#3](/cloud-archive/%2Bbug/1493303/comments/3) |
| --- | --- | --- | --- |

From the description it sounds like this bug impacts the stable/kilo and master (liberty) branches, but not the stable/juno branch.

From the description it sounds like this bug impacts the stable/kilo and master (liberty) branches, but not the stable/juno branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-09-25: |  |  | [#4](/cloud-archive/%2Bbug/1493303/comments/4) |
| --- | --- | --- | --- |

@swift-coresec, is this a duplicate of [bug 1466549](/bugs/1466549) ?

@swift-coresec, is this a duplicate of bug 1466549 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-10-13: |  |  | [#5](/cloud-archive/%2Bbug/1493303/comments/5) |
| --- | --- | --- | --- |

@swift-coresec, can you triage this bug report please ?

@swift-coresec, can you triage this bug report please ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-10-14: |  |  | [#6](/cloud-archive/%2Bbug/1493303/comments/6) |
| --- | --- | --- | --- |

On commit fdc8828e8527b6fa4997072fb4795e4060c68cc0 (tip of master as of the time of this comment), I am unable to reproduce the behavior. I experimented with a variety of curl timeouts (the -m argument), including the proposed 0.001, but still could not reproduce this.

On a freshly-restarted VM, I did see a small jump in the number of non-TIME\_WAIT connections after the first request, but that jump did not occur on the second and subsequent requests, so it appears to be something warming up.

I also checked stable/liberty (47eb6a37) and was unable to reproduce the behavior there either.

I \*can\* reproduce this on stable/kilo (da428c4f).

I suspect that commit 12d8a53 fixed this, though I have no proof of that.

On commit fdc8828e8527b6fa4997072fb4795e4060c68cc0 (tip of master as of the time of this comment), I am unable to reproduce the behavior. I experimented with a variety of curl timeouts (the -m argument), including the proposed 0.001, but still could not reproduce this.
On a freshly-restarted VM, I did see a small jump in the number of non-TIME\_WAIT connections after the first request, but that jump did not occur on the second and subsequent requests, so it appears to be something warming up.
I also checked stable/liberty (47eb6a37) and was unable to reproduce the behavior there either.
I \*can\* reproduce this on stable/kilo (da428c4f).
I suspect that commit 12d8a53 fixed this, though I have no proof of that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Christian Schwede (cschwede)](https://launchpad.net/~cschwede) wrote on 2015-10-14: |  |  | [#7](/cloud-archive/%2Bbug/1493303/comments/7) |
| --- | --- | --- | --- |

I couldn't reproduce this on/after commit 12d8a53, but I could reproduce it on the commits before that.

I had to use a larger timeout to reproduce this (0.01 seconds). I used the following command:

for i in `seq 1 1000`; do curl -H 'X-Auth-Token: AUTH\_...' <http://127.0.0.1:8080/v1/AUTH_test/big/bigfile> -m 0.01 > /dev/null ; done

From my point of view this affects all releases before commit 12d8a53, and I would propose to backport 12d8a53 to stable/juno and stable/kilo.

I couldn't reproduce this on/after commit 12d8a53, but I could reproduce it on the commits before that.
I had to use a larger timeout to reproduce this (0.01 seconds). I used the following command:
for i in `seq 1 1000`; do curl -H 'X-Auth-Token: AUTH\_...' http://127.0.0.1:8080/v1/AUTH\_test/big/bigfile -m 0.01 > /dev/null ; done
From my point of view this affects all releases before commit 12d8a53, and I would propose to backport 12d8a53 to stable/juno and stable/kilo.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Christian Schwede (cschwede)](https://launchpad.net/~cschwede) wrote on 2015-10-14: |  |  | [#8](/cloud-archive/%2Bbug/1493303/comments/8) |
| --- | --- | --- | --- |

Just to add more light on this: most of the connections on pre-12d8a53 are still not closed after 50 minutes. That definetely does not happen on a branch on or after commit 12d8a53.

Just to add more light on this: most of the connections on pre-12d8a53 are still not closed after 50 minutes. That definetely does not happen on a branch on or after commit 12d8a53.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matthew Oliver (matt-0)](https://launchpad.net/~matt-0) wrote on 2015-10-14:  [**Re: [Bug 1493303] Re: Swift proxy memory leak on unfinished read**](/cloud-archive/%2Bbug/1493303/comments/9) |  |  | [#9](/cloud-archive/%2Bbug/1493303/comments/9) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/comments/9/%2Bdownload) (6.2 KiB)

Sam and Romain was the author of patch 12d8a53, the patch makes sure

connections are closed. Here is the commit message of the patch:

commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9

Author: Samuel Merritt <email address hidden>

Date: Thu Jun 18 12:58:03 2015 -0700

Get better at closing WSGI iterables.

PEP 333 (WSGI) says: "If the iterable returned by the application has

    a close() method, the server or gateway must call that method upon

    completion of the current request[.]"

There's a bunch of places where we weren't doing that; some of them

    matter more than others. Calling .close() can prevent a connection

    leak in some cases. In others, it just provides a certain pedantic

    smugness. Either way, we should do what WSGI requires.

Noteworthy goofs include:

\* If a client is downloading a large object and disconnects halfway

        through, a proxy -> obj connection may be leaked. In this case,

        the WSGI iterable is a SegmentedIterable, which lacked a close()

        method. Thus, when the WSGI server noticed the client disconnect,

        it had no way of telling the SegmentedIterable about it, and so

        the underlying iterable for the segment's data didn't get

        closed.

Here, it seems likely (though unproven) that the object server

        would time out and kill the connection, or that a

        ChunkWriteTimeout would fire down in the proxy server, so the

        leaked connection would eventually go away. However, a flurry of

        client disconnects could leave a big pile of useless connections.

\* If a conditional request receives a 304 or 412, the underlying

        app\_iter is not closed. This mostly affects conditional requests

        for large objects.

The leaked connections were noticed by this patch's co-author, who

    made the changes to SegmentedIterable. Those changes helped, but did

    not completely fix, the issue. The rest of the patch is an attempt to

    plug the rest of the holes.

Co-Authored-By: Romain LE DISEZ <email address hidden>

Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937

    Closes-Bug: #1466549

The first noteworthy goof looks like what we're seeing in this bug. This

patch is already in Liberty, but it was applied well after 2.2.0 (Juno) and

Kilo. So it only needs to be backported.

My 2 cents,

Matt

On Wed, Oct 14, 2015 at 7:59 PM, Christian Schwede <

<email address hidden>> wrote:

> Just to add more light on this: most of the connections on pre-12d8a53

> are still not closed after 50 minutes. That definetely does not happen

> on a branch on or after commit 12d8a53.

>

> --

> You received this bug notification because you are a member of Swift

> Core security contacts, which is subscribed to the bug report.

> <https://bugs.launchpad.net/bugs/1493303>

>

> Title:

> Swift proxy memory leak on unfinished read

>

> Status in ubuntu-cloud-archive:

> New

> Status in OpenStack Security Advisory:

> Incomplete

> Status in OpenStack Object Storage (swift):

> New

> Status in swift package in Ubuntu:

> New

>

> Bug description:

> This issue is being treated as a potential security risk under

> embargo. Pleas...

[Read more...](/cloud-archive/%2Bbug/1493303/comments/9)

Sam and Romain was the author of patch 12d8a53, the patch makes sure
connections are closed. Here is the commit message of the patch:
commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
Closes-Bug: #1466549
The first noteworthy goof looks like what we're seeing in this bug. This
patch is already in Liberty, but it was applied well after 2.2.0 (Juno) and
Kilo. So it only needs to be backported.
My 2 cents,
Matt
On Wed, Oct 14, 2015 at 7:59 PM, Christian Schwede <
1493303@bugs.launchpad.net> wrote:
> Just to add more light on this: most of the connections on pre-12d8a53
> are still not closed after 50 minutes. That definetely does not happen
> on a branch on or after commit 12d8a53.
>
> --
> You received this bug notification because you are a member of Swift
> Core security contacts, which is subscribed to the bug report.
> https://bugs.launchpad.net/bugs/1493303
>
> Title:
> Swift proxy memory leak on unfinished read
>
> Status in ubuntu-cloud-archive:
> New
> Status in OpenStack Security Advisory:
> Incomplete
> Status in OpenStack Object Storage (swift):
> New
> Status in swift package in Ubuntu:
> New
>
> Bug description:
> This issue is being treated as a potential security risk under
> embargo. Please do not make any public mention of embargoed (private)
> security vulnerabilities before their coordinated publication by the
> OpenStack Vulnerability Management Team in the form of an official
> OpenStack Security Advisory. This includes discussion of the bug or
> associated fixes in public forums such as mailing lists, code review
> systems and bug trackers. Please also avoid private disclosure to
> other individuals not already approved for access to this information,
> and provide this same reminder to those who are made aware of the
> issue prior to publication. All discussion should remain confined to
> this private bug report, and any proposed fixes should be added to the
> bug as attachments.
>
> It looks like the Swift proxy will leak memory if the connection is
> closed and the full response is not read. This opens for a potential
> DoS attacks.
>
> Reproduce:
>
> $ swift -A http://localhost:8888/auth/v1.0 -U .. -K .. upload --use-slo
> --segment-size 1048576 <container> <big-file>
> $ curl -H'X-Auth-Token: AUTH\_...' "http://localhost:8888/v1/AUTH\_../<container>/<big-file>"
> -m 0.001 > /dev/null
>
> Repeat the curl command a couple of times and you will have more
> information in netstat and sockstat. The important part is the -m
> which sets the max time curl spends at downloading. After that point,
> it'll close the connection.
>
> $ sudo netstat -ant -p | grep :6000
> $ cat /proc/net/sockstat
>
> tcp 0 0 127.0.0.1:6000 0.0.0.0:\*
> LISTEN 1358/python
> tcp 0 43221 127.0.0.1:6000 127.0.0.1:48350
> FIN\_WAIT1 -
> tcp 0 43221 127.0.0.1:6000 127.0.0.1:48882
> FIN\_WAIT1 -
> tcp 939820 0 127.0.0.1:48350 127.0.0.1:6000
> ESTABLISHED 17897/python
> tcp 939820 0 127.0.0.1:48882 127.0.0.1:6000
> ESTABLISHED 17890/python
> tcp 983041 0 127.0.0.1:48191 127.0.0.1:6000
> CLOSE\_WAIT 17897/python
> tcp 983041 0 127.0.0.1:48948 127.0.0.1:6000
> CLOSE\_WAIT 17892/python
>
> Restarting the proxy frees up the lingering memory.
>
> This problem did not exist in 2.2.0.
>
> ProblemType: Bug
> DistroRelease: Ubuntu 14.04
> Package: swift 2.2.2-0ubuntu1~cloud0 [origin: Canonical]
> ProcVersionSignature: Ubuntu 3.16.0-48.64~14.04.1-generic 3.16.7-ckt15
> Uname: Linux 3.16.0-48-generic x86\_64
> ApportVersion: 2.14.1-0ubuntu3.12
> Architecture: amd64
> CrashDB:
> {
> "impl": "launchpad",
> "project": "cloud-archive",
> "bug\_pattern\_url": "
> http://people.canonical.com/~ubuntu-archive/bugpatterns/bugpatterns.xml",
> }
> Date: Tue Sep 8 09:55:05 2015
> InstallationDate: Installed on 2015-06-22 (77 days ago)
> InstallationMedia: Ubuntu-Server 14.04.2 LTS "Trusty Tahr" - Release
> amd64 (20150218.1)
> PackageArchitecture: all
> SourcePackage: swift
> UpgradeStatus: No upgrade log present (probably fresh install)
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/cloud-archive/+bug/1493303/+subscriptions
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-16:  [**Re: Swift proxy memory leak on unfinished read**](/cloud-archive/%2Bbug/1493303/comments/10) |  |  | [#10](/cloud-archive/%2Bbug/1493303/comments/10) |
| --- | --- | --- | --- |

* [leakreproducer.sh](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4520199/%2Bfiles/leakreproducer.sh)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4520199)
  (1.1 KiB,
  text/x-sh)

This bug can still be reproduced in an easy and consistent manner. I've attached a script reproducing the leaks. It simply spins up a swift SAIO box in vagrant, and then runs the curl command mentioned in this issue. Every time the script is run, more memory is leaked. If the proxy-server is restared, the memory will be freed.

A small note: while the script was provisioning the vagrant box for the first time, apt failed. This was easily fixed:

$ cd vagrant-swift-all-in-one/

$ vagrant ssh -c "sudo apt-get -f install -y"

$ vagrant provision

Then just rerun the script:

$ cd ..

$ ./leakreproducer.sh

This bug can still be reproduced in an easy and consistent manner. I've attached a script reproducing the leaks. It simply spins up a swift SAIO box in vagrant, and then runs the curl command mentioned in this issue. Every time the script is run, more memory is leaked. If the proxy-server is restared, the memory will be freed.
A small note: while the script was provisioning the vagrant box for the first time, apt failed. This was easily fixed:
$ cd vagrant-swift-all-in-one/
$ vagrant ssh -c "sudo apt-get -f install -y"
$ vagrant provision
Then just rerun the script:
$ cd ..
$ ./leakreproducer.sh

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-18: |  |  | [#11](/cloud-archive/%2Bbug/1493303/comments/11) |
| --- | --- | --- | --- |

I was able to reproduce this on saio instance of 8Go of ram, deployed with openstack-swift-2.3.0-2.fc23.noarch (which doesn't have 12d8a53). However it didn't cause a noticeable effect since the process was killed and automatically restarted without causing disruption to other services. Also the leak was quickly limited by the maximum number of open file and it took about 42k connections until the process reserved all memory.

Anyway this seems like a duplicate of [bug 1466549](/bugs/1466549) which is already public, can we mark this bug as duplicate and open it ?

I was able to reproduce this on saio instance of 8Go of ram, deployed with openstack-swift-2.3.0-2.fc23.noarch (which doesn't have 12d8a53). However it didn't cause a noticeable effect since the process was killed and automatically restarted without causing disruption to other services. Also the leak was quickly limited by the maximum number of open file and it took about 42k connections until the process reserved all memory.
Anyway this seems like a duplicate of bug 1466549 which is already public, can we mark this bug as duplicate and open it ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-19: |  |  | [#12](/cloud-archive/%2Bbug/1493303/comments/12) |
| --- | --- | --- | --- |

The problem is not that the machine runs out of memory, the problem is that the kernel runs out of buffer space for the TCP stack. This renders the machine unable to do any form of network communication, including SSH. It will however not get the proxy process killed, as there's still plenty of memory left on the machine (just not for TCP). This effectively renders the machine completely unresponsive until it's rebooted, or the proxy process is restarted.

dmesg gets filled up with messages like these:

[ 276.495010] TCP: out of memory -- consider tuning tcp\_mem

[ 276.852703] TCP: out of memory -- consider tuning tcp\_mem

[ 277.996776] TCP: out of memory -- consider tuning tcp\_mem

[ 278.111035] TCP: out of memory -- consider tuning tcp\_mem

[ 279.840715] TCP: out of memory -- consider tuning tcp\_mem

[ 280.421439] TCP: out of memory -- consider tuning tcp\_mem

[ 281.435703] TCP: out of memory -- consider tuning tcp\_mem

[ 283.579847] TCP: out of memory -- consider tuning tcp\_mem

[ 283.616647] TCP: out of memory -- consider tuning tcp\_mem

[ 283.652761] TCP: out of memory -- consider tuning tcp\_mem

These symptons are easily reproduced with the script I posted above, just run it a few times, and the machine will become completely unresponsive. The following line should do the trick:

$ vagrant ssh -c 'for i in {1..100}; do /vagrant/leakconnections.sh; done'

The problem is not that the machine runs out of memory, the problem is that the kernel runs out of buffer space for the TCP stack. This renders the machine unable to do any form of network communication, including SSH. It will however not get the proxy process killed, as there's still plenty of memory left on the machine (just not for TCP). This effectively renders the machine completely unresponsive until it's rebooted, or the proxy process is restarted.
dmesg gets filled up with messages like these:
[ 276.495010] TCP: out of memory -- consider tuning tcp\_mem
[ 276.852703] TCP: out of memory -- consider tuning tcp\_mem
[ 277.996776] TCP: out of memory -- consider tuning tcp\_mem
[ 278.111035] TCP: out of memory -- consider tuning tcp\_mem
[ 279.840715] TCP: out of memory -- consider tuning tcp\_mem
[ 280.421439] TCP: out of memory -- consider tuning tcp\_mem
[ 281.435703] TCP: out of memory -- consider tuning tcp\_mem
[ 283.579847] TCP: out of memory -- consider tuning tcp\_mem
[ 283.616647] TCP: out of memory -- consider tuning tcp\_mem
[ 283.652761] TCP: out of memory -- consider tuning tcp\_mem
These symptons are easily reproduced with the script I posted above, just run it a few times, and the machine will become completely unresponsive. The following line should do the trick:
$ vagrant ssh -c 'for i in {1..100}; do /vagrant/leakconnections.sh; done'

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-19: |  |  | [#13](/cloud-archive/%2Bbug/1493303/comments/13) |
| --- | --- | --- | --- |

That behavior might be related to vagrant networking setup, using a nova instance with fedora kernel didn't broke ssh connection (active and new one). I run 5 parallel "while true; curl ...; done" using a public SLO object (no need for token).

Hence the question asked on [bug 1466549](/bugs/1466549) comment #7:

Does that mean that the issue described here is confirmed to be reproducible under most deployments?

That behavior might be related to vagrant networking setup, using a nova instance with fedora kernel didn't broke ssh connection (active and new one). I run 5 parallel "while true; curl ...; done" using a public SLO object (no need for token).
Hence the question asked on bug 1466549 comment #7:
Does that mean that the issue described here is confirmed to be reproducible under most deployments?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-19: |  |  | [#14](/cloud-archive/%2Bbug/1493303/comments/14) |
| --- | --- | --- | --- |

No, I don't think is related to vagrant, we get the same results in our production environment (that's why we filed the original ticket, our nodes we upgraded to 2.4.0 sunk after the upgrade). The production environment is running on bare metal, so it shouldn't be related to any form of virtualization.

We also tried 2.5.0 in production, and still get the same issues. The last good version for us was 2.2.x, after this we skipped straight to 2.4.0 (I don't think ubuntu packaged 2.3.0) and started having problems.

No, I don't think is related to vagrant, we get the same results in our production environment (that's why we filed the original ticket, our nodes we upgraded to 2.4.0 sunk after the upgrade). The production environment is running on bare metal, so it shouldn't be related to any form of virtualization.
We also tried 2.5.0 in production, and still get the same issues. The last good version for us was 2.2.x, after this we skipped straight to 2.4.0 (I don't think ubuntu packaged 2.3.0) and started having problems.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2015-11-19: |  |  | [#15](/cloud-archive/%2Bbug/1493303/comments/15) |
| --- | --- | --- | --- |

Status changed to 'Confirmed' because the bug affects multiple users.

Status changed to 'Confirmed' because the bug affects multiple users.

| Changed in swift (Ubuntu): | |
| --- | --- |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-19: |  |  | [#16](/cloud-archive/%2Bbug/1493303/comments/16) |
| --- | --- | --- | --- |

Hum, if this reproduce in 2.4.0 and 2.5.0 then it may be a different issue than [bug 1466549](/bugs/1466549) for which the fix (12d8a53) is included in those releases...

It seems like the leakreproducer.sh is stressing the proxy-server using localhost, would this be a different scenario compared to external connection ?

Hum, if this reproduce in 2.4.0 and 2.5.0 then it may be a different issue than bug 1466549 for which the fix (12d8a53) is included in those releases...
It seems like the leakreproducer.sh is stressing the proxy-server using localhost, would this be a different scenario compared to external connection ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-19: |  |  | [#17](/cloud-archive/%2Bbug/1493303/comments/17) |
| --- | --- | --- | --- |

No, it's not different compared to an external connection. If leakproducer.sh is run outside of the virtual machine (just change localhost to 192.168.8.80 in the script), the problem still persists.

Another thing which migth be interesting to note is that after the memory has leaked, it isn't freed even if the object-server is stopped. The proxy-server needs to be restarted in order for the memory to be freed.

No, it's not different compared to an external connection. If leakproducer.sh is run outside of the virtual machine (just change localhost to 192.168.8.80 in the script), the problem still persists.
Another thing which migth be interesting to note is that after the memory has leaked, it isn't freed even if the object-server is stopped. The proxy-server needs to be restarted in order for the memory to be freed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2015-11-19: |  |  | [#18](/cloud-archive/%2Bbug/1493303/comments/18) |
| --- | --- | --- | --- |

Andreas, what version of curl are you using?

I'm not able to see any issues when running leakconnections.sh from my mac (curl 7.43.0), but I did find something when running directly on my precise SAIO (curl 7.22).

Andreas, what version of curl are you using?
I'm not able to see any issues when running leakconnections.sh from my mac (curl 7.43.0), but I did find something when running directly on my precise SAIO (curl 7.22).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-11-20: |  |  | [#19](/cloud-archive/%2Bbug/1493303/comments/19) |
| --- | --- | --- | --- |

I'm running curl 7.43.0 on ubuntu 15.10. I don't think the issue is tied to the curl version though, this happens for us in our production environment when running ffmpeg to transcode videos. When ffmpeg is running it seeks a lot in the stream by opening a new socket with some offset, doing a short read, and then closing the socket. The read and close without consuming the whole object seems to be the key to the problem here.

When running curl from your mac, what output do you get? You should see a lot of lines like these:

curl: (28) Operation timed out after 102 milliseconds with 769995 out of 524288512 bytes received

These are due to curl closing the socket without consuming the whole object, triggering the bug.

I'm running curl 7.43.0 on ubuntu 15.10. I don't think the issue is tied to the curl version though, this happens for us in our production environment when running ffmpeg to transcode videos. When ffmpeg is running it seeks a lot in the stream by opening a new socket with some offset, doing a short read, and then closing the socket. The read and close without consuming the whole object seems to be the key to the problem here.
When running curl from your mac, what output do you get? You should see a lot of lines like these:
curl: (28) Operation timed out after 102 milliseconds with 769995 out of 524288512 bytes received
These are due to curl closing the socket without consuming the whole object, triggering the bug.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-11-23: |  |  | [#20](/cloud-archive/%2Bbug/1493303/comments/20) |
| --- | --- | --- | --- |

@notmyname, does your precise SAIO is running with 12d8a53 ?

@notmyname, does your precise SAIO is running with 12d8a53 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-12-01: |  |  | [#21](/cloud-archive/%2Bbug/1493303/comments/21) |
| --- | --- | --- | --- |

Any news on this? Can we consider this bug confirmed as it can be consistently reproduced?

Any news on this? Can we consider this bug confirmed as it can be consistently reproduced?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kota Tsuyuzaki (tsuyuzaki-kota)](https://launchpad.net/~tsuyuzaki-kota) wrote on 2015-12-02: |  |  | [#22](/cloud-archive/%2Bbug/1493303/comments/22) |
| --- | --- | --- | --- |

It seems that I can reproduce this with current master (exactly after 12d8a53 ) in 2 environment, one is ubuntu 14.04.02 (3.13.0-48-generic kernel) on AWS and the other is 14.04.01 (3.13.0-36-generic) on my laptop virtual machine.

I didn't look at the reason in detail yet but it looks like that we have an issue for that.

My procedure is:

1. upload a 50MB slo object via swift command (i.e. swift upload ---use-slo)

2. Download the slo object via curl, and then stop the download stream via -m (timeout) option

3. cat /proc/net/sockstat shows as follows:

sockets: used 314

TCP: inuse 20 orphan 0 tw 0 alloc 123 mem 3919 (<- I found the "mem" increased by the curl requests)

UDP: inuse 3 mem 0

UDPLITE: inuse 0

RAW: inuse 0

FRAG: inuse 0 memory 0

4. It looks also increase proxy-server memory usage (confilemed by ps and top command)

It looks that larger number of timeout increased the used memory rapidly. i.e. "-m 0.1" made proxy-server to spend more memory than "-m 0.01" (both of them killed the connections before the task finished)

However, I couldn't find CLOSE\_WAIT/FIN\_WAIT in netstat. (it might be related that I turned on tcp\_recycle in sysctl)

Right now I'm not sure but it might be depends on kernel version because I tested in closer version with reported environment so I'll try to make sure another environment if we can reproduce this anytime.

It seems that I can reproduce this with current master (exactly after 12d8a53 ) in 2 environment, one is ubuntu 14.04.02 (3.13.0-48-generic kernel) on AWS and the other is 14.04.01 (3.13.0-36-generic) on my laptop virtual machine.
I didn't look at the reason in detail yet but it looks like that we have an issue for that.
My procedure is:
1. upload a 50MB slo object via swift command (i.e. swift upload ---use-slo)
2. Download the slo object via curl, and then stop the download stream via -m (timeout) option
3. cat /proc/net/sockstat shows as follows:
sockets: used 314
TCP: inuse 20 orphan 0 tw 0 alloc 123 mem 3919 (<- I found the "mem" increased by the curl requests)
UDP: inuse 3 mem 0
UDPLITE: inuse 0
RAW: inuse 0
FRAG: inuse 0 memory 0
4. It looks also increase proxy-server memory usage (confilemed by ps and top command)
It looks that larger number of timeout increased the used memory rapidly. i.e. "-m 0.1" made proxy-server to spend more memory than "-m 0.01" (both of them killed the connections before the task finished)
However, I couldn't find CLOSE\_WAIT/FIN\_WAIT in netstat. (it might be related that I turned on tcp\_recycle in sysctl)
Right now I'm not sure but it might be depends on kernel version because I tested in closer version with reported environment so I'll try to make sure another environment if we can reproduce this anytime.

[John Dickinson (notmyname)](https://launchpad.net/~notmyname)
on 2015-12-02

| Changed in swift: | |
| --- | --- |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#23](/cloud-archive/%2Bbug/1493303/comments/23) |
| --- | --- | --- | --- |

This is weird. I was able to reproduce the problem; the proxy server accumulates a bunch of open filehandles for dead sockets.

I can see with strace that the sockets in question are used for client <--> proxy communication. We're not leaking connections to the storage backends. Also, it looks like someone is trying to clean them up, but is just bad at it. Check this out:

# we have a GET request from the client; the socket is fd 220

    accept(4, {sa\_family=AF\_INET, sin\_port=htons(38280), sin\_addr=inet\_addr("127.0.0.1")}, [16]) = 220

    fcntl(220, F\_GETFL) = 0x2 (flags O\_RDWR)

    fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0

    fcntl(220, F\_GETFL) = 0x802 (flags O\_RDWR|O\_NONBLOCK)

    fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0

    sendto(3, "<139>proxy-server: STDERR: (2834"..., 65, 0, NULL, 0) = 65

    accept(4, 0x7fffa0e778c0, [16]) = -1 EAGAIN (Resource temporarily unavailable)

    recvfrom(220, "GET /v1/AUTH\_test/test/largefile"..., 65536, 0, NULL, NULL) = 160

# ... removed stuff talking to memcached + storage backends

# then we try to send something and learn that it's shut down, so SIGPIPE

    sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)

    --- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---

    # stupidly, we try to send it again ang get another SIGPIPE

    sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)

    --- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---

# attempted cleanup...

    shutdown(220, SHUT\_RDWR) = -1 ENOTCONN (Transport endpoint is not connected)

# and now we completely forget about fd 220 and it's never mentioned again. there's the leak.

    poll([{fd=4, events=POLLIN|POLLPRI|POLLERR|POLLHUP}], 1, 13) = 1 ([{fd=4, revents=POLLIN}])

    # ...thousands more lines not mentioning fd 220

What's weird here is that eventlet is doing this at least somewhat intentionally. Here's an annotated eventlet.wsgi.HttpProtocol.finish():

def finish(self):

        try:

            # this tries to flush any buffers; this is probably what

            # causes the second sendto()/SIGPIPE pair, but I have not

            # verified that.

            BaseHTTPServer.BaseHTTPRequestHandler.finish(self)

        except socket.error as e:

            # Broken pipe, connection reset by peer

            if support.get\_errno(e) not in BROKEN\_SOCK:

                raise

        # This is responsible for the shutdown call. It executes every time;

        # the try/except above doesn't let any exceptions out that would

        # exit this method early.

        greenio.shutdown\_safe(self.connection)

# Here's the fun part: this method call gets executed, but it

        # doesn't make any syscalls. Something is causing this to be a no-op,

        # but I don't know what it is.

        self.connection.close()

Looks like it might be a bug in eventlet, maybe? I'm not convinced this bug is fixable from within Swift.

This is weird. I was able to reproduce the problem; the proxy server accumulates a bunch of open filehandles for dead sockets.
I can see with strace that the sockets in question are used for client <--> proxy communication. We're not leaking connections to the storage backends. Also, it looks like someone is trying to clean them up, but is just bad at it. Check this out:
# we have a GET request from the client; the socket is fd 220
accept(4, {sa\_family=AF\_INET, sin\_port=htons(38280), sin\_addr=inet\_addr("127.0.0.1")}, [16]) = 220
fcntl(220, F\_GETFL) = 0x2 (flags O\_RDWR)
fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0
fcntl(220, F\_GETFL) = 0x802 (flags O\_RDWR|O\_NONBLOCK)
fcntl(220, F\_SETFL, O\_RDWR|O\_NONBLOCK) = 0
sendto(3, "<139>proxy-server: STDERR: (2834"..., 65, 0, NULL, 0) = 65
accept(4, 0x7fffa0e778c0, [16]) = -1 EAGAIN (Resource temporarily unavailable)
recvfrom(220, "GET /v1/AUTH\_test/test/largefile"..., 65536, 0, NULL, NULL) = 160
# ... removed stuff talking to memcached + storage backends
# then we try to send something and learn that it's shut down, so SIGPIPE
sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)
--- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---
# stupidly, we try to send it again ang get another SIGPIPE
sendto(220, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 65536, 0, NULL, 0) = -1 EPIPE (Broken pipe)
--- SIGPIPE {si\_signo=SIGPIPE, si\_code=SI\_USER, si\_pid=28347, si\_uid=1000} ---
# attempted cleanup...
shutdown(220, SHUT\_RDWR) = -1 ENOTCONN (Transport endpoint is not connected)
# and now we completely forget about fd 220 and it's never mentioned again. there's the leak.
poll([{fd=4, events=POLLIN|POLLPRI|POLLERR|POLLHUP}], 1, 13) = 1 ([{fd=4, revents=POLLIN}])
# ...thousands more lines not mentioning fd 220
What's weird here is that eventlet is doing this at least somewhat intentionally. Here's an annotated eventlet.wsgi.HttpProtocol.finish():
def finish(self):
try:
# this tries to flush any buffers; this is probably what
# causes the second sendto()/SIGPIPE pair, but I have not
# verified that.
BaseHTTPServer.BaseHTTPRequestHandler.finish(self)
except socket.error as e:
# Broken pipe, connection reset by peer
if support.get\_errno(e) not in BROKEN\_SOCK:
raise
# This is responsible for the shutdown call. It executes every time;
# the try/except above doesn't let any exceptions out that would
# exit this method early.
greenio.shutdown\_safe(self.connection)
# Here's the fun part: this method call gets executed, but it
# doesn't make any syscalls. Something is causing this to be a no-op,
# but I don't know what it is.
self.connection.close()
Looks like it might be a bug in eventlet, maybe? I'm not convinced this bug is fixable from within Swift.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#24](/cloud-archive/%2Bbug/1493303/comments/24) |
| --- | --- | --- | --- |

Also, there are two separate issues here. The first is fixed by commit 12d8a53 and concerns a leak of connections from proxy to storage server. This is the one being discussed for backporting. The second is a file descriptor leak for client-to-proxy connections. It is reproducible on master (418f9b21) and may be in Swift, eventlet, somewhere else, or the interaction between any two or more of those.

Also, there are two separate issues here. The first is fixed by commit 12d8a53 and concerns a leak of connections from proxy to storage server. This is the one being discussed for backporting. The second is a file descriptor leak for client-to-proxy connections. It is reproducible on master (418f9b21) and may be in Swift, eventlet, somewhere else, or the interaction between any two or more of those.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#25](/cloud-archive/%2Bbug/1493303/comments/25) |
| --- | --- | --- | --- |

never mind... it's only reproducible with SLOs and DLOs. Not even regular Swift objects. Something in our SegmentedIterable class is probably the culprit.

feh.

never mind... it's only reproducible with SLOs and DLOs. Not even regular Swift objects. Something in our SegmentedIterable class is probably the culprit.
feh.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-03: |  |  | [#26](/cloud-archive/%2Bbug/1493303/comments/26) |
| --- | --- | --- | --- |

git bisect claims it's commit 5ca49ca92485b6ba868544f12fa524d9d7b666c6 that introduced the bug. conveniently, this commit changes a bunch of stuff in SegmentedIterable, validating the guess in comment #25.

git bisect claims it's commit 5ca49ca92485b6ba868544f12fa524d9d7b666c6 that introduced the bug. conveniently, this commit changes a bunch of stuff in SegmentedIterable, validating the guess in comment #25.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-04: |  |  | [#27](/cloud-archive/%2Bbug/1493303/comments/27) |
| --- | --- | --- | --- |

* [leakpatch-1.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4529331/%2Bfiles/leakpatch-1.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4529331)
  (496 bytes,
  text/plain)

Experimentally, this fixes the bug. Having a heck of a time writing a unit test, though. If anyone wants to jump in there, please feel free.

Experimentally, this fixes the bug. Having a heck of a time writing a unit test, though. If anyone wants to jump in there, please feel free.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Kota Tsuyuzaki (tsuyuzaki-kota)](https://launchpad.net/~tsuyuzaki-kota) wrote on 2015-12-07: |  |  | [#28](/cloud-archive/%2Bbug/1493303/comments/28) |
| --- | --- | --- | --- |

* [security\_leak\_fix.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4530760/%2Bfiles/security_leak_fix.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4530760)
  (885 bytes,
  text/plain)

Awesome Sam!

SegmentItrable never closes its app\_iter handle and it causes the handler leak. It makes me sense and I confirmed the leakpatch-1.diff fixed the issue in my environment.

Plus, I tried to improve the fix to be intuitive a bit more (attached). In my patch, SegmentIterable.close will attempt to close self.app\_iter at first and it will emit GeneratorExit and then, it will close also backend request iter at current\_resp.

Anyways, nice work and thanks! :-)

Awesome Sam!
SegmentItrable never closes its app\_iter handle and it causes the handler leak. It makes me sense and I confirmed the leakpatch-1.diff fixed the issue in my environment.
Plus, I tried to improve the fix to be intuitive a bit more (attached). In my patch, SegmentIterable.close will attempt to close self.app\_iter at first and it will emit GeneratorExit and then, it will close also backend request iter at current\_resp.
Anyways, nice work and thanks! :-)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-12-07: |  |  | [#29](/cloud-archive/%2Bbug/1493303/comments/29) |
| --- | --- | --- | --- |

@tsuyuzaki-kota we've deployed your patch to some of our servers now. Everything seems to be fixed when running some simple tests that used to trigger the bug! I'll let it run for a day or two and see if everything is stable.

Thanks for the good work everybody! :D

@tsuyuzaki-kota we've deployed your patch to some of our servers now. Everything seems to be fixed when running some simple tests that used to trigger the bug! I'll let it run for a day or two and see if everything is stable.
Thanks for the good work everybody! :D

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-12-07

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Andreas Andersen (yoshiyaka)](https://launchpad.net/~yoshiyaka) wrote on 2015-12-08: |  |  | [#30](/cloud-archive/%2Bbug/1493303/comments/30) |
| --- | --- | --- | --- |

Ok, so everything is still fine on our servers. It seems like the patch fixed the bug completely :)

Ok, so everything is still fine on our servers. It seems like the patch fixed the bug completely :)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-12-09: |  |  | [#31](/cloud-archive/%2Bbug/1493303/comments/31) |
| --- | --- | --- | --- |

* [socket-leak-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4532159/%2Bfiles/socket-leak-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4532159)
  (5.1 KiB,
  text/plain)

Here is a slight modification of Kota's patch, plus a unit test.

The modification was only to change "except GeneratorExit:" to "finally:" so that GeneratorExit propagates to any generators enclosing SegmentedIterable. I don't know of any right now, but future middlewares could easily introduce them.

Now that we have a unit test, I believe this patch to be ready for review.

Here is a slight modification of Kota's patch, plus a unit test.
The modification was only to change "except GeneratorExit:" to "finally:" so that GeneratorExit propagates to any generators enclosing SegmentedIterable. I don't know of any right now, but future middlewares could easily introduce them.
Now that we have a unit test, I believe this patch to be ready for review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-09: |  |  | [#32](/cloud-archive/%2Bbug/1493303/comments/32) |
| --- | --- | --- | --- |

It seems like both leaks (proxy to server and client to proxy) have been reported on former [bug 1466549](/bugs/1466549). I've subscribed the original reporter.

Örjan, I can't find your affiliation, if you want to credit your current employer, please let me know.

Here is the impact description to cover both bugs (which will likely get two different CVE):

Title: Swift proxy-server DoS through Large Object

Reporter: Romain LE DISEZ (OVH), Örjan Persson

Products: Swift

Affects: client-proxy: < 2.4.0 (Liberty)

      proxy-server: =< 2.5.0 (Liberty included)

Description:

Romain LE DISEZ from OVH and Örjan Persson independently reported two vulnerabilities in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. Note that there are two distinct bugs that can exhaust proxy resources, one for client connection (client to proxy), one for servers connection (proxy to server). All Swift setup are affected.

It seems like both leaks (proxy to server and client to proxy) have been reported on former bug 1466549. I've subscribed the original reporter.
Örjan, I can't find your affiliation, if you want to credit your current employer, please let me know.
Here is the impact description to cover both bugs (which will likely get two different CVE):
Title: Swift proxy-server DoS through Large Object
Reporter: Romain LE DISEZ (OVH), Örjan Persson
Products: Swift
Affects: client-proxy: < 2.4.0 (Liberty)
proxy-server: =< 2.5.0 (Liberty included)
Description:
Romain LE DISEZ from OVH and Örjan Persson independently reported two vulnerabilities in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. Note that there are two distinct bugs that can exhaust proxy resources, one for client connection (client to proxy), one for servers connection (proxy to server). All Swift setup are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Örjan Fors (orrriot)](https://launchpad.net/~orrriot) wrote on 2015-12-09: |  |  | [#33](/cloud-archive/%2Bbug/1493303/comments/33) |
| --- | --- | --- | --- |

Great! Happy to hear that it has been resolved. Kiliaro is my employer.

Great! Happy to hear that it has been resolved. Kiliaro is my employer.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-12-10: |  |  | [#34](/cloud-archive/%2Bbug/1493303/comments/34) |
| --- | --- | --- | --- |

Thanks Örjan, next description will mention Kiliaro. I just need to figure out what swift release are going to be fixed...

The tip of stable/kilo (463fbe39fa1142d2bb9f7c738c6d88d9f77857f1) doesn't seems to be in any tags

There is no stable/liberty branch.

According to <http://docs.openstack.org/releases/>, it looks like the fix should land in 2.3.1 (for kilo) and 2.5.1 (for liberty).

@swift-coresec, is this following affect line correct ?

Affects: client to proxy: >=2.2.1, <= 2.3.0

                proxy to server: >=2.2.1, <= 2.3.0, >= 2.4.0, <= 2.5.0

Thanks Örjan, next description will mention Kiliaro. I just need to figure out what swift release are going to be fixed...
The tip of stable/kilo (463fbe39fa1142d2bb9f7c738c6d88d9f77857f1) doesn't seems to be in any tags
There is no stable/liberty branch.
According to http://docs.openstack.org/releases/, it looks like the fix should land in 2.3.1 (for kilo) and 2.5.1 (for liberty).
@swift-coresec, is this following affect line correct ?
Affects: client to proxy: >=2.2.1, <= 2.3.0
proxy to server: >=2.2.1, <= 2.3.0, >= 2.4.0, <= 2.5.0

[John Dickinson (notmyname)](https://launchpad.net/~notmyname)
on 2015-12-15

| Changed in swift: | |
| --- | --- |
| **importance**: | Undecided → Critical |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2015-12-17: |  |  | [#35](/cloud-archive/%2Bbug/1493303/comments/35) |
| --- | --- | --- | --- |

Sam, I think the patch is ok, but the test seems to only be testing the implementation of FakeSwift, not the actual change in SegmentedIterable. When only applying the changes from this patch in the test/ directory, unittests still pass.

Sam, I think the patch is ok, but the test seems to only be testing the implementation of FakeSwift, not the actual change in SegmentedIterable. When only applying the changes from this patch in the test/ directory, unittests still pass.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2016-01-06: |  |  | [#36](/cloud-archive/%2Bbug/1493303/comments/36) |
| --- | --- | --- | --- |

Sam what's the status of tests?

For everyone, it would be good to review the patch in #31 to see how the patch itself looks

Sam what's the status of tests?
For everyone, it would be good to review the patch in #31 to see how the patch itself looks

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-08: |  |  | [#37](/cloud-archive/%2Bbug/1493303/comments/37) |
| --- | --- | --- | --- |

* [socket-leak-3.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4545988/%2Bfiles/socket-leak-3.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4545988)
  (6.8 KiB,
  text/plain)

Here's a patch with a commit message explaining what's going on. Since it's a fix for a memory leak, the test is fairly crappy, but it's something.

Here's a patch with a commit message explaining what's going on. Since it's a fix for a memory leak, the test is fairly crappy, but it's something.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-08: |  |  | [#38](/cloud-archive/%2Bbug/1493303/comments/38) |
| --- | --- | --- | --- |

* [socket-leak-4.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4546358/%2Bfiles/socket-leak-4.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4546358)
  (6.8 KiB,
  text/plain)

Let's try this again, only without the leftover print statements.

Let's try this again, only without the leftover print statements.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-11: |  |  | [#39](/cloud-archive/%2Bbug/1493303/comments/39) |
| --- | --- | --- | --- |

@swift-coresec, please review proposed patch in comment #38. Thanks!

@swift-coresec, please review proposed patch in comment #38. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [John Dickinson (notmyname)](https://launchpad.net/~notmyname) wrote on 2016-01-12: |  |  | [#40](/cloud-archive/%2Bbug/1493303/comments/40) |
| --- | --- | --- | --- |

+2 from me

great work, Sam and Kota

+2 from me
great work, Sam and Kota

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matthew Oliver (matt-0)](https://launchpad.net/~matt-0) wrote on 2016-01-12: |  |  | [#41](/cloud-archive/%2Bbug/1493303/comments/41) |
| --- | --- | --- | --- |

+2 from me too, code looks good and test is working.

+2 from me too, code looks good and test is working.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-12: |  |  | [#42](/cloud-archive/%2Bbug/1493303/comments/42) |
| --- | --- | --- | --- |

The patch seems pretty trivial, would it be possible to get backports for stable/kilo and liberty release too ?

The patch seems pretty trivial, would it be possible to get backports for stable/kilo and liberty release too ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-13: |  |  | [#43](/cloud-archive/%2Bbug/1493303/comments/43) |
| --- | --- | --- | --- |

* [socket-leak-kilo-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548894/%2Bfiles/socket-leak-kilo-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548894)
  (6.6 KiB,
  text/plain)

kilo

kilo

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-13: |  |  | [#44](/cloud-archive/%2Bbug/1493303/comments/44) |
| --- | --- | --- | --- |

* [socket-leak-liberty-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548896/%2Bfiles/socket-leak-liberty-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548896)
  (6.8 KiB,
  text/plain)

liberty

liberty

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-13: |  |  | [#45](/cloud-archive/%2Bbug/1493303/comments/45) |
| --- | --- | --- | --- |

Thanks Samuel.

So iirc, the last three patches only fixe the proxy to server connection leak. For client to proxy leak ([bug 1466549](/bugs/1466549)) the fix only got merged for stable/liberty. The missing stable/kilo backport is proposed here: <https://review.openstack.org/#/c/217750/>

Thanks Samuel.
So iirc, the last three patches only fixe the proxy to server connection leak. For client to proxy leak (bug 1466549) the fix only got merged for stable/liberty. The missing stable/kilo backport is proposed here: https://review.openstack.org/#/c/217750/

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-13: |  |  | [#46](/cloud-archive/%2Bbug/1493303/comments/46) |
| --- | --- | --- | --- |

@swift-coresec, any chance to get <https://review.openstack.org/#/c/217750/> merged before sending the advance notification ?

@swift-coresec, any chance to get https://review.openstack.org/#/c/217750/ merged before sending the advance notification ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-14: |  |  | [#47](/cloud-archive/%2Bbug/1493303/comments/47) |
| --- | --- | --- | --- |

Here is the final impact description for both [bug 1493303](/bugs/1493303) and [bug 1466549](/bugs/1466549),

If it's accurate, I'd like to send the advance notification asap with a disclosure date set to:

2016-01-20, 1500UTC

Title: Swift proxy-server DoS through Large Object

Reporter: Romain LE DISEZ (OVH), Örjan Persson (Kiliaro)

Products: Swift

Affects: client to proxy: >=2.2.1 <= 2.3.0

         proxy to server: >=2.2.1 <= 2.3.0, >= 2.4.0 <= 2.5.0

Description:

Romain LE DISEZ from OVH and Örjan Persson from Kiliaro independently

reported two vulnerabilities in Swift Large Object. By repeatedly

requesting and interrupting connections to a Large Object (Dynamic or

Static) URL, a remote attacker may exhausts Swift proxy-server

resources, potentially resulting in a denial of service. Note that there

are two distinct bugs that can exhaust proxy resources, one for client

connection (client to proxy), one for servers connection (proxy to

server). All Swift setup are affected.

Here is the final impact description for both bug 1493303 and bug 1466549,
If it's accurate, I'd like to send the advance notification asap with a disclosure date set to:
2016-01-20, 1500UTC
Title: Swift proxy-server DoS through Large Object
Reporter: Romain LE DISEZ (OVH), Örjan Persson (Kiliaro)
Products: Swift
Affects: client to proxy: >=2.2.1 <= 2.3.0
proxy to server: >=2.2.1 <= 2.3.0, >= 2.4.0 <= 2.5.0
Description:
Romain LE DISEZ from OVH and Örjan Persson from Kiliaro independently
reported two vulnerabilities in Swift Large Object. By repeatedly
requesting and interrupting connections to a Large Object (Dynamic or
Static) URL, a remote attacker may exhausts Swift proxy-server
resources, potentially resulting in a denial of service. Note that there
are two distinct bugs that can exhaust proxy resources, one for client
connection (client to proxy), one for servers connection (proxy to
server). All Swift setup are affected.

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → In Progress |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-14

| **summary**: | - Swift proxy memory leak on unfinished read+ Swift proxy memory leak on unfinished read (CVE-2016-0738) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alistair Coles (alistair-coles)](https://launchpad.net/~alistair-coles) wrote on 2016-01-14:  [**Re: Swift proxy memory leak on unfinished read (CVE-2016-0738)**](/cloud-archive/%2Bbug/1493303/comments/48) |  |  | [#48](/cloud-archive/%2Bbug/1493303/comments/48) |
| --- | --- | --- | --- |

+2 for patch at #38 applied to master. Verified that this fixes socket leak with early-terminated dlo and slo downloads (on SAIO on Ubuntu 14.04.2)

There's no test for DLO. Not a blocker and possibly redundant since ultimately it is the close call to SegmentedIterable that is being tested.

+2 for patch at #38 applied to master. Verified that this fixes socket leak with early-terminated dlo and slo downloads (on SAIO on Ubuntu 14.04.2)
There's no test for DLO. Not a blocker and possibly redundant since ultimately it is the close call to SegmentedIterable that is being tested.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alistair Coles (alistair-coles)](https://launchpad.net/~alistair-coles) wrote on 2016-01-14: |  |  | [#49](/cloud-archive/%2Bbug/1493303/comments/49) |
| --- | --- | --- | --- |

+2 for the liberty backport at #44

I could not apply the kilo backport at #43:

anc@u128:~/0dev/swift ((036c2f3...))$ git checkout origin/stable/kilo

HEAD is now at 036c2f3... Get better at closing WSGI iterables.

anc@u128:~/0dev/swift ((036c2f3...))$ git am ../patches/socket-leak-kilo-backport.diff

Applying: Fix memory/socket leak in proxy on truncated SLO/DLO GET

error: patch failed: swift/common/request\_helpers.py:431

error: swift/common/request\_helpers.py: patch does not apply

Patch failed at 0001 Fix memory/socket leak in proxy on truncated SLO/DLO GET

The copy of the patch that failed is found in:

   /home/anc/0dev/swift/.git/rebase-apply/patch

When you have resolved this problem, run "git am --continue".

If you prefer to skip this patch, run "git am --skip" instead.

To restore the original branch and stop patching, run "git am --abort".

+2 for the liberty backport at #44
I could not apply the kilo backport at #43:
anc@u128:~/0dev/swift ((036c2f3...))$ git checkout origin/stable/kilo
HEAD is now at 036c2f3... Get better at closing WSGI iterables.
anc@u128:~/0dev/swift ((036c2f3...))$ git am ../patches/socket-leak-kilo-backport.diff
Applying: Fix memory/socket leak in proxy on truncated SLO/DLO GET
error: patch failed: swift/common/request\_helpers.py:431
error: swift/common/request\_helpers.py: patch does not apply
Patch failed at 0001 Fix memory/socket leak in proxy on truncated SLO/DLO GET
The copy of the patch that failed is found in:
/home/anc/0dev/swift/.git/rebase-apply/patch
When you have resolved this problem, run "git am --continue".
If you prefer to skip this patch, run "git am --skip" instead.
To restore the original branch and stop patching, run "git am --abort".

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-14: |  |  | [#50](/cloud-archive/%2Bbug/1493303/comments/50) |
| --- | --- | --- | --- |

Oups, their is now a conflict for stable/kilo backport (proposed in comment #43).

This patch do: in swift/common/request\_helpers.py

+ def close(self):

+ """

+ Called when the client disconnect. Ensure that the connection to the

+ backend server is closed.

+ """

+ close\_if\_possible(self.app\_iter)

While current stable/kilo has:

    def close(self):

        """

        Called when the client disconnect. Ensure that the connection to the

        backend server is closed.

        """

        if self.current\_resp:

            close\_if\_possible(self.current\_resp.app\_iter)

Samuel, can you please fix that backport?

Oups, their is now a conflict for stable/kilo backport (proposed in comment #43).
This patch do: in swift/common/request\_helpers.py
+ def close(self):
+ """
+ Called when the client disconnect. Ensure that the connection to the
+ backend server is closed.
+ """
+ close\_if\_possible(self.app\_iter)
While current stable/kilo has:
def close(self):
"""
Called when the client disconnect. Ensure that the connection to the
backend server is closed.
"""
if self.current\_resp:
close\_if\_possible(self.current\_resp.app\_iter)
Samuel, can you please fix that backport?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alistair Coles (alistair-coles)](https://launchpad.net/~alistair-coles) wrote on 2016-01-14: |  |  | [#51](/cloud-archive/%2Bbug/1493303/comments/51) |
| --- | --- | --- | --- |

* [socket-leak-kilo-backport-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4549968/%2Bfiles/socket-leak-kilo-backport-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4549968)
  (6.3 KiB,
  text/plain)

I think I fixed the conflict with stable/kilo (at 036c2f3) in the attached patch

Sam had better take a look at it to be sure. 036c2f3 added stuff that seemed to allow this patch to be closer to the others i.e. self.current\_resp

I think I fixed the conflict with stable/kilo (at 036c2f3) in the attached patch
Sam had better take a look at it to be sure. 036c2f3 added stuff that seemed to allow this patch to be closer to the others i.e. self.current\_resp

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2016-01-14: |  |  | [#52](/cloud-archive/%2Bbug/1493303/comments/52) |
| --- | --- | --- | --- |

The patch in #51 looks good to me.

The patch in #51 looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-01-14: |  |  | [#53](/cloud-archive/%2Bbug/1493303/comments/53) |
| --- | --- | --- | --- |

The patch in comment #51 works for me. To sum-up, the upcoming advisory needs those patch to be applied:

- <https://review.openstack.org/#/c/217750/> (the stable/kilo backport for [bug 1466549](/bugs/1466549))

 - patch in comment #51 (the stable/kilo backport of this bug)

 - patch in comment #44 (the stable/liberty backport of this bug)

 - patch in comment #38 (the master/mitaka fix of this bug)

No need for stable/liberty or master/mitaka fix for [bug 1466549](/bugs/1466549) since liberty release already has this fix.

The patch in comment #51 works for me. To sum-up, the upcoming advisory needs those patch to be applied:
- https://review.openstack.org/#/c/217750/ (the stable/kilo backport for bug 1466549)
- patch in comment #51 (the stable/kilo backport of this bug)
- patch in comment #44 (the stable/liberty backport of this bug)
- patch in comment #38 (the master/mitaka fix of this bug)
No need for stable/liberty or master/mitaka fix for bug 1466549 since liberty release already has this fix.

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-14

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-20

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public Security |
| **summary**: | - Swift proxy memory leak on unfinished read (CVE-2016-0738)+ [OSSA 2016-004] Swift proxy memory leak on unfinished read+ (CVE-2016-0738) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Fix proposed to swift (stable/kilo)**](/cloud-archive/%2Bbug/1493303/comments/54) |  |  | [#54](/cloud-archive/%2Bbug/1493303/comments/54) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/270234>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/270234

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Fix proposed to swift (stable/liberty)**](/cloud-archive/%2Bbug/1493303/comments/55) |  |  | [#55](/cloud-archive/%2Bbug/1493303/comments/55) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/liberty

Review: <https://review.openstack.org/270235>

Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/270235

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Related fix proposed to ossa (master)**](/cloud-archive/%2Bbug/1493303/comments/56) |  |  | [#56](/cloud-archive/%2Bbug/1493303/comments/56) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: <https://review.openstack.org/270241>

Related fix proposed to branch: master
Review: https://review.openstack.org/270241

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Ubuntu Foundations Team Bug Bot (crichton)](https://launchpad.net/~crichton) wrote on 2016-01-20: |  |  | [#57](/cloud-archive/%2Bbug/1493303/comments/57) |
| --- | --- | --- | --- |

The attachment "leakpatch-1.diff" seems to be a patch. If it isn't, please remove the "patch" flag from the attachment, remove the "patch" tag, and if you are a member of the ~ubuntu-reviewers, unsubscribe the team.

[This is an automated message performed by a Launchpad user owned by ~brian-murray, for any issues please contact him.]

The attachment "leakpatch-1.diff" seems to be a patch. If it isn't, please remove the "patch" flag from the attachment, remove the "patch" tag, and if you are a member of the ~ubuntu-reviewers, unsubscribe the team.
[This is an automated message performed by a Launchpad user owned by ~brian-murray, for any issues please contact him.]

| **tags**: | added: patch |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-22:  [**Fix merged to swift (stable/kilo)**](/cloud-archive/%2Bbug/1493303/comments/58) |  |  | [#58](/cloud-archive/%2Bbug/1493303/comments/58) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270234>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=a4c1825a026655b7ed21d779824ae7c25318fd52>

Submitter: Jenkins

Branch: stable/kilo

commit a4c1825a026655b7ed21d779824ae7c25318fd52

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3.4, at least. See PEP 442.

\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also

       has\_finalizer() in Modules/gcmodule.c in Python.

\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See

        sock\_close() in the same file for the other half of the sad story.

This closes CVE-2016-0738.

Closes-Bug: 1493303

Change-Id: I9b617bfc152dca40d1750131d1d814d85c0a88dd

    Co-Authored-By: Kota Tsuyuzaki <email address hidden>

Reviewed: https://review.openstack.org/270234
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=a4c1825a026655b7ed21d779824ae7c25318fd52
Submitter: Jenkins
Branch: stable/kilo
commit a4c1825a026655b7ed21d779824ae7c25318fd52
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Change-Id: I9b617bfc152dca40d1750131d1d814d85c0a88dd
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>

| **tags**: | added: in-stable-kilo |
| --- | --- |
| **tags**: | added: in-stable-liberty |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-22:  [**Fix merged to swift (stable/liberty)**](/cloud-archive/%2Bbug/1493303/comments/59) |  |  | [#59](/cloud-archive/%2Bbug/1493303/comments/59) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270235>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=8c1976aa771f8c43c5dbe676bd9a5efc69f09eae>

Submitter: Jenkins

Branch: stable/liberty

commit 8c1976aa771f8c43c5dbe676bd9a5efc69f09eae

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3.4, at least. See PEP 442.

\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also

       has\_finalizer() in Modules/gcmodule.c in Python.

\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See

        sock\_close() in the same file for the other half of the sad story.

This closes CVE-2016-0738.

Closes-Bug: 1493303

Change-Id: I74ea49eaa7d5c372cdc2399148d5495d3007dbd0

    Co-Authored-By: Kota Tsuyuzaki <email address hidden>

Reviewed: https://review.openstack.org/270235
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=8c1976aa771f8c43c5dbe676bd9a5efc69f09eae
Submitter: Jenkins
Branch: stable/liberty
commit 8c1976aa771f8c43c5dbe676bd9a5efc69f09eae
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Change-Id: I74ea49eaa7d5c372cdc2399148d5495d3007dbd0
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>

| Changed in swift: | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-22:  [**Fix merged to swift (master)**](/cloud-archive/%2Bbug/1493303/comments/60) |  |  | [#60](/cloud-archive/%2Bbug/1493303/comments/60) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270233>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=58359269b0e971e52f0eb7f97221566ca2148014>

Submitter: Jenkins

Branch: master

commit 58359269b0e971e52f0eb7f97221566ca2148014

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3.4, at least. See PEP 442.

\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also

       has\_finalizer() in Modules/gcmodule.c in Python.

\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See

        sock\_close() in the same file for the other half of the sad story.

This closes CVE-2016-0738.

Closes-Bug: 1493303

Co-Authored-By: Kota Tsuyuzaki <email address hidden>

Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612

Reviewed: https://review.openstack.org/270233
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=58359269b0e971e52f0eb7f97221566ca2148014
Submitter: Jenkins
Branch: master
commit 58359269b0e971e52f0eb7f97221566ca2148014
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-25

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Doug Hellmann (doug-hellmann)](https://launchpad.net/~doug-hellmann) wrote on 2016-01-25:  [**Fix included in openstack/swift 2.6.0**](/cloud-archive/%2Bbug/1493303/comments/61) |  |  | [#61](/cloud-archive/%2Bbug/1493303/comments/61) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/swift 2.6.0 release.

This issue was fixed in the openstack/swift 2.6.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-25:  [**Fix proposed to swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/62) |  |  | [#62](/cloud-archive/%2Bbug/1493303/comments/62) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/272201>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/272201

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-26:  [**Fix merged to swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/63) |  |  | [#63](/cloud-archive/%2Bbug/1493303/comments/63) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/comments/63/%2Bdownload) (30.2 KiB)

Reviewed: <https://review.openstack.org/272201>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=f9b7fd3074b5b0e5d6ea879d4144f7bfeec5d46b>

Submitter: Jenkins

Branch: feature/crypto

commit e13a03c379273ee10e678818078b9c40a96a7dc9

Author: Tim Burke <email address hidden>

Date: Wed Jan 20 16:06:26 2016 -0800

Stop overriding builtin range

Change-Id: I315f8b554bb9e96659b455f4158f074961bd6498

commit 0a404def7d54d1ef1c85c11a378052260c4fda4c

Author: John Dickinson <email address hidden>

Date: Wed Jan 20 15:19:35 2016 -0800

remove unneeded duplicate dict keys

Change-Id: I926d7aaa9df093418aaae54fe26e8f7bc8210645

commit 221f94fdd39fd2dcd9a2e5565adceab615d55913

Author: John Dickinson <email address hidden>

Date: Tue Jan 19 14:50:24 2016 -0800

authors and changelog updates for 2.6.0

Change-Id: Idd0ff9e70abc0773be183c37cd6125fe852da7c0

commit 58359269b0e971e52f0eb7f97221566ca2148014

Author: Samuel Merritt <email address hidden>

Date: Tue Dec 8 16:36:05 2015 -0800

Fix memory/socket leak in proxy on truncated SLO/DLO GET

When a client disconnected while consuming an SLO or DLO GET response,

    the proxy would leak a socket. This could be observed via strace as a

    socket that had shutdown() called on it, but was never closed. It

    could also be observed by counting entries in /proc/<pid>/fd, where

    <pid> is the pid of a proxy server worker process.

This is due to a memory leak in SegmentedIterable. A SegmentedIterable

    has an 'app\_iter' attribute, which is a generator. That generator

    references 'self' (the SegmentedIterable object). This creates a

    cyclic reference: the generator refers to the SegmentedIterable, and

    the SegmentedIterable refers to the generator.

Python can normally handle cyclic garbage; reference counting won't

    reclaim it, but the garbage collector will. However, objects with

    finalizers will stop the garbage collector from collecting them\* and

    the cycle of which they are part.

For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_

    method". However, a generator has a finalizer once it's started

    running and before it finishes: basically, while it has stack frames

    associated with it\*\*.

When a client disconnects mid-stream, we get a memory leak. We have

    our SegmentedIterable object (call it "si"), and its associated

    generator. si.app\_iter is the generator, and the generator closes over

    si, so we have a cycle; and the generator has started but not yet

    finished, so the generator needs finalization; hence, the garbage

    collector won't ever clean it up.

The socket leak comes in because the generator \*also\* refers to the

    request's WSGI environment, which contains wsgi.input, which

    ultimately refers to a \_socket object from the standard

    library. Python's \_socket objects only close their underlying file

    descriptor when their reference counts fall to 0\*\*\*.

This commit makes SegmentedIterable.close() call

    self.app\_iter.close(), thereby unwinding its generator's stack and

    making it eligible for garbage collection.

\* in Python < 3...

Reviewed: https://review.openstack.org/272201
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=f9b7fd3074b5b0e5d6ea879d4144f7bfeec5d46b
Submitter: Jenkins
Branch: feature/crypto
commit e13a03c379273ee10e678818078b9c40a96a7dc9
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Jan 20 16:06:26 2016 -0800
Stop overriding builtin range
Change-Id: I315f8b554bb9e96659b455f4158f074961bd6498
commit 0a404def7d54d1ef1c85c11a378052260c4fda4c
Author: John Dickinson <me@not.mn>
Date: Wed Jan 20 15:19:35 2016 -0800
remove unneeded duplicate dict keys
Change-Id: I926d7aaa9df093418aaae54fe26e8f7bc8210645
commit 221f94fdd39fd2dcd9a2e5565adceab615d55913
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 14:50:24 2016 -0800
authors and changelog updates for 2.6.0
Change-Id: Idd0ff9e70abc0773be183c37cd6125fe852da7c0
commit 58359269b0e971e52f0eb7f97221566ca2148014
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612
commit bc4b298b6e208d3188641712c9d66ae82d172c14
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 19 15:33:13 2016 -0800
Fix a comment's indentation
Change-Id: I34514525b606cf82767ddce7769bc42fa5457717
commit 3a0486e532f22af0d3c8a5c5d78613c22e786ff6
Author: Sivasathurappan Radhakrishnan <siva.radhakrishnan@intel.com>
Date: Fri Dec 4 17:43:00 2015 +0000
Deleted comment about part power in FakeRing
Deleted comment about parameter part power in Class FakeRing as its
behavior got dropped in I8bfc388a04eff6491038991cdfd7686c9d961545.
Change-Id: Iec7d2565a77e48493b0056021066d8d8eab65d0b
Closes-Bug: #1488704
commit 999479f9b17b42ccc5da54ce01651960cf7cf970
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 10:30:30 2016 -0800
Bump eventlet min version to 0.17.4
IPv6 support in Swift is dependent on IPv6 support in eventlet.
eventlet itself only claims support for IPv6 post v0.17
(https://github.com/eventlet/eventlet/issues/8). This update matches
the OpenStack global requirements version.
Change-Id: I9d8433cdd3bf7d7a93b8f50b991cc21721a80d22
commit 133a3ea601a3fea84af36a42845f27b8182fd901
Author: Christopher Bartz <bartz@dkrz.de>
Date: Mon Dec 21 14:17:00 2015 +0100
Use the correct split\_path in handle\_request
Change-Id: I86d423309f0b2091ee2e82b2245caf925b6a75ef
Closes-Bug: #1528189
commit bf10974cdefffdaaebc58d21e8a9912638a0405a
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Dec 16 15:46:13 2015 -0800
Expose token expiration time in tempauth auth response
Previously, we gave no indication of when a token would expire. Users
would have to just use it until it stopped working, then re-auth.
Now, a successful auth response will include a new header,
X-Auth-Token-Expires, with the number of seconds remaining until the
token is invalid. This allows the client to attempt to re-auth before
sending a request that will definitely fail.
For comparison, swauth already uses the X-Auth-Token-Expires header with
identical semantics. Additionally, Keystone (v2 and v3) already exposes
expiration times in its JSON responses. The security impact should be
minimal.
Change-Id: I5a4a74276bc0df6dda94e4bc150065c0d77de0eb
commit 47e226418bad35ccad2a1525f392ba69f6165027
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Mon Jan 18 06:20:14 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Ic416c9afc8a1c76f552803a7c70fc905eda7b3cb
commit 5d449471b12c67b31ebb5a383d9bb35bace36213
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jan 14 17:26:01 2016 -0800
Remove some Python 2.6 leftovers
Change-Id: I798d08722c90327c66759aa0bb4526851ba38d41
commit 3c0cf549f1e822cce8f905b069b317e676cf306b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jan 13 18:08:45 2016 -0800
Speed up get\_more\_nodes() when there is an empty zone
The ring has some optimizations in get\_more\_nodes() so that it can
find handoffs that span all the regions/zones/et cetera and then stop
looking. The stopping is the important part.
Previously, it would quickly find a handoff in each unused region,
then spend way too long looking for more unused regions; the same was
true for zones, IPs, and so on. Thus, in commit 9cd7c6c, we started
counting regions and zones, then stopping when we found them all.
This count included all regions and zones in the ring, regardless of
whether or not there were actually any parts assigned or not. In rings
with an empty region, i.e. a region for which there are only
zero-weight devices, get\_more\_nodes() would be very slow.
This commit ignores devices with no assigned partitions when counting
regions, zones, and so forth, thus greatly speeding things up.
The output of get\_more\_nodes() is unchanged. This is purely an
optimization.
Closes-Bug: 1534303
Change-Id: I4a5c57205e87e1205d40fd5d9458d4114e524332
commit 70047709fc9885df7019f791e17a3240682cc6cb
Author: keliang <ke.liang@easystack.cn>
Date: Fri Jan 15 00:31:51 2016 +0800
Drop python 2.6 support
Change-Id: Id6329c863dacb189fccfc304453ed7b6f9607c14
commit a4c2fe95ab2fbe59379a69914ed0fac49c28efbb
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Jan 12 21:26:33 2016 +0100
Allow to change auditor sleep interval in config
Change-Id: Ic451c5e0b686509f8982ed1bf65a223a2d77b9a0
commit edc823e8030640184071fee4920d34f9a1cc6b3e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Nov 29 18:46:47 2015 +0100
Show UTC time in swift-recon.
It's not consistent now for example local time in replication part and
UTC time at begging of line. Use \_ptime in swift-recon for all time
printing and this function returns UTC now.
Change-Id: I732d9851db157130a08e825e8093b7e244b63e9c
commit fa5b32d27964478dfcccf71155d2aaa946c561f0
Author: Tim Burke <tim.burke@gmail.com>
Date: Tue Jan 12 14:18:30 2016 -0800
Make object-auditor storage-policy-aware
Previously, the object-auditor would always use a (replication)
DiskFileManager when walking through AuditLocations, which would cause
it to skip EC fragment archives with a warning like:
Unexpected file <hash\_path>/1452557187.03610#3.data:
Invalid Timestamp value in filename '1452557187.03610#3.data'
Now, the AuditLocation's policy will be used to find an appropriate
manager to get the diskfile. Additionally, several .commit()s were added
to the auditor tests so the .durable will be written, which is required
when auditing EC fragment archives.
Change-Id: I960e7d696fd9ad704ca1872b4ac821f9078838c7
Closes-Bug: 1533002
commit 33476460239c9cdb08dd8065d22d84a4717da7be
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jan 8 16:15:54 2016 -0800
fixups for ipv6 memcache\_servers docs
Change-Id: I20d91c1e276014eaf210fa9eb43788bc17f4e8df
commit d5ff5447be30b44bf4acc8b912b6241a44f710be
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 12 16:42:06 2016 -0800
Install liberasurecode packages in SAIO.
Change-Id: If673afa2b61a3e388612debf4860d561960963a3
commit 4ffc4ba411f67c8407ba38d082a3a51a96ad7e04
Author: Jonathan Hinson <jlhinson@us.ibm.com>
Date: Tue Jan 12 11:46:21 2016 -0600
Functional tests for if-match with multiple etags
Multiple etags can be provided on an if-match or if-none-match
request. This is currently being tested in the unit tests, but not
in the functional tests. Since these etags can be modified by
middleware, we need functional tests to assert multiple-etag
requests are handled correctly.
Change-Id: Idc409c85e8aa82b59dc2bc28af6ca2617de82699
commit e6194113a3c81563590eabf8f761ccb988bb917c
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri Jan 8 16:38:31 2016 -0800
Validate X-Timestamps
Previously, attempting to PUT a new object with an X-Timestamp header
less than or equal to zero (ie, for a timestamp on or before 1970-01-01
00:00:00) would cause the object-server to 500.
While we're at it, cap X-Timestamp at 9999999999 (2286-11-20 17:46:40)
so we don't get an eleventh digit before the decimal point.
Closes-Bug: 1532471
Change-Id: I23666ec8a067d829eaf9bfe54bd086c320b3429e
commit 1f3304c5153e01988b8f4493875b6489e93f76d0
Author: Ben Martin <blmartin@us.ibm.com>
Date: Mon Dec 14 15:28:17 2015 -0600
Print min\_part\_hours lockout time remaining
swift-ring-builder currently only displays min\_part\_hours and
not the amount of time remaining before a rebalance can occur.
This information is readily available and has been displayed
as a quality of life improvement.
Additionally, a bug where the time since the last rebalance
was always updated when rebalance was called regardless of
if any partitions were reassigned. This can lead to partitions
being unable to be reassigned as they never age according to
the time since last rebalance.
Change-Id: Ie0e2b5e25140cbac7465f31a26a4998beb3892e9
Closes-Bug: #1526017
commit 167bb5eeb82886d67c1b382417fb22b8ea85f0d3
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Wed Dec 16 12:07:27 2015 -0800
Fix IPv6 handling in MemcacheConnPool.
The patch removes the assumption of IPv4-only addresses in the
MemcacheConnPool. The changes are around address handling.
Namely, if a server is specified with an address
[<address>]:port (port is optional), it is assumed to be an IPv6
address [1]. If an IPv6 address is specified without "[]", an exception
is raised as it is impossible to parse such addresses correctly.
For testing, memcache can be configured to listen on the link-local,
unique-local, or ::1 (equivalent to 127.0.0.1) addresses. Link-local
addresses are assigned by default to each interface and are of the form
"fe80::dead:beef". These addresses require a scope ID, which would look
like "fe80::dead:beef%eth0" (replacing eth0 with the correct interface).
Unique-local addresses are any addresses in the fc00::/7 subnet. To add
a ULA to an interface use the "ip" utility. For example:
"ip -6 address add fc01::dead:beef dev eth0". Lastly, and probably
simplest, memcache can be configured to listen on "::1". The same
address would be used in the swift configuration, e.g. "[::1]:11211".
Note: only memcached version 1.4.25 or greater supports binding to an
IPv6 address.
Fixes #1526570
[1] IPv6 host literals:
https://tools.ietf.org/html/rfc3986#section-3.2.2
Change-Id: I8408143c1d47d24e70df56a08167c529825276a2
commit fb6751d8ba133c57e1ebb76be71a96f2f120b8ca
Author: Paul Dardeau <paul.dardeau@intel.com>
Date: Fri Jan 8 22:49:05 2016 +0000
Look for device holes that can be reused when adding new device.
Change-Id: I1980ebdd9dc89848173d8ca2fe2afb74029dcfa2
Closes-Bug: 1532276
commit b35f3c90bde8a7ccb50440bda5800cbb8274a5a1
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Jan 8 01:29:11 2016 -0800
Add note COPY with conditional headers
Swift now supports Range header for COPY (or PUT with X-Copy-From)
to make a partial copied object. This patch adds the note to show
it obviously supported in Swift community.
Change-Id: I6bf28f0932c90e7b305cd61aabce4ed028ae691e
Partial-Bug: #1532126
commit 23c7a58f8f1412c28b3a16b79be09c224c9f7d55
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Dec 11 18:26:34 2015 +0900
Fix ClientException handling in Container Sync
swift/container/sync.py uses swift.common.internal\_client.delete\_object
and put\_object and expected these methods raise ClientException.
But delete\_object and put\_object never raise the exception so this patch
raises ClientException when urllib2 library raises HTTPError.
Co-Authored-By: Eran Rom <eranr@il.ibm.com>
Closes-Bug: #1419901
Change-Id: I58cbf77988979a07998a46d9d81be84d29b0d9bf
commit 6786cdf036b4faabe3928c3d0dd9615d94834801
Author: Harshada Mangesh Kakad <harshadak@metsi.co.uk>
Date: Thu Dec 31 01:44:00 2015 -0800
Fixing the deprecated library function.
os.popen() is deprecated since version 2.6. Resolved with use of
subprocess module.
Change-Id: I4409cdd9edbc1a26d6f99c125c9100fadda5d758
Partial-Bug: #1529836
commit 85a0a6a28e166bc076cf8786de2b46248d8786a2
Author: Eran Rom <eranr@il.ibm.com>
Date: Sun Jul 26 13:31:17 2015 +0300
Container-Sync to iterate only over synced containers
This change introduces a sync\_store which holds only containers that
are enabled for sync. The store is implemented using a directory
structure that resembles that of the containers directory, but has
entries only for containers enabled for sync.
The store is maintained in two ways:
1. Preemptively by the container server when processing
PUT/POST/DELETE operations targeted at containers with
x-container-sync-key / x-container-sync-to
2. In the background using the containers replicator
whenever it processes a container set up for sync
The change updates [1]
[1] http://docs.openstack.org/developer/swift/overview\_container\_sync.html
Change-Id: I9ae4d4c7ff6336611df4122b7c753cc4fa46c0ff
Closes-Bug: #1476623
commit e75888b281d59df0889f28d0b32241dac3a34aa2
Author: HugoKuo <tonytkdk@gmail.com>
Date: Wed Jan 6 14:33:23 2016 +0800
Add more description for write\_affinity\_node\_count parameter in the doc.
Change-Id: Iad410a2be4f9a2cd5c53e860b9f91993aa7f2369
Closes-Bug: #1531173
commit f53cf1043d078451c4b9957027bf3af378aa0166
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Jan 5 20:20:15 2016 +0100
Fixed few misspellings in comments
Change-Id: I8479c85cb8821c48b5da197cac37c80e5c1c7f05
commit 3b1591f235f4b85796917507be5e7fd80365ff9e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Wed Sep 30 19:08:09 2015 +0200
swift-init: New option kill-after-timeout
This option send SIGKILL to daemon after kill\_wait period.
When daemon hangs and doesn't respond to SIGTERM/SIGHUP
there is no way to stop it using swift-init now. Classic
init scripts in Linux kills hanged process after grace
period and this patch add same behaviour. This is most
usefull when using "restart" on hanged daemon.
Change-Id: I8c932b673a0f51e52132df87ea2f4396f4bba9d8
commit 79222e327f9df6335b58e17a6c8dd0dc44b86c17
Author: ChangBo Guo(gcb) <eric.guo@easystack.cn>
Date: Sat Dec 26 13:13:37 2015 +0800
Fix AttributeError for LogAdapter
LogAdapter object has no attribute 'warn' but has attribute
'warning'.
Closes-Bug: #1529321
Change-Id: I0e0bd0a3dbc4bb5c1f0b343a8809e53491a1da5f
commit 684c4c04592278a280032002b5313b171ee7a4c0
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Aug 2 22:47:42 2015 +0530
Python 3 deprecated the logger.warn method in favor of warning
DeprecationWarning: The 'warn' method is deprecated, use 'warning'
instead
Change-Id: I35df44374c4521b1f06be7a96c0b873e8c3674d8
commit d0a026fcb8e8a9f5475699cc56e1998bdc4cd5ca
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Wed Dec 16 18:50:37 2015 +0900
Fix duplication for headers in Access-Control-Expose-Headers
There are following problems with Access-Control-Expose-Headers.
\* If headers in X-Container-Meta-Access-Control-Expose-Headers are
configured, the headers are kept with case-sensitive string.
Then a CORS request comes, the headers are merged into
Access-Control-Expose-Headers as case-sensitive string even if
there is a same header which is not case-sensitive string.
\* Access-Control-Expose-Headers is handled by a list.
If X-Container/Object-Meta-XXX is configured in container/object
and X-Container-Meta-Access-Control-Expose-Headers, same header
is listed in Access-Control-Expose-Headers.
This patch provides a fix for the problems.
Change-Id: Ifc1c14eb3833ec6a851631cfc23008648463bd81
commit 0bcd7fd50ec0763dcb366dbf43a9696ca3806f15
Author: Bill Huber <wbhuber@us.ibm.com>
Date: Fri Nov 20 12:09:26 2015 -0600
Update Erasure Coding Overview doc to remove Beta version
The major functionality of EC has been released for Liberty and
the beta version of the code has been removed since it is now
in production.
Change-Id: If60712045fb1af803093d6753fcd60434e637772
commit 84ba24a75640be4212e0f984c284faf4c894e7c6
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Dec 18 11:24:34 2015 +0000
Fix rst errors so that html docs are complete
rst table format errors don't break the gate job
but do cause sections of the documents to go missing
from the html output.
Change-Id: Ic8c9953c93d03dcdafd8f47b271d276c7b356dc3
commit 9fe0e25604dff35db7eab1bca312821a81db6c1d
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Dec 8 22:27:44 2015 -0800
Sleep enough for trampoline
When running unite test suite in local poor resource environment,
sometimes test/unit/proxy/test\_server.py fails due to a lack of
waiting time to trampoline of eventlet thread.
This patch enables to sleep 1 more second when it doesn't seem
to have enough time to tranpoline.
Change-Id: I0bbc8fc245919d3c0a071ff87ff6e20b8d58f9b8
commit 87f7e907ee412f5847f1f9ffca7a566fb148c6b1
Author: Matthew Oliver <matt@oliver.net.au>
Date: Wed Dec 16 17:19:24 2015 +1100
Pass HTTP\_REFERER down to subrequests
Currently a HTTP\_REFERER (Referer) header isn't passed down to
subrequests. This means \*LO subrequests to segment containers
return a 403 on a \*LO GET when accessed by requests using referer
ACLs.
Currently the only way around referer access to \*LO's is to make the
segments container world readable.
This change makes sure the referer header is passed into subrequests
allowing a segments container to only need to be locked down with
the same referer as the \*LO container.
This is a 1 line change to code, but also adds a unit and 2 functional
functional tests (one for DLO and one for SLO).
Change-Id: I1fa5328979302d9c8133aa739787c8dae6084f54
Closes-Bug: #1526575
commit e15960a5d86e00a7d420edc4af034b27da0af8fd
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Thu Dec 17 12:08:45 2015 +0000
Fix incorrect kwarg in auth middleware example
When calling memcache\_client.set(), timeout was deprecated
and is now removed as a keyword arg, use time instead.
Change-Id: Iedbd5b064853ef2b386963246f639fbcd3931cd3
commit 169a7c7f9e12ebc9933bd9ca4592e13b0de8b47b
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Dec 16 15:28:25 2015 +0000
Fix func test --until-failure and --no-discover options
This patch changes functional test classes to subclass
unittest2.TestCase rather than unittest.TestCase.
This fixes errors when attempting to use
tox -e func -- -n <test\_path\_including\_test\_method>
and
tox -e func -- --until-failure
Also migrate from using nose.SkipTest to unittest2.SkipTest
Change-Id: I903033f5e01833550b2f2b945894edca4233c4a2
Closes-Bug: 1526725
Co-Authored-By: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
commit b68311db95860ac1cab585a5ab66bd3b3abb765e
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Dec 15 18:55:41 2015 -0800
Fix reconciler test to calc lastmodified as UTC
Swift reconciler calculates the last-modified date as UTC but
current test calculates it as local time zone. It triggers unit
test failure in non-UTC environment.
This patch fixes the test to calculate the last-modified as UTC
as well.
Change-Id: Ia0053f350daf2cb8c61ac01a933924b6e4b0cb37
Closes-Bug: #1526588
commit 1bb665331af92422290fb585de7cb6a2497236e6
Author: Venkateswarlu Pallamala <p.venkatesh551@gmail.com>
Date: Mon Nov 9 19:22:38 2015 -0800
remove unused parameters in the method
make the helper methods as private by using convention
Change-Id: I73b9604f8d5a0e85d012aac42b7963b618f5ad97
commit 9d7f71d5754c8b45f8e7c6ab80202de09933afb8
Author: Richard Hawkins <hurricanerix@gmail.com>
Date: Fri Aug 7 18:14:13 2015 -0500
Modify functional tests to use ostestr/testr
Defcore uses Tempest, which uses Test Repository.
This change makes it easier for Defcore to pull functional
tests from Swift and run them. Additionally, using testr
allows tests to be run in parallel.
Concurrency set to 1 for now, >1 causes failures for
reasons that are still TBD.
With switch to ostestr all the server logs are being sent to stdout
which makes it completely unreadable. Suppressing the logs by default
now with a flag to enable it if desired.
Co-Authored-By: John Dickinson <me@not.mn>
Co-Authored-By: Robert Collins <rbtcollins@hpe.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Co-Authored-By: Ganesh Maharaj Mahalingam <ganesh.mahalingam@intel.com>
Change-Id: I53ef4a116996a772cf1f3abc2eb0ad60047322d5
Related-Bug: 1177924
commit 2f4b79233e30d42140bbc07059417443bf7a0757
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Tue Dec 15 15:49:42 2015 +0000
Minor cleanup of repeated identical test assertions
assertDictContainsSubset is being called multiple times with
same arguments in a loop. Since assertDictContainsSubset is
deprecated form python 3.2, replace it with checks on
individual key, value pairs.
Change-Id: I7089487710147021f26bd77c36accf5751855d68
commit 60b2e02905d57f55169e506f4874b2334a1a68a5
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Oct 5 16:15:29 2015 +0100
Make ECDiskFile report all fragments found on disk
Refactor the disk file get\_ondisk\_files logic to enable
ECDiskfile to gather \*all\* fragments found on disk (not just those
with a matching .durable file) and make the fragments available
via the DiskFile interface as a dict mapping:
Timestamp --> list of fragment indexes
Also, if a durable fragment has been found then the timestamp
of the durable file is exposed via the diskfile interface.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I55e20a999685b94023d47b231d51007045ac920e
commit 450737f886050e486f518cdce0c97596ccad848d
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Dec 15 11:33:56 2015 +0900
Fix a typo in development\_auth.rst
This patch uses correct name for "CORS".
Change-Id: I5fee5c581a2b3adb7596a273baf05708bfa97f79
commit 40476ea0797690d3a90a9ed91906d26103dfa058
Author: John Dickinson <me@not.mn>
Date: Mon Dec 14 10:52:22 2015 -0800
Document pretend\_min\_part\_hours\_passed
Added a docstring for the swift-ring-builder CLI command
"pretend\_min\_part\_hours\_passed". This is a dangerous operation, and
that's why it hasn't been documented, but it can be useful at times.
It should be made known to those who need it.
Change-Id: I45bdbaacbbdda64c7510453e6d93e6d8563e3ecd
commit 6ade2908cca696ce1b48a7a19f4d460081fa5b0a
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Dec 13 21:13:42 2015 +0100
Deprecated param timeout removed from memcached
Change-Id: Idf042a79f0db148bf9f28a9e360cb2a3c18d385a
commit 88c9aed7c846402355a3c7831f34f3e833bbdf11
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:19:28 2015 +0200
Port swift.common.utils.StatsdClient to Python 3
\* StatsdClient.\_send(): on Python 3, encode parts to UTF-8 and
replace '|' with b'|' to join parts.
\* timing\_stats(): replace func.func\_name with func.\_\_name\_\_. The
func\_name attribute of functions was removed on Python 3, whereas
the \_\_name\_\_ attribute is available on Python 2 and Python 3.
\* Fix unit tests to use bytes
Change-Id: Ic279c9b54e91aabcc52587eed7758e268ffb155e
commit ca2dcc371921aa1aded6161287cc03c0940bf198
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Fri Dec 11 18:21:28 2015 +0100
Deprecated tox -downloadcache option removed
Caching is enabled by default from pip version 6.0
More info:
https://testrun.org/tox/latest/config.html#confval-downloadcache=path
https://pip.pypa.io/en/stable/reference/pip\_install/#caching
Change-Id: I9451a0f0dee5c5a3c0ca0a52f58bd353602661a2
commit 211758f8cb02298fe16e59bf2954a146c6b24b83
Author: Catherine Northcott <catherine@northcott.nz>
Date: Thu Nov 5 23:04:14 2015 +1300
Add support for storage policies to have more than one name
This patch alters storage\_policy.py to allow storage policies
to have multiple names. Now users are able to add a number of
human-readable aliases for storage policies. Policies now have
a .name (the default name), .aliases (a string of comma
seperated aliases), and .aliases\_list (a list of all human
readable names). Policies will always have an .aliases value
if no aliases are set it will contain the default name.
The policy docs and tests have been updated to reflect changes
and policy.get\_policy\_info has been altered to display the
name and aliases
Change-Id: I02967ca8d7c790595e5ee551581196aa64552eea
commit 7f636a557296ecc6ae4727700cfcf9f82573bd16
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Nov 30 18:06:09 2015 -0800
Allow smaller segments in static large objects
The addition of range support for SLO segments (commit 25d5e68)
required the range size to be at least the SLO minimum segment size
(default 1 MiB). However, if you're doing something like assembling a
video of short clips out of a larger one, then you might not need a
full 1 MiB.
The reason for the 1 MiB restriction was to protect Swift from
resource overconsumption. It takes CPU, RAM, and internal bandwidth to
connect to an object server, so it's much cheaper to serve a 10 GiB
SLO if it has 10 MiB segments than if it has 10 B segments.
Instead of a strict limit, now we apply ratelimiting to small
segments. The threshold for "small" is configurable and defaults to 1
MiB. SLO segments may now be as small as 1 byte.
If a client makes SLOs as before, it'll still be able to download the
objects as fast as Swift can serve them. However, a SLO with a lot of
small ranges or segments will be slowed down to avoid resource
overconsumption. This is similar to how DLOs work, except that DLOs
ratelimit \*every\* segment, not just small ones.
UpgradeImpact
For operators: if your cluster has enabled ratelimiting for SLO, you
will want to set rate\_limit\_under\_size to a large number prior to
upgrade. This will preserve your existing behavior of ratelimiting all
SLO segments. 5368709123 is a good value, as that's 1 greater than the
default max object size. Alternately, hold down the 9 key until you
get bored.
If your cluster has not enabled ratelimiting for SLO (the default), no
action is needed.
Change-Id: Id1ff7742308ed816038a5c44ec548afa26612b95
commit 73d0f1620a269f990dbd3d2796abf27e9a05e227
Author: Béla Vancsics <vancsics@inf.u-szeged.hu>
Date: Tue Dec 8 10:17:08 2015 +0100
Not used parameter
The account variable was not used in the method.
Change-Id: I8e91d7616529f33b615bc52af76bfda01141d364

| **tags**: | added: in-feature-crypto |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-28:  [**Related fix merged to ossa (master)**](/cloud-archive/%2Bbug/1493303/comments/64) |  |  | [#64](/cloud-archive/%2Bbug/1493303/comments/64) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270241>

Committed: <https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d>

Submitter: Jenkins

Branch: master

commit 606a18e718aed329a9d42d298e3119f0f1974e3d

Author: Tristan Cacqueray <email address hidden>

Date: Wed Jan 20 10:19:30 2016 -0500

Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)

Related-Bug: #1466549

    Related-Bug: #1493303

    Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

Reviewed: https://review.openstack.org/270241
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d
Submitter: Jenkins
Branch: master
commit 606a18e718aed329a9d42d298e3119f0f1974e3d
Author: Tristan Cacqueray <tdecacqu@redhat.com>
Date: Wed Jan 20 10:19:30 2016 -0500
Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)
Related-Bug: #1466549
Related-Bug: #1493303
Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-02-09:  [**Fix proposed to swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/65) |  |  | [#65](/cloud-archive/%2Bbug/1493303/comments/65) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/277950>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/277950

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-02-10:  [**Change abandoned on swift (feature/crypto)**](/cloud-archive/%2Bbug/1493303/comments/66) |  |  | [#66](/cloud-archive/%2Bbug/1493303/comments/66) |
| --- | --- | --- | --- |

Change abandoned by Alistair Coles (<email address hidden>) on branch: feature/crypto

Review: <https://review.openstack.org/277950>

Change abandoned by Alistair Coles (alistair.coles@hpe.com) on branch: feature/crypto
Review: https://review.openstack.org/277950

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-03-08:  [**Fix proposed to swift (feature/hummingbird)**](/cloud-archive/%2Bbug/1493303/comments/67) |  |  | [#67](/cloud-archive/%2Bbug/1493303/comments/67) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/290148>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/290148

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-03-08:  [**Fix merged to swift (feature/hummingbird)**](/cloud-archive/%2Bbug/1493303/comments/68) |  |  | [#68](/cloud-archive/%2Bbug/1493303/comments/68) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/comments/68/%2Bdownload) (71.7 KiB)

Reviewed: <https://review.openstack.org/290148>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=0f7f1de233919a0b046349a3e31ae7fc8675a1c5>

Submitter: Jenkins

Branch: feature/hummingbird

commit d6b4587a554b51ba733b151e0d924735b63d07e0

Author: Olga Saprycheva <email address hidden>

Date: Tue Mar 8 10:57:56 2016 -0600

Removed redundant file for flake8 check

Change-Id: I4322978aa20ee731391f7709bbd79dee140fc703

commit 643dbce134140530eef2ae62c42fef1107f905ed

Author: OpenStack Proposal Bot <email address hidden>

Date: Tue Mar 8 06:35:49 2016 +0000

Imported Translations from Zanata

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I96b8ff1287bf219c5f8d56a3a4868c1063a953f9

commit 83713d37f0331c5ce9d377f4b4e8724551ae30ca

Author: Daisuke Morita <email address hidden>

Date: Mon Mar 7 18:30:47 2016 -0800

Missing comments for storage policy parameter

There are missing comments about storege\_policy\_index so appropriate

    comments are added.

Change-Id: I3de3f0e6864e65918ca1a13cce70f19c23d295f5

commit 2cff2dec3d1c4588f5103e39679c43b3dded6dcb

Author: Olga Saprycheva <email address hidden>

Date: Fri Mar 4 15:19:39 2016 -0600

Fixed pep8 and flake8 errors in doc/source/conf.py and updated flake8 commands in tox.ini to test it.

Change-Id: I2add370e4cfb55d1388e3a8b41f688a7f3f2c621

commit 043fbca6d08648baa314ea2236f1ccdca8785f16

Author: Christian Schwede <email address hidden>

Date: Fri Mar 4 09:33:17 2016 +0000

Remove Erasure Coding beta status from docs

This removes notes stating support for Erasure coding as beta. Questions

    regarding the stability of EC are coming up regularly, and are often referring

    to the docs that state EC as still in beta.

Besides this, a note marking statsd support as beta has been removed as well.

Change-Id: If4fb6a5c4cb741d42953db3cee8cb17a1d774e15

commit 09c73b86e9255f28fbd4cf571a52c17d549a8f9a

Author: Pete Zaitcev <email address hidden>

Date: Thu Mar 3 10:24:28 2016 -0700

Fix a crash in exception printout

Says the number of arguments does not match the number of '%'.

Change-Id: I8b5e395a07328fb9d4ac7a19f8ed2ae1637bee3b

commit fad5fabe0a22e8a86635a66523dd3d3d3b1fa705

Author: Tim Burke <email address hidden>

Date: Thu Mar 3 15:07:08 2016 +0000

During functional tests, 404 response to a DELETE is successful

Previously, we would only consider 204 responses successful, which would

    cause some spurious gate failures, such as

<http://logs.openstack.org/66/287666/3/check/gate-swift-dsvm-functional/c6d2673/console.html#_2016-03-03_13_41_07_846>

Change-Id: Ic8c300647924352a297a2781b50064f7657038b4

commit e91de49d6864b3794f8dc5acd9c1bf0c2f7409d1

Author: Alistair Coles <email address hidden>

Date: Mon Aug 10 10:30:10 2015 -0500

Update container on fast-POST

This patch makes a number of changes to enable content-type

    metadata to be updated when using the fast-POST mode of

    operation, as proposed in the associated spec ...

Reviewed: https://review.openstack.org/290148
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=0f7f1de233919a0b046349a3e31ae7fc8675a1c5
Submitter: Jenkins
Branch: feature/hummingbird
commit d6b4587a554b51ba733b151e0d924735b63d07e0
Author: Olga Saprycheva <osapryc@us.ibm.com>
Date: Tue Mar 8 10:57:56 2016 -0600
Removed redundant file for flake8 check
Change-Id: I4322978aa20ee731391f7709bbd79dee140fc703
commit 643dbce134140530eef2ae62c42fef1107f905ed
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue Mar 8 06:35:49 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I96b8ff1287bf219c5f8d56a3a4868c1063a953f9
commit 83713d37f0331c5ce9d377f4b4e8724551ae30ca
Author: Daisuke Morita <morita.daisuke@ntti3.com>
Date: Mon Mar 7 18:30:47 2016 -0800
Missing comments for storage policy parameter
There are missing comments about storege\_policy\_index so appropriate
comments are added.
Change-Id: I3de3f0e6864e65918ca1a13cce70f19c23d295f5
commit 2cff2dec3d1c4588f5103e39679c43b3dded6dcb
Author: Olga Saprycheva <osapryc@us.ibm.com>
Date: Fri Mar 4 15:19:39 2016 -0600
Fixed pep8 and flake8 errors in doc/source/conf.py and updated flake8 commands in tox.ini to test it.
Change-Id: I2add370e4cfb55d1388e3a8b41f688a7f3f2c621
commit 043fbca6d08648baa314ea2236f1ccdca8785f16
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri Mar 4 09:33:17 2016 +0000
Remove Erasure Coding beta status from docs
This removes notes stating support for Erasure coding as beta. Questions
regarding the stability of EC are coming up regularly, and are often referring
to the docs that state EC as still in beta.
Besides this, a note marking statsd support as beta has been removed as well.
Change-Id: If4fb6a5c4cb741d42953db3cee8cb17a1d774e15
commit 09c73b86e9255f28fbd4cf571a52c17d549a8f9a
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Thu Mar 3 10:24:28 2016 -0700
Fix a crash in exception printout
Says the number of arguments does not match the number of '%'.
Change-Id: I8b5e395a07328fb9d4ac7a19f8ed2ae1637bee3b
commit fad5fabe0a22e8a86635a66523dd3d3d3b1fa705
Author: Tim Burke <tim.burke@gmail.com>
Date: Thu Mar 3 15:07:08 2016 +0000
During functional tests, 404 response to a DELETE is successful
Previously, we would only consider 204 responses successful, which would
cause some spurious gate failures, such as
http://logs.openstack.org/66/287666/3/check/gate-swift-dsvm-functional/c6d2673/console.html#\_2016-03-03\_13\_41\_07\_846
Change-Id: Ic8c300647924352a297a2781b50064f7657038b4
commit e91de49d6864b3794f8dc5acd9c1bf0c2f7409d1
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Aug 10 10:30:10 2015 -0500
Update container on fast-POST
This patch makes a number of changes to enable content-type
metadata to be updated when using the fast-POST mode of
operation, as proposed in the associated spec [1].
\* the object server and diskfile are modified to allow
content-type to be updated by a POST and the updated value
to be stored in .meta files.
\* the object server accepts PUTs and DELETEs with older
timestamps than existing .meta files. This is to be
consistent with replication that will leave a later .meta
file in place when replicating a .data file.
\* the diskfile interface is modified to provide accessor
methods for the content-type and its timestamp.
\* the naming of .meta files is modified to encode two
timestamps when the .meta file contains a content-type value
that was set prior to the latest metadata update; this
enables consistency to be achieved when rsync is used for
replication.
\* ssync is modified to sync meta files when content-type
differs between local and remote copies of objects.
\* the object server issues container updates when handling
POST requests, notifying the container server of the current
immutable metadata (etag, size, hash, swift\_bytes),
content-type with their respective timestamps, and the
mutable metadata timestamp.
\* the container server maintains the most recently reported
values for immutable metadata, content-type and mutable
metadata, each with their respective timestamps, in a single
db row.
\* new probe tests verify that replication achieves eventual
consistency of containers and objects after discrete updates
to content-type and mutable metadata, and that container-sync
sync's objects after fast-post updates.
[1] spec change-id: I60688efc3df692d3a39557114dca8c5490f7837e
Change-Id: Ia597cd460bb5fd40aa92e886e3e18a7542603d01
commit 3c61ab4678a7aa9ff256ace4bc97ab449607fd49
Author: asettle <alexandra.settle@rackspace.com>
Date: Wed Feb 10 17:58:05 2016 +1000
Operational procedures guide
This is the operational procedures guide that HPE used
to operate and monitor their public Swift systems.
It has been made publicly available.
Change-Id: Iefb484893056d28beb69265d99ba30c3c84add2b
commit 8e4347afd59aa30708ef03a78202652aaadda2e9
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Tue Nov 17 16:15:59 2015 +0900
Fix proxy-server's support for chunked transferring in GET object
Proxy-server now requires Content-Length in the response header
when getting object and does not support chunked transferring with
"Transfer-Encoding: chunked"
This doesn't matter in normal swift, but prohibits us from putting
any middelwares to execute something like streaming processing of
objects, which can't calculate the length of their response body
before they start to send their response.
Change-Id: I60fc6c86338d734e39b7e5f1e48a2647995045ef
commit 9dda1c9526c5b3e0ac905985921605d833bef3cc
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Fri Dec 25 10:30:01 2015 +0900
Update parameters about authtoken middleware in proxy-server.conf.sample
This patch replaces some configration parameters about authtoken
middleware in proxy-server.conf, which will be deprecated.
The following parameters are to be deprecated.
auth\_admin\_prefix, auth\_host, auth\_port, auth\_protocol,
identity\_uri, admin\_token, admin\_user, admin\_password,
admin\_tenant\_name
Change-Id: I373734933189c87c4094203b0752dd3762689034
commit 087fa4fa01fc36343f2ce0974d3b36ec0b98afc8
Author: Andreas Jaeger <aj@suse.com>
Date: Mon Feb 29 20:00:38 2016 +0100
Remove unused pngmath Sphinx extension
There's no RST file that uses ".. math" and thus
the pngmath Sphinx extension is not used and can
get removed.
Change-Id: I3ea4b529025c8ac3c4092f3720124647861e6668
commit 9c5b01e7c7699fbfd221e98ccde1afa9361c8119
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Wed Dec 9 08:08:22 2015 +0000
Add container quota functional test
This patch provides one container quota functional test.
Change-Id: I16354c15fc434d70f9bb6b9b1e18b09357195c83
commit efdc6ee8dbc434e9189a6b85b924c322c3ff6ae3
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Thu Dec 10 01:15:30 2015 +0000
Add X-Delete-After and X-Delete-At functional test
This patch provides functional tests for X-Delete-After and X-Delete-At.
Change-Id: I55b0d0584428413aa7a31f66defec55f9b1bbcd9
commit bd93d44bb46350f716f1dfb66fb43c2ab4ad8c50
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Sun Feb 28 13:41:19 2016 +0900
Make sure all temp files get deleted in test\_ringbuilder
This patch makes test\_ringbuilder create a temporal directory,
run ring builder commands under it, and delete it after testing
for each test cases, to fix temp file leaking.
Change-Id: I6f59fe095ea6485af0e60b5a8e8fc3892e0a0f90
commit 10b5765c60790f8a3ae2a94d6a51736ec2c99ce0
Author: benjkeller <bjkeller@us.ibm.com>
Date: Thu Feb 25 18:54:00 2016 -0600
Rename test\_object\_delete\_at\_aysnc
This renames test\_object\_delete\_at\_aysnc to
test\_object\_delete\_at\_async to match with the function
async\_update which it tests.
Change-Id: I726afcbf08a3449c7af2834e573b97be378a86cd
Closes-Bug: 1550067
commit 9e53bb47efa28983109da8ceca5d316925bc6804
Author: John Dickinson <me@not.mn>
Date: Wed Feb 24 09:36:40 2016 -0800
updated some weird whitespace character to a normal one
Change-Id: I187fb8fc8d10f950bbebc586999eced0bc117432
commit 54e53ae87b6e87229dc77cb7c814ab9733ea7013
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Feb 19 09:30:10 2016 +0000
Silence SkipTest noise in in-process test teardown
setup\_package and teardown\_package get called twice when
running functional tests using nose. With in-process mode
the first call to teardown\_package clears global config
which causes the test swiftclient to raise a SkipTest error
during the second call to teardown\_package.
To reproduce:
SWIFT\_TEST\_IN\_PROCESS=1 nosetests ./test/functional/test\_account.py
This patch simply tests for config existence before attempting
to create a test swiftclient in the teardown\_package function.
Also fix a related issue whereby in\_process flag would be reset to
False during second call to setup\_package, thus causing some of the
in process cleanup in teardown\_package to never be executed.
Change-Id: I074dcd3d39aa46b262632024b047556ca471e8b8
commit 076134784b4eb1c2e55b28218dc0d64a57795d63
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Feb 23 17:28:08 2016 -0800
Add warn method back to LogAdapter
The change in 684c4c04 to improve py3 support breaks older middleware
that consumes the SwiftLogger.
Good for Swift code to not to use warn because it's deprecated.
Bad for LogAdapter to not faithfully provide the current python logging
module API (deprecated or otherwise).
Change-Id: Ib0baf66b7f33f91562867076ff0526a287d8e5a6
commit eb7ca115e6501edd9225dce8784b8b3d3e094bb1
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Feb 23 14:00:34 2016 -0800
Fix StatsD tests to not use real DNS
In common/test\_utils.py, TestStatsdLogging had the majority of its
test cases calling the real socket.getaddrinfo(), which uses real
DNS. This is very slightly slower than using a mock getaddrinfo() when
the machine running the tests has functioning DNS, but on a machine
with no network connection at all, the tests are excruciatingly slow
due to timeouts.
This commit mocks things out as appropriate. There's still one user of
the real getaddrinfo(), but it's for ::1, so that's just local
resolution based on /etc/hosts.
Timing numbers for "./.unittests test.unit.common.test\_utils:TestStatsdLogging":
\* network, without this patch: 1.8s
\* no network, without this patch: 221.2s (ouch)
\* network, with this patch: 1.1s
\* no network, with this patch: 1.1s
Change-Id: I1a2d6f24fc9bb928894fb1fd8383516250e29e0c
commit b97adf70ade2982fea5354c55f1eea9f98442fa7
Author: Thiago da Silva <thiago@redhat.com>
Date: Tue Feb 23 16:23:51 2016 -0500
fix formatting of bulk operations doc
Change-Id: I247d2867c55d6bbf2288dfb74271f57c6f88b243
commit cfd50212358372694ba0713ff8c3bc313c6f1a92
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Feb 18 21:06:40 2016 -0800
dry out container unittests
Change Ifcc4392ffa4df485ce3c62a35d0fcc8c93de74aa introduced
TestContainerController4Replicas as a subclass of
TestContainerController. And there is duplicated code
block to override setUp method.
This patch removed the duplicated code block.
Change-Id: Iad0b64cba52554b89dbd959475a2ce7c0d9a20eb
commit 406e8996fb288e9851e02c3f3faa536a9919b28f
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Mon Feb 22 16:10:09 2016 +0900
Use 201 insted of 200 in PUT test case
There are some unit test cases which assumes 200 as the response
of PUT request, but 200 is never returned in PUT.
This patch replaces 200 in PUT by 201, and adapt unit test cases
to real case.
Change-Id: I35fc7a4fe7fcc5558a9e6c6371105793c2710f3e
commit 5b18455cef57d052df3cda3e9179c923d3aadcad
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Jan 22 07:06:45 2016 +0000
Add unit tests for checking responses in ContainerController
This patch provides unit tests to check responses for various situation
in three/four replicas env.
Change-Id: Ifcc4392ffa4df485ce3c62a35d0fcc8c93de74aa
commit 002513d21786df0d6c71e9772ec4688e2c14d8de
Author: Tim Burke <tim.burke@gmail.com>
Date: Thu Jan 7 11:56:33 2016 -0800
Make write-only container access consistent
Previously, if a user could write to (but not read from) a container,
the behavior for object POST would vary depending on whether
object\_post\_as\_copy was enabled (403 response) or disabled (202
response).
Now, POSTs will consistently be allowed, regardless of whether fast-POST
is enabled.
Change-Id: I1d6dcbc4f5034a322a1073850fc3b059ebb1c0fa
commit 9a6c6b55713f896609b7127560ae99fabbf759e7
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Thu Feb 18 17:38:42 2016 +0100
Fixed log format in object auditor
Change-Id: I218e08446c5ffda2db7c774ec8bb9d28ce9f63e7
commit 2d55960a221c9934680053873bf1355c4690bb19
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Thu Jan 14 18:31:21 2016 +0000
Fix inconsistent suffix hashes after ssync of tombstone
Consider two replicas of the same object whose ondisk files
have diverged due to failures:
A has t2.ts
B has t1.data, t4.meta
(The DELETE at t2 did not make it to B. The POST at t4 was
rejected by A.)
After ssync replication the two ondisk file sets will not be
consistent:
A has t2.ts (ssync cannot POST t4.meta to this node)
B has t2.ts, t4.meta (ssync should not delete t4.meta,
there may be a t3.data somewhere)
Consequenty the two nodes will report different hashes for the
object's suffix, and replication will repeat, always with the
inconsistent outcome. This scenario is reproduced by the probe
test added in this patch.
(Note that rsync replication does result in (t2.ts, t4.meta)
on both nodes.)
The solution is to change the way that suffix hashes are
calculated. Currently the names of \*all\* files found in each
object dir are added to the hash. With this patch the
timestamps of only those files that could be used to
construct a valid diskfile are added to the hash. File
extensions are appended to the timestamp so that in most
'normal' situations the result of the hashing is the same
as before this patch. That avoids a storm of hash mismatches
when this patch is deployed in an existing cluster.
In the problem case described above, t4.meta is no longer
added to the hash, since it is not useful for constructing
a diskfile. (Note that t4.meta is not deleted because it
may become useful should a t3.data be replicated in future).
Closes-Bug: 1534276
Change-Id: I99e88b8d5f5d9bc22b42112a99634ba942415e05
commit ddeb0cde9fc828fa79dce90df4975f66737ba054
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Wed Feb 17 21:17:34 2016 -0800
Fix object-server to handle newer ts file
Swift object-server will return 409 Conflict when the incomming
request X-Timestamp is older than the local disk file to prevent
wasted data transfer and disk space consumption. However, IFF,
the local disk file is a tombstone, current object-server will
write the data in the device and cleanup it according to timestamp
comparison result in hash\_cleanup\_list\_dir, and then return 201
Created. That's wasted and far from the semantics in the normal case.
This patch fixes object-server to catch the DiskFileDeleted exception
at PUT request, and then, set the timestamp from tombstone as
original\_timestamp to be able to compare with request timestamp.
Co-Authored-By: Kazuhiro Miyahara <miyahara.kazuhiro@lab.ntt.co.jp>
Change-Id: I078c9cb90707a3c320708e76ea42cbfa73e1ea4b
Closes-Bug: #1546865
commit 878688cae00576ec0bdb0a66eca7ada95e661c0a
Author: Béla Vancsics <vancsics@inf.u-szeged.hu>
Date: Mon Dec 7 17:02:40 2015 +0100
Reduce code duplication
Reduced source code by extracting duplicated code
(swift/common/direct\_client.py)
http://openqa.sed.hu/dashboard/index/5?did=1
Change-Id: I47fa6ae12c646e8e42fb0a46a017971f05d883fc
Closes-Bug: 1536067
commit c3201f256cf415988a3cb1c42e9c6b7835195fa3
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Fri Jan 8 18:03:33 2016 +0900
Remove execute permissions from doc files and swift.conf-sample
Some doc files and swift.conf-sample were added execute permissions in past changes.
This patch remove execute permissions from them.
Change-Id: Id8844989a8321578e9207566ebd6660f5b9523f0
commit e46d6b17251ab538595b1deb5581360a286b8fd1
Author: Christian Schwede <cschwede@redhat.com>
Date: Wed Feb 17 20:47:26 2016 +0100
Add note on using printable chars for swift\_hash\_path\_suffix/prefix
Using unprintable characters for swift\_hash\_path\_prefix/suffix might lead to
hard problems when parsing of these values changes, for example due to newer
Python versions or changes in the parsers itself. Let's avoid this and add a
note that deployers should use printable strings for these values.
Change-Id: I976982b753b6af831ab91d7190f50f8f15bf73bf
commit b8fa48080812ab0f6bac7ae19c0290da08f6a6e4
Author: Donagh McCabe <donagh.mccabe@hp.com>
Date: Thu Feb 4 16:19:13 2016 +0000
Added links to API reference and usage guides
Added a link to the API reference (where headers and query
strings are documented; click the "detail" button to see).
Also added a reference to Swift section of the OpenStack end
user guide. This contains some additional details about the API.
No attempt was made to reconcile duplicate information. Instead
this patch links documents that might otherwise be overlooked.
However, I fixed text, originally in a table, that had become
garbled in a prior patch.
Change-Id: I0910cbeb0c8bffc00e510f35585603e7b7a67790
commit aa7204d106ae33eba9219514f31f008510c9db53
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Fri Feb 12 20:48:34 2016 +0900
Remove '#! /usr/bin/env python' from unexecutable files
'cli/recon.py' and 'cli/ring\_builder\_analyzer.py' have '#! /usr/bin/env
python' in spite of they don't have execute permissions. This patch
removes '#! /usr/bin/env python' from them.
Change-Id: I1917ccc84b1673af3d862be1796f54595f94c5ca
commit db87a5a9889d436f2e2aacdc8923d55ca0d3d1ca
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Feb 16 10:52:01 2016 -0800
Mock sleep in direct\_client retry tests
... and fixup some assertions, and other mocks
Change-Id: Iadf839d1d3d735109fed24049fc3d829776b7b65
commit 8eb30afd7c39f6e6ba031f72c6a61f45b28d37f6
Author: Tim Burke <tim.burke@gmail.com>
Date: Tue Feb 16 10:25:39 2016 -0800
Static methods should be @staticmethods
Change-Id: Ifee5d68e00bbb3571aaac885cdd7490c79732985
commit 4a44e27e00795c5f12176ef346cd2249fca54fd8
Author: Chaozhe.Chen <chaozhe.chen@easystack.cn>
Date: Tue Feb 16 23:44:27 2016 +0800
Replace assertEqual(None, \*) with assertIsNone in tests
As swift no longer supports Python 2.6, replace assertEqual(None, \*)
with assertIsNone in tests to have more clear messages in case of
failure.
Change-Id: I94af3e8156ef40465d4f7a2cb79fb99fc7bbda56
Closes-Bug: #1280522
commit 42f4b3fc1e69a046c1e70e73afe847e4423fa2da
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Feb 16 10:08:55 2016 +0000
Add SwiftHLM to associated projects
Change-Id: I5ea3de34e61f22abec803b35fec8adde18a793e9
commit 025ebf2901d5a972796b73538bb306847d7d06b6
Author: Ankur Gupta <ankur.gupta@intel.com>
Date: Wed Feb 10 14:36:16 2016 -0600
Docstring omission in class BaseDiskFileManager.
Added documentation for missing Docstring variables.
Change-Id: I29a53b8141c5607815f234a6123e2289200bca34
commit 4906b4c431edc436f165b163a228b0a221950c79
Author: Janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jan 12 12:50:43 2016 +0530
Fix missing txn\_id logs in GreenAsyncPile's spawned functions
This commit ensures that the logger thread\_locals
value is passed to and set in \_get\_conn\_response methods
executed in a green thread.
Added partial bug tag because in bug description a more
relevant fix is suggested which would fix the bug completely
but for now this makes sense to add this commit for logging.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I13bbf174fdca89318d69bb0674ed23dc9ec25b9a
Partial-Bug: #1409302
commit 511a1b8698889c430bf673ed916ae41a96b99c5c
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Fri Feb 12 19:01:59 2016 +0900
Remove execute permission from swift/cli/ringbuilder.py
In Change-Id: Ia63f59a8faca1fad990784f27532ca07a2125454,
'bin/swift-ring-builder' is renamed to 'swift/cli/ringbuilder.py'.
However, execute permission and '#! /usr/bin/env python' are left on
the file.
This patch removes execute permission and '#! /usr/bin/env python'
from the file.
Change-Id: I66370f825ce9ed9a40ec21f2745aa6aff22c8709
commit 973d9358d2e6e029409d1902831b4680e02952c9
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Thu Feb 11 10:20:10 2016 +0100
Bump PyECLib requirement to >= 1.2.0
This was discussed at last Swift meeting [1] and conclusion was
to require newest PyECLib version.
[1] http://eavesdrop.openstack.org/meetings/swift/2016/swift.2016-02-10-21.00.log.html#l-268
Depends-On: I0fd58f26bc0a3e7715356ff74344981f22786152
Change-Id: I54e89d99b48e00e614d2d457814c00354763c83b
commit d3dd137cad896c7f741592e88f076acab2636a3c
Author: Tomas Matlocha <tomas.matlocha@firma.seznam.cz>
Date: Tue Jan 5 12:32:50 2016 +0100
Additional info log message for drive-audit
An additional info log message was added for case of
running drive-audit without failed device unmounting.
Change-Id: I11abee40a712b6c6de65e63626b6f7f0a9c9f4c7
commit c4158bd674f34c8a0648c98974ba474fcd1c2b7a
Author: Sarafraj Singh <Sarafraj.Singh@intel.com>
Date: Thu Feb 11 20:52:47 2016 +0000
Fixed params on autocreate\_account docstring
... in proxy.controllers.base
Change-Id: Ic5c27cbf0f19b65fcaa3e6587583f03e56d646a0
commit f56d18e143d0a38584e4c383ea9afe46e67a0af6
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Feb 11 10:59:43 2016 -0800
Fix typos in comments
Change-Id: I4f98d447bd2ddd8eeb2f4da66d069bd7d6f00dc6
commit cc8dc88b55b44ca2a1fd65c049f3cfec22eb5525
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Thu Feb 4 16:02:42 2016 +0100
Script for checking sanity of manpages
Change-Id: Ia27b0ecf6a3267eb51f8a6562721dca72f128915
commit bcada66b9065c94cd39498a5330c727cc575a6fe
Author: root <lr699s@att.com>
Date: Wed Feb 10 09:21:53 2016 -0600
Removed unused parameter in server.py
The variable max\_large\_object\_get\_time is no longer used and was
removed to reflect the change.
Change-Id: I43051181dcb38245de6d13fab63876e83f46fc39
Closes-Bug: #1538834
commit b5311f63dbf5787bda3495a58c8ef7a6a557daa4
Author: gh159m <gh159m@att.com>
Date: Wed Feb 10 10:36:59 2016 -0600
Removed default value for log\_statsd\_host
Multiple files and documents showed that log\_statsd\_host had
a default value, usually localhost. This was incorrect, instead
setting a value for log\_statsd\_host enables statsd logging.
Removed any reference of log\_statsd\_host having a default value.
Also changed descriptions to show setting a value enables logging.
Change-Id: I3ca5c0e8b8e4981de3aa6db0c476072b5a59723d
Closes-Bug: #1542227
commit b98c1c60f9c581c76677c19baae60ae720e3c7f3
Author: Christian Berendt <berendt@b1-systems.de>
Date: Tue Feb 9 07:32:48 2016 +0100
Remove executable flag from sample config file
swift.conf-sample should not be executbale
Change-Id: I960058e2af10b43efc6324a7534d9a23c810e39a
commit 81a4355c2d0907035805c300a9fa5aaa6d0e70c4
Author: Christopher Bartz <bartz@dkrz.de>
Date: Fri Feb 5 09:51:11 2016 +0100
Adds storage policy option to recon
With this patch, recon gets policy-aware in regard to the hosts to retrieve.
If no policy is passed and the server\_type is object,
all hosts of all policies are retrieved.
Previously, recon did only retrieve the hosts of the storage-policy 0.
Change-Id: If5735cd6721eac504aed8aaf3884cb91b6a0fcac
Closes-Bug: 1541491
commit 87fc21c7cfcce2a3e23a84fddcfd1309cd884716
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Mon Feb 8 15:31:42 2016 +0000
Speed up functional testing
test/functional/tests.py:TestObjectVersioningUTF8 does not clean
up the versions files it creates because the class's multiple
inheritance is such that it does not call the tearDown method in
TestObjectVersioning.
As a result, any attempt to clean up account containers wastes
time retrying container delete requests. This occurs either in
the setUp for TestSloEnv, if the TestSlo class is included in a
test run, or in the tests.py package tearDown method.
On the author's dev machine this patch reduces the execution
time of functional tests in tests.py by approx 30% or 1 minute.
Change-Id: I8194672bf2ca82435df5868720b6a55a79b94413
commit 3b94bd45406f9d457d37caa10c856a19c4cec22a
Author: Mingyu Li <li.mingyu@99cloud.net>
Date: Sun Feb 7 21:41:08 2016 +0800
Keep the Usage of exit()/sys.exit() Consistent
It's better to keep the usage of exit()/sys.exit() consistent
in one file. Furthermore, sys.exit() is considered good to be
used in production code, while exit is for interactive shell.
Change-Id: Ia3092853a648922588e2bc11db37d6decdec1b48
commit f05da4c8fa37a285bb2ca9b45a355dbe57f7add4
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Feb 6 16:59:57 2016 +0530
Changing the base version to python2.7 for pep8 checks
tox was taking python3 as it's base version which lead to
tox pep8 check failing on local env:
http://paste.openstack.org/show/486183/
Change-Id: Ia822ec5b5e12a1fc30b676f1e6d95e287b9b3368
commit 13edc9a865cd203ddf28a3f782426a1b3b94f7a1
Author: Sarafraj Singh <Sarafraj.Singh@intel.com>
Date: Fri Feb 5 17:28:26 2016 +0000
Improved test coverage of form\_signature
Added four new test cases to execute path of invalid arguments. This
improved test coverage of file specified from 80% to 91%.
Change-Id: I63c2e7bab3f01121301d78b687687208a58401c0
commit b173995666b026def3f6558d9a8c972b75449323
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Thu Feb 4 05:18:42 2016 -0800
Fix missing Accept-Ranges
Since commit 4f2ed8bcd0468f3b69d5fded274d8d6b02ac3d10, the response
header for GET EC object doesn't include the Accept-Ranges header.
This patch fixes it and also adds a few unittests to prevent regression.
Closes-Bug: #1542168
Change-Id: Ibafe56ac87b14bc0028953e620a653cd68dd3f84
commit d78e861d850db96989f4fb77ad31e3170034f15d
Author: Richard Hawkins <richard.hawkins@rackspace.com>
Date: Wed Jan 13 13:15:07 2016 -0600
Add option for label to static web listings
By default listings are rendered with a label of:
"Listing of /v1/account/container/path"
This change adds a new custom metadata key/value pair
"X-Container-Meta-Web-Listings-Label: <label>" that
when set, will cause the following:
"Listing of <label>/path" to be rendered instead.
Change-Id: I47c5d21834f47e566b380920196926882ff83abf
commit ae632abbd802228ef98a23c98ee49988e7e5b942
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Feb 2 21:58:52 2016 +0100
Fixed manpages errors.
account-server.conf.5
105: warning: numeric expression expected (got `)')
container-server.conf.5
111: warning: numeric expression expected (got `)')
object-expirer.conf.5
79: warning: numeric expression expected (got `)')
object-server.conf.5
114: warning: numeric expression expected (got `)')
proxy-server.conf.5
121: warning: numeric expression expected (got `)')
331: warning: numeric expression expected (got `[')
1005: warning: macro `\*' not defined
Change-Id: I203dcfde83035e3b1dcb91109b72b5d08bb7840e
commit f2fca9aafa17e45b668c6f76b256927681cc463a
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Tue Feb 2 11:43:44 2016 +0000
Fix time-shifting of objects PUT with container-sync
When container-sync PUTs an object to a destination container
it uses the timestamp from the container row rather than the
actual timestamp of the object being copied. The actual timestamp
of the object can be newer, so the sync'd object may end up with
the right content but at the wrong, older, timestamp.
This patch changes the timestamp sent with the sync'd object
to be that of the actual source object being sent.
Drive-by fix to make code more readable by removing a variable
rename mid-function, fix a typo and remove a redundant function
call.
Change-Id: I800e6de4cdeea289864414980a96f5929281da04
Closes-Bug: #1540884
commit 050e3b35dd88f7b31b6810d9ac88548ef371e3ce
Author: venkatamahesh <venkatamaheshkotha@gmail.com>
Date: Thu Feb 4 16:47:15 2016 +0530
Use uppercase 'S' in word "OpenStack"
Change-Id: I4692aa58b5173b1b662d5eee19fac770ae5aaed0
commit e47aaaacf15e8f0c7226400541a97238447a7f56
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Feb 3 12:52:29 2016 -0800
Stop nesting functions unnecessarily
Change-Id: Iff120d0bac8a075c37bbddcd2bb0fe85145f1749
commit 26327e1e8b1d37faa764ec586f5bee0e1560eea2
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu Jan 21 11:18:18 2016 -0800
Allow IPv6 addresses/hostnames in StatsD target
The log\_statsd\_host value can now be an IPv6 address or a hostname
which only resolves to an IPv6 address. In both cases, the new
behavior is to use an AF\_INET6 socket on which .sendto() is called
with the originally-configured hostname (or IP). This means the
Swift process is not caching a DNS resolution for the lifetime of
the process (a good thing).
If a hostname resolves to both an IPv6 or IPv4 address, an AF\_INET
socket is used (i.e. only the IPv4 address will receive the UDP
packet).
The old behavior is preserved: any invalid IP address literals and
failures in DNS resolution or actual StatsD packet sending do not
halt the process or bubble up; they are caught, logged, and
otherwise ignored.
Change-Id: Ibddddcf140e2e69b08edf3feed3e9a5fa17307cf
commit 2f8e6040470948cf17c5fc5fddd0991a415d2a4c
Author: Eran Rom <eranr@il.ibm.com>
Date: Wed Feb 3 08:59:53 2016 +0200
Fixing typo in unit test
The typo does not influence the correctness of the test
yet its ugly. bhhha.
Change-Id: I62e511bae23523892b87309dd3c50aea61742f2d
commit f27ad34e1d4e5dc306eed3ff620a294a4c301f31
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Feb 2 11:44:39 2016 -0800
Document use-case for slow option
Change-Id: Iec4087a896a2277179e3720d802cca101fa7ad54
commit 16976a0f14ee2b5f7abc76086f9abfb9f337a655
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Jan 31 10:30:06 2016 +0100
Changed EC backend from jerasure to liberasurecode in examples and docs
liberasurecode\_rs\_vand is build-in liberasurecode, so you don't need
another depedency libjerasure2.
liberasurecode\_rs\_vand is supported by pyeclib from 1.0.8
version, so bumping version up.
Closes-Bug: #1534325
Change-Id: If2d96875694df8fd48c5278395859aaa165cb566
commit 30d74af6534b754e6ad9bfdcbff4ec494277ca83
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 27 13:50:57 2016 +0000
Insert versioned\_writes in correct pipeline position
If not explicitly configured the versioned\_writes middleware
should be auto-inserted in the pipeline after slo and dlo, which
is where the versioned\_writes filter section's comments say it
should be in proxy-server.conf-sample. At the moment it can end up
being placed ahead of slo and dlo if they have been explicitly
configured, which results in the linked bug manifesting.
Closes-Bug: #1537042
Change-Id: I6ac95a331f4ef0d4887311940acc6f8bc00fb4eb
commit ccdf4a9f309af5fe1401a6e4b776b08c3f6a655c
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Feb 2 09:38:55 2016 +0100
Document slow option in etc/object-server.conf
Change-Id: Ic9940b0b830a468887878f7b0d7ca42c2cbbebd5
commit b19dc1ddecdc68760ca2f5a2b7b4bbdce2199b35
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Feb 1 15:30:59 2016 -0800
Always fix devices with multiple part-replica assignments
I've found that given a sufficiently bad replica2part2dev table we can
accidently not entirely fix palcement when more than two replicas of a
part are assigned to the duplicate devices.
It shows up most on > 3 replica rings when you have two \*different\*
devices both holding two replicas. But you can see it on a three
replica ring when all three replicas are assigned to the same device.
Change-Id: Ieb213c1a259815a2ed657291242919cda568c7b5
commit c722fa1ab318b233fc11f8e1bd8758dbe33e87bb
Author: dangming <dangming@unitedstack.com>
Date: Mon Feb 1 16:13:54 2016 +0800
Fix spelling error
Change-Id: I4a1400c4d383acd59727ada3661a8dffc67825fb
commit c7e5e125003de1a0f288f79783e9a41650e6f686
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Jan 29 14:22:19 2016 +0000
Enable in-process func tests to optionally use fast-post
Running functional tests in the in-process mode uses
the default value for proxy-server object\_post\_as\_copy,
which is True. This patch adds support for an environment
variable to change this value to False so that the fast-post
mode is tested when running in-process functional tests.
The patch also adds a new tox environment func-in-process-fast-post
which forces in-process functional testing with
object\_post\_as\_copy=False.
The motivation for this change, apart from enabling configurable
local testing, is to put support in place for an upstream CI job
that will actually functionally test the fast-post mode, which is
otherwise only covered by unit tests.
There are currently two gate jobs that run the functional tests:
- gate-swift-dsvm-functional runs the tests \*twice\* against a
devstack swift service, once using tempauth and once using
keystoneauth. The devstack swift service uses the default
object\_post\_as\_copy=True.
- gate-swift-tox-func runs the func tests in in-process mode
which also uses tempauth and object\_post\_as\_copy=True. This
duplicates one of the config scenarios above.
With this change either the gate-swift-tox-func job or a new job
could run the functional tests using object\_post\_as\_copy=False.
Change-Id: Ia37f6df1dc38e44ef7404fbf0a52f6fc22fae0c2
commit 4ba290bac19b1b6e8f709848fd35cda33b8bd1c4
Author: Qiaowei Ren <qiaowei.ren@intel.com>
Date: Mon Feb 1 16:44:52 2016 +0800
Replace exit() by sys.exit()
sys.exit() is considered good to use here.
Change-Id: I365b0dbb50c8f1953b41665ba49145ac6db1b24f
commit 9aff76bd18e609eb657db14f2d60e605ee28d472
Author: Qiaowei Ren <qiaowei.ren@intel.com>
Date: Mon Feb 1 17:15:32 2016 +0800
fix typo
informations -> information
Change-Id: I6bcb9bb9fd24b873b49de4a686b223550dd703ac
commit a8e0dc550bf35010595ce791433cd68c4b8d5287
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Sun Jan 31 06:15:17 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: If1cd20e187720f5ee02c6a1574f612c8a8e26e30
commit 02c06585e6e0403d1a983fccaba5093e3d3fa7c5
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Fri Jan 29 22:46:50 2016 +0100
Renamed variable for better code readability
Change-Id: I22d8db0dd9edc39672fc9997895a24f669975e15
commit 595ec464e3fdc5a766eee9baa06edd074576c73e
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Fri Jan 29 15:28:56 2016 +0000
Trivial fix for sphinx warnings
Including a \* in the param name causes a sphinx warning,
messes up the html formatting, and strictly the \* isn't part of
the param name.
Change-Id: I6be6a7aa2a371eaae9f8e501435838c1e15f4a1c
commit cc90834a8ed7bd84440bf132a94978a47ee2f3da
Author: Mingyu Li <li.mingyu@99cloud.net>
Date: Fri Jan 29 03:48:47 2016 +0900
A minor modification of the Deployment Guide
In the section of General Service Tuning, there is a sentence
"Our Storage servers all run together on the same servers".
The word "servers" is used twice with different meanings, which
would be a little confusing. This patch makes it more understandable.
Change-Id: I6d806456aeb7d0ecf297c04dacbd271b94a0425c
Closes-Bug: #1526697
commit a1776b9c1f23fbd604114b377434e4269d2f1a2e
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Thu Jan 28 16:47:37 2016 +0000
Let equal Timestamps not be unequal
Make the result of Timestamp(x) != Timestamp(x) be False.
In python 2.7 this requires the \_\_ne\_\_ method to be defined [1].
"The truth of x==y does not imply that x!=y is false." The
functools.total\_ordering decorator does not autocreate a \_\_ne\_\_
method.
In python 3 the \_\_ne\_\_ method is not required [2]. "By default,
\_\_ne\_\_() delegates to \_\_eq\_\_() and inverts the result".
This patch puts back the \_\_ne\_\_ method removed in [3]. Whilst no tests
fail on master with python2.7, they do on this patch [4] and it seems
dangerous to have this absurd behaviour lurking.
[1] https://docs.python.org/2/reference/datamodel.html#object.\_\_ne\_\_
[2] https://docs.python.org/3.4/reference/datamodel.html#object.\_\_ne\_\_
[3] Change-Id: Id26777ac2c780316ff10ef7d954c48cc1fd480b5
[4] Change-Id: Ia597cd460bb5fd40aa92e886e3e18a7542603d01
Change-Id: I01fbfa310df3c74390f8e8c2e9ffff81bbf05e47
commit c3886eea15f11104764fb201e85202dd871c3027
Author: Thomas Goirand <thomas@goirand.fr>
Date: Thu Jan 28 09:15:28 2016 +0000
Fix a few English mistakes in man
These errors are producing lintian warnings, so fixing them
helps having less errors when checking for Debian packages.
Change-Id: Iff99a8d5f2276515f42d758d110a43cae757db28
commit 400cc707273bab0b70a3cdf5dec1c55c2edc4e22
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 27 15:35:40 2016 +0000
Remove a print statement from tests
Change-Id: I213b7e4bc4f9e6de76ebab572c377af61072d9c5
commit c871e423ef0bed6c774693af3d54750235d6ce1f
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Jan 22 05:19:06 2016 +0000
Add unit tests for checking responses in AccountController
This patch provides unit tests to check responses for various situation
in three/four replicas env.
Change-Id: I1af48728b28da9780a2a78f3110e1c7487047ff8
commit e45d30d6b7b596b80c63e75018ad07582d705ee1
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 27 10:18:37 2016 +0000
Remove unnecessary code from test\_account.py
Change-Id: Ia197ba08a606421244d5b94a900bdc39bc5da647
commit f39cffbb5f7f1853f7f67261c4652b9875d302be
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Jan 26 20:16:08 2016 -0800
Follow up mem\_server diskfile fixes
This is a follow-up patch for change
https://review.openstack.org/#/c/270422
That patch fixes POST behavior on object mem server and adds
some tests for last-modified. However, that one doesn't check
the POST updates the last-modified on object server.
This patch adds assertions to make sure the actual POST semantics.
\*bonus\* Add docs and cleanup variable name to fit actual instance
at mem diskfile.
Change-Id: I78185cdfb0ea604b2122821870ec34322236f48d
commit 9ef15453fadb847db0f0fb92e935785b544da3fc
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Thu Jan 21 14:18:31 2016 +0900
Fix handling of "Permission Denied" error from NamedTemporaryFile function
If "Permission Denied" has happen in NamedTemporaryFile function in
dump\_recon\_cache method, swift will log a message of reference to a variable
without assignment and not log a message of "Permission Denied".
This patch fixes the handling and add an unit test.
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Iafdd94905e9e9c81f5966a923324b50c18fcf592
commit 01410129dac6903ce7f486997a48e36072fa0401
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Aug 21 18:15:25 2015 -0700
Make handoffs\_first a more useful "mode"
Based on experience using handoffs\_first and feedback from other
operators it has become clear that handoffs\_first is only used during
periods of problematic cluster behavior (e.g. full disks) when
replication attempts are failing to quickly drain off the partitions
from the nodes which they have been rebalanced from.
In order to focus on the most important work (getting handoff partitions
off the node) handoffs\_first mode will abort the current replication
sweep before attempting any primary suffix syncing if any of the handoff
partitions were not removed for any reason - and start over with
replication of handoffs jobs as the highest priority.
Note that handoffs\_first being enabled will emit a warning on start up,
even if no handoff jobs fail, because of the negative impact it can have
during normal operations by dog piling on a node that was temporarily
unavailable.
Change-Id: Ia324728d42c606e2f9e7d29b4ab5fcbff6e47aea
commit 78cfb137d5d3d6f4770923a1fb086adaa9c0676f
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Nov 11 19:05:09 2015 -0800
Ring Overview updates
Change-Id: Ic5a8ec5be9fec7fa812fdb7b91890d5fc2fbf967
commit 24227e8bb0d4d369eeab61ab5c20730b4f84b36a
Author: Richard Hawkins <richard.hawkins@rackspace.com>
Date: Wed Jan 13 10:16:29 2016 -0600
\_get\_info\_cache should encode unicode metadata
Closes-Bug: 1533768
Change-Id: I67bbd0e8802d2a34cb3a0b0fafe26bbc62221032
commit fc9a3852e44b2bf1258fcb24a6c12ecfb2795f44
Author: Tim Burke <tim.burke@gmail.com>
Date: Mon Jan 25 09:25:20 2016 -0800
Don't .lower() a literal
It feels silly, and we don't do it for any of the other headers in
headers\_to\_container\_info.
While we're at it, clean up a stray '
Change-Id: I0745038cc3832a77d064e515c37cacbdcb97c4d9
Related-Change: Iea3d06de80210e9e504e296d4572583d7ffabeac
commit 5c6576d1eb3c4c042bb46dd48f23d2fd474eba07
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Mon Jan 25 18:20:45 2016 +0100
Fixed docs: Title underline too short
Change-Id: If96b0e799a4671e7b7f3f5bea2628db75afa9578
commit 9c403d5e1bb1f404445f1731e3ff1b5c034336a6
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:31:12 2015 +0200
Port swift.common.utils.Timestamp to Python 3
\* Fix Timestamp.isoformat(): on Python 3, round manually to use the
same rounding method than Python 2.
\* Use @functoos.total\_ordering on Timestamp instead of the \_\_cmp\_\_()
special method. On Python 3, the \_\_cmp\_\_() method is no more used,
and other special methods must be defined (\_\_eq\_\_, \_\_lt\_\_, etc.).
Only define \_\_eq\_\_() and \_\_lt\_\_() methods but use
@functools.total\_ordering to generate other methods.
\* Fix also a Python 3 issues in swift.common.swob.\_datetime\_property:
replace (float, int, long) with (float,) + six.integer\_types. The
long type was renamed to int in Python 3.
Change-Id: Id26777ac2c780316ff10ef7d954c48cc1fd480b5
commit c790db89369221473bcbfc23f301424ab8d30d60
Author: Andrew Welleck <awellec@us.ibm.com>
Date: Mon Jan 25 10:03:18 2016 -0600
Additional step for Debugging Issues in SAIO
Adding an additional debugging step for the SAIO "Debugging Issues"
section. Adding step to check if memcache is running and to start
it if its not.
Change-Id: I0bfa563f595dbefcf907494451fad45e6310db88
commit d47155af262d52c284f262bf6c303d0587000bba
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 17:22:24 2015 +0200
Add \_\_next\_\_() methods to utils iterators for py3
On Python 3, next(obj) calls obj.\_\_next\_\_(), not obj.next(). Add an
alias from \_\_next\_\_() to next() to be compatible with Python 2 and
Python 3.
Change-Id: Ida104d3bd7cdba557e523f18df43d56847060054
commit 0f8319dceb2d21a9d1ec74f78203b033f25c0969
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri Jan 22 13:31:34 2016 -0800
Use calendar.timegm not time.mktime
time.mktime produces a POSIX timestamp that takes into account the local
timezone, but we're parsing a Last-Modified header with a known (GMT)
timezone. As a result, if one proxy-server is configured with a timezone
other than GMT/UTC, we may have previous versions in the wrong order.
Change-Id: I320e2368b243f4245725e73bfabc7ad19bc5bacb
commit 72d972166ff66d3c5313356c1e1e3984fee9f012
Author: paul luse <paul.e.luse@intel.com>
Date: Thu Jan 21 13:30:15 2016 -0700
Update AUTHORS
+Luse core emeritus
Change-Id: Ie175f410ddc24a2d5e64bc191364418a3c450f3f
commit 2f8105e5fcf4ecee2202797ba1ab48fa8fb1a1f6
Author: Alistair Coles <alistair.coles@hpe.com>
Date: Wed Jan 20 18:14:16 2016 +0000
Fix bug in mem\_diskfile write\_metadata method
The mem\_diskfile DiskFile.write\_metadata method was
apparently never called in any existing test, as if it
were it would blow up as reported in the bug.
This patch fixes the method and adds a test that
exercises it. The test addition itself should be useful
since it verifies the behaviour of Last-Modified after
POSTs to an object.
Drive-by fixes for bad docstring and undefined references
in the \_quarantine method.
Change-Id: I17fd62e5f02be5b48bfd9ba7fa25315e30a0a4bf
Closes-Bug: #1536037
commit e13a03c379273ee10e678818078b9c40a96a7dc9
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Jan 20 16:06:26 2016 -0800
Stop overriding builtin range
Change-Id: I315f8b554bb9e96659b455f4158f074961bd6498
commit 0a404def7d54d1ef1c85c11a378052260c4fda4c
Author: John Dickinson <me@not.mn>
Date: Wed Jan 20 15:19:35 2016 -0800
remove unneeded duplicate dict keys
Change-Id: I926d7aaa9df093418aaae54fe26e8f7bc8210645
commit 221f94fdd39fd2dcd9a2e5565adceab615d55913
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 14:50:24 2016 -0800
authors and changelog updates for 2.6.0
Change-Id: Idd0ff9e70abc0773be183c37cd6125fe852da7c0
commit 58359269b0e971e52f0eb7f97221566ca2148014
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Dec 8 16:36:05 2015 -0800
Fix memory/socket leak in proxy on truncated SLO/DLO GET
When a client disconnected while consuming an SLO or DLO GET response,
the proxy would leak a socket. This could be observed via strace as a
socket that had shutdown() called on it, but was never closed. It
could also be observed by counting entries in /proc/<pid>/fd, where
<pid> is the pid of a proxy server worker process.
This is due to a memory leak in SegmentedIterable. A SegmentedIterable
has an 'app\_iter' attribute, which is a generator. That generator
references 'self' (the SegmentedIterable object). This creates a
cyclic reference: the generator refers to the SegmentedIterable, and
the SegmentedIterable refers to the generator.
Python can normally handle cyclic garbage; reference counting won't
reclaim it, but the garbage collector will. However, objects with
finalizers will stop the garbage collector from collecting them\* and
the cycle of which they are part.
For most objects, "has finalizer" is synonymous with "has a \_\_del\_\_
method". However, a generator has a finalizer once it's started
running and before it finishes: basically, while it has stack frames
associated with it\*\*.
When a client disconnects mid-stream, we get a memory leak. We have
our SegmentedIterable object (call it "si"), and its associated
generator. si.app\_iter is the generator, and the generator closes over
si, so we have a cycle; and the generator has started but not yet
finished, so the generator needs finalization; hence, the garbage
collector won't ever clean it up.
The socket leak comes in because the generator \*also\* refers to the
request's WSGI environment, which contains wsgi.input, which
ultimately refers to a \_socket object from the standard
library. Python's \_socket objects only close their underlying file
descriptor when their reference counts fall to 0\*\*\*.
This commit makes SegmentedIterable.close() call
self.app\_iter.close(), thereby unwinding its generator's stack and
making it eligible for garbage collection.
\* in Python < 3.4, at least. See PEP 442.
\*\* see PyGen\_NeedsFinalizing() in Objects/genobject.c and also
has\_finalizer() in Modules/gcmodule.c in Python.
\*\*\* see sock\_dealloc() in Modules/socketmodule.c in Python. See
sock\_close() in the same file for the other half of the sad story.
This closes CVE-2016-0738.
Closes-Bug: 1493303
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ib86c4c45641485ce1034212bf6f53bb84f02f612
commit d9b22ac51cca579e97ec7bd5a6df3ad7bf56c3bf
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:45:33 2015 +0200
Port parse\_mime\_headers() to Python 3
Port swift.common.utils.parse\_mime\_headers() to Python 3:
\* On Python 3, tries to decode headers from UTF-8. If an header was
was not encoded to UTF-8, decode the header from Latin1.
\* Update the parse\_mime\_headers() tests: on Python 3, HTTP header
values are Unicode strings.
This change is a follow-up of the change
Ia5ee2ead67e36e8c6416183667f64ae255887736.
Change-Id: I042dd13e9eb0e9844ccd832d538cdac84359ed42
commit cec2aa0b4dbf0e1bf2de62945f5abdf494925a8e
Author: Victor Stinner <vstinner@redhat.com>
Date: Fri Oct 9 17:56:39 2015 +0200
py3: Use the six module in the xprofile middleware
\* Replace bytes\_() with a isinstance(content, six.text\_type)
and content.encode('utf-8')
\* Get parse\_qs() from six.moves.urllib.parse
Change-Id: I4a506975814bff098ade25c950c154e50dc9626e
commit bc4b298b6e208d3188641712c9d66ae82d172c14
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 19 15:33:13 2016 -0800
Fix a comment's indentation
Change-Id: I34514525b606cf82767ddce7769bc42fa5457717
commit 6c32da14f48b435aa4e5efea48904bd288a532a2
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon Oct 19 16:38:24 2015 +0200
Port FileLikeIter to Python 3
Port FileLikeIter and \_MultipartMimeFileLikeObject and
swift.common.utils to Python 3:
\* Add a \_\_next\_\_() alias to the next() method. On Python 3, the
next() method is no more used, \_\_next\_\_() is required.
\* Use literal byte strings: FileLikeIter \_MultipartMimeFileLikeObject
are written to handle binary files.
\* test\_close(): replace .FileLikeIter('abcdef') with
FileLikeIter([b'a', b'b', b'c']). On Python 3, list(b'abc') returns
[97, 98, 99], whereas ['a', 'b', 'c'] is returned on Python 2.
\* Update unit FileLikeIter tests to use byte strings.
Change-Id: Ibacddb70b22f624ecd83e374749578feddf8bca8
commit caa127d59a63a25cc6d08e985e536f90300a6156
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Nov 12 11:34:44 2015 -0800
Monkeypatch everything the same
There's three spots in the code where eventlet monkeypatches
things. In one place, it was monkeypatching socket and thread; in the
other two, only socket. This commit monkeypatches socket and thread
everywhere.
Hopefully, this lets us avoid code that, for example, works in the
object server but fails in the object updater.
Change-Id: Ia30d069c5ac89f4bfbe52233d03d96738144b614
commit 3a0486e532f22af0d3c8a5c5d78613c22e786ff6
Author: Sivasathurappan Radhakrishnan <siva.radhakrishnan@intel.com>
Date: Fri Dec 4 17:43:00 2015 +0000
Deleted comment about part power in FakeRing
Deleted comment about parameter part power in Class FakeRing as its
behavior got dropped in I8bfc388a04eff6491038991cdfd7686c9d961545.
Change-Id: Iec7d2565a77e48493b0056021066d8d8eab65d0b
Closes-Bug: #1488704
commit 999479f9b17b42ccc5da54ce01651960cf7cf970
Author: John Dickinson <me@not.mn>
Date: Tue Jan 19 10:30:30 2016 -0800
Bump eventlet min version to 0.17.4
IPv6 support in Swift is dependent on IPv6 support in eventlet.
eventlet itself only claims support for IPv6 post v0.17
(https://github.com/eventlet/eventlet/issues/8). This update matches
the OpenStack global requirements version.
Change-Id: I9d8433cdd3bf7d7a93b8f50b991cc21721a80d22
commit 133a3ea601a3fea84af36a42845f27b8182fd901
Author: Christopher Bartz <bartz@dkrz.de>
Date: Mon Dec 21 14:17:00 2015 +0100
Use the correct split\_path in handle\_request
Change-Id: I86d423309f0b2091ee2e82b2245caf925b6a75ef
Closes-Bug: #1528189
commit 09b188f03c4a40838ea6b3e54e0714d93077b066
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Thu Jul 16 09:35:37 2015 +0900
Add functional test for access control (RBAC) with Keystone
This patch adds test cases for PUT, DELETE, GET, HEAD, POST and OPTIONS
requests to accounts, containers and objects using various combinations
of users/projects, roles and/or service tokens.
Change-Id: Iea8141ac74ad949a3ae7fa47fda3135d0f2612f6
commit bf10974cdefffdaaebc58d21e8a9912638a0405a
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed Dec 16 15:46:13 2015 -0800
Expose token expiration time in tempauth auth response
Previously, we gave no indication of when a token would expire. Users
would have to just use it until it stopped working, then re-auth.
Now, a successful auth response will include a new header,
X-Auth-Token-Expires, with the number of seconds remaining until the
token is invalid. This allows the client to attempt to re-auth before
sending a request that will definitely fail.
For comparison, swauth already uses the X-Auth-Token-Expires header with
identical semantics. Additionally, Keystone (v2 and v3) already exposes
expiration times in its JSON responses. The security impact should be
minimal.
Change-Id: I5a4a74276bc0df6dda94e4bc150065c0d77de0eb
commit f56f29ef7a692b6c3204e25d41eace3d68dceece
Author: Peter Lisák <peter.lisak@firma.seznam.cz>
Date: Thu Dec 3 16:48:18 2015 +0100
Add info about state of ring file to default command.
Try to find ring file, load and compare it with builder file, then show result state.
Examples:
Ring file object.ring.gz not found, probably it hasn't been written yet
Ring file object.ring.gz is up-to-date
Ring file object.ring.gz is obsolete
Ring file object.ring.gz is invalid: ValueError('string length not a multiple of item size',)
Change-Id: I4d769aa5fe1c2b1167ec088aa372874f7d13ae48
commit 47e226418bad35ccad2a1525f392ba69f6165027
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Mon Jan 18 06:20:14 2016 +0000
Imported Translations from Zanata
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: Ic416c9afc8a1c76f552803a7c70fc905eda7b3cb
commit 165fa1fd40b5e4b13cf5188712593e2275bef821
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jan 15 11:44:21 2016 -0800
add test for zero weight region get\_more\_nodes
Change-Id: If537981e8deadd9c3528dcb30a15011c7781e334
commit 5d449471b12c67b31ebb5a383d9bb35bace36213
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jan 14 17:26:01 2016 -0800
Remove some Python 2.6 leftovers
Change-Id: I798d08722c90327c66759aa0bb4526851ba38d41
commit 3c0cf549f1e822cce8f905b069b317e676cf306b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jan 13 18:08:45 2016 -0800
Speed up get\_more\_nodes() when there is an empty zone
The ring has some optimizations in get\_more\_nodes() so that it can
find handoffs that span all the regions/zones/et cetera and then stop
looking. The stopping is the important part.
Previously, it would quickly find a handoff in each unused region,
then spend way too long looking for more unused regions; the same was
true for zones, IPs, and so on. Thus, in commit 9cd7c6c, we started
counting regions and zones, then stopping when we found them all.
This count included all regions and zones in the ring, regardless of
whether or not there were actually any parts assigned or not. In rings
with an empty region, i.e. a region for which there are only
zero-weight devices, get\_more\_nodes() would be very slow.
This commit ignores devices with no assigned partitions when counting
regions, zones, and so forth, thus greatly speeding things up.
The output of get\_more\_nodes() is unchanged. This is purely an
optimization.
Closes-Bug: 1534303
Change-Id: I4a5c57205e87e1205d40fd5d9458d4114e524332
commit 70047709fc9885df7019f791e17a3240682cc6cb
Author: keliang <ke.liang@easystack.cn>
Date: Fri Jan 15 00:31:51 2016 +0800
Drop python 2.6 support
Change-Id: Id6329c863dacb189fccfc304453ed7b6f9607c14
commit a4c2fe95ab2fbe59379a69914ed0fac49c28efbb
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Tue Jan 12 21:26:33 2016 +0100
Allow to change auditor sleep interval in config
Change-Id: Ic451c5e0b686509f8982ed1bf65a223a2d77b9a0
commit edc823e8030640184071fee4920d34f9a1cc6b3e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Sun Nov 29 18:46:47 2015 +0100
Show UTC time in swift-recon.
It's not consistent now for example local time in replication part and
UTC time at begging of line. Use \_ptime in swift-recon for all time
printing and this function returns UTC now.
Change-Id: I732d9851db157130a08e825e8093b7e244b63e9c
commit fa5b32d27964478dfcccf71155d2aaa946c561f0
Author: Tim Burke <tim.burke@gmail.com>
Date: Tue Jan 12 14:18:30 2016 -0800
Make object-auditor storage-policy-aware
Previously, the object-auditor would always use a (replication)
DiskFileManager when walking through AuditLocations, which would cause
it to skip EC fragment archives with a warning like:
Unexpected file <hash\_path>/1452557187.03610#3.data:
Invalid Timestamp value in filename '1452557187.03610#3.data'
Now, the AuditLocation's policy will be used to find an appropriate
manager to get the diskfile. Additionally, several .commit()s were added
to the auditor tests so the .durable will be written, which is required
when auditing EC fragment archives.
Change-Id: I960e7d696fd9ad704ca1872b4ac821f9078838c7
Closes-Bug: 1533002
commit 725a166ebd3fde2c34f2c9578ff6f9911cf206d7
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Fri Jan 8 18:42:33 2016 -0800
Make \_get\_addr() method a function in utils.
The patch moves the MemcacheConnPool.\_get\_addr() method a function in
swift.common.utils. The function is renamed to parse\_socket\_string()
and the documentation is updated accordingly. The test for it has also
been moved.
Change-Id: Ida65b2fded28d0a059e668646f5b89714298f348
commit 0647aea9c5fc95f0860758cc54bc23f965da460d
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Fri Jan 8 14:54:56 2016 -0800
Fail early if the memcache address is invalid.
In cases when the memcache address is invalid, we should fail early.
This patch addresses the cases when the IPv6 addresses are not
enclosed in "[]". It does not, however, fix the case of an invalid
hostname. These improvements could also be added to the \_get\_addr()
method.
Change-Id: I4743dcda45a1fc1640989325c4a2e1fea591fc69
commit 33476460239c9cdb08dd8065d22d84a4717da7be
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Jan 8 16:15:54 2016 -0800
fixups for ipv6 memcache\_servers docs
Change-Id: I20d91c1e276014eaf210fa9eb43788bc17f4e8df
commit d5ff5447be30b44bf4acc8b912b6241a44f710be
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Jan 12 16:42:06 2016 -0800
Install liberasurecode packages in SAIO.
Change-Id: If673afa2b61a3e388612debf4860d561960963a3
commit 4ffc4ba411f67c8407ba38d082a3a51a96ad7e04
Author: Jonathan Hinson <jlhinson@us.ibm.com>
Date: Tue Jan 12 11:46:21 2016 -0600
Functional tests for if-match with multiple etags
Multiple etags can be provided on an if-match or if-none-match
request. This is currently being tested in the unit tests, but not
in the functional tests. Since these etags can be modified by
middleware, we need functional tests to assert multiple-etag
requests are handled correctly.
Change-Id: Idc409c85e8aa82b59dc2bc28af6ca2617de82699
commit 1292361176aec385137dd5873c5cc9714de1fa17
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Jan 11 16:25:50 2016 -0800
functest for x-timestamp validation
Change-Id: I05af7d837af00cd1059a8912df05c131a52ffb90
commit e6194113a3c81563590eabf8f761ccb988bb917c
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri Jan 8 16:38:31 2016 -0800
Validate X-Timestamps
Previously, attempting to PUT a new object with an X-Timestamp header
less than or equal to zero (ie, for a timestamp on or before 1970-01-01
00:00:00) would cause the object-server to 500.
While we're at it, cap X-Timestamp at 9999999999 (2286-11-20 17:46:40)
so we don't get an eleventh digit before the decimal point.
Closes-Bug: 1532471
Change-Id: I23666ec8a067d829eaf9bfe54bd086c320b3429e
commit 1f3304c5153e01988b8f4493875b6489e93f76d0
Author: Ben Martin <blmartin@us.ibm.com>
Date: Mon Dec 14 15:28:17 2015 -0600
Print min\_part\_hours lockout time remaining
swift-ring-builder currently only displays min\_part\_hours and
not the amount of time remaining before a rebalance can occur.
This information is readily available and has been displayed
as a quality of life improvement.
Additionally, a bug where the time since the last rebalance
was always updated when rebalance was called regardless of
if any partitions were reassigned. This can lead to partitions
being unable to be reassigned as they never age according to
the time since last rebalance.
Change-Id: Ie0e2b5e25140cbac7465f31a26a4998beb3892e9
Closes-Bug: #1526017
commit 167bb5eeb82886d67c1b382417fb22b8ea85f0d3
Author: Timur Alperovich <timuralp@swiftstack.com>
Date: Wed Dec 16 12:07:27 2015 -0800
Fix IPv6 handling in MemcacheConnPool.
The patch removes the assumption of IPv4-only addresses in the
MemcacheConnPool. The changes are around address handling.
Namely, if a server is specified with an address
[<address>]:port (port is optional), it is assumed to be an IPv6
address [1]. If an IPv6 address is specified without "[]", an exception
is raised as it is impossible to parse such addresses correctly.
For testing, memcache can be configured to listen on the link-local,
unique-local, or ::1 (equivalent to 127.0.0.1) addresses. Link-local
addresses are assigned by default to each interface and are of the form
"fe80::dead:beef". These addresses require a scope ID, which would look
like "fe80::dead:beef%eth0" (replacing eth0 with the correct interface).
Unique-local addresses are any addresses in the fc00::/7 subnet. To add
a ULA to an interface use the "ip" utility. For example:
"ip -6 address add fc01::dead:beef dev eth0". Lastly, and probably
simplest, memcache can be configured to listen on "::1". The same
address would be used in the swift configuration, e.g. "[::1]:11211".
Note: only memcached version 1.4.25 or greater supports binding to an
IPv6 address.
Fixes #1526570
[1] IPv6 host literals:
https://tools.ietf.org/html/rfc3986#section-3.2.2
Change-Id: I8408143c1d47d24e70df56a08167c529825276a2
commit fb6751d8ba133c57e1ebb76be71a96f2f120b8ca
Author: Paul Dardeau <paul.dardeau@intel.com>
Date: Fri Jan 8 22:49:05 2016 +0000
Look for device holes that can be reused when adding new device.
Change-Id: I1980ebdd9dc89848173d8ca2fe2afb74029dcfa2
Closes-Bug: 1532276
commit b35f3c90bde8a7ccb50440bda5800cbb8274a5a1
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Jan 8 01:29:11 2016 -0800
Add note COPY with conditional headers
Swift now supports Range header for COPY (or PUT with X-Copy-From)
to make a partial copied object. This patch adds the note to show
it obviously supported in Swift community.
Change-Id: I6bf28f0932c90e7b305cd61aabce4ed028ae691e
Partial-Bug: #1532126
commit 23c7a58f8f1412c28b3a16b79be09c224c9f7d55
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Dec 11 18:26:34 2015 +0900
Fix ClientException handling in Container Sync
swift/container/sync.py uses swift.common.internal\_client.delete\_object
and put\_object and expected these methods raise ClientException.
But delete\_object and put\_object never raise the exception so this patch
raises ClientException when urllib2 library raises HTTPError.
Co-Authored-By: Eran Rom <eranr@il.ibm.com>
Closes-Bug: #1419901
Change-Id: I58cbf77988979a07998a46d9d81be84d29b0d9bf
commit 6786cdf036b4faabe3928c3d0dd9615d94834801
Author: Harshada Mangesh Kakad <harshadak@metsi.co.uk>
Date: Thu Dec 31 01:44:00 2015 -0800
Fixing the deprecated library function.
os.popen() is deprecated since version 2.6. Resolved with use of
subprocess module.
Change-Id: I4409cdd9edbc1a26d6f99c125c9100fadda5d758
Partial-Bug: #1529836
commit 85a0a6a28e166bc076cf8786de2b46248d8786a2
Author: Eran Rom <eranr@il.ibm.com>
Date: Sun Jul 26 13:31:17 2015 +0300
Container-Sync to iterate only over synced containers
This change introduces a sync\_store which holds only containers that
are enabled for sync. The store is implemented using a directory
structure that resembles that of the containers directory, but has
entries only for containers enabled for sync.
The store is maintained in two ways:
1. Preemptively by the container server when processing
PUT/POST/DELETE operations targeted at containers with
x-container-sync-key / x-container-sync-to
2. In the background using the containers replicator
whenever it processes a container set up for sync
The change updates [1]
[1] http://docs.openstack.org/developer/swift/overview\_container\_sync.html
Change-Id: I9ae4d4c7ff6336611df4122b7c753cc4fa46c0ff
Closes-Bug: #1476623
commit e75888b281d59df0889f28d0b32241dac3a34aa2
Author: HugoKuo <tonytkdk@gmail.com>
Date: Wed Jan 6 14:33:23 2016 +0800
Add more description for write\_affinity\_node\_count parameter in the doc.
Change-Id: Iad410a2be4f9a2cd5c53e860b9f91993aa7f2369
Closes-Bug: #1531173
commit 3b1591f235f4b85796917507be5e7fd80365ff9e
Author: Ondřej Nový <ondrej.novy@firma.seznam.cz>
Date: Wed Sep 30 19:08:09 2015 +0200
swift-init: New option kill-after-timeout
This option send SIGKILL to daemon after kill\_wait period.
When daemon hangs and doesn't respond to SIGTERM/SIGHUP
there is no way to stop it using swift-init now. Classic
init scripts in Linux kills hanged process after grace
period and this patch add same behaviour. This is most
usefull when using "restart" on hanged daemon.
Change-Id: I8c932b673a0f51e52132df87ea2f4396f4bba9d8
commit 4691d0592ff3deeea2713195312bf1effd5a7a7b
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Fri Dec 25 14:00:16 2015 +0900
Add object replicator's succeeded and failed counts in log
account-replicator and container-replicator outputted the
following info in log.
info account-replicator: 17 successes, 4 failures
info container-replicator: 178 successes, 29 failures
But there is no output info for object-replicator. This info
is important to check replicator's status from log.
So this patch adds object-replicator's succeeded and failed
counts in log like account-replicator and container-replicator.
Change-Id: I7fbaf161540bdb06c0a65a1032aae83764bd970c
commit 9fe0e25604dff35db7eab1bca312821a81db6c1d
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Tue Dec 8 22:27:44 2015 -0800
Sleep enough for trampoline
When running unite test suite in local poor resource environment,
sometimes test/unit/proxy/test\_server.py fails due to a lack of
waiting time to trampoline of eventlet thread.
This patch enables to sleep 1 more second when it doesn't seem
to have enough time to tranpoline.
Change-Id: I0bbc8fc245919d3c0a071ff87ff6e20b8d58f9b8
commit 7f636a557296ecc6ae4727700cfcf9f82573bd16
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Nov 30 18:06:09 2015 -0800
Allow smaller segments in static large objects
The addition of range support for SLO segments (commit 25d5e68)
required the range size to be at least the SLO minimum segment size
(default 1 MiB). However, if you're doing something like assembling a
video of short clips out of a larger one, then you might not need a
full 1 MiB.
The reason for the 1 MiB restriction was to protect Swift from
resource overconsumption. It takes CPU, RAM, and internal bandwidth to
connect to an object server, so it's much cheaper to serve a 10 GiB
SLO if it has 10 MiB segments than if it has 10 B segments.
Instead of a strict limit, now we apply ratelimiting to small
segments. The threshold for "small" is configurable and defaults to 1
MiB. SLO segments may now be as small as 1 byte.
If a client makes SLOs as before, it'll still be able to download the
objects as fast as Swift can serve them. However, a SLO with a lot of
small ranges or segments will be slowed down to avoid resource
overconsumption. This is similar to how DLOs work, except that DLOs
ratelimit \*every\* segment, not just small ones.
UpgradeImpact
For operators: if your cluster has enabled ratelimiting for SLO, you
will want to set rate\_limit\_under\_size to a large number prior to
upgrade. This will preserve your existing behavior of ratelimiting all
SLO segments. 5368709123 is a good value, as that's 1 greater than the
default max object size. Alternately, hold down the 9 key until you
get bored.
If your cluster has not enabled ratelimiting for SLO (the default), no
action is needed.
Change-Id: Id1ff7742308ed816038a5c44ec548afa26612b95

| **tags**: | added: in-feature-hummingbird |
| --- | --- |

[Pratap D (pratapd)](https://launchpad.net/~pratapd)
on 2016-06-03

| Changed in swift (Ubuntu): | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pratap D (pratapd)](https://launchpad.net/~pratapd) wrote on 2016-06-03: |  |  | [#69](/cloud-archive/%2Bbug/1493303/comments/69) |
| --- | --- | --- | --- |

Changed in swift (Ubuntu):

By mistake I changed the status to "Fix released".

Status needs to be changed to "Confirmed".

Please change the status to "Confirmed".

Sorry for the trouble.

Changed in swift (Ubuntu):
By mistake I changed the status to "Fix released".
Status needs to be changed to "Confirmed".
Please change the status to "Confirmed".
Sorry for the trouble.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2016-06-03: |  |  | [#70](/cloud-archive/%2Bbug/1493303/comments/70) |
| --- | --- | --- | --- |

@james-page, it seems like you are the one who can change the "swift (ubuntu)" task status. Please put it back to "confirmed"...

@james-page, it seems like you are the one who can change the "swift (ubuntu)" task status. Please put it back to "confirmed"...

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-06-03

| Changed in swift (Ubuntu): | |
| --- | --- |
| **status**: | Fix Released → Confirmed |

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-06-10

| Changed in swift (Ubuntu Yakkety): | |
| --- | --- |
| **status**: | Confirmed → Fix Released |
| Changed in swift (Ubuntu Xenial): | |
| **status**: | New → Fix Released |
| Changed in swift (Ubuntu Wily): | |
| **status**: | New → Triaged |
| Changed in swift (Ubuntu Vivid): | |
| **status**: | New → Won't Fix |
| Changed in swift (Ubuntu Trusty): | |
| **status**: | New → Triaged |

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-06-10

| **no longer affects**: | swift (Ubuntu Vivid) |
| --- | --- |

[James Page (james-page)](https://launchpad.net/~james-page)
on 2016-09-08

| Changed in cloud-archive: | |
| --- | --- |
| **status**: | New → Invalid |
| Changed in swift (Ubuntu Wily): | |
| **status**: | Triaged → Won't Fix |
| Changed in swift (Ubuntu Trusty): | |
| **status**: | Triaged → Won't Fix |
| **status**: | Won't Fix → New |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Eduardo Barretto (ebarretto)](https://launchpad.net/~ebarretto) wrote on 2020-07-06: |  |  | [#71](/cloud-archive/%2Bbug/1493303/comments/71) |
| --- | --- | --- | --- |

This bug was fixed in the package swift - 1.13.1-0ubuntu1.5

---------------

swift (1.13.1-0ubuntu1.5) trusty-security; urgency=medium

[ Jamie Strandboge ]

  \* SECURITY UPDATE: disallow unsafe tempurl operations to point to

    unauthorized data

    - debian/patches/CVE-2015-5223.patch: disallow creation of DLO object

      manifests if non-safe tempurl request includes X-Object-Manifest header

    - CVE-2015-5223

    - LP: [#1453948](/bugs/1453948)

[ Marc Deslauriers ]

  \* SECURITY UPDATE: DoS via incorrectly closed client connections

    - debian/patches/CVE-2016-0737.patch: get better at closing WSGI

      iterables in swift/common/middleware/dlo.py,

      swift/common/middleware/slo.py, swift/common/request\_helpers.py,

      swift/common/swob.py, swift/common/utils.py,

      test/unit/common/middleware/helpers.py,

      test/unit/common/middleware/test\_dlo.py,

      test/unit/common/middleware/test\_slo.py.

    - CVE-2016-0737

  \* SECURITY UPDATE: DoS via incorrectly closed server connections

    - debian/patches/CVE-2016-0738.patch: fix memory/socket leak in proxy

      on truncated SLO/DLO GET in swift/common/request\_helpers.py,

      test/unit/common/middleware/test\_slo.py.

    - CVE-2016-0738

  \* Thanks to Red Hat for the patch backports!

  \* debian/patches/fix-ubuntu-tests.patch: disable another test that no

    longer works on buildds.

-- Marc Deslauriers <email address hidden> Tue, 12 Sep 2017 07:36:43 -0400

This bug was fixed in the package swift - 1.13.1-0ubuntu1.5
---------------
swift (1.13.1-0ubuntu1.5) trusty-security; urgency=medium
[ Jamie Strandboge ]
\* SECURITY UPDATE: disallow unsafe tempurl operations to point to
unauthorized data
- debian/patches/CVE-2015-5223.patch: disallow creation of DLO object
manifests if non-safe tempurl request includes X-Object-Manifest header
- CVE-2015-5223
- LP: #1453948
[ Marc Deslauriers ]
\* SECURITY UPDATE: DoS via incorrectly closed client connections
- debian/patches/CVE-2016-0737.patch: get better at closing WSGI
iterables in swift/common/middleware/dlo.py,
swift/common/middleware/slo.py, swift/common/request\_helpers.py,
swift/common/swob.py, swift/common/utils.py,
test/unit/common/middleware/helpers.py,
test/unit/common/middleware/test\_dlo.py,
test/unit/common/middleware/test\_slo.py.
- CVE-2016-0737
\* SECURITY UPDATE: DoS via incorrectly closed server connections
- debian/patches/CVE-2016-0738.patch: fix memory/socket leak in proxy
on truncated SLO/DLO GET in swift/common/request\_helpers.py,
test/unit/common/middleware/test\_slo.py.
- CVE-2016-0738
\* Thanks to Red Hat for the patch backports!
\* debian/patches/fix-ubuntu-tests.patch: disable another test that no
longer works on buildds.
-- Marc Deslauriers <marc.deslauriers@ubuntu.com> Tue, 12 Sep 2017 07:36:43 -0400

| Changed in swift (Ubuntu Trusty): | |
| --- | --- |
| **status**: | New → Fix Released |

[See full activity log](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/cloud-archive/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/cloud-archive/%2Bbug/1493303/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [leakpatch-1.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4529331/%2Bfiles/leakpatch-1.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4529331 "Change patch details")
* [security\_leak\_fix.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4530760/%2Bfiles/security_leak_fix.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4530760 "Change patch details")
* [socket-leak-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4532159/%2Bfiles/socket-leak-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4532159 "Change patch details")
* [socket-leak-3.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4545988/%2Bfiles/socket-leak-3.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4545988 "Change patch details")
* [socket-leak-4.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4546358/%2Bfiles/socket-leak-4.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4546358 "Change patch details")
* [socket-leak-kilo-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548894/%2Bfiles/socket-leak-kilo-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548894 "Change patch details")
* [socket-leak-liberty-backport.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4548896/%2Bfiles/socket-leak-liberty-backport.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4548896 "Change patch details")
* [socket-leak-kilo-backport-2.diff](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4549968/%2Bfiles/socket-leak-kilo-backport-2.diff)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4549968 "Change patch details")

* [Add patch](/cloud-archive/%2Bbug/1493303/%2Baddcomment?field.patch=on)

## Bug attachments

* [Dependencies.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459119/%2Bfiles/Dependencies.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459119 "Change attachment details")
* [ProcEnviron.txt](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4459120/%2Bfiles/ProcEnviron.txt)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4459120 "Change attachment details")
* [leakreproducer.sh](https://bugs.launchpad.net/cloud-archive/%2Bbug/1493303/%2Battachment/4520199/%2Bfiles/leakreproducer.sh)
  [Edit](/cloud-archive/%2Bbug/1493303/%2Battachment/4520199 "Change attachment details")

* [Add attachment](/cloud-archive/%2Bbug/1493303/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from access.redhat.com_c262b403_20250126_093648.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)

  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Product Documentation](https://access.redhat.com/documentation)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)

  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform)
  [All Product Docs](//docs.redhat.com/en/products/)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)

  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Classifications](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Severety Ratings](https://access.redhat.com/security/security-updates/#/cve)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)

  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

 Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

# How do I apply package updates to my RHEL system?

Updated 2023-06-08T17:44:17+00:00 -
English

* [English](https://access.redhat.com/articles/11258)
* [Japanese](https://access.redhat.com/ja/articles/17461)
* [Chinese](https://access.redhat.com/zh-hans/articles/7047073)

## Table of Contents

* [Environment considerations](#environment-considerations-1)
* [Prerequisites](#prerequisites-2)
* [Registering the system with the Subscription Manager](#rhsm)
* [Graphical interface](#graphical-interface-4)
* [Command line](#command-line-5)

* [Applying package updates on Red Hat Enterprise Linux 9](#rhel9)
* [Applying package updates on Red Hat Enterprise Linux 8](#rhel8)
* [Applying package updates on Red Hat Enterprise Linux 7](#rhel7)
* [Applying package updates on Red Hat Enterprise Linux 6](#rhel6)
* [Applying package updates on Red Hat Enterprise Linux 5](#rhel5)

## Environment considerations

Red Hat Enterprise Linux starting with versions 6.1 and 5.7 introduced a new Red Hat Subscription Management (RHSM) service. Red Hat Network (RHN) has been decommissioned.

Users that are new to Red Hat or would like the enhanced subscription information and improved content access should use RHSM. If you are still using Red Hat Network, we advise you to [migrate to RHSM as soon as possible](https://access.redhat.com/products/red-hat-subscription-management#migration). Customers using older versions of Red Hat Enterprise Linux must continue using RHN Classic. Refer to [FAQ for Changes to Red Hat's Entitlement Platform with RHEL 6.1 and 5.7](https://access.redhat.com/articles/47844) and [What's the difference between management services provided by Red Hat Network (RHN) Classic and Red Hat Subscription Management (RHSM)?](https://access.redhat.com/articles/63269) for more information on benefits of RHSM over RHN.

* For **Red Hat Enterprise Linux 9**, register the system using RHSM as described in [Registering the system with the Subscription Manager](#rhsm). Then update the system according to instructions in [Applying package updates on Red Hat Enterprise Linux 9](#rhel9).
* For **Red Hat Enterprise Linux 8**, register the system using RHSM as described in [Registering the system with the Subscription Manager](#rhsm). Then update the system according to instructions in [Applying package updates on Red Hat Enterprise Linux 8](#rhel8).
* For **Red Hat Enterprise Linux 7**, register the system using RHSM as described in [Registering the system with the Subscription Manager](#rhsm). Then update the system according to instructions in [Applying package updates on Red Hat Enterprise Linux 7](#rhel7).
* For **Red Hat Enterprise Linux 6**, register the system using RHSM (if RHEL 6.1 or above) as described in [Registering the system with the Subscription Manager](#rhsm). Then update the system according to instructions in [Applying package updates on Red Hat Enterprise Linux 6](#rhel6).
* For **Red Hat Enterprise Linux 5**, register the system using RHSM (if RHEL 5.7 or above) as described in [Registering the system with the Subscription Manager](#rhsm). After registration, update the system according to instructions in [Applying package updates on Red Hat Enterprise Linux 5](#rhel5).
* If your system cannot connect to the Internet directly, our [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/) offering may be of interest.

## Prerequisites

### Registering the system with the Subscription Manager

#### Graphical interface

Access the Subscription Management GUI client in Red Hat Enterprise Linux 9 via **Activities** and then **Show Applications** which is visible in the Favorites dock by default.

Access the Subscription Management GUI client in Red Hat Enterprise Linux 8 via **Activities**, then select **Show Applications** and click **All**. Then select **Red Hat Subscription Manager**.

In Red Hat Enterprise Linux 7 open **Applications** -> **System Tools** -> **Red Hat Subscription Manager** and in Red Hat Enterprise Linux 6 via **System** -> **Administration** -> **Red Hat Subscription Manager**.

#### Command line

A system can also be registered via the command line by using the "subscription-manager" command. To register your system, either through the GUI or from the command line, follow the instructions in the [Using and Configuring Red Hat Subscription Manager](https://access.redhat.com/documentation/en-US/Red_Hat_Subscription_Management/1/html-single/RHSM/index.html) guide.

Make sure that your firewall allows configuring RHSM, for more information see [How do I access RHSM (yum) through a firewall?](https://access.redhat.com/solutions/65300).

General information on RHSM can be found in [Red Hat Network Subscription Management](https://access.redhat.com/documentation/en-US/Red_Hat_Customer_Portal/1/html/Red_Hat_Network_Certificate-based_Subscription_Management/index.html), while [FAQ for Changes to Red Hat's Entitlement Platform with RHEL 6.1 and 5.7](/knowledge/node/47844) provides a quick overview and a comparison with RHN.

## Applying package updates on Red Hat Enterprise Linux 9

Before installing an update, make sure all previously released errata relevant to the system have been applied.

To access updates when using Red Hat Enterprise Linux 9, launch the graphical update tool through **Applications** and then **Software** which is visible in the Favorites dock (by default).

```
# gnome-software

```

Within the graphical interface, select **Updates**.

For a command line interface, use the following command to update the operating system:

```
# dnf upgrade

```

To install a specific package, such as vsftpd, use the following command:

```
# dnf install vsftpd

```

To update a specific package, such as bind, use the following command:

```
# dnf upgrade bind

```

To find more information about the command line options available for `yum`, use the following command:

```
# man dnf

```
## Applying package updates on Red Hat Enterprise Linux 8

Before installing an update, make sure all previously released errata relevant to the system have been applied.

To access updates when using Red Hat Enterprise Linux 8, launch the graphical update tool through **Applications** -> **Show Applications** -> **All** -> **Software**, or from the command line via the following command:

```
# gnome-software

```

Within the graphical interface, select **Updates**.

For a command line interface, use the following command to update the operating system:

```
# dnf update

```

To install a specific package, such as vsftpd, use the following command:

```
# dnf install vsftpd

```

To update a specific package, such as bind, use the following command:

```
# dnf update bind

```

To find more information about the command line options available for `yum`, use the following command:

```
# man dnf

```
## Applying package updates on Red Hat Enterprise Linux 7

Before installing an update, make sure all previously released errata relevant to the system have been applied.

To access updates when using Red Hat Enterprise Linux 7, launch the graphical update tool through **Applications** -> **System Tools** -> **Software Update**, or from the command line via the following command:

```
# gpk-update-viewer

```

For a command line interface, use the following command to update the operating system:

```
# yum update

```

To install a specific package, such as vsftpd, use the following command:

```
# yum install vsftpd

```

To update a specific package, such as bind, use the following command:

```
# yum update bind

```

To find more information about the command line options available for `yum`, use the following command:

```
# man yum

```
## Applying package updates on Red Hat Enterprise Linux 6

Before installing an update, make sure all previously released errata relevant to the system have been applied.

To access updates when using Red Hat Enterprise Linux 6, launch the graphical update tool through **System** -> **Administration** -> **Software Update**, or from the command line via the following command:

```
# gpk-update-viewer

```

For a command line interface, use the following command to update the operating system:

```
# yum update

```

To install a specific package, such as vsftpd, use the following command:

```
# yum install vsftpd

```

To update a specific package, such as bind, use the following command:

```
# yum update bind

```

To find more information about the command line options available for `yum`, use the following command:

```
# man yum

```
## Applying package updates on Red Hat Enterprise Linux 5

Before installing an update, make sure all previously released errata relevant to the system have been applied.

To access updates when using Red Hat Enterprise Linux 5, launch the graphical update tool through **Applications** -> **System Tools** -> **Software Updater**, or from the command line via the following command:

```
# pup

```

For a command line interface, use the following command to update the operating system:

```
# yum update

```

To install a specific package, such as vsftpd, use the following command:

```
# yum install vsftpd

```

To update a specific package, such as bind, use the following command:

```
# yum update bind

```

To find more information about the command line options available for `yum`, use the following command:

```
# man yum

```

* **Product(s)**
* [Red Hat Network](https://access.redhat.com/search?q=Red+Hat+Network&documentKind=Article%26Solution)
* [Red Hat Subscription Management](https://access.redhat.com/search?q=Red+Hat+Subscription+Management&documentKind=Article%26Solution)

* **Category**
* [Learn more](https://access.redhat.com/search?q=Learn+more&documentKind=Article%26Solution)

* **Component**
* [rhn\_register](https://access.redhat.com/search?q=rhn_register&documentKind=Article%26Solution)
* [subscription-manager](https://access.redhat.com/search?q=subscription-manager&documentKind=Article%26Solution)

* **Tags**
* [customer\_portal](https://access.redhat.com/search?q=customer_portal&documentKind=Article%26Solution)

* **Article Type**
* [General](https://access.redhat.com/search?q=General&documentKind=Article%26Solution)

## Comments

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com)

### Help

* [Contact Customer Portal](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Systems Status

### About

* [Red Hat Subscription Value](https://access.redhat.com/subscription-value)
* [About Red Hat](https://www.redhat.com/about/)
* [Red Hat Jobs](http://jobs.redhat.com)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

Copyright © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)

×
### Formatting Tips

Here are the common uses of Markdown.

Code blocks
```
~~~
Code surrounded in tildes is easier to read
~~~
```

Links/URLs`[Red Hat Customer Portal](https://access.redhat.com)`

[Learn more](/help/markdown)
Close

×
#### Request a English Translation

Are you sure you want to update a translation?
It seems an existing [English Translation](%40url) exists already.
We appreciate your interest in having Red Hat content localized to your language. Please note that excessive use of this feature could cause delays in getting specific content you are interested in translated.
Close
 [Request Japanese Translation](/articles/11258?rate=4KpVk2OisoRoaBCC1xAYYu2EqqVd-hs-lWbo3UiEzrI "Request Japanese Translation") [Request Chinese Translation](/articles/11258?rate=Djff6xI-V_Ac9jkgVml5Zy46vWj-_DUy2x9AY3QVlmM "Request Chinese Translation") [Request Korean Translation](/articles/11258?rate=Jlnc4lh8Dy-a-VpnQ5nujpRwH0WyxQjy0mAR7wwUHTU "Request Korean Translation")

×
#### Generating Machine Translation

Loading…
We are generating a machine translation for this content. Depending on the length of the content, this process could take a while.

Cancel



=== Content from launchpad.net_358978c3_20250126_093632.html ===

[Log in / Register](https://launchpad.net/~hudson-openstack/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~hudson-openstack)

## [OpenStack Infra](https://launchpad.net/~hudson-openstack)

* Overview
* [Code](https://code.launchpad.net/~hudson-openstack)
* [Bugs](https://bugs.launchpad.net/~hudson-openstack)
* [Blueprints](https://blueprints.launchpad.net/~hudson-openstack)
* [Translations](https://translations.launchpad.net/~hudson-openstack)
* [Answers](https://answers.launchpad.net/~hudson-openstack)

* [Related packages](https://launchpad.net/~hudson-openstack/%2Brelated-packages)
* [Related projects](https://launchpad.net/~hudson-openstack/%2Brelated-projects)

## User information

Launchpad Id:
hudson-openstack

Email:
[Log in](%2Blogin) for email information.

Member since:
2010-07-14

[![Icon of Burrow](https://launchpadlibrarian.net/67728214/os14.png "Member of Burrow")](/~burrow)
[![Icon of Citrix OpenStack development team](https://launchpadlibrarian.net/64472709/Citrix%2014.png "Member of Citrix OpenStack development team")](/~citrix-openstack)
[![Icon of (deprecated) OpenStack PPA maintainers](https://launchpadlibrarian.net/87891894/ppa.gif "Member of (deprecated) OpenStack PPA maintainers")](/~openstack-ppa)
[![Icon of Designate Core](https://launchpadlibrarian.net/360468328/designate_14.jpg "Member of Designate Core")](/~designate-core)
[![Icon of Designate Drivers](https://launchpadlibrarian.net/360468067/designate_14.jpg "Member of Designate Drivers")](/~designate-drivers)
[![Icon of MidoNet Bugs](https://launchpadlibrarian.net/228074955/midonet_14x14.png "Member of MidoNet Bugs")](/~midonet-bugs)
[![Icon of Nova Bug Team](https://launchpadlibrarian.net/108832444/bug.gif "Member of Nova Bug Team")](/~nova-bugs)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

OpenPGP keys:

72571ACC301E6FE900837F5CDF85501232EE128C

SSH keys:

[hudson@hudson](%2Bsshkeys)

[jenkins@vpcslave](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[6535](https://launchpad.net/~hudson-openstack/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All memberships](https://launchpad.net/~hudson-openstack/%2Bparticipation) Latest memberships

| [Compute Hyper-V Bugs](/~compute-hyperv-bugs)  Joined on 2019-08-28 | |
| --- | --- |
| [OS-Win Bugs](/~os-win-bugs)  Joined on 2019-08-28 | |
| [Networking Hyper-V Bugs](/~networking-hyperv-bugs)  Joined on 2019-08-28 | |
| [kolla-drivers](/~kolla-drivers)  Joined on 2019-05-20 | |
| [fixtures-git-bugs](/~fixtures-git-bugs)  Joined on 2018-03-25 | |

## [Recent activities](https://launchpad.net/~hudson-openstack/%2Bkarma) Most active in

| [StarlingX](/starlingx) |  |  |  |
| --- | --- | --- | --- |
| [kolla-ansible](/kolla-ansible) |  |  |  |
| [kolla](/kolla) |  |  |  |
| [kayobe](/kayobe) |  |  |  |
| [OpenStack Compute (nova)](/nova) |  |  |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from rhn.redhat.com_509031d4_20250125_144121.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2016:0128 - Security Advisory

Issued:
2016-02-08
Updated:
2016-02-08
# RHSA-2016:0128 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: openstack-swift security update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2016%3A0128)

## Topic

Updated openstack-swift packages that fix two security issues are now
available for Red Hat Enterprise Linux OpenStack Platform 6.0 for RHEL 7.

Red Hat Product Security has rated this update as having Moderate
security impact. A Common Vulnerability Scoring System (CVSS) base
score, which gives a detailed severity rating, is available from the
CVE link in the References section.

## Description

OpenStack Object Storage (swift) provides object storage in virtual
containers, which allows users to store and retrieve files (arbitrary
data). The service's distributed architecture supports horizontal scaling;
redundancy as failure-proofing is provided through software-based data
replication. Because Object Storage supports asynchronous eventual
consistency replication, it is well suited to multiple data-center
deployment.

A memory-leak issue was found in OpenStack Object Storage (swift), in the
proxy-to-server connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0738)

A memory-leak issue was found in OpenStack Object Storage (swift), in the
client-to-proxy connection. An OpenStack-authenticated attacker could
remotely trigger this flaw to cause denial of service through excess memory
consumption. (CVE-2016-0737)

Red Hat would like to thank the OpenStack project for reporting these
issues. Upstream acknowledges Romain Le Disez from OVH and Örjan Persson
from Kiliaro as the original reporters.

All users of openstack-swift are advised to upgrade to these updated
packages, which correct these issues. After installing this update, the
OpenStack Object Storage services will be restarted automatically.

## Solution

Before applying this update, ensure all previously released errata
relevant to your system have been applied.

For details on how to apply this update, refer to:

<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat OpenStack 6.0 x86\_64

## Fixes

* [BZ - 1298905](https://bugzilla.redhat.com/show_bug.cgi?id=1298905)
  - CVE-2016-0738 openstack-swift: Proxy to server DoS through Large Objects
* [BZ - 1298924](https://bugzilla.redhat.com/show_bug.cgi?id=1298924)
  - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects

## CVEs

* [CVE-2016-0737](https://www.redhat.com/security/data/cve/CVE-2016-0737.html)
* [CVE-2016-0738](https://www.redhat.com/security/data/cve/CVE-2016-0738.html)

## References

* <http://www.redhat.com/security/updates/classification/#normal>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat OpenStack 6.0

| SRPM | |
| --- | --- |
| openstack-swift-2.2.0-6.el7ost.src.rpm | SHA-256: 2786e50f053f4dcb53f0ae941d54f3f6ee6976d51de329a864eaa9b41ab216f4 |
| x86\_64 | |
| openstack-swift-2.2.0-6.el7ost.noarch.rpm | SHA-256: f80b255be42507f4fe10b7f1a0fd17de84942c8d3af95df1c1c20818a3c114fd |
| openstack-swift-account-2.2.0-6.el7ost.noarch.rpm | SHA-256: 97b03508f7edd6c432d26cd199b2765d3003cf84f3aaa212c729ce866e1c26cd |
| openstack-swift-container-2.2.0-6.el7ost.noarch.rpm | SHA-256: fffab203df81d30033f14c3b46ea5ba935518f5c2490190b7aaf43c1f793c66a |
| openstack-swift-doc-2.2.0-6.el7ost.noarch.rpm | SHA-256: ba5df2a953ad411fba328e32fc2474fe41a28c887cdefa03017b0e896cce67b1 |
| openstack-swift-object-2.2.0-6.el7ost.noarch.rpm | SHA-256: 701a203c8a81e92ac1a3ef22b4ca620ae225e1f74de0730469b24b4243ac8e72 |
| openstack-swift-proxy-2.2.0-6.el7ost.noarch.rpm | SHA-256: 07ba287ee3c90e8496fac3cdfd636ed229744f109da06f2850e353f510ffc6f1 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from security.openstack.org_6a0264c0_20250125_144129.html ===


Toggle navigation

 Search

* [Software](https://www.openstack.org/software/)
  + [Overview](https://www.openstack.org/software/)
  + [OpenStack Components](https://www.openstack.org/software/project-navigator/openstack-components)
  + [SDKs](https://www.openstack.org/software/project-navigator/sdks)
  + [Deployment Tools](https://www.openstack.org/software/project-navigator/deployment-tools)
  + [OpenStack Map](https://www.openstack.org/assets/software/projectmap/openstack-map.pdf)
  + [Sample Configs](https://www.openstack.org/software/sample-configs/)
* [Use Cases](https://www.openstack.org/use-cases/)
  + [Users in Production](https://www.openstack.org/use-cases/)
  + [Ironic Bare Metal](https://www.openstack.org/use-cases/bare-metal/)
  + [Edge Computing](https://www.openstack.org/use-cases/edge-computing/)
  + [Telecom & NFV](https://www.openstack.org/use-cases/telecoms-and-nfv/)
  + [Science and HPC](https://www.openstack.org/use-cases/science/)
  + [Containers](https://www.openstack.org/use-cases/containers/)
  + [Enterprise](https://www.openstack.org/use-cases/enterprise/)
  + [User Survey](https://www.openstack.org/surveys/landing)
* [Events](https://openinfra.dev/summit)
  + [OpenInfra Summit](https://openinfra.dev/summit)
  + [Project Teams Gathering](https://www.openstack.org/ptg/)
  + [OpenDev](https://www.openstack.org/events/opendev-2020/)
  + [Community Events](https://www.openstack.org/events/community-events/)
  + [OpenStack & OpenInfra Days](https://www.openstack.org/events/openstackdays)
  + [Summit Videos](https://www.openstack.org/videos/)
* [Community](https://www.openstack.org/community/)
  + [Welcome! Start Here](https://www.openstack.org/community/)
  + [OpenStack Technical Committee](https://www.openstack.org/community/tech-committee)
  + [Speakers Bureau](https://www.openstack.org/community/speakers/)
  + [OpenStack Wiki](http://wiki.openstack.org)
  + [Get Certified (COA)](https://www.openstack.org/coa/)
  + [Jobs](https://www.openstack.org/community/jobs/)
  + [Marketing Resources](https://www.openstack.org/marketing/)
  + [Community News](https://www.openstack.org/news/)
  + [Superuser Magazine](http://superuser.openstack.org)
  + [OpenInfra Foundation Supporting Organizations](https://www.openstack.org/community/supporting-organizations/)
  + [OpenInfra Foundation](https://openinfra.dev)
* [Marketplace](https://www.openstack.org/marketplace/)
  + [Training](https://www.openstack.org/marketplace/training/)
  + [Distros & Appliances](https://www.openstack.org/marketplace/distros/)
  + [Public Clouds](https://www.openstack.org/marketplace/public-clouds/)
  + [Hosted Private Clouds](https://www.openstack.org/marketplace/hosted-private-clouds/)
  + [Remotely Managed Private Clouds](https://www.openstack.org/marketplace/remotely-managed-private-clouds/)
  + [Consulting & Integrators](https://www.openstack.org/marketplace/consulting/)
  + [Drivers](https://www.openstack.org/marketplace/drivers/)
* [Blog](https://www.openstack.org/blog/)
* [Docs](http://docs.openstack.org/)
* [Join](https://openinfra.dev/join/)
  + [Sign up for Foundation Membership](https://openinfra.dev/join/)
  + [Sponsor the Foundation](https://openinfra.dev/join/)
  + [More about the Foundation](https://openinfra.dev)
* [Log In](https://www.openstack.org/Security/login/?BackURL=/home/)

# OSSA-2016-004: Swift proxy-server DoS through Large Object

# OSSA-2016-004: Swift proxy-server DoS through Large Object[Â¶](#ossa-2016-004-swift-proxy-server-dos-through-large-object "Link to this heading")

Date:

January 20, 2016

CVE:

CVE-2016-0737 (client to proxy),
CVE-2016-0738 (proxy to server)

## Affects[Â¶](#affects "Link to this heading")

* Swift: >=2.2.1 <= 2.3.0, >= 2.4.0 <= 2.5.0

## Description[Â¶](#description "Link to this heading")

Romain LE DISEZ from OVH and Ãrjan Persson from Kiliaro independently reported two vulnerabilities in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. Note that there are two distinct bugs that can exhaust proxy resources, one for client connection (client to proxy), one for servers connection (proxy to server). All Swift setup are affected.

## Patches[Â¶](#patches "Link to this heading")

* <https://review.openstack.org/270234> (proxy to server) (Kilo)
* <https://review.openstack.org/217750> (client to proxy) (Kilo)
* <https://review.openstack.org/270235> (proxy to server) (Liberty)
* <https://review.openstack.org/270233> (proxy to server) (Mitaka)

## Credits[Â¶](#credits "Link to this heading")

* Romain LE DISEZ from OVH (CVE-2016-0737)
* Ãrjan Persson from Kiliaro (CVE-2016-0738)

## References[Â¶](#references "Link to this heading")

* <https://bugs.launchpad.net/bugs/1466549> (client to proxy)
* <https://bugs.launchpad.net/bugs/1493303> (proxy to server)
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-0737> (client to proxy)
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-0738> (proxy to server)

## Notes[Â¶](#notes "Link to this heading")

* The client to proxy issue (CVE-2016-0737) is already fixed in Liberty
* The remaining fix will be included in future 2.3.1 (Kilo) and 2.5.1
  (Liberty) releases.

this page last updated: 2025-01-07 18:17:35

[![Creative Commons Attribution 3.0 License](../_static/images/docs/license.png)](https://creativecommons.org/licenses/by/3.0/)

Except where otherwise noted, this document is licensed under
[Creative Commons
Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/). See all [OpenStack Legal Documents](https://www.openstack.org/legal).

found an error? report a bug

OpenStack Documentation

* Guides
* [Install Guides](https://docs.openstack.org/index.html#install-guides)
* [User Guides](https://docs.openstack.org/index.html#user-guides)
* [Configuration Guides](https://docs.openstack.org/index.html#configuration-guides)
* [Operations and Administration Guides](https://docs.openstack.org/index.html#ops-and-admin-guides)
* [API Guides](https://docs.openstack.org/index.html#api-guides)
* [Contributor Guides](https://docs.openstack.org/index.html#contributor-guides)
* Languages
* [Deutsch (German)](https://docs.openstack.org/de/)
* [FranÃ§ais (French)](https://docs.openstack.org/fr/)
* [Bahasa Indonesia (Indonesian)](https://docs.openstack.org/id/)
* [Italiano (Italian)](https://docs.openstack.org/it/)
* [æ¥æ¬èª (Japanese)](https://docs.openstack.org/ja/)
* [íêµ­ì´ (Korean)](https://docs.openstack.org/ko_KR/)
* [PortuguÃªs (Portuguese)](https://docs.openstack.org/pt_BR/)
* [TÃ¼rkÃ§e (TÃ¼rkiye)](https://docs.openstack.org/tr_TR/)
* [ç®ä½ä¸­æ (Simplified Chinese)](https://docs.openstack.org/zh_CN/)

#### Contents

* OSSA-2016-004: Swift proxy-server DoS through Large Object
  + [Affects](#affects)
  + [Description](#description)
  + [Patches](#patches)
  + [Credits](#credits)
  + [References](#references)
  + [Notes](#notes)

### OpenStack

* [Projects](https://www.openstack.org/software/project-navigator/)
* [OpenStack Security](https://security.openstack.org/)
* [Blog](https://openstack.org/blog/)
* [News](https://openstack.org/news/)

### Community

* [User Groups](https://www.meetup.com/pro/openinfradev/)
* [Events](https://openstack.org/community/events/)
* [Jobs](https://openstack.org/community/jobs/)
* [Companies](https://openinfra.dev/members/)
* [Contribute](https://docs.openstack.org/contributors)

### Documentation

* [OpenStack Manuals](https://docs.openstack.org)
* [Getting Started](https://openstack.org/software/start/)
* [API Documentation](https://developer.openstack.org)
* [Wiki](https://wiki.openstack.org)

### Branding & Legal

* [Legal Docs](https://openinfra.dev/legal)
* [Logos & Guidelines](https://openstack.org/brand/)
* [Trademark Policy](https://openinfra.dev/legal/trademark-policy)
* [Privacy Policy](https://openinfra.dev/privacy-policy)
* [OpenInfra CLA](https://docs.openstack.org/contributors/common/setup-gerrit.html#individual-contributor-license-agreement)

### Stay In Touch

The OpenStack project is provided under the
[Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0). Docs.openstack.org is powered by
[Rackspace Cloud Computing](https://rackspace.com).



=== Content from github.com_dc2c7820_20250125_144128.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenstack%2Fswift%2Fblob%2Fmaster%2FCHANGELOG)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenstack%2Fswift%2Fblob%2Fmaster%2FCHANGELOG)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=openstack%2Fswift)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openstack](/openstack)
/
**[swift](/openstack/swift)**
Public

* [Notifications](/login?return_to=%2Fopenstack%2Fswift) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fopenstack%2Fswift)
* [Star
   2.7k](/login?return_to=%2Fopenstack%2Fswift)

* [Code](/openstack/swift)
* [Pull requests
  0](/openstack/swift/pulls)
* [Actions](/openstack/swift/actions)
* [Security](/openstack/swift/security)
* [Insights](/openstack/swift/pulse)

Additional navigation options

* [Code](/openstack/swift)
* [Pull requests](/openstack/swift/pulls)
* [Actions](/openstack/swift/actions)
* [Security](/openstack/swift/security)
* [Insights](/openstack/swift/pulse)

## Files

 master
## Breadcrumbs

1. [swift](/openstack/swift/tree/master)
/
# CHANGELOG

Copy path Blame  Blame
## Latest commit

## History

[History](/openstack/swift/commits/master/CHANGELOG)4858 lines (3216 loc) · 190 KB master
## Breadcrumbs

1. [swift](/openstack/swift/tree/master)
/
# CHANGELOG

Top
## File metadata and controls

* Code
* Blame

4858 lines (3216 loc) · 190 KB[Raw](https://github.com/openstack/swift/raw/refs/heads/master/CHANGELOG)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000swift (2.34.0, OpenStack Dalmatian)
 \* Middleware features:
 \* The static large object (SLO) middleware now supports including a `?part-number=<N>` query parameter to request just part of a large object. This may be used to enable efficient parallel downloads. For more information, see https://docs.openstack.org/swift/latest/overview\_large\_objects.html#retrieving-a-large-object
 \* The S3 API middleware now supports the `?partNumber=<N>` query parameter, enabling parallel downloads.
 \* The KMS keymaster now supports overriding the endpoint returned in the Keystone catalog via the `barbican\_endpoint` configuration option. This may be useful in multi-region deployments which have multiple endpoints.
 \* The backend ratelimiter now supports dynamic reloading of limits. The new configuration options `backend\_ratelimit\_conf\_path` and `config\_reload\_interval` control which file is reloaded and how frequently, respectively.
 \* The backend ratelimiter now supports per-method, per-device ratelimits. See `etc/backend-ratelimit.conf-sample` for more information.
 \* S3 API improvements:
 \* Error response reasons are now logged as part of the `log\_info` field. This can be especially useful when diagnosing HEAD failures, which necessarily have no response body.
 \* Fixed a server error when using non-ASCII access key IDs.
 \* Fixed several checksum-related error responses to be more AWS-like.
 \* Account quota improvements:
 \* Overall account byte quotas should now be set with the `X-Account-Quota-Bytes` header. The `X-Account-Meta-Quota-Bytes` header is now deprecated.
 \* The account quota middleware now supports object-count quotas in addition to byte-count quotas, similar to the container quota middleware. For more information, see https://docs.openstack.org/swift/latest/middleware.html#module-swift.common.middleware.account\_quotas
 \* Using an `X-Remove-Account-Quota-Bytes-Policy-<policy name>` header now removes the per-policy quota, rather than reducing it to zero.
 \* Object expiration improvements:
 \* Added per-account and per-container reaping delays. These may be used to offer some grace period in which to recover expired objects.
 \* Added a proxy-server configuration option: `allow\_open\_expired`. This defaults to false; if true, clients may intereact with expired objects by including an `X-Open-Expired: true` header in GET, HEAD, or POST requests.
 \* Expiring object queue entries now include the size of the object to be expired in the `swift\_expirer\_bytes` parameter of the queue entry's content-type.
 \* Added metrics to count skipped, delayed, and assigned tasks as they're enumerated.
 \* Proxy-server fixes:
 \* Object POSTs now 503 rather than trusting the 404s that might be returned from handoffs when primaries are overloaded.
 \* Client disconnects should always be logged within the context of the appropriate client request. Previously, there were some cases where logging would occur during general garbage collection, leading to incorrect or missing transaction IDs in logs.
 \* The proxy-logging middleware now emits timing and transfer stats for more requests such as auth requests. These will be labeled `UNKNOWN` rather than `account`, `container`, etc.
 \* Fixed a server error when the Swift request path has missing account or container components.
 \* Python 3.12 is now supported.
 \* `EUCLEAN` errors are better handled on the object server.
 \* `swift-account-info` now supports the `--sync` option to display the contents of the incoming and outgoing sync tables, similar to `swift-container-info`.
 \* The `swift-drive-audit` tool now works with ISO timestamps in kernel logs.
 \* The `swift-recon-cron` tool now better handles missing directories.
 \* Dependency update: lxml must be at least 4.2.3.
 \* Various other minor bug fixes and improvements.
swift (2.33.0, OpenStack Caracal)
 \* S3 API fixes:
 \* When the `+segments` container's storage policy differs from that of the primary container, completed manifests are now written with the correct policy in the primary container.
 \* Add basic read support for object locking. This improves compatibility with an Ansible S3 module. Write support is not yet implemented, so get-object-lock-configuration will always 404.
 \* If there's a conflict deleting the in-progress-upload marker when completing a multipart-upload, a 503 is now returned to the client, prompting it to retry.
 \* Added `Accept-Ranges: bytes` to object responses. Range requests have always been supported; now, that support is properly advertised.
 \* Static large object fixes:
 \* Fixed a server error when handling conditional GET requests.
 \* Return an error if the SLO manifest could not be parsed. Previously, a zero-byte response was returned.
 \* Proxy server fixes:
 \* Added a new `swift.proxy\_logging\_status` request environment key that middlewares may use to override the logged status for a request.
 \* Transaction IDs are included in more error responses.
 \* Added a counter metric when caching shard ranges.
 \* The `recoverable\_node\_timeout` option no longer applies to `X-Newest` GET requests.
 \* Improved error-handling in multi-part range responses.
 \* Sharding fixes:
 \* Prevent resets of a shard range's epoch.
 \* Cleaned up `X-Backend-\*` headers in listing responses.
 \* Reduced the frequency of `Reclaimable db stuck waiting for shrinking` messages when a root DB has been deleted but its shards have not been shrunk away.
 \* The more-efficient shard range structure from the last release is now used when fetching ranges from the backend.
 \* Include more information in shard-replication warnings.
 \* Object server fixes:
 \* Object POSTs and chunked PUTs are no longer accepted when the target drive is already past its `fallocate\_reserve`. DELETEs are still allowed.
 \* Added the ability to configure cooperative yielding when servicing GET responses, via the `cooperative\_period` option. See the example config for more information.
 \* Invalid `hashes.invalid` entries are now ignored, rather than causing a complete partition rehash.
 \* Prefix-based tempurls may now be used to explore staticweb listings within that prefix. Note that this opens a new ability to list containers from tempurls, but only if staticweb's `X-Container-Meta-Web-Listings` is enabled.
 \* When generating index pages from listings, staticweb now sends an HTML5 doctype. This makes them https://peps.python.org/pep-0503/ compliant, allowing their continued use for simple Python package repositories.
 \* Per-service `auto\_create\_account\_prefix` configuration options have been removed. These options were deprecated in favor of `swift.conf` configuration in Swift 2.24.0, part of the OpenStack Ussuri release.
 \* Added a `swift-reload` command to assist with safely reloading WSGI servers.
 \* Daemons now send `STOPPING` and `RELOADING` systemd notifications when the service is configured with `Type=notify`.
 \* Added more metrics to the container-server, allowing GET and PUT timings to be broken out for listings, shard range operations, and container creation.
 \* Daemons send object updates via the replication network in more cases.
 \* `swift-account-info` and `swift-container-info` now accept a `--sync` flag to show information from the incoming/outgoing sync tables.
 \* Several fixes to prepare for Python 3.12 support. While not yet tested in the gate, initial manual testing looks promising.
 \* Added support for recent versions of eventlet.
 \* The dark-data object audit watcher now works with sharded containers. Previously, it would think that all data files were absent from listings.
 \* Various other minor bug fixes and improvements.
swift (2.32.0, OpenStack Bobcat)
 \* Python 3 fixes:
 \* Python 3 object servers can now read unencrypted non-ASCII metadata that was written under Python 2.
 \* Ssync no longer corrupts unencrypted non-ASCII metadata during transfers.
 \* Fixed an encoding issue when writing non-ASCII object names to sharded containers and shard range caching is not enabled.
 \* Fixed an encoding issue when handling non-ASCII account names.
 \* Fixed a `generator already executing` error on client disconnect.
 \* Suppressed `RemoteDisconnected` tracebacks.
 \* Metrics improvements:
 \* Metrics are now emitted for a variety of S3 error responses, in the form `s3api.<status\_int>.<error\_class>[.<reason>]`
 \* Fixed an issue that prevented proxy servers from emitting metrics and logs for backend requests made when getting account or container info.
 \* Account and container info metrics now include the response status code when backend requests are made.
 \* Added timing metrics to the container sharder for various operations.
 \* Python 3.11 is now supported.
 \* Added the ability for reseller admins to set per-policy account quotas by posting metadata of the form `X-Account-Quota-Bytes-Policy-<policy name>`.
 \* Added a `keepalive\_timeout` option to the proxy server to limit how long to wait for a client to initiate a request, separate from the general `client\_timeout` option. Note that this requires eventlet 0.34.0 (currently unreleased) or later.
 \* Added a `keep\_cache\_slo\_manifest` option to the object server to better control whether SLO manifests are dropped from the page cache.
 \* WSGI servers now accept a `--test-config` option that may be used to validate configuration changes before reloading/restarting the server.
 \* The structure of cached shard ranges has changed, improving performance when listing or writing to sharded containers. Note that immediately after upgrade, the new structures will all be cache misses, which may lead to a thundering herd problem. To avoid this, upgrade just a few nodes first, let them service some fraction of traffic to populate the cache, then upgrade the rest of the cluster.
 \* A variety of performance improvements have been made for sharded container databases.
 \* Various logging and metrics improvements when talking to memcache.
 \* Fixed ssync's handling of timestamp offsets. Previously, this could cause ssync to fail with a 409 Conflict, causing the transfer to fail and preventing handoffs from clearing.
 \* Fixed an issue where an erasure-coded PUT could prevent other requests from being processed when network calls rarely or never blocked.
 \* Fixed an issue when downloading an SLO manifest would hit a recoverable error and attempt to resume from another node. This would manifest as either a pyeclib decode error or an unexpected empty response.
 \* The proxy server now applies error-limiting to the correct node when handling a recoverable node error.
 \* Account, container, and object log fields are now correctly identified when returning `BadDigest` responses to S3 requests.
 \* Previously, under some circumstances, a non-standard config option such as `RECLAIM\_AGE` might get parsed as `reclaim\_age` for some processes but ignored by others. Now, all config parsing is case-sensitive; non-standard names will always be ignored.
 \* Reduced the backend load of making `?versions` requests to a container that has never had object versioning enabled.
 \* Improved formatting of meta and sysmeta for `swift-account-info` and `swift-container-info`.
 \* The standard-library `logging` module is no longer monkey-patched when importing `swift.common.utils`, making it easier to re-use swift code in other contexts.
 \* Removed the hard dependency on netifaces; it may still be used if the `getifaddrs` C function is not available. This fallback support may be removed in a future release.
 \* Various other minor bug fixes and improvements.
swift (2.31.1, OpenStack Antelope)
 \* Sharding fixes
 \* Shards no longer report stats to the root database when they are in the CREATED state.
 \* Sharding metadata is no longer cleared when databases are deleted. This could previously cause deleted shards that still had rows to become stuck and never move them to the correct database.
 \* Fixed a performance regression in the handling of misplaced objects.
 \* Swift path and on-disk path are now included with all sharder logging.
 \* `s3token` no longer mangles request paths that include the Access Key ID.
 \* User metadata is now exposed via CORS when encryption is enabled, matching the behavior when encryption is not enabled.
 \* Fewer backend requests are now required when account or container information is missing from memcache.
 \* Fixed logging of IP and port in the proxy-server; in particular, internal clients now correctly log about the replication IP/port.
 \* Fixed a bug in the object replicator that would cause an under-reporting of failures.
 \* Various other minor bug fixes.
swift (2.31.0)
 \* S3 API improvements
 \* Fixed a security issue in how `s3api` handles XML parsing that allowed authenticated S3 clients to read arbitrary files from proxy servers. Refer to CVE-2022-47950 for more information.
 \* Fixed a server error when handling malformed CompleteMultipartUpload requests.
 \* Improved error reporting when attempting to set invalid `X-Delete-At` or `X-Delete-After` values via the S3 API.
 \* Sharding improvements
 \* Sync more shard ranges from the root database to the shards. This helps ensure shard range repairs effected at the root make their way to shards that would otherwise be stuck trying to further divide into sub-shards.
 \* Added a `merge` subcommand to `swift-manage-shard-ranges` to merge arbitrary shard ranges into a container DB. Minimal safety checks are performed; it should only be used for emergency shard range manipulation by expert users.
 \* Improved performance of `delimiter` listings for sharded containers.
 \* Added more safety checks to the `repair` subcommand of `swift-manage-shard-ranges`.
 \* Better handle `EOFError` and `KeyboardInterrupt` when prompting for input in `swift-manage-shard-ranges`.
 \* Warnings are now emitted when sharding appears to have become stuck. Use the new `container\_sharding\_timeout` option to configure the "stuck" threshold; the default is 48 hours.
 \* Stop warning about transient overlaps when auditing shard ranges.
 \* Metrics improvements
 \* Added timing stats for memcached operations.
 \* Renamed and improved the granularity of shard range cache and backend stats. Metrics dashboards may need to be updated.
 \* Emit stats when backend nodes are error-limited.
 \* Added support for Python 3.10.
 \* Added an optional `backend\_ratelimit` middleware for backend servers. See the backend server sample configuration files for more information.
 \* Added the ability to configure a chance to skip checking memcache when querying account and container information. This allows some fraction of traffic to go to disk and refresh memcache before the key ages out. Recommended values for the new `account\_existence\_skip\_cache\_pct` and `container\_existence\_skip\_cache\_pct` options are in the range of 0.0 to 0.01.
 \* Static large object segments may now be deleted asynchronously by default. Operators may return to the old behavior by disabling the `allow\_async\_delete` option in the `[filter:slo]` section in their proxy-server.conf.
 \* Absolute-form request targets are now accepted. This enables access for certain clients and SDKs (including some older versions of rclone that were using an old version of aws-sdk-go).
 \* Fixed a path-rewriting bug introduced in Python 3.7.14, 3.8.14, 3.9.14, and 3.10.6 that could cause some `domain\_remap` requests to be routed to the wrong object.
 \* Fixed a server error when attempting to access data in a deleted container that had an erasure-coded storage policy.
 \* Improved error messages to clients that encounter errors using the `formpost` middleware.
 \* Removed some inappropriate error-suppression when locking account and container databases.
 \* Improved server start-up time when using multiple workers.
 \* Removed some unnecessary locking when logging.
 \* Added some basic object-metadata validation; invalid diskfiles will be quarantined via the auditor or reconstructor.
 \* Enhanced logging when error-limiting a backend node.
 \* Various other minor bug fixes and improvements.
swift (2.30.1, zed stable backports)
 \* Fixed a security issue in how `s3api` handles XML parsing that allowed authenticated S3 clients to read arbitrary files from proxy servers. Refer to CVE-2022-47950 for more information.
 \* Fixed a path-rewriting bug introduced in Python 3.7.14, 3.8.14, 3.9.14, and 3.10.6 that could cause some `domain\_remap` requests to be routed to the wrong object.
swift (2.30.0, OpenStack Zed)
 \* Sharding improvements
 \* The `swift-manage-shard-ranges` tool has a new mode to repair gaps in the namespace.
 \* Misplaced tombstone records are now properly cleaved.
 \* Fixed a bug where the sharder could fail to find a device to use for cleaving.
 \* Databases marked deleted are now processed by the sharder.
 \* More information is now synced to the fresh database when sharding. Previously, a database could lose the fact that it had been marked as deleted.
 \* Shard ranges with no rows to cleave could previously be left in the CREATED state after cleaving. Now, they are advanced to CLEAVED.
 \* Metrics are now emitted for whether databases used for cleaving were created or already existed, allowing a better understanding of the reason for handoffs in the cluster.
 \* Misplaced-record stats are now also emitted to statsd. Previously, these were only available in logs.
 \* S3 API improvements
 \* Constant-time string comparisons are now used when checking signatures.
 \* Fixed cross-policy object copies. Previously, copied data would always be written using the source container's policy. Now, the destination container's policy will be used, avoiding availability issues and unnecessary container-reconciler work.
 \* More headers are now copied from multi-part upload markers to their completed objects, including `Content-Encoding`.
 \* When running with `s3\_acl` disabled, `bucket-owner-full-control` and `bucket-owner-read` canned ACLs will be translated to the same Swift ACLs as `private`.
 \* The S3 ACL and Delete Multiple APIs are now less case-sensitive.
 \* Improved the error message when deleting a bucket that's ever had versioning enabled and still has versions in it.
 \* `LastModified` timestamps in listings are now rounded up to whole seconds, like they are in responses from AWS.
 \* Proxy logging for Complete Multipart Upload requests is now more consistent when requests have been retried.
 \* Logging improvements
 \* Signal handling is more consistently logged at notice level. Previously, signal handling would sometimes be logged at info or error levels.
 \* The message template for proxy logging may now include a `{domain}` field for the client-provided `Host` header.
 \* The object-replicator now logs successful rsync transfers at debug instead of info.
 \* Added a `log\_rsync\_transfers` option to the object-replicator. Set it to false to disable logging rsync "send" lines; during large rebalances, such logging can overwhelm log aggregation while providing little useful information.
 \* Transaction IDs are now only included in daemon log lines in a request/response context.
 \* Fixed a socket leak when clients try to delete a non-SLO as though it were a Static Large Object.
 \* The formpost digest algorithm is now configurable via the new `allowed\_digests` option, and support is added for both SHA-256 and SHA-512. Supported formpost digests are exposed to clients in `/info`. Additionally, formpost signatures can now be base64 encoded.
 \* Added metrics to the formpost and tempurl middlewares to monitor digest usage in signatures.
 \* SHA-1 signatures are now deprecated for the formpost and tempurl middlewares. At some point in the future, SHA-1 will no longer be enabled by default; eventually, support for it will be removed entirely.
 \* Improved compatibility with certain FIPS-mode-enabled systems.
 \* Added a `ring\_ip` option for various object services. This may be used to find own devices in the ring in a containerized environment where the `bind\_ip` may not appear in the ring at all.
 \* Account and container replicators can now be configured with a `handoff\_delete` option, similar to object replicators and reconstructors. See the sample config for more information.
 \* Developers using Swift's memcache client may now opt in to having a `MemcacheConnectionError` be raised when no connection succeeded using a new `raise\_on\_error` keyword argument to `get`/`set`.
 \* The tempurl middleware has been updated to return a 503 if storing a token in memcache fails. Third party authentication middlewares are encouraged to also use the new `raise\_on\_error` keyword argument when storing ephemeral tokens in memcache.
 \* Pickle support has been removed from Swift's memcache client. Support had been deprecated since Swift 1.7.0.
 \* Device names are now included in new database IDs. This provides more context when examining incoming/outgoing sync tables or sharding CleaveContexts.
 \* Database replication connections are now closed following an error or timeout. This prevents a traceback in some cases when the replicator tries to reuse the connection.
 \* `ENOENT` and `ENODATA` errors are better handled in the object replicator and auditor.
 \* Improved object update throughput by shifting some shard range filtering from Python to SQL.
 \* Include `Vary: Origin` header when CORS responses vary by origin.
 \* The staticweb middleware now allows empty listings at the root of a container. Previously, this would result in a 404 response.
 \* Ring builder output tables better display weights over 1000.
 \* Various other minor bug fixes and improvements.
swift (2.29.2, yoga stable backports)
 \* Fixed a security issue in how `s3api` handles XML parsing that allowed authenticated S3 clients to read arbitrary files from proxy servers. Refer to CVE-2022-47950 for more information.
 \* Constant-time string comparisons are now used when checking S3 API signatures.
 \* Fixed a path-rewriting bug introduced in Python 3.7.14, 3.8.14, 3.9.14, and 3.10.6 that could cause some `domain\_remap` requests to be routed to the wrong object.
 \* Improved compatibility with certain FIPS-mode-enabled systems.
swift (2.29.1, OpenStack Yoga)
 \* This is the final stable branch that will support Python 2.7.
 \* Fixed s3v4 signature calculation when the client sends an un-encoded path in the request.
 \* Fixed multiple issues in s3api involving Multipart Uploads with non-ASCII names.
 \* The object-updater now defers rate-limited updates to the end of its cycle; these deferred updates will be processed (at the limited rate) until the configured `interval` elapses. A new `max\_deferred\_updates` option may be used to bound the deferral queue.
 \* Empty account and container partition directories are now cleaned up immediately after replication, rather than needing to wait for an additional replication cycle.
 \* The object-expirer now only cleans up empty containers. Previously, it would attempt to delete all processed containers, regardless of whether there were entries which were skipped or had errors.
 \* A new `item\_size\_warning\_threshold` option may be used to monitor for values that are approaching the limit of what can be stored in memcache. See the memcache sample config for more information.
 \* Internal clients now correctly use their configured User-Agent in backend requests, rather than only using it for logging.
 \* Various other minor bug fixes and improvements.
swift (2.29.0)
 \* S3 API improvements
 \* CORS preflights are now allowed for pre-signed URLs.
 \* The `storage\_domain` option now accepts a comma-separated list of storage domains. This allows multiple storage domains to configured for use with virtual-host style addressing.
 \* Fixed the types of configured values in /info response.
 \* Fixed a server error when trying to copy objects with non-ASCII names.
 \* Fixed a server error when uploading objects with very long names. A KeyTooLongError is now returned.
 \* Fixed an error when multi-deleting MPUs when SLO async-deletes are enabled.
 \* Fixed an error that allowed list-uploads and list-parts requests to return incomplete or out-of-order results.
 \* Fixed several bugs when dealing with non-ASCII object names and multipart uploads.
 \* Reduced the overhead of retrieving bucket and object ACLs.
 \* Replication, reconstruction, and diskfile improvements
 \* The reconstructor now uses the replication network to fetch fragments for reconstruction.
 \* Added the ability to limit how many objects per handoff partition will be reverted in a reconstructor cycle using the new `max\_objects\_per\_revert` option. This may be useful to reduce ssync timeouts and lock contention, ensuring that progress is made during rebalances.
 \* Ensure that non-durable data and .meta files are purged from handoffs after syncing.
 \* Fixed tracebacks when there's a race to mark a file durable or delete it.
 \* Improved cooperative multitasking during ssync.
 \* Upon detecting a ring change, the reconstructor now only aborts the jobs for that ring and continues processing jobs for other rings.
 \* Fixed a traceback when logging about a lock timeout in the replicator.
 \* Object updater improvements
 \* Added the ability to ratelimit updates (approximately) per-container using the new `max\_objects\_per\_container\_per\_second` option. This may be used to limit requests to already-overloaded containers while still making progress on updates to other containers.
 \* Added timing stats by response code.
 \* Updates are now sent over the replication network.
 \* Fixed a race condition where swift would attempt to quarantine recently-deleted updates.
 \* Memcache improvements
 \* Added the ability to configure a chance to skip checking memcache when querying shard ranges. This allows some fraction of traffic to go to disk and refresh memcache before the key ages out. Recommended values for the new `container\_updating\_shard\_ranges\_skip\_cache\_pct` and `container\_listing\_shard\_ranges\_skip\_cache\_pct` options are in the range of 0.0 to 0.1.
 \* Added stats for shard range cache hits, misses, and skips.
 \* Improved handling of timeouts and other errors when obtaining a connection to memcached.
 \* Recon improvements
 \* Added object-reconstructor stats to recon.
 \* Each object-server IP is now queried only once when reporting disk usage. Previously, each port in the ring would be queried; when using servers-per-port, this could dramatically overstate the disk capacity in the cluster.
 \* Fixed a security issue where tempurl and s3api signatures were logged in full. This allowed an attacker with access to log data to perform replay attacks, potentially accessing or overwriting cluster data. Now, such signatures are redacted in a manner similar to auth tokens; see the `reveal\_sensitive\_prefix` option in `proxy-server.conf`.
 See CVE-2017-8761 for more information.
 \* Added a new `swift.common.registry` module. This includes helper functions `register\_sensitive\_header` and `register\_sensitive\_param` which third party middleware authors may use to flag headers and query parameters for redaction when logging. For more information, see https://docs.openstack.org/swift/latest/misc.html#module-swift.common.registry
 \* Added the ability to configure project-scope read-only roles for keystoneauth using the new `project\_reader\_roles` option.
 \* The cname\_lookup middleware now works with dnspython 2.0 and later.
 \* The internal clients used by the container-reconciler, container-sharder, container-sync, and object-expirer daemons now use a more-descriptive `<daemon>-ic` log name, rather than `swift`. If you previously configured the `log\_name` option in `internal-client.conf`, you must now use the `set log\_name = <value>` syntax to configure it, even if no value is set in the `[DEFAULT]` section. This may be done prior to upgrading.
 \* Fixed a bug that allowed some statsd metrics to be annotated with the wrong backend layer.
 \* The `StatsdClient.set\_prefix` method is now deprecated and may be removed in a future release; by extension, so is the `LogAdapter.set\_statsd\_prefix` method. Middleware developers should use the `statsd\_tail\_prefix` argument to `get\_logger` instead.
 \* Fixed a traceback in the account-server when there's no account database on disk to receive a container update. The account-server now correctly 404s.
 \* The container-updater will quarantine container databases if all replicas for the account respond 404.
 \* Fixed a proxy-server error when the read-only middleware tried to handle non-Swift paths (such as may be used by third-party middleware).
 \* Some client behaviors that the proxy previously logged at warning have been lowered to info.
 \* Removed translations from most logging.
 \* Various other minor bug fixes and improvements.
swift (2.28.1, xena stable backports)
 \* Fixed a security issue in how `s3api` handles XML parsing that allowed authenticated S3 clients to read arbitrary files from proxy servers. Refer to CVE-2022-47950 for more information.
 \* Constant-time string comparisons are now used when checking S3 API signatures.
 \* Fixed a path-rewriting bug introduced in Python 3.7.14, 3.8.14, 3.9.14, and 3.10.6 that could cause some `domain\_remap` requests to be routed to the wrong object.
 \* Improved compatibility with certain FIPS-mode-enabled systems.
 \* Ensure that non-durable data and .meta files are purged from handoffs after syncing.
swift (2.28.0, OpenStack Xena)
 \* Sharding improvements:
 \* When building a listing from shards, any failure to retrieve listings will result in a 503 response. Previously, failures fetching a partiucular shard would result in a gap in listings.
 \* Container-server logs now include the shard path in the referer field when receiving stat updates.
 \* Added a new config option, `rows\_per\_shard`, to specify how many objects should be in each shard when scanning for ranges. The default is `shard\_container\_threshold / 2`, preserving existing behavior.
 \* Added a new config option, `minimum\_shard\_size`. When scanning for shard ranges, if the final shard would otherwise contain fewer than this many objects, the previous shard will instead be expanded to the end of the namespace (and so may contain up to `rows\_per\_shard + minimum\_shard\_size` objects). This reduces the number of small shards generated. The default value is `rows\_per\_shard / 5`.
 \* Added a new config option, `shrink\_threshold`, to specify the absolute size below which a shard will be considered for shrinking. This overrides the `shard\_shrink\_point` configuration option, which expressed this as a percentage of `shard\_container\_threshold`. `shard\_shrink\_point` is now deprecated.
 \* Similar to above, `expansion\_limit` was added as an absolute-size replacement for the now-deprecated `shard\_shrink\_merge\_point` configuration option.
 \* The sharder now correctly identifies and fails audits for shard ranges that overlap exactly.
 \* The sharder and swift-manage-shard-ranges now consider total row count (instead of just object count) when deciding whether a shard is a candidate for shrinking.
 \* If the sharder encounters shard range gaps while cleaving, it will now log an error and halt sharding progress. Previously, rows may not have been moved properly, leading to data loss.
 \* Sharding cycle time and last-completion time are now available via swift-recon.
 \* Fixed an issue where resolving overlapping shard ranges via shrinking could prematurely mark created or cleaved shards as active.
 \* `swift-manage-shard-ranges` improvements:
 \* Exit codes are now applied more consistently:
 - 0 for success - 1 for an unexpected outcome - 2 for invalid options - 3 for user exit
 As a result, some errors that previously resulted in exit code 2 will now exit with code 1.
 \* Added a new 'repair' command to automatically identify and optionally resolve overlapping shard ranges.
 \* Added a new 'analyze' command to automatically identify overlapping shard ranges and recommend a resolution based on a JSON listing of shard ranges such as produced by the 'show' command.
 \* Added a `--includes` option for the 'show' command to only output shard ranges that may include a given object name.
 \* Added a `--dry-run` option for the 'compact' command.
 \* The 'compact' command now outputs the total number of compactible sequences.
 \* S3 API improvements:
 \* Added an option, `ratelimit\_as\_client\_error`, to return 429s for rate-limited responses. Several clients/SDKs have seem to support retries with backoffs on 429, and having it as a client error cleans up logging and metrics. By default, Swift will respond 503, matching AWS documentation.
 \* Fixed a server error in bucket listings when `s3\_acl` is enabled and staticweb is configured for the container.
 \* Fixed a server error when a client exceeds `client\_timeout` during an upload. Now, a `RequestTimeout` error is correctly returned.
 \* Fixed a server error when downloading multipart uploads/static large objects that have missing or inaccessible segments. This is a state that cannot arise in AWS, so a new `BrokenMPU` error is returned, indicating that retrying the request is unlikely to succeed.
 \* Fixed several issues with the prefix, marker, and delimiter parameters that would be mirrored back to clients when listing buckets.
 \* Partition power increase improvements:
 \* The relinker now spawns multiple subprocesses to process disks in parallel. By default, one worker is spawned per disk; use the new `--workers` option to control how many subprocesses are used. Use `--workers=0` to maintain the previous behavior.
 \* The relinker now performs eventlet-hub selection the same way as other daemons. In particular, `epolls` will no longer be selected, as it seemed to cause occassional hangs.
 \* The relinker can now target specific storage policies or partitions by using the new `--policy` and `--partition` options.
 \* Partitions that encountered errors during relinking are no longer marked as completed in the relinker state file. This ensures that a subsequent relink will retry the failed partitions.
 \* Partition cleanup is more robust, decreasing the likelihood of leaving behind mostly-empty partitions from the old partition power.
 \* Improved relinker progress logging, and started collecting progress information for swift-recon.
 \* Cleanup is more robust to files and directories being deleted by another process.
 \* The relinker better handles data found from earlier partition power increases.
 \* The relinker better handles tombstones found for the same object but with different inodes.
 \* The reconciler now defers working on policies that have a partition power increase in progress to avoid issues with concurrent writes.
 \* Erasure coding fixes:
 \* Added the ability to quarantine EC fragments that have no (or few) other fragments in the cluster. A new configuration option, `quarantine\_threshold`, in the reconstructor controls the point at the fragment will be quarantined; the default (0) will never quarantine. Only fragments older than `quarantine\_age` (default: `reclaim\_age`) may be quarantined. Before quarantining, the reconstructor will attempt to fetch fragments from handoff nodes in addition to the usual primary nodes; a new `request\_node\_count` option (default `2 \* replicas`) limits the total number of nodes to contact.
 \* Added a delay before deleting non-durable data. A new configuration option, `commit\_window` in the `[DEFAULT]` section of object-server.conf, adjusts this delay; the default is 60 seconds. This improves the durability of both back-dated PUTs (from the reconciler or container-sync, for example) and fresh writes to handoffs by preventing the reconstructor from deleting data that the object-server was still writing.
 \* Improved proxy-server and object-reconstructor logging when data cannot be reconstructed.
 \* Fixed an issue where some but not all fragments having metadata applied could prevent reconstruction of missing fragments.
 \* Server-side copying of erasure-coded data to a replicated policy no longer copies EC sysmeta. The previous behavior had no material effect, but could confuse operators examining data on disk.
 \* Python 3 fixes:
 \* Fixed a server error when performing a PUT authorized via tempurl with some proxy pipelines.
 \* Fixed a server error during GET of a symlink with some proxy pipelines.
 \* Fixed an issue with logging setup when /dev/log doesn't exist or is not a UNIX socket.
 \* The container-reconciler now scales out better with new `processes`, `process`, and `concurrency` options, similar to the object-expirer.
 \* The dark-data audit watcher now skips objects younger than a new configurable `grace\_age` period. This avoids issues where data could be flagged, quarantined, or deleted because of listing consistency issues. The default is one week.
 \* The dark-data audit watcher now requires that all primary locations for an object's container agree that the data does not appear in listings to consider data "dark". Previously, a network partition that left an object node isolated could cause it to quarantine or delete all of its data.
 \* More daemons now support systemd notify sockets.
 \* `EPIPE` errors no longer log tracebacks.
 \* The account and container auditors now log and update recon before going to sleep.
 \* The object-expirer logs fewer client disconnects.
 \* `swift-recon-cron` now includes the last time it was run in the recon information.
[View remainder of file in raw view](https://github.com/openstack/swift/raw/refs/heads/master/CHANGELOG)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from git.openstack.org_5098f906_20250126_093648.html ===

This website requires JavaScript.
[![Logo](/assets/img/logo.svg)](/)

[Explore](/explore/repos)
[Get Started](https://docs.opendev.org/opendev/infra-manual/latest/gettingstarted.html)

![OpenDev](/assets/img/opendev.svg)

![Gitea](/assets/img/git.svg)
[Code hosting](https://opendev.org/explore/organizations)

![Gerrit](/assets/img/gerrit.svg)
[Code review](https://review.opendev.org/)

![Zuul CI](/assets/img/zuul.svg)
[Continuous integration](https://zuul.opendev.org/)

![Etherpad](/assets/img/etherpad.svg)
[Collaborative editing](https://etherpad.opendev.org/)

## What is OpenDev?

OpenDev is a collaboratory for open source software
development at scale. Its focus is on code review, continuous
integration, and project hosting provided exclusively through open source
solutions like Git, Gerrit, Zuul, and Gitea. It also provides a number of
peripheral collaboration services (like Mailman mailing lists, IRC bots for
notifications and annotating text-based meetings, Jitsi-Meet for
videoconference discussions integrated with Etherpad for collective text
editing). All of these services are openly operated by the community, and
continuously integrated and deployed using OpenDev itself.

## How is development different with OpenDev

OpenDev doesn't use a pull request (or merge request)
workflow, like those implemented by GitHub or Gitlab. Instead it follows
Gerrit's iterative change proposal workflow, which results in a slightly
different experience.

In GitHub or Gitlab, contribution typically starts by
forking a personal copy of the original repository, cloning that locally, and
pushing one or more commits to that personal fork. Once your code seems ready
to merge, you ask the service to create a pull request for your branch into the
original repository. The pull request is reviewed, and if accepted your changes
get merged into the original repository. If not, you push more commits to your
fork and update the request seeking more reviews.

By contrast, contribution with Gerrit starts by cloning
the original repository locally. You iterate on development of one or more
local commits, and then use git push (or the git-review tool) to propose your
commits as a series of changes to the Gerrit code review service. Each change
in the series is reviewed, and if it's accepted (and passing tests) then it
gets merged into the original repository. If more work is needed, you amend
the same commits and push new versions of them for re-review.

The difference is subtle, but significant. In the
pull request model, you create a fork of the original repository, push
changes to it, and ultimately propose to merge changes back. In the change
proposal model, you prepare a change, and propose it. You do not create a
complete fork and everyone contributes into the same original repository with
what are basically lightweight, ephemeral topic branches. It results in less
fragmentation overall, and avoids confusion between the original repository and
its numerous forks.

That high-level difference also affects lower-level
details. A pull request may contain several commits, and if merged all those
commits will appear in the original repository history. In Gerrit, every commit
is a separate change (optionally depending on other related changes) for code
reviewers to review, so developers squash or amend edits made while developing
to represent the desired final state of that change. Each prior revision of a
change is still retained by the service, as are all the review comments, so
updates can be compared side-by-side for a clear picture of how the change
evolved. It generally results in easier code review, but also a cleaner branch
history with the commit messages reviewed as an integral part of each
change.

In summary, the Gerrit workflow, its user experience and
UI are different from the pull request workflow. While it may not be
immediately familiar to developers used to pull request workflows, it's worth
learning. Long-term benefits outweigh the short-term cost of having to learn a
new tool, especially for someone who is going to spend a lot of time developing
for that project anyway.

## Integrated Continuous Integration

One key benefit of OpenDev is that it integrates
powerful continuous integration features, made possible by the donation of
compute resources from our generous infrastructure partners. Test jobs are
run when changes are proposed and provide code reviewers with valuable
information. Test jobs also run again at merge time, in case recently approved
changes introduce an incompatibility, preventing code which doesn't pass tests
from merging to the repository.

Advanced Zuul features like speculative execution of
tests allow the testing of sequenced changes in parallel, so development
velocity is rarely limited by how thorough you want your tests to be. Changes
in one Git repository can depend on proposed changes in another repository,
allowing integration testing of features actively developed across multiple
projects, removing artificial barriers between development teams.

This advanced continuous integration system was
developed to sustain the complexity and scale of OpenStack development, one of
the three most actively developed open source projects in the world. OpenDev
makes this system available to other projects, enabling open development at
scale for everyone.

## Free software needs free tools

Finally, another key difference between OpenDev and
other development infrastructure services like GitHub or Gitlab.com is that
it's built purely using open source software. GitHub and Gitlab.com are
provided free of charge for open source projects, but they are both implemented
using proprietary code. If development of your free and open source software
requires interaction with proprietary code, is it truly free (as in
freedom)?

It is widely accepted today that using open source
technology reduces your reliance on outside parties and enables innovation. It
should be obvious that developing software by using open source toolchains has
the same effect. Nothing prevents a service provider from changing its terms of
service, creating new limitations, blocking access for contributors connecting
from specific countries, or even fully removing your project. Proprietary
development services create the same form of hard limits, lock-in and
dependency that proprietary software does, and prevent open innovation in the
development infrastructure space.

OpenDev is entirely built using open source software,
but goes one step beyond: it is also openly operated. Even its operation
tooling and configuration is open source, lives in Git, and is
continuously-deployed. It serves as a clear example of transparent
collaboration for systems administration. Like free and open source software,
it requires engaging with its community to get the most of it -- OpenDev is not
a service you consume, it's a community you join. That can be a bit
overwhelming if you just want to focus on development, especially when
ready-to-consume services are available. But it's worth it, especially if you
want to have a say in what services are provided, or just support the idea of
improving open source tools in that space.

## Cloud Donors

These are the companies generously donating the cloud infrastructure where we host our service control plane and operate [pools of Zuul test resources](https://docs.opendev.org/opendev/system-config/latest/contribute-cloud.html):

[![Rackspace](/assets/img/donors/rackspace.jpg)](https://openinfra.dev/a/members/profile/5/rackspace)

[![VEXXHOST, Inc.](/assets/img/donors/vexxhost.jpg)](https://openinfra.dev/a/members/profile/5/vexxhost-inc)

[![OVHcloud](/assets/img/donors/ovh.jpg)](https://openinfra.dev/a/members/profile/5/ov-hcloud)

[![OpenMetal](/assets/img/donors/openmetal.jpg)](https://openinfra.dev/a/members/profile/5/open-metal)

## FAQ

### Isn’t this just OpenStack Infrastructure rebranded?

It is more than that. We want to make this toolset
available to others that would find it helpful. OpenStack is one of the OpenDev
tenants, but other tenants like Zuul or $gizmo would be just as important.

### Can I host my project on OpenDev?

Yes! However, as noted above it is still early days yet
and the early experience might be a bit bumpy. Certain things may still say
“OpenStack” on them as we figure out the transition. And while any moves should
come with appropriate redirects, we may have some inadvertent misses.

### Can I run tests on Windows or OSX machines?

Currently all of our test resources are Linux based.
Adding additional platforms would likely require someone to help us get that
running, but Zuul will support systems with ansible connection plugins.
Talk to us!

### I am an existing OpenStack Infra user do I need to do anything?

No. We’ll continue to communicate changes as they
happen. We’ll also do our best to make this as smooth a transition as
possible. If we run into situations that force us to break something we’ll
be sure to let you know at that point.

### Is a CLA required for hosted repos?

No.

### What if I don’t like Gerrit and would prefer (insert tool here)?

We’ve got a fair bit of experience with the existing
toolset and adding new tools for which we’ve already got an answer is currently
out of scope. We think the existing tools (like Gerrit) work well, and should
only get better as we update them. The system is able to scale because we do
not need multiple implementations of different software that solve similar
problems.

### Why can't we use Gitea's issue tracker and wiki?

For scaling and redundancy purposes we are actually
running a number of independent Giteas behind a load balancer. We can keep
Git repos in sync from Gerrit reasonably well, but the issue tracker and
wiki functionality would need another level of state syncing. Once Gitea
can be run as a proper cluster this may change, but until then the
functionality is limited.

## Contact info

* IRC #opendev on OFTC ([logs](https://meetings.opendev.org/irclogs/%23opendev/))
* Mailing list: service-discuss@lists.opendev.org ([subscribe](https://lists.opendev.org/mailman3/lists/service-discuss.lists.opendev.org/), [archives](https://lists.opendev.org/archives/list/service-discuss%40lists.opendev.org/))
* Important announcements: service-announce@lists.opendev.org ([subscribe](https://lists.opendev.org/mailman3/lists/service-announce.lists.opendev.org/), [archives](https://lists.opendev.org/archives/list/service-announce%40lists.opendev.org/))
* Status updates on [Mastodon](https://fosstodon.org/%40opendevinfra)

## Service vulnerabilities

If you find or suspect a security issue with any OpenDev services, please inform the administrators via email at service-incident@lists.opendev.org.

[Powered by Gitea](https://about.gitea.com)
Version:
v1.23.1
Page: **1ms**
Template: **1ms**

 English
Bahasa Indonesia
Deutsch
English
Español
Français
Gaeilge
Italiano
Latviešu
Magyar nyelv
Nederlands
Polski
Português de Portugal
Português do Brasil
Suomi
Svenska
Türkçe
Čeština
Ελληνικά
Български
Русский
Українська
فارسی
മലയാളം
日本語
简体中文
繁體中文（台灣）
繁體中文（香港）
한국어

[Licenses](/assets/licenses.txt)
[API](/api/swagger)



=== Content from bugs.launchpad.net_e7cbd54a_20250126_093653.html ===

[Log in / Register](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Blogin)

[![](https://launchpadlibrarian.net/52141984/os64.png)](https://launchpad.net/swift)

## [OpenStack Object Storage (swift)](https://launchpad.net/swift)

* [Overview](https://launchpad.net/swift)
* [Code](https://code.launchpad.net/swift)
* [Bugs](https://bugs.launchpad.net/swift)
* [Blueprints](https://blueprints.launchpad.net/swift)
* [Translations](https://translations.launchpad.net/swift)
* [Answers](https://answers.launchpad.net/swift)

# [OSSA 2016-004] Download DLO objects leak connections when client kill connection (CVE-2016-0737)

Bug #1466549 reported by
[Romain LE DISEZ](https://launchpad.net/~rledisez)
on 2015-06-18

[264](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Object Storage (swift)](https://bugs.launchpad.net/swift) | Fix Released | Undecided | Unassigned | [OpenStack Object Storage (swift) 2.4.0](https://launchpad.net/swift/%2Bmilestone/2.4.0) |
| Nominated for Juno by [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | | | | | |
| Nominated for Kilo by [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) | | | | | |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |

### Bug Description

When a client is downloading a DLO object, if it interrupts its connection, the proxy does not close the connection to the object server

From my test, this bug impacts versions 1.10, 2.2.2 and master.

I flag this bug security vulnerability because it makes it easy to do a DoS on a proxy-server. It's actually what's happening to us because one of our user do VoD. It uses DLO a lot and close connections when his customers stop watching video.

How to reproduce on a fresh SAIO, with processes just started:

1. Upload an object in DLO

    $ dd if=/dev/zero of=2x1G bs=1M count=2048

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing post test

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing upload test -S 1073741824 2x1G

2. In an other terminal, watch connections between proxy-server and object-server:

   $ watch -n 1 "netstat -tapn | grep -E ':60[1-4]0' | grep ESTA"

(For now, you should see no connections)

3. Start to download the object, but stop it before the end (eg: CTRL+C)

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing download test 2x1G --no-download

(Now, you should see one connection)

4. Repeat step 3 and observe the connections stacking

Tags:

[in-feature-crypto](/swift/%2Bbugs?field.tag=in-feature-crypto)
[in-feature-hummingbird](/swift/%2Bbugs?field.tag=in-feature-hummingbird)
[in-stable-kilo](/swift/%2Bbugs?field.tag=in-stable-kilo)

## CVE References

* [2016-0737](/bugs/cve/2016-0737 "OpenStack Object Storage (Swift) befo...")
* [2016-0738](/bugs/cve/2016-0738 "OpenStack Object Storage (Swift) befo...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-18: |  |  | [#1](/swift/%2Bbug/1466549/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-06-18: |  |  | [#2](/swift/%2Bbug/1466549/comments/2) |
| --- | --- | --- | --- |

Based on <https://www.python.org/dev/peps/pep-0333/#specification-details>

"If the iterable returned by the application has a close() method, the server or gateway must call that method upon completion of the current request, whether the request was completed normally, or terminated early due to an error. (This is to support resource release by the application. This protocol is intended to complement PEP 325 's generator support, and other common iterables with close() methods."

here is a fix proposal : <https://review.openstack.org/#/c/193192/>

It passes all tests, but I'm not very familiar with wsgi. So i don't know all the implications of adding a close() method.

Based on https://www.python.org/dev/peps/pep-0333/#specification-details
"If the iterable returned by the application has a close() method, the server or gateway must call that method upon completion of the current request, whether the request was completed normally, or terminated early due to an error. (This is to support resource release by the application. This protocol is intended to complement PEP 325 's generator support, and other common iterables with close() methods."
here is a fix proposal : https://review.openstack.org/#/c/193192/
It passes all tests, but I'm not very familiar with wsgi. So i don't know all the implications of adding a close() method.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-06-18: |  |  | [#3](/swift/%2Bbug/1466549/comments/3) |
| --- | --- | --- | --- |

Eventually the object server will time out the connection, right? I mean, immediately after killing the client -> proxy connection, you'll see what appears to be a leaked connection from proxy -> obj, but if you wait a few minutes, the object server will time out and close the connection from its end.

Eventually the object server will time out the connection, right? I mean, immediately after killing the client -> proxy connection, you'll see what appears to be a leaked connection from proxy -> obj, but if you wait a few minutes, the object server will time out and close the connection from its end.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-06-18: |  |  | [#4](/swift/%2Bbug/1466549/comments/4) |
| --- | --- | --- | --- |

It might need more testing, but i didn't observe any connection timeout-ing.

On production, we see that leaked connections continue increasing for many hours, until the proxy cannot treat connections anymore. On my SAIO, after more than 20 minutes, connections were still not closed.

It might need more testing, but i didn't observe any connection timeout-ing.
On production, we see that leaked connections continue increasing for many hours, until the proxy cannot treat connections anymore. On my SAIO, after more than 20 minutes, connections were still not closed.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Samuel Merritt (torgomatic)](https://launchpad.net/~torgomatic) wrote on 2015-06-18: |  |  | [#5](/swift/%2Bbug/1466549/comments/5) |
| --- | --- | --- | --- |

This bug report should probably be marked as public since there's a patch in Gerrit referencing it.

For reference, when filing a security bug, attach patches to the LP bug, not in Gerrit. This is probably the only case where attaching patches to LP bugs is better than filing in Gerrit.

This bug report should probably be marked as public since there's a patch in Gerrit referencing it.
For reference, when filing a security bug, attach patches to the LP bug, not in Gerrit. This is probably the only case where attaching patches to LP bugs is better than filing in Gerrit.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-06-19: |  |  | [#6](/swift/%2Bbug/1466549/comments/6) |
| --- | --- | --- | --- |

Opening this bug now, does it affect stable releases ?

Opening this bug now, does it affect stable releases ?

| **information type**: | Private Security → Public Security |
| --- | --- |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2015-06-23

| Changed in swift: | |
| --- | --- |
| **status**: | New → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2015-07-06: |  |  | [#7](/swift/%2Bbug/1466549/comments/7) |
| --- | --- | --- | --- |

For the record, the patch which was eventually merged to address this (I think) seems to be <https://review.openstack.org/193303> . Does that mean that the issue described here is confirmed to be reproducible under most deployments?

For the record, the patch which was eventually merged to address this (I think) seems to be https://review.openstack.org/193303 . Does that mean that the issue described here is confirmed to be reproducible under most deployments?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-13:  [**Fix proposed to swift (master)**](/swift/%2Bbug/1466549/comments/8) |  |  | [#8](/swift/%2Bbug/1466549/comments/8) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: <https://review.openstack.org/201269>

Fix proposed to branch: master
Review: https://review.openstack.org/201269

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-13:  [**Change abandoned on swift (master)**](/swift/%2Bbug/1466549/comments/9) |  |  | [#9](/swift/%2Bbug/1466549/comments/9) |
| --- | --- | --- | --- |

Change abandoned by paul luse (<email address hidden>) on branch: master

Review: <https://review.openstack.org/201269>

Reason: going to redo this w/o the dependencies

Change abandoned by paul luse (paul.e.luse@intel.com) on branch: master
Review: https://review.openstack.org/201269
Reason: going to redo this w/o the dependencies

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Fix proposed to swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/10) |  |  | [#10](/swift/%2Bbug/1466549/comments/10) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/202227>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/202227

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Change abandoned on swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/11) |  |  | [#11](/swift/%2Bbug/1466549/comments/11) |
| --- | --- | --- | --- |

Change abandoned by Michael Barton (<email address hidden>) on branch: feature/hummingbird

Review: <https://review.openstack.org/202227>

Reason: Apparently I did this wrong.

Change abandoned by Michael Barton (mike@weirdlooking.com) on branch: feature/hummingbird
Review: https://review.openstack.org/202227
Reason: Apparently I did this wrong.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Fix proposed to swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/12) |  |  | [#12](/swift/%2Bbug/1466549/comments/12) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/hummingbird

Review: <https://review.openstack.org/202230>

Fix proposed to branch: feature/hummingbird
Review: https://review.openstack.org/202230

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-15:  [**Fix merged to swift (feature/hummingbird)**](/swift/%2Bbug/1466549/comments/13) |  |  | [#13](/swift/%2Bbug/1466549/comments/13) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/swift/%2Bbug/1466549/comments/13/%2Bdownload) (72.8 KiB)

Reviewed: <https://review.openstack.org/202230>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=f7cb1777e1b514b3345b9e516ed8f89ad1a4ae87>

Submitter: Jenkins

Branch: feature/hummingbird

commit 51f806d3e3d3a1fcbc80d2f7d7ddbe5cc4c024c9

Author: John Dickinson <email address hidden>

Date: Tue Jul 14 20:49:08 2015 -0700

remove Python 2.6 from the classifier

Change-Id: I67233e9c7b69826242546bd6bd98c24b81070579

commit 278adf5c20101a191979ce1e4d6277e5f209149e

Author: Hisashi Osanai <email address hidden>

Date: Tue Jul 14 15:33:45 2015 +0900

Make logic of unit tests responsive to the method names

The two methods, test\_authorize\_succeeds\_for\_tenant\_name\_in\_roles and

    test\_authorize\_succeeds\_for\_tenant\_id\_in\_roles, have names that don't

    match what they are testing. tenant\_name and tenant\_id need to be

    switched.

Change-Id: I7cb0a7d2b2111127fd5d6b55f2da6a3eadf2235d

commit 1cc3eff958fdd4fb07c2b74c52df7829d3125466

Author: Victor Stinner <email address hidden>

Date: Fri Jul 10 13:04:44 2015 +0200

Fixes for mock 1.1

The new release of mock 1.1 is more strict. It helped to find bugs in

    tests.

Closes-Bug: #1473369

    Change-Id: Id179513c6010d827cbcbdda7692a920e29213bcb

commit ff192cfe5705324497a389aa2f22227d75dc0f8e

Author: janonymous <email address hidden>

Date: Wed Jul 8 18:38:22 2015 +0530

Replace reduce and unichr , these are no longer available in py3

\* Replace reduce() with six.moves.reduce()

    \* Replace unichr with six.unichr

Change-Id: I2038e47e0a6522dd992fd2a4aeff981cf7750fe0

commit 4beceab4f4be99f14025815cf7ed4510ea77f460

Author: OpenStack Proposal Bot <email address hidden>

Date: Thu Jul 9 06:14:56 2015 +0000

Imported Translations from Transifex

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I9ff1dde06be45fc7d6c441a1e1c07221f839a9a1

commit 56ee39a7e13417203c5e1816d7a3184a07f85826

Author: Matthew Oliver <email address hidden>

Date: Thu Jul 9 15:19:32 2015 +1000

Ring builder code clean up follow up patch

This is a simple change that cleans up a NIT from Sam's 'stop moving

    partitions unnecessarily when overload is on' patch.

Change-Id: I9d9f1cc23e2bb625d8e158f4d3f64e10973176a1

commit 6cafd0a4c0bb8f311fc59df580b42e801214effd

Author: Oshrit Feder <email address hidden>

Date: Wed Jul 8 15:18:22 2015 +0300

Fix Container Sync example

Container-sync realm uses cluster\_ as a prefix to specify clusters'

    names. At use, the prefix should not be included. Fixing the examples

    and sample conf to make it clearer that only the name of the cluster

    should be passed.

Change-Id: I2e521d86faffb59e1b45d3f039987ee023c5e939

commit 125238612f58481316db68d7087252bb7729f447

Author: Janie Richling <email address hidden>

Date: Sat Jul 4 17:08:32 2015 -0500

Add CORS unit tests to base

In earlier versions of swift when a request was made with an

    existing origin, but without any CORS settings in the container,

    it was possible to get an u...

Reviewed: https://review.openstack.org/202230
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=f7cb1777e1b514b3345b9e516ed8f89ad1a4ae87
Submitter: Jenkins
Branch: feature/hummingbird
commit 51f806d3e3d3a1fcbc80d2f7d7ddbe5cc4c024c9
Author: John Dickinson <me@not.mn>
Date: Tue Jul 14 20:49:08 2015 -0700
remove Python 2.6 from the classifier
Change-Id: I67233e9c7b69826242546bd6bd98c24b81070579
commit 278adf5c20101a191979ce1e4d6277e5f209149e
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jul 14 15:33:45 2015 +0900
Make logic of unit tests responsive to the method names
The two methods, test\_authorize\_succeeds\_for\_tenant\_name\_in\_roles and
test\_authorize\_succeeds\_for\_tenant\_id\_in\_roles, have names that don't
match what they are testing. tenant\_name and tenant\_id need to be
switched.
Change-Id: I7cb0a7d2b2111127fd5d6b55f2da6a3eadf2235d
commit 1cc3eff958fdd4fb07c2b74c52df7829d3125466
Author: Victor Stinner <vstinner@redhat.com>
Date: Fri Jul 10 13:04:44 2015 +0200
Fixes for mock 1.1
The new release of mock 1.1 is more strict. It helped to find bugs in
tests.
Closes-Bug: #1473369
Change-Id: Id179513c6010d827cbcbdda7692a920e29213bcb
commit ff192cfe5705324497a389aa2f22227d75dc0f8e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jul 8 18:38:22 2015 +0530
Replace reduce and unichr , these are no longer available in py3
\* Replace reduce() with six.moves.reduce()
\* Replace unichr with six.unichr
Change-Id: I2038e47e0a6522dd992fd2a4aeff981cf7750fe0
commit 4beceab4f4be99f14025815cf7ed4510ea77f460
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 9 06:14:56 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9ff1dde06be45fc7d6c441a1e1c07221f839a9a1
commit 56ee39a7e13417203c5e1816d7a3184a07f85826
Author: Matthew Oliver <matt@oliver.net.au>
Date: Thu Jul 9 15:19:32 2015 +1000
Ring builder code clean up follow up patch
This is a simple change that cleans up a NIT from Sam's 'stop moving
partitions unnecessarily when overload is on' patch.
Change-Id: I9d9f1cc23e2bb625d8e158f4d3f64e10973176a1
commit 6cafd0a4c0bb8f311fc59df580b42e801214effd
Author: Oshrit Feder <oshritf@il.ibm.com>
Date: Wed Jul 8 15:18:22 2015 +0300
Fix Container Sync example
Container-sync realm uses cluster\_ as a prefix to specify clusters'
names. At use, the prefix should not be included. Fixing the examples
and sample conf to make it clearer that only the name of the cluster
should be passed.
Change-Id: I2e521d86faffb59e1b45d3f039987ee023c5e939
commit 125238612f58481316db68d7087252bb7729f447
Author: Janie Richling <jrichli@us.ibm.com>
Date: Sat Jul 4 17:08:32 2015 -0500
Add CORS unit tests to base
In earlier versions of swift when a request was made with an
existing origin, but without any CORS settings in the container,
it was possible to get an unhandled exception due to a method call
on the "None" return of cors.get('allow\_origin', '').
Unit tests have been added to assert that this problem cannot go
undetected again.
Change-Id: Ia74896dabe1cf5a307c551b15a43ab1fd789c213
Fixes: bug 1468782
commit e87a74695e2f55dbb0e01721de9d46e230e36008
Author: John Dickinson <me@not.mn>
Date: Sat Jun 6 13:03:15 2015 -0700
add domain\_remap to /info
Also added the value of default\_reseller\_prefix to /info. I did not
add the reseller\_prefixes value to /info because deployers may not
want to expose all of the resellers that are available.
Change-Id: I9ca2f002dc395913bb646390d6908dfb8f554df1
commit 12473104f005b76ebe4b6dbe118a5ac37518eb52
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 7 18:02:53 2015 -0700
Cleanup error messages in ECDiskFileWriter.commit
I think the error messages make better sense and it's more obvious what the
error handling code was trying to bring to the surface for operators.
If you run this test with nosetests --verbose --nocapture
test\_diskfile.py:TestECDiskFile.test\_commit\_fsync\_dir\_raises\_DiskFileErrors
... you can review most of the potential log output
Change-Id: I40c9d77f44e087ee61d9642e924b0a4039d6ca9a
commit bd3717df65f57da9e7f06292ba349442d17fc939
Author: John Dickinson <me@not.mn>
Date: Thu Jul 2 09:54:30 2015 -0700
update AUTHORS file
Change-Id: I509ceeb522bd83c407beb40c22c2924a1d92b8ff
commit cd20961abd20f01a14554c14d4f61a7f0d8deb88
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Jul 5 10:59:50 2015 +0530
Replace dict.iteritems() with dict.items() in bin directory of swift.
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3.
Change-Id: I4bdc064c90bab56cd60f2dca2a5a78426ffbb31c
commit 8eca02d3a1db1e0ed68b15ed41bc62e6c89870c7
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:45:58 2015 +0530
Replace xrange() with six.moves.range()
xrange is no longer available in py3.
replacing xrange with range from six.moves
Change-Id: Ib863c316a0724bd9c4f53c2e5a8d1bcd42c4dc5a
commit 10f367224d5f30c3398169ffe3087f225f3343fc
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:05:36 2015 +0530
Fix Python 3 issues
\* Replace long with six.integer\_type
six.integer\_type :In Python 2, this is long and int, and in Python 3,
just int.
'long' is an undefined variable in py3.
Change-Id: Ibe4c5d0d81fe883f4fe33be93a68d814a228ad28
commit 2328983b7535d24d08942e62095b4346f2626566
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jun 24 17:07:32 2015 -0700
Stop moving partitions unnecessarily when overload is on.
When overload was on and in use, the ring builder was unnecessarily
moving partitions. It would converge on a good solution and settle
down eventually, but it moved more partitions than necessary along the
way.
There are three partition gatherers used in the ring builder:
dev-removed, dispersion, and weight, in that order. The dev-removed
gatherer will pick up all partitions on removed devices. The
dispersion gatherer picks up replicas of partitions that are
suboptimally dispersed. The weight gatherer picks up partitions on
devices which are overweight.
The weight gatherer was not overload-aware, so it would pick up
partitions that did not need to move. Consider a device that would
normally have 100 partitions assigned, assume we set overload to 0.1
so that this device will hold up to 110 (10 extra) for the sake of
dispersion, and assume the device actually has 104 partitions assigned
to it. The correct behavior is to gather nothing from this device
because it has fewer than the maximum. Prior to this commit, the
weight gatherer would remove 4 partitions from this device; they would
subsequently be reassigned by the overload-aware partition placer
(\_reassign\_parts()). In a ring with multiple overloaded devices, the
builder would pick up some partitions from each, shuffle them, and
then assign them back to those same devices. Obviously, this just
created extra replication work for no benefit.
Now, the weight gatherer takes overload into account, and will no
longer needlessly gather partitions.
That's not all, though; this change worsened the behavior of a ring
with more overload than necessary. Before, the ring would balance as
best it could, using the minimal amount of overload. With the
weight-gatherer change, the ring builder will stop gathering
partitions once a device reaches its maximum-permissible assignment
including overload.
For example, imagine a 3-replica, 4-zone ring with overload=0.2 and
weights:
z1: 100
z2: 60
z3: 60
z4: 60
Since z1 has more than 1/3 of the weight, z2, z3, and z4 must take
more than their fair share for the sake of dispersion.
Now, turn up the weights some:
z1: 100
z2: 80
z3: 80
z4: 80
Overload is no longer needed; this ring can balance. However, z2, z3,
and z4 would end up keeping more than their fair share since (a) they
already had extra due to earlier conditions, and (b) the weight
gatherer won't pick up partitions from them since they're not
overburdened once it takes overload into account.
To fix this, we compute the minimum overload factor required for
optimal dispersion and then use min(user-input-overload,
minimum-overload) during rebalance. This way, we don't overload
devices more than the user says, but if the user sets overload higher
than necessary, we'll still give the best balance possible.
Change-Id: If5666ba654ee25da54f9144f3b78840273a49627
commit ccf0758ef1f362312a6197f86455f680ebd990d3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 11 15:40:28 2015 -0700
Add ring-builder analyzer.
This is a tool to help developers quantify changes to the ring
builder. It takes a scenario (JSON file) describing the builder's
basic parameters (part\_power, replicas, etc.) and a number of
"rounds", where each round is a set of operations to perform on the
builder. For each round, the operations are applied, and then the
builder is rebalanced until it reaches a steady state.
The idea is that a developer observes the ring builder behaving
suboptimally, writes a scenario to reproduce the behavior, modifies
the ring builder to fix it, and references the scenario with the
commit so that others can see that things have improved.
I decided to write this after writing my fourth or fifth hacky one-off
script to reproduce some bad behavior in the ring builder.
Change-Id: I114242748368f142304aab90a6d99c1337bced4c
commit e860ec138913dc4c450725766a77e76a7101d06e
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 29 10:11:44 2015 +0000
Ignore invalid PIDs in swift-init
While reviewing ab9f6340 I recognized that invalid pids in the pid files raise
an exceptions (in case it is not a number), and also accept a 0 that is
impossible to use as a pid for any Swift process. In the latter case the process
was recognized as runnning, even if it did not - and thus restarting didn't
worked.
This patch ensures a better handling of any non-numeric value and also removes a
pid file if it uses 0 as the pid.
Change-Id: I09c415c7a75e4b9a0574a08f46f48fff5bb11d02
commit 0a6f2ab870a868e3036dbb212c0e7dd8375a39eb
Author: asettle <alexandra.settle@rackspace.com>
Date: Fri Jun 26 10:57:35 2015 +1000
Correcting minor grammatical errors
1. Removing unnecessary semi colon
2. Removing unnecessary content
Change-Id: Ie95403a4d96db2b8465e75495061fc059098c922
commit 4d4db054d35c7e9de9ed28ac24965e8408dd9f82
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Mon May 18 14:08:25 2015 -0500
After the .durable has been written, fsync the directory.
Added try-except statements in \_finalize\_durable() to fsync the directory
after a successful fsync of the .durable file.
Added test\_commit\_fsync\_dir\_raises\_DiskFileErrors() for testing whether
certain assertions hold for the change to include fsync\_dir().
Some more error details have been included in the logger.
Closes-Bug: #1470651
Change-Id: I4791d75ade8542678369ba0811ef39af6e955cc6
commit d4d7c0e1b11af8f20f965f410901a56e1f8ee69e
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jun 30 17:24:13 2015 -0700
Fix race in test\_server.TestObjectController.test\_PUT\_ssync\_multi\_frag
If the test ran across a one second boundary it would fail because while
the timestamp normalization was doing some rounding it was making no
attempt to reuse the same timestamp on subsequent requests.
Change-Id: Ic560032bcfacd6f0d10cfc0f4f10e5d6c2bc8dd5
commit a88bd6e6b9253b6488a2bf1a354ce29b51f37fe1
Author: ZhiQiang Fan <aji.zqfan@gmail.com>
Date: Sun Jun 28 22:04:46 2015 -0700
fix api overview document
The content about Object Storage HTTP requests constraints seems to
be a table but broken, this patch fixes it into correct rst table format.
Change-Id: I1b4c62da3e6d91add3ee0218707c1628c8f04b33
commit c95a0efe7973a660f4abcd13f4ea6211d72c4baa
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:44:10 2015 -0700
Make ssync\_sender a better HTTP client
When a server responses with an error - if that error includes a body - the
client should read the body. This cleans up some ugly eventlet/wsgi.server log
output related to chunked transfer disconnect (invalid literal for int() with
base 16).
Change-Id: Ibd06ddee9f216fce07fa33c3a7d8306b59eb6d77
Closes-Bug: #1466138
commit 44b76a1b1b83ac9563010f1ddfca5fca76e567bf
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Thu Jun 18 14:21:06 2015 -0500
EC Reconstructor: Do not reconstruct existing fragments.
The EC reconstructor needs to verify that the fragment needing to
be reconstructed does not reside in the collection of node responses.
Otherwise, resources will be spent unnecessarily reconstructing
the fragment. Moreover, this could cause a segfault on some backends.
This change adds the necessary verification steps to make sure
that a fragment will only be rebuilt in the case it is missing from
the other fragment archives.
Added some tests to provide coverage for these scenarios.
Change-Id: I91f3d4af52cbc66c9f7ce00726f247b5462e66f9
Closes-Bug: #1452553
commit d124ce5792d93e1efcdb083211ecef381f7b7173
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:35:07 2015 -0700
Fix ValueError in ssync\_receiver
httplib's putheader method will cast whatever you give it to a string.
where we allow the default dict.get default of None to be passed to
putheader unmodified ssync\_receiver is surpised that the non-empty
string isn't able to be converted to an integer.
We can avoid surprising the ssync\_receiver in this way by sending the
empty string as a better default.
Change-Id: Ie9df9927ff4d3dd3f334647f883b2937d0d81030
commit edfca861b6fa39972df276fb1f37aa81583a605d
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri Jun 26 08:54:22 2015 +0000
Increase httplib.\_MAXHEADERS
Python 2.7.9+ and 3.2.6+ limits the number of maximum headers in httplib to 100
[1,2,3]. This setting is too low for Swift.
By default the maximum number of allowed headers depends on the number of max
allowed metadata settings plus a default value of 32 for regular http headers.
If for some reason this is not enough (custom middleware for example) it can be
increased with the extra\_header\_count constraint.
[1] https://bugs.python.org/issue16037
[2] https://hg.python.org/cpython/raw-file/15c95b7d81dc/Misc/NEWS
[3] https://hg.python.org/cpython/raw-file/v3.2.6/Misc/NEWS
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Co-Authored-By: Thomas Herve <therve@redhat.com>
Change-Id: I388fd697ec88476024b0e9f1ae75ba35ff765282
commit 81ceee056de604d81a921280f453731eadf7be09
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jun 22 23:24:19 2015 -0700
Add one more test for ssync\_receiver
To prevent 409 conflict on a primary node during ssyncing,
ssync-receiver should add x-ssync-backend-frag-index generated from
x-ssync-backend-node-index of the SSYNC replication request header.
The change is done by previous work[1], but we need more test for that.
This patch addes one more assertion if the x-ssync-backend-frag-index
is in the ssync subrequest correctly.
\*BONUS\*
Fix some weird mock and add some sanities.
1: https://review.openstack.org/#/c/191521/
Change-Id: I27aff713c69017c0bc4c60b4833184e1285595d7
commit c2c1366b0794bcdbbbaef7fedaef2cab19cd8db8
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jun 24 21:07:16 2015 +0530
Fixed Errors in Swift-Form Post middleware section rst.
Inline markup cannot be nested in RST.
Fixing markups by using a single option for the whole line and making
some minor error corrections.
Change-Id: I42bfd7dfe5c93a69436ecc5d154f2e61ca83fa82
commit 514daea6317edc02587f7abfaae8770e1ef9cc4b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jun 12 23:40:51 2015 +0530
Fixed Formatting Error in Swift -Form Post middleware section.
Fixed Formatting error in ``action=”SWIFT\_URL``” => action=”``SWIFT\_URL``”
Change-Id: Id461129ef7f5b6412f94d36920c942a4181c0eb7
Closes-Bug: #1464740
commit e70b66586e13718e7ac0078c2f2cd1135c61a1f1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed Jun 24 09:36:37 2015 +0200
Replace dict.iteritems() with dict.items()
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3. According to a discussion on the openstack-dev mailing list,
the overhead of creating a temporary list using dict.items() on Python 2
is very low because most dictionaries are small:
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066391.html
Patch generated by the following command:
sed -i 's,iteritems,items,g' \
$(find swift -name "\*.py") \
$(find test -name "\*.py")
Change-Id: I6070bb6c684be76e8e77222a7d280ec6edd43496
commit e6165a7879d796efd3992260ef23a7f95ceeab32
Author: paul luse <paul.e.luse@intel.com>
Date: Mon May 25 14:41:42 2015 -0700
Add policy support to dispersion tools
Doesn't work for anything other than policy 0. updated to allow user
to specify policy name on cmd line (as with object-info) which
then makes populate/report work with 3x, 2x, or EC style policies
Change-Id: Ib7c298f0f6d666b1ecca25315b88539f45cf9f95
Closes-Bug: 1458688
commit e5c962a28ce99f01c6cd0b68b7434ddcd0e55f62
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon May 25 18:28:02 2015 +0200
Replace xrange() with six.moves.range()
Patch generated by the xrange operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Manual changes:
\* Fix indentation for pep8 checks
\* Fix TestGreenthreadSafeIterator.test\_access\_is\_serialized of
test.unit.common.test\_utils:
replace range(1, 11) with list(range(1, 11))
\* Fix UnsafeXrange docstring, revert change
Change-Id: Icb7e26135c5e57b5302b8bfe066b33cafe69fe4d
commit 4a5b851207c98a380a32e27a183dd98022be9d16
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 22 14:48:41 2015 +0200
Add note about updatedb to the docs
Change-Id: Ia1aa0bb1f93ee487e2f7ddf76a7a08efa8f3ba41
commit ac8a76958510646c369df9ffc2bf22005e43d153
Author: paul luse <paul.e.luse@intel.com>
Date: Sat Jun 13 11:03:56 2015 -0700
EC Ssync: Update parms to include node and frag indices
Previously we sent the ssync backend frag index based on the node
index. We need to be more specific for ssync to handle both sync
and revert cases so now we send the frag index based on the job
contents (as determined by the ec recon)) and the node index
as a new header based on, well, the node index.
The rcvr can now validate the incoming pair to reject (400) when
a primary node is being asked to accept fragments that don't
belong to it. Additionally, by having the frag index the
rcvr can reject (409) an attempt to accept a fragment when its
a handoff and already has one that needs to be reverted.
Fixes-bug: #1452619
Change-Id: I8287b274bbbd00903c1975fe49375590af697be4
commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
Closes-Bug: #1466549
commit df134df901a13c2261a8205826ea1aa8d75dc283
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu May 14 22:14:15 2015 -0700
Allow 1+ object-servers-per-disk deployment
Enabled by a new > 0 integer config value, "servers\_per\_port" in the
[DEFAULT] config section for object-server and/or replication server
configs. The setting's integer value determines how many different
object-server workers handle requests for any single unique local port
in the ring. In this mode, the parent swift-object-server process
continues to run as the original user (i.e. root if low-port binding
is required), binds to all ports as defined in the ring, and forks off
the specified number of workers per listen socket. The child, per-port
servers drop privileges and behave pretty much how object-server workers
always have, except that because the ring has unique ports per disk, the
object-servers will only be handling requests for a single disk. The
parent process detects dead servers and restarts them (with the correct
listen socket), starts missing servers when an updated ring file is
found with a device on the server with a new port, and kills extraneous
servers when their port is found to no longer be in the ring. The ring
files are stat'ed at most every "ring\_check\_interval" seconds, as
configured in the object-server config (same default of 15s).
Immediately stopping all swift-object-worker processes still works by
sending the parent a SIGTERM. Likewise, a SIGHUP to the parent process
still causes the parent process to close all listen sockets and exit,
allowing existing children to finish serving their existing requests.
The drop\_privileges helper function now has an optional param to
suppress the setsid() call, which otherwise screws up the child workers'
process management.
The class method RingData.load() can be told to only load the ring
metadata (i.e. everything except replica2part2dev\_id) with the optional
kwarg, header\_only=True. This is used to keep the parent and all
forked off workers from unnecessarily having full copies of all storage
policy rings in memory.
A new helper class, swift.common.storage\_policy.BindPortsCache,
provides a method to return a set of all device ports in all rings for
the server on which it is instantiated (identified by its set of IP
addresses). The BindPortsCache instance will track mtimes of ring
files, so they are not opened more frequently than necessary.
This patch includes enhancements to the probe tests and
object-replicator/object-reconstructor config plumbing to allow the
probe tests to work correctly both in the "normal" config (same IP but
unique ports for each SAIO "server") and a server-per-port setup where
each SAIO "server" must have a unique IP address and unique port per
disk within each "server". The main probe tests only work with 4
servers and 4 disks, but you can see the difference in the rings for the
EC probe tests where there are 2 disks per server for a total of 8
disks. Specifically, swift.common.ring.utils.is\_local\_device() will
ignore the ports when the "my\_port" argument is None. Then,
object-replicator and object-reconstructor both set self.bind\_port to
None if server\_per\_port is enabled. Bonus improvement for IPv6
addresses in is\_local\_device().
This PR for vagrant-swift-all-in-one will aid in testing this patch:
https://github.com/swiftstack/vagrant-swift-all-in-one/pull/16/
Also allow SAIO to answer is\_local\_device() better; common SAIO setups
have multiple "servers" all on the same host with different ports for
the different "servers" (which happen to match the IPs specified in the
rings for the devices on each of those "servers").
However, you can configure the SAIO to have different localhost IP
addresses (e.g. 127.0.0.1, 127.0.0.2, etc.) in the ring and in the
servers' config files' bind\_ip setting.
This new whataremyips() implementation combined with a little plumbing
allows is\_local\_device() to accurately answer, even on an SAIO.
In the default case (an unspecified bind\_ip defaults to '0.0.0.0') as
well as an explict "bind to everything" like '0.0.0.0' or '::',
whataremyips() behaves as it always has, returning all IP addresses for
the server.
Also updated probe tests to handle each "server" in the SAIO having a
unique IP address.
For some (noisy) benchmarks that show servers\_per\_port=X is at least as
good as the same number of "normal" workers:
https://gist.github.com/dbishop/c214f89ca708a6b1624a#file-summary-md
Benchmarks showing the benefits of I/O isolation with a small number of
slow disks:
https://gist.github.com/dbishop/fd0ab067babdecfb07ca#file-results-md
If you were wondering what the overhead of threads\_per\_disk looks like:
https://gist.github.com/dbishop/1d14755fedc86a161718#file-tabular\_results-md
DocImpact
Change-Id: I2239a4000b41a7e7cc53465ce794af49d44796c6
commit af72881d1dcc46486d8d652b92a0ec9aa9ca2bfa
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jun 15 13:36:36 2015 -0700
Use just IP, not port, when determining partition placement
In the ring builder, we place partitions with maximum possible
dispersion across tiers, where a "tier" is region, then zone, then
IP/port,then device. Now, instead of IP/port, just use IP. The port
wasn't really getting us anything; two different object servers on two
different ports on one machine aren't separate failure
domains. However, if someone has only a few machines and is using one
object server on its own port per disk, then the ring builder would
end up with every disk in its own IP/port tier, resulting in bad (with
respect to durability) partition placement.
For example: assume 1 region, 1 zone, 4 machines, 48 total disks (12
per machine), and one object server (and hence one port) per
disk. With the old behavior, partition replicas will all go in the one
region, then the one zone, then pick one of 48 IP/port pairs, then
pick the one disk therein. This gives the same result as randomly
picking 3 disks (without replacement) to store data on; it completely
ignores machine boundaries.
With the new behavior, the replica placer will pick the one region,
then the one zone, then one of 4 IPs, then one of 12 disks
therein. This gives the optimal placement with respect to durability.
The same applies to Ring.get\_more\_nodes().
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ibbd740c51296b7e360845b5309d276d7383a3742
commit 09e7477a391e7425af62a6516f43c69bc98b7080
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jun 15 22:10:45 2015 +0530
Replace it.next() with next(it) for py3 compat
The Python 2 next() method of iterators was renamed to \_\_next\_\_() on
Python 3. Use the builtin next() function instead which works on Python
2 and Python 3.
Change-Id: Ic948bc574b58f1d28c5c58e3985906dee17fa51d
commit 5ad369c1cb0f480b164a5b5e7eb194081835c266
Author: Victor Stinner <vstinner@redhat.com>
Date: Tue Jun 9 00:22:12 2015 +0200
Add six requirement
The six module is needed to add Python 3 support to Swift.
Change-Id: Ie637ed3458c7ff56c26834bca73203ed55604d74
commit 037a0c5dbe01a57b741d34988e21f4f763b6204b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jun 6 17:42:41 2015 +0530
Object are sorted and concatenated by swift in cardinal order.
Modified values in example in decimal to be more precise,
added a small description on Object are sorted and concatenated
by swift in cardinal order as a small phrase would be sufficient.
Change-Id: I914ded4e5726e50bb93b05759c3bfb76edda53ab
backport: none
Closes-Bug: #1383893
commit 11e5c4adf0e02c8fdab0d8584fc943d96e1165cd
Author: Koert van der Veer <koert@cloudvps.com>
Date: Tue Dec 16 11:15:19 2014 +0100
Allow default reseller prefix in domain\_remap middleware
Previously, the reseller prefix needed to be provided in the host name
even when the domain was unique to that reseller. With the
default\_reseller\_prefix, any domain which matches in this middleware,
will will be passed on with a reseller prefix, whether or not it was
provided.
Change-Id: I5aa5ce78ad1ee2e3660cce4c3e07306f8999f02a
Implements: blueprint domainremap-reseller-domains
commit c953e8cc9049e94cd01239d5e4a30a56f26a97d3
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Tue Apr 28 13:18:32 2015 -0500
The hash\_cleanup\_listdir function should only be called when necessary.
Introduced a conditional that will specify to \_finalize\_put() whether
the put() method is being called within the context of ECDiskFileWriter.
Included some unit tests that will test the number of calls to
hash\_cleanup\_listdir() during put(), commit(), and delete()
operations.
Change-Id: I287b2648591fdbf686898dc9047beda80a64da0c
commit 93de6c73e587a672663fa0997f439b73b336769c
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jun 2 17:00:42 2015 +0900
Add metadata size tests on the border
This patch adds a test for a 204 when a single metadata item in a POST causes
the backend aggregate constraints check to be on the border.
Background:
Overall metadata size constraint is enforced in the container and
account backends as well as in the proxy controllers.
Whereas the proxy controller can check that constraints are not exceeded
by a single PUT or POST request, the backend checks that constraints are not
exceeded by the aggregate of all PUTs and POSTs.
The change [1] added a test for a 400 when a single metadata item in
a POST causes the backend aggregate constraints check to go over limit.
[1] I1489e29686013cbd3d70283d8756b548aea3c2e1
Change-Id: Iac86ea71240ddde177e625c279c21aef67659d10
commit af734b3fb6fdbc11b8a0b775256e7642eb485b8d
Author: Mark Seger <Mark.Seger@hp.com>
Date: Wed Jun 3 08:16:06 2015 -0400
Change usage help and Attention messages to warnings
Change-Id: I1396aaffe36e739606f15f7fef37b11bd83f1fc1
commit 4f2ed8bcd0468f3b69d5fded274d8d6b02ac3d10
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri Mar 20 09:56:30 2015 -0700
EC: support multiple ranges for GET requests
This commit lets clients receive multipart/byteranges responses (see
RFC 7233, Appendix A) for erasure-coded objects. Clients can already
do this for replicated objects, so this brings EC closer to feature
parity (ha!).
GetOrHeadHandler got a base class extracted from it that treats an
HTTP response as a sequence of byte-range responses. This way, it can
continue to yield whole fragments, not just N-byte pieces of the raw
HTTP response, since an N-byte piece of a multipart/byteranges
response is pretty much useless.
There are a couple of bonus fixes in here, too. For starters, download
resuming now works on multipart/byteranges responses. Before, it only
worked on 200 responses or 206 responses for a single byte
range. Also, BufferedHTTPResponse grew a readline() method.
Also, the MIME response for replicated objects got tightened up a
little. Before, it had some leading and trailing CRLFs which, while
allowed by RFC 7233, provide no benefit. Now, both replicated and EC
multipart/byteranges avoid extraneous bytes. This let me re-use the
Content-Length calculation in swob instead of having to either hack
around it or add extraneous whitespace to match.
Change-Id: I16fc65e0ec4e356706d327bdb02a3741e36330a0
commit f1f4bb30cd8ad930ddb7a232b2744b48e35a0480
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Jun 2 19:51:39 2015 +0000
Fix testing issues
When functional tests are run in tox and an exception is raised when connecting
to Swift (for example: Swift not running, missing python-keystoneclient package
used by python-swiftclient) 0 tests are executed, but tox returns a success.
An exception is raised during tests, caused by a missing python-keystoneclient
in python-swiftclient. Instead of adding python-keystoneclient as a dependency
in python-swiftclient the package is added to the test-requirements.txt in Swift
itself. Note that adding python-keystoneclient to the test-requirements in
python-swiftclient is not sufficient (it's already in there).
The exception in setup\_package() is catched by the openstack.nose\_plugin, thus
disabling this plugin for now as well.
Also fixing two test errors seen on the gate regarding the tempurl middleware.
There was also an update to tox, environment variables were no longer passed
with versions >= 2.0 (http://tox.readthedocs.org/en/latest/changelog.html).
Swift test environment variables have been added to the passenv to re-enable the
former behavior, as well as environment variables required to pass proxy
settings.
This also led to skipped tempauth tests, and together with the missing
python-keystoneclient no tests were executed.
Related-Bug: 1461440
Related-Bug: 1455102
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Ideea071017d04912c60ed0bc76532adbb446c31d
commit 2759a6f159d4a90e4ad4c8e9e479085d195f8d14
Author: Pradeep Kumar Singh <pradeep.singh@nectechnologies.in>
Date: Wed May 13 21:18:02 2015 +0530
Handle Disk IO error Exception in swift account auditor
Swift account auditor fails to quarantine corrupt db due to
Disk IO error. This patch fixes that by handling Disk IO Error
Exception.
Closes-Bug:1169189
Change-Id: I031ee2a5775e4a88d4fb00d972d553936147c42e
commit 1bef06eec8f5f780914ac701d63f9c498b29119b
Author: Michael Barton <mike@weirdlooking.com>
Date: Sun May 31 23:10:15 2015 +0000
Don't quarantine on read\_metadata ENOENT
An operation that removes an existing .ts or .meta out from under another
concurrent operation at the right point can cause the whole object to be
needlessly quarantined.
Closes-Bug: #1451520
Change-Id: I37d660199e54411d0610889f9ee230b13747244b
commit 8b4af92dac813d707d124b3be37df586260fe74a
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Jun 1 17:57:25 2015 +0100
Tighten up overall metadata size tests
Overall metadata size constraint is enforced in the container and account
backends as well as in the proxy controllers. Whereas the proxy controller
can check that constraints are not exceeded by a single PUT or POST request,
the backend checks that constraints are not exceeded by the aggregate of all
PUTs and POSTs.
The current functional tests only exercise the proxy controller checks, since
they test for a 400 when sending excessive metadata in a single POST. This patch
adds a test for a 400 when a single metadata item in a POST causes the backend
aggregate constraints check to go over limit.
The extra coverage of the new assertions can be seen by modifying
swift/common/db.DatabasBroker.validate\_metadata() to always return None
immediately - only the new assertions fail when functests are run.
Change-Id: I1489e29686013cbd3d70283d8756b548aea3c2e1
commit b4c1d73ad56e0705d1c5dd1fc4f1d89b09fceff1
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 1 06:50:33 2015 +0000
Make swift-recon compatible for servers without storage policies
Swift recon introduced a new key for storage policies, and the CLI expected this
key in the server response. However, if one updates the CLI but not yet the
server an exception will be raised, because there is no default value and no
check if the key is included in the response.
This change checks if the policies key is included in the response and updates
one test to ensure backward compability.
Closes-Bug: 1453599
Change-Id: I7c7a90f9933bec2ab45595df9dc600a6cba65666
commit 38787d0fb5102e41b153e4629d2ef374a02965e9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:19:54 2015 -0700
Remove simplejson from staticweb
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This lets us get rid of some redundant Unicode encoding. Before, we
would take the container-listing response off the wire,
JSON-deserialize it (str -> unicode), then pass each of several fields
from each entry to get\_valid\_utf8\_str(), which would encode it,
(unicode -> str), decode it (str -> unicode), and then encode it again
(unicode -> str) for good measure.
The net effect was that each object's name would, in the proxy server,
go str -> unicode -> str -> unicode -> str.
By replacing simplejson with stdlib json, we get a guarantee that each
container-listing entry's name, hash, content\_type, and last\_modified
are unicodes, so we can stop worrying about them being valid UTF-8 or
not. This takes an encode and decode out of the path, so we just have
str -> unicode -> str. While it'd be ideal to avoid this, the first
transform (str -> unicode) happens when we decode the
container-listing response body (json.loads()), so there's no way out.
Change-Id: I00aedf952d691a809c23025b89131ea0f02b6431
commit 736cf54adf3ee85d2f473e5e5374f9833422967c
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu May 28 15:30:47 2015 -0700
Remove simplejson from tests
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This commit just takes simplejson out of the unit and functional
tests. They still pass.
Change-Id: I96f17df81fa5d265395a938b19213d2638682106
commit 68c30b80b47c281c549d101c43d79e718e91d21d
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu May 28 06:08:12 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I0c7b2bdb0edcc3bb3fa06903ec8457ca5e2dd688
commit 5374ba3a80a5b895542196502eac4d9300ba53d2
Author: John Dickinson <me@not.mn>
Date: Wed May 27 12:28:04 2015 -0700
drop Python 2.6 testing support
Change-Id: I78f21e5794e8ba7a095f03d279247516a241f555
commit 191f2a00bd9121fddc03d8f07f15e5e34790541e
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 16:39:23 2015 +0100
Remove \_ensure\_flush() from SSYNC receiver
The Receiver.\_ensure\_flush() method in ssync\_receiver.py has
the following comment:
Sends a blank line sufficient to flush buffers.
This is to ensure Eventlet versions that don't support
eventlet.minimum\_write\_chunk\_size will send any previous data
buffered.
If https://bitbucket.org/eventlet/eventlet/pull-request/37
ever gets released in an Eventlet version, we should make
this yield only for versions older than that.
The reference pull request was included with eventlet 0.14 [1] and
swift now requires >=0.16.1 so it is safe to remove \_ensure\_flush()
and save > 8k bytes per SSYNC response.
[1] https://bitbucket.org/eventlet/eventlet/commits/4bd654205a4217970a57a7c4802fed7ff2c8b770
Change-Id: I367e9a6e92b7ea75fe7e5795cded212657de57ed
commit 3aa06f185ac4256a8883c565bdc90b1ffbd519ca
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 09:17:46 2015 +0100
Make SSYNC receiver return a reponse when initial checks fail
The ssync Receiver performs some checks on request parameters
in initialize\_request() before starting the exchange of missing
hashes and updates e.g. the destination device must be available;
the policy must be valid. Currently if any of these checks fails
then the receiver just closes the connection, so the Sender gets
no useful response code and noise is generated in logs by httplib
and wsgi Exceptions.
This change moves the request parameter checks to the Receiver
constructor so that the HTTPExceptions raised are actually sent
as responses. (The 'connection close' exception handling still
applies once the 'missing\_check' and 'updates' handshakes are in
progress.)
Moving initialize\_request() revealed the following lurking bug:
\* initialize\_request() sets
req.environ['eventlet.minimum\_write\_chunk\_size'] = 0
\* this was previously ineffective because the Response environ
had already been copied from Request environ before this value
was set, so the Response never used the value :/
\* Now that it is effective (a good thing) it causes the empty string
yielded by the receiver when there are no missing hashes in
missing\_checks() to be sent to the sender immediately. This makes
the Sender.readline() think there has been an early disconnect
and raise an Exception (a bad thing), as revealed by
test/unit/obj/test\_ssync\_sender.py:TestSsync.test\_nothing\_to\_sync
The fix for this is to simply make the receiver skip sending the empty
string if there are no missing object\_hashes.
Change-Id: I036a6919fead6e970505dccbb0da7bfbdf8cecc3
commit bb716573ab5c8455348ec013feb894421e0e1f1c
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed May 20 00:39:41 2015 -0700
Allow SLO PUTs to forgo per-segment integrity checks
While manifests still require 'etag' and 'size\_bytes' fields for each
segment (to catch user errors like 'etaf' or 'size\_btyes'), an explicit
null for either will skip that particular integrity check and instead
use whatever value is retrieved when HEADing the segment. So, if a user
uploads a manifest like:
[{"path": "/con/obj\_seg\_1", "etag": null, "size\_bytes": 1048576},
{"path": "/con/obj\_seg\_2", "etag": "etag2", "size\_bytes": null},
{"path": "/con/obj\_seg\_3", "etag": null, "size\_bytes": null}]
then the etag will only be verified for the /con/obj\_seg\_2 segment,
and the segment size will only be verified for the /con/obj\_seg\_1
segment. However, the manifest that's ultimately stored (and can be
retrieved with a ?multipart-manifest=get query-string) will still look
like:
[{"name": "/con/obj\_seg\_1", "hash": "etag1", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_2", "hash": "etag2", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_3", "hash": "etag3", "bytes": 1234, ...}]
This allows the middleware to continue performing integrity checks on
object GET.
Change-Id: I2c4e585221387dd02a8679a50398d6b614407b12
DocImpact
commit a1c327022c70907ccc159d6203de26b37c3a4586
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:43:55 2015 -0700
Remove simplejson from swift-recon
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
All swift-recon was doing with json was decoding a JSON response (from
the recon middleware) and printing it to the terminal. This still
works just fine.
Change-Id: I28cf25a7c2856f230d4642c62fb8bf9c4d37e9e5
commit a3559edc2342e2cf92a5188336ab263ffd038554
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Apr 17 16:30:30 2015 -0700
Exclude local\_dev from sync partners on failure
If the primary left or right hand partners are down, the next best thing
is to validate the rest of the primary nodes. Where the rest should
exclude not just the left and right hand partners - but ourself as well.
This fixes a accidental noop when partner node is unavailable and
another node is missing data.
Validation:
Add probetests to cover ssync failures for the primary sync\_to nodes for
sync jobs.
Drive-by:
Make additional plumbing for the check\_mount and check\_dir constraints into
the remaining daemons.
Change-Id: I4d1c047106c242bca85c94b569d98fd59bb255f4
commit 666bf06c26bc9e0d6256d054835386e50e67b8a2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed May 6 16:29:06 2015 -0700
EC: don't 503 on marginally-successful PUT
On EC PUT in an M+K scheme, we require M+1 fragment archives to
durably land on disk. If we get that, then we go ahead and ask the
object servers to "commit" the object by writing out .durable
files. We only require 2 of those.
When we got exactly M+1 fragment archives on disk, and then one
connection timed out while writing .durable files, we should still be
okay (provided M is at least 3). However, we'd take our M > 2
remaining successful responses and pass that off to best\_response()
with a quorum size of M+1, thus getting a 503 even though everything
worked well enough.
Now we pass 2 to best\_response() to avoid that false negative.
There was also a spot where we were getting the quorum size wrong. If
we wrote out 3 fragment archives for a 2+1 policy, we were only
requiring 2 successful backend PUTs. That's wrong; the right number is
3, which is what the policy's .quorum() method says. There was a spot
where the right number wasn't getting plumbed through, but it is now.
Change-Id: Ic658a199e952558db329268f4d7b4009f47c6d03
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Closes-Bug: 1452468
commit e7c8c578d9e5b0aa7e56b02bd9c39baa99d2d6ae
Author: Michael MATUR <michael.matur@gmail.com>
Date: Mon May 25 15:13:01 2015 +0200
fixup!Patch of "parse\_content\_disposition" method to meet RFC2183
The spec of Content-Disposition does not require a space character after
comma: http://www.ietf.org/rfc/rfc2183.txt
Change-Id: Iff438dc36ce78c6a79bb66ab3d889a8dae7c0e1f
Closes-Bug: #1458497
commit af8d842076ba269fed7f4128d0c7503ab5d1a94a
Author: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Date: Tue Oct 21 09:24:25 2014 +0000
Replaced setting run\_pause with standard interval
The deprecated directive `run\_pause` should be replaced with the more
standard one `interval`. The `run\_pause` should be still supported for
backward compatibility. This patch updates object replicator to use
`interval` and support `run\_pause`. It also updates its sample config
and documentation.
Co-Authored-By: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Co-Authored-By: Kamil Rykowski <kamil.rykowski@intel.com>
Change-Id: Ie2a3414a96a94efb9273ff53a80b9d90c74fff09
Closes-Bug: #1364735
commit f11d92d566757a54ff1e3800ec0bfac098347a68
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri May 22 16:58:04 2015 -0700
Add swift-durability-calculator line to docs
This commits add a line (link and small doc) for
swift-durability-calculator which provides a browser based
durability calculation tool to docs as an associated project.
Change-Id: I4ea8015f512616dc25072080bef79b8734971ccf
commit f864092455ebcd40b3568633c3524cc5c64d3309
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed May 20 17:50:07 2015 -0700
Add Swift Inspector to assoicated projects
Change-Id: I5b5448674ea455119a51509ab5e7cd11a764b5a7
commit e54781a2aa29808aff654861d8a0aafd24b6620c
Author: Thiago da Silva <thiago@redhat.com>
Date: Tue May 19 20:27:06 2015 +0000
add object post and delete methods to BaseObjectController
Adding post and delete methods to BaseObjectController that can
be overriden by ObjectCOntroller subclasses. These methods are
similar to the PUT and GET methods that were introduced as part
of the EC work
Change-Id: I197364bc3e2f2287c0afc8948863e3cdeab90383
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit ab9f63402de6d554528699a02955854ac28264c5
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Mon Nov 24 21:44:03 2014 +0900
Add process name checking into swift-init
Swift-init uses pid files to detect existing swift processes by pid.
However, it mistakes an unrelated process for a swift process and makes
a wrong decision, when the unrelated process is running with pid written
in swift pid files.
This patch adds process name checking into swift-init and enable it to remove
invalid pid files in such situation.
Change-Id: Ibca026bdfbdacdd92c8763e1eb15d98293c70656
Closes-Bug: #1327106
commit aa4866eb6014d7fbb8531eb5d927d5611ebfd06d
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed May 13 20:10:59 2015 +0000
move replication code to ReplicatedObjectController
Moving \_connect\_put\_node, send\_file, \_transfer\_data and \_store\_object
methods to ReplicatedObjectController. Each one of these methods are
specific to replication policy. EC policy implements their own
version of them.
Of these four methods, only \_store\_object and \_connect\_put\_node are
required to be implemented by the policy specific Object Controllers.
Change-Id: Ifc72461b77dbfdaae9d63417f1286e8b5da3ca4e
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit 025c4c4339e7ace2f5be8cb3a3cddf6c38ceff37
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Apr 24 02:15:36 2015 -0700
Remove confusable query string on post as copy
Current post as copy routine (i.e. POST object with post\_as\_copy option
turned on) on Object Controller uses "multipart-manifest" query string
which is feeded to env['copy\_hook'] to decide which data (the manifest or
object pointed by the manifest) should be copied.
However, the way using the query string will confuse operators looking at
logging system (or analyzing the log) because whole POST object requests
have 'multipart-manifest=get' like as:
POST /v1/AUTH\_test/d4c816b24d38489082f5118599a67920/manifest-abcde%3Fmultipart-manifest%3Dget
We cannot know whether the query string was added by hand
(from user) or not. In addition, the query isn't needed by the
backend conversation between proxy-server and object-server.
(Just needed by "copy\_hook" on the proxy controller!)
To remove the confusable query string and to keep the log to be clean,
this patch introduces new environment variable "swift.post\_as\_copy"
and changes proxy controller and the copy\_hook to use the new env.
This item was originally discussed at
https://review.openstack.org/#/c/177132/
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: I0cd37520eea1825a10ebd27ccdc7e9162647233e
commit 98b725fec639c5501c645ce4e4dc9d12c686f91d
Author: Alistair Coles <alistair.coles@hp.com>
Date: Fri May 1 13:02:29 2015 +0100
Cleanup and extend end to end ssync tests
Extends the existing end to end ssync tests with
a test using replication policy.
Also some cleanup and improvements to the test framework e.g. rather
than faking the connection between sender and receiver, use a real
connection and wrap it to capture traffic for verification.
Change-Id: Id71d2eb3fb8fa15c016ef151aacf95f97196a902
commit 518262ab6ecd8faa2b915df118ffc70a30112a18
Author: paul luse <paul.e.luse@intel.com>
Date: Tue May 12 15:21:13 2015 -0700
Remove 1 line of dead code from EC reconstructor
Assuming nobody intentionally left this in here for some reason...
Change-Id: I4bf43bb3828e062c0342557243076ed62d6790f4
commit 29f4393d88426fd6c34f2cfe43a8c434bfad8d47
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri May 8 15:55:14 2015 -0700
Remove workaround for old eventlet version
Swift now requires eventlet >= 0.16.1, so we can get rid of this
workaround for a bug in eventlet 0.9.16.
Change-Id: I4a1200b9bd9266896a704a840fda0d1b720bc86d
commit 90b84d3a699811a99c97ebbe4f71a14d2f76a0e5
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri May 8 11:45:12 2015 -0700
Properly re-raise exceptions in proxy\_logging
Previously, this could encounter TypeErrors, presumably because
sys.exc\_clear() was called somewhere in the block of code between
catching the exception and re-raising.
Related-Bug: 1181146
Change-Id: Iadeea3f61e70bf83dc0eb063fdb27edd16f3ca32
commit 664a632c01f8c5c80826b223b9ade774bfe2ed9a
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 8 08:41:39 2015 +0200
Update my mailmap entry
Change-Id: I5d21a55d0fa4cab6eaa6ff426819aa1dc997de2f
commit 0b20a18e5216b991855c461e41e9ef32e17fadb4
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Thu May 7 13:16:15 2015 -0600
Spell "rebalance" right in swift-ring-builder.1
See Red Hat bug #1218269.
Change-Id: I814eb4b3c0821f5a8df5feea2bda3a964aace536
commit 1faad248f833735585aa8f6135babceb46fbb6f8
Author: Emmanuel Cazenave <contact@emcaz.fr>
Date: Tue May 5 12:31:22 2015 +0200
X-Auth-Token should be a bytestring.
Change-Id: I2aa941d74883e17e9548b0144a4a2e2db33aba95
Closes-Bug: 1451773
commit 55dd705a863c4500330cbd2b8c2fec46d618dc71
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Wed May 6 19:53:09 2015 +0200
Add missing statsd metrics section for object-reconstructor
Change-Id: Id3f98e5f637ff537a387262b40f21c05876fca91
commit c77c79b2c9b9ca7790c29577341cf36c5e9012cf
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue May 5 06:08:09 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9b0156c7fc315182d80604bf353586455bbc34d1
commit 94215049fd37f810ddf4e6b8122cce02aea3e6e3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon May 4 15:08:51 2015 -0700
Bump up a timeout in a test
Got a slow crappy VM like I do? You might see this fail
occasionally. Bump up the timeout a little to help it out.
Change-Id: I8c0e5b99012830ea3525fa55b0811268db3da2a2
commit 03536dbb55c219b94389e635babec2df2e2759fa
Author: Prashanth Pai <ppai@redhat.com>
Date: Wed Apr 29 12:11:59 2015 +0530
Fix incorrect passing of file object to fsync()
swift.common.utils.fsync() requires a file descriptor as argument
but file object handle was being passed.
Change-Id: I316b58f6bc37de0945eff551e4e50565653664f5
Signed-off-by: Prashanth Pai <ppai@redhat.com>
commit bfbc94c3cb34eb9ff288fb817dee667cc870d9eb
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Apr 28 10:45:50 2015 +0100
Fix intermittent container replicator test failure
Intermittent failure of this test could be due to
insufficient time elapsing between either the local
and remote db's being created or during the
debug\_timing calls. This patch forces greater timestamp
separation and forces debug\_timing to always log timings.
Also add message to the failign assertion so if this does
fail again we get some clue as to why.
Closes-Bug: 1369663
Change-Id: I4b69b2e759d586a14abd0931a68dbdf256d57c32
commit dbb9d4b7938f24ee588d260c9b51ca65d5095749
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Mon Apr 27 08:52:18 2015 +0200
Add missing docstring in direct\_client
Added a missing docstring to the direct\_delete\_container method.
Also checked other docstrings in the same file and fixed a wrong docstring
element in direct\_delete\_object. Added raises: docstring entry to all methods
that raise an Exception.
Change-Id: If463a0f9ddff3fe2d13f6d97fcfa955e91d0f01f
commit 8cdf0fdebe9eb782322fccfc11253dc959cf321d
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Apr 27 13:29:50 2015 -0700
Fix account replication during pre-storage-policy upgrade
Old account schemas don't send the storage\_policy\_index key for container rows
during replication, and if the recieving end is already running an upgraded
server it is surprised with a KeyError. Normally this would work itself out
if the old schema recieved any updates from container layer, or a new
container is created, or requires a row sync from another account database -
but if the account databases have rows out of sync and there's no activity in
the account otherwise, there's nothing to force the old schemas to be
upgraded.
Rather than force the old schema that already has a complete set of container
rows to migrate even in the absense of activity we can just fill in default
legacy value for the storage policy index and allow the accounts to get back
in sync and migrate the next time a container update occurs.
FWIW, I never able to get a cluster upgrade to get stuck in this state without
some sort of account failure that forced them to get their rows out of sync
(in my cause I just unlinked a pending and then made sure to force all my
account datbases to commit pending files before upgrading - leading to an
upgraded cluster that absolutly needed account-replication to solve a row
mismatch for inactive accounts with old schemas)
Closes-Bug #1424108
Change-Id: Iaf4ef834eb24f0e11a52cc22b93a864574fabf83
commit 03380380efb5d5c0b2a3acfaa64b486ee2cb6e64
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Apr 23 19:39:16 2015 -0700
Simplify ring.builder.RingBuilder.\_\_deepcopy\_\_
Only container classes (lists, sets, dicts, graphs, collections,
etc) need to track objects they deepcopy in the memo dict -
particularly when they may contain other containers! As they
recreate a new container with the same items as themselves, they'll
reference the memo for each item they contain before making a
deepcopy of it, and place a reference to the copied item into memo
after they do. Trying to help out some other container class in
this endeavor by attempting to add ourselves to the memo dict in
some useful manor on their behalf however; is not helpful.
All we need to do to make sure we're being a good \_\_deepcopy\_\_
implementation is make sure we pass on memo to our calls of deepcopy
so that other container classes can avoid making additional
deepcopy's of our containers if they already have a memorized copy
(which would be odd since unique instances of RingBuilders aren't
expected to share state, but hey - python doesn't have private
attributes so you never know!)
Change-Id: Ifac444dffbf79d650b2d858f6282e05d8ea741a0
commit 43ace3c62893364b6e3c130df56438995627598d
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 12:17:56 2015 -0700
Make RingBuilders deep-copy-able
We used to be able to deep-copy RingBuilder objects, but the addition
of debug logging (8d3b3b2) broke that since you can't deep-copy a
Python logger. This commit fixes that.
Swift doesn't really deep-copy RingBuilders anywhere, but third-party
code might.
Change-Id: If8bdadd93d9980db3d8a093f32d76ca604de9301
commit 215cd551df8be066edafd2a1e16d0bd143ec214b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Apr 21 17:38:04 2015 -0700
Bulk upload: treat user xattrs as object metadata
Currently, if you PUT a single object, then you can also associate
metadata with it by putting it in the request headers, prefixed with
"X-Object-Meta". However, if you're bulk-uploading objects, then you
have no way to assign any metadata.
The tar file format\* allows for arbitrary UTF-8 key/value pairs to be
associated with each file in an archive (as well as with the archive
itself, but we don't care about that here). If a file has extended
attributes, then tar will store those as key/value pairs.
This commit makes bulk upload read those extended attributes, if
present, and convert those to Swift object metadata. Attributes
starting with "user.meta" are converted to object metadata, and
"user.mime\_type"\*\* is converted to Content-Type.
For example, if you have a file "setup.py":
$ setfattr -n user.mime\_type -v "application/python-setup" setup.py
$ setfattr -n user.meta.lunch -v "burger and fries" setup.py
$ setfattr -n user.meta.dinner -v "baked ziti" setup.py
$ setfattr -n user.stuff -v "whee" setup.py
This will get translated to headers:
Content-Type: application/python-setup
X-Object-Meta-Lunch: burger and fries
X-Object-Meta-Dinner: baked ziti
Swift will handle xattrs stored by both GNU and BSD tar\*\*\*. Only
xattrs user.mime\_type and user.meta.\* are processed; others are
ignored.
This brings bulk upload much closer to feature-parity with non-bulk upload.
\* The POSIX 1003.1-2001 (pax) format, at least. There are a few
different, mutually-incompatible tar formats out there, because of
course there are. This is the default format on GNU tar 1.27.1 or
later.
\*\* http://standards.freedesktop.org/shared-mime-info-spec/latest/ar01s02.html#idm140622087713936
\*\*\* Even with pax-format tarballs, different encoders store xattrs
slightly differently; for example, GNU tar stores the xattr
"user.rubberducky" as pax header "SCHILY.xattr.user.rubberducky",
while BSD tar (which uses libarchive) stores it as
"LIBARCHIVE.xattr.user.rubberducky". One might wonder if this is
some programmer's attempt at job security.
Change-Id: I5e3ce87d31054f5239e86d47c45adbde2bb93640
commit f8dee761bd36f857aa1288c27e095907032fad68
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:15:35 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Note: This is part of importing of translations, there are no new
translations for this project, thus only the pot file gets updated.
Change-Id: I0cbfdae3bd1662da54c58e91a13f49419eba9b2d
commit cd7c58e93690fd25f5266754d0593c656dd51e2e
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Closes-Bug: 1446801
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 281cb1c210f0292bad190cabaae447145fa5eade
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Closes-Bug: 1446727
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit 51e31c5c7147f3ba61437e132b12b491ca718ce4
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Apr 15 15:31:06 2015 -0700
Don't apply the wrong Etag validation to rebuilt fragments
Because of the object-server's interaction with ssync sender's
X-Backend-Replication-Headers when a object (or fragment archive) is
pushed unmodified to another node it's ETag value is duped into the
recieving ends metadata as Etag. This interacts poorly with the
reconstructor's RebuildingECDiskFileStream which can not know ahead of
time the ETag of the fragment archive being rebuilt.
Don't send the Etag from the local source fragment archive being used as
the basis for the rebuilt fragent archive's metadata along to ssync.
Closes-Bug: 1446800
Change-Id: Ie59ad93a67a7f439c9a84cd9cff31540f97f334a
commit 2080f7dbd897d6130542dbf88e37641a41625eb5
Author: Alistair Coles <alistair.coles@hp.com>
Date: Thu Feb 26 15:16:22 2015 +0000
Fix tempauth acl checks when simplejson has no speedups
As documented in linked bug report, tempauth unit tests
were seen to fail on a system where simplejson was
installed but without the speedups extension. This
is because the tempauth account acl validation checks
that values are type str, but without the speedups
extension the json parser is returning unicode objects.
Fix is to have the acl validator tolerate those objects
being unicode or str.
Also change common/bufferedhttp.py to coerce ring device
to type str when constructing a path, in order to avoid
a UnicodeDecodeError when httplib sends a message that
has non-ascii header values.
Change-Id: I01524282cbaa25dc4b6dfa09f3f4723516cdba99
Closes-Bug: 1425776
commit 27f6fba5c3b9e0461d52c1deffe32130e7e9af51
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 0c391d6daffe1943f6def803db42e08e6d6846d2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 16:47:10 2015 -0700
SAIO instructions: ensure ~/bin exists before copying into it
Change-Id: I16cd211b00b529ccc4b46f6b10497c32b6741896
commit c5c281ba6dd97a301ba80511e3356d6ca536d701
Author: Minwoo B <minwoob@us.ibm.com>
Date: Mon Apr 20 17:03:25 2015 -0500
Included step in development\_saio.rst for installing dependencies in requirements.txt.
Change-Id: I6ed1704148e5ae1e3164d10080c350d81856f7a9
commit 2203b46e3f14ef68a090aaea284f0a0442bbb86f
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit f6482bdece27144ee083a53d696469528d7940c2
Author: Thierry Carrez <thierry@openstack.org>
Date: Thu Apr 16 22:08:47 2015 +0200
Set default branch to stable/kilo
Open stable/kilo branch by setting defaultbranch for git-review.
Change-Id: I81bcda30f99173416eaaa3f1d42da32f3ab5b6d2
commit a2a5b6aa6664b61fa31d25f329426ff089372f17
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Apr 16 11:42:12 2015 -0700
Functional test for SLO PUT overwriting one of its own segments
Change-Id: I4855816848f4fdb148d0b82735cf79bc68429617
commit e4d326b5a7dd186d762726faa45733ff2900343d
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Thu Feb 19 17:38:10 2015 +0900
Fix conflict SLO reponse
This patch fixes Swift to respond "409 Conflict"
when a segment object path of the manifest on PUT SLO
is same as requested object path. It is because
the request will overwrite the segment and then it
will absolutely cause "409 Conflict" on GET SLO.
e.g.:
request:
PUT "http://hostname/v1/AUTH\_account/container/segment\_object\_00?multipart-manifest=put"
manifest file:
[{"path" : "container/segment\_object\_00", "etag" : "<etag of segment\_object\_00>", "size\_bytes" : <size of segment\_object\_00>},
{"path" : "container/segment\_object\_01", "etag" : "<etag of segment\_object\_01>", "size\_bytes" : <size of segment\_object\_01>},
{"path" : "container/segment\_object\_02", "etag" : "<etag of segment\_object\_02>", "size\_bytes" : <size of segment\_object\_02>}]
Change-Id: I4f4f7b9dbeb6a7c355b801c7e0ae560aa19a70b4
Closes-Bug: 1417936
commit 38ae7bb89c95292c171cb89c1d62859cee0cc24f
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Apr 15 23:03:21 2015 +0100
Make the reaper use same timestamp for replica deletes
The account reaper is using a unique timestamp when deleting
replicas of the same resource. This will result in unnecessary
replication traffic after reaping.
This patch makes the reaper use a single timestamp per resource.
Probe test is modified to check that delete times are equal
across replicas before replicators run.
test\_direct\_client.py is modified to check that it uses explicit
timestamp when passed to direct\_delete\_[object|container]
methods.
Drive-by bug fixes in the probe test e.g. it was not sending
X-Backend-Storage-Policy-Index when doing a direct GET to check
object state, so the 404s being verified could in fact be due
to diskfile not existing rather than diskfile being deleted.
Closes-Bug: 1442879
Change-Id: I8bab22d66308bb9d3294e1e0def017c784228423
commit 9c33bbde6923b26f111572ae967a3b97a8ab12f2
Author: Prashanth Pai <ppai@redhat.com>
Date: Tue Jan 20 12:14:32 2015 +0530
Allow rsync to use compression
From rsync's man page:
-z, --compress
With this option, rsync compresses the file data as it is sent to the
destination machine, which reduces the amount of data being transmitted --
something that is useful over a slow connection.
A configurable option has been added to allow rsync to compress, but only
if the remote node is in a different region than the local one.
NOTE: Objects that are already compressed (for example: .tar.gz, .mp3)
might slow down the syncing process.
On wire compression can also be extended to ssync later in a different
change if required. In case of ssync, we could explore faster
compression libraries like lz4. rsync uses zlib which is slow but offers
higher compression ratio.
Change-Id: Ic9b9cbff9b5e68bef8257b522cc352fc3544db3c
Signed-off-by: Prashanth Pai <ppai@redhat.com>

| **tags**: | added: in-feature-hummingbird |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-24:  [**Fix proposed to swift (feature/crypto)**](/swift/%2Bbug/1466549/comments/14) |  |  | [#14](/swift/%2Bbug/1466549/comments/14) |
| --- | --- | --- | --- |

Fix proposed to branch: feature/crypto

Review: <https://review.openstack.org/205579>

Fix proposed to branch: feature/crypto
Review: https://review.openstack.org/205579

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-07-24:  [**Fix merged to swift (feature/crypto)**](/swift/%2Bbug/1466549/comments/15) |  |  | [#15](/swift/%2Bbug/1466549/comments/15) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/swift/%2Bbug/1466549/comments/15/%2Bdownload) (80.5 KiB)

Reviewed: <https://review.openstack.org/205579>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=8ab46b64365b8eab80680f2562f81e8adb3032a3>

Submitter: Jenkins

Branch: feature/crypto

commit 89f705e8aab144092d40a13fc4ef19ffef5f3eba

Author: OpenStack Proposal Bot <email address hidden>

Date: Thu Jul 23 06:11:27 2015 +0000

Imported Translations from Transifex

For more information about this automatic import see:

    <https://wiki.openstack.org/wiki/Translations/Infrastructure>

Change-Id: I94cf347564cb33977f33b1e64259bcb39a8cf809

commit a65e9db8752793ec37b594dc9eca5066171825db

Author: Christian Schwede <email address hidden>

Date: Wed Jul 22 10:43:17 2015 +0000

Removing commented out code in test/unit/account/test\_backend.py

Noticed this while reviewing another change. Looks like the test itself already

    ensures correct functionality of the reclaim() method in AccountBroker without

    the commented code, thus removing this stale code.

Change-Id: I6a26a7591adef9fd794ca68a4e9c493d1127f93c

commit 99d052772a9585e0befdfd292fd03aefde77180a

Author: Kota Tsuyuzaki <email address hidden>

Date: Mon Jul 13 01:12:43 2015 -0700

Fix 499 client disconnected on COPY EC object

Currently, a COPY request for an EC object might go to fail as 499 Client

    disconnected because of the difference between destination request content

    length and actual transferred bytes.

That is because the conditional response status and content length for

    an EC object range GET is handled at calling the response instance on

    proxy server. Therefore the calling response instance (resp()) will change

    the conditional status from 200 (HTTP\_OK) to 206 (PartialContent) and will

    change the content length for the range GET.

In EC case, sometimes Swift needs whole stored contents to decode a segment.

    It will make 200 HTTP OK response from object-server and proxy-server

    will unfortunately set whole content length to the destination content

    length and it makes the [bug 1467677](/bugs/1467677).

This patch introduces a new method "fix\_conditional\_response" for

    swift.common.swob.Response that calling \_response\_iter() and cached the

    iter in the Response instance. By calling it, Swift can set correct condtional

    response any time after setting whole content\_length to the response

    instance like EC case.

Change-Id: If85826243f955d2f03c6ad395215c73daab509b1

    Closes-Bug: #1467677

commit 62ed4f81ef80440550633eaaaa962a4f9383c2d3

Author: Timur Alperovich <email address hidden>

Date: Tue Jul 14 16:56:44 2015 -0700

Add two functional tests for delimiter.

The first test verifies that a delimiter will trim entries beyond the

    first matching instance of delimiter (after the given matching prefix,

    if any) and squash duplicates. So, when setting the delimiter

    to "-", given blobs "test", "test-foo" and "test-bar-baz", we expect

    only "test" (no matching delim) and "test-" (trim all characters after

    the first "-", and squash duplicates).

The second test verifies that when a prefix is provid...

Reviewed: https://review.openstack.org/205579
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=8ab46b64365b8eab80680f2562f81e8adb3032a3
Submitter: Jenkins
Branch: feature/crypto
commit 89f705e8aab144092d40a13fc4ef19ffef5f3eba
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 23 06:11:27 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I94cf347564cb33977f33b1e64259bcb39a8cf809
commit a65e9db8752793ec37b594dc9eca5066171825db
Author: Christian Schwede <cschwede@redhat.com>
Date: Wed Jul 22 10:43:17 2015 +0000
Removing commented out code in test/unit/account/test\_backend.py
Noticed this while reviewing another change. Looks like the test itself already
ensures correct functionality of the reclaim() method in AccountBroker without
the commented code, thus removing this stale code.
Change-Id: I6a26a7591adef9fd794ca68a4e9c493d1127f93c
commit 99d052772a9585e0befdfd292fd03aefde77180a
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jul 13 01:12:43 2015 -0700
Fix 499 client disconnected on COPY EC object
Currently, a COPY request for an EC object might go to fail as 499 Client
disconnected because of the difference between destination request content
length and actual transferred bytes.
That is because the conditional response status and content length for
an EC object range GET is handled at calling the response instance on
proxy server. Therefore the calling response instance (resp()) will change
the conditional status from 200 (HTTP\_OK) to 206 (PartialContent) and will
change the content length for the range GET.
In EC case, sometimes Swift needs whole stored contents to decode a segment.
It will make 200 HTTP OK response from object-server and proxy-server
will unfortunately set whole content length to the destination content
length and it makes the bug 1467677.
This patch introduces a new method "fix\_conditional\_response" for
swift.common.swob.Response that calling \_response\_iter() and cached the
iter in the Response instance. By calling it, Swift can set correct condtional
response any time after setting whole content\_length to the response
instance like EC case.
Change-Id: If85826243f955d2f03c6ad395215c73daab509b1
Closes-Bug: #1467677
commit 62ed4f81ef80440550633eaaaa962a4f9383c2d3
Author: Timur Alperovich <timur.alperovich@gmail.com>
Date: Tue Jul 14 16:56:44 2015 -0700
Add two functional tests for delimiter.
The first test verifies that a delimiter will trim entries beyond the
first matching instance of delimiter (after the given matching prefix,
if any) and squash duplicates. So, when setting the delimiter
to "-", given blobs "test", "test-foo" and "test-bar-baz", we expect
only "test" (no matching delim) and "test-" (trim all characters after
the first "-", and squash duplicates).
The second test verifies that when a prefix is provided, the delimiter
will trim entries beyond the first matching instance of the delimiter
\*after the given prefix\*. So "bar, "bazar" which both match the
prefix "ba" will be returned as "bar" (no delimiter after the matching
prefix) and "baza" (after matching the prefix the remainder after the
the \*next\* matching delimiter "a" is trimmed).
Change-Id: I49a2aa8722f83e87b7d211e5c26827e93963d92a
commit 2d6c5fe2afde382edb8f04c91fca1911601b61d9
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 21 09:56:13 2015 -0700
Fix Associated Projects link on Getting Started
Change-Id: I50be656bc5868242489f97c96a1feaef171933e0
commit cd7b2db550e41412281da0256b468c90ebcf3e8b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Tue Jul 21 19:23:00 2015 +0530
unit tests: Replace "self.assert\_" by "self.assertTrue"
The assert\_() method is deprecated and can be safely replaced by assertTrue().
This patch makes sure that running the tests does not create undesired
warnings.
Change-Id: I0602ba39ef93263386644ee68088d5f65fcb4a71
commit c3cc98b2c918476f1b54924e0c54e4c746eba4ac
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jul 20 17:03:20 2015 -0700
Add comment about ResumingGetter.used\_source\_etag
This confused a couple developers and took about ten minutes to
unravel in IRC; let's leave a clue for the next person.
Change-Id: I356c8c7a44de23f02eaf68d23a39c9eb4c203ff1
commit 06326d74657a8796439988115002298e4a5f4630
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jul 20 21:41:58 2015 +0530
Metaclass Python 3.x Compatibility
use "six.add\_metaclass" instead of "\_\_metaclass\_\_"
Change-Id: I57390fec40afe3a965be3215db8f79b9cf862a70
commit 317fa1af49d72ecaf7a9a499d8cdf00a086b4c6f
Author: Azhagu Selvan SP <tamizhgeek@gmail.com>
Date: Sat Jul 18 14:37:16 2015 +0530
Minor change in development saio setup doc
Make the test-requirements install command uniform with the rest of the
setup commands in the page by using the $HOME, instead of hardcoding
the folder path.
Change-Id: I8da7a191a301601e27f894f8268238d77b150ede
commit faff98efd47fd59e28b1adb3e7ad4bc3dc6dd781
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Thu Jul 9 07:35:47 2015 +0530
Replace python print operator with print function (pep H233, py33)
'print' function is compatible with 2.x and 3.x python versions
Link : https://www.python.org/dev/peps/pep-3105/
Python 2.6 has a \_\_future\_\_ import that removes print as language syntax,
letting you use the functional form instead
Change-Id: I9d9ca5766a2773a7b4071e280f00361d16b85383
commit 8753e452b04b0af6d6b444184b628724e14fbbb1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed May 27 18:01:37 2015 +0200
Replace StringIO with BytesIO for WSGI input
wsgi.input is a binary stream (bytes), not a text stream (unicode).
\* Replace StringIO with BytesIO for WSGI input
\* Replace StringIO('') with StringIO() and replace WsgiStringIO('') with
WsgiStringIO(): an empty string is already the default value
Change-Id: I09c9527be2265a6847189aeeb74a17261ddc781a
commit 6e70f3fa322da70c2a65fb919d200e52fc5add8a
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed May 27 17:27:47 2015 +0200
Get StringIO and cStringIO from six.moves
\* replace "from cStringIO import StringIO"
with "from six.moves import cStringIO as StringIO"
\* replace "from StringIO import StringIO"
with "from six import StringIO"
\* replace "import cStringIO" and "cStringIO.StringIO()"
with "from six import moves" and "moves.cStringIO()"
\* replace "import StringIO" and "StringIO.StringIO()"
with "import six" and "six.StringIO()"
This patch was generated by the stringio operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Change-Id: Iacba77fec3045f96773d1090c0bd48613729a561
commit 51f806d3e3d3a1fcbc80d2f7d7ddbe5cc4c024c9
Author: John Dickinson <me@not.mn>
Date: Tue Jul 14 20:49:08 2015 -0700
remove Python 2.6 from the classifier
Change-Id: I67233e9c7b69826242546bd6bd98c24b81070579
commit 278adf5c20101a191979ce1e4d6277e5f209149e
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jul 14 15:33:45 2015 +0900
Make logic of unit tests responsive to the method names
The two methods, test\_authorize\_succeeds\_for\_tenant\_name\_in\_roles and
test\_authorize\_succeeds\_for\_tenant\_id\_in\_roles, have names that don't
match what they are testing. tenant\_name and tenant\_id need to be
switched.
Change-Id: I7cb0a7d2b2111127fd5d6b55f2da6a3eadf2235d
commit 1cc3eff958fdd4fb07c2b74c52df7829d3125466
Author: Victor Stinner <vstinner@redhat.com>
Date: Fri Jul 10 13:04:44 2015 +0200
Fixes for mock 1.1
The new release of mock 1.1 is more strict. It helped to find bugs in
tests.
Closes-Bug: #1473369
Change-Id: Id179513c6010d827cbcbdda7692a920e29213bcb
commit ff192cfe5705324497a389aa2f22227d75dc0f8e
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jul 8 18:38:22 2015 +0530
Replace reduce and unichr , these are no longer available in py3
\* Replace reduce() with six.moves.reduce()
\* Replace unichr with six.unichr
Change-Id: I2038e47e0a6522dd992fd2a4aeff981cf7750fe0
commit 4beceab4f4be99f14025815cf7ed4510ea77f460
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu Jul 9 06:14:56 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9ff1dde06be45fc7d6c441a1e1c07221f839a9a1
commit 56ee39a7e13417203c5e1816d7a3184a07f85826
Author: Matthew Oliver <matt@oliver.net.au>
Date: Thu Jul 9 15:19:32 2015 +1000
Ring builder code clean up follow up patch
This is a simple change that cleans up a NIT from Sam's 'stop moving
partitions unnecessarily when overload is on' patch.
Change-Id: I9d9f1cc23e2bb625d8e158f4d3f64e10973176a1
commit 6cafd0a4c0bb8f311fc59df580b42e801214effd
Author: Oshrit Feder <oshritf@il.ibm.com>
Date: Wed Jul 8 15:18:22 2015 +0300
Fix Container Sync example
Container-sync realm uses cluster\_ as a prefix to specify clusters'
names. At use, the prefix should not be included. Fixing the examples
and sample conf to make it clearer that only the name of the cluster
should be passed.
Change-Id: I2e521d86faffb59e1b45d3f039987ee023c5e939
commit 125238612f58481316db68d7087252bb7729f447
Author: Janie Richling <jrichli@us.ibm.com>
Date: Sat Jul 4 17:08:32 2015 -0500
Add CORS unit tests to base
In earlier versions of swift when a request was made with an
existing origin, but without any CORS settings in the container,
it was possible to get an unhandled exception due to a method call
on the "None" return of cors.get('allow\_origin', '').
Unit tests have been added to assert that this problem cannot go
undetected again.
Change-Id: Ia74896dabe1cf5a307c551b15a43ab1fd789c213
Fixes: bug 1468782
commit e87a74695e2f55dbb0e01721de9d46e230e36008
Author: John Dickinson <me@not.mn>
Date: Sat Jun 6 13:03:15 2015 -0700
add domain\_remap to /info
Also added the value of default\_reseller\_prefix to /info. I did not
add the reseller\_prefixes value to /info because deployers may not
want to expose all of the resellers that are available.
Change-Id: I9ca2f002dc395913bb646390d6908dfb8f554df1
commit 12473104f005b76ebe4b6dbe118a5ac37518eb52
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jul 7 18:02:53 2015 -0700
Cleanup error messages in ECDiskFileWriter.commit
I think the error messages make better sense and it's more obvious what the
error handling code was trying to bring to the surface for operators.
If you run this test with nosetests --verbose --nocapture
test\_diskfile.py:TestECDiskFile.test\_commit\_fsync\_dir\_raises\_DiskFileErrors
... you can review most of the potential log output
Change-Id: I40c9d77f44e087ee61d9642e924b0a4039d6ca9a
commit bd3717df65f57da9e7f06292ba349442d17fc939
Author: John Dickinson <me@not.mn>
Date: Thu Jul 2 09:54:30 2015 -0700
update AUTHORS file
Change-Id: I509ceeb522bd83c407beb40c22c2924a1d92b8ff
commit cd20961abd20f01a14554c14d4f61a7f0d8deb88
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sun Jul 5 10:59:50 2015 +0530
Replace dict.iteritems() with dict.items() in bin directory of swift.
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3.
Change-Id: I4bdc064c90bab56cd60f2dca2a5a78426ffbb31c
commit 8eca02d3a1db1e0ed68b15ed41bc62e6c89870c7
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:45:58 2015 +0530
Replace xrange() with six.moves.range()
xrange is no longer available in py3.
replacing xrange with range from six.moves
Change-Id: Ib863c316a0724bd9c4f53c2e5a8d1bcd42c4dc5a
commit 10f367224d5f30c3398169ffe3087f225f3343fc
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jul 3 00:05:36 2015 +0530
Fix Python 3 issues
\* Replace long with six.integer\_type
six.integer\_type :In Python 2, this is long and int, and in Python 3,
just int.
'long' is an undefined variable in py3.
Change-Id: Ibe4c5d0d81fe883f4fe33be93a68d814a228ad28
commit 2328983b7535d24d08942e62095b4346f2626566
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed Jun 24 17:07:32 2015 -0700
Stop moving partitions unnecessarily when overload is on.
When overload was on and in use, the ring builder was unnecessarily
moving partitions. It would converge on a good solution and settle
down eventually, but it moved more partitions than necessary along the
way.
There are three partition gatherers used in the ring builder:
dev-removed, dispersion, and weight, in that order. The dev-removed
gatherer will pick up all partitions on removed devices. The
dispersion gatherer picks up replicas of partitions that are
suboptimally dispersed. The weight gatherer picks up partitions on
devices which are overweight.
The weight gatherer was not overload-aware, so it would pick up
partitions that did not need to move. Consider a device that would
normally have 100 partitions assigned, assume we set overload to 0.1
so that this device will hold up to 110 (10 extra) for the sake of
dispersion, and assume the device actually has 104 partitions assigned
to it. The correct behavior is to gather nothing from this device
because it has fewer than the maximum. Prior to this commit, the
weight gatherer would remove 4 partitions from this device; they would
subsequently be reassigned by the overload-aware partition placer
(\_reassign\_parts()). In a ring with multiple overloaded devices, the
builder would pick up some partitions from each, shuffle them, and
then assign them back to those same devices. Obviously, this just
created extra replication work for no benefit.
Now, the weight gatherer takes overload into account, and will no
longer needlessly gather partitions.
That's not all, though; this change worsened the behavior of a ring
with more overload than necessary. Before, the ring would balance as
best it could, using the minimal amount of overload. With the
weight-gatherer change, the ring builder will stop gathering
partitions once a device reaches its maximum-permissible assignment
including overload.
For example, imagine a 3-replica, 4-zone ring with overload=0.2 and
weights:
z1: 100
z2: 60
z3: 60
z4: 60
Since z1 has more than 1/3 of the weight, z2, z3, and z4 must take
more than their fair share for the sake of dispersion.
Now, turn up the weights some:
z1: 100
z2: 80
z3: 80
z4: 80
Overload is no longer needed; this ring can balance. However, z2, z3,
and z4 would end up keeping more than their fair share since (a) they
already had extra due to earlier conditions, and (b) the weight
gatherer won't pick up partitions from them since they're not
overburdened once it takes overload into account.
To fix this, we compute the minimum overload factor required for
optimal dispersion and then use min(user-input-overload,
minimum-overload) during rebalance. This way, we don't overload
devices more than the user says, but if the user sets overload higher
than necessary, we'll still give the best balance possible.
Change-Id: If5666ba654ee25da54f9144f3b78840273a49627
commit ccf0758ef1f362312a6197f86455f680ebd990d3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 11 15:40:28 2015 -0700
Add ring-builder analyzer.
This is a tool to help developers quantify changes to the ring
builder. It takes a scenario (JSON file) describing the builder's
basic parameters (part\_power, replicas, etc.) and a number of
"rounds", where each round is a set of operations to perform on the
builder. For each round, the operations are applied, and then the
builder is rebalanced until it reaches a steady state.
The idea is that a developer observes the ring builder behaving
suboptimally, writes a scenario to reproduce the behavior, modifies
the ring builder to fix it, and references the scenario with the
commit so that others can see that things have improved.
I decided to write this after writing my fourth or fifth hacky one-off
script to reproduce some bad behavior in the ring builder.
Change-Id: I114242748368f142304aab90a6d99c1337bced4c
commit e860ec138913dc4c450725766a77e76a7101d06e
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 29 10:11:44 2015 +0000
Ignore invalid PIDs in swift-init
While reviewing ab9f6340 I recognized that invalid pids in the pid files raise
an exceptions (in case it is not a number), and also accept a 0 that is
impossible to use as a pid for any Swift process. In the latter case the process
was recognized as runnning, even if it did not - and thus restarting didn't
worked.
This patch ensures a better handling of any non-numeric value and also removes a
pid file if it uses 0 as the pid.
Change-Id: I09c415c7a75e4b9a0574a08f46f48fff5bb11d02
commit 0a6f2ab870a868e3036dbb212c0e7dd8375a39eb
Author: asettle <alexandra.settle@rackspace.com>
Date: Fri Jun 26 10:57:35 2015 +1000
Correcting minor grammatical errors
1. Removing unnecessary semi colon
2. Removing unnecessary content
Change-Id: Ie95403a4d96db2b8465e75495061fc059098c922
commit 4d4db054d35c7e9de9ed28ac24965e8408dd9f82
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Mon May 18 14:08:25 2015 -0500
After the .durable has been written, fsync the directory.
Added try-except statements in \_finalize\_durable() to fsync the directory
after a successful fsync of the .durable file.
Added test\_commit\_fsync\_dir\_raises\_DiskFileErrors() for testing whether
certain assertions hold for the change to include fsync\_dir().
Some more error details have been included in the logger.
Closes-Bug: #1470651
Change-Id: I4791d75ade8542678369ba0811ef39af6e955cc6
commit d4d7c0e1b11af8f20f965f410901a56e1f8ee69e
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Tue Jun 30 17:24:13 2015 -0700
Fix race in test\_server.TestObjectController.test\_PUT\_ssync\_multi\_frag
If the test ran across a one second boundary it would fail because while
the timestamp normalization was doing some rounding it was making no
attempt to reuse the same timestamp on subsequent requests.
Change-Id: Ic560032bcfacd6f0d10cfc0f4f10e5d6c2bc8dd5
commit a88bd6e6b9253b6488a2bf1a354ce29b51f37fe1
Author: ZhiQiang Fan <aji.zqfan@gmail.com>
Date: Sun Jun 28 22:04:46 2015 -0700
fix api overview document
The content about Object Storage HTTP requests constraints seems to
be a table but broken, this patch fixes it into correct rst table format.
Change-Id: I1b4c62da3e6d91add3ee0218707c1628c8f04b33
commit c95a0efe7973a660f4abcd13f4ea6211d72c4baa
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:44:10 2015 -0700
Make ssync\_sender a better HTTP client
When a server responses with an error - if that error includes a body - the
client should read the body. This cleans up some ugly eventlet/wsgi.server log
output related to chunked transfer disconnect (invalid literal for int() with
base 16).
Change-Id: Ibd06ddee9f216fce07fa33c3a7d8306b59eb6d77
Closes-Bug: #1466138
commit 44b76a1b1b83ac9563010f1ddfca5fca76e567bf
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Thu Jun 18 14:21:06 2015 -0500
EC Reconstructor: Do not reconstruct existing fragments.
The EC reconstructor needs to verify that the fragment needing to
be reconstructed does not reside in the collection of node responses.
Otherwise, resources will be spent unnecessarily reconstructing
the fragment. Moreover, this could cause a segfault on some backends.
This change adds the necessary verification steps to make sure
that a fragment will only be rebuilt in the case it is missing from
the other fragment archives.
Added some tests to provide coverage for these scenarios.
Change-Id: I91f3d4af52cbc66c9f7ce00726f247b5462e66f9
Closes-Bug: #1452553
commit d124ce5792d93e1efcdb083211ecef381f7b7173
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Jun 25 01:35:07 2015 -0700
Fix ValueError in ssync\_receiver
httplib's putheader method will cast whatever you give it to a string.
where we allow the default dict.get default of None to be passed to
putheader unmodified ssync\_receiver is surpised that the non-empty
string isn't able to be converted to an integer.
We can avoid surprising the ssync\_receiver in this way by sending the
empty string as a better default.
Change-Id: Ie9df9927ff4d3dd3f334647f883b2937d0d81030
commit edfca861b6fa39972df276fb1f37aa81583a605d
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri Jun 26 08:54:22 2015 +0000
Increase httplib.\_MAXHEADERS
Python 2.7.9+ and 3.2.6+ limits the number of maximum headers in httplib to 100
[1,2,3]. This setting is too low for Swift.
By default the maximum number of allowed headers depends on the number of max
allowed metadata settings plus a default value of 32 for regular http headers.
If for some reason this is not enough (custom middleware for example) it can be
increased with the extra\_header\_count constraint.
[1] https://bugs.python.org/issue16037
[2] https://hg.python.org/cpython/raw-file/15c95b7d81dc/Misc/NEWS
[3] https://hg.python.org/cpython/raw-file/v3.2.6/Misc/NEWS
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Co-Authored-By: Matthew Oliver <matt@oliver.net.au>
Co-Authored-By: Thomas Herve <therve@redhat.com>
Change-Id: I388fd697ec88476024b0e9f1ae75ba35ff765282
commit 81ceee056de604d81a921280f453731eadf7be09
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Jun 22 23:24:19 2015 -0700
Add one more test for ssync\_receiver
To prevent 409 conflict on a primary node during ssyncing,
ssync-receiver should add x-ssync-backend-frag-index generated from
x-ssync-backend-node-index of the SSYNC replication request header.
The change is done by previous work[1], but we need more test for that.
This patch addes one more assertion if the x-ssync-backend-frag-index
is in the ssync subrequest correctly.
\*BONUS\*
Fix some weird mock and add some sanities.
1: https://review.openstack.org/#/c/191521/
Change-Id: I27aff713c69017c0bc4c60b4833184e1285595d7
commit c2c1366b0794bcdbbbaef7fedaef2cab19cd8db8
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Wed Jun 24 21:07:16 2015 +0530
Fixed Errors in Swift-Form Post middleware section rst.
Inline markup cannot be nested in RST.
Fixing markups by using a single option for the whole line and making
some minor error corrections.
Change-Id: I42bfd7dfe5c93a69436ecc5d154f2e61ca83fa82
commit 514daea6317edc02587f7abfaae8770e1ef9cc4b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Fri Jun 12 23:40:51 2015 +0530
Fixed Formatting Error in Swift -Form Post middleware section.
Fixed Formatting error in ``action=”SWIFT\_URL``” => action=”``SWIFT\_URL``”
Change-Id: Id461129ef7f5b6412f94d36920c942a4181c0eb7
Closes-Bug: #1464740
commit e70b66586e13718e7ac0078c2f2cd1135c61a1f1
Author: Victor Stinner <vstinner@redhat.com>
Date: Wed Jun 24 09:36:37 2015 +0200
Replace dict.iteritems() with dict.items()
The iteritems() of Python 2 dictionaries has been renamed to items() on
Python 3. According to a discussion on the openstack-dev mailing list,
the overhead of creating a temporary list using dict.items() on Python 2
is very low because most dictionaries are small:
http://lists.openstack.org/pipermail/openstack-dev/2015-June/066391.html
Patch generated by the following command:
sed -i 's,iteritems,items,g' \
$(find swift -name "\*.py") \
$(find test -name "\*.py")
Change-Id: I6070bb6c684be76e8e77222a7d280ec6edd43496
commit e6165a7879d796efd3992260ef23a7f95ceeab32
Author: paul luse <paul.e.luse@intel.com>
Date: Mon May 25 14:41:42 2015 -0700
Add policy support to dispersion tools
Doesn't work for anything other than policy 0. updated to allow user
to specify policy name on cmd line (as with object-info) which
then makes populate/report work with 3x, 2x, or EC style policies
Change-Id: Ib7c298f0f6d666b1ecca25315b88539f45cf9f95
Closes-Bug: 1458688
commit e5c962a28ce99f01c6cd0b68b7434ddcd0e55f62
Author: Victor Stinner <vstinner@redhat.com>
Date: Mon May 25 18:28:02 2015 +0200
Replace xrange() with six.moves.range()
Patch generated by the xrange operation of the sixer tool:
https://pypi.python.org/pypi/sixer
Manual changes:
\* Fix indentation for pep8 checks
\* Fix TestGreenthreadSafeIterator.test\_access\_is\_serialized of
test.unit.common.test\_utils:
replace range(1, 11) with list(range(1, 11))
\* Fix UnsafeXrange docstring, revert change
Change-Id: Icb7e26135c5e57b5302b8bfe066b33cafe69fe4d
commit 4a5b851207c98a380a32e27a183dd98022be9d16
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 22 14:48:41 2015 +0200
Add note about updatedb to the docs
Change-Id: Ia1aa0bb1f93ee487e2f7ddf76a7a08efa8f3ba41
commit ac8a76958510646c369df9ffc2bf22005e43d153
Author: paul luse <paul.e.luse@intel.com>
Date: Sat Jun 13 11:03:56 2015 -0700
EC Ssync: Update parms to include node and frag indices
Previously we sent the ssync backend frag index based on the node
index. We need to be more specific for ssync to handle both sync
and revert cases so now we send the frag index based on the job
contents (as determined by the ec recon)) and the node index
as a new header based on, well, the node index.
The rcvr can now validate the incoming pair to reject (400) when
a primary node is being asked to accept fragments that don't
belong to it. Additionally, by having the frag index the
rcvr can reject (409) an attempt to accept a fragment when its
a handoff and already has one that needs to be reverted.
Fixes-bug: #1452619
Change-Id: I8287b274bbbd00903c1975fe49375590af697be4
commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
Closes-Bug: #1466549
commit df134df901a13c2261a8205826ea1aa8d75dc283
Author: Darrell Bishop <darrell@swiftstack.com>
Date: Thu May 14 22:14:15 2015 -0700
Allow 1+ object-servers-per-disk deployment
Enabled by a new > 0 integer config value, "servers\_per\_port" in the
[DEFAULT] config section for object-server and/or replication server
configs. The setting's integer value determines how many different
object-server workers handle requests for any single unique local port
in the ring. In this mode, the parent swift-object-server process
continues to run as the original user (i.e. root if low-port binding
is required), binds to all ports as defined in the ring, and forks off
the specified number of workers per listen socket. The child, per-port
servers drop privileges and behave pretty much how object-server workers
always have, except that because the ring has unique ports per disk, the
object-servers will only be handling requests for a single disk. The
parent process detects dead servers and restarts them (with the correct
listen socket), starts missing servers when an updated ring file is
found with a device on the server with a new port, and kills extraneous
servers when their port is found to no longer be in the ring. The ring
files are stat'ed at most every "ring\_check\_interval" seconds, as
configured in the object-server config (same default of 15s).
Immediately stopping all swift-object-worker processes still works by
sending the parent a SIGTERM. Likewise, a SIGHUP to the parent process
still causes the parent process to close all listen sockets and exit,
allowing existing children to finish serving their existing requests.
The drop\_privileges helper function now has an optional param to
suppress the setsid() call, which otherwise screws up the child workers'
process management.
The class method RingData.load() can be told to only load the ring
metadata (i.e. everything except replica2part2dev\_id) with the optional
kwarg, header\_only=True. This is used to keep the parent and all
forked off workers from unnecessarily having full copies of all storage
policy rings in memory.
A new helper class, swift.common.storage\_policy.BindPortsCache,
provides a method to return a set of all device ports in all rings for
the server on which it is instantiated (identified by its set of IP
addresses). The BindPortsCache instance will track mtimes of ring
files, so they are not opened more frequently than necessary.
This patch includes enhancements to the probe tests and
object-replicator/object-reconstructor config plumbing to allow the
probe tests to work correctly both in the "normal" config (same IP but
unique ports for each SAIO "server") and a server-per-port setup where
each SAIO "server" must have a unique IP address and unique port per
disk within each "server". The main probe tests only work with 4
servers and 4 disks, but you can see the difference in the rings for the
EC probe tests where there are 2 disks per server for a total of 8
disks. Specifically, swift.common.ring.utils.is\_local\_device() will
ignore the ports when the "my\_port" argument is None. Then,
object-replicator and object-reconstructor both set self.bind\_port to
None if server\_per\_port is enabled. Bonus improvement for IPv6
addresses in is\_local\_device().
This PR for vagrant-swift-all-in-one will aid in testing this patch:
https://github.com/swiftstack/vagrant-swift-all-in-one/pull/16/
Also allow SAIO to answer is\_local\_device() better; common SAIO setups
have multiple "servers" all on the same host with different ports for
the different "servers" (which happen to match the IPs specified in the
rings for the devices on each of those "servers").
However, you can configure the SAIO to have different localhost IP
addresses (e.g. 127.0.0.1, 127.0.0.2, etc.) in the ring and in the
servers' config files' bind\_ip setting.
This new whataremyips() implementation combined with a little plumbing
allows is\_local\_device() to accurately answer, even on an SAIO.
In the default case (an unspecified bind\_ip defaults to '0.0.0.0') as
well as an explict "bind to everything" like '0.0.0.0' or '::',
whataremyips() behaves as it always has, returning all IP addresses for
the server.
Also updated probe tests to handle each "server" in the SAIO having a
unique IP address.
For some (noisy) benchmarks that show servers\_per\_port=X is at least as
good as the same number of "normal" workers:
https://gist.github.com/dbishop/c214f89ca708a6b1624a#file-summary-md
Benchmarks showing the benefits of I/O isolation with a small number of
slow disks:
https://gist.github.com/dbishop/fd0ab067babdecfb07ca#file-results-md
If you were wondering what the overhead of threads\_per\_disk looks like:
https://gist.github.com/dbishop/1d14755fedc86a161718#file-tabular\_results-md
DocImpact
Change-Id: I2239a4000b41a7e7cc53465ce794af49d44796c6
commit af72881d1dcc46486d8d652b92a0ec9aa9ca2bfa
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Jun 15 13:36:36 2015 -0700
Use just IP, not port, when determining partition placement
In the ring builder, we place partitions with maximum possible
dispersion across tiers, where a "tier" is region, then zone, then
IP/port,then device. Now, instead of IP/port, just use IP. The port
wasn't really getting us anything; two different object servers on two
different ports on one machine aren't separate failure
domains. However, if someone has only a few machines and is using one
object server on its own port per disk, then the ring builder would
end up with every disk in its own IP/port tier, resulting in bad (with
respect to durability) partition placement.
For example: assume 1 region, 1 zone, 4 machines, 48 total disks (12
per machine), and one object server (and hence one port) per
disk. With the old behavior, partition replicas will all go in the one
region, then the one zone, then pick one of 48 IP/port pairs, then
pick the one disk therein. This gives the same result as randomly
picking 3 disks (without replacement) to store data on; it completely
ignores machine boundaries.
With the new behavior, the replica placer will pick the one region,
then the one zone, then one of 4 IPs, then one of 12 disks
therein. This gives the optimal placement with respect to durability.
The same applies to Ring.get\_more\_nodes().
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Change-Id: Ibbd740c51296b7e360845b5309d276d7383a3742
commit 09e7477a391e7425af62a6516f43c69bc98b7080
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Mon Jun 15 22:10:45 2015 +0530
Replace it.next() with next(it) for py3 compat
The Python 2 next() method of iterators was renamed to \_\_next\_\_() on
Python 3. Use the builtin next() function instead which works on Python
2 and Python 3.
Change-Id: Ic948bc574b58f1d28c5c58e3985906dee17fa51d
commit 5ad369c1cb0f480b164a5b5e7eb194081835c266
Author: Victor Stinner <vstinner@redhat.com>
Date: Tue Jun 9 00:22:12 2015 +0200
Add six requirement
The six module is needed to add Python 3 support to Swift.
Change-Id: Ie637ed3458c7ff56c26834bca73203ed55604d74
commit 037a0c5dbe01a57b741d34988e21f4f763b6204b
Author: janonymous <janonymous.codevulture@gmail.com>
Date: Sat Jun 6 17:42:41 2015 +0530
Object are sorted and concatenated by swift in cardinal order.
Modified values in example in decimal to be more precise,
added a small description on Object are sorted and concatenated
by swift in cardinal order as a small phrase would be sufficient.
Change-Id: I914ded4e5726e50bb93b05759c3bfb76edda53ab
backport: none
Closes-Bug: #1383893
commit 11e5c4adf0e02c8fdab0d8584fc943d96e1165cd
Author: Koert van der Veer <koert@cloudvps.com>
Date: Tue Dec 16 11:15:19 2014 +0100
Allow default reseller prefix in domain\_remap middleware
Previously, the reseller prefix needed to be provided in the host name
even when the domain was unique to that reseller. With the
default\_reseller\_prefix, any domain which matches in this middleware,
will will be passed on with a reseller prefix, whether or not it was
provided.
Change-Id: I5aa5ce78ad1ee2e3660cce4c3e07306f8999f02a
Implements: blueprint domainremap-reseller-domains
commit c953e8cc9049e94cd01239d5e4a30a56f26a97d3
Author: Minwoo Bae <minwoob@us.ibm.com>
Date: Tue Apr 28 13:18:32 2015 -0500
The hash\_cleanup\_listdir function should only be called when necessary.
Introduced a conditional that will specify to \_finalize\_put() whether
the put() method is being called within the context of ECDiskFileWriter.
Included some unit tests that will test the number of calls to
hash\_cleanup\_listdir() during put(), commit(), and delete()
operations.
Change-Id: I287b2648591fdbf686898dc9047beda80a64da0c
commit 93de6c73e587a672663fa0997f439b73b336769c
Author: Hisashi Osanai <osanai.hisashi@jp.fujitsu.com>
Date: Tue Jun 2 17:00:42 2015 +0900
Add metadata size tests on the border
This patch adds a test for a 204 when a single metadata item in a POST causes
the backend aggregate constraints check to be on the border.
Background:
Overall metadata size constraint is enforced in the container and
account backends as well as in the proxy controllers.
Whereas the proxy controller can check that constraints are not exceeded
by a single PUT or POST request, the backend checks that constraints are not
exceeded by the aggregate of all PUTs and POSTs.
The change [1] added a test for a 400 when a single metadata item in
a POST causes the backend aggregate constraints check to go over limit.
[1] I1489e29686013cbd3d70283d8756b548aea3c2e1
Change-Id: Iac86ea71240ddde177e625c279c21aef67659d10
commit af734b3fb6fdbc11b8a0b775256e7642eb485b8d
Author: Mark Seger <Mark.Seger@hp.com>
Date: Wed Jun 3 08:16:06 2015 -0400
Change usage help and Attention messages to warnings
Change-Id: I1396aaffe36e739606f15f7fef37b11bd83f1fc1
commit 4f2ed8bcd0468f3b69d5fded274d8d6b02ac3d10
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri Mar 20 09:56:30 2015 -0700
EC: support multiple ranges for GET requests
This commit lets clients receive multipart/byteranges responses (see
RFC 7233, Appendix A) for erasure-coded objects. Clients can already
do this for replicated objects, so this brings EC closer to feature
parity (ha!).
GetOrHeadHandler got a base class extracted from it that treats an
HTTP response as a sequence of byte-range responses. This way, it can
continue to yield whole fragments, not just N-byte pieces of the raw
HTTP response, since an N-byte piece of a multipart/byteranges
response is pretty much useless.
There are a couple of bonus fixes in here, too. For starters, download
resuming now works on multipart/byteranges responses. Before, it only
worked on 200 responses or 206 responses for a single byte
range. Also, BufferedHTTPResponse grew a readline() method.
Also, the MIME response for replicated objects got tightened up a
little. Before, it had some leading and trailing CRLFs which, while
allowed by RFC 7233, provide no benefit. Now, both replicated and EC
multipart/byteranges avoid extraneous bytes. This let me re-use the
Content-Length calculation in swob instead of having to either hack
around it or add extraneous whitespace to match.
Change-Id: I16fc65e0ec4e356706d327bdb02a3741e36330a0
commit f1f4bb30cd8ad930ddb7a232b2744b48e35a0480
Author: Christian Schwede <cschwede@redhat.com>
Date: Tue Jun 2 19:51:39 2015 +0000
Fix testing issues
When functional tests are run in tox and an exception is raised when connecting
to Swift (for example: Swift not running, missing python-keystoneclient package
used by python-swiftclient) 0 tests are executed, but tox returns a success.
An exception is raised during tests, caused by a missing python-keystoneclient
in python-swiftclient. Instead of adding python-keystoneclient as a dependency
in python-swiftclient the package is added to the test-requirements.txt in Swift
itself. Note that adding python-keystoneclient to the test-requirements in
python-swiftclient is not sufficient (it's already in there).
The exception in setup\_package() is catched by the openstack.nose\_plugin, thus
disabling this plugin for now as well.
Also fixing two test errors seen on the gate regarding the tempurl middleware.
There was also an update to tox, environment variables were no longer passed
with versions >= 2.0 (http://tox.readthedocs.org/en/latest/changelog.html).
Swift test environment variables have been added to the passenv to re-enable the
former behavior, as well as environment variables required to pass proxy
settings.
This also led to skipped tempauth tests, and together with the missing
python-keystoneclient no tests were executed.
Related-Bug: 1461440
Related-Bug: 1455102
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Ideea071017d04912c60ed0bc76532adbb446c31d
commit 2759a6f159d4a90e4ad4c8e9e479085d195f8d14
Author: Pradeep Kumar Singh <pradeep.singh@nectechnologies.in>
Date: Wed May 13 21:18:02 2015 +0530
Handle Disk IO error Exception in swift account auditor
Swift account auditor fails to quarantine corrupt db due to
Disk IO error. This patch fixes that by handling Disk IO Error
Exception.
Closes-Bug:1169189
Change-Id: I031ee2a5775e4a88d4fb00d972d553936147c42e
commit 1bef06eec8f5f780914ac701d63f9c498b29119b
Author: Michael Barton <mike@weirdlooking.com>
Date: Sun May 31 23:10:15 2015 +0000
Don't quarantine on read\_metadata ENOENT
An operation that removes an existing .ts or .meta out from under another
concurrent operation at the right point can cause the whole object to be
needlessly quarantined.
Closes-Bug: #1451520
Change-Id: I37d660199e54411d0610889f9ee230b13747244b
commit 8b4af92dac813d707d124b3be37df586260fe74a
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Jun 1 17:57:25 2015 +0100
Tighten up overall metadata size tests
Overall metadata size constraint is enforced in the container and account
backends as well as in the proxy controllers. Whereas the proxy controller
can check that constraints are not exceeded by a single PUT or POST request,
the backend checks that constraints are not exceeded by the aggregate of all
PUTs and POSTs.
The current functional tests only exercise the proxy controller checks, since
they test for a 400 when sending excessive metadata in a single POST. This patch
adds a test for a 400 when a single metadata item in a POST causes the backend
aggregate constraints check to go over limit.
The extra coverage of the new assertions can be seen by modifying
swift/common/db.DatabasBroker.validate\_metadata() to always return None
immediately - only the new assertions fail when functests are run.
Change-Id: I1489e29686013cbd3d70283d8756b548aea3c2e1
commit b4c1d73ad56e0705d1c5dd1fc4f1d89b09fceff1
Author: Christian Schwede <cschwede@redhat.com>
Date: Mon Jun 1 06:50:33 2015 +0000
Make swift-recon compatible for servers without storage policies
Swift recon introduced a new key for storage policies, and the CLI expected this
key in the server response. However, if one updates the CLI but not yet the
server an exception will be raised, because there is no default value and no
check if the key is included in the response.
This change checks if the policies key is included in the response and updates
one test to ensure backward compability.
Closes-Bug: 1453599
Change-Id: I7c7a90f9933bec2ab45595df9dc600a6cba65666
commit 38787d0fb5102e41b153e4629d2ef374a02965e9
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:19:54 2015 -0700
Remove simplejson from staticweb
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This lets us get rid of some redundant Unicode encoding. Before, we
would take the container-listing response off the wire,
JSON-deserialize it (str -> unicode), then pass each of several fields
from each entry to get\_valid\_utf8\_str(), which would encode it,
(unicode -> str), decode it (str -> unicode), and then encode it again
(unicode -> str) for good measure.
The net effect was that each object's name would, in the proxy server,
go str -> unicode -> str -> unicode -> str.
By replacing simplejson with stdlib json, we get a guarantee that each
container-listing entry's name, hash, content\_type, and last\_modified
are unicodes, so we can stop worrying about them being valid UTF-8 or
not. This takes an encode and decode out of the path, so we just have
str -> unicode -> str. While it'd be ideal to avoid this, the first
transform (str -> unicode) happens when we decode the
container-listing response body (json.loads()), so there's no way out.
Change-Id: I00aedf952d691a809c23025b89131ea0f02b6431
commit 736cf54adf3ee85d2f473e5e5374f9833422967c
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu May 28 15:30:47 2015 -0700
Remove simplejson from tests
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
This commit just takes simplejson out of the unit and functional
tests. They still pass.
Change-Id: I96f17df81fa5d265395a938b19213d2638682106
commit 68c30b80b47c281c549d101c43d79e718e91d21d
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Thu May 28 06:08:12 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I0c7b2bdb0edcc3bb3fa06903ec8457ca5e2dd688
commit 5374ba3a80a5b895542196502eac4d9300ba53d2
Author: John Dickinson <me@not.mn>
Date: Wed May 27 12:28:04 2015 -0700
drop Python 2.6 testing support
Change-Id: I78f21e5794e8ba7a095f03d279247516a241f555
commit 191f2a00bd9121fddc03d8f07f15e5e34790541e
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 16:39:23 2015 +0100
Remove \_ensure\_flush() from SSYNC receiver
The Receiver.\_ensure\_flush() method in ssync\_receiver.py has
the following comment:
Sends a blank line sufficient to flush buffers.
This is to ensure Eventlet versions that don't support
eventlet.minimum\_write\_chunk\_size will send any previous data
buffered.
If https://bitbucket.org/eventlet/eventlet/pull-request/37
ever gets released in an Eventlet version, we should make
this yield only for versions older than that.
The reference pull request was included with eventlet 0.14 [1] and
swift now requires >=0.16.1 so it is safe to remove \_ensure\_flush()
and save > 8k bytes per SSYNC response.
[1] https://bitbucket.org/eventlet/eventlet/commits/4bd654205a4217970a57a7c4802fed7ff2c8b770
Change-Id: I367e9a6e92b7ea75fe7e5795cded212657de57ed
commit 3aa06f185ac4256a8883c565bdc90b1ffbd519ca
Author: Alistair Coles <alistair.coles@hp.com>
Date: Mon Apr 27 09:17:46 2015 +0100
Make SSYNC receiver return a reponse when initial checks fail
The ssync Receiver performs some checks on request parameters
in initialize\_request() before starting the exchange of missing
hashes and updates e.g. the destination device must be available;
the policy must be valid. Currently if any of these checks fails
then the receiver just closes the connection, so the Sender gets
no useful response code and noise is generated in logs by httplib
and wsgi Exceptions.
This change moves the request parameter checks to the Receiver
constructor so that the HTTPExceptions raised are actually sent
as responses. (The 'connection close' exception handling still
applies once the 'missing\_check' and 'updates' handshakes are in
progress.)
Moving initialize\_request() revealed the following lurking bug:
\* initialize\_request() sets
req.environ['eventlet.minimum\_write\_chunk\_size'] = 0
\* this was previously ineffective because the Response environ
had already been copied from Request environ before this value
was set, so the Response never used the value :/
\* Now that it is effective (a good thing) it causes the empty string
yielded by the receiver when there are no missing hashes in
missing\_checks() to be sent to the sender immediately. This makes
the Sender.readline() think there has been an early disconnect
and raise an Exception (a bad thing), as revealed by
test/unit/obj/test\_ssync\_sender.py:TestSsync.test\_nothing\_to\_sync
The fix for this is to simply make the receiver skip sending the empty
string if there are no missing object\_hashes.
Change-Id: I036a6919fead6e970505dccbb0da7bfbdf8cecc3
commit bb716573ab5c8455348ec013feb894421e0e1f1c
Author: Tim Burke <tim.burke@gmail.com>
Date: Wed May 20 00:39:41 2015 -0700
Allow SLO PUTs to forgo per-segment integrity checks
While manifests still require 'etag' and 'size\_bytes' fields for each
segment (to catch user errors like 'etaf' or 'size\_btyes'), an explicit
null for either will skip that particular integrity check and instead
use whatever value is retrieved when HEADing the segment. So, if a user
uploads a manifest like:
[{"path": "/con/obj\_seg\_1", "etag": null, "size\_bytes": 1048576},
{"path": "/con/obj\_seg\_2", "etag": "etag2", "size\_bytes": null},
{"path": "/con/obj\_seg\_3", "etag": null, "size\_bytes": null}]
then the etag will only be verified for the /con/obj\_seg\_2 segment,
and the segment size will only be verified for the /con/obj\_seg\_1
segment. However, the manifest that's ultimately stored (and can be
retrieved with a ?multipart-manifest=get query-string) will still look
like:
[{"name": "/con/obj\_seg\_1", "hash": "etag1", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_2", "hash": "etag2", "bytes": 1048576, ...},
{"name": "/con/obj\_seg\_3", "hash": "etag3", "bytes": 1234, ...}]
This allows the middleware to continue performing integrity checks on
object GET.
Change-Id: I2c4e585221387dd02a8679a50398d6b614407b12
DocImpact
commit a1c327022c70907ccc159d6203de26b37c3a4586
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue May 26 16:43:55 2015 -0700
Remove simplejson from swift-recon
Since we're dropping Python 2.6 support, we can rely on stdlib's json
and get rid of our dependency on simplejson.
All swift-recon was doing with json was decoding a JSON response (from
the recon middleware) and printing it to the terminal. This still
works just fine.
Change-Id: I28cf25a7c2856f230d4642c62fb8bf9c4d37e9e5
commit a3559edc2342e2cf92a5188336ab263ffd038554
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Fri Apr 17 16:30:30 2015 -0700
Exclude local\_dev from sync partners on failure
If the primary left or right hand partners are down, the next best thing
is to validate the rest of the primary nodes. Where the rest should
exclude not just the left and right hand partners - but ourself as well.
This fixes a accidental noop when partner node is unavailable and
another node is missing data.
Validation:
Add probetests to cover ssync failures for the primary sync\_to nodes for
sync jobs.
Drive-by:
Make additional plumbing for the check\_mount and check\_dir constraints into
the remaining daemons.
Change-Id: I4d1c047106c242bca85c94b569d98fd59bb255f4
commit 666bf06c26bc9e0d6256d054835386e50e67b8a2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Wed May 6 16:29:06 2015 -0700
EC: don't 503 on marginally-successful PUT
On EC PUT in an M+K scheme, we require M+1 fragment archives to
durably land on disk. If we get that, then we go ahead and ask the
object servers to "commit" the object by writing out .durable
files. We only require 2 of those.
When we got exactly M+1 fragment archives on disk, and then one
connection timed out while writing .durable files, we should still be
okay (provided M is at least 3). However, we'd take our M > 2
remaining successful responses and pass that off to best\_response()
with a quorum size of M+1, thus getting a 503 even though everything
worked well enough.
Now we pass 2 to best\_response() to avoid that false negative.
There was also a spot where we were getting the quorum size wrong. If
we wrote out 3 fragment archives for a 2+1 policy, we were only
requiring 2 successful backend PUTs. That's wrong; the right number is
3, which is what the policy's .quorum() method says. There was a spot
where the right number wasn't getting plumbed through, but it is now.
Change-Id: Ic658a199e952558db329268f4d7b4009f47c6d03
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Closes-Bug: 1452468
commit e7c8c578d9e5b0aa7e56b02bd9c39baa99d2d6ae
Author: Michael MATUR <michael.matur@gmail.com>
Date: Mon May 25 15:13:01 2015 +0200
fixup!Patch of "parse\_content\_disposition" method to meet RFC2183
The spec of Content-Disposition does not require a space character after
comma: http://www.ietf.org/rfc/rfc2183.txt
Change-Id: Iff438dc36ce78c6a79bb66ab3d889a8dae7c0e1f
Closes-Bug: #1458497
commit af8d842076ba269fed7f4128d0c7503ab5d1a94a
Author: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Date: Tue Oct 21 09:24:25 2014 +0000
Replaced setting run\_pause with standard interval
The deprecated directive `run\_pause` should be replaced with the more
standard one `interval`. The `run\_pause` should be still supported for
backward compatibility. This patch updates object replicator to use
`interval` and support `run\_pause`. It also updates its sample config
and documentation.
Co-Authored-By: Joanna H. Huang <joanna.huitzu.huang@gmail.com>
Co-Authored-By: Kamil Rykowski <kamil.rykowski@intel.com>
Change-Id: Ie2a3414a96a94efb9273ff53a80b9d90c74fff09
Closes-Bug: #1364735
commit f11d92d566757a54ff1e3800ec0bfac098347a68
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri May 22 16:58:04 2015 -0700
Add swift-durability-calculator line to docs
This commits add a line (link and small doc) for
swift-durability-calculator which provides a browser based
durability calculation tool to docs as an associated project.
Change-Id: I4ea8015f512616dc25072080bef79b8734971ccf
commit f864092455ebcd40b3568633c3524cc5c64d3309
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed May 20 17:50:07 2015 -0700
Add Swift Inspector to assoicated projects
Change-Id: I5b5448674ea455119a51509ab5e7cd11a764b5a7
commit e54781a2aa29808aff654861d8a0aafd24b6620c
Author: Thiago da Silva <thiago@redhat.com>
Date: Tue May 19 20:27:06 2015 +0000
add object post and delete methods to BaseObjectController
Adding post and delete methods to BaseObjectController that can
be overriden by ObjectCOntroller subclasses. These methods are
similar to the PUT and GET methods that were introduced as part
of the EC work
Change-Id: I197364bc3e2f2287c0afc8948863e3cdeab90383
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit ab9f63402de6d554528699a02955854ac28264c5
Author: Takashi Kajinami <kajinamit@nttdata.co.jp>
Date: Mon Nov 24 21:44:03 2014 +0900
Add process name checking into swift-init
Swift-init uses pid files to detect existing swift processes by pid.
However, it mistakes an unrelated process for a swift process and makes
a wrong decision, when the unrelated process is running with pid written
in swift pid files.
This patch adds process name checking into swift-init and enable it to remove
invalid pid files in such situation.
Change-Id: Ibca026bdfbdacdd92c8763e1eb15d98293c70656
Closes-Bug: #1327106
commit aa4866eb6014d7fbb8531eb5d927d5611ebfd06d
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed May 13 20:10:59 2015 +0000
move replication code to ReplicatedObjectController
Moving \_connect\_put\_node, send\_file, \_transfer\_data and \_store\_object
methods to ReplicatedObjectController. Each one of these methods are
specific to replication policy. EC policy implements their own
version of them.
Of these four methods, only \_store\_object and \_connect\_put\_node are
required to be implemented by the policy specific Object Controllers.
Change-Id: Ifc72461b77dbfdaae9d63417f1286e8b5da3ca4e
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit 025c4c4339e7ace2f5be8cb3a3cddf6c38ceff37
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Fri Apr 24 02:15:36 2015 -0700
Remove confusable query string on post as copy
Current post as copy routine (i.e. POST object with post\_as\_copy option
turned on) on Object Controller uses "multipart-manifest" query string
which is feeded to env['copy\_hook'] to decide which data (the manifest or
object pointed by the manifest) should be copied.
However, the way using the query string will confuse operators looking at
logging system (or analyzing the log) because whole POST object requests
have 'multipart-manifest=get' like as:
POST /v1/AUTH\_test/d4c816b24d38489082f5118599a67920/manifest-abcde%3Fmultipart-manifest%3Dget
We cannot know whether the query string was added by hand
(from user) or not. In addition, the query isn't needed by the
backend conversation between proxy-server and object-server.
(Just needed by "copy\_hook" on the proxy controller!)
To remove the confusable query string and to keep the log to be clean,
this patch introduces new environment variable "swift.post\_as\_copy"
and changes proxy controller and the copy\_hook to use the new env.
This item was originally discussed at
https://review.openstack.org/#/c/177132/
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: I0cd37520eea1825a10ebd27ccdc7e9162647233e
commit 98b725fec639c5501c645ce4e4dc9d12c686f91d
Author: Alistair Coles <alistair.coles@hp.com>
Date: Fri May 1 13:02:29 2015 +0100
Cleanup and extend end to end ssync tests
Extends the existing end to end ssync tests with
a test using replication policy.
Also some cleanup and improvements to the test framework e.g. rather
than faking the connection between sender and receiver, use a real
connection and wrap it to capture traffic for verification.
Change-Id: Id71d2eb3fb8fa15c016ef151aacf95f97196a902
commit 518262ab6ecd8faa2b915df118ffc70a30112a18
Author: paul luse <paul.e.luse@intel.com>
Date: Tue May 12 15:21:13 2015 -0700
Remove 1 line of dead code from EC reconstructor
Assuming nobody intentionally left this in here for some reason...
Change-Id: I4bf43bb3828e062c0342557243076ed62d6790f4
commit 29f4393d88426fd6c34f2cfe43a8c434bfad8d47
Author: Samuel Merritt <sam@swiftstack.com>
Date: Fri May 8 15:55:14 2015 -0700
Remove workaround for old eventlet version
Swift now requires eventlet >= 0.16.1, so we can get rid of this
workaround for a bug in eventlet 0.9.16.
Change-Id: I4a1200b9bd9266896a704a840fda0d1b720bc86d
commit 90b84d3a699811a99c97ebbe4f71a14d2f76a0e5
Author: Tim Burke <tim.burke@gmail.com>
Date: Fri May 8 11:45:12 2015 -0700
Properly re-raise exceptions in proxy\_logging
Previously, this could encounter TypeErrors, presumably because
sys.exc\_clear() was called somewhere in the block of code between
catching the exception and re-raising.
Related-Bug: 1181146
Change-Id: Iadeea3f61e70bf83dc0eb063fdb27edd16f3ca32
commit 664a632c01f8c5c80826b223b9ade774bfe2ed9a
Author: Christian Schwede <cschwede@redhat.com>
Date: Fri May 8 08:41:39 2015 +0200
Update my mailmap entry
Change-Id: I5d21a55d0fa4cab6eaa6ff426819aa1dc997de2f
commit 0b20a18e5216b991855c461e41e9ef32e17fadb4
Author: Pete Zaitcev <zaitcev@kotori.zaitcev.us>
Date: Thu May 7 13:16:15 2015 -0600
Spell "rebalance" right in swift-ring-builder.1
See Red Hat bug #1218269.
Change-Id: I814eb4b3c0821f5a8df5feea2bda3a964aace536
commit 1faad248f833735585aa8f6135babceb46fbb6f8
Author: Emmanuel Cazenave <contact@emcaz.fr>
Date: Tue May 5 12:31:22 2015 +0200
X-Auth-Token should be a bytestring.
Change-Id: I2aa941d74883e17e9548b0144a4a2e2db33aba95
Closes-Bug: 1451773
commit 55dd705a863c4500330cbd2b8c2fec46d618dc71
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Wed May 6 19:53:09 2015 +0200
Add missing statsd metrics section for object-reconstructor
Change-Id: Id3f98e5f637ff537a387262b40f21c05876fca91
commit c77c79b2c9b9ca7790c29577341cf36c5e9012cf
Author: OpenStack Proposal Bot <openstack-infra@lists.openstack.org>
Date: Tue May 5 06:08:09 2015 +0000
Imported Translations from Transifex
For more information about this automatic import see:
https://wiki.openstack.org/wiki/Translations/Infrastructure
Change-Id: I9b0156c7fc315182d80604bf353586455bbc34d1
commit 94215049fd37f810ddf4e6b8122cce02aea3e6e3
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon May 4 15:08:51 2015 -0700
Bump up a timeout in a test
Got a slow crappy VM like I do? You might see this fail
occasionally. Bump up the timeout a little to help it out.
Change-Id: I8c0e5b99012830ea3525fa55b0811268db3da2a2
commit 03536dbb55c219b94389e635babec2df2e2759fa
Author: Prashanth Pai <ppai@redhat.com>
Date: Wed Apr 29 12:11:59 2015 +0530
Fix incorrect passing of file object to fsync()
swift.common.utils.fsync() requires a file descriptor as argument
but file object handle was being passed.
Change-Id: I316b58f6bc37de0945eff551e4e50565653664f5
Signed-off-by: Prashanth Pai <ppai@redhat.com>
commit bfbc94c3cb34eb9ff288fb817dee667cc870d9eb
Author: Alistair Coles <alistair.coles@hp.com>
Date: Tue Apr 28 10:45:50 2015 +0100
Fix intermittent container replicator test failure
Intermittent failure of this test could be due to
insufficient time elapsing between either the local
and remote db's being created or during the
debug\_timing calls. This patch forces greater timestamp
separation and forces debug\_timing to always log timings.
Also add message to the failign assertion so if this does
fail again we get some clue as to why.
Closes-Bug: 1369663
Change-Id: I4b69b2e759d586a14abd0931a68dbdf256d57c32
commit dbb9d4b7938f24ee588d260c9b51ca65d5095749
Author: Christian Schwede <christian.schwede@enovance.com>
Date: Mon Apr 27 08:52:18 2015 +0200
Add missing docstring in direct\_client
Added a missing docstring to the direct\_delete\_container method.
Also checked other docstrings in the same file and fixed a wrong docstring
element in direct\_delete\_object. Added raises: docstring entry to all methods
that raise an Exception.
Change-Id: If463a0f9ddff3fe2d13f6d97fcfa955e91d0f01f
commit 8cdf0fdebe9eb782322fccfc11253dc959cf321d
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Mon Apr 27 13:29:50 2015 -0700
Fix account replication during pre-storage-policy upgrade
Old account schemas don't send the storage\_policy\_index key for container rows
during replication, and if the recieving end is already running an upgraded
server it is surprised with a KeyError. Normally this would work itself out
if the old schema recieved any updates from container layer, or a new
container is created, or requires a row sync from another account database -
but if the account databases have rows out of sync and there's no activity in
the account otherwise, there's nothing to force the old schemas to be
upgraded.
Rather than force the old schema that already has a complete set of container
rows to migrate even in the absense of activity we can just fill in default
legacy value for the storage policy index and allow the accounts to get back
in sync and migrate the next time a container update occurs.
FWIW, I never able to get a cluster upgrade to get stuck in this state without
some sort of account failure that forced them to get their rows out of sync
(in my cause I just unlinked a pending and then made sure to force all my
account datbases to commit pending files before upgrading - leading to an
upgraded cluster that absolutly needed account-replication to solve a row
mismatch for inactive accounts with old schemas)
Closes-Bug #1424108
Change-Id: Iaf4ef834eb24f0e11a52cc22b93a864574fabf83
commit 03380380efb5d5c0b2a3acfaa64b486ee2cb6e64
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Thu Apr 23 19:39:16 2015 -0700
Simplify ring.builder.RingBuilder.\_\_deepcopy\_\_
Only container classes (lists, sets, dicts, graphs, collections,
etc) need to track objects they deepcopy in the memo dict -
particularly when they may contain other containers! As they
recreate a new container with the same items as themselves, they'll
reference the memo for each item they contain before making a
deepcopy of it, and place a reference to the copied item into memo
after they do. Trying to help out some other container class in
this endeavor by attempting to add ourselves to the memo dict in
some useful manor on their behalf however; is not helpful.
All we need to do to make sure we're being a good \_\_deepcopy\_\_
implementation is make sure we pass on memo to our calls of deepcopy
so that other container classes can avoid making additional
deepcopy's of our containers if they already have a memorized copy
(which would be odd since unique instances of RingBuilders aren't
expected to share state, but hey - python doesn't have private
attributes so you never know!)
Change-Id: Ifac444dffbf79d650b2d858f6282e05d8ea741a0
commit 43ace3c62893364b6e3c130df56438995627598d
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 12:17:56 2015 -0700
Make RingBuilders deep-copy-able
We used to be able to deep-copy RingBuilder objects, but the addition
of debug logging (8d3b3b2) broke that since you can't deep-copy a
Python logger. This commit fixes that.
Swift doesn't really deep-copy RingBuilders anywhere, but third-party
code might.
Change-Id: If8bdadd93d9980db3d8a093f32d76ca604de9301
commit 215cd551df8be066edafd2a1e16d0bd143ec214b
Author: Samuel Merritt <sam@swiftstack.com>
Date: Tue Apr 21 17:38:04 2015 -0700
Bulk upload: treat user xattrs as object metadata
Currently, if you PUT a single object, then you can also associate
metadata with it by putting it in the request headers, prefixed with
"X-Object-Meta". However, if you're bulk-uploading objects, then you
have no way to assign any metadata.
The tar file format\* allows for arbitrary UTF-8 key/value pairs to be
associated with each file in an archive (as well as with the archive
itself, but we don't care about that here). If a file has extended
attributes, then tar will store those as key/value pairs.
This commit makes bulk upload read those extended attributes, if
present, and convert those to Swift object metadata. Attributes
starting with "user.meta" are converted to object metadata, and
"user.mime\_type"\*\* is converted to Content-Type.
For example, if you have a file "setup.py":
$ setfattr -n user.mime\_type -v "application/python-setup" setup.py
$ setfattr -n user.meta.lunch -v "burger and fries" setup.py
$ setfattr -n user.meta.dinner -v "baked ziti" setup.py
$ setfattr -n user.stuff -v "whee" setup.py
This will get translated to headers:
Content-Type: application/python-setup
X-Object-Meta-Lunch: burger and fries
X-Object-Meta-Dinner: baked ziti
Swift will handle xattrs stored by both GNU and BSD tar\*\*\*. Only
xattrs user.mime\_type and user.meta.\* are processed; others are
ignored.
This brings bulk upload much closer to feature-parity with non-bulk upload.
\* The POSIX 1003.1-2001 (pax) format, at least. There are a few
different, mutually-incompatible tar formats out there, because of
course there are. This is the default format on GNU tar 1.27.1 or
later.
\*\* http://standards.freedesktop.org/shared-mime-info-spec/latest/ar01s02.html#idm140622087713936
\*\*\* Even with pax-format tarballs, different encoders store xattrs
slightly differently; for example, GNU tar stores the xattr
"user.rubberducky" as pax header "SCHILY.xattr.user.rubberducky",
while BSD tar (which uses libarchive) stores it as
"LIBARCHIVE.xattr.user.rubberducky". One might wonder if this is
some programmer's attempt at job security.
Change-Id: I5e3ce87d31054f5239e86d47c45adbde2bb93640
commit f8dee761bd36f857aa1288c27e095907032fad68
Author: Andreas Jaeger <aj@suse.de>
Date: Mon Apr 20 11:15:35 2015 +0200
Release Import of Translations from Transifex
Manual import of Translations from Transifex. This change also removes
all po files that are less than 66 per cent translated since such
partially translated files will not help users.
This updates also recreates all pot (translation source files) to
reflect the state of the repository.
This change needs to be done manually since the automatic import does
not handle the proposed branches and we need to sync with latest
translations.
Note: This is part of importing of translations, there are no new
translations for this project, thus only the pot file gets updated.
Change-Id: I0cbfdae3bd1662da54c58e91a13f49419eba9b2d
commit cd7c58e93690fd25f5266754d0593c656dd51e2e
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Closes-Bug: 1446801
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 281cb1c210f0292bad190cabaae447145fa5eade
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Closes-Bug: 1446727
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit 51e31c5c7147f3ba61437e132b12b491ca718ce4
Author: Clay Gerrard <clay.gerrard@gmail.com>
Date: Wed Apr 15 15:31:06 2015 -0700
Don't apply the wrong Etag validation to rebuilt fragments
Because of the object-server's interaction with ssync sender's
X-Backend-Replication-Headers when a object (or fragment archive) is
pushed unmodified to another node it's ETag value is duped into the
recieving ends metadata as Etag. This interacts poorly with the
reconstructor's RebuildingECDiskFileStream which can not know ahead of
time the ETag of the fragment archive being rebuilt.
Don't send the Etag from the local source fragment archive being used as
the basis for the rebuilt fragent archive's metadata along to ssync.
Closes-Bug: 1446800
Change-Id: Ie59ad93a67a7f439c9a84cd9cff31540f97f334a
commit 2080f7dbd897d6130542dbf88e37641a41625eb5
Author: Alistair Coles <alistair.coles@hp.com>
Date: Thu Feb 26 15:16:22 2015 +0000
Fix tempauth acl checks when simplejson has no speedups
As documented in linked bug report, tempauth unit tests
were seen to fail on a system where simplejson was
installed but without the speedups extension. This
is because the tempauth account acl validation checks
that values are type str, but without the speedups
extension the json parser is returning unicode objects.
Fix is to have the acl validator tolerate those objects
being unicode or str.
Also change common/bufferedhttp.py to coerce ring device
to type str when constructing a path, in order to avoid
a UnicodeDecodeError when httplib sends a message that
has non-ascii header values.
Change-Id: I01524282cbaa25dc4b6dfa09f3f4723516cdba99
Closes-Bug: 1425776
commit 27f6fba5c3b9e0461d52c1deffe32130e7e9af51
Author: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Date: Mon Apr 20 00:18:25 2015 -0700
Use reconstruct insetad of decode/encode
With bumping PyECLib up to 1.0.7 on global requirements,
we can use the "reconstruct" function directly instead
of the current hack doing decode/encode on reconstructor.
That is because the hack was for treating PyECLib < 1.0.7
(strictly jearsure scheme) reconstruction bug so we don't
have to do decode/encode anymore.
Co-Authored-By: Clay Gerrard <clay.gerrard@gmail.com>
Change-Id: I69aae495670e3d0bdebe665f73915547a4d56f99
commit 0c391d6daffe1943f6def803db42e08e6d6846d2
Author: Samuel Merritt <sam@swiftstack.com>
Date: Mon Apr 20 16:47:10 2015 -0700
SAIO instructions: ensure ~/bin exists before copying into it
Change-Id: I16cd211b00b529ccc4b46f6b10497c32b6741896
commit c5c281ba6dd97a301ba80511e3356d6ca536d701
Author: Minwoo B <minwoob@us.ibm.com>
Date: Mon Apr 20 17:03:25 2015 -0500
Included step in development\_saio.rst for installing dependencies in requirements.txt.
Change-Id: I6ed1704148e5ae1e3164d10080c350d81856f7a9
commit 2203b46e3f14ef68a090aaea284f0a0442bbb86f
Author: Tushar Gohad <tushar.gohad@intel.com>
Date: Wed Apr 15 17:34:48 2015 -0700
Bump PyECLib version from 1.0.3 to 1.0.7
In addition to fixing several bugs, 1.0.7 eliminates the need for a
few work-around code in Swift. This code was only to hide issues in
the current version, but it also ends up breaking some third-party
integration. In order to enable expected functionality and to avoid
dealing with deprecation issues right from the beginning, we need to
bump the minium PyECLib requirement to 1.0.7.
Change-Id: I03e059e7335656c22be28ffd6157b56e13bdfc1b
commit f6482bdece27144ee083a53d696469528d7940c2
Author: Thierry Carrez <thierry@openstack.org>
Date: Thu Apr 16 22:08:47 2015 +0200
Set default branch to stable/kilo
Open stable/kilo branch by setting defaultbranch for git-review.
Change-Id: I81bcda30f99173416eaaa3f1d42da32f3ab5b6d2
commit a2a5b6aa6664b61fa31d25f329426ff089372f17
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Apr 16 11:42:12 2015 -0700
Functional test for SLO PUT overwriting one of its own segments
Change-Id: I4855816848f4fdb148d0b82735cf79bc68429617
commit e4d326b5a7dd186d762726faa45733ff2900343d
Author: Kazuhiro MIYAHARA <miyahara.kazuhiro@lab.ntt.co.jp>
Date: Thu Feb 19 17:38:10 2015 +0900
Fix conflict SLO reponse
This patch fixes Swift to respond "409 Conflict"
when a segment object path of the manifest on PUT SLO
is same as requested object path. It is because
the request will overwrite the segment and then it
will absolutely cause "409 Conflict" on GET SLO.
e.g.:
request:
PUT "http://hostname/v1/AUTH\_account/container/segment\_object\_00?multipart-manifest=put"
manifest file:
[{"path" : "container/segment\_object\_00", "etag" : "<etag of segment\_object\_00>", "size\_bytes" : <size of segment\_object\_00>},
{"path" : "container/segment\_object\_01", "etag" : "<etag of segment\_object\_01>", "size\_bytes" : <size of segment\_object\_01>},
{"path" : "container/segment\_object\_02", "etag" : "<etag of segment\_object\_02>", "size\_bytes" : <size of segment\_object\_02>}]
Change-Id: I4f4f7b9dbeb6a7c355b801c7e0ae560aa19a70b4
Closes-Bug: 1417936
commit 38ae7bb89c95292c171cb89c1d62859cee0cc24f
Author: Alistair Coles <alistair.coles@hp.com>
Date: Wed Apr 15 23:03:21 2015 +0100
Make the reaper use same timestamp for replica deletes
The account reaper is using a unique timestamp when deleting
replicas of the same resource. This will result in unnecessary
replication traffic after reaping.
This patch makes the reaper use a single timestamp per resource.
Probe test is modified to check that delete times are equal
across replicas before replicators run.
test\_direct\_client.py is modified to check that it uses explicit
timestamp when passed to direct\_delete\_[object|container]
methods.
Drive-by bug fixes in the probe test e.g. it was not sending
X-Backend-Storage-Policy-Index when doing a direct GET to check
object state, so the 404s being verified could in fact be due
to diskfile not existing rather than diskfile being deleted.
Closes-Bug: 1442879
Change-Id: I8bab22d66308bb9d3294e1e0def017c784228423
commit 7bdb8266d4b926526acdea22e8c9c634855eeecc
Author: Thiago da Silva <thiago@redhat.com>
Date: Wed Mar 25 13:19:36 2015 +0000
Select policy when running functional test
Add ability to select a storage policy when running
the functional tests by defining the environment variable
SWIFT\_TEST\_POLICY.
This patch was first introduced by Janie Richling in
feature/ec: https://review.openstack.org/#/c/166097
Co-Authored-By: Janie Richling <jrichli@us.ibm.com>
Co-Authored-By: Christian Schwede <christian.schwede@enovance.com>
Co-Authored-By: Kota Tsuyuzaki <tsuyuzaki.kota@lab.ntt.co.jp>
Co-Authored-By: Alistair Coles <alistair.coles@hp.com>
Change-Id: Id96354546088df137def0ae7fd434baf64ed0c51
Signed-off-by: Thiago da Silva <thiago@redhat.com>
commit 9c33bbde6923b26f111572ae967a3b97a8ab12f2
Author: Prashanth Pai <ppai@redhat.com>
Date: Tue Jan 20 12:14:32 2015 +0530
Allow rsync to use compression
From rsync's man page:
-z, --compress
With this option, rsync compresses the file data as it is sent to the
destination machine, which reduces the amount of data being transmitted --
something that is useful over a slow connection.
A configurable option has been added to allow rsync to compress, but only
if the remote node is in a different region than the local one.
NOTE: Objects that are already compressed (for example: .tar.gz, .mp3)
might slow down the syncing process.
On wire compression can also be extended to ssync later in a different
change if required. In case of ssync, we could explore faster
compression libraries like lz4. rsync uses zlib which is slow but offers
higher compression ratio.
Change-Id: Ic9b9cbff9b5e68bef8257b522cc352fc3544db3c
Signed-off-by: Prashanth Pai <ppai@redhat.com>

| **tags**: | added: in-feature-crypto |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-05:  [**Re: Download DLO objects leak connections when client kill connection**](/swift/%2Bbug/1466549/comments/16) |  |  | [#16](/swift/%2Bbug/1466549/comments/16) |
| --- | --- | --- | --- |

Swift cores, can you answer comment #7 please ?

Swift cores, can you answer comment #7 please ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [clayg (clay-gerrard)](https://launchpad.net/~clay-gerrard) wrote on 2015-08-06: |  |  | [#17](/swift/%2Bbug/1466549/comments/17) |
| --- | --- | --- | --- |

yeah, <https://review.openstack.org/#/c/193303/> was the fix.

But it's really about the same as [https://bugs.launchpad.net/swift/+bug/667956](https://bugs.launchpad.net/swift/%2Bbug/667956) (i.e. slow resource exhaustion depending on your clients access patterns) and that was open for ages. I'm glad we fixed both of them...

So yeah, people that need to support a bunch of VOD clients that disconnect reading \*LO's should upgrade to the latest Swift or they will probably encounter this bug.

yeah, https://review.openstack.org/#/c/193303/ was the fix.
But it's really about the same as https://bugs.launchpad.net/swift/+bug/667956 (i.e. slow resource exhaustion depending on your clients access patterns) and that was open for ages. I'm glad we fixed both of them...
So yeah, people that need to support a bunch of VOD clients that disconnect reading \*LO's should upgrade to the latest Swift or they will probably encounter this bug.

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2015-08-26

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2015-08-26: |  |  | [#18](/swift/%2Bbug/1466549/comments/18) |
| --- | --- | --- | --- |

Thanks clayg, so this issue can be abused, the fix should be backported and an OSSA issued.

Here is the proposed impact description:

Title: Swift proxy-server DoS through Large Object

Reporter: Romain LE DISEZ (OVH)

Products: Swift

Affects: versions through 2.3.0

Description:

Romain LE DISEZ from OVH reported a vulnerability in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. All Swift setup are affected.

Thanks clayg, so this issue can be abused, the fix should be backported and an OSSA issued.
Here is the proposed impact description:
Title: Swift proxy-server DoS through Large Object
Reporter: Romain LE DISEZ (OVH)
Products: Swift
Affects: versions through 2.3.0
Description:
Romain LE DISEZ from OVH reported a vulnerability in Swift Large Object. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service. All Swift setup are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-08-27:  [**Fix proposed to swift (stable/kilo)**](/swift/%2Bbug/1466549/comments/19) |  |  | [#19](/swift/%2Bbug/1466549/comments/19) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/kilo

Review: <https://review.openstack.org/217750>

Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/217750

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2015-09-01

| Changed in swift: | |
| --- | --- |
| **milestone**: | none → 2.4.0 |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-09-23:  [**Re: Download DLO objects leak connections when client kill connection**](/swift/%2Bbug/1466549/comments/20) |  |  | [#20](/swift/%2Bbug/1466549/comments/20) |
| --- | --- | --- | --- |

It seems the bug is not really fixed but it is "moved". I know have sockets leak when a client stops a DLO download. Each interrupted DLO download leak one TCP socket. It applies on Linux, don't know if others OS are impacted.

How to reproduce, on a fresh SAIO on master, with processes just started:

1. Upload an object in DLO

    $ dd if=/dev/zero of=2x1G bs=1M count=2048

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing post test

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing upload test -S 1073741824 2x1G

2. In an other terminal, watch socket stats:

   $ while [ 1 ]; do grep ^TCP /proc/net/sockstat; sleep 1; done

(For now, you should see that the number of allocated sockets is stable, for me: alloc 45)

3. Start to download the object, but stop it before the end (eg: CTRL+C)

    $ swift -A <http://127.0.0.1:8080/auth/v1.0> -U test:tester -K testing download test 2x1G --no-download

(Now, you should see one more allocated socket)

4. Repeat step 3 and observe the socket stacking

So, no more connections leak, but socket leak. Instead of few hours, it takes few days to exhaust server resources.

It seems the bug is not really fixed but it is "moved". I know have sockets leak when a client stops a DLO download. Each interrupted DLO download leak one TCP socket. It applies on Linux, don't know if others OS are impacted.
How to reproduce, on a fresh SAIO on master, with processes just started:
1. Upload an object in DLO
$ dd if=/dev/zero of=2x1G bs=1M count=2048
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing post test
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing upload test -S 1073741824 2x1G
2. In an other terminal, watch socket stats:
$ while [ 1 ]; do grep ^TCP /proc/net/sockstat; sleep 1; done
(For now, you should see that the number of allocated sockets is stable, for me: alloc 45)
3. Start to download the object, but stop it before the end (eg: CTRL+C)
$ swift -A http://127.0.0.1:8080/auth/v1.0 -U test:tester -K testing download test 2x1G --no-download
(Now, you should see one more allocated socket)
4. Repeat step 3 and observe the socket stacking
So, no more connections leak, but socket leak. Instead of few hours, it takes few days to exhaust server resources.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2015-10-20:  [**Change abandoned on swift (stable/kilo)**](/swift/%2Bbug/1466549/comments/21) |  |  | [#21](/swift/%2Bbug/1466549/comments/21) |
| --- | --- | --- | --- |

Change abandoned by John Dickinson (<email address hidden>) on branch: stable/kilo

Review: <https://review.openstack.org/217750>

Reason: Abanoning based on the lack of activity since the last negative review. If you want to continue working on this, please reopen this patch.

Change abandoned by John Dickinson (me@not.mn) on branch: stable/kilo
Review: https://review.openstack.org/217750
Reason: Abanoning based on the lack of activity since the last negative review. If you want to continue working on this, please reopen this patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [clayg (clay-gerrard)](https://launchpad.net/~clay-gerrard) wrote on 2015-11-03:  [**Re: Download DLO objects leak connections when client kill connection**](/swift/%2Bbug/1466549/comments/22) |  |  | [#22](/swift/%2Bbug/1466549/comments/22) |
| --- | --- | --- | --- |

so is this the same as the lp [bug #1361360](/bugs/1361360) ?

so is this the same as the lp bug #1361360 ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Romain LE DISEZ (rledisez)](https://launchpad.net/~rledisez) wrote on 2015-11-04: |  |  | [#23](/swift/%2Bbug/1466549/comments/23) |
| --- | --- | --- | --- |

I don't think it is the same. [Bug #1361360](/bugs/1361360) describe the slowloris attack, where TCP connections are kept open for a long time if the client does not close the connection.

The behavior i'm observing is that when client close the connection, the TCP connection is closed, but the socket is not released. Also, it does not apply on standard downloads, but only on DLO downloads.

To be sure, i tried to set keepalive=False (and socket\_timeout=10): it didn't fix the problem.

I don't think it is the same. Bug #1361360 describe the slowloris attack, where TCP connections are kept open for a long time if the client does not close the connection.
The behavior i'm observing is that when client close the connection, the TCP connection is closed, but the socket is not released. Also, it does not apply on standard downloads, but only on DLO downloads.
To be sure, i tried to set keepalive=False (and socket\_timeout=10): it didn't fix the problem.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Grant Murphy (gmurphy)](https://launchpad.net/~gmurphy) wrote on 2015-11-17: |  |  | [#24](/swift/%2Bbug/1466549/comments/24) |
| --- | --- | --- | --- |

+1 impact description in comment #18

+1 impact description in comment #18

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-14:  [**Fix merged to swift (stable/kilo)**](/swift/%2Bbug/1466549/comments/25) |  |  | [#25](/swift/%2Bbug/1466549/comments/25) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/217750>

Committed: <https://git.openstack.org/cgit/openstack/swift/commit/?id=036c2f348d24c01c7a4deba3e44889c45270b46d>

Submitter: Jenkins

Branch: stable/kilo

commit 036c2f348d24c01c7a4deba3e44889c45270b46d

Author: Samuel Merritt <email address hidden>

Date: Thu Jun 18 12:58:03 2015 -0700

Get better at closing WSGI iterables.

PEP 333 (WSGI) says: "If the iterable returned by the application has

    a close() method, the server or gateway must call that method upon

    completion of the current request[.]"

There's a bunch of places where we weren't doing that; some of them

    matter more than others. Calling .close() can prevent a connection

    leak in some cases. In others, it just provides a certain pedantic

    smugness. Either way, we should do what WSGI requires.

Noteworthy goofs include:

\* If a client is downloading a large object and disconnects halfway

        through, a proxy -> obj connection may be leaked. In this case,

        the WSGI iterable is a SegmentedIterable, which lacked a close()

        method. Thus, when the WSGI server noticed the client disconnect,

        it had no way of telling the SegmentedIterable about it, and so

        the underlying iterable for the segment's data didn't get

        closed.

Here, it seems likely (though unproven) that the object server

        would time out and kill the connection, or that a

        ChunkWriteTimeout would fire down in the proxy server, so the

        leaked connection would eventually go away. However, a flurry of

        client disconnects could leave a big pile of useless connections.

\* If a conditional request receives a 304 or 412, the underlying

        app\_iter is not closed. This mostly affects conditional requests

        for large objects.

The leaked connections were noticed by this patch's co-author, who

    made the changes to SegmentedIterable. Those changes helped, but did

    not completely fix, the issue. The rest of the patch is an attempt to

    plug the rest of the holes.

Co-Authored-By: Romain LE DISEZ <email address hidden>

Closes-Bug: #1466549

Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937

    (cherry picked from commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9

    with fixed import conflicts)

Reviewed: https://review.openstack.org/217750
Committed: https://git.openstack.org/cgit/openstack/swift/commit/?id=036c2f348d24c01c7a4deba3e44889c45270b46d
Submitter: Jenkins
Branch: stable/kilo
commit 036c2f348d24c01c7a4deba3e44889c45270b46d
Author: Samuel Merritt <sam@swiftstack.com>
Date: Thu Jun 18 12:58:03 2015 -0700
Get better at closing WSGI iterables.
PEP 333 (WSGI) says: "If the iterable returned by the application has
a close() method, the server or gateway must call that method upon
completion of the current request[.]"
There's a bunch of places where we weren't doing that; some of them
matter more than others. Calling .close() can prevent a connection
leak in some cases. In others, it just provides a certain pedantic
smugness. Either way, we should do what WSGI requires.
Noteworthy goofs include:
\* If a client is downloading a large object and disconnects halfway
through, a proxy -> obj connection may be leaked. In this case,
the WSGI iterable is a SegmentedIterable, which lacked a close()
method. Thus, when the WSGI server noticed the client disconnect,
it had no way of telling the SegmentedIterable about it, and so
the underlying iterable for the segment's data didn't get
closed.
Here, it seems likely (though unproven) that the object server
would time out and kill the connection, or that a
ChunkWriteTimeout would fire down in the proxy server, so the
leaked connection would eventually go away. However, a flurry of
client disconnects could leave a big pile of useless connections.
\* If a conditional request receives a 304 or 412, the underlying
app\_iter is not closed. This mostly affects conditional requests
for large objects.
The leaked connections were noticed by this patch's co-author, who
made the changes to SegmentedIterable. Those changes helped, but did
not completely fix, the issue. The rest of the patch is an attempt to
plug the rest of the holes.
Co-Authored-By: Romain LE DISEZ <romain.ledisez@ovh.net>
Closes-Bug: #1466549
Change-Id: I168e147aae7c1728e7e3fdabb7fba6f2d747d937
(cherry picked from commit 12d8a53fffea6e4bed8ba3d502ce625f5c6710b9
with fixed import conflicts)

| **tags**: | added: in-stable-kilo |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-14

| **summary**: | Download DLO objects leak connections when client kill connection+ (CVE-2016-0737) |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-20

| **summary**: | - Download DLO objects leak connections when client kill connection- (CVE-2016-0737)+ [OSSA 2016-004] Download DLO objects leak connections when client kill+ connection (CVE-2016-0737) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-20:  [**Related fix proposed to ossa (master)**](/swift/%2Bbug/1466549/comments/26) |  |  | [#26](/swift/%2Bbug/1466549/comments/26) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: <https://review.openstack.org/270241>

Related fix proposed to branch: master
Review: https://review.openstack.org/270241

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2016-01-20

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2016-01-28:  [**Related fix merged to ossa (master)**](/swift/%2Bbug/1466549/comments/27) |  |  | [#27](/swift/%2Bbug/1466549/comments/27) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/270241>

Committed: <https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d>

Submitter: Jenkins

Branch: master

commit 606a18e718aed329a9d42d298e3119f0f1974e3d

Author: Tristan Cacqueray <email address hidden>

Date: Wed Jan 20 10:19:30 2016 -0500

Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)

Related-Bug: #1466549

    Related-Bug: #1493303

    Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

Reviewed: https://review.openstack.org/270241
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=606a18e718aed329a9d42d298e3119f0f1974e3d
Submitter: Jenkins
Branch: master
commit 606a18e718aed329a9d42d298e3119f0f1974e3d
Author: Tristan Cacqueray <tdecacqu@redhat.com>
Date: Wed Jan 20 10:19:30 2016 -0500
Adds OSSA-2016-004 (CVE-2016-0737, CVE-2016-0738)
Related-Bug: #1466549
Related-Bug: #1493303
Change-Id: Id7b40ab5101ccbd889c4ffc6bd9629bb5f2b8d7f

[See full activity log](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/swift/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/swift/%2Bbug/1466549/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/swift/%2Bbug/1466549/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

* [python-roundup #16037](http://bugs.python.org/issue16037)

  [2:3]
  [Edit](/bugs/1466549/%2Bwatch/116735 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_9e50c715_20250126_093648.html ===

[Log in / Register](https://launchpad.net/~tristan-cacqueray/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~tristan-cacqueray)

## [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray)

* Overview
* [Code](https://code.launchpad.net/~tristan-cacqueray)
* [Bugs](https://bugs.launchpad.net/~tristan-cacqueray)
* [Blueprints](https://blueprints.launchpad.net/~tristan-cacqueray)
* [Translations](https://translations.launchpad.net/~tristan-cacqueray)
* [Answers](https://answers.launchpad.net/~tristan-cacqueray)

* [Related packages](https://launchpad.net/~tristan-cacqueray/%2Brelated-packages)
* [Related projects](https://launchpad.net/~tristan-cacqueray/%2Brelated-projects)

## User information

Launchpad Id:
tristan-cacqueray

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-10-25

[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)

Signed Ubuntu Code of Conduct:
Yes

Languages:

English

OpenPGP keys:

EB103DE8B5E69E631C6FF17922B9A05C925CC5D8

SSH keys:

[localadmin@controller](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~tristan-cacqueray/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**tristanC**
 on
**irc.freenode.net**

## [All memberships](https://launchpad.net/~tristan-cacqueray/%2Bparticipation) Latest memberships

| [Swiftsync dev](/~swiftsync-devteam)  Joined on 2014-02-13 | |
| --- | --- |
| [OpenStack Security SIG](/~openstack-ossg)  Joined on 2013-12-12 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from review.openstack.org_08731f32_20250126_093656.html ===




=== Content from www.redhat.com_c9d4c12c_20250126_093648.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from translations.launchpad.net_9839fa71_20250126_093632.html ===

[Log in / Register](https://translations.launchpad.net/cloud-archive/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/cloud-archive)

## [Ubuntu Cloud Archive](https://launchpad.net/cloud-archive)

* [Overview](https://launchpad.net/cloud-archive)
* [Code](https://code.launchpad.net/cloud-archive)
* [Bugs](https://bugs.launchpad.net/cloud-archive)
* [Blueprints](https://blueprints.launchpad.net/cloud-archive)
* Translations
* [Answers](https://answers.launchpad.net/cloud-archive)

# Translation overview

[Help for translations](https://help.launchpad.net/Translations)

**Ubuntu Cloud Archive does not translate its
messages.**

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugzilla.redhat.com_b2daa2e5_20250126_093650.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1298905)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1298905)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1298905)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1298905

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1298905**](show_bug.cgi?id=1298905)
(CVE-2016-0738)
- [CVE-2016-0738](https://access.redhat.com/security/cve/CVE-2016-0738) openstack-swift: Proxy to server DoS through Large Objects

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2016-0738 openstack-swift: Proxy to server DoS through Large Objects

| | [Keywords](describekeywords.cgi): | Reopened  Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2016-0738 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1299668](show_bug.cgi?id=1299668) [1299669](show_bug.cgi?id=1299669) [1299670](show_bug.cgi?id=1299670) [1299671](show_bug.cgi?id=1299671) [1299672](show_bug.cgi?id=1299672) [1300612](show_bug.cgi?id=1300612) [1300613](show_bug.cgi?id=1300613 "CLOSED ERRATA - CVE-2016-0738 openstack-swift: Proxy to server DoS through Large Objects [fedora-all]") [1308476](show_bug.cgi?id=1308476) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1298929](show_bug.cgi?id=1298929) [1312737](show_bug.cgi?id=1312737) | | TreeView+ | [depends on](buglist.cgi?bug_id=1298905&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1298905&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2016-01-15 12:10 UTC by Adam Mariš | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-06-02 06:25 UTC ([History](show_activity.cgi?id=1298905)) | | [CC List:](page.cgi?id=fields.html#cclist) | 36 users (show)  aavati abaron aortega apevec ayoung chrisw dallan derekh gkotton gmollett jjoyce jrusnack jschluet kbasil lhh lpeer markmc mburns nlevinki osoukup rbryant rfortier sclewis security-response-team sgirijan sisharma slinaber slong smohan srevivo ssaha tdecacqu tshefi vbellur yeylon zaitcev | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: | A memory-leak issue was found in OpenStack Object Storage (swift), in the proxy-to-server connection. An OpenStack-authenticated attacker could remotely trigger this flaw to cause denial of service through excess memory consumption. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2016-03-01 10:31:19 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**Master/mitaka patch**](attachment.cgi?id=1115108 "View the content of the attachment") (6.78 KB, patch)  [2016-01-15 12:12 UTC](#attach_1115108 "Go to the comment associated with the attachment"), Adam Mariš | *no flags* | [Details](attachment.cgi?id=1115108&action=edit) | [Diff](attachment.cgi?id=1115108&action=diff) | | [**Stable/kilo patch**](attachment.cgi?id=1115109 "View the content of the attachment") (6.35 KB, patch)  [2016-01-15 12:12 UTC](#attach_1115109 "Go to the comment associated with the attachment"), Adam Mariš | *no flags* | [Details](attachment.cgi?id=1115109&action=edit) | [Diff](attachment.cgi?id=1115109&action=diff) | | [**Stable/liberty patch**](attachment.cgi?id=1115112 "View the content of the attachment") (6.79 KB, patch)  [2016-01-15 12:13 UTC](#attach_1115112 "Go to the comment associated with the attachment"), Adam Mariš | *no flags* | [Details](attachment.cgi?id=1115112&action=edit) | [Diff](attachment.cgi?id=1115112&action=diff) | | [View All](attachment.cgi?bugid=1298905&action=viewall) | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2016:0126](https://access.redhat.com/errata/RHSA-2016%3A0126) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-08 09:35:30 UTC | | Red Hat Product Errata | [RHSA-2016:0127](https://access.redhat.com/errata/RHSA-2016%3A0127) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-08 09:35:22 UTC | | Red Hat Product Errata | [RHSA-2016:0128](https://access.redhat.com/errata/RHSA-2016%3A0128) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-08 09:35:11 UTC | | Red Hat Product Errata | [RHSA-2016:0155](https://access.redhat.com/errata/RHSA-2016%3A0155) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-10 01:56:35 UTC | | Red Hat Product Errata | [RHSA-2016:0328](https://access.redhat.com/errata/RHSA-2016%3A0328) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-03-01 12:02:03 UTC | | Red Hat Product Errata | [RHSA-2016:0329](https://access.redhat.com/errata/RHSA-2016%3A0329) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-03-01 12:01:20 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1298905#c0)  Adam Mariš    2016-01-15 12:10:22 UTC  ``` A DoS vulnerability in openstack-swift was reported. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service.  Affects versions: >=2.2.1 <= 2.3.0, >= 2.4.0 <= 2.5.0  There are two similar bugs, [CVE-2016-0738](https://access.redhat.com/security/cve/CVE-2016-0738) is for proxy to server connection.   ```  [Comment 1](show_bug.cgi?id=1298905#c1)  Adam Mariš    2016-01-15 12:12:09 UTC  ``` Created [attachment 1115108](attachment.cgi?id=1115108&action=diff "Master/mitaka patch") [[details]](attachment.cgi?id=1115108&action=edit "Master/mitaka patch") Master/mitaka patch   ```  [Comment 2](show_bug.cgi?id=1298905#c2)  Adam Mariš    2016-01-15 12:12:39 UTC  ``` Created [attachment 1115109](attachment.cgi?id=1115109&action=diff "Stable/kilo patch") [[details]](attachment.cgi?id=1115109&action=edit "Stable/kilo patch") Stable/kilo patch   ```  [Comment 3](show_bug.cgi?id=1298905#c3)  Adam Mariš    2016-01-15 12:13:10 UTC  ``` Created [attachment 1115112](attachment.cgi?id=1115112&action=diff "Stable/liberty patch") [[details]](attachment.cgi?id=1115112&action=edit "Stable/liberty patch") Stable/liberty patch   ```  [Comment 7](show_bug.cgi?id=1298905#c7)  Andrej Nemec    2016-01-21 09:40:16 UTC  ```  Created openstack-swift tracking bugs for this issue:  Affects: fedora-all [[bug 1300613](show_bug.cgi?id=1300613 "CLOSED ERRATA - CVE-2016-0738 openstack-swift: Proxy to server DoS through Large Objects [fedora-all]")]   ```  [Comment 8](show_bug.cgi?id=1298905#c8)  Andrej Nemec    2016-01-21 09:40:41 UTC  ``` This issue is now public.   ```  [Comment 9](show_bug.cgi?id=1298905#c9)  Fedora Update System    2016-02-02 19:21:05 UTC  ``` openstack-swift-2.3.0-3.fc23 has been pushed to the Fedora 23 stable repository. If problems still persist, please make note of it in this bug report.   ```  [Comment 10](show_bug.cgi?id=1298905#c10)  errata-xmlrpc    2016-02-08 04:35:44 UTC  ``` This issue has been addressed in the following products:    OpenStack 6 for RHEL 7  Via RHSA-2016:0128 <https://rhn.redhat.com/errata/RHSA-2016-0128.html>   ```  [Comment 11](show_bug.cgi?id=1298905#c11)  errata-xmlrpc    2016-02-08 04:36:28 UTC  ``` This issue has been addressed in the following products:    OpenStack 5 for RHEL 7  Via RHSA-2016:0127 <https://rhn.redhat.com/errata/RHSA-2016-0127.html>   ```  [Comment 12](show_bug.cgi?id=1298905#c12)  errata-xmlrpc    2016-02-08 04:37:41 UTC  ``` This issue has been addressed in the following products:    OpenStack 5 for RHEL 6  Via RHSA-2016:0126 <https://rhn.redhat.com/errata/RHSA-2016-0126.html>   ```  [Comment 13](show_bug.cgi?id=1298905#c13)  errata-xmlrpc    2016-02-09 20:56:48 UTC  ``` This issue has been addressed in the following products:    OpenStack 7 For RHEL 7  Via RHSA-2016:0155 <https://rhn.redhat.com/errata/RHSA-2016-0155.html>   ```  [Comment 15](show_bug.cgi?id=1298905#c15)  errata-xmlrpc    2016-03-01 07:02:21 UTC  ``` This issue has been addressed in the following products:    Red Hat Gluster Storage 3.1 for RHEL 6  Via RHSA-2016:0329 <https://rhn.redhat.com/errata/RHSA-2016-0329.html>   ```  [Comment 16](show_bug.cgi?id=1298905#c16)  errata-xmlrpc    2016-03-01 07:03:06 UTC  ``` This issue has been addressed in the following products:    Red Hat Gluster Storage 3.1 for RHEL 7  Via RHSA-2016:0328 <https://rhn.redhat.com/errata/RHSA-2016-0328.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1298905&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from answers.launchpad.net_ca8585c3_20250126_093633.html ===

[Log in / Register](https://answers.launchpad.net/cloud-archive/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/cloud-archive)

## [Ubuntu Cloud Archive](https://launchpad.net/cloud-archive)

* [Overview](https://launchpad.net/cloud-archive)
* [Code](https://code.launchpad.net/cloud-archive)
* [Bugs](https://bugs.launchpad.net/cloud-archive)
* [Blueprints](https://blueprints.launchpad.net/cloud-archive)
* [Translations](https://translations.launchpad.net/cloud-archive)
* Answers

# Questions for Ubuntu Cloud Archive

by relevancy
by status
newest first
oldest first
recently updated first

Status
 Open    Needs information    Answered    Solved    Expired    Invalid

| Summary | | | Created | Submitter | Assignee | Status |
| --- | --- | --- | --- | --- | --- | --- |
| Open | 678564 | [How to ask for bug status if fix was released for other version](/cloud-archive/%2Bquestion/678564) | 2019-02-14 16:15:33 UTC 2019-02-14 | [Joris Baum](https://launchpad.net/~jbaumcloud) | — | Open |
| Solved | 269200 | [/etc/init.d directory and service files are missing from packages](/cloud-archive/%2Bquestion/269200) | 2015-07-14 08:17:06 UTC 2015-07-14 | [Matteo Pergolesi](https://launchpad.net/~matpergo) | — | Solved |
| Answered | 265851 | [CRITICAL glance [-] AttributeError: 'NoneType' object has no attribute 'drivername'](/cloud-archive/%2Bquestion/265851) | 2015-04-25 11:21:57 UTC 2015-04-25 | [amira](https://launchpad.net/~amira-nasri88) | — | Answered |

| **1** → **3** of 3 results | First • Previous • **Next** • Last |
| --- | --- |

* [Ask a question](https://answers.launchpad.net/cloud-archive/%2Baddquestion)

* [All FAQs](https://answers.launchpad.net/cloud-archive/%2Bfaqs)
* [Open](https://answers.launchpad.net/cloud-archive/%2Bquestions?field.status=Open&field.sort=recently+updated+first&field.search_text=&field.actions.search=Search)
* [Answered](https://answers.launchpad.net/cloud-archive/%2Bquestions?field.status=Answered&field.status=Solved&field.sort=by+relevancy&field.search_text=&field.actions.search=Search)
* [My questions](https://answers.launchpad.net/cloud-archive/%2Bmyquestions)
* [Need attention](https://answers.launchpad.net/cloud-archive/%2Bneed-attention)
* [Ask a question](https://answers.launchpad.net/cloud-archive/%2Baddquestion)
* [Set answer contact](https://answers.launchpad.net/cloud-archive/%2Banswer-contact)

## Answer contacts for Ubuntu Cloud Archive

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_389ce8f4_20250126_093629.html ===

[Log in / Register](https://launchpad.net/%2Blogin)

![Launchpad logo and name](/@@/launchpad-logo-and-name.svg)

---

Search

Search

**47,168** projects,
**2,043,835** bugs,
**1,009,617** branches,
**86,958** Git repositories,
**3,149,475** translations,
**817,744** answers,
**76,153** blueprints,
and counting...

## Launchpad

#### A software collaboration platform that provides

#### [Bug tracking](https://bugs.launchpad.net/)

One place to track bugs across project boundaries and tools

#### [Code hosting](https://code.launchpad.net/) using [Git](https://git-scm.com/) and [Bazaar](http://bazaar.canonical.com/)

Easy for anyone to get your project's code using Git or Bazaar

#### [Code reviews](https://help.launchpad.net/Code/Review)

Full control of who can land code in your project remains with you

#### [Ubuntu package building and hosting](https://launchpad.net/ubuntu)

Publishing your software is simple with Personal Package Archives

#### [Crowd source translations](https://translations.launchpad.net/)

Build an open community to translate your software into almost any language

#### [Mailing lists](https://help.launchpad.net/Teams/MailingLists)

Find and work with the right people by building a social network of individuals and teams around projects

#### [Answer tracking and FAQs](https://answers.launchpad.net/)

Free software thrives on people helping each other when the unexpected happens

#### [Specification tracking](https://blueprints.launchpad.net/)

Track ideas and chunks of work as “blueprints”

## Get started

Learn more about Launchpad in the
[user guide](https://help.launchpad.net/).

If you're ready, you can:

* ![add](/@@/add-homepage.png)
  #### [Create an account](/%2Blogin)
* ![tour](/@@/tour-homepage.png)
  #### [Take the tour](/%2Btour)
* ![question](/@@/question-homepage.png)
  #### [Find answers](https://answers.launchpad.net/)

## Featured projects

* ![Beautiful Soup](/@@/product-logo)
  #### [Beautiful Soup](/beautifulsoup)

  A program designed for screen-scraping HTML. The discussion group is at: http://groups.google.com...
* ![Breezy](/@@/product-logo)
  #### [Breezy](/brz)

  Breezy is a friendly powerful distributed version control system.
* ![Inkscape](https://launchpadlibrarian.net/66795469/ink-lp-logo.png)
  #### [Inkscape](/inkscape)

  Inkscape is an SVG-based graphics editor featuring alpha
  blending, node editing, SVG to PNG exp...
* ![Launchpad itself](https://launchpadlibrarian.net/600817174/Canonical_Launchpad_icon_64px.png)
  #### [Launchpad itself](/launchpad)

  Launchpad is a set of Web services to help software developers collaborate.
* ![OpenMW](/@@/product-logo)
  #### [OpenMW](/openmw)

  OpenMW is an attempt to reimplement the popular role playing game Morrowind. It aims to be a full...
* ![OpenShot Video Editor](https://launchpadlibrarian.net/250357498/OpenShot-2-Logo.png)
  #### [OpenShot Video Editor](/openshot)

  OpenShot Video Editor is a free, open-source, non-linear video editor. It can create and edit vid...
* ![OpenStack](https://launchpadlibrarian.net/52042558/os64.png)
  #### [OpenStack](/openstack)

  The OpenStack Open Source Cloud Mission: to produce the ubiquitous Open Source Cloud Computing pl...
* ![txpkgupload](/@@/product-logo)
  #### [txpkgupload](/txpkgupload)

  Package upload server used by Launchpad.
* ![Ubuntu](https://launchpadlibrarian.net/606381979/CoF%2064px.png)
  #### [Ubuntu](/ubuntu)

  Ubuntu is a complete Linux-based operating system, freely available with both community and profe...

* **[Browse all
  47168
  projects](/projects)!**

## Recent Launchpad blog posts

[Read the blog](http://blog.launchpad.net)

* [Introducing Launchpad Bug Templates](https://blog.launchpad.net/general/introducing-launchpad-bug-templates)
  – 03 Dec 2024

  The new feature bug templates in Launchpad aims to streamline the bug reporting process, making it more efficient for both users and project maintainers. In the past, Launchpad provided only a basic description field for filling bug reports. This often led to incomplete or vague submissions, as users may not include essential details or steps […]
* [Launchpad’s new homepage](https://blog.launchpad.net/general/launchpads-new-homepage)
  – 01 Mar 2024

  Launchpad’s new homepage Launchpad has been around for a while, and its frontpage has remained untouched for a few years now. If you go into launchpad.net, you’ll notice it looks quite different from what it has looked like for the past 10 years – it has been updated! The goal was to modernize it while […]
* [Launchpad-linked federated Matrix accounts](https://blog.launchpad.net/general/launchpad-verified-federated-matrix-accounts)
  – 22 Jan 2024

  Users can now add their Matrix accounts to their profile in Launchpad, as requested by Canonical’s Community team. We also took the chance to slightly rework the frontend and how we display social accounts in the user profiles. Instead of having different sections in the profile for each social account , all social accounts are […]
* [Self-service riscv64 builds](https://blog.launchpad.net/ppa/self-service-riscv64-builds)
  – 22 Nov 2023

  Launchpad has supported building for riscv64 for a while, since it was a requirement to get Ubuntu’s riscv64 port going. We don’t actually have riscv64 hardware in our datacentre, since we’d need server-class hardware with the hypervisor extension and that’s still in its infancy; instead, we do full-system emulation of riscv64 on beefy amd64 hardware […]
* [Introducing Project-Scoped Access Tokens](https://blog.launchpad.net/general/introducing-project-scoped-access-tokens)
  – 20 Nov 2023

  Access tokens can be used to access repositories on behalf of someone. They have scope limitations, optional expiry dates, and can be revoked at any time. They are a stricter and safer alternative to using real user authentication when needing to automate pushing and/or pulling from your git repositories. This is a concept that has […]
* [New domain names for PPAs](https://blog.launchpad.net/ppa/new-domain-names-for-ppas)
  – 16 Feb 2022

  Since they were introduced in 2007, Launchpad’s Personal Package Archives (PPAs) have always been hosted on ppa.launchpad.net. This has generally worked well, but one significant snag became clear later on: it was difficult to add HTTPS support for PPAs due to the way that cookies work on the web. Launchpad uses a cookie for your […]

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_8e7a5903_20250126_093635.html ===

[Log in / Register](https://launchpad.net/~orrriot/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~orrriot)

## [Örjan Fors](https://launchpad.net/~orrriot)

* Overview
* [Code](https://code.launchpad.net/~orrriot)
* [Bugs](https://bugs.launchpad.net/~orrriot)
* [Blueprints](https://blueprints.launchpad.net/~orrriot)
* [Translations](https://translations.launchpad.net/~orrriot)
* [Answers](https://answers.launchpad.net/~orrriot)

* [Related packages](https://launchpad.net/~orrriot/%2Brelated-packages)
* [Related projects](https://launchpad.net/~orrriot/%2Brelated-projects)

## User information

Launchpad Id:
orrriot

Email:
[Log in](%2Blogin) for email information.

Member since:
2011-05-17

Languages:

English

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~orrriot/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## Latest memberships

Örjan Fors is not an
active member of any Launchpad teams.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugzilla.redhat.com_ab86f2ce_20250126_093651.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1298924)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1298924)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1298924)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1298924

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1298924**](show_bug.cgi?id=1298924)
(CVE-2016-0737)
- [CVE-2016-0737](https://access.redhat.com/security/cve/CVE-2016-0737) openstack-swift: Client to proxy DoS through Large Objects

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects

| | [Keywords](describekeywords.cgi): | Reopened  Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2016-0737 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1299668](show_bug.cgi?id=1299668) [1299669](show_bug.cgi?id=1299669) [1299670](show_bug.cgi?id=1299670) [1299671](show_bug.cgi?id=1299671) [1300607](show_bug.cgi?id=1300607) [1300608](show_bug.cgi?id=1300608 "CLOSED EOL - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects [fedora-all]") [1308476](show_bug.cgi?id=1308476) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1298929](show_bug.cgi?id=1298929) [1312737](show_bug.cgi?id=1312737) | | TreeView+ | [depends on](buglist.cgi?bug_id=1298924&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1298924&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2016-01-15 12:20 UTC by Adam Mariš | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-06-02 06:49 UTC ([History](show_activity.cgi?id=1298924)) | | [CC List:](page.cgi?id=fields.html#cclist) | 36 users (show)  aavati abaron aortega apevec ayoung chrisw dallan derekh gkotton gmollett jjoyce jrusnack jschluet kbasil lhh lpeer markmc mburns nlevinki osoukup rbryant rfortier sclewis security-response-team sgirijan sisharma slinaber slong smohan srevivo ssaha tdecacqu tshefi vbellur yeylon zaitcev | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: | A memory-leak issue was found in OpenStack Object Storage (swift), in the client-to-proxy connection. An OpenStack-authenticated attacker could remotely trigger this flaw to cause denial of service through excess memory consumption. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2016-03-01 10:31:37 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2016:0126](https://access.redhat.com/errata/RHSA-2016%3A0126) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-08 09:35:30 UTC | | Red Hat Product Errata | [RHSA-2016:0127](https://access.redhat.com/errata/RHSA-2016%3A0127) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-08 09:35:22 UTC | | Red Hat Product Errata | [RHSA-2016:0128](https://access.redhat.com/errata/RHSA-2016%3A0128) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-08 09:35:11 UTC | | Red Hat Product Errata | [RHSA-2016:0155](https://access.redhat.com/errata/RHSA-2016%3A0155) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-02-10 01:56:35 UTC | | Red Hat Product Errata | [RHSA-2016:0328](https://access.redhat.com/errata/RHSA-2016%3A0328) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-03-01 12:02:03 UTC | | Red Hat Product Errata | [RHSA-2016:0329](https://access.redhat.com/errata/RHSA-2016%3A0329) | 0 | normal | SHIPPED\_LIVE | Moderate: openstack-swift security update | 2016-03-01 12:01:20 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1298924#c0)  Adam Mariš    2016-01-15 12:20:58 UTC  ``` A DoS vulnerability in openstack-swift was reported. By repeatedly requesting and interrupting connections to a Large Object (Dynamic or Static) URL, a remote attacker may exhausts Swift proxy-server resources, potentially resulting in a denial of service.  Affects versions: >=2.2.1 <= 2.3.0  Upstream patch:  <https://review.openstack.org/#/c/217750/>  There are similar bugs [CVE-2016-0737](https://access.redhat.com/security/cve/CVE-2016-0737) and [CVE-2016-0738](https://access.redhat.com/security/cve/CVE-2016-0738). This ([CVE-2016-0737](https://access.redhat.com/security/cve/CVE-2016-0737)) is for client to proxy connection.   ```  [Comment 4](show_bug.cgi?id=1298924#c4)  Andrej Nemec    2016-01-21 09:35:14 UTC  ```  Created openstack-swift tracking bugs for this issue:  Affects: fedora-all [[bug 1300608](show_bug.cgi?id=1300608 "CLOSED EOL - CVE-2016-0737 openstack-swift: Client to proxy DoS through Large Objects [fedora-all]")]   ```  [Comment 5](show_bug.cgi?id=1298924#c5)  Andrej Nemec    2016-01-21 09:36:47 UTC  ``` This issue is now public.   ```  [Comment 6](show_bug.cgi?id=1298924#c6)  errata-xmlrpc    2016-02-08 04:35:56 UTC  ``` This issue has been addressed in the following products:    OpenStack 6 for RHEL 7  Via RHSA-2016:0128 <https://rhn.redhat.com/errata/RHSA-2016-0128.html>   ```  [Comment 7](show_bug.cgi?id=1298924#c7)  errata-xmlrpc    2016-02-08 04:36:41 UTC  ``` This issue has been addressed in the following products:    OpenStack 5 for RHEL 7  Via RHSA-2016:0127 <https://rhn.redhat.com/errata/RHSA-2016-0127.html>   ```  [Comment 8](show_bug.cgi?id=1298924#c8)  errata-xmlrpc    2016-02-08 04:37:51 UTC  ``` This issue has been addressed in the following products:    OpenStack 5 for RHEL 6  Via RHSA-2016:0126 <https://rhn.redhat.com/errata/RHSA-2016-0126.html>   ```  [Comment 9](show_bug.cgi?id=1298924#c9)  errata-xmlrpc    2016-02-09 20:56:58 UTC  ``` This issue has been addressed in the following products:    OpenStack 7 For RHEL 7  Via RHSA-2016:0155 <https://rhn.redhat.com/errata/RHSA-2016-0155.html>   ```  [Comment 11](show_bug.cgi?id=1298924#c11)  errata-xmlrpc    2016-03-01 07:02:33 UTC  ``` This issue has been addressed in the following products:    Red Hat Gluster Storage 3.1 for RHEL 6  Via RHSA-2016:0329 <https://rhn.redhat.com/errata/RHSA-2016-0329.html>   ```  [Comment 12](show_bug.cgi?id=1298924#c12)  errata-xmlrpc    2016-03-01 07:03:17 UTC  ``` This issue has been addressed in the following products:    Red Hat Gluster Storage 3.1 for RHEL 7  Via RHSA-2016:0328 <https://rhn.redhat.com/errata/RHSA-2016-0328.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1298924&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)


