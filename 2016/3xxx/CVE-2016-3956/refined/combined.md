=== Content from www-01.ibm.com_98babec4_20250125_213439.html ===


[IBM Support](https://www.ibm.com/mysupport/)

##

No results were found for your search query.

---

##### **Tips**

To return expected results, you can:

* **Reduce the number of search terms.** Each term you use focuses the search further.
* **Check your spelling.** A single misspelled or incorrectly typed term can change your result.
* **Try substituting synonyms for your original terms.** For example, instead of searching for "java classes", try "java training"
* **Did you search for an IBM acquired or sold product ?** If so, follow the appropriate link below to find the content you need.

Our apologies

Search results are not available at this time. Please try again later or use one of the other support options on this page.

# Security Bulletin: Current Releases of IBM® SDK for Node.js™ are affected by CVE-2016-3956

### Security Bulletin

## Summary

HTTP bearer token leak in the npm package management tool

## Vulnerability Details

**CVE-ID:** [CVE-2016-3956](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3956)

## Affected Products and Versions

These vulnerabilities affect IBM SDK for Node.js v1.1.0.20 and previous releases.

These vulnerabilities affect IBM SDK for Node.js v1.2.0.10 and previous releases.

These vulnerabilities affect IBM SDK for Node.js v4.4.1.0 and previous releases.

## Remediation/Fixes

The fixes for these vulnerabilities are included in IBM SDK for Node.js v1.1.1.0 and subsequent releases.

The fixes for these vulnerabilities are included in IBM SDK for Node.js v1.2.0.11 and subsequent releases.

The fixes for these vulnerabilities are included in IBM SDK for Node.js v4.4.2.0 and subsequent releases.

IBM SDK for Node.js can be downloaded, subject to the terms of the developerWorks license, from [here](http://www.ibm.com/developerworks/web/nodesdk/).

IBM customers requiring an update for an SDK shipped with an IBM product should contact [IBM support](http://www.ibm.com/support/), and/or refer to the appropriate product security bulletin.

## Get Notified about Future Security Bulletins

Subscribe to [My Notifications](https://www.ibm.com/support/pages/node/718119) to be notified of important product support alerts like this.

### References

[Complete CVSS v2 Guide](http://www.first.org/cvss/v2/guide "Link resides outside of ibm.com")

[On-line Calculator v2](http://nvd.nist.gov/CVSS-v2-Calculator "Link resides outside of ibm.com")

[Complete CVSS v3 Guide](http://www.first.org/cvss/user-guide "Link resides outside of ibm.com")

[On-line Calculator v3](http://www.first.org/cvss/calculator/3.0 "Link resides outside of ibm.com")

Off

## Related Information

[IBM Secure Engineering Web Portal](http://www.ibm.com/security/secure-engineering/bulletins.html)

[IBM Product Security Incident Response Blog](http://www.ibm.com/blogs/psirt)

[Node.js 0.10.44](https://nodejs.org/en/blog/release/v0.10.44/)

[Node.js 0.12.13](https://nodejs.org/en/blog/release/v0.12.13/)

[Node.js 4.4.2](https://nodejs.org/en/blog/release/v4.4.2/)

## Change History

April 14 2016: Original version published

May 18 2016: Fixed typo in CVSS vector

\*The CVSS Environment Score is customer environment specific and will ultimately impact the Overall CVSS Score. Customers can evaluate the impact of this vulnerability in their environments by accessing the links in the Reference section of this Security Bulletin.

## Disclaimer

Review the [IBM security bulletin disclaimer and definitions](https://www.ibm.com/support/pages/node/6610583#disclaimer) regarding your responsibilities for assessing potential impact of security vulnerabilities to your environment.

[{"Product":{"code":"SSWLKB","label":"IBM SDK for Node.js"},"Business Unit":{"code":"BU053","label":"Cloud & Data Platform"},"Component":"npm","Platform":[{"code":"PF025","label":"Platform Independent"}],"Version":"1.1;1.2;4.0","Edition":"","Line of Business":{"code":"LOB45","label":"Automation"}}]

## Was this topic helpful?

### Document Information

**Modified date:**

08 August 2018

## UID

swg21980827

Page Feedback

## Share your feedback

### Need support?

* Submit feedback to IBM Support
* 1-800-IBM-7378 (**USA**)
* [Directory of worldwide contacts](//www.ibm.com/planetwide/index.html#region)



=== Content from github.com_103f06a5_20250125_213444.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fcommit%2Ffea8cc92cee02c720b58f95f14d315507ccad401)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fcommit%2Ffea8cc92cee02c720b58f95f14d315507ccad401)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=npm%2Fnpm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Aug 11, 2022. It is now read-only.

[npm](/npm)
/
**[npm](/npm/npm)**
Public archive

* [Notifications](/login?return_to=%2Fnpm%2Fnpm) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Fnpm%2Fnpm)
* [Star
   17.5k](/login?return_to=%2Fnpm%2Fnpm)

* [Code](/npm/npm)
* [Issues
  2.2k](/npm/npm/issues)
* [Pull requests
  0](/npm/npm/pulls)
* [Actions](/npm/npm/actions)
* [Security](/npm/npm/security)
* [Insights](/npm/npm/pulse)

Additional navigation options

* [Code](/npm/npm)
* [Issues](/npm/npm/issues)
* [Pull requests](/npm/npm/pulls)
* [Actions](/npm/npm/actions)
* [Security](/npm/npm/security)
* [Insights](/npm/npm/pulse)

## Commit

[Permalink](/npm/npm/commit/fea8cc92cee02c720b58f95f14d315507ccad401)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

config: only send token to registry hosts

[Browse files](/npm/npm/tree/fea8cc92cee02c720b58f95f14d315507ccad401)
Browse the repository at this point in the history

```
Fixes: [#8380](https://github.com/npm/npm/issues/8380)
Credit: [@othiym23](https://github.com/othiym23)
Reviewed-By: [@zkat](https://github.com/zkat)
```

* Loading branch information

[![@othiym23](https://avatars.githubusercontent.com/u/418097?s=40&v=4)](/othiym23)

[othiym23](/npm/npm/commits?author=othiym23 "View all commits by othiym23")
committed
Mar 17, 2016

1 parent
[df2cc02](/npm/npm/commit/df2cc02fafbb31f6257f686c652d34049d5faddc)

commit fea8cc9

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**268 additions**
and
**27 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* doc/cli

  + doc/cli/npm-adduser.md
    [npm-adduser.md](#diff-3f89c024c4528eb7edcd1f9fe1dd95600794a6fa730974377cd23c5f10447915)
* lib

  + lib/cache.js
    [cache.js](#diff-12b54b3000333055ee88a072267d594bf79cd59239cc9030f48a012b53ea1f0e)
  + config

    - lib/config/get-credentials-by-uri.js
      [get-credentials-by-uri.js](#diff-6b4fb429058277acd592135f9cfa1bfc1fa697f4b64f957278d5f0dbcb556005)
  + utils

    - lib/utils/map-to-registry.js
      [map-to-registry.js](#diff-c46a297373e0eafec0fb2b5acdcbe62db4d328cf07444cae2175f0bde6020c95)
* test/tap

  + test/tap/bearer-token-check.js
    [bearer-token-check.js](#diff-b0ce112f0e7077dfc944ae51bca34c9a7aa8ee66bb32d65c994f48f52e00bdf6)
  + test/tap/config-credentials.js
    [config-credentials.js](#diff-1c7436f712c09ef26e47fad18528160bbb6a7089ee677480a42b354c081de6b0)
  + test/tap/map-to-registry.js
    [map-to-registry.js](#diff-d722bd88978d994586a30e88c246d1fbfe0410f426132e07f834e8b7bec5c39a)

## There are no files selected for viewing

8 changes: 5 additions & 3 deletions

8
[doc/cli/npm-adduser.md](#diff-3f89c024c4528eb7edcd1f9fe1dd95600794a6fa730974377cd23c5f10447915 "doc/cli/npm-adduser.md")

Show comments

[View file](/npm/npm/blob/fea8cc92cee02c720b58f95f14d315507ccad401/doc/cli/npm-adduser.md)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -59,9 +59,11 @@ registries. Can be used with `--registry` and / or `--scope`, e.g. |
|  |  | npm adduser --registry=http://private-registry.example.com --always-auth |
|  |  |  |
|  |  | This will ensure that all requests to that registry (including for tarballs) |
|  |  | include an authorization header. See `always-auth` in `npm-config(7)` for more |
|  |  | details on always-auth. Registry-specific configuration of `always-auth` takes |
|  |  | precedence over any global configuration. |
|  |  | include an authorization header. This setting may be necessary for use with |
|  |  | private registries where metadata and package tarballs are stored on hosts with |
|  |  | different hostnames. See `always-auth` in `npm-config(7)` for more details on |
|  |  | always-auth. Registry-specific configuration of `always-auth` takes precedence |
|  |  | over any global configuration. |
|  |  |  |
|  |  | ## SEE ALSO |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[lib/cache.js](#diff-12b54b3000333055ee88a072267d594bf79cd59239cc9030f48a012b53ea1f0e "lib/cache.js")

Show comments

[View file](/npm/npm/blob/fea8cc92cee02c720b58f95f14d315507ccad401/lib/cache.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -288,7 +288,7 @@ function add (args, where, cb) { |
|  |  | break |
|  |  | case "remote": |
|  |  | // get auth, if possible |
|  |  | mapToRegistry(spec, npm.config, function (err, uri, auth) { |
|  |  | mapToRegistry(p.raw, npm.config, function (err, uri, auth) { |
|  |  | if (err) return cb(err) |
|  |  |  |
|  |  | addRemoteTarball(p.spec, {name : p.name}, null, auth, cb) |
| Expand Down | |  |

19 changes: 10 additions & 9 deletions

19
[lib/config/get-credentials-by-uri.js](#diff-6b4fb429058277acd592135f9cfa1bfc1fa697f4b64f957278d5f0dbcb556005 "lib/config/get-credentials-by-uri.js")

Show comments

[View file](/npm/npm/blob/fea8cc92cee02c720b58f95f14d315507ccad401/lib/config/get-credentials-by-uri.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,8 +20,16 @@ function getCredentialsByURI (uri) { |
|  |  | alwaysAuth : undefined |
|  |  | } |
|  |  |  |
|  |  | if (this.get(nerfed + ":\_authToken")) { |
|  |  | c.token = this.get(nerfed + ":\_authToken") |
|  |  | // used to override scope matching for tokens as well as legacy auth |
|  |  | if (this.get(nerfed + ':always-auth') !== undefined) { |
|  |  | var val = this.get(nerfed + ':always-auth') |
|  |  | c.alwaysAuth = val === 'false' ? false : !!val |
|  |  | } else if (this.get('always-auth') !== undefined) { |
|  |  | c.alwaysAuth = this.get('always-auth') |
|  |  | } |
|  |  |  |
|  |  | if (this.get(nerfed + ':\_authToken')) { |
|  |  | c.token = this.get(nerfed + ':\_authToken') |
|  |  | // the bearer token is enough, don't confuse things |
|  |  | return c |
|  |  | } |
| Expand Down  Expand Up | | @@ -58,13 +66,6 @@ function getCredentialsByURI (uri) { |
|  |  | c.email = this.get("email") |
|  |  | } |
|  |  |  |
|  |  | if (this.get(nerfed + ":always-auth") !== undefined) { |
|  |  | var val = this.get(nerfed + ":always-auth") |
|  |  | c.alwaysAuth = val === "false" ? false : !!val |
|  |  | } else if (this.get("always-auth") !== undefined) { |
|  |  | c.alwaysAuth = this.get("always-auth") |
|  |  | } |
|  |  |  |
|  |  | if (c.username && c.password) { |
|  |  | c.auth = new Buffer(c.username + ":" + c.password).toString("base64") |
|  |  | } |
| Expand Down | |  |

52 changes: 48 additions & 4 deletions

52
[lib/utils/map-to-registry.js](#diff-c46a297373e0eafec0fb2b5acdcbe62db4d328cf07444cae2175f0bde6020c95 "lib/utils/map-to-registry.js")

Show comments

[View file](/npm/npm/blob/fea8cc92cee02c720b58f95f14d315507ccad401/lib/utils/map-to-registry.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,9 +48,53 @@ function mapToRegistry(name, config, cb) { |
|  |  | var auth = config.getCredentialsByURI(registry) |
|  |  |  |
|  |  | // normalize registry URL so resolution doesn't drop a piece of registry URL |
|  |  | var normalized = registry.slice(-1) !== "/" ? registry+"/" : registry |
|  |  | var uri = url.resolve(normalized, name) |
|  |  | log.silly("mapToRegistry", "uri", uri) |
|  |  | var normalized = registry.slice(-1) !== '/' ? registry + '/' : registry |
|  |  | var uri |
|  |  | log.silly('mapToRegistry', 'data', data) |
|  |  | if (data.type === 'remote') { |
|  |  | uri = data.spec |
|  |  | } else { |
|  |  | uri = url.resolve(normalized, name) |
|  |  | } |
|  |  |  |
|  |  | log.silly('mapToRegistry', 'uri', uri) |
|  |  |  |
|  |  | cb(null, uri, scopeAuth(uri, registry, auth), normalized) |
|  |  | } |
|  |  |  |
|  |  | function scopeAuth (uri, registry, auth) { |
|  |  | var cleaned = { |
|  |  | scope: auth.scope, |
|  |  | email: auth.email, |
|  |  | alwaysAuth: auth.alwaysAuth, |
|  |  | token: undefined, |
|  |  | username: undefined, |
|  |  | password: undefined, |
|  |  | auth: undefined |
|  |  | } |
|  |  |  |
|  |  | var requestHost |
|  |  | var registryHost |
|  |  |  |
|  |  | if (auth.token || auth.auth || (auth.username && auth.password)) { |
|  |  | requestHost = url.parse(uri).hostname |
|  |  | registryHost = url.parse(registry).hostname |
|  |  |  |
|  |  | if (requestHost === registryHost) { |
|  |  | cleaned.token = auth.token |
|  |  | cleaned.auth = auth.auth |
|  |  | cleaned.username = auth.username |
|  |  | cleaned.password = auth.password |
|  |  | } else if (auth.alwaysAuth) { |
|  |  | log.verbose('scopeAuth', 'alwaysAuth set for', registry) |
|  |  | cleaned.token = auth.token |
|  |  | cleaned.auth = auth.auth |
|  |  | cleaned.username = auth.username |
|  |  | cleaned.password = auth.password |
|  |  | } else { |
|  |  | log.silly('scopeAuth', uri, "doesn't share host with registry", registry) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | cb(null, uri, auth, normalized) |
|  |  | return cleaned |
|  |  | } |

119 changes: 119 additions & 0 deletions

119
[test/tap/bearer-token-check.js](#diff-b0ce112f0e7077dfc944ae51bca34c9a7aa8ee66bb32d65c994f48f52e00bdf6 "test/tap/bearer-token-check.js")

Show comments

[View file](/npm/npm/blob/fea8cc92cee02c720b58f95f14d315507ccad401/test/tap/bearer-token-check.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,119 @@ |
|  |  | var resolve = require('path').resolve |
|  |  | var writeFileSync = require('graceful-fs').writeFileSync |
|  |  |  |
|  |  | var mkdirp = require('mkdirp') |
|  |  | var mr = require('npm-registry-mock') |
|  |  | var osenv = require('osenv') |
|  |  | var rimraf = require('rimraf') |
|  |  | var test = require('tap').test |
|  |  |  |
|  |  | var common = require('../common-tap.js') |
|  |  | var toNerfDart = require('../../lib/config/nerf-dart.js') |
|  |  |  |
|  |  | var pkg = resolve(\_\_dirname, 'install-bearer-check') |
|  |  | var outfile = resolve(pkg, '\_npmrc') |
|  |  | var modules = resolve(pkg, 'node\_modules') |
|  |  | var tarballPath = '/scoped-underscore/-/scoped-underscore-1.3.1.tgz' |
|  |  | // needs to be a different hostname to verify tokens (not) being sent correctly |
|  |  | var tarballURL = 'http://lvh.me:' + common.port + tarballPath |
|  |  | var tarball = resolve(\_\_dirname, '../fixtures/scoped-underscore-1.3.1.tgz') |
|  |  |  |
|  |  | var server |
|  |  |  |
|  |  | var EXEC\_OPTS = { cwd: pkg } |
|  |  |  |
|  |  | function mocks (server) { |
|  |  | var auth = 'Bearer 0xabad1dea' |
|  |  | server.get(tarballPath, { authorization: auth }).reply(403, { |
|  |  | error: 'token leakage', |
|  |  | reason: 'This token should not be sent.' |
|  |  | }) |
|  |  | server.get(tarballPath).replyWithFile(200, tarball) |
|  |  | } |
|  |  |  |
|  |  | test('setup', function (t) { |
|  |  | mr({ port: common.port, plugin: mocks }, function (er, s) { |
|  |  | server = s |
|  |  | t.ok(s, 'set up mock registry') |
|  |  | setup() |
|  |  | t.end() |
|  |  | }) |
|  |  | }) |
|  |  |  |
|  |  | test('authed npm install with tarball not on registry', function (t) { |
|  |  | common.npm( |
|  |  | [ |
|  |  | 'install', |
|  |  | '--loglevel', 'silent', |
|  |  | '--json', |
|  |  | '--fetch-retries', 0, |
|  |  | '--userconfig', outfile |
|  |  | ], |
|  |  | EXEC\_OPTS, |
|  |  | function (err, code, stdout, stderr) { |
|  |  | t.ifError(err, 'test runner executed without error') |
|  |  | t.equal(code, 0, 'npm install exited OK') |
|  |  | t.notOk(stderr, 'no output on stderr') |
|  |  | try { |
|  |  | var results = JSON.parse(stdout) |
|  |  | } catch (ex) { |
|  |  | console.error('#', ex) |
|  |  | t.ifError(ex, 'stdout was valid JSON') |
|  |  | } |
|  |  |  |
|  |  | if (results) { |
|  |  | var installedversion = { |
|  |  | 'name': '@scoped/underscore', |
|  |  | 'version': '1.3.1', |
|  |  | 'from': 'http://lvh.me:1337/scoped-underscore/-/scoped-underscore-1.3.1.tgz', |
|  |  | 'dependencies': {} |
|  |  | } |
|  |  | t.isDeeply(results[0], installedversion, '@scoped/underscore installed') |
|  |  | } |
|  |  |  |
|  |  | t.end() |
|  |  | } |
|  |  | ) |
|  |  | }) |
|  |  |  |
|  |  | test('cleanup', function (t) { |
|  |  | server.close() |
|  |  | cleanup() |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
|  |  | var contents = '@scoped:registry=' + common.registry + '\n' + |
|  |  | toNerfDart(common.registry) + ':\_authToken=0xabad1dea\n' |
|  |  |  |
|  |  | var json = { |
|  |  | name: 'test-package-install', |
|  |  | version: '1.0.0' |
|  |  | } |
|  |  |  |
|  |  | var shrinkwrap = { |
|  |  | name: 'test-package-install', |
|  |  | version: '1.0.0', |
|  |  | dependencies: { |
|  |  | '@scoped/underscore': { |
|  |  | resolved: tarballURL, |
|  |  | from: '>=1.3.1 <2', |
|  |  | version: '1.3.1' |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | function setup () { |
|  |  | cleanup() |
|  |  | mkdirp.sync(modules) |
|  |  | writeFileSync(resolve(pkg, 'package.json'), JSON.stringify(json, null, 2) + '\n') |
|  |  | writeFileSync(outfile, contents) |
|  |  | writeFileSync( |
|  |  | resolve(pkg, 'npm-shrinkwrap.json'), |
|  |  | JSON.stringify(shrinkwrap, null, 2) + '\n' |
|  |  | ) |
|  |  | } |
|  |  |  |
|  |  | function cleanup () { |
|  |  | process.chdir(osenv.tmpdir()) |
|  |  | rimraf.sync(pkg) |
|  |  | } |

14 changes: 7 additions & 7 deletions

14
[test/tap/config-credentials.js](#diff-1c7436f712c09ef26e47fad18528160bbb6a7089ee677480a42b354c081de6b0 "test/tap/config-credentials.js")

Show comments

[View file](/npm/npm/blob/fea8cc92cee02c720b58f95f14d315507ccad401/test/tap/config-credentials.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -73,13 +73,13 @@ test("set with token", function (t) { |
|  |  | }, "needs only token") |
|  |  |  |
|  |  | var expected = { |
|  |  | scope : "//registry.lvh.me:8661/", |
|  |  | token : "simple-token", |
|  |  | username : undefined, |
|  |  | password : undefined, |
|  |  | email : undefined, |
|  |  | auth : undefined, |
|  |  | alwaysAuth : undefined |
|  |  | scope: '//registry.lvh.me:8661/', |
|  |  | token: 'simple-token', |
|  |  | username: undefined, |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: false |
|  |  | } |
|  |  |  |
|  |  | t.same(conf.getCredentialsByURI(URI), expected, "got bearer token and scope") |
| Expand Down | |  |

81 changes: 78 additions & 3 deletions

81
[test/tap/map-to-registry.js](#diff-d722bd88978d994586a30e88c246d1fbfe0410f426132e07f834e8b7bec5c39a "test/tap/map-to-registry.js")

Show comments

[View file](/npm/npm/blob/fea8cc92cee02c720b58f95f14d315507ccad401/test/tap/map-to-registry.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,7 +48,7 @@ test('mapRegistryToURI', function (t) { |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: undefined |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'http://reg.npm/design/-/rewrite/') |
|  |  | }) |
| Expand All | | @@ -66,7 +66,7 @@ test('mapRegistryToURI', function (t) { |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: undefined |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'http://reg.npm/-/rewrite/') |
|  |  | }) |
| Expand All | | @@ -84,8 +84,83 @@ test('mapRegistryToURI', function (t) { |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: undefined |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'http://reg.npm/design/-/rewrite/relative/') |
|  |  | }) |
|  |  | }) |
|  |  |  |
|  |  | test('mapToRegistry token scoping', function (t) { |
|  |  | npm.config.set('scope', '') |
|  |  | npm.config.set('registry', 'https://reg.npm/') |
|  |  | npm.config.set('//reg.npm/:\_authToken', 'r-token') |
|  |  |  |
|  |  | t.test('pass token to registry host', function (t) { |
|  |  | mapRegistry( |
|  |  | 'https://reg.npm/packages/e/easy-1.0.0.tgz', |
|  |  | npm.config, |
|  |  | function (er, uri, auth, registry) { |
|  |  | t.ifError(er, 'mapRegistryToURI worked') |
|  |  | t.equal(uri, 'https://reg.npm/packages/e/easy-1.0.0.tgz') |
|  |  | t.deepEqual(auth, { |
|  |  | scope: '//reg.npm/', |
|  |  | token: 'r-token', |
|  |  | username: undefined, |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'https://reg.npm/') |
|  |  | } |
|  |  | ) |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
|  |  | t.test("don't pass token to non-registry host", function (t) { |
|  |  | mapRegistry( |
|  |  | 'https://butts.lol/packages/e/easy-1.0.0.tgz', |
|  |  | npm.config, |
|  |  | function (er, uri, auth, registry) { |
|  |  | t.ifError(er, 'mapRegistryToURI worked') |
|  |  | t.equal(uri, 'https://butts.lol/packages/e/easy-1.0.0.tgz') |
|  |  | t.deepEqual(auth, { |
|  |  | scope: '//reg.npm/', |
|  |  | token: undefined, |
|  |  | username: undefined, |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'https://reg.npm/') |
|  |  | } |
|  |  | ) |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
|  |  | t.test('pass token to non-registry host with always-auth', function (t) { |
|  |  | npm.config.set('always-auth', true) |
|  |  | mapRegistry( |
|  |  | 'https://butts.lol/packages/e/easy-1.0.0.tgz', |
|  |  | npm.config, |
|  |  | function (er, uri, auth, registry) { |
|  |  | t.ifError(er, 'mapRegistryToURI worked') |
|  |  | t.equal(uri, 'https://butts.lol/packages/e/easy-1.0.0.tgz') |
|  |  | t.deepEqual(auth, { |
|  |  | scope: '//reg.npm/', |
|  |  | token: 'r-token', |
|  |  | username: undefined, |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: true |
|  |  | }) |
|  |  | t.equal(registry, 'https://reg.npm/') |
|  |  | } |
|  |  | ) |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
|  |  | t.end() |
|  |  | }) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fea8cc9`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fcommit%2Ffea8cc92cee02c720b58f95f14d315507ccad401) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3d924df4_20250125_213441.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fcommit%2Ff67ecad59e99a03e5aad8e93cd1a086ae087cb29)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fcommit%2Ff67ecad59e99a03e5aad8e93cd1a086ae087cb29)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=npm%2Fnpm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Aug 11, 2022. It is now read-only.

[npm](/npm)
/
**[npm](/npm/npm)**
Public archive

* [Notifications](/login?return_to=%2Fnpm%2Fnpm) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Fnpm%2Fnpm)
* [Star
   17.5k](/login?return_to=%2Fnpm%2Fnpm)

* [Code](/npm/npm)
* [Issues
  2.2k](/npm/npm/issues)
* [Pull requests
  0](/npm/npm/pulls)
* [Actions](/npm/npm/actions)
* [Security](/npm/npm/security)
* [Insights](/npm/npm/pulse)

Additional navigation options

* [Code](/npm/npm)
* [Issues](/npm/npm/issues)
* [Pull requests](/npm/npm/pulls)
* [Actions](/npm/npm/actions)
* [Security](/npm/npm/security)
* [Insights](/npm/npm/pulse)

## Commit

[Permalink](/npm/npm/commit/f67ecad59e99a03e5aad8e93cd1a086ae087cb29)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

config: only send token to registry hosts

[Browse files](/npm/npm/tree/f67ecad59e99a03e5aad8e93cd1a086ae087cb29)
Browse the repository at this point in the history

```
Fixes: [#8380](https://github.com/npm/npm/issues/8380)
Credit: [@othiym23](https://github.com/othiym23)
Reviewed-By: [@zkat](https://github.com/zkat)
```

* Loading branch information

[![@othiym23](https://avatars.githubusercontent.com/u/418097?s=40&v=4)](/othiym23)

[othiym23](/npm/npm/commits?author=othiym23 "View all commits by othiym23")
committed
Mar 17, 2016

1 parent
[ffa428a](/npm/npm/commit/ffa428a4eee482aa620819bc8df994a76fad7b0c)

commit f67ecad

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**257 additions**
and
**17 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* doc/cli

  + doc/cli/npm-adduser.md
    [npm-adduser.md](#diff-3f89c024c4528eb7edcd1f9fe1dd95600794a6fa730974377cd23c5f10447915)
* lib

  + lib/cache.js
    [cache.js](#diff-12b54b3000333055ee88a072267d594bf79cd59239cc9030f48a012b53ea1f0e)
  + config

    - lib/config/get-credentials-by-uri.js
      [get-credentials-by-uri.js](#diff-6b4fb429058277acd592135f9cfa1bfc1fa697f4b64f957278d5f0dbcb556005)
  + utils

    - lib/utils/map-to-registry.js
      [map-to-registry.js](#diff-c46a297373e0eafec0fb2b5acdcbe62db4d328cf07444cae2175f0bde6020c95)
* test/tap

  + test/tap/bearer-token-check.js
    [bearer-token-check.js](#diff-b0ce112f0e7077dfc944ae51bca34c9a7aa8ee66bb32d65c994f48f52e00bdf6)
  + test/tap/config-credentials.js
    [config-credentials.js](#diff-1c7436f712c09ef26e47fad18528160bbb6a7089ee677480a42b354c081de6b0)
  + test/tap/map-to-registry.js
    [map-to-registry.js](#diff-d722bd88978d994586a30e88c246d1fbfe0410f426132e07f834e8b7bec5c39a)

## There are no files selected for viewing

8 changes: 5 additions & 3 deletions

8
[doc/cli/npm-adduser.md](#diff-3f89c024c4528eb7edcd1f9fe1dd95600794a6fa730974377cd23c5f10447915 "doc/cli/npm-adduser.md")

Show comments

[View file](/npm/npm/blob/f67ecad59e99a03e5aad8e93cd1a086ae087cb29/doc/cli/npm-adduser.md)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -59,9 +59,11 @@ registries. Can be used with `--registry` and / or `--scope`, e.g. |
|  |  | npm adduser --registry=http://private-registry.example.com --always-auth |
|  |  |  |
|  |  | This will ensure that all requests to that registry (including for tarballs) |
|  |  | include an authorization header. See `always-auth` in `npm-config(7)` for more |
|  |  | details on always-auth. Registry-specific configuration of `always-auth` takes |
|  |  | precedence over any global configuration. |
|  |  | include an authorization header. This setting may be necessary for use with |
|  |  | private registries where metadata and package tarballs are stored on hosts with |
|  |  | different hostnames. See `always-auth` in `npm-config(7)` for more details on |
|  |  | always-auth. Registry-specific configuration of `always-auth` takes precedence |
|  |  | over any global configuration. |
|  |  |  |
|  |  | ## SEE ALSO |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[lib/cache.js](#diff-12b54b3000333055ee88a072267d594bf79cd59239cc9030f48a012b53ea1f0e "lib/cache.js")

Show comments

[View file](/npm/npm/blob/f67ecad59e99a03e5aad8e93cd1a086ae087cb29/lib/cache.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -285,7 +285,7 @@ function add (args, where, cb) { |
|  |  | break |
|  |  | case 'remote': |
|  |  | // get auth, if possible |
|  |  | mapToRegistry(spec, npm.config, function (err, uri, auth) { |
|  |  | mapToRegistry(p.raw, npm.config, function (err, uri, auth) { |
|  |  | if (err) return cb(err) |
|  |  |  |
|  |  | addRemoteTarball(p.spec, { name: p.name }, null, auth, cb) |
| Expand Down | |  |

15 changes: 8 additions & 7 deletions

15
[lib/config/get-credentials-by-uri.js](#diff-6b4fb429058277acd592135f9cfa1bfc1fa697f4b64f957278d5f0dbcb556005 "lib/config/get-credentials-by-uri.js")

Show comments

[View file](/npm/npm/blob/f67ecad59e99a03e5aad8e93cd1a086ae087cb29/lib/config/get-credentials-by-uri.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,6 +20,14 @@ function getCredentialsByURI (uri) { |
|  |  | alwaysAuth: undefined |
|  |  | } |
|  |  |  |
|  |  | // used to override scope matching for tokens as well as legacy auth |
|  |  | if (this.get(nerfed + ':always-auth') !== undefined) { |
|  |  | var val = this.get(nerfed + ':always-auth') |
|  |  | c.alwaysAuth = val === 'false' ? false : !!val |
|  |  | } else if (this.get('always-auth') !== undefined) { |
|  |  | c.alwaysAuth = this.get('always-auth') |
|  |  | } |
|  |  |  |
|  |  | if (this.get(nerfed + ':\_authToken')) { |
|  |  | c.token = this.get(nerfed + ':\_authToken') |
|  |  | // the bearer token is enough, don't confuse things |
| Expand Down  Expand Up | | @@ -58,13 +66,6 @@ function getCredentialsByURI (uri) { |
|  |  | c.email = this.get('email') |
|  |  | } |
|  |  |  |
|  |  | if (this.get(nerfed + ':always-auth') !== undefined) { |
|  |  | var val = this.get(nerfed + ':always-auth') |
|  |  | c.alwaysAuth = val === 'false' ? false : !!val |
|  |  | } else if (this.get('always-auth') !== undefined) { |
|  |  | c.alwaysAuth = this.get('always-auth') |
|  |  | } |
|  |  |  |
|  |  | if (c.username && c.password) { |
|  |  | c.auth = new Buffer(c.username + ':' + c.password).toString('base64') |
|  |  | } |
| Expand Down | |  |

48 changes: 46 additions & 2 deletions

48
[lib/utils/map-to-registry.js](#diff-c46a297373e0eafec0fb2b5acdcbe62db4d328cf07444cae2175f0bde6020c95 "lib/utils/map-to-registry.js")

Show comments

[View file](/npm/npm/blob/f67ecad59e99a03e5aad8e93cd1a086ae087cb29/lib/utils/map-to-registry.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -49,8 +49,52 @@ function mapToRegistry (name, config, cb) { |
|  |  |  |
|  |  | // normalize registry URL so resolution doesn't drop a piece of registry URL |
|  |  | var normalized = registry.slice(-1) !== '/' ? registry + '/' : registry |
|  |  | var uri = url.resolve(normalized, name) |
|  |  | var uri |
|  |  | log.silly('mapToRegistry', 'data', data) |
|  |  | if (data.type === 'remote') { |
|  |  | uri = data.spec |
|  |  | } else { |
|  |  | uri = url.resolve(normalized, name) |
|  |  | } |
|  |  |  |
|  |  | log.silly('mapToRegistry', 'uri', uri) |
|  |  |  |
|  |  | cb(null, uri, auth, normalized) |
|  |  | cb(null, uri, scopeAuth(uri, registry, auth), normalized) |
|  |  | } |
|  |  |  |
|  |  | function scopeAuth (uri, registry, auth) { |
|  |  | var cleaned = { |
|  |  | scope: auth.scope, |
|  |  | email: auth.email, |
|  |  | alwaysAuth: auth.alwaysAuth, |
|  |  | token: undefined, |
|  |  | username: undefined, |
|  |  | password: undefined, |
|  |  | auth: undefined |
|  |  | } |
|  |  |  |
|  |  | var requestHost |
|  |  | var registryHost |
|  |  |  |
|  |  | if (auth.token || auth.auth || (auth.username && auth.password)) { |
|  |  | requestHost = url.parse(uri).hostname |
|  |  | registryHost = url.parse(registry).hostname |
|  |  |  |
|  |  | if (requestHost === registryHost) { |
|  |  | cleaned.token = auth.token |
|  |  | cleaned.auth = auth.auth |
|  |  | cleaned.username = auth.username |
|  |  | cleaned.password = auth.password |
|  |  | } else if (auth.alwaysAuth) { |
|  |  | log.verbose('scopeAuth', 'alwaysAuth set for', registry) |
|  |  | cleaned.token = auth.token |
|  |  | cleaned.auth = auth.auth |
|  |  | cleaned.username = auth.username |
|  |  | cleaned.password = auth.password |
|  |  | } else { |
|  |  | log.silly('scopeAuth', uri, "doesn't share host with registry", registry) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return cleaned |
|  |  | } |

118 changes: 118 additions & 0 deletions

118
[test/tap/bearer-token-check.js](#diff-b0ce112f0e7077dfc944ae51bca34c9a7aa8ee66bb32d65c994f48f52e00bdf6 "test/tap/bearer-token-check.js")

Show comments

[View file](/npm/npm/blob/f67ecad59e99a03e5aad8e93cd1a086ae087cb29/test/tap/bearer-token-check.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,118 @@ |
|  |  | var resolve = require('path').resolve |
|  |  | var writeFileSync = require('graceful-fs').writeFileSync |
|  |  |  |
|  |  | var mkdirp = require('mkdirp') |
|  |  | var mr = require('npm-registry-mock') |
|  |  | var osenv = require('osenv') |
|  |  | var rimraf = require('rimraf') |
|  |  | var test = require('tap').test |
|  |  |  |
|  |  | var common = require('../common-tap.js') |
|  |  | var toNerfDart = require('../../lib/config/nerf-dart.js') |
|  |  |  |
|  |  | var pkg = resolve(\_\_dirname, 'install-bearer-check') |
|  |  | var outfile = resolve(pkg, '\_npmrc') |
|  |  | var modules = resolve(pkg, 'node\_modules') |
|  |  | var tarballPath = '/scoped-underscore/-/scoped-underscore-1.3.1.tgz' |
|  |  | // needs to be a different hostname to verify tokens (not) being sent correctly |
|  |  | var tarballURL = 'http://lvh.me:' + common.port + tarballPath |
|  |  | var tarball = resolve(\_\_dirname, '../fixtures/scoped-underscore-1.3.1.tgz') |
|  |  |  |
|  |  | var server |
|  |  |  |
|  |  | var EXEC\_OPTS = { cwd: pkg } |
|  |  |  |
|  |  | function mocks (server) { |
|  |  | var auth = 'Bearer 0xabad1dea' |
|  |  | server.get(tarballPath, { authorization: auth }).reply(403, { |
|  |  | error: 'token leakage', |
|  |  | reason: 'This token should not be sent.' |
|  |  | }) |
|  |  | server.get(tarballPath).replyWithFile(200, tarball) |
|  |  | } |
|  |  |  |
|  |  | test('setup', function (t) { |
|  |  | mr({ port: common.port, plugin: mocks }, function (er, s) { |
|  |  | server = s |
|  |  | t.ok(s, 'set up mock registry') |
|  |  | setup() |
|  |  | t.end() |
|  |  | }) |
|  |  | }) |
|  |  |  |
|  |  | test('authed npm install with tarball not on registry', function (t) { |
|  |  | common.npm( |
|  |  | [ |
|  |  | 'install', |
|  |  | '--loglevel', 'silent', |
|  |  | '--json', |
|  |  | '--fetch-retries', 0, |
|  |  | '--userconfig', outfile |
|  |  | ], |
|  |  | EXEC\_OPTS, |
|  |  | function (err, code, stdout, stderr) { |
|  |  | t.ifError(err, 'test runner executed without error') |
|  |  | t.equal(code, 0, 'npm install exited OK') |
|  |  | t.notOk(stderr, 'no output on stderr') |
|  |  | try { |
|  |  | var results = JSON.parse(stdout) |
|  |  | } catch (ex) { |
|  |  | console.error('#', ex) |
|  |  | t.ifError(ex, 'stdout was valid JSON') |
|  |  | } |
|  |  |  |
|  |  | if (results) { |
|  |  | var installedversion = { |
|  |  | 'version': '1.3.1', |
|  |  | 'from': '>=1.3.1 <2', |
|  |  | 'resolved': 'http://lvh.me:1337/scoped-underscore/-/scoped-underscore-1.3.1.tgz' |
|  |  | } |
|  |  | t.isDeeply(results.dependencies['@scoped/underscore'], installedversion, '@scoped/underscore installed') |
|  |  | } |
|  |  |  |
|  |  | t.end() |
|  |  | } |
|  |  | ) |
|  |  | }) |
|  |  |  |
|  |  | test('cleanup', function (t) { |
|  |  | server.close() |
|  |  | cleanup() |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
|  |  | var contents = '@scoped:registry=' + common.registry + '\n' + |
|  |  | toNerfDart(common.registry) + ':\_authToken=0xabad1dea\n' |
|  |  |  |
|  |  | var json = { |
|  |  | name: 'test-package-install', |
|  |  | version: '1.0.0' |
|  |  | } |
|  |  |  |
|  |  | var shrinkwrap = { |
|  |  | name: 'test-package-install', |
|  |  | version: '1.0.0', |
|  |  | dependencies: { |
|  |  | '@scoped/underscore': { |
|  |  | resolved: tarballURL, |
|  |  | from: '>=1.3.1 <2', |
|  |  | version: '1.3.1' |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | function setup () { |
|  |  | cleanup() |
|  |  | mkdirp.sync(modules) |
|  |  | writeFileSync(resolve(pkg, 'package.json'), JSON.stringify(json, null, 2) + '\n') |
|  |  | writeFileSync(outfile, contents) |
|  |  | writeFileSync( |
|  |  | resolve(pkg, 'npm-shrinkwrap.json'), |
|  |  | JSON.stringify(shrinkwrap, null, 2) + '\n' |
|  |  | ) |
|  |  | } |
|  |  |  |
|  |  | function cleanup () { |
|  |  | process.chdir(osenv.tmpdir()) |
|  |  | rimraf.sync(pkg) |
|  |  | } |

2 changes: 1 addition & 1 deletion

2
[test/tap/config-credentials.js](#diff-1c7436f712c09ef26e47fad18528160bbb6a7089ee677480a42b354c081de6b0 "test/tap/config-credentials.js")

Show comments

[View file](/npm/npm/blob/f67ecad59e99a03e5aad8e93cd1a086ae087cb29/test/tap/config-credentials.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -79,7 +79,7 @@ test('set with token', function (t) { |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: undefined |
|  |  | alwaysAuth: false |
|  |  | } |
|  |  |  |
|  |  | t.same(conf.getCredentialsByURI(URI), expected, 'got bearer token and scope') |
| Expand Down | |  |

81 changes: 78 additions & 3 deletions

81
[test/tap/map-to-registry.js](#diff-d722bd88978d994586a30e88c246d1fbfe0410f426132e07f834e8b7bec5c39a "test/tap/map-to-registry.js")

Show comments

[View file](/npm/npm/blob/f67ecad59e99a03e5aad8e93cd1a086ae087cb29/test/tap/map-to-registry.js)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,7 +48,7 @@ test('mapRegistryToURI', function (t) { |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: undefined |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'http://reg.npm/design/-/rewrite/') |
|  |  | }) |
| Expand All | | @@ -66,7 +66,7 @@ test('mapRegistryToURI', function (t) { |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: undefined |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'http://reg.npm/-/rewrite/') |
|  |  | }) |
| Expand All | | @@ -84,8 +84,83 @@ test('mapRegistryToURI', function (t) { |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: undefined |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'http://reg.npm/design/-/rewrite/relative/') |
|  |  | }) |
|  |  | }) |
|  |  |  |
|  |  | test('mapToRegistry token scoping', function (t) { |
|  |  | npm.config.set('scope', '') |
|  |  | npm.config.set('registry', 'https://reg.npm/') |
|  |  | npm.config.set('//reg.npm/:\_authToken', 'r-token') |
|  |  |  |
|  |  | t.test('pass token to registry host', function (t) { |
|  |  | mapRegistry( |
|  |  | 'https://reg.npm/packages/e/easy-1.0.0.tgz', |
|  |  | npm.config, |
|  |  | function (er, uri, auth, registry) { |
|  |  | t.ifError(er, 'mapRegistryToURI worked') |
|  |  | t.equal(uri, 'https://reg.npm/packages/e/easy-1.0.0.tgz') |
|  |  | t.deepEqual(auth, { |
|  |  | scope: '//reg.npm/', |
|  |  | token: 'r-token', |
|  |  | username: undefined, |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'https://reg.npm/') |
|  |  | } |
|  |  | ) |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
|  |  | t.test("don't pass token to non-registry host", function (t) { |
|  |  | mapRegistry( |
|  |  | 'https://butts.lol/packages/e/easy-1.0.0.tgz', |
|  |  | npm.config, |
|  |  | function (er, uri, auth, registry) { |
|  |  | t.ifError(er, 'mapRegistryToURI worked') |
|  |  | t.equal(uri, 'https://butts.lol/packages/e/easy-1.0.0.tgz') |
|  |  | t.deepEqual(auth, { |
|  |  | scope: '//reg.npm/', |
|  |  | token: undefined, |
|  |  | username: undefined, |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: false |
|  |  | }) |
|  |  | t.equal(registry, 'https://reg.npm/') |
|  |  | } |
|  |  | ) |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
|  |  | t.test('pass token to non-registry host with always-auth', function (t) { |
|  |  | npm.config.set('always-auth', true) |
|  |  | mapRegistry( |
|  |  | 'https://butts.lol/packages/e/easy-1.0.0.tgz', |
|  |  | npm.config, |
|  |  | function (er, uri, auth, registry) { |
|  |  | t.ifError(er, 'mapRegistryToURI worked') |
|  |  | t.equal(uri, 'https://butts.lol/packages/e/easy-1.0.0.tgz') |
|  |  | t.deepEqual(auth, { |
|  |  | scope: '//reg.npm/', |
|  |  | token: 'r-token', |
|  |  | username: undefined, |
|  |  | password: undefined, |
|  |  | email: undefined, |
|  |  | auth: undefined, |
|  |  | alwaysAuth: true |
|  |  | }) |
|  |  | t.equal(registry, 'https://reg.npm/') |
|  |  | } |
|  |  | ) |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
|  |  | t.end() |
|  |  | }) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f67ecad`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fcommit%2Ff67ecad59e99a03e5aad8e93cd1a086ae087cb29) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_15511c32_20250125_213446.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fissues%2F8380)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnpm%2Fnpm%2Fissues%2F8380)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=npm%2Fnpm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Aug 11, 2022. It is now read-only.

[npm](/npm)
/
**[npm](/npm/npm)**
Public archive

* [Notifications](/login?return_to=%2Fnpm%2Fnpm) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Fnpm%2Fnpm)
* [Star
   17.5k](/login?return_to=%2Fnpm%2Fnpm)

* [Code](/npm/npm)
* [Issues
  2.2k](/npm/npm/issues)
* [Pull requests
  0](/npm/npm/pulls)
* [Actions](/npm/npm/actions)
* [Security](/npm/npm/security)
* [Insights](/npm/npm/pulse)

Additional navigation options

* [Code](/npm/npm)
* [Issues](/npm/npm/issues)
* [Pull requests](/npm/npm/pulls)
* [Actions](/npm/npm/actions)
* [Security](/npm/npm/security)
* [Insights](/npm/npm/pulse)

This repository has been archived by the owner on Aug 11, 2022. It is now read-only.

# npm uses auth token from registry on http[s]:// dependencies, breaking BitBucket URLs #8380

[Jump to bottom](#comment-composer-heading)Copy link[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[npm uses auth token from registry on http[s]:// dependencies, breaking BitBucket URLs](#top)#8380Copy linkLabels[bug](https://github.com/npm/npm/issues?q=state%3Aopen%20label%3A%22bug%22)[![@MaxMotovilov](https://avatars.githubusercontent.com/u/78924?u=b7ea77a4edbfe3f8d20926e61e4ee4aa1c4ab1b7&v=4&size=80)](/MaxMotovilov)
## Description

[![@MaxMotovilov](https://avatars.githubusercontent.com/u/78924?u=b7ea77a4edbfe3f8d20926e61e4ee4aa1c4ab1b7&v=4&size=48)](/MaxMotovilov)[MaxMotovilov](https://github.com/MaxMotovilov)opened [on May 27, 2015](https://github.com/npm/npm/issues/8380#issue-81652970)

npm@2.10.1

Excerpt from the log:

```
1010 http fetch GET http://bitbucket.org/12qcp/sequelize/get/fc2.tar.gz
1011 verbose request using bearer token for auth

```

further:

```
1724 info retry will retry, error on last attempt: Error: Exceeded maxRedirects. Probably stuck in a redirect loop https://bitbucket.org/account/signin/?next=/account/signin/%3Fnext%3D/account/signin/%253Fnext%253D/account/signin/%25253Fnext%25253D/account/signin/%2525253Fnext%2525253D/account/signin/%252525253Fnext%252525253D/account/signin/%25252525253Fnext%25252525253D/account/signin/%2525252525253Fnext%2525252525253D/account/signin/%252525252525253Fnext%252525252525253D/12qcp/sequelize/get/fc2.tar.gz
1725 http fetch 302 http://bitbucket.org/12qcp/sequelize/get/fc2.tar.gz
1726 error fetch failed http://bitbucket.org/12qcp/sequelize/get/fc2.tar.gz
1727 warn retry will retry, error on last attempt: Error: fetch failed with status code 302

```

Removing auth token with `npm logout` helps. Apparently BitBucket server reacts badly to foreign auth tokens. This issue has not been observed with npm 1.x.

👍1
## Metadata

### Assignees

No one assigned

### Labels

[bug](https://github.com/npm/npm/issues?q=state%3Aopen%20label%3A%22bug%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from nodejs.org_ee38d3f9_20250125_213448.html ===
[January Security Release is available](https://nodejs.org/en/blog/vulnerability/january-2025-security-releases)[Learn](/en/learn)[About](/en/about)[Download](/en/download)[Blog](/en/blog)[Docs](https://nodejs.org/docs/latest/api/)[Contribute](https://github.com/nodejs/node/blob/main/CONTRIBUTING.md)[Certification](https://training.linuxfoundation.org/openjs/)
# npm security updates v2.15.1 and v3.8.3

FN

Forrest Norvell

npm security updates v2.15.1 and v3.8.3

*This announcement is also covered on the npm blog: <http://blog.npmjs.org/post/142036323955/fixing-a-bearer-token-vulnerability>.*

The primary npm registry has, since late 2014, used HTTP bearer tokens to authenticate requests from the npm command-line interface. Due to a design flaw in the CLI, these bearer tokens were sent with every request made by the CLI for logged-in users, regardless of the destination of the request. They should instead only be included for requests made against the registry or registries used for the current install.

This flaw allows an attacker to set up an HTTP server that could collect authentication information they could use to impersonate the users whose tokens they collected. This impersonation would allow them to do anything the compromised users could do, including publishing new versions of packages.

This flaw has been fixed in [[email protected]](https://github.com/npm/npm/commit/fea8cc92cee02c720b58f95f14d315507ccad401) (npm LTS) and [[email protected]](https://github.com/npm/npm/commit/f67ecad59e99a03e5aad8e93cd1a086ae087cb29). The npm CLI team believes that the fix won't break any existing registry setups, but due to the large number of registry software suites in the wild, it's possible that this change will be breaking in some cases. If so, please [file an issue](https://github.com/npm/npm/issues/new) describing the software you're using and how it broke, and the team will work with you to mitigate the breakage.

If you believe that your bearer token may have been leaked, it should be sufficient to [invalidate your current npm bearer tokens](https://www.npmjs.com/settings/tokens) and to rerun npm login to generate new tokens. Keep in mind that this may cause continuous integration builds in services like Travis to break, in which case you'll need to update the tokens in your CI server's configuration.

Thanks to Mitar, Will White & the team at Mapbox, Max Motovilov, and James Taylor for reporting this vulnerability to npm.

As Node.js ships with npm, releases for the active lines will be made available shortly for your convenience. Please watch the [Node.js news feed](/en/blog/) for the following releases:

* **v0.10 (Maintenance)**: [Node.js v0.10.44](/en/blog/release/v0.10.44/) includes npm LTS v2.15.1. This is a major upgrade of npm from v1 which has previously been deprecated. No fix is being made available for npm v1, please upgrade to npm v2 as soon as possible.
* **v0.12 (LTS)**: [Node.js v0.12.13](/en/blog/release/v0.12.13/) includes npm LTS v2.15.1.
* **v4 (LTS "Argon")**: [Node.js v4.4.2](/en/blog/release/v4.4.2/) includes npm LTS v2.15.1.
* **v5 (Stable)**: [Node.js v5.10.0](/en/blog/release/v5.10.0/) includes npm v3.8.3.

**Update:** Unfortunately the version of npm that was bundled with Node.js version v0.10.44, v0.12.13 and v4.4.2 did not include the correct version string, `npm -v` reports `2.15.0`, however the code is v2.15.1.

**Note that you can upgrade your installed version of npm manually** without requiring a Node.js update by using the command `npm install npm@2 -g` for npm LTS v2.15.2 or `npm install npm@3 -g` for npm v3.8.5.

[PrevOpenSSL updates, 1.0.1t and 1.0.2h](/en/blog/vulnerability/openssl-may-2016)[NextOpenSSL updates, 1.0.2g and 1.0.1s](/en/blog/vulnerability/openssl-march-2016)Last UpdatedMar 31, 2016Reading Time3 min readContribute[Edit this page](https://github.com/nodejs/nodejs.org/blob/main/apps/site/pages/en/blog/vulnerability/npm-tokens-leak-march-2016.md)[Trademark Policy](https://trademark-policy.openjsf.org/)[Privacy Policy](https://privacy-policy.openjsf.org/)[Version Support](/en/about/previous-releases)[Code of Conduct](https://github.com/openjs-foundation/cross-project-council/blob/main/CODE_OF_CONDUCT.md)[Security Policy](https://github.com/nodejs/node/security/policy)[© OpenJS Foundation](https://openjsf.org/)



=== Content from blog.npmjs.org_c2a15fff_20250125_213428.html ===


[npm Blog (Archive)](/)

[npmjs.com](https://npmjs.com/)
[Status](https://status.npmjs.com/)
[Support](https://npmjs.com/support/)

The npm blog has been discontinued.

Updates from the npm team are now published on the
[GitHub Blog](https://github.blog/) and
the [GitHub
Changelog](https://github.blog/changelog/).

# fixing a bearer token vulnerability

Last week, [`npm@2.15.1`](https://github.com/npm/npm/commit/fea8cc92cee02c720b58f95f14d315507ccad401) (npm LTS) and [`npm@3.8.3`](https://github.com/npm/npm/commit/f67ecad59e99a03e5aad8e93cd1a086ae087cb29) were released to `latest`. Among other improvements, these fix a vulnerability that could cause the unintentional leakage of bearer tokens.

Here are details on this vulnerability and how it affects you.

## How to update npm

An up to date npm is the most secure npm. Update npm to get this patch, as well as other patches:

`npm install npm@latest -g`

## Think you’re at risk? Generate a new bearer token

If you believe that your bearer token may have been leaked, [invalidate your current npm bearer tokens](https://www.npmjs.com/settings/tokens) and rerun `npm login` to generate new tokens. Keep in mind that this may cause continuous integration builds in services like Travis to break, in which case you’ll need to update the tokens in your CI server’s configuration.

## Details of the vulnerability

Since 2014, npm’s registry has used HTTP bearer tokens to authenticate requests from the npm’s command-line interface. A design flaw meant that the CLI was sending these bearer tokens with *every* request made by logged-in users, regardless of the destination of their request. (The bearers only should have been included for requests made against a registry or registries used for the current install.)

An attacker could exploit this flaw by setting up an HTTP server that could collect authentication information, then use this authentication information to impersonate the users whose tokens they collected. This impersonation would allow them to do anything the compromised users could do, including publishing new versions of packages.

With the fixes we’ve released, the CLI will only send bearer tokens with requests made against a registry.

## Will this break my current setup?

Maybe.

npm’s CLI team believes that the fix won’t break any existing registry setups. Due to the large number of registry software suites out in the wild, though, it’s possible our change will be breaking in some cases.

If so, please [file an issue](https://github.com/npm/npm/issues/new) describing the software you’re using and how it broke. Our team will work with you to mitigate the breakage.

## Thanks to the community

Thanks to Mitar, Will White & the team at Mapbox, Max Motovilov, and James Taylor for reporting this vulnerability to npm. You can learn more about npm’s security policy on [our security page](https://www.npmjs.com/policies/security).

-/-

Node.js has also posted about this disclosure. You can read that [here](http://nodejs.org/en/blog/vulnerability/npm-tokens-leak-march-2016/).

 March 31st, 2016 3:54pm
@agdubs-blog1


