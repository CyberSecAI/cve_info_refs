=== Content from github.com_459132e5_20250126_034631.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGNOME%2Flibxml2%2Fcommit%2F960f0e2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGNOME%2Flibxml2%2Fcommit%2F960f0e2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=GNOME%2Flibxml2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[GNOME](/GNOME)
/
**[libxml2](/GNOME/libxml2)**
Public

* [Notifications](/login?return_to=%2FGNOME%2Flibxml2) You must be signed in to change notification settings
* [Fork
  371](/login?return_to=%2FGNOME%2Flibxml2)
* [Star
   614](/login?return_to=%2FGNOME%2Flibxml2)

* [Code](/GNOME/libxml2)
* [Pull requests
  0](/GNOME/libxml2/pulls)
* [Actions](/GNOME/libxml2/actions)
* [Projects
  0](/GNOME/libxml2/projects)
* [Security](/GNOME/libxml2/security)
* [Insights](/GNOME/libxml2/pulse)

Additional navigation options

* [Code](/GNOME/libxml2)
* [Pull requests](/GNOME/libxml2/pulls)
* [Actions](/GNOME/libxml2/actions)
* [Projects](/GNOME/libxml2/projects)
* [Security](/GNOME/libxml2/security)
* [Insights](/GNOME/libxml2/pulse)

## Commit

[Permalink](/GNOME/libxml2/commit/960f0e275616cadc29671a218d7fb9b69eb35588)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Do not URI escape in server side includes

[Browse files](/GNOME/libxml2/tree/960f0e275616cadc29671a218d7fb9b69eb35588)
Browse the repository at this point in the history

* Loading branch information

[![@veillard](https://avatars.githubusercontent.com/u/3223055?s=40&v=4)](/veillard)

Romain Bondue
authored and
[veillard](/GNOME/libxml2/commits?author=veillard "View all commits by veillard")
committed
Apr 23, 2013

1 parent
[704d8c5](/GNOME/libxml2/commit/704d8c5e9ae911715d575abca03900591d56c040)

commit 960f0e2

Showing
**1 changed file**
with
**38 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

49 changes: 38 additions & 11 deletions

49
[HTMLtree.c](#diff-d7783bd620a6f319f0de68f4c7d2e9bc8205d90c598525c94709e30748c04681 "HTMLtree.c")

Show comments

[View file](/GNOME/libxml2/blob/960f0e275616cadc29671a218d7fb9b69eb35588/HTMLtree.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -716,22 +716,49 @@ htmlAttrDumpOutput(xmlOutputBufferPtr buf, xmlDocPtr doc, xmlAttrPtr cur, |
|  |  | (!xmlStrcasecmp(cur->name, BAD\_CAST "src")) || |
|  |  | ((!xmlStrcasecmp(cur->name, BAD\_CAST "name")) && |
|  |  | (!xmlStrcasecmp(cur->parent->name, BAD\_CAST "a"))))) { |
|  |  | xmlChar \*escaped; |
|  |  | xmlChar \*tmp = value; |
|  |  | /\* xmlURIEscapeStr() escapes '"' so it can be safely used. \*/ |
|  |  | xmlBufCCat(buf->buffer, "\""); |
|  |  |  |
|  |  | while (IS\_BLANK\_CH(\*tmp)) tmp++; |
|  |  |  |
|  |  | /\* |
|  |  | \* the < and > have already been escaped at the entity level |
|  |  | \* And doing so here breaks server side includes |
|  |  | \*/ |
|  |  | escaped = xmlURIEscapeStr(tmp, BAD\_CAST"@/:=?;#%&,+<>"); |
|  |  | if (escaped != NULL) { |
|  |  | xmlBufWriteQuotedString(buf->buffer, escaped); |
|  |  | xmlFree(escaped); |
|  |  | } else { |
|  |  | xmlBufWriteQuotedString(buf->buffer, value); |
|  |  | /\* URI Escape everything, except server side includes. \*/ |
|  |  | for ( ; ; ) { |
|  |  | xmlChar \*escaped; |
|  |  | xmlChar endChar; |
|  |  | xmlChar \*end = NULL; |
|  |  | xmlChar \*start = (xmlChar \*)xmlStrstr(tmp, BAD\_CAST "<!--"); |
|  |  | if (start != NULL) { |
|  |  | end = (xmlChar \*)xmlStrstr(tmp, BAD\_CAST "-->"); |
|  |  | if (end != NULL) { |
|  |  | \*start = '\0'; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\* Escape the whole string, or until start (set to '\0'). \*/ |
|  |  | escaped = xmlURIEscapeStr(tmp, BAD\_CAST"@/:=?;#%&,+"); |
|  |  | if (escaped != NULL) { |
|  |  | xmlBufCat(buf->buffer, escaped); |
|  |  | xmlFree(escaped); |
|  |  | } else { |
|  |  | xmlBufCat(buf->buffer, tmp); |
|  |  | } |
|  |  |  |
|  |  | if (end == NULL) { /\* Everything has been written. \*/ |
|  |  | break; |
|  |  | } |
|  |  |  |
|  |  | /\* Do not escape anything within server side includes. \*/ |
|  |  | \*start = '<'; /\* Restore the first character of "<!--". \*/ |
|  |  | end += 3; /\* strlen("-->") \*/ |
|  |  | endChar = \*end; |
|  |  | \*end = '\0'; |
|  |  | xmlBufCat(buf->buffer, start); |
|  |  | \*end = endChar; |
|  |  | tmp = end; |
|  |  | } |
|  |  |  |
|  |  | xmlBufCCat(buf->buffer, "\""); |
|  |  | } else { |
|  |  | xmlBufWriteQuotedString(buf->buffer, value); |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `960f0e2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGNOME%2Flibxml2%2Fcommit%2F960f0e2) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from mail.gnome.org_ad61f9d3_20250124_215321.html ===


[GNOME.org](https://www.gnome.org/)

[![GNOME: Mail Services](https://static.gnome.org/css/gnome-mail.png)](https://mail.gnome.org/ "Go to home page")

* [Home](https://mail.gnome.org/)
* [Mailing Lists](https://mail.gnome.org/mailman/listinfo/)
* [List Archives](https://mail.gnome.org/archives/)

Search

# [xml] Incorrect server side include parsing can lead to XSS and other similar issues

---

* *From*: Patrick Toomey <patrick toomey github com>
* *To*: "xml gnome org" <xml gnome org>
* *Subject*: [xml] Incorrect server side include parsing can lead to XSS and other similar issues
* *Date*: Fri, 12 Jan 2018 17:01:21 +0000

---

While triaging a reported cross site scripting bug we were analyzing the behavior of our HTML sanitization code and noticed that it was parsing an input in an unexpected way.Â  The sanitization library itself eventually wraps Nokogiri, which is a relatively thin wrapper around libxml2. We reached out to Kurt Seifriend and Daniel Veillard to let them know about the observed behavior.Â  There was discussion about whether the observed behavior was was expected or not and eventually it was suggested that we move the discussion to the libxml2 mailing list (the folks on that thread reserved CVE-2016-3709 in case it is decided that this is an issue). Â
In shortÂ <https://github.com/GNOME/libxml2/commit/960f0e2>Â introduced support for not URI escaping server side includes. However, this seems to lead to the below behavior.Â
-> Â libxml2 git:(bc5a5d65) â cat test/HTML/ssiquote.html<html><body><p><a href="">-> Â libxml2 git:(bc5a5d65) â make testHTML-> Â libxml2 git:(bc5a5d65) â ./testHTML test/HTML/ssiquote.html<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "<http://www.w3.org/TR/REC-html40/loose.dtd>"><html><body><p><a href="">
Notice that the output results in a script tag added to the resulting parsed output.Â  Here is a small bit of Java/Xerces code to compare:
import java.io.IOException;import java.io.StringReader;import java.io.StringWriter;
import javax.xml.parsers.\*;import javax.xml.transform.OutputKeys;import javax.xml.transform.Transformer;import javax.xml.transform.TransformerException;import javax.xml.transform.TransformerFactory;import javax.xml.transform.dom.DOMSource;import javax.xml.transform.stream.StreamResult;
import org.w3c.dom.Document;import org.w3c.dom.NamedNodeMap;import org.w3c.dom.Node;import org.w3c.dom.NodeList;import org.xml.sax.InputSource;import org.xml.sax.SAXException;
public class XmlTester {
 public static void main(String[] args) throws ParserConfigurationException, SAXException, IOException, TransformerException { String text = "<html><body><p><a href=""> DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); DocumentBuilder builder = factory.newDocumentBuilder();
 // text contains the XML content Document doc = builder.parse(new InputSource(new StringReader(text))); System.out.println(getStringFromDocument(doc)); }
 public static String getStringFromDocument(Document doc) throws TransformerException { DOMSource domSource = new DOMSource(doc); StringWriter writer = new StringWriter(); StreamResult result = new StreamResult(writer); TransformerFactory tf = TransformerFactory.newInstance(); Transformer transformer = tf.newTransformer(); transformer.transform(domSource, result); return writer.toString(); }}
This Java code, with the same input, results in the following output:
<html><body><p><a href=""></p></body></html>
The attribute contents are quoted/escaped such that Â they donât break out of the attribute once it is parsed. This libxml2 behavior doesnât apply to all attributes. If we change the href to a class attribute there is no issue. This likely makes sense since the above mentioned commit specifically references not URI escaping.Â
-> Â libxml2 git:(bc5a5d65) â cat test/HTML/ssiquote.html<html><body><p><a class='&lt;!--"&gt;&lt;script&gt;alert(1)&lt;/script&gt;-->'>test1</a></p></body></html>-> Â libxml2 git:(bc5a5d65) â make testHTML-> Â libxml2 git:(bc5a5d65) â ./testHTML test/HTML/ssiquote.html<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "<http://www.w3.org/TR/REC-html40/loose.dtd>"><html><body><p><a class='<!--"><script>alert(1)</script>-->'>test1</a></p></body></html>
So, I guess the question is, what do people think? I believe the argument from Daniel was roughly that this would be expected behavior for server side includes. However, this functionality seems to be in conflict with the Xerces behavior and it also leads to a trivial way to cause new/unexpected nodes to be introduced into the tree simply by parsing the document.Â

---

* **Follow-Ups**:
  + **[Re: [xml] Incorrect server side include parsing can lead to XSS and other similar issues](msg00011.html)**
    - *From:* Patrick Toomey

---

[[Date Prev](msg00009.html)][[Date Next](msg00011.html)]   [[Thread Prev](msg00004.html)][[Thread Next](msg00011.html)]
[[Thread Index](thread.html#00010)]
[[Date Index](date.html#00010)]
[[Author Index](author.html#00010)]

* [The GNOME Project](http://www.gnome.org)
  + [About Us](https://www.gnome.org/about/)
  + [Get Involved](https://www.gnome.org/get-involved/)
  + [Teams](https://www.gnome.org/teams/)
  + [Support GNOME](https://www.gnome.org/support-gnome/)
  + [Contact Us](https://www.gnome.org/contact/)
  + [The GNOME Foundation](https://www.gnome.org/foundation/)
* Resources
  + [Developer Center](https://developer.gnome.org)
  + [Documentation](https://help.gnome.org)
  + [Wiki](https://wiki.gnome.org)
  + [Mailing Lists](https://mail.gnome.org/mailman/listinfo)
  + [IRC Channels](https://wiki.gnome.org/GnomeIrcChannels)
  + [Bug Tracker](https://bugzilla.gnome.org/)
  + [Development Code](https://git.gnome.org/browse/)
  + [Build Tool](https://wiki.gnome.org/Jhbuild)
* [News](https://www.gnome.org/news)
  + [Press Releases](https://www.gnome.org/press/)
  + [Latest Release](https://www.gnome.org/start/stable)
  + [Planet GNOME](https://planet.gnome.org)
  + [Development News](https://news.gnome.org)
  + [Identi.ca](https://identi.ca/gnome)
  + [Twitter](https://twitter.com/gnome)

Copyright © 2005 -  [**The GNOME Project**](https://www.gnome.org/).


