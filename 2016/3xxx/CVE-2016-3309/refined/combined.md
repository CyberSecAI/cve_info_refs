=== Content from siberas.de_967a7dc1_20250126_073445.html ===


###### WER IST SIBERAS?

Die siberas GmbH ein auf Sicherheitsanalysen und Penetrationstests spezialisiertes Beratungsunternehmen, welches Sie herstellerunabhängig und kompetent im Bereich IT-Sicherheit berät.

###### LETZTE BLOGEINTRÄGE

* [Kernel Exploitation Case Study - "Wild" Pool Overflow on Win10 x64 RS2 (CVE-2016-3309 Reloaded)](/blog/2017/10/05/exploitation_case_study_wild_pool_overflow_CVE-2016-3309_reloaded.html)
* [sJET (siberas JMX Exploitation Toolkit)](/blog/2017/08/24/sjet_siberas_jmx_exploitation_toolkit.html)
* [TYPO3-CORE-SA-2016-013 analysis](/blog/2017/04/19/typo3-core-sa-2016-013-analysis.html)

###### KONTAKT

* **siberas GmbH*** Karl-Krämer-Strasse 29
     71364 Winnenden
     Deutschland
  * info@siberas.de
  * [@siberas](https://twitter.com/siberas) [siberas](https://github.com/siberas)

[![siberas logo](/images/siberas.png)](/index.html)

* [HOME](/index.html)
* [LEISTUNGEN](/index.html#services)
* [RESEARCH](/index.html#research)
  + [SECURITY ADVISORIES](/advisories.html)
  + [BLOG](/blog/)
  + [PWNING ADOBE READER with XFA](https://github.com/siberas/arpwn)
  + [WATOBO WEBPROXY](http://watobo.sourceforge.net/index.html)
* [KONTAKT / IMPRESSUM](/impressum.html)
* [DATENSCHUTZ](/datenschutz.html)
* [EN](/en/index.html)

# siberas blog

#### Because sharing is caring...

# Kernel Exploitation Case Study - "Wild" Pool Overflow on Win10 x64 RS2 (CVE-2016-3309 Reloaded)

* October 05, 2017
* [exploitation](/blog/category/exploitation)
  [research](/blog/category/research)
* Sebastian Apelt

### TLDR

* Microsoft reintroduced a kernel vulnerability in Windows 10 Creators Update which was originally patched in 2016. This blog showcases the exploitation of this âwildâ Pool-based overflow in the kernel on Windows 10 x64 (RS2)
* Microsoft improved the validation of the BASEOBJECT64.hHmgr field which makes linear Pool overflows on the Paged Session Pool harder to exploit when using well-known exploitation techniques using Palettes or Bitmaps
* Exploitation using Palettes or Bitmaps to get arbitrary Read-Write primitives is still possible despite the improved hHmgr Handle validation
* Exploits (one using Palettes, one using Bitmaps) have been published on [Github](https://github.com/siberas/CVE-2016-3309_Reloaded)

### Vulnerability History

About two months ago, we discovered an Integer Overflow vulnerability in the kernel function win32kfull!bFill in Windows 10 x86 (v1607, Anniversary Update) and Windows 10 x86/x64 (v1703, Creators Update). The vulnerability was reported to Microsoft via the ZDI. It has been patched as part of Microsoftâs [September Updates](https://portal.msrc.microsoft.com/en-us/security-guidance/releasenotedetail/5984735e-f651-e711-80dd-000d3a32fc99). ZDI published it as [ZDI-17-733](http://www.zerodayinitiative.com/advisories/ZDI-17-733/). The vulnerability did not receive its own CVE, because it was declared as an [update](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2016-0165) for [CVE-2016-0165](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-0165). The CVE-assignment was rather surprising for us since the âoriginalâ win32k!bFill vulnerability, which had been [discovered](http://www.zerodayinitiative.com/advisories/ZDI-16-449) by [@bee13oy](https://twitter.com/bee13oy) of CloverSec Labs, was assigned [CVE-2016-3309](http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-3309).

The interesting part with this vulnerability is that the very same issue had already been patched in Windows 10 and earlier Windows versions as part of the [MS16-098](https://technet.microsoft.com/en-US/library/security/ms16-098.aspx) update from August 2016. Back then, the patch successfully addressed this Integer Overflow vulnerability by adding the function [ULongMult](https://msdn.microsoft.com/en-us/library/windows/desktop/bb776657%28v%3Dvs.85%29.aspx) to perform overflow-safe multiplications. However, at some point Microsoft removed the ULongMult function from the Windows 10 code base. While the 64-bit version of Windows 10 remained safe despite the removal of this function, the 32-bit version of Windows 10 (v1607) became vulnerable again to this flaw. With the Creators Update things became worse, when Microsoft changed the resulting length variable of the multiplication to a 32-bit value. The result was that, by installing the Creators Update, everyone with the latest patch level of Windows 10 x64 was vulnerable again to this vulnerability. In fact, Microsoft made two code changes: First they dropped ULongMult in Windows 10, making the 32-bit OS vulnerable again, then they apparently changed the type of the length variable in v1703 making Windows 10 x64 vulnerable, too.

The bFill vulnerability has been exploited before and exploit code is publicly available. However, available exploit code targets Windows 8.1 x64 only. In this blog post we demonstrate how the vulnerability can also be exploited under Windows 10 x64 (Build 15063.540).

Great research material has been published by Saif El-Sherei ([@Saif\_Sherei](https://twitter.com/Saif_Sherei)) of Sensepost covering the details of this specific vulnerability. He demonstrated twice that this bug was very well exploitable:

* [Blog post](https://sensepost.com/blog/2017/exploiting-ms16-098-rgnobj-integer-overflow-on-windows-8.1-x64-bit-by-abusing-gdi-objects/): Exploiting MS16-098 RGNOBJ Integer Overflow on Windows 8.1 x64 bit by abusing GDI objects
* [Defcon 2017](https://media.defcon.org/DEF%20CON%2025/DEF%20CON%2025%20presentations/5A1F/DEFCON-25-5A1F-Demystifying-Kernel-Exploitation-By-Abusing-GDI-Objects.pdf): âDemystifying Windows Kernel Exploitation by Abusing GDI Objectsâ
* The exploit, slides, white paper, videos, etc. for his Defcon technique using Palette objects are published on [Github](https://github.com/sensepost/gdi-palettes-exp)

Important research with a very similar vulnerability has also been [published](https://www.coresecurity.com/blog/ms16-039-windows-10-64-bits-integer-overflow-exploitation-by-using-gdi-objects) by Nicolas Economou ([@NicoEconomou](https://twitter.com/NicoEconomou)), who demonstrated the exploitation of the RGNMEMOBJ::vCreate vulnerability on Windows 10 x64. While the vulnerability was in a completely different function the actual Integer Overflow and the function which triggers the Out-Of-Bounds (âOOBâ) Writes (win32kbase!AddEdgeToGET) are very similar.

The bFill vulnerability is a straight forward Integer Overflow, multiplying a controllable DWORD with a constant value (0x28 on 32-bit systems and 0x30 on 64-bit systems) before passing it on to the memory allocation function win32kfull!PALLOCMEM2. By allocating a small Pool buffer and overflowing into adjacent objects it was possible to achieve Ring0 code execution in a highly-reliable fashion with well-known techniques using GDI kernel objects.

This blog post will cover how the vulnerability found its way back into the Windows 10 code base and how to exploit it on Windows 10 x64 with the latest Creators Update (before the September patches were released). In my opinion, the bug is particularly interesting, since it is a good example of a linear, âwildâ Pool-based overflow, a type of vulnerability which still occurs quite often in modern Kernels. âWildâ in that context means that the contents which are written OOB are not, or only to a limited degree controllable by an attacker.

Please note that due to the amount of detail which had already been published by Saif and Nico, certain details about the overflow will be omitted or only covered briefly. I strongly recommend to study their research material beforehand.

### Before and after the Patch

First of all, letâs have a short look at how Microsoft originally patched the vulnerability under Windows 8.1 x64. Following images show the vulnerable code in win32k!bFill on the left and the patched version on the right:

![vuln1_win81](/assets/images/kernel_exploit/vuln1_win81.png)

The introduction of the safe multiplication wrapper function ULongMult (both under 64- and 32-bit systems) successfully remediated the vulnerability under Windows 8.1.

Knowing that the patches for Windows 8.1 looked good after the MS16-098 update, letâs look at the equivalent Windows 10 binaries (in case of Windows 10 this is win32kfull.sys) and how the vulnerability got patched there.

If you compare the pre-patch versions of the Windows 10 binaries for 32- and 64-bit, youâll notice that the vulnerable code looks almost 100% identical to the one we see in the vulnerable Windows 8.1 binary:

![vuln2_win10v1511](/assets/images/kernel_exploit/vuln2_win10v1511.png)

After the MS16-098 update, the vulnerabilities were resolved in the same way as it was done under Windows 8.1, by adding ULongMult to perform the potentially unsafe multiplication:

![vuln3_win10v1511_patched](/assets/images/kernel_exploit/vuln3_win10v1511_patched.png)

So far so good, it looks like Microsoft correctly patched the Integer Overflow under both Windows 10 versions back in 2016.

Now, letâs take a leap forward in time, up to the latest version (as of August 2017) of the Anniversary Update, v1607, and check the same code regions in the bFill function again:

![vuln4_win10v1607](/assets/images/kernel_exploit/vuln4_win10v1607.png)

First of all, we notice that the UIntMult function has been removed! Checking the binary, I found out that the safety function is not even present in the binary anymore â it had been **removed completely** from win32kfull.sys.

For the **64-bit** version the controlled size value is read as a DWORD (!) at win32kfull+0x4aa2 from RBX+4 and moved into EAX. At win32kfull+0x4abe we multiply RAX by 3 and store it into RCX. In this case, the **multiplication is indeed safe against Integer Overflows** since RAX is limited by the maximum value which can be stored in EAX, which is MAX\_UINT32 (0xffffffff). After the multiplication, the value in RCX is shifted left by 4 (i.e. multiplied by 0x10). This operation is also safe since RCX canât be bigger than MAX\_UINT32\*3, which is 0x2fffffffd. After the SHL instruction we also have a check that the resulting value in RCX is smaller than MAX\_UINT32. This last check is rather useless against an Integer Overflow which might occur in the instructions before, but anyway, in this case the situation is completely safe against the flaw mentioned above.

In the **32-bit** binary the situation is completely different: The controlled DWORD is again stored in EAX, but then we directly hit the unsafe IMUL instruction, multiplying the controlled DWORD by 0x28. This is the exact same vulnerability which was present before the MS16-098 patches were released! In other words: **By removing the UIntMult function Microsoft re-introduced the privilege escalation vulnerability in Windows 10, v1607, 32-bit**. On a side note: The UIntMult function has not been removed from Windows 8.1, only Windows 10 was affected.

When I noticed the re-appearance of this security issue, I wrote an advisory and submitted it to the ZDI describing the vulnerability. Since I analyzed the binary with the latest version of Windows 10 v1607, I initially missed that **things got even worse when installing the Creators Update**. Letâs see what happened by inspecting the win32kfull.sys binary of Windows 10 x64 v1703, fully patched as of August 2017 (the OS version footprint is 15063.0.amd64fre.rs2\_release.170317-1834 to be exact):

![vuln5_win10v1703](/assets/images/kernel_exploit/vuln5_win10v1703.png)

Just like in the last version of the binary we read the controlled DWORD from RBX into EAX (not RAX!). At win32kfull+0x11db47 we multiply the DWORD value in RAX by 3 and store the resulting value in ECX instead of RCX, thereby truncating the upper 32 bits of the 64-bit value. The SHL instruction can then be abused to cause a 32-bit Integer Overflow. As you might have noticed, the vulnerability now looks 100% the same as in Win10 v1511 before the MS16-098 updates. Any value larger than 0x5555556 will cause an exploitable Integer Overflow making the Windows kernel vulnerable to privilege escalation attacks. The above vulnerability in Windows 10 Creators Update could still be exploited despite all the mitigations that Microsoft has put into place to make an attackerâs life harder. The âhowâ will be covered in the exploitation part of this blog post.

But first, letâs take a look at how Microsoft has finally patched the vulnerability in the September updates (Build 15063.608):

![vuln6_win10v1703_patched](/assets/images/kernel_exploit/vuln6_win10v1703_patched.png)

As we can see, the safe multiplication wrapper functions have found their way back into the Windows 10 code base. The vulnerability is therefore not present anymore in the latest Windows 10 v1703.

Interestingly, under the v1607 branch the safe wrapper function has NOT been added for 64-bit, but only for 32-bit. But right now, the multiplication is done in a safe way. Well, letâs check that again in a few monthsâ¦ :)

### Exploitation Case Study

Recent research, most notably Morten Schenkâs ([@Blomster81](https://twitter.com/Blomster81)) [material](https://github.com/MortenSchenk/BHUSA2017) which has been published at BlackHat 2017, mostly focused on âWrite-What-Whereâ (âWWWâ) vulnerabilities. Morten has demonstrated that, even with the latest versions of Windows 10, it is still possible to exploit this type of vulnerability using arbitrary Read-Write (âARWâ) primitives based on the corruption of GDI objects. This vulnerability, however, is an example of a linear, Pool-based overflow. Furthermore, it is an overflow where you hardly control any of the data which is being written. This type of vulnerability is often labeled as âwildâ overflow since the data which is written OOB is not directly user-controllable. Linear Pool overflows are still very common in modern kernels, often originating from Integer Overflows or Integer Truncations. While similar exploitation techniques can be used to gain arbitrary code execution with both vulnerability classes, in case of a WWW-vulnerability the attacker always needs some sort of information leak in order to know where to write to. From an attackerâs perspective, the advantage of linear overflows is that you only need to craft the Pool layout properly in order to know exactly which object or structure you are going to overwrite. Unfortunately, Pool-based Feng Shui is still amazingly simple to accomplish under recent Windows 10 systems, giving you a large amount of possibilities which objects to overwrite.

**Please note:**
This blog post will not focus on the basics of GDI-object based kernel exploitation or basic Pool Feng Shui techniques. Also, we wonât cover an in-depth analysis of the vulnerability and the overflow itself. This has been thoroughly described in Saif El-Shereiâs [Defcon paper](https://github.com/sensepost/gdi-palettes-exp/blob/master/5A1F_Defcon_25_Demystifying_Kernel_Exploitation_By_Abusing_GDI_Objects_white_paper.pdf) (pages 33-49).

#### Facilitating Pool Layout

The first step into exploiting this bug was of course running Saifâs public [exploit](https://github.com/sensepost/gdi-palettes-exp/blob/master/MS16-098/main.c) against a vulnerable Windows 10 x64 VM (Build 15063.540). Saifâs exploit performs Pool Feng Shui before triggering the actual vulnerability in order to overwrite the sizlBitmap.cx member of a Bitmap object (or SURFOBJ in kernel context). This could be leveraged to create an ARW primitive and to elevate privileges by hijacking the SYSTEM Process Token. The Pool Feng Shui is a decisive part of the exploit which has to work in a highly-reliable fashion, because the wrong Pool layout will in most cases directly BSOD the machine.

In order to verify the Pool layout, a breakpoint was set on the instruction right after the flawed win32kfull!PALLOCMEM2 allocation, at win32kfull!bFill+0x3e6:

![pool_layout_saif_exploit](/assets/images/kernel_exploit/pool_layout_saif_exploit.png)

According to Saifâs description we should have seen the 0x50-sized allocation (0x60 includes 0x10 bytes for the Pool header) to be located right at the end of a Pool Page, not in the middle. Obviously, crafting the Heap (in this case, the Paged Session Pool) was not successful. The actual OOB Writes, which happen later in the function win32kbase!AddEdgeToGET, will overwrite the adjacent object headers and data fields, which will result in a BSOD.

Just a short recap: Saifâs Pool layout should have given us a continuous pattern of one Region object (Pool tag âGh04â), followed by one Bitmap object (tag âGh05â), followed by 2 freed Accelerator objects of size 0x40 (tag âUsacâ):

![pool_layout_region_and_bitmap](/assets/images/kernel_exploit/pool_layout_region_and_bitmap.png)

The 0x50-sized allocation was supposed to fall into one of the âholesâ created at the end of one of the Pages.

The reason why we did not get this layout was of course a change in the object sizes which were used in the Pool Feng Shui. Luckily, adjusting the object sizes is just a matter of supplying the correct parameters to the CreateBitmap and CreatePalette functions. In order to facilitate the creation of Bitmap and Palette objects of a certain size wrapper functions have been written to accomplish this task (createPaletteofSize, createBitmapOfSize and createCompatibleBitmapOfSize). The functions only take a size parameter which will be the Pool bufferâs size (excluding Pool header) that is supposed to be allocated. The parameters are then computed accordingly. As an example, this is the createPaletteofSize function:

```
HPALETTE createPaletteofSize(int size) {
  // we alloc a palette which will have the specific size on the paged session pool.
  if (size <= 0x90) {
    printf("bad size! can't allocate palette of size < 0x90!\n");
    return 0;
  }
  int pal_cnt = (size - 0x90) / 4;
  int palsize = sizeof(LOGPALETTE) + (pal_cnt - 1) * sizeof(PALETTEENTRY);
  LOGPALETTE *lPalette = (LOGPALETTE*)malloc(palsize);
  memset(lPalette, 0x4, palsize);
  lPalette->palNumEntries = pal_cnt;
  lPalette->palVersion = 0x300;
  return CreatePalette(lPalette);
}
```

So, after figuring out how to layout the Pool in the exact same way as it was described in Saifâs white paper, another problem occurred which took me quite some time to overcome. The whole system suddenly froze after running the POC. This happened for both techniques, either when using Palettes or when using Bitmaps. Please note, that it was not a BSOD which occurred, just a system freeze. Now, how do you debug a system freeze? The big problem with a freeze is that you have no fixed point where you can clearly say NOW things went wrong, unlike if you get a BSOD where you see a backtrace and the exact place where nt!KeBugcheckEx was called. Usually, when you get a crash, you simply trace backwards from the faulting instruction to see where the problem originates from. But this specific point was missing hereâ¦ So after freezing my VM quite a number of times without getting any further my decision was to simplify Saifâs POC and to rewrite it from scratch, step by step, to see if and where the problem popped up again.

First, I wanted to simplify the Pool layout. The plan was to get rid of the Accelerator objects and the Region objects and to do the Pool Feng Shui with only Palette or Bitmap objects, just to make sure that the problem was not connected to those objects. A continuous pattern of 4 Palettes or Bitmaps each was supposed to be created with a âholeâ at the end of the first object. The hole should be created as a free spot which is supposed to be claimed by the overflow-buffer at the moment when we trigger the vulnerability. Additionally, the hole needs to be at the end of the Pool Page because otherwise the system would bugcheck when freeing the overflow-buffer near the end of the win32kfull!bFill. So, why do we actually need 4 consecutive objects? The first one is a âDummyâ object which will prepare the hole for the overflow-buffer. The second one will be called âPwndâ object, since it is the one which will get overwritten by the overflow. This Pwnd object (with overwritten cEntries or sizlBitmap.cx value, depending on the technique) will be used to transform the 3rd object in line into our Manager and the 4th object into our Worker object. The control of the Worker object will give us the ARW primitive: For Bitmap object we can can control the sizlBitmap.cx value and the pvScan0 pointer, for Palette objects we can control the cEntries value and the pFirstColor pointer.

Please note, that we can NOT use the Pwnd object as the Manager object, because we will only be able to do exactly one Set/GetPaletteEntries or Set/GetBitmapBits call with that overwritten object. The reason for that is a deadlock situation which will occur due to the wild overflow into the Pwnd object â this will be explained in detail in the next paragraph. The Pool layout, what to overwrite and where to overwrite is illustrated in the following visualization:

![pool_feng_shui](/assets/images/kernel_exploit/pool_feng_shui.gif)

Adjusting the Pool layout to the hole of size 0xa0 was required so that the overwrite exactly hits the cEntries or sizlBitmap.cx values. The good thing with Integer Overflows is that the chance that you control the size of the overflow-buffer is usually quite high. Just like in this case!

Looking at Saifâs POC code we see that he used 0x156 PolyLineTo calls with 0x3fe01 as parameter, which gave him the exact size he needed (0x50). The computation behind that is:

```
0x3FE01 * 0x156 = 0x5555556;
(0x5555556 + 1) * 0x30 = 0x100000050 = (UINT32) 0x50
```

In our case we need to get size 0xa0. In order to allocate this size, we canât use an Integer Overflow which results in a size just above MAX\_INT32, because 0x1000000a0 cannot be divided evenly by 0x30 (0x1000000a0 % 0x30 = 0x20). However, we can just use 2\*MAX\_INT32 as âtargetâ boundary. The only thing we need is an integer factorization of 0xaaaaaad (== (0x2000000a0 / 0x30) - 1), so for example the values 0x1769 and 0x74a5 give us the correct size:

```
0x1769 * 0x74a5 = 0xaaaaaad
(0xaaaaaad + 1) * 0x30 = 0x2000000a0 = (UINT32) 0xa0
```

Using only Palettes or Bitmaps makes the code of the Feng Shui part very simple. For example, for Palette objects, the Feng Shui task is performed by the following lines of code (chunksize in this case is 0xa0, palette\_size is 0xf40):

```
// defragment on page level â we will cause 0xfe0 + 0x10 = 0xff0-sized buffers, filling one pool page each
for (int i = 0; i < 0x400; i++) {
	AllocateOnSessionPool(0xfe0); // alloc 0xff0 including header
}

// defragment with chunksize - we will create buffers on session pool of size chunsize + 0x10
for (int i = 0; i < 0x5000; i++) {
	AllocateOnSessionPool(chunksize);
}

targets_objects = (target_objs*)calloc(create_objs_count, sizeof(target_objs));

for (int i = 0; i < create_objs_count; i++) {
	targets_objects[i].dummy_palette   = createPaletteofSize(palette_size); // create "hole" here!
	targets_objects[i].pwnd_palette    = createPaletteofSize(0xfe0); // alloc 0xff0 including header
	targets_objects[i].manager_palette = createPaletteofSize(0xfe0);
	targets_objects[i].worker_palette  = createPaletteofSize(0xfe0);
}

// now trigger some more chunksize allocations to fill the holes
for (int i = 0; i < create_objs_count / 2; i++) {
	AllocateOnSessionPool(chunksize);
}
```

The Feng Shui part for the Bitmap technique will look exactly the same, only with calls to createBitmapOfSize instead of createPaletteOfSize.

The AllocateOnSessionPool function does what the name already implies, allocate a buffer of a given size on the Paged Session Pool by using the NtUserConvertMemHandle syscall (kudos to Nico for finding this nice allocation primitive!). First, we defragment on the Pool Page level, allocating 0x400 Pages. Afterwards, we defragment with size 0xa0 to fill potential holes that we do not want to hit when allocating our overflow-buffer. Finally, we allocate the Palettes in groups of four with sizes 0xf40, 0xfe0, 0xfe0, 0xfe0 (excluding header size). After creating the objects, we allocate some more 0xa0-sized buffers to make sure the overflow-buffer is placed somewhere in the middle of the created objects.

Now, when we trigger the vulnerability right after the Pool Feng Shui part we can verify whether it actually worked and if the overflow-buffer falls into the correct hole. We can do this by setting a breakpoint on the instruction right after the flawed allocation in the win32kfull!bFill function. The following listing shows the Pool layout for the Palette technique:

![pool_layout_palettes](/assets/images/kernel_exploit/pool_layout_palettes.png)

As we can see, the overflow-buffer claimed exactly the hole that we wanted. The buffer size 0xb0 of course includes the Pool header. The actual overflow will happen right after the allocation, in function win32kbase!bConstruct which will call win32kbase!AddEdgeToGet for the actual writes. Due to the placement of the overflow-buffer we will hit the adjacent âPwnd Paletteâ and overwrite its cEntries field. The same overflow situation with Bitmaps will lead to an overwrite of the sizlBitmap.cx field.

#### Inspecting a System Deadlock

Now, letâs have a look at the actual overflow. We continue from the debugger state above, with RIP still at the position right after the flawed allocation. The following listing shows the memory before and after the overflow using Palettes:

![before_and_after_overflow_palettes](/assets/images/kernel_exploit/before_and_after_overflow_palettes.png)

The important cEntries value has been colored yellow - it has been overwritten with 0x1337. This will give us OOB Read and Write capabilities through the Pwnd Palette.

Using the Bitmap technique we will see the following data layout before and after the overflow:

![before_and_after_overflow_bitmaps](/assets/images/kernel_exploit/before_and_after_overflow_bitmaps.png)

The overwritten sizlBitmap.cx field will give us an OOB Read and Write primitive through the Pwnd Bitmap.

Continuing after the overflow we iterate over the pwnd\_palette (or pwnd\_bitmap) entries in our target\_object array, calling SetPaletteEntries (or SetBitmapBits) on each object. One of the calls will then trigger the overflow into the Manager object:

```
for (int i = create_objs_count - 1; i >= 0; i--) {
  // [...]
  if (SetPaletteEntries(targets_objects[i].pwnd_palette, 0, palette_overflow_count_until_cEntries / 4, rPalette) == (palette_overflow_count_until_cEntries / 4))
    break;
}
```

But when executing the POC, trying to get control over the Manager object, the old problem popped up again: The POC first became unresponsive, then the machine suddenly froze! Again the same behavior, for both Palettes and Bitmaps.

At least I had minimized the POC to the point where I knew things went down the drain: It must have been one of the SetPaletteEntries or SetBitmapBits calls which causes the freeze â most likely the one which operates on the overwritten object. Knowing that the problem was related to the overwritten Palette or Bitmap object it could also be concluded that overwritten Accelerator or Region objects were not involved in the system freeze.

As you can see in above memory dumps, we overwrite nearly every single byte of the adjacent object, up to the cEntries / sizlBitmap.cx members and including a few bytes after these. The identification of the âbadâ field was now just a matter of creating a minimalistic piece of code and of manually âreplayingâ the overflow situation step-by-step.

The way I approached this will be explained using the Palette objects â the same methodology can be applied to Bitmaps. The code that I used for Palettes was:

```
LOGPALETTE lPalette;
memset(&lPalette, 0x4, sizeof(LOGPALETTE) + 1*sizeof(PALETTEENTRY));
lPalette.palNumEntries = 1;
lPalette.palVersion = 0x300;
HPALETTE hpal = CreatePalette(&lPalette);
PALETTEENTRY palentry = { 1,2,3,4 };
while (1) {
	printf("call SetPaletteEntries now!\n");
	getchar();
	int res = SetPaletteEntries(hpal, 0, 1, &palentry);
	printf("res: set 0x%x entries\n", res);
}
```

The loop continuously calls SetPaletteEntries. This gives us the chance to change data bit by bit. In order to manually change data of the Palette object, a breakpoint should be set right after the EPALOBJ constructor in win32kfull!GreSetPaletteEntries. When hitting win32kfull!GreSetPaletteEntries+0x31, RSP+0x28 will hold a reference to the Palette object:

```
ba e1 win32kfull!GreSetPaletteEntries+0x31 "dd poi(rsp+28)"
```

![GreSetPaletteEntries](/assets/images/kernel_exploit/GreSetPaletteEntries.png)

Executing the c snippet, we will hit our breakpoint and we see the âcleanâ layout of the Palette object.

![palette_object_clean](/assets/images/kernel_exploit/palette_object_clean.png)

Only the first 0x40 bytes are taken into account, since this is the number of bytes that we overwrite in our scenario. The bytes which will be overwritten with different values are colored yellow (for BASEOBJECT64) and cyan (for other fields of the PALETTE64 structure). Just as a reminder, here are the BASEOBJECT64 and PALETTE64 structures, taken from Saifâs paper:

```
typedef struct _BASEOBJECT64
{
    ULONG64 hHmgr;		// 0x0
    ULONG32 ulShareCount;	// 0x8
    WORD cExclusiveLock;	// 0xc
    WORD BaseFlags;		// 0xe
    ULONG64 Tid;		// 0x10
 }BASEOBJECT64

typedef struct _PALETTE64
{
    BASEOBJECT64 BaseObject;	// 0x00
    FLONG flPal;      		// 0x18
    ULONG cEntries;   		// 0x1C
    ULONGLONG ullTime;    	// 0x20
    HDC hdcHead;    		// 0x28
    HDEVPPAL hSelected;  	// 0x30
    ULONG cRefhpal;   		// 0x38
    ULONG cRefRegular;		// 0x3c
    PTRANSLATE ptransFore;	// 0x40
    PTRANSLATE ptransCurrent;	// 0x48
    PTRANSLATE ptransOld;	// 0x50
    ULONGLONG unk_058;		// 0x58
    PFN pfnGetNearest;		// 0x60
    PFN pfnGetMatch;		// 0x68
    ULONGLONG ulRGBTime;	// 0x70
    PRGB555XL pRGBXlate;	// 0x78
    PALETTEENTRY *pFirstColor;	// 0x80
    struct _PALETTE *ppalThis;	// 0x88
    PALETTEENTRY apalColors[3];	// 0x90
} PALETTE64, *PPALETTE64;
```

So now, with each time we hit SetPaletteEntries, we can manually overwrite the fields and see if we âsurviveâ the syscall, or if we encounter the program or system freeze. Following this procedure step-by-step we end up with the following manual overwrites where SetPaletteEntries is still returning data to us:

![manual_palette_overwrites](/assets/images/kernel_exploit/manual_palette_overwrites.png)

However, if we overwrite the first DWORD (lower 32 bits of BASEOBJECT64.hHmgr) with 0, just in the way it happens when executing our POC, we will recognize that our program will become completely unresponsive. And, if for example you start a new process or if you just wait a few seconds, you will see that the whole OS freezes. kd will you only report the following message:

```
DBGK: DbgkWerCaptureLiveKernelDump: WerLiveKernelCreateReport failed, status 0xc0000022.
```

Finally, we have identified the culprit: It is the BASEOBJECT64.hHmgr member which causes the problems. And due to the fact that the hHmgr Handle is the first field of both BITMAP and PALETTE objects you cannot avoid overwriting the hHmgr field if you want to manipulate the cEntries or sizlBitmap.cx fields. At first sight this really poses a problem when exploiting linear overflows with GDI-based techniques.

On a side note, the hHmgr value problem could of course be avoided in cases of controlled, linear Pool overflows. The reason is that the value of the hHmgr member is the HPALETTE value which is known from userland. That means, if we are able to overwrite the hHmgr value with the known HPALETTE value we donât get into trouble at all â and that is of course possible when you control the data being written. Unfortunately, in our case we neither have a way to actually control this value with our overflow, nor do we have a chance to leave the hHmgr value untouched. This exact problem will likely be the case for most linear Pool overflows.

The described situation where you can only overwrite the hHmgr Handle with the value 0 is of course a special one and the chance that you hit this corner case is arguably rather slim. However, executing Set/GetPaletteEntries on Palette objects with a hHmgr field overwritten with different values doesnât have much better outcomes:

Examples:

* Overwriting it with 0xeeeeeeee (or other randomly chosen, large values) will result in a BSOD, caused within the EPALOBJ constructor which calls win32kbase!HmgShareLockCheck and then crashes in nt!ExReleasePushLockExclusiveEx:

![BSOD_HmgShareLockCheck_p1](/assets/images/kernel_exploit/BSOD_HmgShareLockCheck_p1.png)

Backtrace:

![BSOD_HmgShareLockCheck_p2](/assets/images/kernel_exploit/BSOD_HmgShareLockCheck_p2.png)

* Overwriting it with 0x1000 will result in a BSOD at the same address, but with a 0-pointer exception
* Overwriting it with 0x10000 will result in the same behavior as with 0 (first process hang, then OS freeze)
* â¦

The BSOD-case is of course not of advantage for us, so I tried to understand what happens when we hit the scenario with freezing the main Thread (hHmgr == 0) and later the whole system.

Single-Stepping through win32kfull!GreSetPaletteEntries we recognize that with hHmgr == 0 we do actually âsurviveâ the EPALOBJ constructor call which crashes with large values. However, now the main Thread gets stuck when calling win32kbase!DEC\_SHARE\_REF\_CNT. The call to this function happens near the end of win32kfull!bFill and takes a pointer to the overwritten hHmgr value as parameter.

Digging a bit deeper into DEC\_SHARE\_REF\_CNT we can observe that we get stuck calling the following functions:

![call_chain_ReleasePushLock](/assets/images/kernel_exploit/call_chain_ReleasePushLock.png)

The function nt!ExReleasePushLockExclusiveEx releases so-called [Pushlocks](https://blogs.msdn.microsoft.com/ntdebugging/2009/09/02/push-locks-what-are-they/). Pushlocks are an internal synchronization mechanism when accessing critical data structures. The word âexclusiveâ means that access to a certain structure is queued â if, for example, some other Thread has acquired exclusive access using a Pushlock weâll have to wait until the Pushlock is released again. One would assume that the kernel just rejects invalid Handle values (such as 0), but in this case, it seems like it doesnât, but just enters a waiting state. The result is that our SetPaletteEntries function triggers the NtGdiDoPalette syscall which calls win32kfull!GreSetPaletteEntries and never returns from that, thus freezing our main Thread. If you remember, in the Pool Layout paragraph I mentioned that you can only use the Get/SetPaletteEntries or Get/SetBitmapBits call once on the overwritten Pwnd object. The described behavior is the reason for that: You will just freeze every thread which calls one of these functions on the overwritten Pwnd object.

#### Continuation in separate Thread

At that point, it seemed like the validation of the hHmgr value has rendered the vulnerability un-exploitable when using Palette and Bitmap techniques. To my surprise, I received a different result when overwriting the hHmgr Handle with 1 instead of 0. I tried this because I knew that by chosing certain point values I was able to actually overwrite the hHmgr value with 1. Hitting SetPaletteEntries with 1 did result in the same deadlock situation of the main Thread, however, for some reason, the system did not freeze anymore! This was a game changer since we were now able to continue execution in a separate Thread without being killed by a deadlocking OS. And since multiple Threads share the same Paged Session Pool, we can just use the second âContinuation Threadâ to detect the successful overwrite of the Manager object and carry on with exploitation in this child Thread. The first part of the continuation Thread is:

```
void continuation_thread() {

  printf("[+] continuation thread waiting for signal...\n");
  while (!go)
    Sleep(100);

  // now we're in the overflow loop in the main thread. wait a bit to make sure we've hit the overflow
  Sleep(1000);

  printf("[+] now check overflow success in continuation thread\n");

  // stay in loop of GetPaletteEntries read attempts until we detect that we have OOB RW capabilities
  int oob_read_count = 0x1000;
  manager_bits = (BYTE*)malloc(oob_read_count);
  int cRead = 0;
  while (!cRead) {
    cRead = GetPaletteEntries(manager_palette, 0, oob_read_count / 4, (PALETTEENTRY*)manager_bits);
    if (cRead != oob_read_count / 4) {
      printf("[-] could not detect arbitrary RW. expected to read 0x%x but only got 0x%x\n", oob_read_count, cRead * 4);
      return;
    }
    Sleep(1000);
  }

  printf("[+] successfully detected OOB RW capability in continuation thread!\n");
  // [...]
```

The âgoâ Boolean variable is set to true in the main Thread, right before entering the SetPaletteEntries loop. After this variable has changed we pause execution for a short moment (1000 ms in that case) until we can safely assume that the SetPaletteEntries loop has hit the overwritten Pwnd Palette object and we overwrote the cEntries field of the Manager Palette. The first GetPaletteEntries call on the Manager Palette should already return that we can read 0x1000 bytes, indicating that ARW is now possible.

As soon as we gained ARW, we repair the overwrittten values of the Pwnd and Manager objects to restore everything of importance to its original state.

After that we need to get the EPROCESS address of SYSTEM and the EPROCESS address of our process in order to use the ARW primitive to copy over the Token. A well-known way to get the EPROCESS pointers is to get the ntoskrnl base address first and then to resolve nt!PsInitialSystemProcess, which carries a pointer to the SYSTEM EPROCESS structure. As soon as we have this pointer we can use the ActiveProcessLinksOffsets to iterate over the various processes. The Token Kidnapping attack is nothing new and wonât be covered in detail.

More interesting is probably a (AFAIK) new way how to get the ntoskrnl base address when using either Bitmap or Palette objects for exploitation. First, I was trying to get my Pool Feng Shui working using Bitmaps created by calling CreateCompatibleBitmap. If that worked, I would have been able to just use Morten Schenkâs technique that he published during BlackHat: He used the Bitmap objectâs hdev pointer to get a pointer to cdd!DvrSynchronizeSurface. This function contains a call to nt! ExEnterCriticalRegionAndAcquireFastMutexUnsafe which he finally uses to compute the ntoskrnl base.

Actually, thereâs a much simpler way which works for both, Bitmaps and Palettes: If we look at the BASEOBJECT64 member of either the Palette or the Bitmap object we can see that the Tid member of the structure is actually a pointer to a nt!ps structure of size 0x8a0:

![nt_leak](/assets/images/kernel_exploit/nt_leak.png)

If we search through this object with dqs we can find pointers to nt!EmpCheckErrataList and nt!KiSchedulerApc at offset 0x308/0x318:

![leaked_pointers](/assets/images/kernel_exploit/leaked_pointers.png)

With our ARW primitive we can simply read out the Tid pointer and then the nt!EmpCheckErrataList pointer, subtract a static offset from it and thereby compute the nt base address.

After getting the nt base address we can carry on with the Token Kidnapping technique and finally grant ourselves SYSTEM privileges.

However, one thing will stay, even with SYSTEM privileges: Weâll be left with a non-killable process! The syscall from the SetPaletteEntries call will stay waiting in the kernel and will never return execution to userland. If someone finds out how to release a Pushlock using a data only attack please tell me =)

Here is a screenshot of the working exploit using Palettes in action:

![privesc_palettes](/assets/images/kernel_exploit/privesc_palettes.png)

The exploit using Bitmap objects is structured exactly the same:

![privesc_bitmaps](/assets/images/kernel_exploit/privesc_bitmaps.png)

Finally, following screenshot shows the successful elevation to SYSTEM privileges:

![privesc_success](/assets/images/kernel_exploit/privesc_success.png)

The procedure for exploiting the vulnerability with Bitmap objects is similar to when using Palettes. The Pool Feng Shui and also the hHmgr locking is exactly the same. However, even when overwriting the hHmgr value with 1 the system will still deadlock after a while. This is a point where the technique using Palettes seems to better-suited than the Bitmap technique. I still included a finished exploit for the Bitmap technique, since privilege escalation is also possible here, however a system freeze will occur after some time. The difference why Palettes work completely fine and keep the OS alive, while Bitmaps still cause trouble remains unclear.

Executing the minimalistic POC and performing the manual overwrites as shown above does NOT cause the problems that we get on the latest Windows 8.1 x64 and it is also not a problem on Windows 10 x64, v1511! It seems like Microsoft has been hardening Handle checks in order to make linear Pool overflows more difficult to exploit since Anniversary Update v1607.

#### Conclusions

* Improved Handle validation, which has been introduced in Windows 10 Anniversary Update, can be an obstacle for attackers when exploiting linear Pool overflows with current GDI-based exploitation methods
* With a limited degree of control over the BASEOBJECT64.hHmgr Handle it is still possible to reliably exploit âwildâ linear Pool overflows using GDI objects
* When exploiting a vulnerability using Palette objects with a specifically-overwritten hHmgr value, the OS will remain stable, in contrast to when using Bitmap objects, which will most likely lead to a BSOD or a system freeze

Special thanks to Saif El-Sherei ([@Saif\_Sherei](https://twitter.com/Saif_Sherei)) and Ashfaq Ansari ([@HackSysTeam](https://twitter.com/HackSysTeam)) for helpful input and ideas!

-Sebastian

exploitation
1
kernel
1

* [← Previous Post](/blog/2017/08/24/sjet_siberas_jmx_exploitation_toolkit.html)

---

#### CATEGORIES

* (3) research
* (5) exploitation

### TAGS

exploitation
1
kernel
1

---

[Impressum](/impressum.html)
/
[Datenschutz](/datenschutz.html)

© 2018 siberas GmbH



=== Content from www.offsec.com_c84a2d9e_20250126_073444.html ===


* Solutions Learning Solutions            Learning Library Cyber workforce resilience and career development with hands-on, real-world training      Cyber Ranges Live-fire simulations to train your team and stay ahead of the latest threats         [Courses & Certifications

  Industry-leading certifications and training for continuous learning](https://www.offsec.com/courses-and-certifications)   [Learning Paths

  Focused training to develop skills based on a specific area of interest](https://www.offsec.com/learning/paths)   [Job Roles

  Rigorous training content and labs for the most critical and in-demand job roles](https://www.offsec.com/learning)   [Skills Development

  Focused training to develop critical cybersecurity skills](https://www.offsec.com/learning/skill-paths-pins)   [Industry Frameworks

  Framework-specific training for MITRE ATT&CK, D3FEND and NIST/NICE](https://www.offsec.com/learning/industry-frameworks)   [Explore Learning Library](https://portal.offsec.com/)     [New course

  IR-200: Foundational Incident Response

  IR-200 teaches the incident response lifecycle, including detection, analysis, containment, eradication and recovery. Learners develop hands-on skills responding to, communicating, and mitigating cyber attacks.

  ![IR-200: Foundational Incident Response](https://manage.offsec.com/app/uploads/2024/10/Course-IR-200.png)](https://www.offsec.com/courses/ir-200/)     [Enterprise Cyber Range & Versus

  Set up tournaments and test red and blue team skills in a live-fire cyber range](https://www.offsec.com/enterprise/cyber-range)   [Offensive Cyber Range

  Train on the latest attack vectors to address vulnerabilities](https://www.offsec.com/enterprise/cyber-range/offensive)   [Defensive Cyber Range

  Prepare for the next attack with simulated real-world training environments](https://www.offsec.com/enterprise/cyber-range/defensive)   [Watch a demo](https://learn.offsec.com/webinar-cyber-drills-versus/?utm_source=offsec)     [Exclusive

  Hands-on training in live-fire, enterprise environments

  Use our most powerful cyber range to develop a cyber resilient workforce

  ![Hands-on training in live-fire, enterprise environments](https://manage.offsec.com/app/uploads/2024/05/live_fire_feat.png)](https://www.offsec.com/enterprise/cyber-range/versus)
* Why OffSec            Organizations Continuous learning & skill development to build cyber workforce resilience      Individuals Get industry leading training and reinforce learning with hands-on labs         [Teams & Enterprises

  Continuous learning & hands-on skills development for cybersecurity teams](https://www.offsec.com/organizations/enterprise)   [Public Sector

  Unique training for government agencies and educational institutions](https://www.offsec.com/public-sector)   [Use Cases

  Meet critical cyber workforce needs with OffSec's learning platform](https://www.offsec.com/use-cases)   [Industries

  Purpose-built and industry-recognized cybersecurity training](https://www.offsec.com/industry)   [Contact sales](https://www.offsec.com/sales)     [Recommended

  Learn Enterprise

  Address your talent gap through continuous skills development and knowledge acquisition

  ![Learn Enterprise](https://manage.offsec.com/app/uploads/2024/05/le_feat_nav_icon.png)](https://www.offsec.com/products/learn-enterprise)     [Attain a Certification

  Prove critical knowledge & skills with an industry-standard certification](https://www.offsec.com/courses-and-certifications)   [Get Hands-on Practice

  Challenge yourself in real-world lab environments](https://www.offsec.com/labs/individual)   [Increase Career Prospects

  Ready yourself for the next step in your cybersecurity career](https://www.offsec.com/products)   [Buy now](https://www.offsec.com/register/)     [New course

  IR-200: Foundational Incident Response

  IR-200 teaches the incident response lifecycle, including detection, analysis, containment, eradication and recovery. Learners develop hands-on skills responding to, communicating, and mitigating cyber attacks.

  ![IR-200: Foundational Incident Response](https://manage.offsec.com/app/uploads/2024/10/Course-IR-200.png)](https://www.offsec.com/courses/ir-200/)
* Pricing Plans & Pricing            Organizations Flexible solutions designed for organizations across industries and sizes      Individuals Find the right training plan for your unique learning needs         [Subscription Pricing

  Provide continuous Learning Library access to build cyber workforce resilience](https://www.offsec.com/pricing/organization)   [Cyber Ranges

  Hands-on training in live-fire, simulation environments](https://www.offsec.com/labs/enterprise)   [Pentesting Services

  Let OffSec conduct a comprehensive vulnerability assessment](https://www.offsec.com/penetration-testing)   [Contact sales](https://www.offsec.com/sales)     [Recommended

  Learn Enterprise

  Provide continuous learning and skill development with Learn Enterprise. Access to the entire Learning Library and the Enterprise Cyber Range for everyone on your team.

  ![Learn Enterprise](https://manage.offsec.com/app/uploads/2024/05/le_feat_nav_icon.png)](https://www.offsec.com/products/learn-enterprise/)     [Pricing

  Flexible options based on your learning goals](https://www.offsec.com/pricing/individual)   [![Learn One](/_astro/one.CuIttstx_1iqdIc.svg)   Learn One

  12-month access to a single course, related labs, and two exam attempts](https://www.offsec.com/products/learn-one)   [![Course & Certification Bundle](/_astro/courses.DUpgYt2-_ZJbVTu.svg)   Course & Certification Bundle

  90-day access to a single course, related labs, and one exam attempt](https://www.offsec.com/products/90-day-bundle)   [![Learn Fundamentals](/_astro/fundamentals.iMOuAzP9_Z1YsvOA.svg)   Learn Fundamentals

  12-month access to introductory- and essential-level content](https://www.offsec.com/products/fundamentals)   [Proving Grounds Labs

  OffSec-curated private labs to practice and perfect your pentesting skills](https://www.offsec.com/labs/individual)   [Buy now](https://www.offsec.com/register/)     [New course

  IR-200: Foundational Incident Response

  IR-200 teaches the incident response lifecycle, including detection, analysis, containment, eradication and recovery. Learners develop hands-on skills responding to, communicating, and mitigating cyber attacks.

  ![IR-200: Foundational Incident Response](https://manage.offsec.com/app/uploads/2024/10/Course-IR-200.png)](https://www.offsec.com/courses/ir-200)
* Partners         [Global Partner Program](https://www.offsec.com/global-partners)   [Partner Portal Login](https://partnerportal.offsec.com/?utm_source=offsec#/page/login)   [Find a Partner](https://www.offsec.com/partner-locator)

  Become a Partner

  Add OffSec to your list of training providers

   [Partner with us](https://www.offsec.com/global-partners/#application)
* Community Kali & Community         [Join Our Community](https://www.offsec.com/community-sign-up)   [Kali Linux](http://www.kali.org/get-kali/?utm_source=offsec)   [Community Projects](https://www.offsec.com/community-projects)   [OffSec Discord](https://offs.ec/discord?utm_source=offsec)   [OffSec Live](https://www.twitch.tv/offsecofficial?utm_source=offsec)

  Connect with us

  OffSec office hours every Friday on Twitch

   [OffSec Twitch](https://www.twitch.tv/offsecofficial?utm_source=offsec)
* Resources
  + [Read](https://www.offsec.com/resources)
  - [Blog](https://www.offsec.com/blog/)
  - [Case Studies](https://www.offsec.com/resources/case-study)
  - [Guides](https://www.offsec.com/resources/guides)
  - [White Papers](https://www.offsec.com/resources/whitepaper)
  - [Product Updates](https://www.offsec.com/resources/product-updates)
  + Watch
  - [Webinars](https://www.offsec.com/webinars)
  - [Twitch](https://www.twitch.tv/offsecofficial?utm_source=offsec)
  - [YouTube](https://www.youtube.com/%40OffSecTraining?utm_source=offsec)
  + Learn
  - [Cyberversity](https://www.offsec.com/cyberversity)
  - [Cybersecurity Job Roles](https://www.offsec.com/cybersecurity-roles)
  + Work at OffSec
  - [Careers](https://www.offsec.com/careers)
  - [Values](https://www.offsec.com/values)
  + [Live Training & Events](https://www.offsec.com/training-and-events)
  + [Subscribe to our Newsletters](https://www.offsec.com/subscriptions)
  + [Press Room](https://www.offsec.com/press-room)
  + [Help Center](https://help.offsec.com/hc/en-us?utm_source=offsec)
  + [Swag Store](https://offsec.usa.dowlis.com/?utm_source=offsec)   [View the Resource Center](/resources/)        [Press Release

  Leeds Equity Partners Acquires OffSec

  Leeds Equity Partners announced that it has acquired OffSec, the leading provider of continuous cybersecurity workforce development training and professional education for cybersecurity practitioners from Spectrum Equity

  ![Leeds Equity Partners Acquires OffSec](https://manage.offsec.com/wp-content/uploads/2023/08/Homepage-default-preview.jpg)](https://www.prnewswire.com/news-releases/leeds-equity-partners-acquires-offsec-302275836.html?utm_source=offsec)
      [Buy now](/pre-registration/)  [Sign In](https://portal.offensive-security.com/sign-in/)    [Contact](/contact-us/)

* Solutions Learning Solutions            Learning Library Cyber workforce resilience and career development with hands-on, real-world training      Cyber Ranges Live-fire simulations to train your team and stay ahead of the latest threats         [Courses & Certifications

  Industry-leading certifications and training for continuous learning](https://www.offsec.com/courses-and-certifications)   [Learning Paths

  Focused training to develop skills based on a specific area of interest](https://www.offsec.com/learning/paths)   [Job Roles

  Rigorous training content and labs for the most critical and in-demand job roles](https://www.offsec.com/learning)   [Skills Development

  Focused training to develop critical cybersecurity skills](https://www.offsec.com/learning/skill-paths-pins)   [Industry Frameworks

  Framework-specific training for MITRE ATT&CK, D3FEND and NIST/NICE](https://www.offsec.com/learning/industry-frameworks)   [Explore Learning Library](https://portal.offsec.com/)     [New course

  IR-200: Foundational Incident Response

  IR-200 teaches the incident response lifecycle, including detection, analysis, containment, eradication and recovery. Learners develop hands-on skills responding to, communicating, and mitigating cyber attacks.

  ![IR-200: Foundational Incident Response](https://manage.offsec.com/app/uploads/2024/10/Course-IR-200.png)](https://www.offsec.com/courses/ir-200/)     [Enterprise Cyber Range & Versus

  Set up tournaments and test red and blue team skills in a live-fire cyber range](https://www.offsec.com/enterprise/cyber-range)   [Offensive Cyber Range

  Train on the latest attack vectors to address vulnerabilities](https://www.offsec.com/enterprise/cyber-range/offensive)   [Defensive Cyber Range

  Prepare for the next attack with simulated real-world training environments](https://www.offsec.com/enterprise/cyber-range/defensive)   [Watch a demo](https://learn.offsec.com/webinar-cyber-drills-versus/?utm_source=offsec)     [Exclusive

  Hands-on training in live-fire, enterprise environments

  Use our most powerful cyber range to develop a cyber resilient workforce

  ![Hands-on training in live-fire, enterprise environments](https://manage.offsec.com/app/uploads/2024/05/live_fire_feat.png)](https://www.offsec.com/enterprise/cyber-range/versus)
* Why OffSec            Organizations Continuous learning & skill development to build cyber workforce resilience      Individuals Get industry leading training and reinforce learning with hands-on labs         [Teams & Enterprises

  Continuous learning & hands-on skills development for cybersecurity teams](https://www.offsec.com/organizations/enterprise)   [Public Sector

  Unique training for government agencies and educational institutions](https://www.offsec.com/public-sector)   [Use Cases

  Meet critical cyber workforce needs with OffSec's learning platform](https://www.offsec.com/use-cases)   [Industries

  Purpose-built and industry-recognized cybersecurity training](https://www.offsec.com/industry)   [Contact sales](https://www.offsec.com/sales)     [Recommended

  Learn Enterprise

  Address your talent gap through continuous skills development and knowledge acquisition

  ![Learn Enterprise](https://manage.offsec.com/app/uploads/2024/05/le_feat_nav_icon.png)](https://www.offsec.com/products/learn-enterprise)     [Attain a Certification

  Prove critical knowledge & skills with an industry-standard certification](https://www.offsec.com/courses-and-certifications)   [Get Hands-on Practice

  Challenge yourself in real-world lab environments](https://www.offsec.com/labs/individual)   [Increase Career Prospects

  Ready yourself for the next step in your cybersecurity career](https://www.offsec.com/products)   [Buy now](https://www.offsec.com/register/)     [New course

  IR-200: Foundational Incident Response

  IR-200 teaches the incident response lifecycle, including detection, analysis, containment, eradication and recovery. Learners develop hands-on skills responding to, communicating, and mitigating cyber attacks.

  ![IR-200: Foundational Incident Response](https://manage.offsec.com/app/uploads/2024/10/Course-IR-200.png)](https://www.offsec.com/courses/ir-200/)
* Pricing Plans & Pricing            Organizations Flexible solutions designed for organizations across industries and sizes      Individuals Find the right training plan for your unique learning needs         [Subscription Pricing

  Provide continuous Learning Library access to build cyber workforce resilience](https://www.offsec.com/pricing/organization)   [Cyber Ranges

  Hands-on training in live-fire, simulation environments](https://www.offsec.com/labs/enterprise)   [Pentesting Services

  Let OffSec conduct a comprehensive vulnerability assessment](https://www.offsec.com/penetration-testing)   [Contact sales](https://www.offsec.com/sales)     [Recommended

  Learn Enterprise

  Provide continuous learning and skill development with Learn Enterprise. Access to the entire Learning Library and the Enterprise Cyber Range for everyone on your team.

  ![Learn Enterprise](https://manage.offsec.com/app/uploads/2024/05/le_feat_nav_icon.png)](https://www.offsec.com/products/learn-enterprise/)     [Pricing

  Flexible options based on your learning goals](https://www.offsec.com/pricing/individual)   [![Learn One](/_astro/one.CuIttstx_1iqdIc.svg)   Learn One

  12-month access to a single course, related labs, and two exam attempts](https://www.offsec.com/products/learn-one)   [![Course & Certification Bundle](/_astro/courses.DUpgYt2-_ZJbVTu.svg)   Course & Certification Bundle

  90-day access to a single course, related labs, and one exam attempt](https://www.offsec.com/products/90-day-bundle)   [![Learn Fundamentals](/_astro/fundamentals.iMOuAzP9_Z1YsvOA.svg)   Learn Fundamentals

  12-month access to introductory- and essential-level content](https://www.offsec.com/products/fundamentals)   [Proving Grounds Labs

  OffSec-curated private labs to practice and perfect your pentesting skills](https://www.offsec.com/labs/individual)   [Buy now](https://www.offsec.com/register/)     [New course

  IR-200: Foundational Incident Response

  IR-200 teaches the incident response lifecycle, including detection, analysis, containment, eradication and recovery. Learners develop hands-on skills responding to, communicating, and mitigating cyber attacks.

  ![IR-200: Foundational Incident Response](https://manage.offsec.com/app/uploads/2024/10/Course-IR-200.png)](https://www.offsec.com/courses/ir-200)
* Partners         [Global Partner Program](https://www.offsec.com/global-partners)   [Partner Portal Login](https://partnerportal.offsec.com/?utm_source=offsec#/page/login)   [Find a Partner](https://www.offsec.com/partner-locator)

  Become a Partner

  Add OffSec to your list of training providers

   [Partner with us](https://www.offsec.com/global-partners/#application)
* Community Kali & Community         [Join Our Community](https://www.offsec.com/community-sign-up)   [Kali Linux](http://www.kali.org/get-kali/?utm_source=offsec)   [Community Projects](https://www.offsec.com/community-projects)   [OffSec Discord](https://offs.ec/discord?utm_source=offsec)   [OffSec Live](https://www.twitch.tv/offsecofficial?utm_source=offsec)

  Connect with us

  OffSec office hours every Friday on Twitch

   [OffSec Twitch](https://www.twitch.tv/offsecofficial?utm_source=offsec)
* Resources
  + [Read](https://www.offsec.com/resources)
  - [Blog](https://www.offsec.com/blog/)
  - [Case Studies](https://www.offsec.com/resources/case-study)
  - [Guides](https://www.offsec.com/resources/guides)
  - [White Papers](https://www.offsec.com/resources/whitepaper)
  - [Product Updates](https://www.offsec.com/resources/product-updates)
  + Watch
  - [Webinars](https://www.offsec.com/webinars)
  - [Twitch](https://www.twitch.tv/offsecofficial?utm_source=offsec)
  - [YouTube](https://www.youtube.com/%40OffSecTraining?utm_source=offsec)
  + Learn
  - [Cyberversity](https://www.offsec.com/cyberversity)
  - [Cybersecurity Job Roles](https://www.offsec.com/cybersecurity-roles)
  + Work at OffSec
  - [Careers](https://www.offsec.com/careers)
  - [Values](https://www.offsec.com/values)
  + [Live Training & Events](https://www.offsec.com/training-and-events)
  + [Subscribe to our Newsletters](https://www.offsec.com/subscriptions)
  + [Press Room](https://www.offsec.com/press-room)
  + [Help Center](https://help.offsec.com/hc/en-us?utm_source=offsec)
  + [Swag Store](https://offsec.usa.dowlis.com/?utm_source=offsec)   [View the Resource Center](/resources/)        [Press Release

  Leeds Equity Partners Acquires OffSec

  Leeds Equity Partners announced that it has acquired OffSec, the leading provider of continuous cybersecurity workforce development training and professional education for cybersecurity practitioners from Spectrum Equity

  ![Leeds Equity Partners Acquires OffSec](https://manage.offsec.com/wp-content/uploads/2023/08/Homepage-default-preview.jpg)](https://www.prnewswire.com/news-releases/leeds-equity-partners-acquires-offsec-302275836.html?utm_source=offsec)
      [Buy now](/pre-registration/) [Sign in](https://portal.offensive-security.com/sign-in/)   [Contact us](/contact-us/)   Learning Solutions  Why OffSec  Plans & Pricing  Partners  Kali & Community  Resources       Dismiss

Looking for Live Training in 2025? -
[View upcoming classes](/training-and-events/)

# Elevating Cyber Workforce and Professional Development

Empowering individuals and organizations to fight cyber threats with indispensable cybersecurity skills and resources.

   [For individuals](/pricing/)  [For organizations](/organizations/enterprise/)
## Trusted by

      ![](/_astro/courses-honeycomb-2.BJsud3cm_AM0V4.svg)
## Learning with OffSec

Our learning platform and library include the most rigorous content, courses, learning paths
and hands-on labs

 [Explore our products](/products/)
## What you'll find in our Learning Library

### 7,800+

Hours of written content

### 1,600+

Videos

### 5,460

Labs

\*Data as of 1/24/2025

 [Watch demo](/resources/gated-content/le-ocr-demo/)
## Find OffSec training for your cybersecurity role or area of responsibility

![](/_astro/offensive.keLynG0W.svg)
### Offensive Security

Essentials

Intermediate

Advanced

   ![](/_astro/defensive.Cxk9T0J8.svg)
### Defensive Security

Essentials

Intermediate

Advanced

   ![](/_astro/secure.ZQsGZjKL.svg)
### Secure Development

Essentials

Intermediate

Advanced

   ![](/_astro/admin.2EArHmUa.svg)
### IT Team cybersecurity

Essentials

Intermediate

Entry-level

Essentials

Intermediate

Advanced

 [![](/_astro/sec-100.Cpi0-2Uw.svg)
### CyberCore

Gain core knowledge required for any cybersecurity role](/courses/sec-100/)       ![Offensive](/_astro/offensive.keLynG0W.svg)
### Offensive Security

Understand the attacker mindset

 ![Offensive](/_astro/offensive.keLynG0W.svg)
### Offensive Security

Develop hacking and pentesting skills

 ![Offensive](/_astro/offensive.keLynG0W.svg)
### Offensive Security

Expert protections across organizations

    ![Defensive](/_astro/defensive.Cxk9T0J8.svg)
### Defensive Security

Understand defensive requirements

 ![Defensive](/_astro/defensive.Cxk9T0J8.svg)
### Defensive Security

Develop mitigation procedures

 ![Defensive](/_astro/defensive.Cxk9T0J8.svg)
### Defensive Security

Proactive, resilient defenses

    ![Secure](/_astro/secure.ZQsGZjKL.svg)
### Secure Development

Learn risks and track security in development

 ![Secure](/_astro/secure.ZQsGZjKL.svg)
### Secure Development

Integrate security best practices into dev

 ![Secure](/_astro/secure.ZQsGZjKL.svg)
### Secure Development

Security first software development lifecycle

    ![Cybersecurity](/_astro/admin.2EArHmUa.svg)
### IT Team cybersecurity

Understand cybersecurity for IT and System Admins

 ![Cybersecurity](/_astro/admin.2EArHmUa.svg)
### IT Team cybersecurity

Develop secure processes

= Course Certification

= Learning Path Badge

## What cybersecurity professionals are saying

     ![Duane LaFlotte](/_astro/duane.CAyBZp_-.png)
### Duane LaFlotte

CTO, Pulsar Security

  I feel like every person's first experience in cybersecurity should be OffSec. Before you go out to figure out how to create a zero-day and you get confused, if you start with OffSec, that won't happen due to how methodologically all the training is put together.      ![Emile Kok](/_astro/emile.C3f2EqfQ.png)
### Emile Kok

Founder and Managing Director, TSTC Institute

  When going to the real world, you have to know what you're doing and understand what is expected from you on the job. For us, OffSec is the champion in this league in educating and preparing learners.      ![Douglas Costa](/_astro/douglas.BdxOPM2d.png)
### Douglas Costa

Cyber Threat Intelligence & Threat Hunter

  This certification reinforces my ability to think creatively, manage time and resources effectively, and persist through complex challenges.
## Cybersecurity talent management with OffSec

### Assess

#### Goal of this stage

Understand skills of candidates to pick the right person for open roles.

#### How OffSec can help

Build tournaments to assess candidates in real-world scenarios. Renowned certifications can be used to in the application process.

 [Check out Assessments](/enterprise/cyber-range/)

Assess

### Onboard

#### Goal of this stage

Train teams to get them up to speed for their new roles and build a foundation of shared knowledge across the team.

#### How OffSec can help

Entry-level courses ground teams in the OffSec mindset. Job role based learning paths & courses support specific roles get up to speed faster.

 [Explore the Library](https://portal.offsec.com)

Onboard

### Upskill

#### Goal of this stage

Identify skill gaps and train to fill those gaps to protect the organization.

#### How OffSec can help

Identify skill gaps with learning path assessments & Versus tournaments. Build custom learning paths for team members to get them the training they need to protect the organization.

 [Build a Custom Learning Path](https://learn.offsec.com/hubfs/Creating%20a%20custom%20path.mp4)

Upskill

### Retain

#### Goal of this stage

Build an engaging employee culture and career development plans that continue to challenge employees.

#### How OffSec can help

Build team camaraderie with Versus tournaments. Develop custom training for job roles & increase difficulty over time.

 [Try a Tournament](/enterprise/cyber-range/versus/)

Retain

## Our unique learning approach

#### Growth

Practicing creative applications leads to growth and knowledge expansion

#### Triumph

Create confidence, pattern recognition, wisdom and allow the cycle to repeat for new learnings

#### Trial

The trial process equips our learner to understand, learn, apply, analyze, synthesize and hypothesize

#### Failure

Failure is a key part of learning, how to get unstuck is a key skill. Grit is necessary to learn

#### Adaptation

Creative ideas and approaches will emerge through trial and failure

## What's new at OffSec

   [![](https://www.offsec.com/app/uploads/2025/01/ir-200-450x236.png)

Research & Tutorials

### My Journey with IR-200: Becoming an OffSec Certified Incident Responder (OSIR)

Embark on a journey to become an OffSec Certified Incident Responder (OSIR) through the IR-200 course, as described by a Student Mentor who tested its effectiveness.

Jan 24, 2025

6 min read](/blog/my-journey-with-ir-200-becoming-an-offsec-certified-incident-responder-osir/)   [![](https://www.offsec.com/app/uploads/2025/01/th-200-450x236.png)

Research & Tutorials

### A Student Mentorâs TH-200 and OSTH Learning Experience

Explore the TH-200 course & OSTH exam with an OffSec Mentor’s insights on mastering threat hunting skills.

Jan 24, 2025

9 min read](/blog/a-student-mentors-th-200-and-osth-learning-experience/)   [![](https://www.offsec.com/app/uploads/2024/12/EOY-2024-blog-post-header-450x236.jpg)

OffSec News

### OffSec Yearly Recap 2024

Join us as we explore all our successes in 2024, including exciting new content, courses, and so much more!

Dec 23, 2024

8 min read](/blog/offsec-yearly-recap-2024/)     [View all blogs](/blog/)
## Our free open-source tools

  [![Kali](/_astro/kali.CU8ZWzHb_21DCwb.svg)](https://kali.org)  [![Kali NetHunter](/_astro/KNH.Cqcp042z_Z1swOvJ.svg)](https://www.kali.org/docs/nethunter/)  [![Exploit Database](/_astro/EXDB.BZmZGyho_2oAweA.svg)](https://exploit-db.org)  [![Google hacking database](/_astro/GHDB.BMpIw1YW_kqYpF.svg)](https://www.exploit-db.com/google-hacking-database)  [![Metasploit Unleashed](/_astro/metasploit.CWelKEsw_Z1kLJ3A.svg)](https://www.offsec.com/metasploit-unleashed/)

Get the latest updates around resources, events & promotions from OffSec

 Submit        Products and Pricing

* [Courses & Content](https://www.offsec.com/courses-and-certifications/)
* [Learn Subscriptions](https://www.offsec.com/products/)
* [Proving Grounds Labs](https://www.offsec.com/labs/individual/)
* [Enterprise Cyber Range](https://www.offsec.com/enterprise/cyber-range/)
* [Pricing](https://www.offsec.com/pricing/)
 About OffSec

* [Contact Us](https://www.offsec.com/contact-us/)
* [Careers](https://www.offsec.com/careers/)
* [Why OffSec?](https://www.offsec.com/why-offsec/)
* [Values](https://www.offsec.com/values/)
* [Leadership Team](https://www.offsec.com/leadership-team/)
* [Bug Bounty Program](https://www.offsec.com/bug-bounty-program/)
* [User-Generated Content](https://www.offsec.com/labs/submit/)
 Resources

* [Resource Center](https://www.offsec.com/resources/)
* [Blog](https://www.offsec.com/blog/)
* [OffSec Cyberversity](https://www.offsec.com/cyberversity/)
* [Press Room](https://www.offsec.com/press-room/)
* [Join our Mailing List](https://www.offsec.com/subscriptions/)
* [Help Center](https://help.offensive-security.com/hc/en-us?utm_source=offsec)
* [Swag Store](https://offsec.usa.dowlis.com/?utm_source=offsec)

  [Feedback](https://www.offsec.com/contact-us/)[Legal](https://www.offsec.com/legal-docs/)[Trust & Compliance](https://trust.offsec.com/?utm_source=offsec)[RSS Feed](https://www.offsec.com/feed)  Â© OffSec Services Limited 2025 All rights reserved

=== Content from www.exploit-db.com_3d6704a3_20250125_083441.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Microsoft Windows 10 RS2 (x64) - 'win32kfull!bFill' Pool Overflow

#### EDB-ID:

###### 42960

#### CVE:

###### [2016-3309](https://nvd.nist.gov/vuln/detail/CVE-2016-3309)

---

**EDB Verified:**

#### Author:

###### [siberas](/?author=9107)

#### Type:

###### [local](/?type=local)

---

#### Platform:

###### [Windows\_x86-64](/?platform=windows_x86-64)

#### Date:

###### 2017-10-06

---

**Vulnerable App:**

```
Sources:
https://siberas.de/blog/2017/10/05/exploitation_case_study_wild_pool_overflow_CVE-2016-3309_reloaded.html
https://github.com/siberas/CVE-2016-3309_Reloaded

Exploits for the recently-patched win32kfull!bFill vulnerability. Executing the Palette or Bitmap exploit will give you SYSTEM privileges on the affected system. The exploits should work fine on Windows 10 x64 with Creators Update, build 15063.540 (latest version of Win10 before the release of Microsoft's September Updates).

The Visual Studio solution contains three exploits:

CVE-2016-3309_Reloaded_Bitmaps: Exploit using the Bitmaps technique
CVE-2016-3309_Reloaded_Palettes: Exploit using the Palettes technique
CVE-2016-3309_Reloaded_Deadlock: POC exploit showcasing the system deadlock which happens due to improved Handle validation

We also published a blog post (https://siberas.de/blog/2017/10/05/exploitation_case_study_wild_pool_overflow_CVE-2016-3309_reloaded.html) which goes into detail about the exploitation of this "wild" Pool-based overflow.

Proof of Concept:
https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/42960.zip

```

**Tags:**

**Advisory/Source:**
[Link](https://github.com/siberas/CVE-2016-3309_Reloaded)

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search



=== Content from docs.microsoft.com_48d59ab0_20250125_083440.html ===

[Skip to main content](#main)

This browser is no longer supported.

Upgrade to Microsoft Edge to take advantage of the latest features, security updates, and technical support.

[Download Microsoft Edge](https://go.microsoft.com/fwlink/p/?LinkID=2092881 )
[More info about Internet Explorer and Microsoft Edge](https://learn.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge)

Table of contents

Exit focus mode

Read in English

Save

Table of contentsRead in English

Save

Add to plan
[Edit](https://github.com/MicrosoftDocs/security-updates/blob/live/security-updates/SecurityBulletins/2016/ms16-098.md "Edit This Document")

---

#### Share via

Facebook
x.com
LinkedIn
Email

---

Print

Table of contents

# Microsoft Security Bulletin MS16-098 - Important

* Article
* 03/01/2023
* 5 contributors

Feedback

## In this article

## Security Update for Windows Kernel-Mode Drivers (3178466)

Published: August 9, 2016

**Version:** 1.0

## Executive Summary

This security update resolves vulnerabilities in Microsoft Windows. The vulnerabilities could allow elevation of privilege if an attacker logs on to an affected system and runs a specially crafted application that could exploit the vulnerabilities and take control of an affected system.

This security update is rated Important for all supported releases of Windows. For more information, see the **Affected Software and Vulnerability Severity Ratings** section.

The security update addresses the vulnerabilities by correcting how the Windows kernel-mode driver handles objects in memory. For more information about the vulnerabilities, see the **Vulnerability Information** section.

For more information about this update, see [Microsoft Knowledge Base Article 3178466](https://support.microsoft.com/kb/3178466).

## Affected Software and Vulnerability Severity Ratings

The following software versions or editions are affected. Versions or editions that are not listed are either past their support life cycle or are not affected. To determine the support life cycle for your software version or edition, see [Microsoft Support Lifecycle](https://go.microsoft.com/fwlink/?linkid=21742).

The following severity ratings assume the potential maximum impact of the vulnerability. For information regarding the likelihood, within 30 days of this security bulletin's release, of the exploitability of the vulnerability in relation to its severity rating and security impact, please see the Exploitability Index in the [August bulletin summary](https://technet.microsoft.com/library/security/ms16-aug).

| **Operating System** | [**Win32k Elevation of Privilege Vulnerability - CVE-2016-3308**](https://www.cve.org/CVERecord?id=CVE-2016-3308) | [**Win32k Elevation of Privilege Vulnerability - CVE-2016-3309**](https://www.cve.org/CVERecord?id=CVE-2016-3309) | [**Win32k Elevation of Privilege Vulnerability - CVE-2016-3310**](https://www.cve.org/CVERecord?id=CVE-2016-3310) | [**Win32k Elevation of Privilege Vulnerability - CVE-2016-3311**](https://www.cve.org/CVERecord?id=CVE-2016-3311) | **Updates Replaced**\* |
| --- | --- | --- | --- | --- | --- |
| **Windows Vista** |  |  |  |  |  |
| [Windows Vista Service Pack 2](https://www.microsoft.com/downloads/details.aspx?familyid=b91b3890-3b31-4705-b933-8b2c2b229c00) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows Vista x64 Edition Service Pack 2](https://www.microsoft.com/downloads/details.aspx?familyid=f3493ca3-8f49-47b4-9bc8-ab449d575608) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| **Windows Server 2008** |  |  |  |  |  |
| [Windows Server 2008 for 32-bit Systems Service Pack 2](https://www.microsoft.com/downloads/details.aspx?familyid=1de426db-0414-4176-888c-8c85b12c1041) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows Server 2008 for x64-based Systems Service Pack 2](https://www.microsoft.com/downloads/details.aspx?familyid=5db2a573-3e75-4953-9b1e-77be3524e628) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows Server 2008 for Itanium-based Systems Service Pack 2](https://www.microsoft.com/downloads/details.aspx?familyid=c585e531-f17a-4784-bffc-144adc56a053) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| **Windows 7** |  |  |  |  |  |
| [Windows 7 for 32-bit Systems Service Pack 1](https://www.microsoft.com/downloads/details.aspx?familyid=30cee182-f59d-4ca7-a36e-dc71dadb819f) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows 7 for x64-based Systems Service Pack 1](https://www.microsoft.com/downloads/details.aspx?familyid=db3970bb-eea8-4efb-8d05-da92701560d7) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| **Windows Server 2008 R2** |  |  |  |  |  |
| [Windows Server 2008 R2 for x64-based Systems Service Pack 1](https://www.microsoft.com/downloads/details.aspx?familyid=63283b10-0c1f-4085-81e9-578be2078547) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows Server 2008 R2 for Itanium-based Systems Service Pack 1](https://www.microsoft.com/downloads/details.aspx?familyid=9e67becf-3bcd-4759-aa51-80a0617441cc) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| **Windows 8.1** |  |  |  |  |  |
| [Windows 8.1 for 32-bit Systems](https://www.microsoft.com/downloads/details.aspx?familyid=0418cd94-c130-4c95-aaae-9e389e9447c3) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows 8.1 for x64-based Systems](https://www.microsoft.com/downloads/details.aspx?familyid=d61a0c64-d2c7-4f1e-8f19-30181bc2a7bb) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| **Windows Server 2012 and Windows Server 2012 R2** |  |  |  |  |  |
| [Windows Server 2012](https://www.microsoft.com/downloads/details.aspx?familyid=621ac545-d583-4f64-addc-0dc34569cd5a) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows Server 2012 R2](https://www.microsoft.com/downloads/details.aspx?familyid=81e7cc19-285d-4a5c-b600-7d3b5d6bc8fe) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| **Windows RT 8.1** |  |  |  |  |  |
| Windows RT 8.1[1](3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| **Windows 10** |  |  |  |  |  |
| [Windows 10 for 32-bit Systems](https://support.microsoft.com/kb/3176492)[2](3176492) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | [3163912](https://support.microsoft.com/kb/3163912) |
| [Windows 10 for x64-based Systems](https://support.microsoft.com/kb/3176492)[2](3176492) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | [3163912](https://support.microsoft.com/kb/3163912) |
| [Windows 10 Version 1511 for 32-bit Systems](https://support.microsoft.com/kb/3176493)[2](3176493) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | [3172985](https://support.microsoft.com/kb/3172985) |
| [Windows 10 Version 1511 for x64-based Systems](https://support.microsoft.com/kb/3176493)[2](3176493) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | [3172985](https://support.microsoft.com/kb/3172985) |
| [Windows 10 Version 1607 for 32-bit Systems](https://support.microsoft.com/kb/3176495)[2](3176495) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | None |
| [Windows 10 Version 1607 for x64-based Systems](https://support.microsoft.com/kb/3176495)[2](3176495) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | None |
| **Server Core installation option** |  |  |  |  |  |
| [Windows Server 2008 for 32-bit Systems Service Pack 2](https://www.microsoft.com/downloads/details.aspx?familyid=1de426db-0414-4176-888c-8c85b12c1041) (Server Core installation) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows Server 2008 for x64-based Systems Service Pack 2](https://www.microsoft.com/downloads/details.aspx?familyid=5db2a573-3e75-4953-9b1e-77be3524e628) (Server Core installation) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows Server 2008 R2 for x64-based Systems Service Pack 1](https://www.microsoft.com/downloads/details.aspx?familyid=63283b10-0c1f-4085-81e9-578be2078547) (Server Core installation) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows Server 2012](https://www.microsoft.com/downloads/details.aspx?familyid=621ac545-d583-4f64-addc-0dc34569cd5a) (Server Core installation) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |
| [Windows Server 2012 R2](https://www.microsoft.com/downloads/details.aspx?familyid=81e7cc19-285d-4a5c-b600-7d3b5d6bc8fe) (Server Core installation) (3177725) | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | **Important**  Elevation of Privilege | 3168965 in [MS16-090](https://go.microsoft.com/fwlink/?linkid=808590) |

[1]This update is only available via [Windows Update](https://go.microsoft.com/fwlink/?linkid=21130).

[2]Windows 10 updates are cumulative. The monthly security release includes all security fixes for vulnerabilities that affect Windows 10, in addition to non-security updates. The updates are available via the [Microsoft Update Catalog](https://catalog.update.microsoft.com/v7/site/home.aspx).

**Note** The vulnerabilities discussed in this bulletin affect Windows Server 2016 Technical Preview 5. To be protected from the vulnerabilities, Microsoft recommends that customers running this operating system apply the current update, which is available from [Windows Update](https://go.microsoft.com/fwlink/?linkid=21130).

\*The Updates Replaced column shows only the latest update in any chain of superseded updates. For a comprehensive list of updates replaced, go to the [Microsoft Update Catalog](https://catalog.update.microsoft.com/v7/site/home.aspx), search for the update KB number, and then view update details (updates replaced information is provided on the Package Details tab).

## Vulnerability Information

## Multiple Win32k Elevation of Privilege Vulnerabilities

Multiple elevation of privilege vulnerabilities exist when the Windows kernel-mode driver fails to properly handle objects in memory. An attacker who successfully exploited these vulnerabilities could run arbitrary code in kernel mode. An attacker could then install programs; view, change, or delete data; or create new accounts with full user rights.

To exploit these vulnerabilities, an attacker would first have to log on to the system. An attacker could then run a specially crafted application to take control of an affected system. The update addresses the vulnerabilities by correcting how the Windows kernel-mode driver handles objects in memory.

The following table contains links to the standard entry for each vulnerability in the Common Vulnerabilities and Exposures list:

| **Vulnerability title** | **CVE number** | **Publicly disclosed** | **Exploited** |
| --- | --- | --- | --- |
| Win32k Elevation of Privilege Vulnerability | [CVE-2016-3308](https://www.cve.org/CVERecord?id=CVE-2016-3308) | No | No |
| Win32k Elevation of Privilege Vulnerability | [CVE-2016-3309](https://www.cve.org/CVERecord?id=CVE-2016-3309) | No | No |
| Win32k Elevation of Privilege Vulnerability | [CVE-2016-3310](https://www.cve.org/CVERecord?id=CVE-2016-3310) | No | No |
| Win32k Elevation of Privilege Vulnerability | [CVE-2016-3311](https://www.cve.org/CVERecord?id=CVE-2016-3311) | No | No |

### Mitigating Factors

Microsoft has not identified any [mitigating factors](https://technet.microsoft.com/library/security/dn848375.aspx) for these vulnerabilities.

### Workarounds

Microsoft has not identified any [workarounds](https://technet.microsoft.com/library/security/dn848375.aspx) for these vulnerabilities.

## Security Update Deployment

For Security Update Deployment information, see the Microsoft Knowledge Base article referenced in the Executive Summary.

## Acknowledgments

Microsoft recognizes the efforts of those in the security community who help us protect customers through coordinated vulnerability disclosure. See [Acknowledgments](https://technet.microsoft.com/library/security/mt674627.aspx) for more information.

## Disclaimer

The information provided in the Microsoft Knowledge Base is provided "as is" without warranty of any kind. Microsoft disclaims all warranties, either express or implied, including the warranties of merchantability and fitness for a particular purpose. In no event shall Microsoft Corporation or its suppliers be liable for any damages whatsoever including direct, indirect, incidental, consequential, loss of business profits or special damages, even if Microsoft Corporation or its suppliers have been advised of the possibility of such damages. Some states do not allow the exclusion or limitation of liability for consequential or incidental damages so the foregoing limitation may not apply.

## Revisions

* V1.0 (August 9, 2016): Bulletin published.

*Page generated 2016-08-03 10:48-07:00.*

---

## Additional resources

[California Consumer Privacy Act (CCPA) Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

Theme

* Light
* Dark
* High contrast

* [Previous Versions](/en-us/previous-versions/)
* [Blog](https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog)
* [Contribute](/en-us/contribute/)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* [Terms of Use](/en-us/legal/termsofuse)
* [Trademarks](https://www.microsoft.com/legal/intellectualproperty/Trademarks/)
* © Microsoft 2025
## Additional resources

### In this article

[California Consumer Privacy Act (CCPA) Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

Theme

* Light
* Dark
* High contrast

* [Previous Versions](/en-us/previous-versions/)
* [Blog](https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog)
* [Contribute](/en-us/contribute/)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* [Terms of Use](/en-us/legal/termsofuse)
* [Trademarks](https://www.microsoft.com/legal/intellectualproperty/Trademarks/)
* © Microsoft 2025



=== Content from github.com_4e1a8934_20250126_073447.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsiberas%2FCVE-2016-3309_Reloaded)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsiberas%2FCVE-2016-3309_Reloaded)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=siberas%2FCVE-2016-3309_Reloaded)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[siberas](/siberas)
/
**[CVE-2016-3309\_Reloaded](/siberas/CVE-2016-3309_Reloaded)**
Public

* [Notifications](/login?return_to=%2Fsiberas%2FCVE-2016-3309_Reloaded) You must be signed in to change notification settings
* [Fork
  21](/login?return_to=%2Fsiberas%2FCVE-2016-3309_Reloaded)
* [Star
   54](/login?return_to=%2Fsiberas%2FCVE-2016-3309_Reloaded)

Exploits for the win32kfull!bFill vulnerability on Win10 x64 RS2 using Bitmap or Palette techniques

[54
stars](/siberas/CVE-2016-3309_Reloaded/stargazers) [21
forks](/siberas/CVE-2016-3309_Reloaded/forks) [Branches](/siberas/CVE-2016-3309_Reloaded/branches) [Tags](/siberas/CVE-2016-3309_Reloaded/tags) [Activity](/siberas/CVE-2016-3309_Reloaded/activity)
 [Star](/login?return_to=%2Fsiberas%2FCVE-2016-3309_Reloaded)

 [Notifications](/login?return_to=%2Fsiberas%2FCVE-2016-3309_Reloaded) You must be signed in to change notification settings

* [Code](/siberas/CVE-2016-3309_Reloaded)
* [Issues
  0](/siberas/CVE-2016-3309_Reloaded/issues)
* [Pull requests
  0](/siberas/CVE-2016-3309_Reloaded/pulls)
* [Actions](/siberas/CVE-2016-3309_Reloaded/actions)
* [Projects
  0](/siberas/CVE-2016-3309_Reloaded/projects)
* [Security](/siberas/CVE-2016-3309_Reloaded/security)
* [Insights](/siberas/CVE-2016-3309_Reloaded/pulse)

Additional navigation options

* [Code](/siberas/CVE-2016-3309_Reloaded)
* [Issues](/siberas/CVE-2016-3309_Reloaded/issues)
* [Pull requests](/siberas/CVE-2016-3309_Reloaded/pulls)
* [Actions](/siberas/CVE-2016-3309_Reloaded/actions)
* [Projects](/siberas/CVE-2016-3309_Reloaded/projects)
* [Security](/siberas/CVE-2016-3309_Reloaded/security)
* [Insights](/siberas/CVE-2016-3309_Reloaded/pulse)

# siberas/CVE-2016-3309\_Reloaded

    master[Branches](/siberas/CVE-2016-3309_Reloaded/branches)[Tags](/siberas/CVE-2016-3309_Reloaded/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[4 Commits](/siberas/CVE-2016-3309_Reloaded/commits/master/) | | |
| [CVE-2016-3309\_Reloaded\_Bitmaps](/siberas/CVE-2016-3309_Reloaded/tree/master/CVE-2016-3309_Reloaded_Bitmaps "CVE-2016-3309_Reloaded_Bitmaps") | | [CVE-2016-3309\_Reloaded\_Bitmaps](/siberas/CVE-2016-3309_Reloaded/tree/master/CVE-2016-3309_Reloaded_Bitmaps "CVE-2016-3309_Reloaded_Bitmaps") |  |  |
| [CVE-2016-3309\_Reloaded\_Deadlock](/siberas/CVE-2016-3309_Reloaded/tree/master/CVE-2016-3309_Reloaded_Deadlock "CVE-2016-3309_Reloaded_Deadlock") | | [CVE-2016-3309\_Reloaded\_Deadlock](/siberas/CVE-2016-3309_Reloaded/tree/master/CVE-2016-3309_Reloaded_Deadlock "CVE-2016-3309_Reloaded_Deadlock") |  |  |
| [CVE-2016-3309\_Reloaded\_Palettes](/siberas/CVE-2016-3309_Reloaded/tree/master/CVE-2016-3309_Reloaded_Palettes "CVE-2016-3309_Reloaded_Palettes") | | [CVE-2016-3309\_Reloaded\_Palettes](/siberas/CVE-2016-3309_Reloaded/tree/master/CVE-2016-3309_Reloaded_Palettes "CVE-2016-3309_Reloaded_Palettes") |  |  |
| [CVE-2016-3309\_Reloaded.sln](/siberas/CVE-2016-3309_Reloaded/blob/master/CVE-2016-3309_Reloaded.sln "CVE-2016-3309_Reloaded.sln") | | [CVE-2016-3309\_Reloaded.sln](/siberas/CVE-2016-3309_Reloaded/blob/master/CVE-2016-3309_Reloaded.sln "CVE-2016-3309_Reloaded.sln") |  |  |
| [CVE-2016-3309\_Reloaded.suo](/siberas/CVE-2016-3309_Reloaded/blob/master/CVE-2016-3309_Reloaded.suo "CVE-2016-3309_Reloaded.suo") | | [CVE-2016-3309\_Reloaded.suo](/siberas/CVE-2016-3309_Reloaded/blob/master/CVE-2016-3309_Reloaded.suo "CVE-2016-3309_Reloaded.suo") |  |  |
| [README.md](/siberas/CVE-2016-3309_Reloaded/blob/master/README.md "README.md") | | [README.md](/siberas/CVE-2016-3309_Reloaded/blob/master/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README
## Kernel Exploitation Case Study - "Wild" Pool Overflow on Win10 x64 RS2 (CVE-2016-3309 Reloaded)

This Github repo contains exploits for the recently-patched win32kfull!bFill vulnerability. Executing the Palette or Bitmap exploit will give you SYSTEM privileges on the affected system. The exploits should work fine on Windows 10 x64 with Creators Update, build 15063.540 (latest version of Win10 before the release of Microsoft's September Updates).

The Visual Studio solution contains three exploits:

* CVE-2016-3309\_Reloaded\_Bitmaps: Exploit using the Bitmaps technique
* CVE-2016-3309\_Reloaded\_Palettes: Exploit using the Palettes technique
* CVE-2016-3309\_Reloaded\_Deadlock: POC exploit showcasing the system deadlock which happens due to improved Handle validation

We also published a [blog post](https://siberas.de/blog/2017/10/05/exploitation_case_study_wild_pool_overflow_CVE-2016-3309_reloaded.html) which goes into detail about the exploitation of this "wild" Pool-based overflow.

## About

Exploits for the win32kfull!bFill vulnerability on Win10 x64 RS2 using Bitmap or Palette techniques

### Resources

[Readme](#readme-ov-file)

[Activity](/siberas/CVE-2016-3309_Reloaded/activity)
### Stars

[**54**
stars](/siberas/CVE-2016-3309_Reloaded/stargazers)
### Watchers

[**5**
watching](/siberas/CVE-2016-3309_Reloaded/watchers)
### Forks

[**21**
forks](/siberas/CVE-2016-3309_Reloaded/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fsiberas%2FCVE-2016-3309_Reloaded&report=siberas+%28user%29)

## [Releases](/siberas/CVE-2016-3309_Reloaded/releases)

No releases published

## [Packages 0](/users/siberas/packages?repo_name=CVE-2016-3309_Reloaded)

No packages published

## Languages

* [C++
  100.0%](/siberas/CVE-2016-3309_Reloaded/search?l=c%2B%2B)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


