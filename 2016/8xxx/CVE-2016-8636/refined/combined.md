=== Content from git.kernel.org_63bebf93_20250124_230807.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=647bf3d8a8e5777319da92af672289b2a6c4dc66)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=647bf3d8a8e5777319da92af672289b2a6c4dc66)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=647bf3d8a8e5777319da92af672289b2a6c4dc66)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=647bf3d8a8e5777319da92af672289b2a6c4dc66)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eyal Itkin <eyal.itkin@gmail.com> | 2017-02-07 16:45:19 +0300 |
| --- | --- | --- |
| committer | Doug Ledford <dledford@redhat.com> | 2017-02-08 12:28:30 -0500 |
| commit | [647bf3d8a8e5777319da92af672289b2a6c4dc66](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=647bf3d8a8e5777319da92af672289b2a6c4dc66) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=647bf3d8a8e5777319da92af672289b2a6c4dc66)) | |
| tree | [8d9a8e7885ba0e86ef6d52b1feffb3b698fc42ba](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=647bf3d8a8e5777319da92af672289b2a6c4dc66) | |
| parent | [628f07d33c1f2e7bf31e0a4a988bb07914bd5e73](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=628f07d33c1f2e7bf31e0a4a988bb07914bd5e73) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=647bf3d8a8e5777319da92af672289b2a6c4dc66&id2=628f07d33c1f2e7bf31e0a4a988bb07914bd5e73)) | |
| download | [linux-647bf3d8a8e5777319da92af672289b2a6c4dc66.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-647bf3d8a8e5777319da92af672289b2a6c4dc66.tar.gz) | |

IB/rxe: Fix mem\_check\_range integer overflowUpdate the range check to avoid integer-overflow in edge case.
Resolves CVE 2016-8636.
Signed-off-by: Eyal Itkin <eyal.itkin@gmail.com>
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Reviewed-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Doug Ledford <dledford@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=647bf3d8a8e5777319da92af672289b2a6c4dc66)

| -rw-r--r-- | [drivers/infiniband/sw/rxe/rxe\_mr.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/infiniband/sw/rxe/rxe_mr.c?id=647bf3d8a8e5777319da92af672289b2a6c4dc66) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 3 deletions

| diff --git a/drivers/infiniband/sw/rxe/rxe\_mr.c b/drivers/infiniband/sw/rxe/rxe\_mr.cindex d0faca294006f4..86a6585b847df9 100644--- a/[drivers/infiniband/sw/rxe/rxe\_mr.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/infiniband/sw/rxe/rxe_mr.c?id=628f07d33c1f2e7bf31e0a4a988bb07914bd5e73)+++ b/[drivers/infiniband/sw/rxe/rxe\_mr.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/infiniband/sw/rxe/rxe_mr.c?id=647bf3d8a8e5777319da92af672289b2a6c4dc66)@@ -59,9 +59,11 @@ int mem\_check\_range(struct rxe\_mem \*mem, u64 iova, size\_t length)  case RXE\_MEM\_TYPE\_MR: case RXE\_MEM\_TYPE\_FMR:- return ((iova < mem->iova) ||- ((iova + length) > (mem->iova + mem->length))) ?- -EFAULT : 0;+ if (iova < mem->iova ||+ length > mem->length ||+ iova > mem->iova + mem->length - length)+ return -EFAULT;+ return 0;  default: return -EFAULT; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 23:06:44 +0000



=== Content from eyalitkin.wordpress.com_ed89c6f0_20250124_230813.html ===

[Skip to content](#content)
[![](https://eyalitkin.wordpress.com/wp-content/uploads/2017/09/cropped-white-hat-300x225.jpg?w=226)](https://eyalitkin.wordpress.com/)

[Eyal Itkin](https://eyalitkin.wordpress.com/)

white hat security blog

Menu

* [Home](/)
* [About](https://eyalitkin.wordpress.com/about/)
* [Contact](https://eyalitkin.wordpress.com/contact/)

* [Twitter](https://twitter.com/)
* [Facebook](https://www.facebook.com/)
* [Google+](http://plus.google.com)
* [GitHub](http://github.com)
* [WordPress.com](http://wordpress.com)

# CVE Publication: CVE 2016-8636

After a long patching process, CVE 2016-8636 was now fixed and can be publicly disclosed. CVE 2016-8636 is caused by a classic integer-overflow vulnerability, showing that even the linux kernel suffers from this major vulnerability family.

## Background

During the end of October 16, I searched for vulnerabilities in the drivers of the kernel, and decided to take a look over the famous RDMA technology. I went to the software implementation of the RDMA protocol over infiniband, also called (Soft RoCE):

`drivers\infiniband\sw\rxe`

Since the main concern was to check the software bounds checking over the incoming read/write requests the flow converged rather quickly to the vulnerable area: `mem_check_range`.

## The Vulnerability

After we identify the matching iov for the current request, there is this following check to ensure the request falls inside the pre-allocated memory region:

```

int mem_check_range(struct rxe_mem *mem, u64 iova, size_t length)
{
  switch (mem->type) {
  // EI: no checks on the DMA regions - used only for local write... [22/10/2016]
  case RXE_MEM_TYPE_DMA:
    return 0;
  case RXE_MEM_TYPE_MR:
  case RXE_MEM_TYPE_FMR:
    // EI [FIX]: should fix this check to be:
    // EI      : ((iova   < mem->iova)   ||
    // EI      :  (length > mem->length) ||
    // EI      :  (iova   > (mem->iova + mem->length - length))) [22/10/2016]
    return ((iova < mem->iova) ||
           ((iova + length) > (mem->iova + mem->length))) ?
           -EFAULT : 0;

  default:
    return -EFAULT;
  }
}

```

As we can see, the check has a classic integer-overflow in it, since we combine several checked variables together into a single check:

* iova – address is checked to start in/after the allocated region
* iova + length – end\* is checked to fall in/before the allocated region

Since length is unsigned it is ASSUMED that iova <= iova + length. However, since length was NOT checked prior to this check, it can be a huge unsigned value causing the addition to wrap-around, thus **breaking** the code’s assumption.

### Possible damage

This later enables any such read/write request to work on an undefined memory region dependent on the internal data-structure that holds the chain of iov’s in the kernel’s memory – memory corruption (Write) and leakage (Read).

## Proposed fix

As we can see in my code comment, and in the [actual patch](https://github.com/torvalds/linux/commit/647bf3d8a8e5777319da92af672289b2a6c4dc66) I committed to the kernel, the fix is to check each variable on it’s own:

* iova – address is checked to start in/after the allocated region
* length – length is checked to match (<=) the region’s capacity
* start – iova is checked to be in the remaining gap:

[mem->iova, mem->iova + mem->length – length]

The key factor is to check the variable itself, without interfering with arithmetic operation that might damage the checked term.

## Conclusion

CVE 2016-8636 is a classic example for an integer-overflow in bounds checks. This family of vulnerabilities is responsible for a dominant part of the overall vulnerabilities in C/C++ code, and will be discussed in more details in a future post.

### Share this:

* [Twitter](https://eyalitkin.wordpress.com/2017/02/11/cve-publication-cve-2016-8636/?share=twitter "Click to share on Twitter")
* [Facebook](https://eyalitkin.wordpress.com/2017/02/11/cve-publication-cve-2016-8636/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

![](https://1.gravatar.com/avatar/47b1067875dedcd52f49e7289241edc64b00e8bf2c9ca9579363f5f513f722d2?s=42&d=identicon&r=G)
## Author: Eyal Itkin

Former white hat security researcher. [View all posts by Eyal Itkin](https://eyalitkin.wordpress.com/author/eyalitki/)

![](https://1.gravatar.com/avatar/47b1067875dedcd52f49e7289241edc64b00e8bf2c9ca9579363f5f513f722d2?s=49&d=identicon&r=G)Author  [Eyal Itkin](https://eyalitkin.wordpress.com/author/eyalitki/)Posted on [February 11, 2017February 11, 2017](https://eyalitkin.wordpress.com/2017/02/11/cve-publication-cve-2016-8636/)Categories [Integer Overflow](https://eyalitkin.wordpress.com/category/integer-overflow/), [Public Disclosure](https://eyalitkin.wordpress.com/category/public-disclosure/)Tags [CVE](https://eyalitkin.wordpress.com/tag/cve/), [disclosure](https://eyalitkin.wordpress.com/tag/disclosure/), [infiniband](https://eyalitkin.wordpress.com/tag/infiniband/), [Integer Overflow](https://eyalitkin.wordpress.com/tag/integer-overflow/), [linux](https://eyalitkin.wordpress.com/tag/linux/), [networking](https://eyalitkin.wordpress.com/tag/networking/), [Soft RoCE](https://eyalitkin.wordpress.com/tag/soft-roce/), [vulnerability](https://eyalitkin.wordpress.com/tag/vulnerability/)

## Leave a comment [Cancel reply](/2017/02/11/cve-publication-cve-2016-8636/#respond)

Δ

## Post navigation

[Previous Previous post: Liberation Guard – CFG Enhancement](https://eyalitkin.wordpress.com/2017/01/06/liberation-guard-cfg-enhancement/)[Next Next post: Integer Exceptions](https://eyalitkin.wordpress.com/2017/02/24/integer-exceptions/)

## Recent Posts

* [Reflections on InfoSec and the Development World – FreeRDP as a Case Study](https://eyalitkin.wordpress.com/2024/01/01/reflections-on-infosec-and-the-development-world-freerdp-as-a-case-study/)
  January 1, 2024
* [Lessons from Securing FreeRDP](https://eyalitkin.wordpress.com/2024/01/01/lessons-from-securing-freerdp/)
  January 1, 2024
* [CPR Publications](https://eyalitkin.wordpress.com/2020/05/24/cpr-publications/)
  May 24, 2020
* [Blog Updates](https://eyalitkin.wordpress.com/2018/05/18/blog-updates/)
  May 18, 2018
* [ELF caves: hiding in the corner](https://eyalitkin.wordpress.com/2018/02/02/elf-caves-hiding-in-the-corner/)
  February 2, 2018

Search for:

Search

* [Home](/)
* [About](https://eyalitkin.wordpress.com/about/)
* [Contact](https://eyalitkin.wordpress.com/contact/)

* [Twitter](https://twitter.com/)
* [Facebook](https://www.facebook.com/)
* [Google+](http://plus.google.com)
* [GitHub](http://github.com)
* [WordPress.com](http://wordpress.com)

[Eyal Itkin](https://eyalitkin.wordpress.com/)
[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

* [Comment](https://eyalitkin.wordpress.com/2017/02/11/cve-publication-cve-2016-8636/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://eyalitkin.wordpress.com/wp-content/uploads/2017/09/cropped-white-hat-300x225.jpg?w=50) Eyal Itkin](https://eyalitkin.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Feyalitkin.wordpress.com%2F2017%2F02%2F11%2Fcve-publication-cve-2016-8636%2F&signup_flow=account)
* Privacy
* + [![](https://eyalitkin.wordpress.com/wp-content/uploads/2017/09/cropped-white-hat-300x225.jpg?w=50) Eyal Itkin](https://eyalitkin.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Feyalitkin.wordpress.com%2F2017%2F02%2F11%2Fcve-publication-cve-2016-8636%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/p7ZO7B-gf)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://eyalitkin.wordpress.com/2017/02/11/cve-publication-cve-2016-8636/)
  + [View post in Reader](https://wordpress.com/read/blogs/118165031/posts/1007)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

%d

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)



=== Content from bugzilla.redhat.com_b82b0cc6_20250124_230812.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1421981)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1421981)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1421981)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1421981

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1421981**](show_bug.cgi?id=1421981)
(CVE-2016-8636)
- [CVE-2016-8636](https://access.redhat.com/security/cve/CVE-2016-8636) kernel: Integer overflow in the RDMA over infiniband software implementation

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2016-8636 kernel: Integer overflow in the RDMA over infiniband software i...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2016-8636 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=1421981&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1421981&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2017-02-14 09:22 UTC by Andrej Nemec | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-17 02:35 UTC ([History](show_activity.cgi?id=1421981)) | | [CC List:](page.cgi?id=fields.html#cclist) | 32 users (show)  agordeev aquini bhu dhoward esammons fhrbata gansalmon iboverma ichavero itamar jforbes jkacur jkastner jonathan jross jwboyer kernel-maint kernel-mgr labbott lgoncalv lwang madhu.chinakonda matt mchehab mcressma mguzik nmurray pholasek plougher rt-maint rvrbovsk williams | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2017-02-14 09:24:20 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1421981#c0)  Andrej Nemec    2017-02-14 09:22:35 UTC  ```  An integer overflow vulnerability was found in the Linux kernel in the software implementation of the RDMA protocol over infiniband.  References:  <http://seclists.org/oss-sec/2017/q1/404> <https://eyalitkin.wordpress.com/2017/02/11/cve-publication-cve-2016-8636/>  Upstream patch:  <https://github.com/torvalds/linux/commit/647bf3d8a8e5777319da92af672289b2a6c4dc66>   ```  [Comment 1](show_bug.cgi?id=1421981#c1)  Andrej Nemec    2017-02-14 09:24:20 UTC  ``` Statement:  This issue did not affect the versions of the Linux kernel as shipped with Red Hat Enterprise Linux as they did not include the software implementation of the RDMA protocol over infiniband.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1421981&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from www.openwall.com_4f9234ad_20250124_230810.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](8) [[next>]](10) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAA=iMULG2UP6XV7voESqSE3gVOxvb4z+uYL_GoqLdETyVFpWcg@mail.gmail.com>
Date: Sat, 11 Feb 2017 11:50:40 +0200
From: Eyal Itkin <eyal.itkin@...il.com>
To: oss-security@...ts.openwall.com
Subject: CVE publication request - CVE 2016-8636

Hello,

The security patch was deployed 3 days ago in the official git repository
of linux, after the fix was reviewed and approved by me.
Therefore, CVE 2016-8636 can now be publicly disclosed.

Commit id of the mainline merge:
   647bf3d8a8e5777319da92af672289b2a6c4dc66

<https://github.com/torvalds/linux/commit/647bf3d8a8e5777319da92af672289b2a6c4dc66>

Public disclosure details in my security blog:

<https://eyalitkin.wordpress.com/2017/02/11/cve-publication-cve-2016-8636/>

P.S. The CVE id was received from the security team of ubuntu, which
directed me to publicly disclose it with the oss-security mailing list.

Thanks for your help,
Eyal Itkin.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.kernel.org_d6a3ef39_20250124_230809.html ===
commit 390caeedd4fdb95b2225768305d163c291f21b5a
Author: Greg Kroah-Hartman
Date: Tue Feb 14 15:26:10 2017 -0800
Linux 4.9.10
commit e5c2e51470c2aadaf53a17acb677bb95529ac4d1
Author: Peter Zijlstra
Date: Tue Jan 31 11:27:10 2017 +0100
perf/core: Fix crash in perf\_event\_read()
commit 451d24d1e5f40bad000fa9abe36ddb16fc9928cb upstream.
Alexei had his box explode because doing read() on a package
(rapl/uncore) event that isn't currently scheduled in ends up doing an
out-of-bounds load.
Rework the code to more explicitly deal with event->oncpu being -1.
Reported-by: Alexei Starovoitov
Tested-by: Alexei Starovoitov
Tested-by: David Carrillo-Cisneros
Signed-off-by: Peter Zijlstra (Intel)
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: eranian@google.com
Fixes: d6a2f9035bfc ("perf/core: Introduce PMU\_EV\_CAP\_READ\_ACTIVE\_PKG")
Link: http://lkml.kernel.org/r/20170131102710.GL6515@twins.programming.kicks-ass.net
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit de65c300c7f0d1e18f5a92ea7a6c1cc9a0734202
Author: Namhyung Kim
Date: Wed Jan 18 14:14:56 2017 +0900
perf diff: Fix segfault on 'perf diff -o N' option
commit 8381cdd0e32dd748bd34ca3ace476949948bd793 upstream.
The -o/--order option is to select column number to sort a diff result.
It does the job by adding a hpp field at the beginning of the sort list.
But it should not be added to the output field list as it has no
callbacks required by a output field.
During the setup\_sorting(), the perf\_hpp\_\_setup\_output\_field() appends
the given sort keys to the output field if it's not there already.
Originally it was checked by fmt->list being non-empty. But commit
3f931f2c4274 ("perf hists: Make hpp setup function generic") changed it
to check the ->equal callback.
Anyways, we don't need to add the pseudo hpp field to the output field
list since it won't be used for output. So just skip fields if they
have no ->color or ->entry callbacks.
Signed-off-by: Namhyung Kim
Acked-by: Jiri Olsa
Cc: Peter Zijlstra
Fixes: 3f931f2c4274 ("perf hists: Make hpp setup function generic")
Link: http://lkml.kernel.org/r/20170118051457.30946-1-namhyung@kernel.org
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Greg Kroah-Hartman
commit 85df621b18e2f20731a1a6eb4defd8b704487064
Author: Namhyung Kim
Date: Wed Jan 18 14:14:57 2017 +0900
perf diff: Fix -o/--order option behavior (again)
commit a1c9f97f0b64e6337d9cfcc08c134450934fdd90 upstream.
Commit 21e6d8428664 ("perf diff: Use perf\_hpp\_\_register\_sort\_field
interface") changed list\_add() to perf\_hpp\_\_register\_sort\_field().
This resulted in a behavior change since the field was added to the tail
instead of the head. So the -o option is mostly ignored due to its
order in the list.
This patch fixes it by adding perf\_hpp\_\_prepend\_sort\_field().
Signed-off-by: Namhyung Kim
Acked-by: Jiri Olsa
Cc: Peter Zijlstra
Fixes: 21e6d8428664 ("perf diff: Use perf\_hpp\_\_register\_sort\_field interface")
Link: http://lkml.kernel.org/r/20170118051457.30946-2-namhyung@kernel.org
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Greg Kroah-Hartman
commit 6b4af0dab8934b046776a65fdd6e91658f500060
Author: Omar Sandoval
Date: Tue Feb 7 15:33:20 2017 -0800
stacktrace, lockdep: Fix address, newline ugliness
commit bfeda41d06d85ad9d52f2413cfc2b77be5022f75 upstream.
Since KERN\_CONT became meaningful again, lockdep stack traces have had
annoying extra newlines, like this:
[ 5.561122] -> #1 (B){+.+...}:
[ 5.561528]
[ 5.561532] [] lock\_acquire+0xc3/0x210
[ 5.562178]
[ 5.562181] [] mutex\_lock\_nested+0x74/0x6d0
[ 5.562861]
[ 5.562880] [] init\_btrfs\_fs+0x21/0x196 [btrfs]
[ 5.563717]
[ 5.563721] [] do\_one\_initcall+0x52/0x1b0
[ 5.564554]
[ 5.564559] [] do\_init\_module+0x5f/0x209
[ 5.565357]
[ 5.565361] [] load\_module+0x218d/0x2b80
[ 5.566020]
[ 5.566021] [] SyS\_finit\_module+0xeb/0x120
[ 5.566694]
[ 5.566696] [] entry\_SYSCALL\_64\_fastpath+0x1f/0xc2
That's happening because each printk() call now gets printed on its own
line, and we do a separate call to print the spaces before the symbol.
Fix it by doing the printk() directly instead of using the
print\_ip\_sym() helper.
Additionally, the symbol address isn't very helpful, so let's get rid of
that, too. The final result looks like this:
[ 5.194518] -> #1 (B){+.+...}:
[ 5.195002] lock\_acquire+0xc3/0x210
[ 5.195439] mutex\_lock\_nested+0x74/0x6d0
[ 5.196491] do\_one\_initcall+0x52/0x1b0
[ 5.196939] do\_init\_module+0x5f/0x209
[ 5.197355] load\_module+0x218d/0x2b80
[ 5.197792] SyS\_finit\_module+0xeb/0x120
[ 5.198251] entry\_SYSCALL\_64\_fastpath+0x1f/0xc2
Suggested-by: Linus Torvalds
Signed-off-by: Omar Sandoval
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: kernel-team@fb.com
Fixes: 4bcc595ccd80 ("printk: reinstate KERN\_CONT for printing continuation lines")
Link: http://lkml.kernel.org/r/43b4e114724b2bdb0308fa86cb33aa07d3d67fad.1486510315.git.osandov@fb.com
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit b7dd5edc3dd9191f2cb1bd508279b0ff7274c5aa
Author: Eyal Itkin
Date: Tue Feb 7 16:45:19 2017 +0300
IB/rxe: Fix mem\_check\_range integer overflow
commit 647bf3d8a8e5777319da92af672289b2a6c4dc66 upstream.
Update the range check to avoid integer-overflow in edge case.
Resolves CVE 2016-8636.
Signed-off-by: Eyal Itkin
Signed-off-by: Dan Carpenter
Reviewed-by: Leon Romanovsky
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit 5476efeec1351d6df008a38c528099be65bfed0f
Author: Eyal Itkin
Date: Tue Feb 7 16:43:05 2017 +0300
IB/rxe: Fix resid update
commit 628f07d33c1f2e7bf31e0a4a988bb07914bd5e73 upstream.
Update the response's resid field when larger than MTU, instead of only
updating the local resid variable.
Fixes: 8700e3e7c485 ("Soft RoCE driver")
Signed-off-by: Eyal Itkin
Signed-off-by: Dan Carpenter
Reviewed-by: Leon Romanovsky
Signed-off-by: Doug Ledford
Signed-off-by: Greg Kroah-Hartman
commit c8cbc219d87cdbe33430b92350cb687b3f2201e6
Author: Yazen Ghannam
Date: Sun Feb 5 11:50:22 2017 +0100
x86/CPU/AMD: Fix Zen SMT topology
commit 08b259631b5a1d912af4832847b5642f377d9101 upstream.
After:
a33d331761bc ("x86/CPU/AMD: Fix Bulldozer topology")
our SMT scheduling topology for Fam17h systems is broken, because
the ThreadId is included in the ApicId when SMT is enabled.
So, without further decoding cpu\_core\_id is unique for each thread
rather than the same for threads on the same core. This didn't affect
systems with SMT disabled. Make cpu\_core\_id be what it is defined to be.
Signed-off-by: Yazen Ghannam
Signed-off-by: Borislav Petkov
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Link: http://lkml.kernel.org/r/20170205105022.8705-2-bp@alien8.de
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 6e306c5907a075ba6d46f6ee33c689abf4bfb733
Author: Borislav Petkov
Date: Sun Feb 5 11:50:21 2017 +0100
x86/CPU/AMD: Bring back Compute Unit ID
commit 79a8b9aa388b0620cc1d525d7c0f0d9a8a85e08e upstream.
Commit:
a33d331761bc ("x86/CPU/AMD: Fix Bulldozer topology")
restored the initial approach we had with the Fam15h topology of
enumerating CU (Compute Unit) threads as cores. And this is still
correct - they're beefier than HT threads but still have some
shared functionality.
Our current approach has a problem with the Mad Max Steam game, for
example. Yves Dionne reported a certain "choppiness" while playing on
v4.9.5.
That problem stems most likely from the fact that the CU threads share
resources within one CU and when we schedule to a thread of a different
compute unit, this incurs latency due to migrating the working set to a
different CU through the caches.
When the thread siblings mask mirrors that aspect of the CUs and
threads, the scheduler pays attention to it and tries to schedule within
one CU first. Which takes care of the latency, of course.
Reported-by: Yves Dionne
Signed-off-by: Borislav Petkov
Cc: Brice Goglin
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: Yazen Ghannam
Link: http://lkml.kernel.org/r/20170205105022.8705-1-bp@alien8.de
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit c3cc4259f8322fef4f59e719b05b07bc6833d8f9
Author: Andrey Ryabinin
Date: Fri Feb 10 12:54:05 2017 +0300
x86/mm/ptdump: Fix soft lockup in page table walker
commit 146fbb766934dc003fcbf755b519acef683576bf upstream.
CONFIG\_KASAN=y needs a lot of virtual memory mapped for its shadow.
In that case ptdump\_walk\_pgd\_level\_core() takes a lot of time to
walk across all page tables and doing this without
a rescheduling causes soft lockups:
NMI watchdog: BUG: soft lockup - CPU#3 stuck for 23s! [swapper/0:1]
...
Call Trace:
ptdump\_walk\_pgd\_level\_core+0x40c/0x550
ptdump\_walk\_pgd\_level\_checkwx+0x17/0x20
mark\_rodata\_ro+0x13b/0x150
kernel\_init+0x2f/0x120
ret\_from\_fork+0x2c/0x40
I guess that this issue might arise even without KASAN on huge machines
with several terabytes of RAM.
Stick cond\_resched() in pgd loop to fix this.
Reported-by: Tobias Regnery
Signed-off-by: Andrey Ryabinin
Cc: kasan-dev@googlegroups.com
Cc: Alexander Potapenko
Cc: "Paul E . McKenney"
Cc: Dmitry Vyukov
Link: http://lkml.kernel.org/r/20170210095405.31802-1-aryabinin@virtuozzo.com
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 34f840fc0d8918fc015ee8bd8a2e1a457c7094e2
Author: Takashi Iwai
Date: Tue Feb 7 09:32:30 2017 +0100
Revert "ALSA: line6: Only determine control port properties if needed"
commit f3d83317a69e7d658e7c83e24f8b31ac533c39e3 upstream.
This reverts commit f6a0dd107ad0c8b59d1c9735eea4b8cb9f460949.
The commit caused a regression on LINE6 Transport that has no control
caps. Although reverting the commit may result back in a spurious
error message for some device again, it's the simplest regression fix,
hence it's taken as is at first. The further code fix will follow
later.
Fixes: f6a0dd107ad0 ("ALSA: line6: Only determine control port properties if needed")
Reported-by: Igor Zinovev
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 23b1595b977c9ce4fe498363c636a555c216a9e2
Author: Takashi Iwai
Date: Mon Feb 6 15:09:48 2017 +0100
ALSA: seq: Don't handle loop timeout at snd\_seq\_pool\_done()
commit 37a7ea4a9b81f6a864c10a7cb0b96458df5310a3 upstream.
snd\_seq\_pool\_done() syncs with closing of all opened threads, but it
aborts the wait loop with a timeout, and proceeds to the release
resource even if not all threads have been closed. The timeout was 5
seconds, and if you run a crazy stuff, it can exceed easily, and may
result in the access of the invalid memory address -- this is what
syzkaller detected in a bug report.
As a fix, let the code graduate from naiveness, simply remove the loop
timeout.
BugLink: http://lkml.kernel.org/r/CACT4Y+YdhDV2H5LLzDTJDVF-qiYHUHhtRaW4rbb4gUhTCQB81w@mail.gmail.com
Reported-by: Dmitry Vyukov
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 5024b2fb8e49091044e450a0548979bb711588d6
Author: Takashi Iwai
Date: Wed Feb 8 12:35:39 2017 +0100
ALSA: seq: Fix race at creating a queue
commit 4842e98f26dd80be3623c4714a244ba52ea096a8 upstream.
When a sequencer queue is created in snd\_seq\_queue\_alloc(),it adds the
new queue element to the public list before referencing it. Thus the
queue might be deleted before the call of snd\_seq\_queue\_use(), and it
results in the use-after-free error, as spotted by syzkaller.
The fix is to reference the queue object at the right time.
Reported-by: Dmitry Vyukov
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 2e0feb524caccbe9c061997f63b97e4f695e816e
Author: Hui Wang
Date: Thu Feb 9 09:20:54 2017 +0800
ALSA: hda - adding a new NV HDMI/DP codec ID in the driver
commit af677166cf63c179dc2485053166e02c4aea01eb upstream.
Without this change, the HDMI/DP codec will be recognised as a
generic codec, and there is no sound when playing through this codec.
As suggested by NVidia side, after adding the new ID in the driver,
the sound playing works well.
Signed-off-by: Hui Wang
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 765c0f9089fcfebd3f5875a38c00f882ccff62ed
Author: Boris Ostrovsky
Date: Mon Jan 30 12:45:46 2017 -0500
xen-netfront: Delete rx\_refill\_timer in xennet\_disconnect\_backend()
commit 74470954857c264168d2b5a113904cf0cfd27d18 upstream.
rx\_refill\_timer should be deleted as soon as we disconnect from the
backend since otherwise it is possible for the timer to go off before
we get to xennet\_destroy\_queues(). If this happens we may dereference
queue->rx.sring which is set to NULL in xennet\_disconnect\_backend().
Signed-off-by: Boris Ostrovsky
Reviewed-by: Juergen Gross
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit e7f9f10bcc8dbbf0e09aba6765e9e07bc59910f1
Author: Benjamin Herrenschmidt
Date: Tue Feb 7 11:35:31 2017 +1100
powerpc/powernv: Fix CPU hotplug to handle waking on HVI
commit 9b256714979fad61ae11d90b53cf67dd5e6484eb upstream.
The IPIs come in as HVI not EE, so we need to test the appropriate
SRR1 bits. The encoding is such that it won't have false positives
on P7 and P8 so we can just test it like that. We also need to handle
the icp-opal variant of the flush.
Fixes: d74361881f0d ("powerpc/xics: Add ICP OPAL backend")
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 3433972d049f256a57b3538b2d29a7ee38748019
Author: Benjamin Herrenschmidt
Date: Mon Feb 6 13:05:16 2017 +1100
powerpc/mm/radix: Update ERAT flushes when invalidating TLB
commit 90c1e3c2fafec57fcb55b5d69bcf293b1a5fc8b3 upstream.
Three tiny changes to the ERAT flushing logic: First don't make
it depend on DD1. It hasn't been decided yet but we might run
DD2 in a mode that also requires explicit flushes for performance
reasons so make it unconditional. We also add a missing isync, and
finally remove the flush from \_tlbiel\_va as it is only necessary
for congruence-class invalidations (PID, LPID and full TLB), not
targetted invalidations.
Fixes: 96ed1fe511a8 ("powerpc/mm/radix: Invalidate ERAT on tlbiel for POWER9 DD1")
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 93fb043478b8d81cfa0d2399223bbf96bdb138e8
Author: Jeff Mahoney
Date: Mon Feb 6 19:39:09 2017 -0500
btrfs: fix btrfs\_compat\_ioctl failures on non-compat ioctls
commit 2a362249187a8d0f6d942d6e1d763d150a296f47 upstream.
Commit 4c63c2454ef incorrectly assumed that returning -ENOIOCTLCMD would
cause the native ioctl to be called. The ->compat\_ioctl callback is
expected to handle all ioctls, not just compat variants. As a result,
when using 32-bit userspace on 64-bit kernels, everything except those
three ioctls would return -ENOTTY.
Fixes: 4c63c2454ef ("btrfs: bugfix: handle FS\_IOC32\_{GETFLAGS,SETFLAGS,GETVERSION} in btrfs\_ioctl")
Signed-off-by: Jeff Mahoney
Reviewed-by: David Sterba
Signed-off-by: David Sterba
Signed-off-by: Greg Kroah-Hartman
commit 76a9ac048b4876849b6e95fa4b20cca949f2bf0a
Author: Mauricio Faria de Oliveira
Date: Wed Jan 25 22:07:06 2017 -0200
scsi: qla2xxx: Avoid that issuing a LIP triggers a kernel crash
commit 2780f3c8f0233de90b6b47a23fc422b7780c5436 upstream.
Avoid that issuing a LIP as follows:
find /sys -name 'issue\_lip'|while read f; do echo 1 > $f; done
triggers the following:
BUG: unable to handle kernel NULL pointer dereference at (null)
Call Trace:
qla2x00\_abort\_all\_cmds+0xed/0x140 [qla2xxx]
qla2x00\_abort\_isp\_cleanup+0x1e3/0x280 [qla2xxx]
qla2x00\_abort\_isp+0xef/0x690 [qla2xxx]
qla2x00\_do\_dpc+0x36c/0x880 [qla2xxx]
kthread+0x10c/0x140
[mkp: consolidated Mauricio's and Bart's fixes]
Signed-off-by: Mauricio Faria de Oliveira
Reported-by: Bart Van Assche
Fixes: 1535aa75a3d8 ("qla2xxx: fix invalid DMA access after command aborts in PCI device remove")
Cc: Himanshu Madhani
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit b5d5f2877c8d447f56a9b5477e485e6361fcd2d3
Author: ojab
Date: Wed Dec 28 11:05:24 2016 +0000
scsi: mpt3sas: disable ASPM for MPI2 controllers
commit ffdadd68af5a397b8a52289ab39d62e1acb39e63 upstream.
MPI2 controllers sometimes got lost (i.e. disappear from
/sys/bus/pci/devices) if ASMP is enabled.
Signed-off-by: Slava Kardakov
Fixes: https://bugzilla.kernel.org/show\_bug.cgi?id=60644
Acked-by: Sreekanth Reddy
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 5684c7db4e1076ce95e38deccd261d59fb612649
Author: Dave Carroll
Date: Thu Feb 9 11:04:47 2017 -0700
scsi: aacraid: Fix INTx/MSI-x issue with older controllers
commit 8af8e1c22f9994bb1849c01d66c24fe23f9bc9a0 upstream.
commit 78cbccd3bd68 ("aacraid: Fix for KDUMP driver hang")
caused a problem on older controllers which do not support MSI-x (namely
ASR3405,ASR3805). This patch conditionalizes the previous patch to
controllers which support MSI-x
Fixes: 78cbccd3bd68 ("aacraid: Fix for KDUMP driver hang")
Reported-by: Arkadiusz Miskiewicz
Signed-off-by: Dave Carroll
Reviewed-by: Raghava Aditya Renukunta
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit e19722449e736d4811f24f68e3a36d4d8e5d429e
Author: Steffen Maier
Date: Wed Feb 8 15:34:22 2017 +0100
scsi: zfcp: fix use-after-free by not tracing WKA port open/close on failed send
commit 2dfa6688aafdc3f74efeb1cf05fb871465d67f79 upstream.
Dan Carpenter kindly reported:
The patch d27a7cb91960: "zfcp: trace on request for open and close of
WKA port" from Aug 10, 2016, leads to the following static checker
warning:
drivers/s390/scsi/zfcp\_fsf.c:1615 zfcp\_fsf\_open\_wka\_port()
warn: 'req' was already freed.
drivers/s390/scsi/zfcp\_fsf.c
1609 zfcp\_fsf\_start\_timer(req, ZFCP\_FSF\_REQUEST\_TIMEOUT);
1610 retval = zfcp\_fsf\_req\_send(req);
1611 if (retval)
1612 zfcp\_fsf\_req\_free(req);
^^^
Freed.
1613 out:
1614 spin\_unlock\_irq(&qdio->req\_q\_lock);
1615 if (req && !IS\_ERR(req))
1616 zfcp\_dbf\_rec\_run\_wka("fsowp\_1", wka\_port, req->req\_id);
^^^^^^^^^^^
Use after free.
1617 return retval;
1618 }
Same thing for zfcp\_fsf\_close\_wka\_port() as well.

Rather than relying on req being NULL (or ERR\_PTR) for all cases where
we don't want to trace or should not trace,
simply check retval which is unconditionally initialized with -EIO != 0
and it can only become 0 on successful retval = zfcp\_fsf\_req\_send(req).
With that we can also remove the then again unnecessary unconditional
initialization of req which was introduced with that earlier commit.
Reported-by: Dan Carpenter
Suggested-by: Benjamin Block
Signed-off-by: Steffen Maier
Fixes: d27a7cb91960 ("zfcp: trace on request for open and close of WKA port")
Reviewed-by: Benjamin Block
Reviewed-by: Jens Remus
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 1cf897fcc5a99e5ecf2f6fb12adec6d485a17e14
Author: Dexuan Cui
Date: Sat Jan 28 11:46:02 2017 -0700
Drivers: hv: vmbus: finally fix hv\_need\_to\_signal\_on\_read()
commit 433e19cf33d34bb6751c874a9c00980552fe508c upstream.
Commit a389fcfd2cb5 ("Drivers: hv: vmbus: Fix signaling logic in
hv\_need\_to\_signal\_on\_read()")
added the proper mb(), but removed the test "prev\_write\_sz < pending\_sz"
when making the signal decision.
As a result, the guest can signal the host unnecessarily,
and then the host can throttle the guest because the host
thinks the guest is buggy or malicious; finally the user
running stress test can perceive intermittent freeze of
the guest.
This patch brings back the test, and properly handles the
in-place consumption APIs used by NetVSC (see get\_next\_pkt\_raw(),
put\_pkt\_raw() and commit\_rd\_index()).
Fixes: a389fcfd2cb5 ("Drivers: hv: vmbus: Fix signaling logic in
hv\_need\_to\_signal\_on\_read()")
Signed-off-by: Dexuan Cui
Reported-by: Rolf Neugebauer
Tested-by: Rolf Neugebauer
Cc: "K. Y. Srinivasan"
Cc: Haiyang Zhang
Cc: Stephen Hemminger
Signed-off-by: K. Y. Srinivasan
Cc: Rolf Neugebauer
Signed-off-by: Greg Kroah-Hartman
commit 964dfbe3dd2d36f9d35018568e303d9847fc1026
Author: K. Y. Srinivasan
Date: Sun Nov 6 13:14:18 2016 -0800
Drivers: hv: vmbus: On the read path cleanup the logic to interrupt the host
commit 3372592a140db69fd63837e81f048ab4abf8111e upstream.
Signal the host when we determine the host is to be signaled -
on th read path. The currrent code determines the need to signal in the
ringbuffer code and actually issues the signal elsewhere. This can result
in the host viewing this interrupt as spurious since the host may also
poll the channel. Make the necessary adjustments.
Signed-off-by: K. Y. Srinivasan
Cc: Rolf Neugebauer
Signed-off-by: Greg Kroah-Hartman
commit e2fdf7841cb32128685ddcd6db7a51d0e3c3c739
Author: K. Y. Srinivasan
Date: Sun Nov 6 13:14:17 2016 -0800
Drivers: hv: vmbus: On write cleanup the logic to interrupt the host
commit 1f6ee4e7d83586c8b10bd4f2f4346353d04ce884 upstream.
Signal the host when we determine the host is to be signaled.
The currrent code determines the need to signal in the ringbuffer
code and actually issues the signal elsewhere. This can result
in the host viewing this interrupt as spurious since the host may also
poll the channel. Make the necessary adjustments.
Signed-off-by: K. Y. Srinivasan
Cc: Rolf Neugebauer
Signed-off-by: Greg Kroah-Hartman
commit afbb98f91d3be20c62bcbdf0de084056325b7be2
Author: K. Y. Srinivasan
Date: Sun Nov 6 13:14:16 2016 -0800
Drivers: hv: vmbus: Base host signaling strictly on the ring state
commit 74198eb4a42c4a3c4fbef08fa01a291a282f7c2e upstream.
One of the factors that can result in the host concluding that a given
guest in mounting a DOS attack is if the guest generates interrupts
to the host when the host is not expecting it. If these "spurious"
interrupts reach a certain rate, the host can throttle the guest to
minimize the impact. The host computation of the "expected number
of interrupts" is strictly based on the ring transitions. Until
the host logic is fixed, base the guest logic to interrupt solely
on the ring state.
Signed-off-by: K. Y. Srinivasan
Cc: Rolf Neugebauer
Signed-off-by: Greg Kroah-Hartman
commit e68f0dbb6bb0f0487a8ae2a117ae1950b6656f1a
Author: Gal Pressman
Date: Wed Jan 11 14:32:26 2017 +0200
net/mlx5e: Modify TIRs hash only when it's needed
commit 1d3398facd08a7fd4202f269317a95668eb880b9 upstream.
We don't need to modify our TIRs unless the user requested a change in
the hash function/key, for example when changing indirection only.
Tested:
# Modify TIRs hash is needed
ethtool -X ethX hkey
ethtool -X ethX hfunc
# Modify TIRs hash is not needed
ethtool -X ethX equal
All cases are verified with TCP Multi-Stream traffic over IPv4 & IPv6.
Fixes: bdfc028de1b3 ("net/mlx5e: Fix ethtool RX hash func configuration change")
Signed-off-by: Gal Pressman
Signed-off-by: Saeed Mahameed
Signed-off-by: Greg Kroah-Hartman
commit 1a1981ef15a5bb52c46ab109a63cf1d4ddaee992
Author: Thorsten Horstmann
Date: Fri Feb 3 14:38:29 2017 +0100
mac80211: Fix adding of mesh vendor IEs
commit da7061c82e4a1bc6a5e134ef362c86261906c860 upstream.
The function ieee80211\_ie\_split\_vendor doesn't return 0 on errors. Instead
it returns any offset < ielen when WLAN\_EID\_VENDOR\_SPECIFIC is found. The
return value in mesh\_add\_vendor\_ies must therefore be checked against
ifmsh->ie\_len and not 0. Otherwise all ifmsh->ie starting with
WLAN\_EID\_VENDOR\_SPECIFIC will be rejected.
Fixes: 082ebb0c258d ("mac80211: fix mesh beacon format")
Signed-off-by: Thorsten Horstmann
Signed-off-by: Mathias Kretschmer
Signed-off-by: Simon Wunderlich
[sven@narfation.org: Add commit message]
Signed-off-by: Sven Eckelmann
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit f9bd791be5b8755746528df95885a2b4a25b6ff6
Author: Masashi Honma
Date: Thu Jan 26 08:56:13 2017 +0900
nl80211: Fix mesh HT operation check
commit fd551bac4795854adaa87bad7e5136083719802b upstream.
A previous change to fix checks for NL80211\_MESHCONF\_HT\_OPMODE
missed setting the flag when replacing FILL\_IN\_MESH\_PARAM\_IF\_SET
with checking codes. This results in dropping the received HT
operation value when called by nl80211\_update\_mesh\_config(). Fix
this by setting the flag properly.
Fixes: 9757235f451c ("nl80211: correct checks for NL80211\_MESHCONF\_HT\_OPMODE value")
Signed-off-by: Masashi Honma
[rewrite commit message to use Fixes: line]
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit 8920a7f28ad837661bc5b9333240425dbcdc6720
Author: Michał Winiarski
Date: Tue Feb 7 20:55:59 2017 +0100
drm/i915: Always convert incoming exec offsets to non-canonical
commit 6e7eb1783be7f19eb071c96ddda0bbf22279ff46 upstream.
We're using non-canonical addresses in drm\_mm, and we're making sure that
userspace is using canonical addressing - both in case of softpin
(verifying incoming offset) and when relocating (converting to canonical
when updating offset returned to userspace).
Unfortunately when considering the need for relocations, we're comparing
offset from userspace (in canonical form) with drm\_mm node (in
non-canonical form), and as a result, we end up always relocating if our
offsets are in the "problematic" range.
Let's always convert the offsets to avoid the performance impact of
relocations.
Fixes: a5f0edf63bdf ("drm/i915: Avoid writing relocs with addresses in non-canonical form")
Cc: Chris Wilson
Cc: Michel Thierry
Reported-by: Michał Pyrzowski
Signed-off-by: Michał Winiarski
Link: http://patchwork.freedesktop.org/patch/msgid/20170207195559.18798-1-michal.winiarski@intel.com
Reviewed-by: Chris Wilson
Signed-off-by: Chris Wilson
(cherry picked from commit 038c95a313e4ca954ee5ab8a0c7559a646b0f462)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 916d03a6aa3f095477c24840595169390d50df6d
Author: Alexander Sverdlin
Date: Tue Jan 17 21:10:11 2017 +0100
ARM: 8642/1: LPAE: catch pending imprecise abort on unmask
commit 97a98ae5b8acf08d07d972c087b2def060bc9b73 upstream.
Asynchronous external abort is coded differently in DFSR with LPAE enabled.
Fixes: 9254970c "ARM: 8447/1: catch pending imprecise abort on unmask".
Signed-off-by: Alexander Sverdlin
Cc: Russell King
Cc: Andrew Morton
Cc: linux-arm-kernel@lists.infradead.org
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 126ed953f4461da31ecc04bbc9a431787b33b81b
Author: Sébastien Szymanski
Date: Wed Jan 18 11:09:51 2017 +0100
ARM: dts: imx6dl: fix GPIO4 range
commit 7f59b319111bbc3a5f32730c8a43b201e9522f52 upstream.
GPIO4\_11 is on pin 152(MX6DL\_PAD\_KEY\_ROW2) and not on pin
151(MX6DL\_PAD\_KEY\_ROW1).
I found the error while booting a mainline kernel on APF6S SoM and
noticed the following message:
[ 2.609337] imx6dl-pinctrl 20e0000.iomuxc: pin MX6DL\_PAD\_KEY\_ROW1
already requested by 20a8000.gpio:105; cannot claim for 20a8000.gpio:107
[ 2.621884] imx6dl-pinctrl 20e0000.iomuxc: pin-151 (20a8000.gpio:107)
status -22
[ 2.629303] spi\_imx 2008000.ecspi: Can't get CS GPIO 107
With this patch, the message is gone and spi\_imx driver probes correctly.
Fixes: bb728d662bed ("ARM: dts: add gpio-ranges property to iMX GPIO controllers")
Signed-off-by: Sébastien Szymanski
Signed-off-by: Shawn Guo
Signed-off-by: Greg Kroah-Hartman
commit 84d209b75e7254fba5de26ee2d3b31e638337a82
Author: Nicholas Bellinger
Date: Mon Feb 6 14:28:09 2017 -0800
target: Fix COMPARE\_AND\_WRITE ref leak for non GOOD status
commit 9b2792c3da1e80f2d460167d319302a24c9ca2b7 upstream.
This patch addresses a long standing bug where the commit phase
of COMPARE\_AND\_WRITE would result in a se\_cmd->cmd\_kref reference
leak if se\_cmd->scsi\_status returned non SAM\_STAT\_GOOD.
This would manifest first as a lost SCSI response, and eventual
hung task during fabric driver logout or re-login, as existing
shutdown logic waited for the COMPARE\_AND\_WRITE se\_cmd->cmd\_kref
to reach zero.
To address this bug, compare\_and\_write\_post() has been changed
to drop the incorrect !cmd->scsi\_status conditional that was
preventing \*post\_ret = 1 for being set during non SAM\_STAT\_GOOD
status.
This patch has been tested with SAM\_STAT\_CHECK\_CONDITION status
from normal target\_complete\_cmd() callback path, as well as the
incoming \_\_target\_execute\_cmd() submission failure path when
se\_cmd->execute\_cmd() returns non zero status.
Reported-by: Donald White
Cc: Donald White
Tested-by: Gary Guo
Cc: Gary Guo
Reviewed-by: Christoph Hellwig
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 4978149de58d816f101daabaf089464b6108ad84
Author: Nicholas Bellinger
Date: Wed Dec 7 12:55:54 2016 -0800
target: Fix multi-session dynamic se\_node\_acl double free OOPs
commit 01d4d673558985d9a118e1e05026633c3e2ade9b upstream.
This patch addresses a long-standing bug with multi-session
(eg: iscsi-target + iser-target) se\_node\_acl dynamic free
withini transport\_deregister\_session().
This bug is caused when a storage endpoint is configured with
demo-mode (generate\_node\_acls = 1 + cache\_dynamic\_acls = 1)
initiators, and initiator login creates a new dynamic node acl
and attaches two sessions to it.
After that, demo-mode for the storage instance is disabled via
configfs (generate\_node\_acls = 0 + cache\_dynamic\_acls = 0) and
the existing dynamic acl is never converted to an explicit ACL.
The end result is dynamic acl resources are released twice when
the sessions are shutdown in transport\_deregister\_session().
If the storage instance is not changed to disable demo-mode,
or the dynamic acl is converted to an explict ACL, or there
is only a single session associated with the dynamic ACL,
the bug is not triggered.
To address this big, move the release of dynamic se\_node\_acl
memory into target\_complete\_nacl() so it's only freed once
when se\_node\_acl->acl\_kref reaches zero.
(Drop unnecessary list\_del\_init usage - HCH)
Reported-by: Rob Millner
Tested-by: Rob Millner
Cc: Rob Millner
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 88e865c5d813e400ad0b135c39fe5842e95df6f4
Author: Nicholas Bellinger
Date: Tue Dec 6 22:45:46 2016 -0800
target: Fix early transport\_generic\_handle\_tmr abort scenario
commit c54eeffbe9338fa982dc853d816fda9202a13b5a upstream.
This patch fixes a bug where incoming task management requests
can be explicitly aborted during an active LUN\_RESET, but who's
struct work\_struct are canceled in-flight before execution.
This occurs when core\_tmr\_drain\_tmr\_list() invokes cancel\_work\_sync()
for the incoming se\_tmr\_req->task\_cmd->work, resulting in cmd->work
for target\_tmr\_work() never getting invoked and the aborted TMR
waiting indefinately within transport\_wait\_for\_tasks().
To address this case, perform a CMD\_T\_ABORTED check early in
transport\_generic\_handle\_tmr(), and invoke the normal path via
transport\_cmd\_check\_stop\_to\_fabric() to complete any TMR kthreads
blocked waiting for CMD\_T\_STOP in transport\_wait\_for\_tasks().
Also, move the TRANSPORT\_ISTATE\_PROCESSING assignment earlier
into transport\_generic\_handle\_tmr() so the existing check in
core\_tmr\_drain\_tmr\_list() avoids attempting abort the incoming
se\_tmr\_req->task\_cmd->work if it has already been queued into
se\_device->tmr\_wq.
Reported-by: Rob Millner
Tested-by: Rob Millner
Cc: Rob Millner
Reviewed-by: Christoph Hellwig
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 4b99bb2e3643d2be438393b95a0572593c5205cf
Author: Nicholas Bellinger
Date: Mon Oct 31 00:54:40 2016 -0700
target: Use correct SCSI status during EXTENDED\_COPY exception
commit 0583c261e6325f392c1f7a1b9112e31298e1a4bd upstream.
This patch adds the missing target\_complete\_cmd() SCSI status
parameter change in target\_xcopy\_do\_work(), that was originally
missing in commit 926317de33.
It correctly propigates up the correct SCSI status during
EXTENDED\_COPY exception cases, instead of always using the
hardcoded SAM\_STAT\_CHECK\_CONDITION from original code.
This is required for ESX host environments that expect to
hit SAM\_STAT\_RESERVATION\_CONFLICT for certain scenarios,
and SAM\_STAT\_CHECK\_CONDITION results in non-retriable
status for these cases.
Reported-by: Nixon Vincent
Tested-by: Nixon Vincent
Cc: Nixon Vincent
Reviewed-by: Christoph Hellwig
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit eb49824ca9c9fb1030cf9a6e51a89fa2471422fa
Author: Nicholas Bellinger
Date: Sun Oct 23 14:28:15 2016 -0700
target: Don't BUG\_ON during NodeACL dynamic -> explicit conversion
commit 391e2a6de9781e4906dd7e0b1cc097050bf43e11 upstream.
After the v4.2+ RCU conversion to se\_node\_acl->lun\_entry\_hlist,
a BUG\_ON() was added in core\_enable\_device\_list\_for\_node() to
detect when the located orig->se\_lun\_acl contains an existing
se\_lun\_acl pointer reference.
However, this scenario can happen when a dynamically generated
NodeACL is being converted to an explicit NodeACL, when the
explicit NodeACL contains a different LUN mapping than the
default provided by the WWN endpoint.
So instead of triggering BUG\_ON(), go ahead and fail instead
following the original pre RCU conversion logic.
Reported-by: Benjamin ESTRABAUD
Cc: Benjamin ESTRABAUD
Reviewed-by: Christoph Hellwig
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 4cd462c7f2b6fcc208aebf44f2c831681feaa925
Author: Maarten Lankhorst
Date: Tue Jan 31 10:25:25 2017 +0100
drm/atomic: Fix double free in drm\_atomic\_state\_default\_clear
commit 92c715fca907686f5298220ece53423e38ba3aed upstream.
drm\_atomic\_helper\_page\_flip and drm\_atomic\_ioctl set their own events
in crtc\_state->event. But when it's set the event is freed in 2 places.
Solve this by only freeing the event in the atomic ioctl when it
allocated its own event.
This has been broken twice. The first time when the code was introduced,
but only in the corner case when an event is allocated, but more crtc's
were included by atomic check and then failing. This can mostly
happen when you do an atomic modeset in i915 and the display clock is
changed, which forces all crtc's to be included to the state.
This has been broken worse by adding in-fences support, which caused
the double free to be done unconditionally.
[IGT] kms\_rotation\_crc: starting subtest primary-rotation-180
=============================================================================
BUG kmalloc-128 (Tainted: G U ): Object already free
-----------------------------------------------------------------------------
Disabling lock debugging due to kernel taint
INFO: Allocated in drm\_atomic\_helper\_setup\_commit+0x285/0x2f0 [drm\_kms\_helper] age=0 cpu=3 pid=1529
\_\_\_slab\_alloc+0x308/0x3b0
\_\_slab\_alloc+0xd/0x20
kmem\_cache\_alloc\_trace+0x92/0x1c0
drm\_atomic\_helper\_setup\_commit+0x285/0x2f0 [drm\_kms\_helper]
intel\_atomic\_commit+0x35/0x4f0 [i915]
drm\_atomic\_commit+0x46/0x50 [drm]
drm\_mode\_atomic\_ioctl+0x7d4/0xab0 [drm]
drm\_ioctl+0x2b3/0x490 [drm]
do\_vfs\_ioctl+0x69c/0x700
SyS\_ioctl+0x4e/0x80
entry\_SYSCALL\_64\_fastpath+0x13/0x94
INFO: Freed in drm\_event\_cancel\_free+0xa3/0xb0 [drm] age=0 cpu=3 pid=1529
\_\_slab\_free+0x48/0x2e0
kfree+0x159/0x1a0
drm\_event\_cancel\_free+0xa3/0xb0 [drm]
drm\_mode\_atomic\_ioctl+0x86d/0xab0 [drm]
drm\_ioctl+0x2b3/0x490 [drm]
do\_vfs\_ioctl+0x69c/0x700
SyS\_ioctl+0x4e/0x80
entry\_SYSCALL\_64\_fastpath+0x13/0x94
INFO: Slab 0xffffde1f0997b080 objects=17 used=2 fp=0xffff92fb65ec2578 flags=0x200000000008101
INFO: Object 0xffff92fb65ec2578 @offset=1400 fp=0xffff92fb65ec2ae8
Redzone ffff92fb65ec2570: bb bb bb bb bb bb bb bb ........
Object ffff92fb65ec2578: 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b kkkkkkkkkkkkkkkk
Object ffff92fb65ec2588: 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b kkkkkkkkkkkkkkkk
Object ffff92fb65ec2598: 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b kkkkkkkkkkkkkkkk
Object ffff92fb65ec25a8: 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b kkkkkkkkkkkkkkkk
Object ffff92fb65ec25b8: 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b kkkkkkkkkkkkkkkk
Object ffff92fb65ec25c8: 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b kkkkkkkkkkkkkkkk
Object ffff92fb65ec25d8: 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b kkkkkkkkkkkkkkkk
Object ffff92fb65ec25e8: 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b a5 kkkkkkkkkkkkkkk.
Redzone ffff92fb65ec25f8: bb bb bb bb bb bb bb bb ........
Padding ffff92fb65ec2738: 5a 5a 5a 5a 5a 5a 5a 5a ZZZZZZZZ
CPU: 3 PID: 180 Comm: kworker/3:2 Tainted: G BU 4.10.0-rc6-patser+ #5039
Hardware name: /NUC5PPYB, BIOS PYBSWCEL.86A.0031.2015.0601.1712 06/01/2015
Workqueue: events intel\_atomic\_helper\_free\_state [i915]
Call Trace:
dump\_stack+0x4d/0x6d
print\_trailer+0x20c/0x220
free\_debug\_processing+0x1c6/0x330
? drm\_atomic\_state\_default\_clear+0xf7/0x1c0 [drm]
\_\_slab\_free+0x48/0x2e0
? drm\_atomic\_state\_default\_clear+0xf7/0x1c0 [drm]
kfree+0x159/0x1a0
drm\_atomic\_state\_default\_clear+0xf7/0x1c0 [drm]
? drm\_atomic\_state\_clear+0x30/0x30 [drm]
intel\_atomic\_state\_clear+0xd/0x20 [i915]
drm\_atomic\_state\_clear+0x1a/0x30 [drm]
\_\_drm\_atomic\_state\_free+0x13/0x60 [drm]
intel\_atomic\_helper\_free\_state+0x5d/0x70 [i915]
process\_one\_work+0x260/0x4a0
worker\_thread+0x2d1/0x4f0
kthread+0x127/0x130
? process\_one\_work+0x4a0/0x4a0
? kthread\_stop+0x120/0x120
ret\_from\_fork+0x29/0x40
FIX kmalloc-128: Object at 0xffff92fb65ec2578 not freed
Fixes: 3b24f7d67581 ("drm/atomic: Add struct drm\_crtc\_commit to track async updates")
Fixes: 9626014258a5 ("drm/fence: add in-fences support")
Cc: Daniel Vetter
Signed-off-by: Maarten Lankhorst
Reviewed-by: Daniel Vetter
Reviewed-by: Gustavo Padovan
Signed-off-by: Daniel Vetter
Link: http://patchwork.freedesktop.org/patch/msgid/1485854725-27640-1-git-send-email-maarten.lankhorst@linux.intel.com
CC: koos vriezen
Signed-off-by: Greg Kroah-Hartman
commit 32c67a2cdf4c2210f9bc7d3747da744d5b3ce866
Author: Lee, Shawn C
Date: Fri Feb 3 12:32:09 2017 +0800
drm/i915/bxt: Add MST support when do DPLL calculation
commit 789ea12500e5ce3911d0a6a822277c3133451927 upstream.
Add the missing INTEL\_OUTPUT\_DP\_MST case in bxt\_get\_dpll()
to correctly initialize the crtc\_state and port plls when
link training a DP MST monitor on BXT/APL devices.
Fixes: a277ca7dc01d ("drm/i915: Split bxt\_ddi\_pll\_select()")
Bugs: https://bugs.freedesktop.org/show\_bug.cgi?id=99572
Reviewed-by: Cooper Chiou
Reviewed-by: Gary C Wang
Reviewed-by: Ciobanu, Nathan D
Reviewed-by: Herbert, Marc
Reviewed-by: Bride, Jim
Reviewed-by: Navare, Manasi D
Cc: Jani Nikula
Signed-off-by: Lee, Shawn C
Signed-off-by: Jani Nikula
Link: http://patchwork.freedesktop.org/patch/msgid/1486096329-6255-1-git-send-email-shawn.c.lee@intel.com
(cherry picked from commit 0aab2c721d81590012a5021a516f00666646741f)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit ebe976ac0c3872f4591c0bcda7f12062e9071074
Author: Andrey Ryabinin
Date: Thu Jan 26 17:32:11 2017 +0300
drm/i915: fix use-after-free in page\_flip\_completed()
commit 5351fbb1bf1413f6024892093528280769ca852f upstream.
page\_flip\_completed() dereferences 'work' variable after executing
queue\_work(). This is not safe as the 'work' item might be already freed
by queued work:
BUG: KASAN: use-after-free in page\_flip\_completed+0x3ff/0x490 at addr ffff8803dc010f90
Call Trace:
\_\_asan\_report\_load8\_noabort+0x59/0x80
page\_flip\_completed+0x3ff/0x490
intel\_finish\_page\_flip\_mmio+0xe3/0x130
intel\_pipe\_handle\_vblank+0x2d/0x40
gen8\_irq\_handler+0x4a7/0xed0
\_\_handle\_irq\_event\_percpu+0xf6/0x860
handle\_irq\_event\_percpu+0x6b/0x160
handle\_irq\_event+0xc7/0x1b0
handle\_edge\_irq+0x1f4/0xa50
handle\_irq+0x41/0x70
do\_IRQ+0x9a/0x200
common\_interrupt+0x89/0x89
Freed:
kfree+0x113/0x4d0
intel\_unpin\_work\_fn+0x29a/0x3b0
process\_one\_work+0x79e/0x1b70
worker\_thread+0x611/0x1460
kthread+0x241/0x3a0
ret\_from\_fork+0x27/0x40
Move queue\_work() after trace\_i915\_flip\_complete() to fix this.
Fixes: e5510fac98a7 ("drm/i915: add tracepoints for flip requests & completions")
Signed-off-by: Andrey Ryabinin
Reviewed-by: Chris Wilson
Signed-off-by: Daniel Vetter
Link: http://patchwork.freedesktop.org/patch/msgid/20170126143211.24013-1-aryabinin@virtuozzo.com
(cherry picked from commit 05c41f926fcc7ef838c80a6a99d84f67b4e0b824)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit bd7d069c7635da0276ce0f25155514b117b0b1eb
Author: Dave Martin
Date: Wed Jan 18 17:11:56 2017 +0100
ARM: 8643/3: arm/ptrace: Preserve previous registers for short regset write
commit 228dbbfb5d77f8e047b2a1d78da14b7158433027 upstream.
Ensure that if userspace supplies insufficient data to
PTRACE\_SETREGSET to fill all the registers, the thread's old
registers are preserved.
Fixes: 5be6f62b0059 ("ARM: 6883/1: ptrace: Migrate to regsets framework")
Signed-off-by: Dave Martin
Acked-by: Russell King
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 14cdf0f590447c4f7c5e1567ce73c81b2d9fe80b
Author: Arnd Bergmann
Date: Fri Feb 3 17:35:46 2017 +0100
hns: avoid stack overflow with CONFIG\_KASAN
commit b3f2d07f4649adcf6905953a10d217b5683e4077 upstream.
The use of ACCESS\_ONCE() looks like a micro-optimization to force gcc to use
an indexed load for the register address, but it has an absolutely detrimental
effect on builds with gcc-5 and CONFIG\_KASAN=y, leading to a very likely
kernel stack overflow aside from very complex object code:
hisilicon/hns/hns\_dsaf\_gmac.c: In function 'hns\_gmac\_update\_stats':
hisilicon/hns/hns\_dsaf\_gmac.c:419:1: error: the frame size of 2912 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
hisilicon/hns/hns\_dsaf\_ppe.c: In function 'hns\_ppe\_reset\_common':
hisilicon/hns/hns\_dsaf\_ppe.c:390:1: error: the frame size of 1184 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
hisilicon/hns/hns\_dsaf\_ppe.c: In function 'hns\_ppe\_get\_regs':
hisilicon/hns/hns\_dsaf\_ppe.c:621:1: error: the frame size of 3632 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
hisilicon/hns/hns\_dsaf\_rcb.c: In function 'hns\_rcb\_get\_common\_regs':
hisilicon/hns/hns\_dsaf\_rcb.c:970:1: error: the frame size of 2784 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
hisilicon/hns/hns\_dsaf\_gmac.c: In function 'hns\_gmac\_get\_regs':
hisilicon/hns/hns\_dsaf\_gmac.c:641:1: error: the frame size of 5728 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
hisilicon/hns/hns\_dsaf\_rcb.c: In function 'hns\_rcb\_get\_ring\_regs':
hisilicon/hns/hns\_dsaf\_rcb.c:1021:1: error: the frame size of 2208 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
hisilicon/hns/hns\_dsaf\_main.c: In function 'hns\_dsaf\_comm\_init':
hisilicon/hns/hns\_dsaf\_main.c:1209:1: error: the frame size of 1904 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
hisilicon/hns/hns\_dsaf\_xgmac.c: In function 'hns\_xgmac\_get\_regs':
hisilicon/hns/hns\_dsaf\_xgmac.c:748:1: error: the frame size of 4704 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
hisilicon/hns/hns\_dsaf\_main.c: In function 'hns\_dsaf\_update\_stats':
hisilicon/hns/hns\_dsaf\_main.c:2420:1: error: the frame size of 1088 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
hisilicon/hns/hns\_dsaf\_main.c: In function 'hns\_dsaf\_get\_regs':
hisilicon/hns/hns\_dsaf\_main.c:2753:1: error: the frame size of 10768 bytes is larger than 1024 bytes [-Werror=frame-larger-than=]
This does not seem to happen any more with gcc-7, but removing the ACCESS\_ONCE
seems safe anyway and it avoids a serious issue for some people. I have verified
that with gcc-5.3.1, the object code we get is better in the new version
both with and without CONFIG\_KASAN, as we no longer allocate a 1344 byte
stack frame for hns\_dsaf\_get\_regs() but otherwise have practically identical
object code.
With gcc-7.0.0, removing ACCESS\_ONCE has no effect, the object code is already
good either way.
This patch is probably not urgent to get into 4.11 as only KASAN=y builds
with certain compilers are affected, but I still think it makes sense to
backport into older kernels.
Fixes: 511e6bc ("net: add Hisilicon Network Subsystem DSAF support")
Signed-off-by: Arnd Bergmann
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 6b10a704325a26d6f6495001e827b8601a170c3b
Author: Bryant G. Ly
Date: Mon Feb 6 10:04:28 2017 -0600
ibmvscsis: Add SGL limit
commit b22bc27868e8c11fe3f00937a341b44f80b50364 upstream.
This patch adds internal LIO sgl limit since the driver already
sets a max transfer limit on transport layer of 1MB to the client.
Tested-by: Steven Royer
Signed-off-by: Bryant G. Ly
Signed-off-by: Nicholas Bellinger
Signed-off-by: Greg Kroah-Hartman
commit 49f68ccccf8e502bce967126207211f5a27feb4c
Author: Sean Rees
Date: Wed Feb 8 14:30:59 2017 -0800
mm/slub.c: fix random\_seq offset destruction
commit a810007afe239d59c1115fcaa06eb5b480f876e9 upstream.
Commit 210e7a43fa90 ("mm: SLUB freelist randomization") broke USB hub
initialisation as described in
https://bugzilla.kernel.org/show\_bug.cgi?id=177551.
Bail out early from init\_cache\_random\_seq if s->random\_seq is already
initialised. This prevents destroying the previously computed
random\_seq offsets later in the function.
If the offsets are destroyed, then shuffle\_freelist will truncate
page->freelist to just the first object (orphaning the rest).
Fixes: 210e7a43fa90 ("mm: SLUB freelist randomization")
Link: http://lkml.kernel.org/r/20170207140707.20824-1-sean@erifax.org
Signed-off-by: Sean Rees
Reported-by:
Cc: Christoph Lameter
Cc: Pekka Enberg
Cc: David Rientjes
Cc: Joonsoo Kim
Cc: Thomas Garnier
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit c4236b0c71169b6e5fb5f2272dd0292156c81e97
Author: Tejun Heo
Date: Wed Feb 8 14:30:56 2017 -0800
cpumask: use nr\_cpumask\_bits for parsing functions
commit 4d59b6ccf000862beed6fc0765d3209f98a8d8a2 upstream.
Commit 513e3d2d11c9 ("cpumask: always use nr\_cpu\_ids in formatting and
parsing functions") converted both cpumask printing and parsing
functions to use nr\_cpu\_ids instead of nr\_cpumask\_bits. While this was
okay for the printing functions as it just picked one of the two output
formats that we were alternating between depending on a kernel config,
doing the same for parsing wasn't okay.
nr\_cpumask\_bits can be either nr\_cpu\_ids or NR\_CPUS. We can always use
nr\_cpu\_ids but that is a variable while NR\_CPUS is a constant, so it can
be more efficient to use NR\_CPUS when we can get away with it.
Converting the printing functions to nr\_cpu\_ids makes sense because it
affects how the masks get presented to userspace and doesn't break
anything; however, using nr\_cpu\_ids for parsing functions can
incorrectly leave the higher bits uninitialized while reading in these
masks from userland. As all testing and comparison functions use
nr\_cpumask\_bits which can be larger than nr\_cpu\_ids, the parsed cpumasks
can erroneously yield false negative results.
This made the taskstats interface incorrectly return -EINVAL even when
the inputs were correct.
Fix it by restoring the parse functions to use nr\_cpumask\_bits instead
of nr\_cpu\_ids.
Link: http://lkml.kernel.org/r/20170206182442.GB31078@htj.duckdns.org
Fixes: 513e3d2d11c9 ("cpumask: always use nr\_cpu\_ids in formatting and parsing functions")
Signed-off-by: Tejun Heo
Reported-by: Martin Steigerwald
Debugged-by: Ben Hutchings
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit d2485c03ce8db7246e2b00cb8d9af82cea32ab60
Author: Jurij Smakov
Date: Mon Jan 30 15:41:36 2017 -0600
rtlwifi: rtl8192ce: Fix loading of incorrect firmware
commit 52f5631a4c056ad01682393be56d2be237e81610 upstream.
In commit cf4747d7535a ("rtlwifi: Fix regression caused by commit
d86e64768859, an error in the edit results in the wrong firmware
being loaded for some models of the RTL8188/8192CE. In this condition,
the connection suffered from high ping latency, slow transfer rates,
and required higher signal strengths to work at all
See https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=853073,
https://bugzilla.opensuse.org/show\_bug.cgi?id=1017471, and
https://github.com/lwfinger/rtlwifi\_new/issues/203 for descriptions
of the problems. This patch fixes all of those problems.
Fixes: cf4747d7535a ("rtlwifi: Fix regression caused by commit d86e64768859")
Signed-off-by: Jurij Smakov
Signed-off-by: Larry Finger
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit d9985610c6bee5998db6d0b39d06cbbc5447e7e1
Author: Linus Torvalds
Date: Wed Feb 8 18:08:29 2017 -0800
Revert "x86/ioapic: Restore IO-APIC irq\_chip retrigger callback"
commit d966564fcdc19e13eb6ba1fbe6b8101070339c3d upstream.
This reverts commit 020eb3daaba2857b32c4cf4c82f503d6a00a67de.
Gabriel C reports that it causes his machine to not boot, and we haven't
tracked down the reason for it yet. Since the bug it fixes has been
around for a longish time, we're better off reverting the fix for now.
Gabriel says:
"It hangs early and freezes with a lot RCU warnings.
I bisected it down to :
> Ruslan Ruslichenko (1):
> x86/ioapic: Restore IO-APIC irq\_chip retrigger callback
Reverting this one fixes the problem for me..
The box is a PRIMERGY TX200 S5 , 2 socket , 2 x E5520 CPU(s) installed"
and Ruslan and Thomas are currently stumped.
Reported-and-bisected-by: Gabriel C
Cc: Ruslan Ruslichenko
Cc: Thomas Gleixner
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 6cbaf7b94373743deb42fd410173aab81f8945fe
Author: Stephen Smalley
Date: Tue Jan 31 11:54:04 2017 -0500
selinux: fix off-by-one in setprocattr
commit 0c461cb727d146c9ef2d3e86214f498b78b7d125 upstream.
SELinux tries to support setting/clearing of /proc/pid/attr attributes
from the shell by ignoring terminating newlines and treating an
attribute value that begins with a NUL or newline as an attempt to
clear the attribute. However, the test for clearing attributes has
always been wrong; it has an off-by-one error, and this could further
lead to reading past the end of the allocated buffer since commit
bb646cdb12e75d82258c2f2e7746d5952d3e321a ("proc\_pid\_attr\_write():
switch to memdup\_user()"). Fix the off-by-one error.
Even with this fix, setting and clearing /proc/pid/attr attributes
from the shell is not straightforward since the interface does not
support multiple write() calls (so shells that write the value and
newline separately will set and then immediately clear the attribute,
requiring use of echo -n to set the attribute), whereas trying to use
echo -n "" to clear the attribute causes the shell to skip the
write() call altogether since POSIX says that a zero-length write
causes no side effects. Thus, one must use echo -n to set and echo
without -n to clear, as in the following example:
$ echo -n unconfined\_u:object\_r:user\_home\_t:s0 > /proc/$$/attr/fscreate
$ cat /proc/$$/attr/fscreate
unconfined\_u:object\_r:user\_home\_t:s0
$ echo "" > /proc/$$/attr/fscreate
$ cat /proc/$$/attr/fscreate
Note the use of /proc/$$ rather than /proc/self, as otherwise
the cat command will read its own attribute value, not that of the shell.
There are no users of this facility to my knowledge; possibly we
should just get rid of it.
UPDATE: Upon further investigation it appears that a local process
with the process:setfscreate permission can cause a kernel panic as a
result of this bug. This patch fixes CVE-2017-2618.
Signed-off-by: Stephen Smalley
[PM: added the update about CVE-2017-2618 to the commit description]
Signed-off-by: Paul Moore
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: James Morris
commit 2089e4563d50c44f187df1ed63a906e05708cf51
Author: Dmitry Torokhov
Date: Tue Jan 31 14:56:43 2017 -0800
Input: uinput - fix crash when mixing old and new init style
commit 601bbbe0517303c9f8eb3d75e11d64efed1293c9 upstream.
If user tries to initialize uinput device mixing old and new style
initialization (i.e. using old UI\_SET\_ABSBIT instead of UI\_ABS\_SETUP,
we forget to allocate input->absinfo and will crash when trying to send
absolute events:
ioctl(ui, UI\_DEV\_SETUP, &us);
ioctl(ui, UI\_SET\_PHYS, "Test");
ioctl(ui, UI\_SET\_EVBIT, EV\_ABS);
ioctl(ui, UI\_SET\_ABSBIT, ABS\_X);
ioctl(ui, UI\_SET\_ABSBIT, ABS\_Y);
ioctl(ui, UI\_DEV\_CREATE, 0);
Reported-by: Rodrigo Rivas Costa
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=191811
Fixes: fbae10db0940 ("Input: uinput - rework ABS validation")
Reviewed-by: Benjamin Tissoires
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 1a815c52d57ebf35bfb516eafada98eeda292d66
Author: Vineet Gupta
Date: Tue Feb 7 09:44:58 2017 -0800
ARC: [arcompact] brown paper bag bug in unaligned access delay slot fixup
commit a524c218bc94c705886a0e0fedeee45d1931da32 upstream.
Reported-by: Jo-Philipp Wich
Fixes: 9aed02feae57bf7 ("ARC: [arcompact] handle unaligned access delay slot")
Cc: linux-kernel@vger.kernel.org
Cc: linux-snps-arc@lists.infradead.org
Signed-off-by: Vineet Gupta
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit f77e7b119ff18d4732b6e08b3d10c4e324de9442
Author: Gary R Hook
Date: Fri Jan 27 17:09:04 2017 -0600
crypto: ccp - Fix double add when creating new DMA command
commit e5da5c5667381d2772374ee6a2967b3576c9483d upstream.
Eliminate a double-add by creating a new list to manage
command descriptors when created; move the descriptor to
the pending list when the command is submitted.
Signed-off-by: Gary R Hook
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 1105ccf25118894ffde5b50d43c52b9e39fe3fc9
Author: Gary R Hook
Date: Fri Jan 27 15:28:45 2017 -0600
crypto: ccp - Fix DMA operations when IOMMU is enabled
commit 500c0106e638e08c2c661c305ed57d6b67e10908 upstream.
An I/O page fault occurs when the IOMMU is enabled on a
system that supports the v5 CCP. DMA operations use a
Request ID value that does not match what is expected by
the IOMMU, resulting in the I/O page fault. Setting the
Request ID value to 0 corrects this issue.
Signed-off-by: Gary R Hook
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit d7aa88a14eb059cdc9c82206cd3ee8ccb6f62ee6
Author: Giovanni Cabiddu
Date: Thu Dec 22 15:00:24 2016 +0000
crypto: qat - zero esram only for DH85x devices
commit 685ce0626840e2673fe64ea8807684f7324fec5f upstream.
Zero embedded ram in DH85x devices. This is not
needed for newer generations as it is done by HW.
Signed-off-by: Giovanni Cabiddu
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 2d5dd056884e147a369aa1f6aa786e65a36e624a
Author: Giovanni Cabiddu
Date: Thu Dec 22 15:00:12 2016 +0000
crypto: qat - fix bar discovery for c62x
commit 3484ecbe0e9deb94afb0b9b6172d77e98eb72b94 upstream.
Some accelerators of the c62x series have only two bars.
This patch skips BAR0 if the accelerator does not have it.
Signed-off-by: Giovanni Cabiddu
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit b4de8af91b8ab9a604a5acd78b0d8763cf5818b5
Author: Harsh Jain
Date: Tue Jan 24 10:34:33 2017 +0530
crypto: chcr - Check device is allocated before use
commit f5f7bebc91ab378dea5aad5277c4d283e46472d9 upstream.
Ensure dev is allocated for crypto uld context before using the device
for crypto operations.
Signed-off-by: Atul Gupta
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 066a7166c5412ea4c04b1946faf2aa7cda48ee60
Author: Harsh Jain
Date: Wed Feb 1 21:10:28 2017 +0530
crypto: algif\_aead - Fix kernel panic on list\_del
commit 0b529f143e8baad441a5aac9ad55ec2434d8fb46 upstream.
Kernel panics when userspace program try to access AEAD interface.
Remove node from Linked List before freeing its memory.
Signed-off-by: Harsh Jain
Reviewed-by: Stephan Müller
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 621d101a7ebb7965ee3332e4e6e8d17bdd8f0555
Author: Mike Snitzer
Date: Wed Jan 25 16:24:52 2017 +0100
dm rq: cope with DM device destruction while in dm\_old\_request\_fn()
commit 4087a1fffe38106e10646606a27f10d40451862d upstream.
Fixes a crash in dm\_table\_find\_target() due to a NULL struct dm\_table
being passed from dm\_old\_request\_fn() that races with DM device
destruction.
Reported-by: artem@flashgrid.io
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit cd755677d9444d718ac04a693523c9ff5a7f79ec
Author: Dan Williams
Date: Sat Feb 4 14:47:31 2017 -0800
libnvdimm, pfn: fix memmap reservation size versus 4K alignment
commit bfb34527a32a1a576d9bfb7026d3ab0369a6cd60 upstream.
When vmemmap\_populate() allocates space for the memmap it does so in 2MB
sized chunks. The libnvdimm-pfn driver incorrectly accounts for this
when the alignment of the device is set to 4K. When this happens we
trigger memory allocation failures in altmap\_alloc\_block\_buf() and
trigger warnings of the form:
WARNING: CPU: 0 PID: 3376 at arch/x86/mm/init\_64.c:656 arch\_add\_memory+0xe4/0xf0
[..]
Call Trace:
dump\_stack+0x86/0xc3
\_\_warn+0xcb/0xf0
warn\_slowpath\_null+0x1d/0x20
arch\_add\_memory+0xe4/0xf0
devm\_memremap\_pages+0x29b/0x4e0
Fixes: 315c562536c4 ("libnvdimm, pfn: add 'align' attribute, default to HPAGE\_SIZE")
Signed-off-by: Dan Williams
Signed-off-by: Greg Kroah-Hartman
commit ebffa7bc77c88218a484a47ab61822943539b252
Author: Dan Williams
Date: Wed Jan 25 00:54:07 2017 +0530
libnvdimm, namespace: do not delete namespace-id 0
commit 9d032f4201d39e5cf43a8709a047e481f5723fdc upstream.
Given that the naming of pmem devices changes from the pmemX form to the
pmemX.Y form when namespace id is greater than 0, arrange for namespaces
with id-0 to be exempt from deletion. Otherwise a simple reconfiguration
of an existing namespace to a new mode results in a name change of the
resulting block device:
# ndctl list --namespace=namespace1.0
{
"dev":"namespace1.0",
"mode":"raw",
"size":2147483648,
"uuid":"3dadf3dc-89b9-4b24-b20e-abc8a4707ce3",
"blockdev":"pmem1"
}
# ndctl create-namespace --reconfig=namespace1.0 --mode=memory --force
{
"dev":"namespace1.1",
"mode":"memory",
"size":2111832064,
"uuid":"7b4a6341-7318-4219-a02c-fb57c0bbf613",
"blockdev":"pmem1.1"
}
This change does require tooling changes to explicitly look for
namespaceX.0 if the seed has already advanced to another namespace.
Fixes: 98a29c39dc68 ("libnvdimm, namespace: allow creation of multiple pmem-namespaces per region")
Reviewed-by: Johannes Thumshirn
Signed-off-by: Dan Williams
Signed-off-by: Greg Kroah-Hartman
commit 46cf1520ed9167f83196022d651f0625152ea79b
Author: Dan Williams
Date: Thu Feb 2 10:31:00 2017 -0800
acpi, nfit: fix acpi\_nfit\_flush\_probe() crash
commit e471486c13b82b1338d49c798f78bb62b1ed0a9e upstream.
We queue an on-stack work item to 'nfit\_wq' and wait for it to complete
as part of a 'flush\_probe' request. However, if the user cancels the
wait we need to make sure the item is flushed from the queue otherwise
we are leaving an out-of-scope stack address on the work list.
BUG: unable to handle kernel paging request at ffffbcb3c72f7cd0
IP: [] \_\_list\_add+0x1b/0xb0
[..]
RIP: 0010:[] [] \_\_list\_add+0x1b/0xb0
RSP: 0018:ffffbcb3c7ba7c00 EFLAGS: 00010046
[..]
Call Trace:
[] insert\_work+0x3a/0xc0
[] ? seq\_open+0x5a/0xa0
[] \_\_queue\_work+0x16a/0x460
[] queue\_work\_on+0x38/0x40
[] acpi\_nfit\_flush\_probe+0x95/0xc0 [nfit]
[] ? nfit\_visible+0x40/0x40 [nfit]
[] wait\_probe\_show+0x25/0x60
[] dev\_attr\_show+0x20/0x50
Fixes: 7ae0fa439faf ("nfit, libnvdimm: async region scrub workqueue")
Reviewed-by: Vishal Verma
Signed-off-by: Dan Williams
Signed-off-by: Greg Kroah-Hartman
commit a6b1dc61bcf45fbc03a2e62f007cd36410e5e269
Author: Srinivas Pandruvada
Date: Fri Feb 3 14:18:39 2017 -0800
cpufreq: intel\_pstate: Disable energy efficiency optimization
commit 6e978b22efa1db9f6e71b24440b5f1d93e968ee3 upstream.
Some Kabylake desktop processors may not reach max turbo when running in
HWP mode, even if running under sustained 100% utilization.
This occurs when the HWP.EPP (Energy Performance Preference) is set to
"balance\_power" (0x80) -- the default on most systems.
It occurs because the platform BIOS may erroneously enable an
energy-efficiency setting -- MSR\_IA32\_POWER\_CTL BIT-EE, which is not
recommended to be enabled on this SKU.
On the failing systems, this BIOS issue was not discovered when the
desktop motherboard was tested with Windows, because the BIOS also
neglects to provide the ACPI/CPPC table, that Windows requires to enable
HWP, and so Windows runs in legacy P-state mode, where this setting has
no effect.
Linux' intel\_pstate driver does not require ACPI/CPPC to enable HWP, and
so it runs in HWP mode, exposing this incorrect BIOS configuration.
There are several ways to address this problem.
First, Linux can also run in legacy P-state mode on this system.
As intel\_pstate is how Linux enables HWP, booting with
"intel\_pstate=disable"
will run in acpi-cpufreq/ondemand legacy p-state mode.
Or second, the "performance" governor can be used with intel\_pstate,
which will modify HWP.EPP to 0.
Or third, starting in 4.10, the
/sys/devices/system/cpu/cpufreq/policy\*/energy\_performance\_preference
attribute in can be updated from "balance\_power" to "performance".
Or fourth, apply this patch, which fixes the erroneous setting of
MSR\_IA32\_POWER\_CTL BIT\_EE on this model, allowing the default
configuration to function as designed.
Signed-off-by: Srinivas Pandruvada
Reviewed-by: Len Brown
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman


=== Content from github.com_001766b8_20250124_230815.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F647bf3d8a8e5777319da92af672289b2a6c4dc66)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F647bf3d8a8e5777319da92af672289b2a6c4dc66)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/647bf3d8a8e5777319da92af672289b2a6c4dc66)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

IB/rxe: Fix mem\_check\_range integer overflow

[Browse files](/torvalds/linux/tree/647bf3d8a8e5777319da92af672289b2a6c4dc66)
Browse the repository at this point in the history

```
Update the range check to avoid integer-overflow in edge case.
Resolves CVE 2016-8636.

Signed-off-by: Eyal Itkin <eyal.itkin@gmail.com>
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Reviewed-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Doug Ledford <dledford@redhat.com>
```

* Loading branch information

[![@eyalitki](https://avatars.githubusercontent.com/u/5611356?s=40&v=4)](/eyalitki) [![@dledford](https://avatars.githubusercontent.com/u/1071125?s=40&v=4)](/dledford)

[eyalitki](/torvalds/linux/commits?author=eyalitki "View all commits by eyalitki")
authored and
[dledford](/torvalds/linux/commits?author=dledford "View all commits by dledford")
committed
Feb 8, 2017

1 parent
[628f07d](/torvalds/linux/commit/628f07d33c1f2e7bf31e0a4a988bb07914bd5e73)

commit 647bf3d

Showing
**1 changed file**
with
**5 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

8 changes: 5 additions & 3 deletions

8
[drivers/infiniband/sw/rxe/rxe\_mr.c](#diff-55d7b6e97f5d4519fc286bb3882a5f3f1717d76b5d5bf868c6e9e3eefa6ebc8a "drivers/infiniband/sw/rxe/rxe_mr.c")

Show comments

[View file](/torvalds/linux/blob/647bf3d8a8e5777319da92af672289b2a6c4dc66/drivers/infiniband/sw/rxe/rxe_mr.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -59,9 +59,11 @@ int mem\_check\_range(struct rxe\_mem \*mem, u64 iova, size\_t length) |
|  |  |  |
|  |  | case RXE\_MEM\_TYPE\_MR: |
|  |  | case RXE\_MEM\_TYPE\_FMR: |
|  |  | return ((iova < mem->iova) || |
|  |  | ((iova + length) > (mem->iova + mem->length))) ? |
|  |  | -EFAULT : 0; |
|  |  | if (iova < mem->iova || |
|  |  | length > mem->length || |
|  |  | iova > mem->iova + mem->length - length) |
|  |  | return -EFAULT; |
|  |  | return 0; |
|  |  |  |
|  |  | default: |
|  |  | return -EFAULT; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `647bf3d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F647bf3d8a8e5777319da92af672289b2a6c4dc66) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from access.redhat.com_5ff3d663_20250126_042102.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


