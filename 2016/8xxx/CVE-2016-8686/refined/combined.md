=== Content from www.openwall.com_86ccf708_20250125_152940.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](9) [[next>]](11) [[<thread-prev]](../../../2016/10/10/1) [[thread-next>]](../../../2016/10/21/6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <20161016025812.1F72742E008@smtpvbsrv1.mitre.org>
Date: Sat, 15 Oct 2016 22:58:12 -0400 (EDT)
From: cve-assign@...re.org
To: ago@...too.org
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: potrace: memory allocation failure

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

> <https://blogs.gentoo.org/ago/2016/08/29/potrace-memory-allocation-failure>

> AddressSanitizer failed to allocate 0x200003000 bytes of LargeMmapAllocator

Use CVE-2016-8686.

- --
CVE Assignment Team
M/S M300, 202 Burlington Road, Bedford, MA 01730 USA
[ A PGP key is available for encrypted communications at
  <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCAAGBQJYAud7AAoJEHb/MwWLVhi2mLoP+gOHwdcHB9ST9f6s+cXdsw5L
CNiHdy5X+nYHsvDCYqZq8v5x+wCcSzAKzdMyU/VhWMQVLWMKNKXfL+qm/EI67L9m
+7CG8d0G1pWuES1ynTn078ZS/wxIkudo5keiyCWGLl6ckJp0YLcQhCVC1fARNh9T
5bTetm3By5PzKGxvQO0NOOHo53Tn3bTZSf30fXqwb/qce2boMw1uD0eupRkqEwtN
jGLQYVN+31RvhJe42ojZU3NaB7XOhxZURrejLVjgjp8hSOAvSKsqP4AsECO8Dckv
9/MVc+duI35gecZ8gZHjPiMt1mlDvJrG+5fPXnbL0g7IG4VOiwCrzVkxiRGTsyE7
Dcy/JGivXOZmq2ZzB6sWT7jvKVne9/5eOKTl40ldv0Gl4XnEgoKr8lADEA8C5/5p
8+yWIj/wpap5TES5k32Yh24jkEYtOTxPwkwIvIZxIfyGqT2Tx/vG20EML7nC+gXd
fxjUrXuHIjwFoBxQ7tzArv4V9/zheGVXozTjvKoNRYkzpHcE33Q9zDIBy9dUTdkL
/8AALluIu/CQo3Rmfw//6IOVCUXCWmqyj1dWTJNI6Y9Cn7uyKmnDAhbwO82xC9NE
4FOu0TtpHWqsFQeSNbAjK7RK0bM8oFK9zK0ECUzFkci5b9HqIWn8XluBPn//exQt
DC56la9Lf9FJgtXtaUa0
=PZwg
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from blogs.gentoo.org_c013f0b4_20250125_152941.html ===


[agostino's blog](https://blogs.gentoo.org/ago/ "agostino's blog")

my fuzzer always find something more than your…
![](https://blogs.gentoo.org/ago/files/2015/06/cropped-modificato2.png)

[Skip to content](#content "Skip to content")

* [About me](https://blogs.gentoo.org/ago/agostino_sarubbo/)
* [Contact](https://blogs.gentoo.org/ago/contact/)
* [Advisories](https://blogs.gentoo.org/ago/advisories/)

[← potrace: invalid memory access in findnext (decompose.c)](https://blogs.gentoo.org/ago/2016/08/29/potrace-invalid-memory-access-in-findnext-decompose-c/)
[ettercap: etterlog: multiple (three) heap-based buffer overflow (el\_profiles.c) →](https://blogs.gentoo.org/ago/2016/09/06/ettercap-etterlog-multiple-three-heap-based-buffer-overflow-el_profiles-c/)

# potrace: memory allocation failure in bm\_new (bitmap.h)

Posted on [August 29, 2016](https://blogs.gentoo.org/ago/2016/08/29/potrace-memory-allocation-failure/ "7:23 pm") by [ago](https://blogs.gentoo.org/ago/author/ago/ "View all posts by ago")

**Description**:

[potrace](http://potrace.sourceforge.net/) is a utility that transforms bitmaps into vector graphics.

A crafted image, through a fuzz testing, causes the memory allocation to fail.

Asan stacktrace:

```
# potrace $FILE
==19351==ERROR: AddressSanitizer failed to allocate 0x200003000 (8589946880) bytes of LargeMmapAllocator (error code: 12)
==19351==Process memory map follows:
        0x000000400000-0x00000056d000   /usr/bin/potrace
        0x00000076c000-0x00000076d000   /usr/bin/potrace
        0x00000076d000-0x000000778000   /usr/bin/potrace
        0x000000778000-0x000001401000
        0x00007fff7000-0x00008fff7000
        0x00008fff7000-0x02008fff7000
        0x02008fff7000-0x10007fff8000
        0x600000000000-0x602000000000
        0x602000000000-0x602000010000
        0x602000010000-0x603000000000
        0x603000000000-0x603000010000
        0x603000010000-0x607000000000
        0x607000000000-0x607000010000
        0x607000010000-0x616000000000
        0x616000000000-0x616000020000
        0x616000020000-0x619000000000
        0x619000000000-0x619000020000
        0x619000020000-0x640000000000
        0x640000000000-0x640000003000
        0x7f1674c00000-0x7f1674d00000
        0x7f1674e00000-0x7f1674f00000
        0x7f1674fea000-0x7f167733c000
        0x7f167733c000-0x7f16774cf000   /lib64/libc-2.22.so
        0x7f16774cf000-0x7f16776cf000   /lib64/libc-2.22.so
        0x7f16776cf000-0x7f16776d3000   /lib64/libc-2.22.so
        0x7f16776d3000-0x7f16776d5000   /lib64/libc-2.22.so
        0x7f16776d5000-0x7f16776d9000
        0x7f16776d9000-0x7f16776ef000   /usr/lib64/gcc/x86_64-pc-linux-gnu/4.9.3/libgcc_s.so.1
        0x7f16776ef000-0x7f16778ee000   /usr/lib64/gcc/x86_64-pc-linux-gnu/4.9.3/libgcc_s.so.1
        0x7f16778ee000-0x7f16778ef000   /usr/lib64/gcc/x86_64-pc-linux-gnu/4.9.3/libgcc_s.so.1
        0x7f16778ef000-0x7f16778f0000   /usr/lib64/gcc/x86_64-pc-linux-gnu/4.9.3/libgcc_s.so.1
        0x7f16778f0000-0x7f16778f2000   /lib64/libdl-2.22.so
        0x7f16778f2000-0x7f1677af2000   /lib64/libdl-2.22.so
        0x7f1677af2000-0x7f1677af3000   /lib64/libdl-2.22.so
        0x7f1677af3000-0x7f1677af4000   /lib64/libdl-2.22.so
        0x7f1677af4000-0x7f1677afa000   /lib64/librt-2.22.so
        0x7f1677afa000-0x7f1677cfa000   /lib64/librt-2.22.so
        0x7f1677cfa000-0x7f1677cfb000   /lib64/librt-2.22.so
        0x7f1677cfb000-0x7f1677cfc000   /lib64/librt-2.22.so
        0x7f1677cfc000-0x7f1677d13000   /lib64/libpthread-2.22.so
        0x7f1677d13000-0x7f1677f12000   /lib64/libpthread-2.22.so
        0x7f1677f12000-0x7f1677f13000   /lib64/libpthread-2.22.so
        0x7f1677f13000-0x7f1677f14000   /lib64/libpthread-2.22.so
        0x7f1677f14000-0x7f1677f18000
        0x7f1677f18000-0x7f1677f2d000   /lib64/libz.so.1.2.8
        0x7f1677f2d000-0x7f167812c000   /lib64/libz.so.1.2.8
        0x7f167812c000-0x7f167812d000   /lib64/libz.so.1.2.8
        0x7f167812d000-0x7f167812e000   /lib64/libz.so.1.2.8
        0x7f167812e000-0x7f167822b000   /lib64/libm-2.22.so
        0x7f167822b000-0x7f167842a000   /lib64/libm-2.22.so
        0x7f167842a000-0x7f167842b000   /lib64/libm-2.22.so
        0x7f167842b000-0x7f167842c000   /lib64/libm-2.22.so
        0x7f167842c000-0x7f1678443000   /usr/lib64/libpotrace.so.0.0.3
        0x7f1678443000-0x7f1678642000   /usr/lib64/libpotrace.so.0.0.3
        0x7f1678642000-0x7f1678643000   /usr/lib64/libpotrace.so.0.0.3
        0x7f1678643000-0x7f1678644000   /usr/lib64/libpotrace.so.0.0.3
        0x7f1678644000-0x7f1678666000   /lib64/ld-2.22.so
        0x7f16787fd000-0x7f167885a000
        0x7f167885a000-0x7f1678865000
        0x7f1678865000-0x7f1678866000   /lib64/ld-2.22.so
        0x7f1678866000-0x7f1678867000   /lib64/ld-2.22.so
        0x7f1678867000-0x7f1678868000
        0x7fffd7a71000-0x7fffd7a92000   [stack]
        0x7fffd7aa4000-0x7fffd7aa6000   [vvar]
        0x7fffd7aa6000-0x7fffd7aa8000   [vdso]
        0xffffffffff600000-0xffffffffff601000   [vsyscall]
==19351==End of process memory map.
==19351==AddressSanitizer CHECK failed: /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/sanitizer_common/sanitizer_common.cc:183 "((0 && "unable to mmap")) != (0)" (0x0, 0x0)
    #0 0x4c9f1d in AsanCheckFailed /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/asan_rtl.cc:67
    #1 0x4d0a53 in __sanitizer::CheckFailed(char const*, int, char const*, unsigned long long, unsigned long long) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/sanitizer_common/sanitizer_common.cc:159
    #2 0x4d0c41 in __sanitizer::ReportMmapFailureAndDie(unsigned long, char const*, char const*, int, bool) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/sanitizer_common/sanitizer_common.cc:183
    #3 0x4d9c7a in __sanitizer::MmapOrDie(unsigned long, char const*, bool) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/sanitizer_common/sanitizer_posix.cc:122
    #4 0x42200f in __sanitizer::LargeMmapAllocator::Allocate(__sanitizer::AllocatorStats*, unsigned long, unsigned long) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/../sanitizer_common/sanitizer_allocator.h:1033
    #5 0x42200f in __sanitizer::CombinedAllocator<__sanitizer::SizeClassAllocator64<105553116266496ul, 4398046511104ul, 0ul, __sanitizer::SizeClassMap, __asan::AsanMapUnmapCallback>, __sanitizer::SizeClassAllocatorLocalCache<__sanitizer::SizeClassAllocator64<105553116266496ul, 4398046511104ul, 0ul, __sanitizer::SizeClassMap, __asan::AsanMapUnmapCallback> >, __sanitizer::LargeMmapAllocator >::Allocate(__sanitizer::SizeClassAllocatorLocalCache<__sanitizer::SizeClassAllocator64<105553116266496ul, 4398046511104ul, 0ul, __sanitizer::SizeClassMap, __asan::AsanMapUnmapCallback> >*, unsigned long, unsigned long, bool, bool) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/../sanitizer_common/sanitizer_allocator.h:1302
    #6 0x42200f in __asan::Allocator::Allocate(unsigned long, unsigned long, __sanitizer::BufferedStackTrace*, __asan::AllocType, bool) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/asan_allocator.cc:368
    #7 0x42200f in __asan::asan_malloc(unsigned long, __sanitizer::BufferedStackTrace*) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/asan_allocator.cc:718
    #8 0x4c05e1 in malloc /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:53
    #9 0x500bcb in bm_new /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/bitmap.h:76:30
    #10 0x500bcb in bm_readbody_bmp /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/bitmap_io.c:559
    #11 0x500bcb in bm_read /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/bitmap_io.c:133
    #12 0x4f8608 in process_file /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/main.c:1058:9
    #13 0x4f5904 in main /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/main.c:1214:7
    #14 0x7f167735c61f in __libc_start_main /var/tmp/portage/sys-libs/glibc-2.22-r4/work/glibc-2.22/csu/libc-start.c:289
    #15 0x4190b8 in getenv (/usr/bin/potrace+0x4190b8)

```

**Affected version:**

1.13

**Fixed version:**

1.14

**Commit fix:**

N/A

**Credit:**

This bug was discovered by Agostino Sarubbo of Gentoo.

**CVE:**

CVE-2016-8686

**Timeline:**

2016-08-26: bug discovered

2016-08-27: bug reported privately to upstream

2016-08-29: blog post about the issue

2016-10-16: CVE Assigned

2016-10-21: Added correct stacktrace

2017-02-20: upstream released 1.14

**Note:**

This bug was found with [American Fuzzy Lop](http://lcamtuf.coredump.cx/afl).

**Permalink:**

> [potrace: memory allocation failure in bm\_new (bitmap.h)](http://blogs.gentoo.org/ago/2016/08/29/potrace-memory-allocation-failure/)

This entry was posted in [advisories](https://blogs.gentoo.org/ago/category/advisories/), [security](https://blogs.gentoo.org/ago/category/security/). Bookmark the [permalink](https://blogs.gentoo.org/ago/2016/08/29/potrace-memory-allocation-failure/ "Permalink to potrace: memory allocation failure in bm_new (bitmap.h)").

[← potrace: invalid memory access in findnext (decompose.c)](https://blogs.gentoo.org/ago/2016/08/29/potrace-invalid-memory-access-in-findnext-decompose-c/)
[ettercap: etterlog: multiple (three) heap-based buffer overflow (el\_profiles.c) →](https://blogs.gentoo.org/ago/2016/09/06/ettercap-etterlog-multiple-three-heap-based-buffer-overflow-el_profiles-c/)

### Leave a Reply [Cancel reply](/ago/2016/08/29/potrace-memory-allocation-failure/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

 Notify me of follow-up comments by email.

 Notify me of new posts by email.

Authenticate this comment using OpenID.

Δ

This site uses Akismet to reduce spam. [Learn how your comment data is processed](https://akismet.com/privacy/).

* Search for:
* ### Recent Posts

  + [gentoo tinderbox](https://blogs.gentoo.org/ago/2020/07/04/gentoo-tinderbox/)
  + [re2c: heap overflow in Scanner::fill (scanner.cc)](https://blogs.gentoo.org/ago/2020/04/19/re2c-heap-overflow-in-scannerfill-scanner-cc/)
  + [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/)
  + [Install Gentoo in less than one minute](https://blogs.gentoo.org/ago/2019/03/20/install-gentoo-in-less-than-one-minute/)
  + [binutils: invalid memory read in find\_abstract\_instance\_name (dwarf2.c)](https://blogs.gentoo.org/ago/2017/10/24/binutils-invalid-memory-read-in-find_abstract_instance_name-dwarf2-c/)
* ### Recent Comments

  + strongcourage on [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/#comment-181437)
  + [Bob Friesenhahn](http://www.graphicsmagick.org/) on [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/#comment-181419)
  + [#gentoo dev: Why I stopped fuzzing research https://blogs.gentoo.or… | Dr. Roy Schestowitz (罗伊)](https://placeholderapi.wordpress.com/2020/04/18/gentoo-dev-why-i-stopped-fuzzing-research-https-blogs-gentoo-or/) on [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/#comment-181400)
  + Ulya on [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/#comment-181396)
  + ago on [Install Gentoo in less than one minute](https://blogs.gentoo.org/ago/2019/03/20/install-gentoo-in-less-than-one-minute/#comment-178429)
* ### Archives

  + [July 2020](https://blogs.gentoo.org/ago/2020/07/)
  + [April 2020](https://blogs.gentoo.org/ago/2020/04/)
  + [March 2019](https://blogs.gentoo.org/ago/2019/03/)
  + [October 2017](https://blogs.gentoo.org/ago/2017/10/)
  + [September 2017](https://blogs.gentoo.org/ago/2017/09/)
  + [August 2017](https://blogs.gentoo.org/ago/2017/08/)
  + [July 2017](https://blogs.gentoo.org/ago/2017/07/)
  + [June 2017](https://blogs.gentoo.org/ago/2017/06/)
  + [May 2017](https://blogs.gentoo.org/ago/2017/05/)
  + [April 2017](https://blogs.gentoo.org/ago/2017/04/)
  + [March 2017](https://blogs.gentoo.org/ago/2017/03/)
  + [February 2017](https://blogs.gentoo.org/ago/2017/02/)
  + [January 2017](https://blogs.gentoo.org/ago/2017/01/)
  + [December 2016](https://blogs.gentoo.org/ago/2016/12/)
  + [November 2016](https://blogs.gentoo.org/ago/2016/11/)
  + [October 2016](https://blogs.gentoo.org/ago/2016/10/)
  + [September 2016](https://blogs.gentoo.org/ago/2016/09/)
  + [August 2016](https://blogs.gentoo.org/ago/2016/08/)
  + [July 2016](https://blogs.gentoo.org/ago/2016/07/)
  + [February 2016](https://blogs.gentoo.org/ago/2016/02/)
  + [July 2015](https://blogs.gentoo.org/ago/2015/07/)
  + [August 2013](https://blogs.gentoo.org/ago/2013/08/)
  + [June 2013](https://blogs.gentoo.org/ago/2013/06/)
  + [May 2013](https://blogs.gentoo.org/ago/2013/05/)
  + [January 2013](https://blogs.gentoo.org/ago/2013/01/)
  + [December 2012](https://blogs.gentoo.org/ago/2012/12/)
  + [November 2012](https://blogs.gentoo.org/ago/2012/11/)
  + [October 2012](https://blogs.gentoo.org/ago/2012/10/)
  + [August 2012](https://blogs.gentoo.org/ago/2012/08/)
  + [July 2012](https://blogs.gentoo.org/ago/2012/07/)
  + [June 2012](https://blogs.gentoo.org/ago/2012/06/)
* ### Categories

  + [advisories](https://blogs.gentoo.org/ago/category/advisories/)
  + [arch testing](https://blogs.gentoo.org/ago/category/arch-testing/)
  + [gentoo](https://blogs.gentoo.org/ago/category/gentoo/)
  + [security](https://blogs.gentoo.org/ago/category/security/)
* ### Meta

  + [Log in](https://blogs.gentoo.org/ago/wp-login.php)
  + [Entries feed](https://blogs.gentoo.org/ago/feed/)
  + [Comments feed](https://blogs.gentoo.org/ago/comments/feed/)
  + [WordPress.org](https://wordpress.org/)

[agostino's blog](https://blogs.gentoo.org/ago/ "agostino's blog")
Original theme twentyten, modified by csslayer. Better experience in firefox and webkit.

[Proudly powered by WordPress.](http://wordpress.org/ "Semantic Personal Publishing Platform")



=== Content from blogs.gentoo.org_2abe851e_20250126_095459.html ===


[agostino's blog](https://blogs.gentoo.org/ago/ "agostino's blog")

my fuzzer always find something more than your…
![](https://blogs.gentoo.org/ago/files/2015/06/cropped-modificato2.png)

[Skip to content](#content "Skip to content")

* [About me](https://blogs.gentoo.org/ago/agostino_sarubbo/)
* [Contact](https://blogs.gentoo.org/ago/contact/)
* [Advisories](https://blogs.gentoo.org/ago/advisories/)

[← potrace: invalid memory access in findnext (decompose.c)](https://blogs.gentoo.org/ago/2016/08/29/potrace-invalid-memory-access-in-findnext-decompose-c/)
[ettercap: etterlog: multiple (three) heap-based buffer overflow (el\_profiles.c) →](https://blogs.gentoo.org/ago/2016/09/06/ettercap-etterlog-multiple-three-heap-based-buffer-overflow-el_profiles-c/)

# potrace: memory allocation failure in bm\_new (bitmap.h)

Posted on [August 29, 2016](https://blogs.gentoo.org/ago/2016/08/29/potrace-memory-allocation-failure/ "7:23 pm") by [ago](https://blogs.gentoo.org/ago/author/ago/ "View all posts by ago")

**Description**:

[potrace](http://potrace.sourceforge.net/) is a utility that transforms bitmaps into vector graphics.

A crafted image, through a fuzz testing, causes the memory allocation to fail.

Asan stacktrace:

```
# potrace $FILE
==19351==ERROR: AddressSanitizer failed to allocate 0x200003000 (8589946880) bytes of LargeMmapAllocator (error code: 12)
==19351==Process memory map follows:
        0x000000400000-0x00000056d000   /usr/bin/potrace
        0x00000076c000-0x00000076d000   /usr/bin/potrace
        0x00000076d000-0x000000778000   /usr/bin/potrace
        0x000000778000-0x000001401000
        0x00007fff7000-0x00008fff7000
        0x00008fff7000-0x02008fff7000
        0x02008fff7000-0x10007fff8000
        0x600000000000-0x602000000000
        0x602000000000-0x602000010000
        0x602000010000-0x603000000000
        0x603000000000-0x603000010000
        0x603000010000-0x607000000000
        0x607000000000-0x607000010000
        0x607000010000-0x616000000000
        0x616000000000-0x616000020000
        0x616000020000-0x619000000000
        0x619000000000-0x619000020000
        0x619000020000-0x640000000000
        0x640000000000-0x640000003000
        0x7f1674c00000-0x7f1674d00000
        0x7f1674e00000-0x7f1674f00000
        0x7f1674fea000-0x7f167733c000
        0x7f167733c000-0x7f16774cf000   /lib64/libc-2.22.so
        0x7f16774cf000-0x7f16776cf000   /lib64/libc-2.22.so
        0x7f16776cf000-0x7f16776d3000   /lib64/libc-2.22.so
        0x7f16776d3000-0x7f16776d5000   /lib64/libc-2.22.so
        0x7f16776d5000-0x7f16776d9000
        0x7f16776d9000-0x7f16776ef000   /usr/lib64/gcc/x86_64-pc-linux-gnu/4.9.3/libgcc_s.so.1
        0x7f16776ef000-0x7f16778ee000   /usr/lib64/gcc/x86_64-pc-linux-gnu/4.9.3/libgcc_s.so.1
        0x7f16778ee000-0x7f16778ef000   /usr/lib64/gcc/x86_64-pc-linux-gnu/4.9.3/libgcc_s.so.1
        0x7f16778ef000-0x7f16778f0000   /usr/lib64/gcc/x86_64-pc-linux-gnu/4.9.3/libgcc_s.so.1
        0x7f16778f0000-0x7f16778f2000   /lib64/libdl-2.22.so
        0x7f16778f2000-0x7f1677af2000   /lib64/libdl-2.22.so
        0x7f1677af2000-0x7f1677af3000   /lib64/libdl-2.22.so
        0x7f1677af3000-0x7f1677af4000   /lib64/libdl-2.22.so
        0x7f1677af4000-0x7f1677afa000   /lib64/librt-2.22.so
        0x7f1677afa000-0x7f1677cfa000   /lib64/librt-2.22.so
        0x7f1677cfa000-0x7f1677cfb000   /lib64/librt-2.22.so
        0x7f1677cfb000-0x7f1677cfc000   /lib64/librt-2.22.so
        0x7f1677cfc000-0x7f1677d13000   /lib64/libpthread-2.22.so
        0x7f1677d13000-0x7f1677f12000   /lib64/libpthread-2.22.so
        0x7f1677f12000-0x7f1677f13000   /lib64/libpthread-2.22.so
        0x7f1677f13000-0x7f1677f14000   /lib64/libpthread-2.22.so
        0x7f1677f14000-0x7f1677f18000
        0x7f1677f18000-0x7f1677f2d000   /lib64/libz.so.1.2.8
        0x7f1677f2d000-0x7f167812c000   /lib64/libz.so.1.2.8
        0x7f167812c000-0x7f167812d000   /lib64/libz.so.1.2.8
        0x7f167812d000-0x7f167812e000   /lib64/libz.so.1.2.8
        0x7f167812e000-0x7f167822b000   /lib64/libm-2.22.so
        0x7f167822b000-0x7f167842a000   /lib64/libm-2.22.so
        0x7f167842a000-0x7f167842b000   /lib64/libm-2.22.so
        0x7f167842b000-0x7f167842c000   /lib64/libm-2.22.so
        0x7f167842c000-0x7f1678443000   /usr/lib64/libpotrace.so.0.0.3
        0x7f1678443000-0x7f1678642000   /usr/lib64/libpotrace.so.0.0.3
        0x7f1678642000-0x7f1678643000   /usr/lib64/libpotrace.so.0.0.3
        0x7f1678643000-0x7f1678644000   /usr/lib64/libpotrace.so.0.0.3
        0x7f1678644000-0x7f1678666000   /lib64/ld-2.22.so
        0x7f16787fd000-0x7f167885a000
        0x7f167885a000-0x7f1678865000
        0x7f1678865000-0x7f1678866000   /lib64/ld-2.22.so
        0x7f1678866000-0x7f1678867000   /lib64/ld-2.22.so
        0x7f1678867000-0x7f1678868000
        0x7fffd7a71000-0x7fffd7a92000   [stack]
        0x7fffd7aa4000-0x7fffd7aa6000   [vvar]
        0x7fffd7aa6000-0x7fffd7aa8000   [vdso]
        0xffffffffff600000-0xffffffffff601000   [vsyscall]
==19351==End of process memory map.
==19351==AddressSanitizer CHECK failed: /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/sanitizer_common/sanitizer_common.cc:183 "((0 && "unable to mmap")) != (0)" (0x0, 0x0)
    #0 0x4c9f1d in AsanCheckFailed /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/asan_rtl.cc:67
    #1 0x4d0a53 in __sanitizer::CheckFailed(char const*, int, char const*, unsigned long long, unsigned long long) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/sanitizer_common/sanitizer_common.cc:159
    #2 0x4d0c41 in __sanitizer::ReportMmapFailureAndDie(unsigned long, char const*, char const*, int, bool) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/sanitizer_common/sanitizer_common.cc:183
    #3 0x4d9c7a in __sanitizer::MmapOrDie(unsigned long, char const*, bool) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/sanitizer_common/sanitizer_posix.cc:122
    #4 0x42200f in __sanitizer::LargeMmapAllocator::Allocate(__sanitizer::AllocatorStats*, unsigned long, unsigned long) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/../sanitizer_common/sanitizer_allocator.h:1033
    #5 0x42200f in __sanitizer::CombinedAllocator<__sanitizer::SizeClassAllocator64<105553116266496ul, 4398046511104ul, 0ul, __sanitizer::SizeClassMap, __asan::AsanMapUnmapCallback>, __sanitizer::SizeClassAllocatorLocalCache<__sanitizer::SizeClassAllocator64<105553116266496ul, 4398046511104ul, 0ul, __sanitizer::SizeClassMap, __asan::AsanMapUnmapCallback> >, __sanitizer::LargeMmapAllocator >::Allocate(__sanitizer::SizeClassAllocatorLocalCache<__sanitizer::SizeClassAllocator64<105553116266496ul, 4398046511104ul, 0ul, __sanitizer::SizeClassMap, __asan::AsanMapUnmapCallback> >*, unsigned long, unsigned long, bool, bool) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/../sanitizer_common/sanitizer_allocator.h:1302
    #6 0x42200f in __asan::Allocator::Allocate(unsigned long, unsigned long, __sanitizer::BufferedStackTrace*, __asan::AllocType, bool) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/asan_allocator.cc:368
    #7 0x42200f in __asan::asan_malloc(unsigned long, __sanitizer::BufferedStackTrace*) /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/asan_allocator.cc:718
    #8 0x4c05e1 in malloc /var/tmp/portage/sys-devel/llvm-3.8.1-r2/work/llvm-3.8.1.src/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:53
    #9 0x500bcb in bm_new /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/bitmap.h:76:30
    #10 0x500bcb in bm_readbody_bmp /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/bitmap_io.c:559
    #11 0x500bcb in bm_read /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/bitmap_io.c:133
    #12 0x4f8608 in process_file /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/main.c:1058:9
    #13 0x4f5904 in main /tmp/portage/media-gfx/potrace-1.13/work/potrace-1.13/src/main.c:1214:7
    #14 0x7f167735c61f in __libc_start_main /var/tmp/portage/sys-libs/glibc-2.22-r4/work/glibc-2.22/csu/libc-start.c:289
    #15 0x4190b8 in getenv (/usr/bin/potrace+0x4190b8)

```

**Affected version:**

1.13

**Fixed version:**

1.14

**Commit fix:**

N/A

**Credit:**

This bug was discovered by Agostino Sarubbo of Gentoo.

**CVE:**

CVE-2016-8686

**Timeline:**

2016-08-26: bug discovered

2016-08-27: bug reported privately to upstream

2016-08-29: blog post about the issue

2016-10-16: CVE Assigned

2016-10-21: Added correct stacktrace

2017-02-20: upstream released 1.14

**Note:**

This bug was found with [American Fuzzy Lop](http://lcamtuf.coredump.cx/afl).

**Permalink:**

> [potrace: memory allocation failure in bm\_new (bitmap.h)](http://blogs.gentoo.org/ago/2016/08/29/potrace-memory-allocation-failure/)

This entry was posted in [advisories](https://blogs.gentoo.org/ago/category/advisories/), [security](https://blogs.gentoo.org/ago/category/security/). Bookmark the [permalink](https://blogs.gentoo.org/ago/2016/08/29/potrace-memory-allocation-failure/ "Permalink to potrace: memory allocation failure in bm_new (bitmap.h)").

[← potrace: invalid memory access in findnext (decompose.c)](https://blogs.gentoo.org/ago/2016/08/29/potrace-invalid-memory-access-in-findnext-decompose-c/)
[ettercap: etterlog: multiple (three) heap-based buffer overflow (el\_profiles.c) →](https://blogs.gentoo.org/ago/2016/09/06/ettercap-etterlog-multiple-three-heap-based-buffer-overflow-el_profiles-c/)

### Leave a Reply [Cancel reply](/ago/2016/08/29/potrace-memory-allocation-failure/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

 Notify me of follow-up comments by email.

 Notify me of new posts by email.

Authenticate this comment using OpenID.

Δ

This site uses Akismet to reduce spam. [Learn how your comment data is processed](https://akismet.com/privacy/).

* Search for:
* ### Recent Posts

  + [gentoo tinderbox](https://blogs.gentoo.org/ago/2020/07/04/gentoo-tinderbox/)
  + [re2c: heap overflow in Scanner::fill (scanner.cc)](https://blogs.gentoo.org/ago/2020/04/19/re2c-heap-overflow-in-scannerfill-scanner-cc/)
  + [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/)
  + [Install Gentoo in less than one minute](https://blogs.gentoo.org/ago/2019/03/20/install-gentoo-in-less-than-one-minute/)
  + [binutils: invalid memory read in find\_abstract\_instance\_name (dwarf2.c)](https://blogs.gentoo.org/ago/2017/10/24/binutils-invalid-memory-read-in-find_abstract_instance_name-dwarf2-c/)
* ### Recent Comments

  + strongcourage on [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/#comment-181437)
  + [Bob Friesenhahn](http://www.graphicsmagick.org/) on [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/#comment-181419)
  + [#gentoo dev: Why I stopped fuzzing research https://blogs.gentoo.or… | Dr. Roy Schestowitz (罗伊)](https://placeholderapi.wordpress.com/2020/04/18/gentoo-dev-why-i-stopped-fuzzing-research-https-blogs-gentoo-or/) on [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/#comment-181400)
  + Ulya on [Why I stopped fuzzing research](https://blogs.gentoo.org/ago/2020/04/16/why-i-stopped-fuzzing-research/#comment-181396)
  + ago on [Install Gentoo in less than one minute](https://blogs.gentoo.org/ago/2019/03/20/install-gentoo-in-less-than-one-minute/#comment-178429)
* ### Archives

  + [July 2020](https://blogs.gentoo.org/ago/2020/07/)
  + [April 2020](https://blogs.gentoo.org/ago/2020/04/)
  + [March 2019](https://blogs.gentoo.org/ago/2019/03/)
  + [October 2017](https://blogs.gentoo.org/ago/2017/10/)
  + [September 2017](https://blogs.gentoo.org/ago/2017/09/)
  + [August 2017](https://blogs.gentoo.org/ago/2017/08/)
  + [July 2017](https://blogs.gentoo.org/ago/2017/07/)
  + [June 2017](https://blogs.gentoo.org/ago/2017/06/)
  + [May 2017](https://blogs.gentoo.org/ago/2017/05/)
  + [April 2017](https://blogs.gentoo.org/ago/2017/04/)
  + [March 2017](https://blogs.gentoo.org/ago/2017/03/)
  + [February 2017](https://blogs.gentoo.org/ago/2017/02/)
  + [January 2017](https://blogs.gentoo.org/ago/2017/01/)
  + [December 2016](https://blogs.gentoo.org/ago/2016/12/)
  + [November 2016](https://blogs.gentoo.org/ago/2016/11/)
  + [October 2016](https://blogs.gentoo.org/ago/2016/10/)
  + [September 2016](https://blogs.gentoo.org/ago/2016/09/)
  + [August 2016](https://blogs.gentoo.org/ago/2016/08/)
  + [July 2016](https://blogs.gentoo.org/ago/2016/07/)
  + [February 2016](https://blogs.gentoo.org/ago/2016/02/)
  + [July 2015](https://blogs.gentoo.org/ago/2015/07/)
  + [August 2013](https://blogs.gentoo.org/ago/2013/08/)
  + [June 2013](https://blogs.gentoo.org/ago/2013/06/)
  + [May 2013](https://blogs.gentoo.org/ago/2013/05/)
  + [January 2013](https://blogs.gentoo.org/ago/2013/01/)
  + [December 2012](https://blogs.gentoo.org/ago/2012/12/)
  + [November 2012](https://blogs.gentoo.org/ago/2012/11/)
  + [October 2012](https://blogs.gentoo.org/ago/2012/10/)
  + [August 2012](https://blogs.gentoo.org/ago/2012/08/)
  + [July 2012](https://blogs.gentoo.org/ago/2012/07/)
  + [June 2012](https://blogs.gentoo.org/ago/2012/06/)
* ### Categories

  + [advisories](https://blogs.gentoo.org/ago/category/advisories/)
  + [arch testing](https://blogs.gentoo.org/ago/category/arch-testing/)
  + [gentoo](https://blogs.gentoo.org/ago/category/gentoo/)
  + [security](https://blogs.gentoo.org/ago/category/security/)
* ### Meta

  + [Log in](https://blogs.gentoo.org/ago/wp-login.php)
  + [Entries feed](https://blogs.gentoo.org/ago/feed/)
  + [Comments feed](https://blogs.gentoo.org/ago/comments/feed/)
  + [WordPress.org](https://wordpress.org/)

[agostino's blog](https://blogs.gentoo.org/ago/ "agostino's blog")
Original theme twentyten, modified by csslayer. Better experience in firefox and webkit.

[Proudly powered by WordPress.](http://wordpress.org/ "Semantic Personal Publishing Platform")


