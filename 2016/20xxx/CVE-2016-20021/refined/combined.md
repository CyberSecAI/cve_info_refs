=== Content from wiki.gentoo.org_abe91ecd_20250124_151856.html ===

Jump to: [content](#top)

 [**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites

* [gentoo.org](https://www.gentoo.org/ "Gentoo's main website")
* [Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
* [Bugs](https://bugs.gentoo.org/ "Discover and report issues with Gentoo")
* [Packages](https://packages.gentoo.org/ "Find software to install")
* [Forums](https://forums.gentoo.org/ "Discuss with the community")
* [Planet](https://planet.gentoo.org/ "Find out what's going on in the dev community")
* [Archives](https://archives.gentoo.org/ "Read up on past discussions")
* [Devmanual](https://devmanual.gentoo.org/ "Read the development guide")
* [Gitweb](https://gitweb.gentoo.org/ "Browse our source code in Gitweb")
* [Infra status](https://infra-status.gentoo.org/ "Get updates on the services provided by the Gentoo infra team")

[![Gentoo Linux Logo](https://assets.gentoo.org/tyrian/site-logo.png)](/ "Back to the homepage")
Wiki

Toggle navigation

* [Main page](/wiki/Main_Page "Visit the main page [z]")
* [Recent changes](/wiki/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Help](/wiki/Special%3AMyLanguage/Help%3AContents "The place to find out")
* [Contribute!](/wiki/Gentoo_Wiki%3AContributor%27s_guide)
* [Documentation](/wiki/Gentoo_Wiki%3AMenu-Documentation)
  + [Gentoo Handbook](/wiki/Handbook%3AMain_Page)
  + [Gentoo FAQ](/wiki/FAQ)
  + [Core system](/wiki/Category%3ACore_system)
  + [Hardware](/wiki/Category%3AHardware)
  + [Software](/wiki/Category%3ASoftware)
  + [Desktop](/wiki/Category%3ADesktop)
  + [Server & Security](/wiki/Category%3AServer_and_Security)
  + [Project & Community](/wiki/Category%3AProject_and_Community)
  + [Gentoo Projects](/wiki/Project%3AGentoo)

* Tools
  + [What links here](/wiki/Special%3AWhatLinksHere/Portage "A list of all wiki pages that link here [j]")
  + [Related changes](/wiki/Special%3ARecentChangesLinked/Portage "Recent changes in pages linked from this page [k]")
  + [Special pages](/wiki/Special%3ASpecialPages "A list of all special pages [q]")
  + Printable version
  + [Permanent link](/index.php?title=Portage&oldid=1327939 "Permanent link to this revision of the page")
  + [Page information](/index.php?title=Portage&action=info "More information about this page")
  + [Browse properties](/wiki/Special%3ABrowse/%3APortage)
* User
  + English
  + [Create account](/index.php?title=Special:CreateAccount&returnto=Portage "You are encouraged to create an account and log in; however, it is not mandatory")
  + [Log in](/index.php?title=Special:UserLogin&returnto=Portage "You are encouraged to log in; however, it is not mandatory [o]")

Toggle navigation

* [Page](/wiki/Portage "View the content page [c]")
* [Discussion](/wiki/Talk%3APortage "Discussion about the content page [t]")

* [View source](/index.php?title=Portage&action=edit "This page is protected.
  You can view its source [e]")
* more
  + [History](/index.php?title=Portage&action=history "Past revisions of this page [h]")

# Portage

From Gentoo Wiki

[Jump to:navigation](#mw-head)
[Jump to:search](#searchInput)
This page contains [changes](https://wiki.gentoo.org/index.php?title=Portage&oldid=1320191&diff=1327939) which are not marked for translation.Other languages:

* English
* [español](/wiki/Portage/es "Portage/es (24% translated)")
* [français](/wiki/Portage/fr "Portage/fr (96% translated)")
* [magyar](/wiki/Portage/hu "Portage/hu (100% translated)")
* [中文（中国大陆）‎](/wiki/Portage/zh-cn "Portage/zh-cn (1% translated)")
* [日本語](/wiki/Portage/ja "Portage/ja (96% translated)")

**Portage - the heart of Gentoo**
[emerge](/wiki/Emerge "Emerge") — [configuration](/wiki//etc/portage/make.conf "/etc/portage/make.conf") — [ebuild repository](/wiki/Ebuild_repository "Ebuild repository") — [dispatch-conf](/wiki/Dispatch-conf "Dispatch-conf")

[world file](/wiki/Selected-packages_set_%28Portage%29 "Selected-packages set (Portage)") — [USE flags](/wiki/USE_flag "USE flag") — [ebuilds](/wiki/Ebuild "Ebuild") — [profiles](/wiki/Profile_%28Portage%29 "Profile (Portage)")
[upgrades](/wiki/Upgrading_Gentoo "Upgrading Gentoo") — [using testing packages](/wiki/Knowledge_Base%3AAccepting_a_keyword_for_a_single_package "Knowledge Base:Accepting a keyword for a single package") — [binary packages](/wiki/Binary_package_guide "Binary package guide")
[tools](/wiki/Useful_Portage_tools "Useful Portage tools") — [gentoolkit](/wiki/Gentoolkit "Gentoolkit") — [eselect](/wiki/Eselect "Eselect")
[Portage FAQ](/wiki/Project%3APortage/FAQ "Project:Portage/FAQ") — [cheat sheet](/wiki/Gentoo_Cheat_Sheet "Gentoo Cheat Sheet") — [FAQ](/wiki/FAQ "FAQ")
[all articles](/wiki/Category%3APortage "Category:Portage")

**Resources**
[![Gentoo peach graphic](/images/thumb/a/ad/Gentoo-logo-peach.svg/25px-Gentoo-logo-peach.svg.png)](/wiki/Project%3APortage "Project:Portage")[Project](/wiki/Project%3APortage "Project:Portage")
[Package information](https://packages.gentoo.org/packages/sys-apps/portage)
[Official documentation](https://dev.gentoo.org/~zmedico/portage/doc)
[Wikipedia](https://en.wikipedia.org/wiki/Portage_%28software%29 "wikipedia:Portage (software)")
[GitWeb](https://gitweb.gentoo.org/proj/portage.git)
[GitHub](https://github.com/gentoo/portage)
[Bugs (upstream)](https://bugs.gentoo.org)

 **See also**
Portage is a very advanced package manager that will treat the user's wishes with the highest respect. Sometimes too much trust in put into the user, so you may be looking for [Portage Help](/wiki/Portage/Help "Portage/Help") rather than this article.

**Portage** is the official [package manager](https://en.wikipedia.org/wiki/Package_manager "wikipedia:Package manager") and [distribution system](https://www.gentoo.org/get-started/about/) for Gentoo. It functions as the heart of Gentoo-based operating systems, providing advanced dependency resolution, flexible building and installation of software from source or from [binary packages](/wiki/Gentoo_Binary_Host_Quickstart "Gentoo Binary Host Quickstart"), and most other core distribution functionality.

Portage will provision software from the [Gentoo ebuild repository](/wiki/Ebuild_repository#The_Gentoo_ebuild_repository "Ebuild repository"), any [additional ebuild repositories](/wiki/Portage#Ebuild_repositories "Portage"), or binhost. Portage includes many [commands](/wiki/Portage#Usage "Portage") for repository and package management, the primary of which is the [emerge](/wiki/Portage#emerge "Portage") command.

Some common questions about portage and the emerge command are answered in the [FAQ](/wiki/FAQ "FAQ") and the [Portage FAQ](/wiki/Project%3APortage/FAQ "Project:Portage/FAQ").

 **Tip**
For day to day usage, the [emerge](/wiki/Emerge "Emerge"), [emaint](/wiki/Portage#emaint "Portage"), and [dispatch-conf](/wiki/Dispatch-conf "Dispatch-conf") will be the most used Portage commands. Refer to relevant documentation.
 **See also**
 See man portage for complete user documentation. See the [emerge](/wiki/Emerge "Emerge") article for information on installing and maintaining packages with Portage.

This article describes Portage from a user's perspective. Those looking to contribute to Portage development should visit the [Portage project page](/wiki/Project%3APortage "Project:Portage").

## Contents

* [1 Installation](#Installation)
* [2 Updating Portage](#Updating_Portage)
* [3 Configuration](#Configuration)
  + [3.1 Files](#Files)
  + [3.2 Environment variables](#Environment_variables)
  + [3.3 Ebuild repositories](#Ebuild_repositories)
  + [3.4 Binary hosts](#Binary_hosts)
* [4 Usage](#Usage)
  + [4.1 archive-conf](#archive-conf)
  + [4.2 dispatch-conf](#dispatch-conf)
  + [4.3 ebuild](#ebuild)
  + [4.4 egencache](#egencache)
  + [4.5 emaint](#emaint)
  + [4.6 emerge](#emerge)
  + [4.7 emerge-webrsync](#emerge-webrsync)
  + [4.8 emirrordist](#emirrordist)
  + [4.9 env-update](#env-update)
  + [4.10 etc-update](#etc-update)
  + [4.11 fixpackages](#fixpackages)
  + [4.12 glsa-check](#glsa-check)
  + [4.13 gpkg-sign](#gpkg-sign)
  + [4.14 portageq](#portageq)
  + [4.15 quickpkg](#quickpkg)
  + [4.16 regenworld](#regenworld)
  + [4.17 repoman](#repoman)
* [5 Tips](#Tips)
  + [5.1 Common portage issues and resolutions](#Common_portage_issues_and_resolutions)
  + [5.2 Main (Gentoo) ebuild repository sync time](#Main_.28Gentoo.29_ebuild_repository_sync_time)
  + [5.3 Listing package sets](#Listing_package_sets)
* [6 Troubleshooting](#Troubleshooting)
  + [6.1 Corrupt or absent Portage](#Corrupt_or_absent_Portage)
  + [6.2 Default Gentoo ebuild repository location change](#Default_Gentoo_ebuild_repository_location_change)
    - [6.2.1 Old location](#Old_location)
    - [6.2.2 New location](#New_location)
* [7 See also](#See_also)
  + [7.1 Related to Portage](#Related_to_Portage)
  + [7.2 Portage in the Gentoo AMD64 Handbook](#Portage_in_the_Gentoo_AMD64_Handbook)
  + [7.3 Portage tools](#Portage_tools)
  + [7.4 Alternate package managers and GUIs](#Alternate_package_managers_and_GUIs)
  + [7.5 Ebuild or package related](#Ebuild_or_package_related)
* [8 External resources](#External_resources)
  + [8.1 Portage man pages](#Portage_man_pages)
## Installation

All Gentoo installations come with Portage, so ***there is no need to install it!***.

In the rare eventuality of a corrupt or missing Portage, see the [Corrupt or absent Portage](/wiki/Portage#Corrupt_or_absent_Portage "Portage") section.

## Updating Portage

In order for Gentoo to stay up to date, Portage must stay up to date. Generally the usual, regular [updating of Gentoo](/wiki/Upgrading_Gentoo#Updating_packages "Upgrading Gentoo"), will automatically update Portage without issue.

On occasion, updates to Portage can make it advisable to update Portage before the rest of the system. After [synchronizing Portage](/wiki/Ebuild_repository#Repository_synchronization "Ebuild repository"), a message requesting this may be displayed:

```
* An update to portage is available. It is _highly_ recommended
* that you update portage now, before any other packages are updated.

* To update portage, run 'emerge --oneshot sys-apps/portage' now.

```

Emerge Portage as advised (adapt the command if the message differs from this example). **The `--oneshot` option is important**, to avoid adding [sys-apps/portage](https://packages.gentoo.org/packages/sys-apps/portage) to the [world file](/wiki/Selected-packages_set_%28Portage%29 "Selected-packages set (Portage)"):

`root #``emerge --ask --oneshot sys-apps/portage`

If there is an issue with updating Portage, [User:Sam/Portage\_help/Upgrading\_Portage](/wiki/User%3ASam/Portage_help/Upgrading_Portage "User:Sam/Portage help/Upgrading Portage") may help.

## Configuration

### Files

The main Portage configuration is in [make.conf](/wiki//etc/portage/make.conf "/etc/portage/make.conf"), though there are many files used to configure Portage, mainly in the [/etc/portage](/wiki//etc/portage "/etc/portage") directory.

See man make.conf for comprehensive documentation, notably a list of variables that can be set in this file.

The [/usr/share/portage/config/make.globals](https://gitweb.gentoo.org/proj/portage.git/tree/cnf/make.globals) file contains many default configuration values sourced by Portage. These values can be overwritten by specifying the same variable names in [/etc/portage/make.conf](/wiki//etc/portage/make.conf "/etc/portage/make.conf").

### Environment variables

Portage can be configured to a vast extent through environment variables.

See man make.conf for information on available environment variables. Refer also to the [Handbook section for working with environment variables](/wiki/Handbook%3AAMD64/Working/EnvVar "Handbook:AMD64/Working/EnvVar") in Gentoo.

To view all presently set environment variables, run:

`user $``emerge --info --verbose`
 **Tip**
Environment variables can be set on a per-package basis via [/etc/portage/package.env](/wiki//etc/portage/package.env "/etc/portage/package.env") entries.
### Ebuild repositories

In addition to the **[Gentoo ebuild repository](/wiki/Ebuild_repository#The_Gentoo_ebuild_repository "Ebuild repository")**, from which Portage will pull packages by default, additional [ebuild repositories](/wiki/Ebuild_repository "Ebuild repository") are available, for example:

* [repos.gentoo.org](https://repos.gentoo.org/) - list of repositories contributed by the community, some by Gentoo developers
* [GURU](/wiki/GURU "GURU") - official ebuild repository maintained collaboratively by Gentoo users, with a little support from a few Gentoo developers
* [gpo.zugaina.org](https://gpo.zugaina.org/) - third-party list of ebuild repositories

The ebuild repository article has a section on [configuring ebuild repositories](/wiki/Ebuild_repository#Repository_management "Ebuild repository") to be used by Portage.

Search for available ebuilds on the command line with emerge --search or [eix](/wiki/Eix "Eix").

 **Warning**
While the [Gentoo ebuild repository](/wiki/Ebuild_repository#The_Gentoo_ebuild_repository "Ebuild repository") is either written or [reviewed](/wiki/Portage_Security "Portage Security") by Gentoo developers, and the [GURU](/wiki/GURU "GURU") repository has some developer oversight, that is not always the case for other ebuild repositories. It is possible that some ebuilds repositories might contain vulnerable, badly broken or, theoretically, even malicious software.
### Binary hosts

Binary hosts are configured in /etc/portage/binrepos.conf and allow fast installation of binary packages, as long as there is a package available for the requested [USE flags](/wiki/USE_flag "USE flag") for the package being installed or updated.

There is an [official Gentoo binary host](/wiki/Gentoo_Binary_Host_Quickstart "Gentoo Binary Host Quickstart") that contains many binary packages for the **amd64** and **arm64** architectures - see the guide at that link for further setup and usage instructions.

To configure alternative binary hosts, and for more information on using binary packages with Portage, see the [binary package guide](/wiki/Binary_package_guide "Binary package guide").

## Usage

Portage includes many different tools and utilities to help with system administration and maintenance. The following sections list these in alphabetical order.

 **Tip**
The main commands users will need on a day to day basis are [emerge](/wiki/Emerge "Emerge"), [emaint](/wiki/Portage#emaint "Portage"), and [dispatch-conf](/wiki/Dispatch-conf "Dispatch-conf").
### archive-conf

The purpose of archive-conf is to save off a config file in the dispatch-conf archive directory. Most users should not *ever* need to run this command:

`root #``archive-conf`
```
Usage: archive-conf /CONFIG/FILE [/CONFIG/FILE...]

```
### dispatch-conf

The dispatch-conf utility is used to manage configuration file updates. See the [dispatch-conf](/wiki/Dispatch-conf "Dispatch-conf") article.

### ebuild

 **See also**
This section covers the ebuild command. For information on *ebuild files*, see the [ebuild](/wiki/Ebuild "Ebuild") article.
 **Note**
As a user, **do not use the ebuild command to install packages**. The ebuild command is provided mainly for package development, use the [emerge](/wiki/Emerge "Emerge") command to install packages.

If in possession of an [ebuild file](/wiki/Ebuild "Ebuild") to be installed, first place it in an [ebuild repository](/wiki/Ebuild_repository "Ebuild repository") that is available to Portage, then install with the [emerge](/wiki/Emerge "Emerge") command.

ebuild is Portage's command for running the various [ebuild functions](https://devmanual.gentoo.org/ebuild-writing/functions/).

For a brief summary of usage and command-line options:

`root #``ebuild --help`
```
usage: Usage: ebuild <ebuild file> <command> [command] ...

See the ebuild(1) man page for more info

options:
  -h, --help            show this help message and exit
  --force               When used together with the digest or manifest command, this option forces regeneration of digests for all distfiles associated
                        with the current ebuild. Any distfiles that do not already exist in ${DISTDIR} will be automatically fetched.
  --color {y,n}         enable or disable color output
  --debug               show debug output
  --version             show version and exit
  --ignore-default-opts
                        do not use the EBUILD_DEFAULT_OPTS environment variable
  --skip-manifest       skip all manifest checks
```

For more information on the ebuild command, view it's man page:

`user $``man 1 ebuild`
### egencache

The egencache tool rebuilds the cache of metadata information for the ebuild repositories. See the [egencache](/wiki/Egencache "Egencache") article for additional information.

### emaint

Performs package management related system health checks and maintenance.

See [repository synchronization](/wiki/Ebuild_repository#Repository_synchronization "Ebuild repository") about how to use emaint to synchronize repositories. See man 1 emaint for detailed information.

 **Note**
The emerge --sync command is now implemented with [emaint](/wiki/Ebuild_repository#Repository_synchronization "Ebuild repository").
`user $``emaint --help`
```
usage: usage: emaint [options] COMMAND

The emaint program provides an interface to system health checks
and maintenance. See the emaint(1) man page for additional
information about the following commands:

Commands:
  all            Perform all supported commands
  binhost        Scan and generate metadata indexes for binary packages.
  cleanconfmem   Check and clean the config tracker list for uninstalled packages.
  cleanresume    Discard emerge --resume merge lists
  logs           Check and clean old logs in the PORTAGE_LOGDIR.
  merges         Scan for failed merges and fix them.
  movebin        Perform package move updates for binary packages
  moveinst       Perform package move updates for installed and binary packages.
  sync           Check repos.conf settings and sync repositories.
  world          Check and fix problems in the world file.

optional arguments:
  -h, --help            show this help message and exit
  -c, --check           Check for problems (a default option for most modules)
  -f, --fix             Attempt to fix problems (a default option for most modules)
  --version             show program's version number and exit
  -C, --clean           Cleans out logs more than 7 days old (cleanlogs only) module-options: -t, -p
  -t NUM, --time NUM    (cleanlogs only): -t, --time Delete logs older than NUM of days
  -p, --pretend         (cleanlogs only): -p, --pretend Output logs that would be deleted
  -P, --purge           Removes the list of previously failed merges. WARNING: Only use this option if you plan on manually fixing them or do not want them re-installed.
  -y, --yes             (merges submodule only): Do not prompt for emerge invocations
  -r REPO, --repo REPO  (sync module only): -r, --repo Sync the specified repo
  -A, --allrepos        (sync module only): -A, --allrepos Sync all repos that have a sync-url defined
  -a, --auto            (sync module only): -a, --auto Sync auto-sync enabled repos only
  --sync-submodule {glsa,news,profiles}
                        (sync module only): Restrict sync to the specified submodule(s)

```
### emerge

[emerge](/wiki/Emerge "Emerge") is the command-line interface to Portage and is how most users will interact with Portage.

See the [emerge](/wiki/Emerge "Emerge") article for more information on the wiki.

### emerge-webrsync

Install a Gentoo ebuild repository snapshot from the web. See [Handbook](/wiki/Handbook%3AAMD64/Installation/Base#Installing_a_Gentoo_ebuild_repository_snapshot_from_the_web "Handbook:AMD64/Installation/Base").

`root #``emerge-webrsync -h`
```
Usage: /usr/bin/emerge-webrsync [options]

Options:
  --revert=yyyymmdd   Revert to snapshot
  -k, --keep          Keep snapshots in DISTDIR (don't delete)
  -q, --quiet         Only output errors
  -v, --verbose       Enable verbose output
  -x, --debug         Enable debug output
  -h, --help          This help screen (duh!)

```

emerge-webrsync is called internally by [eix-sync](/wiki/Ebuild_repository#eix "Ebuild repository") when `sync-type` in [/etc/portage/repos.conf](/wiki//etc/portage/repos.conf "/etc/portage/repos.conf") is set to `[webrsync](/wiki/Handbook%3AAMD64/Working/Features#Validated_Gentoo_repository_snapshots "Handbook:AMD64/Working/Features")`.

### emirrordist

Tool for mirroring of package distfiles.

`root #``emirrordist -h`
```
usage: emirrordist [options] <action>

emirrordist - a fetch tool for mirroring of package distfiles

optional arguments:
  -h, --help            show this help message and exit

Actions:
  --version             display portage version and exit
  --mirror              mirror distfiles for the selected repository

Common options:
  --dry-run             perform a trial run with no changes made (usually
                        combined with --verbose)
  --verbose, -v         display extra information on stderr (multiple
                        occurences increase verbosity)
  --ignore-default-opts
                        do not use the EMIRRORDIST_DEFAULT_OPTS environment
                        variable
  --distfiles DIR       distfiles directory to use (required)
  --jobs JOBS, -j JOBS  number of concurrent jobs to run
  --load-average LOAD, -l LOAD
                        load average limit for spawning of new concurrent jobs
  --tries TRIES         maximum number of tries per file, 0 means unlimited
                        (default is 10)
  --repo REPO           name of repo to operate on
  --config-root DIR     location of portage config files
  --repositories-configuration REPOSITORIES_CONFIGURATION
                        override configuration of repositories (in format of
                        repos.conf)
  --strict-manifests <y|n>
                        manually override "strict" FEATURES setting
  --failure-log FILE    log file for fetch failures, with tab-delimited
                        output, for reporting purposes
  --success-log FILE    log file for fetch successes, with tab-delimited
                        output, for reporting purposes
  --scheduled-deletion-log FILE
                        log file for scheduled deletions, with tab-delimited
                        output, for reporting purposes
  --delete              enable deletion of unused distfiles
  --deletion-db FILE    database file used to track lifetime of files
                        scheduled for delayed deletion
  --deletion-delay SECONDS
                        delay time for deletion, measured in seconds
  --temp-dir DIR        temporary directory for downloads
  --mirror-overrides FILE
                        file holding a list of mirror overrides
  --mirror-skip MIRROR_SKIP
                        comma delimited list of mirror targets to skip when
                        fetching
  --restrict-mirror-exemptions RESTRICT_MIRROR_EXEMPTIONS
                        comma delimited list of mirror targets for which to
                        ignore RESTRICT="mirror"
  --verify-existing-digest
                        use digest as a verification of whether existing
                        distfiles are valid
  --distfiles-local DIR
                        distfiles-local directory to use
  --distfiles-db FILE   database file used to track which ebuilds a distfile
                        belongs to
  --recycle-dir DIR     directory for extended retention of files that are
                        removed from distdir with the --delete option
  --recycle-db FILE     database file used to track lifetime of files in
                        recycle dir
  --recycle-deletion-delay SECONDS
                        delay time for deletion of unused files from recycle
                        dir, measured in seconds (defaults to the equivalent
                        of 60 days)
  --fetch-log-dir DIR   directory for individual fetch logs
  --whitelist-from FILE
                        specifies a file containing a list of files to
                        whitelist, one per line, # prefixed lines ignored

```

See also man emirrordist.

### env-update

Updates environment settings automatically.

`root #``env-update -h`
```
Usage: env-update [--no-ldconfig]

See the env-update(1) man page for more info

```

See also man env-update. See the [login](/wiki/Login "Login") article for some information on how the environment is set up in Gentoo.

### etc-update

 **Warning**
[dispatch-conf](/wiki/Dispatch-conf "Dispatch-conf") is the recommended way to manage configuration file changes. Using etc-update risks the loss of important data.

See the [etc-update](/wiki/Etc-update "Etc-update") article.

### fixpackages

Perform package move updates for all packages.

`root #``fixpackages -h`
```
usage: fixpackages [-h]

The fixpackages program performs package move updates on configuration files,
installed packages, and binary packages.

optional arguments:
  -h, --help  show this help message and exit

```

See also man fixpackages.

### glsa-check

[Gentoo Linux Security Announcements](/wiki/GLSA "GLSA"), or [GLSAs](https://www.gentoo.org/support/security/), are notifications sent out to the community to inform of security vulnerabilities related broadly to Gentoo Linux or specifically to packages contained in the ::gentoo ebuild repository.

glsa-check is a tool to keep track of the various [GLSAs](https://security.gentoo.org/glsa/). It can be used to view GLSAs, but more importantly to test if the system is vulnerable to known GLSAs.

See man glsa-check and glsa-check --help for more information:

`user $``glsa-check --help`
```
usage: glsa-check <option> [glsa-id | all | new | affected]

optional arguments:
  -h, --help        show this help message and exit
  -V, --version     Show information about glsa-check
  -q, --quiet       Be less verbose and do not send empty mail
  -v, --verbose     Print more messages
  -n, --nocolor     Removes color from output
  -e, --emergelike  Upgrade to latest version (not least-change)
  -c, --cve         Show CVE IDs in listing mode
  -r, --reverse     List GLSAs in reverse order

Modes:
  -l, --list        List a summary for the given GLSA(s) or set and whether they affect the system
  -d, --dump        Show all information about the GLSA(s) or set
  --print           Alias for --dump
  -t, --test        Test if this system is affected by the GLSA(s) or set and output the GLSA ID(s)
  -p, --pretend     Show the necessary steps to remediate the system
  -f, --fix         (experimental) Attempt to remediate the system based on the instructions given in the GLSA(s) or set. This will only upgrade (when an upgrade path exists) or remove packages
  -i, --inject      Inject the given GLSA(s) into the glsa_injected file
  -m, --mail        Send a mail with the given GLSAs to the administrator

glsa-list can contain an arbitrary number of GLSA ids, filenames containing GLSAs or the special identifiers 'all' and 'affected'

```
### gpkg-sign

 **Todo:**

* This section needs an explanation on the use of this command.

`user $``gpkg-sign --help`
```
usage: gpkg-sign [options] <gpkg package file>

options:
  -h, --help            show this help message and exit
  --keep-current-signature
                        Keep existing signature when updating signature (default: false)
  --allow-unsigned      Allow signing from unsigned packages when binpkg-request-signature is enabled (default: false)
  --skip-signed         Skip signing if a package is already signed (default: false)

```
### portageq

For details see [portageq](/wiki/Portageq "Portageq").

### quickpkg

 **Warning**
This command **uses the current state of files present on the system**, which is often not what is desired when creating binary packages. See the [quikpkg section of the Binary package guide](/wiki/Binary_package_guide#Using_quickpkg "Binary package guide") for more information.

Creates binary packages **using the current state of files present on the system**. See the [quikpkg section of the Binary package guide](/wiki/Binary_package_guide#Using_quickpkg "Binary package guide") for more information.

`user $``quickpkg --help`
```
usage: quickpkg [options] <list of package atoms or package sets>

optional arguments:
  -h, --help            show this help message and exit
  --umask UMASK         umask used during package creation (default is 0077)
  --ignore-default-opts
                        do not use the QUICKPKG_DEFAULT_OPTS environment variable
  --include-config <y|n>
                        include all files protected by CONFIG_PROTECT (as a security precaution, default is 'n')
  --include-unmodified-config <y|n>
                        include files protected by CONFIG_PROTECT that have not been modified since installation (as a
                        security precaution, default is 'n')
```

See also man quickpkg.

### regenworld

See the [regenworld](/wiki/Regenworld "Regenworld") article.

### repoman

 The information in this section has been **deprecated**. It may or may not be relevant for contemporary usage. Handle with care!

repoman is a development tool used for testing ebuilds. Since version 2.3.0, it is packaged separately from Portage, in [app-portage/repoman](https://packages.gentoo.org/packages/app-portage/repoman). See the [repoman](/wiki/Repoman "Repoman") article for additional information.

It is now **deprecated** in favor of tools provided by the [dev-util/pkgcheck](https://packages.gentoo.org/packages/dev-util/pkgcheck) and [dev-util/pkgdev](https://packages.gentoo.org/packages/dev-util/pkgdev) packages.

## Tips

### Common portage issues and resolutions

Gentoo has many more configuration options than most distributions allow. This leads to some confusing at first terminology, such as **blockers**, **Circular dependencies**, **REQUIRED\_USE** and some others.

The articles linked below, will help a user understand how they come about and how to resolve them.

[Portage/Help](/wiki/Portage/Help "Portage/Help")

### Main (Gentoo) ebuild repository sync time

To see when the Gentoo ebuild repository was last updated (synced), run the following command:

`user $``cat /var/db/repos/gentoo/metadata/timestamp.chk`
### Listing package sets

Need to determine what packages are inside each set? See [Package sets](/wiki/Package_sets#Listing "Package sets").

## Troubleshooting

### Corrupt or absent Portage

Although it should be very rare, as with all data, there remains a possibility that Portage could become corrupt or even uninstalled, which would be *very* bad for the functioning of the whole system. If ever this were to occur, there *are* ways Portage can be recovered, however, because Portage is so central, re-installation is a rather involved operation, requiring manual intervention to, in effect, install a package manager without having a functioning package manager.

See [Fix my Gentoo](/wiki/Fix_my_Gentoo "Fix my Gentoo") for details on emergency installation via binary packages. See also [Fixing broken Portage](/wiki/Project%3APortage/Fixing_broken_portage "Project:Portage/Fixing broken portage").

### Default Gentoo ebuild repository location change

As of portage v2.3.66[[1]](#cite_note-1), which was released on 2019-04-29[[2]](#cite_note-2), the default locations changed for the portdir, distdir, repo\_name, repo\_basedir directories.

For more information see bug [bug #662982](https://bugs.gentoo.org/show_bug.cgi?id=662982).

#### Old location

CODE **Location before 2019-04-29**
```
repo_basedir="/usr"
repo_name="portage"
distdir="/usr/portage/distfiles"
portdir="/usr/portage"
target_distdir="/usr/portage/distfiles"
target_pkgdir="/usr/portage/packages"

```
#### New location

CODE **Location as of 2019-04-29 and later**
```
repo_basedir="/var/db/repos"
repo_name="gentoo"
distdir="/var/cache/distfiles"
portdir="/var/db/repos/gentoo"
target_distdir="/var/cache/distfiles"
target_pkgdir="/var/cache/binpkgs"

```
## See also

* [/etc/portage](/wiki//etc/portage "/etc/portage") — the primary configuration directory for Portage, Gentoo's package manager.
* [/etc/portage/make.conf](/wiki//etc/portage/make.conf "/etc/portage/make.conf") — the main configuration file used to customize the Portage environment on a global level., the location Portage keeps binary packages.
* [/etc/portage/color.map](/wiki//etc/portage/color.map "/etc/portage/color.map") — a file containing variables that define color classes used by Portage.
* [prefix](/wiki/Prefix "Prefix") — enables the power of Gentoo and Portage on other distributions and/or operating systems (Microsoft Windows via Cygwin, Android via Termux, etc.).

### Related to Portage

* [Upgrading Gentoo](/wiki/Upgrading_Gentoo "Upgrading Gentoo") — explains how to **upgrade (update)** Gentoo, as well as how to proceed for a well maintained system.
* [Catalyst](/wiki/Catalyst "Catalyst") — a tool to build [stage files](/wiki/Stage_file "Stage file") and [live-images](/wiki/Live_image "Live image") for Gentoo
* [Creating an ebuild repository](/wiki/Creating_an_ebuild_repository "Creating an ebuild repository") — basics of creating an ebuild repository and maintaining ebuilds in it.
* [GCC optimization](/wiki/GCC_optimization "GCC optimization") — an introduction to optimizing compiled code using safe, sane CFLAGS and CXXFLAGS.
* [Portage tips](/wiki/Portage_tips "Portage tips") — the main command-line interface to Portage
* [Repository format](/wiki/Repository_format "Repository format") — A quick reference to Gentoo ebuild repository (overlay) format.
* [Package Manager Specification](/wiki/Package_Manager_Specification "Package Manager Specification") — a standardization effort to ensure that the [ebuild](/wiki/Ebuild "Ebuild") file format, the ebuild repository format (of which the Gentoo ebuild repository is the main incarnation), as well as behavior of the package managers interacting with these ebuilds is properly agreed upon and documented.
* [Ebuild repository](/wiki/Ebuild_repository "Ebuild repository") — a file-structure that can provide packages for installation on a Gentoo system.
* [Category:Portage](/wiki/Category%3APortage "Category:Portage")
* [Gentoolkit](/wiki/Gentoolkit "Gentoolkit") — a suite of tools to ease the administration of a Gentoo system, and Portage in particular.
* [Portage Multi Stage Dockerfile](/wiki/Portage_Multi_Stage_Dockerfile "Portage Multi Stage Dockerfile") — The emerge --quickpkg-direct and related emerge --quickpkg-direct-root options are useful inside Dockerfiles
* [Portage Security](/wiki/Portage_Security "Portage Security") — aims to answer the question *"How can I dispel doubts regarding the security of the Gentoo ebuild repository on a system?"*
* [Portage TMPDIR on tmpfs](/wiki/Portage_TMPDIR_on_tmpfs "Portage TMPDIR on tmpfs") — It is unlikely that tmpfs will provide any performance gain for modern systems

### Portage in the Gentoo AMD64 Handbook

* [A Portage introduction](/wiki/Handbook%3AAMD64/Working/Portage "Handbook:AMD64/Working/Portage")
* [USE flags](/wiki/Handbook%3AAMD64/Working/USE "Handbook:AMD64/Working/USE")
* [Portage features](/wiki/Handbook%3AAMD64/Working/Features "Handbook:AMD64/Working/Features")
* [Files and directories](/wiki/Handbook%3AAMD64/Portage/Files "Handbook:AMD64/Portage/Files")
* [Configuring through variables](/wiki/Handbook%3AAMD64/Portage/Variables "Handbook:AMD64/Portage/Variables")
* [Mixing software branches](/wiki/Handbook%3AAMD64/Portage/Branches "Handbook:AMD64/Portage/Branches")
* [Additional Portage tools](/wiki/Handbook%3AAMD64/Portage/Tools "Handbook:AMD64/Portage/Tools")
* [Custom Portage tree](/wiki/Handbook%3AAMD64/Portage/CustomTree "Handbook:AMD64/Portage/CustomTree")
* [Advanced Portage features](/wiki/Handbook%3AAMD64/Portage/Advanced "Handbook:AMD64/Portage/Advanced")

### Portage tools

* [Useful Portage tools](/wiki/Useful_Portage_tools "Useful Portage tools") — provides a list of Gentoo-specific system management tools, notably for Portage, available in the [ebuild repository](/wiki/Ebuild_repository "Ebuild repository").
* [Cfg-update](/wiki/Cfg-update "Cfg-update") — a utility used on Gentoo to manage configuration file updates.

### Alternate package managers and GUIs

* [Pkgcore](/wiki/Pkgcore "Pkgcore") — an alternative package manager for Gentoo that aims for high performance, extensibility, and a clean design.
* [app-portage/kuroo](https://packages.gentoo.org/packages/app-portage/kuroo) - Graphical Portage frontend based on KF5/Qt5.
* [App Swipe](https://github.com/k9spud/appswipe) - Qt GUI for browsing local Portage repositories.

### Ebuild or package related

* [Package sets](/wiki/Package_sets "Package sets") — describes package sets in high detail and includes a list of all typically available sets on a Gentoo system.

## External resources

* [Official Portage documentation](https://dev.gentoo.org/~zmedico/portage/doc) - Built by Portage developer [Zac Medico (zmedico)](/wiki/User%3AZmedico "User:Zmedico") .
* [packages.gentoo.org](https://packages.gentoo.org/) - online searchable database of packages from the Gentoo package repository.

### Portage man pages

The man pages contain complete technical documentation for Portage. Type man <subject> in a shell on a Gentoo system to read the local man page. Note that man pages have a *see also* section for further information.

* [emerge - command-line interface to the Portage system](https://dev.gentoo.org/~zmedico/portage/doc/man/emerge.1.html) - emerge man page.
* [Portage configuration files](https://dev.gentoo.org/~zmedico/portage/doc/man/portage.5.html) - Portage man page.

1. [↑](#cite_ref-1) <https://gitweb.gentoo.org/proj/catalyst.git/commit/?id=91eb3317ee581f7d1eeacc68ebe88de5a1cdfd1a>
2. [↑](#cite_ref-2) <https://gitweb.gentoo.org/proj/portage.git/tag/?h=portage-2.3.66>

Retrieved from "<https://wiki.gentoo.org/index.php?title=Portage&oldid=1327939>"
[Categories](/wiki/Special%3ACategories "Special:Categories"):

* [Todo articles](/wiki/Category%3ATodo_articles "Category:Todo articles")
* [Deprecated](/wiki/Category%3ADeprecated "Category:Deprecated")
* [Portage](/wiki/Category%3APortage "Category:Portage")
* [Command line tools](/wiki/Category%3ACommand_line_tools "Category:Command line tools")

* This page was last edited on 31 December 2024, at 13:33.
* [Privacy policy](/wiki/Gentoo_Wiki%3APrivacy_policy "Gentoo Wiki:Privacy policy")
* [About Gentoo Wiki](/wiki/Gentoo_Wiki%3AAbout "Gentoo Wiki:About")
* [Disclaimers](/wiki/Gentoo_Wiki%3AGeneral_disclaimer "Gentoo Wiki:General disclaimer")

**© 2001–2025 Gentoo Authors**

Gentoo is a trademark of the Gentoo Foundation, Inc. and of Förderverein Gentoo e.V.
The contents of this document, unless otherwise expressly stated, are licensed under the
[CC-BY-SA-4.0](https://creativecommons.org/licenses/by-sa/4.0/) license.
The [Gentoo Name and Logo Usage Guidelines](https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html) apply.



=== Content from gitweb.gentoo.org_1b64e290_20250124_151854.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
GitWeb

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Gentoo Repository](/repo/gentoo.git)
* [Repositories](/repo/)
* [Projects](/proj/)
* [Developer Overlays](/dev/)
* [User Overlays](/user/)
* [Data](/data/)
* [Websites](/sites/)

| [cgit logo](/) | [index](/) : [proj/portage.git](/proj/portage.git/) | master prefix public\_api use-conflict-auto-resolve |
| --- | --- | --- |
| Package management system | Portage development team <dev-portage@gentoo.org> |

| [about](/proj/portage.git/about/)[summary](/proj/portage.git/)[refs](/proj/portage.git/refs/)[log](/proj/portage.git/log/NEWS)[tree](/proj/portage.git/tree/NEWS)[commit](/proj/portage.git/commit/NEWS)[diff](/proj/portage.git/diff/NEWS) | log msg author committer range |
| --- | --- |

path: [root](/proj/portage.git/tree/)/[NEWS](/proj/portage.git/tree/NEWS)blob: d0f5ff4ef62a0cff15f9d61b7b98ed393ae0a37e ([plain](/proj/portage.git/plain/NEWS))

| ``` [1](#n1) [2](#n2) [3](#n3) [4](#n4) [5](#n5) [6](#n6) [7](#n7) [8](#n8) [9](#n9) [10](#n10) [11](#n11) [12](#n12) [13](#n13) [14](#n14) [15](#n15) [16](#n16) [17](#n17) [18](#n18) [19](#n19) [20](#n20) [21](#n21) [22](#n22) [23](#n23) [24](#n24) [25](#n25) [26](#n26) [27](#n27) [28](#n28) [29](#n29) [30](#n30) [31](#n31) [32](#n32) [33](#n33) [34](#n34) [35](#n35) [36](#n36) [37](#n37) [38](#n38) [39](#n39) [40](#n40) [41](#n41) [42](#n42) [43](#n43) [44](#n44) [45](#n45) [46](#n46) [47](#n47) [48](#n48) [49](#n49) [50](#n50) [51](#n51) [52](#n52) [53](#n53) [54](#n54) [55](#n55) [56](#n56) [57](#n57) [58](#n58) [59](#n59) [60](#n60) [61](#n61) [62](#n62) [63](#n63) [64](#n64) [65](#n65) [66](#n66) [67](#n67) [68](#n68) [69](#n69) [70](#n70) [71](#n71) [72](#n72) [73](#n73) [74](#n74) [75](#n75) [76](#n76) [77](#n77) [78](#n78) [79](#n79) [80](#n80) [81](#n81) [82](#n82) [83](#n83) [84](#n84) [85](#n85) [86](#n86) [87](#n87) [88](#n88) [89](#n89) [90](#n90) [91](#n91) [92](#n92) [93](#n93) [94](#n94) [95](#n95) [96](#n96) [97](#n97) [98](#n98) [99](#n99) [100](#n100) [101](#n101) [102](#n102) [103](#n103) [104](#n104) [105](#n105) [106](#n106) [107](#n107) [108](#n108) [109](#n109) [110](#n110) [111](#n111) [112](#n112) [113](#n113) [114](#n114) [115](#n115) [116](#n116) [117](#n117) [118](#n118) [119](#n119) [120](#n120) [121](#n121) [122](#n122) [123](#n123) [124](#n124) [125](#n125) [126](#n126) [127](#n127) [128](#n128) [129](#n129) [130](#n130) [131](#n131) [132](#n132) [133](#n133) [134](#n134) [135](#n135) [136](#n136) [137](#n137) [138](#n138) [139](#n139) [140](#n140) [141](#n141) [142](#n142) [143](#n143) [144](#n144) [145](#n145) [146](#n146) [147](#n147) [148](#n148) [149](#n149) [150](#n150) [151](#n151) [152](#n152) [153](#n153) [154](#n154) [155](#n155) [156](#n156) [157](#n157) [158](#n158) [159](#n159) [160](#n160) [161](#n161) [162](#n162) [163](#n163) [164](#n164) [165](#n165) [166](#n166) [167](#n167) [168](#n168) [169](#n169) [170](#n170) [171](#n171) [172](#n172) [173](#n173) [174](#n174) [175](#n175) [176](#n176) [177](#n177) [178](#n178) [179](#n179) [180](#n180) [181](#n181) [182](#n182) [183](#n183) [184](#n184) [185](#n185) [186](#n186) [187](#n187) [188](#n188) [189](#n189) [190](#n190) [191](#n191) [192](#n192) [193](#n193) [194](#n194) [195](#n195) [196](#n196) [197](#n197) [198](#n198) [199](#n199) [200](#n200) [201](#n201) [202](#n202) [203](#n203) [204](#n204) [205](#n205) [206](#n206) [207](#n207) [208](#n208) [209](#n209) [210](#n210) [211](#n211) [212](#n212) [213](#n213) [214](#n214) [215](#n215) [216](#n216) [217](#n217) [218](#n218) [219](#n219) [220](#n220) [221](#n221) [222](#n222) [223](#n223) [224](#n224) [225](#n225) [226](#n226) [227](#n227) [228](#n228) [229](#n229) [230](#n230) [231](#n231) [232](#n232) [233](#n233) [234](#n234) [235](#n235) [236](#n236) [237](#n237) [238](#n238) [239](#n239) [240](#n240) [241](#n241) [242](#n242) [243](#n243) [244](#n244) [245](#n245) [246](#n246) [247](#n247) [248](#n248) [249](#n249) [250](#n250) [251](#n251) [252](#n252) [253](#n253) [254](#n254) [255](#n255) [256](#n256) [257](#n257) [258](#n258) [259](#n259) [260](#n260) [261](#n261) [262](#n262) [263](#n263) [264](#n264) [265](#n265) [266](#n266) [267](#n267) [268](#n268) [269](#n269) [270](#n270) [271](#n271) [272](#n272) [273](#n273) [274](#n274) [275](#n275) [276](#n276) [277](#n277) [278](#n278) [279](#n279) [280](#n280) [281](#n281) [282](#n282) [283](#n283) [284](#n284) [285](#n285) [286](#n286) [287](#n287) [288](#n288) [289](#n289) [290](#n290) [291](#n291) [292](#n292) [293](#n293) [294](#n294) [295](#n295) [296](#n296) [297](#n297) [298](#n298) [299](#n299) [300](#n300) [301](#n301) [302](#n302) [303](#n303) [304](#n304) [305](#n305) [306](#n306) [307](#n307) [308](#n308) [309](#n309) [310](#n310) [311](#n311) [312](#n312) [313](#n313) [314](#n314) [315](#n315) [316](#n316) [317](#n317) [318](#n318) [319](#n319) [320](#n320) [321](#n321) [322](#n322) [323](#n323) [324](#n324) [325](#n325) [326](#n326) [327](#n327) [328](#n328) [329](#n329) [330](#n330) [331](#n331) [332](#n332) [333](#n333) [334](#n334) [335](#n335) [336](#n336) [337](#n337) [338](#n338) [339](#n339) [340](#n340) [341](#n341) [342](#n342) [343](#n343) [344](#n344) [345](#n345) [346](#n346) [347](#n347) [348](#n348) [349](#n349) [350](#n350) [351](#n351) [352](#n352) [353](#n353) [354](#n354) [355](#n355) [356](#n356) [357](#n357) [358](#n358) [359](#n359) [360](#n360) [361](#n361) [362](#n362) [363](#n363) [364](#n364) [365](#n365) [366](#n366) [367](#n367) [368](#n368) [369](#n369) [370](#n370) [371](#n371) [372](#n372) [373](#n373) [374](#n374) [375](#n375) [376](#n376) [377](#n377) [378](#n378) [379](#n379) [380](#n380) [381](#n381) [382](#n382) [383](#n383) [384](#n384) [385](#n385) [386](#n386) [387](#n387) [388](#n388) [389](#n389) [390](#n390) [391](#n391) [392](#n392) [393](#n393) [394](#n394) [395](#n395) [396](#n396) [397](#n397) [398](#n398) [399](#n399) [400](#n400) [401](#n401) [402](#n402) [403](#n403) [404](#n404) [405](#n405) [406](#n406) [407](#n407) [408](#n408) [409](#n409) [410](#n410) [411](#n411) [412](#n412) [413](#n413) [414](#n414) [415](#n415) [416](#n416) [417](#n417) [418](#n418) [419](#n419) [420](#n420) [421](#n421) [422](#n422) [423](#n423) [424](#n424) [425](#n425) [426](#n426) [427](#n427) [428](#n428) [429](#n429) [430](#n430) [431](#n431) [432](#n432) [433](#n433) [434](#n434) [435](#n435) [436](#n436) [437](#n437) [438](#n438) [439](#n439) [440](#n440) [441](#n441) [442](#n442) [443](#n443) [444](#n444) [445](#n445) [446](#n446) [447](#n447) [448](#n448) [449](#n449) [450](#n450) [451](#n451) [452](#n452) [453](#n453) [454](#n454) [455](#n455) [456](#n456) [457](#n457) [458](#n458) [459](#n459) [460](#n460) [461](#n461) [462](#n462) [463](#n463) [464](#n464) [465](#n465) [466](#n466) [467](#n467) [468](#n468) [469](#n469) [470](#n470) [471](#n471) [472](#n472) [473](#n473) [474](#n474) [475](#n475) [476](#n476) [477](#n477) [478](#n478) [479](#n479) [480](#n480) [481](#n481) [482](#n482) [483](#n483) [484](#n484) [485](#n485) [486](#n486) [487](#n487) [488](#n488) [489](#n489) [490](#n490) [491](#n491) [492](#n492) [493](#n493) [494](#n494) [495](#n495) [496](#n496) [497](#n497) [498](#n498) [499](#n499) [500](#n500) [501](#n501) [502](#n502) [503](#n503) [504](#n504) [505](#n505) [506](#n506) [507](#n507) [508](#n508) [509](#n509) [510](#n510) [511](#n511) [512](#n512) [513](#n513) [514](#n514) [515](#n515) [516](#n516) [517](#n517) [518](#n518) [519](#n519) [520](#n520) [521](#n521) [522](#n522) [523](#n523) [524](#n524) [525](#n525) [526](#n526) [527](#n527) [528](#n528) [529](#n529) [530](#n530) [531](#n531) [532](#n532) [533](#n533) [534](#n534) [535](#n535) [536](#n536) [537](#n537) [538](#n538) [539](#n539) [540](#n540) [541](#n541) [542](#n542) [543](#n543) [544](#n544) [545](#n545) [546](#n546) [547](#n547) [548](#n548) [549](#n549) [550](#n550) [551](#n551) [552](#n552) [553](#n553) [554](#n554) [555](#n555) [556](#n556) [557](#n557) [558](#n558) [559](#n559) [560](#n560) [561](#n561) [562](#n562) [563](#n563) [564](#n564) [565](#n565) [566](#n566) [567](#n567) [568](#n568) [569](#n569) [570](#n570) [571](#n571) [572](#n572) [573](#n573) [574](#n574) [575](#n575) [576](#n576) [577](#n577) [578](#n578) [579](#n579) [580](#n580) [581](#n581) [582](#n582) [583](#n583) [584](#n584) [585](#n585) [586](#n586) [587](#n587) [588](#n588) [589](#n589) [590](#n590) [591](#n591) [592](#n592) [593](#n593) [594](#n594) [595](#n595) [596](#n596) [597](#n597) [598](#n598) [599](#n599) [600](#n600) [601](#n601) [602](#n602) [603](#n603) [604](#n604) [605](#n605) [606](#n606) [607](#n607) [608](#n608) [609](#n609) [610](#n610) [611](#n611) [612](#n612) [613](#n613) [614](#n614) [615](#n615) [616](#n616) [617](#n617) [618](#n618) [619](#n619) [620](#n620) [621](#n621) [622](#n622) [623](#n623) [624](#n624) [625](#n625) [626](#n626) [627](#n627) [628](#n628) [629](#n629) [630](#n630) [631](#n631) [632](#n632) [633](#n633) [634](#n634) [635](#n635) [636](#n636) [637](#n637) [638](#n638) [639](#n639) [640](#n640) [641](#n641) [642](#n642) [643](#n643) [644](#n644) [645](#n645) [646](#n646) [647](#n647) [648](#n648) [649](#n649) [650](#n650) [651](#n651) [652](#n652) [653](#n653) [654](#n654) [655](#n655) [656](#n656) [657](#n657) [658](#n658) [659](#n659) [660](#n660) [661](#n661) [662](#n662) [663](#n663) [664](#n664) [665](#n665) [666](#n666) [667](#n667) [668](#n668) [669](#n669) [670](#n670) [671](#n671) [672](#n672) [673](#n673) [674](#n674) [675](#n675) [676](#n676) [677](#n677) [678](#n678) [679](#n679) [680](#n680) [681](#n681) [682](#n682) [683](#n683) [684](#n684) [685](#n685) [686](#n686) [687](#n687) [688](#n688) [689](#n689) [690](#n690) [691](#n691) [692](#n692) [693](#n693) [694](#n694) [695](#n695) [696](#n696) [697](#n697) [698](#n698) [699](#n699) [700](#n700) [701](#n701) [702](#n702) [703](#n703) [704](#n704) [705](#n705) [706](#n706) [707](#n707) [708](#n708) [709](#n709) [710](#n710) [711](#n711) [712](#n712) [713](#n713) [714](#n714) [715](#n715) [716](#n716) [717](#n717) [718](#n718) [719](#n719) [720](#n720) [721](#n721) [722](#n722) [723](#n723) [724](#n724) [725](#n725) [726](#n726) [727](#n727) [728](#n728) [729](#n729) [730](#n730) [731](#n731) [732](#n732) [733](#n733) [734](#n734) [735](#n735) [736](#n736) [737](#n737) [738](#n738) [739](#n739) [740](#n740) [741](#n741) [742](#n742) [743](#n743) [744](#n744) [745](#n745) [746](#n746) [747](#n747) [748](#n748) [749](#n749) [750](#n750) [751](#n751) [752](#n752) [753](#n753) [754](#n754) [755](#n755) [756](#n756) [757](#n757) [758](#n758) [759](#n759) [760](#n760) [761](#n761) [762](#n762) [763](#n763) [764](#n764) [765](#n765) [766](#n766) [767](#n767) [768](#n768) [769](#n769) [770](#n770) [771](#n771) [772](#n772) [773](#n773) [774](#n774) [775](#n775) [776](#n776) [777](#n777) [778](#n778) [779](#n779) [780](#n780) [781](#n781) [782](#n782) [783](#n783) [784](#n784) [785](#n785) [786](#n786) [787](#n787) [788](#n788) [789](#n789) [790](#n790) [791](#n791) [792](#n792) [793](#n793) [794](#n794) [795](#n795) [796](#n796) [797](#n797) [798](#n798) [799](#n799) [800](#n800) [801](#n801) [802](#n802) [803](#n803) [804](#n804) [805](#n805) [806](#n806) [807](#n807) [808](#n808) [809](#n809) [810](#n810) [811](#n811) [812](#n812) [813](#n813) [814](#n814) [815](#n815) [816](#n816) [817](#n817) [818](#n818) [819](#n819) [820](#n820) [821](#n821) [822](#n822) [823](#n823) [824](#n824) [825](#n825) [826](#n826) [827](#n827) [828](#n828) [829](#n829) [830](#n830) [831](#n831) [832](#n832) [833](#n833) [834](#n834) [835](#n835) [836](#n836) [837](#n837) [838](#n838) [839](#n839) [840](#n840) [841](#n841) [842](#n842) [843](#n843) [844](#n844) [845](#n845) [846](#n846) [847](#n847) [848](#n848) [849](#n849) [850](#n850) [851](#n851) [852](#n852) [853](#n853) [854](#n854) [855](#n855) [856](#n856) [857](#n857) [858](#n858) [859](#n859) [860](#n860) [861](#n861) [862](#n862) [863](#n863) [864](#n864) [865](#n865) [866](#n866) [867](#n867) [868](#n868) [869](#n869) [870](#n870) [871](#n871) [872](#n872) [873](#n873) [874](#n874) [875](#n875) [876](#n876) [877](#n877) [878](#n878) [879](#n879) [880](#n880) [881](#n881) [882](#n882) [883](#n883) [884](#n884) [885](#n885) [886](#n886) [887](#n887) [888](#n888) [889](#n889) [890](#n890) [891](#n891) [892](#n892) [893](#n893) [894](#n894) [895](#n895) [896](#n896) [897](#n897) [898](#n898) [899](#n899) [900](#n900) [901](#n901) [902](#n902) [903](#n903) [904](#n904) [905](#n905) [906](#n906) [907](#n907) [908](#n908) [909](#n909) [910](#n910) [911](#n911) [912](#n912) [913](#n913) [914](#n914) [915](#n915) [916](#n916) [917](#n917) [918](#n918) [919](#n919) [920](#n920) [921](#n921) [922](#n922) [923](#n923) [924](#n924) [925](#n925) [926](#n926) [927](#n927) [928](#n928) [929](#n929) [930](#n930) [931](#n931) [932](#n932) [933](#n933) [934](#n934) [935](#n935) [936](#n936) [937](#n937) [938](#n938) [939](#n939) [940](#n940) [941](#n941) [942](#n942) [943](#n943) [944](#n944) [945](#n945) [946](#n946) [947](#n947) [948](#n948) [949](#n949) [950](#n950) [951](#n951) [952](#n952) [953](#n953) [954](#n954) [955](#n955) [956](#n956) [957](#n957) [958](#n958) [959](#n959) [960](#n960) [961](#n961) [962](#n962) [963](#n963) [964](#n964) [965](#n965) [966](#n966) [967](#n967) [968](#n968) [969](#n969) [970](#n970) [971](#n971) [972](#n972) [973](#n973) [974](#n974) [975](#n975) [976](#n976) [977](#n977) [978](#n978) [979](#n979) [980](#n980) [981](#n981) [982](#n982) [983](#n983) [984](#n984) [985](#n985) [986](#n986) [987](#n987) [988](#n988) [989](#n989) [990](#n990) [991](#n991) [992](#n992) [993](#n993) [994](#n994) [995](#n995) [996](#n996) [997](#n997) [998](#n998) [999](#n999) [1000](#n1000) [1001](#n1001) [1002](#n1002) [1003](#n1003) [1004](#n1004) [1005](#n1005) [1006](#n1006) [1007](#n1007) [1008](#n1008) [1009](#n1009) [1010](#n1010) [1011](#n1011) [1012](#n1012) [1013](#n1013) [1014](#n1014) [1015](#n1015) [1016](#n1016) [1017](#n1017) [1018](#n1018) [1019](#n1019) [1020](#n1020) [1021](#n1021) [1022](#n1022) [1023](#n1023) [1024](#n1024) [1025](#n1025) [1026](#n1026) [1027](#n1027) [1028](#n1028) [1029](#n1029) [1030](#n1030) [1031](#n1031) [1032](#n1032) [1033](#n1033) [1034](#n1034) [1035](#n1035) [1036](#n1036) [1037](#n1037) [1038](#n1038) [1039](#n1039) [1040](#n1040) [1041](#n1041) [1042](#n1042) [1043](#n1043) [1044](#n1044) [1045](#n1045) [1046](#n1046) [1047](#n1047) [1048](#n1048) [1049](#n1049) [1050](#n1050) [1051](#n1051) [1052](#n1052) [1053](#n1053) [1054](#n1054) [1055](#n1055) [1056](#n1056) [1057](#n1057) [1058](#n1058) [1059](#n1059) [1060](#n1060) [1061](#n1061) [1062](#n1062) [1063](#n1063) [1064](#n1064) [1065](#n1065) [1066](#n1066) [1067](#n1067) [1068](#n1068) [1069](#n1069) [1070](#n1070) [1071](#n1071) [1072](#n1072) [1073](#n1073) [1074](#n1074) [1075](#n1075) [1076](#n1076) [1077](#n1077) [1078](#n1078) [1079](#n1079) [1080](#n1080) [1081](#n1081) [1082](#n1082) [1083](#n1083) [1084](#n1084) [1085](#n1085) [1086](#n1086) [1087](#n1087) [1088](#n1088) [1089](#n1089) [1090](#n1090) [1091](#n1091) [1092](#n1092) [1093](#n1093) [1094](#n1094) [1095](#n1095) [1096](#n1096) [1097](#n1097) [1098](#n1098) [1099](#n1099) [1100](#n1100) [1101](#n1101) [1102](#n1102) [1103](#n1103) [1104](#n1104) [1105](#n1105) [1106](#n1106) [1107](#n1107) [1108](#n1108) [1109](#n1109) [1110](#n1110) [1111](#n1111) [1112](#n1112) [1113](#n1113) [1114](#n1114) [1115](#n1115) [1116](#n1116) [1117](#n1117) [1118](#n1118) [1119](#n1119) [1120](#n1120) [1121](#n1121) [1122](#n1122) [1123](#n1123) [1124](#n1124) [1125](#n1125) [1126](#n1126) [1127](#n1127) [1128](#n1128) [1129](#n1129) [1130](#n1130) [1131](#n1131) [1132](#n1132) [1133](#n1133) [1134](#n1134) [1135](#n1135) [1136](#n1136) [1137](#n1137) [1138](#n1138) [1139](#n1139) [1140](#n1140) [1141](#n1141) [1142](#n1142) [1143](#n1143) [1144](#n1144) [1145](#n1145) [1146](#n1146) [1147](#n1147) [1148](#n1148) [1149](#n1149) [1150](#n1150) [1151](#n1151) [1152](#n1152) [1153](#n1153) [1154](#n1154) [1155](#n1155) [1156](#n1156) [1157](#n1157) [1158](#n1158) [1159](#n1159) [1160](#n1160) [1161](#n1161) [1162](#n1162) [1163](#n1163) [1164](#n1164) [1165](#n1165) [1166](#n1166) [1167](#n1167) [1168](#n1168) [1169](#n1169) [1170](#n1170) [1171](#n1171) [1172](#n1172) [1173](#n1173) [1174](#n1174) [1175](#n1175) [1176](#n1176) [1177](#n1177) [1178](#n1178) [1179](#n1179) [1180](#n1180) [1181](#n1181) [1182](#n1182) [1183](#n1183) [1184](#n1184) [1185](#n1185) [1186](#n1186) [1187](#n1187) [1188](#n1188) [1189](#n1189) [1190](#n1190) [1191](#n1191) [1192](#n1192) [1193](#n1193) [1194](#n1194) [1195](#n1195) [1196](#n1196) [1197](#n1197) [1198](#n1198) [1199](#n1199) [1200](#n1200) [1201](#n1201) [1202](#n1202) [1203](#n1203) [1204](#n1204) [1205](#n1205) [1206](#n1206) [1207](#n1207) [1208](#n1208) [1209](#n1209) [1210](#n1210) [1211](#n1211) [1212](#n1212) [1213](#n1213) [1214](#n1214) [1215](#n1215) [1216](#n1216) [1217](#n1217) [1218](#n1218) [1219](#n1219) [1220](#n1220) [1221](#n1221) [1222](#n1222) [1223](#n1223) [1224](#n1224) [1225](#n1225) [1226](#n1226) [1227](#n1227) [1228](#n1228) [1229](#n1229) [1230](#n1230) [1231](#n1231) [1232](#n1232) [1233](#n1233) [1234](#n1234) [1235](#n1235) [1236](#n1236) [1237](#n1237) [1238](#n1238) [1239](#n1239) [1240](#n1240) [1241](#n1241) [1242](#n1242) [1243](#n1243) [1244](#n1244) [1245](#n1245) [1246](#n1246) [1247](#n1247) [1248](#n1248) [1249](#n1249) [1250](#n1250) [1251](#n1251) [1252](#n1252) [1253](#n1253) [1254](#n1254) [1255](#n1255) [1256](#n1256) [1257](#n1257) [1258](#n1258) [1259](#n1259) [1260](#n1260) [1261](#n1261) [1262](#n1262) [1263](#n1263) [1264](#n1264) [1265](#n1265) [1266](#n1266) [1267](#n1267) [1268](#n1268) [1269](#n1269) [1270](#n1270) [1271](#n1271) [1272](#n1272) [1273](#n1273) [1274](#n1274) [1275](#n1275) [1276](#n1276) [1277](#n1277) [1278](#n1278) [1279](#n1279) [1280](#n1280) [1281](#n1281) [1282](#n1282) [1283](#n1283) [1284](#n1284) [1285](#n1285) [1286](#n1286) [1287](#n1287) [1288](#n1288) [1289](#n1289) [1290](#n1290) [1291](#n1291) [1292](#n1292) [1293](#n1293) [1294](#n1294) [1295](#n1295) [1296](#n1296) [1297](#n1297) [1298](#n1298) [1299](#n1299) [1300](#n1300) [1301](#n1301) [1302](#n1302) [1303](#n1303) [1304](#n1304) [1305](#n1305) [1306](#n1306) [1307](#n1307) [1308](#n1308) [1309](#n1309) [1310](#n1310) [1311](#n1311) [1312](#n1312) [1313](#n1313) [1314](#n1314) [1315](#n1315) [1316](#n1316) [1317](#n1317) [1318](#n1318) [1319](#n1319) [1320](#n1320) [1321](#n1321) [1322](#n1322) [1323](#n1323) [1324](#n1324) [1325](#n1325) [1326](#n1326) [1327](#n1327) [1328](#n1328) [1329](#n1329) [1330](#n1330) [1331](#n1331) [1332](#n1332) [1333](#n1333) [1334](#n1334) [1335](#n1335) [1336](#n1336) [1337](#n1337) [1338](#n1338) [1339](#n1339) [1340](#n1340) [1341](#n1341) [1342](#n1342) [1343](#n1343) [1344](#n1344) [1345](#n1345) [1346](#n1346) [1347](#n1347) [1348](#n1348) [1349](#n1349) [1350](#n1350) [1351](#n1351) [1352](#n1352) [1353](#n1353) [1354](#n1354) [1355](#n1355) [1356](#n1356) [1357](#n1357) [1358](#n1358) [1359](#n1359) [1360](#n1360) [1361](#n1361) [1362](#n1362) [1363](#n1363) [1364](#n1364) [1365](#n1365) [1366](#n1366) [1367](#n1367) [1368](#n1368) [1369](#n1369) [1370](#n1370) [1371](#n1371) [1372](#n1372) [1373](#n1373) [1374](#n1374) [1375](#n1375) [1376](#n1376) [1377](#n1377) [1378](#n1378) [1379](#n1379) [1380](#n1380) [1381](#n1381) [1382](#n1382) [1383](#n1383) [1384](#n1384) [1385](#n1385) [1386](#n1386) [1387](#n1387) [1388](#n1388) [1389](#n1389) [1390](#n1390) [1391](#n1391) [1392](#n1392) [1393](#n1393) [1394](#n1394) [1395](#n1395) [1396](#n1396) [1397](#n1397) [1398](#n1398) [1399](#n1399) [1400](#n1400) [1401](#n1401) [1402](#n1402) [1403](#n1403) [1404](#n1404) [1405](#n1405) [1406](#n1406) [1407](#n1407) [1408](#n1408) [1409](#n1409) [1410](#n1410) [1411](#n1411) [1412](#n1412) [1413](#n1413) [1414](#n1414) [1415](#n1415) [1416](#n1416) [1417](#n1417) [1418](#n1418) [1419](#n1419) [1420](#n1420) [1421](#n1421) [1422](#n1422) [1423](#n1423) [1424](#n1424) [1425](#n1425) [1426](#n1426) [1427](#n1427) [1428](#n1428) [1429](#n1429) [1430](#n1430) [1431](#n1431) [1432](#n1432) [1433](#n1433) [1434](#n1434) [1435](#n1435) [1436](#n1436) [1437](#n1437) [1438](#n1438) [1439](#n1439) [1440](#n1440) [1441](#n1441) [1442](#n1442) [1443](#n1443) [1444](#n1444) [1445](#n1445) [1446](#n1446) [1447](#n1447) [1448](#n1448) [1449](#n1449) [1450](#n1450) [1451](#n1451) [1452](#n1452) [1453](#n1453) [1454](#n1454) [1455](#n1455) [1456](#n1456) [1457](#n1457) [1458](#n1458) [1459](#n1459) [1460](#n1460) [1461](#n1461) [1462](#n1462) [1463](#n1463) [1464](#n1464) [1465](#n1465) [1466](#n1466) [1467](#n1467) [1468](#n1468) [1469](#n1469) [1470](#n1470) [1471](#n1471) [1472](#n1472) [1473](#n1473) [1474](#n1474) [1475](#n1475) [1476](#n1476) [1477](#n1477) [1478](#n1478) [1479](#n1479) [1480](#n1480) [1481](#n1481) [1482](#n1482) [1483](#n1483) [1484](#n1484) [1485](#n1485) [1486](#n1486) [1487](#n1487) [1488](#n1488) [1489](#n1489) [1490](#n1490) [1491](#n1491) [1492](#n1492) [1493](#n1493) [1494](#n1494) [1495](#n1495) [1496](#n1496) [1497](#n1497) [1498](#n1498) [1499](#n1499) [1500](#n1500) [1501](#n1501) [1502](#n1502) [1503](#n1503) [1504](#n1504) [1505](#n1505) [1506](#n1506) [1507](#n1507) [1508](#n1508) [1509](#n1509) [1510](#n1510) [1511](#n1511) [1512](#n1512) [1513](#n1513) [1514](#n1514) [1515](#n1515) [1516](#n1516) [1517](#n1517) [1518](#n1518) [1519](#n1519) [1520](#n1520) [1521](#n1521) [1522](#n1522) [1523](#n1523) [1524](#n1524) [1525](#n1525) [1526](#n1526) [1527](#n1527) [1528](#n1528) [1529](#n1529) [1530](#n1530) [1531](#n1531) [1532](#n1532) [1533](#n1533) [1534](#n1534) [1535](#n1535) [1536](#n1536) [1537](#n1537) [1538](#n1538) [1539](#n1539) [1540](#n1540) [1541](#n1541) [1542](#n1542) [1543](#n1543) [1544](#n1544) [1545](#n1545) [1546](#n1546) [1547](#n1547) [1548](#n1548) [1549](#n1549) [1550](#n1550) [1551](#n1551) [1552](#n1552) [1553](#n1553) [1554](#n1554) [1555](#n1555) [1556](#n1556) [1557](#n1557) [1558](#n1558) [1559](#n1559) [1560](#n1560) [1561](#n1561) [1562](#n1562) [1563](#n1563) [1564](#n1564) [1565](#n1565) [1566](#n1566) [1567](#n1567) [1568](#n1568) [1569](#n1569) [1570](#n1570) [1571](#n1571) [1572](#n1572) [1573](#n1573) [1574](#n1574) [1575](#n1575) [1576](#n1576) [1577](#n1577) [1578](#n1578) [1579](#n1579) [1580](#n1580) [1581](#n1581) [1582](#n1582) [1583](#n1583) [1584](#n1584) [1585](#n1585) [1586](#n1586) [1587](#n1587) [1588](#n1588) [1589](#n1589) [1590](#n1590) [1591](#n1591) [1592](#n1592) [1593](#n1593) [1594](#n1594) [1595](#n1595) [1596](#n1596) [1597](#n1597) [1598](#n1598) [1599](#n1599) [1600](#n1600) [1601](#n1601) [1602](#n1602) [1603](#n1603) [1604](#n1604) [1605](#n1605) [1606](#n1606) [1607](#n1607) [1608](#n1608) [1609](#n1609) [1610](#n1610) [1611](#n1611) [1612](#n1612) [1613](#n1613) [1614](#n1614) [1615](#n1615) [1616](#n1616) [1617](#n1617) [1618](#n1618) [1619](#n1619) [1620](#n1620) [1621](#n1621) [1622](#n1622) [1623](#n1623) [1624](#n1624) [1625](#n1625) [1626](#n1626) [1627](#n1627) [1628](#n1628) [1629](#n1629) [1630](#n1630) [1631](#n1631) [1632](#n1632) [1633](#n1633) [1634](#n1634) [1635](#n1635) [1636](#n1636) [1637](#n1637) [1638](#n1638) [1639](#n1639) [1640](#n1640) [1641](#n1641) [1642](#n1642) [1643](#n1643) [1644](#n1644) [1645](#n1645) [1646](#n1646) [1647](#n1647) [1648](#n1648) [1649](#n1649) [1650](#n1650) [1651](#n1651) [1652](#n1652) [1653](#n1653) [1654](#n1654) [1655](#n1655) [1656](#n1656) [1657](#n1657) [1658](#n1658) [1659](#n1659) [1660](#n1660) [1661](#n1661) [1662](#n1662) [1663](#n1663) [1664](#n1664) [1665](#n1665) [1666](#n1666) [1667](#n1667) [1668](#n1668) [1669](#n1669) [1670](#n1670) [1671](#n1671) [1672](#n1672) [1673](#n1673) [1674](#n1674) [1675](#n1675) [1676](#n1676) [1677](#n1677) [1678](#n1678) [1679](#n1679) [1680](#n1680) [1681](#n1681) [1682](#n1682) [1683](#n1683) [1684](#n1684) [1685](#n1685) [1686](#n1686) [1687](#n1687) [1688](#n1688) [1689](#n1689) [1690](#n1690) [1691](#n1691) [1692](#n1692) [1693](#n1693) [1694](#n1694) [1695](#n1695) [1696](#n1696) [1697](#n1697) [1698](#n1698) [1699](#n1699) [1700](#n1700) [1701](#n1701) [1702](#n1702) [1703](#n1703) [1704](#n1704) [1705](#n1705) [1706](#n1706) [1707](#n1707) [1708](#n1708) [1709](#n1709) [1710](#n1710) [1711](#n1711) [1712](#n1712) [1713](#n1713) [1714](#n1714) [1715](#n1715) [1716](#n1716) [1717](#n1717) [1718](#n1718) [1719](#n1719) [1720](#n1720) [1721](#n1721) [1722](#n1722) [1723](#n1723) [1724](#n1724) [1725](#n1725) [1726](#n1726) [1727](#n1727) [1728](#n1728) [1729](#n1729) [1730](#n1730) [1731](#n1731) [1732](#n1732) [1733](#n1733) [1734](#n1734) [1735](#n1735) [1736](#n1736) [1737](#n1737) [1738](#n1738) [1739](#n1739) [1740](#n1740) [1741](#n1741) [1742](#n1742) [1743](#n1743) [1744](#n1744) [1745](#n1745) [1746](#n1746) [1747](#n1747) [1748](#n1748) [1749](#n1749) [1750](#n1750) [1751](#n1751) [1752](#n1752) [1753](#n1753) [1754](#n1754) [1755](#n1755) [1756](#n1756) [1757](#n1757) [1758](#n1758) [1759](#n1759) [1760](#n1760) [1761](#n1761) [1762](#n1762) [1763](#n1763) [1764](#n1764) [1765](#n1765) [1766](#n1766) [1767](#n1767) [1768](#n1768) [1769](#n1769) [1770](#n1770) [1771](#n1771) [1772](#n1772) [1773](#n1773) [1774](#n1774) [1775](#n1775) [1776](#n1776) [1777](#n1777) [1778](#n1778) [1779](#n1779) [1780](#n1780) [1781](#n1781) [1782](#n1782) [1783](#n1783) [1784](#n1784) [1785](#n1785) [1786](#n1786) [1787](#n1787) [1788](#n1788) [1789](#n1789) [1790](#n1790) [1791](#n1791) [1792](#n1792) [1793](#n1793) [1794](#n1794) [1795](#n1795) [1796](#n1796) [1797](#n1797) [1798](#n1798) [1799](#n1799) [1800](#n1800) [1801](#n1801) [1802](#n1802) [1803](#n1803) [1804](#n1804) [1805](#n1805) [1806](#n1806) [1807](#n1807) [1808](#n1808) [1809](#n1809) [1810](#n1810) [1811](#n1811) [1812](#n1812) [1813](#n1813) [1814](#n1814) [1815](#n1815) [1816](#n1816) [1817](#n1817) [1818](#n1818) [1819](#n1819) [1820](#n1820) [1821](#n1821) [1822](#n1822) [1823](#n1823) [1824](#n1824) [1825](#n1825) [1826](#n1826) [1827](#n1827) [1828](#n1828) [1829](#n1829) [1830](#n1830) [1831](#n1831) [1832](#n1832) [1833](#n1833) [1834](#n1834) [1835](#n1835) [1836](#n1836) [1837](#n1837) [1838](#n1838) [1839](#n1839) [1840](#n1840) [1841](#n1841) [1842](#n1842) [1843](#n1843) [1844](#n1844) [1845](#n1845) [1846](#n1846) [1847](#n1847) [1848](#n1848) [1849](#n1849) [1850](#n1850) [1851](#n1851) [1852](#n1852) [1853](#n1853) [1854](#n1854) [1855](#n1855) [1856](#n1856) [1857](#n1857) [1858](#n1858) [1859](#n1859) [1860](#n1860) [1861](#n1861) [1862](#n1862) [1863](#n1863) [1864](#n1864) [1865](#n1865) [1866](#n1866) [1867](#n1867) [1868](#n1868) [1869](#n1869) [1870](#n1870) [1871](#n1871) [1872](#n1872) [1873](#n1873) [1874](#n1874) [1875](#n1875) [1876](#n1876) [1877](#n1877) [1878](#n1878) [1879](#n1879) [1880](#n1880) [1881](#n1881) [1882](#n1882) [1883](#n1883) [1884](#n1884) [1885](#n1885) [1886](#n1886) [1887](#n1887) [1888](#n1888) [1889](#n1889) [1890](#n1890) [1891](#n1891) [1892](#n1892) [1893](#n1893) [1894](#n1894) [1895](#n1895) [1896](#n1896) [1897](#n1897) [1898](#n1898) [1899](#n1899) [1900](#n1900) [1901](#n1901) [1902](#n1902) [1903](#n1903) [1904](#n1904) [1905](#n1905) [1906](#n1906) [1907](#n1907) [1908](#n1908) [1909](#n1909) [1910](#n1910) [1911](#n1911) [1912](#n1912) [1913](#n1913) [1914](#n1914) [1915](#n1915) [1916](#n1916) [1917](#n1917) [1918](#n1918) [1919](#n1919) [1920](#n1920) [1921](#n1921) [1922](#n1922) [1923](#n1923) [1924](#n1924) [1925](#n1925) [1926](#n1926) [1927](#n1927) [1928](#n1928) [1929](#n1929) [1930](#n1930) [1931](#n1931) [1932](#n1932) [1933](#n1933) [1934](#n1934) [1935](#n1935) [1936](#n1936) [1937](#n1937) [1938](#n1938) [1939](#n1939) [1940](#n1940) [1941](#n1941) [1942](#n1942) [1943](#n1943) [1944](#n1944) [1945](#n1945) [1946](#n1946) [1947](#n1947) [1948](#n1948) [1949](#n1949) [1950](#n1950) [1951](#n1951) [1952](#n1952) [1953](#n1953) [1954](#n1954) [1955](#n1955) [1956](#n1956) [1957](#n1957) [1958](#n1958) [1959](#n1959) [1960](#n1960) [1961](#n1961) [1962](#n1962) [1963](#n1963) [1964](#n1964) [1965](#n1965) [1966](#n1966) [1967](#n1967) [1968](#n1968) [1969](#n1969) [1970](#n1970) [1971](#n1971) [1972](#n1972) [1973](#n1973) [1974](#n1974) [1975](#n1975) [1976](#n1976) [1977](#n1977) [1978](#n1978) [1979](#n1979) [1980](#n1980) [1981](#n1981) [1982](#n1982) [1983](#n1983) [1984](#n1984) [1985](#n1985) [1986](#n1986) [1987](#n1987) [1988](#n1988) [1989](#n1989) [1990](#n1990) [1991](#n1991) [1992](#n1992) [1993](#n1993) [1994](#n1994) [1995](#n1995) [1996](#n1996) [1997](#n1997) [1998](#n1998) [1999](#n1999) [2000](#n2000) [2001](#n2001) [2002](#n2002) [2003](#n2003) [2004](#n2004) [2005](#n2005) [2006](#n2006) [2007](#n2007) [2008](#n2008) [2009](#n2009) [2010](#n2010) [2011](#n2011) [2012](#n2012) [2013](#n2013) [2014](#n2014) [2015](#n2015) [2016](#n2016) [2017](#n2017) [2018](#n2018) [2019](#n2019) [2020](#n2020) [2021](#n2021) [2022](#n2022) [2023](#n2023) [2024](#n2024) [2025](#n2025) [2026](#n2026) [2027](#n2027) [2028](#n2028) [2029](#n2029) [2030](#n2030) [2031](#n2031) [2032](#n2032) [2033](#n2033) [2034](#n2034) [2035](#n2035) [2036](#n2036) [2037](#n2037) [2038](#n2038) [2039](#n2039) [2040](#n2040) [2041](#n2041) [2042](#n2042) [2043](#n2043) [2044](#n2044) [2045](#n2045) [2046](#n2046) [2047](#n2047) [2048](#n2048) [2049](#n2049) [2050](#n2050) [2051](#n2051) [2052](#n2052) [2053](#n2053) [2054](#n2054) [2055](#n2055) [2056](#n2056) [2057](#n2057) [2058](#n2058) [2059](#n2059) [2060](#n2060) [2061](#n2061) [2062](#n2062) [2063](#n2063) [2064](#n2064) [2065](#n2065) [2066](#n2066) [2067](#n2067) [2068](#n2068) [2069](#n2069) [2070](#n2070) [2071](#n2071) [2072](#n2072) [2073](#n2073) [2074](#n2074) [2075](#n2075) [2076](#n2076) [2077](#n2077) [2078](#n2078) [2079](#n2079) [2080](#n2080) [2081](#n2081) [2082](#n2082) [2083](#n2083) [2084](#n2084) [2085](#n2085) [2086](#n2086) [2087](#n2087) [2088](#n2088) [2089](#n2089) [2090](#n2090) [2091](#n2091) [2092](#n2092) [2093](#n2093) [2094](#n2094) [2095](#n2095) [2096](#n2096) [2097](#n2097) [2098](#n2098) [2099](#n2099) [2100](#n2100) [2101](#n2101) [2102](#n2102) [2103](#n2103) [2104](#n2104) [2105](#n2105) [2106](#n2106) [2107](#n2107) [2108](#n2108) [2109](#n2109) [2110](#n2110) [2111](#n2111) [2112](#n2112) [2113](#n2113) [2114](#n2114) [2115](#n2115) [2116](#n2116) [2117](#n2117) [2118](#n2118) [2119](#n2119) [2120](#n2120) [2121](#n2121) [2122](#n2122) [2123](#n2123) [2124](#n2124) [2125](#n2125) [2126](#n2126) [2127](#n2127) [2128](#n2128) [2129](#n2129) [2130](#n2130) [2131](#n2131) [2132](#n2132) [2133](#n2133) [2134](#n2134) [2135](#n2135) [2136](#n2136) [2137](#n2137) [2138](#n2138) [2139](#n2139) [2140](#n2140) [2141](#n2141) [2142](#n2142) [2143](#n2143) [2144](#n2144) [2145](#n2145) [2146](#n2146) [2147](#n2147) [2148](#n2148) [2149](#n2149) [2150](#n2150) [2151](#n2151) [2152](#n2152) [2153](#n2153) [2154](#n2154) [2155](#n2155) [2156](#n2156) [2157](#n2157) [2158](#n2158) [2159](#n2159) [2160](#n2160) [2161](#n2161) [2162](#n2162) [2163](#n2163) [2164](#n2164) [2165](#n2165) [2166](#n2166) [2167](#n2167) [2168](#n2168) [2169](#n2169) [2170](#n2170) [2171](#n2171) [2172](#n2172) [2173](#n2173) [2174](#n2174) [2175](#n2175) [2176](#n2176) [2177](#n2177) [2178](#n2178) [2179](#n2179) [2180](#n2180) [2181](#n2181) [2182](#n2182) [2183](#n2183) [2184](#n2184) [2185](#n2185) [2186](#n2186) [2187](#n2187) [2188](#n2188) [2189](#n2189) [2190](#n2190) [2191](#n2191) [2192](#n2192) [2193](#n2193) [2194](#n2194) [2195](#n2195) [2196](#n2196) [2197](#n2197) [2198](#n2198) [2199](#n2199) [2200](#n2200) [2201](#n2201) [2202](#n2202) [2203](#n2203) [2204](#n2204) [2205](#n2205) [2206](#n2206) [2207](#n2207) [2208](#n2208) [2209](#n2209) [2210](#n2210) [2211](#n2211) [2212](#n2212) [2213](#n2213) [2214](#n2214) [2215](#n2215) [2216](#n2216) [2217](#n2217) [2218](#n2218) [2219](#n2219) [2220](#n2220) [2221](#n2221) [2222](#n2222) [2223](#n2223) [2224](#n2224) [2225](#n2225) [2226](#n2226) [2227](#n2227) [2228](#n2228) [2229](#n2229) [2230](#n2230) [2231](#n2231) [2232](#n2232) [2233](#n2233) [2234](#n2234) [2235](#n2235) [2236](#n2236) [2237](#n2237) [2238](#n2238) [2239](#n2239) [2240](#n2240) [2241](#n2241) [2242](#n2242) [2243](#n2243) [2244](#n2244) [2245](#n2245) [2246](#n2246) [2247](#n2247) [2248](#n2248) [2249](#n2249)  ``` | ```  ``` Release notes take the form of the following optional categories: [Optional short blurb/summary] * Breaking changes * Security * Features * Bug fixes * Cleanups  portage-3.0.67 (2025-01-22) --------------  Breaking changes: * eend: Missing argument is now an error (bug #703520).  * ebuild.sh: A colon in sandbox function args is now an error (bug #920654).  Security: * make.globals: disable FEATURES="sfperms" by default (bug #938164).  * emerge-webrsync: Create /var/db/repos/gentoo with correct permissions to   facilitate FEATURES="usersync" (bug #707980).  Features: * New 'home-dir-template-copy' FEATURE (bug #947822).    If enabled, as part of the ebuild environment setup, copies the PORTAGE_USERNAME   home directory into the build environment HOME directory. Useful predominantly   for ebuilds that use the git-r3 eclass, to give a place to put SSH keys and user-   specific git configuration files used during the build.  * Flush the merge-wait queue on SIGUSR2.  Bug fixes: * depgraph: Ignore blockers when computing virtual deps visibility (PR #1387).  * binarytree: Fix _inject_repo_revisions to ignore remote packages for which   source repostories are missing, triggering KeyError (PR #1391).  * gpkg: do not consider symlinks targets for size estimation (bug #942512).  * install_qa_check: Fix noclean interaction with merge-wait (bug #942760).  * save-ebuild-env.sh: Add functions from newer EAPIs to filter list  * Support cross-root package moves (bug #946326).  * Process elog messages for emerge --config (bug #904702).  * Scheduler: Handle SIGWINCH for JobStatusDisplay (bug #945382).  * Pass through MAKEFLAGS and exclude from environment.bz2 (bug #692576).  * binarytree.move_ent: Allocate path with binpkg_format (bug #923530).  * ebuild.sh: Allow CC and CXX to be changed in profile.bashrc.  * Preserve PORTAGE_BZIP2_COMMAND in environment.bz2 (bug #948067).  * config: Initialize default PORTAGE_USERNAME and PORTAGE_GRPNAME (bug #941977).  * rust-rebuild: Update for recent changes in ::gentoo (bug #906044).  * emerge-webrsync: Use variables PORTAGE_USERNAME and PORTAGE_GRPNAME (bug #707980).  Cleanups: * eapi.sh: Remove support for unofficial 4-slot-abi EAPI.  * locks: Drop comment regarding sleep() call.  portage-3.0.66.1 (2024-09-18) --------------  Bug fixes: * JobStatusDisplay: Fix width of display. Notable with the new 'merge wait'   metric.  * install-qa-check.d: 90config-impl-decl: Skip various false positives.  portage-3.0.66 (2024-09-11) --------------  Features: * binrepos.conf: Support custom download location (bug #934784).    In binrepos.conf, 'location' can now be set to choose the location   for fetched binpkgs from a particular remote repository.  * emerge: Make bare --root-deps option install build-time dependencies to ROOT   as well as / for all EAPIs rather than instead of / for EAPI 6 and below   (bug #435066).  * Show length of merge-wait queue as part of the status display.  * src: Allow GIL to be disabled for Whirlpool C extension (bug #934220).  * ELF: Recognise BPF (bug #937485).  * portage.util.compression_probe: Handle lack of ctypes (libffi) for   bootstrapping purposes.  Bug fixes: * ebuild: Handle Bash 5.2's change in behavior which enables the shopt   'globskipdots' by default. This is needed to avoid breaking existing   working ebuilds. Future EAPIs will need to adjust the logic   added by this change. See bug #907061.  * doebuild.spawn: Fix hang with FEATURES="network-sandbox-proxy" in consumers   like gentoolkit (bug #937384).  * make.globals: add bcachefs_effective.* and bcachefs.* to PORTAGE_XATTR_EXCLUDE  * vartree, movefile: Warn when rewriting a symlink (bug #934514).  * repository: config: Allow a repository to be configured using one of its   aliases rather than its primary name (bug #935830).  * emerge: Fix parallel-fetch to properly terminate FETCHCOMMAND processes when   needed, using a SIGTERM handler (bug #936273).  * unpack: Don't display "Unpacking ..." message for skipped files.   Match file extensions case-sensitively in old EAPIs, fixes PMS compliance.  * sync: zipfile: Fix installing module.  * ebuild: Improve 'maintainer mode' QA check.  * emerge-webrsync: Honour sync-webrsync-verify-signature attribute.  * dispatch-conf: Don't use SHELL (bug #910560).  * phase-functions: Fix QA_SONAME_NO_SYMLINK so it accepts regex (bug #924953).  * ebuild.5: Improve QA_PREBUILT docs.  * install-qa-check.d: 90gcc-warnings: Handle color in logs for build.log too.  Cleanups: * tar_safe_extract: Port to Python 3.14 (bug #933433).  * Drop unnecessary f-string use.  * Improve detection of xtrace (debugging).  * eapi.py: Use attrs rather than hardcoding / repeating EAPI properties.  portage-3.0.65 (2024-06-04) --------------  Features: * binrepos.conf: Support "frozen" attribute (bug #932739).    This avoids mutating the local index cache by fetching changes from a   binpkg host when running emerge repeatedly. It's useful for consistency   between emerge runs while completing an update.    It should only be used temporarily, not set on a permanent basis.  * bintree: Add REPO_REVISIONS to Packages index header (bug #924772).    Portage will now store synced revisions at /var/lib/portage/repo_revisions.    This associates a binpkg being built with the repository state / revision   at a time, which will ultimately later allow pinning binhost clients   to <= the last commit the binhost was updated at.    It's also useful for pinning source builds from the same revision as   when binary builds were done for consistency and to minimize rebuilds and   maximize binpkg use.  * mtimedb: Record binpkg BUILD_ID and BUILD_TIME (bug #933442).    This fixes 'emerge --resume' to correctly pick up binpkgs and not   recalculate.  Bug fixes: * unpack: Skip unrecognized file formats silently, fixing PMS compliance.  * estrip: Don't use splitdebug for .o files (bug #787623).    This fixes splitdebug mangling debug information with Clang.  * sync: git: Add safe.directory for getting HEAD commit (bug #930992).  * install-qa-checks.d: 90config-impl-decl: Suppress known false positives   for gnulib on glibc and musl.  * CONFIG_PROTECT: Don't use shlex.split (as it's a whitespace-separated list).  * depgraph: Fix crash with --useoldpkg with subslot bumps (bug #932804).  * depgraph: find_smallest_cycle: Revert optimization which caused   merge order regression (bug #922629).    A new testcase is also added.  * sync: Don't use IPv6 for rsync when disabled (bug #927241).  * atomic_ofstream: Use mkstemp instead of PID for PID namespace safety (bug #851015).  * MergeProcess: Pass bintree to subprocess (bug #933297).    This fixes FEATURES="downgrade-backup".  * tar_stream_writer: Improve error handling (bug #933385).  Cleanups: * Scheduler: Improve legibility.  * portage.util.shlex_split: Drop legacy Python 2 wrapper.  * eapi.sh: Drop obsolete ___eapi_has_dohtml_deprecated().  portage-3.0.64 (2024-04-28) --------------  Features: * Scheduler: Support parallel-install with merge-wait (bug #256616, bug #925213).    This makes the (future) improvement mentioned in portage-3.0.62's NEWS.  * phase-functions: prematurely delete WORKDIR if FEATURES=merge-wait    The 'merge-wait' feature could lead to running out of disk space on   PORTAGE_TMPDIR's filesystem because many more workdirs were kept around   until merging was queued up. We now purge the workdirs but keep the image   around until merging.  * Start to record REPO_REVISIONS in build-info in VDB (bug #924772).    Ultimately the intention is to expose this information in binhost   metadata so that clients can select consistent revisions of source   repositories.  * util: file_copy: Support btrfs's FICLONE ioctl for fast file clones.    Added when implementing the below 'src: Drop linux_reflink C module.'   cleanup.  * sync: Add new 'zipfile' sync-type.    This allows fetching ebuild repositories via snapshots from e.g. GitHub,   gitweb, cgit.  Bug fixes: * ctypes: Add workaround for loading libc on musl.  * util: set a timeout for urlopen calls (bug #926221).  * SpawnProcess: Fix noise / warnings caused by set_term_size (bug #923750, bug #925456).  * binpkg, gpkg: Add missing newlines to error messages.  * writable_check: Improve whitespace handling when parsing /proc/self/mountinfo (bug #925888).  * doebuild: Call _setup_locale (bug #925863).    This is needed to more robustly handle invalid or inappropriate locale settings.  * binarytree._populate_remote: Fix UnboundLocalError for binpkg-request-signature (bug #926048).  * elog/mod_custom: Spawn processes in background (bug #925907).    Fixes a noisy crash on exit.  * Fix REQUIRED_USE error with --fetchonly --pretend but not --fetchonly (bug #675748).  * socks5: Fix exit with FEATURES="network-sandbox-proxy" or FEATURES="distcc" (bug #925240).  * meson.build: Install dist-info METADATA (bug #920330).    This is needed for 'pip' to not be confused when Portage is installed system-wide.  * EbuildPhase/EbuildBinpkg: Ensure PKGDIR subdirectory permissions (bug #712222).    A warning (failure) was observed with FEATURES="installsources" otherwise.  * config: Sort FEATURES to avoid non-determinism (bug #914441).  * man: Document autoenabled options by --getbinpkgonly.  * BinpkgPrefetcher: Use eerror for binarytree inject failures (bug #927632).    This improves the readability of the error substantially.  * install-qa-check.d: Remove QA warning when no bash completions are found  (bug #928599, bug #928869).    This check had too many false positives.  * lib: use more pure git-describe output for --version (bug #912209).    This makes 'emerge --version' info far nicer when using portage-9999.  * lib: adhere to python package version conventions (bug #926966).    (Note that this needed fixing even before the change for bug #912209).  Cleanups: * cnf: sets: Migrate @golang-rebuild to dev-lang/go (removed from Portage) (bug #919751).  * src: Drop libc C module.    This was only used for `find_library` on musl. We've now implemented   an alternative workaround for this.  * src: Drop linux_reflink C module.    This is now implemented in pure Python, which also means PyPy can   benefit.    Testsuite coverage was also improved for this area.  * Delete compat_coroutine module.  portage-3.0.63 (2024-02-25) --------------  Bug fixes: * emerge: Skip installed packages with emptytree in depgraph selection (bug #651018).  * bin/install-qa-check.d: 90gcc-warnings: drop warnings with too many FPs (bug #925460).  * AsyncioEventLoop: Call process.run_exitfuncs() before close (bug #925240).    Fixes hang with FEATURES="network-sandbox-proxy" or FEATURES="distcc".  * SchedulerInterface/PollScheduler: Add _loop property (bug #925333).    Fixes erroneous assert.  * _dynamic_deps_preload: Fix settings reference (bug #925350).    Fix KeyError with --dynamic-deps.  * process.spawn: Fix logic for missing libc.unshare on musl (bug #925311).    Fix handling when we can't unshare where we might e.g. modify the hostname   of the real system on musl.  * dbapi: Fix TypeError when passing Exception to warnings.warn (bug #922935).    Fix testUpdateDbentryDbapiTestCase.  * _start_proc: Prevent premature ForkProcess garbage collection (bug #925456).    Fix warnings/errors like "[ERROR] Task was destroyed but it is pending!".  Cleanups: * More asyncio porting.  portage-3.0.62 (2024-02-22) --------------  This release has a lot of misc. bug fixes as well as many asyncio fixes from Zac to kill off unsafe fork use.  Features: * cnf: make.conf.example.arc: Add for the arc arch.  * ELF: Add entries for ARC machines  * bintree: Use urllib to parse PORTAGE_BINHOST / sync-uri so IPv6 works (bug #921400).  * FEATURES: Add FEATURES="merge-wait", enabled by default, to control whether   we do parallel merges of images to the live filesystem (bug #663324).    If enabled, we serialize these merges.    For now, this makes FEATURES="parallel-install" a no-op, but in future, it   will be improved to allow parallel merges, just not while any packages are   compiling.  * estrip: Add FEATURES="dedupdebug" (bug #906368).    This uses sys-devel/dwz to deduplicate installed DWARF debug information.    Future improvements may be made for multifile support.  * Support PROPERTIES="test_privileged" to not drop privileges for tests (bug #924585).  Bug fixes: * vartree: Make _needs_move() resilient to corrupt files on the live filesystem   (do a full copy/replace).  * binpkgs: Handle SignatureException during package moves (bug #922142).  * gpkg, bintree, binpkg: Add missing newlines to signed binpkg update notice.  * emerge: Backtrack consistently regardless of --fetchonly (bug #922038).  * emaint: Cleanup duplicate 'usage:' output.  * installed_dynlibs: Resolve *.so symlinks (bug #921170).  * bin: Consistently prefix eqawarn with 'QA Notice' (bug #728046).  * _overlap_dnf: Deduplicate any-of blocks which improves performance (bug #891137).  * tests: Handle larger PAGE_SIZE in environment size check (bug #923368).  Cleanups: * tests: Add a job with multiprocessing set to the 'spawn' method.  * tests: Fix missing playground cleanups.  * process.spawn: Add abstraction for os.fork() to allow migrating callers to it.  portage-3.0.61 (2024-01-05) --------------  A small set of binpkg robustness fixes.  Bug fixes: * BinpkgFetcher: Preserve mtime (bug #921208).  * bintree: Don't call trust helper unless bindb is writable (bug #915842, bug #920180).  * bintree: Avoid unnecessary build id incrementation (bug #921208).  * bintree: Handle inject failures (bug #921327).  * emaint: merges: Fix TrackingFile for utf8_mode (bug #921181).  portage-3.0.60 (2024-01-02) --------------  A small set of binpkg robustness fixes.  Bug fixes: * EbuildBinpkg: Avoid crash with verification failure in some cases (bug #921089).  * dbapi: Raise CorruptionKeyError - which is treated as a warning - during pkgmoves   to avoid falling over in the event of a corrupt Packages index (bug #920828).  * EbuildFetchTestCase: Fix key order assumption (bug #921107).  * gpkg: Fix basename handling via aux_update (in particular with FEATURES="binpkg-multi-instance")   (bug #920828).  portage-3.0.59 (2023-12-27) --------------  Features: * emerge: depclean now returns with failure if no packages are matched   (bug #917120).  * bintree: Support 'file://' scheme for binhost sync-uri (bug #920537).  * sync: git: Include signing key and git revision in log output with --verbose   or if a failure occurs.  Bug fixes: * Scheduler: Handle aborted unpack more gracefully (bug #920258).  * Scheduler: Handle SignatureException in _run_pkg_pretend to give a proper   error message if a signature could not be verified, rather than crashing out   (bug #920258).  * ebuild: Improve 'command not found' regex for the dash shell (bug #822033).  * ebuild: Do not skip 'command not found' QA warnings for configure (bug #245716).  * emerge: Fix --binpkg-respect-use output optimization (was broken by refactoring   for ROOT support).  * depgraph: Use strip_libc_deps in _eliminate_rebuilds (bug #915494).  * depgraph: Handle IDEPEND circular dependencies for depclean (bug #916135).  * bindbapi: Update Packages index when signed binpkgs are invalidated post-updates   (bug #920095).  * _global_updates: Take a lock when performing updates (bug #587088, bug #920095).  * make.conf(5): Fix note about binpkg extension for gpkg.  * addread, addwrite, adddeny, addpredict: Warn about passing a colon-separated   list of paths as argument (bug #920654).  portage-3.0.58 (2023-12-14) --------------  Breaking changes: * Switch BINPKG_FORMAT to "gpkg" by default (bug #912672).  portage-3.0.57 (2023-12-10) --------------  This release has a series of binpkg robustness fixes. Notably, it includes a workaround/fix for binpkgs built against a newer glibc to ensure that they aren't merged on a binpkg consumer before merging a newer glibc, which has been a longstanding cause of frustration for binpkg users.  Features: * emerge: Make --binpkg-changed-deps output far more concise (don't show   packages missing from the merge list).  * ebuild: Inject implicit libc RDEPEND. This avoids "bricking" systems when   using binpkgs built against a newer glibc (bug #753500, bug #913628).  * BinpkgVerifier: Improve error message on stale binpkg index. This became   more common with the portage-3.0.52 default change to FEATURES="pkgdir-index-trusted"   (bug #915474).  Bug fixes: * Fix package moves for signed binary packages by deleting the old binpkg   if it cannot be re-signed, rather than crashing (bug #919419).  * Set SYSROOT appropriately for best_version and has_version so that they work   when cross-compiling and IPC is disabled.  * bindbapi: Add missing SIZE key for binpkg-multi-instance (bug #906675,   bug #918597, bug #919668).  * resolver: Weaken circular dependency handling for cross-root (bug #919174).  * BuildLogger: Avoid hang with -ipc builds (bug #919072).  * soname dependency support: Fix crash with --ignore-soname-deps=n (bug #919311).  * sets: VariableSet: Flatten dependencies so that e.g. www-client/firefox   appears in @rust-rebuild.  portage-3.0.56 (2023-12-01) --------------  In particular, this release improves dependency resolution robustness in a few scenarios.  Breaking changes: * ebuild: no longer implicitly set NOCOLOR and NO_COLOR when color output   is disabled for emerge itself.  In order to obtain color-free logs, please   either explicitly set NO_COLOR environment variable or use e.g. ansifilter.  Features: * sync: git: Add sync-git-verify-max-age-days option.  Bug fixes: * resolver: Handle merge order correctly for some circular dependencies   (e.g. app-alternatives/gzip with app-arch/pigz and sys-libs/zlib)   (bug #690436, bug #917259).  * resolver: Adjust priorities to fix wrong merge order   (e.g. net-misc/curl with net-libs/nghttp2) (bug #918683).  * resolver: Optimize find_smallest_cycle (bug #918682).  * emerge: Fix PROMPT_COMMAND crash on shutdown (bug #917033).  * emerge: Fix crash on some build failures (bug #917315).  * emerge: Give output referring to emerge-fetch.log for FEATURES="parallel-fetch"   while waiting for binpkgs (bug #760893).  * ebuild: Add missing newlines in error messages.  Cleanups: * tests: Add pytest markers: ft, unit and stress.  * tests: Add test for trust helper --pretend issue (bug #915842).  portage-3.0.55 (2023-11-06) --------------  Bug fixes: * Convert portageq helper to a function to avoid breaking external callers   (bug #916287, bug #916296).  * Avoid crash with incomplete depgraph for binpkg-respect-use notice (bug #916614).  * Avoid crash with blockers in depgraph for binpkg-respect-use notice (bug #916336).  * Don't call trust helper (e.g. getuto) with --getbinpkg --pretend as we may   lack privileges to do anything (bug #915842).  portage-3.0.54 (2023-10-25) --------------  Zac has continued working on preparing us for the 'spawn' multiprocessing method.  Breaking changes: * Finally ban non-PMS helpers portageq, prepinfo, prepman, prepstrip and   prepallstrip (bug #899898, bug #906129, bug #906156).  Features: * sync: git: Pass --verbose to git when emerge --sync --verbose.  * sync: git: Forcefully update git remote to match sync-uri for non-volatile   repositories (bug #905869).  * emerge: Make --binpkg-respect-use output far more concise (don't show   packages missing from the merge list and don't show packages w/ multiple   BUILD_IDs).  Bug fixes: * SpawnProcess, ForkProcess: Pass stdin via fd_pipes for non-background. This   fixes e.g. emerge --sync --ask (bug #916116).  * _emerge: Fix looking up package name for error colorization (bug #915551).  * sync: git: Handle when git is configured with 'log.showSignature'.  * StaticFileSet: Fix os.walk for utf8_mode (bug #916182).  * create_trees: Handle bytes arguments for utf8_mode (bug #916149). This broke app-portage/unsymlink-lib.  Cleanups: * MergeProcess: Support QueryCommand with spawn start method (bug #916106)  * vardbapi.unpack_contents: Support spawn start method (bug #916112)  * vardbapi.unpack_metadata: Support spawn start method (bug #916108)  * ForkProcess: Implement fd_pipes via send_handle for spawn start method (non-fork)   (bug #915896).  portage-3.0.53 (2023-10-20) --------------  Standard mix of bug fixes and new features, along with Zac's continued work on preparing us for the spawn multiprocessing method.  Features: * GNUMAKEFLAGS: also specify "-l $(nproc)", that is, limit by load average,   per default.  * Increase default number of maximum backtrack attempts from 10 to 20.  Bug fixes: * bintree: Add another API member (invalid_errors) to allow eclean-pkg to suppress   errors when cleaning invalid binpkgs (bug #900224).  * repos.conf: Fix default value of sync-rsync-verify-max-age for ::gentoo. It   was previously '24' which allowed far too much time with a stale mirror and   could lead to users missing important updates.  * Miscellaneous determinism/reproducibility fixes for binpkgs / environment (bug #914441).  * make.conf(5): Update MAKEOPTS guidance to reflect modern practice (bug #821529).  * For locales that have UTF-8 filesystem encoding, use unicode strings rather   than raw bytes for file paths in calls to python modules like os and shutil   (bug #914722).    We recommend using a UTF-8 locale for both performance and correctness reasons.  * Eliminate unnecessary package reinstalls (bug #915494).  * Update the git remote URL of an overlay with its configured sync-uri   when necessary (bug #905869).  portage-3.0.52 (2023-10-03) --------------  This release has a nice speedup for backtracking caching and supports eclean-pkg removing invalid binpkgs.  Breaking changes: * FEATURES=pkgdir-index-trusted is now on by default. This improves performance   with binpkgs, but does require that users run `emaint binhost --fix` if they   manually add or remove binpkgs from their PKGDIR (bug #889300).  Features: * Refine _slot_operator_check_reverse_dependencies caching (bug #883071).  * bintree: Add new API member (invalid_paths) to allow gentoolkit to later   clean up invalid binpkgs (bug #900224).  * gpkg: Run PORTAGE_TRUST_HELPER before remote binary package operations (bug #913070).  * emerge: Use appropriate colors if binpkgs are used in e.g. pkg_pretend   messages as well as elog's mod_echo module (bug #914159).  * Show backtrack information after dependency resolution.  Bug fixes: * Prevent gpg from removing /dev/null when unlocking signing key (bug #912808).  * emerge: ensure paths are UTF-8 encoded in _needs_move() (bug #913103).  * vartree: keep build dir if postinst fails (bug #704866).  * fetch: fix fetching of layout.conf when FEATURES=force-mirror (bug #877793).  * dispatch-conf, etc-update: fix SELinux security labels on merged files.  * emerge: fix application count when listing search results for ambiguous   packages (bug #915054).  * env-update: Write ${EPREFIX}/usr/etc/ld.so.conf with unprefixed paths on   prefixed systems to fix the bfd linker in some obscure cases (bug #892549).  * locks: Handle multiprocessing 'spawn' method (bug #915119).  Cleanups: * vartree: Remove unused variables and parameters  * locks: Drop obsolete EINTR wrapper  portage-3.0.51 (2023-08-20) --------------  This release features better debug logging in particular.  Features: * emerge: Set up logging immediately and respect --debug for log level.  * sync: git, rsync: now respects --debug for better output from gemato. This is   especially useful for debugging hangs during the 'Refreshing keys' stage.  Bug fixes: * sync (inc. emerge-webrsync): Handle https_proxy to help users who only have it set   - the expectation is to have http_proxy set (bug #691434, bug #835927, bug #911629)  * sync: git: respect --quiet more for PGP verification (bug #673624).  * emerge-webrsync: Explicitly pass http_proxy or https_proxy into gemato   via --proxy (bug #911629).  * doebuild: gate -Oline behind MAKEFLAGS check (bug #909009).  * misc/emerge-delta-webrsync: Fix PGP logic which prevented syncing for this   rarely-used tool (bug #911335).  * make.conf(5): Mention https_proxy.  portage-3.0.50 (2023-08-09) --------------  This release has a major build system rework to support PEP517 by migrating to meson-python, thanks to Chewi!  Breaking changes: * The minimum supported Python version is now >= Python 3.9.  * Portage now installed with Meson and Python sdist + wheel now prepared with   meson-python for PEP 517 compliance.  * FEATURES=cgroup was removed since it was based on version 1 cgroups, which   caused some issues and version 1 cgroups are obsolete. Use   FEATURES=pid-sandbox instead.  Bug fixes: * install-qa-check.d/05prefix: Fix prefixifying shebang for >= EAPI 7 ebuilds   (bug #909147).  * bin/save-ebuild-env.sh: Stop using compgen and hence stop needing readline   (bug #909148).  * _reflink_linux_file_copy: Fix -Wmaybe-uninitialized.  * env-update: Check exit code from ldconfig (bug #910376).  * emerge: Fix 'no ebuilds available' message always mentioning binpkgs   (bug #909853).  * gpkg: Fix timestamp for binary packages (bug #909067).  * Ensure non-Python (s)bin scripts launch other Python-based Portage scripts   using the same environment.  * Use the correct Python library path when launching scripts directly from a   virtual environment.  * Define BROOT in pkg_* phases following PMS change.  * portage(5): Fix description of 'volatile' repos.conf setting (bug #911594).  portage-3.0.49 (2023-06-21) --------------  Bug fixes: * Adjust write tests for DISTDIR and PORTAGE_TMPDIR to work with automount   directories (bug #485100, bug #890812).  * depgraph: Do not allow slotted deps to be satisfied by wrong slots   (bug #463976, bug #592880, bug #596664, bug #631490, bug #764365, bug #793992).    This is the notorious "Perl rebuild" bug where Perl modules would get rebuilt   _before_ a new dev-lang/perl and therefore be broken at runtime.  * dosym: Prevent globbing of argument in dosym_canonicalize().  * emerge-webrsync: Give a nicer error message if the requested key isn't   on the filesystem (bug #905868).  * glsa-check: appropriately handle more error cases with invalid GLSAs   (bug #905660)  portage-3.0.48.1 (2023-06-06) ----------------  Bug fixes: * sync: webrsync: Fix syncing with keyserver explicitly specified (bug #907816).  portage-3.0.48 (2023-06-01) --------------  Breaking changes: * Output deprecation warnings for portageq, prepstrip and prepallstrip   when they are called from an ebuild (bug #906129, bug #906156).  Features: * Optimize merge process by only writing files to disk if a package's   contents have changed. This is particularly beneficial on CoW filesystems   with snapshots. This is always enabled. See bug #722270.  Cleanups: * Begin porting to pytest!  Bug fixes: * fowners, fperms: Fix handling of relative pathnames (bug #905223).  * emerge-webrsync: Switch Portage to use gemato for when it shells out   to emerge-webrsync for repositories configured with sync-type=webrsync   (bug #905358).    This unifies some of the logic between Portage and emerge-webrsync:   both of them now use the same main path for PGP verification (i.e.   gemato).  * emerge-webrsync: Fall back correctly to manual gpg (rather than aborting   entirely) if gemato is not installed (bug #905868).  Cleanups: * Convert printf-style %-formats into fstrings.  * Move the internal portageq wrapper script out of the ebuild-helpers   directory.  * Drop unused deprecated-path script.  portage-3.0.47 (2023-04-30) --------------  Security: * emerge-webrsync (the standalone tool) now verifies PGP signatures, see   bug #597800. Note that 'sync-type = webrsync' in repos.conf already   handled PGP verification when configured to do so (and it is by default).  * dispatch-conf: Avoid race when accessing log file (bug #903973).  Features: * install-qa-check.d: 90gcc-warnings: Add additional code quality warnings:   - -Wrestrict   - -Wstringop-overread   - -Wstringop-truncation   - -Wformat-truncation   - -Wcast-function-type   - -Wnull-dereference   - -Wmain   - -Wimplicit-int   - -Wstring-compare * install-qa-check.d: cython-dep: Report packages that are using Cython   but are missing BDEPEND on it.  Bug fixes: * econf now checks for proper end of string in "configure --help" output for   all options starting with "--with-", "--disable-" or "--enable-", in order   to pass them to configure. This follows a change in PMS (bug #815169).  * All _E_*DESTTREE_ variables to renamed to __E_*DESTTREE, in order to move   them to the __* namespace which is reserved for the package manager.  * The PVR variable includes -r0 if explicitly specified (bug #875362).  portage-3.0.46 (2023-04-07) --------------  Breaking changes: * Drop STREEBOG{256,512} support    Support was originally added in https://bugs.gentoo.org/597736, but   exclusively via two modules (pygost and pygcrypt) which aren't packaged in   Gentoo - or seemingly any other major distribution.    We're dropping both pygost and pygcrypt compatibility: pygost has been   removed from pypi and pygcrypt is inactive upstream.    pygost being yanked from pypi made CI start to fail too and silently dropping   it from CI without addressing the situation which was already suboptimal (insufficient   testing) wasn't deemed acceptable.  * Inline most code from prepinfo in install_qa_check() (bug #899898).   Output a deprecation warning for prepinfo and prepman when they are called   from an ebuild.  Cleanups: * Drop support for pygcrypt    The codepath has been disabled since 2017 because of https://bugs.gentoo.org/615620,   so let's finally clean it up.    pygcrypt *prior to 2017* was used for RMD160/WHIRLPOOL/SHA3_256/SHA3_512   if hashlib didn't provide these *and* the sha3 module didn't either.    pygcrypt last received a release in 2017 too.  * Drop support for pyblake2, sha3    We've only supported >= Python 3.6 for quite some time, so these codepaths are   obsolete given hashlib will always provide support for BLAKE2 and SHA3.    Neither pyblake2 nor sha3 are even packaged in Gentoo anymore either (the   Python bindings).  * Drop most of the pycrypto/pycryptodome fallbacks    >= Python 3.6 includes support for BLAKE2 and SHA3 in hashlib, so these   aren't needed anymore.    pycrypto fallback support continues to exist for RMD160.  * Drop support for WHIRLPOOL logic via mhash    Drop mhash fallback logic for WHIRLPOOL as we already have:       hashlib > pycrypto > bundled C > bundled pure Python   in terms of priority for providers.  Features: * Respect the NO_COLOR environment variable for disabling color.    The new quasi-standard for disabling ANSI color is to check for the NO_COLOR   environment variable and disable color when the variable has a nonempty value.   See bug #898224. Portage previously used NOCOLOR. It continues to support NOCOLOR   for a time for compatibility.  * ci: enable running Portage tests on sourcehut builds    The build manifests and supporting files can be found in .builds/    Current limitations compared to GitHub actions:    - Does not test with PyPy (see bug #903709)   - Runs all all tests on each push (unless pushed with `-o skip-ci` which skips     all tests)   - Runs lint and ci jobs concurrently, but each Python version within those is     tested sequentially. This means tests will take longer to complete, unless     the run fails partway through (~1h vs ~15-20m).    Benefits compared to GitHub actions:    - Can monitor test progress over SSH   - Can investigate failed tests over SSH   - ... not GitHub ;)  Bug fixes: * dbapi: Handle mismatched binpkg structure during pkgmoves (bug #877271,   bug #903917, bug #903926).  * tests: util/test_shelve: fix test failure if the backend for the shelve module   does not create the shelve db using the literal filename.  portage-3.0.45.3 (2023-03-19) ----------------  Features: * New portage FEATURE warn-on-large-env, to emit a warning if portage   executes an ebuild-related child process with a large environment.  Bug fixes: * repository: config: Handle more error cases when determining repository   volatility (bug #900683).  portage-3.0.45.2 (2023-03-04) ----------------  Bug fixes: * repository: config: Fix initial sync of repositories (bug #899208). Regression   from portage-3.0.45, but the real bug is from portage-3.0.42.  portage-3.0.45.1 (2023-02-27) ----------------  Bug fixes: * install-qa-check.d/90config-impl-decl: fix handling of non-ASCII quotes when   extracting the function name. Detect "-Werror=implicit-function-declaration"   as used by GCC.  portage-3.0.45 (2023-02-26) --------------  Features: * Support new ELF machine code: AMDGPU (bug #795825)  * ebuild: Set GNUMAKEFLAGS="--output-sync=line" to ensure build logs are written   to synchronously when running GNU make in parallel. This option is only set if   MAKEOPTS and GNUMAKEFLAGS are left unset by the user.  * emerge: add --onlydeps-with-ideps=<y|n> option (bug #890777)  * emerge: add --update-if-installed option. This is useful for one-shot   emerge commands to be run across several machines to upgrade packages   only if they're installed.  * install-qa-check.d: 60pkgconfig: add opt-in QA_PKGCONFIG_VERSION check  * install-qa-check.d: add 90config-impl-decl to detect -Wimplicit-function-declaration   in config.log, CMakeError.log, and meson-log.txt. ebuilds can add functions to   the QA_CONFIG_IMPL_DECL_SKIP array to skip false positives.    The following entries are created in qa.log under the tag 'config.log-impl-decl':    * 'line' - line number in the config log where the warning is found   * 'func' - the function that is implicitly declared    (bug #892651)  * emerge: Log completion of package installs.  Bug fixes: * gpkg: Handle out-of-space errors (bug #891391).  * gpkg: GPG signed gpkg will be ignored for profiles updates.  * binpkg: Show warning if the binhost is missing metadata (outdated). (bug #884869)  * binpkg: Improve error handling for binpkg detection. (bug #893638)  * portage(5): List volatile option as a separate entry (bug #888585).  * emaint: Changed default action for emaint target sync to 'auto'.  * tests: news: significantly improved test coverage (bug #889330).  * git: also report sync errors for volatile repos. Portage would previously simply   report success if an volatile repository failed to sync (bug #895526).  * git: correct detection of volatile repositories (bug #895526).  * ebuild(5): alphabetize QA_* vars  portage-3.0.44 (2023-01-15) --------------  Features: * emerge: Show time taken to calculate dependency resolution with   emerge --verbose.  * cleanups: Use flynt on the codebase to upgrade to Python f-strings everywhere.  * process: Show diagnostic message if exec failed with E2BIG  Bug fixes: * ebuild: the PATH variable exported to ebuilds has been changed:   The PATH setting from /etc/profile.env is appended to portage-internal   paths, and ROOTPATH is no longer included (bug #607696, #693308, #888543).  * emerge: Fix installation of binpkgs by path (bug #873202, bug #890291).  * Fix crash with pypy when PORTAGE_SCHEDULING_POLICY has been set (bug #876031).  portage-3.0.43 (2023-01-02) --------------  Bug fixes: * news: Fix matching profile paths with Display-If-Profile in some cases.  * checksum: Rewrite Whirlpool implementation as a C extension to substantially improve   performance (bug #885909).    This only takes effect with OpenSSL 3 and newer (unnecessary otherwise).    Whirlpool is considered deprecated within Portage and we recommend that   repository maintainers remove it from `metadata/layout.conf`!  * sync: git: Fix "is shallow git repository" check.  * bin: Rewrite signal handling which will now correctly rethrow SIGINT   and not confuse shells (bug #887817).  * bin: Pass -S to file(1) to avoid seccomp sandbox issues (bug #811462, bug #889046).    Files being installed by Portage are generally trusted but also the   syscalls allowed by file are quite broad anyway.    Things can go catastrophically wrong if file misses valid input,   as we may have invalid VDB metadata.  portage-3.0.42 (2022-12-26) --------------  Breaking changes: * Portage changed its git sync behaviour for repositories with sync-type=git.    Recently in Portage 3.0.39 (for sync depth) and Portage 3.0.40 (git reset/clobbering),   Portage started doing two things:    1. Clobbering changes to repositories with sync-type=git    If git is pulling from a CDN, Portage may on one sync receive state X, but   on a subsequent sync receive state X-1. This can cause an odd state   where git wants to resolve conflicts and manual intervention is required,   hence needing git reset.    This situation was often worse with sync-depth=1 and would lead   to orphaned files hence needing git clean.    2. Defaulted to sync-depth=clone-depth=1.    The motivation here was because of disk space growing unbounded   otherwise, as a full disk could lead to sync failure. It also makes sense   when considered within the school of thought / motivation listed above   (prioritising a successful sync and then making an optimisation   based on how we achieve that).    Portage 3.0.42 will now only make a repository shallow if:   1. volatile=yes and it is a new sync (i.e. it was not deep before), or   2. volatile=no  and sync-depth is unset in repos.conf.    --    To allow users to opt-out of these destructive changes, we now   have a repository setting called 'volatile'.    * If volatile=yes, the repository is assumed to be user-modifiable     and Portage will NOT prioritise successful sync over preserving     repository state.    * If volatile=no, the repository is assumed to only be modified     by Portage, and Portage will try its best to ensure syncs continue     to work.    The default value of 'volatile' is determined as follows:   - If the repository is under /var/db/repos or if it is owned by either     'portage' or 'root', then it defaults to 'no'. That is, portage     assumes full control over the repository, potentially performing     destructive changes to the repository.   - If the repository is not under /var/db/repos or owned by a different     user than 'portage' or 'root', then it defaults to 'yes'. That is,     portage assumes the repository is user owned and does *not* perform     any destructive changes.  Features: * cnf: make.conf.example.loong: add for the loong arch (bug #884135).  * sync: git: only perform destructive operations like 'git reset' to keep   sync working and the repository in a predictable state for sync-type=git   repositories if the repository is not marked volatile.  * sync: git: only perform shallow updates if the repository is a shallow one   or if the repository is not marked volatile.  * sync: git: run 'git clean' in git repositories if they are marked as   non-volatile.  Bug fixes: * glsa: Abort if a GLSA's arch list doesn't match the expected format (bug #882797).  * install-qa-check.d: 60pkgconfig: avoid using grep -P (PCRE) unnecessarily (bug #884285).  * etc-update: Apply defences for patsub_replacement being default on in Bash 5.2   (bug #881383).  * make.conf(5): Note the various file suffixes / file extensions used   for binary packages.  * logging: Write logs under BROOT, not EPREFIX.  portage-3.0.41 (2022-11-04) --------------  Features: * vartree: On collisions which are non-fatal (e.g. orphaned files when using   FEATURES="protect-owned"), Portage now has friendlier output   by using ewarn rather than eerror.  * cleanups: Use pyupgrade on the codebase (up to Python 3.8) to use newer   idioms.  Bug fixes: * Fixed possible corruption of GPKG multi-instance binary packages on upgrade.   Bug #877271.  portage-3.0.40 (2022-12-01) --------------  Features: * Optimize _slot_operator_check_reverse_dependencies by caching using   lru_cache. In a ChromeOS use case, this patch decreases the running time from   311s to 197s with almost no memory usage increase. See bug #883071.  * config: /etc/portage/sets.conf can now be a directory. Ditto for the Portage extension   supporting sets.conf in ebuild repositories.  * sets: Tests added for VariableSet changes to check @golang-rebuild works as   intended.  * cleanups: Drop long-obsolete Jython compatibility code.  * cleanups: Use designated initializer syntax in src/ (C bits).  * Add support for a distinct SYSROOT location that is not equal to / or ROOT.   This is only expected to be used for cross-bootstrapping a new system from   scratch using a crossdev environment under /usr/${CHOST}.  Bug fixes: * ebuild: Handle Bash 5.2's change in behavior which enables the shopt   'patsub_replacement' by default. This is needed to avoid breaking existing   working ebuilds. Future EAPIs will need to adjust the logic   added by this change. See bug #881383.  * sync: Clobber repositories using sync-type=git to match rsync behavior. This   helps with issues where git-synced repositories can become confused   if the remote is a CDN and then starts to diverge, preventing further   syncs.  * portage: sets: Fix DeprecationWarning in sets.  * install-qa-check.d: 90gcc-warnings: Disable -Wimplicit-function-declaration being   fatal for now. The number of failures in bug #870412 is too large for the time   being.  * Fix definition of ESYSROOT to use SYSROOT's prefix. For a given location, we   were basing ESYSROOT on the prefix of that location instead of the prefix used   by the SYSROOT location. For example, if BROOT=/foo, ROOT=/bar, EPREFIX=/baz,   EROOT=/bar/baz, and SYSROOT=/ then ESYSROOT should be /foo, not /baz.  * depgraph: Resolve atoms using the correct root. This bug may have played out   in different ways, but one example was a rebuild in / causing the same package   to be added to ROOT, even when it had no other reason to be. See bug #520112.  * env-update: Also generate PATH definition in systemd user environment file   /etc/environment.d/10-gentoo-env.conf  * bintree: Properly assign filenames for remote binpkgs.  * --disable-static is only passed for libtool-enabled configure scripts in EAPI 8.   This avoids annoying warnings when a configure script has a flag such as   --disable-static_link that would then trigger a QA warning (bug #814380).  portage-3.0.39 (2022-11-20) --------------  Features: * gpkg: Call xz and zstd with -T N where N is the number of jobs from ${MAKEOPTS}   for parallel compression (xz & zstd) and decompression (xz with newer versions).  * gpkg: Add per format compression flags for binpkgs. This adds new config   options BINPKG_COMPRESS_FLAGS_[format] to be used for different compression   methods. General BINPKG_COMPRESS_FLAGS will be ignored if current method had   specified BINPKG_COMPRESS_FLAGS_[format] (bug #871573).  * sync: git: git will sync with --depth=1 unless otherwise specified in repos.conf   (bug #824782).  * install-qa-check.d: 90gcc-warnings: Add additional code quality warnings   which are indicative of problems with LTO in particular:   * -Wbuiltin-declaration-mismatch   * -Wlto-type-mismatch (LTO esp.)   * -Wmismatched-dealloc   * -Wodr (LTO esp.)   * -Wreturn-type   * -Wstringop-overflow (GCC, FORTIFY_SOURCE)   * -Wfortify-source (Clang, FORTIFY_SOURCE)   * -Wstrlcpy-strlcat-size   * -Wstrncat-size   * -Wsuspicious-bzero   * -Wvarargs   * -Wargument-undefined-behaviour (Clang)   * -Wincompatible-function-pointer-types (Clang, becomes fatal in Clang 16)     (note we already have -Wincompatible-pointer-types in the list for GCC)   * -Wundefined-reinterpret-cast (Clang, C++ strict aliasing)   * -Wcast-function-type-strict (Clang, CFI)   * Further -Wformat matches for missing specifiers.     In future, we may warn on all -Wformat (in particular because of e.g.     time_t & LFS).  * install-qa-check.d: 90gcc-warnings: Always die on -Wimplicit-function-declaration   and remove bin/check-implicit-pointer-usage.py of dubious licencing (it was   broken since GCC 4.5 because of output changes anyway, bug #365655).    -Wimplicit-function-declaration becomes an error in Clang 16 onwards and   GCC is likely to do the same from 14 onwards. See bug #870412.  * ecompress, etc: Support additional compression suffixes for texinfo:   .Z, .bz2, .lzma, .lz, .xz, .zst (bug #757525).  Bug fixes: * binpkg: Deprecate BINPKG_FORMAT in the binpkg manifest ('Packages') because   it can become out-of-sync with reality and shouldn't be relied upon anyway   (bug #877419).  * binpkg: Add various asserts / integrity checks to detect structure mismatches   and detect problems earlier (bug #877357, bug #877271, bug #877419).  * binpkg: gpkg: Try to correct mismatched structures (old/new gpkg structure)   (bug #877271).  * binpkg: gpkg: Handle package renames ('updates') where the same category was   used but with a new package name (bug #877357).  * binpkg: gpkg: Don't silence compressor stderr to ease debugging (bug #877215).  * Manifest: Fix Manifest.addFile() calls and add tests (bug #875860).  * ecompress, etc: Pass --quiet to xz to reduce noise from "reducing threads"   messages.  * ecompress, etc: Pass --memlimit-compress=50% to xz to avoid breakage   on 32-bit systems with large -Tn. Required for < xz-5.3.3_alpha and   has an equivalent effect to the limiting that comes with newer xz versions.   We don't need it for decompression as it's there by default in newer xz   and it's a no-op in older xz.  * emerge(1), make.conf(5), xpak(5): document BINPKG_FORMAT and the gpkg binary   package format further.  * sync: git: Fix sync printing local repo path (bug #875812)  portage-3.0.38.1 (2022-10-04) ----------------  Bug fixes: * ecompress: Fix typo in ___makeopts_jobs (bug #874597).  portage-3.0.38 (2022-10-01) --------------  Features: * unpack now calls xz(1) with -T N where N is the number of jobs from ${MAKEOPTS}.   This allows decompression in parallel with new enough xz (>= xz-utils 5.3.3 alpha)   and where the source file was compressed using the parallel xz compressor   (which becomes the default with newer xz too).  * portage: sets: Parse INCLUDES/EXCLUDES in VariableSet which allows properly   checking for dependencies. Update @golang-rebuild accordingly which now   includes all packages depending on dev-lang/go (bug #827974, bug #865115)  * cnf: Provide a @rust-rebuild set, similar to @golang-rebuild.  * bin: ecompress: xz, zstd: Pass -T N where N is the number of jobs from ${MAKEOPTS}   to xz, zstd for parallel compression.  * bin: ecompress: xz: Pass -9 to xz for compression level like we do for bzip2 & gzip.  Bug fixes: * emerge: Scheduler: Fix filenames for binpkgs in some cases - reuse existing   filename and don't allocate a new one (bug #872392).  * dbapi: bintree: Avoid fetching 'Packages' multiple times (bug #864259).  * binpkg: Handle failure of various BINPKG_COMPRESS_* commands (bug #871570).  * data: Fix PORTAGE_USERNAME default (bug #873088).  * bin: isolated-functions.sh: return number of CPUs in ___makeopts_jobs as default   instead of 1 to match Portage's behavior on the Python side.  * bin: ecompress: Recognize .lz, .lzo, .lz4, and .zst as compressed file   suffixes for the purposes of the internal compressed file collision check.  * bin: ecompress: zstd: Set '-q --rm' in PORTAGE_COMPRESS_FLAGS to behave   like other compressors.  * portage: _global_updates: Fix update summary output.  portage-3.0.37 (2022-09-23) --------------  Bug fixes: * _emerge: SpawnProcess: Avoid sandbox violations with PROPERTIES="interactive"   when accessing /dev/tty* (bug #870310).  * _emerge: Binpkg: Don't create empty stray binpkgs (bug #870283).  * bin: gpkg-sign: Check gpg configuration before using (bug #869470).  * portage: gpkg: Allow missing files (needed for when ebuilds touch   ${EROOT} in pkg_*) when creating binpkgs with quickpkg (bug #870229).  * portage: getbinpkg: Fix --getbinpkgonly command list with e.g. rsync (bug #866197).  * portage: checksum: Fix PORTAGE_CHECKSUM_FILTER. Regression from 3.0.31.  portage-3.0.36 (2022-09-09) --------------  Bug fixes: * The layout of gpkg (new binpkg format) packages has been fixed (bug #865905).  * Fix getbinpkg fetching (bug #864160).  portage-3.0.35 (2022-08-23) --------------  Features: * Portage can now set scheduling policies using the PORTAGE_SCHEDULING_POLICY   and PORTAGE_SCHEDULING_PRIORITY variables. See make.conf.example for details.    See also https://wiki.gentoo.org/wiki/Portage_niceness.  * The header of build.log now contains the package's slot (bug #864382).  Bug fixes: * xml: Fix XML node parsing (resulted in duplicate USE flag descriptions   in gentoolkit, bug 858791). This code is thought to have only one   consumer (gentoolkit, and only as of its most recent releases), so   impact is not severe.  * portage: dbapi: porttree: fix _set_porttrees() to operate correctly if passed   a generator. Fixes e.g. blank emerge --metadata caches in /var/cache/edb   which affected eix (bug #865635). Regression from 3.0.31.  * logging: don't clutter with a global logger and instead scope to   each module. Allows further logging refactoring in future.  * estrip: fix double slash for older EAPIs (bug #862600).  * estrip: avoid spurious NEEDED warning when no ELF files installed for   < EAPI 7 (bug #749624, bug #862606).  * estrip: apply scanelf optimisation for EAPI 7+ too (bug #749624, bug #862606).  * dispatch-conf: respect (E)ROOT  * install-qa-check.d: 60pkgconfig: drop noisy pkg-config mismatched Version   field check (bug 857654).  * install-qa-check.d: 60pkgconfig: fix --validate check by adding   ${ED}/usr/{lib*,share} to search path.  * install-qa-check.d: 60pkgconfig: only check defined variables for   ${EPREFIX} compliance (bug 860825).  * install-qa-check.d: 60pkgconfig: display the detected version from   the .pc file (improves the QA warning output), and hint to the user/developer   about the existence of QA_PKGCONFIG_VERSION to silence the warning.  * install-qa-check.d: 60pkgconfig: use eqatag for nicer output.  * install-qa-check.d: 60pkgconfig: use ver_test where possible in version   comparison checks to avoid warning if the Version field in the .pc file   is equivalent to the ebuild version.  * install-qa-check.d: 80libraries: include Darwin/Mach-O objects in checks.  * install-qa-check.d: 80multilib-strict: use file/find from Prefix instead   of absolute paths in /usr/bin.  * install-qa-checks.d: 90gcc-warnings: add arm64, aarch64 (used by Apple),   loongarch64, riscv64, s390x to list of 64-bit arches which affects the   severity of some warnings (like pointer truncation).  * install-qa-check.d: 90world-writable: include EPREFIX in paths.  * portage: output: update obsolete /etc/init.d/functions.sh path.  * bin: style tweaks to conform to Gentoo style (mostly variable bracing).  * doins: fix D check, add EPREFIX check  * misc-functions.sh: add Prefix fixups, like including EPREFIX in   INSTALL_MASK for /usr/share for noman, noinfo, nodoc.  * phase-function.sh: mark ED, EROOT read-only variables  * eapi.sh: cleanup obsolete references to unofficial 5-hdepend EAPI.  * isolated-functions.sh: sync __makeopts_jobs implementation with   multiprocessing.eclass.  * ebuild(1): improve descriptions of various phase functions.  * emerge(1): mention --with-bdeps=n behavior for both --usepkg (-k) and   --usepkgonly (-K) (bug #863422).  * ecompress: add option to lz4 in order to be able to compress multiple   files at once (bug #672916).  portage-3.0.34 (2022-07-20) --------------  Bug fixes: * checksum: fix trying to use discard on a frozenset().  * ebuild(5): mention doexe behavior is undefined if exeinto not yet called.  * ebuild(5): fix typos.  portage-3.0.33 (2022-07-18) --------------  Bug fixes: * env-update: Handle BROOT vs ROOT distinction for PATH (and other   variables like PREROOTPATH and ROOTPATH). The issue being that   only some variables are relevant for execution (and hence need   to be derived from BROOT), while others need to correspond to   EROOT for e.g. library paths. This should help with Clang   stage building.  * Build: Fix test suite file data processing (copying of .gnupg data   for the gpkg tests led to a failure in src_test in the portage ebuild).  * emerge: drop obsolete fixpackages warning (as a result of refactoring,   started to show on every emerge, but is harmless and left over   from many years ago). Bug #858407.  * quickpkg: Fix quoting/splitting of BINPKG_COMPRESS_FLAGS arguments. Bug #857933.  * estrip: fix double prefix (regression from "don't call estrip twice" fix   in 3.0.31). Bug #858818.  * ebuild(5): dolib, libopts: mention dolib, libopts being banned in EAPI 7.  * ebuild(5): dohtml: mention dohtml is banned in EAPI 7.  * ebuild(5): hasv: mention hasv is banned in EAPI 8.  * ebuild(5): dosym: mention dosym -r for EAPI 8.  * ebuild(5): einstall: mention einstall was banned in EAPI 6.  * ebuild(5): econf: add --docdir and --htmldir for EAPI 6,   add --with-sysroot for EAPI 7, add --datarootdir and --disable-static for EAPI   8.  * ebuild(5): econf: drop --disable-dependency-tracking from "example"   because it's confusing (implies it was always added, even before EAPI 4).  * ebuild(5): modernize examples slightly.  portage-3.0.32 (2022-07-11) --------------  Bug fixes: * Fix marking all news items as relevant. See bug #857669.  * Allow nested ebegin again while there's a lack of consensus on banning it.  * Fix use of deprecated (now removed) getchildren() call in XML parser,   which caused failures with gentoolkit. See bug #857537. (Note that this   was not originally in the release notes for 3.0.32, but the fix was in   3.0.32).  * Fix doc generation by removing reference to removed EAPIs. See bug #857486.  portage-3.0.31 (2022-07-10) --------------  Breaking changes: * repoman support dropped. Please migrate to pkgcheck. See bug 835013.  * Remove support for never-official EAPIs: "4-python", "5-progress".   Further cleanups as a result allowed removal of "USE alias" support too.  * Drop support for Python 3.6. It's been EOL upstream since 2021-12-23.   The minimum version of Python for Portage is now Python 3.7.  Features: * GLEP 78 "gpkg" binary package format support, including the ability to sign   binpkgs! See bug 500630, bug 659864, bug 672672, bug 773259, bug 820578.    This is still somewhat experimental!    To try it out:   - set BINPKG_FORMAT="gpkg" in make.conf;    - optionally, set FEATURES="binpkg-signing binpkg-request-signature", and so on.     See cnf/make.conf.example for the full details, options, and documentation.  * emerge: Add -X short option for --exclude.  * emerge: Support the "foot" terminal for title updates.  * Recognize LoongArch ABIs in multilib_category.  * depclean: Return failure via exit code if requested packages   aren't depcleaned. See bug 851750.  * estrip: Optimize calls (avoid duplicate call) by using previously   collected scanelf data. See bug 749624  * autoclean: Optimize unmerges by only enabling autoclean for global   updates and/or depcleans. This avoids needing to iterate over all   installed packages after each individual removal.  * vartree: Optimize by skipping `env-update` call (which is expensive, as   it ends up calling `ldconfig` to regenerate ld.so.cache) if no files   were installed (e.g. virtual/).  * vartree: Optimize by avoiding VDB lock contention (avoid taking   lock if no blockers).  * QA: warn if 'eend' is called without a corresponding 'ebegin',   and vice-versa: if 'ebegin' is called without a corresponding 'eend'.   See bug 835824 and bug 835823.  * QA: install-qa-check.d: Add 60pkgconfig check which:   - checks libdir in installed .pc files   - checks paths not respecting EPREFIX in .pc files   - runs pkg-config --validate on .pc files   - checks for mismatched version in .pc files vs ${PV}. Ebuilds can override     this using QA_PKGCONFIG_VERSION.  * QA: install-qa-check.d: Update 20runtime-directories to warn on /var/tmp   usage too.  * emerge: Deduplicate atoms in 'dropped' message for --keep-going.  * dispatch-conf: Warn about changing the 'use-rcs' setting. See bug 837533.  * Lots of general refactoring and code cleanups.  Bug fixes: * Disable SONAME dependencies by default again (i.e. set --ignore-soname-deps=y   to default on). See bug 687956 and bug 829623.    This was done because of problems caused with depcleans.  * git: Mark repository as safe for newer versions of git (>= git-2.35.2).   See bug 838223 and bug 838271.  * dosym: Fix EAPI check for '-r' (relative) flag. It would previously allow   using an EAPI 8 only feature.  * ebuild: Fix re-sourcing IDEPEND (EAPI 8+).  * estrip: Fix race when creating build-id debug symlinks. See bug 831927.  * MergeProcess: Fix bug causing unnecessary ld.so.cache regeneration even   when no libraries were installed. This used to work in the past, so is viewed   as a bug fix, rather than an optimization, although it's a bit of both.   See bug 836375.  * MiscFunctionsProcess: Avoid clobbering the main sandbox.log if a "die hook"   is invoked. This should prevent sandbox.log being blank in many cases.  * Drop /run warning as it ended up being too noisy and we've decided   to workaround/fix (depending on your perspective) the issues in packages   themselves, given only one package was actually at fault here: bug 832853.  * movefile: Merge symlinks atomically. This should reduce the risk of build   failures during parallel builds (multiple emerge jobs). See bug 836400.  * Improve error message when Bash version is too old for an ebuild   to be read.  * Minor improvements to 'die' output.  * Undo dep_zapdeps change in 3.0.29 as it introduced a regression w.r.t solving   blockers for gentoo-kernel. See bug 833014.  * QA: install-qa-check.d: update 95empty-dirs to mention Portage behavior   change for EAPI 8+.  * QA: install-qa-check.d: Fix usage of obsolete 'egrep' and 'fgrep' which   now emit warnings with an upcoming grep release (> 3.7).  * portageq: Ditto re egrep/fgrep.  * util: Fix Whirlpool implementation breaking (crashing/failing tests) with   OpenSSL 3. This wasn't noticed before as previously, OpenSSL exposed its   Whirlpool implementation by default, whereas it's now marked as legacy.   See bug 846389.  * socks5-server: Fix Python 3.10 DeprecationWarning. See bug 794115.  * portage.eapi: Include workaround for consumers with misconfigured   logger to avoid needing a newer gentoolkit. See bug 838406.  * CI: Run 'black' on remaining files missed in the previous conversion and fix   CI to catch regressions related to this.  * CI: Test with Python 3.11.  * CI: Drop references to unsupported Python 3.6.  * make.conf: document MAKEOPTS defaulting to the number of processors for   the number of jobs in make.conf(5).  * dispatch-conf: fix description of 'frozen-files' format in dispatch-conf.conf   man page. See bug 830618.  portage-3.0.30 -------------- * fix warning/crash on bad PROVIDES in package. See bug 828966. * avoid infinite loop in _optimized_copyfile. See bug 828844.  portage-3.0.29 -------------- * check for inconsistent/missing PROVIDES during package (and binpkg)   installation. See bug 811462. * avoid pulling in newer slots for upgrades in some cases. See bug 828136. * enable SONAME dependencies for binpkgs by default. See bug 687956. * add new options to allow avoiding building/using binpkgs for live ebuilds:   FEATURES="binpkg-live" and --usepkg-exclude-live. * add emphasis in output to user patches being applied.  portage-3.0.27 -------------- * improve blocker output to make it clear which blockers   are not satisfied. * use distinct colors for einfo/elog and ewarn/eqawarn.  portage-3.0.26 -------------- * fix broken FILESDIR copying logic.  portage-3.0.25 (yanked) ----------------------- * fix Python < 3.8 compatibility of FILESDIR copying code.  portage-3.0.24 -------------- * remove doebuild(dbkey=...) support that was deprecated since 2013. * pass metadata internally using key=value format. * include INHERIT key md5-cache to match pkgcore. * reformat Portage code using black. * fix Python 3.10 deprecation warnings. * replace compat_coroutine use with modern async.  portage-3.0.23 -------------- * enable autogroup scheduling with pid-sandbox if possible. This should   make the kernel respect niceness better. * add support conf-update.d hooks. * display all preserved libraries with --verbose. * restore QA warnings when EXPORT_FUNCTIONS is called before inherit. * catch more setuptools warnings via the respective QA check.  portage-3.0.22 -------------- * USE flags are now sorted with respect to numerical segments in emerge   output (e.g. python3_10 comes after python3_9). * setuptools version normalization warnings are now ignored. * FEATURES=installsources no longer copies irrelevant directory trees   with gcc-11. * sdist archives built using "build" now include setup.py.  portage-3.0.21 -------------- * EAPI 8 fixups.  portage-3.0.20 -------------- * Finalize EAPI 8.  portage-3.0.19 -------------- * Enable EAPI 8.  portage-3.0.18 -------------- * profile-repo-deps is supported in layout.conf profile-formats.  portage-3.0.16 -------------- * emirrordist supports the content-hash distfiles mirror layout.  portage-3.0.15 -------------- * FEATURES=binpkg-multi-instance is now enabled by default.  portage-3.0.13 -------------- * FETCHCOMMAND now supports a \${DIGESTS} placeholder which expands   to a space separated list of digests. Refer to the FETCHCOMMAND   documentation in the make.conf(5) man page.  portage-3.0.6 -------------- * emerge --search now detects regular expressions automatically. This   behavior is controlled by the --regex-search-auto option. * make.conf now treats variable names that begin with two underscores   as local variables which are not displayed by emerge --info --verbose. * egencache --update-pkg-desc now has a --verbose option which causes   it to emulate esync --verbose output. * env-update now generates a systemd user-session environment in a file   named /etc/environment.d/10-gentoo-env.conf. * binrepos.conf is a new configuration file that acts as a substitute   for the PORTAGE_BINHOST variable, and allows each repository to have   a separate FETCHCOMMAND which can be used to customize authentication.   This file is documented in the portage(5) man page.  portage-3.0.0 -------------- * Dropped support for Python 2.x.  portage-2.3.101 -------------- * The new PORTAGE_LOG_FILTER_FILE_CMD make.conf(5) variable specifies a   command that filters build log output to a log file. In order to   filter ANSI escape codes from build logs, ansifilter(1) is a   convenient setting for this variable.  portage-2.3.100 -------------- * New BINPKG_COMPRESS=zstd default (does not apply to installed systems   using the old bzip2 default).  portage-2.3.97 -------------- * Support for the PORTAGE_LOG_FILTER_FILE_CMD variable has been   temporarily removed due to bug 716636.  portage-2.3.90 -------------- * The new PORTAGE_LOG_FILTER_FILE_CMD make.conf(5) variable specifies a   command that filters build log output to a log file. In order to   filter ANSI escape codes from build logs, ansifilter(1) is a   convenient setting for this variable.  portage-2.3.80 -------------- * The emerge --quickpkg-direct option enables use of installed packages   directly as binary packages. It can be used to create minimal runtime   container images (which need not include a package manager), or to   enable a live image to act as a binary installer that uses packages   installed in the live image as a source of binary packages. This   option is especially useful in combination with --usepkgonly and   --ignore-soname-deps=n options, allowing implicit system dependencies   such as libc to be automatically accounted for.  portage-2.3.77 -------------- * The emerge --autounmask option is now disabled by default, except for   portions of behavior which are controlled by the --autounmask-use and   --autounmask-license options. For backward compatibility, previous   behavior of --autounmask=y and --autounmask=n is entirely preserved.   Users can get the old behavior simply by adding --autounmask to the   make.conf EMERGE_DEFAULT_OPTS variable.  portage-2.3.72 -------------- * The glsa-check program is now provided by portage, and it has been   removed from gentoolkit. See bug 463952.  portage-2.3.70 -------------- * The @live-rebuild package set now searches for PROPERTIES=live, see   bug 233589. The @deprecated-live-rebuild package set provides the   old behavior which was based on inherited eclasses.  portage-2.3.64 -------------- * New (council approved) default locations for the Gentoo repository,   distfiles, and binary packages (does not apply to installed systems   using the old defaults):   /usr/portage -> /var/db/repos/gentoo   /usr/portage/distfiles -> /var/cache/distfiles   /usr/portage/packages -> /var/cache/binpkgs  portage-2.3.53 -------------- * Renamed PORT_LOGDIR and PORT_LOGDIR_CLEAN variables to   PORTAGE_LOGDIR and PORTAGE_LOGDIR_CLEAN to match other existing   similar variables * Enable FEATURES={ipc,network,pid}-sandbox by default  portage-2.3.42 ---------------- * Sync with rsync quarantines data prior to verification, using the   rsync --link-dest option (can be disabled by setting   "sync-allow-hardlinks = no" in repos.conf). * Sync with git quarantines data prior to verification, see   https://wiki.gentoo.org/wiki/Portage_Security#git-mirror_repo. * Sync with shallow git pull is supported, by "setting sync-depth = 1"   in repos.conf.  portage-2.3.32 ---------------- * EAPI 7 support.  portage-2.3.29 ---------------- * Portage API consumers can use asyncio with portage's internal event   loop, see portage.util.futures.unix_events.DefaultEventLoopPolicy.  portage-2.3.25 ---------------- * Experimental support for EAPI 7_pre1.  portage-2.3.20 ---------------- * Support RESTRICT=network-sandbox in ebuilds.  portage-2.3.17 ---------------- * The doins ebuild helper has been rewritten in python for performance, and   it does in-kernel file copying on Linux.  portage-2.3.14 ---------------- * Repository metadata/layout.conf supports manifest-required-hashes   attribute (default value is SHA512).  portage-2.3.12 ---------------- * better_cache implemented to use less expensive os.listdir() instead of   os.stat() operations to scan for ebuilds. Avoids exhaustively scanning   overlays for all ebuilds which allows Portage to not slow down significantly   with lots of overlays enabled. (Daniel Robbins)  portage-2.3.7 ----------------- * eapply_user combines patch basenames from all matched directories into a   list, and applies them in POSIX sorted order. This allows patches in   more-specific directories to override patches of the same basename found   in less-specific directories. An empty patch (or /dev/null symlink) negates   a patch with the same basename found in a less-specific directory. * FEATURES=multilib-strict no longer recurses into subdirectories, in order   to avoid false-positives. The MULTILIB_STRICT_EXEMPT variable only served   to filter false-positives that were triggered by recursion, so it will no   longer be needed. * New emerge --autounmask-keep-keywords and --onlydeps-with-rdeps=<y|n>   options. * Set compression method for binpackages via BINPKG_COMPRESS variable * Support for environment variables for git cmd in repos.conf via sync-git-env   portage-2.3.5 ----------------- * Numerous patches updating checksums code and python module imports for them   including new checksum methods * New linux in kernel movefile support via a new "C" extension module   portage-2.3.3 ----------------- * Reverted commits:     - Bug 552814 Revert "GitSync.update: respect sync-depth                  (Shallow fetch is not a practical default at this time,                   given performance issues introduced by `git update-index`                   and `git prune` (see bug 599008).                  )   portage-2.3.1 ----------------- * Support News-Item-Format 2.0 * emerge: add --fuzzy-search and --search-similarity * Add emerge --autounmask-continue option  portage-2.3.0 ----------------- * Final release * Includes numerous bugfixes  portage-2.3.0_rc1 ----------------- * New split release for the repoman Q/A tool * Includes the stage2 rewite of the repoman code base   portage-2.2.26 -------------- * EAPI 6 stable portage release   portage-2.2.25 -------------- * EAPI 6 final fully implemented.   portage-2.2.22 ------------- * Stage 1 of the repoman re-write code merged in to master branch   This is the first release of the new code base.   portage-2.2.19 ------------- * The squashdelta sync module was removed for separate installation   and development work   portage-2.2.19 ------------- * websync module now fully renamed to webrsync * New squashdelta sync module for downloading full or updates for a squasfs tree   requires dev-util/squashmerge be installed * New binpkg-multi-instance feature allows for multiple variations     (USE settings) to be saved in the pkgdir and index.   portage-2.2.16 ------------- * New portage plug-in sync system.     Read the news anouncement for more details of the changes in config     settings and operation. * New native portage postsync.d capability * New native portage repo.postsync.d capability * New native indexed search capability for decent search speed * Tentative EAPI 6 patches for additional testing   portage-2.2.14 ------------- * Remaining bugs in build/install system should be fixed.   portge-2.2.14_rc1 ------------- * Many new build/installation system errors fixed.   portage-2.2.13 ------------- * New setup.py build system and distutils-r1 ebuild at EAPI 5 * PORTAGE_{BIN,PYM}_PATH variables. If you want to call internal portage tools,     you need to query PORTAGE_BIN_PATH and PORTAGE_PYM_PATH, use them     and re-export them. * New @changed-deps set to update packages which need dependecy change updates.   portage-2.2.12 ------------- * New emaint module "merges"  for finding and fixing failed merges   If a pkg fails to merge to the live filesystem correctly, that pkg may   not work correctly if at all.  This module scans the installed pkg database   for those failures and can re-emerge those packages.  portage-2.2.1 -------------  * Add cgroups, ipc-sandbox, and network-sandbox FEATURES.  portage-2.2 -------------  * Add extended set configuration via /etc/portage/sets.conf. See   /usr/share/portage/config/sets/portage.conf for examples.  portage-2.1.11.20 ------------- * Add support for EAPI 5. Refer to the PMS EAPI Cheat Sheet, portage's html   docs installed with USE=doc, or `man 5 ebuild` for more info about EAPI 5. * Add support for FEATURES=preserve-libs which preserves libraries when the   sonames change during upgrade or downgrade, and the @preserved-rebuild   package set which rebuilds consumers of preserved libraries. * Add link level dependency awareness to emerge --depclean and --prune actions   in order to protect against uninstallation of required libraries. Refer to   the --depclean-lib-check option in the emerge(1) man page.  portage-2.1.11 -------------  * Add support for experimental EAPI "4-slot-abi". Refer to the corresponding   html documentation that is installed with USE=doc, and also to the emerge(1)   man page for information about the related --ignore-built-slot-operator-deps and   --rebuild-if-new-slot options.  portage-2.1.10 -------------  * Improve handling of repositories/overlays for cases in which the same ebuild   is provided by multiple repositories but with different masking status, and   support for repository constraints on atoms (atom::repo) in configuration   files. * Add emerge --rebuild-if-* options that trigger rebuilds of reverse   dependencies when packages are rebuilt or updated. Related --rebuild-exclude   and --rebuild-ignore options can be used to avoid rebuilds for specific   packages. * Add emerge --reinstall-atoms, --useoldpkg-atoms, and --usepkg-exclude options   which can be used to alter selection rules for specific packages. * Add FEATURES=parallel-install and ebuild-locks, allowing for greater   parallelization when installing packages (by using finer-grained locks).  portage-2.1.9.27 -------------  * Add support for EAPI 4. Refer to the PMS EAPI Cheat Sheet, portage's html   docs installed with USE=doc, or `man 5 ebuild` for more info about EAPI 4.   Bug #273620 tracks EAPI 4 implementation in portage.  portage-2.1.9 -------------  * There is a new ipc (inter-process communication) USE flag which is enabled   by default. This allows portage to communicate with running ebuild processes,   for things like best_version, has_version, and die calls in nested processes.   This flag should remain enabled unless it is found to be incompatible with a   specific profile or environment. When enabled, it fixes bug #278895,   bug #315615, and makes subshell die support more robust (so that repoman's   ebuild.nesteddie check is irrelevant).  portage-2.1.8 ------------- * The top-level __init__.py for the portage python package has been split into   many smaller python modules, making the code easier to navigate and allowing   small parts of the portage api to be imported with less overhead.  portage-2.1.7.17 ------------- * Add support for EAPI 3. This adds support for installation prefix, including   new EPREFIX, ED, and EROOT variables which are used by econf and einstall   helpers. Also, EAPI 3 adds xz extension support to the unpack helper.  portage-2.1.7 -------------  * Add license visibility filtering (GLEP 23) * Add --accept-properties option for emerge which allows you to use   --accept-properties=-interactive in order to temporarily exclude   interactive updates. * Add support for Python 3.0. At least Python 2.6 is now required in order to   support the new syntax which is used by Python 3.0.  portage-2.1.6 -------------  * Add support for a new EAPI="2" value. For more information about new EAPI   features, refer to the "Ebuild" chapter of the html documentation that is   installed with portage. * Add PORTAGE_IONICE_COMMAND setting for make.conf which is called to adjust   IO priority on portage and it's subprocesses. * Add emerge --jobs and --load-average options which specify behavior   for building packages in parallel or for generating metadata in parallel   with emerge --regen. * Add emerge --keep-going option to continue as much as possible after   an error. When an error occurs, dependencies are recalculated for   remaining packages and any with unsatisfied dependencies are   automatically dropped. The --skipfirst option automatically drops   packages in the same way, and also drops any masked packages. * Add git and subversion support for repoman. * It is now possible to use `emerge <file>` to reinstall the package that   installed a particular file. Package contents entries are indexed to   improve performance. A command such as `emerge /lib/modules` can serve   as a decent substitute for module-rebuild. * Namespace sanitizing: move all portage related code into portage.* namespace,   rename portage_foo modules to portage.foo (but keep symlinks for compability) * Add support for news items (GLEP 42) * Add FEATURES=protect-owned which is identical to the collision-protect   feature except that files may be overwritten if they are not explicitly   listed in the contents of a currently installed package.  portage-2.1.5 -------------  * For extra careful dependency handling, emerge has a new --complete-graph   option that causes it to consider the deep dependencies of all packages from   the system and world sets. With this option enabled, emerge will bail out   if it determines that the given operation will break any dependencies of   the packages that have been added to the graph. Unlike the --deep option,   the --complete-graph option does not cause any more packages to be updated   than would have otherwise been updated with the option disabled. * Blockers are now resolved automatically in many more cases   than before.  When it's safe, blocked packages are uninstalled   automatically so that users are no longer inconvenienced with the   task. Automatically uninstalled packages are displayed in the merge   list, marked "uninstall" and highlighted in red. With the --tree   option enabled, it's possible to see which package(s) caused other   ones to be automatically uninstalled. * The dependency resolver now has a feedback mechanism that helps make atom   selections more consistent with previous selections that have been added to   the graph. This solves some common cases of bug #1343.  portage-2.1.4 -------------  * After the initial setup phase, the original ebuild and eclasses are no   longer needed because the same ebuild environment is reused for the   entire lifecycle of the package, including uninstallation. * The emerge --search action supports searching of both installed and binary packages   The --usepkg and --usepkgonly options control which repositories are searched.  portage-2.1.3 -------------  * Allow per-module setting of PORTAGE_ELOG_CLASSES * Add new elog module "echo" to simply display messages when emerge exits * Add ** as new token for package.keywords to bypass the keyword visibility layer * USE_EXPAND variables such as LINGUAS support a * wildcard that will enable   all of the corresponding flags that are listed in IUSE for a given package.   USE_EXPAND wildcards such as linguas_* are supported in USE and package.use. * The merge process preserves the modification timestamp of files that it   installs. The unmerge process will not uninstall files that are claimed by   another package in the same slot. * PDEPEND is now installed as soon as possible so that it behaves more like   RDEPEND.  This makes PDEPEND more useful for breaking the dependency cycles   that are sometimes triggered by RDEPEND and DEPEND. * Enable "echo" and "save_summary" elog modules by default * Fix -* handling in package.keywords to work as intended (reset the accepted   keywords list), also see RELEASE-NOTES. * Make elog functionality available to python code  portage-2.1.2 -------------  * Ebuilds support default USE flags via +flag in IUSE. * New-style virtuals are now usable for packages that depend on themselves for   bootstrap. * Profiles support multiple inheritance and package.use. * CONFIG_PROTECT and CONFIG_PROTECT_MASK both support files (not just   directories). * Collision protection handles symlinks properly. * Dependencies can be satisfied by installed packages that do not have matching   ebuilds in the portage tree or overlay. * Emerge automatically ignores blockers that are made irrelevant by an upgrade. * Emerge supports "reverse blocker detection" which means that the blockers of   installed packages will always be respected. * Emerge builds a complete dependency graph in order to ensure correct merge   order and detection of circular dependencies. * The world and system sets allow automatic update of all installed slots. * DEPEND atoms support SLOT dependencies of the form ${CATEGORY}/${PN}:${SLOT}. * Development: Extend PYTHONPATH support to allow overriding the hardcoded   /usr/lib/portage/pym for development/testing purposes * New "finalize" hook for elog modules enabling modules to perform actions on   shutdown (like dispatching collected messages). * New elog modules mail_summary and save_summary that act like the mail/save   modules except that they merge messages from multiple packages in a single   file/mail. * New QA loglevel and matching eqawarn function * `ebuild foo test` now always runs src_test if available * If DOC_SYMLINK_DIR is set portage installs symlinks to html documention there * FEATURES="test" automatically implies USE="test".  portage-2.1.1 -------------  * Profiles support use.force, package.use.force, and package.use.mask files.  portage-2.1 (ongoing via pre releases) ------------  * FEATURES="confcache" integration; global caching to speed up configure calls,   requires dev-util/confcache * elog framework and accompanying modules for logging ebuild warnings, errors   and general notices. Collects eerror/ewarn/elog/einfo messages. * New elog function (should replace einfo in many cases) * version syntax enhancements allowing multiple suffixes and a new 'cvs'   version prefix for denoting "live sources" ebuilds. * config files as directories enabling more flexible settings management. * Addition of an register_die_hook method that allows ebuild/eclasses to   register functions to be called for better debugging on errors. * Addition of pre and post user hookable functions for each ebuild phase, accessible   via portage bashrc.  Example would be pre_src_unpack . * cache refactoring- runtime improvement from 35% -> 65%. * Intelligently handle and display USE_EXPAND-based IUSE variables. * FEATURES="parallel-fetch".  Download in parallel to compilation. * Include a "changed or new" USE flag output when --verbose isn't specified. * Support for splitting out debug information into separate files in   /usr/lib{,32,64}. * exec subsystem refactoring (now with less bugs!) * Added sha256 and rmd160 hashes for digests/manifests * Make --emptytree only apply to ${ROOT} rather than always including /. * Allow packages to be upgraded that are only depended on via a   "|| ( =cat/pkg-1* =cat/pkg-2* )" construct. * Ebuild output is no longer cut off early when using PORTAGE_LOGDIR. * Distfiles indirection- $DISTFILES access goes through a tmp dir to fail   access to files not listed in SRC_URI. * Emerge now uses --resume to restart itself after portage upgrade. * Atomic file updates via the new atomic_ofstream class. * Global updates and fixpackages performance optimizations. * Tests show that file locking is now more reliable. * A bash call stack is printed when an ebuild dies in ebuild.sh. * New rsync option handling by using a generic PORTAGE_RSYNC_EXTRA_OPTS variable * Manifest2 support that will allow digest-* files to be eliminated from the tree.  ```   ``` |
| --- | --- |

### Questions or comments?

Please feel free to [contact us](https://www.gentoo.org/inside-gentoo/contact/).

**© 2001–2024 Gentoo Authors**

Gentoo is a trademark of the Gentoo Foundation, Inc. and of Förderverein Gentoo e.V.
The contents of this document, unless otherwise expressly stated, are licensed under the
[CC-BY-SA-4.0](https://creativecommons.org/licenses/by-sa/4.0/) license.
The [Gentoo Name and Logo Usage Guidelines](https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html) apply.



=== Content from bugs.gentoo.org_61a47dc8_20250124_151853.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 597800
emerge-webrsync: Downloads .gpgsig by default, but doesn't verify it.
Last modified: 2024-12-07 00:55:53 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=597800&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=597800&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 597800**](show_bug.cgi?id=597800)
- emerge-webrsync: Downloads .gpgsig by default, but doesn't verify it.

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
emerge-webrsync: Downloads .gpgsig by default, but doesn't verify it.

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Portage Development | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Portage Development "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Tools ([show other bugs](buglist.cgi?component=Tools&product=Portage%20Development&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | High critical | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Portage team | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | Fixed in portage-3.0.47 | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") | PullRequest | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [597918](show_bug.cgi?id=597918 "RESOLVED FIXED - sys-apps/portage: make emerge-webrsync use app-crypt/gkeys to automatically establish trust for gpg signature verification") [903973](show_bug.cgi?id=903973 "RESOLVED FIXED - [TRACKER] sys-apps/portage-3.0.47") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [CVE-2016-20021](show_bug.cgi?id=905356 "RESOLVED FIXED - <sys-apps/portage-3.0.47: emerge-webrsync does not verify PGP signatures") | |  | Show dependency [tree](showdependencytree.cgi?id=597800&hide_resolved=1) | |  | | Reported: | 2016-10-22 15:56 UTC by Walter | | --- | --- | | Modified: | 2024-12-07 00:55 UTC ([History](show_activity.cgi?id=597800)) | | CC List: | 10 users (show)  alarig flow jaak kfm luke maffblaster ryao sam security wizardedit | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") | * [689506](show_bug.cgi?id=689506 "RESOLVED FIXED - sys-apps/portage: repos.conf default sync-webrsync-verify-signature = true") * [661838](show_bug.cgi?id=661838 "RESOLVED FIXED - sys-apps/portage: sync-type webrsync could use repos.conf sync-openpgp-key-path and automatic key refresh") * [725398](show_bug.cgi?id=725398 "CONFIRMED - sys-apps/portage: remove deprecated FEATURES=webrsync-gpg") * <https://github.com/gentoo/portage/pull/1021> * <https://github.com/projg2/gemato/pull/30> * [905358](show_bug.cgi?id=905358 "RESOLVED FIXED - sync: Consolidate PGP verification paths") * [854990](show_bug.cgi?id=854990 "RESOLVED FIXED - \"Installing the base system/Configuring Portage\" is not aware of forbidden direct emerge-webrsync invocation") * [671816](show_bug.cgi?id=671816 "RESOLVED FIXED - emerge-webrsync does not work just after stage3 if webrsync-gpg feature is set in make.conf") * [660344](show_bug.cgi?id=660344 "RESOLVED FIXED - sys-apps/portage: migrate emerge*-webrsync to app-crypt/openpgp-keys-gentoo-release") * [945861](show_bug.cgi?id=945861 "RESOLVED FIXED - =sys-apps/portage-3.0.66.1-r1: `sync-webrsync-verify-signature: no` is not respected when using `sync-type: webrsync` to execute `emerge --sync`") | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=597800&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=597800&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Walter    2016-10-22 15:56:55 UTC  ``` This is dangerous as it is insecure default behavior. There may be an argument (poor) for keeping insecure default behavior. However, it is also doubly dangerous because it may imply to the user that the operation has been cryptographically verified when in fact it has not.  Reproducible: Always  Steps to Reproduce: 1. emerge-webrsync 2. "Fetching file portage-20161021.tar.xz.gpgsig ..." Actual Results:   User things "cool, it's verified"... but it's not verified, and no warning is shown to this effect.  Expected Results:   All downloads are cryptographically verified or, failing that, a big (preferably red, flashing) SCARY WARNING is shown.   Probably it should whinge immediately and require the addition of an --insecure command line flag. ```  [Comment 1](#c1)  Walter    2016-10-22 15:57:41 UTC  ``` Right now one must follow the obtuse, well-buried instructions @ [https://wiki.gentoo.org/wiki/Handbook:AMD64/Working/Features#Validated_Portage_tree_snapshots](https://wiki.gentoo.org/wiki/Handbook%3AAMD64/Working/Features#Validated_Portage_tree_snapshots) to get it to actually verify. ```  [Comment 2](#c2)  Walter    2016-10-22 15:58:50 UTC  ``` Further, I believe *emerge-webrsync* is the currently recommended sync method in the handbook, and no mention is made of configuring it for secure operation. ```  [Comment 3](#c3)  Walter    2016-10-22 16:09:46 UTC  ``` Further, I believe this may be a serious enough vulnerability to issue a security advisory over, since people with high-security requirement systems may not be aware that their syncs are not being validated.  As I see it, MITM on sync + subsequent MITM'd emerge means rooted box, since emerge relies on Manifests pulled in via sync, and in current default behavior, sync is not validated except for md5sum, which is also MITM'd at the same time as SYNC, and often pulled via HTTP (so not even HTTPS levels of assurance). ```  [Comment 4](#c4)  Zac Medico   gentoo-dev  2016-10-22 21:33:06 UTC  ``` (In reply to Walter from [comment #0](show_bug.cgi?id=597800#c0)) > This is dangerous as it is insecure default behavior. There may be an > argument (poor) for keeping insecure default behavior.  I think the existing support should be improved before we make it default, since the existing support requires manual verification of the key fingerprint that is posted here:  [https://wiki.gentoo.org/wiki/Project:RelEng#Keys](https://wiki.gentoo.org/wiki/Project%3ARelEng#Keys)  I think we need an automated way to establish the chain of trust (people can manually double-check the key fingerprints if they desire). In order to accomplish this, the bare minimum would be to automate fetch and verification of key fingerprints via https. Alternatively, we could have an installed bundle of fingerprints, or an installed bundle of trusted public keys in ASCII armor format.  > doubly dangerous because it may imply to the user that the operation has > been cryptographically verified when in fact it has not.  Yes, it's possible that some users could gain false confidence from this.  (In reply to Walter from [comment #3](show_bug.cgi?id=597800#c3)) > Further, I believe this may be a serious enough vulnerability to issue a > security advisory over, since people with high-security requirement systems > may not be aware that their syncs are not being validated.  Perhaps. Adding security to CC so that they can evaluate it. ```  [Comment 5](#c5)  Walter    2016-10-23 01:45:23 UTC  ``` Re: automated establishment of trust, see [https://bugs.gentoo.org/show_bug.cgi?id=453620](show_bug.cgi?id=453620 "RESOLVED FIXED - Release Engineering Key Distribution not Automation-Friendly") which I was also pushing for (3 years now).  The key issue there is that apparently the decision was made to use a python-based mechanism for key acquisition, and the normal 'establish base trust' situation is a fresh install from arbitrary (eg. non-gentoo, python-unavailable) media.  Therefore I motion that, in light of the severity of the current situation, placing current keys in the stage3 archives is strongly considered. (Possibly/probably along with that python-based tool.)  This has, at this point, simply been too severe a problem for far too long, and would solve the default insecure behavior for emerge-webrsync as well as for older/traditional rsync-based syncs. ```  [Comment 6](#c6)  Walter    2016-10-23 02:01:00 UTC  ``` Actually almost 4 years.  Thinking with regards to the danger of downloading a compromised stage3 image with compromised keys (as unfortunately it seems all mirrors right now are insecure http, rsync or ftp), the handbook should also be updated to include a recommendation to use an alternate device or internet connection to download the GPG signature of the installation media (or of the current keys file) from a fixed, gentoo-hosted HTTPS URL.  The use of an alternate device with its own certificate chain and potentially internet connection (eg. phone in mobile data mode) is far more secure than any same-system approach, and remains viable for most people most of the time. ```  [Comment 7](#c7)  Jason A. Donenfeld   gentoo-dev  2016-10-23 09:02:15 UTC  ``` Jeeze louise. This is a mess indeed. I'm traveling now but will look into fixing the default behavior when I'm home. At the very least, if the current keychain doesn't have the necessary keys for verification, a big ugly warning message should be posted, "WARNING WARNING: you've sync'd with webrsync-gpg, but your gpg has issues XYZ, so this was not verified.", with possibly a different exit status too. ```  [Comment 8](#c8)  Zac Medico   gentoo-dev  2016-10-23 20:38:44 UTC  ``` I've filed [bug 597918](show_bug.cgi?id=597918 "RESOLVED FIXED - sys-apps/portage: make emerge-webrsync use app-crypt/gkeys to automatically establish trust for gpg signature verification") for automated establishment of trust.  (In reply to Walter from [comment #6](show_bug.cgi?id=597800#c6)) > Thinking with regards to the danger of downloading a compromised stage3 > image with compromised keys (as unfortunately it seems all mirrors right now > are insecure http, rsync or ftp), the handbook should also be updated to > include a recommendation to use an alternate device or internet connection > to download the GPG signature of the installation media (or of the current > keys file) from a fixed, gentoo-hosted HTTPS URL.  The fingerprints provided via https are sufficient to establish trust, given that the corresponding keys can be used to verify *.DIGESTS.asc file that's distributed with the stage3, and the verified digests can be used to verify the stage3 itself. ```  [Comment 9](#c9)  Brian Dolbec (RETIRED)   gentoo-dev  2016-10-23 21:08:10 UTC  ``` And having install media and stage3's or stage4's with gentoo-keys and gkeys installed is also planned.  Along with the new meta-manifest system which also gpg signs all manifests and will be gpg verifed at every sync (normal rsync, not webrsync). ```  [Comment 10](#c10)  Kristian Fiskerstrand (RETIRED)   gentoo-dev  2016-10-29 18:25:38 UTC  ```  >  > (In reply to Walter from [comment #3](show_bug.cgi?id=597800#c3)) > > Further, I believe this may be a serious enough vulnerability to issue a > > security advisory over, since people with high-security requirement systems > > may not be aware that their syncs are not being validated. >  > Perhaps. Adding security to CC so that they can evaluate it.  This issue likely require a CVE as expectations are for the OpenPGP signature to be verified. This is used by a Gentoo developer as late as in [1]. That is is not by default signify a ... very interesting ... design  References: [1] <https://www.reddit.com/r/Gentoo/comments/59yvl9/where_is_the_gentoo_foundation_and_the_source/d9cpy3s/> ```  [Comment 11](#c11)  Walter    2016-10-29 23:05:55 UTC  ``` I have added a discussion item to the relevant Gentoo Handbook page requesting the addition of explicit directions to secure portage for new users. [https://wiki.gentoo.org/wiki/Handbook_Talk:AMD64/Installation/Stage#Portage_security_recommendation](https://wiki.gentoo.org/wiki/Handbook_Talk%3AAMD64/Installation/Stage#Portage_security_recommendation) ```  [Comment 12](#c12)  Walter    2016-12-28 02:34:15 UTC  ``` Nudge. Nobody has bothered to respond to or integrate the handbook suggestions. ```  [Comment 13](#c13)  Matthew Marchese   Gentoo Infrastructure gentoo-dev  2016-12-31 04:24:32 UTC  ``` I'm looking into the Handbook suggestions found here:  [https://wiki.gentoo.org/wiki/Handbook_Talk:AMD64/Installation/Stage#Portage_and_stage3_security_recommendations](https://wiki.gentoo.org/wiki/Handbook_Talk%3AAMD64/Installation/Stage#Portage_and_stage3_security_recommendations)  Closing some other discussions up (these things need testing, so it takes quite a bit of time), then I'll make my rounds to this discussion. ```  [Comment 14](#c14)  Walter    2017-05-30 07:17:51 UTC  ``` Nudge. ```  [Comment 15](#c15)  Sam James   archtester Gentoo Infrastructure gentoo-dev Security  2023-03-29 13:41:44 UTC  ``` I'll get this sorted now. ```  [Comment 16](#c16)  Larry the Git Cow   gentoo-dev  2023-04-09 06:52:06 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/proj/portage.git/commit/?id=28cd240fb23d880b8641a058831c6762db71c3e2>  commit 28cd240fb23d880b8641a058831c6762db71c3e2 Author:     Sam James <sam@gentoo.org> AuthorDate: 2023-03-29 22:34:37 +0000 Commit:     Sam James <sam@gentoo.org> CommitDate: 2023-04-09 06:51:35 +0000      emerge-webrsync: support PGP verification via gemato          Introduce PGP verification of the webrsync snapshot tarballs     using app-portage/gemato - which is already a dependency of Portage     for verifying normal rsync.          This is the same method Portage uses (see below).          Technical changes before we dive into the rationale:     - Use gemato for PGP verification just like Portage does for       sync-type=webrsync, sync-type=rsync (although that uses a metamanifest),       and sync-type=git (although that uses gemato for gpg-wrap, so works differently).          - Use gentoo-functions automagically if available for better output       functions.          - Be more verbose about verification and various other operations,       while also respecting --quiet if passed for misc. existing & new       messages.          - Make --verbose a no-op. There weren't enough output messages       to justify three states (--quiet, normal, --verbose).          - Bail out more aggressively in the event of errors or "warnings".          - Use modern terminology for repository, etc (avoid overloading the       "portage" term.)          - Allow disabling PGP verification with --no-pgp-verify.          Technically, the fix is very straightforward, but getting to     the fix was the slightly painful bit. What I've concluded     happened is:     - Portage starts getting reworked to gain proper sync module support;          - Someone gets the idea of implementing emerge-webrsync fully in Python       as a Portage sync module (which is a not-unreasonable idea);            [This ultimately hasn't gone anywhere, and in fact, while working on this       bug, I ended up finding a bunch of typos that meant you couldn't even test it.       But it's a stub anyway.]          - The idea of deprecating emerge-webrsync is floated around. The idea       being Portage should call it via its new sync module with sync-type=webrsync.            This is presumably with the ultimate goal of it transparently one day       using the aforementioned (yet-non-existent) Python implementation as its       backend, and not the shell script.            [To this day, Portage's webrsync implementation shells out to the emerge-webrsync       shell script, but it has the abstraction to switch that out, in theory.]          - At the time, PGP verification in general of the Gentoo       repository is an active topic, especially now we'd migrated to git which makes       it way easier, unlike CVS.          - A bug is filed for PGP verification in emerge-webrsync.            People decide it doesn't matter too much, because Portage is going to       Real Soon Now (TM) have its own backend (replacing the shell script) and/or       Portage's sync module support obsoletes emerge-webrsync entirely.            The idea here, I think, being that nobody should call emerge-webrsync and       everyone should just call emerge (or emaint) to sync as appropriate.            [This isn't a terrible idea in a sense, but it needs a better basis:       we should probably make emerge-webrsync a wrapper which creates a temporary       repo config to forcefully webrsync a repository if the user asks us to. This       is what people expect from emerge-webrsync with the default sync-type=rsync       in repos.conf for ::gentoo.            I actually started implementing this before I realised that emerge was       shelling out to emerge-webrsync, so have postponed it.]          - Then nothing happens with the "replacement" ideas and the good       ol' trusty emerge-webrsync ends up with the same problems sitting       there because nobody saw the point in working on it if it was to       be replaced soon. But that didn't happen.          The fix overall for this is pretty small, but the commit is larger     than I'd like because I had to rework a few things to sensibly allow     disabling PGP verification as well as follow the flow.          (I did start splitting up this commit but ultimately it needs -w     for best review even without the output tweaks in this commit and     deconstructing this for atomic commits would end up being more brittle     as I couldn't be as confident in the result.)          Bug: <https://bugs.gentoo.org/597800>     Signed-off-by: Sam James <sam@gentoo.org>   NEWS                |   5 +  bin/emerge-webrsync | 363 ++++++++++++++++++++++++++++++++++------------------  2 files changed, 240 insertions(+), 128 deletions(-) ```  [Comment 17](#c17)  Larry the Git Cow   gentoo-dev  2023-04-30 04:14:22 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=5b3c80502e96406b4b175e2ee79eb65f3f3cd9f6>  commit 5b3c80502e96406b4b175e2ee79eb65f3f3cd9f6 Author:     Sam James <sam@gentoo.org> AuthorDate: 2023-04-30 04:13:31 +0000 Commit:     Sam James <sam@gentoo.org> CommitDate: 2023-04-30 04:13:36 +0000      sys-apps/portage: add 3.0.47          Bug: <https://bugs.gentoo.org/597800>     Closes: <https://bugs.gentoo.org/903973>     Closes: <https://bugs.gentoo.org/875362>     Closes: <https://bugs.gentoo.org/904895>     Signed-off-by: Sam James <sam@gentoo.org>   sys-apps/portage/Manifest              |   1 +  sys-apps/portage/portage-3.0.47.ebuild | 285 +++++++++++++++++++++++++++++++++  2 files changed, 286 insertions(+) ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=597800)
* - [XML](show_bug.cgi?ctype=xml&id=597800)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=597800)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=597800&product=Portage%20Development)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=597800&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=597800&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


