=== Content from gitlab.com_9e1df85d_20250125_184537.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

Project 'gitlab-org/gitlab-ce' was moved to 'gitlab-org/gitlab-foss'. Please update any links and bookmarks that may still have the old path.

**Commit
29ceb98b**

authored
Nov 30, 2016
by
**![Douwe Maan's avatar](https://secure.gravatar.com/avatar/5053658479dd21e2f94dd420194c7fbe96497c71a79c0aeb4a1d5d965519af42?s=48&d=identicon "Douwe Maan")
Douwe Maan**
Committed by
[Robert Speicher](/rspeicher)
Dec 06, 2016

[Browse files](/gitlab-org/gitlab-foss/-/tree/29ceb98b5162677601702704e89d845580372078)

### Merge branch 'issue\_25064' into 'security'

```

Ensure state param has a valid value when filtering issuables.

Closes <https://gitlab.com/gitlab-org/gitlab-ce/issues/25064>

This fix makes sure we only call safe methods on issuable when filtering by state.

See merge request [!2038](/gitlab-org/gitlab-foss/-/merge_requests/2038 "Update init script only once")
```

parent
[f0f514ac](/gitlab-org/gitlab-foss/-/commit/f0f514ac25763a5e02aac7abb8a7528a0437577f)

Loading

Loading

Loading

Loading

* [Changes
  3](/gitlab-org/gitlab-foss/-/commit/29ceb98b5162677601702704e89d845580372078)
* [Pipelines
  1](/gitlab-org/gitlab-foss/-/commit/29ceb98b5162677601702704e89d845580372078/pipelines)

[Hide whitespace changes](/gitlab-org/gitlab-foss/-/commit/29ceb98b5162677601702704e89d845580372078?action=show&controller=projects%2Fcommit&id=29ceb98b5162677601702704e89d845580372078&namespace_id=gitlab-org&project_id=gitlab-foss&w=1)
[Inline](/gitlab-org/gitlab-foss/-/commit/29ceb98b5162677601702704e89d845580372078?view=inline)
[Side-by-side](/gitlab-org/gitlab-foss/-/commit/29ceb98b5162677601702704e89d845580372078?view=parallel)

Loading

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from gitlab.com_69cef420_20250125_184540.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

Project 'gitlab-org/gitlab-ce' was moved to 'gitlab-org/gitlab-foss'. Please update any links and bookmarks that may still have the old path.

**Commit
f325e4e7**

authored
Nov 30, 2016
by
**![Douwe Maan's avatar](https://secure.gravatar.com/avatar/5053658479dd21e2f94dd420194c7fbe96497c71a79c0aeb4a1d5d965519af42?s=48&d=identicon "Douwe Maan")
Douwe Maan**
Committed by
[Alejandro RodrÃ­guez](/alejandro)
Dec 02, 2016

[Browse files](/gitlab-org/gitlab-foss/-/tree/f325e4e734e5e486f3b02db176eb629124052b43)

### Merge branch 'issue\_25064' into 'security'

```

Ensure state param has a valid value when filtering issuables.

Closes <https://gitlab.com/gitlab-org/gitlab-ce/issues/25064>

This fix makes sure we only call safe methods on issuable when filtering by state.

See merge request [!2038](/gitlab-org/gitlab-foss/-/merge_requests/2038 "Update init script only once")
```

parent
[2faf3279](/gitlab-org/gitlab-foss/-/commit/2faf3279b4cf2e3a2bcd9697dae6ef272690c373)

Loading

Loading

Loading

* [Changes
  3](/gitlab-org/gitlab-foss/-/commit/f325e4e734e5e486f3b02db176eb629124052b43)

[Hide whitespace changes](/gitlab-org/gitlab-foss/-/commit/f325e4e734e5e486f3b02db176eb629124052b43?action=show&controller=projects%2Fcommit&id=f325e4e734e5e486f3b02db176eb629124052b43&namespace_id=gitlab-org&project_id=gitlab-foss&w=1)
[Inline](/gitlab-org/gitlab-foss/-/commit/f325e4e734e5e486f3b02db176eb629124052b43?view=inline)
[Side-by-side](/gitlab-org/gitlab-foss/-/commit/f325e4e734e5e486f3b02db176eb629124052b43?view=parallel)

Loading

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from gitlab.com_a7a3b6af_20250125_184542.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

Project 'gitlab-org/gitlab-ce' was moved to 'gitlab-org/gitlab-foss'. Please update any links and bookmarks that may still have the old path.

# Any user can delete all issues and merge requests

Jobert from HackerOne reported this issue:

---

# Vulnerability details

The state filter in the `IssuableFinder` class has the ability to filter issues and merge requests by state. This filter is implemented by calling `public_send` with unfiltered user input. This allows an attacker to call `delete_all` or `destroy_all`. Because the method is called **before** the project / group scope is applied, it deletes all issues and merge requests of the GitLab instance.

# Proof of concept

Create two users and a new project for each of them. It doesn't matter if they're private or not. Now create an issue (or merge request) for each project. Now browse to the Issues overview. When clicking All, you'll be redirected to hxxp://gitlab-instance/root/xxxx/issues?scope=all&state=all. Simply substitude `all` with `delete_all` in the URL and ALL issues will be deleted: hxxp://gitlab-instance/root/xxxx/issues?scope=all&state=delete\_all. To delete all merge requests, substitude `issues` with `merge_requests`. When requesting the `delete_all` URL, a 500 internal server error will be shown. This is caused by the `delete_all` method returning a boolean instead of an `ActiveRecord::Relation` class.

# Origin

The vulnerability comes from the fact that un-sanitized user input is passed into a `public_send` call that is being called on `model.all`. Here's the `execute` method of the `IssuableFinder`:

```
def execute
 items = init_collection
 items = by_scope(items)
 items = by_state(items)
 items = by_group(items)
 items = by_project(items)
 items = by_search(items)
 items = by_milestone(items)
 items = by_assignee(items)
 items = by_author(items)
 items = by_label(items)
 items = by_due_date(items)
 sort(items)
end
```

Now take a look at the `by_state` method:

```
def by_state(items)
 params[:state] ||= 'all'

 if items.respond_to?(params[:state])
   items.public_send(params[:state])
 else
   items
 end
end
```

The controllers are passing the `state` parameter without any form of sanitization or validation to the finder. Since you're passing around ActiveRecord relations, `delete_all` can be called early on in the relation chain. Since the scope hasn't been applied (the `by_project` is called later), this will affect all issues and merge requests.

# Remediation

Never pass un-sanitized or unvalidated user input to `public_send` or `send`.

---

I've verified this is exploitable.

Edited Nov 08, 2021 by [ðŸ¤– GitLab Bot ðŸ¤–](/gitlab-bot)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_d342de6b_20250125_184539.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

Project 'gitlab-org/gitlab-ce' was moved to 'gitlab-org/gitlab-foss'. Please update any links and bookmarks that may still have the old path.

**Commit
55196497**

authored
Nov 30, 2016
by
**![Douwe Maan's avatar](https://secure.gravatar.com/avatar/5053658479dd21e2f94dd420194c7fbe96497c71a79c0aeb4a1d5d965519af42?s=48&d=identicon "Douwe Maan")
Douwe Maan**
Committed by
[Alejandro RodrÃ­guez](/alejandro)
Dec 02, 2016

[Browse files](/gitlab-org/gitlab-foss/-/tree/55196497301eea429913f9c4b1b37c42c2e358ce)

### Merge branch 'issue\_25064' into 'security'

```

Ensure state param has a valid value when filtering issuables.

Closes <https://gitlab.com/gitlab-org/gitlab-ce/issues/25064>

This fix makes sure we only call safe methods on issuable when filtering by state.

See merge request [!2038](/gitlab-org/gitlab-foss/-/merge_requests/2038 "Update init script only once")
```

parent
[b9442a5e](/gitlab-org/gitlab-foss/-/commit/b9442a5eb08d79f33b7ac4d47576f2893ed2a91f)

Loading

Loading

Loading

* [Changes
  3](/gitlab-org/gitlab-foss/-/commit/55196497301eea429913f9c4b1b37c42c2e358ce)

[Hide whitespace changes](/gitlab-org/gitlab-foss/-/commit/55196497301eea429913f9c4b1b37c42c2e358ce?action=show&controller=projects%2Fcommit&id=55196497301eea429913f9c4b1b37c42c2e358ce&namespace_id=gitlab-org&project_id=gitlab-foss&w=1)
[Inline](/gitlab-org/gitlab-foss/-/commit/55196497301eea429913f9c4b1b37c42c2e358ce?view=inline)
[Side-by-side](/gitlab-org/gitlab-foss/-/commit/55196497301eea429913f9c4b1b37c42c2e358ce?view=parallel)

Loading

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment


