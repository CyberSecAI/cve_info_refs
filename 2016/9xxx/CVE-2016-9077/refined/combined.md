=== Content from www.mozilla.org_ce132be8_20250125_001512.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2016-89

## Security vulnerabilities fixed in Firefox 50

Announced
November 15, 2016
Impact
critical
Products
Firefox
Fixed in

* Firefox 50

#### [#CVE-2016-5296: Heap-buffer-overflow WRITE in rasterize\_edges\_1](#CVE-2016-5296)

Reporter
Abhishek Arya
Impact
critical
##### Description

A heap-buffer-overflow in Cairo when processing SVG content caused by compiler optimization, resulting in a potentially exploitable crash.

##### References

* [Bug 1292443](https://bugzilla.mozilla.org/show_bug.cgi?id=1292443)

#### [#CVE-2016-5292: URL parsing causes crash](#CVE-2016-5292)

Reporter
Daniel Browning
Impact
high
##### Description

During URL parsing, a maliciously crafted URL can cause a potentially exploitable crash.

##### References

* [Bug 1288482](https://bugzilla.mozilla.org/show_bug.cgi?id=1288482)

#### [#CVE-2016-5293: Write to arbitrary file with Mozilla Updater and Maintenance Service using updater.log hardlink](#CVE-2016-5293)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

When the Mozilla Updater is run, if the Updater's log file in the working directory points to a hardlink, data can be appended to an arbitrary local file. This vulnerability requires local system access.
*Note: this issue only affects Windows operating systems.*

##### References

* [Bug 1246945](https://bugzilla.mozilla.org/show_bug.cgi?id=1246945)

#### [#CVE-2016-5294: Arbitrary target directory for result files of update process](#CVE-2016-5294)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

The Mozilla Updater can be made to choose an arbitrary target working directory for output files resulting from the update process. This vulnerability requires local system access.
*Note: this issue only affects Windows operating systems.*

##### References

* [Bug 1246972](https://bugzilla.mozilla.org/show_bug.cgi?id=1246972)

#### [#CVE-2016-5297: Incorrect argument length checking in JavaScript](#CVE-2016-5297)

Reporter
André Bargull
Impact
high
##### Description

An error in argument length checking in JavaScript, leading to potential integer overflows or other bounds checking issues.

##### References

* [Bug 1303678](https://bugzilla.mozilla.org/show_bug.cgi?id=1303678)

#### [#CVE-2016-9064: Add-ons update must verify IDs match between current and new versions](#CVE-2016-9064)

Reporter
Multiple people
Impact
high
##### Description

Add-on updates failed to verify that the add-on ID inside the signed package matched the ID of the add-on being updated. An attacker who could perform a man-in-the-middle attack on the user's connection to the update server and defeat the certificate pinning protection could provide a malicious signed add-on instead of a valid update.

##### References

* [Bug 1303418](https://bugzilla.mozilla.org/show_bug.cgi?id=1303418)

#### [#CVE-2016-9065: Firefox for Android location bar spoofing using fullscreen](#CVE-2016-9065)

Reporter
Raphael
Impact
high
##### Description

The location bar in Firefox for Android can be spoofed by forcing a user into fullscreen mode, blocking its exiting, and creating of a fake location bar without any user notification.
*Note: This issue only affects Firefox for Android. Other versions and operating systems are unaffected.*

##### References

* [Bug 1306696](https://bugzilla.mozilla.org/show_bug.cgi?id=1306696)

#### [#CVE-2016-9066: Integer overflow leading to a buffer overflow in nsScriptLoadHandler](#CVE-2016-9066)

Reporter
Samuel Groß
Impact
high
##### Description

A buffer overflow resulting in a potentially exploitable crash due to memory allocation issues when handling large amounts of incoming data.

##### References

* [Bug 1299686](https://bugzilla.mozilla.org/show_bug.cgi?id=1299686)

#### [#CVE-2016-9067: heap-use-after-free in nsINode::ReplaceOrInsertBefore](#CVE-2016-9067)

Reporter
Nils
Impact
high
##### Description

Two use-after-free errors during DOM operations resulting in potentially exploitable crashes.

##### References

* [Bug 1301777 (CVE-2016-9067)](https://bugzilla.mozilla.org/show_bug.cgi?id=1301777)
* [Bug 1308922 (CVE-2016-9069)](https://bugzilla.mozilla.org/show_bug.cgi?id=1308922)

#### [#CVE-2016-9068: heap-use-after-free in nsRefreshDriver](#CVE-2016-9068)

Reporter
Nils
Impact
high
##### Description

A use-after-free during web animations when working with timelines resulting in a potentially exploitable crash.

##### References

* [Bug 1302973](https://bugzilla.mozilla.org/show_bug.cgi?id=1302973)

#### [#CVE-2016-9072: 64-bit NPAPI sandbox isn't enabled on fresh profile](#CVE-2016-9072)

Reporter
Bob Owen
Impact
high
##### Description

When a new Firefox profile is created on 64-bit Windows installations, the sandbox for 64-bit NPAPI plugins is not enabled by default.
*Note: This issue only affects 64-bit Windows. 32-bit Windows and other operating systems are unaffected.*

##### References

* [Bug 1300083](https://bugzilla.mozilla.org/show_bug.cgi?id=1300083)

#### [#CVE-2016-9075: WebExtensions can access the mozAddonManager API and use it to gain elevated privileges](#CVE-2016-9075)

Reporter
Kris Maglione
Impact
high
##### Description

An issue where WebExtensions can use the mozAddonManager API to elevate privilege due to privileged pages being allowed in the permissions list. This allows a malicious extension to then install additional extensions without explicit user permission.

##### References

* [Bug 1295324](https://bugzilla.mozilla.org/show_bug.cgi?id=1295324)

#### [#CVE-2016-9077: Canvas filters allow feDisplacementMaps to be applied to cross-origin images, allowing timing attacks on them](#CVE-2016-9077)

Reporter
Markus Stange
Impact
high
##### Description

Canvas allows the use of the `feDisplacementMap` filter on images loaded cross-origin. The rendering by the filter is variable depending on the input pixel, allowing for timing attacks when the images are loaded from third party locations.

##### References

* [Bug 1298552](https://bugzilla.mozilla.org/show_bug.cgi?id=1298552)

#### [#CVE-2016-5291: Same-origin policy violation using local HTML file and saved shortcut file](#CVE-2016-5291)

Reporter
Yuyang Zhou
Impact
moderate
##### Description

A same-origin policy bypass with local shortcut files to load arbitrary local content from disk.

##### References

* [Bug 1292159](https://bugzilla.mozilla.org/show_bug.cgi?id=1292159)

#### [#CVE-2016-5295: Mozilla Maintenance Service: Ability to read arbitrary files as SYSTEM](#CVE-2016-5295)

Reporter
Holger Fuhrmannek
Impact
moderate
##### Description

This vulnerability allows an attacker to use the Mozilla Maintenance Service to escalate privilege by having the Maintenance Service invoke the Mozilla Updater to run malicious local files. This vulnerability requires local system access and is a variant of MFSA2013-44.
*Note: this issue only affects Windows operating systems.*

##### References

* [Bug 1247239](https://bugzilla.mozilla.org/show_bug.cgi?id=1247239)
* [MFSA2013-44 - Local privilege escalation through Mozilla Maintenance Service](https://www.mozilla.org/en-US/security/advisories/mfsa2013-44/)

#### [#CVE-2016-5298: SSL indicator can mislead the user about the real URL visited](#CVE-2016-5298)

Reporter
Jordi Chancel
Impact
moderate
##### Description

A mechanism where disruption of the loading of a new web page can cause the previous page's favicon and SSL indicator to not be reset when the new page is loaded.
*Note: this issue only affects Firefox for Android. Desktop Firefox is unaffected.*

##### References

* [Bug 1227538](https://bugzilla.mozilla.org/show_bug.cgi?id=1227538)

#### [#CVE-2016-5299: Firefox AuthToken in broadcast protected with signature-level permission can be accessed by an application installed beforehand that defines the same permissions](#CVE-2016-5299)

Reporter
Ken Okuyama
Impact
moderate
##### Description

A previously installed malicious Android application with same signature-level permissions as Firefox can intercept AuthTokens meant for Firefox only.
*Note: This issue only affects Firefox for Android. Other versions and operating systems are unaffected.*

##### References

* [Bug 1245791](https://bugzilla.mozilla.org/show_bug.cgi?id=1245791)

#### [#CVE-2016-9061: API key (glocation) in broadcast protected with signature-level permission can be accessed by an application installed beforehand that defines the same permissions](#CVE-2016-9061)

Reporter
Ken Okuyama
Impact
moderate
##### Description

A previously installed malicious Android application which defines a specific signature-level permissions used by Firefox can access API keys meant for Firefox only.
*Note: This issue only affects Firefox for Android. Other versions and operating systems are unaffected.*

##### References

* [Bug 1245795](https://bugzilla.mozilla.org/show_bug.cgi?id=1245795)

#### [#CVE-2016-9062: Private browsing browser traces (Android) in browser.db and wal file](#CVE-2016-9062)

Reporter
Daniel D.
Impact
moderate
##### Description

Private browsing mode leaves metadata information, such as URLs, for sites visited in `browser.db` and `browser.db-wal` files within the Firefox profile after the mode is exited.
*Note: This issue only affects Firefox for Android. Other versions and operating systems are unaffected.*

##### References

* [Bug 1294438](https://bugzilla.mozilla.org/show_bug.cgi?id=1294438)

#### [#CVE-2016-9070: Sidebar bookmark can have reference to chrome window](#CVE-2016-9070)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

A maliciously crafted page loaded to the sidebar through a bookmark can reference a privileged chrome window and engage in limited JavaScript operations violating cross-origin protections.

##### References

* [Bug 1281071](https://bugzilla.mozilla.org/show_bug.cgi?id=1281071)

#### [#CVE-2016-9073: windows.create schema doesn't specify "format": "relativeUrl"](#CVE-2016-9073)

Reporter
Will Bamberg
Impact
moderate
##### Description

WebExtensions can bypass security checks to load privileged URLs and potentially escape the WebExtension sandbox.

##### References

* [Bug 1289273](https://bugzilla.mozilla.org/show_bug.cgi?id=1289273)

#### [#CVE-2016-9074: Insufficient timing side-channel resistance in divSpoiler](#CVE-2016-9074)

Reporter
Franziskus Kiefer
Impact
moderate
##### Description

An existing mitigation of timing side-channel attacks is insufficient in some circumstances. This issue is addressed in Network Security Services (NSS) 3.26.1.

##### References

* [Bug 1293334](https://bugzilla.mozilla.org/show_bug.cgi?id=1293334)

#### [#CVE-2016-9076: select dropdown menu can be used for URL bar spoofing on e10s](#CVE-2016-9076)

Reporter
Mats Palmgren
Impact
moderate
##### Description

An issue where a `<select>` dropdown menu can be used to cover location bar content, resulting in potential spoofing attacks. This attack requires e10s to be enabled in order to function.

##### References

* [Bug 1276976](https://bugzilla.mozilla.org/show_bug.cgi?id=1276976)

#### [#CVE-2016-9063: Possible integer overflow to fix inside XML\_Parse in Expat](#CVE-2016-9063)

Reporter
Gustavo Grieco
Impact
low
##### Description

An integer overflow during the parsing of XML using the Expat library.

##### References

* [Bug 1274777](https://bugzilla.mozilla.org/show_bug.cgi?id=1274777)

#### [#CVE-2016-9071: Probe browser history via HSTS/301 redirect + CSP](#CVE-2016-9071)

Reporter
Xiaoyin Liu
Impact
low
##### Description

Content Security Policy combined with HTTP to HTTPS redirection can be used by malicious server to verify whether a known site is within a user's browser history.

##### References

* [Bug 1285003](https://bugzilla.mozilla.org/show_bug.cgi?id=1285003)

#### [#CVE-2016-5289: Memory safety bugs fixed in Firefox 50](#CVE-2016-5289)

Reporter
Mozilla developers
Impact
critical
##### Description

Mozilla developers and community members Christian Holler, Andrew McCreight, Dan Minor, Tyson Smith, Jon Coppeard, Jan-Ivar Bruaroey, Jesse Ruderman, and Markus Stange reported memory safety bugs present in Firefox 49. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 50](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1296649%2C1298107%2C1300129%2C1305876%2C1314667%2C1301252%2C1277866%2C1307254%2C1252511%2C1264053)

#### [#CVE-2016-5290: Memory safety bugs fixed in Firefox 50 and Firefox ESR 45.5](#CVE-2016-5290)

Reporter
Mozilla developers
Impact
critical
##### Description

Mozilla developers and community members Olli Pettay, Christian Holler, Ehsan Akhgari, Jon Coppeard, Gary Kwong, Tooru Fujisawa, Philipp, and Randell Jesup reported memory safety bugs present in Firefox 49 and Firefox ESR 45.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 50 and Firefox ESR 45.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1309720%2C1297062%2C1303710%2C1018486%2C1292590%2C1301343%2C1301496%2C1308048%2C1308346%2C1299519%2C1286911%2C1298169)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from wiki.mozilla.org_73f8d6fa_20250126_044429.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from bugzilla.mozilla.org_3e495cd2_20250125_001510.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1298552)
* [XML](/show_bug.cgi?ctype=xml&id=1298552)

Closed
[Bug 1298552](/show_bug.cgi?id=1298552)
(CVE-2016-9077)

Opened 8 years ago
Closed 8 years ago

# Canvas filters allow feDisplacementMaps to be applied to cross-origin images, allowing timing attacks on them

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Canvas filters allow feDisplacementMaps to be applied to cross-origin images, allowing timing attacks on them

## Categories

### (Core :: Graphics: Canvas2D, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20Canvas2D#Graphics%3A%20Canvas2D)

Graphics: Canvas2D
▾

Core :: Graphics: Canvas2D
Bugs with the HTML5 [<canvas>](http://whatwg.org/specs/web-apps/current-work/#dynamic) element, its XUL sibling, and related rendering contexts.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Canvas2D&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Canvas2D&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20Canvas2D)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

49 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla52

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox48 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=unaffected) |
| firefox49 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix) |
| firefox-esr45 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=unaffected) |
| firefox50 | [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed) |
| firefox51 | [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed) |
| firefox52 | [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox48 |  | unaffected |
| firefox49 |  | wontfix |
| firefox-esr45 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox50 | + | fixed |
| firefox51 | + | fixed |
| firefox52 | + | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mstange, Assigned: mstange)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/711e7c6f7c2c62a7bc2eb760585c3daa?d=mm&size=40)  [mstange](/user_profile?user_id=293943)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/711e7c6f7c2c62a7bc2eb760585c3daa?d=mm&size=40)  [mstange](/user_profile?user_id=293943)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/029a38b9773f1943419c24b7c3d93761?d=mm&size=40)  [lsalzman](/user_profile?user_id=536714)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1308859](/show_bug.cgi?id=1308859 "RESOLVED FIXED - Crash in mozilla::dom::CanvasRenderingContext2D::NeedToApplyFilter"), [1318283](/show_bug.cgi?id=1318283 "RESOLVED FIXED - Crash in mozilla::dom::CanvasRenderingContext2D::Fill")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1173545](/show_bug.cgi?id=1173545 "RESOLVED FIXED - Enable canvas CSS/SVG filters by default")

Dependency [tree](/showdependencytree.cgi?id=1298552&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1298552)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-disclosure, regression, sec-high, Whiteboard: [post-critsmash-triage][adv-main50+][pixel-stealing])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2016-9077

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main50+][pixel-stealing]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c15 "8 years ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | [qe-verify](#a6027351_452604 "8 years ago") | - |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |

## Crash Data

Signature:

[[@ mozilla::dom::AdjustedTargetForFilter::~AdjustedTargetForFilter ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Adom%3A%3AAdjustedTargetForFilter%3A%3A~AdjustedTargetForFilter)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [testcase](/attachment.cgi?id=8785481)  [8 years ago](#c0)  [Markus Stange [:mstange]](/user_profile?user_id=293943)   656 bytes, text/html |  | [Details](/attachment.cgi?id=8785481&action=edit) |
| --- | --- | --- |
| [patch](/attachment.cgi?id=8785487)  [8 years ago](#c1)  [Markus Stange [:mstange]](/user_profile?user_id=293943)   6.73 KB, patch | mstange : [review+](#c2 "8 years ago") | [Details](/attachment.cgi?id=8785487&action=edit) | [Diff](/attachment.cgi?id=8785487&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785487) |
| [patch](/attachment.cgi?id=8785496)  [8 years ago](#c4)  [Markus Stange [:mstange]](/user_profile?user_id=293943)   6.73 KB, patch | mstange : [review+](#c4 "8 years ago")  ritu : [approval-mozilla-aurora+](#c14 "8 years ago")  ritu : [approval-mozilla-beta+](#c14 "8 years ago")  abillings : [sec-approval+](#a515548_280903 "8 years ago") | [Details](/attachment.cgi?id=8785496&action=edit) | [Diff](/attachment.cgi?id=8785496&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785496) |
| [testcase for that other crash bug](/attachment.cgi?id=8822771)  [8 years ago](#c25)  [Markus Stange [:mstange]](/user_profile?user_id=293943)   1.32 KB, text/html |  | [Details](/attachment.cgi?id=8822771&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1298552#c0)• 8 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=8785481)
— [Details](attachment.cgi?id=8785481&action=edit)

See the last paragraph of [bug 1287316 comment 29](/show_bug.cgi?id=1287316#c29 "RESOLVED FIXED - global-buffer-overflow in mozilla::gfx::FilterSupport::ComputeSourceNeededRegions") - updateFilterOnWriteOnly is only checked on the first draw after the filter was set. If the canvas's IsWriteOnly state changes after that first draw, we don't update the filter, and happily apply feDisplacementMap filters.
This is bad because feDisplacementMap filter rendering can take different amounts of time depending on the input pixel, and the input pixel can be a cross-origin image drawn through drawImage.
In the testcase, the stuff in the top left corner should be a black square, not a black funny looking blob.
Chrome also has this bug.

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1298552#c1)• 8 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=8785487&action=diff) (obsolete)
— [Details](attachment.cgi?id=8785487&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785487)

Assignee: nobody → mstangeStatus: NEW → ASSIGNED

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1298552#c2)• 8 years ago |
|  | |

Comment on [attachment 8785487](/attachment.cgi?id=8785487 "patch") [[details]](/attachment.cgi?id=8785487&action=edit "patch") [[diff]](/attachment.cgi?id=8785487&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785487)
patch
r=jrmuizel
Jeff reviewed this in person but had to leave before he could set the r+ state.
[Attachment #8785487](/attachment.cgi?id=8785487&action=edit "patch") -
Flags: review+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a781_280903)• 8 years ago |

Group: core-security

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1298552#c3)• 8 years ago |
|  | |

Comment on [attachment 8785487](/attachment.cgi?id=8785487 "patch") [[details]](/attachment.cgi?id=8785487&action=edit "patch") [[diff]](/attachment.cgi?id=8785487&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785487)
patch
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
With medium difficulty
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
Not really
Which older supported branches are affected by this flaw?
Beta 49, Aurora 50
If not all supported branches, which bug introduced the flaw?
Enabling canvas filters by default, [bug 1173545](/show_bug.cgi?id=1173545 "RESOLVED FIXED - Enable canvas CSS/SVG filters by default")
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
The code hasn't changed since 49, so trivial.
How likely is this patch to cause regressions; how much testing does it need?
Not likely - canvas filters are a new feature that will be released with 49.
[Attachment #8785487](/attachment.cgi?id=8785487&action=edit "patch") -
Flags: sec-approval?

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1298552#c4)• 8 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=8785496&action=diff)
— [Details](attachment.cgi?id=8785496&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785496)

[Attachment #8785487](/attachment.cgi?id=8785487&action=edit "patch") -
Attachment is obsolete: true
[Attachment #8785487](/attachment.cgi?id=8785487&action=edit "patch") -
Flags: sec-approval?
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: sec-approval?
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: review+

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1298552#c5)• 8 years ago |
|  | |

Comment on [attachment 8785496](/attachment.cgi?id=8785496 "patch") [[details]](/attachment.cgi?id=8785496&action=edit "patch") [[diff]](/attachment.cgi?id=8785496&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785496)
patch
Approval Request Comment
[Feature/regressing bug #]: enabling canvas filters by default, [bug 1173545](/show_bug.cgi?id=1173545 "RESOLVED FIXED - Enable canvas CSS/SVG filters by default")
[User impact if declined]: cross-origin images can be read through timing attacks with a lot of work (Chrome has the same bug)
[Describe test coverage new/current, TreeHerder]: canvas filters have reasonable test coverage but there is no test for this particular bug, and this bug doesn't add one
[Risks and why]: low, the patch is straightforward
[String/UUID change made/needed]: none
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: approval-mozilla-aurora?

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a3281_293943)• 8 years ago |

[status-firefox48](/buglist.cgi?f1=cf_status_firefox48&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=unaffected)
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=affected)
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1298552#c6)• 8 years ago |
|  | |

This seems like a sec-moderate bug. We need to figure out a rating before it can get sec-approval.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1298552#c7)• 8 years ago |
|  | |

Seems like it should be sec-high like [bug 711043](/show_bug.cgi?id=711043 "RESOLVED FIXED - SVG Filter Timing Attack")Keywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a435585_293943)• 8 years ago |

[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: sec-approval?

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a435599_293943)• 8 years ago |

[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1298552#c8)• 8 years ago |
|  | |

This isn't going to go into 49. It has been too late for a week or two really. I'm giving sec-approval+ for check on September 20, two weeks into the next cycle.
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix)Whiteboard: [checkin on 9/20]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a515548_280903)• 8 years ago |

[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: sec-approval? → sec-approval+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1298552#c9)• 8 years ago |
|  | |

Comment on [attachment 8785496](/attachment.cgi?id=8785496 "patch") [[details]](/attachment.cgi?id=8785496&action=edit "patch") [[diff]](/attachment.cgi?id=8785496&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785496)
patch
Agreed, this can wait till 50.
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a607735_1689)• 8 years ago |

Blocks: [1173545](/show_bug.cgi?id=1173545 "RESOLVED FIXED - Enable canvas CSS/SVG filters by default")Group: core-security → gfx-core-security
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1298552#c10)• 8 years ago |
|  | |

The wallpaper fix in [bug 1297316](/show_bug.cgi?id=1297316 "RESOLVED FIXED - New Relic Unable to ping pontoon.mozilla.org, snippets.mozilla.com-python, oneanddone.mozilla.org") moved the crash to a MOZ\_RELEASE\_ASSERT() added in
[@ mozilla::dom::AdjustedTargetForFilter::~AdjustedTargetForFilter ]. According to Markus this patch will fix that, but we should test once this is landed.Crash Signature: [@ mozilla::dom::AdjustedTargetForFilter::~AdjustedTargetForFilter ]

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a1020219_456486)• 8 years ago |

Version: Trunk → 49 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1298552#c11)• 8 years ago |
|  | |

Comment on [attachment 8785496](/attachment.cgi?id=8785496 "patch") [[details]](/attachment.cgi?id=8785496&action=edit "patch") [[diff]](/attachment.cgi?id=8785496&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785496)
patch
50 moved to Beta today. I can't reset the nomination on this, but it'll need to be :)Flags: needinfo?(lhenry)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a2040684_451704)• 8 years ago |

Flags: needinfo?(lhenry)
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: approval-mozilla-beta- → approval-mozilla-beta?

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1298552#c12)• 8 years ago |
|  | |

Hi Al, Dan, given that Fx49 release slipped by a week, do we need to move the checkin by 9/20 to 9/27 on this one?Flags: needinfo?(dveditz)Flags: needinfo?(abillings)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1298552#c13)• 8 years ago |
|  | |

This can be checked in at any time nowFlags: needinfo?(dveditz)Flags: needinfo?(abillings)Whiteboard: [checkin on 9/20]

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1298552#c14)• 8 years ago |
|  | |

Comment on [attachment 8785496](/attachment.cgi?id=8785496 "patch") [[details]](/attachment.cgi?id=8785496&action=edit "patch") [[diff]](/attachment.cgi?id=8785496&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1298552&attachment=8785496)
patch
Sec-high, approved for uplift to Aurora51, Beta50.
Hi Markus, should we uplift to esr45 as well?Flags: needinfo?(mstange)
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: approval-mozilla-beta+
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #8785496](/attachment.cgi?id=8785496&action=edit "patch") -
Flags: approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1298552#c15)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/4e451d0e6324>
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected)
[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%3F)
[tracking-firefox51](/buglist.cgi?f1=cf_tracking_firefox51&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%3F)
[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%3F)
[tracking-firefox-esr45](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=%3F)Flags: in-testsuite?

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1298552#c16)• 8 years ago |
|  | |

es45 is unaffected. This is a regression from [bug 1174278](/show_bug.cgi?id=1174278 "RESOLVED FIXED - Make filter tainting and canvas tainting interact properly") which only landed on 49, and the code is only used when canvas filters are enabled, which also only happened in 49 ([bug 1173545](/show_bug.cgi?id=1173545 "RESOLVED FIXED - Enable canvas CSS/SVG filters by default")).
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=unaffected)
[tracking-firefox-esr45](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=%3F) → ---Flags: needinfo?(mstange)

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1298552#c17)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/4e451d0e6324>
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed)Target Milestone: --- → mozilla52

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1298552#c18)• 8 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/d531a9166e20>
<https://hg.mozilla.org/releases/mozilla-beta/rev/37a9c564fc95>Status: ASSIGNED → RESOLVEDClosed: 8 years ago
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Gerry Chang [:gchang]](/user_profile?user_id=506302) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1298552#c19)• 8 years ago |
|  | |

Track for 51+ as sec-high regression.
[tracking-firefox51](/buglist.cgi?f1=cf_tracking_firefox51&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a2752410_1689)• 8 years ago |

Group: gfx-core-security → core-security-release

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a2756367_538805)• 8 years ago |

[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B)

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1298552#c20)• 8 years ago |
|  | |

Tracking 52+ for this sec-high issue.
[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a4126439_1689)• 8 years ago |

Depends on: [1308859](/show_bug.cgi?id=1308859 "RESOLVED FIXED - Crash in mozilla::dom::CanvasRenderingContext2D::NeedToApplyFilter")

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a6027351_452604)• 8 years ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a6469484_280903)• 8 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main50+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a6551856_280903)• 8 years ago |

Alias: CVE-2016-9077

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1298552#c21)• 8 years ago |
|  | |

As of the patch on this bug, CanvasRenderContext2D::NeedToCalculateBounds, called before most of the canvas operations (Fill\*, Stroke\*, DrawImage, etc.), can end up calling UpdateFilter, which can invalidate the draw target. ::DrawImage on its own is enough to make it a top crasher on beta.
NeedToCalculateBounds checks NeedToDrawShadow (no side effects) and NeedToApplyFilter (side effects as of this bug.)
NeedToApplyFilter is called in a few other places, and it appears that in at least some of them, the draw target disappearing would be an unexpected (and bad) thing.
So, the question is - is the right solution to not have NeedToApplyFilter call UpdateFilter, or is the right thing to call EnsureTarget after/as a part of NeedToApplyFilter? Or something completely different?
Markus, thoughts? We really shouldn't ship this in 51, if we can at all help it.Flags: needinfo?(mstange)

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1298552#c22)• 8 years ago |
|  | |

It'd be useful if I attached a [bug 1318283](/show_bug.cgi?id=1318283 "RESOLVED FIXED - Crash in mozilla::dom::CanvasRenderingContext2D::Fill") that is tracking these crashes.

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1298552#c23)• 8 years ago |
|  | |

Another potential issue; NeedToCalculateBounds() only calls NeedToApplyFilter() (with its side effects of updating filters) if NeedToDrawShadow() returns false. Does that mean that we still have the original bug when there is a shadow involved?
(Randomly and unreproducibly, I had this crash when I was testing with a slight modification of the above testcase - <https://crash-stats.mozilla.com/report/index/1fafea4d-132e-4d36-bf1e-945052161230>, though I can't quite recall what the modification was :)

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1298552#c24)• 8 years ago |
|  | |

AdjustedTargetForFilter calls MaxSourceNeededBoundsForFilter which calls NeedToApplyFilter, even when NeedToCalculateBounds doesn't.

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1298552#c25)• 8 years ago |
|  | |

Attached file
[testcase for that other crash bug](attachment.cgi?id=8822771)
— [Details](attachment.cgi?id=8822771&action=edit)

Flags: needinfo?(mstange)

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1298552#c26)• 8 years ago |
|  | |

(In reply to Milan Sreckovic [:milan] from [comment #21](/show_bug.cgi?id=1298552#c21 "RESOLVED FIXED - Canvas filters allow feDisplacementMaps to be applied to cross-origin images, allowing timing attacks on them"))
> So, the question is - is the right solution to not have NeedToApplyFilter
> call UpdateFilter
I don't think so. If we know that the cached filter is out of date, we need to update it at some point before drawing. We could conceivably do that in each drawing function before we call EnsureTarget, but NeedToApplyFilter feels like a better location to trigger the update.
> or is the right thing to call EnsureTarget after/as a
> part of NeedToApplyFilter?
I think that's a fine solution.
> Or something completely different?
Maybe UpdateFilter should not have the presshell flush in the general case. The flush is needed so that url(#filter) references to SVG filters work, but I think this flush only has to be done when the filter is changed through JS setting the ctx.filter property. If the filter is invalidated by something else, we might not need the flush. So we could potentially move the flush to SetFilter. I don't know if that would help, I'd need to look at it more closely.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a11144920_75935)• 8 years ago |

Depends on: [1318283](/show_bug.cgi?id=1318283 "RESOLVED FIXED - Crash in mozilla::dom::CanvasRenderingContext2D::Fill")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a14401808_1689)• 8 years ago |

Group: core-security-release

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1298552#a51211095_578488)• 7 years ago |

Whiteboard: [post-critsmash-triage][adv-main50+] → [post-critsmash-triage][adv-main50+][pixel-stealing]
You need to [log in](/show_bug.cgi?id=1298552&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Markus Stange [:mstange]](/user_profile?user_id=293943)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_8f6bef3c_20250126_044428.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1295324)
* [XML](/show_bug.cgi?ctype=xml&id=1295324)

Closed
[Bug 1295324](/show_bug.cgi?id=1295324)
(CVE-2016-9075)

Opened 8 years ago
Closed 8 years ago

# WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges.

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges.

## Categories

### (WebExtensions :: Untriaged, defect, P1)

[Product:](/describecomponents.cgi?product=WebExtensions)

WebExtensions
▾

WebExtensions
File feature requests and bugs related to the WebExtension add-on API.
[See Open Bugs in This Product](/buglist.cgi?product=WebExtensions&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=WebExtensions)
Watch This Product

[Component:](/describecomponents.cgi?product=WebExtensions&component=Untriaged#Untriaged)

Untriaged
▾

WebExtensions :: Untriaged
File feature requests and bugs related to the WebExtension add-on API.
[See Open Bugs in This Component](/buglist.cgi?product=WebExtensions&component=Untriaged&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=WebExtensions&component=Untriaged&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=WebExtensions&component=Untriaged)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

51 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### (firefox49 wontfix, firefox-esr45 unaffected, firefox50+ verified, firefox51+ verified, firefox52+ verified)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla52

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox49 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix) |
| firefox-esr45 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=unaffected) |
| firefox50 | [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=verified) |
| firefox51 | [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified) |
| firefox52 | [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox49 |  | wontfix |
| firefox-esr45 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox50 | + | verified |
| firefox51 | + | verified |
| firefox52 | + | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

[Blocking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Blocking_Flags)

| webextensions | --- |
| --- | --- |

## People

### (Reporter: kmag, Assigned: aswan)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=40)  [aswan](/user_profile?user_id=561655)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=40)  [kmag](/user_profile?user_id=106098)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e2fa737f7938f690847d2f5eeea87025?d=mm&size=40)  [willdurand](/user_profile?user_id=603050)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

19 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1313996](/show_bug.cgi?id=1313996 "RESOLVED DUPLICATE - Awesome Screenshot Plus doesn’t work for addons.mozilla.org pages")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1309033](/show_bug.cgi?id=1309033 "NEW - Show message in Browser Console when WebExtensions scripts are blocked"), [CVE-2017-5389](/show_bug.cgi?id=1308688 "RESOLVED FIXED - Prevent WebExtensions from modifying requests to hosts with mozAddonManager permissions")

Dependency [tree](/showdependencytree.cgi?id=1295324&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1295324)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-high, Whiteboard: [adv-main50+] triaged)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2016-9075

[Keywords:](/describekeywords.cgi)

[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main50+] triaged

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [kmag](/user_profile?user_id=106098) | [in-testsuite](#a9140522_106098 "8 years ago") | ? |
| --- | --- | --- |
| [kmag](/user_profile?user_id=106098) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 4 obsolete files)

| [test-aom.xpi](/attachment.cgi?id=8781277)  [8 years ago](#c1)  [Kris Maglione [:kmag]](/user_profile?user_id=106098)   1.15 KB, application/zip |  | [Details](/attachment.cgi?id=8781277&action=edit) |
| --- | --- | --- |
| [Expose mozAddonManager allowed hosts to chrome](/attachment.cgi?id=8793500)  [8 years ago](#c5)  [Andrew Swan [:aswan]](/user_profile?user_id=561655)   4.80 KB, patch |  | [Details](/attachment.cgi?id=8793500&action=edit) | [Diff](/attachment.cgi?id=8793500&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793500) |
| [Expose mozAddonManager allowed hosts to chrome](/attachment.cgi?id=8793567)  [8 years ago](#c6)  [Andrew Swan [:aswan]](/user_profile?user_id=561655)   4.78 KB, patch | bkelly : [review+](#c8 "8 years ago") | [Details](/attachment.cgi?id=8793567&action=edit) | [Diff](/attachment.cgi?id=8793567&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793567) |
| [Don't allow content scripts on pages with mozAddonManager](/attachment.cgi?id=8793568)  [8 years ago](#c7)  [Andrew Swan [:aswan]](/user_profile?user_id=561655)   4.71 KB, patch |  | [Details](/attachment.cgi?id=8793568&action=edit) | [Diff](/attachment.cgi?id=8793568&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793568) |
| [Don't load content scripts on pages with mozAddonManager](/attachment.cgi?id=8799010)  [8 years ago](#c16)  [Andrew Swan [:aswan]](/user_profile?user_id=561655)   1.09 KB, patch | kmag : [review+](#c18 "8 years ago") | [Details](/attachment.cgi?id=8799010&action=edit) | [Diff](/attachment.cgi?id=8799010&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799010) |
| [Test for content scripts with mozAddonManager](/attachment.cgi?id=8799011)  [8 years ago](#c17)  [Andrew Swan [:aswan]](/user_profile?user_id=561655)   3.47 KB, patch | kmag : [review+](#a4572114_106098 "8 years ago") | [Details](/attachment.cgi?id=8799011&action=edit) | [Diff](/attachment.cgi?id=8799011&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799011) |
| [360403](/attachment.cgi?id=8799046)  [8 years ago](#c20)  [Andrew Swan [:aswan]](/user_profile?user_id=561655)   1.03 KB, patch | aswan : [review+](#c21 "8 years ago")  ritu : [approval-mozilla-aurora+](#c28 "8 years ago")  ritu : [approval-mozilla-beta+](#c28 "8 years ago")  abillings : [sec-approval+](#a4586578_280903 "8 years ago") | [Details](/attachment.cgi?id=8799046&action=edit) | [Diff](/attachment.cgi?id=8799046&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799046) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1295324#c0)• 8 years ago |
|  | |

See attached testcase. Simply install it (in Firefox 49 or later), and it immediately installs AdBlock Plus.
Given AMO's CSP, we could probably prevent this by a) preventing the object from being accessed via wrappers, and b) preventing extensions from meddling with CSP headers.
But the only real solution I see is to prevent WebExtensions from executing scripts on any site with these kinds of elevated privileges.

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1295324#c1)• 8 years ago |
|  | |

Attached file
[test-aom.xpi](attachment.cgi?id=8781277)
— [Details](attachment.cgi?id=8781277&action=edit)

|  | [Andy McKay](/user_profile?user_id=397635) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a1203233_397635)• 8 years ago |

Assignee: nobody → aswanPriority: -- → P1Whiteboard: triaged

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1295324#c2)• 8 years ago |
|  | |

(In reply to Kris Maglione [:kmag] from [comment #0](/show_bug.cgi?id=1295324#c0 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> Given AMO's CSP, we could probably prevent this by a) preventing the object
> from being accessed via wrappers, and b) preventing extensions from meddling
> with CSP headers.
I think we briefly discussed this on IRC a while back but for posterity here, can you elaborate on this? Why isn't a by itself sufficient?

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1295324#c3)• 8 years ago |
|  | |

It's just way too fragile. Even if we're fairly sure we can prevent the extension from executing scripts in the page context, we can't really prevent it from manipulating the page content or other JS objects so that the existing page scripts call it for us.

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1295324#c4)• 8 years ago |
|  | |

Got it. Assuming we should go with the "prevent WebExtensions from executing scripts on any site with these kinds of elevated privileges" technique, I'd like to get on the same page about implementation before starting.
It looks like the simplest solution would be filter out privileged pages when creating the host permissions list (whiteListedHosts). My initial reaction is that that seems roundabout, but the alternative would be a much bigger change. Or am I overlooking something?
Also the list of hosts to which mozAddonManager is exposed is currently buried in c++ code, I'll have to get that list up to js, ugh.

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1295324#c5)• 8 years ago |
|  | |

Attached patch

[Expose mozAddonManager allowed hosts to chrome](attachment.cgi?id=8793500&action=diff) (obsolete)
— [Details](attachment.cgi?id=8793500&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793500)

MozReview-Commit-ID: Hp82unF8h4v

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1295324#c6)• 8 years ago |
|  | |

Attached patch

[Expose mozAddonManager allowed hosts to chrome](attachment.cgi?id=8793567&action=diff) (obsolete)
— [Details](attachment.cgi?id=8793567&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793567)

[Attachment #8793567](/attachment.cgi?id=8793567&action=edit "Expose mozAddonManager allowed hosts to chrome") -
Flags: review?(bkelly)

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a3203322_561655)• 8 years ago |

[Attachment #8793500](/attachment.cgi?id=8793500&action=edit "Expose mozAddonManager allowed hosts to chrome") -
Attachment is obsolete: true

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1295324#c7)• 8 years ago |
|  | |

Attached patch

[Don't allow content scripts on pages with mozAddonManager](attachment.cgi?id=8793568&action=diff) (obsolete)
— [Details](attachment.cgi?id=8793568&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793568)

[Attachment #8793568](/attachment.cgi?id=8793568&action=edit "Don't allow content scripts on pages with mozAddonManager") -
Flags: review?(kmaglione+bmo)

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1295324#c8)• 8 years ago |
|  | |

Comment on [attachment 8793567](/attachment.cgi?id=8793567 "Expose mozAddonManager allowed hosts to chrome") [[details]](/attachment.cgi?id=8793567&action=edit "Expose mozAddonManager allowed hosts to chrome") [[diff]](/attachment.cgi?id=8793567&action=diff "Expose mozAddonManager allowed hosts to chrome") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793567)
Expose mozAddonManager allowed hosts to chrome
Review of [attachment 8793567](/attachment.cgi?id=8793567 "Expose mozAddonManager allowed hosts to chrome") [[details]](/attachment.cgi?id=8793567&action=edit "Expose mozAddonManager allowed hosts to chrome") [[diff]](/attachment.cgi?id=8793567&action=diff "Expose mozAddonManager allowed hosts to chrome") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793567):
-----------------------------------------------------------------
A few nits, but overall looks reasonable.
::: dom/webidl/AddonManager.webidl
@@ +81,5 @@
> };
> +
> +[ChromeOnly,Exposed=System,HeaderFile="mozilla/AddonManagerWebAPI.h"]
> +interface AddonManagerPermissions {
> + static boolean isHostPermitted(DOMString host);
Is there any reason not to put this static on AddonManager directly? Do you need it to be available when IsAPIEnabled() is false or something?
::: toolkit/mozapps/extensions/AddonManagerWebAPI.cpp
@@ +18,5 @@
> namespace mozilla {
> using namespace mozilla::dom;
>
> +static bool
> +IsValidHost(const nsACString& host) {
Unless you are exposing this method to other code modules I think its slightly preferred to put it in the anonymous namespace:
namespace {
bool
IsValidHost(const nsACString& aHost) {
// ...
}
} // anonymous namespace
@@ +62,5 @@
> if (NS\_FAILED(rv)) {
> return false;
> }
>
> + if (IsValidHost(host)) {
I think this can just be `return IsValidHost(host);`
@@ +67,3 @@
> return true;
> }
> +
nit: trailing white space
[Attachment #8793567](/attachment.cgi?id=8793567&action=edit "Expose mozAddonManager allowed hosts to chrome") -
Flags: review?(bkelly) → review+

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1295324#c9)• 8 years ago |
|  | |

Comment on [attachment 8793568](/attachment.cgi?id=8793568 "Don't allow content scripts on pages with mozAddonManager") [[details]](/attachment.cgi?id=8793568&action=edit "Don't allow content scripts on pages with mozAddonManager") [[diff]](/attachment.cgi?id=8793568&action=diff "Don't allow content scripts on pages with mozAddonManager") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793568)
Don't allow content scripts on pages with mozAddonManager
Review of [attachment 8793568](/attachment.cgi?id=8793568 "Don't allow content scripts on pages with mozAddonManager") [[details]](/attachment.cgi?id=8793568&action=edit "Don't allow content scripts on pages with mozAddonManager") [[diff]](/attachment.cgi?id=8793568&action=diff "Don't allow content scripts on pages with mozAddonManager") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793568):
-----------------------------------------------------------------
::: toolkit/components/extensions/ExtensionContent.jsm
@@ +129,5 @@
> let uri = window.document.documentURIObject;
> +
> + // If mozAddonManager is present on this page, don't allow
> + // content scripts.
> + if (AddonManagerPermissions.isHostPermitted(uri.host)) {
As an alternative to this, can you not check for the existence of the AddonManager directly? Something like:
if (window.navigator.mozAddonManager instanceof AddonManager)

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1295324#c10)• 8 years ago |
|  | |

(In reply to Ben Kelly [:bkelly] from [comment #9](/show_bug.cgi?id=1295324#c9 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> ::: toolkit/components/extensions/ExtensionContent.jsm
> @@ +129,5 @@
> > let uri = window.document.documentURIObject;
> > +
> > + // If mozAddonManager is present on this page, don't allow
> > + // content scripts.
> > + if (AddonManagerPermissions.isHostPermitted(uri.host)) {
>
> As an alternative to this, can you not check for the existence of the
> AddonManager directly? Something like:
>
> if (window.navigator.mozAddonManager instanceof AddonManager)
Hey, that does sound much better. To make this work though, I need to expose the AddonManager bindings into chrome code in the content process (I'll also rename the interface to AddonManagerWebAPI or something to avoid colliding with AddonManager from AddonManager.jsm). I'm a novice with webidl, adding "Exposed=System" or "Exposed=(System,Window") caused this build error:
WebIDL.WebIDLError: error: Interface member has larger exposure set than the interface itself
Can you help me find the right magic for the bit before the AddonManager interface in AddonManager.webidl?Flags: needinfo?(bkelly)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1295324#c11)• 8 years ago |
|  | |

(In reply to Ben Kelly [:bkelly] from [comment #8](/show_bug.cgi?id=1295324#c8 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> ::: dom/webidl/AddonManager.webidl
> @@ +81,5 @@
> > };
> > +
> > +[ChromeOnly,Exposed=System,HeaderFile="mozilla/AddonManagerWebAPI.h"]
> > +interface AddonManagerPermissions {
> > + static boolean isHostPermitted(DOMString host);
>
> Is there any reason not to put this static on AddonManager directly? Do you
> need it to be available when IsAPIEnabled() is false or something?
The AddonManager module is only exposed via `navigator`, which doesn't exist in the JSM scopes we need to access this from.

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1295324#c12)• 8 years ago |
|  | |

Comment on [attachment 8793568](/attachment.cgi?id=8793568 "Don't allow content scripts on pages with mozAddonManager") [[details]](/attachment.cgi?id=8793568&action=edit "Don't allow content scripts on pages with mozAddonManager") [[diff]](/attachment.cgi?id=8793568&action=diff "Don't allow content scripts on pages with mozAddonManager") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793568)
Don't allow content scripts on pages with mozAddonManager
Review of [attachment 8793568](/attachment.cgi?id=8793568 "Don't allow content scripts on pages with mozAddonManager") [[details]](/attachment.cgi?id=8793568&action=edit "Don't allow content scripts on pages with mozAddonManager") [[diff]](/attachment.cgi?id=8793568&action=diff "Don't allow content scripts on pages with mozAddonManager") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8793568):
-----------------------------------------------------------------
::: toolkit/components/extensions/ExtensionContent.jsm
@@ +5,5 @@
> "use strict";
>
> this.EXPORTED\_SYMBOLS = ["ExtensionContent"];
>
> +/\* globals ExtensionContent, AddonManagerPermissions \*/
This should be added to .eslintrc instead, since it's not specific to this file. Also, please keep globals lists sorted when possible.
@@ +129,5 @@
> let uri = window.document.documentURIObject;
> +
> + // If mozAddonManager is present on this page, don't allow
> + // content scripts.
> + if (AddonManagerPermissions.isHostPermitted(uri.host)) {
That would work here, but I was expecting this check to happen in MatchPattern.jsm, instead...
If we do go this route, though, I'd rather just check that it's defined, rather than using an `instanceof` check.
::: toolkit/components/extensions/test/mochitest/mochitest.ini
@@ +51,5 @@
> [test\_ext\_contentscript\_create\_iframe.html]
> [test\_ext\_contentscript\_devtools\_metadata.html]
> [test\_ext\_contentscript\_exporthelpers.html]
> [test\_ext\_contentscript\_css.html]
> +[test\_ext\_contentscript\_permission.html]
Please move this test to a separate patch so it can be landed after the fixes make it to release.
::: toolkit/components/extensions/test/mochitest/test\_ext\_contentscript\_permission.html
@@ +16,5 @@
> +add\_task(function\* test\_contentscript() {
> + function background() {
> + browser.test.onMessage.addListener(msg => {
> + browser.tabs.executeScript({
> + code: "true;",
We should probably use a more distinct sentinel here.
@@ +32,5 @@
> + },
> + background,
> + };
> +
> + let win = window.open("<http://example.com/>");
We should also check with explicit permissions for the site, and with active activeTab permissions, just to be safe.
@@ +45,5 @@
> + yield SpecialPowers.pushPrefEnv({
> + set: [["extensions.webapi.testing", true]],
> + });
> +
> + extension.sendMessage("run");
Should probably reload the page between checks, just to be safe.
[Attachment #8793568](/attachment.cgi?id=8793568&action=edit "Don't allow content scripts on pages with mozAddonManager") -
Flags: review?(kmaglione+bmo)

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1295324#c13)• 8 years ago |
|  | |

(In reply to Andrew Swan [:aswan] from [comment #10](/show_bug.cgi?id=1295324#c10 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> Hey, that does sound much better. To make this work though, I need to
> expose the AddonManager bindings into chrome code in the content process
> (I'll also rename the interface to AddonManagerWebAPI or something to avoid
> colliding with AddonManager from AddonManager.jsm). I'm a novice with
> webidl, adding "Exposed=System" or "Exposed=(System,Window") caused this
> build error:
> WebIDL.WebIDLError: error: Interface member has larger exposure set than the
> interface itself
> Can you help me find the right magic for the bit before the AddonManager
> interface in AddonManager.webidl?
To be honest I'm not sure how [Exposed] plays with jsm's and whatnot. You could either stick with your original plan or :bz could probably answer this. Unfortunately I'm short on time to investigate myself at the moment.Flags: needinfo?(bkelly)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1295324#c14)• 8 years ago |
|  | |

(In reply to Ben Kelly [Mostly PTO, back Oct 10][:bkelly] from [comment #13](/show_bug.cgi?id=1295324#c13 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> (In reply to Andrew Swan [:aswan] from [comment #10](/show_bug.cgi?id=1295324#c10 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> > Hey, that does sound much better. To make this work though, I need to
> > expose the AddonManager bindings into chrome code in the content process
> > (I'll also rename the interface to AddonManagerWebAPI or something to avoid
> > colliding with AddonManager from AddonManager.jsm). I'm a novice with
> > webidl, adding "Exposed=System" or "Exposed=(System,Window") caused this
> > build error:
> > WebIDL.WebIDLError: error: Interface member has larger exposure set than the
> > interface itself
> > Can you help me find the right magic for the bit before the AddonManager
> > interface in AddonManager.webidl?
>
> To be honest I'm not sure how [Exposed] plays with jsm's and whatnot. You
> could either stick with your original plan or :bz could probably answer
> this. Unfortunately I'm short on time to investigate myself at the moment.
[Esposed=System] makes things accessible to JSMs. We'd need [Exposed=(System,Window)] on the interface itself for [Exposed=System] to work on the static method. But given the nature of this API, I think we'd be better off not trying to expose the AddonManager interface in JSMs.

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1295324#c15)• 8 years ago |
|  | |

(In reply to Kris Maglione [:kmag] from [comment #14](/show_bug.cgi?id=1295324#c14 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> [Esposed=System] makes things accessible to JSMs. We'd need
> [Exposed=(System,Window)] on the interface itself for [Exposed=System] to
> work on the static method. But given the nature of this API, I think we'd be
> better off not trying to expose the AddonManager interface in JSMs.
The point was just to expose it to do the instanceof check. The alternative would be just to check for a mozAddonManager property that != undefined, but then if a page happened to create a property on navigator with that name, that would suppress content scripts. Maybe we can just live with that?Flags: needinfo?(kmaglione+bmo)

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a4571198_561655)• 8 years ago |

[Attachment #8793567](/attachment.cgi?id=8793567&action=edit "Expose mozAddonManager allowed hosts to chrome") -
Attachment is obsolete: true

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a4571210_561655)• 8 years ago |

[Attachment #8793568](/attachment.cgi?id=8793568&action=edit "Don't allow content scripts on pages with mozAddonManager") -
Attachment is obsolete: true

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1295324#c16)• 8 years ago |
|  | |

Attached patch

[Don't load content scripts on pages with mozAddonManager](attachment.cgi?id=8799010&action=diff) (obsolete)
— [Details](attachment.cgi?id=8799010&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799010)

MozReview-Commit-ID: GN4Bc8RZQBn
[Attachment #8799010](/attachment.cgi?id=8799010&action=edit "Don't load content scripts on pages with mozAddonManager") -
Flags: review?(kmaglione+bmo)

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1295324#c17)• 8 years ago |
|  | |

Attached patch

[Test for content scripts with mozAddonManager](attachment.cgi?id=8799011&action=diff)
— [Details](attachment.cgi?id=8799011&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799011)

MozReview-Commit-ID: BN9HKaHkbuC
[Attachment #8799011](/attachment.cgi?id=8799011&action=edit "Test for content scripts with mozAddonManager") -
Flags: review?(kmaglione+bmo)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1295324#c18)• 8 years ago |
|  | |

Comment on [attachment 8799010](/attachment.cgi?id=8799010 "Don't load content scripts on pages with mozAddonManager") [[details]](/attachment.cgi?id=8799010&action=edit "Don't load content scripts on pages with mozAddonManager") [[diff]](/attachment.cgi?id=8799010&action=diff "Don't load content scripts on pages with mozAddonManager") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799010)
Don't load content scripts on pages with mozAddonManager
Review of [attachment 8799010](/attachment.cgi?id=8799010 "Don't load content scripts on pages with mozAddonManager") [[details]](/attachment.cgi?id=8799010&action=edit "Don't load content scripts on pages with mozAddonManager") [[diff]](/attachment.cgi?id=8799010&action=diff "Don't load content scripts on pages with mozAddonManager") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799010):
-----------------------------------------------------------------
Please remove the summary from this commit before landing, and only include the bug number and reviewer.
[Attachment #8799010](/attachment.cgi?id=8799010&action=edit "Don't load content scripts on pages with mozAddonManager") -
Flags: review?(kmaglione+bmo) → review+

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a4572114_106098)• 8 years ago |

[Attachment #8799011](/attachment.cgi?id=8799011&action=edit "Test for content scripts with mozAddonManager") -
Flags: review?(kmaglione+bmo) → review+

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1295324#c19)• 8 years ago |
|  | |

Bumping this to sec-high since, even though this is something legacy add-ons can already do, it is a pretty severe privilege escalation for sandboxed WebExtensions.Flags: needinfo?(kmaglione+bmo)Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---) → [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1295324#c20)• 8 years ago |
|  | |

Attached patch

[360403](attachment.cgi?id=8799046&action=diff)
— [Details](attachment.cgi?id=8799046&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799046)

MozReview-Commit-ID: GN4Bc8RZQBn

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a4577313_561655)• 8 years ago |

[Attachment #8799010](/attachment.cgi?id=8799010&action=edit "Don't load content scripts on pages with mozAddonManager") -
Attachment is obsolete: true

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1295324#c21)• 8 years ago |
|  | |

Comment on [attachment 8799046](/attachment.cgi?id=8799046 "360403") [[details]](/attachment.cgi?id=8799046&action=edit "360403") [[diff]](/attachment.cgi?id=8799046&action=diff "360403") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799046)
360403
Carrying over :kmag's r+ from a previous copy of this patch.
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Constructing the exploit would be relatively easy, actually carrying out the exploit requires the attacker to trick the victim into installing a malicious extension.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
The patch doesn't exactly "paint a bulls-eye" but it does point clearly toward the problem.
Which older supported branches are affected by this flaw?
This problem has existed since mozAddonManager originally shipped in 48.
If not all supported branches, which bug introduced the flaw?
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
The patch is simple enough that backports should be trivial.
How likely is this patch to cause regressions; how much testing does it need?
It is unlikely to cause regressions, and it includes tests.
[Attachment #8799046](/attachment.cgi?id=8799046&action=edit "360403") -
Flags: sec-approval?
[Attachment #8799046](/attachment.cgi?id=8799046&action=edit "360403") -
Flags: review+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1295324#c22)• 8 years ago |
|  | |

sec-approval+ for checkin \*without\* tests. We don't check in tests for security bugs normally until after the effected code ships to the public. Otherwise, the tests can 0day us.
We'll want Aurora and Beta patches made and nominated as well for going in after trunk is green.
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix)
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected)
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=unaffected)
[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B)
[tracking-firefox51](/buglist.cgi?f1=cf_tracking_firefox51&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B)
[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a4586578_280903)• 8 years ago |

[Attachment #8799046](/attachment.cgi?id=8799046&action=edit "360403") -
Flags: sec-approval? → sec-approval+

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1295324#c23)• 8 years ago |
|  | |

It occurs to me that this is an issue for Greasemonkey user scripts, too... We should probably reach out to its developers to get it fixed and then blocklist affected versions.Flags: needinfo?(jorge)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1295324#c24)• 8 years ago |
|  | |

Also, I think we are going to need to go the host permission checking rout, after all, and add a check to MatchPattern.jsm. It's still possible for extensions to exploit this using the webRequest API, by changing CSP headers and then redirecting a script request from AMO to a malicious third-party.
I'll file a follow-up bug for that. Also adding the leave-open flag to this bug until tests are landed.Keywords: [leave-open](/buglist.cgi?keywords=leave-open&resolution=---)

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1295324#c25)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/63e401d16993f2b17a69c92eabd385d2f2e256fb>
[Bug 1295324](/show_bug.cgi?id=1295324 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges.") r=kmag a=al

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1295324#c26)• 8 years ago |
|  | |

Comment on [attachment 8799046](/attachment.cgi?id=8799046 "360403") [[details]](/attachment.cgi?id=8799046&action=edit "360403") [[diff]](/attachment.cgi?id=8799046&action=diff "360403") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799046)
360403
Approval Request Comment
[Feature/regressing bug #]:
Security vulnerability with extensions and mozAddonManager
[User impact if declined]:
Malicious extensions may be able to access the mozAddonManager api and use that to install extensions that have greater privileges.
[Describe test coverage new/current, TreeHerder]:
Tests are in a separate patch attached to this bug, which will be embargoed until the fix is widely distributed.
[Risks and why]:
This patch addresses the vulnerability described in the bug.
[String/UUID change made/needed]:
N/A
[Attachment #8799046](/attachment.cgi?id=8799046&action=edit "360403") -
Flags: approval-mozilla-beta?
[Attachment #8799046](/attachment.cgi?id=8799046&action=edit "360403") -
Flags: approval-mozilla-aurora?

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a4601683_106098)• 8 years ago |

Blocks: [CVE-2017-5389](/show_bug.cgi?id=1308688 "RESOLVED FIXED - Prevent WebExtensions from modifying requests to hosts with mozAddonManager permissions")

|  | [Phil Ringnalda (:philor)](/user_profile?user_id=135518) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1295324#c27)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/63e401d16993>
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed)Target Milestone: --- → mozilla52

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1295324#c28)• 8 years ago |
|  | |

Comment on [attachment 8799046](/attachment.cgi?id=8799046 "360403") [[details]](/attachment.cgi?id=8799046&action=edit "360403") [[diff]](/attachment.cgi?id=8799046&action=diff "360403") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1295324&attachment=8799046)
360403
Sec-high, Aurora51+, Beta50+
[Attachment #8799046](/attachment.cgi?id=8799046&action=edit "360403") -
Flags: approval-mozilla-beta?
[Attachment #8799046](/attachment.cgi?id=8799046&action=edit "360403") -
Flags: approval-mozilla-beta+
[Attachment #8799046](/attachment.cgi?id=8799046&action=edit "360403") -
Flags: approval-mozilla-aurora?
[Attachment #8799046](/attachment.cgi?id=8799046&action=edit "360403") -
Flags: approval-mozilla-aurora+

|  | [Jorge Villalobos [:jorgev] (he/him)](/user_profile?user_id=189742) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1295324#c29)• 8 years ago |
|  | |

This is blocking all content scripts from working on domains that expose `mozAddonManager`, right? Other than addons.mozilla.org, what domains are affected? Is there no workaround for someone who wants to write a content script for those domains?
As for the outreach, this would be specifically for add-ons attempting to access `mozAddonManager`, right?Flags: needinfo?(jorge) → needinfo?(kmaglione+bmo)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1295324#c30)• 8 years ago |
|  | |

(In reply to Jorge Villalobos [:jorgev] from [comment #29](/show_bug.cgi?id=1295324#c29 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> This is blocking all content scripts from working on domains that expose
> `mozAddonManager`, right? Other than addons.mozilla.org, what domains are
> affected?
Yes. At the moment, just testpilot.firefox.com:
<http://searchfox.org/mozilla-central/rev/3e03a4064eb585d96f28023785a5c242969878a6/toolkit/mozapps/extensions/AddonManagerWebAPI.cpp#42-44>
> Is there no workaround for someone who wants to write a content script for
> those domains?
No, for the moment at least, they'd just have to write a legacy bootstrap
add-on. There's no safe way to load user scripts into those pages.
Hopefully, in the future, we'll be able to add a special WebExtension
permission that requires manual review, but for now, it's not really an
option.
> As for the outreach, this would be specifically for add-ons attempting to
> access `mozAddonManager`, right?
Just for add-ons that load third-party user scripts, like Greasemonkey or
Scriptish, and WebExtensions that currently load user scripts into AMO.
However, we can't do any outreach to the second group in general until \*after\*
this merges to release. There might be some special cases that we can contact
sooner.Flags: needinfo?(kmaglione+bmo)

|  | [Jorge Villalobos [:jorgev] (he/him)](/user_profile?user_id=189742) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1295324#c31)• 8 years ago |
|  | |

(In reply to Kris Maglione [:kmag] from [comment #30](/show_bug.cgi?id=1295324#c30 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> Hopefully, in the future, we'll be able to add a special WebExtension
> permission that requires manual review, but for now, it's not really an
> option.
In the interim, dropping content scripts should include a console message to make it clear why this is happening. Maybe this is something that also needs to wait for the merge to release, but at the moment the experience is far from ideal (I noticed that with one of my add-ons on Nightly this morning and had no idea until I saw this bug).

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1295324#c32)• 8 years ago |
|  | |

(In reply to Jorge Villalobos [:jorgev] from [comment #31](/show_bug.cgi?id=1295324#c31 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> In the interim, dropping content scripts should include a console message to
> make it clear why this is happening. Maybe this is something that also needs
> to wait for the merge to release, but at the moment the experience is far
> from ideal (I noticed that with one of my add-ons on Nightly this morning
> and had no idea until I saw this bug).
Can you file a follow-up (security) bug to add a console message? We might
have to start with a vague message and add more details once the fix is in
release.

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1295324#c33)• 8 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/181a64b1364b>
<https://hg.mozilla.org/releases/mozilla-beta/rev/e6bc67cc7d76>
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed)

|  | [Jorge Villalobos [:jorgev] (he/him)](/user_profile?user_id=189742) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a4833974_189742)• 8 years ago |

Blocks: [1309033](/show_bug.cgi?id=1309033 "NEW - Show message in Browser Console when WebExtensions scripts are blocked")

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1295324#c34)• 8 years ago |
|  | |

We are planning a 49.0.2 release next week. If you think that it needs to be on 49 asap please request uplift to mozilla-release. If it can wait till 50 is out on Nov. 8th then let's wait.Flags: needinfo?(aswan)

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1295324#c35)• 8 years ago |
|  | |

I don't feel strongly one way or the other but Al marked this wontfix for 49 in [comment 22](/show_bug.cgi?id=1295324#c22 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges.").Flags: needinfo?(aswan)

|  | [Vasilica Tamas, QA [:vtamas]](/user_profile?user_id=522000) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a6610019_522000)• 8 years ago |

Depends on: [1313996](/show_bug.cgi?id=1313996 "RESOLVED DUPLICATE - Awesome Screenshot Plus doesn’t work for addons.mozilla.org pages")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a7424290_280903)• 8 years ago |

Whiteboard: triaged → [adv-main50+] triaged

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a7507294_280903)• 8 years ago |

Alias: CVE-2016-9075

|  | [Chuck Harmston [:chuck]](/user_profile?user_id=461732) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1295324#c36)• 8 years ago |
|  | |

> Yes. At the moment, just testpilot.firefox.com:
>
> <http://searchfox.org/mozilla-central/rev/3e03a4064eb585d96f28023785a5c242969878a6/toolkit/mozapps/extensions/AddonManagerWebAPI.cpp#42-44>
Best I can tell, these changes only apply to WebExtensions. Test Pilot is currently an SDK add-on that uses a PageMods to create a communication channel between our add-on and the website. If that's not affected, we're fine.
It's worth noting that we do hope to move Test Pilot to a WebExtension in the near future (ref #1280233), and this change would be a blocker to that.

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1295324#c37)• 8 years ago |
|  | |

It should be easy enough to add a special permission for internal add-ons so we can ignore this restriction.

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1295324#c38)• 8 years ago |
|  | |

Al, when should the tests for this bug land? (The patch itself many weeks ago now). This is also loosely related to [bug 1308688](/show_bug.cgi?id=1308688 "RESOLVED FIXED - Prevent WebExtensions from modifying requests to hosts with mozAddonManager permissions")Flags: needinfo?(abillings)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a9140522_106098)• 8 years ago |

Status: NEW → RESOLVEDClosed: 8 years agoFlags: in-testsuite?Keywords: [leave-open](/buglist.cgi?keywords=leave-open&resolution=---)Resolution: --- → FIXED

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1295324#c39)• 8 years ago |
|  | |

(In reply to Andrew Swan [:aswan] from [comment #38](/show_bug.cgi?id=1295324#c38 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> Al, when should the tests for this bug land? (The patch itself many weeks
> ago now). This is also loosely related to [bug 1308688](/show_bug.cgi?id=1308688 "RESOLVED FIXED - Prevent WebExtensions from modifying requests to hosts with mozAddonManager permissions")
Dan and I discussed this and think it can be checked in after the work week (i.e. week after next). We're hoping for more Firefox 50 uptake before running a risk of revealing the fix.Flags: needinfo?(abillings)

|  | [Vasilica Tamas, QA [:vtamas]](/user_profile?user_id=522000) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1295324#c40)• 8 years ago |
|  | |

I was able to reproduce this issue on Firefox 51.0a1 (2016-08-15) under Windows 10 64-bit.
Manually verified this bug using the webextension from [Comment 1](/show_bug.cgi?id=1295324#c1 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges.") and I confirm that the AdBlock Plus is no longer installed on Firefox 53.0a1 (2016-12-01), Firefox 52.0a2 (2016-12-01/02), Firefox 51.0b5 (20161129164126) and Firefox 50.0.2 (20161129173726) under Windows 10 64-bit and Ubuntu 16.-4 32-bit.Status: RESOLVED → VERIFIED
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=verified)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified)
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a10487384_1689)• 8 years ago |

Group: toolkit-core-security → core-security-release

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1295324#c41)• 8 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #39](/show_bug.cgi?id=1295324#c39 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> (In reply to Andrew Swan [:aswan] from [comment #38](/show_bug.cgi?id=1295324#c38 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges."))
> > Al, when should the tests for this bug land? (The patch itself many weeks
> > ago now). This is also loosely related to [bug 1308688](/show_bug.cgi?id=1308688 "RESOLVED FIXED - Prevent WebExtensions from modifying requests to hosts with mozAddonManager permissions")
>
> Dan and I discussed this and think it can be checked in after the work week
> (i.e. week after next). We're hoping for more Firefox 50 uptake before
> running a risk of revealing the fix.
Just a double check, we're now ready to check in the tests for this bug?Flags: needinfo?(abillings)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1295324#c42)• 8 years ago |
|  | |

Yes, I think it is fine.Flags: needinfo?(abillings) → needinfo?(aswan)

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1295324#c43)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/ab439ec85d1556fdeaf5aafb5261bfa452a69f4e>
[Bug 1295324](/show_bug.cgi?id=1295324 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges.") Test for content scripts with mozAddonManager r=kmag

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1295324#c44)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/d7c4457f610d002b6385d6de0ffc7ce0203aac5e>
[Bug 1295324](/show_bug.cgi?id=1295324 "VERIFIED FIXED - WebExtensions can easily access the mozAddonManager API and use it to gain elevated privileges.") Skip test on android r=me a=test-only

|  | [Andrew Swan [:aswan]](/user_profile?user_id=561655)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a11073963_561655)• 8 years ago |

Flags: needinfo?(aswan)

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1295324#c45)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/ab439ec85d15>
<https://hg.mozilla.org/mozilla-central/rev/d7c4457f610d>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a15357341_1689)• 8 years ago |

Group: core-security-release

|  | [YF (Yang)](/user_profile?user_id=398515) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a33871414_398515)• 7 years ago |

Depends on: [1280237](/show_bug.cgi?id=1280237 "RESOLVED WONTFIX - Implement chrome.management.install")

|  | [YF (Yang)](/user_profile?user_id=398515) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a33871620_398515)• 7 years ago |

No longer depends on: [1280237](/show_bug.cgi?id=1280237 "RESOLVED WONTFIX - Implement chrome.management.install")

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1295324#a58139817_546015)• 7 years ago |

Product: Toolkit → WebExtensions
You need to [log in](/show_bug.cgi?id=1295324&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Kris Maglione [:kmag]](/user_profile?user_id=106098)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


