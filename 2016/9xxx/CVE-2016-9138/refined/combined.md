=== Content from www.openwall.com_89c4e47e_20250124_125254.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](../../../2016/10/18/15) [[thread-next>]](7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAEsznC4-QChSbpYPR8cDCdjOyGpiseTv0VYwSra2+ttkiBNm=A@mail.gmail.com>
Date: Tue, 1 Nov 2016 10:58:28 +0200
From: Lior Kaplan <kaplanlior@...il.com>
To: cve-assign@...re.org
Cc: oss-security@...ts.openwall.com
Subject: Re: CVE assignment for PHP 5.6.27 and 7.0.12

On Tue, Oct 18, 2016 at 7:34 PM, <cve-assign@...re.org> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA256
>
> > Please assign a CVE for the following issue:
> >
> > Bug #73147    Use After Free in unserialize()
> > <https://bugs.php.net/bug.php?id=73147>
> > <http://git.php.net/?p=php-src.git;a=commit;h=>
> 0e6fe3a4c96be2d3e88389a5776f878021b4c59f
>
> Can you clarify what should be the scope of this CVE?
> zend_unset_property doesn't exist at all in PHP 7.0.11. The
> 0e6fe3a4c96be2d3e88389a5776f878021b4c59f commit adds
> zend_unset_property for PHP 7.0.12, and arranges for
> zend_unset_property to be called only from
> "ZEND_METHOD(CURLFile, __wakeup)" in ext/curl/curl_file.c.
>
> We're not sure whether that affects anything outside of the CURLFile
> implementation. However, 73147 discusses other concerns such as "The
> similar bug can be also triggered via Exception::__toString with
> DateInterval::__wakeup" and "The problem is that every __wakeup that
> modifies any property would produce the same problem."
>
> There seems to be a related code change between 7.0.11 and 7.0.12 that
> arranges for additional calls to zend_unset_property:
>
>   <http://git.php.net/?p=php-src.git;a=blobdiff;f=Zend/zend_exceptions.c;h=>
> f21968733581a3cb672d039bec16ce6f17a93db9;hp=95d18f45fbea8808c00975b5df4619
> d5d6745ab0;hb=689a9b8def07875641b3132a82c701fb7acb676c;hpb=
> 4165d976066129000d947ffa3be73f91e9867635
>
> So, some of the options include:
>
> 1. 0e6fe3a4c96be2d3e88389a5776f878021b4c59f is a complete security
> patch that fixes everything discussed in 73147, including the "other
> concerns" mentioned above.
>
> 2. 0e6fe3a4c96be2d3e88389a5776f878021b4c59f fixes only the CURLFile
> implementation. The "other concerns" mentioned above are
> vulnerabilities that still exist in 7.0.12.
>
> 3. The combination of 0e6fe3a4c96be2d3e88389a5776f878021b4c59f and the
> above Zend/zend_exceptions.c diff is a complete security patch that
> fixes everything discussed in 73147, including the "other concerns"
> mentioned above. There only needs to be one CVE ID associated with
> this complete security patch.
>
> 4. The combination of 0e6fe3a4c96be2d3e88389a5776f878021b4c59f and the
> above Zend/zend_exceptions.c diff is a complete security patch that
> fixes everything discussed in 73147, including the "other concerns"
> mentioned above. There should be one CVE ID for the security fix to
> the CURLFile implementation, and a separate CVE ID for the security
> fix found in Zend/zend_exceptions.c.
>
> Which of the above (1 through 4) is correct and/or preferred?
>

I've asked Stas (who fixed the issue) and #2 is the current situation.

Kaplan

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from bugs.php.net_c0e271cc_20250124_125255.html ===


| [Bugs](/) | [php.net](https://php.net/) |  [support](https://php.net/support.php) |  [documentation](https://php.net/docs.php) |  [report a bug](report.php) |  [advanced search](search.php) |  [search howto](search-howto.php) |  [statistics](stats.php) |  [random bug](random) |  [login](login.php) |
| --- | --- |
| go to bug id or search bugs for | |

| | [Sec Bug](bug.php?id=73147) #73147 | Use After Free in unserialize() | | | | | | --- | --- | --- | --- | --- | --- | | Submitted: | 2016-09-23 13:22 UTC | Modified: | 2016-11-02 09:25 UTC |  | | From: | taoguangchen at icloud dot com | Assigned: | [stas](search.php?cmd=display&assign=stas) ([profile](https://people.php.net/stas)) | | Status: | Closed | Package: | [\*General Issues](search.php?cmd=display&package_name[]=%2AGeneral+Issues) | | PHP Version: | 5.6.26 | OS: |  | | Private report: | No | CVE-ID: | [2016-9137](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9137) |   View [Developer](bug.php?id=73147&edit=1) [Edit](bug.php?id=73147&edit=2)   **[2016-09-23 13:22 UTC] taoguangchen at icloud dot com** ``` Description: ------------ PoC: ``` <?php  $poc = 'a:1:{i:0;O:8:"CURLFile":1:{s:4:"name";R:1;}}'; unserialize($poc);  ?> ```    ``` Patches[1](patch-display.php?bug_id=73147&patch=1&revision=latest) (last revision 2019-09-06 03:41 UTC by 825307076 at qq dot com) [demo17](patch-display.php?bug_id=73147&patch=demo17&revision=latest) (last revision 2019-06-06 06:46 UTC by 417177366 at qq dot com) Pull RequestsHistoryAllCommentsChangesGit/SVN commitsRelated reports  **[2016-09-26 02:55 UTC] [stas@php.net](//people.php.net/stas)** -PHP Version: 7.0.11 +PHP Version: 5.6.26 -Assigned To: +Assigned To: stas -CVE-ID: +CVE-ID: needed **[2016-09-26 02:55 UTC] [stas@php.net](//people.php.net/stas)** ``` The fix is in security repo as 0e6fe3a4c96be2d3e88389a5776f878021b4c59f and in <https://gist.github.com/57d761ebfeed962fe7ffb498348f2965>  please verify  ``` **[2016-09-26 11:10 UTC] taoguangchen at icloud dot com** ``` The similar bug can be also triggered via Exception::__toString with DateInterval::__wakeup  ``` ZEND_METHOD(exception, __toString) { ... 	zend_update_property_str(base_ce, exception, "string", sizeof("string")-1, str); ```  PoC: ``` <?php  $poc = 'O:9:"Exception":2:{S:17:"\00Exception\00string";R:1;i:0;O:12:"DateInterval":1:{s:4:"days";R:1;}}'; unserialize($poc);  ?> ```  ``` **[2016-09-26 19:42 UTC] [stas@php.net](//people.php.net/stas)** ``` Hmmm... I suspect there might be also other places, I'm not sure how to handle this problem in general, as reference allows to overwrite anything, by definition, that's how reference is supposed to work.  ``` **[2016-09-26 22:30 UTC] taoguangchen at icloud dot com** ``` the follow patch can fix this bug:  ``` +	zval tmp; +	ZVAL_STRINGL(&tmp, "string", sizeof("string") - 1); +	Z_OBJ_HANDLER_P(exception, unset_property)(exception, &tmp, NULL); +	zval_ptr_dtor(&tmp); 	zend_update_property_str(base_ce, exception, "string", sizeof("string")-1, str); ```  ``` **[2016-09-26 22:35 UTC] [stas@php.net](//people.php.net/stas)** ``` Yes, I know this particular one can be easily fixed. The problem is that every __wakeup that modifies any property would produce the same problem.  ``` **[2016-09-26 22:41 UTC] taoguangchen at icloud dot com** ``` You can handle the DateInterval::__wakeup() like PHP5.  ``` **[2016-10-11 23:45 UTC] [stas@php.net](//people.php.net/stas)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=0e6fe3a4c96be2d3e88389a5776f878021b4c59f> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-11 23:45 UTC] [stas@php.net](//people.php.net/stas)** -Status: Assigned +Status: Closed **[2016-10-12 15:57 UTC] [ab@php.net](//people.php.net/ab)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=f42cbd749cde1f91274c1d03df9024baba141a8f> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-12 23:26 UTC] [ab@php.net](//people.php.net/ab)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=d13507d2e6d7c280888cc9c3cab125b347662e90> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-12 23:35 UTC] [ab@php.net](//people.php.net/ab)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=0e6fe3a4c96be2d3e88389a5776f878021b4c59f> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-14 01:02 UTC] [ab@php.net](//people.php.net/ab)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=54003ab6631b489af54631a548597e8bd599b266> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-14 02:22 UTC] [ab@php.net](//people.php.net/ab)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=f42cbd749cde1f91274c1d03df9024baba141a8f> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-14 02:23 UTC] [ab@php.net](//people.php.net/ab)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=0e6fe3a4c96be2d3e88389a5776f878021b4c59f> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-14 02:23 UTC] [ab@php.net](//people.php.net/ab)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=54003ab6631b489af54631a548597e8bd599b266> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-14 06:00 UTC] [tyrael@php.net](//people.php.net/tyrael)** -Summary: Use After Free in PHP7 unserialize() +Summary: Use After Free in unserialize() **[2016-10-17 10:06 UTC] [bwoebi@php.net](//people.php.net/bwoebi)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=54003ab6631b489af54631a548597e8bd599b266> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-17 10:07 UTC] [bwoebi@php.net](//people.php.net/bwoebi)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=f42cbd749cde1f91274c1d03df9024baba141a8f> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-10-17 10:07 UTC] [bwoebi@php.net](//people.php.net/bwoebi)** ``` Automatic comment on behalf of stas Revision: <http://git.php.net/?p=php-src.git;a=commit;h=0e6fe3a4c96be2d3e88389a5776f878021b4c59f> Log: Fix [bug #73147](bug.php?id=73147): Use After Free in PHP7 unserialize()  ``` **[2016-11-02 09:25 UTC] [kaplan@php.net](//people.php.net/kaplan)** -CVE-ID: needed +CVE-ID: 2016-9137 **[2016-11-02 09:25 UTC] [kaplan@php.net](//people.php.net/kaplan)** ``` From CVE-assign: "Use CVE-2016-9137 for the ext/curl/curl_file.c vulnerability that was fixed in 5.6.27 and 7.0.12.  Use CVE-2016-9138 for the remaining security problem associated with __wakeup that is still present in 5.6.27 and 7.0.12."  ``` **[2019-06-06 06:46 UTC] 417177366 at qq dot com** ``` The following patch has been added/updated:  Patch Name: demo17 Revision:   1559803573 URL:        <https://bugs.php.net/patch-display.php?bug=73147&patch=demo17&revision=1559803573>  ``` **[2019-09-06 03:41 UTC] 825307076 at qq dot com** ``` The following patch has been added/updated:  Patch Name: 1 Revision:   1567741285 URL:        <https://bugs.php.net/patch-display.php?bug=73147&patch=1&revision=1567741285>  ``` |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

|  | |
| --- | --- |
| [PHP](https://php.net/) [Copyright © 2001-2025 The PHP Group](https://php.net/copyright.php) All rights reserved. | Last updated: Fri Jan 24 12:01:28 2025 UTC |


