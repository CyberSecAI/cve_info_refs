=== Content from access.redhat.com_1539aa23_20250126_125630.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.openwall.com_9c0341bf_20250125_235853.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](../../../2016/10/26/8) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <20161027064453.D3E771BE040@smtpvbsrv1.mitre.org>
Date: Thu, 27 Oct 2016 02:44:53 -0400 (EDT)
From: cve-assign@...re.org
To: gustavo.grieco@...il.com
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: librsvg and cairo are causing libpng to write out-of-bounds

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

> A patch was recently proposed:
>
> <https://bugs.freedesktop.org/attachment.cgi?id=127421>
>
> thanks to John Bowler and his detailed analysis of this issue:
>
> <https://bugs.freedesktop.org/show_bug.cgi?id=98165>
>
> Can we have a CVE, now that we know it was an integer overflow and we have
> a patch?

Yes, use CVE-2016-9082 for everything fixed by
attachment.cgi?id=127421. Our understanding is that cairo is the
primary affected product.

- --
CVE Assignment Team
M/S M300, 202 Burlington Road, Bedford, MA 01730 USA
[ A PGP key is available for encrypted communications at
  <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCAAGBQJYEaIXAAoJEHb/MwWLVhi2F84P/RGLhyp408cPps8/bkAIzpL5
zJ8/+sqWYlVfYt+Mwcd4InGIzxHhaBRtPbX7c8FsWRhySib7QRadPdnp4U9xUNXP
o7Z4kV55WIaJhqo5soJT0kMBoI+itrktfJHFsyWnX3KGPvrsc+lembzQ0313Bw8f
G8KSmcSIfEBChOPdqezTsVHggDpwPdmXjBrNrd44WbQJA95oUz9dr9VPknSX52Bw
eBUJRuZ19EV3qlwaw0zrZcme1oqReyELGj8LRBLXGIbEbKfX9azjnHefWJXQW8qr
N3iWWoKSHe2RMo61FcG0T75AVF+A8SCsnbrWsmR4tDMmV98KNqdEoBZmvqH0wrBH
1A3pfvLYE4b9y6IsuWOjSvncvnxaWjHL+U0Vl7ndvHjWUWx6FTXkNLy6+YtxOu7D
wTfMhCSjaXtGoQS6yXYTJlHO1iFE9E3b/7p7Bn/Wgztba78OUUZQyVf4+jT49YQg
dO3OlSx0piN/VSg3ow6+YBHcN9Hr4abgRjFQD9stw2Ski8AOnGZ6vAn5XYqP9xLG
xbWdGECCFX3WlTrQwW/2yKV4B1QndNeqvnhYFTEKNxePPI4236mTHC49mP64SFVG
qALbGd+izC6KRtK1TG6jmFze8wQ1zyfCg3pWd0wottDwoSDOIkUGLv+6U5Cpqz6O
nve18XRyf0Tm9+hQQ8/X
=3wl0
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from security.gentoo.org_60202344_20250125_235858.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Cairo: Denial of service — GLSA **201904-01**

Multiple vulnerabilities were found in Cairo, the worst of which
could cause a Denial of Service condition.

### Affected packages

| Package | **x11-libs/cairo** on all architectures |
| --- | --- |
| Affected versions | < **1.16.0-r3** |
| Unaffected versions | >= **1.16.0-r3** |

### Background

Cairo is a 2D vector graphics library with cross-device output support.

### Description

Multiple vulnerabilities have been discovered in Cairo. Please review
the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Cairo users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=x11-libs/cairo-1.16.0-r2"

```
### References

* [CVE-2016-9082](https://nvd.nist.gov/vuln/detail/CVE-2016-9082)
* [CVE-2017-9814](https://nvd.nist.gov/vuln/detail/CVE-2017-9814)

**Release date**

April 02, 2019

**Latest revision**

April 02, 2019: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [596756](https://bugs.gentoo.org/show_bug.cgi?id=596756)
* [625636](https://bugs.gentoo.org/show_bug.cgi?id=625636)
* [672908](https://bugs.gentoo.org/show_bug.cgi?id=672908)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugs.freedesktop.org_3915fedc_20250126_125630.html ===


Bugzilla – Bug 98165
DoS attack based on using SVG to generate invalid pointers from a \_cairo\_image\_surface in write\_png
Last modified: 2019-07-20 00:47:28 UTC

* [Home](./)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

[**Bug 98165**](show_bug.cgi?id=98165)
(CVE-2016-9082)
- DoS attack based on using SVG to generate invalid pointers from a \_cairo\_image\_surface in write\_png

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
DoS attack based on using SVG to generate invalid pointers from a \_cairo\_imag...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED MOVED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2016-9082 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | cairo | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=cairo "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | general ([show other bugs](buglist.cgi?component=general&product=cairo&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | x86-64 (AMD64) All | |  | | | [Importance](page.cgi?id=fields.html#importance): | medium critical | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Chris Wilson | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | cairo-bugs mailing list | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2016-10-08 17:16 UTC by John Bowler | | --- | --- | | Modified: | 2019-07-20 00:47 UTC ([History](show_activity.cgi?id=98165)) | | CC List: | 1 user (show)  vcunat | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [i915 platform:](page.cgi?id=fields.html#cf_i915_platform "Intel platforms affected by the bug") |  | | [i915 features:](page.cgi?id=fields.html#cf_i915_features "Features of the i915 driver affected by the bug.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**fix integer overflow**](attachment.cgi?id=127211 "View the content of the attachment") (1.08 KB, patch)  [2016-10-11 12:38 UTC](#attach_127211 "Go to the comment associated with the attachment"), Adrian Johnson | [Details](attachment.cgi?id=127211&action=edit) | [Splinter Review](https://bugs.freedesktop.org/page.cgi?id=splinter.html&bug=98165&attachment=127211) | | [**prevent invalid ptr access**](attachment.cgi?id=127421 "View the content of the attachment") (3.78 KB, patch)  [2016-10-20 11:06 UTC](#attach_127421 "Go to the comment associated with the attachment"), Adrian Johnson | [Details](attachment.cgi?id=127421&action=edit) | [Splinter Review](https://bugs.freedesktop.org/page.cgi?id=splinter.html&bug=98165&attachment=127421) | | [Show Obsolete](#a0) (1) [View All](attachment.cgi?bugid=98165&action=viewall&hide_obsolete=1) | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=98165#c0)  John Bowler    2016-10-08 17:16:15 UTC  ``` This is in cairo-1.14.6  This has already been reported on oss-security, although there is no analysis there and as yet there is no CVE:  <http://www.openwall.com/lists/oss-security/2016/10/06/1>  The repro uses:  rsvg-convert -o crash.png crash.svg  The crash happens because write_png passes invalid (off by 4GByte) pointers to libpng.  The bug is in the declaration of _cairo_image_surface which obviously won't work on a machine with a 64-bit address space and 32-bit (int) values.  The crash is 'just' a read from the invalid pointer inside libpng, however there is at least one other case of the loop in read_png where the crash would be a memory overwrite with data from the PNG; that version has been semi-fixed.  I'm not posting a detailed analysis because I'm not sure how many places the bug is exposed and it is pretty clear given the fact that the loop in read_png is different that you already know about one instance of this bug.  The libpng maintainer has a copy of my complete analysis and the original SVG, I suggest not posting it at the moment because it took me about 4 minutes to find the problem given the SVG.  I also suspect it isn't specific to SVG; I assume the read_png change came from test jockeys hitting Cairo with various obvious PNG files, they tend to not test SVG anywhere near as much.  The fix is to change 'stride' in the surface to (size_t), and preferably width/height to (uint32_t) and depth to (unsigned).  Doing that will reveal all cases of the bug given a sufficiently high warning level. ```  [Comment 1](show_bug.cgi?id=98165#c1)  John Bowler    2016-10-11 07:30:52 UTC  ``` This bug is also reported here:  <https://bugzilla.redhat.com/show_bug.cgi?id=1382656>  The referenced bug:  <http://seclists.org/oss-sec/2016/q4/44>  isn't up to date but is, unfortunately, publicly readable. ```  [Comment 2](show_bug.cgi?id=98165#c2)  Adrian Johnson    2016-10-11 12:38:11 UTC  ``` Created [attachment 127211](attachment.cgi?id=127211 "fix integer overflow") [[details]](attachment.cgi?id=127211&action=edit "fix integer overflow") [[review]](page.cgi?id=splinter.html&bug=98165&attachment=127211) fix integer overflow ```  [Comment 3](show_bug.cgi?id=98165#c3)  John Bowler    2016-10-11 16:43:50 UTC  ``` Well, yes, stride should be (size_t), but there may be other instances of this.  If you change the type of stride in the struct to (unsigned int), from (int) and run with the correct compiler warning options it will warn about:      (int) * (unsigned int)  because the (int) gets converted silently to (unsigned int).  GCC probably ignores this by default, but the -Wconversion stuff is meant to detect it.  Coverity certainly can.  Doing the above temporarily will tell you if any other code in libcairo does this.  It doesn't catch all the potential problems; for example read_png already has 'i' as (unsigned int) and does (IRC):      i * stride  That still overflows on a 64-bit system, it just requires a bigger SVG and it is a 'safe' overflow because all the pointers are still inside the image buffer.  This is why I suggested changing the struct member; it is difficult to detect potential 32-bit overflow.  I don't think even Coverity warns about 32-bit arithmetic being used inside a 64-bit address calculation and it is extremely common and normally safe.  The other approach you could use is to check when the cairo surface is created to make sure it doesn't require more than a 31, or 32-bit sized buffer.  However there are some devices out there which can exceed a 4GByte image; think of a 72" poster printer running at 1200dpi.  That has 86400 dots (bytes) per row so a 42" high printout would exceed the limit. ```  [Comment 4](show_bug.cgi?id=98165#c4)  Adrian Johnson    2016-10-13 11:36:08 UTC  ``` I don't like the idea of making stride unsigned. Maybe ptrdiff_t would be a better type for stride. ```  [Comment 5](show_bug.cgi?id=98165#c5)  John Bowler    2016-10-13 14:54:46 UTC  ``` If cairo does support bottom-up surfaces, as are typically used in engineering analysis (where 'z' comes out of the page) then that is the correct solution.  Indeed, the change made to write_png (the cast to (size_t)) does not work because the surface is not made inside cairo-png.c (as in read_png).  Internally libpng uses ptrdiff_t because the libpng "simplified API" accepts an image buffer with a negative stride; stride is 31-bit signed in the API but the local variables initialized using it are ptrdiff_t.  With hindsight it would have been better to use ptrdiff_t in the API, but the CVEs only started rolling in after the API had been in use for a while. ```  [Comment 6](show_bug.cgi?id=98165#c6)  Adrian Johnson    2016-10-20 11:06:45 UTC  ``` Created [attachment 127421](attachment.cgi?id=127421 "prevent invalid ptr access") [[details]](attachment.cgi?id=127421&action=edit "prevent invalid ptr access") [[review]](page.cgi?id=splinter.html&bug=98165&attachment=127421) prevent invalid ptr access ```  [Comment 7](show_bug.cgi?id=98165#c7)  Seth Arnold    2016-11-10 00:35:26 UTC  ``` Is this patch sufficient? There's more cases of 'int stride', including e.g.:  static cairo_surface_t * _cairo_boilerplate_image_create_similar (cairo_surface_t *other,                                          cairo_content_t content,                                          int width, int height) {     cairo_format_t format;     cairo_surface_t *surface;     int stride;     void *ptr;      switch (content) {     case CAIRO_CONTENT_ALPHA:         format = CAIRO_FORMAT_A8;         break;     case CAIRO_CONTENT_COLOR:         format = CAIRO_FORMAT_RGB24;         break;     case CAIRO_CONTENT_COLOR_ALPHA:     default:         format = CAIRO_FORMAT_ARGB32;         break;     }          stride = cairo_format_stride_for_width(format, width);     ptr = malloc (stride* height);      surface = cairo_image_surface_create_for_data (ptr, format,                                                    width, height, stride);     cairo_surface_set_user_data (surface, &key, ptr, free);      return surface; }     I know the malloc (stride * height) looks unsafe, but I think cairo_format_stride_for_width() will return -1 in cases that might cause the stride*height parameter to overflow, which causes the malloc() to fail, and the subsequent functions fail 'safely' in that case.  In any event, this code looks fairly closely tied to stride being an 'int' rather than ptrdiff_t.   Here's another example:  static cairo_status_t _cairo_image_spans_and_zero (void *abstract_renderer,                              int y, int height,                              const cairo_half_open_span_t *spans,                              unsigned num_spans) {     cairo_image_span_renderer_t *r = abstract_renderer;     uint8_t *mask;     int len;      mask = r->u.mask.data;     if (y > r->u.mask.extents.y) {         len = (y - r->u.mask.extents.y) * r->u.mask.stride;         memset (mask, 0, len);         mask += len;     }   The u.mask.stride would be a ptrdiff_t after this patch, but 'len' is still only an 'int'.  Any advice appreciated.  Thanks ```  [Comment 8](show_bug.cgi?id=98165#c8)  John Bowler    2016-11-10 01:33:33 UTC  ``` (In reply to Seth Arnold from [comment #7](show_bug.cgi?id=98165#c7)) >     stride = cairo_format_stride_for_width(format, width);  I think that function should return a ptrdiff_t.  If it does so the compiler will start issuing warnings on 64-bit builds where the result is truncated to 32 bits, as in the above assignment.  I believe that in general it is ok for 'width' and 'height' to be (int), assuming you don't support 16-bit systems, but any multiplication has to be done with care:  >     ptr = malloc (stride* height);  That strikes me as bogus.  Images with rows as long as 2^31 bytes are rare; pretty much limited to people trying to break libpng!  However images with 2^31 or more bytes in total can happen and it is perfectly possible on a modern desktop/laptop/tablet to end up with one in memory.  (Maybe it's a little dumb, but it is possible.)  In any case if cairo_format_stride_for_width uses (-1) as an error return (I'm not that was what you are saying) the callers need to check for it.  >     surface = cairo_image_surface_create_for_data (ptr, format, >                                                    width, height, stride);  The last (stride) parameter should have type ptrdiff_t.  I think the point I was trying to make before is that if the change is done in the struct and places that use the 'stride' member it will force a lot of other changes (int to ptrdiff_t) but a GNU 64-bit compiler with -Wall -Wextra should show the vast majority of the issues.  > Here's another example: >  > static cairo_status_t > _cairo_image_spans_and_zero (void *abstract_renderer, >                              int y, int height, >                              const cairo_half_open_span_t *spans, >                              unsigned num_spans) > { >     cairo_image_span_renderer_t *r = abstract_renderer; >     uint8_t *mask; >     int len; >  >     mask = r->u.mask.data; >     if (y > r->u.mask.extents.y) { >         len = (y - r->u.mask.extents.y) * r->u.mask.stride; >         memset (mask, 0, len); >         mask += len; >     } >  >  > The u.mask.stride would be a ptrdiff_t after this patch, but 'len' is still > only an 'int'.  Right; that should result in a compiler warning for the assignment to 'len', so then the next step is to change 'len' to ptrdiff_t.  Fixing the warnings forces the change through to all the required places.  The only way to stop the warning without fixing the problem is to use an explicit cast; a static_cast in C++ terms.  casts are evil ;-) ```  [Comment 9](show_bug.cgi?id=98165#c9)  zhouzhen1    2017-01-05 14:49:28 UTC  ``` It's been a while since this thread was last updated. Is there any plan to fix this and make a new release? ```  [Comment 10](show_bug.cgi?id=98165#c10)  Bryce Harrington    2017-11-08 01:09:59 UTC  ``` Yes agreed, this fix looks ok, and this is already being carried by Debian Sid.  Carrying this in the devel tree seems like the next logical step, and if no issues arise from the extra testing and review, it looks suitable for landing in 1.14 stable too.  Landed: To ssh://git.freedesktop.org/git/cairo    35fccff..38fbe62  master -> master  Given the feedback in comments 7 & 8 I'm going to leave this report open for now as reminder to investigate further, although it might be worthwhile to break those out as a separate bug report or two so this one can be closed. ```  [Comment 11](show_bug.cgi?id=98165#c11)  GitLab Migration User    2018-08-25 13:35:06 UTC  ``` -- GitLab Migration Automatic Message --  This bug has been migrated to freedesktop.org's GitLab instance and has been closed from further activity.  You can subscribe and participate further through the new bug through this link to our GitLab instance: <https://gitlab.freedesktop.org/cairo/cairo/issues/81>. ```   [Comment 12](show_bug.cgi?id=98165#c12)  emadyassen1998@yahoo.com (Spammer; Account disabled)    2019-07-20 00:47:28 UTC  Comment hidden (spam)  ``` great post. <http://www.winmilliongame.com> <http://www.gtagame100.com> <http://www.subway-game.com> <http://www.zumagame100.com> ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=98165)
* - Top of page

* + [Home](./)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

Use of freedesktop.org services, including Bugzilla, is subject to our [Code of Conduct](https://www.freedesktop.org/wiki/CodeOfConduct/). How we collect and use information is described in our [Privacy Policy](https://www.freedesktop.org/wiki/PrivacyPolicy).



=== Content from bugzilla.redhat.com_d06e5a91_20250125_235857.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1312337)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1312337)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1312337)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1312337

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1312337**](show_bug.cgi?id=1312337)
(CVE-2016-9082)
- [CVE-2016-9082](https://access.redhat.com/security/cve/CVE-2016-9082) cairo: Out of bounds read in read\_png/write\_png in cairo-png.c

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2016-9082 cairo: Out of bounds read in read\_png/write\_png in cairo-png.c

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED WONTFIX | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2016-9082 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | low | | [Severity:](page.cgi?id=fields.html#bug_severity) | low | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | Duplicates (4): | [1382656](show_bug.cgi?id=1382656 "CLOSED DUPLICATE - libpng: Out of bounds write in png_write_row") [1382658](show_bug.cgi?id=1382658 "CLOSED DUPLICATE - libpng10: libpng: Out of bounds write in png_write_row [fedora-all]") [1382659](show_bug.cgi?id=1382659 "CLOSED DUPLICATE - libpng10: libpng: Out of bounds write in png_write_row [fedora-all]") [1382662](show_bug.cgi?id=1382662 "CLOSED DUPLICATE - libpng10: libpng: Out of bounds write in png_write_row [epel-6]")  ([view as bug list](buglist.cgi?bug_id=1382656,1382658,1382659,1382662)) | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1384554](show_bug.cgi?id=1384554 "CLOSED CURRENTRELEASE - cairo: Out of bounds read in read_png/write_png in cairo-png.c [fedora-all]") [1384555](show_bug.cgi?id=1384555 "CLOSED WONTFIX - mingw-cairo: cairo: Out of bounds read in read_png/write_png in cairo-png.c [fedora-all]") [1384556](show_bug.cgi?id=1384556 "CLOSED EOL - mingw-cairo: cairo: Out of bounds read in read_png/write_png in cairo-png.c [epel-7]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1312341](show_bug.cgi?id=1312341) [1382656](show_bug.cgi?id=1382656 "CLOSED DUPLICATE - libpng: Out of bounds write in png_write_row") [1382664](show_bug.cgi?id=1382664) | | TreeView+ | [depends on](buglist.cgi?bug_id=1312337&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1312337&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2016-02-26 13:10 UTC by Adam Mariš | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-17 04:16 UTC ([History](show_activity.cgi?id=1312337)) | | [CC List:](page.cgi?id=fields.html#cclist) | 18 users (show)  bmcclain cfergeau dblechte eedri gklein lsurette mgoldboi michal.skrivanek otte phracek rbalakri sardella security-response-team sherold slawomir srevivo ykaul ylavi | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2016-10-19 19:58:58 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**Backtrace report**](attachment.cgi?id=1130832 "View the content of the attachment") (1.35 KB, text/plain)  [2016-02-26 13:14 UTC](#attach_1130832 "Go to the comment associated with the attachment"), Adam Mariš | *no flags* | [Details](attachment.cgi?id=1130832&action=edit) | | [View All](attachment.cgi?bugid=1312337&action=viewall) | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1312337#c0)  Adam Mariš    2016-02-26 13:10:34 UTC  ``` It was found that specially crafted SVG file can trigger crash in png_write_row when converting the given SVG using librsvg2 and cairo. Crash happens inside libpng when trying to access invalid pointer.  Acknowledgements:  Name: Gustavo Grieco   ```  [Comment 1](show_bug.cgi?id=1312337#c1)  Adam Mariš    2016-02-26 13:14:49 UTC  ``` Created [attachment 1130832](attachment.cgi?id=1130832 "Backtrace report") [[details]](attachment.cgi?id=1130832&action=edit "Backtrace report") Backtrace report   ```  [Comment 3](show_bug.cgi?id=1312337#c3)  Adam Mariš    2016-10-13 10:17:21 UTC  ``` *** [Bug 1382656](show_bug.cgi?id=1382656 "CLOSED DUPLICATE - libpng: Out of bounds write in png_write_row") has been marked as a duplicate of this bug. ***   ```  [Comment 4](show_bug.cgi?id=1312337#c4)  Adam Mariš    2016-10-13 10:38:05 UTC  ``` CVE request:  <http://seclists.org/oss-sec/2016/q4/44>  Upstream bug:  <https://bugs.freedesktop.org/show_bug.cgi?id=98165>   ```  [Comment 5](show_bug.cgi?id=1312337#c5)  Adam Mariš    2016-10-13 14:21:05 UTC  ```  Created cairo tracking bugs for this issue:  Affects: fedora-all [[bug 1384554](show_bug.cgi?id=1384554 "CLOSED CURRENTRELEASE - cairo: Out of bounds read in read_png/write_png in cairo-png.c [fedora-all]")]   ```  [Comment 6](show_bug.cgi?id=1312337#c6)  Adam Mariš    2016-10-13 14:21:17 UTC  ```  Created mingw-cairo tracking bugs for this issue:  Affects: fedora-all [[bug 1384555](show_bug.cgi?id=1384555 "CLOSED WONTFIX - mingw-cairo: cairo: Out of bounds read in read_png/write_png in cairo-png.c [fedora-all]")] Affects: epel-7 [[bug 1384556](show_bug.cgi?id=1384556 "CLOSED EOL - mingw-cairo: cairo: Out of bounds read in read_png/write_png in cairo-png.c [epel-7]")]   ```  [Comment 7](show_bug.cgi?id=1312337#c7)  Stefan Cornelius    2016-10-19 19:54:29 UTC  ``` The upstream bug mentions a separate issue that may cause out-of-bounds writes. While this looks correct initially, I don't think that this is feasible: The memory is allocated using _cairo_malloc_ab(), which has a built-in overflow check. As far as I can tell, this will catch the problem before we can reach the problematic code.  This leaves only the out-of-bounds read, which, all things considered, isn't really that dangerous.   ```  [Comment 8](show_bug.cgi?id=1312337#c8)  Paul Howarth    2016-10-21 10:17:11 UTC  ``` *** [Bug 1382658](show_bug.cgi?id=1382658 "CLOSED DUPLICATE - libpng10: libpng: Out of bounds write in png_write_row [fedora-all]") has been marked as a duplicate of this bug. ***   ```  [Comment 9](show_bug.cgi?id=1312337#c9)  Paul Howarth    2016-10-21 10:18:31 UTC  ``` *** [Bug 1382659](show_bug.cgi?id=1382659 "CLOSED DUPLICATE - libpng10: libpng: Out of bounds write in png_write_row [fedora-all]") has been marked as a duplicate of this bug. ***   ```  [Comment 10](show_bug.cgi?id=1312337#c10)  Paul Howarth    2016-10-21 10:20:10 UTC  ``` *** [Bug 1382662](show_bug.cgi?id=1382662 "CLOSED DUPLICATE - libpng10: libpng: Out of bounds write in png_write_row [epel-6]") has been marked as a duplicate of this bug. ***   ```  [Comment 11](show_bug.cgi?id=1312337#c11)  Adam Mariš    2016-10-27 11:26:23 UTC  ``` Proposed patch:  <https://bugs.freedesktop.org/attachment.cgi?id=127421>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1312337&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugs.freedesktop.org_9cbaeb4a_20250125_235855.html ===
From c812d1c1935cccf096a60ad904e640fdc83bd41c Mon Sep 17 00:00:00 2001
From: Adrian Johnson
Date: Thu, 20 Oct 2016 21:12:30 +1030
Subject: [PATCH] image: prevent invalid ptr access for > 4GB images
Image data is often accessed using:
image->data + y \* image->stride
On 64-bit achitectures if the image data is > 4GB, this computation
will overflow since both y and stride are 32-bit types.
https://bugs.freedesktop.org/show\_bug.cgi?id=98165
---
boilerplate/cairo-boilerplate.c | 4 +++-
src/cairo-image-compositor.c | 4 ++--
src/cairo-image-surface-private.h | 2 +-
src/cairo-mesh-pattern-rasterizer.c | 2 +-
src/cairo-png.c | 2 +-
src/cairo-script-surface.c | 3 ++-
6 files changed, 10 insertions(+), 7 deletions(-)
diff --git a/boilerplate/cairo-boilerplate.c b/boilerplate/cairo-boilerplate.c
index 7fdbf79..4804dea 100644
--- a/boilerplate/cairo-boilerplate.c
+++ b/boilerplate/cairo-boilerplate.c
@@ -42,6 +42,7 @@
#undef CAIRO\_VERSION\_H
#include "../cairo-version.h"
+#include
#include
#include
#include
@@ -976,7 +977,8 @@ cairo\_surface\_t \*
cairo\_boilerplate\_image\_surface\_create\_from\_ppm\_stream (FILE \*file)
{
char format;
- int width, height, stride;
+ int width, height;
+ ptrdiff\_t stride;
int x, y;
unsigned char \*data;
cairo\_surface\_t \*image = NULL;
diff --git a/src/cairo-image-compositor.c b/src/cairo-image-compositor.c
index 48072f8..3ca0006 100644
--- a/src/cairo-image-compositor.c
+++ b/src/cairo-image-compositor.c
@@ -1575,7 +1575,7 @@ typedef struct \_cairo\_image\_span\_renderer {
pixman\_image\_t \*src, \*mask;
union {
struct fill {
- int stride;
+ ptrdiff\_t stride;
uint8\_t \*data;
uint32\_t pixel;
} fill;
@@ -1594,7 +1594,7 @@ typedef struct \_cairo\_image\_span\_renderer {
struct finish {
cairo\_rectangle\_int\_t extents;
int src\_x, src\_y;
- int stride;
+ ptrdiff\_t stride;
uint8\_t \*data;
} mask;
} u;
diff --git a/src/cairo-image-surface-private.h b/src/cairo-image-surface-private.h
index 8ca694c..7e78d61 100644
--- a/src/cairo-image-surface-private.h
+++ b/src/cairo-image-surface-private.h
@@ -71,7 +71,7 @@ struct \_cairo\_image\_surface {
int width;
int height;
- int stride;
+ ptrdiff\_t stride;
int depth;
unsigned owns\_data : 1;
diff --git a/src/cairo-mesh-pattern-rasterizer.c b/src/cairo-mesh-pattern-rasterizer.c
index 1b63ca8..e7f0db6 100644
--- a/src/cairo-mesh-pattern-rasterizer.c
+++ b/src/cairo-mesh-pattern-rasterizer.c
@@ -470,7 +470,7 @@ draw\_pixel (unsigned char \*data, int width, int height, int stride,
tg += tg >> 16;
tb += tb >> 16;
- \*((uint32\_t\*) (data + y\*stride + 4\*x)) = ((ta << 16) & 0xff000000) |
+ \*((uint32\_t\*) (data + y\*(ptrdiff\_t)stride + 4\*x)) = ((ta << 16) & 0xff000000) |
((tr >> 8) & 0xff0000) | ((tg >> 16) & 0xff00) | (tb >> 24);
}
}
diff --git a/src/cairo-png.c b/src/cairo-png.c
index 562b743..aa8c227 100644
--- a/src/cairo-png.c
+++ b/src/cairo-png.c
@@ -673,7 +673,7 @@ read\_png (struct png\_read\_closure\_t \*png\_closure)
}
for (i = 0; i < png\_height; i++)
- row\_pointers[i] = &data[i \* stride];
+ row\_pointers[i] = &data[i \* (ptrdiff\_t)stride];
png\_read\_image (png, row\_pointers);
png\_read\_end (png, info);
diff --git a/src/cairo-script-surface.c b/src/cairo-script-surface.c
index ea0117d..91e4baa 100644
--- a/src/cairo-script-surface.c
+++ b/src/cairo-script-surface.c
@@ -1202,7 +1202,8 @@ static cairo\_status\_t
\_write\_image\_surface (cairo\_output\_stream\_t \*output,
const cairo\_image\_surface\_t \*image)
{
- int stride, row, width;
+ int row, width;
+ ptrdiff\_t stride;
uint8\_t row\_stack[CAIRO\_STACK\_BUFFER\_SIZE];
uint8\_t \*rowdata;
uint8\_t \*data;
--
2.1.4

