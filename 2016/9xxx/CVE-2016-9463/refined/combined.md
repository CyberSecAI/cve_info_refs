=== Content from rhinosecuritylabs.com_8a0cd72c_20250125_082742.html ===


# [Rhino Security Labs](https://rhinosecuritylabs.com)

(888) 944-8679

* [Contact Us](https://rhinosecuritylabs.com/contact/)
* [Get a quote](https://rhinosecuritylabs.com/landing/request-a-quote/)

* [Assessments](/assessment-services/)
  + [Application and Network](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
    - [Web Application Penetration Testing](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
    - [Network Penetration Testing](https://rhinosecuritylabs.com/assessment-services/network-penetration-testing/)
    - [Mobile App Penetration Testing](https://rhinosecuritylabs.com/assessment-services/mobile-app-assessment/)
  + [Cloud Penetration Testing](https://rhinosecuritylabs.com/assessment-services/aws-cloud-penetration-testing/)
    - [AWS Penetration Testing](/assessment-services/aws-cloud-penetration-testing/)
    - [GCP Penetration Testing](https://rhinosecuritylabs.com/assessment-services/gcp-penetration-testing/)
    - [Azure Penetration Testing](https://rhinosecuritylabs.com/assessment-services/azure-penetration-testing/)
  + [Adversary Simulation](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)
    - [Red Team Assessments](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)
    - [Email Spear Phishing](https://rhinosecuritylabs.com/assessment-services/social-engineering/email-phishing-assessment/)
    - [Vishing (Voice Call) Testing](https://rhinosecuritylabs.com/assessment-services/social-engineering/vishing-assessments/)
* [Industries](https://rhinosecuritylabs.com/industry/)
  + [Technology](https://rhinosecuritylabs.com/industry/technology/)
  + [Healthcare](https://rhinosecuritylabs.com/industry/healthcare/)
  + [Financial](https://rhinosecuritylabs.com/industry/financial/)
  + [Retail](https://rhinosecuritylabs.com/industry/retail/)
* [Resources](https://rhinosecuritylabs.com/resources/)
  + [Security Blog](https://rhinosecuritylabs.com/blog/)
    - [Penetration Testing AWS Environments](https://rhinosecuritylabs.com/penetration-testing/aws-security-vulnerabilities-and-the-attackers-perspective/)
    - [EasyMP Zeroday Disclosure](https://rhinosecuritylabs.com/research/epson-easymp-remote-projection-vulnerabilities/)
  + [Downloads](https://rhinosecuritylabs.com/resources/)
    - [Ebook: Questions For Every Pentest Vendor](https://rhinosecuritylabs.com/landing/6-questions-ask-pentest-vendors/)
    - [Example Pentest Report](https://rhinosecuritylabs.com/landing/penetration-test-report/)
    - [Penetration Testing FAQ](https://rhinosecuritylabs.com/assessment-services/penetration-testing-faq/)
  + [Security Research](/research-and-vulnerability-disclosure)
    - [Research and Tool Development](https://rhinosecuritylabs.com/research-and-vulnerability-disclosure/#section-1)
    - [Vulnerability Disclosure](/research-and-vulnerability-disclosure/#section-2)
* [Security Blog](https://rhinosecuritylabs.com/blog/)
* [Company](https://rhinosecuritylabs.com/company/)
  + [About Us](https://rhinosecuritylabs.com/company/)
  + [Leadership](https://rhinosecuritylabs.com/company/leadership/)
  + [Careers](https://rhinosecuritylabs.com/careers/)
  + [Company Principles](https://rhinosecuritylabs.com/careers/rhino-company-principles/)

* [Assessments](/assessment-services/)

  [Application and Network](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
  + [Web Application Penetration Testing](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
  + [Network Penetration Testing](https://rhinosecuritylabs.com/assessment-services/network-penetration-testing/)
  + [Mobile App Penetration Testing](https://rhinosecuritylabs.com/assessment-services/mobile-app-assessment/)

  [Cloud Penetration Testing](https://rhinosecuritylabs.com/assessment-services/aws-cloud-penetration-testing/)
  + [AWS Penetration Testing](/assessment-services/aws-cloud-penetration-testing/)
  + [GCP Penetration Testing](https://rhinosecuritylabs.com/assessment-services/gcp-penetration-testing/)
  + [Azure Penetration Testing](https://rhinosecuritylabs.com/assessment-services/azure-penetration-testing/)

  [Adversary Simulation](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)
  + [Red Team Assessments](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)
  + [Email Spear Phishing](https://rhinosecuritylabs.com/assessment-services/social-engineering/email-phishing-assessment/)
  + [Vishing (Voice Call) Testing](https://rhinosecuritylabs.com/assessment-services/social-engineering/vishing-assessments/)
* [Industries](https://rhinosecuritylabs.com/industry/)

  + [Technology](https://rhinosecuritylabs.com/industry/technology/)
  + [Healthcare](https://rhinosecuritylabs.com/industry/healthcare/)
  + [Financial](https://rhinosecuritylabs.com/industry/financial/)
  + [Retail](https://rhinosecuritylabs.com/industry/retail/)
* [Resources](https://rhinosecuritylabs.com/resources/)

  [Security Blog](https://rhinosecuritylabs.com/blog/)
  + [Penetration Testing AWS Environments](https://rhinosecuritylabs.com/penetration-testing/aws-security-vulnerabilities-and-the-attackers-perspective/)
  + [EasyMP Zeroday Disclosure](https://rhinosecuritylabs.com/research/epson-easymp-remote-projection-vulnerabilities/)

  [Downloads](https://rhinosecuritylabs.com/resources/)
  + [Ebook: Questions For Every Pentest Vendor](https://rhinosecuritylabs.com/landing/6-questions-ask-pentest-vendors/)
  + [Example Pentest Report](https://rhinosecuritylabs.com/landing/penetration-test-report/)
  + [Penetration Testing FAQ](https://rhinosecuritylabs.com/assessment-services/penetration-testing-faq/)

  [Security Research](/research-and-vulnerability-disclosure)
  + [Research and Tool Development](https://rhinosecuritylabs.com/research-and-vulnerability-disclosure/#section-1)
  + [Vulnerability Disclosure](/research-and-vulnerability-disclosure/#section-2)
* [Security Blog](https://rhinosecuritylabs.com/blog/)
* [Company](https://rhinosecuritylabs.com/company/)

  + [About Us](https://rhinosecuritylabs.com/company/)
  + [Leadership](https://rhinosecuritylabs.com/company/leadership/)
  + [Careers](https://rhinosecuritylabs.com/careers/)
  + [Company Principles](https://rhinosecuritylabs.com/careers/rhino-company-principles/)

[Strategic and Technical Blog](https://rhinosecuritylabs.com/blog)

[Penetration Testing](https://rhinosecuritylabs.com/penetration-testing/)

![The Healthcare Industry is a large target for many online attacks.](https://rhinosecuritylabs.com/wp-content/uploads/2016/03/Depositphotos_81840228_original-1140x400.jpg "Medicine concept: Heart on Digital Paper background")
# Operation OwnedCloud: Exploitation and Post-exploitation Persistence

Benjamin Caudill

For a recent engagement, Rhino Security Lab’s was recruited to assess an internal network whose predominant operating system was Windows. After running tertiary scans and audits, nothing seemed to jump out at us besides an open OwnCloud webserver. Owncloud is a private storage solution that is easy to install and customize based on your environment.

Normally a login screen for any web app presents a problem for a penetration tester. To gain access one must have valid credentials, know of an authentication bypass or simply find another way onto the machine; however, we were able to gain access to the machine using a username gathered from the reconnaissance phase using the first password we tried.

Once logged into the application we noticed that this user had access to a shared folder that represented an external SMB storage device. We were able to determine that this folder was not accessible by everyone when monitoring requests through our intercepting proxy, as the apps/files\_external/userglobalstorages/ID endpoint leaked usernames that had access to this device including the administrative user. As our non-admin user, we attempted to upload a PHP shell since PHP files were allowed to be uploaded; however, we could not determine where it was located on the server and thus could not browse to it.

![]( "Screen Shot 2016-08-31 at 11.12.54 AM")

Connecting to an invalid SMB share using improper credentials led to the BAD\_NETWORK\_NAME error on default configurations of SMB servers.

![]( "ifelse")

The faulty logic of the SMB authentication app returns a login if the only error thrown is “NT\_STATUS\_BAD\_NETWORK\_NAME”, meaning any username/password will work to login for default samba SMB server installations.

With nothing left in the tank, we decided to brute force the administrative account credentials. Surprisingly the first set of account credentials worked again of admin:admin. Logging in twice in a row on your first guess of credentials seemed too good to be true, and thus we decided to explore the web administrative console. This client had enabled external SMB authentication mechanisms so they would not have to create a new user for each previous SMB storage user; however, this is where the logic flaw laid. OwnCloud attempts to authenticate any current login by using the command “smbclient -L //host/dummy -Uusername%password”, where host in the SMB host, and the username and password are given at the login screen. However, in default SMB servers this command will return a listing of shares even if the user requesting them does not exist. The problem is that the SMB variable “map to guest” is not set to “never” by default, allowing for anyone to login using any username and password combination they pleased. Moreover, if the user did not exist before logging in with these fake credentials one would be created. To compound this, the external SMB storage they were using to store files had the actual username and password leaked in the administrative console as well.

![]( "cleartext_pass")

In the administrative OwnCloud console, passwords for the external storage devices are stored in cleartext.

Thanks to the faulty authentication protocol used in the external authentication app, we were able to gain web admin but had yet to gain a foothold on the machine. After installing OwnCloud it was discovered that the data directory for all user files would, by default, be installed under the webroot in which OwnCloud was located. Further, after creating the data directory in this unsafe location OwnCloud failed to update the “.htaccess” file allowing a user to browse to their own files. As a simple proof of concept to see if the data directory was left within the host’s web-root, we browsed to the https://hostname/owncloud/data url and was not greeted with a 403 or redirect, and thus deduced we could browse to our file. We browsed to our previously uploaded PHP file located at https://hostname/data/username/files/cmd.php and began executing commands on the machine!

![]( "cmd_php")

After setting up a replica of the client OwnCloud configuration on AWS, we uploaded our PHP shell and gained code execution.

Finally, our foothold had been established on the machine locally as the web user “www-data”. This foothold is a fragile one however as we had left a large indicator that our file, cmd.php, still uploaded under the compromised account. For post-exploitation persistence we decided to use the faulty SMB authentication command. When reading the source code both username and password are escaped for shell arguments but the host parameter was not. This allowed us to edit the configuration file and change the SMB host it authenticated against to run a reverse shell to our attacking machine each time a user attempted to login. Once we validated the command was running each time a user tried to login to the web app, we removed our “cmd.php” file and had established a strong backdoor onto the system.

## VULNERABILITY DISCLOSURE

At the time of writing this, [NextCloud](https://www.nextcloud.com/) has patched the authentication bypass vulnerability, while OwnCloud has chosen not to.

**Disclosure Timeline:**

* Jun 28th: Authentication bypass disclosure to OwnCloud via HackerOne report.
* Jul 1st: Response from OwnCloud investigating.
* Jul 27th: Inquiry by Rhino Security Labs for an update.
* Aug 2nd: Another inquiry for an update by Rhino Security Labs.
* Aug 10th: NextCloud responder joins the ticket and recognizes vulnerability. Solution figured out.
* Aug 22nd: Update requested by Rhino Security Labs on progress.
* Sep 7th: Second OwnCloud representative joins conversation and says that they “Fail to see the impact” of the vulnerability.
* Sep 12th: NextCloud recognizes the bypass and will integrate the solution into their application.
* Sep 28th: NextCloud patches the application (https://nextcloud.com/changelog/).
* Oct 11th: Advisory released. (https://nextcloud.com/security/advisory/?id=nc-sa-2016-006)
* Nov 10th: OwnCloud advisory released. (https://owncloud.org/security/advisory/?id=oc-sa-2016-017)

## Related Resources

![]( "feed config")
### CVE-2022-25372:Local Privilege Escalation in Pritunl VPN Client

![]( "Pasted_image_at_2018-10-28__5_37_PM")
### Java Deserialization Exploitation With Customized Ysoserial Payloads

![]( "pic3")
### Fuzzing Left4Dead 2 with CERT’s Basic Fuzzing Framework

## Interested in more information?

20603
[Contact Us Today](https://rhinosecuritylabs.com/contact/)

![]()

##### [Assessment Services](https://rhinosecuritylabs.com/assessment-services/)

* [Network Penetration Test](https://rhinosecuritylabs.com/assessment-services/network-penetration-testing/)
* [Webapp Penetration Test](https://rhinosecuritylabs.com/assessment-services/web-penetration-testing/)
* [AWS Cloud Penetration Testing](https://rhinosecuritylabs.com/assessment-services/aws-cloud-penetration-testing/)
* [GCP Cloud Penetration Testing](https://rhinosecuritylabs.com/assessment-services/gcp-penetration-testing/)
* [Azure Penetration Testing](https://rhinosecuritylabs.com/assessment-services/azure-penetration-testing/)
* [Mobile App Assessment](https://rhinosecuritylabs.com/assessment-services/mobile-app-assessment/)
* [Secure Code Review](https://rhinosecuritylabs.com/assessment-services/secure-code-review/)
* [Social Engineering / Phishing Testing](https://rhinosecuritylabs.com/assessment-services/social-engineering/)
* [Vishing (Voice Call) Testing](https://rhinosecuritylabs.com/assessment-services/social-engineering/vishing-assessments/)
* [Red Team Engagements](https://rhinosecuritylabs.com/assessment-services/red-team-engagement/)

##### [Industries](https://rhinosecuritylabs.com/industry/)

* [Healthcare](https://rhinosecuritylabs.com/industry/healthcare/)
* [Finance](https://rhinosecuritylabs.com/industry/financial/)
* [Technology](https://rhinosecuritylabs.com/industry/technology/)
* [Retail](https://rhinosecuritylabs.com/industry/retail/)

##### [Resources](https://rhinosecuritylabs.com/resources/)

* [Technical Blog](https://rhinosecuritylabs.com/blog-technical/)
* [Strategic Blog](https://rhinosecuritylabs.com/blog-strategic/)
* [Example Pentest Report](https://rhinosecuritylabs.com/landing/penetration-test-report/)
* [Technical Research](https://rhinosecuritylabs.com/research-and-vulnerability-disclosure/)
* [Vulnerability Disclosures](https://rhinosecuritylabs.com/research-and-vulnerability-disclosure/)
* [Disclosure Policy](https://rhinosecuritylabs.com/company/vulnerability-disclosure-policy/)
* [Penetration Testing FAQ](https://rhinosecuritylabs.com/assessment-services/penetration-testing-faq/)
* [Support: AWS Pentest Form](https://rhinosecuritylabs.com/assessment-services/support-aws-penetration-testing-form/)

##### [Company](https://rhinosecuritylabs.com/company/)

* [Leadership](https://rhinosecuritylabs.com/company/leadership/)
* [Blog](https://rhinosecuritylabs.com/blog/)
* [Careers](https://rhinosecuritylabs.com/careers/)
* [Company Principles](https://rhinosecuritylabs.com/careers/rhino-company-principles/)
* [Contact Us](https://rhinosecuritylabs.com/contact/)
* [Get a Quote](https://rhinosecuritylabs.com/request-a-quote/)
* [RSS Feed](https://rhinosecuritylabs.com/blog/feed/)

##### About Us

Rhino Security Labs is a top penetration testing and security assessment firm, with a focus on cloud pentesting (AWS, GCP, Azure), network pentesting, web application pentesting, and phishing.

Endorsed by industry leaders, Rhino Security Labs is a trusted security advisor to the Fortune 500.

info@rhinosecuritylabs.com

(888) 944-8679

Rhino Security Labs, Inc



=== Content from github.com_da3172b8_20250125_082738.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fowncloud-archive%2Fapps%2Fcommit%2Fa0e07b7ddd5a5fd850a6e07f8457d05b76a300b3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fowncloud-archive%2Fapps%2Fcommit%2Fa0e07b7ddd5a5fd850a6e07f8457d05b76a300b3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=owncloud-archive%2Fapps)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 14, 2018. It is now read-only.

[owncloud-archive](/owncloud-archive)
/
**[apps](/owncloud-archive/apps)**
Public archive

* [Notifications](/login?return_to=%2Fowncloud-archive%2Fapps) You must be signed in to change notification settings
* [Fork
  336](/login?return_to=%2Fowncloud-archive%2Fapps)
* [Star
   372](/login?return_to=%2Fowncloud-archive%2Fapps)

* [Code](/owncloud-archive/apps)
* [Issues
  183](/owncloud-archive/apps/issues)
* [Pull requests
  3](/owncloud-archive/apps/pulls)
* [Actions](/owncloud-archive/apps/actions)
* [Projects
  0](/owncloud-archive/apps/projects)
* [Security](/owncloud-archive/apps/security)
* [Insights](/owncloud-archive/apps/pulse)

Additional navigation options

* [Code](/owncloud-archive/apps)
* [Issues](/owncloud-archive/apps/issues)
* [Pull requests](/owncloud-archive/apps/pulls)
* [Actions](/owncloud-archive/apps/actions)
* [Projects](/owncloud-archive/apps/projects)
* [Security](/owncloud-archive/apps/security)
* [Insights](/owncloud-archive/apps/pulse)

## Commit

[Permalink](/owncloud-archive/apps/commit/a0e07b7ddd5a5fd850a6e07f8457d05b76a300b3)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[stable8.2] Merge pull request [#2198](https://github.com/owncloud-archive/apps/pull/2198) from owncloud/smb-auth-fix

[Browse files](/owncloud-archive/apps/tree/a0e07b7ddd5a5fd850a6e07f8457d05b76a300b3)
Browse the repository at this point in the history

```
Double verify the SMB response
```

* Loading branch information

[![@DeepDiver1975](https://avatars.githubusercontent.com/u/1005065?s=40&v=4)](/DeepDiver1975)

[DeepDiver1975](/owncloud-archive/apps/commits?author=DeepDiver1975 "View all commits by DeepDiver1975")
committed
Oct 13, 2016

1 parent
[bc47e3a](/owncloud-archive/apps/commit/bc47e3a0fbe8b4c6d9a0dc8bc37d1914aef5f670)

commit a0e07b7

Showing
**1 changed file**
with
**32 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

43 changes: 32 additions & 11 deletions

43
[user\_external/lib/smb.php](#diff-ff8192ea7a5c6499fa9f662e1dc49bdf5b3d96d077a3845b14edd43681e0cf15 "user_external/lib/smb.php")

Show comments

[View file](/owncloud-archive/apps/blob/a0e07b7ddd5a5fd850a6e07f8457d05b76a300b3/user_external/lib/smb.php)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,18 +32,14 @@ public function \_\_construct($host) { |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \* @param string $uid |
|  |  | \* @param string $password |
|  |  | \* @return bool |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | $uidEscaped=escapeshellarg($uid); |
|  |  | $password=escapeshellarg($password); |
|  |  | $result=array(); |
|  |  | $command=self::SMBCLIENT.' //'.$this->host.'/dummy -U'.$uidEscaped.'%'.$password; |
|  |  | private function tryAuthentication($uid, $password) { |
|  |  | $uidEscaped = escapeshellarg($uid); |
|  |  | $password = escapeshellarg($password); |
|  |  | $command = self::SMBCLIENT.' '.escapeshellarg('//' . $this->host . '/dummy').' -U'.$uidEscaped.'%'.$password; |
|  |  | $lastline = exec($command, $output, $retval); |
|  |  | if ($retval === 127) { |
|  |  | OCP\Util::writeLog( |
| Expand All | | @@ -66,8 +62,33 @@ public function checkPassword($uid, $password) { |
|  |  | return false; |
|  |  | } else { |
|  |  | login: |
|  |  | return $uid; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | // Check with an invalid password, if the user authenticates then fail |
|  |  | $attemptWithInvalidPassword = $this->tryAuthentication($uid, base64\_encode($password)); |
|  |  | if(is\_string($attemptWithInvalidPassword)) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | // Check with valid password |
|  |  | $attemptWithValidPassword = $this->tryAuthentication($uid, $password); |
|  |  | if(is\_string($attemptWithValidPassword)) { |
|  |  | $this->storeUser($uid); |
|  |  | return $uid; |
|  |  | } |
|  |  |  |
|  |  | return false; |
|  |  | } |
|  |  | } |
|  |  |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a0e07b7`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fowncloud-archive%2Fapps%2Fcommit%2Fa0e07b7ddd5a5fd850a6e07f8457d05b76a300b3) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_038fa513_20250125_082735.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fapps%2Fcommit%2Fdecb91fd31f4ffab191cbf09ce4e5c55c67a4087)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fapps%2Fcommit%2Fdecb91fd31f4ffab191cbf09ce4e5c55c67a4087)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nextcloud%2Fapps)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Oct 26, 2019. It is now read-only.

[nextcloud](/nextcloud)
/
**[apps](/nextcloud/apps)**
Public archive

* [Notifications](/login?return_to=%2Fnextcloud%2Fapps) You must be signed in to change notification settings
* [Fork
  29](/login?return_to=%2Fnextcloud%2Fapps)
* [Star
   11](/login?return_to=%2Fnextcloud%2Fapps)

* [Code](/nextcloud/apps)
* [Issues
  0](/nextcloud/apps/issues)
* [Pull requests
  0](/nextcloud/apps/pulls)
* [Actions](/nextcloud/apps/actions)
* [Security](/nextcloud/apps/security)
* [Insights](/nextcloud/apps/pulse)

Additional navigation options

* [Code](/nextcloud/apps)
* [Issues](/nextcloud/apps/issues)
* [Pull requests](/nextcloud/apps/pulls)
* [Actions](/nextcloud/apps/actions)
* [Security](/nextcloud/apps/security)
* [Insights](/nextcloud/apps/pulse)

## Commit

[Permalink](/nextcloud/apps/commit/decb91fd31f4ffab191cbf09ce4e5c55c67a4087)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Double verify the SMB response

[Browse files](/nextcloud/apps/tree/decb91fd31f4ffab191cbf09ce4e5c55c67a4087)
Browse the repository at this point in the history

```
In case anonymous auth is allowed this can otherwise lead to unexpected actions.
```

* Loading branch information

[![@LukasReschke](https://avatars.githubusercontent.com/u/878997?s=40&v=4)](/LukasReschke)

[LukasReschke](/nextcloud/apps/commits?author=LukasReschke "View all commits by LukasReschke")
committed
Sep 9, 2016

1 parent
[f101d84](/nextcloud/apps/commit/f101d8498ffac83924f3bd7acdda7ff181fd662c)

commit decb91f

Showing
**1 changed file**
with
**31 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

42 changes: 31 additions & 11 deletions

42
[user\_external/lib/smb.php](#diff-ff8192ea7a5c6499fa9f662e1dc49bdf5b3d96d077a3845b14edd43681e0cf15 "user_external/lib/smb.php")

Show comments

[View file](/nextcloud/apps/blob/decb91fd31f4ffab191cbf09ce4e5c55c67a4087/user_external/lib/smb.php)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,18 +32,14 @@ public function \_\_construct($host) { |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \* @param string $uid |
|  |  | \* @param string $password |
|  |  | \* @return bool |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | $uidEscaped=escapeshellarg($uid); |
|  |  | $password=escapeshellarg($password); |
|  |  | $result=array(); |
|  |  | $command=self::SMBCLIENT.' //'.$this->host.'/dummy -U'.$uidEscaped.'%'.$password; |
|  |  | private function tryAuthentication($uid, $password) { |
|  |  | $uidEscaped = escapeshellarg($uid); |
|  |  | $password = escapeshellarg($password); |
|  |  | $command = self::SMBCLIENT.' '.escapeshellarg('//' . $this->host . '/dummy').' -U'.$uidEscaped.'%'.$password; |
|  |  | $lastline = exec($command, $output, $retval); |
|  |  | if ($retval === 127) { |
|  |  | OCP\Util::writeLog( |
| Expand All | | @@ -66,8 +62,32 @@ public function checkPassword($uid, $password) { |
|  |  | return false; |
|  |  | } else { |
|  |  | login: |
|  |  | return $uid; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | // Check with an invalid password, if the user authenticates then fail |
|  |  | $attemptWithInvalidPassword = $this->tryAuthentication($uid, base64\_encode($password)); |
|  |  | if(is\_string($attemptWithInvalidPassword)) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | // Check with valid password |
|  |  | $attemptWithValidPassword = $this->tryAuthentication($uid, $password); |
|  |  | if(is\_string($attemptWithValidPassword)) { |
|  |  | $this->storeUser($uid); |
|  |  | return $uid; |
|  |  | } |
|  |  |  |
|  |  | return false; |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `decb91f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fapps%2Fcommit%2Fdecb91fd31f4ffab191cbf09ce4e5c55c67a4087) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from nextcloud.com_9231bef4_20250125_082739.html ===


[Skip to main content](#main)
[![Global launch
](https://nextcloud.com/c/uploads/2025/01/nc-hub10-logo.svg)](https://nextcloud.com/hub10/ "Global launch
")

[Global launch](https://nextcloud.com/hub10/ "Global launch
")

[Sign up now](https://nextcloud.com/hub10/ "Global launch
")

[![Nextcloud Talk](https://nextcloud.com/c/uploads/2022/10/nc-talk-icon-blue.svg)](https://nextcloud.com/blog/nextcloud-talk-our-open-source-answer-to-microsoft-teams/ "The open source answer to Microsoft Teams")

[The **open source answer** to Microsoft Teams](https://nextcloud.com/blog/nextcloud-talk-our-open-source-answer-to-microsoft-teams/ "The open source answer to Microsoft Teams")

[Learn more](https://nextcloud.com/blog/nextcloud-talk-our-open-source-answer-to-microsoft-teams/ "The open source answer to Microsoft Teams")

[![Nextcloud logo](https://nextcloud.com/c/uploads/2023/02/logo_nextcloud_white.svg)](https://nextcloud.com/ "Nextcloud")

* Products
  + [![Nextcloud Hub](https://nextcloud.com/c/uploads/2024/02/nc-hub-icons-square.svg)Nextcloud Hub](https://nextcloud.com/hub/)
    - [![Nextcloud Files](https://nextcloud.com/c/uploads/2022/09/nc-files-icon.svg)Nextcloud FilesFile Sync and Share](https://nextcloud.com/files/)
    - [![Nextcloud Talk](https://nextcloud.com/c/uploads/2022/10/nc-talk-icon-blue.svg)Nextcloud TalkCalls, chat and video conferencing](https://nextcloud.com/talk/)
    - [![Nextcloud Groupware](https://nextcloud.com/c/uploads/2022/10/nc-groupware-icon-blue.svg)Nextcloud GroupwareCalendar, Contacts & Mail](https://nextcloud.com/groupware/)
    - [![Nextcloud Office](https://nextcloud.com/c/uploads/Nextcloud-Office-icon.svg)Nextcloud OfficeReal time document collaboration](https://nextcloud.com/office/ "Nextcloud Office")
    - [![Nextcloud Assistant](https://nextcloud.com/c/uploads/2024/06/assistant-logo-blue.svg)Nextcloud AssistantPrivate and local AI assistant](https://nextcloud.com/assistant/)
  + [![Roundcube](https://nextcloud.com/c/uploads/2024/08/Roundcube_logo_icon.svg)RoundcubeThe most popular on premise webmail](https://nextcloud.com/roundcube/)
  + [![Microsoft integrations](https://nextcloud.com/c/uploads/2024/12/Microsoft_logo-blue.svg)Microsoft integrationsOutlook, Sharepoint, Teams and more](https://nextcloud.com/microsoft-integrations/)
* Solutions
  + [![Nextcloud Enterprise](https://nextcloud.com/c/uploads/2022/10/nc-enterprise-icon.svg)Nextcloud EnterpriseFor mission-critical use](https://nextcloud.com/enterprise/)
    - [![Public sector](https://nextcloud.com/c/uploads/2023/01/nc-government-blue-icon.svg)Public sectorEnterprise for the public sector](https://nextcloud.com/government/)
    - [![Enterprises](https://nextcloud.com/c/uploads/2024/12/nc-enterprises-blue-icon-3.svg)EnterprisesEnterprise for organizations](https://nextcloud.com/enterprises/)
    - [![Service providers](https://nextcloud.com/c/uploads/2023/01/nc-service-providers-blue-icon.svg)Service providersEnterprise for service providers](https://nextcloud.com/service-providers/)
    - [![Education](https://nextcloud.com/c/uploads/2023/01/nc-education-blue-icon.svg)EducationEnterprise for universities and schools](https://nextcloud.com/education/)
    - [![Pricing](https://nextcloud.com/c/uploads/2024/12/pricing-tags-icon.svg)PricingNextcloud Enterprise plans and pricing](https://nextcloud.com/pricing/ "Pricing")
  + [![Nextcloud at home](https://nextcloud.com/c/uploads/2022/10/nc-icon-at-home.svg)Nextcloud at homeFor families, students & you](https://nextcloud.com/athome/)
* Resources
  + Col1
    - [![Blog](https://nextcloud.com/c/uploads/2024/12/bullhorn-solid.svg)BlogNextcloud news and articles](https://nextcloud.com/blog/)
    - [![Events](https://nextcloud.com/c/uploads/2024/12/NC-events-icon.svg)EventsAll in-person and virtual Nextcloud events](https://nextcloud.com/events/)
    - [![Webinars](https://nextcloud.com/c/uploads/2024/12/NC-webinar-icon-blue.svg)WebinarsAll upcoming webinars and recordings](https://nextcloud.com/webinars/)
    - [![Success stories](https://nextcloud.com/c/uploads/2024/12/nc-success-stories-icon.svg)Success storiesSuccess stories and case studies](https://nextcloud.com/whitepapers/)
    - [![Whitepapers](https://nextcloud.com/c/uploads/2024/12/nc-whitepapers-icon-blue.svg)WhitepapersDownload our whitepapers](https://nextcloud.com/whitepapers/#whitepapers)
    - [![Data sheets](https://nextcloud.com/c/uploads/2024/02/data-sheets-icon-1.svg)Data sheetsSee all data sheets](https://nextcloud.com/whitepapers/#data-sheets)
    - [![Podcast](https://nextcloud.com/c/uploads/2024/12/NC-podcast-icon.svg)PodcastLatest Nextcloud Podcast episodes](https://nextcloud.com/podcast/)
  + Col2
    - Featured276209[![Nextcloud powering the digital workspace of tomorrow - 2024 in review](https://nextcloud.com/c/uploads/2024/12/Nextcloud-powering-the-digital-workspace-of-tomorrow-2024-in-review-1024x576.png)](https://nextcloud.com/blog/nextcloud-2024-wrap-up/?ref=top_megamenu_preview "Nextcloud powering the digital workspace of tomorrow: 2024 in review")[Featured blog
      #### Nextcloud powering the digital workspace of tomorrow: 2024 in review](https://nextcloud.com/blog/nextcloud-2024-wrap-up/?ref=top_megamenu_preview "Nextcloud powering the digital workspace of tomorrow: 2024 in review")
      * Blog, Community, General[All news and articles](https://nextcloud.com/blog/)
    - [![Features](https://nextcloud.com/c/uploads/2024/12/nc-features-icon.svg)FeaturesA complete list of features](https://nextcloud.com/features/)
    - [![App Store](https://nextcloud.com/c/uploads/2022/08/nextcloud-logo-icon.svg)App StoreHundreds of Nextcloud apps](https://apps.nextcloud.com/)
    - [![Documentation](https://nextcloud.com/c/uploads/2023/01/nc-education-blue-icon.svg)DocumentationAdmin, user and developer manuals](https://nextcloud.com/support/)
    - [![FAQ](https://nextcloud.com/c/uploads/2024/12/NC-faq-icon-2-1.svg)FAQNextcloud Enterprise FAQ](https://nextcloud.com/faq/)
    - [![Support Portal](https://nextcloud.com/c/uploads/2024/12/NC-customer-support-portal-icon.svg)Support PortalCustomer access to Enterprise support](https://portal.nextcloud.com/)
* Community
  + [How to contribute](https://nextcloud.com/contribute/)
  + [Code on GitHub](https://github.com/nextcloud)
  + [Report a bug](https://github.com/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fserver%2Fissues%2Fnew%2Fchoose)
  + [Community support](https://help.nextcloud.com/)
  + [Developer program](https://nextcloud.com/developer/)
  + [Code of Conduct](https://nextcloud.com/contribute/code-of-conduct/)
  + [Nextcloud Include](https://nextcloud.com/include/)
  + [Migration](https://nextcloud.com/migration/)
* [About](https://nextcloud.com/about/)
  + [About us](https://nextcloud.com/about/)
  + [Comparison with others](https://nextcloud.com/compare/)
  + [Press](https://nextcloud.com/press/)
  + [Security](https://nextcloud.com/security/)
  + [Team](https://nextcloud.com/team/)
  + [Jobs](https://nextcloud.com/jobs/)
  + [Partners](https://nextcloud.com/partners/)
  + [Search our site](https://nextcloud.com/search/)
* [Instant trial](https://nextcloud.com/instant-trial/)
* [Download](https://nextcloud.com/install/)
  + [![Desktop & mobile apps](https://nextcloud.com/c/uploads/2024/02/nc-clients-icon-blue.svg)Desktop & mobile appsWindows , macOS, Linux, Android, iOS](https://nextcloud.com/install/#install-clients "Desktop & mobile apps")
  + [![Nextcloud server](https://nextcloud.com/c/uploads/2024/02/nc-gear-icon-blue.svg)Nextcloud serverFor self-hosting on your server](https://nextcloud.com/install/#instructions-server "Nextcloud server")
  + [![Sign up now](https://nextcloud.com/c/uploads/2024/02/nc-pencil-icon-blue.svg)Sign up nowGet free account at a provider](https://nextcloud.com/sign-up/ "Sign up now")
* [![](https://nextcloud.com/c/uploads/flags/Flag_of_the_United_Kingdom.svg)English](https://nextcloud.com/security/ "English")
  + [![](https://nextcloud.com/p/sitepress-multilingual-cms/res/flags/fr.png)Français](https://nextcloud.com/fr/security/ "Français")
  + [![](https://nextcloud.com/p/sitepress-multilingual-cms/res/flags/de.png)Deutsch](https://nextcloud.com/de/security/ "Deutsch")
  + [![](https://nextcloud.com/p/sitepress-multilingual-cms/res/flags/es.png)Español](https://nextcloud.com/es/security/ "Español")
  + [![](https://nextcloud.com/p/sitepress-multilingual-cms/res/flags/it.png)Italiano](https://nextcloud.com/it/security/ "Italiano")

# Security and advisories

This page hosts our security policies and information with regards to reporting security flaws.

Nextcloud security

## Security in Nextcloud

Nextcloud is designed to offer the best security in the on premise content collaboration industry. Read more about the security features and our development process.

[More about security](https://nextcloud.com/secure/ "More about security")[#### Server owners

#####

For server owners, our documentation has a section with best practices and tips on securing a Nextcloud server.See more](https://docs.nextcloud.com/server/latest/admin_manual/installation/harden_server.html "best practices and tips on securing a Nextcloud server")  [Security advisories](https://github.com/nextcloud/security-advisories/security/advisories "Security advisories") [Official CVE database](https://www.cvedetails.com/vendor/15913/Nextcloud.html "See a full list of historic advisories in the CVE database.")[Threat model](https://nextcloud.com/security/threat-model/ "Threat model")
## Report a security issue

If you have discovered a security issue with Nextcloud, please read our responsible

disclosure guidelines and contact us at [**hackerone.com/nextcloud**](https://hackerone.com/nextcloud).

Your report should include:

#### Product version

#### A vulnerability description

#### Reproduction steps

### What happens next

A member of the security team will confirm the vulnerability, determine its impact, and develop a fix.

The fix will be applied to the master branch, tested, and packaged in the next security release.

The vulnerability will be publicly announced after the release.

Finally, your name will be added to the [hall of fame](https://hackerone.com/nextcloud/thanks) as a thank you from the entire Nextcloud community.

[Read our threat model](https://nextcloud.com/security/threat-model/) to know what is expected behavior.

## PGP Key for Submissions

In order to facilitate secure submission of security issues,

we provide the following [PGP key](https://pgp.mit.edu/pks/lookup?op=get&search=0xD75899B9A724937A) for confidential submission:

#### Key ID

`A724937A`

#### Fingerprint

`2880 6A87 8AE4 23A2 8372 792E D758 99B9 A724 937A`

We do however recommend to not encrypt the information submitted

via HackerOne as only a small subset of the team has access to this key.

Guidelines

## Responsible disclosure guidelines

The Nextcloud community kindly requests that you comply with the following guidelines when researching and reporting security vulnerabilities:

* Only test for vulnerabilities on your own install of Nextcloud Server
* Confirm the vulnerability applies to a supported product version
* Share vulnerabilities in detail only with the security team
* Allow reasonable time for a response from the security team
* Do not publish information related to the vulnerability until Nextcloud has made an announcement to the community

## Get started now

Reduce compliance risks, improve internal collaboration and reduce

operational expenses with the leading content collaboration platform.

Contact us now to learn how Nextcloud can help you!

 [Get a quote](https://nextcloud.com/get-a-quote/) Talk to us [Newsletter](https://nextcloud.com/newsletter/)
![Nextcloud Logo](https://nextcloud.com/c/uploads/2022/08/nextcloud-logo-icon.svg "Nextcloud Logo")

## Supported Product Versions

#### Nextcloud Server

* 30.0.0 (latest release)
* 29.0.x
* 28.0.x

You will find our Maintenance and Release Schedule [on GitHub](https://github.com/nextcloud/server/wiki/Maintenance-and-Release-Schedule). Please have a close look into the End of Life-section. Note that the Github page has the authoritative list of supported releases – the list above is manually maintained and thus occasionally outdated.

If you want to continue to use versions, which reached their End of Life, please [contact Nextcloud sales](https://nextcloud.com/enterprise/buy/) to get access to our Long Term Support offering.

#### Nextcloud Desktop Clients

[![Nextcloud Logo](https://nextcloud.com/c/uploads/2022/11/logo_nextcloud_white.svg)
#### Latest release on our download servers](https://download.nextcloud.com/desktop/releases/ "Latest release on our download servers")
#### Nextcloud Android Clients

[![Nextcloud Files](https://nextcloud.com/c/uploads/2022/09/nc-files-icon-white.svg)
#### Latest release of Nextcloud Files in the Google Play Store](https://play.google.com/store/apps/details?id=com.nextcloud.client "Latest release of Nextcloud Files in the Google Play Store")[![Nextcloud Talk](https://nextcloud.com/c/uploads/2022/09/nc-talk-icon.svg)
#### Latest release of Nextcloud Talk in the Google Play Store](https://play.google.com/store/apps/details?id=com.nextcloud.talk2 "Latest release of Nextcloud Talk in the Google Play Store")
#### Nextcloud iOS Clients

[![Nextcloud Files](https://nextcloud.com/c/uploads/2022/09/nc-files-icon-white.svg)
#### Latest release of Nextcloud Files in the App Store](https://itunes.apple.com/app/nextcloud/id1125420102?mt=8 "Latest release of Nextcloud Files in the App Store")[![Nextcloud Talk](https://nextcloud.com/c/uploads/2022/09/nc-talk-icon.svg)
#### Latest release of Nextcloud Talk in the App Store](https://itunes.apple.com/app/nextcloud-talk/id1296825574?mt=8 "Latest release of Nextcloud Talk in the App Store")

![Logo Nextcloud white](https://nextcloud.com/c/uploads/2022/11/logo_nextcloud_white.svg)

Nextcloud offers a modern, on premise content collaboration platform with real-time document editing, video chat & groupware on mobile, desktop and web.

### Search

Search:

* About Nextcloud
  + [About us](https://nextcloud.com/about/)
  + [Jobs](https://nextcloud.com/jobs/)
  + [Code of conduct](https://nextcloud.com/contribute/code-of-conduct/)
  + [Privacy](https://nextcloud.com/privacy/)
  + [Press](https://nextcloud.com/press/)
  + [Legal note](https://nextcloud.com/impressum/)
  + [Trademarks](https://nextcloud.com/trademarks/)
  + [Brand guidelines](https://nextcloud.com/brand/)
  + [Features](https://nextcloud.com/features/ "Nextcloud features")
  + [Human Rights Policy](https://nextcloud.com/human-rights-policy/)
  + [Code of Ethics](https://nextcloud.com/code-of-ethics/)
* Resources
  + [Download](https://nextcloud.com/install/)
  + [App Store](https://apps.nextcloud.com)
  + [Admin manual](https://docs.nextcloud.com/server/latest/admin_manual/)
  + [User manual](https://docs.nextcloud.com/server/latest/user_manual/)
  + [Security](https://nextcloud.com/security/)
  + [Developer information](https://nextcloud.com/developer/)
  + [Code on GitHub](https://github.com/nextcloud)
  + [Compare with others](https://nextcloud.com/compare/)
  + [Search](https://nextcloud.com/search/)
* Interact
  + [Support](https://nextcloud.com/support/)
  + [Forums](https://help.nextcloud.com)
  + [Demo](https://nextcloud.com/instant-trial/)
  + [Contact us](https://nextcloud.com/contact/)
  + [Bug Tracker](https://github.com/nextcloud)

* Cookies preferences
* [![Facebook](https://nextcloud.com/c/uploads/2021/12/facebook-icon.png)](https://www.facebook.com/Nextclouders/ "Facebook")
* [![X](https://nextcloud.com/c/uploads/2024/01/X_logo_2023_white.svg)](https://twitter.com/nextclouders "X")
* [![Instagram](https://nextcloud.com/c/uploads/2021/12/instagram-icon.png)](https://www.instagram.com/nextclouders/ "Instagram")
* [![Linkedin](https://nextcloud.com/c/uploads/2021/12/linkedin-icon.png)](https://www.linkedin.com/company/10827569/ "Linkedin")
* [![Nextcloud Forum](https://nextcloud.com/c/uploads/2022/06/discourse.png)](https://help.nextcloud.com/ "Nextcloud Forum")
* [![Youtube](https://nextcloud.com/c/uploads/2021/12/youtube-icon.png)](https://youtube.com/nextcloud "Youtube")
* [![Mastodon](https://nextcloud.com/c/uploads/2022/11/Mastodon_icon-white.svg)](https://mastodon.xyz/%40nextcloud "Mastodon")
* [![RSS Feed](https://nextcloud.com/c/uploads/2023/01/RSS-feed-icon-white.svg)](https://nextcloud.com/feed/ "RSS Feed")

© 2021 - 2025 Nextcloud GmbH

![Nextcloud](https://nextcloud.com/wp-content/uploads/2022/10/nextcloud-logo-blue-transparent.svg "Nextcloud")

We save some cookies to count visitors and make the site easier to use. This doesn't leave our server and isn't to track you personally!
See our [Privacy Policy](/privacy/) for more information. [Customize](#no_scroll)

Accept all cookies

Reject all

[Customize](#no_scroll)

Essentials More details

Essential cookies enable basic functions and are necessary for the proper function of the website.

Cookie name:wp-wpml\_current\_language
Cookie description:Set the language on the website
Cookie expiry:No expiration
Consent

Cookie name:nc\_cookie\_banner
Cookie description:Saves the cookie containing the user cookies preferences
Cookie expiry:30 days
Consent

Convenience More details

Cookies used to save the data entered in forms, such as name, email, phone number, and preferred language.

Cookie name:nc\_form\_fields
Cookie description:Remembers the data filled in the forms for the next time (name, email, phone and preferred language)
Cookie expiry:30 days
Consent

Statistics More details

Statistics cookies collect information anonymously and help us understand how our visitors use our website. We use cloud-hosted [Matomo](https://matomo.org/matomo-cloud/)

Service:Matomo
Cookies description:
\_pk\_ses\*: Counts the first visit of the user

\_pk\_id\*: Helps not to double count the visits.

mtm\_cookie\_consent: Remembers that consent for storing and using cookies was given by the user.
Cookies expiry:\_pk\_ses\*: 30 minutes

\_pk\_id\*: 28 days

mtm\_cookie\_consent: 30 days
Consent

External media More details

Allows connections for loading external media. No cookies from Youtube or Vimeo will be set.

Service:Play Youtube videos
Service description:
All of the Youtube videos get unblocked if this setting is saved
Cookie expiry: -
Consent

Service:Play Vimeo videos
Service description:
All of the Vimeo videos get unblocked if this setting is saved
Cookie expiry: -
Consent



=== Content from github.com_2a2378f7_20250125_082736.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fowncloud-archive%2Fapps%2Fcommit%2F16cbccfc946c8711721fa684d78135ca1fb64791)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fowncloud-archive%2Fapps%2Fcommit%2F16cbccfc946c8711721fa684d78135ca1fb64791)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=owncloud-archive%2Fapps)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 14, 2018. It is now read-only.

[owncloud-archive](/owncloud-archive)
/
**[apps](/owncloud-archive/apps)**
Public archive

* [Notifications](/login?return_to=%2Fowncloud-archive%2Fapps) You must be signed in to change notification settings
* [Fork
  336](/login?return_to=%2Fowncloud-archive%2Fapps)
* [Star
   372](/login?return_to=%2Fowncloud-archive%2Fapps)

* [Code](/owncloud-archive/apps)
* [Issues
  183](/owncloud-archive/apps/issues)
* [Pull requests
  3](/owncloud-archive/apps/pulls)
* [Actions](/owncloud-archive/apps/actions)
* [Projects
  0](/owncloud-archive/apps/projects)
* [Security](/owncloud-archive/apps/security)
* [Insights](/owncloud-archive/apps/pulse)

Additional navigation options

* [Code](/owncloud-archive/apps)
* [Issues](/owncloud-archive/apps/issues)
* [Pull requests](/owncloud-archive/apps/pulls)
* [Actions](/owncloud-archive/apps/actions)
* [Projects](/owncloud-archive/apps/projects)
* [Security](/owncloud-archive/apps/security)
* [Insights](/owncloud-archive/apps/pulse)

## Commit

[Permalink](/owncloud-archive/apps/commit/16cbccfc946c8711721fa684d78135ca1fb64791)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[stable9] Merge pull request [#2198](https://github.com/owncloud-archive/apps/pull/2198) from owncloud/smb-auth-fix

[Browse files](/owncloud-archive/apps/tree/16cbccfc946c8711721fa684d78135ca1fb64791)
Browse the repository at this point in the history

```
Double verify the SMB response
```

* Loading branch information

[![@DeepDiver1975](https://avatars.githubusercontent.com/u/1005065?s=40&v=4)](/DeepDiver1975)

[DeepDiver1975](/owncloud-archive/apps/commits?author=DeepDiver1975 "View all commits by DeepDiver1975")
committed
Oct 13, 2016

1 parent
[f101d84](/owncloud-archive/apps/commit/f101d8498ffac83924f3bd7acdda7ff181fd662c)

commit 16cbccf

Showing
**1 changed file**
with
**32 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

43 changes: 32 additions & 11 deletions

43
[user\_external/lib/smb.php](#diff-ff8192ea7a5c6499fa9f662e1dc49bdf5b3d96d077a3845b14edd43681e0cf15 "user_external/lib/smb.php")

Show comments

[View file](/owncloud-archive/apps/blob/16cbccfc946c8711721fa684d78135ca1fb64791/user_external/lib/smb.php)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,18 +32,14 @@ public function \_\_construct($host) { |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \* @param string $uid |
|  |  | \* @param string $password |
|  |  | \* @return bool |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | $uidEscaped=escapeshellarg($uid); |
|  |  | $password=escapeshellarg($password); |
|  |  | $result=array(); |
|  |  | $command=self::SMBCLIENT.' //'.$this->host.'/dummy -U'.$uidEscaped.'%'.$password; |
|  |  | private function tryAuthentication($uid, $password) { |
|  |  | $uidEscaped = escapeshellarg($uid); |
|  |  | $password = escapeshellarg($password); |
|  |  | $command = self::SMBCLIENT.' '.escapeshellarg('//' . $this->host . '/dummy').' -U'.$uidEscaped.'%'.$password; |
|  |  | $lastline = exec($command, $output, $retval); |
|  |  | if ($retval === 127) { |
|  |  | OCP\Util::writeLog( |
| Expand All | | @@ -66,8 +62,33 @@ public function checkPassword($uid, $password) { |
|  |  | return false; |
|  |  | } else { |
|  |  | login: |
|  |  | return $uid; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | // Check with an invalid password, if the user authenticates then fail |
|  |  | $attemptWithInvalidPassword = $this->tryAuthentication($uid, base64\_encode($password)); |
|  |  | if(is\_string($attemptWithInvalidPassword)) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | // Check with valid password |
|  |  | $attemptWithValidPassword = $this->tryAuthentication($uid, $password); |
|  |  | if(is\_string($attemptWithValidPassword)) { |
|  |  | $this->storeUser($uid); |
|  |  | return $uid; |
|  |  | } |
|  |  |  |
|  |  | return false; |
|  |  | } |
|  |  | } |
|  |  |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `16cbccf`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fowncloud-archive%2Fapps%2Fcommit%2F16cbccfc946c8711721fa684d78135ca1fb64791) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0a32a72a_20250125_082737.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fowncloud-archive%2Fapps%2Fcommit%2F5d47e7b52646cf79edadd78ce10c754290cbb732)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fowncloud-archive%2Fapps%2Fcommit%2F5d47e7b52646cf79edadd78ce10c754290cbb732)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=owncloud-archive%2Fapps)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Nov 14, 2018. It is now read-only.

[owncloud-archive](/owncloud-archive)
/
**[apps](/owncloud-archive/apps)**
Public archive

* [Notifications](/login?return_to=%2Fowncloud-archive%2Fapps) You must be signed in to change notification settings
* [Fork
  336](/login?return_to=%2Fowncloud-archive%2Fapps)
* [Star
   372](/login?return_to=%2Fowncloud-archive%2Fapps)

* [Code](/owncloud-archive/apps)
* [Issues
  183](/owncloud-archive/apps/issues)
* [Pull requests
  3](/owncloud-archive/apps/pulls)
* [Actions](/owncloud-archive/apps/actions)
* [Projects
  0](/owncloud-archive/apps/projects)
* [Security](/owncloud-archive/apps/security)
* [Insights](/owncloud-archive/apps/pulse)

Additional navigation options

* [Code](/owncloud-archive/apps)
* [Issues](/owncloud-archive/apps/issues)
* [Pull requests](/owncloud-archive/apps/pulls)
* [Actions](/owncloud-archive/apps/actions)
* [Projects](/owncloud-archive/apps/projects)
* [Security](/owncloud-archive/apps/security)
* [Insights](/owncloud-archive/apps/pulse)

## Commit

[Permalink](/owncloud-archive/apps/commit/5d47e7b52646cf79edadd78ce10c754290cbb732)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#2198](https://github.com/owncloud-archive/apps/pull/2198) from owncloud/smb-auth-fix

[Browse files](/owncloud-archive/apps/tree/5d47e7b52646cf79edadd78ce10c754290cbb732)
Browse the repository at this point in the history

```
Double verify the SMB response
```

* Loading branch information

[![@DeepDiver1975](https://avatars.githubusercontent.com/u/1005065?s=40&v=4)](/DeepDiver1975)

[DeepDiver1975](/owncloud-archive/apps/commits?author=DeepDiver1975 "View all commits by DeepDiver1975")
committed
Sep 19, 2016

1 parent
[3b2712f](/owncloud-archive/apps/commit/3b2712fc761d3c39b736f918e632d48c7689f6b8)

commit 5d47e7b

Showing
**1 changed file**
with
**32 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

43 changes: 32 additions & 11 deletions

43
[user\_external/lib/smb.php](#diff-ff8192ea7a5c6499fa9f662e1dc49bdf5b3d96d077a3845b14edd43681e0cf15 "user_external/lib/smb.php")

Show comments

[View file](/owncloud-archive/apps/blob/5d47e7b52646cf79edadd78ce10c754290cbb732/user_external/lib/smb.php)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,18 +32,14 @@ public function \_\_construct($host) { |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \* @param string $uid |
|  |  | \* @param string $password |
|  |  | \* @return bool |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | $uidEscaped=escapeshellarg($uid); |
|  |  | $password=escapeshellarg($password); |
|  |  | $result=array(); |
|  |  | $command=self::SMBCLIENT.' //'.$this->host.'/dummy -U'.$uidEscaped.'%'.$password; |
|  |  | private function tryAuthentication($uid, $password) { |
|  |  | $uidEscaped = escapeshellarg($uid); |
|  |  | $password = escapeshellarg($password); |
|  |  | $command = self::SMBCLIENT.' '.escapeshellarg('//' . $this->host . '/dummy').' -U'.$uidEscaped.'%'.$password; |
|  |  | $lastline = exec($command, $output, $retval); |
|  |  | if ($retval === 127) { |
|  |  | OCP\Util::writeLog( |
| Expand All | | @@ -66,8 +62,33 @@ public function checkPassword($uid, $password) { |
|  |  | return false; |
|  |  | } else { |
|  |  | login: |
|  |  | return $uid; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | // Check with an invalid password, if the user authenticates then fail |
|  |  | $attemptWithInvalidPassword = $this->tryAuthentication($uid, base64\_encode($password)); |
|  |  | if(is\_string($attemptWithInvalidPassword)) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | // Check with valid password |
|  |  | $attemptWithValidPassword = $this->tryAuthentication($uid, $password); |
|  |  | if(is\_string($attemptWithValidPassword)) { |
|  |  | $this->storeUser($uid); |
|  |  | return $uid; |
|  |  | } |
|  |  |  |
|  |  | return false; |
|  |  | } |
|  |  | } |
|  |  |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5d47e7b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fowncloud-archive%2Fapps%2Fcommit%2F5d47e7b52646cf79edadd78ce10c754290cbb732) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c3bdd2d6_20250125_082734.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fapps%2Fcommit%2Fb85ace6840b8a6704641086bc3b8eb8e81cb2274)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fapps%2Fcommit%2Fb85ace6840b8a6704641086bc3b8eb8e81cb2274)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nextcloud%2Fapps)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Oct 26, 2019. It is now read-only.

[nextcloud](/nextcloud)
/
**[apps](/nextcloud/apps)**
Public archive

* [Notifications](/login?return_to=%2Fnextcloud%2Fapps) You must be signed in to change notification settings
* [Fork
  29](/login?return_to=%2Fnextcloud%2Fapps)
* [Star
   11](/login?return_to=%2Fnextcloud%2Fapps)

* [Code](/nextcloud/apps)
* [Issues
  0](/nextcloud/apps/issues)
* [Pull requests
  0](/nextcloud/apps/pulls)
* [Actions](/nextcloud/apps/actions)
* [Security](/nextcloud/apps/security)
* [Insights](/nextcloud/apps/pulse)

Additional navigation options

* [Code](/nextcloud/apps)
* [Issues](/nextcloud/apps/issues)
* [Pull requests](/nextcloud/apps/pulls)
* [Actions](/nextcloud/apps/actions)
* [Security](/nextcloud/apps/security)
* [Insights](/nextcloud/apps/pulse)

## Commit

[Permalink](/nextcloud/apps/commit/b85ace6840b8a6704641086bc3b8eb8e81cb2274)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Double verify the SMB response

[Browse files](/nextcloud/apps/tree/b85ace6840b8a6704641086bc3b8eb8e81cb2274)
Browse the repository at this point in the history

```
In case anonymous auth is allowed this can otherwise lead to unexpected actions.
```

* Loading branch information

[![@LukasReschke](https://avatars.githubusercontent.com/u/878997?s=40&v=4)](/LukasReschke)

[LukasReschke](/nextcloud/apps/commits?author=LukasReschke "View all commits by LukasReschke")
committed
Sep 9, 2016

1 parent
[a17a78b](/nextcloud/apps/commit/a17a78b0c503d39e0175c1e59c6013ec7145f934)

commit b85ace6

Showing
**1 changed file**
with
**32 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

43 changes: 32 additions & 11 deletions

43
[user\_external/lib/smb.php](#diff-ff8192ea7a5c6499fa9f662e1dc49bdf5b3d96d077a3845b14edd43681e0cf15 "user_external/lib/smb.php")

Show comments

[View file](/nextcloud/apps/blob/b85ace6840b8a6704641086bc3b8eb8e81cb2274/user_external/lib/smb.php)
Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,18 +32,14 @@ public function \_\_construct($host) { |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \* @param string $uid |
|  |  | \* @param string $password |
|  |  | \* @return bool |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | $uidEscaped=escapeshellarg($uid); |
|  |  | $password=escapeshellarg($password); |
|  |  | $result=array(); |
|  |  | $command=self::SMBCLIENT.' '.escapeshellarg('//' . $this->host . '/dummy').' -U'.$uidEscaped.'%'.$password; |
|  |  | private function tryAuthentication($uid, $password) { |
|  |  | $uidEscaped = escapeshellarg($uid); |
|  |  | $password = escapeshellarg($password); |
|  |  | $command = self::SMBCLIENT.' '.escapeshellarg('//' . $this->host . '/dummy').' -U'.$uidEscaped.'%'.$password; |
|  |  | $lastline = exec($command, $output, $retval); |
|  |  | if ($retval === 127) { |
|  |  | OCP\Util::writeLog( |
| Expand All | | @@ -66,8 +62,33 @@ public function checkPassword($uid, $password) { |
|  |  | return false; |
|  |  | } else { |
|  |  | login: |
|  |  | return $uid; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if the password is correct without logging in the user |
|  |  | \* |
|  |  | \* @param string $uid The username |
|  |  | \* @param string $password The password |
|  |  | \* |
|  |  | \* @return true/false |
|  |  | \*/ |
|  |  | public function checkPassword($uid, $password) { |
|  |  | // Check with an invalid password, if the user authenticates then fail |
|  |  | $attemptWithInvalidPassword = $this->tryAuthentication($uid, base64\_encode($password)); |
|  |  | if(is\_string($attemptWithInvalidPassword)) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | // Check with valid password |
|  |  | $attemptWithValidPassword = $this->tryAuthentication($uid, $password); |
|  |  | if(is\_string($attemptWithValidPassword)) { |
|  |  | $this->storeUser($uid); |
|  |  | return $uid; |
|  |  | } |
|  |  |  |
|  |  | return false; |
|  |  | } |
|  |  | } |
|  |  |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b85ace6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fapps%2Fcommit%2Fb85ace6840b8a6704641086bc3b8eb8e81cb2274) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


