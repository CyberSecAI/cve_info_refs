```
{
  "vulnerability": {
    "root_cause": "The `rollback` function in `apps/files_versions/lib/storage.php` does not properly check if a user has update permissions before attempting to revert a file to a previous version.",
    "weaknesses": [
      "Missing authorization check before performing a file rollback operation."
    ],
    "impact": "A user with read permissions to a file (e.g., through sharing) could potentially trigger a rollback operation, potentially overwriting the current file with an older version, which can result in data loss or corruption.",
    "attack_vectors": "An attacker with read-only permissions to a file can send a crafted request to revert the file to a specific version. This is possible even if the user does not have the permissions to modify the file.",
    "required_capabilities": "Attacker must be a user with read-only permissions to a file, potentially through a share."
  },
  "commits": [
    {
      "commit_id": "23383080731d092e079986464a8c4c9ffcb79f4c",
      "files_changed": [
        {
          "file_path": "apps/files_versions/lib/storage.php",
          "changes": "The commit adds a leading slash to the file path before processing it."
        },
        {
          "file_path": "apps/files_versions/tests/versions.php",
           "changes": "The commit adds a test case to verify that users with only read permissions can't revert a file."
        }
      ]
    },
      {
      "commit_id": "d31720b6f1e8c8dfeb5e8805ab35ad7c8000b2f1",
       "files_changed": [
        {
          "file_path": "apps/files_versions/lib/storage.php",
          "changes": "The commit adds a leading slash to the file path before processing it."
        },
          {
          "file_path": "apps/files_versions/tests/versions.php",
          "changes": "This commit enhances the tests to check version creation when overwriting as an owner, recipient, and anonymously. It also adds a test for restoring a file without permission."
        }
      ]
    },
    {
      "commit_id": "3b056fa68ce502ceb0db9b446dab3b9e7b10dd13",
      "files_changed": [
        {
          "file_path": "apps/files_versions/js/versionstabview.js",
          "changes": "The commit modifies the error handling to ensure the loading state is correctly handled and to display a more user-friendly error message."
        },
        {
          "file_path": "apps/files_versions/lib/storage.php",
           "changes": "The commit adds a leading slash to the file path before processing it."
        },
        {
           "file_path": "apps/files_versions/tests/js/versionstabviewSpec.js",
            "changes": "This commit modifies the test case to verify that the revert button is not rendered when the user does not have update permissions."
        },
        {
          "file_path": "apps/files_versions/tests/versions.php",
           "changes": "This commit adds checks for the rollback hook."
         }
      ]
    },
    {
      "commit_id": "1208953ba1d4d55a18a639846bbcdd66a2d5bc5e",
      "files_changed": [
        {
          "file_path": "apps/files_versions/lib/storage.php",
          "changes":"The commit adds a permission check before allowing a file rollback operation, preventing unauthorized users from reverting files"
        }
      ]
    },
    {
       "commit_id":"c93eca49c32428ece03dd67042772d5fa62c8d6e",
        "files_changed": [
        {
           "file_path": "apps/files_versions/js/versionstabview.js",
           "changes": "The commit modifies the error handling to ensure the loading state is correctly handled and to display a more user-friendly error message."
        },
         {
          "file_path": "apps/files_versions/lib/storage.php",
            "changes":"The commit adds a leading slash to the file path before processing it."
          },
        {
           "file_path": "apps/files_versions/tests/js/versionstabviewSpec.js",
            "changes": "This commit modifies the test case to verify that the revert button is not rendered when the user does not have update permissions."
        },
        {
          "file_path":"apps/files_versions/tests/versions.php",
          "changes": "This commit ensures that a user with only read permissions (such as through a share) cannot restore a file to a previous version"
        }
      ]
    }
  ]
}
```