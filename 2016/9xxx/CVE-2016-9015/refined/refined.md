- **Root cause of vulnerability:** A refactor in the PyOpenSSL contrib module of the urllib3 library accidentally removed the mapping of Python's standard library certificate verification constants to OpenSSL verification mode flags. This caused Python standard library constants to be passed directly to OpenSSL, which interprets them differently, leading to incorrect certificate validation.

- **Weaknesses/vulnerabilities present:** Incorrect mapping of Python's ssl.CERT_REQUIRED (value 2) to OpenSSL's verification flags. OpenSSL 1.1.0 interprets the value 2 as SSL_VERIFY_FAIL_IF_NO_PEER_CERT which, by itself, does not enforce peer certificate verification in client mode, effectively disabling certificate validation. In previous versions of OpenSSL, any non-zero value would have been treated as requiring certificate verification, hiding the issue.

- **Impact of exploitation:** Users of urllib3 with PyOpenSSL support and OpenSSL 1.1.0 would not have their TLS certificates correctly validated which puts them at risk of man-in-the-middle attacks, and information leakage.

- **Attack vectors:** Man-in-the-middle attack where an attacker could present a malicious certificate which would be incorrectly accepted, as certificate validation is effectively disabled.

- **Required attacker capabilities/position:** The attacker needs to be in a position to intercept and modify network traffic between the client using the vulnerable urllib3 configuration and the server it is trying to connect to. They would also need to be able to forge a TLS certificate.

- **Additional information:**
    - The vulnerability only affects a specific combination of urllib3 versions (1.17 and 1.18), PyOpenSSL, and OpenSSL 1.1.0.
    - The vulnerability was introduced in a refactor.
    - OpenSSL changed their behavior in 1.1.0 and did not report the invalid flag combination.
    - The fix involves reintroducing a mapping between Python standard library constants and OpenSSL verification flags.
    - The issue was discovered by the urllib3 test suite, and was mitigated in version 1.18.1.