=== Content from security.gentoo.org_1305b977_20250126_001755.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Xen: Multiple vulnerabilities — GLSA **201612-56**

Multiple vulnerabilities have been found in Xen, the worst of which
could lead to the execution of arbitrary code on the host system.

### Affected packages

| Package | **app-emulation/xen** on all architectures |
| --- | --- |
| Affected versions | < **4.7.1-r4** |
| Unaffected versions | >= **4.7.1-r4** |

| Package | **app-emulation/xen-tools** on all architectures |
| --- | --- |
| Affected versions | < **4.7.1-r4** |
| Unaffected versions | >= **4.7.1-r4** |

| Package | **app-emulation/xen-pvgrub** on all architectures |
| --- | --- |
| Affected versions | < **4.7.1-r1** |
| Unaffected versions | >= **4.7.1-r1** |

### Background

Xen is a bare-metal hypervisor.

### Description

Multiple vulnerabilities have been discovered in Xen. Please review the
CVE identifiers referenced below for details.

### Impact

A local attacker could possibly execute arbitrary code with the
privileges of the process, could gain privileges on the host system,
cause a Denial of Service condition, or obtain sensitive information.

### Workaround

There is no known workaround at this time.

### Resolution

All Xen users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=app-emulation/xen-4.7.1-r4"

```

All Xen Tools users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose
 ">=app-emulation/xen-tools-4.7.1-r4"

```

All Xen PvGrub users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose
 ">=app-emulation/xen-pvgrub-4.7.1-r1"

```
### References

* [CVE-2016-10024](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-10024)
* [CVE-2016-9377](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9377)
* [CVE-2016-9378](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9378)
* [CVE-2016-9379](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9379)
* [CVE-2016-9380](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9380)
* [CVE-2016-9381](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9381)
* [CVE-2016-9382](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9382)
* [CVE-2016-9383](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9383)
* [CVE-2016-9384](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9384)
* [CVE-2016-9385](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9385)
* [CVE-2016-9386](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9386)
* [CVE-2016-9637](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9637)
* [CVE-2016-9815](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9815)
* [CVE-2016-9816](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9816)
* [CVE-2016-9817](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9817)
* [CVE-2016-9818](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9818)
* [CVE-2016-9932](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9932)

**Release date**

December 31, 2016

**Latest revision**

January 03, 2017: 2

**Severity**

normal

**Exploitable**

local

**Bugzilla entries**

* [600382](https://bugs.gentoo.org/show_bug.cgi?id=600382)
* [600662](https://bugs.gentoo.org/show_bug.cgi?id=600662)
* [601248](https://bugs.gentoo.org/show_bug.cgi?id=601248)
* [601250](https://bugs.gentoo.org/show_bug.cgi?id=601250)
* [601986](https://bugs.gentoo.org/show_bug.cgi?id=601986)
* [603420](https://bugs.gentoo.org/show_bug.cgi?id=603420)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from xenbits.xen.org_d2ef0bf3_20250126_001755.html ===
From 71096b016f7fd54a72af73576948cb25cf42ebcb Mon Sep 17 00:00:00 2001
From: Roger Pau MonnÃ© Date: Wed, 2 Nov 2016 15:02:00 +0000
Subject: [PATCH] libelf: fix stack memory leak when loading 32 bit symbol
tables
The 32 bit Elf structs are smaller than the 64 bit ones, which means that
when loading them there's some padding left uninitialized at the end of each
struct (because the size indicated in e\_ehsize and e\_shentsize is
smaller than the size of elf\_ehdr and elf\_shdr).
Fix this by introducing a new helper that is used to set
[caller\_]xdest\_{base/size} and that takes care of performing the appropriate
memset of the region. This newly introduced helper is then used to set and
unset xdest\_{base/size} in elf\_load\_bsdsyms. Now that the full struct
is zeroed, there's no need to specifically zero the undefined section.
This is XSA-194.
Suggested-by: Ian Jackson
Also remove the open coded (and redundant with the earlier
elf\_memset\_unchecked()) use of caller\_xdest\_\* from elf\_init().
Signed-off-by: Roger Pau MonnÃ©
Signed-off-by: Jan Beulich
Signed-off-by: Ian Jackson
---
xen/common/libelf/libelf-loader.c | 14 +++-----------
xen/common/libelf/libelf-tools.c | 11 +++++++++--
xen/include/xen/libelf.h | 15 +++++++++------
3 files changed, 21 insertions(+), 19 deletions(-)
diff --git a/xen/common/libelf/libelf-loader.c b/xen/common/libelf/libelf-loader.c
index 4d3ae4d..bc1f87b 100644
--- a/xen/common/libelf/libelf-loader.c
+++ b/xen/common/libelf/libelf-loader.c
@@ -43,8 +43,6 @@ elf\_errorstatus elf\_init(struct elf\_binary \*elf, const char \*image\_input, size\_t
elf->ehdr = ELF\_MAKE\_HANDLE(elf\_ehdr, (elf\_ptrval)image\_input);
elf->class = elf\_uval\_3264(elf, elf->ehdr, e32.e\_ident[EI\_CLASS]);
elf->data = elf\_uval\_3264(elf, elf->ehdr, e32.e\_ident[EI\_DATA]);
- elf->caller\_xdest\_base = NULL;
- elf->caller\_xdest\_size = 0;
/\* Sanity check phdr. \*/
offset = elf\_uval(elf, elf->ehdr, e\_phoff) +
@@ -284,9 +282,8 @@ do { \
#define SYMTAB\_INDEX 1
#define STRTAB\_INDEX 2
- /\* Allow elf\_memcpy\_safe to write to symbol\_header. \*/
- elf->caller\_xdest\_base = &header
- elf->caller\_xdest\_size = sizeof(header);
+ /\* Allow elf\_memcpy\_safe to write to header. \*/
+ elf\_set\_xdest(elf, &header, sizeof(header));
/\*
\* Calculate the position of the various elements in GUEST MEMORY SPACE.
@@ -319,11 +316,7 @@ do { \
elf\_store\_field\_bitness(elf, header\_handle, e\_phentsize, 0);
elf\_store\_field\_bitness(elf, header\_handle, e\_phnum, 0);
- /\* Zero the undefined section. \*/
- section\_handle = ELF\_MAKE\_HANDLE(elf\_shdr,
- ELF\_REALPTR2PTRVAL(&header.elf\_header.section[SHN\_UNDEF]));
shdr\_size = elf\_uval(elf, elf->ehdr, e\_shentsize);
- elf\_memset\_safe(elf, ELF\_HANDLE\_PTRVAL(section\_handle), 0, shdr\_size);
/\*
\* The symtab section header is going to reside in section[SYMTAB\_INDEX],
@@ -404,8 +397,7 @@ do { \
}
/\* Remove permissions from elf\_memcpy\_safe. \*/
- elf->caller\_xdest\_base = NULL;
- elf->caller\_xdest\_size = 0;
+ elf\_set\_xdest(elf, NULL, 0);
#undef SYMTAB\_INDEX
#undef STRTAB\_INDEX
diff --git a/xen/common/libelf/libelf-tools.c b/xen/common/libelf/libelf-tools.c
index 5a4757b..e73e729 100644
--- a/xen/common/libelf/libelf-tools.c
+++ b/xen/common/libelf/libelf-tools.c
@@ -59,8 +59,7 @@ bool elf\_access\_ok(struct elf\_binary \* elf,
return 1;
if ( elf\_ptrval\_in\_range(ptrval, size, elf->dest\_base, elf->dest\_size) )
return 1;
- if ( elf\_ptrval\_in\_range(ptrval, size,
- elf->caller\_xdest\_base, elf->caller\_xdest\_size) )
+ if ( elf\_ptrval\_in\_range(ptrval, size, elf->xdest\_base, elf->xdest\_size) )
return 1;
elf\_mark\_broken(elf, "out of range access");
return 0;
@@ -373,6 +372,14 @@ bool elf\_phdr\_is\_loadable(struct elf\_binary \*elf, ELF\_HANDLE\_DECL(elf\_phdr) phdr
return ((p\_type == PT\_LOAD) && (p\_flags & (PF\_R | PF\_W | PF\_X)) != 0);
}
+void elf\_set\_xdest(struct elf\_binary \*elf, void \*addr, uint64\_t size)
+{
+ elf->xdest\_base = addr;
+ elf->xdest\_size = size;
+ if ( addr != NULL )
+ elf\_memset\_safe(elf, ELF\_REALPTR2PTRVAL(addr), 0, size);
+}
+
/\*
\* Local variables:
\* mode: C
diff --git a/xen/include/xen/libelf.h b/xen/include/xen/libelf.h
index 95b5370..cf62bc7 100644
--- a/xen/include/xen/libelf.h
+++ b/xen/include/xen/libelf.h
@@ -210,13 +210,11 @@ struct elf\_binary {
uint64\_t bsd\_symtab\_pend;
/\*
- \* caller's other acceptable destination
- \*
- \* Again, these are trusted and must be valid (or 0) so long
- \* as the struct elf\_binary is in use.
+ \* caller's other acceptable destination.
+ \* Set by elf\_set\_xdest. Do not set these directly.
\*/
- void \*caller\_xdest\_base;
- uint64\_t caller\_xdest\_size;
+ void \*xdest\_base;
+ uint64\_t xdest\_size;
#ifndef \_\_XEN\_\_
/\* misc \*/
@@ -494,5 +492,10 @@ static inline void ELF\_ADVANCE\_DEST(struct elf\_binary \*elf, uint64\_t amount)
}
}
+/\* Specify a (single) additional destination, to which the image may
+ \* cause writes. As with dest\_base and dest\_size, the values provided
+ \* are trusted and must be valid so long as the struct elf\_binary
+ \* is in use or until elf\_set\_xdest(,0,0) is called. \*/
+void elf\_set\_xdest(struct elf\_binary \*elf, void \*addr, uint64\_t size);
#endif /\* \_\_XEN\_LIBELF\_H\_\_ \*/
--
2.1.4


=== Content from xenbits.xen.org_745df904_20250126_001755.html ===

# Information

| Advisory | [XSA-194](advisory-194.html) |
| --- | --- |
| Public release | 2016-11-22 12:00 |
| Updated | 2016-11-22 12:00 |
| Version | 3 |
| CVE(s) | [CVE-2016-9384](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9384) |
| Title | guest 32-bit ELF symbol table load leaking host data |

# Files

<advisory-194.txt> (signed advisory file)

<xsa194.patch>
# Advisory

---

```

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

            Xen Security Advisory CVE-2016-9384 / XSA-194
                              version 3

           guest 32-bit ELF symbol table load leaking host data

UPDATES IN VERSION 3
====================

Public release.

ISSUE DESCRIPTION
=================

Along with their main kernel binary, unprivileged guests may arrange
to have their Xen environment load (kernel) symbol tables for their
use.  The ELF image metadata created for this purpose has a few unused
bytes when the symbol table binary is in 32-bit ELF format.  These
unused bytes were not properly cleared during symbol table loading.

IMPACT
======

A malicious unprivileged guest may be able to obtain sensitive
information from the host.

The information leak is small and not under the control of the guest,
so effectively exploiting this vulnerability is probably difficult.

VULNERABLE SYSTEMS
==================

Only Xen version 4.7 is affected.  Xen versions 4.6 and earlier are not
affected.

The vulnerability is not exposed to x86 HVM guests, unless the host
toolstack has configured to load the guest with a non-default loader,
rather than hvmloader.

MITIGATION
==========

There is no known mitigation.

CREDITS
=======

This issue was discovered by Roger Pau Monné of Citrix.

RESOLUTION
==========

Applying the attached patch resolves this issue.

xsa194.patch           xen-unstable, Xen 4.7.x

$ sha256sum xsa194*
[4dad65417d9ff3c86e763d3c88cf8de79b58a9981d531f641ae0dd0dcedce911  xsa194.patch](xsa194.patch)
$

DEPLOYMENT DURING EMBARGO
=========================

Deployment of the patches and/or mitigations described above (or
others which are substantially similar) is permitted during the
embargo, even on public-facing systems with untrusted guest users and
administrators.

But: Distribution of updated software is prohibited (except to other
members of the predisclosure list).

Predisclosure list members who wish to deploy significantly different
patches and/or mitigations, please contact the Xen Project Security
Team.

(Note: this during-embargo deployment notice is retained in
post-embargo publicly released Xen Project advisories, even though it
is then no longer applicable.  This is to enable the community to have
oversight of the Xen Project Security Team's decisionmaking.)

For more information about permissible uses of embargoed information,
consult the Xen Project community's agreed Security Policy:
  <http://www.xenproject.org/security-policy.html>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJYNDLYAAoJEIP+FMlX6CvZqAoH/39GSWwDpYnflz3TcFyQUViM
j36XzzStWya71ewaXiguUbTHHg6mK47pK4EA/3zFwerczz/5yQzhlToitPkP/8WE
5Qbg9Wyg4STylzeKaiTvLzqUK6XSiJ4oKZwLsnU7tFPLcb6FBMm9t3bzg9NECaft
/6zYj1SVCvoLJB/gtgbwrz2MCjVZQZ9Q2+mpirvu0ePQRD73M0cwfj1ncqjUkFd9
ZNdk14gmxOk1/wWAm/oD1QKUWmjpzByT5dbGcMV3OxGs1V2Px+o4c1u1t/agldr0
wC2LvCK9IED9JcBaH/M85TTAGR7GqfU8l9x3ep97GkrUpquX4OGFt7na28M1YUQ=
=Gc8O
-----END PGP SIGNATURE-----

```

---

Xenproject.org Security Team

