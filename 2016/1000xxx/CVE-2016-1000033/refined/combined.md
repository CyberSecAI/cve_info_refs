=== Content from bugzilla.gnome.org_f6813124_20250125_025100.html ===


| GNOME Bugzilla â BugÂ 754488 | (DWF-2016-89001) Validate TLS certificates | Last modified: 2016-03-11 15:12:58 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)

After an [evaluation](https://wiki.gnome.org/Initiatives/DevelopmentInfrastructure), GNOME has moved from Bugzilla to [GitLab](https://gitlab.gnome.org/). [Learn more about GitLab](https://wiki.gnome.org/GitLab).
**No new issues can be reported in GNOME Bugzilla anymore.**

**To report an issue in a GNOME project, [go to GNOME GitLab](https://gitlab.gnome.org/GNOME)**.
Do **not** go to GNOME Gitlab for: [Bluefish](https://sourceforge.net/p/bluefish/tickets), [Doxygen](https://github.com/doxygen/doxygen/issues), [GnuCash](https://bugs.gnucash.org/), [GStreamer](https://gitlab.freedesktop.org/gstreamer/), [java-gnome](https://github.com/afcowie/java-gnome/issues), [LDTP](https://github.com/ldtp/ldtp2/issues), [NetworkManager](https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues), [Tomboy](https://github.com/tomboy-notes/tomboy/issues).

[**BugÂ 754488**](show_bug.cgi?id=754488) -
(DWF-2016-89001) Validate TLS certificates

|  | |
| --- | --- |
| [Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.") | (DWF-2016-89001) Validate TLS certificates |

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | shotwell | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=shotwell "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | general | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 0.22.x | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | Normal critical | | [TargetÂ Milestone](page.cgi?id=fields.html#target_milestone): | --- | | [Assigned To](page.cgi?id=fields.html#assigned_to): | Shotwell Maintainers | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Shotwell Maintainers | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [751709](show_bug.cgi?id=751709 "RESOLVED FIXED - Port to webkit2gtk-4.0") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [748991](show_bug.cgi?id=748991 "RESOLVED FIXED - Error to publish on Facebook") | | Â | | Â | | Reported: | 2015-09-02 20:21 UTC by Michael Catanzaro | | --- | --- | | Modified: | 2016-03-11 15:12 UTC | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [GNOME target:](page.cgi?id=fields.html#cf_gnome_target "A custom Drop Down field in this installation of GNOME Bugzilla.") | --- | | | [GNOME version:](page.cgi?id=fields.html#cf_gnome_version "A custom Drop Down field in this installation of GNOME Bugzilla.") | --- | | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

|  |  |
| --- | --- |

| [Description](show_bug.cgi?id=754488#c0)  Michael Catanzaro    2015-09-02 20:21:31 UTC  ``` Seems Shotwell logs into Facebook, etc. without validating TLS certificates. First reported in [bug #751709](show_bug.cgi?id=751709 "RESOLVED FIXED - Port to webkit2gtk-4.0").  Since you use WebKit1 you're responsible not just for all security bugs since security updates ended a year ago, but also for validating TLS certificates on the SoupSession used by your WebKitWebView, before sending any HTTP headers. I've never done this before, but I think the right way is to connect to WebKitWebView:resource-request-starting, grab the WebKitNetworkRequest, get the SoupMessage property from it, then connect to notify::tls-errors and cancel the message immediately in the signal handler (not sure how to do that). I think you also have to somehow tell libsoup to check for TLS errors in the first place; should be easy if you can find a way to get the SoupSession from WebKit (see below), but I'm not sure how to do that (CCing a couple people who might know).  Much better to just upgrade to WebKit2 ([bug #751709](show_bug.cgi?id=751709 "RESOLVED FIXED - Port to webkit2gtk-4.0")), which is secure by default.  Also, since you use SoupSessionAsync outside of WebKit, you need to validate them there too, either by upgrading to plain SoupSession or by setting its ssl-use-system-ca-file property to TRUE, regardless of the version of WebKit in use. But that is easy. ``` [Comment 1](show_bug.cgi?id=754488#c1)  Dan Winship    2015-09-02 20:30:13 UTC  ``` (In reply to Michael Catanzaro from [comment #0](show_bug.cgi?id=754488#c0)) > Since you use WebKit1 you're responsible not just for all security bugs > since security updates ended a year ago, but also for validating TLS > certificates on the SoupSession used by your WebKitWebView, before sending > any HTTP headers. I've never done this before, but I think the right way is > to connect to WebKitWebView:resource-request-starting, grab the > WebKitNetworkRequest, get the SoupMessage property from it, then connect to > notify::tls-errors and cancel the message immediately in the signal handler  No, webkit did things complicatedly because it wanted to be able to "accept this certificate anyway". If you just want to kill the connection when the cert is bad, just get the session object and set ssl-use-system-ca-file on it. ``` [Comment 2](show_bug.cgi?id=754488#c2)  Michael Catanzaro    2015-09-02 20:41:23 UTC  ``` That would be enough to satisfy me, but how to we get the session object from WebKit? ``` [Comment 3](show_bug.cgi?id=754488#c3)  Dan Winship    2015-09-02 20:58:51 UTC  ``` In wk1 there's a function that returns it. I don't remember the precise details. ``` [Comment 4](show_bug.cgi?id=754488#c4)  Michael Catanzaro    2015-09-02 22:00:46 UTC  ``` It's webkit_get_default_session. I'm not sure why I could not find it earlier; I thought I had searched the entire API and found no use of the word "session," but apparently not. ``` [Comment 5](show_bug.cgi?id=754488#c5)  Michael Catanzaro    2015-09-02 23:32:50 UTC  ``` Carlos, what is the right way to do this? I have to set ssl-use-system-ca-file again immediately before each call to webkit_web_view_open. That can't be the right way. I downloaded a tarball of 2.4.9 to look at what it's doing, but it's not unsetting it anywhere that I can see.  E.g. with these modified functions in FacebookPublishing.vala:      private string get_login_url() {         string facebook_locale = get_system_locale_as_facebook_locale();          return "[https://cacert.org/%s](https://cacert.org/%25s)".printf(facebook_locale);     }      public void on_pane_installed() {         WebKit.get_default_session().ssl_use_system_ca_file = true;         webview.open(get_login_url());     }  The load gets stopped properly. But if I try to set ssl_use_system_ca_file anywhere else, it doesn't work. Surely we don't have to do this before each webview.open.  P.S. You don't need a Facebook account to test, just click some photo, click Publish on the bottom, and click Log In. ``` [Comment 6](show_bug.cgi?id=754488#c6)  Michael Catanzaro    2015-10-09 21:00:40 UTC  ``` (In reply to Michael Catanzaro from [comment #5](show_bug.cgi?id=754488#c5)) > Carlos, what is the right way to do this? I have to set > ssl-use-system-ca-file again immediately before each call to > webkit_web_view_open. That can't be the right way.  I don't plan to spend more time debugging why this setting is getting changed, so this is the approach I will take unless someone has a better idea.... ``` [Comment 7](show_bug.cgi?id=754488#c7)  Carlos Garcia Campos    2015-10-12 08:16:48 UTC  ``` I'm not sure I understand the problem. WebKit1, uses the default soup session (SoupNetworkSession::defaultSession().soupSession()) that doesn't set anything about SSL on the session. But, wk1 also calls WebCore::ResourceHandle::setIgnoreSSLErrors(true); for backwards compatibility reasons. That means that WebKit will not handle the SSL errors at all. And we don't change the ssl-use-system-ca-file property anywhere. So, if what we want is that bad certificates are rejected, we should only set the ssl-use-system-ca-file property once, during the app intialization, for example, before anything is loaded. Also ensure that the ssl-strict is TRUE, but it should be by default. ``` [Comment 8](show_bug.cgi?id=754488#c8)  Michael Catanzaro    2015-12-04 17:14:40 UTC  ``` Patches for this in [bug #751709](show_bug.cgi?id=751709 "RESOLVED FIXED - Port to webkit2gtk-4.0") ``` [Comment 9](show_bug.cgi?id=754488#c9)  Michael Catanzaro    2015-12-08 16:44:12 UTC  ``` CVE request: <http://www.openwall.com/lists/oss-security/2015/12/04/4> ``` [Comment 10](show_bug.cgi?id=754488#c10)  Michael Catanzaro    2015-12-20 21:09:52 UTC  ``` (In reply to Michael Catanzaro from [comment #9](show_bug.cgi?id=754488#c9)) > CVE request: <http://www.openwall.com/lists/oss-security/2015/12/04/4>  It's gone unanswered. ``` [Comment 11](show_bug.cgi?id=754488#c11)  Michael Catanzaro    2015-12-21 01:13:52 UTC  ``` (In reply to Carlos Garcia Campos from [comment #7](show_bug.cgi?id=754488#c7)) > And we don't change the ssl-use-system-ca-file property anywhere. > So, if what we want is that bad certificates are rejected, we should only > set the ssl-use-system-ca-file property once, during the app intialization, > for example, before anything is loaded.  Well that's what I thought too, but for the record, something about that is wrong; the only way I could find to fix this with WK1 was to set ssl-use-system-ca-file once before every load. I never debugged far enough to figure out why, since Ian ported Shotwell to WK2. ``` [Comment 12](show_bug.cgi?id=754488#c12)  Michael Catanzaro    2016-03-11 15:12:58 UTC  ``` (In reply to Michael Catanzaro from [comment #10](show_bug.cgi?id=754488#c10)) > (In reply to Michael Catanzaro from [comment #9](show_bug.cgi?id=754488#c9)) > > CVE request: <http://www.openwall.com/lists/oss-security/2015/12/04/4> >  > It's gone unanswered.  Since MITRE did not respond despite Shotwell clearly falling into its full coverage tier due to its presence in Ubuntu/Debian/RHEL, I requested a DWF, which is a new project aiming to allocate CVE-compatible IDs in response to widespread difficulty of researchers in receiving new CVE assignments. This issue was allocated DWF-2016-89001. ``` |  |
| --- | --- |

---

---

* + [Home](./)
  + | New
  + | [Browse](page.cgi?id=browse.html&product=shotwell)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](page.cgi?id=reports.html)
  + |
    [Help](http://www.bugzilla.org/docs/4.4/en/html/bug_page.html)
  + |
    [Log In](show_bug.cgi?id=754488&GoAheadAndLogIn=1)

    Remember

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=754488&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


