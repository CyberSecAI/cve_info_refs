=== Content from github.com_2afd22fc_20250125_091701.html ===
From 2e227f6023477cbdbefd577f15d0846aa40c8775 Mon Sep 17 00:00:00 2001
From: Patrick Uiterwijk
Date: Fri, 17 Jun 2016 18:32:34 +0000
Subject: [PATCH] Allow submission of checkin information via json
This means we still allow pickle submissions as a stopgap until we
manage to convince admins to move to json submissions.
Related: CVE-2016-1000003
Signed-off-by: Patrick Uiterwijk
---
mirrormanager2/xmlrpc.py | 7 ++++++-
1 file changed, 6 insertions(+), 1 deletion(-)
diff --git a/mirrormanager2/xmlrpc.py b/mirrormanager2/xmlrpc.py
index 804f43afc..82a90e3a1 100644
--- a/mirrormanager2/xmlrpc.py
+++ b/mirrormanager2/xmlrpc.py
@@ -25,6 +25,7 @@
import base64
import pickle
+import json
import bz2
import flask
@@ -41,7 +42,11 @@
@XMLRPC.register
def checkin(pickledata):
- config = pickle.loads(bz2.decompress(base64.urlsafe\_b64decode(pickledata)))
+ uncompressed = bz2.decompress(base64.urlsafe\_b64decode(pickledata))
+ try:
+ config = json.loads(uncompressed)
+ except ValueError:
+ config = pickle.loads(uncompressed)
r, message = read\_host\_config(SESSION, config)
if r is not None:
return message + 'checked in successful'


=== Content from github.com_6e489aaa_20250125_091701.html ===
From eb9b542bc818071b9eee41c3583b7e6e172b3a53 Mon Sep 17 00:00:00 2001
From: Patrick Uiterwijk
Date: Fri, 17 Jun 2016 19:09:13 +0000
Subject: [PATCH] Update client to use json serialization
This changes the client to use json serialization rather than
pickles.
Related: CVE-2016-1000003
Signed-off-by: Patrick Uiterwijk
---
client/report\_mirror | 8 ++++----
1 file changed, 4 insertions(+), 4 deletions(-)
diff --git a/client/report\_mirror b/client/report\_mirror
index 89317409d..2b97aed28 100755
--- a/client/report\_mirror
+++ b/client/report\_mirror
@@ -1,7 +1,7 @@
#!/usr/bin/python
import os, sys
-import pickle
+import json
import ConfigParser
import pprint
import xmlrpclib
@@ -186,7 +186,7 @@ def get\_stats(conf, section):
try:
f = open(fn, 'r')
contents = contents + f.readlines()
- statsdata[name] = pickle.dumps(contents, -1)
+ statsdata[name] = json.dumps(contents, -1)
f.close()
except:
pass
@@ -284,7 +284,7 @@ def main():
get\_exclude\_dir\_patterns\_from\_file(options)
if options.input:
infile = open(options.input, 'rb')
- item.config = pickle.load(infile)
+ item.config = json.load(infile)
infile.close()
if not config(options.config, item, crawl=False):
sys.exit(1)
@@ -292,7 +292,7 @@ def main():
if not config(options.config, item, crawl=True):
sys.exit(1)
- p = pickle.dumps(item.config, -1)
+ p = json.dumps(item.config, -1)
if options.debug:
pp = pprint.PrettyPrinter(indent=4)

