=== Content from www.facebook.com_e8c1717a_20250124_141642.html ===

# [*Facebook*](https://www.facebook.com/ "Go to Facebook home")

| Email or phone | Password |
| --- | --- |
|  |  |  |
|  | [Forgot account?](https://www.facebook.com/recover/initiate?lwv=110&ars=royal_blue_bar) |

[Sign Up](/r.php?locale=en_US)*Notice*You must log in to continue.Log into FacebookLog In[Forgot account?](https://www.facebook.com/recover/initiate?lwv=110&ars=royal_blue_bar)[Create new account](/r.php?r=101)

* English (US)
* [Gaeilge](https://www.facebook.com/security/advisories/cve-2016-1000109 "Irish")
* [Polski](https://ga-ie.facebook.com/security/advisories/cve-2016-1000109 "Polish")
* [Lietuvių](https://pl-pl.facebook.com/security/advisories/cve-2016-1000109 "Lithuanian")
* [Português (Brasil)](https://lt-lt.facebook.com/security/advisories/cve-2016-1000109 "Portuguese (Brazil)")
* [Русский](https://pt-br.facebook.com/security/advisories/cve-2016-1000109 "Russian")
* [Română](https://ru-ru.facebook.com/security/advisories/cve-2016-1000109 "Romanian")
* [Español](https://ro-ro.facebook.com/security/advisories/cve-2016-1000109 "Spanish")
* [Français (France)](https://es-la.facebook.com/security/advisories/cve-2016-1000109 "French (France)")
* [Deutsch](https://fr-fr.facebook.com/security/advisories/cve-2016-1000109 "German")
* [Italiano](https://de-de.facebook.com/security/advisories/cve-2016-1000109 "Italian")

* [Sign Up](/reg/ "Sign Up for Facebook")
* [Log In](/login/ "Log into Facebook")
* [Messenger](https://messenger.com/ "Check out Messenger.")
* [Facebook Lite](/lite/ "Facebook Lite for Android.")
* [Video](https://www.facebook.com/watch/ "Browse in Video")
* [Places](/places/ "Check out popular places on Facebook.")
* [Games](/games/ "Check out Facebook games.")
* [Marketplace](/marketplace/ "Buy and sell on Facebook Marketplace.")
* [Meta Pay](https://about.meta.com/technologies/meta-pay "Learn more about Meta Pay")
* [Meta Store](https://www.meta.com/ "Check out Meta")
* [Meta Quest](https://www.meta.com/quest/ "Learn more about Meta Quest")
* [Ray-Ban Meta](https://www.meta.com/smart-glasses/ "Learn more about Ray-Ban Meta")
* [Meta AI](https://www.meta.ai/ "Meta AI")
* [Instagram](https://l.facebook.com/l.php?u=https%3A%2F%2Fwww.instagram.com%2F&h=AT0KCxTU7MDM_t3VGxWQfLi37JbO0_ZXAzqxLErT0IwIcWzNusiTSG7wg0uG1-ZB1BbfW-NJf1HHI11wM0-JWVkJRtcLrp-QKftldV6PAPiIdxs_gPta4E-qF_OVm36aV6IpJjMHl_Bids8ml9aAHw "Check out Instagram")
* [Threads](https://www.threads.net/ "Check out Threads")
* [Fundraisers](/fundraisers/ "Donate to worthy causes.")
* [Services](/biz/directory/ "Browse our Facebook Services directory.")
* [Voting Information Center](/votinginformationcenter/?entry_point=c2l0ZQ%3D%3D "See the Voting Information Center.")
* [Privacy Policy](/privacy/policy/?entry_point=facebook_page_footer "Learn how we collect, use and share information to support Facebook.")
* [Privacy Center](/privacy/center/?entry_point=facebook_page_footer "Learn how to manage and control your privacy on Facebook.")
* [Groups](/groups/discover/ "Explore our Groups.")
* [About](https://about.meta.com/ "Read our blog, discover the resource center, and find job opportunities.")
* [Create ad](/ad_campaign/landing.php?placement=pflo&campaign_id=402047449186&nav_source=unknown&extra_1=auto "Advertise on Facebook.")
* [Create Page](/pages/create/?ref_type=site_footer "Create a page")
* [Developers](https://developers.facebook.com/?ref=pf "Develop on our platform.")
* [Careers](/careers/?ref=pf "Make your next career move to our awesome company.")
* [Cookies](/policies/cookies/ "Learn about cookies and Facebook.")
* [Ad choices](https://www.facebook.com/help/568137493302217 "Learn about Ad Choices.")
* [Terms](/policies?ref=pf "Review our terms and policies.")
* [Help](/help/?ref=pf "Visit our Help Center.")
* [Contact Uploading & Non-Users](https://www.facebook.com/help/637205020878504 "Visit our Contact Uploading & Non-Users Notice.")
* [Settings](/settings "View and edit your Facebook settings.")
* [Activity log](/allactivity?privacy_source=activity_log_top_menu "View your activity log")
 Meta © 2025![](https://facebook.com/security/hsts-pixel.gif)



=== Content from github.com_d11089cf_20250126_013031.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-qhf2-73w2-gwfh)

**CVE-2016-1000109**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-qhf2-73w2-gwfh)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2016-1000109](/advisories/GHSA-qhf2-73w2-gwfh)

## HHVM does not attempt to address RFC 3875 section 4.1.18...

Moderate severity

Unreviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Jan 29, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-qhf2-73w2-gwfh/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

HHVM does not attempt to address RFC 3875 section 4.1.18 namespace conflicts and therefore does not protect CGI applications from the presence of untrusted client data in the HTTP\_PROXY environment variable, which might allow remote attackers to redirect a CGI application's outbound HTTP traffic to an arbitrary proxy server via a crafted Proxy header in an HTTP request, aka an "httpoxy" issue. This issue affects HHVM versions prior to 3.9.6, all versions between 3.10.0 and 3.12.4 (inclusive), and all versions between 3.13.0 and 3.14.2 (inclusive).

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2016-1000109>
* [facebook/hhvm@423b4b7](https://github.com/facebook/hhvm/commit/423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25)
* <https://httpoxy.org/>
* <https://www.facebook.com/security/advisories/cve-2016-1000109>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2016-1000109)
Feb 19, 2020

Published to the GitHub Advisory Database
May 24, 2022

Last updated
Jan 29, 2023

### Severity

Moderate

### EPSS score

5.036%

# Exploit Prediction Scoring System (EPSS)

This score estimates the probability of this vulnerability being exploited within the next 30 days.
Data provided by [FIRST](https://www.first.org/epss/user-guide).

 (93rd percentile)

### Weaknesses

No CWEs

### CVE ID

CVE-2016-1000109

### GHSA ID

GHSA-qhf2-73w2-gwfh

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-qhf2-73w2-gwfh/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b02a70b2_20250124_141641.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fhhvm%2Fcommit%2F423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fhhvm%2Fcommit%2F423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=facebook%2Fhhvm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[facebook](/facebook)
/
**[hhvm](/facebook/hhvm)**
Public

* [Notifications](/login?return_to=%2Ffacebook%2Fhhvm) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Ffacebook%2Fhhvm)
* [Star
   18.3k](/login?return_to=%2Ffacebook%2Fhhvm)

* [Code](/facebook/hhvm)
* [Issues
  453](/facebook/hhvm/issues)
* [Pull requests
  87](/facebook/hhvm/pulls)
* [Discussions](/facebook/hhvm/discussions)
* [Actions](/facebook/hhvm/actions)
* [Wiki](/facebook/hhvm/wiki)
* [Security](/facebook/hhvm/security)
* [Insights](/facebook/hhvm/pulse)

Additional navigation options

* [Code](/facebook/hhvm)
* [Issues](/facebook/hhvm/issues)
* [Pull requests](/facebook/hhvm/pulls)
* [Discussions](/facebook/hhvm/discussions)
* [Actions](/facebook/hhvm/actions)
* [Wiki](/facebook/hhvm/wiki)
* [Security](/facebook/hhvm/security)
* [Insights](/facebook/hhvm/pulse)

## Commit

[Permalink](/facebook/hhvm/commit/423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[CVE-2016-1000109](https://github.com/advisories/GHSA-qhf2-73w2-gwfh "CVE-2016-1000109"): Ignore Proxy HTTP header from fastcgi requests

[Browse files](/facebook/hhvm/tree/423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25)
Browse the repository at this point in the history

```
Summary:
The default PHP behavior is to transform a Proxy header from requests
into the HTTP_PROXY environment variable in the PHP environment running the
request. Some scripts may use this env var to decide which HTTP proxy to
connect to, and we don't want requests to have that kind of control over
scripts' behavior.

Reviewed By: alexmalyshev, Orvid

Differential Revision: D3579221

fbshipit-source-id: 18a405fd73aee65283aea99ff995f8082b3fc3b5
```

* Loading branch information

[![@swtaarrs](https://avatars.githubusercontent.com/u/118219?s=40&v=4)](/swtaarrs)

[swtaarrs](/facebook/hhvm/commits?author=swtaarrs "View all commits by swtaarrs")
authored and
Hhvm Bot
committed
Jul 19, 2016

1 parent
[a47d75b](/facebook/hhvm/commit/a47d75b728c476d47eb7606493dd97bb7cfbca8e)

commit 423b4b7

Showing
**1 changed file**
with
**4 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[hphp/runtime/server/fastcgi/fastcgi-transport.cpp](#diff-85e7126c34a59e68351af005578c7498868021286ed22a0969608a12676618cc "hphp/runtime/server/fastcgi/fastcgi-transport.cpp")

Show comments

[View file](/facebook/hhvm/blob/423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25/hphp/runtime/server/fastcgi/fastcgi-transport.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -212,6 +212,10 @@ void FastCGITransport::onHeader(std::unique\_ptr<folly::IOBuf> key\_chain, |
|  |  | Cursor keyCur(key\_chain.get()); |
|  |  | auto key = keyCur.readFixedString(key\_chain->computeChainDataLength()); |
|  |  |  |
|  |  | // Don't allow requests to inject an HTTP\_PROXY environment variable by |
|  |  | // sending a Proxy header. |
|  |  | if (strcasecmp(key.c\_str(), "HTTP\_PROXY") == 0) return; |
|  |  |  |
|  |  | Cursor valCur(value\_chain.get()); |
|  |  | auto value = valCur.readFixedString(value\_chain->computeChainDataLength()); |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `423b4b7`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fhhvm%2Fcommit%2F423b4b719afd5ef4e6e19d8447fbf7b6bc0d0a25) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from httpoxy.org_17808822_20250124_141642.html ===

# httpoxy

###### Recommended reading

* [Summary](#top)
* [What Is Affected](#affected-summary)
* [Immediate Mitigation](#fix-now)
* [Prevention](#prevent)

###### Interesting, but once youâve mitigated

* [How It Works](#how-it-works)
* [Why It Happened](#why)
* [History of httpoxy](#history)
* [CVEs](#cve)

## A CGI application vulnerability (in 2016) for PHP, Go, Python and others

*httpoxy* is a set of vulnerabilities that affect application code running in CGI, or CGI-like environments. It comes
down to a simple namespace conflict:

* RFC 3875 (CGI) puts the HTTP `Proxy` header from a request into the environment variables as `HTTP_PROXY`
* `HTTP_PROXY` is a popular environment variable used to configure an outgoing proxy

This leads to a remotely exploitable vulnerability. If youâre running PHP or CGI, you should block the `Proxy` header.
[Hereâs how.](#fix-now)

httpoxy is a vulnerability for server-side web applications. If youâre not deploying code, you donât need to worry.

#### What can happen if my web application is vulnerable?

If a vulnerable HTTP client makes an outgoing HTTP connection, while running in a server-side CGI application, an
attacker may be able to:

* Proxy the outgoing HTTP requests made by the web application
* Direct the server to open outgoing connections to an address and port of their choosing
* Tie up server resources by forcing the vulnerable software to use a malicious proxy

httpoxy is extremely easy to exploit in basic form. And we expect security
researchers to be able to scan for it quickly. Luckily, if you read on and
find you are affected, [easy mitigations](#fix-now) are available.

## Isnât this old news? Is this still a problem?

httpoxy **was disclosed in mid-2016**. If youâre reading about it now for the first time, you can *probably* relax and
take your time reading about this quaint historical bug that *hopefully* no longer affects any of the applications you
maintain. But you should verify that to your own satisfaction.

The content below this point reflects the original disclosure, and Iâll be leaving the site up and mostly unchanged, other
than noting fix versions where I can. I guess Iâm just saying: the time for urgency was last year.

## What Is Affected

A few things are necessary to be vulnerable:

* Code running under a CGI-like context, where `HTTP_PROXY` becomes a real or emulated environment variable
* An HTTP client that trusts `HTTP_PROXY`, and configures it as the proxy
* That client, used within a request handler, making an HTTP (as opposed to HTTPS) request

For example, the confirmed cases weâve found so far:

| Language | Environment | HTTP client |
| --- | --- | --- |
| PHP | php-fpm  mod\_php | Guzzle 4+  Artax |
| Python | wsgiref.handlers.CGIHandler  twisted.web.twcgi.CGIScript | requests |
| Go | net/http/cgi | net/http |

But obviously there may be languages we havenât considered yet. CGI is a common standard, and
`HTTP_PROXY` seems to be becoming more popular over time. Take the below as a sample of the most
commonly affected scenarios:

### PHP

* Whether you are vulnerable depends on your specific application code and PHP libraries, but the problem
  seems fairly widespread
* Just *using* one of the vulnerable libraries, while processing a userâs request, is exploitable.
* If youâre using a vulnerable library, this vulnerability will affect any version of PHP
  + It even affects alternative PHP runtimes such as HHVM deployed under FastCGI
* It is present in Guzzle, Artax, and probably many, many libraries
  + Guzzle versions in the range `>=4.0.0rc2,<6.2.1` are vulnerable, Guzzle 3 and below is not.
  + Another example is (update: was) in Composerâs StreamContextBuilder utility class

So, for example, if you are using a Drupal module that uses Guzzle `6.2.0` and makes an outgoing HTTP request (for example,
to check a weather API), you are vulnerable to the request that plugin makes being âhttpoxiedâ.

### Python

* Python code *must be deployed under CGI to be vulnerable*. Usually, thatâll mean the vulnerable code
  will use a CGI handler like `wsgiref.handlers.CGIHandler`
  + This is not considered a normal way of deploying Python webapps (most people are using WSGI or FastCGI, both of which are
    not affected), so vulnerable Python applications will probably be much rarer than vulnerable PHP applications.
  + wsgi, for example, is not vulnerable, because os.environ is not polluted by CGI data
* Vulnerable versions of the requests library will trust and use `os.environ['HTTP_PROXY']`, without checking if CGI is in use
* Update: Fixed in `2.7.13`, `3.4.6`, `3.5.3`, `3.6.0` (see [the Python advisory](https://python-security.readthedocs.io/vuln/cve-2016-1000110_httpoxy_attack.html))

### Go

* Go code *must be deployed under CGI to be vulnerable*. Usually, thatâll mean the vulnerable code uses
  the `net/http/cgi` package.
  + As with Python, this is not considered a usual way of deploying Go as a web application, so this vulnerability should be
    relatively rare
  + Goâs `net/http/fcgi` package, by comparison, does not set actual environment variables, so it is *not* vulnerable
* Vulnerable versions of `net/http` will trust and use `HTTP_PROXY` for outgoing requests, without checking if CGI is in use
* Update: Fixed in Go `1.7rc3`, all stable versions of `>=1.7`

## Immediate Mitigation

The best immediate mitigation is to block `Proxy` request headers as early as possible, and before they hit your
application. This is easy and safe.

* Itâs safe because the `Proxy` header is undefined by the IETF, and isnât listed on the
  [IANAâs registry of message headers](http://www.iana.org/assignments/message-headers/message-headers.xhtml). This means
  **there is no standard use for the header at all**; not even a provisional use-case.
* Standards-compliant HTTP clients and servers will never read or send this header.
* You can either strip the header or completely block requests attempting to use it.
* You should try to do your mitigation as *early* and as far *upstream* as you can.
  + Do it âat the edgeâ, where HTTP requests first enter your system.
  + That way, you can fix lots of vulnerable software at once.
  + Everything behind a reverse proxy or application firewall that strips the `Proxy` header is safe!

How you block a `Proxy` header depends on the specifics of your setup. The earliest convenient place to block the header
might be at a web application firewall device, or directly on the webserver running Apache or NGINX. Here are a few of
the more common mitigations:

### NGINX/FastCGI

Use this to block the header from being passed on to PHP-FPM, PHP-PM etc.

```
fastcgi_param HTTP_PROXY "";

```

In FastCGI configurations, PHP is vulnerable (but many other languages that use NGINX FastCGI are not).

For specific NGINX coverage, we recommend that you read the official [NGINX blog post](https://www.nginx.com/blog/mitigating-the-httpoxy-vulnerability-with-nginx)
on this vulnerability. The blog post provides a graphic depiction of how
httpoxy works and more extensive mitigation information for NGINX.

### Apache

For specific Apache coverage (and details for other Apache software projects like Tomcat), we strongly recommend
you read the [Apache Software Foundationâs official advisory](https://www.apache.org/security/asf-httpoxy-response.txt) on
the matter. The very basic mitigation information youâll find below is covered in much greater depth there.

If youâre using Apache HTTP Server with `mod_cgi`, languages like Go and Python may be vulnerable (the `HTTP_PROXY` env var
is ârealâ). And `mod_php` is affected due to the nature of PHP. If you are using **mod\_headers**, you can unset the
`Proxy` header before further processing with this directive:

```
RequestHeader unset Proxy early

```

Example for using this in `.htaccess` files:

```
<IfModule mod_headers.c>
   RequestHeader unset Proxy
</IfModule>

```

If you are using **mod\_security**, you can use a `SecRule` to deny traffic with a `Proxy` header. Hereâs an example,
vary the action to taste, and make sure `SecRuleEngine` is on. The 1000005 ID has been assigned to this issue.

```
SecRule &REQUEST_HEADERS:Proxy "@gt 0" "id:1000005,log,deny,msg:'httpoxy denied'"

```

Finally, if youâre using Apache Traffic Server, itâs not itself affected, but you can use it to strip the `Proxy` header; very helpful
for any services sitting behind it. Again, see the [ASFâs guidance](https://www.apache.org/security/asf-httpoxy-response.txt),
but one possible configuration is:

* Within `plugin.config`, inside the configuration directory (e.g. `/usr/local/etc/trafficserver` or `/etc/trafficserver`),
  add the following directive:

  ```
  header_rewrite.so strip_proxy.conf

  ```
* Add the following to a new file named `strip_proxy.conf` in the same directory:

  ```
  cond %{READ_REQUEST_HDR_HOOK}
  rm-header Proxy

  ```

### HAProxy

This will strip the header off requests:

```
http-request del-header Proxy

```

If your version of HAProxy is old (i.e. `1.4` or earlier), you may not have the `http-request del-header` directive.
If so, you must also take care that headers are stripped from requests served after the first one over an HTTP 1.1
keep-alive connection. (i.e. take special note of the limitation described in the first paragraph of [the 1.4 âheader
manipulationâ documentation](https://cbonte.github.io/haproxy-dconv/1.4/configuration.html#6))

### Varnish

For Varnish, the following should unset the header. Add it to the pre-existing vcl\_recv section:

```
sub vcl_recv {
    [...]
    unset req.http.proxy;
    [...]
}

```
### OpenBSD relayd

For relayd, the following should remove the header. Add it to a pre-existing filter:

```
http protocol httpfilter {
        match request header remove "Proxy"
}

```
### lighttpd

#### <= 1.4.40

To reject requests containing a `Proxy` header

* Create `/path/to/deny-proxy.lua`, read-only to lighttpd, with the content:

  ```
  if (lighty.request["Proxy"] == nil) then return 0 else return 403 end

  ```
* Modify `lighttpd.conf` to load `mod_magnet` and run the above lua code:

  ```
  server.modules += ( "mod_magnet" )
  magnet.attract-raw-url-to = ( "/path/to/deny-proxy.lua" )

  ```

#### lighttpd2 (development)

To strip the `Proxy` header from the request, add the following to `lighttpd.conf`:

```
req_header.remove "Proxy";

```
### Microsoft IIS with PHP or a CGI framework

For detailed information about mitigating httpoxy on IIS, you should
head to the official [Microsoft article KB3179800](https://support.microsoft.com/en-us/kb/3179800), which covers
the below mitigations in greater detail.

Also important to know: httpoxy does not affect any Microsoft Web Frameworks, e.g. not ASP.NET nor Active Server Pages.
But if you have installed PHP or any other third party framework on top of IIS, we recommend applying mitigation steps
to protect from httpoxy attacks. You can either block requests containing a `Proxy` header, or clear the header. (The header
is safe to block, because browsers will not generally send it at all).

To *block* requests that contain a `Proxy` header (the preferred solution), run the following command line.

```
appcmd set config /section:requestfiltering /+requestlimits.headerLimits.[header='proxy',sizelimit='0']

```

**Note:** `appcmd.exe` is not typically in the path and can be found in the `%systemroot%\system32\inetsrv` directory

To *clear* the value of the header, use the following URL Rewrite rule:

```
<system.webServer>
    <rewrite>
        <rules>
            <rule name="Erase HTTP_PROXY" patternSyntax="Wildcard">
                <match url="*.*" />
                <serverVariables>
                    <set name="HTTP_PROXY" value="" />
                </serverVariables>
                <action type="None" />
            </rule>
        </rules>
    </rewrite>
</system.webServer>

```

**Note:** URL Rewrite is a downloadable add-in for IIS and is not included in a default IIS installation.

### Hiawatha

You can block any request containing a `Proxy` header (or ban the sending client) via the UrlToolkit:

```
UrlToolkit {
  ToolkitID = block_httpoxy
  Header Proxy .* DenyAccess
}

```

See more information at the [hiawatha blog](https://www.hiawatha-webserver.org/weblog/115)

### LiteSpeed Web Server

Upgrade to `>= 5.0.19` or `>= 5.1.7` to mitigate. You can do this manually with one of these commands, or youâll get
an upgrade notification soon.

```
/usr/local/lsws/admin/misc/lsup.sh -v 5.0.19 # or
/usr/local/lsws/admin/misc/lsup.sh -v 5.1.7

```

See more information at the [litespeed blog](http://blog.litespeedtech.com/2016/07/18/the-httpoxy-vulnerability-has-been-taken-care-of-by-litespeed-automatically/)

### h2o Web Server

Upgrade to `>= 2.0.2` and add this to your configuration:

```
setenv:
  HTTP_PROXY: ""

```

More information can be found in this [GitHub pull request](https://github.com/h2o/h2o/pull/996).

### Other CGI software and applications

Please let us know of other places where httpoxy is found. Weâd be happy to help you communicate fixes for your platform,
server or library if you are affected. Contact contact@httpoxy.org to let us
know. Or create a PR or issue against the [httpoxy-org repo](https://github.com/httpoxy/httpoxy-org) in GitHub.

## Ineffective fixes in PHP

Userland PHP fixes donât work. Donât bother:

* Using `unset($_SERVER['HTTP_PROXY'])` does not affect the value returned from `getenv()`, so is not an effective
  mitigation
* Using `putenv('HTTP_PROXY=')` does not work either (to be precise: it only works if that value is coming from an
  actual environment variable rather than a header â so, it cannot be used for mitigation)

## Prevention

### Summary

* If you can avoid it, do not deploy into environments where the CGI data is merged into the actual environment variables
* Use and expect `CGI_HTTP_PROXY` to set the proxy for a CGI applicationâs internal requests, if necessary
  + You can still support `HTTP_PROXY`, but you must assert that CGI is not in use
  + In PHP, check `PHP_SAPI == 'cli'`
  + Otherwise, a simple check is to not trust `HTTP_PROXY` if `REQUEST_METHOD` is also set. RFC 3875 seems to require
    this meta-variable:

    > The `REQUEST_METHOD` meta-variable MUST be set to the method which should be used by the script to process the request

### Donât Trust `HTTP_PROXY` Under CGI

To put it plainly: there is no way to trust the value of an `HTTP_` env var in a CGI environment. They cannot be
distinguished from request headers according to the specification. So, *any* usage of `HTTP_PROXY` in a CGI context is
suspicious.

If you need to configure the proxy of a CGI application via an environment variable, use a variable name that will
never conflict with request headers. That is: one that does not begin with `HTTP_`. We strongly recommend you go for
`CGI_HTTP_PROXY`. (As seen in Ruby and libwww-perlâs mitigations for this issue.)

### PHP

CLI-only code may safely trust `$_SERVER['HTTP_PROXY']` or `getenv('HTTP_PROXY')`. But bear in mind that code written
for the CLI context often ends up running in a SAPI eventually, particularly utility or library code. And, with open
source code, that might not even be your doing. So, if you are going to rely on `HTTP_PROXY` at all, you should guard
that code with a check of the `PHP_SAPI` constant.

### Network Configuration as Prevention

A defense-in-depth strategy that can combat httpoxy (and entire classes of other security problems) is to severely restrict
the outgoing requests your web application can make to an absolute minimum. For example, if a web application is
firewalled in such a way that it *cannot* make outgoing HTTP requests, an attacker will not be able to receive
the âmisproxiedâ requests (because the web application is prevented from connecting to the attacker).

### HTTPS

And, of course, another defense-in-depth strategy that works is to use HTTPS for internal requests, not just for
securing your siteâs connections to the outside world. HTTPS requests arenât affected by `HTTP_PROXY`.

## How It Works

Using PHP as an example, because it is illustrative. PHP has a method called `getenv()`[1](#fn:php-getenv).

There is a common vulnerability in many PHP libraries and applications, introduced by confusing
`getenv` for a method that only returns environment variables. In fact, getenv() is closer to the
`$_SERVER` superglobal: it contains both environment variables and user-controlled data.

Specifically, when PHP is running under a CGI-like server, the HTTP request headers (data supplied
by the client) are merged into the `$_SERVER` superglobal under keys beginning with `HTTP_`. This is
the same information that `getenv` reads from.

When a user sends a request with a `Proxy` header, the header appears to the PHP application as `getenv('HTTP_PROXY')`.
Some common PHP libraries have been trusting this value, even when run in a CGI/SAPI environment.

Reading and trusting `$_SERVER['HTTP_PROXY']` is exactly the same vulnerability, but tends to happen much less often
(perhaps because of getenvâs name, perhaps because the semantics of the `$_SERVER` superglobal are better understood among
the community).

### Minimal example code

Note that these examples require deployment into a vulnerable environment before there is actually a vulnerability
(e.g. php-fpm, or Apacheâs `ScriptAlias`)

#### PHP

```
$client = new GuzzleHttp\Client();
$client->get('http://api.internal/?secret=foo')

```
#### Python

```
from wsgiref.handlers import CGIHandler
def application(environ, start_response):
    requests.get("http://api.internal/?secret=foo")
CGIHandler().run(application)

```
#### Go

```
cgi.Serve(
    http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        res, _ := http.Get("http://api.internal/?secret=foo")
        // [...]

```

More complete PoC repos (using Docker, and testing with an actual listener for the proxied request) have been prepared
under the [httpoxy Github organization](https://github.com/httpoxy).

## Why It Happened

Under the CGI spec, headers are provided mixed into the environment variables. (These are formally known as
âProtocol-Specific Meta-Variablesâ[2](#fn:meta-variables)). Thatâs just the way the spec works, not a failure or bug.

The goal of the code, in most of the vulnerabilities, is to find the correct proxy to use, when auto-configuring a
client for the internal HTTP request made shortly after. This task in Ruby could be completed by
the `find_proxy` method of `URI::Generic`, which notes:

> `http_proxy` and `HTTP_PROXY` are treated specially under the CGI environment, because `HTTP_PROXY` may be set by Proxy:
> header. So `HTTP_PROXY` is not used. `http_proxy` is not used too if the variable is case insensitive. `CGI_HTTP_PROXY`
> can be used instead.
>
> From the [Ruby stdlib documentation](http://ruby-doc.org/stdlib-2.3.1/libdoc/uri/rdoc/URI/Generic.html#method-i-find_proxy)

Other instances of the same vulnerability are present in other languages. For example, when
using Goâs `net/http/cgi` module, and deploying as a CGI application. This indicates the vulnerability
is a standard danger in CGI environments.

## History of httpoxy

This bug was first discovered over 15 years ago. The timeline goes something like:

March 2001

The issue is discovered in libwww-perl and fixed. Reported by Randal L. Schwartz. [3](#fn:perl-bug)

April 2001

The issue is discovered in curl, and fixed there too (albeit probably not for Windows). Reported by Cris Bailiff. [4](#fn:curl-bug)

July 2012

In implementing `HTTP_PROXY` for `Net::HTTP`, the Ruby team notice and avoid the potential issue. Nice work Akira Tanaka! [5](#fn:ruby-ref)

November 2013

The issue is mentioned on the NGINX mailing list. The user humbly points out the issue: âunless
Iâm missing something, which is very possibleâ. No, Jonathan Matthews, you were exactly right! [6](#fn:nginx-ref)

February 2015

The issue is mentioned on the Apache httpd-dev mailing list. Spotted by Stefan Fritsch. [7](#fn:apache-ref)

July 2016

Scott Geary, an engineer at Vend, found an instance of the bug in the wild. The Vend security team found the vulnerability
was still exploitable in PHP, and present in many modern languages and libraries. We started to disclose to security response teams.

So, the bug was lying dormant for years, like a latent infection: pox. We imagine that many people may have found the issue over
the years, but never investigated its scope in other languages and libraries. If youâve found a historical discussion
of interest that weâve missed, let us know. You can contact contact@httpoxy.org
or create an issue against the [httpoxy-org repo](https://github.com/httpoxy/httpoxy-org).

## CVEs

httpoxy has a number of CVEs assigned. These cover the cases where

* a language or CGI implementation makes the `Proxy` header available in such a way that the application cannot tell whether
  it is a real environment variable, or
* an application trusts the value of the `HTTP_PROXY` environment variable by default in a CGI environment (but only where that application should have been
  able to tell it came from a request)

The assigned CVEs so far:

* CVE-2016-5385: PHP
* CVE-2016-5386: Go
* CVE-2016-5387: Apache HTTP Server
* CVE-2016-5388: Apache Tomcat
* CVE-2016-6286: spiffy-cgi-handlers for CHICKEN
* CVE-2016-6287: CHICKENâs http-client
* CVE-2016-1000104: mod\_fcgi
* CVE-2016-1000105: Nginx cgi script
* CVE-2016-1000107: Erlang inets
* CVE-2016-1000108: YAWS
* CVE-2016-1000109: HHVM FastCGI
* CVE-2016-1000110: Python CGIHandler
* CVE-2016-1000111: Python Twisted
* CVE-2016-1000212: lighttpd

We suspect there may be more CVEs coming for httpoxy, as less common software is checked over. If you
want to get a CVE assigned for an httpoxy issue, there are a couple of options:

* For open source code projects, you can use the [Distributed Weakness Filing Project](https://distributedweaknessfiling.org/) (DWF).
  They have a simple way to report (public) issues using the form at [iwantacve.org](https://iwantacve.org/)
* For closed source code projects, you can talk to [MITRE, or one of their participating CNAs/vendors/coordinators](https://cve.mitre.org/cve/cna.html).

## Thanks and Further Coverage

Weâll be linking to official announcements from affected teams here, as they become available.

* [The CERT vulnerability note - VU#797896](https://www.kb.cert.org/vuls/id/797896)
* [Red Hat advisory](https://access.redhat.com/security/vulnerabilities/httpoxy)
* [The Apache Software Foundation advisory](https://www.apache.org/security/asf-httpoxy-response.txt)
* [Microsoft advisory KB3179800](https://support.microsoft.com/en-us/kb/3179800)
* [NGINX blog post](https://www.nginx.com/blog/mitigating-the-httpoxy-vulnerability-with-nginx/)
* [Drupal advisory](https://www.drupal.org/SA-CORE-2016-003)
* [Fastly advisory](https://www.fastly.com/security-advisories/vulnerability-use-httpproxy-cgi)
* [Cloudflare blog post](https://blog.cloudflare.com/cloudflare-sites-protected-from-httpoxy/)
* [Akamai blog post](https://blogs.akamai.com/2016/07/akamai-mitigates-httpoxy-vulnerability.html)
* [LiteSpeed blog post](http://blog.litespeedtech.com/2016/07/18/the-httpoxy-vulnerability-has-been-taken-care-of-by-litespeed-automatically/)

Over the past two weeks, the Vend security team worked to disclose the issue responsibly to as many affected parties as we
could. Weâd like to thank the members of:

* The Red Hat Product Security team, who provided extremely useful advice and access to their experience disclosing
  widespread vulnerabilities - if youâre sitting on a big or complicated disclosure, theyâre a great resource to reach
  out to for help.
* The language and implementation teams, who kept to disclosure norms and provided lively discussion.

Thereâs an [extra](extra.html) page with some meta-discussion on the whole named disclosure thing and contact details.
The content on this page is licensed as [CC0](http://creativecommons.org/publicdomain/zero/1.0/) (TL;DR: use what you
like, no permission/attribution necessary).

Iâve put together some more opinionated notes on httpoxy on [my Medium account](https://medium.com/%40nzdominic).

Regards,

Dominic Scheirlinck and the httpoxy disclosure team

July 2016

## Contact

You can email contact@httpoxy.org, or, for corrections or suggestions,
feel free to open an issue on the [httpoxy-org repo](https://github.com/httpoxy/httpoxy-org).

Page updated at 2017-06-23 14:17 UTC

## References

1. [The PHP documentation manual page for getenv](https://secure.php.net/getenv) [↩](#fnref:php-getenv)
2. [RFC 3875 4.1.18: Protocol-Specific Meta-Variables](https://tools.ietf.org/html/rfc3875#section-4.1.18) [↩](#fnref:meta-variables)
3. The fix applied correctly handles cases with case-insensitive environment variables.
   [libwww-perl-5.51 announcement](http://www.nntp.perl.org/group/perl.libwww/2001/03/msg2249.html) [↩](#fnref:perl-bug)
4. The [fix applied to Curl](https://sourceforge.net/p/curl/bugs/66/) does not
   correctly handle cases with case-insensitive environment variables - it specifically mentions the fix would not
   be enough for âNTâ (Windows). The commit itself carries the prescient message â[since it might become
   a security problem](https://github.com/curl/curl/commit/18f044f19d26f2b6dcd41796966f488a62a1bdca).â [↩](#fnref:curl-bug)
5. The [mitigation in Ruby](https://bugs.ruby-lang.org/issues/6546), like that for libwww-perl, correctly handles
   case-insensitive environment variables. [↩](#fnref:ruby-ref)
6. The [NGINX mailing list](https://forum.nginx.org/read.php?2,244407,244485#msg-244485) even had a PHP-specific
   explanation. [↩](#fnref:nginx-ref)
7. [Discussed](http://mail-archives.apache.org/mod_mbox/httpd-dev/201502.mbox/%3C2651807.jIIY3NPtlf%40k%3E) in reference to CGI specifically. [↩](#fnref:apache-ref)


