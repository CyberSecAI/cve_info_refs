=== Content from www.openwall.com_7ec3dc13_20250124_204638.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2016/06/17/5) [[next>]](../../../2016/06/20/1) [[<thread-prev]](../../../2016/06/10/7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <20160618195224.BFA2A33201D@smtpvbsrv1.mitre.org>
Date: Sat, 18 Jun 2016 15:52:24 -0400 (EDT)
From: cve-assign@...re.org
To: scott@...agonie.com
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: Simple Machines Forums - PHP Object Injection

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

> The first one appears to have been fixed in the release-2.1 branch, but the
> other one still exists.

> <https://github.com/SimpleMachines/SMF2.1/blob/404fd5347951652624dfb72304ee38fcab98378f/Sources/Packages.php#L863-L873>

Use CVE-2016-5726.

> <https://github.com/SimpleMachines/SMF2.1/blob/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources/LogInOut.php#L125-L129>

Use CVE-2016-5727.

- --
CVE Assignment Team
M/S M300, 202 Burlington Road, Bedford, MA 01730 USA
[ A PGP key is available for encrypted communications at
  <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCAAGBQJXZaYTAAoJEHb/MwWLVhi2/+YP+wc2CtBwbz9Qs67YW8t1UXuS
wxH2Dw7r3VLuGmD5UJAZBYt4+7kGd8FdMijD4ZNT3EdfraEkD45u8sXmbx0P0y7E
qX178dTVoi3h7sJHlTOa5agRmGqS1uLbzWWxXSolAU8X6/FFO/7/cTOJBCVW0z02
R1GNIVuf8mJA0mgGZ3DDJy0RV/dnco3VO4LoRKy2uQHnz3XHWaKnZkrmkBmt+eGK
ZevSmz4OVVf6B/w8rx4BcAajdlGWS89epGZSeAPnZeTPeixQE7E6uOhRaGPif0h4
0JP4GsDbKNUjod7DnVEKkDV0bHxc2Z+SEQyBihahtvdSxwe2W0N5ZdMejHbw2f8f
kN+0EYIGbOdPJYAP0c35PKLyfhlDrUwF/iPNx2k+tTls1T8qX//gb8PuZoF0k2Ro
zO9MYrZTlM819fN1Y4oqpUsB1dhDgcPstQx8ptqI6KDVJP61KUgRv/ADga9cLulo
nYPDfcqd+swJUZxRnUgeJuwmsYDF8BZTUQJmR48wTiBCQEqrQN4PSyD11RZLcJUv
lUrKhv6zINxknlNMPyb72NMIcSfW1iMwc0SiuYNElY+pSliBrPyZ0jC8+Bhpt0QL
eFvKwmGRTnoWp6Ly7iK2nI8uwp5zS0bCKrjw7ZpVmh97vslA2iA+7yxohqNV7po5
mGc8to+TR4jrcCoFZy2E
=SRzi
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_a5e0ddd1_20250126_032526.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fblob%2F19ee85ff8761b792ea3e9ed630a947f45f93ee68%2FSources%2FLogInOut.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fblob%2F19ee85ff8761b792ea3e9ed630a947f45f93ee68%2FSources%2FLogInOut.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=SimpleMachines%2FSMF)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SimpleMachines](/SimpleMachines)
/
**[SMF](/SimpleMachines/SMF)**
Public

* [Notifications](/login?return_to=%2FSimpleMachines%2FSMF) You must be signed in to change notification settings
* [Fork
  255](/login?return_to=%2FSimpleMachines%2FSMF)
* [Star
   615](/login?return_to=%2FSimpleMachines%2FSMF)

* [Code](/SimpleMachines/SMF)
* [Issues
  171](/SimpleMachines/SMF/issues)
* [Pull requests
  44](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects
  0](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

Additional navigation options

* [Code](/SimpleMachines/SMF)
* [Issues](/SimpleMachines/SMF/issues)
* [Pull requests](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

## Files

 19ee85f
## Breadcrumbs

1. [SMF](/SimpleMachines/SMF/tree/19ee85ff8761b792ea3e9ed630a947f45f93ee68)
2. /[Sources](/SimpleMachines/SMF/tree/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources)
/
# LogInOut.php

Copy path Blame  Blame
## Latest commit

## History

[History](/SimpleMachines/SMF/commits/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources/LogInOut.php)863 lines (716 loc) · 30.6 KB 19ee85f
## Breadcrumbs

1. [SMF](/SimpleMachines/SMF/tree/19ee85ff8761b792ea3e9ed630a947f45f93ee68)
2. /[Sources](/SimpleMachines/SMF/tree/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources)
/
# LogInOut.php

Top
## File metadata and controls

* Code
* Blame

863 lines (716 loc) · 30.6 KB[Raw](https://github.com/SimpleMachines/SMF/raw/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources/LogInOut.php)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863<?php
/\*\* \* This file is concerned pretty entirely, as you see from its name, with \* logging in and out members, and the validation of that. \* \* Simple Machines Forum (SMF) \* \* @package SMF \* @author Simple Machines http://www.simplemachines.org \* @copyright 2016 Simple Machines and individual contributors \* @license http://www.simplemachines.org/about/smf/license.php BSD \* \* @version 2.1 Beta 3 \*/
if (!defined('SMF')) die('No direct access...');
/\*\* \* Ask them for their login information. (shows a page for the user to type \* in their username and password.) \* It caches the referring URL in $\_SESSION['login\_url']. \* It is accessed from ?action=login. \* @uses Login template and language file with the login sub-template. \*/function Login(){ global $txt, $context, $scripturl, $user\_info;
 // You are already logged in, go take a tour of the boards if (!empty($user\_info['id'])) redirectexit();
 // We need to load the Login template/language file. loadLanguage('Login'); loadTemplate('Login');
 $context['sub\_template'] = 'login';
 if (!empty($\_SERVER['HTTP\_X\_REQUESTED\_WITH']) && $\_SERVER['HTTP\_X\_REQUESTED\_WITH'] == 'XMLHttpRequest') { $context['from\_ajax'] = true; $context['template\_layers'] = array(); }
 // Get the template ready.... not really much else to do. $context['page\_title'] = $txt['login']; $context['default\_username'] = &$\_REQUEST['u']; $context['default\_password'] = ''; $context['never\_expire'] = false;
 // Add the login chain to the link tree. $context['linktree'][] = array( 'url' => $scripturl . '?action=login', 'name' => $txt['login'], );
 // Set the login URL - will be used when the login process is done (but careful not to send us to an attachment). if (isset($\_SESSION['old\_url']) && strpos($\_SESSION['old\_url'], 'dlattach') === false && preg\_match('~(board|topic)[=,]~', $\_SESSION['old\_url']) != 0) $\_SESSION['login\_url'] = $\_SESSION['old\_url']; elseif (isset($\_SESSION['login\_url']) && strpos($\_SESSION['login\_url'], 'dlattach') !== false) unset($\_SESSION['login\_url']);
 // Create a one time token. createToken('login');}
/\*\* \* Actually logs you in. \* What it does: \* - checks credentials and checks that login was successful. \* - it employs protection against a specific IP or user trying to brute force \* a login to an account. \* - upgrades password encryption on login, if necessary. \* - after successful login, redirects you to $\_SESSION['login\_url']. \* - accessed from ?action=login2, by forms. \* On error, uses the same templates Login() uses. \*/function Login2(){ global $txt, $scripturl, $user\_info, $user\_settings, $smcFunc; global $cookiename, $modSettings, $context, $sourcedir, $maintenance;
 // Check to ensure we're forcing SSL for authentication if (!empty($modSettings['force\_ssl']) && empty($maintenance) && (!isset($\_SERVER['HTTPS']) || $\_SERVER['HTTPS'] != 'on')) fatal\_lang\_error('login\_ssl\_required');
 // Load cookie authentication stuff. require\_once($sourcedir . '/Subs-Auth.php');
 if (!empty($\_SERVER['HTTP\_X\_REQUESTED\_WITH']) && $\_SERVER['HTTP\_X\_REQUESTED\_WITH'] == 'XMLHttpRequest') { $context['from\_ajax'] = true; $context['template\_layers'] = array(); }
 if (isset($\_GET['sa']) && $\_GET['sa'] == 'salt' && !$user\_info['is\_guest']) { if (isset($\_COOKIE[$cookiename]) && preg\_match('~^a:[34]:\{i:0;i:\d{1,7};i:1;s:(0|128):"([a-fA-F0-9]{128})?";i:2;[id]:\d{1,14};(i:3;i:\d;)?\}$~', $\_COOKIE[$cookiename]) === 1) { list (, , $timeout) = json\_decode($\_COOKIE[$cookiename], true);
 // That didn't work... Maybe it's using serialize? if (is\_null($timeout)) list (, , $timeout) = @unserialize($\_COOKIE[$cookiename]); } elseif (isset($\_SESSION['login\_' . $cookiename])) { list (, , $timeout) = json\_decode($\_SESSION['login\_' . $cookiename]);
 // Try for old format if (is\_null($timeout)) list (, , $timeout) = @unserialize($\_SESSION['login\_' . $cookiename]); } else trigger\_error('Login2(): Cannot be logged in without a session or cookie', E\_USER\_ERROR);
 $user\_settings['password\_salt'] = substr(md5(mt\_rand()), 0, 4); updateMemberData($user\_info['id'], array('password\_salt' => $user\_settings['password\_salt']));
 // Preserve the 2FA cookie? if (!empty($modSettings['tfa\_mode']) && !empty($\_COOKIE[$cookiename . '\_tfa'])) { $tfadata = json\_decode($\_COOKIE[$cookiename . '\_tfa'], true);
 // If that didn't work, try unserialize instead... if (is\_null($tfadata)) $tfadata = @unserialize($\_COOKIE[$cookiename . '\_tfa']);
 list ($tfamember, $tfasecret, $exp, $state, $preserve) = $tfadata;
 // If we're preserving the cookie, reset it with updated salt if ($preserve && time() < $exp) setTFACookie(3153600, $user\_info['password\_salt'], hash\_salt($user\_settings['tfa\_backup'], $user\_settings['password\_salt']), true); else setTFACookie(-3600, 0, ''); }
 setLoginCookie($timeout - time(), $user\_info['id'], hash\_salt($user\_settings['passwd'], $user\_settings['password\_salt']));
 redirectexit('action=login2;sa=check;member=' . $user\_info['id'], $context['server']['needs\_login\_fix']); } // Double check the cookie... elseif (isset($\_GET['sa']) && $\_GET['sa'] == 'check') { // Strike! You're outta there! if ($\_GET['member'] != $user\_info['id']) fatal\_lang\_error('login\_cookie\_error', false);
 $user\_info['can\_mod'] = allowedTo('access\_mod\_center') || (!$user\_info['is\_guest'] && ($user\_info['mod\_cache']['gq'] != '0=1' || $user\_info['mod\_cache']['bq'] != '0=1' || ($modSettings['postmod\_active'] && !empty($user\_info['mod\_cache']['ap']))));
 // Some whitelisting for login\_url... if (empty($\_SESSION['login\_url'])) redirectexit(empty($user\_settings['tfa\_secret']) ? '' : 'action=logintfa'); elseif (!empty($\_SESSION['login\_url']) && (strpos($\_SESSION['login\_url'], 'http://') === false && strpos($\_SESSION['login\_url'], 'https://') === false)) { unset ($\_SESSION['login\_url']); redirectexit(empty($user\_settings['tfa\_secret']) ? '' : 'action=logintfa'); } else { // Best not to clutter the session data too much... $temp = $\_SESSION['login\_url']; unset($\_SESSION['login\_url']);
 redirectexit($temp); } }
 // Beyond this point you are assumed to be a guest trying to login. if (!$user\_info['is\_guest']) redirectexit();
 // Are you guessing with a script? checkSession(); $tk = validateToken('login'); spamProtection('login');
 // Set the login\_url if it's not already set (but careful not to send us to an attachment). if ((empty($\_SESSION['login\_url']) && isset($\_SESSION['old\_url']) && strpos($\_SESSION['old\_url'], 'dlattach') === false && preg\_match('~(board|topic)[=,]~', $\_SESSION['old\_url']) != 0) || (isset($\_GET['quicklogin']) && isset($\_SESSION['old\_url']) && strpos($\_SESSION['old\_url'], 'login') === false)) $\_SESSION['login\_url'] = $\_SESSION['old\_url'];
 // Been guessing a lot, haven't we? if (isset($\_SESSION['failed\_login']) && $\_SESSION['failed\_login'] >= $modSettings['failed\_login\_threshold'] \* 3) fatal\_lang\_error('login\_threshold\_fail', 'critical');
 // Set up the cookie length. (if it's invalid, just fall through and use the default.) if (isset($\_POST['cookieneverexp']) || (!empty($\_POST['cookielength']) && $\_POST['cookielength'] == -1)) $modSettings['cookieTime'] = 3153600; elseif (!empty($\_POST['cookielength']) && ($\_POST['cookielength'] >= 1 && $\_POST['cookielength'] <= 525600)) $modSettings['cookieTime'] = (int) $\_POST['cookielength'];
 loadLanguage('Login'); // Load the template stuff. loadTemplate('Login'); $context['sub\_template'] = 'login';
 // Set up the default/fallback stuff. $context['default\_username'] = isset($\_POST['user']) ? preg\_replace('~&amp;#(\\d{1,7}|x[0-9a-fA-F]{1,6});~', '&#\\1;', $smcFunc['htmlspecialchars']($\_POST['user'])) : ''; $context['default\_password'] = ''; $context['never\_expire'] = $modSettings['cookieTime'] == 525600 || $modSettings['cookieTime'] == 3153600; $context['login\_errors'] = array($txt['error\_occured']); $context['page\_title'] = $txt['login'];
 // Add the login chain to the link tree. $context['linktree'][] = array( 'url' => $scripturl . '?action=login', 'name' => $txt['login'], );
 // You forgot to type your username, dummy! if (!isset($\_POST['user']) || $\_POST['user'] == '') { $context['login\_errors'] = array($txt['need\_username']); return; }
 // Hmm... maybe 'admin' will login with no password. Uhh... NO! if (!isset($\_POST['passwrd']) || $\_POST['passwrd'] == '') { $context['login\_errors'] = array($txt['no\_password']); return; }
 // No funky symbols either. if (preg\_match('~[<>&"\'=\\\]~', preg\_replace('~(&#(\\d{1,7}|x[0-9a-fA-F]{1,6});)~', '', $\_POST['user'])) != 0) { $context['login\_errors'] = array($txt['error\_invalid\_characters\_username']); return; }
 // And if it's too long, trim it back. if ($smcFunc['strlen']($\_POST['user']) > 80) { $\_POST['user'] = $smcFunc['substr']($\_POST['user'], 0, 79); $context['default\_username'] = preg\_replace('~&amp;#(\\d{1,7}|x[0-9a-fA-F]{1,6});~', '&#\\1;', $smcFunc['htmlspecialchars']($\_POST['user'])); }
 // Load the data up! $request = $smcFunc['db\_query']('', ' SELECT passwd, id\_member, id\_group, lngfile, is\_activated, email\_address, additional\_groups, member\_name, password\_salt, passwd\_flood, tfa\_secret FROM {db\_prefix}members WHERE ' . ($smcFunc['db\_case\_sensitive'] ? 'LOWER(member\_name) = LOWER({string:user\_name})' : 'member\_name = {string:user\_name}') . ' LIMIT 1', array( 'user\_name' => $smcFunc['db\_case\_sensitive'] ? strtolower($\_POST['user']) : $\_POST['user'], ) ); // Probably mistyped or their email, try it as an email address. (member\_name first, though!) if ($smcFunc['db\_num\_rows']($request) == 0 && strpos($\_POST['user'], '@') !== false) { $smcFunc['db\_free\_result']($request);
 $request = $smcFunc['db\_query']('', ' SELECT passwd, id\_member, id\_group, lngfile, is\_activated, email\_address, additional\_groups, member\_name, password\_salt, passwd\_flood, tfa\_secret FROM {db\_prefix}members WHERE email\_address = {string:user\_name} LIMIT 1', array( 'user\_name' => $\_POST['user'], ) ); }
 // Let them try again, it didn't match anything... if ($smcFunc['db\_num\_rows']($request) == 0) { $context['login\_errors'] = array($txt['username\_no\_exist']); return; }
 $user\_settings = $smcFunc['db\_fetch\_assoc']($request); $smcFunc['db\_free\_result']($request);
 // Bad password! Thought you could fool the database?! if (!hash\_verify\_password($user\_settings['member\_name'], un\_htmlspecialchars($\_POST['passwrd']), $user\_settings['passwd'])) { // Let's be cautious, no hacking please. thanx. validatePasswordFlood($user\_settings['id\_member'], $user\_settings['passwd\_flood']);
 // Maybe we were too hasty... let's try some other authentication methods. $other\_passwords = array();
 // None of the below cases will be used most of the time (because the salt is normally set.) if (!empty($modSettings['enable\_password\_conversion']) && $user\_settings['password\_salt'] == '') { // YaBB SE, Discus, MD5 (used a lot), SHA-1 (used some), SMF 1.0.x, IkonBoard, and none at all. $other\_passwords[] = crypt($\_POST['passwrd'], substr($\_POST['passwrd'], 0, 2)); $other\_passwords[] = crypt($\_POST['passwrd'], substr($user\_settings['passwd'], 0, 2)); $other\_passwords[] = md5($\_POST['passwrd']); $other\_passwords[] = sha1($\_POST['passwrd']); $other\_passwords[] = md5\_hmac($\_POST['passwrd'], strtolower($user\_settings['member\_name'])); $other\_passwords[] = md5($\_POST['passwrd'] . strtolower($user\_settings['member\_name'])); $other\_passwords[] = md5(md5($\_POST['passwrd'])); $other\_passwords[] = $\_POST['passwrd'];
 // This one is a strange one... MyPHP, crypt() on the MD5 hash. $other\_passwords[] = crypt(md5($\_POST['passwrd']), md5($\_POST['passwrd']));
 // Snitz style - SHA-256. Technically, this is a downgrade, but most PHP configurations don't support sha256 anyway. if (strlen($user\_settings['passwd']) == 64 && function\_exists('mhash') && defined('MHASH\_SHA256')) $other\_passwords[] = bin2hex(mhash(MHASH\_SHA256, $\_POST['passwrd']));
 // phpBB3 users new hashing. We now support it as well ;). $other\_passwords[] = phpBB3\_password\_check($\_POST['passwrd'], $user\_settings['passwd']);
 // APBoard 2 Login Method. $other\_passwords[] = md5(crypt($\_POST['passwrd'], 'CRYPT\_MD5')); } // The hash should be 40 if it's SHA-1, so we're safe with more here too. elseif (!empty($modSettings['enable\_password\_conversion']) && strlen($user\_settings['passwd']) == 32) { // vBulletin 3 style hashing? Let's welcome them with open arms \o/. $other\_passwords[] = md5(md5($\_POST['passwrd']) . stripslashes($user\_settings['password\_salt']));
 // Hmm.. p'raps it's Invision 2 style? $other\_passwords[] = md5(md5($user\_settings['password\_salt']) . md5($\_POST['passwrd']));
 // Some common md5 ones. $other\_passwords[] = md5($user\_settings['password\_salt'] . $\_POST['passwrd']); $other\_passwords[] = md5($\_POST['passwrd'] . $user\_settings['password\_salt']); } elseif (strlen($user\_settings['passwd']) == 40) { // Maybe they are using a hash from before the password fix. // This is also valid for SMF 1.1 to 2.0 style of hashing, changed to bcrypt in SMF 2.1 $other\_passwords[] = sha1(strtolower($user\_settings['member\_name']) . un\_htmlspecialchars($\_POST['passwrd']));
 // BurningBoard3 style of hashing. if (!empty($modSettings['enable\_password\_conversion'])) $other\_passwords[] = sha1($user\_settings['password\_salt'] . sha1($user\_settings['password\_salt'] . sha1($\_POST['passwrd'])));
 // Perhaps we converted to UTF-8 and have a valid password being hashed differently. if ($context['character\_set'] == 'utf8' && !empty($modSettings['previousCharacterSet']) && $modSettings['previousCharacterSet'] != 'utf8') { // Try iconv first, for no particular reason. if (function\_exists('iconv')) $other\_passwords['iconv'] = sha1(strtolower(iconv('UTF-8', $modSettings['previousCharacterSet'], $user\_settings['member\_name'])) . un\_htmlspecialchars(iconv('UTF-8', $modSettings['previousCharacterSet'], $\_POST['passwrd'])));
 // Say it aint so, iconv failed! if (empty($other\_passwords['iconv']) && function\_exists('mb\_convert\_encoding')) $other\_passwords[] = sha1(strtolower(mb\_convert\_encoding($user\_settings['member\_name'], 'UTF-8', $modSettings['previousCharacterSet'])) . un\_htmlspecialchars(mb\_convert\_encoding($\_POST['passwrd'], 'UTF-8', $modSettings['previousCharacterSet']))); } }
 // SMF's sha1 function can give a funny result on Linux (Not our fault!). If we've now got the real one let the old one be valid! if (stripos(PHP\_OS, 'win') !== 0 && strlen($user\_settings['passwd']) < hash\_length()) { require\_once($sourcedir . '/Subs-Compat.php'); $other\_passwords[] = sha1\_smf(strtolower($user\_settings['member\_name']) . un\_htmlspecialchars($\_POST['passwrd'])); }
 // Allows mods to easily extend the $other\_passwords array call\_integration\_hook('integrate\_other\_passwords', array(&$other\_passwords));
 // Whichever encryption it was using, let's make it use SMF's now ;). if (in\_array($user\_settings['passwd'], $other\_passwords)) { $user\_settings['passwd'] = hash\_password($user\_settings['member\_name'], un\_htmlspecialchars($\_POST['passwrd'])); $user\_settings['password\_salt'] = substr(md5(mt\_rand()), 0, 4);
 // Update the password and set up the hash. updateMemberData($user\_settings['id\_member'], array('passwd' => $user\_settings['passwd'], 'password\_salt' => $user\_settings['password\_salt'], 'passwd\_flood' => '')); } // Okay, they for sure didn't enter the password! else { // They've messed up again - keep a count to see if they need a hand. $\_SESSION['failed\_login'] = isset($\_SESSION['failed\_login']) ? ($\_SESSION['failed\_login'] + 1) : 1;
 // Hmm... don't remember it, do you? Here, try the password reminder ;). if ($\_SESSION['failed\_login'] >= $modSettings['failed\_login\_threshold']) redirectexit('action=reminder'); // We'll give you another chance... else { // Log an error so we know that it didn't go well in the error log. log\_error($txt['incorrect\_password'] . ' - <span class="remove">' . $user\_settings['member\_name'] . '</span>', 'user');
 $context['login\_errors'] = array($txt['incorrect\_password']); return; } } } elseif (!empty($user\_settings['passwd\_flood'])) { // Let's be sure they weren't a little hacker. validatePasswordFlood($user\_settings['id\_member'], $user\_settings['passwd\_flood'], true);
 // If we got here then we can reset the flood counter. updateMemberData($user\_settings['id\_member'], array('passwd\_flood' => '')); }
 // Correct password, but they've got no salt; fix it! if ($user\_settings['password\_salt'] == '') { $user\_settings['password\_salt'] = substr(md5(mt\_rand()), 0, 4); updateMemberData($user\_settings['id\_member'], array('password\_salt' => $user\_settings['password\_salt'])); }
 // Check their activation status. if (!checkActivation()) return;
 DoLogin();}
/\*\* \* Allows the user to enter their Two-Factor Authentication code \*/function LoginTFA(){ global $sourcedir, $txt, $context, $user\_info, $modSettings, $scripturl;
 if (!$user\_info['is\_guest'] || empty($context['tfa\_member']) || empty($modSettings['tfa\_mode'])) fatal\_lang\_error('no\_access', false);
 loadLanguage('Profile'); require\_once($sourcedir . '/Class-TOTP.php');
 $member = $context['tfa\_member'];
 // Prevent replay attacks by limiting at least 2 minutes before they can log in again via 2FA if (time() - $member['last\_login'] < 120) fatal\_lang\_error('tfa\_wait', false);
 $totp = new \TOTP\Auth($member['tfa\_secret']); $totp->setRange(1);
 if (!empty($\_SERVER['HTTP\_X\_REQUESTED\_WITH']) && $\_SERVER['HTTP\_X\_REQUESTED\_WITH'] == 'XMLHttpRequest') { $context['from\_ajax'] = true; $context['template\_layers'] = array(); }
 if (!empty($\_POST['tfa\_code']) && empty($\_POST['tfa\_backup'])) { // Check to ensure we're forcing SSL for authentication if (!empty($modSettings['force\_ssl']) && empty($maintenance) && (!isset($\_SERVER['HTTPS']) || $\_SERVER['HTTPS'] != 'on')) fatal\_lang\_error('login\_ssl\_required');
 $code = $\_POST['tfa\_code'];
 if (strlen($code) == $totp->getCodeLength() && $totp->validateCode($code)) { updateMemberData($member['id\_member'], array('last\_login' => time()));
 setTFACookie(3153600, $member['id\_member'], hash\_salt($member['tfa\_backup'], $member['password\_salt']), !empty($\_POST['tfa\_preserve'])); redirectexit(); } else { validatePasswordFlood($member['id\_member'], $member['passwd\_flood'], false, true);
 $context['tfa\_error'] = true; $context['tfa\_value'] = $\_POST['tfa\_code']; } } elseif (!empty($\_POST['tfa\_backup'])) { // Check to ensure we're forcing SSL for authentication if (!empty($modSettings['force\_ssl']) && empty($maintenance) && (!isset($\_SERVER['HTTPS']) || $\_SERVER['HTTPS'] != 'on')) fatal\_lang\_error('login\_ssl\_required');
 $backup = $\_POST['tfa\_backup'];
 if (hash\_verify\_password($member['member\_name'], $backup, $member['tfa\_backup'])) { // Get rid of their current TFA settings updateMemberData($member['id\_member'], array( 'tfa\_secret' => '', 'tfa\_backup' => '', 'last\_login' => time(), )); setTFACookie(3153600, $member['id\_member'], hash\_salt($member['tfa\_backup'], $member['password\_salt'])); redirectexit('action=profile;area=tfasetup;backup'); } else { validatePasswordFlood($member['id\_member'], $member['passwd\_flood'], false, true);
 $context['tfa\_backup\_error'] = true; $context['tfa\_value'] = $\_POST['tfa\_code']; $context['tfa\_backup\_value'] = $\_POST['tfa\_backup']; } }
 loadTemplate('Login'); $context['sub\_template'] = 'login\_tfa'; $context['page\_title'] = $txt['login']; $context['tfa\_url'] = (!empty($modSettings['force\_ssl']) && $modSettings['force\_ssl'] < 2 ? strtr($scripturl, array('http://' => 'https://')) : $scripturl) . '?action=logintfa';}
/\*\* \* Check activation status of the current user. \*/function checkActivation(){ global $context, $txt, $scripturl, $user\_settings, $modSettings;
 if (!isset($context['login\_errors'])) $context['login\_errors'] = array();
 // What is the true activation status of this account? $activation\_status = $user\_settings['is\_activated'] > 10 ? $user\_settings['is\_activated'] - 10 : $user\_settings['is\_activated'];
 // Check if the account is activated - COPPA first... if ($activation\_status == 5) { $context['login\_errors'][] = $txt['coppa\_no\_concent'] . ' <a href="' . $scripturl . '?action=coppa;member=' . $user\_settings['id\_member'] . '">' . $txt['coppa\_need\_more\_details'] . '</a>'; return false; } // Awaiting approval still? elseif ($activation\_status == 3) fatal\_lang\_error('still\_awaiting\_approval', 'user'); // Awaiting deletion, changed their mind? elseif ($activation\_status == 4) { if (isset($\_REQUEST['undelete'])) { updateMemberData($user\_settings['id\_member'], array('is\_activated' => 1)); updateSettings(array('unapprovedMembers' => ($modSettings['unapprovedMembers'] > 0 ? $modSettings['unapprovedMembers'] - 1 : 0))); } else { $context['disable\_login\_hashing'] = true; $context['login\_errors'][] = $txt['awaiting\_delete\_account']; $context['login\_show\_undelete'] = true; return false; } } // Standard activation? elseif ($activation\_status != 1) { log\_error($txt['activate\_not\_completed1'] . ' - <span class="remove">' . $user\_settings['member\_name'] . '</span>', false);
 $context['login\_errors'][] = $txt['activate\_not\_completed1'] . ' <a href="' . $scripturl . '?action=activate;sa=resend;u=' . $user\_settings['id\_member'] . '">' . $txt['activate\_not\_completed2'] . '</a>'; return false; } return true;}
/\*\* \* Perform the logging in. (set cookie, call hooks, etc) \*/function DoLogin(){ global $user\_info, $user\_settings, $smcFunc; global $maintenance, $modSettings, $context, $sourcedir;
 // Load cookie authentication stuff. require\_once($sourcedir . '/Subs-Auth.php');
 // Call login integration functions. call\_integration\_hook('integrate\_login', array($user\_settings['member\_name'], null, $modSettings['cookieTime']));
 // Get ready to set the cookie... $username = $user\_settings['member\_name']; $user\_info['id'] = $user\_settings['id\_member'];
 // Bam! Cookie set. A session too, just in case. setLoginCookie(60 \* $modSettings['cookieTime'], $user\_settings['id\_member'], hash\_salt($user\_settings['passwd'], $user\_settings['password\_salt']));
 // Reset the login threshold. if (isset($\_SESSION['failed\_login'])) unset($\_SESSION['failed\_login']);
 $user\_info['is\_guest'] = false; $user\_settings['additional\_groups'] = explode(',', $user\_settings['additional\_groups']); $user\_info['is\_admin'] = $user\_settings['id\_group'] == 1 || in\_array(1, $user\_settings['additional\_groups']);
 // Are you banned? is\_not\_banned(true);
 // Don't stick the language or theme after this point. unset($\_SESSION['language'], $\_SESSION['id\_theme']);
 // First login? $request = $smcFunc['db\_query']('', ' SELECT last\_login FROM {db\_prefix}members WHERE id\_member = {int:id\_member} AND last\_login = 0', array( 'id\_member' => $user\_info['id'], ) ); if ($smcFunc['db\_num\_rows']($request) == 1) $\_SESSION['first\_login'] = true; else unset($\_SESSION['first\_login']); $smcFunc['db\_free\_result']($request);
 // You've logged in, haven't you? $update = array('member\_ip' => $user\_info['ip'], 'member\_ip2' => $\_SERVER['BAN\_CHECK\_IP']); if (empty($user\_settings['tfa\_secret'])) $update['last\_login'] = time(); updateMemberData($user\_info['id'], $update);
 // Get rid of the online entry for that old guest.... $smcFunc['db\_query']('', ' DELETE FROM {db\_prefix}log\_online WHERE session = {string:session}', array( 'session' => 'ip' . $user\_info['ip'], ) ); $\_SESSION['log\_time'] = 0;
 // Log this entry, only if we have it enabled. if (!empty($modSettings['loginHistoryDays'])) $smcFunc['db\_insert']('insert', '{db\_prefix}member\_logins', array( 'id\_member' => 'int', 'time' => 'int', 'ip' => 'string', 'ip2' => 'string', ), array( $user\_info['id'], time(), $user\_info['ip'], $user\_info['ip2'] ), array( 'id\_member', 'time' ) );
 // Just log you back out if it's in maintenance mode and you AREN'T an admin. if (empty($maintenance) || allowedTo('admin\_forum')) redirectexit('action=login2;sa=check;member=' . $user\_info['id'], $context['server']['needs\_login\_fix']); else redirectexit('action=logout;' . $context['session\_var'] . '=' . $context['session\_id'], $context['server']['needs\_login\_fix']);}
/\*\* \* Logs the current user out of their account. \* It requires that the session hash is sent as well, to prevent automatic logouts by images or javascript. \* It redirects back to $\_SESSION['logout\_url'], if it exists. \* It is accessed via ?action=logout;session\_var=... \* \* @param bool $internal If true, it doesn't check the session \* @param bool $redirect Whether or not to redirect the user after they log out \*/function Logout($internal = false, $redirect = true){ global $sourcedir, $user\_info, $user\_settings, $context, $smcFunc, $cookiename, $modSettings;
 // Make sure they aren't being auto-logged out. if (!$internal) checkSession('get');
 require\_once($sourcedir . '/Subs-Auth.php');
 if (isset($\_SESSION['pack\_ftp'])) $\_SESSION['pack\_ftp'] = null;
 // It won't be first login anymore. unset($\_SESSION['first\_login']);
 // Just ensure they aren't a guest! if (!$user\_info['is\_guest']) { // Pass the logout information to integrations. call\_integration\_hook('integrate\_logout', array($user\_settings['member\_name']));
 // If you log out, you aren't online anymore :P. $smcFunc['db\_query']('', ' DELETE FROM {db\_prefix}log\_online WHERE id\_member = {int:current\_member}', array( 'current\_member' => $user\_info['id'], ) ); }
 $\_SESSION['log\_time'] = 0;
 // Empty the cookie! (set it in the past, and for id\_member = 0) setLoginCookie(-3600, 0);
 // And some other housekeeping while we're at it. $salt = substr(md5(mt\_rand()), 0, 4); if (!empty($user\_info['id'])) updateMemberData($user\_info['id'], array('password\_salt' => $salt));
 if (!empty($modSettings['tfa\_mode']) && !empty($user\_info['id']) && !empty($\_COOKIE[$cookiename . '\_tfa'])) { $tfadata = json\_decode($\_COOKIE[$cookiename . '\_tfa'], true);
 // If that failed, try the old method if (is\_null($tfadata)) $tfadata = @unserialize($\_COOKIE[$cookiename . '\_tfa']);
 list ($tfamember, $tfasecret, $exp, $state, $preserve) = $tfadata;
 // If we're preserving the cookie, reset it with updated salt if ($preserve && time() < $exp) setTFACookie(3153600, $user\_info['id'], hash\_salt($user\_settings['tfa\_backup'], $salt), true); else setTFACookie(-3600, 0, ''); }
 session\_destroy();
 // Off to the merry board index we go! if ($redirect) { if (empty($\_SESSION['logout\_url'])) redirectexit('', $context['server']['needs\_login\_fix']); elseif (!empty($\_SESSION['logout\_url']) && (strpos($\_SESSION['logout\_url'], 'http://') === false && strpos($\_SESSION['logout\_url'], 'https://') === false)) { unset ($\_SESSION['logout\_url']); redirectexit(); } else { $temp = $\_SESSION['logout\_url']; unset($\_SESSION['logout\_url']);
 redirectexit($temp, $context['server']['needs\_login\_fix']); } }}
/\*\* \* MD5 Encryption used for older passwords. (SMF 1.0.x/YaBB SE 1.5.x hashing) \* \* @param string $data The data \* @param string $key The key \* @return string The HMAC MD5 of data with key \*/function md5\_hmac($data, $key){ $key = str\_pad(strlen($key) <= 64 ? $key : pack('H\*', md5($key)), 64, chr(0x00)); return md5(($key ^ str\_repeat(chr(0x5c), 64)) . pack('H\*', md5(($key ^ str\_repeat(chr(0x36), 64)) . $data)));}
/\*\* \* Custom encryption for phpBB3 based passwords. \* \* @param string $passwd The raw (unhashed) password \* @param string $passwd\_hash The hashed password \* @return string The hashed version of $passwd \*/function phpBB3\_password\_check($passwd, $passwd\_hash){ // Too long or too short? if (strlen($passwd\_hash) != 34) return;
 // Range of characters allowed. $range = './0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
 // Tests $strpos = strpos($range, $passwd\_hash[3]); $count = 1 << $strpos; $count2 = $count; $salt = substr($passwd\_hash, 4, 8);
 $hash = md5($salt . $passwd, true); for (; $count != 0; --$count) $hash = md5($hash . $passwd, true);
 $output = substr($passwd\_hash, 0, 12); $i = 0; while ($i < 16) { $value = ord($hash[$i++]); $output .= $range[$value & 0x3f];
 if ($i < 16) $value |= ord($hash[$i]) << 8;
 $output .= $range[($value >> 6) & 0x3f];
 if ($i++ >= 16) break;
 if ($i < 16) $value |= ord($hash[$i]) << 16;
 $output .= $range[($value >> 12) & 0x3f];
 if ($i++ >= 16) break;
 $output .= $range[($value >> 18) & 0x3f]; }
 // Return now. return $output;}
/\*\* \* This protects against brute force attacks on a member's password. \* Importantly, even if the password was right we DON'T TELL THEM! \* \* @param int $id\_member The ID of the member \* @param bool|string $password\_flood\_value False if we don't have a flood value, otherwise a string with a timestamp and number of tries separated by a | \* @param bool $was\_correct Whether or not the password was correct \* @param bool $tfa Whether we're validating for two-factor authentication \*/function validatePasswordFlood($id\_member, $password\_flood\_value = false, $was\_correct = false, $tfa = false){ global $cookiename, $sourcedir;
 // As this is only brute protection, we allow 5 attempts every 10 seconds.
 // Destroy any session or cookie data about this member, as they validated wrong. // Only if they're not validating for 2FA if (!$tfa) { require\_once($sourcedir . '/Subs-Auth.php'); setLoginCookie(-3600, 0);
 if (isset($\_SESSION['login\_' . $cookiename])) unset($\_SESSION['login\_' . $cookiename]); }
 // We need a member! if (!$id\_member) { // Redirect back! redirectexit();
 // Probably not needed, but still make sure... fatal\_lang\_error('no\_access', false); }
 // Right, have we got a flood value? if ($password\_flood\_value !== false) @list ($time\_stamp, $number\_tries) = explode('|', $password\_flood\_value);
 // Timestamp or number of tries invalid? if (empty($number\_tries) || empty($time\_stamp)) { $number\_tries = 0; $time\_stamp = time(); }
 // They've failed logging in already if (!empty($number\_tries)) { // Give them less chances if they failed before $number\_tries = $time\_stamp < time() - 20 ? 2 : $number\_tries;
 // They are trying too fast, make them wait longer if ($time\_stamp < time() - 10) $time\_stamp = time(); }
 $number\_tries++;
 // Broken the law? if ($number\_tries > 5) fatal\_lang\_error('login\_threshold\_brute\_fail', 'critical');
 // Otherwise set the members data. If they correct on their first attempt then we actually clear it, otherwise we set it! updateMemberData($id\_member, array('passwd\_flood' => $was\_correct && $number\_tries == 1 ? '' : $time\_stamp . '|' . $number\_tries));
}
?>

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_0ff2182b_20250124_204638.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](8) [[thread-next>]](../../../2016/06/18/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAKws9z0qx_7spQTw9Z3vrV1hRa8so=G-1T7eegnLuMzTp0H59Q@mail.gmail.com>
Date: Fri, 10 Jun 2016 13:56:14 -0400
From: Scott Arciszewski <scott@...agonie.com>
To: oss-security@...ts.openwall.com
Subject: Simple Machines Forums - PHP Object Injection

I reported the following PHP Object Injection vulnerabilities to the SMF
development team on March 9, 2016:

<https://github.com/SimpleMachines/SMF2.1/blob/404fd5347951652624dfb72304ee38fcab98378f/Sources/Packages.php#L863-L873>

<https://github.com/SimpleMachines/SMF2.1/blob/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources/LogInOut.php#L125-L129>

In the first case, you can achieve PHP Object Injection by sending
themechanges[]=serialized+object+here in the POST data of an HTTP request.

It looks like someone had attempted to find+replace all the obvious PHP
Object Injection issues (i.e. unserialize($_POST['foo'])) at some point,
but they didn't look for variables directly derived from user input.
(foreach ($_POST['foo'] as $bar)).

I've sent follow-up emails to the development team but was never notified
of any progress towards fixing it.

The first one appears to have been fixed in the release-2.1 branch, but the
other one still exists.

<https://github.com/SimpleMachines/SMF2.1/blob/release-2.1/Sources/Packages.php#L872-L882>
is fixed

<https://github.com/SimpleMachines/SMF2.1/blob/release-2.1/Sources/LogInOut.php#L125-L129>
is unfixed

That's all from me.

Scott Arciszewski
Chief Development Officer
Paragon Initiative Enterprises <<https://paragonie.com>>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_10f26ba5_20250126_032522.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fblob%2F404fd5347951652624dfb72304ee38fcab98378f%2FSources%2FPackages.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fblob%2F404fd5347951652624dfb72304ee38fcab98378f%2FSources%2FPackages.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=SimpleMachines%2FSMF)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SimpleMachines](/SimpleMachines)
/
**[SMF](/SimpleMachines/SMF)**
Public

* [Notifications](/login?return_to=%2FSimpleMachines%2FSMF) You must be signed in to change notification settings
* [Fork
  255](/login?return_to=%2FSimpleMachines%2FSMF)
* [Star
   615](/login?return_to=%2FSimpleMachines%2FSMF)

* [Code](/SimpleMachines/SMF)
* [Issues
  171](/SimpleMachines/SMF/issues)
* [Pull requests
  44](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects
  0](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

Additional navigation options

* [Code](/SimpleMachines/SMF)
* [Issues](/SimpleMachines/SMF/issues)
* [Pull requests](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

## Files

 404fd53
## Breadcrumbs

1. [SMF](/SimpleMachines/SMF/tree/404fd5347951652624dfb72304ee38fcab98378f)
2. /[Sources](/SimpleMachines/SMF/tree/404fd5347951652624dfb72304ee38fcab98378f/Sources)
/
# Packages.php

Copy path Blame  Blame
## Latest commit

## History

[History](/SimpleMachines/SMF/commits/404fd5347951652624dfb72304ee38fcab98378f/Sources/Packages.php)2621 lines (2297 loc) · 91.4 KB 404fd53
## Breadcrumbs

1. [SMF](/SimpleMachines/SMF/tree/404fd5347951652624dfb72304ee38fcab98378f)
2. /[Sources](/SimpleMachines/SMF/tree/404fd5347951652624dfb72304ee38fcab98378f/Sources)
/
# Packages.php

Top
## File metadata and controls

* Code
* Blame

2621 lines (2297 loc) · 91.4 KB[Raw](https://github.com/SimpleMachines/SMF/raw/404fd5347951652624dfb72304ee38fcab98378f/Sources/Packages.php)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000<?php
/\*\* \* This file is the main Package Manager. \* \* Simple Machines Forum (SMF) \* \* @package SMF \* @author Simple Machines http://www.simplemachines.org \* @copyright 2012 Simple Machines \* @license http://www.simplemachines.org/about/smf/license.php BSD \* \* @version 2.1 Alpha 1 \*/
if (!defined('SMF')) die('Hacking attempt...');
/\*\* \* This is the notoriously defunct package manager..... :/. \*/function Packages(){ global $txt, $scripturl, $sourcedir, $context;
 // @todo Remove this! if (isset($\_GET['get']) || isset($\_GET['pgdownload'])) { require\_once($sourcedir . '/PackageGet.php'); return PackageGet(); }
 isAllowedTo('admin\_forum');
 // Load all the basic stuff. require\_once($sourcedir . '/Subs-Package.php'); loadLanguage('Packages'); loadTemplate('Packages', 'admin');
 $context['page\_title'] = $txt['package'];
 // Delegation makes the world... that is, the package manager go 'round. $subActions = array( 'browse' => 'PackageBrowse', 'remove' => 'PackageRemove', 'list' => 'PackageList', 'ftptest' => 'PackageFTPTest', 'install' => 'PackageInstallTest', 'install2' => 'PackageInstall', 'uninstall' => 'PackageInstallTest', 'uninstall2' => 'PackageInstall', 'installed' => 'PackageBrowse', 'options' => 'PackageOptions', 'perms' => 'PackagePermissions', 'flush' => 'FlushInstall', 'examine' => 'ExamineFile', 'showoperations' => 'ViewOperations', );
 // Work out exactly who it is we are calling. if (isset($\_REQUEST['sa']) && isset($subActions[$\_REQUEST['sa']])) $context['sub\_action'] = $\_REQUEST['sa']; else $context['sub\_action'] = 'browse';
 // Set up some tabs... $context[$context['admin\_menu\_name']]['tab\_data'] = array( 'title' => $txt['package\_manager'], // @todo 'help' => 'registrations', 'description' => $txt['package\_manager\_desc'], 'tabs' => array( 'browse' => array( ), 'packageget' => array( 'description' => $txt['download\_packages\_desc'], ), 'installed' => array( 'description' => $txt['installed\_packages\_desc'], ), 'perms' => array( 'description' => $txt['package\_file\_perms\_desc'], ), 'options' => array( 'description' => $txt['package\_install\_options\_desc'], ), ), );
 // Call the function we're handing control to. $subActions[$context['sub\_action']]();}
/\*\* \* Test install a package. \*/function PackageInstallTest(){ global $boarddir, $txt, $context, $scripturl, $sourcedir, $modSettings, $smcFunc, $settings;
 // You have to specify a file!! if (!isset($\_REQUEST['package']) || $\_REQUEST['package'] == '') redirectexit('action=admin;area=packages'); $context['filename'] = preg\_replace('~[\.]+~', '.', $\_REQUEST['package']);
 // Do we have an existing id, for uninstalls and the like. $context['install\_id'] = isset($\_REQUEST['pid']) ? (int) $\_REQUEST['pid'] : 0;
 require\_once($sourcedir . '/Subs-Package.php');
 // Load up the package FTP information? create\_chmod\_control();
 // Make sure temp directory exists and is empty. if (file\_exists($boarddir . '/Packages/temp')) deltree($boarddir . '/Packages/temp', false);
 if (!mktree($boarddir . '/Packages/temp', 0755)) { deltree($boarddir . '/Packages/temp', false); if (!mktree($boarddir . '/Packages/temp', 0777)) { deltree($boarddir . '/Packages/temp', false); create\_chmod\_control(array($boarddir . '/Packages/temp/delme.tmp'), array('destination\_url' => $scripturl . '?action=admin;area=packages;sa=' . $\_REQUEST['sa'] . ';package=' . $\_REQUEST['package'], 'crash\_on\_error' => true));
 deltree($boarddir . '/Packages/temp', false); if (!mktree($boarddir . '/Packages/temp', 0777)) fatal\_lang\_error('package\_cant\_download', false); } }
 $context['uninstalling'] = $\_REQUEST['sa'] == 'uninstall';
 // Change our last link tree item for more information on this Packages area. $context['linktree'][count($context['linktree']) - 1] = array( 'url' => $scripturl . '?action=admin;area=packages;sa=browse', 'name' => $context['uninstalling'] ? $txt['package\_uninstall\_actions'] : $txt['install\_actions'] ); $context['page\_title'] .= ' - ' . ($context['uninstalling'] ? $txt['package\_uninstall\_actions'] : $txt['install\_actions']);
 $context['sub\_template'] = 'view\_package';
 if (!file\_exists($boarddir . '/Packages/' . $context['filename'])) { deltree($boarddir . '/Packages/temp'); fatal\_lang\_error('package\_no\_file', false); }
 // Extract the files so we can get things like the readme, etc. if (is\_file($boarddir . '/Packages/' . $context['filename'])) { $context['extracted\_files'] = read\_tgz\_file($boarddir . '/Packages/' . $context['filename'], $boarddir . '/Packages/temp');
 if ($context['extracted\_files'] && !file\_exists($boarddir . '/Packages/temp/package-info.xml')) foreach ($context['extracted\_files'] as $file) if (basename($file['filename']) == 'package-info.xml') { $context['base\_path'] = dirname($file['filename']) . '/'; break; }
 if (!isset($context['base\_path'])) $context['base\_path'] = ''; } elseif (is\_dir($boarddir . '/Packages/' . $context['filename'])) { copytree($boarddir . '/Packages/' . $context['filename'], $boarddir . '/Packages/temp'); $context['extracted\_files'] = listtree($boarddir . '/Packages/temp'); $context['base\_path'] = ''; } else fatal\_lang\_error('no\_access', false);
 // Load up any custom themes we may want to install into... $request = $smcFunc['db\_query']('', ' SELECT id\_theme, variable, value FROM {db\_prefix}themes WHERE (id\_theme = {int:default\_theme} OR id\_theme IN ({array\_int:known\_theme\_list})) AND variable IN ({string:name}, {string:theme\_dir})', array( 'known\_theme\_list' => explode(',', $modSettings['knownThemes']), 'default\_theme' => 1, 'name' => 'name', 'theme\_dir' => 'theme\_dir', ) ); $theme\_paths = array(); while ($row = $smcFunc['db\_fetch\_assoc']($request)) $theme\_paths[$row['id\_theme']][$row['variable']] = $row['value']; $smcFunc['db\_free\_result']($request);
 // Get the package info... $packageInfo = getPackageInfo($context['filename']);
 if (!is\_array($packageInfo)) fatal\_lang\_error($packageInfo);
 $packageInfo['filename'] = $context['filename']; $context['package\_name'] = isset($packageInfo['name']) ? $packageInfo['name'] : $context['filename'];
 // Set the type of extraction... $context['extract\_type'] = isset($packageInfo['type']) ? $packageInfo['type'] : 'modification';
 // The mod isn't installed.... unless proven otherwise. $context['is\_installed'] = false;
 // See if it is installed? $request = $smcFunc['db\_query']('', ' SELECT version, themes\_installed, db\_changes FROM {db\_prefix}log\_packages WHERE package\_id = {string:current\_package} AND install\_state != {int:not\_installed} ORDER BY time\_installed DESC LIMIT 1', array( 'not\_installed' => 0, 'current\_package' => $packageInfo['id'], ) );
 while ($row = $smcFunc['db\_fetch\_assoc']($request)) { $old\_themes = explode(',', $row['themes\_installed']); $old\_version = $row['version']; $db\_changes = empty($row['db\_changes']) ? array() : unserialize($row['db\_changes']); } $smcFunc['db\_free\_result']($request);
 $context['database\_changes'] = array(); if (!empty($db\_changes)) { foreach ($db\_changes as $change) { if (isset($change[2]) && isset($txt['package\_db\_' . $change[0]])) $context['database\_changes'][] = sprintf($txt['package\_db\_' . $change[0]], $change[1], $change[2]); elseif (isset($txt['package\_db\_' . $change[0]])) $context['database\_changes'][] = sprintf($txt['package\_db\_' . $change[0]], $change[1]); else $context['database\_changes'][] = $change[0] . '-' . $change[1] . (isset($change[2]) ? '-' . $change[2] : ''); } }
 // Uninstalling? if ($context['uninstalling']) { // Wait, it's not installed yet! if (!isset($old\_version) && $context['uninstalling']) { deltree($boarddir . '/Packages/temp'); fatal\_lang\_error('package\_cant\_uninstall', false); }
 $actions = parsePackageInfo($packageInfo['xml'], true, 'uninstall');
 // Gadzooks! There's no uninstaller at all!? if (empty($actions)) { deltree($boarddir . '/Packages/temp'); fatal\_lang\_error('package\_uninstall\_cannot', false); }
 // Can't edit the custom themes it's edited if you're unisntalling, they must be removed. $context['themes\_locked'] = true;
 // Only let them uninstall themes it was installed into. foreach ($theme\_paths as $id => $data) if ($id != 1 && !in\_array($id, $old\_themes)) unset($theme\_paths[$id]); } elseif (isset($old\_version) && $old\_version != $packageInfo['version']) { // Look for an upgrade... $actions = parsePackageInfo($packageInfo['xml'], true, 'upgrade', $old\_version);
 // There was no upgrade.... if (empty($actions)) $context['is\_installed'] = true; else { // Otherwise they can only upgrade themes from the first time around. foreach ($theme\_paths as $id => $data) if ($id != 1 && !in\_array($id, $old\_themes)) unset($theme\_paths[$id]); } } elseif (isset($old\_version) && $old\_version == $packageInfo['version']) $context['is\_installed'] = true;
 if (!isset($old\_version) || $context['is\_installed']) $actions = parsePackageInfo($packageInfo['xml'], true, 'install');
 $context['actions'] = array(); $context['ftp\_needed'] = false; $context['has\_failure'] = false; $chmod\_files = array();
 // no actions found, return so we can display an error if (empty($actions)) return;
 // This will hold data about anything that can be installed in other themes. $themeFinds = array( 'candidates' => array(), 'other\_themes' => array(), );
 // Now prepare things for the template. foreach ($actions as $action) { // Not failed until proven otherwise. $failed = false; $thisAction = array();
 if ($action['type'] == 'chmod') { $chmod\_files[] = $action['filename']; continue; } elseif ($action['type'] == 'readme' || $action['type'] == 'license') { $type = 'package\_' . $action['type']; if (file\_exists($boarddir . '/Packages/temp/' . $context['base\_path'] . $action['filename'])) $context[$type] = htmlspecialchars(trim(file\_get\_contents($boarddir . '/Packages/temp/' . $context['base\_path'] . $action['filename']), "\n\r")); elseif (file\_exists($action['filename'])) $context[$type] = htmlspecialchars(trim(file\_get\_contents($action['filename']), "\n\r"));
 if (!empty($action['parse\_bbc'])) { require\_once($sourcedir . '/Subs-Post.php'); preparsecode($context[$type]); $context[$type] = parse\_bbc($context[$type]); } else $context[$type] = nl2br($context[$type]);
 continue; } // Don't show redirects. elseif ($action['type'] == 'redirect') continue; elseif ($action['type'] == 'error') { $context['has\_failure'] = true; if (isset($action['error\_msg']) && isset($action['error\_var'])) $context['failure\_details'] = sprintf($txt['package\_will\_fail\_' . $action['error\_msg']], $action['error\_var']); elseif (isset($action['error\_msg'])) $context['failure\_details'] = isset($txt['package\_will\_fail\_' . $action['error\_msg']]) ? $txt['package\_will\_fail\_' . $action['error\_msg']] : $action['error\_msg']; } elseif ($action['type'] == 'modification') { if (!file\_exists($boarddir . '/Packages/temp/' . $context['base\_path'] . $action['filename'])) { $context['has\_failure'] = true;
 $context['actions'][] = array( 'type' => $txt['execute\_modification'], 'action' => $smcFunc['htmlspecialchars'](strtr($action['filename'], array($boarddir => '.'))), 'description' => $txt['package\_action\_error'], 'failed' => true, ); } else {
 if ($action['boardmod']) $mod\_actions = parseBoardMod(@file\_get\_contents($boarddir . '/Packages/temp/' . $context['base\_path'] . $action['filename']), true, $action['reverse'], $theme\_paths); else $mod\_actions = parseModification(@file\_get\_contents($boarddir . '/Packages/temp/' . $context['base\_path'] . $action['filename']), true, $action['reverse'], $theme\_paths);
 if (count($mod\_actions) == 1 && isset($mod\_actions[0]) && $mod\_actions[0]['type'] == 'error' && $mod\_actions[0]['filename'] == '-') $mod\_actions[0]['filename'] = $action['filename'];
 foreach ($mod\_actions as $key => $mod\_action) { // Lets get the last section of the file name. if (isset($mod\_action['filename']) && substr($mod\_action['filename'], -13) != '.template.php') $actual\_filename = strtolower(substr(strrchr($mod\_action['filename'], '/'), 1) . '||' . $action['filename']); elseif (isset($mod\_action['filename']) && preg\_match('~([\w]\*)/([\w]\*)\.template\.php$~', $mod\_action['filename'], $matches)) $actual\_filename = strtolower($matches[1] . '/' . $matches[2] . '.template.php' . '||' . $action['filename']); else $actual\_filename = $key;
 if ($mod\_action['type'] == 'opened') $failed = false; elseif ($mod\_action['type'] == 'failure') { if (empty($mod\_action['is\_custom'])) $context['has\_failure'] = true; $failed = true; } elseif ($mod\_action['type'] == 'chmod') { $chmod\_files[] = $mod\_action['filename']; } elseif ($mod\_action['type'] == 'saved') { if (!empty($mod\_action['is\_custom'])) { if (!isset($context['theme\_actions'][$mod\_action['is\_custom']])) $context['theme\_actions'][$mod\_action['is\_custom']] = array( 'name' => $theme\_paths[$mod\_action['is\_custom']]['name'], 'actions' => array(), 'has\_failure' => $failed, ); else $context['theme\_actions'][$mod\_action['is\_custom']]['has\_failure'] |= $failed;
 $context['theme\_actions'][$mod\_action['is\_custom']]['actions'][$actual\_filename] = array( 'type' => $txt['execute\_modification'], 'action' => $smcFunc['htmlspecialchars'](strtr($mod\_action['filename'], array($boarddir => '.'))), 'description' => $failed ? $txt['package\_action\_failure'] : $txt['package\_action\_success'], 'failed' => $failed, ); } elseif (!isset($context['actions'][$actual\_filename])) { $context['actions'][$actual\_filename] = array( 'type' => $txt['execute\_modification'], 'action' => $smcFunc['htmlspecialchars'](strtr($mod\_action['filename'], array($boarddir => '.'))), 'description' => $failed ? $txt['package\_action\_failure'] : $txt['package\_action\_success'], 'failed' => $failed, ); } else { $context['actions'][$actual\_filename]['failed'] |= $failed; $context['actions'][$actual\_filename]['description'] = $context['actions'][$actual\_filename]['failed'] ? $txt['package\_action\_failure'] : $txt['package\_action\_success']; } } elseif ($mod\_action['type'] == 'skipping') { $context['actions'][$actual\_filename] = array( 'type' => $txt['execute\_modification'], 'action' => $smcFunc['htmlspecialchars'](strtr($mod\_action['filename'], array($boarddir => '.'))), 'description' => $txt['package\_action\_skipping'] ); } elseif ($mod\_action['type'] == 'missing' && empty($mod\_action['is\_custom'])) { $context['has\_failure'] = true; $context['actions'][$actual\_filename] = array( 'type' => $txt['execute\_modification'], 'action' => $smcFunc['htmlspecialchars'](strtr($mod\_action['filename'], array($boarddir => '.'))), 'description' => $txt['package\_action\_missing'], 'failed' => true, ); } elseif ($mod\_action['type'] == 'error') $context['actions'][$actual\_filename] = array( 'type' => $txt['execute\_modification'], 'action' => $smcFunc['htmlspecialchars'](strtr($mod\_action['filename'], array($boarddir => '.'))), 'description' => $txt['package\_action\_error'], 'failed' => true, ); }
 // We need to loop again just to get the operations down correctly. foreach ($mod\_actions as $operation\_key => $mod\_action) { // Lets get the last section of the file name. if (isset($mod\_action['filename']) && substr($mod\_action['filename'], -13) != '.template.php') $actual\_filename = strtolower(substr(strrchr($mod\_action['filename'], '/'), 1) . '||' . $action['filename']); elseif (isset($mod\_action['filename']) && preg\_match('~([\w]\*)/([\w]\*)\.template\.php$~', $mod\_action['filename'], $matches)) $actual\_filename = strtolower($matches[1] . '/' . $matches[2] . '.template.php' . '||' . $action['filename']); else $actual\_filename = $key;
 // We just need it for actual parse changes. if (!in\_array($mod\_action['type'], array('error', 'result', 'opened', 'saved', 'end', 'missing', 'skipping', 'chmod'))) { if (empty($mod\_action['is\_custom'])) $context['actions'][$actual\_filename]['operations'][] = array( 'type' => $txt['execute\_modification'], 'action' => $smcFunc['htmlspecialchars'](strtr($mod\_action['filename'], array($boarddir => '.'))), 'description' => $mod\_action['failed'] ? $txt['package\_action\_failure'] : $txt['package\_action\_success'], 'position' => $mod\_action['position'], 'operation\_key' => $operation\_key, 'filename' => $action['filename'], 'is\_boardmod' => $action['boardmod'], 'failed' => $mod\_action['failed'], 'ignore\_failure' => !empty($mod\_action['ignore\_failure']), );
 // Themes are under the saved type. if (isset($mod\_action['is\_custom']) && isset($context['theme\_actions'][$mod\_action['is\_custom']])) $context['theme\_actions'][$mod\_action['is\_custom']]['actions'][$actual\_filename]['operations'][] = array( 'type' => $txt['execute\_modification'], 'action' => $smcFunc['htmlspecialchars'](strtr($mod\_action['filename'], array($boarddir => '.'))), 'description' => $mod\_action['failed'] ? $txt['package\_action\_failure'] : $txt['package\_action\_success'], 'position' => $mod\_action['position'], 'operation\_key' => $operation\_key, 'filename' => $action['filename'], 'is\_boardmod' => $action['boardmod'], 'failed' => $mod\_action['failed'], 'ignore\_failure' => !empty($mod\_action['ignore\_failure']), ); } } } } elseif ($action['type'] == 'code') { $thisAction = array( 'type' => $txt['execute\_code'], 'action' => $smcFunc['htmlspecialchars']($action['filename']), ); } elseif ($action['type'] == 'database') { $thisAction = array( 'type' => $txt['execute\_database\_changes'], 'action' => $smcFunc['htmlspecialchars']($action['filename']), ); } elseif (in\_array($action['type'], array('create-dir', 'create-file'))) { $thisAction = array( 'type' => $txt['package\_create'] . ' ' . ($action['type'] == 'create-dir' ? $txt['package\_tree'] : $txt['package\_file']), 'action' => $smcFunc['htmlspecialchars'](strtr($action['destination'], array($boarddir => '.'))) ); } elseif ($action['type'] == 'hook') { $action['description'] = !isset($action['hook'], $action['function']) ? $txt['package\_action\_failure'] : $txt['package\_action\_success'];
 if (!isset($action['hook'], $action['function'])) $context['has\_failure'] = true;
 $thisAction = array( 'type' => $action['reverse'] ? $txt['execute\_hook\_remove'] : $txt['execute\_hook\_add'], 'action' => sprintf($txt['execute\_hook\_action'], $smcFunc['htmlspecialchars']($action['hook'])), ); } elseif ($action['type'] == 'credits') { $thisAction = array( 'type' => $txt['execute\_credits\_add'], 'action' => sprintf($txt['execute\_credits\_action'], $smcFunc['htmlspecialchars']($action['title'])), ); } elseif ($action['type'] == 'requires') { $installed = false; $version = true;
 // package missing required values? if (!isset($action['id'])) $context['has\_failure'] = true; else { // See if this dependancy is installed $request = $smcFunc['db\_query']('', ' SELECT version FROM {db\_prefix}log\_packages WHERE package\_id = {string:current\_package} AND install\_state != {int:not\_installed} ORDER BY time\_installed DESC LIMIT 1', array( 'not\_installed' => 0, 'current\_package' => $action['id'], ) ); $installed = ($smcFunc['db\_num\_rows']($request) !== 0); if ($installed) list($version) = $smcFunc['db\_fetch\_row']($request); $smcFunc['db\_free\_result']($request);
 // do a version level check (if requested) in the most basic way $version = (isset($action['version']) ? $version == $action['version'] : true); }
 // Set success or failure information $action['description'] = ($installed && $version) ? $txt['package\_action\_success'] : $txt['package\_action\_failure']; $context['has\_failure'] = !($installed && $version);
 $thisAction = array( 'type' => $txt['package\_requires'], 'action' => $txt['package\_check\_for'] . ' ' . $action['id'] . (isset($action['version']) ? (' / ' . ($version ? $action['version'] : '<span class="error">' . $action['version'] . '</span>')) : ''), ); } elseif (in\_array($action['type'], array('require-dir', 'require-file'))) { // Do this one... $thisAction = array( 'type' => $txt['package\_extract'] . ' ' . ($action['type'] == 'require-dir' ? $txt['package\_tree'] : $txt['package\_file']), 'action' => $smcFunc['htmlspecialchars'](strtr($action['destination'], array($boarddir => '.'))) );
 // Could this be theme related? if (!empty($action['unparsed\_destination']) && preg\_match('~^\$(languagedir|languages\_dir|imagesdir|themedir|themes\_dir)~i', $action['unparsed\_destination'], $matches)) { // Is the action already stated? $theme\_action = !empty($action['theme\_action']) && in\_array($action['theme\_action'], array('no', 'yes', 'auto')) ? $action['theme\_action'] : 'auto'; // If it's not auto do we think we have something we can act upon? if ($theme\_action != 'auto' && !in\_array($matches[1], array('languagedir', 'languages\_dir', 'imagesdir', 'themedir'))) $theme\_action = ''; // ... or if it's auto do we even want to do anything? elseif ($theme\_action == 'auto' && $matches[1] != 'imagesdir') $theme\_action = '';
 // So, we still want to do something? if ($theme\_action != '') $themeFinds['candidates'][] = $action; // Otherwise is this is going into another theme record it. elseif ($matches[1] == 'themes\_dir') $themeFinds['other\_themes'][] = strtolower(strtr(parse\_path($action['unparsed\_destination']), array('\\' => '/')) . '/' . basename($action['filename'])); } } elseif (in\_array($action['type'], array('move-dir', 'move-file'))) $thisAction = array( 'type' => $txt['package\_move'] . ' ' . ($action['type'] == 'move-dir' ? $txt['package\_tree'] : $txt['package\_file']), 'action' => $smcFunc['htmlspecialchars'](strtr($action['source'], array($boarddir => '.'))) . ' => ' . $smcFunc['htmlspecialchars'](strtr($action['destination'], array($boarddir => '.'))) ); elseif (in\_array($action['type'], array('remove-dir', 'remove-file'))) { $thisAction = array( 'type' => $txt['package\_delete'] . ' ' . ($action['type'] == 'remove-dir' ? $txt['package\_tree'] : $txt['package\_file']), 'action' => $smcFunc['htmlspecialchars'](strtr($action['filename'], array($boarddir => '.'))) );
 // Could this be theme related? if (!empty($action['unparsed\_filename']) && preg\_match('~^\$(languagedir|languages\_dir|imagesdir|themedir|themes\_dir)~i', $action['unparsed\_filename'], $matches)) {
 // Is the action already stated? $theme\_action = !empty($action['theme\_action']) && in\_array($action['theme\_action'], array('no', 'yes', 'auto')) ? $action['theme\_action'] : 'auto'; $action['unparsed\_destination'] = $action['unparsed\_filename'];
 // If it's not auto do we think we have something we can act upon? if ($theme\_action != 'auto' && !in\_array($matches[1], array('languagedir', 'languages\_dir', 'imagesdir', 'themedir'))) $theme\_action = ''; // ... or if it's auto do we even want to do anything? elseif ($theme\_action == 'auto' && $matches[1] != 'imagesdir') $theme\_action = '';
 // So, we still want to do something? if ($theme\_action != '') $themeFinds['candidates'][] = $action; // Otherwise is this is going into another theme record it. elseif ($matches[1] == 'themes\_dir') $themeFinds['other\_themes'][] = strtolower(strtr(parse\_path($action['unparsed\_filename']), array('\\' => '/')) . '/' . basename($action['filename'])); } }
 if (empty($thisAction)) continue;
 if ($context['uninstalling']) $file = in\_array($action['type'], array('remove-dir', 'remove-file')) ? $action['filename'] : $boarddir . '/Packages/temp/' . $context['base\_path'] . $action['filename']; else $file = $boarddir . '/Packages/temp/' . $context['base\_path'] . $action['filename'];
 if (isset($action['filename']) && !file\_exists($file)) { $context['has\_failure'] = true;
 $thisAction += array( 'description' => $txt['package\_action\_error'], 'failed' => true, ); }
 // @todo None given? if (empty($thisAction['description'])) $thisAction['description'] = isset($action['description']) ? $action['description'] : '';
 $context['actions'][] = $thisAction; }
 // Have we got some things which we might want to do "multi-theme"? if (!empty($themeFinds['candidates'])) { foreach ($themeFinds['candidates'] as $action\_data) { // Get the part of the file we'll be dealing with. preg\_match('~^\$(languagedir|languages\_dir|imagesdir|themedir)(\\|/)\*(.+)\*~i', $action\_data['unparsed\_destination'], $matches);
 if ($matches[1] == 'imagesdir') $path = '/' . basename($settings['default\_images\_url']); elseif ($matches[1] == 'languagedir' || $matches[1] == 'languages\_dir') $path = '/languages'; else $path = '';
 if (!empty($matches[3])) $path .= $matches[3];
 if (!$context['uninstalling']) $path .= '/' . basename($action\_data['filename']);
 // Loop through each custom theme to note it's candidacy! foreach ($theme\_paths as $id => $theme\_data) { if (isset($theme\_data['theme\_dir']) && $id != 1) { $real\_path = $theme\_data['theme\_dir'] . $path;
 // Confirm that we don't already have this dealt with by another entry. if (!in\_array(strtolower(strtr($real\_path, array('\\' => '/'))), $themeFinds['other\_themes'])) { // Check if we will need to chmod this. if (!mktree(dirname($real\_path), false)) { $temp = dirname($real\_path); while (!file\_exists($temp) && strlen($temp) > 1) $temp = dirname($temp); $chmod\_files[] = $temp; }
 if ($action\_data['type'] == 'require-dir' && !is\_writable($real\_path) && (file\_exists($real\_path) || !is\_writable(dirname($real\_path)))) $chmod\_files[] = $real\_path;
 if (!isset($context['theme\_actions'][$id])) $context['theme\_actions'][$id] = array( 'name' => $theme\_data['name'], 'actions' => array(), );
 if ($context['uninstalling']) $context['theme\_actions'][$id]['actions'][] = array( 'type' => $txt['package\_delete'] . ' ' . ($action\_data['type'] == 'require-dir' ? $txt['package\_tree'] : $txt['package\_file']), 'action' => strtr($real\_path, array('\\' => '/', $boarddir => '.')), 'description' => '', 'value' => base64\_encode(serialize(array('type' => $action\_data['type'], 'orig' => $action\_data['filename'], 'future' => $real\_path, 'id' => $id))), 'not\_mod' => true, ); else $context['theme\_actions'][$id]['actions'][] = array( 'type' => $txt['package\_extract'] . ' ' . ($action\_data['type'] == 'require-dir' ? $txt['package\_tree'] : $txt['package\_file']), 'action' => strtr($real\_path, array('\\' => '/', $boarddir => '.')), 'description' => '', 'value' => base64\_encode(serialize(array('type' => $action\_data['type'], 'orig' => $action\_data['destination'], 'future' => $real\_path, 'id' => $id))), 'not\_mod' => true, ); } } } } }
 // Trash the cache... which will also check permissions for us! package\_flush\_cache(true);
 if (file\_exists($boarddir . '/Packages/temp')) deltree($boarddir . '/Packages/temp');
 if (!empty($chmod\_files)) { $ftp\_status = create\_chmod\_control($chmod\_files); $context['ftp\_needed'] = !empty($ftp\_status['files']['notwritable']) && !empty($context['package\_ftp']); }
 checkSubmitOnce('register');}
/\*\* \* Apply another type of (avatar, language, etc.) package. \*/function PackageInstall(){ global $boarddir, $txt, $context, $boardurl, $scripturl, $sourcedir, $modSettings; global $user\_info, $smcFunc;
 // Make sure we don't install this mod twice. checkSubmitOnce('check'); checkSession();
 // If there's no file, what are we installing? if (!isset($\_REQUEST['package']) || $\_REQUEST['package'] == '') redirectexit('action=admin;area=packages'); $context['filename'] = $\_REQUEST['package'];
 // If this is an uninstall, we'll have an id. $context['install\_id'] = isset($\_REQUEST['pid']) ? (int) $\_REQUEST['pid'] : 0;
 require\_once($sourcedir . '/Subs-Package.php');
 // @todo Perhaps do it in steps, if necessary?
 $context['uninstalling'] = $\_REQUEST['sa'] == 'uninstall2';
 // Set up the linktree for other. $context['linktree'][count($context['linktree']) - 1] = array( 'url' => $scripturl . '?action=admin;area=packages;sa=browse', 'name' => $context['uninstalling'] ? $txt['uninstall'] : $txt['extracting'] ); $context['page\_title'] .= ' - ' . ($context['uninstalling'] ? $txt['uninstall'] : $txt['extracting']);
 $context['sub\_template'] = 'extract\_package';
 if (!file\_exists($boarddir . '/Packages/' . $context['filename'])) fatal\_lang\_error('package\_no\_file', false);
 // Load up the package FTP information? create\_chmod\_control(array(), array('destination\_url' => $scripturl . '?action=admin;area=packages;sa=' . $\_REQUEST['sa'] . ';package=' . $\_REQUEST['package']));
 // Make sure temp directory exists and is empty! if (file\_exists($boarddir . '/Packages/temp')) deltree($boarddir . '/Packages/temp', false); else mktree($boarddir . '/Packages/temp', 0777);
 // Let the unpacker do the work. if (is\_file($boarddir . '/Packages/' . $context['filename'])) { $context['extracted\_files'] = read\_tgz\_file($boarddir . '/Packages/' . $context['filename'], $boarddir . '/Packages/temp');
 if (!file\_exists($boarddir . '/Packages/temp/package-info.xml')) foreach ($context['extracted\_files'] as $file) if (basename($file['filename']) == 'package-info.xml') { $context['base\_path'] = dirname($file['filename']) . '/'; break; }
 if (!isset($context['base\_path'])) $context['base\_path'] = ''; } elseif (is\_dir($boarddir . '/Packages/' . $context['filename'])) { copytree($boarddir . '/Packages/' . $context['filename'], $boarddir . '/Packages/temp'); $context['extracted\_files'] = listtree($boarddir . '/Packages/temp'); $context['base\_path'] = ''; } else fatal\_lang\_error('no\_access', false);
 // Are we installing this into any custom themes? $custom\_themes = array(1); $known\_themes = explode(',', $modSettings['knownThemes']); if (!empty($\_POST['custom\_theme'])) { foreach ($\_POST['custom\_theme'] as $tid) if (in\_array($tid, $known\_themes)) $custom\_themes[] = (int) $tid; }
 // Now load up the paths of the themes that we need to know about. $request = $smcFunc['db\_query']('', ' SELECT id\_theme, variable, value FROM {db\_prefix}themes WHERE id\_theme IN ({array\_int:custom\_themes}) AND variable IN ({string:name}, {string:theme\_dir})', array( 'custom\_themes' => $custom\_themes, 'name' => 'name', 'theme\_dir' => 'theme\_dir', ) ); $theme\_paths = array(); $themes\_installed = array(1); while ($row = $smcFunc['db\_fetch\_assoc']($request)) $theme\_paths[$row['id\_theme']][$row['variable']] = $row['value']; $smcFunc['db\_free\_result']($request);
 // Are there any theme copying that we want to take place? $context['theme\_copies'] = array( 'require-file' => array(), 'require-dir' => array(), ); if (!empty($\_POST['theme\_changes'])) { foreach ($\_POST['theme\_changes'] as $change) { if (empty($change)) continue; $theme\_data = unserialize(base64\_decode($change)); if (empty($theme\_data['type'])) continue;
 $themes\_installed[] = $theme\_data['id']; $context['theme\_copies'][$theme\_data['type']][$theme\_data['orig']][] = $theme\_data['future']; } }
 // Get the package info... $packageInfo = getPackageInfo($context['filename']); if (!is\_array($packageInfo)) fatal\_lang\_error($packageInfo);
 $packageInfo['filename'] = $context['filename'];
 // Set the type of extraction... $context['extract\_type'] = isset($packageInfo['type']) ? $packageInfo['type'] : 'modification';
 // Create a backup file to roll back to! (but if they do this more than once, don't run it a zillion times.) if (!empty($modSettings['package\_make\_full\_backups']) && (!isset($\_SESSION['last\_backup\_for']) || $\_SESSION['last\_backup\_for'] != $context['filename'] . ($context['uninstalling'] ? '$$' : '$'))) { $\_SESSION['last\_backup\_for'] = $context['filename'] . ($context['uninstalling'] ? '$$' : '$'); // @todo Internationalize this? package\_create\_backup(($context['uninstalling'] ? 'backup\_' : 'before\_') . strtok($context['filename'], '.')); }
 // The mod isn't installed.... unless proven otherwise. $context['is\_installed'] = false;
 // Is it actually installed? $request = $smcFunc['db\_query']('', ' SELECT version, themes\_installed, db\_changes FROM {db\_prefix}log\_packages WHERE package\_id = {string:current\_package} AND install\_state != {int:not\_installed} ORDER BY time\_installed DESC LIMIT 1', array( 'not\_installed' => 0, 'current\_package' => $packageInfo['id'], ) ); while ($row = $smcFunc['db\_fetch\_assoc']($request)) { $old\_themes = explode(',', $row['themes\_installed']); $old\_version = $row['version']; $db\_changes = empty($row['db\_changes']) ? array() : unserialize($row['db\_changes']); } $smcFunc['db\_free\_result']($request);
 // Wait, it's not installed yet! // @todo Replace with a better error message! if (!isset($old\_version) && $context['uninstalling']) { deltree($boarddir . '/Packages/temp'); fatal\_error('Hacker?', false); } // Uninstalling? elseif ($context['uninstalling']) { $install\_log = parsePackageInfo($packageInfo['xml'], false, 'uninstall');
 // Gadzooks! There's no uninstaller at all!? if (empty($install\_log)) fatal\_lang\_error('package\_uninstall\_cannot', false);
 // They can only uninstall from what it was originally installed into. foreach ($theme\_paths as $id => $data) if ($id != 1 && !in\_array($id, $old\_themes)) unset($theme\_paths[$id]); } elseif (isset($old\_version) && $old\_version != $packageInfo['version']) { // Look for an upgrade... $install\_log = parsePackageInfo($packageInfo['xml'], false, 'upgrade', $old\_version);
 // There was no upgrade.... if (empty($install\_log)) $context['is\_installed'] = true; else { // Upgrade previous themes only! foreach ($theme\_paths as $id => $data) if ($id != 1 && !in\_array($id, $old\_themes)) unset($theme\_paths[$id]); } } elseif (isset($old\_version) && $old\_version == $packageInfo['version']) $context['is\_installed'] = true;
 if (!isset($old\_version) || $context['is\_installed']) $install\_log = parsePackageInfo($packageInfo['xml'], false, 'install');
 $context['install\_finished'] = false;
 // @todo Make a log of any errors that occurred and output them?
 if (!empty($install\_log)) { $failed\_steps = array(); $failed\_count = 0;
 foreach ($install\_log as $action) { $failed\_count++;
 if ($action['type'] == 'modification' && !empty($action['filename'])) { if ($action['boardmod']) $mod\_actions = parseBoardMod(file\_get\_contents($boarddir . '/Packages/temp/' . $context['base\_path'] . $action['filename']), false, $action['reverse'], $theme\_paths); else $mod\_actions = parseModification(file\_get\_contents($boarddir . '/Packages/temp/' . $context['base\_path'] . $action['filename']), false, $action['reverse'], $theme\_paths);
 // Any errors worth noting? foreach ($mod\_actions as $key => $action) { if ($action['type'] == 'failure') $failed\_steps[] = array( 'file' => $action['filename'], 'large\_step' => $failed\_count, 'sub\_step' => $key, 'theme' => 1, );
 // Gather the themes we installed into. if (!empty($action['is\_custom'])) $themes\_installed[] = $action['is\_custom']; } } elseif ($action['type'] == 'code' && !empty($action['filename'])) { // This is just here as reference for what is available. global $txt, $boarddir, $sourcedir, $modSettings, $context, $settings, $forum\_version, $smcFunc;[View remainder of file in raw view](https://github.com/SimpleMachines/SMF/raw/404fd5347951652624dfb72304ee38fcab98378f/Sources/Packages.php)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


