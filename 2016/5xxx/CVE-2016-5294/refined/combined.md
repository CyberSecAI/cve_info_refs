=== Content from bugzilla.mozilla.org_341655cb_20250126_060800.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1246945)
* [XML](/show_bug.cgi?ctype=xml&id=1246945)

Closed
[Bug 1246945](/show_bug.cgi?id=1246945)
(CVE-2016-5293)

Opened 9 years ago
Closed 9 years ago

# Write to arbitrary file with updater and moz maintenance service using updater.log hardlink

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Write to arbitrary file with updater and moz maintenance service using updater.log hardlink

## Categories

### (Toolkit :: Application Update, defect)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Application%20Update#Application%20Update)

Application Update
▾

Toolkit :: Application Update
Application update for Firefox and Thunderbird.
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Application%20Update&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Application%20Update&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Application%20Update)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| Install Update Workflow | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox47 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox47&o1=equals&v1=wontfix) |
| firefox48 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=wontfix) |
| firefox49 | [+](/buglist.cgi?f1=cf_tracking_firefox49&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix) |
| firefox-esr45 | [50+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=50%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=verified) |
| firefox50 | [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=verified) |
| firefox51 | --- | [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified) |
| firefox52 | --- | [verified](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox47 |  | wontfix |
| firefox48 |  | wontfix |
| firefox49 | + | wontfix |
| firefox-esr45 | 50+ | verified |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox50 | + | verified |
| firefox51 |  | verified |
| firefox52 |  | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: hofusec, Assigned: robert.strong.bugs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [robert.strong.bugs](/user_profile?user_id=141755)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/f8267efedda3c2e24d5829ef3a9d124e?d=mm&size=40)  [kjozwiak](/user_profile?user_id=455785)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/270499a0d11a67b911327984af6ffe90?d=mm&size=40)  [hofusec](/user_profile?user_id=436533)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/50e82ef70720dfcf1385f583e34f9ba9?d=mm&size=40)  [erchen](/user_profile?user_id=753852)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, sec-high, Whiteboard: [post-critsmash-triage][adv-main50+][adv-esr45.5+] fixed by bug 1168743)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2016-5293

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main50+][adv-esr45.5+] fixed by bug 1168743

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a18672755_1689 "8 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | [qe-verify](#a23249655_452604 "8 years ago") | + |
| --- | --- | --- |
| [mwobensmith](/user_profile?user_id=452604) | qe-verify | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [write.poc.zip](/attachment.cgi?id=8717458)  [9 years ago](#c0)  [Holger Fuhrmannek](/user_profile?user_id=436533)   66.41 KB, application/zip |  | [Details](/attachment.cgi?id=8717458&action=edit) |
| --- | --- | --- |
| [Patch](/attachment.cgi?id=8761353)  [9 years ago](#c5)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   1.32 KB, patch | robert.strong.bugs : [review-](#c8 "9 years ago") | [Details](/attachment.cgi?id=8761353&action=edit) | [Diff](/attachment.cgi?id=8761353&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8761353) |
| [bug 1168743 client patch](/attachment.cgi?id=8762239)  [9 years ago](#c14)  [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)   48.23 KB, patch | robert.strong.bugs : [review+](#c14 "9 years ago")  abillings : [sec-approval+](#a10586718_280903 "9 years ago") | [Details](/attachment.cgi?id=8762239&action=edit) | [Diff](/attachment.cgi?id=8762239&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8762239) |
| [esr45 bug 1168743 client patch](/attachment.cgi?id=8790403)  [8 years ago](#c31)  [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)   47.14 KB, patch | robert.strong.bugs : [review+](#c31 "8 years ago")  lizzard : [approval-mozilla-esr45+](#c39 "8 years ago")  abillings : [sec-approval+](#a18777183_280903 "8 years ago") | [Details](/attachment.cgi?id=8790403&action=edit) | [Diff](/attachment.cgi?id=8790403&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8790403) |
| [esr45 patch for bug 1299333](/attachment.cgi?id=8790404)  [8 years ago](#c32)  [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)   9.40 KB, patch |  | [Details](/attachment.cgi?id=8790404&action=edit) | [Diff](/attachment.cgi?id=8790404&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8790404) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Holger Fuhrmannek](/user_profile?user_id=436533)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1246945#c0)• 9 years ago |
|  | |

Attached file
[write.poc.zip](attachment.cgi?id=8717458)
— [Details](attachment.cgi?id=8717458&action=edit)

During an update a updater.log file is created in the update source directory. If possible the new log data are added to an existing log file. If the file is actually a hardlink the new data are added to an arbitrary file.
The poc use the CreateHardlink tool from <https://github.com/google/symboliclink-testing-tools> to create the hardlink without the need of write access to the target file.
I have tested the poc with win7 and ff 47 nightly installed to C:\Program Files (x86)\Nightly\:
To reproduce
- download poc and extract the files
- execute poc.rb
The poc adds amongst other data a user controlled new line to the updater.ini in the firefox directory.
This might be used to elevate privileges by overwriting a script or ini file which has a permissive parser which subsequently gets executed/parsed by a privileged process.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1246945#c1)• 9 years ago |
|  | |

Rob, can you take this and suggest a security rating?Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1246945#c2)• 9 years ago |
|  | |

Similar bugs have been rated sec-high. Looking into what can be done to mitigate this.Flags: needinfo?(robert.strong.bugs)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a5125832_280903)• 9 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1246945#c3)• 9 years ago |
|  | |

Matt, is this another one of these bugs that you'll be looking at?Flags: needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1246945#c4)• 9 years ago |
|  | |

This one wasn't on my radar, but I'll go ahead and take it.
rstrong, did you ever have time to come up with any mitigation ideas? This exploit uses a replace request, so it's exploiting the fact that moving the existing log file to the new temporary path before we append to it preserves the hard link from the source path. My first thought is that we should be able to move that file in a way that breaks the link.Assignee: nobody → mhowellFlags: needinfo?(mhowell) → needinfo?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1246945#c5)• 9 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=8761353&action=diff) (obsolete)
— [Details](attachment.cgi?id=8761353&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8761353)

This patch copies the existing log file instead of moving it; the original is then deleted by already existing code. This copies the content of the log while breaking the hard link.Flags: needinfo?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1246945#c6)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=574ce180d5e8>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a10395229_550257)• 9 years ago |

[Attachment #8761353](/attachment.cgi?id=8761353&action=edit "Patch") -
Flags: review?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1246945#c7)• 9 years ago |
|  | |

Note: in [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") I am removing the append option from logging which also fixes this bug.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1246945#c8)• 9 years ago |
|  | |

Comment on [attachment 8761353](/attachment.cgi?id=8761353 "Patch") [[details]](/attachment.cgi?id=8761353&action=edit "Patch") [[diff]](/attachment.cgi?id=8761353&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8761353)
Patch
Won't this suffer from the same issue as [bug 1171518](/show_bug.cgi?id=1171518 "RESOLVED FIXED - [Win] Privileged update processes writing to user writable locations can overwrite non-user writable locations using hard links") when using CopyFile?
[Attachment #8761353](/attachment.cgi?id=8761353&action=edit "Patch") -
Flags: review?(robert.strong.bugs) → review-

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1246945#c9)• 9 years ago |
|  | |

(In reply to Robert Strong [:rstrong] (use needinfo to contact me) from [comment #8](/show_bug.cgi?id=1246945#c8 "VERIFIED FIXED - Write to arbitrary file with updater and moz maintenance service using updater.log hardlink"))
> Won't this suffer from the same issue as [bug 1171518](/show_bug.cgi?id=1171518 "RESOLVED FIXED - [Win] Privileged update processes writing to user writable locations can overwrite non-user writable locations using hard links") when using CopyFile?
Yeah, looks like it would. I could mitigate that to a degree by including some randomness in the temp file name, instead of a timestamp like GetTempFileName uses. Do you want to bother in light of [comment 7](/show_bug.cgi?id=1246945#c7 "VERIFIED FIXED - Write to arbitrary file with updater and moz maintenance service using updater.log hardlink") though? Removing the append functionality is definitely the better fix.Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1246945#c10)• 9 years ago |
|  | |

I think it would be better to go with [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup")Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1246945#c11)• 9 years ago |
|  | |

Al, the client patch in [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") addresses this bug and I'd like to know how you'd like to handle getting that landed. Would you prefer that I put the client patch that only fixes this bug in this bug for the security approvals, etc. for landing on other branches and if so would you like the client patch without the additional cleanup? I don't think the additional cleanup is that risky to land on other branches especially since we are early in this cycle but I'm not against reducing the changes. Also, the test patches in [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") will need to land on the branches as well. Thanks!Flags: needinfo?(abillings)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1246945#c12)• 9 years ago |
|  | |

I'd just ask for sec-approval here and branch approvals with the caveat to all involved that we're actually approving (quietly) the patches for [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup"), if that works for you. That's assuming that the patches there are review+ in general.Flags: needinfo?(abillings)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1246945#c13)• 9 years ago |
|  | |

Works for me and thanks!

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a10565309_141755)• 9 years ago |

Assignee: mhowell → robert.strong.bugsStatus: UNCONFIRMED → ASSIGNEDEver confirmed: true

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a10565636_141755)• 9 years ago |

[Attachment #8761353](/attachment.cgi?id=8761353&action=edit "Patch") -
Attachment is obsolete: true

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1246945#c14)• 9 years ago |
|  | |

Attached patch

[bug 1168743 client patch](attachment.cgi?id=8762239&action=diff)
— [Details](attachment.cgi?id=8762239&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8762239)

Attaching client patch from [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") so I have something to request sec-approcal on
[Security approval request comment]
How easily could an exploit be constructed based on the patch? Not easily at all since this fix was done as part of [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup").
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem? Not at all
Which older supported branches are affected by this flaw? It was introduced in Firefox 42 in [bug 1171518](/show_bug.cgi?id=1171518 "RESOLVED FIXED - [Win] Privileged update processes writing to user writable locations can overwrite non-user writable locations using hard links") to fix a different security bug. So, all supported branches.
If not all supported branches, which bug introduced the flaw?
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be? I don't expect any difficulty in creating backports.
How likely is this patch to cause regressions; how much testing does it need? Not very likely but I'd like this to spend a week or two on nightly before uplifting as with all app update changes. With this being the start of the cycle this shouldn't be a problem.
[Attachment #8762239](/attachment.cgi?id=8762239&action=edit "bug 1168743 client patch") -
Flags: sec-approval?
[Attachment #8762239](/attachment.cgi?id=8762239&action=edit "bug 1168743 client patch") -
Flags: review+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a10586718_280903)• 9 years ago |

[Attachment #8762239](/attachment.cgi?id=8762239&action=edit "bug 1168743 client patch") -
Flags: sec-approval? → sec-approval+

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1246945#c15)• 9 years ago |
|  | |

Pushed patches in [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") to mozilla-inbound.
Pushed by rstrong@mozilla.com:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/a78bd6c722f8>
test data files - Only use env vars in the test updater and general app update cleanup. r=mhowell
<https://hg.mozilla.org/integration/mozilla-inbound/rev/8f965be1037f>
client changes - Only use env vars in the test updater and general app update cleanup. r=mhowell
<https://hg.mozilla.org/integration/mozilla-inbound/rev/c69b17415feb>
test changes - Only use env vars in the test updater and general app update cleanup. r=mhowell

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1246945#c16)• 9 years ago |
|  | |

After the patches from [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") have baked on m-c nightly for a while I'll request branch approval.Status: ASSIGNED → RESOLVEDClosed: 9 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a12038074_1689)• 9 years ago |

Group: toolkit-core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1246945#c17)• 9 years ago |
|  | |

Has it baked enough? It's too late to get this into Beta but would be nice to get it into Aurora so it has the full Beta period for testing.
[status-firefox47](/buglist.cgi?f1=cf_status_firefox47&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox47&o1=equals&v1=wontfix)
[status-firefox48](/buglist.cgi?f1=cf_status_firefox48&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=affected)
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=affected)
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected)
[tracking-firefox49](/buglist.cgi?f1=cf_tracking_firefox49&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox49&o1=equals&v1=%2B)
[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B)Flags: needinfo?(robert.strong.bugs)Whiteboard: fixed by bug 1168743

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1246945#c18)• 9 years ago |
|  | |

After baking I found a regression ([bug 1287176](/show_bug.cgi?id=1287176 "RESOLVED FIXED - Status file not written for staging errors")) that needs to be fixed first and I am working on.Flags: needinfo?(robert.strong.bugs)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1246945#c19)• 9 years ago |
|  | |

Definitely a no-go for Fx48 then; maybe it'll make Firefox 49.
[status-firefox48](/buglist.cgi?f1=cf_status_firefox48&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=wontfix)
[tracking-firefox-esr45](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=isnotempty):
--- → [49+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=49%2B)

|  | [Gerry Chang [:gchang]](/user_profile?user_id=506302) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1246945#c20)• 8 years ago |
|  | |

Hi :rstrong,
Since this patch also affects 49, are you also considering to uplift this patch to 49 beta?Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1246945#c21)• 8 years ago |
|  | |

I have considered it and don't think it should be uplifted at present due to [comment #18](/show_bug.cgi?id=1246945#c18 "VERIFIED FIXED - Write to arbitrary file with updater and moz maintenance service using updater.log hardlink").Flags: needinfo?(robert.strong.bugs)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1246945#c22)• 8 years ago |
|  | |

[Bug 1287176](/show_bug.cgi?id=1287176 "RESOLVED FIXED - Status file not written for staging errors") is marked as unaffected for 49. Does that change things? Or do you think it also affects 49?
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=fix-optional)Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1246945#c23)• 8 years ago |
|  | |

The patch in [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") which fixes this bug caused [bug 1287176](/show_bug.cgi?id=1287176 "RESOLVED FIXED - Status file not written for staging errors"). I'd like the patch for [bug 1287176](/show_bug.cgi?id=1287176 "RESOLVED FIXED - Status file not written for staging errors") to bake a little longer but after that I am ok with uplifting [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") and [bug 1287176](/show_bug.cgi?id=1287176 "RESOLVED FIXED - Status file not written for staging errors") if you want them. Please note that like most of the app update bugs like this that local system access is necessary to exploit this and afaik we haven't had reports of this ever happening.Flags: needinfo?(robert.strong.bugs) → needinfo?(lhenry)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1246945#c24)• 8 years ago |
|  | |

I'm happier to leave it in 50. Thanks!
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix)Flags: needinfo?(lhenry)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1246945#c25)• 8 years ago |
|  | |

seems that esr will have to leave with this bug, are we ok?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a17545164_280903)• 8 years ago |

Flags: sec-bounty?

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1246945#c26)• 8 years ago |
|  | |

How about uplifting this to esr when this merges to beta?

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1246945#c27)• 8 years ago |
|  | |

If [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") is uplifted to esr45 I'd like to take [bug 1212939](/show_bug.cgi?id=1212939 "VERIFIED FIXED - Maintenance Service updater File Deletion Elevation of Privilege") as well to simplify the changes needed for the esr45 patch. In case we do decide at some point to uplift to esr45 I've created an esr45 patch for [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") and will soon create one for [bug 1287176](/show_bug.cgi?id=1287176 "RESOLVED FIXED - Status file not written for staging errors").

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1246945#c28)• 8 years ago |
|  | |

I have patches that apply to esr45 and the tests pass locally if this is wanted after the merge from aurora to beta.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1246945#c29)• 8 years ago |
|  | |

I think we should take this on ESR45.5 (shipping with Firefox 50).
[tracking-firefox-esr45](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=isnotempty):
[49+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=49%2B) → [50+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=50%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a18672755_1689)• 8 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1246945#c30)• 8 years ago |
|  | |

Requested esr45 on [bug 1212939](/show_bug.cgi?id=1212939 "VERIFIED FIXED - Maintenance Service updater File Deletion Elevation of Privilege") to simplify the landing of this patch.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1246945#c31)• 8 years ago |
|  | |

Attached patch

[esr45 bug 1168743 client patch](attachment.cgi?id=8790403&action=diff)
— [Details](attachment.cgi?id=8790403&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8790403)

This patch requires the patch from [bug 1212939](/show_bug.cgi?id=1212939 "VERIFIED FIXED - Maintenance Service updater File Deletion Elevation of Privilege") and [bug 1287176](/show_bug.cgi?id=1287176 "RESOLVED FIXED - Status file not written for staging errors") (I'll attach the patch for [bug 1299333](/show_bug.cgi?id=1299333 "RESOLVED FIXED - Fix app update test file in use checks") in this bug as well).
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
User impact if declined: Possible to write to arbitrary file with local computer access using the updater and moz maintenance service and an updater log hardlink
Fix Landed on Version: Firefox 50
Risk to taking this patch (and alternatives if risky): Minimal. The fix and the regression the patch caused has baked on Nightly and Aurora.
String or UUID changes made by this patch: None
See <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process> for more info.
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Not easily at all since this fix was done as part of [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup").
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
Not at all
Which older supported branches are affected by this flaw?
It was introduced in Firefox 42 in [bug 1171518](/show_bug.cgi?id=1171518 "RESOLVED FIXED - [Win] Privileged update processes writing to user writable locations can overwrite non-user writable locations using hard links") to fix a different security bug. So, all supported branches.
If not all supported branches, which bug introduced the flaw?
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
Yes, I do.
How likely is this patch to cause regressions; how much testing does it need?
Not likely since it has baked on Nightly and Aurora for quite some time. Only normal update testing should be needed.
[Attachment #8790403](/attachment.cgi?id=8790403&action=edit "esr45 bug 1168743 client patch") -
Flags: sec-approval?
[Attachment #8790403](/attachment.cgi?id=8790403&action=edit "esr45 bug 1168743 client patch") -
Flags: review+
[Attachment #8790403](/attachment.cgi?id=8790403&action=edit "esr45 bug 1168743 client patch") -
Flags: approval-mozilla-esr45?

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1246945#c32)• 8 years ago |
|  | |

Attached patch

[esr45 patch for bug 1299333](attachment.cgi?id=8790404&action=diff)
— [Details](attachment.cgi?id=8790404&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8790404)

[Approval Request Comment]
See previous request
[Attachment #8790404](/attachment.cgi?id=8790404&action=edit "esr45 patch for bug 1299333") -
Flags: approval-mozilla-esr45?

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1246945#c33)• 8 years ago |
|  | |

Note: I'll land this myself since there are several test patches that go along with it.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1246945#c34)• 8 years ago |
|  | |

This can land on 9/20. sec-approval for that date for trunk. I think we'll want to move this up the branches after things are settled on trunk.
The flags on this bug are confusing since it isn't really "fixed" on 50 is it?Whiteboard: fixed by bug 1168743 → fixed by bug 1168743 [checkin on 9/20]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a18777183_280903)• 8 years ago |

[Attachment #8790403](/attachment.cgi?id=8790403&action=edit "esr45 bug 1168743 client patch") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1246945#c35)• 8 years ago |
|  | |

or is this patch ESR only?

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1246945#c36)• 8 years ago |
|  | |

This patch is esr only

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1246945#c37)• 8 years ago |
|  | |

Ah, ok. Thank you for making this clear.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1246945#c38)• 8 years ago |
|  | |

Liz, esr approval pingFlags: needinfo?(lhenry)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1246945#c39)• 8 years ago |
|  | |

Comment on [attachment 8790403](/attachment.cgi?id=8790403 "esr45 bug 1168743 client patch") [[details]](/attachment.cgi?id=8790403&action=edit "esr45 bug 1168743 client patch") [[diff]](/attachment.cgi?id=8790403&action=diff "esr45 bug 1168743 client patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246945&attachment=8790403)
esr45 [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") client patch
Already landed in 50, sec-high, let's take this for ESR45.5.0.Flags: needinfo?(lhenry)
[Attachment #8790403](/attachment.cgi?id=8790403&action=edit "esr45 bug 1168743 client patch") -
Flags: approval-mozilla-esr45? → approval-mozilla-esr45+

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1246945#c40)• 8 years ago |
|  | |

Liz, this also needs the patch in [bug 1212939](/show_bug.cgi?id=1212939 "VERIFIED FIXED - Maintenance Service updater File Deletion Elevation of Privilege"). Can I get approval for that as well?Flags: needinfo?(lhenry)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a21262931_141755)• 8 years ago |

Flags: needinfo?(lhenry)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a21287473_141755)• 8 years ago |

[Attachment #8790404](/attachment.cgi?id=8790404&action=edit "esr45 patch for bug 1299333") -
Flags: approval-mozilla-esr45?

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1246945#c41)• 8 years ago |
|  | |

Pushed the patches from [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") to mozilla-esr45
<https://hg.mozilla.org/releases/mozilla-esr45/rev/54f7eaaa6de3> test data files
<https://hg.mozilla.org/releases/mozilla-esr45/rev/a1e06af61ab3> client code
<https://hg.mozilla.org/releases/mozilla-esr45/rev/6ac20c152794> test code
Pushed the patches from [bug 1287176](/show_bug.cgi?id=1287176 "RESOLVED FIXED - Status file not written for staging errors") to mozilla-esr45
<https://hg.mozilla.org/releases/mozilla-esr45/rev/0569d5dce9db> client code
<https://hg.mozilla.org/releases/mozilla-esr45/rev/804d7029982c> test code
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a23249655_452604)• 8 years ago |

Flags: qe-verify+QA Contact: kjozwiakWhiteboard: fixed by bug 1168743 [checkin on 9/20] → fixed by bug 1168743 [checkin on 9/20][post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a23536543_280903)• 8 years ago |

Whiteboard: fixed by bug 1168743 [checkin on 9/20][post-critsmash-triage] → fixed by bug 1168743 [checkin on 9/20][post-critsmash-triage][adv-main50+][adv-esr45.5+]

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1246945#c42)• 8 years ago |
|  | |

I managed to reproduce this issue using Firefox 49.0.2 build 2 and STR from [Comment 0](/show_bug.cgi?id=1246945#c0 "VERIFIED FIXED - Write to arbitrary file with updater and moz maintenance service using updater.log hardlink").
The issue is no longer reproducible on Firefox 45.5.0ESR, Firefox 50.0, Firefox 51.0a2(2016-11-08), or on Firefox 52.0a1(2016-11-07).
Tests were performed under Windows 10x64.Status: RESOLVED → VERIFIED
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=verified)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
--- → [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified)
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
--- → [verified](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=verified)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=verified)

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1246945#c43)• 8 years ago |
|  | |

As :mboldan used Win 10 x64 for verification, I double checked using Win 7 as it was the original platform used in [comment#0](/show_bug.cgi?id=1246945#c0 "VERIFIED FIXED - Write to arbitrary file with updater and moz maintenance service using updater.log hardlink").
Reproduced the issue using the POC from [comment#0](/show_bug.cgi?id=1246945#c0 "VERIFIED FIXED - Write to arbitrary file with updater and moz maintenance service using updater.log hardlink") with the following build:
\* <https://archive.mozilla.org/pub/firefox/nightly/2016/02/2016-02-09-03-03-47-mozilla-central/>
Platform used:
\* Win 7 SP1 x64 - PASSED
Changed the appropriate paths under "write.poc\poc.rb" when using fx51.0a2 and fx50.0b9.
FX builds being used:
\* fx52.0a1, buildId: 20161108030212, changeset: f13e90d496cf - PASSED
\* fx51.0a2, buildId: 20161108004019, changeset: d9cfe58247e8 - PASSED
\* fx50.0b9, buildId: 20161020152750, changeset: 2bb6dc758711 - PASSED
\* fx45.5.0, buildId: 20161031153904, changeset: 32ce7be98543 - PASSED

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a23775350_280903)• 8 years ago |

Alias: CVE-2016-5293

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a24908695_75935)• 8 years ago |

Whiteboard: fixed by bug 1168743 [checkin on 9/20][post-critsmash-triage][adv-main50+][adv-esr45.5+] → [post-critsmash-triage][adv-main50+][adv-esr45.5+] fixed by bug 1168743

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a31626116_1689)• 8 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246945#a262055298_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1246945&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Holger Fuhrmannek](/user_profile?user_id=436533)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_ce132be8_20250125_045731.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2016-89

## Security vulnerabilities fixed in Firefox 50

Announced
November 15, 2016
Impact
critical
Products
Firefox
Fixed in

* Firefox 50

#### [#CVE-2016-5296: Heap-buffer-overflow WRITE in rasterize\_edges\_1](#CVE-2016-5296)

Reporter
Abhishek Arya
Impact
critical
##### Description

A heap-buffer-overflow in Cairo when processing SVG content caused by compiler optimization, resulting in a potentially exploitable crash.

##### References

* [Bug 1292443](https://bugzilla.mozilla.org/show_bug.cgi?id=1292443)

#### [#CVE-2016-5292: URL parsing causes crash](#CVE-2016-5292)

Reporter
Daniel Browning
Impact
high
##### Description

During URL parsing, a maliciously crafted URL can cause a potentially exploitable crash.

##### References

* [Bug 1288482](https://bugzilla.mozilla.org/show_bug.cgi?id=1288482)

#### [#CVE-2016-5293: Write to arbitrary file with Mozilla Updater and Maintenance Service using updater.log hardlink](#CVE-2016-5293)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

When the Mozilla Updater is run, if the Updater's log file in the working directory points to a hardlink, data can be appended to an arbitrary local file. This vulnerability requires local system access.
*Note: this issue only affects Windows operating systems.*

##### References

* [Bug 1246945](https://bugzilla.mozilla.org/show_bug.cgi?id=1246945)

#### [#CVE-2016-5294: Arbitrary target directory for result files of update process](#CVE-2016-5294)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

The Mozilla Updater can be made to choose an arbitrary target working directory for output files resulting from the update process. This vulnerability requires local system access.
*Note: this issue only affects Windows operating systems.*

##### References

* [Bug 1246972](https://bugzilla.mozilla.org/show_bug.cgi?id=1246972)

#### [#CVE-2016-5297: Incorrect argument length checking in JavaScript](#CVE-2016-5297)

Reporter
André Bargull
Impact
high
##### Description

An error in argument length checking in JavaScript, leading to potential integer overflows or other bounds checking issues.

##### References

* [Bug 1303678](https://bugzilla.mozilla.org/show_bug.cgi?id=1303678)

#### [#CVE-2016-9064: Add-ons update must verify IDs match between current and new versions](#CVE-2016-9064)

Reporter
Multiple people
Impact
high
##### Description

Add-on updates failed to verify that the add-on ID inside the signed package matched the ID of the add-on being updated. An attacker who could perform a man-in-the-middle attack on the user's connection to the update server and defeat the certificate pinning protection could provide a malicious signed add-on instead of a valid update.

##### References

* [Bug 1303418](https://bugzilla.mozilla.org/show_bug.cgi?id=1303418)

#### [#CVE-2016-9065: Firefox for Android location bar spoofing using fullscreen](#CVE-2016-9065)

Reporter
Raphael
Impact
high
##### Description

The location bar in Firefox for Android can be spoofed by forcing a user into fullscreen mode, blocking its exiting, and creating of a fake location bar without any user notification.
*Note: This issue only affects Firefox for Android. Other versions and operating systems are unaffected.*

##### References

* [Bug 1306696](https://bugzilla.mozilla.org/show_bug.cgi?id=1306696)

#### [#CVE-2016-9066: Integer overflow leading to a buffer overflow in nsScriptLoadHandler](#CVE-2016-9066)

Reporter
Samuel Groß
Impact
high
##### Description

A buffer overflow resulting in a potentially exploitable crash due to memory allocation issues when handling large amounts of incoming data.

##### References

* [Bug 1299686](https://bugzilla.mozilla.org/show_bug.cgi?id=1299686)

#### [#CVE-2016-9067: heap-use-after-free in nsINode::ReplaceOrInsertBefore](#CVE-2016-9067)

Reporter
Nils
Impact
high
##### Description

Two use-after-free errors during DOM operations resulting in potentially exploitable crashes.

##### References

* [Bug 1301777 (CVE-2016-9067)](https://bugzilla.mozilla.org/show_bug.cgi?id=1301777)
* [Bug 1308922 (CVE-2016-9069)](https://bugzilla.mozilla.org/show_bug.cgi?id=1308922)

#### [#CVE-2016-9068: heap-use-after-free in nsRefreshDriver](#CVE-2016-9068)

Reporter
Nils
Impact
high
##### Description

A use-after-free during web animations when working with timelines resulting in a potentially exploitable crash.

##### References

* [Bug 1302973](https://bugzilla.mozilla.org/show_bug.cgi?id=1302973)

#### [#CVE-2016-9072: 64-bit NPAPI sandbox isn't enabled on fresh profile](#CVE-2016-9072)

Reporter
Bob Owen
Impact
high
##### Description

When a new Firefox profile is created on 64-bit Windows installations, the sandbox for 64-bit NPAPI plugins is not enabled by default.
*Note: This issue only affects 64-bit Windows. 32-bit Windows and other operating systems are unaffected.*

##### References

* [Bug 1300083](https://bugzilla.mozilla.org/show_bug.cgi?id=1300083)

#### [#CVE-2016-9075: WebExtensions can access the mozAddonManager API and use it to gain elevated privileges](#CVE-2016-9075)

Reporter
Kris Maglione
Impact
high
##### Description

An issue where WebExtensions can use the mozAddonManager API to elevate privilege due to privileged pages being allowed in the permissions list. This allows a malicious extension to then install additional extensions without explicit user permission.

##### References

* [Bug 1295324](https://bugzilla.mozilla.org/show_bug.cgi?id=1295324)

#### [#CVE-2016-9077: Canvas filters allow feDisplacementMaps to be applied to cross-origin images, allowing timing attacks on them](#CVE-2016-9077)

Reporter
Markus Stange
Impact
high
##### Description

Canvas allows the use of the `feDisplacementMap` filter on images loaded cross-origin. The rendering by the filter is variable depending on the input pixel, allowing for timing attacks when the images are loaded from third party locations.

##### References

* [Bug 1298552](https://bugzilla.mozilla.org/show_bug.cgi?id=1298552)

#### [#CVE-2016-5291: Same-origin policy violation using local HTML file and saved shortcut file](#CVE-2016-5291)

Reporter
Yuyang Zhou
Impact
moderate
##### Description

A same-origin policy bypass with local shortcut files to load arbitrary local content from disk.

##### References

* [Bug 1292159](https://bugzilla.mozilla.org/show_bug.cgi?id=1292159)

#### [#CVE-2016-5295: Mozilla Maintenance Service: Ability to read arbitrary files as SYSTEM](#CVE-2016-5295)

Reporter
Holger Fuhrmannek
Impact
moderate
##### Description

This vulnerability allows an attacker to use the Mozilla Maintenance Service to escalate privilege by having the Maintenance Service invoke the Mozilla Updater to run malicious local files. This vulnerability requires local system access and is a variant of MFSA2013-44.
*Note: this issue only affects Windows operating systems.*

##### References

* [Bug 1247239](https://bugzilla.mozilla.org/show_bug.cgi?id=1247239)
* [MFSA2013-44 - Local privilege escalation through Mozilla Maintenance Service](https://www.mozilla.org/en-US/security/advisories/mfsa2013-44/)

#### [#CVE-2016-5298: SSL indicator can mislead the user about the real URL visited](#CVE-2016-5298)

Reporter
Jordi Chancel
Impact
moderate
##### Description

A mechanism where disruption of the loading of a new web page can cause the previous page's favicon and SSL indicator to not be reset when the new page is loaded.
*Note: this issue only affects Firefox for Android. Desktop Firefox is unaffected.*

##### References

* [Bug 1227538](https://bugzilla.mozilla.org/show_bug.cgi?id=1227538)

#### [#CVE-2016-5299: Firefox AuthToken in broadcast protected with signature-level permission can be accessed by an application installed beforehand that defines the same permissions](#CVE-2016-5299)

Reporter
Ken Okuyama
Impact
moderate
##### Description

A previously installed malicious Android application with same signature-level permissions as Firefox can intercept AuthTokens meant for Firefox only.
*Note: This issue only affects Firefox for Android. Other versions and operating systems are unaffected.*

##### References

* [Bug 1245791](https://bugzilla.mozilla.org/show_bug.cgi?id=1245791)

#### [#CVE-2016-9061: API key (glocation) in broadcast protected with signature-level permission can be accessed by an application installed beforehand that defines the same permissions](#CVE-2016-9061)

Reporter
Ken Okuyama
Impact
moderate
##### Description

A previously installed malicious Android application which defines a specific signature-level permissions used by Firefox can access API keys meant for Firefox only.
*Note: This issue only affects Firefox for Android. Other versions and operating systems are unaffected.*

##### References

* [Bug 1245795](https://bugzilla.mozilla.org/show_bug.cgi?id=1245795)

#### [#CVE-2016-9062: Private browsing browser traces (Android) in browser.db and wal file](#CVE-2016-9062)

Reporter
Daniel D.
Impact
moderate
##### Description

Private browsing mode leaves metadata information, such as URLs, for sites visited in `browser.db` and `browser.db-wal` files within the Firefox profile after the mode is exited.
*Note: This issue only affects Firefox for Android. Other versions and operating systems are unaffected.*

##### References

* [Bug 1294438](https://bugzilla.mozilla.org/show_bug.cgi?id=1294438)

#### [#CVE-2016-9070: Sidebar bookmark can have reference to chrome window](#CVE-2016-9070)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

A maliciously crafted page loaded to the sidebar through a bookmark can reference a privileged chrome window and engage in limited JavaScript operations violating cross-origin protections.

##### References

* [Bug 1281071](https://bugzilla.mozilla.org/show_bug.cgi?id=1281071)

#### [#CVE-2016-9073: windows.create schema doesn't specify "format": "relativeUrl"](#CVE-2016-9073)

Reporter
Will Bamberg
Impact
moderate
##### Description

WebExtensions can bypass security checks to load privileged URLs and potentially escape the WebExtension sandbox.

##### References

* [Bug 1289273](https://bugzilla.mozilla.org/show_bug.cgi?id=1289273)

#### [#CVE-2016-9074: Insufficient timing side-channel resistance in divSpoiler](#CVE-2016-9074)

Reporter
Franziskus Kiefer
Impact
moderate
##### Description

An existing mitigation of timing side-channel attacks is insufficient in some circumstances. This issue is addressed in Network Security Services (NSS) 3.26.1.

##### References

* [Bug 1293334](https://bugzilla.mozilla.org/show_bug.cgi?id=1293334)

#### [#CVE-2016-9076: select dropdown menu can be used for URL bar spoofing on e10s](#CVE-2016-9076)

Reporter
Mats Palmgren
Impact
moderate
##### Description

An issue where a `<select>` dropdown menu can be used to cover location bar content, resulting in potential spoofing attacks. This attack requires e10s to be enabled in order to function.

##### References

* [Bug 1276976](https://bugzilla.mozilla.org/show_bug.cgi?id=1276976)

#### [#CVE-2016-9063: Possible integer overflow to fix inside XML\_Parse in Expat](#CVE-2016-9063)

Reporter
Gustavo Grieco
Impact
low
##### Description

An integer overflow during the parsing of XML using the Expat library.

##### References

* [Bug 1274777](https://bugzilla.mozilla.org/show_bug.cgi?id=1274777)

#### [#CVE-2016-9071: Probe browser history via HSTS/301 redirect + CSP](#CVE-2016-9071)

Reporter
Xiaoyin Liu
Impact
low
##### Description

Content Security Policy combined with HTTP to HTTPS redirection can be used by malicious server to verify whether a known site is within a user's browser history.

##### References

* [Bug 1285003](https://bugzilla.mozilla.org/show_bug.cgi?id=1285003)

#### [#CVE-2016-5289: Memory safety bugs fixed in Firefox 50](#CVE-2016-5289)

Reporter
Mozilla developers
Impact
critical
##### Description

Mozilla developers and community members Christian Holler, Andrew McCreight, Dan Minor, Tyson Smith, Jon Coppeard, Jan-Ivar Bruaroey, Jesse Ruderman, and Markus Stange reported memory safety bugs present in Firefox 49. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 50](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1296649%2C1298107%2C1300129%2C1305876%2C1314667%2C1301252%2C1277866%2C1307254%2C1252511%2C1264053)

#### [#CVE-2016-5290: Memory safety bugs fixed in Firefox 50 and Firefox ESR 45.5](#CVE-2016-5290)

Reporter
Mozilla developers
Impact
critical
##### Description

Mozilla developers and community members Olli Pettay, Christian Holler, Ehsan Akhgari, Jon Coppeard, Gary Kwong, Tooru Fujisawa, Philipp, and Randell Jesup reported memory safety bugs present in Firefox 49 and Firefox ESR 45.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 50 and Firefox ESR 45.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1309720%2C1297062%2C1303710%2C1018486%2C1292590%2C1301343%2C1301496%2C1308048%2C1308346%2C1299519%2C1286911%2C1298169)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from wiki.mozilla.org_3659d679_20250126_060757.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from bugzilla.mozilla.org_05e64c07_20250126_060801.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1292443)
* [XML](/show_bug.cgi?ctype=xml&id=1292443)

Closed
[Bug 1292443](/show_bug.cgi?id=1292443)
(CVE-2016-5296)

Opened 8 years ago
Closed 8 years ago

# Heap-buffer-overflow WRITE in rasterize\_edges\_1

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Heap-buffer-overflow WRITE in rasterize\_edges\_1

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla52

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | [50+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=50%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=verified) |
| firefox50 | [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=verified) |
| firefox51 | [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified) |
| firefox52 | [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr45 | 50+ | verified |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox50 | + | verified |
| firefox51 | + | verified |
| firefox52 | + | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: inferno, Assigned: jrmuizel)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ad916833cb7747e6939d576f34df1daa?d=mm&size=40)  [jrmuizel](/user_profile?user_id=309398)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/61d5301eaed11c2f726c8ea95578e6b2?d=mm&size=40)  [inferno](/user_profile?user_id=397541)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [post-critsmash-triage][adv-main50+][adv-esr45.5+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2016-5296

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[csectype-undefined](/buglist.cgi?keywords=csectype-undefined&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main50+][adv-esr45.5+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a5141426_1689 "8 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (7 files, 2 obsolete files)

| [Testcase](/attachment.cgi?id=8778096)  [8 years ago](#c0)  [Abhishek Arya](/user_profile?user_id=397541)   4.65 KB, image/svg+xml |  | [Details](/attachment.cgi?id=8778096&action=edit) |
| --- | --- | --- |
| [testcase 2 (reduced)](/attachment.cgi?id=8779869)  [8 years ago](#c7)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   413 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=8779869&action=edit) |
| [testcase 3 (interactive -- hover blue area to test)](/attachment.cgi?id=8779903)  [8 years ago](#c9)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   489 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=8779903&action=edit) |
| [debugging patch v1](/attachment.cgi?id=8779906)  [8 years ago](#c10)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   2.62 KB, patch |  | [Details](/attachment.cgi?id=8779906&action=edit) | [Diff](/attachment.cgi?id=8779906&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8779906) |
| [snippet of annotated disassembly](/attachment.cgi?id=8785631)  [8 years ago](#c15)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   2.17 KB, text/plain |  | [Details](/attachment.cgi?id=8785631&action=edit) |
| [snippet of annotated disassembly #2](/attachment.cgi?id=8786096)  [8 years ago](#c16)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   3.16 KB, text/plain |  | [Details](/attachment.cgi?id=8786096&action=edit) |
| [Check for overflow.](/attachment.cgi?id=8798497)  [8 years ago](#c31)  [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486)   1.07 KB, patch |  | [Details](/attachment.cgi?id=8798497&action=edit) | [Diff](/attachment.cgi?id=8798497&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8798497) |
| [Cast to unsigned for arithmetic](/attachment.cgi?id=8800006)  [8 years ago](#c32)  [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)   25.18 KB, patch |  | [Details](/attachment.cgi?id=8800006&action=edit) | [Diff](/attachment.cgi?id=8800006&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8800006) |
| [Cast to unsigned for arithmetic](/attachment.cgi?id=8800854)  [8 years ago](#c34)  [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)   667 bytes, patch | dholbert : [review+](#c37 "8 years ago")  dveditz : [approval-mozilla-aurora+](#c45 "8 years ago")  dveditz : [approval-mozilla-beta+](#c45 "8 years ago")  dveditz : [approval-mozilla-esr45+](#c45 "8 years ago")  dveditz : [sec-approval+](#c45 "8 years ago") | [Details](/attachment.cgi?id=8800854&action=edit) | [Diff](/attachment.cgi?id=8800854&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8800854) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Abhishek Arya](/user_profile?user_id=397541)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1292443#c0)• 8 years ago |
|  | |

Attached image
[Testcase](attachment.cgi?id=8778096)
— [Details](attachment.cgi?id=8778096&action=edit)

==13447==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6230000601a8 at pc 0x0000004bea3c bp 0x7ffeffd80c70 sp 0x7ffeffd80420
WRITE of size 4112 at 0x6230000601a8 thread T0 (Web Content)
SCARINESS: 55 (multi-byte-write-heap-buffer-overflow-far-from-bounds)
#0 0x4bea3b in \_\_asan\_memset \_asan\_rtl\_
#1 0x7fd8de8e2b4c in rasterize\_edges\_1 gfx/cairo/libpixman/src/pixman-edge-imp.h:125:7
#2 0x7fd8de8e2b4c in pixman\_rasterize\_edges\_no\_accessors gfx/cairo/libpixman/src/pixman-edge.c:351
#3 0x7fd8de8e2b4c in \_moz\_pixman\_rasterize\_edges gfx/cairo/libpixman/src/pixman-edge.c:382
#4 0x7fd8de99d824 in \_moz\_pixman\_rasterize\_trapezoid gfx/cairo/libpixman/src/pixman-trap.c:386:2
#5 0x7fd8de7b1392 in \_pixman\_image\_add\_traps gfx/cairo/cairo/src/cairo-image-surface.c:2466:2
#6 0x7fd8de7b0701 in \_composite\_traps gfx/cairo/cairo/src/cairo-image-surface.c:2516:5
#7 0x7fd8de7b5b18 in \_clip\_and\_composite gfx/cairo/cairo/src/cairo-image-surface.c:2359:15
#8 0x7fd8de7b891f in \_clip\_and\_composite\_trapezoids gfx/cairo/cairo/src/cairo-image-surface.c:3258:12
#9 0x7fd8de7b7d7d in \_clip\_and\_composite\_polygon gfx/cairo/cairo/src/cairo-image-surface.c:3625:15
#10 0x7fd8de7a3ceb in \_cairo\_image\_surface\_stroke gfx/cairo/cairo/src/cairo-image-surface.c:3717:15
#11 0x7fd8de81bce1 in \_cairo\_surface\_stroke gfx/cairo/cairo/src/cairo-surface.c:2296:11
#12 0x7fd8de796646 in \_cairo\_gstate\_stroke gfx/cairo/cairo/src/cairo-gstate.c:1166:14
#13 0x7fd8de83ea7d in \_moz\_cairo\_stroke\_preserve gfx/cairo/cairo/src/cairo.c:2430:14
#14 0x7fd8d75bfbcf in mozilla::gfx::DrawTargetCairo::DrawPattern(mozilla::gfx::Pattern const&, mozilla::gfx::StrokeOptions const&, mozilla::gfx::DrawOptions const&, mozilla::gfx::DrawTargetCairo::DrawPatternType, bool) gfx/2d/DrawTargetCairo.cpp:1024:7
#15 0x7fd8d75c4f81 in mozilla::gfx::DrawTargetCairo::Stroke(mozilla::gfx::Path const\*, mozilla::gfx::Pattern const&, mozilla::gfx::StrokeOptions const&, mozilla::gfx::DrawOptions const&) gfx/2d/DrawTargetCairo.cpp:1255:3
#16 0x7fd8dcd8bca6 in nsSVGPathGeometryFrame::Render(gfxContext\*, unsigned int, gfxMatrix const&) layout/svg/nsSVGPathGeometryFrame.cpp:867:21
#17 0x7fd8dcd8a20d in nsSVGPathGeometryFrame::PaintSVG(gfxContext&, gfxMatrix const&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const\*) layout/svg/nsSVGPathGeometryFrame.cpp:293:5
#18 0x7fd8dcd88726 in nsDisplaySVGPathGeometry::Paint(nsDisplayListBuilder\*, nsRenderingContext\*) layout/svg/nsSVGPathGeometryFrame.cpp:125:51
#19 0x7fd8dc5f5f98 in mozilla::FrameLayerBuilder::PaintItems(nsTArray<mozilla::FrameLayerBuilder::ClippedDisplayItem>&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, gfxContext\*, nsRenderingContext\*, nsDisplayListBuilder\*, nsPresContext\*, mozilla::gfx::IntPointTyped<mozilla::gfx::UnknownUnits> const&, float, float, int) layout/base/FrameLayerBuilder.cpp:5710:21
#20 0x7fd8dc5f9433 in mozilla::FrameLayerBuilder::DrawPaintedLayer(mozilla::layers::PaintedLayer\*, gfxContext\*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void\*) layout/base/FrameLayerBuilder.cpp:5885:19
#21 0x7fd8d7940a51 in mozilla::layers::BasicPaintedLayer::PaintThebes(gfxContext\*, mozilla::layers::Layer\*, void (\*)(mozilla::layers::PaintedLayer\*, gfxContext\*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void\*), void\*) gfx/layers/basic/BasicPaintedLayer.cpp:95:9
#22 0x7fd8d793b3ec in mozilla::layers::BasicLayerManager::PaintSelfOrChildren(mozilla::layers::PaintLayerContext&, gfxContext\*) gfx/layers/basic/BasicLayerManager.cpp:714:13
#23 0x7fd8d7939c49 in mozilla::layers::BasicLayerManager::PaintLayer(gfxContext\*, mozilla::layers::Layer\*, void (\*)(mozilla::layers::PaintedLayer\*, gfxContext\*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void\*), void\*) gfx/layers/basic/BasicLayerManager.cpp:883:5
#24 0x7fd8d793b0b2 in mozilla::layers::BasicLayerManager::PaintSelfOrChildren(mozilla::layers::PaintLayerContext&, gfxContext\*) gfx/layers/basic/BasicLayerManager.cpp:735:7
#25 0x7fd8d7939c49 in mozilla::layers::BasicLayerManager::PaintLayer(gfxContext\*, mozilla::layers::Layer\*, void (\*)(mozilla::layers::PaintedLayer\*, gfxContext\*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void\*), void\*) gfx/layers/basic/BasicLayerManager.cpp:883:5
#26 0x7fd8d7934f1d in mozilla::layers::BasicLayerManager::EndTransactionInternal(void (\*)(mozilla::layers::PaintedLayer\*, gfxContext\*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void\*), void\*, mozilla::layers::LayerManager::EndTransactionFlags) gfx/layers/basic/BasicLayerManager.cpp:623:5
#27 0x7fd8dc5f5fb6 in PaintInactiveLayer layout/base/FrameLayerBuilder.cpp:3605:12
#28 0x7fd8dc5f5fb6 in mozilla::FrameLayerBuilder::PaintItems(nsTArray<mozilla::FrameLayerBuilder::ClippedDisplayItem>&, mozilla::gfx::IntRectTyped<mozilla::gfx::UnknownUnits> const&, gfxContext\*, nsRenderingContext\*, nsDisplayListBuilder\*, nsPresContext\*, mozilla::gfx::IntPointTyped<mozilla::gfx::UnknownUnits> const&, float, float, int) layout/base/FrameLayerBuilder.cpp:5696
#29 0x7fd8dc5f9433 in mozilla::FrameLayerBuilder::DrawPaintedLayer(mozilla::layers::PaintedLayer\*, gfxContext\*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void\*) layout/base/FrameLayerBuilder.cpp:5885:19
#30 0x7fd8d79536e2 in mozilla::layers::ClientPaintedLayer::PaintThebes() gfx/layers/client/ClientPaintedLayer.cpp:94:5
#31 0x7fd8d795437d in mozilla::layers::ClientPaintedLayer::RenderLayerWithReadback(mozilla::layers::ReadbackProcessor\*) gfx/layers/client/ClientPaintedLayer.cpp:148:3
#32 0x7fd8d796dd8c in mozilla::layers::ClientContainerLayer::RenderLayer() gfx/layers/client/ClientContainerLayer.h:65:29
#33 0x7fd8d796dd8c in mozilla::layers::ClientContainerLayer::RenderLayer() gfx/layers/client/ClientContainerLayer.h:65:29
#34 0x7fd8d796dd8c in mozilla::layers::ClientContainerLayer::RenderLayer() gfx/layers/client/ClientContainerLayer.h:65:29
#35 0x7fd8d796dd8c in mozilla::layers::ClientContainerLayer::RenderLayer() gfx/layers/client/ClientContainerLayer.h:65:29
#36 0x7fd8d796dd8c in mozilla::layers::ClientContainerLayer::RenderLayer() gfx/layers/client/ClientContainerLayer.h:65:29
#37 0x7fd8d796dd8c in mozilla::layers::ClientContainerLayer::RenderLayer() gfx/layers/client/ClientContainerLayer.h:65:29
#38 0x7fd8d796dd8c in mozilla::layers::ClientContainerLayer::RenderLayer() gfx/layers/client/ClientContainerLayer.h:65:29
#39 0x7fd8d794e89e in mozilla::layers::ClientLayerManager::EndTransactionInternal(void (\*)(mozilla::layers::PaintedLayer\*, gfxContext\*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void\*), void\*, mozilla::layers::LayerManager::EndTransactionFlags) gfx/layers/client/ClientLayerManager.cpp:296:9
#40 0x7fd8d794ee7c in mozilla::layers::ClientLayerManager::EndTransaction(void (\*)(mozilla::layers::PaintedLayer\*, gfxContext\*, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, mozilla::layers::DrawRegionClip, mozilla::gfx::IntRegionTyped<mozilla::gfx::UnknownUnits> const&, void\*), void\*, mozilla::layers::LayerManager::EndTransactionFlags) gfx/layers/client/ClientLayerManager.cpp:339:3
#41 0x7fd8dc74a3db in nsDisplayList::PaintRoot(nsDisplayListBuilder\*, nsRenderingContext\*, unsigned int) layout/base/nsDisplayList.cpp:1927:17
#42 0x7fd8dc7fb0d0 in nsLayoutUtils::PaintFrame(nsRenderingContext\*, nsIFrame\*, nsRegion const&, unsigned int, nsDisplayListBuilderMode, nsLayoutUtils::PaintFrameFlags) layout/base/nsLayoutUtils.cpp:3606:10
#43 0x7fd8dc8835ad in PresShell::Paint(nsView\*, nsRegion const&, unsigned int) layout/base/nsPresShell.cpp:6636:5
#44 0x7fd8dbe4bf5c in nsViewManager::ProcessPendingUpdatesPaint(nsIWidget\*) view/nsViewManager.cpp:484:19
#45 0x7fd8dbe4ad31 in nsViewManager::ProcessPendingUpdatesForView(nsView\*, bool) view/nsViewManager.cpp:415:33
#46 0x7fd8dbe4ecc9 in nsViewManager::ProcessPendingUpdates() view/nsViewManager.cpp:1119:5
#47 0x7fd8dc57654f in nsRefreshDriver::Tick(long, mozilla::TimeStamp) layout/base/nsRefreshDriver.cpp:1911:9
#48 0x7fd8dc58109d in TickDriver layout/base/nsRefreshDriver.cpp:279:13
#49 0x7fd8dc58109d in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) layout/base/nsRefreshDriver.cpp:251
#50 0x7fd8dc580cf9 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) layout/base/nsRefreshDriver.cpp:270:5
#51 0x7fd8dc582c94 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::NotifyVsync(mozilla::TimeStamp) layout/base/nsRefreshDriver.cpp:430:9
#52 0x7fd8dcf0c2c4 in mozilla::layout::VsyncChild::RecvNotify(mozilla::TimeStamp const&) layout/ipc/VsyncChild.cpp:64:16
#53 0x7fd8d6823059 in mozilla::layout::PVsyncChild::OnMessageReceived(IPC::Message const&) objdir-ff-asan/ipc/ipdl/PVsyncChild.cpp:240:20
#54 0x7fd8d62a1814 in mozilla::ipc::PBackgroundChild::OnMessageReceived(IPC::Message const&) objdir-ff-asan/ipc/ipdl/PBackgroundChild.cpp:2133:28
#55 0x7fd8d61cd566 in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) ipc/glue/MessageChannel.cpp:1661:25
#56 0x7fd8d61c9c87 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) ipc/glue/MessageChannel.cpp:1599:17
#57 0x7fd8d61b6dff in mozilla::ipc::MessageChannel::OnMaybeDequeueOne() ipc/glue/MessageChannel.cpp:1566:5
#58 0x7fd8d61e8152 in applyImpl<mozilla::ipc::MessageChannel, bool (mozilla::ipc::MessageChannel::\*)()> objdir-ff-asan/dist/include/nsThreadUtils.h:729:12
#59 0x7fd8d61e8152 in apply<mozilla::ipc::MessageChannel, bool (mozilla::ipc::MessageChannel::\*)()> objdir-ff-asan/dist/include/nsThreadUtils.h:735
#60 0x7fd8d61e8152 in mozilla::detail::RunnableMethodImpl<bool (mozilla::ipc::MessageChannel::\*)(), false, true>::Run() objdir-ff-asan/dist/include/nsThreadUtils.h:764
#61 0x7fd8d61e773f in Run objdir-ff-asan/dist/include/mozilla/ipc/MessageChannel.h:550:29
#62 0x7fd8d61e773f in mozilla::ipc::MessageChannel::DequeueTask::Run() objdir-ff-asan/dist/include/mozilla/ipc/MessageChannel.h:569
#63 0x7fd8d53e8802 in nsThread::ProcessNextEvent(bool, bool\*) xpcom/threads/nsThread.cpp:1068:14
#64 0x7fd8d54684d8 in NS\_ProcessNextEvent(nsIThread\*, bool) xpcom/glue/nsThreadUtils.cpp:290:10
#65 0x7fd8d61d4d51 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate\*) ipc/glue/MessagePump.cpp:100:21
#66 0x7fd8d61478f0 in RunInternal ipc/chromium/src/base/message\_loop.cc:232:10
#67 0x7fd8d61478f0 in RunHandler ipc/chromium/src/base/message\_loop.cc:225
#68 0x7fd8d61478f0 in MessageLoop::Run() ipc/chromium/src/base/message\_loop.cc:205
#69 0x7fd8dbec0e2f in nsBaseAppShell::Run() widget/nsBaseAppShell.cpp:156:27
#70 0x7fd8ddfe49c7 in XRE\_RunAppShell toolkit/xre/nsEmbedFunctions.cpp:851:22
#71 0x7fd8d61478f0 in RunInternal ipc/chromium/src/base/message\_loop.cc:232:10
#72 0x7fd8d61478f0 in RunHandler ipc/chromium/src/base/message\_loop.cc:225
#73 0x7fd8d61478f0 in MessageLoop::Run() ipc/chromium/src/base/message\_loop.cc:205
#74 0x7fd8ddfe4088 in XRE\_InitChildProcess toolkit/xre/nsEmbedFunctions.cpp:681:34
#75 0x510ae1 in content\_process\_main ipc/contentproc/plugin-container.cpp:224:19
#76 0x510ae1 in main browser/app/nsBrowserApp.cpp:357
#77 0x7fd8ef154f44 in \_\_libc\_start\_main /build/eglibc-oGUzwX/eglibc-2.19/csu/libc-start.c:287
AddressSanitizer can not describe address in more detail (wild memory access suspected).
SUMMARY: AddressSanitizer: heap-buffer-overflow (/mnt/scratch0/clusterfuzz/slave-bot/builds/linux\_asan\_firefox/custom/firefox/firefox-bin+0x4bea3b)
Shadow bytes around the buggy address:
0x0c4680003fe0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c4680003ff0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c4680004000: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c4680004010: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c4680004020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
=>0x0c4680004030: fa fa fa fa fa[fa]fa fa fa fa fa fa fa fa fa fa
0x0c4680004040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c4680004050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c4680004060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c4680004070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
0x0c4680004080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
Addressable: 00
Partially addressable: 01 02 03 04 05 06 07
Heap left redzone: fa
Heap right redzone: fb
Freed heap region: fd
Stack left redzone: f1
Stack mid redzone: f2
Stack right redzone: f3
Stack partial redzone: f4
Stack after return: f5
Stack use after scope: f8
Global redzone: f9
Global init order: f6
Poisoned by user: f7
Container overflow: fc
Array cookie: ac
Intra object redzone: bb
ASan internal: fe
Left alloca redzone: ca
Right alloca redzone: cb
==13447==ABORTING

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1292443#c1)• 8 years ago |
|  | |

Daniel: please direct this bug to someone in the SVG team that can work on it.Group: core-security → layout-core-securityFlags: needinfo?(dholbert)Keywords: [csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1292443#c2)• 8 years ago |
|  | |

I'll take a look to start out... Abishek, could you let me know what build/OS you're using?
I can't reproduce any ASAN issues on linux, using the latest inbound ASAN build:
<http://archive.mozilla.org/pub/firefox/tinderbox-builds/mozilla-inbound-linux64-asan-debug/1470715521/>
I just get this when loading the attached file:
> JavaScript error: file:///...path-to-file.../test.svg, line 15: SyntaxError: expected expression, got '}'
but no ASAN errors.Flags: needinfo?(dholbert) → needinfo?(inferno)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a349473_278074)• 8 years ago |

Flags: needinfo?(dholbert)

|  | [Abhishek Arya](/user_profile?user_id=397541)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1292443#c3)• 8 years ago |
|  | |

20160807213804 was previous build i used. i just tried with tip-of-tree trunk (6cf0089510fa) and easily reproduces with that svg file. you need to use release build. also my clang revision is [r277962](https://viewvc.svn.mozilla.org/vc?view=rev&revision=277962). and this was on linux.Flags: needinfo?(inferno)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1292443#c4)• 8 years ago |
|  | |

(In reply to Abhishek Arya from [comment #3](/show_bug.cgi?id=1292443#c3 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"))
> you need to use release build.
(I assume you mean an optimized build [not a build with release branding] -- gotcha.)
> also my clang revision is [r277962](https://viewvc.svn.mozilla.org/vc?view=rev&revision=277962). and this was on linux.
OK, thanks. Have you tested with a Mozilla-provided ASAN-enabled optimized Firefox build, like this one from today:
<https://ftp.mozilla.org/pub/firefox/tinderbox-builds/mozilla-central-linux64-asan/1470837316/firefox-51.0a1.en-US.linux-x86_64-asan.tar.bz2>
?
I just tried that one and still can't reproduce. I'm building locally as well, but given that I've failed to repro with 2 different types of ASAN builds so far, I'm wondering if there's another factor that I'm missing. (And if you could test [or let me know if you've already tested] a build like the FTP one above, that would rule out the possibility of something special in your build environment.)Flags: needinfo?(dholbert)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a473987_278074)• 8 years ago |

Flags: needinfo?(inferno)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1292443#c5)• 8 years ago |
|  | |

I just finished & tested my own local [enable-debug,enable-opt] ASAN Firefox build, as well -- couldn't repro any ASAN issues. I happen to be using clang from [r278176](https://viewvc.svn.mozilla.org/vc?view=rev&revision=278176) (~trunk), and mozilla-central c12bb83ad278 (also ~trunk).
I'll try Abhishek's clang/m-c revision next, to rule out the possibility of any differences there. But I suspect there's some other factor that I'm missing here.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1292443#c6)• 8 years ago |
|  | |

(In reply to Daniel Holbert [:dholbert] (recovering from vacation reviews/bugmail) from [comment #5](/show_bug.cgi?id=1292443#c5 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"))
> I'll try Abhishek's clang/m-c revision next, to rule out the possibility of
> any differences there.
OK, I've found that I can reproduce with those revisions.Flags: needinfo?(inferno)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1292443#c7)• 8 years ago |
|  | |

Attached file
[testcase 2 (reduced)](attachment.cgi?id=8779869)
— [Details](attachment.cgi?id=8779869&action=edit)

Here's a reduced / cleaned-up testcase that still triggers the crash for me (using a debug+opt ASAN-enabled build with the mozilla-central/clang revisions noted in [comment 3](/show_bug.cgi?id=1292443#c3 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1")).

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1292443#c8)• 8 years ago |
|  | |

er, s/still triggers the crash/still triggers the ASAN report/abort.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1292443#c9)• 8 years ago |
|  | |

Attached file
[testcase 3 (interactive -- hover blue area to test)](attachment.cgi?id=8779903)
— [Details](attachment.cgi?id=8779903&action=edit)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1292443#c10)• 8 years ago |
|  | |

Attached patch

[debugging patch v1](attachment.cgi?id=8779906&action=diff)
— [Details](attachment.cgi?id=8779906&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8779906)

Here's a debugging/diagnostic patch which demonstrates what the problem is, on my machine.
It seems the compiler is assuming (incorrectly in this case) that signed integer overflow will never happen. IIRC, that is something that compilers are allowed to assume. We end up with an (overflowed) hugely-negative number, which the code \*purportedly\* clamps to be nonnegative -- BUT in actual fact, we skip the "lx < 0" check (and the clamping code) because the compiler is mistakenly assuming the value is still positive.
Here's the tail end of the printf output from this patch, leading up to where we get killed by ASAN:
{
Initial lx: 2147183239
Adding 32767 to lx
Do we think lx=2147216006 is negative & needs clamping? No.
Initial lx: 2147254082
Adding 32767 to lx
Do we think lx=2147286849 is negative & needs clamping? No.
Initial lx: 2147324924
Adding 32767 to lx
Do we think lx=2147357691 is negative & needs clamping? No.
Initial lx: 2147395766
Adding 32767 to lx
Do we think lx=2147428533 is negative & needs clamping? No.
Initial lx: 2147466609
Adding 32767 to lx
OH NO, we're about to wrap lx past INT32\_MAX! Upcoming clamp might fail to catch this...
Do we think lx=-2147467920 is negative & needs clamping? No.
\*\*\*dholbert Calling WRITE with nmiddle=1029 (x=0, width=32964, startmask=0, endmask=15) (rx=12865573, lx=-2147467920) (rxi=196, lxi=-32768)
=================================================================
==12873==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x623000122378 at pc 0x7f5c6c3238c5 bp 0x7fffa9076e30 sp 0x7fffa9076e28
}
Note in particular the final "Do we think lx=-2147467920 is negative...No" report there. :-/ That's the problem.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1292443#c11)• 8 years ago |
|  | |

This particular chunk of code (the addition to & clamping of "lx") hasn't changed since a pixman update that happened in [bug 562087](/show_bug.cgi?id=562087 "RESOLVED FIXED - Update pixman to newer version") (back in 2010), BTW. And it looks like we had a version of this bug (potential for overflow & failure-to-clamp) before that, too.
This bug exists in the latest version of the pixman code that I can find, too (i.e. it may trigger signed-overflow and then fail to clamp a negative |lx| value):
> lx += X\_FRAC\_FIRST(1) - pixman\_fixed\_e;
> rx += X\_FRAC\_FIRST(1) - pixman\_fixed\_e;
> #endif
> /\* clip X \*/
> if (lx < 0)
> lx = 0;
<https://cgit.freedesktop.org/pixman/tree/pixman/pixman-edge-imp.h#n58>
Ideally this should get fixed in pixman, but that's perhaps pretty fragile... Perhaps we can also add some sanity-checking in the code that produces such large |lx| values, to clamp it such that it can never get this close to INT32\_MAX.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a495258_278074)• 8 years ago |

Flags: needinfo?(dholbert)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1292443#c12)• 8 years ago |
|  | |

Jeff, maybe this falls under your wheelhouse, as being a bug in cairo... do you have any ideas on what we should do here? Perhaps we should add a spot fix here to check that lx and rx aren't going to overflow \*before\* we do the addition? (since checking for after the overflow already happened isn't guaranteed to work, due to compiler optimizations)
See my description of the bug in [comment 10](/show_bug.cgi?id=1292443#c10 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"). As shown in the output there, this value |lx| is overflowing into negative territory, and it's used to determine where we write some memory, so we end up writing into hugely negative memory.Flags: needinfo?(dholbert) → needinfo?(jmuizelaar)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1292443#c13)• 8 years ago |
|  | |

>so we end up writing into hugely negative memory.
(By which I meant to say: we end up writing at a hugely negative offset from some pointer, i.e. at a bogus location.)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1292443#c14)• 8 years ago |
|  | |

(In reply to Daniel Holbert [:dholbert] from [comment #11](/show_bug.cgi?id=1292443#c11 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"))
I'd like to understand how the compiler is dropping the check. Can you perhaps post the annotated assembly?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a1792056_278074)• 8 years ago |

Flags: needinfo?(dholbert)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1292443#c15)• 8 years ago |
|  | |

Attached file
[snippet of annotated disassembly](attachment.cgi?id=8785631)
— [Details](attachment.cgi?id=8785631&action=edit)

Here's a snippet of the annotated disassembly of "rasterize\_edges\_1".
The source annotation is missing some source code -- it just shows us assigning |lx| and then checking if it's less than 0, and it's missing the lines of addition that I quoted in [comment 11](/show_bug.cgi?id=1292443#c11 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1") (adding X\_FRAC\_FIRST(1) - pixman\_fixed\_e)
But I think that addition is present in the annotation - I do see an "add" instruction in between the bunch of assembly between the assignment & the less-than-zero-check, at least.Flags: needinfo?(dholbert)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1292443#c16)• 8 years ago |
|  | |

Attached file
[snippet of annotated disassembly #2](attachment.cgi?id=8786096)
— [Details](attachment.cgi?id=8786096&action=edit)

I see different assembler from Daniel's.
It appears this code essentially does this instead:
if ("original lx before the increment" < -32767)
lx = 0;
which clearly ignores any overflow from the addition.
(this is an Opt ASAN build on 64-bit Linux with clang 3.8.0)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1292443#c17)• 8 years ago |
|  | |

If I use an unsigned type to do the addition then it seems to work,
presumably because unsigned overflow is well-defined:
- lx += X\_FRAC\_FIRST(1) - pixman\_fixed\_e;
- rx += X\_FRAC\_FIRST(1) - pixman\_fixed\_e;
+ uint32\_t lx\_unsigned = lx;
+ lx = lx\_unsigned + (X\_FRAC\_FIRST(1) - pixman\_fixed\_e);
+ uint32\_t rx\_unsigned = rx;
+ rx = rx\_unsigned + (X\_FRAC\_FIRST(1) - pixman\_fixed\_e);
I'm not sure how we typically fix stuff like this though.
Any suggestions?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1292443#c18)• 8 years ago |
|  | |

Reassigning to Graphics since the underlying bug is in Cairo.Group: layout-core-security → gfx-core-securitySeverity: normal → criticalComponent: SVG → GraphicsKeywords: [crash](/buglist.cgi?keywords=crash&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a2307650_1689)• 8 years ago |

Flags: sec-bounty?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1292443#c19)• 8 years ago |
|  | |

Milan is there somebody who can look at this? This externally reported sec-critical bug is about a month old. Thanks!Flags: needinfo?(milan)

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1292443#c20)• 8 years ago |
|  | |

Does this actually happen with non-ASAN builds? I couldn't quite tell from the different comments.Flags: needinfo?(milan) → needinfo?(dholbert)

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a2896747_456486)• 8 years ago |

Flags: needinfo?(milan)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1292443#c21)• 8 years ago |
|  | |

On Windows, the attached testcases show rendering issues with hardware acceleration disabled, but they don't crash. No asserts with debug builds. However, the switch to the Skia backend for unaccelerated layers ([bug 1007702](/show_bug.cgi?id=1007702 "RESOLVED FIXED - Enable skia content on Windows by default when not using D2D")) has made this go away on m-c tip, i.e. rendering now matches the accelerated rendering.
Per dholbert on IRC, the root pixman issue has probably been around since ever, so removing the regressionwindow-wanted keyword.Keywords: [regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1292443#c22)• 8 years ago |
|  | |

(In reply to Milan Sreckovic [:milan] from [comment #20](/show_bug.cgi?id=1292443#c20 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"))
> Does this actually happen with non-ASAN builds? I couldn't quite tell from
> the different comments.
I'm pretty sure. Since it depends on a compiler optimization, this does require optimizations to be enabled (i.e. not the sort of build we normally compile/test locally). I don't have an enable-optimize build handy, so I can't immediately check, but I'm rebuilding & can confirm soon.
My attached diagnostic patch should make it easy to detect if/when this bug happens, in any build (particularly opt builds). The key "printf" output to look for is something like this:
> OH NO, we're about to wrap lx past INT32\_MAX! Upcoming clamp might fail to catch this...
> Do we think lx=-2147467920 is negative & needs clamping? No.
"lx" is used as an assumed-to-be-positive offset for a write shortly after that point (and that's the dangerous/exploitable part).

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a2899287_406194)• 8 years ago |

Keywords: [csectype-undefined](/buglist.cgi?keywords=csectype-undefined&resolution=---)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1292443#c23)• 8 years ago |
|  | |

OK -- Milan, I can confirm that normal (non-ASAN) optimized builds \*\*are indeed affected by this bug\*\*, using my diagnostic patch. (I compiled my local opt build using Ubuntu 16.04's stock clang 3.8 version, if it matters.)
With my diagnostic patch applied, I see this go by in my terminal output when I load & hover testcase 3 (after grepping for "OH NO" to narrow in on the bad part):
> Adding 32767 to lx
> OH NO, we're about to wrap lx past INT32\_MAX! Upcoming clamp might fail to catch this...
> Do we think lx=-2147467920 is negative & needs clamping? No.
> \*\*\*dholbert Calling WRITE with nmiddle=1029 (x=0, width=32964, startmask=0, endmask=15) (rx=12865573, lx=-2147467920) (rxi=196, lxi=-32768)
Note that I had to manually enable cairo as my rendering backend here (by setting gfx.content.azure.backends=cairo) in order to enable this codepath. We recently switched to prefer/mandate skia on trunk, in [bug 1278957](/show_bug.cgi?id=1278957 "RESOLVED FIXED - Make Skia the default content backend on Linux"). But we're still shipping cairo in version 49 and 50, and as a fallback renderer on Windows, so we do still need to care about it I think.Flags: needinfo?(dholbert)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a3497820_280903)• 8 years ago |

[tracking-firefox51](/buglist.cgi?f1=cf_tracking_firefox51&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox51&o1=equals&v1=%2B)

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1292443#c24)• 8 years ago |
|  | |

I'm particularly enjoying this from [comment 23](/show_bug.cgi?id=1292443#c23 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"):
Do we think lx=-2147467920 is negative & needs clamping? No.
Yikes.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1292443#c25)• 8 years ago |
|  | |

Yeah, that's the problem. And then we use that as an (assumed-to-be-nonnegative) offset into a buffer, and we write data into that location.
Mats' suggestion in [comment 17](/show_bug.cgi?id=1292443#c17 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1") seems like a reasonable workaround to me, FWIW (just doing the arithmetic in unsigned space and then casting back to signed).

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1292443#c26)• 8 years ago |
|  | |

I don't mind changing the code, in order to fix this particular bug, but what are the chances of this being the only place where something like that happens?
It'd be interesting to try if -fwrapv option changes the behaviour at all.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1292443#c27)• 8 years ago |
|  | |

(In reply to Milan Sreckovic [:milan] from [comment #26](/show_bug.cgi?id=1292443#c26 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"))
> I don't mind changing the code, in order to fix this particular bug, but
> what are the chances of this being the only place where something like that
> happens?
I'm worried about that, too. :/ I was hoping someone who knows the cairo code (Jeff?) might have a guess about (or might be able to quickly audit for) the presence of other instances of this pattern that we'd need to fix at the same time.
We do probably want to report this bug to upstream cairo developers, too -- do we have a contact who works on cairo who we could CC here for thoughts/expertise?

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1292443#c28)• 8 years ago |
|  | |

On the upstream note - this code is still the same in the latest pixman from what I can see. Also, does this <https://gcc.gnu.org/onlinedocs/gcc/Integer-Overflow-Builtins.html> apply here? We're not currently using it, and it could be GCC only.Flags: needinfo?(milan)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a4707491_280903)• 8 years ago |

[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected)
[tracking-firefox52](/buglist.cgi?f1=cf_tracking_firefox52&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox52&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a5141426_1689)• 8 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1292443#c29)• 8 years ago |
|  | |

Milan, what do you think should happen going forward? Looks like there is some ambiguity about how to best approach this. But it is a sec critical issue so we don't want to let it sit too long.Flags: needinfo?(milan)

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1292443#c30)• 8 years ago |
|  | |

Yes, we're not completely sure what to do with this as a general issue, though perhaps could deal with it in this instance. Also, as of 52, we're moving to Skia where the problem goes away. Still, let me see if we can do something.

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1292443#c31)• 8 years ago |
|  | |

Attached patch

[Check for overflow.](attachment.cgi?id=8798497&action=diff) (obsolete)
— [Details](attachment.cgi?id=8798497&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8798497)

Not sure this is worth it (see my previous comment), but should take care of this particular instance of a problem. Don't know what kind of performance impact it may have.Flags: needinfo?(milan)Flags: needinfo?(jmuizelaar)
[Attachment #8798497](/attachment.cgi?id=8798497&action=edit "Check for overflow.") -
Flags: review?(jmuizelaar)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1292443#c32)• 8 years ago |
|  | |

Attached patch

[Cast to unsigned for arithmetic](attachment.cgi?id=8800006&action=diff) (obsolete)
— [Details](attachment.cgi?id=8800006&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8800006)

I'd prefer this as this code is somewhat performance sensitive and this seems like it might be more palatable to upstream.

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1292443#c33)• 8 years ago |
|  | |

(In reply to Jeff Muizelaar [:jrmuizel] from [comment #32](/show_bug.cgi?id=1292443#c32 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"))
> Created [attachment 8800006](/attachment.cgi?id=8800006 "Cast to unsigned for arithmetic") [[details]](/attachment.cgi?id=8800006&action=edit "Cast to unsigned for arithmetic") [[diff]](/attachment.cgi?id=8800006&action=diff "Cast to unsigned for arithmetic") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8800006)
> Cast to unsigned for arithmetic
>
> I'd prefer this as this code is somewhat performance sensitive and this
> seems like it might be more palatable to upstream.
Pretty sure you attached a wrong patch.Flags: needinfo?(jmuizelaar)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1292443#c34)• 8 years ago |
|  | |

Attached patch

[Cast to unsigned for arithmetic](attachment.cgi?id=8800854&action=diff)
— [Details](attachment.cgi?id=8800854&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8800854)

[Attachment #8800006](/attachment.cgi?id=8800006&action=edit "Cast to unsigned for arithmetic") -
Attachment is obsolete: trueFlags: needinfo?(jmuizelaar)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1292443#c35)• 8 years ago |
|  | |

Liz or Ritu, will this be able to make beta if we have a reviewed patch?Flags: needinfo?(rkothari)Flags: needinfo?(lhenry)

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1292443#c36)• 8 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #35](/show_bug.cgi?id=1292443#c35 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"))
> Liz or Ritu, will this be able to make beta if we have a reviewed patch?
Hi Al, given that this is a sec-crit, yes we can take it in Beta. I hope it lands today/tomm am PST so it gets included in 50.0b9 (gtb Thursday noon PST).Flags: needinfo?(rkothari)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1292443#c37)• 8 years ago |
|  | |

Comment on [attachment 8800854](/attachment.cgi?id=8800854 "Cast to unsigned for arithmetic") [[details]](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") [[diff]](/attachment.cgi?id=8800854&action=diff "Cast to unsigned for arithmetic") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8800854)
Cast to unsigned for arithmetic
Review of [attachment 8800854](/attachment.cgi?id=8800854 "Cast to unsigned for arithmetic") [[details]](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") [[diff]](/attachment.cgi?id=8800854&action=diff "Cast to unsigned for arithmetic") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8800854):
-----------------------------------------------------------------
Not sure if you meant to request review on this latest patch, but in the interests of getting this landed, I'll jump in & mark this r=me, assuming:
- you've tested it locally & made sure it does fix the overflow.
- you add a sane commit message that doesn't give away too much.
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: review+

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a6529648_278074)• 8 years ago |

Flags: needinfo?(jmuizelaar)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1292443#c38)• 8 years ago |
|  | |

Comment on [attachment 8798497](/attachment.cgi?id=8798497 "Check for overflow.") [[details]](/attachment.cgi?id=8798497&action=edit "Check for overflow.") [[diff]](/attachment.cgi?id=8798497&action=diff "Check for overflow.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8798497)
Check for overflow.
(I think this earlier patch is obsolete, too --> marking as such.)
[Attachment #8798497](/attachment.cgi?id=8798497&action=edit "Check for overflow.") -
Attachment is obsolete: true
[Attachment #8798497](/attachment.cgi?id=8798497&action=edit "Check for overflow.") -
Flags: review?(jmuizelaar)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1292443#c39)• 8 years ago |
|  | |

Comment on [attachment 8800854](/attachment.cgi?id=8800854 "Cast to unsigned for arithmetic") [[details]](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") [[diff]](/attachment.cgi?id=8800854&action=diff "Cast to unsigned for arithmetic") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8800854)
Cast to unsigned for arithmetic
Looks like Jeff isn't online currently, so I'll jump-start the approvals...
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Not really.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
Nope.
Which older supported branches are affected by this flaw?
All, most likely.
If not all supported branches, which bug introduced the flaw?
N/A
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
This patch should apply to all branches.
How likely is this patch to cause regressions; how much testing does it need?
Very unlikely to cause regressions.
Approval Request Comment
[Feature/regressing bug #]: -
[User impact if declined]: sec-critical
[Describe test coverage new/current, TreeHerder]: I suspect this code is covered by a lot of tests in general (although not with the extreme input values that the testcases on this bug creates). As usual, we'll wait with landing these tests until the bug is public.
[Risks and why]: very low risc
[String/UUID change made/needed]: none
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: sec-approval?
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: approval-mozilla-beta?
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: approval-mozilla-aurora?

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a6541334_538805)• 8 years ago |

[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=%3F)

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1292443#c40)• 8 years ago |
|  | |

I'll wait for a sec-approval+ before taking it in beta50 and aurora51.
If someone can assess whether esr45 is affected or not, that would be great!

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1292443#c41)• 8 years ago |
|  | |

It's a really old issue in pixman, so I'm about 99% sure that esr45 is also affected.
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected)
[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%3F)
[tracking-firefox-esr45](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=%3F)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1292443#c42)• 8 years ago |
|  | |

Yup -- per [comment 11](/show_bug.cgi?id=1292443#c11 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"), we've had this bug (via this chunk of pixman code) since 2010 or earlier, so esr45 is definitely affected.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a6608773_451704)• 8 years ago |

Flags: needinfo?(lhenry)

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1292443#c43)• 8 years ago |
|  | |

Thanks Dan and Ryan. Hello Mats, could you please nominate a patch for uplift to ESR45 as well? Thanks!Flags: needinfo?(mats)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a6609504_278074)• 8 years ago |

[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: approval-mozilla-esr45?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1292443#c44)• 8 years ago |
|  | |

(nominated. I would've done so sooner, in [comment 42](/show_bug.cgi?id=1292443#c42 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"), but I misread the flags that RyanVM had tweaked & thought he'd already nominated it.)Flags: needinfo?(mats)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1292443#c45)• 8 years ago |
|  | |

Comment on [attachment 8800854](/attachment.cgi?id=8800854 "Cast to unsigned for arithmetic") [[details]](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") [[diff]](/attachment.cgi?id=8800854&action=diff "Cast to unsigned for arithmetic") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1292443&attachment=8800854)
Cast to unsigned for arithmetic
sec-approval+
a=dveditz/ritu for aurora, beta, and esr45
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: sec-approval?
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: sec-approval+
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: approval-mozilla-esr45?
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: approval-mozilla-esr45+
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: approval-mozilla-beta?
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: approval-mozilla-beta+
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: approval-mozilla-aurora?
[Attachment #8800854](/attachment.cgi?id=8800854&action=edit "Cast to unsigned for arithmetic") -
Flags: approval-mozilla-aurora+

|  | [Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)](/user_profile?user_id=538805) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a6612121_538805)• 8 years ago |

[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B)

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1292443#c46)• 8 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/6abc8be2325d29eeabdd59de838907cf0c0dbd44>
<https://hg.mozilla.org/releases/mozilla-beta/rev/d4fe6876afeb14bfa005e24b9e47260d9a2b4e1c>
<https://hg.mozilla.org/releases/mozilla-esr45/rev/5e39c1c2fded8a33099b0f0266a258b5673c79e0>
Unclear to me if this needs to still land on trunk with the move to skia.
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1292443#c47)• 8 years ago |
|  | |

I pushed this:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/fbd443ce8fb5b8a1897baac3bfe62f8c5c5b054f>

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a6629341_451704)• 8 years ago |

[tracking-firefox-esr45](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=%3F) → [50+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=50%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1292443#c48)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/fbd443ce8fb5>Assignee: nobody → jmuizelaarStatus: NEW → RESOLVEDClosed: 8 years ago
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed)Flags: needinfo?(jmuizelaar)Resolution: --- → FIXEDTarget Milestone: --- → mozilla52

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a6950736_1689)• 8 years ago |

Group: gfx-core-security → core-security-release

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a7782473_488993)• 8 years ago |

Flags: qe-verify+

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a7905542_452604)• 8 years ago |

Whiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a8191121_280903)• 8 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main50+][adv-esr45.5+]

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1292443#c49)• 8 years ago |
|  | |

I've managed to reproduce this bug with an inbound ASAN build (2016-08-04) and using testcase 3 on Ubuntu 16.04 x64 LTS.
This issue is verified fixed on latest Nightly 52.0a1 (2016-11-07) and latest Aurora 51.a2 (2016-11-07) using the same platform mentioned above. I can no longer reproduce the crash and I don't see any rendering issues.
-- On 45.5.0 esr (20161031153904) I cannot see the testcase 3 (interactive -- hover blue area to test), the page appears blank when I load the testcase. You can see here: <https://goo.gl/zNp9xF>
-- On 50.0-build2 (20161104212021) there are some rendering issues but the tab is not crashing. See here: <https://goo.gl/J6G0YX>
Jeff, Wes what do you think about this results in 45.5.0 esr and 50 RC2?

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1292443#c50)• 8 years ago |
|  | |

 > Jeff, Wes what do you think about this results in 45.5.0 esr and 50 RC2? ([comment 49](/show_bug.cgi?id=1292443#c49 "VERIFIED FIXED - Heap-buffer-overflow WRITE in rasterize_edges_1"))Flags: needinfo?(jmuizelaar)

|  | [Milan Sreckovic [:milan] (needinfo for best results)](/user_profile?user_id=456486) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1292443#c51)• 8 years ago |
|  | |

I'm not worried about 45.5 and 50 results in the context of this bug. Looks like the crash got fixed. If those problems happen in those versions, we should probably open another bug.Flags: needinfo?(jmuizelaar)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a8429886_280903)• 8 years ago |

Alias: CVE-2016-5296

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1292443#c52)• 8 years ago |
|  | |

Thank you, Milan. I will close this issue as verified fixed since I can no longer reproduce the crashes on 45.5.0 esr, 50, 51 beta 2 and 52 latest Aurora.Status: RESOLVED → VERIFIED
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=verified)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified)
[status-firefox52](/buglist.cgi?f1=cf_status_firefox52&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox52&o1=equals&v1=verified)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=verified)Flags: qe-verify+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a16280540_1689)• 8 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1292443#a246710344_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1292443&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Abhishek Arya](/user_profile?user_id=397541)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_845c98ac_20250125_045730.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1246972)
* [XML](/show_bug.cgi?ctype=xml&id=1246972)

Closed
[Bug 1246972](/show_bug.cgi?id=1246972)
(CVE-2016-5294)

Opened 9 years ago
Closed 8 years ago

# Arbitrary target directory for result files of update process

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Arbitrary target directory for result files of update process

## Categories

### (Toolkit :: Application Update, defect)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Application%20Update#Application%20Update)

Application Update
▾

Toolkit :: Application Update
Application update for Firefox and Thunderbird.
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Application%20Update&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Application%20Update&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Application%20Update)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla51

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Install Update Workflow | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox46 | [+](/buglist.cgi?f1=cf_tracking_firefox46&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox46&o1=equals&v1=wontfix) |
| firefox47 | [+](/buglist.cgi?f1=cf_tracking_firefox47&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox47&o1=equals&v1=wontfix) |
| firefox48 | [+](/buglist.cgi?f1=cf_tracking_firefox48&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=wontfix) |
| firefox49 | [+](/buglist.cgi?f1=cf_tracking_firefox49&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix) |
| firefox-esr45 | [50+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=50%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=verified) |
| firefox50 | [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=verified) |
| firefox51 | --- | [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox46 | + | wontfix |
| firefox47 | + | wontfix |
| firefox48 | + | wontfix |
| firefox49 | + | wontfix |
| firefox-esr45 | 50+ | verified |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox50 | + | verified |
| firefox51 |  | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: hofusec, Assigned: molly)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/59fd68692a3013b8c8fa55f0d27bb43c?d=mm&size=40)  [molly](/user_profile?user_id=550257)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/270499a0d11a67b911327984af6ffe90?d=mm&size=40)  [hofusec](/user_profile?user_id=436533)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/50e82ef70720dfcf1385f583e34f9ba9?d=mm&size=40)  [erchen](/user_profile?user_id=753852)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1362267](/show_bug.cgi?id=1362267 "RESOLVED FIXED - Replace requests are failing on Windows and falling back to normal updates")

[1574080](/show_bug.cgi?id=1574080 "RESOLVED FIXED - gDestPath is unused in updater.cpp")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1246972&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1246972)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-priv-escalation, reporter-external, sec-high, Whiteboard: [post-critsmash-triage][adv-main50+][adv-esr45.5+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2016-5294

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main50+][adv-esr45.5+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a18666284_1689 "8 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c95 "8 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 14 obsolete files)

| [invalid.loc.poc.zip](/attachment.cgi?id=8717491)  [9 years ago](#c0)  [Holger Fuhrmannek](/user_profile?user_id=436533)   854 bytes, application/zip |  | [Details](/attachment.cgi?id=8717491&action=edit) |
| --- | --- | --- |
| [Do update install directory registry check earlier and unconditionally](/attachment.cgi?id=8753043)  [9 years ago](#c16)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   3.57 KB, patch | robert.strong.bugs : [review-](#c18 "9 years ago") | [Details](/attachment.cgi?id=8753043&action=edit) | [Diff](/attachment.cgi?id=8753043&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8753043) |
| [Do update install directory registry check earlier and unconditionally](/attachment.cgi?id=8753902)  [9 years ago](#c19)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   3.63 KB, patch |  | [Details](/attachment.cgi?id=8753902&action=edit) | [Diff](/attachment.cgi?id=8753902&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8753902) |
| [Patch - Always require the update working directory to be within the installation path](/attachment.cgi?id=8756101)  [9 years ago](#c24)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   6.97 KB, patch |  | [Details](/attachment.cgi?id=8756101&action=edit) | [Diff](/attachment.cgi?id=8756101&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8756101) |
| [Always require the update working directory to be within the installation path](/attachment.cgi?id=8756466)  [9 years ago](#c26)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   7.05 KB, patch |  | [Details](/attachment.cgi?id=8756466&action=edit) | [Diff](/attachment.cgi?id=8756466&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8756466) |
| [Patch - Always require the update working directory to be within the installation path on Windows](/attachment.cgi?id=8756599)  [9 years ago](#c28)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   7.92 KB, patch |  | [Details](/attachment.cgi?id=8756599&action=edit) | [Diff](/attachment.cgi?id=8756599&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8756599) |
| [Patch - Always require the update working directory to be within the installation path on Windows](/attachment.cgi?id=8757479)  [9 years ago](#c34)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   7.94 KB, patch | robert.strong.bugs : [review-](#c39 "9 years ago") | [Details](/attachment.cgi?id=8757479&action=edit) | [Diff](/attachment.cgi?id=8757479&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8757479) |
| [Patch](/attachment.cgi?id=8761845)  [9 years ago](#c40)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   10.92 KB, patch |  | [Details](/attachment.cgi?id=8761845&action=edit) | [Diff](/attachment.cgi?id=8761845&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8761845) |
| [Patch](/attachment.cgi?id=8763991)  [9 years ago](#c42)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   8.10 KB, patch | robert.strong.bugs : [review-](#c44 "9 years ago") | [Details](/attachment.cgi?id=8763991&action=edit) | [Diff](/attachment.cgi?id=8763991&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8763991) |
| [Patch](/attachment.cgi?id=8772624)  [9 years ago](#c45)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   40.49 KB, patch |  | [Details](/attachment.cgi?id=8772624&action=edit) | [Diff](/attachment.cgi?id=8772624&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8772624) |
| [Patch](/attachment.cgi?id=8773858)  [9 years ago](#c48)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   45.77 KB, patch | robert.strong.bugs : [review-](#c54 "9 years ago") | [Details](/attachment.cgi?id=8773858&action=edit) | [Diff](/attachment.cgi?id=8773858&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8773858) |
| [Patch](/attachment.cgi?id=8777584)  [8 years ago](#c57)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   45.88 KB, patch | robert.strong.bugs : [review-](#c64 "8 years ago") | [Details](/attachment.cgi?id=8777584&action=edit) | [Diff](/attachment.cgi?id=8777584&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8777584) |
| [Patch](/attachment.cgi?id=8778458)  [8 years ago](#c67)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   52.67 KB, patch | robert.strong.bugs : [review+](#c68 "8 years ago") | [Details](/attachment.cgi?id=8778458&action=edit) | [Diff](/attachment.cgi?id=8778458&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8778458) |
| [Patch](/attachment.cgi?id=8784879)  [8 years ago](#c73)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   53.27 KB, patch | molly : [review+](#c73 "8 years ago")  abillings : [approval-mozilla-aurora+](#a17127976_280903 "8 years ago")  abillings : [sec-approval+](#c75 "8 years ago") | [Details](/attachment.cgi?id=8784879&action=edit) | [Diff](/attachment.cgi?id=8784879&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8784879) |
| [Fixed Patch](/attachment.cgi?id=8785392)  [8 years ago](#c83)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   55.01 KB, patch | molly : [review+](#c83 "8 years ago")  abillings : [approval-mozilla-aurora+](#c92 "8 years ago")  abillings : [sec-approval+](#a17216207_280903 "8 years ago") | [Details](/attachment.cgi?id=8785392&action=edit) | [Diff](/attachment.cgi?id=8785392&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8785392) |
| [ESR45 Patch](/attachment.cgi?id=8790451)  [8 years ago](#c94)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   52.45 KB, patch | Sylvestre : [approval-mozilla-esr45-](#a21748237_495955 "8 years ago") | [Details](/attachment.cgi?id=8790451&action=edit) | [Diff](/attachment.cgi?id=8790451&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8790451) |
| [ESR45 Patch Rebased](/attachment.cgi?id=8801906)  [8 years ago](#c97)  [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)   54.82 KB, patch | Sylvestre : [approval-mozilla-esr45+](#a21748231_495955 "8 years ago") | [Details](/attachment.cgi?id=8801906&action=edit) | [Diff](/attachment.cgi?id=8801906&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8801906) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Holger Fuhrmannek](/user_profile?user_id=436533)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1246972#c0)• 9 years ago |
|  | |

Attached file
[invalid.loc.poc.zip](attachment.cgi?id=8717491)
— [Details](attachment.cgi?id=8717491&action=edit)

It's possible to choose an arbitrary target directory for result files of an update process. As in [Bug 1177861](/show_bug.cgi?id=1177861 "VERIFIED FIXED - Arbitrary file manipulation through updater.exe (Privilege Escalation)") this leads to the possibility to change arbitrary files because for example extracted \*.patch files from the .mar file are also placed in this directory.
I have tested the poc with win7 and ff 47 nightly installed to C:\Program Files (x86)\Nightly\:
To reproduce
- download poc and extract the files
- download <http://releases.mozilla.org/pub/firefox/nightly/latest-mozilla-central/firefox-47.0a1.en-US.win32.complete.mar> and place the file to <pocdir>/updatework/update.mar
- execute poc.rb
- a firefox directory will appear next to the poc.rb
As seen in [Bug 1177861](/show_bug.cgi?id=1177861 "VERIFIED FIXED - Arbitrary file manipulation through updater.exe (Privilege Escalation)") a more advance poc can change arbitrary files through manipulating \*.patch files and the use of junctions.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1246972#c1)• 9 years ago |
|  | |

Rob, can you take a look at this and maybe suggest a security rating?Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1246972#c2)• 9 years ago |
|  | |

This is similar to [bug 1171518](/show_bug.cgi?id=1171518 "RESOLVED FIXED - [Win] Privileged update processes writing to user writable locations can overwrite non-user writable locations using hard links") and should receive the same rating.Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a268694_141755)• 9 years ago |

Assignee: nobody → robert.strong.bugsStatus: UNCONFIRMED → ASSIGNEDEver confirmed: true

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a287082_280903)• 9 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1246972#c3)• 9 years ago |
|  | |

Tracking for 46+ since this is sec-high and seems to affect all branches.
[status-firefox46](/buglist.cgi?f1=cf_status_firefox46&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox46&o1=equals&v1=affected)
[status-firefox47](/buglist.cgi?f1=cf_status_firefox47&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox47&o1=equals&v1=affected)
[status-firefox48](/buglist.cgi?f1=cf_status_firefox48&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=affected)
[tracking-firefox46](/buglist.cgi?f1=cf_tracking_firefox46&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox46&o1=equals&v1=%2B)
[tracking-firefox47](/buglist.cgi?f1=cf_tracking_firefox47&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox47&o1=equals&v1=%2B)
[tracking-firefox48](/buglist.cgi?f1=cf_tracking_firefox48&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox48&o1=equals&v1=%2B)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1246972#c4)• 9 years ago |
|  | |

We are heading into beta 10 on Monday, we could potentially still take a patch for 46 beta. We might want to coordinate extra testing with QE for when we do land a fix.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1246972#c5)• 9 years ago |
|  | |

The fix for this is likely going to be too complex to try to push for 46

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1246972#c6)• 9 years ago |
|  | |

OK, thanks Robert.
[status-firefox46](/buglist.cgi?f1=cf_status_firefox46&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox46&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox46&o1=equals&v1=wontfix)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1246972#c7)• 9 years ago |
|  | |

Any progress? Wontfix this for beta 47 at this point.
[status-firefox47](/buglist.cgi?f1=cf_status_firefox47&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox47&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox47&o1=equals&v1=wontfix)
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=affected)
[tracking-firefox49](/buglist.cgi?f1=cf_tracking_firefox49&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox49&o1=equals&v1=%2B)Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1246972#c8)• 9 years ago |
|  | |

No progress at this time.
Matt, could you take a look at this?Assignee: robert.strong.bugs → nobodyStatus: ASSIGNED → NEWFlags: needinfo?(robert.strong.bugs) → needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1246972#c9)• 9 years ago |
|  | |

The only way I can see of fixing this bug directly seems risky, so I'll offer that and another solution. rstrong, I'd like to get your feedback on these:
1) Fix the bug directly by only allowing updates to be applied to known application installation paths. To avoid spoofing, the list of known paths would have to be stored in a high-privilege location, such as in the registry at machine-level or a file in the maintenance service installation directory. Each new installation of an application would have to update this list, or it could not be updated using the service.
This seems high-risk to me, but it's the most direct fix to this bug.
2) Prevent this bug from being exploited with very much control by preventing editing of the update manifest, either by locking the file or by extracting it to RAM instead of a file. This way an attacker cannot control the specific operations the updater executes, but can still cause normal update actions to be taken in arbitrary locations, which could still be dangerous in theory.Flags: needinfo?(mhowell) → needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1246972#c10)• 9 years ago |
|  | |

For 1 are you referring to just maintenance service updates? If so, we already have this information in the registry under HKLM. Why do you think it is high risk?Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a8092471_141755)• 9 years ago |

Flags: needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1246972#c11)• 9 years ago |
|  | |

(In reply to Robert Strong [:rstrong] (use needinfo to contact me) from [comment #10](/show_bug.cgi?id=1246972#c10 "VERIFIED FIXED - Arbitrary target directory for result files of update process"))
> For 1 are you referring to just maintenance service updates? If so, we
> already have this information in the registry under HKLM. Why do you think
> it is high risk?
No, sorry, I meant application updates running via the service.Flags: needinfo?(mhowell) → needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1246972#c12)• 9 years ago |
|  | |

Sorry, I meant application updates via the service as well.
We already have this info under HKLM in Software\Mozilla\MaintenanceService in the form of a hash of the path to the install directory. So, when updating using the service would getting the hash for the install directory and verifying that it exists in this location be sufficient for this bug?Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a8134937_141755)• 9 years ago |

Flags: needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1246972#c13)• 9 years ago |
|  | |

(In reply to Robert Strong [:rstrong] (use needinfo to contact me) from [comment #12](/show_bug.cgi?id=1246972#c12 "VERIFIED FIXED - Arbitrary target directory for result files of update process"))
> We already have this info under HKLM in Software\Mozilla\MaintenanceService
> in the form of a hash of the path to the install directory.
... I forgot all about those. That is exactly what we need.
> So, when updating using the service would getting the hash for the install
> directory and verifying that it exists in this location be sufficient for this bug?
Yep, I'll do that.Assignee: nobody → mhowellFlags: needinfo?(mhowell)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1246972#c14)• 9 years ago |
|  | |

FYI: I \*think\* we already do check but it might fallback to allowing cases where it doesn't exist or it might not happen early enough.

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1246972#c15)• 9 years ago |
|  | |

(In reply to Robert Strong [:rstrong] (use needinfo to contact me) from [comment #14](/show_bug.cgi?id=1246972#c14 "VERIFIED FIXED - Arbitrary target directory for result files of update process"))
> FYI: I \*think\* we already do check but it might fallback to allowing cases
> where it doesn't exist or it might not happen early enough.
You're right, but it works out that the existing check is skipped if we can successfully write a lock file into the install dir, so any exploit satisfying that condition can get past the check. I'm going to try moving it to a much earlier spot and making it unconditional.

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1246972#c16)• 9 years ago |
|  | |

Attached patch

[Do update install directory registry check earlier and unconditionally](attachment.cgi?id=8753043&action=diff) (obsolete)
— [Details](attachment.cgi?id=8753043&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8753043)

MozReview-Commit-ID: FR44f4b5KbI

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a8395990_550257)• 9 years ago |

[Attachment #8753043](/attachment.cgi?id=8753043&action=edit "Do update install directory registry check earlier and unconditionally") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1246972#c17)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=18dd63221a07>

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1246972#c18)• 9 years ago |
|  | |

Comment on [attachment 8753043](/attachment.cgi?id=8753043 "Do update install directory registry check earlier and unconditionally") [[details]](/attachment.cgi?id=8753043&action=edit "Do update install directory registry check earlier and unconditionally") [[diff]](/attachment.cgi?id=8753043&action=diff "Do update install directory registry check earlier and unconditionally") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8753043)
Do update install directory registry check earlier and unconditionally
I thought this was only going to be for the case where the service is used per [comment #11](/show_bug.cgi?id=1246972#c11 "VERIFIED FIXED - Arbitrary target directory for result files of update process").
We support updating without the service as well as well as installing without admin prvis and the removal of the useService will break updating for both of those cases.
[Attachment #8753043](/attachment.cgi?id=8753043&action=edit "Do update install directory registry check earlier and unconditionally") -
Flags: review?(robert.strong.bugs) → review-

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1246972#c19)• 9 years ago |
|  | |

Attached patch

[Do update install directory registry check earlier and unconditionally](attachment.cgi?id=8753902&action=diff) (obsolete)
— [Details](attachment.cgi?id=8753902&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8753902)

MozReview-Commit-ID: FR44f4b5KbI

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a8550785_550257)• 9 years ago |

[Attachment #8753043](/attachment.cgi?id=8753043&action=edit "Do update install directory registry check earlier and unconditionally") -
Attachment is obsolete: true

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a8550934_550257)• 9 years ago |

[Attachment #8753902](/attachment.cgi?id=8753902&action=edit "Do update install directory registry check earlier and unconditionally") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1246972#c20)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=ed5cdf7a1f6d>

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1246972#c21)• 9 years ago |
|  | |

Comment on [attachment 8753902](/attachment.cgi?id=8753902 "Do update install directory registry check earlier and unconditionally") [[details]](/attachment.cgi?id=8753902&action=edit "Do update install directory registry check earlier and unconditionally") [[diff]](/attachment.cgi?id=8753902&action=diff "Do update install directory registry check earlier and unconditionally") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8753902)
Do update install directory registry check earlier and unconditionally
When the key for the directory doesn't exist it should fallback to the non service update path by setting useService to false and sets the error in update.status. With this patch the status isn't updated and it doesn't fallback to the non service update. Does this bug also affect non service updates? Could you provide me with more detail?
Please fix the typo on the last line of this patch
s/comamnd/command/
[Attachment #8753902](/attachment.cgi?id=8753902&action=edit "Do update install directory registry check earlier and unconditionally") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1246972#c22)• 9 years ago |
|  | |

Comment on [attachment 8753902](/attachment.cgi?id=8753902 "Do update install directory registry check earlier and unconditionally") [[details]](/attachment.cgi?id=8753902&action=edit "Do update install directory registry check earlier and unconditionally") [[diff]](/attachment.cgi?id=8753902&action=diff "Do update install directory registry check earlier and unconditionally") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8753902)
Do update install directory registry check earlier and unconditionally
Obsoleting this patch because I completely misinterpreted the bug.
The problem isn't the install directory, the service already has protections for that. The problem is the working directory. For staged updates, we require that it's a child of the install directory, but otherwise there are no restrictions on it at all. That's how the updater can be made to perform file operations in arbitrary locations.
rstrong, what would you think about extending the requirement for the working directory to be a child of the install directory from just staged updates to all updates? I tried it and it made some of the tests quite angry with me, but I feel like that's just because they don't know to expect it.
[Attachment #8753902](/attachment.cgi?id=8753902&action=edit "Do update install directory registry check earlier and unconditionally") -
Attachment is obsolete: trueFlags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1246972#c23)• 9 years ago |
|  | |

I think that should work. If you have a patch in progress that you can attach I can run the tests locally to get a better idea and to see what is going on with the tests.Flags: needinfo?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1246972#c24)• 9 years ago |
|  | |

Attached patch

[Patch - Always require the update working directory to be within the installation path](attachment.cgi?id=8756101&action=diff) (obsolete)
— [Details](attachment.cgi?id=8756101&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8756101)

This patch could probably use some polish, but it's ready to throw at try.

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1246972#c25)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=acca8834c9cc>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1246972#c26)• 9 years ago |
|  | |

Attached patch

[Always require the update working directory to be within the installation path](attachment.cgi?id=8756466&action=diff) (obsolete)
— [Details](attachment.cgi?id=8756466&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8756466)

MozReview-Commit-ID: ASxfV4uVpmD

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a9164115_550257)• 9 years ago |

[Attachment #8756101](/attachment.cgi?id=8756101&action=edit "Patch - Always require the update working directory to be within the installation path") -
Attachment is obsolete: true

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1246972#c27)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=40a236d9190c>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1246972#c28)• 9 years ago |
|  | |

Attached patch

[Patch - Always require the update working directory to be within the installation path on Windows](attachment.cgi?id=8756599&action=diff) (obsolete)
— [Details](attachment.cgi?id=8756599&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8756599)

Hopefully this resolves the remaining try failures, and doesn't create more. It's difficult for me to test the MOZ\_VERIFY\_MAR\_SIGNATURE paths locally.
[Attachment #8756466](/attachment.cgi?id=8756466&action=edit "Always require the update working directory to be within the installation path") -
Attachment is obsolete: true

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1246972#c29)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=8e94bcd63849>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1246972#c30)• 9 years ago |
|  | |

Comment on [attachment 8756599](/attachment.cgi?id=8756599 "Patch - Always require the update working directory to be within the installation path on Windows") [[details]](/attachment.cgi?id=8756599&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") [[diff]](/attachment.cgi?id=8756599&action=diff "Patch - Always require the update working directory to be within the installation path on Windows") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8756599)
Patch - Always require the update working directory to be within the installation path on Windows
The Mac Mochitest failures in that try run appear locally with or without this patch, so I'm calling it clean and requesting review.
[Attachment #8756599](/attachment.cgi?id=8756599&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") -
Flags: review?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1246972#c31)• 9 years ago |
|  | |

The Mac mochitest failures are succeeding on the build system without your patch... right?Flags: needinfo?(mhowell)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1246972#c32)• 9 years ago |
|  | |

Comment on [attachment 8756599](/attachment.cgi?id=8756599 "Patch - Always require the update working directory to be within the installation path on Windows") [[details]](/attachment.cgi?id=8756599&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") [[diff]](/attachment.cgi?id=8756599&action=diff "Patch - Always require the update working directory to be within the installation path on Windows") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8756599)
Patch - Always require the update working directory to be within the installation path on Windows
Cancelling review until the Mac mochitest failures are understood.
[Attachment #8756599](/attachment.cgi?id=8756599&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") -
Flags: review?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1246972#c33)• 9 years ago |
|  | |

Talked with Mat over irc regarding the failures he is seeing locally.Flags: needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a9253957_550257)• 9 years ago |

[Attachment #8756599](/attachment.cgi?id=8756599&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") -
Attachment description: Patch - Always require the update working directory to be within the installation path on Windowsbug1246972.diff → Patch - Always require the update working directory to be within the installation path on Windows

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1246972#c34)• 9 years ago |
|  | |

Attached patch

[Patch - Always require the update working directory to be within the installation path on Windows](attachment.cgi?id=8757479&action=diff) (obsolete)
— [Details](attachment.cgi?id=8757479&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8757479)

Wasn't able to really track down those Mac failures, so this is kind of a stab in the dark. New try push incoming.
[Attachment #8756599](/attachment.cgi?id=8756599&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") -
Attachment is obsolete: true

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1246972#c35)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=f037546a798b>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1246972#c36)• 9 years ago |
|  | |

Comment on [attachment 8757479](/attachment.cgi?id=8757479 "Patch - Always require the update working directory to be within the installation path on Windows") [[details]](/attachment.cgi?id=8757479&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") [[diff]](/attachment.cgi?id=8757479&action=diff "Patch - Always require the update working directory to be within the installation path on Windows") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8757479)
Patch - Always require the update working directory to be within the installation path on Windows
Whoa it's finally green.
[Attachment #8757479](/attachment.cgi?id=8757479&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1246972#c37)• 9 years ago |
|  | |

<https://hg.mozilla.org/projects/oak/rev/f38999684d8c02dba1befd26a8d9f0d6056ef928>
[Bug 1246972](/show_bug.cgi?id=1246972 "VERIFIED FIXED - Arbitrary target directory for result files of update process") - Always require the update working directory to be within the installation path; r?rstrong

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1246972#c38)• 9 years ago |
|  | |

Using the builds from oak, I've manually tested updating from a build with this patch using all combinations of the following states: maintenance service enabled or disabled, staged updates enabled or disabled, and install location in Program Files or inside the user profile. That makes for 8 test cases, and all of them successfully updated using the expected flow.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a10371642_451704)• 9 years ago |

[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected)
[tracking-firefox50](/buglist.cgi?f1=cf_tracking_firefox50&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox50&o1=equals&v1=%2B)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1246972#c39)• 9 years ago |
|  | |

Comment on [attachment 8757479](/attachment.cgi?id=8757479 "Patch - Always require the update working directory to be within the installation path on Windows") [[details]](/attachment.cgi?id=8757479&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") [[diff]](/attachment.cgi?id=8757479&action=diff "Patch - Always require the update working directory to be within the installation path on Windows") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8757479)
Patch - Always require the update working directory to be within the installation path on Windows
>diff --git a/toolkit/mozapps/update/updater/updater.cpp b/toolkit/mozapps/update/updater/updater.cpp
>--- a/toolkit/mozapps/update/updater/updater.cpp
>+++ b/toolkit/mozapps/update/updater/updater.cpp
>@@ -386,31 +386,19 @@ EnvHasValue(const char \*name)
> \*
> \* @param relpath
> \* The relative path to convert to a full path.
> \* @return valid filesystem full path or nullptr if memory allocation fails.
> \*/
> static NS\_tchar\*
> get\_full\_path(const NS\_tchar \*relpath)
> {
>- size\_t lendestpath = NS\_tstrlen(gDestPath);
>- size\_t lenrelpath = NS\_tstrlen(relpath);
>- NS\_tchar \*s = (NS\_tchar \*) malloc((lendestpath + lenrelpath + 1) \* sizeof(NS\_tchar));
>- if (!s)
>- return nullptr;
>-
>- NS\_tchar \*c = s;
>-
>- NS\_tstrcpy(c, gDestPath);
>- c += lendestpath;
>- NS\_tstrcat(c, relpath);
>- c += lenrelpath;
>- \*c = NS\_T('\0');
>- c++;
>- return s;
>+ NS\_tchar \*fullPath = (NS\_tchar \*)malloc((MAX\_PATH + 1) \* sizeof(NS\_tchar));
>+ GetFullPathName(relpath, MAX\_PATH, fullPath, nullptr);
>+ return fullPath;
Per our previous conversation I'd prefer not using GetFullPathName.
>@@ -2452,17 +2440,21 @@ UpdateThreadFunc(void \*param)
> NS\_tchar updateSettingsPath[MAX\_TEXT\_LEN];
> NS\_tsnprintf(updateSettingsPath,
> sizeof(updateSettingsPath) / sizeof(updateSettingsPath[0]),
> #ifdef XP\_MACOSX
> NS\_T("%s/Contents/Resources/update-settings.ini"),
> #else
> NS\_T("%s/update-settings.ini"),
> #endif
>+#ifdef XP\_WIN
>+ gInstallDirPath);
Does this really have to be Windows only? If not, I'd prefer it to be consistent across platforms.
>+#else
> gWorkingDirPath);
>+#endif
> MARChannelStringTable MARStrings;
> if (ReadMARChannelIDs(updateSettingsPath, &MARStrings) != OK) {
> // If we can't read from update-settings.ini then we shouldn't impose
> // a MAR restriction. Some installations won't even include this file.
> MARStrings.MARChannelID[0] = '\0';
> }
>
> rv = gArchiveReader.VerifyProductInformation(MARStrings.MARChannelID,
>@@ -2831,34 +2823,32 @@ int NS\_main(int argc, NS\_tchar \*\*argv)
> LOG(("Performing a replace request"));
> }
>
> LOG(("PATCH DIRECTORY " LOG\_S, gPatchDirPath));
> LOG(("INSTALLATION DIRECTORY " LOG\_S, gInstallDirPath));
> LOG(("WORKING DIRECTORY " LOG\_S, gWorkingDirPath));
>
> #if defined(XP\_WIN)
>- if (sReplaceRequest || sStagedUpdate) {
>- NS\_tchar stagedParent[MAX\_PATH];
>- NS\_tsnprintf(stagedParent, sizeof(stagedParent)/sizeof(stagedParent[0]),
>- NS\_T("%s"), gWorkingDirPath);
>- if (!PathRemoveFileSpecW(stagedParent)) {
>- WriteStatusFile(REMOVE\_FILE\_SPEC\_ERROR);
>- LOG(("Error calling PathRemoveFileSpecW: %d", GetLastError()));
>- LogFinish();
>- return 1;
>- }
>-
>- if (\_wcsnicmp(stagedParent, gInstallDirPath, MAX\_PATH) != 0) {
>- WriteStatusFile(INVALID\_STAGED\_PARENT\_ERROR);
>- LOG(("Stage and Replace requests require that the working directory " \
>- "is a sub-directory of the installation directory! Exiting"));
>- LogFinish();
>- return 1;
>- }
>+ NS\_tchar workingDirParent[MAX\_PATH];
>+ NS\_tsnprintf(workingDirParent, sizeof(workingDirParent) / sizeof(workingDirParent[0]),
>+ NS\_T("%s"), gWorkingDirPath);
>+ if (!PathRemoveFileSpecW(workingDirParent)) {
>+ WriteStatusFile(REMOVE\_FILE\_SPEC\_ERROR);
>+ LOG(("Error calling PathRemoveFileSpecW: %d", GetLastError()));
>+ LogFinish();
>+ return 1;
>+ }
>+
>+ if (\_wcsnicmp(workingDirParent, gInstallDirPath, MAX\_PATH) != 0) {
>+ WriteStatusFile(INVALID\_STAGED\_PARENT\_ERROR);
Since this applies to all updates please change the name to reflect that.
>+ LOG(("The working directory must be a sub-directory "
>+ "of the installation directory! Exiting"));
>+ LogFinish();
>+ return 1;
> }
> #endif
>
> #ifdef MOZ\_WIDGET\_GONK
> const char \*prioEnv = getenv("MOZ\_UPDATER\_PRIO");
> if (prioEnv) {
> int32\_t prioVal;
> int32\_t oomScoreAdj;
[Attachment #8757479](/attachment.cgi?id=8757479&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") -
Flags: review?(robert.strong.bugs) → review-

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1246972#c40)• 9 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=8761845&action=diff) (obsolete)
— [Details](attachment.cgi?id=8761845&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8761845)

(In reply to Robert Strong [:rstrong] (use needinfo to contact me) from [comment #39](/show_bug.cgi?id=1246972#c39 "VERIFIED FIXED - Arbitrary target directory for result files of update process"))
> >+ NS\_tchar \*fullPath = (NS\_tchar \*)malloc((MAX\_PATH + 1) \* sizeof(NS\_tchar));
> >+ GetFullPathName(relpath, MAX\_PATH, fullPath, nullptr);
> >+ return fullPath;
> Per our previous conversation I'd prefer not using GetFullPathName.
Restored the previous implementation, with only the necessary changes.
> >+#ifdef XP\_WIN
> >+ gInstallDirPath);
> Does this really have to be Windows only? If not, I'd prefer it to be
> consistent across platforms.
This was my fix for the Mac chrome test failures. On (much) further investigation, those turn out to actually have been caused by an implicit assumption in a bit of the test code that the application binaries and the resource files (specifically update-settings.ini) live at the same path, which is not true on Mac OS. This version of the patch removes that assumption, which allowed this Windows check to go as well.
> >+ WriteStatusFile(INVALID\_STAGED\_PARENT\_ERROR);
> Since this applies to all updates please change the name to reflect that.
Done.
[Attachment #8757479](/attachment.cgi?id=8757479&action=edit "Patch - Always require the update working directory to be within the installation path on Windows") -
Attachment is obsolete: true
[Attachment #8761845](/attachment.cgi?id=8761845&action=edit "Patch") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1246972#c41)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=e3109cb148dc>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1246972#c42)• 9 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=8763991&action=diff) (obsolete)
— [Details](attachment.cgi?id=8763991&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8763991)

Updated patch; removed creation of extra working directory within the apply-to path.
[Attachment #8761845](/attachment.cgi?id=8761845&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #8761845](/attachment.cgi?id=8761845&action=edit "Patch") -
Flags: review?(robert.strong.bugs)
[Attachment #8763991](/attachment.cgi?id=8763991&action=edit "Patch") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1246972#c43)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=910a54b4b9b9>

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1246972#c44)• 9 years ago |
|  | |

Comment on [attachment 8763991](/attachment.cgi?id=8763991 "Patch") [[details]](/attachment.cgi?id=8763991&action=edit "Patch") [[diff]](/attachment.cgi?id=8763991&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8763991)
Patch
Per our discussion during MozLondon, please consolidate all of the NS\_tchdir... I don't think we need so many of them.
[Attachment #8763991](/attachment.cgi?id=8763991&action=edit "Patch") -
Flags: review?(robert.strong.bugs) → review-

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1246972#c45)• 9 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=8772624&action=diff) (obsolete)
— [Details](attachment.cgi?id=8772624&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8772624)

I was able to remove the chdir calls that I added, as well as all but two of the existing calls; one is needed to set the working directory for the callback app, and the other is the one that switches to the system directory to avoid holding a lock on anything we might need to delete.
Making all of that work out was a little more involved than I think either of us expected. Most of the changes come from needing the Action objects to hold their own copies of the paths they act on, so that they can call get\_full\_path() and properly dispose of the result, while also keeping the relative paths around so that they can be used in the log; it was easier than making the tests cope with paths in the log that include the test name. The tobedeleted directory needed a similar change as well.
[Attachment #8763991](/attachment.cgi?id=8763991&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #8772624](/attachment.cgi?id=8772624&action=edit "Patch") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1246972#c46)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=e490ed001eaf>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1246972#c47)• 9 years ago |
|  | |

Comment on [attachment 8772624](/attachment.cgi?id=8772624 "Patch") [[details]](/attachment.cgi?id=8772624&action=edit "Patch") [[diff]](/attachment.cgi?id=8772624&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8772624)
Patch
This patch is in pretty bad shape on Mac and Linux; working on a fixed version now.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a14004061_141755)• 9 years ago |

[Attachment #8772624](/attachment.cgi?id=8772624&action=edit "Patch") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1246972#c48)• 9 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=8773858&action=diff) (obsolete)
— [Details](attachment.cgi?id=8773858&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8773858)

Okay, let's try this one.
[Attachment #8772624](/attachment.cgi?id=8772624&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #8773858](/attachment.cgi?id=8773858&action=edit "Patch") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1246972#c49)• 9 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=5db59389e6ae>

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a15025271_495955)• 8 years ago |

[status-firefox48](/buglist.cgi?f1=cf_status_firefox48&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox48&o1=equals&v1=wontfix)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1246972#c50)• 8 years ago |
|  | |

Matt, just in case please run try for asan, static analysis, etc. just in case they catch something.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a15051135_141755)• 8 years ago |

Flags: needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1246972#c51)• 8 years ago |
|  | |

Okay; I can't seem to add any jobs to the previous try push, I guess it's too old, so I'll make a new one.Flags: needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1246972#c52)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=7fcd0396b17b>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1246972#c53)• 8 years ago |
|  | |

Looks like that run didn't turn up any issues.Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1246972#c54)• 8 years ago |
|  | |

Comment on [attachment 8773858](/attachment.cgi?id=8773858 "Patch") [[details]](/attachment.cgi?id=8773858&action=edit "Patch") [[diff]](/attachment.cgi?id=8773858&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8773858)
Patch
>diff --git a/toolkit/mozapps/update/updater/updater.cpp b/toolkit/mozapps/update/updater/updater.cpp
>--- a/toolkit/mozapps/update/updater/updater.cpp
>+++ b/toolkit/mozapps/update/updater/updater.cpp
>@@ -375,44 +377,85 @@ mstrtok(const NS\_tchar \*delims, NS\_tchar
>
> static bool
> EnvHasValue(const char \*name)
> {
> const char \*val = getenv(name);
> return (val && \*val);
> }
>
>-#ifdef XP\_WIN
> /\*\*
>- \* Coverts a relative update path to a full path for Windows.
>+ \* Coverts a relative update path to a full path.
> \*
> \* @param relpath
> \* The relative path to convert to a full path.
> \* @return valid filesystem full path or nullptr if memory allocation fails.
> \*/
> static NS\_tchar\*
> get\_full\_path(const NS\_tchar \*relpath)
> {
>- size\_t lendestpath = NS\_tstrlen(gDestPath);
>+ NS\_tchar \*destpath = sStagedUpdate ? gWorkingDirPath : gInstallDirPath;
>+ size\_t lendestpath = NS\_tstrlen(destpath);
> size\_t lenrelpath = NS\_tstrlen(relpath);
>- NS\_tchar \*s = (NS\_tchar \*) malloc((lendestpath + lenrelpath + 1) \* sizeof(NS\_tchar));
>- if (!s)
>+ NS\_tchar \*s = new NS\_tchar[lendestpath + lenrelpath + 2];
>+ if (!s) {
> return nullptr;
>+ }
>
> NS\_tchar \*c = s;
>
>- NS\_tstrcpy(c, gDestPath);
>+ NS\_tstrcpy(c, destpath);
> c += lendestpath;
>+#ifdef XP\_WIN
>+ if (\*c != '\\') {
>+ NS\_tstrcat(c, NS\_T("\\"));
>+ c++;
>+ }
>+#else
>+ if (\*c != '/') {
>+ NS\_tstrcat(c, NS\_T("/"));
>+ c++;
>+ }
>+#endif
Both gWorkingDirPath and gInstallDirPath have the trailing slash removed so no need to check if there is one.
<https://dxr.mozilla.org/mozilla-central/source/toolkit/mozapps/update/updater/updater.cpp#2795>
<https://dxr.mozilla.org/mozilla-central/source/toolkit/mozapps/update/updater/updater.cpp#2723>
I think this should just concatenate NS\_T("/") for all platforms as we do in almost all other cases when working with paths. For example, all paths in the manifest use / so it should be safe to go this route. If it is actually needed please use NS\_SLASH which is defined in updatedefines.h. In either case, there is no need for the ifdef or the check for a slash.
>+
> NS\_tstrcat(c, relpath);
> c += lenrelpath;
> \*c = NS\_T('\0');
>- c++;
> return s;
> }
>@@ -2468,17 +2558,18 @@ UpdateThreadFunc(void \*param)
> NS\_tchar updateSettingsPath[MAX\_TEXT\_LEN];
> NS\_tsnprintf(updateSettingsPath,
> sizeof(updateSettingsPath) / sizeof(updateSettingsPath[0]),
> #ifdef XP\_MACOSX
> NS\_T("%s/Contents/Resources/update-settings.ini"),
> #else
> NS\_T("%s/update-settings.ini"),
> #endif
>- gWorkingDirPath);
>+ gInstallDirPath);
Pretty sure this shouldn't be changed.
Pushed this changed back to try to verify
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=2d7358e3b2bd>
>+
> MARChannelStringTable MARStrings;
> if (ReadMARChannelIDs(updateSettingsPath, &MARStrings) != OK) {
> // If we can't read from update-settings.ini then we shouldn't impose
> // a MAR restriction. Some installations won't even include this file.
> MARStrings.MARChannelID[0] = '\0';
> }
>
> rv = gArchiveReader.VerifyProductInformation(MARStrings.MARChannelID,
>@@ -2844,31 +2934,32 @@ int NS\_main(int argc, NS\_tchar \*\*argv)
> LOG(("Performing a replace request"));
> }
>
> LOG(("PATCH DIRECTORY " LOG\_S, gPatchDirPath));
> LOG(("INSTALLATION DIRECTORY " LOG\_S, gInstallDirPath));
> LOG(("WORKING DIRECTORY " LOG\_S, gWorkingDirPath));
>
> #if defined(XP\_WIN)
>- if (sReplaceRequest || sStagedUpdate) {
>- NS\_tchar stagedParent[MAX\_PATH];
>- NS\_tsnprintf(stagedParent, sizeof(stagedParent)/sizeof(stagedParent[0]),
>+ if (\_wcsnicmp(gWorkingDirPath, gInstallDirPath, MAX\_PATH) != 0) {
These should always be the same on Windows when performing a normal update (e.g. not a staged update or a replace request). I think what we want here is to bail with an error code when these aren't the same during a normal update.
>+ NS\_tchar workingDirParent[MAX\_PATH];
>+ NS\_tsnprintf(workingDirParent,
>+ sizeof(workingDirParent) / sizeof(workingDirParent[0]),
> NS\_T("%s"), gWorkingDirPath);
>- if (!PathRemoveFileSpecW(stagedParent)) {
>+ if (!PathRemoveFileSpecW(workingDirParent)) {
> WriteStatusFile(REMOVE\_FILE\_SPEC\_ERROR);
> LOG(("Error calling PathRemoveFileSpecW: %d", GetLastError()));
> LogFinish();
> return 1;
> }
>
>- if (\_wcsnicmp(stagedParent, gInstallDirPath, MAX\_PATH) != 0) {
>- WriteStatusFile(INVALID\_STAGED\_PARENT\_ERROR);
>- LOG(("Stage and Replace requests require that the working directory " \
>- "is a sub-directory of the installation directory! Exiting"));
>+ if (\_wcsnicmp(workingDirParent, gInstallDirPath, MAX\_PATH) != 0) {
>+ WriteStatusFile(INVALID\_APPLYTO\_DIR\_ERROR);
>+ LOG(("The apply-to directory must be the same as or "
>+ "a child of the installation directory! Exiting."));
> LogFinish();
> return 1;
> }
> }
> #endif
>
> #ifdef MOZ\_WIDGET\_GONK
> const char \*prioEnv = getenv("MOZ\_UPDATER\_PRIO");
>@@ -2916,25 +3007,16 @@ int NS\_main(int argc, NS\_tchar \*\*argv)
> }
> }
> #else
> if (pid > 0)
> waitpid(pid, nullptr, 0);
> #endif
>
> #ifdef XP\_WIN
>- if (sReplaceRequest) {
>- // On Windows, the current working directory of the process should be changed
>- // so that it's not locked.
>- NS\_tchar sysDir[MAX\_PATH + 1] = { L'\0' };
>- if (GetSystemDirectoryW(sysDir, MAX\_PATH + 1)) {
>- NS\_tchdir(sysDir);
>- }
>- }
>-
> #ifdef MOZ\_MAINTENANCE\_SERVICE
> sUsingService = EnvHasValue("MOZ\_USING\_SERVICE");
> putenv(const\_cast<char\*>("MOZ\_USING\_SERVICE="));
> #endif
> // lastFallbackError keeps track of the last error for the service not being
> // used, in case of an error when fallback is not enabled we write the
> // error to the update.status file.
> // When fallback is disabled (MOZ\_NO\_SERVICE\_FALLBACK does not exist) then
>@@ -3380,17 +3446,17 @@ int NS\_main(int argc, NS\_tchar \*\*argv)
> argv + callbackIndex,
> sUsingService);
> }
> return 1;
> }
>
> // Doing this is only necessary when we're actually applying a patch.
> if (!sReplaceRequest) {
>- int len = NS\_tstrlen(applyDirLongPath);
>+ int len = NS\_tstrlen(gInstallDirPath);
Why did you change this?
> NS\_tchar \*s = callbackLongPath;
> NS\_tchar \*d = gCallbackRelPath;
> // advance to the apply to directory and advance past the trailing backslash
> // if present.
> s += len;
> if (\*s == NS\_T('\\'))
> ++s;
>
>@@ -3486,18 +3552,22 @@ int NS\_main(int argc, NS\_tchar \*\*argv)
> }
> }
>
> // DELETE\_DIR is not required when staging an update.
Please change this comment to something along the lines of
// DELETE\_DIR is not required when performing a staged update or replace
// request though it can be used during a replace request but it doesn't
// use gDeleteDirPath.
> if (!sStagedUpdate && !sReplaceRequest) {
> // The directory to move files that are in use to on Windows. This directory
> // will be deleted after the update is finished or on OS reboot using
> // MoveFileEx if it contains files that are in use.
Please change this comment as follows
// The directory to move files that are in use to on Windows. This directory
// will either be deleted after the update is finished, on OS reboot using
// MoveFileEx if it contains files that are in use, or by the post update
// process after the update finishes. On Windows when performing a normal
// update (e.g. the update is not a staged update and is not a replace
// request) gWorkingDirPath is the same as gInstallDirPath and
// gWorkingDirPath is used because it is the destination directory.
>- if (NS\_taccess(DELETE\_DIR, F\_OK)) {
>- NS\_tmkdir(DELETE\_DIR, 0755);
>+ NS\_tsnprintf(gDeleteDirPath,
>+ sizeof(gDeleteDirPath) / sizeof(gDeleteDirPath[0]),
>+ NS\_T("%s/%s"), gWorkingDirPath, DELETE\_DIR);
>+
>+ if (NS\_taccess(gDeleteDirPath, F\_OK)) {
>+ NS\_tmkdir(gDeleteDirPath, 0755);
> }
> }
> #endif /\* XP\_WIN \*/
@@ -4062,21 +4123,26 @@ GetManifestContents(const NS\_tchar \*mani
}
int AddPreCompleteActions(ActionList \*list)
{
if (sIsOSUpdate) {
return OK;
}
+ NS\_tchar manifestPath[MAXPATHLEN];
#ifdef XP\_MACOSX
- NS\_tchar \*rb = GetManifestContents(NS\_T("Contents/Resources/precomplete"));
+ NS\_tsnprintf(manifestPath, sizeof(manifestPath) / sizeof(manifestPath[0]),
+ NS\_T("%s/Contents/Resources/precomplete"), gInstallDirPath);
#else
- NS\_tchar \*rb = GetManifestContents(NS\_T("precomplete"));
+ NS\_tsnprintf(manifestPath, sizeof(manifestPath) / sizeof(manifestPath[0]),
+ NS\_T("%s/precomplete"), gInstallDirPath);
#endif
Though either should work I think this should be gWorkingDirPath so it will use the one in the staging directory when staging.
As mhowell suggested over irc, use get\_full\_path.
+
+ NS\_tchar \*rb = GetManifestContents(manifestPath);
if (rb == nullptr) {
LOG(("AddPreCompleteActions: error getting contents of precomplete " \
"manifest"));
// Applications aren't required to have a precomplete manifest. The mar
// generation scripts enforce the presence of a precomplete manifest.
return OK;
}Flags: needinfo?(robert.strong.bugs)
[Attachment #8773858](/attachment.cgi?id=8773858&action=edit "Patch") -
Flags: review?(robert.strong.bugs) → review-

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1246972#c55)• 8 years ago |
|  | |

BTW: it looks like some Windows style newlines might have snuck into your patch

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1246972#c56)• 8 years ago |
|  | |

(In reply to Robert Strong [:rstrong] (use needinfo to contact me) from [comment #54](/show_bug.cgi?id=1246972#c54 "VERIFIED FIXED - Arbitrary target directory for result files of update process"))
<snip>
> >+
> > NS\_tstrcat(c, relpath);
> > c += lenrelpath;
> > \*c = NS\_T('\0');
> >- c++;
> > return s;
> > }
> >@@ -2468,17 +2558,18 @@ UpdateThreadFunc(void \*param)
> > NS\_tchar updateSettingsPath[MAX\_TEXT\_LEN];
> > NS\_tsnprintf(updateSettingsPath,
> > sizeof(updateSettingsPath) / sizeof(updateSettingsPath[0]),
> > #ifdef XP\_MACOSX
> > NS\_T("%s/Contents/Resources/update-settings.ini"),
> > #else
> > NS\_T("%s/update-settings.ini"),
> > #endif
> >- gWorkingDirPath);
> >+ gInstallDirPath);
> Pretty sure this shouldn't be changed.
>
> Pushed this changed back to try to verify
> <https://treeherder.mozilla.org/#/jobs?repo=try&revision=2d7358e3b2bd>
Debug try run finished successfully on Mac and other platforms look fine too so it should be safe to revert this.

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1246972#c57)• 8 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=8777584&action=diff) (obsolete)
— [Details](attachment.cgi?id=8777584&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8777584)

This fixes all the review comments, including the ones from [comment 55](/show_bug.cgi?id=1246972#c55 "VERIFIED FIXED - Arbitrary target directory for result files of update process") and [comment 56](/show_bug.cgi?id=1246972#c56 "VERIFIED FIXED - Arbitrary target directory for result files of update process").
>- int len = NS\_tstrlen(applyDirLongPath);
>+ int len = NS\_tstrlen(gInstallDirPath);
>Why did you change this?
I have no idea; I reverted that as well. My guess is that it was needed on an earlier version of the patch and stopped making sense when the chdir calls were removed.
I'll do one more try push to make sure all this is still okay.
[Attachment #8773858](/attachment.cgi?id=8773858&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #8777584](/attachment.cgi?id=8777584&action=edit "Patch") -
Flags: review?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1246972#c58)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=37aa231d84ab>

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1246972#c59)• 8 years ago |
|  | |

It would be a good thing to have a test for the failure when the gWorkingDirPath and gInstallDirPath aren't the same for a normal update. I'm wondering if the same restriction should be cross platform as well... could you check?
<https://dxr.mozilla.org/mozilla-central/source/toolkit/xre/nsUpdateDriver.cpp>

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1246972#c60)• 8 years ago |
|  | |

Comment on [attachment 8777584](/attachment.cgi?id=8777584 "Patch") [[details]](/attachment.cgi?id=8777584&action=edit "Patch") [[diff]](/attachment.cgi?id=8777584&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8777584)
Patch
Clearing review until [comment #45](/show_bug.cgi?id=1246972#c45 "VERIFIED FIXED - Arbitrary target directory for result files of update process") is answeredFlags: needinfo?(mhowell)
[Attachment #8777584](/attachment.cgi?id=8777584&action=edit "Patch") -
Flags: review?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1246972#c61)• 8 years ago |
|  | |

bah! I meant [comment #59](/show_bug.cgi?id=1246972#c59 "VERIFIED FIXED - Arbitrary target directory for result files of update process")

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1246972#c62)• 8 years ago |
|  | |

(In reply to Robert Strong [:rstrong] (use needinfo to contact me) from [comment #59](/show_bug.cgi?id=1246972#c59 "VERIFIED FIXED - Arbitrary target directory for result files of update process"))
> It would be a good thing to have a test for the failure when the
> gWorkingDirPath and gInstallDirPath aren't the same for a normal update.
Okay, I can add that.
> I'm wondering if the same restriction should be cross platform as well... could you check?
> <https://dxr.mozilla.org/mozilla-central/source/toolkit/xre/nsUpdateDriver.cpp>
It should be possible to make it cross-platform, but it broke staging when I tried it, and I'd rather not spend time fixing that as part of this bug, since the security implications aren't really there on platforms lacking the maintenance service.Flags: needinfo?(mhowell)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1246972#c63)• 8 years ago |
|  | |

That should only apply when the following is true and hence shouldn't break staging or replace requests.
if (!sStagedUpdate && !sReplaceRequest) {
The only case that I think it might break is gonk but I'm fine with not doing this change in this bug.
Also, you didn't add a new error and write it to the status file for
+ if (\_wcsnicmp(gWorkingDirPath, gInstallDirPath, MAX\_PATH) != 0) {
+ if (!sStagedUpdate && !sReplaceRequest) {
+ LOG(("Installation directory and working directory must be the same "
+ "for non-staged updates. Exiting."));

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1246972#c64)• 8 years ago |
|  | |

Comment on [attachment 8777584](/attachment.cgi?id=8777584 "Patch") [[details]](/attachment.cgi?id=8777584&action=edit "Patch") [[diff]](/attachment.cgi?id=8777584&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8777584)
Patch
The only remaining things to be done are the new test and
Also, you didn't add a new error and write it to the status file for
+ if (\_wcsnicmp(gWorkingDirPath, gInstallDirPath, MAX\_PATH) != 0) {
+ if (!sStagedUpdate && !sReplaceRequest) {
+ LOG(("Installation directory and working directory must be the same "
+ "for non-staged updates. Exiting."));
This error should also be handled in nsUpdateService.js and reported via telemetry.
[Attachment #8777584](/attachment.cgi?id=8777584&action=edit "Patch") -
Flags: review-

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1246972#c65)• 8 years ago |
|  | |

(In reply to Robert Strong [:rstrong] (use needinfo to contact me) from [comment #64](/show_bug.cgi?id=1246972#c64 "VERIFIED FIXED - Arbitrary target directory for result files of update process"))
> Also, you didn't add a new error and write it to the status file for
> + if (\_wcsnicmp(gWorkingDirPath, gInstallDirPath, MAX\_PATH) != 0) {
> + if (!sStagedUpdate && !sReplaceRequest) {
> + LOG(("Installation directory and working directory must be the same "
> + "for non-staged updates. Exiting."));
>
> This error should also be handled in nsUpdateService.js and reported via
> telemetry.
Do you think this needs to be a whole new error code? It seems like INVALID\_APPLYTO\_DIR\_ERROR would work fine; it's really the same error as the other place that code is returned, and the fact that it's a stage or replace run disambiguates this one from that one.Flags: needinfo?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1246972#c66)• 8 years ago |
|  | |

It depends on how difficult it is to differentiate it in telemetry. I suspect it won't be that easy.Flags: needinfo?(robert.strong.bugs)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1246972#c67)• 8 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=8778458&action=diff) (obsolete)
— [Details](attachment.cgi?id=8778458&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8778458)

Added new error code and test.
[Attachment #8777584](/attachment.cgi?id=8777584&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #8778458](/attachment.cgi?id=8778458&action=edit "Patch") -
Flags: review?(robert.strong.bugs)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1246972#c68)• 8 years ago |
|  | |

Comment on [attachment 8778458](/attachment.cgi?id=8778458 "Patch") [[details]](/attachment.cgi?id=8778458&action=edit "Patch") [[diff]](/attachment.cgi?id=8778458&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8778458)
Patch
I thought you were going to land this on oak first... you don't need to wait on review to do so. Anyways, this looks good.
[Attachment #8778458](/attachment.cgi?id=8778458&action=edit "Patch") -
Flags: review?(robert.strong.bugs) → review+

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1246972#c69)• 8 years ago |
|  | |

(In reply to Robert Strong [:rstrong] (use needinfo to contact me) from [comment #68](/show_bug.cgi?id=1246972#c68 "VERIFIED FIXED - Arbitrary target directory for result files of update process"))
> I thought you were going to land this on oak first... you don't need to wait
> on review to do so. Anyways, this looks good.
Yeah, sorry, I just hadn't gotten around to it yet. Trying to do it today.
Thanks for the reviews.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1246972#c70)• 8 years ago |
|  | |

I'll do some manual update testing on oak after it is landed as well. Thanks!

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1246972#c71)• 8 years ago |
|  | |

<https://hg.mozilla.org/projects/oak/rev/4afd44e5b901>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1246972#c72)• 8 years ago |
|  | |

Finally managed to get that testing done. I tried staged and non-staged updates, first in Program Files, and then inside the user's profile. Everything went as expected. I'll post a rebased patch (there's one file with a non-trivial merge) with a carried-over r+ and then request security approval.

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1246972#c73)• 8 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=8784879&action=diff) (obsolete)
— [Details](attachment.cgi?id=8784879&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8784879)

Rebased version of [attachment 8778458](/attachment.cgi?id=8778458 "Patch") [[details]](/attachment.cgi?id=8778458&action=edit "Patch") [[diff]](/attachment.cgi?id=8778458&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8778458); r+ carried over.
[Attachment #8778458](/attachment.cgi?id=8778458&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #8784879](/attachment.cgi?id=8784879&action=edit "Patch") -
Flags: sec-approval?
[Attachment #8784879](/attachment.cgi?id=8784879&action=edit "Patch") -
Flags: review+

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a17105914_550257)• 8 years ago |

[Attachment #8784879](/attachment.cgi?id=8784879&action=edit "Patch") -
Flags: sec-approval?

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1246972#c74)• 8 years ago |
|  | |

Comment on [attachment 8784879](/attachment.cgi?id=8784879 "Patch") [[details]](/attachment.cgi?id=8784879&action=edit "Patch") [[diff]](/attachment.cgi?id=8784879&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8784879)
Patch
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
I suspect it wouldn't be easy; the patch is large and the actual security fix is kind of buried.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
Not in my opinion.
Which older supported branches are affected by this flaw?
All
If not all supported branches, which bug introduced the flaw?
N/A
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
I do not; they might be non-trivial to create because of the amount of surgery I had to do to the updater. I'm not sure this patch merits backporting, though.
How likely is this patch to cause regressions; how much testing does it need?
Unlikely. Existing automated tests are fairly extensive, and I did some manual testing myself, see [comment 72](/show_bug.cgi?id=1246972#c72 "VERIFIED FIXED - Arbitrary target directory for result files of update process").
[Attachment #8784879](/attachment.cgi?id=8784879&action=edit "Patch") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1246972#c75)• 8 years ago |
|  | |

Comment on [attachment 8784879](/attachment.cgi?id=8784879 "Patch") [[details]](/attachment.cgi?id=8784879&action=edit "Patch") [[diff]](/attachment.cgi?id=8784879&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8784879)
Patch
sec-approval+ for trunk. I think we should take it on Aurora but I don't know that we want to take a big patch late for beta for 49.
[Attachment #8784879](/attachment.cgi?id=8784879&action=edit "Patch") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a17109135_280903)• 8 years ago |

[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1246972#c76)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/c079fb045b9d18df1a6fe80e3a46ad1e27eff03d>
[Bug 1246972](/show_bug.cgi?id=1246972 "VERIFIED FIXED - Arbitrary target directory for result files of update process") - Always require the update working directory to be within the installation path; r=rstrong

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1246972#c77)• 8 years ago |
|  | |

Comment on [attachment 8784879](/attachment.cgi?id=8784879 "Patch") [[details]](/attachment.cgi?id=8784879&action=edit "Patch") [[diff]](/attachment.cgi?id=8784879&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8784879)
Patch
On abillings's suggestion:
Approval Request Comment
[Feature/regressing bug #]:
Probably [bug 481815](/show_bug.cgi?id=481815 "RESOLVED FIXED - Provide a Windows service to update applications without asking Administrator password").
[User impact if declined]:
Security bug classified sec-high.
[Describe test coverage new/current, TreeHerder]:
Automated test coverage for the updater is good. A new test was also added to verify the new failure condition. The latest push that includes this patch is on TreeHerder at <https://treeherder.mozilla.org/#/jobs?repo=oak&revision=189f55e63199>. I've also done a bit of manual testing, see [comment 72](/show_bug.cgi?id=1246972#c72 "VERIFIED FIXED - Arbitrary target directory for result files of update process").
[Risks and why]:
This patch contains pretty wide-reaching changes to the updater, so the risk is that updates start failing. Allowing the patch to sit on nightly for a few days before uplifting it would be a good way to manage that.
[String/UUID change made/needed]:
None
[Attachment #8784879](/attachment.cgi?id=8784879&action=edit "Patch") -
Flags: approval-mozilla-aurora?

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=1246972#c78)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/4576637003b6ae52477041cd6a807f482bad5211>
[Bug 1246972](/show_bug.cgi?id=1246972 "VERIFIED FIXED - Arbitrary target directory for result files of update process") followup - Fix eslint errors; CLOSED TREE

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=1246972#c79)• 8 years ago |
|  | |

Backed out for xpcshell failures like <https://treeherder.mozilla.org/logviewer.html#?job_id=34660566&repo=mozilla-inbound>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/41ee5cb3266c>Flags: needinfo?(mhowell)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=1246972#c80)• 8 years ago |
|  | |

I landed [bug 1291985](/show_bug.cgi?id=1291985 "RESOLVED FIXED - DON'T USE WinXP debug only TEST-UNEXPECTED-TIMEOUT | toolkit/mozapps/update/tests/unit_service_updater/bootstrapSvc.js | Test timed out - followed by numerous other update test failures on WinXP debug only") on inbound today so please add the following to the xpcshell.ini for the new test
skip-if = os != 'win' || debug && (os\_version == '5.1' || os\_version == '5.2')
reason = Windows only test and [bug 1291985](/show_bug.cgi?id=1291985 "RESOLVED FIXED - DON'T USE WinXP debug only TEST-UNEXPECTED-TIMEOUT | toolkit/mozapps/update/tests/unit_service_updater/bootstrapSvc.js | Test timed out - followed by numerous other update test failures on WinXP debug only")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a17127976_280903)• 8 years ago |

[Attachment #8784879](/attachment.cgi?id=8784879&action=edit "Patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=1246972#c81)• 8 years ago |
|  | |

Note that patch was backed out from inbound for asan failures, so don't actually push that one to aurora. Attempted fix incoming.Flags: needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=1246972#c82)• 8 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=27cdfe581567>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 83](/show_bug.cgi?id=1246972#c83)• 8 years ago |
|  | |

Attached patch

[Fixed Patch](attachment.cgi?id=8785392&action=diff)
— [Details](attachment.cgi?id=8785392&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8785392)

Okay, my stab at a fix for the asan failures seems to have worked. This is the fixed patch.
Not sure if I need to request sec-approval again, since this is a minor change to the previous patch which already had it. I'll do it anyway just to be safe.
[Attachment #8784879](/attachment.cgi?id=8784879&action=edit "Patch") -
Attachment is obsolete: true
[Attachment #8785392](/attachment.cgi?id=8785392&action=edit "Fixed Patch") -
Flags: sec-approval?
[Attachment #8785392](/attachment.cgi?id=8785392&action=edit "Fixed Patch") -
Flags: review+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a17216207_280903)• 8 years ago |

[Attachment #8785392](/attachment.cgi?id=8785392&action=edit "Fixed Patch") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a17216216_280903)• 8 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 84](/show_bug.cgi?id=1246972#c84)• 8 years ago |
|  | |

Since this patch has a chance (and in fact a history) of causing trouble, I didn't really want to push it out last thing on a Friday. ;)
I'll request uplift again if this push sticks on nightly for a few days.Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 85](/show_bug.cgi?id=1246972#c85)• 8 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/c908e9677a9b93ac25b3c35e75bdb447b6e69b56>
[Bug 1246972](/show_bug.cgi?id=1246972 "VERIFIED FIXED - Arbitrary target directory for result files of update process") - Always require the update working directory to be within the installation path; r=rstrong

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 86](/show_bug.cgi?id=1246972#c86)• 8 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/c908e9677a9b>Status: NEW → RESOLVEDClosed: 8 years ago
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla51

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a17538911_280903)• 8 years ago |

Flags: sec-bounty?

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 87](/show_bug.cgi?id=1246972#c87)• 8 years ago |
|  | |

Is this ready to request uplift? We're running out of time if this is going to make 49.Flags: needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 88](/show_bug.cgi?id=1246972#c88)• 8 years ago |
|  | |

Yesterday would have been the first nightly that included this patch, which means today's is the first update that's using it. I'd rather wait at least a few more hours, up to a couple of days if possible, for more people to attempt that update, to see if any problems appear.Flags: needinfo?(mhowell)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 89](/show_bug.cgi?id=1246972#c89)• 8 years ago |
|  | |

Matt: I am planning to start the 49 beta 9 build tomorrow, then the RC build on Monday. I would rather not take this in late beta though.
[status-firefox49](/buglist.cgi?f1=cf_status_firefox49&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox49&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a17712704_1689)• 8 years ago |

Group: toolkit-core-security → core-security-release

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 90](/show_bug.cgi?id=1246972#c90)• 8 years ago |
|  | |

Comment on [attachment 8785392](/attachment.cgi?id=8785392 "Fixed Patch") [[details]](/attachment.cgi?id=8785392&action=edit "Fixed Patch") [[diff]](/attachment.cgi?id=8785392&action=diff "Fixed Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8785392)
Fixed Patch
Approval Request Comment
See [comment 77](/show_bug.cgi?id=1246972#c77 "VERIFIED FIXED - Arbitrary target directory for result files of update process"). We've had a couple of nightly updates using this patch now and no reports of issues, so I'm confident that the risk has been addressed.
[Attachment #8785392](/attachment.cgi?id=8785392&action=edit "Fixed Patch") -
Flags: approval-mozilla-aurora?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 91](/show_bug.cgi?id=1246972#c91)• 8 years ago |
|  | |

We need to fix this in the ESR release that matches the Firefox release that fixes it (looking like 50/45.5)
[tracking-firefox-esr45](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=isnotempty):
--- → [50+](/buglist.cgi?f1=cf_tracking_firefox_esr45&o1=equals&v1=50%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a18666284_1689)• 8 years ago |

Flags: sec-bounty? → sec-bounty+Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 92](/show_bug.cgi?id=1246972#c92)• 8 years ago |
|  | |

Comment on [attachment 8785392](/attachment.cgi?id=8785392 "Fixed Patch") [[details]](/attachment.cgi?id=8785392&action=edit "Fixed Patch") [[diff]](/attachment.cgi?id=8785392&action=diff "Fixed Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8785392)
Fixed Patch
Approving for Aurora. We should take this on ESR45 as well.
[Attachment #8785392](/attachment.cgi?id=8785392&action=edit "Fixed Patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 93](/show_bug.cgi?id=1246972#c93)• 8 years ago |
|  | |

Can you make an ESR45 patch and nominate it, Matt?Flags: needinfo?(mhowell)

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 94](/show_bug.cgi?id=1246972#c94)• 8 years ago |
|  | |

Attached patch

[ESR45 Patch](attachment.cgi?id=8790451&action=diff) (obsolete)
— [Details](attachment.cgi?id=8790451&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8790451)

Same patch as [attachment 8785392](/attachment.cgi?id=8785392 "Fixed Patch") [[details]](/attachment.cgi?id=8785392&action=edit "Fixed Patch") [[diff]](/attachment.cgi?id=8785392&action=diff "Fixed Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8785392) rebased for ESR45.
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
N/A, this bug is sec-high
User impact if declined:
sec-high bug allowing privilege escalation on Windows
Fix Landed on Version:
51, with uplift to 50
Risk to taking this patch (and alternatives if risky):
Primary risk is new bugs created in the updater by this patch causing updates to fail. This risk has been managed by running this patch on Nightly for two weeks; no issues have been observed or reported.
String or UUID changes made by this patch:
NoneFlags: needinfo?(mhowell)
[Attachment #8790451](/attachment.cgi?id=8790451&action=edit "ESR45 Patch") -
Flags: approval-mozilla-esr45?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 95](/show_bug.cgi?id=1246972#c95)• 8 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/89ba44134660>
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed)Flags: in-testsuite+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 96](/show_bug.cgi?id=1246972#c96)• 8 years ago |
|  | |

Comment on [attachment 8790451](/attachment.cgi?id=8790451 "ESR45 Patch") [[details]](/attachment.cgi?id=8790451&action=edit "ESR45 Patch") [[diff]](/attachment.cgi?id=8790451&action=diff "ESR45 Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8790451)
ESR45 Patch
sec-high, taking it on the esr branch
[Attachment #8790451](/attachment.cgi?id=8790451&action=edit "ESR45 Patch") -
Flags: approval-mozilla-esr45? → approval-mozilla-esr45+

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 97](/show_bug.cgi?id=1246972#c97)• 8 years ago |
|  | |

Attached patch

[ESR45 Patch Rebased](attachment.cgi?id=8801906&action=diff)
— [Details](attachment.cgi?id=8801906&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8801906)

The ESR45 patch previously posted here and just approved had bitrotted due to the landing of [bug 1168743](/show_bug.cgi?id=1168743 "RESOLVED FIXED - Only use env vars in the test updater and general cleanup") and friends. This one should apply cleanly.
[Attachment #8790451](/attachment.cgi?id=8790451&action=edit "ESR45 Patch") -
Attachment is obsolete: true
[Attachment #8801906](/attachment.cgi?id=8801906&action=edit "ESR45 Patch Rebased") -
Flags: approval-mozilla-esr45?

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a21748231_495955)• 8 years ago |

[Attachment #8801906](/attachment.cgi?id=8801906&action=edit "ESR45 Patch Rebased") -
Flags: approval-mozilla-esr45? → approval-mozilla-esr45+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a21748237_495955)• 8 years ago |

[Attachment #8790451](/attachment.cgi?id=8790451&action=edit "ESR45 Patch") -
Flags: approval-mozilla-esr45+ → approval-mozilla-esr45-

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Comment 98](/show_bug.cgi?id=1246972#c98)• 8 years ago |
|  | |

Comment on [attachment 8801906](/attachment.cgi?id=8801906 "ESR45 Patch Rebased") [[details]](/attachment.cgi?id=8801906&action=edit "ESR45 Patch Rebased") [[diff]](/attachment.cgi?id=8801906&action=diff "ESR45 Patch Rebased") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1246972&attachment=8801906)
ESR45 Patch Rebased
Pushed:
<https://hg.mozilla.org/releases/mozilla-esr45/rev/aa1593ec5ccd027070daa190e433ed588eb2fdca>

|  | [Molly Howell (she/her) (mostly inactive)](/user_profile?user_id=550257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a21768479_550257)• 8 years ago |

[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a23243493_452604)• 8 years ago |

Flags: qe-verify+QA Contact: kjozwiakWhiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a23530326_280903)• 8 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main50+][adv-esr45.5+]

|  | [Bogdan Maris, Desktop Test Engineering](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 99](/show_bug.cgi?id=1246972#c99)• 8 years ago |
|  | |

OS tested:
- Windows 7 64bit.
Reproduced the initial issue using old Nightly from (2016-02-09) and poc file attached:
\* Installed Firefox
<https://archive.mozilla.org/pub/firefox/nightly/2016/02/2016-02-09-03-03-47-mozilla-central/firefox-47.0a1.en-US.win32.installer.exe>
\* Mar file
<https://archive.mozilla.org/pub/firefox/nightly/2016/02/2016-02-09-03-03-47-mozilla-central/firefox-47.0a1.en-US.win32.complete.mar>
Executing poc file will result in:
- 'target' folder is created in the same directory as poc.rb
- update.log:
> PATCH DIRECTORY C:\Users\bogdan.maris\Desktop\invalid.loc.poc\updatework
> INSTALLATION DIRECTORY C:\Program Files (x86)\Nightly
> WORKING DIRECTORY C:\Users\bogdan.maris\Desktop\invalid.loc.poc\target
> failed: 6
> calling QuitProgressUI
- update.status
> failed: 6
Verified that the initial issue does not reproduce in current builds:
1) Firefox 50.0-build2
\* Installed Firefox
<https://archive.mozilla.org/pub/firefox/candidates/50.0-candidates/build2/win32/en-US/Firefox%20Setup%2050.0.exe>
\* Mar file
<https://archive.mozilla.org/pub/firefox/candidates/50.0-candidates/build2/update/win32/en-US/firefox-50.0.complete.mar>
Executing poc file will result in:
- 'target' folder is NOT created at all
- update.log:
> PATCH DIRECTORY C:\Users\bogdan.maris\Desktop\invalid.loc.poc\updatework
> INSTALLATION DIRECTORY C:\Program Files (x86)\Nightly
> WORKING DIRECTORY C:\Users\bogdan.maris\Desktop\invalid.loc.poc\target
> Installation directory and working directory must be the same for non-staged updates. Exiting.
- update.status:
> failed: 74
2) Firefox 45.5.0esr-build1
\* Installed FirefoxESR
<https://archive.mozilla.org/pub/firefox/candidates/45.5.0esr-candidates/build1/win32/en-US/Firefox%20Setup%2045.5.0esr.exe>
\* Mar file:
<https://archive.mozilla.org/pub/firefox/candidates/45.5.0esr-candidates/build1/update/win32/en-US/firefox-45.5.0esr.complete.mar>
Executing poc file will result in:
- 'target' folder is NOT created at all
- update.log:
> PATCH DIRECTORY C:\Users\bogdan.maris\Desktop\invalid.loc.poc\updatework
> INSTALLATION DIRECTORY C:\Program Files (x86)\Nightly
> WORKING DIRECTORY C:\Users\bogdan.maris\Desktop\invalid.loc.poc\target
> Installation directory and working directory must be the same for non-staged updates. Exiting.
- update.status:
> failed: 74
3) Latest Firefox Developer Edition 51.0a2 (2016-11-08)
\* Installed Firefox
<https://archive.mozilla.org/pub/firefox/nightly/latest-mozilla-aurora/firefox-51.0a2.en-US.win32.installer.exe>
\* Mar file
<https://archive.mozilla.org/pub/firefox/nightly/latest-mozilla-aurora/firefox-51.0a2.en-US.win32.complete.mar>
Executing poc file will result in:
- 'target' folder is NOT created at all
- update.log:
> PATCH DIRECTORY C:\Users\bogdan.maris\Desktop\invalid.loc.poc\updatework
> INSTALLATION DIRECTORY C:\Program Files (x86)\Nightly
> WORKING DIRECTORY C:\Users\bogdan.maris\Desktop\invalid.loc.poc\target
> Installation directory and working directory must be the same for non-staged updates. Exiting.
- update.status:
> failed: 74
Note:
- Nightly directory was the directory where all Firefox versions were installed, this was done to avoid editing the poc file.Status: RESOLVED → VERIFIED
[status-firefox50](/buglist.cgi?f1=cf_status_firefox50&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox50&o1=equals&v1=verified)
[status-firefox51](/buglist.cgi?f1=cf_status_firefox51&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox51&o1=equals&v1=verified)
[status-firefox-esr45](/buglist.cgi?f1=cf_status_firefox_esr45&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr45&o1=equals&v1=verified)Flags: qe-verify+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a23769118_280903)• 8 years ago |

Alias: CVE-2016-5294

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a31619865_1689)• 8 years ago |

Group: core-security-release

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a38917920_141755)• 8 years ago |

Depends on: [1362267](/show_bug.cgi?id=1362267 "RESOLVED FIXED - Replace requests are failing on Windows and falling back to normal updates")

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a38979364_455785)• 8 years ago |

QA Contact: kjozwiak

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a110817122_141755)• 5 years ago |

Depends on: [1574080](/show_bug.cgi?id=1574080 "RESOLVED FIXED - gDestPath is unused in updater.cpp")

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1246972#a262049040_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1246972&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Holger Fuhrmannek](/user_profile?user_id=436533)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_73f8d6fa_20250126_060758.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from security.gentoo.org_14686fcf_20250125_045730.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox, Thunderbird: Multiple vulnerabilities — GLSA **201701-15**

Multiple vulnerabilities have been found in Mozilla Firefox and
Thunderbird the worst of which could lead to the execution of arbitrary
code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **45.6.0** |
| Unaffected versions | >= **45.6.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **45.6.0** |
| Unaffected versions | >= **45.6.0** |

| Package | **mail-client/thunderbird** on all architectures |
| --- | --- |
| Affected versions | < **45.6.0** |
| Unaffected versions | >= **45.6.0** |

| Package | **mail-client/thunderbird-bin** on all architectures |
| --- | --- |
| Affected versions | < **45.6.0** |
| Unaffected versions | >= **45.6.0** |

### Background

Mozilla Firefox is a cross-platform web browser from Mozilla. The
Mozilla Thunderbird mail client is a redesign of the Mozilla Mail
component. The goal is to produce a cross-platform stand-alone mail
application using XUL (XML User Interface Language).

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox and
Thunderbird. Please review the CVE identifiers referenced below for
details.

### Impact

A remote attacker could possibly execute arbitrary code with the
privileges of the process or cause a Denial of Service condition via
multiple vectors.

### Workaround

There is no known workaround at this time.

### Resolution

All Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-45.6.0"

```

All Firefox-bin users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-45.6.0"

```

All Thunderbird users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=mail-client/thunderbird-45.6.0"

```

All Thunderbird-bin users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose
 ">=mail-client/thunderbird-bin-45.6.0"

```
### References

* [CVE-2016-2804](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2804)
* [CVE-2016-2805](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2805)
* [CVE-2016-2806](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2806)
* [CVE-2016-2807](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2807)
* [CVE-2016-2808](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2808)
* [CVE-2016-2809](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2809)
* [CVE-2016-2810](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2810)
* [CVE-2016-2811](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2811)
* [CVE-2016-2812](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2812)
* [CVE-2016-2813](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2813)
* [CVE-2016-2814](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2814)
* [CVE-2016-2816](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2816)
* [CVE-2016-2817](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2817)
* [CVE-2016-2820](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2820)
* [CVE-2016-2827](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2827)
* [CVE-2016-2830](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2830)
* [CVE-2016-2835](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2835)
* [CVE-2016-2836](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2836)
* [CVE-2016-2837](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2837)
* [CVE-2016-2838](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2838)
* [CVE-2016-2839](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-2839)
* [CVE-2016-5250](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5250)
* [CVE-2016-5251](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5251)
* [CVE-2016-5252](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5252)
* [CVE-2016-5253](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5253)
* [CVE-2016-5254](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5254)
* [CVE-2016-5255](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5255)
* [CVE-2016-5256](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5256)
* [CVE-2016-5257](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5257)
* [CVE-2016-5258](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5258)
* [CVE-2016-5259](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5259)
* [CVE-2016-5260](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5260)
* [CVE-2016-5261](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5261)
* [CVE-2016-5262](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5262)
* [CVE-2016-5263](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5263)
* [CVE-2016-5264](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5264)
* [CVE-2016-5265](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5265)
* [CVE-2016-5266](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5266)
* [CVE-2016-5267](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5267)
* [CVE-2016-5268](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5268)
* [CVE-2016-5270](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5270)
* [CVE-2016-5271](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5271)
* [CVE-2016-5272](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5272)
* [CVE-2016-5273](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5273)
* [CVE-2016-5274](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5274)
* [CVE-2016-5275](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5275)
* [CVE-2016-5276](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5276)
* [CVE-2016-5277](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5277)
* [CVE-2016-5278](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5278)
* [CVE-2016-5279](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5279)
* [CVE-2016-5280](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5280)
* [CVE-2016-5281](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5281)
* [CVE-2016-5282](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5282)
* [CVE-2016-5283](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5283)
* [CVE-2016-5284](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5284)
* [CVE-2016-5290](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5290)
* [CVE-2016-5291](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5291)
* [CVE-2016-5293](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5293)
* [CVE-2016-5294](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5294)
* [CVE-2016-5296](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5296)
* [CVE-2016-5297](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-5297)
* [CVE-2016-9064](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9064)
* [CVE-2016-9066](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9066)
* [CVE-2016-9074](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9074)
* [CVE-2016-9079](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9079)
* [CVE-2016-9893](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9893)
* [CVE-2016-9895](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9895)
* [CVE-2016-9897](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9897)
* [CVE-2016-9898](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9898)
* [CVE-2016-9899](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9899)
* [CVE-2016-9900](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9900)
* [CVE-2016-9901](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9901)
* [CVE-2016-9902](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9902)
* [CVE-2016-9904](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9904)
* [CVE-2016-9905](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-9905)

**Release date**

January 03, 2017

**Latest revision**

January 04, 2017: 2

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [581326](https://bugs.gentoo.org/show_bug.cgi?id=581326)
* [590330](https://bugs.gentoo.org/show_bug.cgi?id=590330)
* [594616](https://bugs.gentoo.org/show_bug.cgi?id=594616)
* [599924](https://bugs.gentoo.org/show_bug.cgi?id=599924)
* [601320](https://bugs.gentoo.org/show_bug.cgi?id=601320)
* [602576](https://bugs.gentoo.org/show_bug.cgi?id=602576)
* [604024](https://bugs.gentoo.org/show_bug.cgi?id=604024)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from www.mozilla.org_106fad63_20250125_045732.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2016-90

## Security vulnerabilities fixed in Firefox ESR 45.5

Announced
November 15, 2016
Impact
critical
Products
Firefox ESR
Fixed in

* Firefox ESR 45.5

#### [#CVE-2016-5296: Heap-buffer-overflow WRITE in rasterize\_edges\_1](#CVE-2016-5296)

Reporter
Abhishek Arya
Impact
critical
##### Description

A heap-buffer-overflow in Cairo when processing SVG content caused by compiler optimization, resulting in a potentially exploitable crash.

##### References

* [Bug 1292443](https://bugzilla.mozilla.org/show_bug.cgi?id=1292443)

#### [#CVE-2016-5293: Write to arbitrary file with Mozilla Updater and Maintenance Service using updater.log hardlink](#CVE-2016-5293)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

When the Mozilla Updater is run, if the Updater's log file in the working directory points to a hardlink, data can be appended to an arbitrary local file. This vulnerability requires local system access.
*Note: this issue only affects Windows operating systems.*

##### References

* [Bug 1246945](https://bugzilla.mozilla.org/show_bug.cgi?id=1246945)

#### [#CVE-2016-5294: Arbitrary target directory for result files of update process](#CVE-2016-5294)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

The Mozilla Updater can be made to choose an arbitrary target working directory for output files resulting from the update process. This vulnerability requires local system access.
*Note: this issue only affects Windows operating systems.*

##### References

* [Bug 1246972](https://bugzilla.mozilla.org/show_bug.cgi?id=1246972)

#### [#CVE-2016-5297: Incorrect argument length checking in JavaScript](#CVE-2016-5297)

Reporter
André Bargull
Impact
high
##### Description

An error in argument length checking in JavaScript, leading to potential integer overflows or other bounds checking issues.

##### References

* [Bug 1303678](https://bugzilla.mozilla.org/show_bug.cgi?id=1303678)

#### [#CVE-2016-9064: Add-ons update must verify IDs match between current and new versions](#CVE-2016-9064)

Reporter
Multiple people
Impact
high
##### Description

Add-on updates failed to verify that the add-on ID inside the signed package matched the ID of the add-on being updated. An attacker who could perform a man-in-the-middle attack on the user's connection to the update server and defeat the certificate pinning protection could provide a malicious signed add-on instead of a valid update.

##### References

* [Bug 1303418](https://bugzilla.mozilla.org/show_bug.cgi?id=1303418)

#### [#CVE-2016-9066: Integer overflow leading to a buffer overflow in nsScriptLoadHandler](#CVE-2016-9066)

Reporter
Samuel Groß
Impact
high
##### Description

A buffer overflow resulting in a potentially exploitable crash due to memory allocation issues when handling large amounts of incoming data.

##### References

* [Bug 1299686](https://bugzilla.mozilla.org/show_bug.cgi?id=1299686)

#### [#CVE-2016-5291: Same-origin policy violation using local HTML file and saved shortcut file](#CVE-2016-5291)

Reporter
Yuyang Zhou
Impact
moderate
##### Description

A same-origin policy bypass with local shortcut files to load arbitrary local content from disk.

##### References

* [Bug 1292159](https://bugzilla.mozilla.org/show_bug.cgi?id=1292159)

#### [#CVE-2016-9074: Insufficient timing side-channel resistance in divSpoiler](#CVE-2016-9074)

Reporter
Franziskus Kiefer
Impact
moderate
##### Description

An existing mitigation of timing side-channel attacks is insufficient in some circumstances. This issue is addressed in Network Security Services (NSS) 3.26.1.

##### References

* [Bug 1293334](https://bugzilla.mozilla.org/show_bug.cgi?id=1293334)

#### [#CVE-2016-5290: Memory safety bugs fixed in Firefox 50 and Firefox ESR 45.5](#CVE-2016-5290)

Reporter
Mozilla developers
Impact
critical
##### Description

Mozilla developers and community members Olli Pettay, Christian Holler, Ehsan Akhgari, Jon Coppeard, Gary Kwong, Tooru Fujisawa, Philipp, and Randell Jesup reported memory safety bugs present in Firefox 49 and Firefox ESR 45.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 50 and Firefox ESR 45.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1309720%2C1297062%2C1303710%2C1018486%2C1292590%2C1301343%2C1301496%2C1308048%2C1308346%2C1299519%2C1286911%2C1298169)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_8d85b83b_20250125_045732.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2016-93

## Security vulnerabilities fixed in Thunderbird 45.5

Announced
November 18, 2016
Impact
critical
Products
Thunderbird
Fixed in

* Thunderbird 45.5

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2016-5296: Heap-buffer-overflow WRITE in rasterize\_edges\_1](#CVE-2016-5296)

Reporter
Abhishek Arya
Impact
critical
##### Description

A heap-buffer-overflow in Cairo when processing SVG content caused by compiler optimization, resulting in a potentially exploitable crash.

##### References

* [Bug 1292443](https://bugzilla.mozilla.org/show_bug.cgi?id=1292443)

#### [#CVE-2016-5294: Arbitrary target directory for result files of update process](#CVE-2016-5294)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

The Mozilla Updater can be made to choose an arbitrary target working directory for output files resulting from the update process. This vulnerability requires local system access.
*Note: this issue only affects Windows operating systems.*

##### References

* [Bug 1246972](https://bugzilla.mozilla.org/show_bug.cgi?id=1246972)

#### [#CVE-2016-5297: Incorrect argument length checking in JavaScript](#CVE-2016-5297)

Reporter
André Bargull
Impact
high
##### Description

An error in argument length checking in JavaScript, leading to potential integer overflows or other bounds checking issues.

##### References

* [Bug 1303678](https://bugzilla.mozilla.org/show_bug.cgi?id=1303678)

#### [#CVE-2016-9066: Integer overflow leading to a buffer overflow in nsScriptLoadHandler](#CVE-2016-9066)

Reporter
Samuel Groß
Impact
high
##### Description

A buffer overflow resulting in a potentially exploitable crash due to memory allocation issues when handling large amounts of incoming data.

##### References

* [Bug 1299686](https://bugzilla.mozilla.org/show_bug.cgi?id=1299686)

#### [#CVE-2016-5291: Same-origin policy violation using local HTML file and saved shortcut file](#CVE-2016-5291)

Reporter
Yuyang Zhou
Impact
moderate
##### Description

A same-origin policy bypass with local shortcut files to load arbitrary local content from disk.

##### References

* [Bug 1292159](https://bugzilla.mozilla.org/show_bug.cgi?id=1292159)

#### [#CVE-2016-9074: Insufficient timing side-channel resistance in divSpoiler](#CVE-2016-9074)

Reporter
Franziskus Kiefer
Impact
moderate
##### Description

An existing mitigation of timing side-channel attacks is insufficient in some circumstances. This issue is addressed in Network Security Services (NSS) 3.26.1.

##### References

* [Bug 1293334](https://bugzilla.mozilla.org/show_bug.cgi?id=1293334)

#### [#CVE-2016-5290: Memory safety bugs fixed in Thunderbird 45.5](#CVE-2016-5290)

Reporter
Mozilla developers
Impact
critical
##### Description

Mozilla developers and community members Olli Pettay, Christian Holler, Ehsan Akhgari, Jon Coppeard, Gary Kwong, Tooru Fujisawa, Philipp, and Randell Jesup reported memory safety bugs present in Thunderbird ESR 45.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in in Thunderbird ESR 45.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1309720%2C1297062%2C1303710%2C1018486%2C1292590%2C1301343%2C1301496%2C1308048%2C1308346%2C1299519%2C1286911%2C1298169)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


