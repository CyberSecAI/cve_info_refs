=== Content from github.com_363ceb0d_20250125_013150.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fissues%2F3522)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fissues%2F3522)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=SimpleMachines%2FSMF)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SimpleMachines](/SimpleMachines)
/
**[SMF](/SimpleMachines/SMF)**
Public

* [Notifications](/login?return_to=%2FSimpleMachines%2FSMF) You must be signed in to change notification settings
* [Fork
  254](/login?return_to=%2FSimpleMachines%2FSMF)
* [Star
   614](/login?return_to=%2FSimpleMachines%2FSMF)

* [Code](/SimpleMachines/SMF)
* [Issues
  171](/SimpleMachines/SMF/issues)
* [Pull requests
  44](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects
  0](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

Additional navigation options

* [Code](/SimpleMachines/SMF)
* [Issues](/SimpleMachines/SMF/issues)
* [Pull requests](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

# Fix CVE-2016-5727 PHP Object Injection Vulnerability #3522

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Fix CVE-2016-5727 PHP Object Injection Vulnerability](#top)#3522Copy link[![@PrplHaz4](https://avatars.githubusercontent.com/u/841414?v=4&size=80)](/PrplHaz4)
## Description

[![@PrplHaz4](https://avatars.githubusercontent.com/u/841414?v=4&size=48)](/PrplHaz4)[PrplHaz4](https://github.com/PrplHaz4)opened [on Jul 12, 2016](https://github.com/SimpleMachines/SMF/issues/3522#issue-165102670)

[@paragonie-security](https://github.com/paragonie-security) can you verify whether or not this was fixed with this commit:

[19e560b#diff-513c4f9c501cbefcc14420c01848f23c](https://github.com/SimpleMachines/SMF/commit/19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008#diff-513c4f9c501cbefcc14420c01848f23c)

per <http://seclists.org/oss-sec/2016/q2/521>

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_7ec3dc13_20250125_013146.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2016/06/17/5) [[next>]](../../../2016/06/20/1) [[<thread-prev]](../../../2016/06/10/7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <20160618195224.BFA2A33201D@smtpvbsrv1.mitre.org>
Date: Sat, 18 Jun 2016 15:52:24 -0400 (EDT)
From: cve-assign@...re.org
To: scott@...agonie.com
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: Simple Machines Forums - PHP Object Injection

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

> The first one appears to have been fixed in the release-2.1 branch, but the
> other one still exists.

> <https://github.com/SimpleMachines/SMF2.1/blob/404fd5347951652624dfb72304ee38fcab98378f/Sources/Packages.php#L863-L873>

Use CVE-2016-5726.

> <https://github.com/SimpleMachines/SMF2.1/blob/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources/LogInOut.php#L125-L129>

Use CVE-2016-5727.

- --
CVE Assignment Team
M/S M300, 202 Burlington Road, Bedford, MA 01730 USA
[ A PGP key is available for encrypted communications at
  <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCAAGBQJXZaYTAAoJEHb/MwWLVhi2/+YP+wc2CtBwbz9Qs67YW8t1UXuS
wxH2Dw7r3VLuGmD5UJAZBYt4+7kGd8FdMijD4ZNT3EdfraEkD45u8sXmbx0P0y7E
qX178dTVoi3h7sJHlTOa5agRmGqS1uLbzWWxXSolAU8X6/FFO/7/cTOJBCVW0z02
R1GNIVuf8mJA0mgGZ3DDJy0RV/dnco3VO4LoRKy2uQHnz3XHWaKnZkrmkBmt+eGK
ZevSmz4OVVf6B/w8rx4BcAajdlGWS89epGZSeAPnZeTPeixQE7E6uOhRaGPif0h4
0JP4GsDbKNUjod7DnVEKkDV0bHxc2Z+SEQyBihahtvdSxwe2W0N5ZdMejHbw2f8f
kN+0EYIGbOdPJYAP0c35PKLyfhlDrUwF/iPNx2k+tTls1T8qX//gb8PuZoF0k2Ro
zO9MYrZTlM819fN1Y4oqpUsB1dhDgcPstQx8ptqI6KDVJP61KUgRv/ADga9cLulo
nYPDfcqd+swJUZxRnUgeJuwmsYDF8BZTUQJmR48wTiBCQEqrQN4PSyD11RZLcJUv
lUrKhv6zINxknlNMPyb72NMIcSfW1iMwc0SiuYNElY+pSliBrPyZ0jC8+Bhpt0QL
eFvKwmGRTnoWp6Ly7iK2nI8uwp5zS0bCKrjw7ZpVmh97vslA2iA+7yxohqNV7po5
mGc8to+TR4jrcCoFZy2E
=SRzi
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_0ff2182b_20250125_013145.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](8) [[thread-next>]](../../../2016/06/18/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAKws9z0qx_7spQTw9Z3vrV1hRa8so=G-1T7eegnLuMzTp0H59Q@mail.gmail.com>
Date: Fri, 10 Jun 2016 13:56:14 -0400
From: Scott Arciszewski <scott@...agonie.com>
To: oss-security@...ts.openwall.com
Subject: Simple Machines Forums - PHP Object Injection

I reported the following PHP Object Injection vulnerabilities to the SMF
development team on March 9, 2016:

<https://github.com/SimpleMachines/SMF2.1/blob/404fd5347951652624dfb72304ee38fcab98378f/Sources/Packages.php#L863-L873>

<https://github.com/SimpleMachines/SMF2.1/blob/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources/LogInOut.php#L125-L129>

In the first case, you can achieve PHP Object Injection by sending
themechanges[]=serialized+object+here in the POST data of an HTTP request.

It looks like someone had attempted to find+replace all the obvious PHP
Object Injection issues (i.e. unserialize($_POST['foo'])) at some point,
but they didn't look for variables directly derived from user input.
(foreach ($_POST['foo'] as $bar)).

I've sent follow-up emails to the development team but was never notified
of any progress towards fixing it.

The first one appears to have been fixed in the release-2.1 branch, but the
other one still exists.

<https://github.com/SimpleMachines/SMF2.1/blob/release-2.1/Sources/Packages.php#L872-L882>
is fixed

<https://github.com/SimpleMachines/SMF2.1/blob/release-2.1/Sources/LogInOut.php#L125-L129>
is unfixed

That's all from me.

Scott Arciszewski
Chief Development Officer
Paragon Initiative Enterprises <<https://paragonie.com>>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_5b150a37_20250125_013148.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fcommit%2F19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fcommit%2F19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=SimpleMachines%2FSMF)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SimpleMachines](/SimpleMachines)
/
**[SMF](/SimpleMachines/SMF)**
Public

* [Notifications](/login?return_to=%2FSimpleMachines%2FSMF) You must be signed in to change notification settings
* [Fork
  254](/login?return_to=%2FSimpleMachines%2FSMF)
* [Star
   614](/login?return_to=%2FSimpleMachines%2FSMF)

* [Code](/SimpleMachines/SMF)
* [Issues
  171](/SimpleMachines/SMF/issues)
* [Pull requests
  44](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects
  0](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

Additional navigation options

* [Code](/SimpleMachines/SMF)
* [Issues](/SimpleMachines/SMF/issues)
* [Pull requests](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

## Commit

[Permalink](/SimpleMachines/SMF/commit/19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Apply safe\_unserialize()

[Browse files](/SimpleMachines/SMF/tree/19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008)
Browse the repository at this point in the history

```
Signed-off-by: Jessica González <suki@missallsunday.com>
```

* Loading branch information

[![@MissAllSunday](https://avatars.githubusercontent.com/u/3420756?s=40&v=4)](/MissAllSunday)

[MissAllSunday](/SimpleMachines/SMF/commits?author=MissAllSunday "View all commits by MissAllSunday")
committed
Jun 12, 2016

1 parent
[3d25b81](/SimpleMachines/SMF/commit/3d25b8161a6a4ddd9cd32b0fb7bcee28b54149b5)

commit 19e560b

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**14 additions**
and
**14 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Sources

  + Sources/Calendar.php
    [Calendar.php](#diff-8694f864b2f395562ba41ce2b09cb1c4851096a2951b336c7b5888d3be03b0cc)
  + Sources/Load.php
    [Load.php](#diff-1cdd8480257c343b09f216bedb63a9a093b4b7813074e0dc309badc0c2b049f8)
  + Sources/LogInOut.php
    [LogInOut.php](#diff-d4aebe7554e2ec50288bce5838baf29adfff631c94a00a62a17be3025af3e2ad)
  + Sources/Subs-Auth.php
    [Subs-Auth.php](#diff-6e3776eece02987bf41d6ce487c383134e3214ce6c39b8e2b79109168cd3d00b)
  + Sources/Subs-Charset.php
    [Subs-Charset.php](#diff-8a2d92c139e2bc3db743326674f96f04e9a06dfa86fae3633bfafef631ebc394)
  + Sources/Subs-Menu.php
    [Subs-Menu.php](#diff-d9563eb0ffe80a38ba5967399471b90ac8a04cb73bab95bc5fb76759a8c94e7b)

## There are no files selected for viewing

6 changes: 3 additions & 3 deletions

6
[Sources/Calendar.php](#diff-8694f864b2f395562ba41ce2b09cb1c4851096a2951b336c7b5888d3be03b0cc "Sources/Calendar.php")

Show comments

[View file](/SimpleMachines/SMF/blob/19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008/Sources/Calendar.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -500,19 +500,19 @@ function clock() |
|  |  | { |
|  |  | $context['sub\_template'] = 'bcd'; |
|  |  | $context['linktree'][] = array('url' => $scripturl . '?action=clock;bcd', 'name' => 'BCD'); |
|  |  | $context['clockicons'] = unserialize(base64\_decode('YTo2OntzOjI6ImgxIjthOjI6e2k6MDtpOjI7aToxO2k6MTt9czoyOiJoMiI7YTo0OntpOjA7aTo4O2k6MTtpOjQ7aToyO2k6MjtpOjM7aToxO31zOjI6Im0xIjthOjM6e2k6MDtpOjQ7aToxO2k6MjtpOjI7aToxO31zOjI6Im0yIjthOjQ6e2k6MDtpOjg7aToxO2k6NDtpOjI7aToyO2k6MztpOjE7fXM6MjoiczEiO2E6Mzp7aTowO2k6NDtpOjE7aToyO2k6MjtpOjE7fXM6MjoiczIiO2E6NDp7aTowO2k6ODtpOjE7aTo0O2k6MjtpOjI7aTozO2k6MTt9fQ==')); |
|  |  | $context['clockicons'] = safe\_unserialize(base64\_decode('YTo2OntzOjI6ImgxIjthOjI6e2k6MDtpOjI7aToxO2k6MTt9czoyOiJoMiI7YTo0OntpOjA7aTo4O2k6MTtpOjQ7aToyO2k6MjtpOjM7aToxO31zOjI6Im0xIjthOjM6e2k6MDtpOjQ7aToxO2k6MjtpOjI7aToxO31zOjI6Im0yIjthOjQ6e2k6MDtpOjg7aToxO2k6NDtpOjI7aToyO2k6MztpOjE7fXM6MjoiczEiO2E6Mzp7aTowO2k6NDtpOjE7aToyO2k6MjtpOjE7fXM6MjoiczIiO2E6NDp7aTowO2k6ODtpOjE7aTo0O2k6MjtpOjI7aTozO2k6MTt9fQ==')); |
|  |  | } |
|  |  | elseif (!$omfg && !isset($\_REQUEST['time'])) |
|  |  | { |
|  |  | $context['sub\_template'] = 'hms'; |
|  |  | $context['linktree'][] = array('url' => $scripturl . '?action=clock', 'name' => 'Binary'); |
|  |  | $context['clockicons'] = unserialize(base64\_decode('YTozOntzOjE6ImgiO2E6NTp7aTowO2k6MTY7aToxO2k6ODtpOjI7aTo0O2k6MztpOjI7aTo0O2k6MTt9czoxOiJtIjthOjY6e2k6MDtpOjMyO2k6MTtpOjE2O2k6MjtpOjg7aTozO2k6NDtpOjQ7aToyO2k6NTtpOjE7fXM6MToicyI7YTo2OntpOjA7aTozMjtpOjE7aToxNjtpOjI7aTo4O2k6MztpOjQ7aTo0O2k6MjtpOjU7aToxO319')); |
|  |  | $context['clockicons'] = safe\_unserialize(base64\_decode('YTozOntzOjE6ImgiO2E6NTp7aTowO2k6MTY7aToxO2k6ODtpOjI7aTo0O2k6MztpOjI7aTo0O2k6MTt9czoxOiJtIjthOjY6e2k6MDtpOjMyO2k6MTtpOjE2O2k6MjtpOjg7aTozO2k6NDtpOjQ7aToyO2k6NTtpOjE7fXM6MToicyI7YTo2OntpOjA7aTozMjtpOjE7aToxNjtpOjI7aTo4O2k6MztpOjQ7aTo0O2k6MjtpOjU7aToxO319')); |
|  |  | } |
|  |  | elseif ($omfg) |
|  |  | { |
|  |  | $context['sub\_template'] = 'omfg'; |
|  |  | $context['linktree'][] = array('url' => $scripturl . '?action=clock;omfg', 'name' => 'OMFG'); |
|  |  | $context['clockicons'] = unserialize(base64\_decode('YTo2OntzOjQ6InllYXIiO2E6Nzp7aTowO2k6NjQ7aToxO2k6MzI7aToyO2k6MTY7aTozO2k6ODtpOjQ7aTo0O2k6NTtpOjI7aTo2O2k6MTt9czo1OiJtb250aCI7YTo0OntpOjA7aTo4O2k6MTtpOjQ7aToyO2k6MjtpOjM7aToxO31zOjM6ImRheSI7YTo1OntpOjA7aToxNjtpOjE7aTo4O2k6MjtpOjQ7aTozO2k6MjtpOjQ7aToxO31zOjQ6ImhvdXIiO2E6NTp7aTowO2k6MTY7aToxO2k6ODtpOjI7aTo0O2k6MztpOjI7aTo0O2k6MTt9czozOiJtaW4iO2E6Njp7aTowO2k6MzI7aToxO2k6MTY7aToyO2k6ODtpOjM7aTo0O2k6NDtpOjI7aTo1O2k6MTt9czozOiJzZWMiO2E6Njp7aTowO2k6MzI7aToxO2k6MTY7aToyO2k6ODtpOjM7aTo0O2k6NDtpOjI7aTo1O2k6MTt9fQ==')); |
|  |  | $context['clockicons'] = safe\_unserialize(base64\_decode('YTo2OntzOjQ6InllYXIiO2E6Nzp7aTowO2k6NjQ7aToxO2k6MzI7aToyO2k6MTY7aTozO2k6ODtpOjQ7aTo0O2k6NTtpOjI7aTo2O2k6MTt9czo1OiJtb250aCI7YTo0OntpOjA7aTo4O2k6MTtpOjQ7aToyO2k6MjtpOjM7aToxO31zOjM6ImRheSI7YTo1OntpOjA7aToxNjtpOjE7aTo4O2k6MjtpOjQ7aTozO2k6MjtpOjQ7aToxO31zOjQ6ImhvdXIiO2E6NTp7aTowO2k6MTY7aToxO2k6ODtpOjI7aTo0O2k6MztpOjI7aTo0O2k6MTt9czozOiJtaW4iO2E6Njp7aTowO2k6MzI7aToxO2k6MTY7aToyO2k6ODtpOjM7aTo0O2k6NDtpOjI7aTo1O2k6MTt9czozOiJzZWMiO2E6Njp7aTowO2k6MzI7aToxO2k6MTY7aToyO2k6ODtpOjM7aTo0O2k6NDtpOjI7aTo1O2k6MTt9fQ==')); |
|  |  | } |
|  |  | elseif (isset($\_REQUEST['time'])) |
|  |  | { |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Sources/Load.php](#diff-1cdd8480257c343b09f216bedb63a9a093b4b7813074e0dc309badc0c2b049f8 "Sources/Load.php")

Show comments

[View file](/SimpleMachines/SMF/blob/19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008/Sources/Load.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -381,7 +381,7 @@ function loadUserSettings() |
|  |  | $cookie\_data = smf\_json\_decode($\_COOKIE[$cookiename], true); |
|  |  |  |
|  |  | if (is\_null($cookie\_data)) |
|  |  | $cookie\_data = @unserialize($\_COOKIE[$cookiename]); |
|  |  | $cookie\_data = safe\_unserialize($\_COOKIE[$cookiename]); |
|  |  |  |
|  |  | list ($id\_member, $password) = $cookie\_data; |
|  |  | $id\_member = !empty($id\_member) && strlen($password) > 0 ? (int) $id\_member : 0; |
| Expand All | | @@ -392,7 +392,7 @@ function loadUserSettings() |
|  |  | $cookie\_data = smf\_json\_decode($\_SESSION['login\_' . $cookiename]); |
|  |  |  |
|  |  | if (is\_null($cookie\_data)) |
|  |  | $cookie\_data = @unserialize($\_SESSION['login\_' . $cookiename]); |
|  |  | $cookie\_data = safe\_unserialize($\_SESSION['login\_' . $cookiename]); |
|  |  |  |
|  |  | list ($id\_member, $password, $login\_span) = $cookie\_data; |
|  |  | $id\_member = !empty($id\_member) && strlen($password) == 128 && $login\_span > time() ? (int) $id\_member : 0; |
| Expand Down  Expand Up | | @@ -463,7 +463,7 @@ function loadUserSettings() |
|  |  | $tfa\_data = smf\_json\_decode($\_COOKIE[$tfacookie]); |
|  |  |  |
|  |  | if (is\_null($tfa\_data)) |
|  |  | $tfa\_data = @unserialize($\_COOKIE[$tfacookie]); |
|  |  | $tfa\_data = safe\_unserialize($\_COOKIE[$tfacookie]); |
|  |  |  |
|  |  | list ($tfamember, $tfasecret) = $tfa\_data; |
|  |  |  |
| Expand Down  Expand Up | | @@ -620,7 +620,7 @@ function loadUserSettings() |
|  |  | $tfa\_data = smf\_json\_decode($\_COOKIE[$cookiename . '\_tfa'], true); |
|  |  |  |
|  |  | if (is\_null($tfa\_data)) |
|  |  | $tfa\_data = @unserialize($\_COOKIE[$cookiename . '\_tfa']); |
|  |  | $tfa\_data = safe\_unserialize($\_COOKIE[$cookiename . '\_tfa']); |
|  |  |  |
|  |  | list ($id, $user, $exp, $state, $preserve) = $tfa\_data; |
|  |  |  |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[Sources/LogInOut.php](#diff-d4aebe7554e2ec50288bce5838baf29adfff631c94a00a62a17be3025af3e2ad "Sources/LogInOut.php")

Show comments

[View file](/SimpleMachines/SMF/blob/19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008/Sources/LogInOut.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -103,15 +103,15 @@ function Login2() |
|  |  |  |
|  |  | // That didn't work... Maybe it's using serialize? |
|  |  | if (is\_null($timeout)) |
|  |  | list (, , $timeout) = @unserialize($\_COOKIE[$cookiename]); |
|  |  | list (, , $timeout) = safe\_unserialize($\_COOKIE[$cookiename]); |
|  |  | } |
|  |  | elseif (isset($\_SESSION['login\_' . $cookiename])) |
|  |  | { |
|  |  | list (, , $timeout) = smf\_json\_decode($\_SESSION['login\_' . $cookiename]); |
|  |  |  |
|  |  | // Try for old format |
|  |  | if (is\_null($timeout)) |
|  |  | list (, , $timeout) = @unserialize($\_SESSION['login\_' . $cookiename]); |
|  |  | list (, , $timeout) = safe\_unserialize($\_SESSION['login\_' . $cookiename]); |
|  |  | } |
|  |  | else |
|  |  | trigger\_error('Login2(): Cannot be logged in without a session or cookie', E\_USER\_ERROR); |
| Expand All | | @@ -126,7 +126,7 @@ function Login2() |
|  |  |  |
|  |  | // If that didn't work, try unserialize instead... |
|  |  | if (is\_null($tfadata)) |
|  |  | $tfadata = @unserialize($\_COOKIE[$cookiename . '\_tfa']); |
|  |  | $tfadata = safe\_unserialize($\_COOKIE[$cookiename . '\_tfa']); |
|  |  |  |
|  |  | list ($tfamember, $tfasecret, $exp, $state, $preserve) = $tfadata; |
|  |  |  |
| Expand Down  Expand Up | | @@ -689,7 +689,7 @@ function Logout($internal = false, $redirect = true) |
|  |  |  |
|  |  | // If that failed, try the old method |
|  |  | if (is\_null($tfadata)) |
|  |  | $tfadata = @unserialize($\_COOKIE[$cookiename . '\_tfa']); |
|  |  | $tfadata = safe\_unserialize($\_COOKIE[$cookiename . '\_tfa']); |
|  |  |  |
|  |  | list ($tfamember, $tfasecret, $exp, $state, $preserve) = $tfadata; |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[Sources/Subs-Auth.php](#diff-6e3776eece02987bf41d6ce487c383134e3214ce6c39b8e2b79109168cd3d00b "Sources/Subs-Auth.php")

Show comments

[View file](/SimpleMachines/SMF/blob/19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008/Sources/Subs-Auth.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,7 +44,7 @@ function setLoginCookie($cookie\_length, $id, $password = '') |
|  |  |  |
|  |  | // Legacy format |
|  |  | if (is\_null($array)) |
|  |  | $array = @unserialize($\_COOKIE[$cookiename]); |
|  |  | $array = safe\_unserialize($\_COOKIE[$cookiename]); |
|  |  |  |
|  |  | // Out with the old, in with the new! |
|  |  | if (isset($array[3]) && $array[3] != $cookie\_state) |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[Sources/Subs-Charset.php](#diff-8a2d92c139e2bc3db743326674f96f04e9a06dfa86fae3633bfafef631ebc394 "Sources/Subs-Charset.php")

Show comments

[View file](/SimpleMachines/SMF/blob/19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008/Sources/Subs-Charset.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -569,7 +569,7 @@ function fix\_serialized\_columns() |
|  |  | ); |
|  |  | while ($row = $smcFunc['db\_fetch\_assoc']($request)) |
|  |  | { |
|  |  | if (@unserialize($row['extra']) === false && preg\_match('~^(a:3:{s:5:"topic";i:\d+;s:7:"subject";s:)(\d+):"(.+)"(;s:6:"member";s:5:"\d+";})$~', $row['extra'], $matches) === 1) |
|  |  | if (safe\_unserialize($row['extra']) === false && preg\_match('~^(a:3:{s:5:"topic";i:\d+;s:7:"subject";s:)(\d+):"(.+)"(;s:6:"member";s:5:"\d+";})$~', $row['extra'], $matches) === 1) |
|  |  | $smcFunc['db\_query']('', ' |
|  |  | UPDATE {db\_prefix}log\_actions |
|  |  | SET extra = {string:extra} |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[Sources/Subs-Menu.php](#diff-d9563eb0ffe80a38ba5967399471b90ac8a04cb73bab95bc5fb76759a8c94e7b "Sources/Subs-Menu.php")

Show comments

[View file](/SimpleMachines/SMF/blob/19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008/Sources/Subs-Menu.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -122,7 +122,7 @@ function createMenu($menuData, $menuOptions = array()) |
|  |  |  |
|  |  | // Does this area have its own icon? |
|  |  | if (!isset($area['force\_menu\_into\_arms\_of\_another\_menu']) && $user\_info['name'] == 'iamanoompaloompa') |
|  |  | $menu\_context['sections'][$section\_id]['areas'][$area\_id] = unserialize(base64\_decode('YTozOntzOjU6ImxhYmVsIjtzOjEyOiJPb21wYSBMb29tcGEiO3M6MzoidXJsIjtzOjQzOiJodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL09vbXBhX0xvb21wYXM/IjtzOjQ6Imljb24iO3M6ODY6IjxpbWcgc3JjPSJodHRwOi8vd3d3LnNpbXBsZW1hY2hpbmVzLm9yZy9pbWFnZXMvb29tcGEuZ2lmIiBhbHQ9IkknbSBhbiBPb21wYSBMb29tcGEiIC8+Ijt9')); |
|  |  | $menu\_context['sections'][$section\_id]['areas'][$area\_id] = safe\_unserialize(base64\_decode('YTozOntzOjU6ImxhYmVsIjtzOjEyOiJPb21wYSBMb29tcGEiO3M6MzoidXJsIjtzOjQzOiJodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL09vbXBhX0xvb21wYXM/IjtzOjQ6Imljb24iO3M6ODY6IjxpbWcgc3JjPSJodHRwOi8vd3d3LnNpbXBsZW1hY2hpbmVzLm9yZy9pbWFnZXMvb29tcGEuZ2lmIiBhbHQ9IkknbSBhbiBPb21wYSBMb29tcGEiIC8+Ijt9')); |
|  |  | elseif (isset($area['icon']) && file\_exists($settings['theme\_dir'] . '/images/admin/' . $area['icon'])) |
|  |  | $menu\_context['sections'][$section\_id]['areas'][$area\_id]['icon'] = '<img src="' . $settings['images\_url'] . '/admin/' . $area['icon'] . '" alt="">'; |
|  |  | elseif (isset($area['icon']) && file\_exists($settings['default\_theme\_dir'] . '/images/admin/' . $area['icon'])) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `19e560b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fcommit%2F19e560b9f3e8fc6d7d9d60c1ff617b5ed5c08008) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_414fc67a_20250126_050435.html ===
�PNG

   
IHDR  �  �   �.�b  �IDATx��ֱm�0�8P�1]h$��H��&��{��m����}� 0�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� ۴�����4���z-�������H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A��nc�� ��e$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� ۴�����4���z-�������H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A쀄m���v\�� ������H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A����>�~���J�u���z��\v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�� b$�� v@�m��z�۹���H; A���H; A���H; A���H; A���H; A���H; A���H; A���H; A쀄�   �����e��?    IEND�B`�

=== Content from github.com_a5e0ddd1_20250126_050438.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fblob%2F19ee85ff8761b792ea3e9ed630a947f45f93ee68%2FSources%2FLogInOut.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSimpleMachines%2FSMF%2Fblob%2F19ee85ff8761b792ea3e9ed630a947f45f93ee68%2FSources%2FLogInOut.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=SimpleMachines%2FSMF)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SimpleMachines](/SimpleMachines)
/
**[SMF](/SimpleMachines/SMF)**
Public

* [Notifications](/login?return_to=%2FSimpleMachines%2FSMF) You must be signed in to change notification settings
* [Fork
  255](/login?return_to=%2FSimpleMachines%2FSMF)
* [Star
   615](/login?return_to=%2FSimpleMachines%2FSMF)

* [Code](/SimpleMachines/SMF)
* [Issues
  171](/SimpleMachines/SMF/issues)
* [Pull requests
  44](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects
  0](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

Additional navigation options

* [Code](/SimpleMachines/SMF)
* [Issues](/SimpleMachines/SMF/issues)
* [Pull requests](/SimpleMachines/SMF/pulls)
* [Actions](/SimpleMachines/SMF/actions)
* [Projects](/SimpleMachines/SMF/projects)
* [Wiki](/SimpleMachines/SMF/wiki)
* [Security](/SimpleMachines/SMF/security)
* [Insights](/SimpleMachines/SMF/pulse)

## Files

 19ee85f
## Breadcrumbs

1. [SMF](/SimpleMachines/SMF/tree/19ee85ff8761b792ea3e9ed630a947f45f93ee68)
2. /[Sources](/SimpleMachines/SMF/tree/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources)
/
# LogInOut.php

Copy path Blame  Blame
## Latest commit

## History

[History](/SimpleMachines/SMF/commits/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources/LogInOut.php)863 lines (716 loc) · 30.6 KB 19ee85f
## Breadcrumbs

1. [SMF](/SimpleMachines/SMF/tree/19ee85ff8761b792ea3e9ed630a947f45f93ee68)
2. /[Sources](/SimpleMachines/SMF/tree/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources)
/
# LogInOut.php

Top
## File metadata and controls

* Code
* Blame

863 lines (716 loc) · 30.6 KB[Raw](https://github.com/SimpleMachines/SMF/raw/19ee85ff8761b792ea3e9ed630a947f45f93ee68/Sources/LogInOut.php)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863<?php
/\*\* \* This file is concerned pretty entirely, as you see from its name, with \* logging in and out members, and the validation of that. \* \* Simple Machines Forum (SMF) \* \* @package SMF \* @author Simple Machines http://www.simplemachines.org \* @copyright 2016 Simple Machines and individual contributors \* @license http://www.simplemachines.org/about/smf/license.php BSD \* \* @version 2.1 Beta 3 \*/
if (!defined('SMF')) die('No direct access...');
/\*\* \* Ask them for their login information. (shows a page for the user to type \* in their username and password.) \* It caches the referring URL in $\_SESSION['login\_url']. \* It is accessed from ?action=login. \* @uses Login template and language file with the login sub-template. \*/function Login(){ global $txt, $context, $scripturl, $user\_info;
 // You are already logged in, go take a tour of the boards if (!empty($user\_info['id'])) redirectexit();
 // We need to load the Login template/language file. loadLanguage('Login'); loadTemplate('Login');
 $context['sub\_template'] = 'login';
 if (!empty($\_SERVER['HTTP\_X\_REQUESTED\_WITH']) && $\_SERVER['HTTP\_X\_REQUESTED\_WITH'] == 'XMLHttpRequest') { $context['from\_ajax'] = true; $context['template\_layers'] = array(); }
 // Get the template ready.... not really much else to do. $context['page\_title'] = $txt['login']; $context['default\_username'] = &$\_REQUEST['u']; $context['default\_password'] = ''; $context['never\_expire'] = false;
 // Add the login chain to the link tree. $context['linktree'][] = array( 'url' => $scripturl . '?action=login', 'name' => $txt['login'], );
 // Set the login URL - will be used when the login process is done (but careful not to send us to an attachment). if (isset($\_SESSION['old\_url']) && strpos($\_SESSION['old\_url'], 'dlattach') === false && preg\_match('~(board|topic)[=,]~', $\_SESSION['old\_url']) != 0) $\_SESSION['login\_url'] = $\_SESSION['old\_url']; elseif (isset($\_SESSION['login\_url']) && strpos($\_SESSION['login\_url'], 'dlattach') !== false) unset($\_SESSION['login\_url']);
 // Create a one time token. createToken('login');}
/\*\* \* Actually logs you in. \* What it does: \* - checks credentials and checks that login was successful. \* - it employs protection against a specific IP or user trying to brute force \* a login to an account. \* - upgrades password encryption on login, if necessary. \* - after successful login, redirects you to $\_SESSION['login\_url']. \* - accessed from ?action=login2, by forms. \* On error, uses the same templates Login() uses. \*/function Login2(){ global $txt, $scripturl, $user\_info, $user\_settings, $smcFunc; global $cookiename, $modSettings, $context, $sourcedir, $maintenance;
 // Check to ensure we're forcing SSL for authentication if (!empty($modSettings['force\_ssl']) && empty($maintenance) && (!isset($\_SERVER['HTTPS']) || $\_SERVER['HTTPS'] != 'on')) fatal\_lang\_error('login\_ssl\_required');
 // Load cookie authentication stuff. require\_once($sourcedir . '/Subs-Auth.php');
 if (!empty($\_SERVER['HTTP\_X\_REQUESTED\_WITH']) && $\_SERVER['HTTP\_X\_REQUESTED\_WITH'] == 'XMLHttpRequest') { $context['from\_ajax'] = true; $context['template\_layers'] = array(); }
 if (isset($\_GET['sa']) && $\_GET['sa'] == 'salt' && !$user\_info['is\_guest']) { if (isset($\_COOKIE[$cookiename]) && preg\_match('~^a:[34]:\{i:0;i:\d{1,7};i:1;s:(0|128):"([a-fA-F0-9]{128})?";i:2;[id]:\d{1,14};(i:3;i:\d;)?\}$~', $\_COOKIE[$cookiename]) === 1) { list (, , $timeout) = json\_decode($\_COOKIE[$cookiename], true);
 // That didn't work... Maybe it's using serialize? if (is\_null($timeout)) list (, , $timeout) = @unserialize($\_COOKIE[$cookiename]); } elseif (isset($\_SESSION['login\_' . $cookiename])) { list (, , $timeout) = json\_decode($\_SESSION['login\_' . $cookiename]);
 // Try for old format if (is\_null($timeout)) list (, , $timeout) = @unserialize($\_SESSION['login\_' . $cookiename]); } else trigger\_error('Login2(): Cannot be logged in without a session or cookie', E\_USER\_ERROR);
 $user\_settings['password\_salt'] = substr(md5(mt\_rand()), 0, 4); updateMemberData($user\_info['id'], array('password\_salt' => $user\_settings['password\_salt']));
 // Preserve the 2FA cookie? if (!empty($modSettings['tfa\_mode']) && !empty($\_COOKIE[$cookiename . '\_tfa'])) { $tfadata = json\_decode($\_COOKIE[$cookiename . '\_tfa'], true);
 // If that didn't work, try unserialize instead... if (is\_null($tfadata)) $tfadata = @unserialize($\_COOKIE[$cookiename . '\_tfa']);
 list ($tfamember, $tfasecret, $exp, $state, $preserve) = $tfadata;
 // If we're preserving the cookie, reset it with updated salt if ($preserve && time() < $exp) setTFACookie(3153600, $user\_info['password\_salt'], hash\_salt($user\_settings['tfa\_backup'], $user\_settings['password\_salt']), true); else setTFACookie(-3600, 0, ''); }
 setLoginCookie($timeout - time(), $user\_info['id'], hash\_salt($user\_settings['passwd'], $user\_settings['password\_salt']));
 redirectexit('action=login2;sa=check;member=' . $user\_info['id'], $context['server']['needs\_login\_fix']); } // Double check the cookie... elseif (isset($\_GET['sa']) && $\_GET['sa'] == 'check') { // Strike! You're outta there! if ($\_GET['member'] != $user\_info['id']) fatal\_lang\_error('login\_cookie\_error', false);
 $user\_info['can\_mod'] = allowedTo('access\_mod\_center') || (!$user\_info['is\_guest'] && ($user\_info['mod\_cache']['gq'] != '0=1' || $user\_info['mod\_cache']['bq'] != '0=1' || ($modSettings['postmod\_active'] && !empty($user\_info['mod\_cache']['ap']))));
 // Some whitelisting for login\_url... if (empty($\_SESSION['login\_url'])) redirectexit(empty($user\_settings['tfa\_secret']) ? '' : 'action=logintfa'); elseif (!empty($\_SESSION['login\_url']) && (strpos($\_SESSION['login\_url'], 'http://') === false && strpos($\_SESSION['login\_url'], 'https://') === false)) { unset ($\_SESSION['login\_url']); redirectexit(empty($user\_settings['tfa\_secret']) ? '' : 'action=logintfa'); } else { // Best not to clutter the session data too much... $temp = $\_SESSION['login\_url']; unset($\_SESSION['login\_url']);
 redirectexit($temp); } }
 // Beyond this point you are assumed to be a guest trying to login. if (!$user\_info['is\_guest']) redirectexit();
 // Are you guessing with a script? checkSession(); $tk = validateToken('login'); spamProtection('login');
 // Set the login\_url if it's not already set (but careful not to send us to an attachment). if ((empty($\_SESSION['login\_url']) && isset($\_SESSION['old\_url']) && strpos($\_SESSION['old\_url'], 'dlattach') === false && preg\_match('~(board|topic)[=,]~', $\_SESSION['old\_url']) != 0) || (isset($\_GET['quicklogin']) && isset($\_SESSION['old\_url']) && strpos($\_SESSION['old\_url'], 'login') === false)) $\_SESSION['login\_url'] = $\_SESSION['old\_url'];
 // Been guessing a lot, haven't we? if (isset($\_SESSION['failed\_login']) && $\_SESSION['failed\_login'] >= $modSettings['failed\_login\_threshold'] \* 3) fatal\_lang\_error('login\_threshold\_fail', 'critical');
 // Set up the cookie length. (if it's invalid, just fall through and use the default.) if (isset($\_POST['cookieneverexp']) || (!empty($\_POST['cookielength']) && $\_POST['cookielength'] == -1)) $modSettings['cookieTime'] = 3153600; elseif (!empty($\_POST['cookielength']) && ($\_POST['cookielength'] >= 1 && $\_POST['cookielength'] <= 525600)) $modSettings['cookieTime'] = (int) $\_POST['cookielength'];
 loadLanguage('Login'); // Load the template stuff. loadTemplate('Login'); $context['sub\_template'] = 'login';
 // Set up the default/fallback stuff. $context['default\_username'] = isset($\_POST['user']) ? preg\_replace('~&amp;#(\\d{1,7}|x[0-9a-fA-F]{1,6});~', '&#\\1;', $smcFunc['htmlspecialchars']($\_POST['user'])) : ''; $context['default\_password'] = ''; $context['never\_expire'] = $modSettings['cookieTime'] == 525600 || $modSettings['cookieTime'] == 3153600; $context['login\_errors'] = array($txt['error\_occured']); $context['page\_title'] = $txt['login'];
 // Add the login chain to the link tree. $context['linktree'][] = array( 'url' => $scripturl . '?action=login', 'name' => $txt['login'], );
 // You forgot to type your username, dummy! if (!isset($\_POST['user']) || $\_POST['user'] == '') { $context['login\_errors'] = array($txt['need\_username']); return; }
 // Hmm... maybe 'admin' will login with no password. Uhh... NO! if (!isset($\_POST['passwrd']) || $\_POST['passwrd'] == '') { $context['login\_errors'] = array($txt['no\_password']); return; }
 // No funky symbols either. if (preg\_match('~[<>&"\'=\\\]~', preg\_replace('~(&#(\\d{1,7}|x[0-9a-fA-F]{1,6});)~', '', $\_POST['user'])) != 0) { $context['login\_errors'] = array($txt['error\_invalid\_characters\_username']); return; }
 // And if it's too long, trim it back. if ($smcFunc['strlen']($\_POST['user']) > 80) { $\_POST['user'] = $smcFunc['substr']($\_POST['user'], 0, 79); $context['default\_username'] = preg\_replace('~&amp;#(\\d{1,7}|x[0-9a-fA-F]{1,6});~', '&#\\1;', $smcFunc['htmlspecialchars']($\_POST['user'])); }
 // Load the data up! $request = $smcFunc['db\_query']('', ' SELECT passwd, id\_member, id\_group, lngfile, is\_activated, email\_address, additional\_groups, member\_name, password\_salt, passwd\_flood, tfa\_secret FROM {db\_prefix}members WHERE ' . ($smcFunc['db\_case\_sensitive'] ? 'LOWER(member\_name) = LOWER({string:user\_name})' : 'member\_name = {string:user\_name}') . ' LIMIT 1', array( 'user\_name' => $smcFunc['db\_case\_sensitive'] ? strtolower($\_POST['user']) : $\_POST['user'], ) ); // Probably mistyped or their email, try it as an email address. (member\_name first, though!) if ($smcFunc['db\_num\_rows']($request) == 0 && strpos($\_POST['user'], '@') !== false) { $smcFunc['db\_free\_result']($request);
 $request = $smcFunc['db\_query']('', ' SELECT passwd, id\_member, id\_group, lngfile, is\_activated, email\_address, additional\_groups, member\_name, password\_salt, passwd\_flood, tfa\_secret FROM {db\_prefix}members WHERE email\_address = {string:user\_name} LIMIT 1', array( 'user\_name' => $\_POST['user'], ) ); }
 // Let them try again, it didn't match anything... if ($smcFunc['db\_num\_rows']($request) == 0) { $context['login\_errors'] = array($txt['username\_no\_exist']); return; }
 $user\_settings = $smcFunc['db\_fetch\_assoc']($request); $smcFunc['db\_free\_result']($request);
 // Bad password! Thought you could fool the database?! if (!hash\_verify\_password($user\_settings['member\_name'], un\_htmlspecialchars($\_POST['passwrd']), $user\_settings['passwd'])) { // Let's be cautious, no hacking please. thanx. validatePasswordFlood($user\_settings['id\_member'], $user\_settings['passwd\_flood']);
 // Maybe we were too hasty... let's try some other authentication methods. $other\_passwords = array();
 // None of the below cases will be used most of the time (because the salt is normally set.) if (!empty($modSettings['enable\_password\_conversion']) && $user\_settings['password\_salt'] == '') { // YaBB SE, Discus, MD5 (used a lot), SHA-1 (used some), SMF 1.0.x, IkonBoard, and none at all. $other\_passwords[] = crypt($\_POST['passwrd'], substr($\_POST['passwrd'], 0, 2)); $other\_passwords[] = crypt($\_POST['passwrd'], substr($user\_settings['passwd'], 0, 2)); $other\_passwords[] = md5($\_POST['passwrd']); $other\_passwords[] = sha1($\_POST['passwrd']); $other\_passwords[] = md5\_hmac($\_POST['passwrd'], strtolower($user\_settings['member\_name'])); $other\_passwords[] = md5($\_POST['passwrd'] . strtolower($user\_settings['member\_name'])); $other\_passwords[] = md5(md5($\_POST['passwrd'])); $other\_passwords[] = $\_POST['passwrd'];
 // This one is a strange one... MyPHP, crypt() on the MD5 hash. $other\_passwords[] = crypt(md5($\_POST['passwrd']), md5($\_POST['passwrd']));
 // Snitz style - SHA-256. Technically, this is a downgrade, but most PHP configurations don't support sha256 anyway. if (strlen($user\_settings['passwd']) == 64 && function\_exists('mhash') && defined('MHASH\_SHA256')) $other\_passwords[] = bin2hex(mhash(MHASH\_SHA256, $\_POST['passwrd']));
 // phpBB3 users new hashing. We now support it as well ;). $other\_passwords[] = phpBB3\_password\_check($\_POST['passwrd'], $user\_settings['passwd']);
 // APBoard 2 Login Method. $other\_passwords[] = md5(crypt($\_POST['passwrd'], 'CRYPT\_MD5')); } // The hash should be 40 if it's SHA-1, so we're safe with more here too. elseif (!empty($modSettings['enable\_password\_conversion']) && strlen($user\_settings['passwd']) == 32) { // vBulletin 3 style hashing? Let's welcome them with open arms \o/. $other\_passwords[] = md5(md5($\_POST['passwrd']) . stripslashes($user\_settings['password\_salt']));
 // Hmm.. p'raps it's Invision 2 style? $other\_passwords[] = md5(md5($user\_settings['password\_salt']) . md5($\_POST['passwrd']));
 // Some common md5 ones. $other\_passwords[] = md5($user\_settings['password\_salt'] . $\_POST['passwrd']); $other\_passwords[] = md5($\_POST['passwrd'] . $user\_settings['password\_salt']); } elseif (strlen($user\_settings['passwd']) == 40) { // Maybe they are using a hash from before the password fix. // This is also valid for SMF 1.1 to 2.0 style of hashing, changed to bcrypt in SMF 2.1 $other\_passwords[] = sha1(strtolower($user\_settings['member\_name']) . un\_htmlspecialchars($\_POST['passwrd']));
 // BurningBoard3 style of hashing. if (!empty($modSettings['enable\_password\_conversion'])) $other\_passwords[] = sha1($user\_settings['password\_salt'] . sha1($user\_settings['password\_salt'] . sha1($\_POST['passwrd'])));
 // Perhaps we converted to UTF-8 and have a valid password being hashed differently. if ($context['character\_set'] == 'utf8' && !empty($modSettings['previousCharacterSet']) && $modSettings['previousCharacterSet'] != 'utf8') { // Try iconv first, for no particular reason. if (function\_exists('iconv')) $other\_passwords['iconv'] = sha1(strtolower(iconv('UTF-8', $modSettings['previousCharacterSet'], $user\_settings['member\_name'])) . un\_htmlspecialchars(iconv('UTF-8', $modSettings['previousCharacterSet'], $\_POST['passwrd'])));
 // Say it aint so, iconv failed! if (empty($other\_passwords['iconv']) && function\_exists('mb\_convert\_encoding')) $other\_passwords[] = sha1(strtolower(mb\_convert\_encoding($user\_settings['member\_name'], 'UTF-8', $modSettings['previousCharacterSet'])) . un\_htmlspecialchars(mb\_convert\_encoding($\_POST['passwrd'], 'UTF-8', $modSettings['previousCharacterSet']))); } }
 // SMF's sha1 function can give a funny result on Linux (Not our fault!). If we've now got the real one let the old one be valid! if (stripos(PHP\_OS, 'win') !== 0 && strlen($user\_settings['passwd']) < hash\_length()) { require\_once($sourcedir . '/Subs-Compat.php'); $other\_passwords[] = sha1\_smf(strtolower($user\_settings['member\_name']) . un\_htmlspecialchars($\_POST['passwrd'])); }
 // Allows mods to easily extend the $other\_passwords array call\_integration\_hook('integrate\_other\_passwords', array(&$other\_passwords));
 // Whichever encryption it was using, let's make it use SMF's now ;). if (in\_array($user\_settings['passwd'], $other\_passwords)) { $user\_settings['passwd'] = hash\_password($user\_settings['member\_name'], un\_htmlspecialchars($\_POST['passwrd'])); $user\_settings['password\_salt'] = substr(md5(mt\_rand()), 0, 4);
 // Update the password and set up the hash. updateMemberData($user\_settings['id\_member'], array('passwd' => $user\_settings['passwd'], 'password\_salt' => $user\_settings['password\_salt'], 'passwd\_flood' => '')); } // Okay, they for sure didn't enter the password! else { // They've messed up again - keep a count to see if they need a hand. $\_SESSION['failed\_login'] = isset($\_SESSION['failed\_login']) ? ($\_SESSION['failed\_login'] + 1) : 1;
 // Hmm... don't remember it, do you? Here, try the password reminder ;). if ($\_SESSION['failed\_login'] >= $modSettings['failed\_login\_threshold']) redirectexit('action=reminder'); // We'll give you another chance... else { // Log an error so we know that it didn't go well in the error log. log\_error($txt['incorrect\_password'] . ' - <span class="remove">' . $user\_settings['member\_name'] . '</span>', 'user');
 $context['login\_errors'] = array($txt['incorrect\_password']); return; } } } elseif (!empty($user\_settings['passwd\_flood'])) { // Let's be sure they weren't a little hacker. validatePasswordFlood($user\_settings['id\_member'], $user\_settings['passwd\_flood'], true);
 // If we got here then we can reset the flood counter. updateMemberData($user\_settings['id\_member'], array('passwd\_flood' => '')); }
 // Correct password, but they've got no salt; fix it! if ($user\_settings['password\_salt'] == '') { $user\_settings['password\_salt'] = substr(md5(mt\_rand()), 0, 4); updateMemberData($user\_settings['id\_member'], array('password\_salt' => $user\_settings['password\_salt'])); }
 // Check their activation status. if (!checkActivation()) return;
 DoLogin();}
/\*\* \* Allows the user to enter their Two-Factor Authentication code \*/function LoginTFA(){ global $sourcedir, $txt, $context, $user\_info, $modSettings, $scripturl;
 if (!$user\_info['is\_guest'] || empty($context['tfa\_member']) || empty($modSettings['tfa\_mode'])) fatal\_lang\_error('no\_access', false);
 loadLanguage('Profile'); require\_once($sourcedir . '/Class-TOTP.php');
 $member = $context['tfa\_member'];
 // Prevent replay attacks by limiting at least 2 minutes before they can log in again via 2FA if (time() - $member['last\_login'] < 120) fatal\_lang\_error('tfa\_wait', false);
 $totp = new \TOTP\Auth($member['tfa\_secret']); $totp->setRange(1);
 if (!empty($\_SERVER['HTTP\_X\_REQUESTED\_WITH']) && $\_SERVER['HTTP\_X\_REQUESTED\_WITH'] == 'XMLHttpRequest') { $context['from\_ajax'] = true; $context['template\_layers'] = array(); }
 if (!empty($\_POST['tfa\_code']) && empty($\_POST['tfa\_backup'])) { // Check to ensure we're forcing SSL for authentication if (!empty($modSettings['force\_ssl']) && empty($maintenance) && (!isset($\_SERVER['HTTPS']) || $\_SERVER['HTTPS'] != 'on')) fatal\_lang\_error('login\_ssl\_required');
 $code = $\_POST['tfa\_code'];
 if (strlen($code) == $totp->getCodeLength() && $totp->validateCode($code)) { updateMemberData($member['id\_member'], array('last\_login' => time()));
 setTFACookie(3153600, $member['id\_member'], hash\_salt($member['tfa\_backup'], $member['password\_salt']), !empty($\_POST['tfa\_preserve'])); redirectexit(); } else { validatePasswordFlood($member['id\_member'], $member['passwd\_flood'], false, true);
 $context['tfa\_error'] = true; $context['tfa\_value'] = $\_POST['tfa\_code']; } } elseif (!empty($\_POST['tfa\_backup'])) { // Check to ensure we're forcing SSL for authentication if (!empty($modSettings['force\_ssl']) && empty($maintenance) && (!isset($\_SERVER['HTTPS']) || $\_SERVER['HTTPS'] != 'on')) fatal\_lang\_error('login\_ssl\_required');
 $backup = $\_POST['tfa\_backup'];
 if (hash\_verify\_password($member['member\_name'], $backup, $member['tfa\_backup'])) { // Get rid of their current TFA settings updateMemberData($member['id\_member'], array( 'tfa\_secret' => '', 'tfa\_backup' => '', 'last\_login' => time(), )); setTFACookie(3153600, $member['id\_member'], hash\_salt($member['tfa\_backup'], $member['password\_salt'])); redirectexit('action=profile;area=tfasetup;backup'); } else { validatePasswordFlood($member['id\_member'], $member['passwd\_flood'], false, true);
 $context['tfa\_backup\_error'] = true; $context['tfa\_value'] = $\_POST['tfa\_code']; $context['tfa\_backup\_value'] = $\_POST['tfa\_backup']; } }
 loadTemplate('Login'); $context['sub\_template'] = 'login\_tfa'; $context['page\_title'] = $txt['login']; $context['tfa\_url'] = (!empty($modSettings['force\_ssl']) && $modSettings['force\_ssl'] < 2 ? strtr($scripturl, array('http://' => 'https://')) : $scripturl) . '?action=logintfa';}
/\*\* \* Check activation status of the current user. \*/function checkActivation(){ global $context, $txt, $scripturl, $user\_settings, $modSettings;
 if (!isset($context['login\_errors'])) $context['login\_errors'] = array();
 // What is the true activation status of this account? $activation\_status = $user\_settings['is\_activated'] > 10 ? $user\_settings['is\_activated'] - 10 : $user\_settings['is\_activated'];
 // Check if the account is activated - COPPA first... if ($activation\_status == 5) { $context['login\_errors'][] = $txt['coppa\_no\_concent'] . ' <a href="' . $scripturl . '?action=coppa;member=' . $user\_settings['id\_member'] . '">' . $txt['coppa\_need\_more\_details'] . '</a>'; return false; } // Awaiting approval still? elseif ($activation\_status == 3) fatal\_lang\_error('still\_awaiting\_approval', 'user'); // Awaiting deletion, changed their mind? elseif ($activation\_status == 4) { if (isset($\_REQUEST['undelete'])) { updateMemberData($user\_settings['id\_member'], array('is\_activated' => 1)); updateSettings(array('unapprovedMembers' => ($modSettings['unapprovedMembers'] > 0 ? $modSettings['unapprovedMembers'] - 1 : 0))); } else { $context['disable\_login\_hashing'] = true; $context['login\_errors'][] = $txt['awaiting\_delete\_account']; $context['login\_show\_undelete'] = true; return false; } } // Standard activation? elseif ($activation\_status != 1) { log\_error($txt['activate\_not\_completed1'] . ' - <span class="remove">' . $user\_settings['member\_name'] . '</span>', false);
 $context['login\_errors'][] = $txt['activate\_not\_completed1'] . ' <a href="' . $scripturl . '?action=activate;sa=resend;u=' . $user\_settings['id\_member'] . '">' . $txt['activate\_not\_completed2'] . '</a>'; return false; } return true;}
/\*\* \* Perform the logging in. (set cookie, call hooks, etc) \*/function DoLogin(){ global $user\_info, $user\_settings, $smcFunc; global $maintenance, $modSettings, $context, $sourcedir;
 // Load cookie authentication stuff. require\_once($sourcedir . '/Subs-Auth.php');
 // Call login integration functions. call\_integration\_hook('integrate\_login', array($user\_settings['member\_name'], null, $modSettings['cookieTime']));
 // Get ready to set the cookie... $username = $user\_settings['member\_name']; $user\_info['id'] = $user\_settings['id\_member'];
 // Bam! Cookie set. A session too, just in case. setLoginCookie(60 \* $modSettings['cookieTime'], $user\_settings['id\_member'], hash\_salt($user\_settings['passwd'], $user\_settings['password\_salt']));
 // Reset the login threshold. if (isset($\_SESSION['failed\_login'])) unset($\_SESSION['failed\_login']);
 $user\_info['is\_guest'] = false; $user\_settings['additional\_groups'] = explode(',', $user\_settings['additional\_groups']); $user\_info['is\_admin'] = $user\_settings['id\_group'] == 1 || in\_array(1, $user\_settings['additional\_groups']);
 // Are you banned? is\_not\_banned(true);
 // Don't stick the language or theme after this point. unset($\_SESSION['language'], $\_SESSION['id\_theme']);
 // First login? $request = $smcFunc['db\_query']('', ' SELECT last\_login FROM {db\_prefix}members WHERE id\_member = {int:id\_member} AND last\_login = 0', array( 'id\_member' => $user\_info['id'], ) ); if ($smcFunc['db\_num\_rows']($request) == 1) $\_SESSION['first\_login'] = true; else unset($\_SESSION['first\_login']); $smcFunc['db\_free\_result']($request);
 // You've logged in, haven't you? $update = array('member\_ip' => $user\_info['ip'], 'member\_ip2' => $\_SERVER['BAN\_CHECK\_IP']); if (empty($user\_settings['tfa\_secret'])) $update['last\_login'] = time(); updateMemberData($user\_info['id'], $update);
 // Get rid of the online entry for that old guest.... $smcFunc['db\_query']('', ' DELETE FROM {db\_prefix}log\_online WHERE session = {string:session}', array( 'session' => 'ip' . $user\_info['ip'], ) ); $\_SESSION['log\_time'] = 0;
 // Log this entry, only if we have it enabled. if (!empty($modSettings['loginHistoryDays'])) $smcFunc['db\_insert']('insert', '{db\_prefix}member\_logins', array( 'id\_member' => 'int', 'time' => 'int', 'ip' => 'string', 'ip2' => 'string', ), array( $user\_info['id'], time(), $user\_info['ip'], $user\_info['ip2'] ), array( 'id\_member', 'time' ) );
 // Just log you back out if it's in maintenance mode and you AREN'T an admin. if (empty($maintenance) || allowedTo('admin\_forum')) redirectexit('action=login2;sa=check;member=' . $user\_info['id'], $context['server']['needs\_login\_fix']); else redirectexit('action=logout;' . $context['session\_var'] . '=' . $context['session\_id'], $context['server']['needs\_login\_fix']);}
/\*\* \* Logs the current user out of their account. \* It requires that the session hash is sent as well, to prevent automatic logouts by images or javascript. \* It redirects back to $\_SESSION['logout\_url'], if it exists. \* It is accessed via ?action=logout;session\_var=... \* \* @param bool $internal If true, it doesn't check the session \* @param bool $redirect Whether or not to redirect the user after they log out \*/function Logout($internal = false, $redirect = true){ global $sourcedir, $user\_info, $user\_settings, $context, $smcFunc, $cookiename, $modSettings;
 // Make sure they aren't being auto-logged out. if (!$internal) checkSession('get');
 require\_once($sourcedir . '/Subs-Auth.php');
 if (isset($\_SESSION['pack\_ftp'])) $\_SESSION['pack\_ftp'] = null;
 // It won't be first login anymore. unset($\_SESSION['first\_login']);
 // Just ensure they aren't a guest! if (!$user\_info['is\_guest']) { // Pass the logout information to integrations. call\_integration\_hook('integrate\_logout', array($user\_settings['member\_name']));
 // If you log out, you aren't online anymore :P. $smcFunc['db\_query']('', ' DELETE FROM {db\_prefix}log\_online WHERE id\_member = {int:current\_member}', array( 'current\_member' => $user\_info['id'], ) ); }
 $\_SESSION['log\_time'] = 0;
 // Empty the cookie! (set it in the past, and for id\_member = 0) setLoginCookie(-3600, 0);
 // And some other housekeeping while we're at it. $salt = substr(md5(mt\_rand()), 0, 4); if (!empty($user\_info['id'])) updateMemberData($user\_info['id'], array('password\_salt' => $salt));
 if (!empty($modSettings['tfa\_mode']) && !empty($user\_info['id']) && !empty($\_COOKIE[$cookiename . '\_tfa'])) { $tfadata = json\_decode($\_COOKIE[$cookiename . '\_tfa'], true);
 // If that failed, try the old method if (is\_null($tfadata)) $tfadata = @unserialize($\_COOKIE[$cookiename . '\_tfa']);
 list ($tfamember, $tfasecret, $exp, $state, $preserve) = $tfadata;
 // If we're preserving the cookie, reset it with updated salt if ($preserve && time() < $exp) setTFACookie(3153600, $user\_info['id'], hash\_salt($user\_settings['tfa\_backup'], $salt), true); else setTFACookie(-3600, 0, ''); }
 session\_destroy();
 // Off to the merry board index we go! if ($redirect) { if (empty($\_SESSION['logout\_url'])) redirectexit('', $context['server']['needs\_login\_fix']); elseif (!empty($\_SESSION['logout\_url']) && (strpos($\_SESSION['logout\_url'], 'http://') === false && strpos($\_SESSION['logout\_url'], 'https://') === false)) { unset ($\_SESSION['logout\_url']); redirectexit(); } else { $temp = $\_SESSION['logout\_url']; unset($\_SESSION['logout\_url']);
 redirectexit($temp, $context['server']['needs\_login\_fix']); } }}
/\*\* \* MD5 Encryption used for older passwords. (SMF 1.0.x/YaBB SE 1.5.x hashing) \* \* @param string $data The data \* @param string $key The key \* @return string The HMAC MD5 of data with key \*/function md5\_hmac($data, $key){ $key = str\_pad(strlen($key) <= 64 ? $key : pack('H\*', md5($key)), 64, chr(0x00)); return md5(($key ^ str\_repeat(chr(0x5c), 64)) . pack('H\*', md5(($key ^ str\_repeat(chr(0x36), 64)) . $data)));}
/\*\* \* Custom encryption for phpBB3 based passwords. \* \* @param string $passwd The raw (unhashed) password \* @param string $passwd\_hash The hashed password \* @return string The hashed version of $passwd \*/function phpBB3\_password\_check($passwd, $passwd\_hash){ // Too long or too short? if (strlen($passwd\_hash) != 34) return;
 // Range of characters allowed. $range = './0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
 // Tests $strpos = strpos($range, $passwd\_hash[3]); $count = 1 << $strpos; $count2 = $count; $salt = substr($passwd\_hash, 4, 8);
 $hash = md5($salt . $passwd, true); for (; $count != 0; --$count) $hash = md5($hash . $passwd, true);
 $output = substr($passwd\_hash, 0, 12); $i = 0; while ($i < 16) { $value = ord($hash[$i++]); $output .= $range[$value & 0x3f];
 if ($i < 16) $value |= ord($hash[$i]) << 8;
 $output .= $range[($value >> 6) & 0x3f];
 if ($i++ >= 16) break;
 if ($i < 16) $value |= ord($hash[$i]) << 16;
 $output .= $range[($value >> 12) & 0x3f];
 if ($i++ >= 16) break;
 $output .= $range[($value >> 18) & 0x3f]; }
 // Return now. return $output;}
/\*\* \* This protects against brute force attacks on a member's password. \* Importantly, even if the password was right we DON'T TELL THEM! \* \* @param int $id\_member The ID of the member \* @param bool|string $password\_flood\_value False if we don't have a flood value, otherwise a string with a timestamp and number of tries separated by a | \* @param bool $was\_correct Whether or not the password was correct \* @param bool $tfa Whether we're validating for two-factor authentication \*/function validatePasswordFlood($id\_member, $password\_flood\_value = false, $was\_correct = false, $tfa = false){ global $cookiename, $sourcedir;
 // As this is only brute protection, we allow 5 attempts every 10 seconds.
 // Destroy any session or cookie data about this member, as they validated wrong. // Only if they're not validating for 2FA if (!$tfa) { require\_once($sourcedir . '/Subs-Auth.php'); setLoginCookie(-3600, 0);
 if (isset($\_SESSION['login\_' . $cookiename])) unset($\_SESSION['login\_' . $cookiename]); }
 // We need a member! if (!$id\_member) { // Redirect back! redirectexit();
 // Probably not needed, but still make sure... fatal\_lang\_error('no\_access', false); }
 // Right, have we got a flood value? if ($password\_flood\_value !== false) @list ($time\_stamp, $number\_tries) = explode('|', $password\_flood\_value);
 // Timestamp or number of tries invalid? if (empty($number\_tries) || empty($time\_stamp)) { $number\_tries = 0; $time\_stamp = time(); }
 // They've failed logging in already if (!empty($number\_tries)) { // Give them less chances if they failed before $number\_tries = $time\_stamp < time() - 20 ? 2 : $number\_tries;
 // They are trying too fast, make them wait longer if ($time\_stamp < time() - 10) $time\_stamp = time(); }
 $number\_tries++;
 // Broken the law? if ($number\_tries > 5) fatal\_lang\_error('login\_threshold\_brute\_fail', 'critical');
 // Otherwise set the members data. If they correct on their first attempt then we actually clear it, otherwise we set it! updateMemberData($id\_member, array('passwd\_flood' => $was\_correct && $number\_tries == 1 ? '' : $time\_stamp . '|' . $number\_tries));
}
?>

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


