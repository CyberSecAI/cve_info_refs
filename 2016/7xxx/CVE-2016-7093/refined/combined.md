=== Content from xenbits.xen.org_33e8e1a6_20250125_155029.html ===

# Information

| Advisory | [XSA-186](advisory-186.html) |
| --- | --- |
| Public release | 2016-09-08 12:00 |
| Updated | 2016-09-08 12:00 |
| Version | 4 |
| CVE(s) | [CVE-2016-7093](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-7093) |
| Title | x86: Mishandling of instruction pointer truncation during emulation |

# Files

<advisory-186.txt> (signed advisory file)

<xsa186-0001-x86-emulate-Correct-boundary-interactions-of-emulate.patch>

<xsa186-0002-hvm-fep-Allow-testing-of-instructions-crossing-the-1.patch>

<xsa186-4.6-0002-hvm-fep-Allow-testing-of-instructions-crossing-the.patch>

<xsa186-4.7-0002-hvm-fep-Allow-testing-of-instructions-crossing-the.patch>
# Advisory

---

```

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

            Xen Security Advisory CVE-2016-7093 / XSA-186
                              version 4

      x86: Mishandling of instruction pointer truncation during emulation

UPDATES IN VERSION 4
====================

Public release.

ISSUE DESCRIPTION
=================

When emulating HVM instructions, Xen uses a small i-cache for fetches
from guest memory.  The code that handles cache misses does not check
if the address from which it fetched lies within the cache before
blindly writing to it.  As such it is possible for the guest to
overwrite hypervisor memory.

It is currently believed that the only way to trigger this bug is to
use the way that Xen currently incorrectly wraps CS:IP in 16 bit
modes.  The included patch prevents such wrapping.

IMPACT
======

A malicious HVM guest administrator can escalate their privilege to that
of the host.

VULNERABLE SYSTEMS
==================

Xen versions 4.7.0 and later are vulnerable.
Xen releases 4.6.3 and 4.5.3 are vulnerable.

Xen releases 4.6.0 to 4.6.2 inclusive are NOT vulnerable.
Xen releases 4.5.2 and earlier are NOT vulnerable.

The vulnerability is only exposed to HVM guests on x86 hardware.

The vulnerability is not exposed to x86 PV guests, or ARM guests.

MITIGATION
==========

Running only PV guests will avoid this vulnerability.

CREDITS
=======

This issue was discovered by Brian Marcotte.

RESOLUTION
==========

Applying the first patch will resolve the issue.

Users wishing to independently verify the correctness of the fix may
find the second patch helpful.  The second patch makes it easier to
use the "fep" (Force Emulation Prefix) feature to reproduce the
erroneous condition in a test environment.  The "fep" feature requires
explicit enablement on the hypervisor command line, and is unsuitable
for production systems.  Accordingly, applying the second patch does
not affect production systems and does not improve security.

Xen version     First patch               Second patch
 xen-unstable:   xsa186-0001-*.patch       xsa186-0002-*.patch
 Xen 4.7.x:      xsa186-0001-*.patch       xsa186-4.7-0002-*.patch
 Xen 4.6.3:      xsa186-0001-*.patch       xsa186-4.6-0002-*.patch
 Xen 4.5.3:      xsa186-0001-*.patch       xsa186-4.6-0002-*.patch

$ sha256sum xsa186*
[f2082a36d968a47e477bb5082d0e0aaa58e6cb3dc20b26389f043a9b7b595fa6  xsa186-0001-x86-emulate-Correct-boundary-interactions-of-emulate.patch](xsa186-0001-x86-emulate-Correct-boundary-interactions-of-emulate.patch)
[412fa58edcbd1c7fdbfec7e28898cf98585593e6a24ccfb088dc0b84715286a5  xsa186-0002-hvm-fep-Allow-testing-of-instructions-crossing-the-1.patch](xsa186-0002-hvm-fep-Allow-testing-of-instructions-crossing-the-1.patch)
[7482a823c3443e26dee1111c4904162845eaa9f826aa7bf8348007406d91bddd  xsa186-4.6-0002-hvm-fep-Allow-testing-of-instructions-crossing-the.patch](xsa186-4.6-0002-hvm-fep-Allow-testing-of-instructions-crossing-the.patch)
[5a826a32763d82ac83c924f8c89d12aae5f069a4cbc7d5193aa8413a02b6dc05  xsa186-4.7-0002-hvm-fep-Allow-testing-of-instructions-crossing-the.patch](xsa186-4.7-0002-hvm-fep-Allow-testing-of-instructions-crossing-the.patch)
$

DEPLOYMENT DURING EMBARGO
=========================

Deployment of the patches and/or mitigations described above (or
others which are substantially similar) is permitted during the
embargo, even on public-facing systems with untrusted guest users and
administrators.

But: Distribution of updated software is prohibited (except to other
members of the predisclosure list).

Predisclosure list members who wish to deploy significantly different
patches and/or mitigations, please contact the Xen Project Security
Team.

(Note: this during-embargo deployment notice is retained in
post-embargo publicly released Xen Project advisories, even though it
is then no longer applicable.  This is to enable the community to have
oversight of the Xen Project Security Team's decisionmaking.)

For more information about permissible uses of embargoed information,
consult the Xen Project community's agreed Security Policy:
  <http://www.xenproject.org/security-policy.html>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJX0VLsAAoJEIP+FMlX6CvZoUoIAMvgdMZRYdK5MaaRUAA1hDG3
UFSxZCH8zja6wZG6WPNj7VqvEkQ2350oqb05BGB8jTFCmqtNDDIyHK68WaMpwDMv
EEeetosujnlHTtVV7N8e0HO7F497PzZtzfniTyZc/h2Lna552ohMy/UcADtA7xxP
IK6qwvxpkx1aLzsDFpHIdrVcttDD/oZcVbBFwcCAqK33eGNC3S6BJvIibCAKfO8h
YKiAtvWUNsX/o4L9Zs4M50/pK3TzWsaDjfK3IX5LJPtsrcrKklrALVnDUOpTz1WA
07UIk0BcrzicEuTvuATWSQ3nVxUXAH95io23PCniHHntBtYJHjGA5rIqX+tiN6w=
=HT+K
-----END PGP SIGNATURE-----

```

---

Xenproject.org Security Team


=== Content from xenbits.xen.org_2de5e8be_20250125_155029.html ===
From e938be013ba73ff08fa4f1d8670501aacefde7fb Mon Sep 17 00:00:00 2001
From: Andrew Cooper
Date: Fri, 22 Jul 2016 16:02:54 +0000
Subject: [PATCH 1/2] x86/emulate: Correct boundary interactions of emulated
instructions
This reverts most of c/s 0640ffb6 "x86emul: fix rIP handling".
Experimentally, in long mode processors will execute an instruction stream
which crosses the 64bit -1 -> 0 virtual boundary, whether the instruction
boundary is aligned on the virtual boundary, or is misaligned.
In compatibility mode, Intel processors will execute an instruction stream
which crosses the 32bit -1 -> 0 virtual boundary, while AMD processors raise a
segmentation fault. Xen's segmentation behaviour matches AMD.
For 16bit code, hardware does not ever truncated %ip. %eip is always used and
behaves normally as a 32bit register, including in 16bit protected mode
segments, as well as in Real and Unreal mode.
This is XSA-186
Reported-by: Brian Marcotte
Signed-off-by: Andrew Cooper
Reviewed-by: Jan Beulich
---
xen/arch/x86/x86\_emulate/x86\_emulate.c | 22 ++++------------------
1 file changed, 4 insertions(+), 18 deletions(-)
diff --git a/xen/arch/x86/x86\_emulate/x86\_emulate.c b/xen/arch/x86/x86\_emulate/x86\_emulate.c
index d5a56cf..bf3529a 100644
--- a/xen/arch/x86/x86\_emulate/x86\_emulate.c
+++ b/xen/arch/x86/x86\_emulate/x86\_emulate.c
@@ -1570,10 +1570,6 @@ x86\_emulate(
#endif
}
- /\* Truncate rIP to def\_ad\_bytes (2 or 4) if necessary. \*/
- if ( def\_ad\_bytes < sizeof(\_regs.eip) )
- \_regs.eip &= (1UL << (def\_ad\_bytes \* 8)) - 1;
-
/\* Prefix bytes. \*/
for ( ; ; )
{
@@ -3906,21 +3902,11 @@ x86\_emulate(
/\* Commit shadow register state. \*/
\_regs.eflags &= ~EFLG\_RF;
- switch ( \_\_builtin\_expect(def\_ad\_bytes, sizeof(\_regs.eip)) )
- {
- uint16\_t ip;
- case 2:
- ip = \_regs.eip;
- \_regs.eip = ctxt->regs->eip;
- \*(uint16\_t \*)&\_regs.eip = ip;
- break;
-#ifdef \_\_x86\_64\_\_
- case 4:
- \_regs.rip = \_regs.\_eip;
- break;
-#endif
- }
+ /\* Zero the upper 32 bits of %rip if not in long mode. \*/
+ if ( def\_ad\_bytes < sizeof(\_regs.eip) )
+ \_regs.eip = (uint32\_t)\_regs.eip;
+
\*ctxt->regs = \_regs;
done:
--
2.1.4


=== Content from security.gentoo.org_e7ef98c7_20250125_155030.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Xen: Multiple vulnerabilities — GLSA **201611-09**

Multiple vulnerabilities have been found in Xen, the worst of which
allows gaining of privileges on the host system.

### Affected packages

| Package | **app-emulation/xen** on all architectures |
| --- | --- |
| Affected versions | < **4.6.3-r3** |
| Unaffected versions | >= **4.6.3-r3** |

| Package | **app-emulation/xen-tools** on all architectures |
| --- | --- |
| Affected versions | < **4.6.3-r2** |
| Unaffected versions | >= **4.6.3-r2** |

### Background

Xen is a bare-metal hypervisor.

### Description

Multiple vulnerabilities have been discovered in Xen. Please review the
CVE identifiers referenced below for details.

### Impact

A malicious guest administrator could escalate their privileges on the
host system or cause a Denial of Service. Additionally, a malicious
unprivileged guest user may be able to obtain or corrupt sensitive
information (including cryptographic material) in other programs in the
same guest.

### Workaround

There is no known workaround at this time.

### Resolution

All Xen users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=app-emulation/xen-4.6.3-r3"

```

All Xen tools users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=app-emulation/xen-tools-4.6.3-r2

```
### References

* [CVE-2016-6258](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-6258)
* [CVE-2016-7092](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-7092)
* [CVE-2016-7093](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-7093)
* [CVE-2016-7094](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-7094)
* [CVE-2016-7777](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2016-7777)

**Release date**

November 15, 2016

**Latest revision**

November 15, 2016: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [588780](https://bugs.gentoo.org/show_bug.cgi?id=588780)
* [593198](https://bugs.gentoo.org/show_bug.cgi?id=593198)
* [594850](https://bugs.gentoo.org/show_bug.cgi?id=594850)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


