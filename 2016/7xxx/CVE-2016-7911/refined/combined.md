=== Content from git.kernel.org_da052c41_20250126_025717.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=6934da9238da947628be83635e365df41064b09b)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6934da9238da947628be83635e365df41064b09b)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6934da9238da947628be83635e365df41064b09b)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6934da9238da947628be83635e365df41064b09b)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lukas Czerner <lczerner@redhat.com> | 2015-10-17 22:57:06 -0400 |
| --- | --- | --- |
| committer | Theodore Ts'o <tytso@mit.edu> | 2015-10-17 22:57:06 -0400 |
| commit | [6934da9238da947628be83635e365df41064b09b](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6934da9238da947628be83635e365df41064b09b) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=6934da9238da947628be83635e365df41064b09b)) | |
| tree | [a7d5770b2fbd3961c40b6bb2da86873dcfab19c0](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6934da9238da947628be83635e365df41064b09b) | |
| parent | [33d14975e5ac469963d5d63856b61698ad0bff07](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=33d14975e5ac469963d5d63856b61698ad0bff07) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6934da9238da947628be83635e365df41064b09b&id2=33d14975e5ac469963d5d63856b61698ad0bff07)) | |
| download | [linux-6934da9238da947628be83635e365df41064b09b.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-6934da9238da947628be83635e365df41064b09b.tar.gz) | |

ext4: fix potential use after free in \_\_ext4\_journal\_stopThere is a use-after-free possibility in \_\_ext4\_journal\_stop() in the
case that we free the handle in the first jbd2\_journal\_stop() because
we're referencing handle->h\_err afterwards. This was introduced in
9705acd63b125dee8b15c705216d7186daea4625 and it is wrong. Fix it by
storing the handle->h\_err value beforehand and avoid referencing
potentially freed handle.
Fixes: 9705acd63b125dee8b15c705216d7186daea4625
Signed-off-by: Lukas Czerner <lczerner@redhat.com>
Reviewed-by: Andreas Dilger <adilger@dilger.ca>
Cc: stable@vger.kernel.org
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6934da9238da947628be83635e365df41064b09b)

| -rw-r--r-- | [fs/ext4/ext4\_jbd2.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/ext4/ext4_jbd2.c?id=6934da9238da947628be83635e365df41064b09b) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/fs/ext4/ext4\_jbd2.c b/fs/ext4/ext4\_jbd2.cindex d4184318181878..e770c1ee4613ed 100644--- a/[fs/ext4/ext4\_jbd2.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/ext4/ext4_jbd2.c?id=33d14975e5ac469963d5d63856b61698ad0bff07)+++ b/[fs/ext4/ext4\_jbd2.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/ext4/ext4_jbd2.c?id=6934da9238da947628be83635e365df41064b09b)@@ -88,13 +88,13 @@ int \_\_ext4\_journal\_stop(const char \*where, unsigned int line, handle\_t \*handle) return 0; } + err = handle->h\_err; if (!handle->h\_transaction) {- err = jbd2\_journal\_stop(handle);- return handle->h\_err ? handle->h\_err : err;+ rc = jbd2\_journal\_stop(handle);+ return err ? err : rc; }  sb = handle->h\_transaction->t\_journal->j\_private;- err = handle->h\_err; rc = jbd2\_journal\_stop(handle);  if (!err) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-26 02:55:00 +0000



=== Content from www.kernel.org_35f8cdce_20250124_190715.html ===
commit 90838e401efa1a6f82f4fc2edf4e1533ec84c343
Author: Greg Kroah-Hartman
Date: Wed Aug 10 12:54:57 2016 +0200
Linux 4.6.6
commit 491749feb6fdd3798b5b263a15c1894965a23aea
Author: Paul Burton
Date: Wed Feb 3 03:15:26 2016 +0000
MIPS: CM: Fix mips\_cm\_max\_vp\_width for UP kernels
commit a60ae81e5e5918138703f22427dd8f2445985b55 upstream.
Fix mips\_cm\_max\_vp\_width for UP kernels where it previously referenced
smp\_num\_siblings, which is not declared for UP kernels. This led to
build errors such as the following:
drivers/built-in.o: In function `$L446':
irq-mips-gic.c:(.text+0x1994): undefined reference to `smp\_num\_siblings'
drivers/built-in.o:irq-mips-gic.c:(.text+0x199c): more undefined references to `smp\_num\_siblings' follow
On UP kernels simply return 1, leaving the reference to smp\_num\_siblings
in place only for SMP kernels.
Signed-off-by: Paul Burton
Cc: Matt Redfearn
Cc: Thomas Gleixner
Cc: linux-mips@linux-mips.org
Cc: linux-kernel@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/12332/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 42c7aa83c3a6ab314d271ba89b67f96eafd72bd2
Author: Miklos Szeredi
Date: Wed Aug 3 13:44:27 2016 +0200
vfs: fix deadlock in file\_remove\_privs() on overlayfs
commit c1892c37769cf89c7e7ba57528ae2ccb5d153c9b upstream.
file\_remove\_privs() is called with inode lock on file\_inode(), which
proceeds to calling notify\_change() on file->f\_path.dentry. Which triggers
the WARN\_ON\_ONCE(!inode\_is\_locked(inode)) in addition to deadlocking later
when ovl\_setattr tries to lock the underlying inode again.
Fix this mess by not mixing the layers, but doing everything on underlying
dentry/inode.
Signed-off-by: Miklos Szeredi
Fixes: 07a2daab49c5 ("ovl: Copy up underlying inode's ->i\_mode to overlay inode")
Signed-off-by: Greg Kroah-Hartman
commit 04678f5598322beecf6f06ddf73b2eb6a8b0ef9a
Author: Scott Bauer
Date: Wed Jul 27 19:11:29 2016 -0600
vfs: ioctl: prevent double-fetch in dedupe ioctl
commit 10eec60ce79187686e052092e5383c99b4420a20 upstream.
This prevents a double-fetch from user space that can lead to to an
undersized allocation and heap overflow.
Fixes: 54dbc1517237 ("vfs: hoist the btrfs deduplication ioctl to the vfs")
Signed-off-by: Scott Bauer
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 900ac92c5514dd8c63a8f3c91942dcb4cc6bd0f3
Author: Alexander Shishkin
Date: Thu Jun 30 11:51:44 2016 +0300
intel\_th: Fix a deadlock in modprobing
commit a36aa80f3cb2540fb1dbad6240852de4365a2e82 upstream.
Driver initialization tries to request a hub (GTH) driver module from
its probe callback, resulting in a deadlock.
This patch solves the problem by adding a deferred work for requesting
the hub module.
Signed-off-by: Alexander Shishkin
Signed-off-by: Greg Kroah-Hartman
commit df1abbea005a621a497fc9def893ed2c6cba4d94
Author: Alexander Shishkin
Date: Tue Jun 28 18:55:23 2016 +0300
intel\_th: pci: Add Kaby Lake PCH-H support
commit 7a1a47ce35821b40f5b2ce46379ba14393bc3873 upstream.
This adds Intel(R) Trace Hub PCI ID for Kaby Lake PCH-H.
Signed-off-by: Alexander Shishkin
Signed-off-by: Greg Kroah-Hartman
commit f4cb43e018456982a0d452f987e2cdf87ae777e0
Author: Gregory Greenman
Date: Tue Jul 5 15:23:10 2016 +0300
cfg80211: handle failed skb allocation
commit 16a910a6722b7a8680409e634c7c0dac073c01e4 upstream.
Handle the case when dev\_alloc\_skb returns NULL.
Fixes: 2b67f944f88c2 ("cfg80211: reuse existing page fragments in A-MSDU rx")
Signed-off-by: Gregory Greenman
Signed-off-by: Luca Coelho
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit 2f4cf2ec9191577c201aaf71cca4ccabb50cdb8e
Author: Dmitri Epshtein
Date: Wed Jul 6 04:18:58 2016 +0200
net: mvneta: set real interrupt per packet for tx\_done
commit 06708f81528725148473c0869d6af5f809c6824b upstream.
Commit aebea2ba0f74 ("net: mvneta: fix Tx interrupt delay") intended to
set coalescing threshold to a value guaranteeing interrupt generation
per each sent packet, so that buffers can be released with no delay.
In fact setting threshold to '1' was wrong, because it causes interrupt
every two packets. According to the documentation a reason behind it is
following - interrupt occurs once sent buffers counter reaches a value,
which is higher than one specified in MVNETA\_TXQ\_SIZE\_REG(q). This
behavior was confirmed during tests. Also when testing the SoC working
as a NAS device, better performance was observed with int-per-packet,
as it strongly depends on the fact that all transmitted packets are
released immediately.
This commit enables NETA controller work in interrupt per sent packet mode
by setting coalescing threshold to 0.
Signed-off-by: Dmitri Epshtein
Signed-off-by: Marcin Wojtas
Fixes aebea2ba0f74 ("net: mvneta: fix Tx interrupt delay")
Acked-by: Willy Tarreau
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 14877928f10667a5606383885d004f7185f33718
Author: Ilya Dryomov
Date: Tue Jul 19 03:50:28 2016 +0200
libceph: apply new\_state before new\_up\_client on incrementals
commit 930c532869774ebf8af9efe9484c597f896a7d46 upstream.
Currently, osd\_weight and osd\_state fields are updated in the encoding
order. This is wrong, because an incremental map may look like e.g.
new\_up\_client: { osd=6, addr=... } # set osd\_state and addr
new\_state: { osd=6, xorstate=EXISTS } # clear osd\_state
Suppose osd6's current osd\_state is EXISTS (i.e. osd6 is down). After
applying new\_up\_client, osd\_state is changed to EXISTS | UP. Carrying
on with the new\_state update, we flip EXISTS and leave osd6 in a weird
"!EXISTS but UP" state. A non-existent OSD is considered down by the
mapping code
2087 for (i = 0; i < pg->pg\_temp.len; i++) {
2088 if (ceph\_osd\_is\_down(osdmap, pg->pg\_temp.osds[i])) {
2089 if (ceph\_can\_shift\_osds(pi))
2090 continue;
2091
2092 temp->osds[temp->size++] = CRUSH\_ITEM\_NONE;
and so requests get directed to the second OSD in the set instead of
the first, resulting in OSD-side errors like:
[WRN] : client.4239 192.168.122.21:0/2444980242 misdirected client.4239.1:2827 pg 2.5df899f2 to osd.4 not [1,4,6] in e680/680
and hung rbds on the client:
[ 493.566367] rbd: rbd0: write 400000 at 11cc00000 (0)
[ 493.566805] rbd: rbd0: result -6 xferred 400000
[ 493.567011] blk\_update\_request: I/O error, dev rbd0, sector 9330688
The fix is to decouple application from the decoding and:
- apply new\_weight first
- apply new\_state before new\_up\_client
- twiddle osd\_state flags if marking in
- clear out some of the state if osd is destroyed
Fixes: http://tracker.ceph.com/issues/14901
Signed-off-by: Ilya Dryomov
Reviewed-by: Josh Durgin
Signed-off-by: Greg Kroah-Hartman
commit 54d61751bb7296a3986f571b915e8f5924e7956e
Author: Tejun Heo
Date: Mon Jul 18 18:40:00 2016 -0400
libata: LITE-ON CX1-JB256-HP needs lower max\_sectors
commit 1488a1e3828d60d74c9b802a05e24c0487babe4e upstream.
Since 34b48db66e08 ("block: remove artifical max\_hw\_sectors cap"),
max\_sectors is no longer limited to BLK\_DEF\_MAX\_SECTORS and LITE-ON
CX1-JB256-HP keeps timing out with higher max\_sectors. Revert it to
the previous value.
Signed-off-by: Tejun Heo
Reported-by: dgerasimov@gmail.com
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=121671
Fixes: 34b48db66e08 ("block: remove artifical max\_hw\_sectors cap")
Signed-off-by: Tejun Heo
Signed-off-by: Greg Kroah-Hartman
commit ed87c21407e4d781dc88c4b4fce0113336ba501d
Author: Lukasz Gemborowski
Date: Mon Jun 27 12:57:47 2016 +0200
i2c: mux: reg: wrong condition checked for of\_address\_to\_resource return value
commit 22ebf00eb56fe77922de8138aa9af9996582c2b3 upstream.
of\_address\_to\_resource return 0 on successful call but
devm\_ioremap\_resource is called only if it returns non-zero value
Signed-off-by: Lukasz Gemborowski
Reviewed-by: Alexander Sverdlin
Signed-off-by: Wolfram Sang
Signed-off-by: Greg Kroah-Hartman
commit f5be1dff829038ff2225238291c67fdeb7caa0c9
Author: Sricharan R
Date: Fri Jun 10 23:38:20 2016 +0530
i2c: qup: Fix wrong value of index variable
commit d4f56c7773483b8829e89cfc739b7a5a071f6da0 upstream.
index gets incremented during check to determine if the
messages can be transferred with dma. But not reset after
that, resulting in wrong start value in subsequent loop,
causing failure. Fix it.
Signed-off-by: Sricharan R
Signed-off-by: Wolfram Sang
Signed-off-by: Greg Kroah-Hartman
commit 9388174e5d878444e78103f9e97e656a463bc5e4
Author: Laurent Pinchart
Date: Tue May 24 09:09:33 2016 -0300
adv7604: Don't ignore pad number in subdev DV timings pad operations
commit 6519c3d7b8621c9f4333c98ed4b703029b51ba79 upstream.
The dv\_timings\_cap() and enum\_dv\_timings() pad operations take a pad
number as an input argument and return the DV timings capabilities and
list of supported DV timings for that pad.
Commit bd3e275f3ec0 ("[media] media: i2c: adv7604: Use v4l2-dv-timings
helpers") broke this as it started ignoring the pad number, always
returning the information associated with the currently selected input.
Fix it.
Fixes: bd3e275f3ec0 ("[media] media: i2c: adv7604: Use v4l2-dv-timings helpers")
Signed-off-by: Laurent Pinchart
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 5e8123b618c8761b607817e84a53ca65d27e8475
Author: Thomas Gleixner
Date: Tue Jul 12 21:59:23 2016 +0200
cpu/hotplug: Keep enough storage space if SMP=n to avoid array out of bounds scribble
commit a7c734140aa36413944eef0f8c660e0e2256357d upstream.
Xiaolong Ye reported lock debug warnings triggered by the following commit:
8de4a0066106 ("perf/x86: Convert the core to the hotplug state machine")
The bug is the following: the cpuhp\_bp\_states[] array is cut short when
CONFIG\_SMP=n, but the dynamically registered callbacks are stored nevertheless
and happily scribble outside of the array bounds...
We need to store them in case that the state is unregistered so we can invoke
the teardown function. That's independent of CONFIG\_SMP. Make sure the array
is large enough.
Reported-by: kernel test robot
Signed-off-by: Thomas Gleixner
Cc: Adam Borowski
Cc: Alexander Shishkin
Cc: Anna-Maria Gleixner
Cc: Arnaldo Carvalho de Melo
Cc: Arnaldo Carvalho de Melo
Cc: Borislav Petkov
Cc: Jiri Olsa
Cc: Kan Liang
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Sebastian Andrzej Siewior
Cc: Stephane Eranian
Cc: Vince Weaver
Cc: lkp@01.org
Cc: tipbuild@zytor.com
Fixes: cff7d378d3fd "cpu/hotplug: Convert to a state machine for the control processor"
Link: http://lkml.kernel.org/r/alpine.DEB.2.11.1607122144560.4083@nanos
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 2acf7a3a4af4e9590f06bd89518c139d3a2884db
Author: Alexey Dobriyan
Date: Fri Jul 8 01:39:11 2016 +0300
posix\_cpu\_timer: Exit early when process has been reaped
commit 2c13ce8f6b2f6fd9ba2f9261b1939fc0f62d1307 upstream.
Variable "now" seems to be genuinely used unintialized
if branch
if (CPUCLOCK\_PERTHREAD(timer->it\_clock)) {
is not taken and branch
if (unlikely(sighand == NULL)) {
is taken. In this case the process has been reaped and the timer is marked as
disarmed anyway. So none of the postprocessing of the sample is
required. Return right away.
Signed-off-by: Alexey Dobriyan
Link: http://lkml.kernel.org/r/20160707223911.GA26483@p183.telecom.by
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 1031db3dff78793352bbda8ab5391def6f372aa4
Author: James Patrick-Evans
Date: Fri Jul 15 16:40:45 2016 +0100
media: fix airspy usb probe error path
commit aa93d1fee85c890a34f2510a310e55ee76a27848 upstream.
Fix a memory leak on probe error of the airspy usb device driver.
The problem is triggered when more than 64 usb devices register with
v4l2 of type VFL\_TYPE\_SDR or VFL\_TYPE\_SUBDEV.
The memory leak is caused by the probe function of the airspy driver
mishandeling errors and not freeing the corresponding control structures
when an error occours registering the device to v4l2 core.
A badusb device can emulate 64 of these devices, and then through
continual emulated connect/disconnect of the 65th device, cause the
kernel to run out of RAM and crash the kernel, thus causing a local DOS
vulnerability.
Fixes CVE-2016-5400
Signed-off-by: James Patrick-Evans
Reviewed-by: Kees Cook
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 602efc3c6731484a497871abf557290fe4d104be
Author: Brian King
Date: Mon Jun 27 09:09:40 2016 -0500
ipr: Clear interrupt on croc/crocodile when running with LSI
commit 54e430bbd490e18ab116afa4cd90dcc45787b3df upstream.
If we fall back to using LSI on the Croc or Crocodile chip we need to
clear the interrupt so we don't hang the system.
Tested-by: Benjamin Herrenschmidt
Signed-off-by: Brian King
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 224d3cc7716dac2372df2b52df78067b3482a751
Author: Alan Stern
Date: Thu Jun 23 15:05:26 2016 -0400
SCSI: fix new bug in scsi\_dev\_info\_list string matching
commit 5e7ff2ca7f2da55fe777167849d0c93403bd0dc8 upstream.
Commit b704f70ce200 ("SCSI: fix bug in scsi\_dev\_info\_list matching")
changed the way vendor- and model-string matching was carried out in the
routine that looks up entries in a SCSI devinfo list. The new matching
code failed to take into account the case of a maximum-length string; in
such cases it could end up testing for a terminating '\0' byte beyond
the end of the memory allocated to the string. This out-of-bounds bug
was detected by UBSAN.
I don't know if anybody has actually encountered this bug. The symptom
would be that a device entry in the blacklist might not be matched
properly if it contained an 8-character vendor name or a 16-character
model name. Such entries certainly exist in scsi\_static\_device\_list.
This patch fixes the problem by adding a check for a maximum-length
string before the '\0' test.
Signed-off-by: Alan Stern
Fixes: b704f70ce200 ("SCSI: fix bug in scsi\_dev\_info\_list matching")
Tested-by: Wilfried Klaebe
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit ddb2bdc5973d558a604a184cc6932434d2e54c84
Author: Bruno PrÃ©mont
Date: Thu Jun 30 17:00:32 2016 +0200
qla2xxx: Fix NULL pointer deref in QLA interrupt
commit 262e2bfd7d1e1f1ee48b870e5dfabb87c06b975e upstream.
In qla24xx\_process\_response\_queue() rsp->msix->cpuid may trigger NULL
pointer dereference when rsp->msix is NULL:
[ 5.622457] NULL pointer dereference at 0000000000000050
[ 5.622457] IP: [] qla24xx\_process\_response\_queue+0x44/0x4b0
[ 5.622457] PGD 0
[ 5.622457] Oops: 0000 [#1] SMP
[ 5.622457] Modules linked in:
[ 5.622457] CPU: 2 PID: 0 Comm: swapper/2 Not tainted 4.6.3-x86\_64 #1
[ 5.622457] Hardware name: HP ProLiant DL360 G5, BIOS P58 05/02/2011
[ 5.622457] task: ffff8801a88f3740 ti: ffff8801a8954000 task.ti: ffff8801a8954000
[ 5.622457] RIP: 0010:[] [] qla24xx\_process\_response\_queue+0x44/0x4b0
[ 5.622457] RSP: 0000:ffff8801afb03de8 EFLAGS: 00010002
[ 5.622457] RAX: 0000000000000000 RBX: 0000000000000032 RCX: 00000000ffffffff
[ 5.622457] RDX: 0000000000000002 RSI: ffff8801a79bf8c8 RDI: ffff8800c8f7e7c0
[ 5.622457] RBP: ffff8801afb03e68 R08: 0000000000000000 R09: 0000000000000000
[ 5.622457] R10: 00000000ffff8c47 R11: 0000000000000002 R12: ffff8801a79bf8c8
[ 5.622457] R13: ffff8800c8f7e7c0 R14: ffff8800c8f60000 R15: 0000000000018013
[ 5.622457] FS: 0000000000000000(0000) GS:ffff8801afb00000(0000) knlGS:0000000000000000
[ 5.622457] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 5.622457] CR2: 0000000000000050 CR3: 0000000001e07000 CR4: 00000000000006e0
[ 5.622457] Stack:
[ 5.622457] ffff8801afb03e30 ffffffff810c0f2d 0000000000000086 0000000000000002
[ 5.622457] ffff8801afb03e28 ffffffff816570e1 ffff8800c8994628 0000000000000002
[ 5.622457] ffff8801afb03e60 ffffffff816772d4 b47c472ad6955e68 0000000000000032
[ 5.622457] Call Trace:
[ 5.622457]
[ 5.622457] [] ? \_\_wake\_up\_common+0x4d/0x80
[ 5.622457] [] ? usb\_hcd\_resume\_root\_hub+0x51/0x60
[ 5.622457] [] ? uhci\_hub\_status\_data+0x64/0x240
[ 5.622457] [] qla24xx\_intr\_handler+0xf0/0x2e0
[ 5.622457] [] ? get\_next\_timer\_interrupt+0xce/0x200
[ 5.622457] [] handle\_irq\_event\_percpu+0x64/0x100
[ 5.622457] [] handle\_irq\_event+0x27/0x50
[ 5.622457] [] handle\_edge\_irq+0x65/0x140
[ 5.622457] [] handle\_irq+0x18/0x30
[ 5.622457] [] do\_IRQ+0x46/0xd0
[ 5.622457] [] common\_interrupt+0x7f/0x7f
[ 5.622457]
[ 5.622457] [] ? mwait\_idle+0x68/0x80
[ 5.622457] [] arch\_cpu\_idle+0xa/0x10
[ 5.622457] [] default\_idle\_call+0x27/0x30
[ 5.622457] [] cpu\_startup\_entry+0x19b/0x230
[ 5.622457] [] start\_secondary+0x136/0x140
[ 5.622457] Code: 00 00 65 48 8b 04 25 28 00 00 00 48 89 45 d0 31 c0 48 8b 47 58 a8 02 0f 84 c5 00 00 00 48 8b 46 50 49 89 f4 65 8b 15 34 bb aa 7e <39> 50 50 74 11 89 50 50 48 8b 46 50 8b 40 50 41 89 86 60 8b 00
[ 5.622457] RIP [] qla24xx\_process\_response\_queue+0x44/0x4b0
[ 5.622457] RSP
[ 5.622457] CR2: 0000000000000050
[ 5.622457] ---[ end trace fa2b19c25106d42b ]---
[ 5.622457] Kernel panic - not syncing: Fatal exception in interrupt
The affected code was introduced by commit cdb898c52d1dfad4b4800b83a58b3fe5d352edde
(qla2xxx: Add irq affinity notification).
Only dereference rsp->msix when it has been set so the machine can boot
fine. Possibly rsp->msix is unset because:
[ 3.479679] qla2xxx [0000:00:00.0]-0005: : QLogic Fibre Channel HBA Driver: 8.07.00.33-k.
[ 3.481839] qla2xxx [0000:13:00.0]-001d: : Found an ISP2432 irq 17 iobase 0xffffc90000038000.
[ 3.484081] qla2xxx [0000:13:00.0]-0035:0: MSI-X; Unsupported ISP2432 (0x2, 0x3).
[ 3.485804] qla2xxx [0000:13:00.0]-0037:0: Falling back-to MSI mode -258.
[ 3.890145] scsi host0: qla2xxx
[ 3.891956] qla2xxx [0000:13:00.0]-00fb:0: QLogic QLE2460 - PCI-Express Single Channel 4Gb Fibre Channel HBA.
[ 3.894207] qla2xxx [0000:13:00.0]-00fc:0: ISP2432: PCIe (2.5GT/s x4) @ 0000:13:00.0 hdma+ host#=0 fw=7.03.00 (9496).
[ 5.714774] qla2xxx [0000:13:00.0]-500a:0: LOOP UP detected (4 Gbps).
Signed-off-by: Bruno Prémont
Acked-by: Quinn Tran
Fixes: cdb898c52d1dfad4b4800b83a58b3fe5d352edde
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 4406733da539f95f29aaac164ab9051af1d5a923
Author: Paul Burton
Date: Tue Jul 5 14:26:00 2016 +0100
irqchip/mips-gic: Match IPI IRQ domain by bus token only
commit 547aefc4db877e65245c3d95fcce703701bf3a0c upstream.
Commit fbde2d7d8290 ("MIPS: Add generic SMP IPI support") introduced
code which calls irq\_find\_matching\_host with a NULL node parameter in
order to discover IPI IRQ domains which are not associated with the DT
root node's interrupt parent. This suggests that implementations of IPI
IRQ domains should effectively ignore the node parameter if it is NULL
and search purely based upon the bus token. Commit 2af70a962070
("irqchip/mips-gic: Add a IPI hierarchy domain") did not do this when
implementing the GIC IPI IRQ domain, and on MIPS Boston boards this
leads to no IPI domain being discovered and a NULL pointer dereference
when attempting to send an IPI:
CPU 0 Unable to handle kernel paging request at virtual address 0000000000000040, epc == ffffffff8016e70c, ra == ffffffff8010ff5c
Oops[#1]:
CPU: 0 PID: 1 Comm: swapper/0 Not tainted 4.7.0-rc6-00223-gad0d1b6 #945
task: a8000000ff066fc0 ti: a8000000ff068000 task.ti: a8000000ff068000
$ 0 : 0000000000000000 0000000000000001 ffffffff80730000 0000000000000003
$ 4 : 0000000000000000 ffffffff8057e5b0 a800000001e3ee00 0000000000000000
$ 8 : 0000000000000000 0000000000000023 0000000000000001 0000000000000001
$12 : 0000000000000000 ffffffff803323d0 0000000000000000 0000000000000000
$16 : 0000000000000000 0000000000000000 0000000000000001 ffffffff801108fc
$20 : 0000000000000000 ffffffff8057e5b0 0000000000000001 0000000000000000
$24 : 0000000000000000 ffffffff8012de28
$28 : a8000000ff068000 a8000000ff06fbc0 0000000000000000 ffffffff8010ff5c
Hi : ffffffff8014c174
Lo : a800000001e1e140
epc : ffffffff8016e70c \_\_ipi\_send\_mask+0x24/0x11c
ra : ffffffff8010ff5c mips\_smp\_send\_ipi\_mask+0x68/0x178
Status: 140084e2 KX SX UX KERNEL EXL
Cause : 00800008 (ExcCode 02)
BadVA : 0000000000000040
PrId : 0001a920 (MIPS I6400)
Process swapper/0 (pid: 1, threadinfo=a8000000ff068000, task=a8000000ff066fc0, tls=0000000000000000)
Stack : 0000000000000000 0000000000000000 0000000000000001 ffffffff801108fc
0000000000000000 ffffffff8057e5b0 0000000000000001 ffffffff8010ff5c
0000000000000001 0000000000000020 0000000000000000 0000000000000000
0000000000000000 ffffffff801108fc 0000000000000000 0000000000000001
0000000000000001 0000000000000000 0000000000000000 ffffffff801865e8
a8000000ff0c7500 a8000000ff06fc90 0000000000000001 0000000000000002
ffffffff801108fc ffffffff801868b8 0000000000000000 ffffffff801108fc
0000000000000000 0000000000000003 ffffffff8068c700 0000000000000001
ffffffff80730000 0000000000000001 a8000000ff00a290 ffffffff80110c50
0000000000000003 a800000001e48308 0000000000000003 0000000000000008
...
Call Trace:
[] \_\_ipi\_send\_mask+0x24/0x11c
[] mips\_smp\_send\_ipi\_mask+0x68/0x178
[] generic\_exec\_single+0x150/0x170
[] smp\_call\_function\_single+0x108/0x160
[] cps\_boot\_secondary+0x328/0x394
[] \_\_cpu\_up+0x38/0x90
[] bringup\_cpu+0x24/0xac
[] cpuhp\_up\_callbacks+0x58/0xdc
[] cpu\_up+0x118/0x18c
[] smp\_init+0xbc/0xe8
[] kernel\_init\_freeable+0xa0/0x228
[] kernel\_init+0x10/0xf0
[] ret\_from\_kernel\_thread+0x14/0x1c
Fix this by allowing the GIC IPI IRQ domain to match purely based upon
the bus token if the node provided is NULL.
Fixes: 2af70a962070 ("irqchip/mips-gic: Add a IPI hierarchy domain")
Signed-off-by: Paul Burton
Cc: linux-mips@linux-mips.org
Cc: Jason Cooper
Cc: Qais Yousef
Cc: Ralf Baechle
Cc: Marc Zyngier
Link: http://lkml.kernel.org/r/20160705132600.27730-2-paul.burton@imgtec.com
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit 42c33fde5406d14afd2db2b65aeb7314044b7430
Author: Paul Burton
Date: Tue Jul 5 14:25:59 2016 +0100
irqchip/mips-gic: Map to VPs using HW VPNum
commit 99ec8a3608330d202448085185cf28389b789b7b upstream.
When mapping an interrupt to a VP(E) we must use the identifier for the
VP that the hardware expects, and this does not always match up with the
Linux CPU number. Commit d46812bb0bef ("irqchip: mips-gic: Use HW IDs
for VPE\_OTHER\_ADDR") corrected this for the cases that existed at the
time it was written, but commit 2af70a962070 ("irqchip/mips-gic: Add a
IPI hierarchy domain") added another case before the former patch was
merged. This leads to incorrectly using Linux CPU numbers when mapping
interrupts to VPs, which breaks on certain systems such as those with
multi-core I6400 CPUs. Fix by adding the appropriate call to
mips\_cm\_vp\_id() to retrieve the expected VP identifier.
Fixes: d46812bb0bef ("irqchip: mips-gic: Use HW IDs for VPE\_OTHER\_ADDR")
Fixes: 2af70a962070 ("irqchip/mips-gic: Add a IPI hierarchy domain")
Signed-off-by: Paul Burton
Cc: linux-mips@linux-mips.org
Cc: Jason Cooper
Cc: Qais Yousef
Cc: Ralf Baechle
Cc: Marc Zyngier
Link: http://lkml.kernel.org/r/20160705132600.27730-1-paul.burton@imgtec.com
Signed-off-by: Thomas Gleixner
Signed-off-by: Greg Kroah-Hartman
commit d71872a9cf634d188cd92bd7df7e1958485d2e59
Author: Vegard Nossum
Date: Sun Jul 3 10:54:54 2016 +0200
RDS: fix rds\_tcp\_init() error path
commit 3dad5424adfb346c871847d467f97dcdca64ea97 upstream.
If register\_pernet\_subsys() fails, we shouldn't try to call
unregister\_pernet\_subsys().
Fixes: 467fa15356 ("RDS-TCP: Support multiple RDS-TCP listen endpoints, one per netns.")
Cc: Sowmini Varadhan
Cc: David S. Miller
Signed-off-by: Vegard Nossum
Acked-by: Sowmini Varadhan
Acked-by: Santosh Shilimkar
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit f3f8ae8b97c9dcae621eff74fd39cf45873d6621
Author: Oliver Hartkopp
Date: Tue Jun 21 15:45:47 2016 +0200
can: fix oops caused by wrong rtnl dellink usage
commit 25e1ed6e64f52a692ba3191c4fde650aab3ecc07 upstream.
For 'real' hardware CAN devices the netlink interface is used to set CAN
specific communication parameters. Real CAN hardware can not be created nor
removed with the ip tool ...
This patch adds a private dellink function for the CAN device driver interface
that does just nothing.
It's a follow up to commit 993e6f2fd ("can: fix oops caused by wrong rtnl
newlink usage") but for dellink.
Reported-by: ajneu
Signed-off-by: Oliver Hartkopp
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 171cf1dc83ea6ba43038a86ea455c04aee908282
Author: Oliver Hartkopp
Date: Tue Jun 21 12:14:07 2016 +0200
can: fix handling of unmodifiable configuration options fix
commit bce271f255dae8335dc4d2ee2c4531e09cc67f5a upstream.
With upstream commit bb208f144cf3f59 (can: fix handling of unmodifiable
configuration options) a new can\_validate() function was introduced.
When invoking 'ip link set can0 type can' without any configuration data
can\_validate() tries to validate the content without taking into account that
there's totally no content. This patch adds a check for missing content.
Reported-by: ajneu
Signed-off-by: Oliver Hartkopp
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 07562cc24b6312275a8b1e146066aafd496cf46e
Author: Thor Thayer
Date: Thu Jun 16 11:10:19 2016 -0500
can: c\_can: Update D\_CAN TX and RX functions to 32 bit - fix Altera Cyclone access
commit 427460c83cdf55069eee49799a0caef7dde8df69 upstream.
When testing CAN write floods on Altera's CycloneV, the first 2 bytes
are sometimes 0x00, 0x00 or corrupted instead of the values sent. Also
observed bytes 4 & 5 were corrupted in some cases.
The D\_CAN Data registers are 32 bits and changing from 16 bit writes to
32 bit writes fixes the problem.
Testing performed on Altera CycloneV (D\_CAN). Requesting tests on other
C\_CAN & D\_CAN platforms.
Reported-by: Richard Andrysek
Signed-off-by: Thor Thayer
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 88e08b416173652eecb33f1d87da68096b06b8b2
Author: Wolfgang Grandegger
Date: Mon Jun 13 15:44:19 2016 +0200
can: at91\_can: RX queue could get stuck at high bus load
commit 43200a4480cbbe660309621817f54cbb93907108 upstream.
At high bus load it could happen that "at91\_poll()" enters with all RX
message boxes filled up. If then at the end the "quota" is exceeded as
well, "rx\_next" will not be reset to the first RX mailbox and hence the
interrupts remain disabled.
Signed-off-by: Wolfgang Grandegger
Tested-by: Amr Bekhit
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 81dc160128e7d8a9e3d5a85657514cd9a110007d
Author: Peter Zijlstra
Date: Fri Jun 24 15:53:54 2016 +0200
sched/fair: Fix effective\_load() to consistently use smoothed load
commit 7dd4912594daf769a46744848b05bd5bc6d62469 upstream.
Starting with the following commit:
fde7d22e01aa ("sched/fair: Fix overly small weight for interactive group entities")
calc\_tg\_weight() doesn't compute the right value as expected by effective\_load().
The difference is in the 'correction' term. In order to ensure \Sum
rw\_j >= rw\_i we cannot use tg->load\_avg directly, since that might be
lagging a correction on the current cfs\_rq->avg.load\_avg value.
Therefore we use tg->load\_avg - cfs\_rq->tg\_load\_avg\_contrib +
cfs\_rq->avg.load\_avg.
Now, per the referenced commit, calc\_tg\_weight() doesn't use
cfs\_rq->avg.load\_avg, as is later used in @w, but uses
cfs\_rq->load.weight instead.
So stop using calc\_tg\_weight() and do it explicitly.
The effects of this bug are wake\_affine() making randomly
poor choices in cgroup-intense workloads.
Signed-off-by: Peter Zijlstra (Intel)
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Fixes: fde7d22e01aa ("sched/fair: Fix overly small weight for interactive group entities")
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 8815298c5f50008af8925cce8ce248f84b959926
Author: Taras Kondratiuk
Date: Wed Jul 13 22:05:38 2016 +0000
mmc: block: fix packed command header endianness
commit f68381a70bb2b26c31b13fdaf67c778f92fd32b4 upstream.
The code that fills packed command header assumes that CPU runs in
little-endian mode. Hence the header is malformed in big-endian mode
and causes MMC data transfer errors:
[ 563.200828] mmcblk0: error -110 transferring data, sector 2048, nr 8, cmd response 0x900, card status 0xc40
[ 563.219647] mmcblk0: packed cmd failed, nr 2, sectors 16, failure index: -1
Convert header data to LE.
Signed-off-by: Taras Kondratiuk
Fixes: ce39f9d17c14 ("mmc: support packed write command for eMMC4.5 devices")
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 5e8087b375595abe0f9dc53bdc902d5b08c54d8b
Author: Ville Viinikka
Date: Fri Jul 8 18:27:02 2016 +0300
mmc: block: fix free of uninitialized 'idata->buf'
commit bfe5b1b1e013f7b1c0fd2ac3b3c8c380114b3fb9 upstream.
Set 'idata->buf' to NULL so that it never gets returned without
initialization. This fixes a bug where mmc\_blk\_ioctl\_cmd() would
free both 'idata' and 'idata->buf' but 'idata->buf' was returned
uninitialized.
Fixes: 1ff8950c0433 ("mmc: block: change to use kmalloc when copy data from userspace")
Signed-off-by: Ville Viinikka
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 5c72cc56550a88bde12f6405c3448a17301aede8
Author: Omar Sandoval
Date: Fri Jul 1 00:39:35 2016 -0700
block: fix use-after-free in sys\_ioprio\_get()
commit 8ba8682107ee2ca3347354e018865d8e1967c5f4 upstream.
get\_task\_ioprio() accesses the task->io\_context without holding the task
lock and thus can race with exit\_io\_context(), leading to a
use-after-free. The reproducer below hits this within a few seconds on
my 4-core QEMU VM:
#define \_GNU\_SOURCE
#include
#include
#include
#include
int main(int argc, char \*\*argv)
{
pid\_t pid, child;
long nproc, i;
/\* ioprio\_set(IOPRIO\_WHO\_PROCESS, 0, IOPRIO\_PRIO\_VALUE(IOPRIO\_CLASS\_IDLE, 0)); \*/
syscall(SYS\_ioprio\_set, 1, 0, 0x6000);
nproc = sysconf(\_SC\_NPROCESSORS\_ONLN);
for (i = 0; i < nproc; i++) {
pid = fork();
assert(pid != -1);
if (pid == 0) {
for (;;) {
pid = fork();
assert(pid != -1);
if (pid == 0) {
\_exit(0);
} else {
child = wait(NULL);
assert(child == pid);
}
}
}
pid = fork();
assert(pid != -1);
if (pid == 0) {
for (;;) {
/\* ioprio\_get(IOPRIO\_WHO\_PGRP, 0); \*/
syscall(SYS\_ioprio\_get, 2, 0);
}
}
}
for (;;) {
/\* ioprio\_get(IOPRIO\_WHO\_PGRP, 0); \*/
syscall(SYS\_ioprio\_get, 2, 0);
}
return 0;
}
This gets us KASAN dumps like this:
[ 35.526914] ==================================================================
[ 35.530009] BUG: KASAN: out-of-bounds in get\_task\_ioprio+0x7b/0x90 at addr ffff880066f34e6c
[ 35.530009] Read of size 2 by task ioprio-gpf/363
[ 35.530009] =============================================================================
[ 35.530009] BUG blkdev\_ioc (Not tainted): kasan: bad access detected
[ 35.530009] -----------------------------------------------------------------------------
[ 35.530009] Disabling lock debugging due to kernel taint
[ 35.530009] INFO: Allocated in create\_task\_io\_context+0x2b/0x370 age=0 cpu=0 pid=360
[ 35.530009] \_\_\_slab\_alloc+0x55d/0x5a0
[ 35.530009] \_\_slab\_alloc.isra.20+0x2b/0x40
[ 35.530009] kmem\_cache\_alloc\_node+0x84/0x200
[ 35.530009] create\_task\_io\_context+0x2b/0x370
[ 35.530009] get\_task\_io\_context+0x92/0xb0
[ 35.530009] copy\_process.part.8+0x5029/0x5660
[ 35.530009] \_do\_fork+0x155/0x7e0
[ 35.530009] SyS\_clone+0x19/0x20
[ 35.530009] do\_syscall\_64+0x195/0x3a0
[ 35.530009] return\_from\_SYSCALL\_64+0x0/0x6a
[ 35.530009] INFO: Freed in put\_io\_context+0xe7/0x120 age=0 cpu=0 pid=1060
[ 35.530009] \_\_slab\_free+0x27b/0x3d0
[ 35.530009] kmem\_cache\_free+0x1fb/0x220
[ 35.530009] put\_io\_context+0xe7/0x120
[ 35.530009] put\_io\_context\_active+0x238/0x380
[ 35.530009] exit\_io\_context+0x66/0x80
[ 35.530009] do\_exit+0x158e/0x2b90
[ 35.530009] do\_group\_exit+0xe5/0x2b0
[ 35.530009] SyS\_exit\_group+0x1d/0x20
[ 35.530009] entry\_SYSCALL\_64\_fastpath+0x1a/0xa4
[ 35.530009] INFO: Slab 0xffffea00019bcd00 objects=20 used=4 fp=0xffff880066f34ff0 flags=0x1fffe0000004080
[ 35.530009] INFO: Object 0xffff880066f34e58 @offset=3672 fp=0x0000000000000001
[ 35.530009] ==================================================================
Fix it by grabbing the task lock while we poke at the io\_context.
Reported-by: Dmitry Vyukov
Signed-off-by: Omar Sandoval
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit ad2591f01326d64a286a7f6ddbfd9799c750f260
Author: Randy Dunlap
Date: Wed Jul 6 16:06:53 2016 -0700
init/Kconfig: keep Expert users menu together
commit 076501ff6ba265a473689c112eda9f1f34f620b5 upstream.
The "expert" menu was broken (split) such that all entries in it after
KALLSYMS were displayed in the "General setup" area instead of in the
"Expert users" area. Fix this by adding one kconfig dependency.
Yes, the Expert users menu is fragile. Problems like this have happened
several times in the past. I will attempt to isolate the Expert users
menu if there is interest in that.
Fixes: 4d5d5664c900 ("x86: kallsyms: disable absolute percpu symbols on !SMP")
Signed-off-by: Randy Dunlap
Cc: Ard Biesheuvel
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 635814d2eada5650825f92cfa292a8c22c65d10d
Author: Ursula Braun
Date: Mon Jul 4 14:07:16 2016 +0200
qeth: delete napi struct when removing a qeth device
commit 7831b4ff0d926e0deeaabef9db8800ed069a2757 upstream.
A qeth\_card contains a napi\_struct linked to the net\_device during
device probing. This struct must be deleted when removing the qeth
device, otherwise Panic on oops can occur when qeth devices are
repeatedly removed and added.
Fixes: a1c3ed4c9ca ("qeth: NAPI support for l2 and l3 discipline")
Signed-off-by: Ursula Braun
Tested-by: Alexander Klein
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 68b0cefc0358c3e3364fd520bf11c9c7b43be45b
Author: Dan Carpenter
Date: Tue Jun 21 16:58:46 2016 +0300
platform/chrome: cros\_ec\_dev - double fetch bug in ioctl
commit 096cdc6f52225835ff503f987a0d68ef770bb78e upstream.
We verify "u\_cmd.outsize" and "u\_cmd.insize" but we need to make sure
that those values have not changed between the two copy\_from\_user()
calls. Otherwise it could lead to a buffer overflow.
Additionally, cros\_ec\_cmd\_xfer() can set s\_cmd->insize to a lower value.
We should use the new smaller value so we don't copy too much data to
the user.
Reported-by: Pengfei Wang
Fixes: a841178445bb ('mfd: cros\_ec: Use a zero-length array for command data')
Signed-off-by: Dan Carpenter
Reviewed-by: Kees Cook
Tested-by: Gwendal Grignou
Signed-off-by: Olof Johansson
Signed-off-by: Greg Kroah-Hartman
commit f54a878c9946fd22a9d7b0088f3f15b5eee1e8b7
Author: Scott Mayhew
Date: Thu Jun 30 10:39:32 2016 -0400
lockd: unregister notifier blocks if the service fails to come up completely
commit cb7d224f82e41d82518e7f9ea271d215d4d08e6e upstream.
If the lockd service fails to start up then we need to be sure that the
notifier blocks are not registered, otherwise a subsequent start of the
service could cause the same notifier to be registered twice, leading to
soft lockups.
Signed-off-by: Scott Mayhew
Fixes: 0751ddf77b6a "lockd: Register callbacks on the inetaddr\_chain..."
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 3e70b591806a05176ed475af16b5f29023b6bb47
Author: Boris Brezillon
Date: Mon Jul 18 09:49:12 2016 +0200
clk: at91: fix clk\_programmable\_set\_parent()
commit f96423f483b1a7854270335b319e8d1cdd6f3585 upstream.
Since commit 1bdf02326b71e ("clk: at91: make use of syscon/regmap
internally"), clk\_programmable\_set\_parent() is always selecting the
first parent (AKA slow\_clk), no matter what's passed in the 'index'
parameter.
Fix that by initializing the pckr variable to the index value.
Signed-off-by: Boris Brezillon
Reported-by: Hans Verkuil
Fixes: 1bdf02326b71e ("clk: at91: make use of syscon/regmap internally")
Signed-off-by: Michael Turquette
Link: lkml.kernel.org/r/1468828152-18389-1-git-send-email-boris.brezillon@free-electrons.com
Signed-off-by: Greg Kroah-Hartman
commit 690a5f1e8e725a8eb799f281d08fcc3b7f3e2b4a
Author: Heiko Stuebner
Date: Tue May 17 20:57:50 2016 +0200
clk: rockchip: initialize flags of clk\_init\_data in mmc-phase clock
commit 595144c1141c951a3c6bb9004ae6a2bc29aad66f upstream.
The flags element of clk\_init\_data was never initialized for mmc-
phase-clocks resulting in the element containing a random value
and thus possibly enabling unwanted clock flags.
Fixes: 89bf26cbc1a0 ("clk: rockchip: Add support for the mmc clock phases using the framework")
Signed-off-by: Heiko Stuebner
Signed-off-by: Greg Kroah-Hartman
commit bb70d865a93137abda0f7925344dd9e0591b9677
Author: Michal Suchanek
Date: Mon Jun 13 17:46:49 2016 +0000
spi: sun4i: fix FIFO limit
commit 6d9fe44bd73d567d04d3a68a2d2fa521ab9532f2 upstream.
When testing SPI without DMA I noticed that filling the FIFO on the
spi controller causes timeout.
Always leave room for one byte in the FIFO.
Signed-off-by: Michal Suchanek
Acked-by: Maxime Ripard
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 3fe82d1e0b1c65c04c4b4f6cf330cae6b34ff6bc
Author: Michal Suchanek
Date: Mon Jun 13 17:46:49 2016 +0000
spi: sunxi: fix transfer timeout
commit 719bd6542044efd9b338a53dba1bef45f40ca169 upstream.
The trasfer timeout is fixed at 1000 ms. Reading a 4Mbyte flash over
1MHz SPI bus takes way longer than that. Calculate the timeout from the
actual time the transfer is supposed to take and multiply by 2 for good
measure.
Signed-off-by: Michal Suchanek
Acked-by: Maxime Ripard
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit ef40d3f3739dbee0178624c5a4e6cda3a92af99a
Author: Tomeu Vizoso
Date: Wed Jun 8 09:32:51 2016 +0200
spi: rockchip: Signal unfinished DMA transfers
commit 4dc0dd83603f05dc3ae152af33ecb15104c313f3 upstream.
When using DMA, the transfer\_one callback should return 1 because the
transfer hasn't finished yet.
A previous commit changed the function to return 0 when the DMA channels
were correctly prepared.
This manifested in Veyron boards with this message:
[ 1.983605] cros-ec-spi spi0.0: EC failed to respond in time
Fixes: ea9849113343 ("spi: rockchip: check return value of dmaengine\_prep\_slave\_sg")
Signed-off-by: Tomeu Vizoso
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 7b1789f9d96d273729dde7e66cb2d80153d53788
Author: Andrey Ulanov
Date: Fri Apr 15 14:24:41 2016 -0700
namespace: update event counter when umounting a deleted dentry
commit e06b933e6ded42384164d28a2060b7f89243b895 upstream.
- m\_start() in fs/namespace.c expects that ns->event is incremented each
time a mount added or removed from ns->list.
- umount\_tree() removes items from the list but does not increment event
counter, expecting that it's done before the function is called.
- There are some codepaths that call umount\_tree() without updating
"event" counter. e.g. from \_\_detach\_mounts().
- When this happens m\_start may reuse a cached mount structure that no
longer belongs to ns->list (i.e. use after free which usually leads
to infinite loop).
This change fixes the above problem by incrementing global event counter
before invoking umount\_tree().
Change-Id: I622c8e84dcb9fb63542372c5dbf0178ee86bb589
Signed-off-by: Andrey Ulanov
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit a0292a0f78ad08db0a9b8eaba19a25c2b4fa75d8
Author: Colin Ian King
Date: Mon Jun 20 15:40:27 2016 +0100
devpts: fix null pointer dereference on failed memory allocation
commit 5353ed8deedee9e5acb9f896e9032158f5d998de upstream.
An ENOMEM when creating a pair tty in tty\_ldisc\_setup causes a null
pointer dereference in devpts\_kill\_index because tty->link->driver\_data
is NULL. The oops was triggered with the pty stressor in stress-ng when
in a low memory condition.
tty\_init\_dev tries to clean up a tty\_ldisc\_setup ENOMEM error by calling
release\_tty, however, this ultimately tries to clean up the NULL pair'd
tty in pty\_unix98\_remove, triggering the Oops.
Add check to pty\_unix98\_remove to only clean up fsi if it is not NULL.
Ooops:
[ 23.020961] Oops: 0000 [#1] SMP
[ 23.020976] Modules linked in: ppdev snd\_hda\_codec\_generic snd\_hda\_intel snd\_hda\_codec parport\_pc snd\_hda\_core snd\_hwdep parport snd\_pcm input\_leds joydev snd\_timer serio\_raw snd soundcore i2c\_piix4 mac\_hid ib\_iser rdma\_cm iw\_cm ib\_cm ib\_core configfs iscsi\_tcp libiscsi\_tcp libiscsi scsi\_transport\_iscsi autofs4 btrfs raid10 raid456 async\_raid6\_recov async\_memcpy async\_pq async\_xor async\_tx xor raid6\_pq libcrc32c raid1 raid0 multipath linear crct10dif\_pclmul crc32\_pclmul ghash\_clmulni\_intel aesni\_intel qxl aes\_x86\_64 ttm lrw gf128mul glue\_helper ablk\_helper drm\_kms\_helper cryptd syscopyarea sysfillrect psmouse sysimgblt floppy fb\_sys\_fops drm pata\_acpi jitterentropy\_rng drbg ansi\_cprng
[ 23.020978] CPU: 0 PID: 1452 Comm: stress-ng-pty Not tainted 4.7.0-rc4+ #2
[ 23.020978] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS Ubuntu-1.8.2-1ubuntu1 04/01/2014
[ 23.020979] task: ffff88007ba30000 ti: ffff880078ea8000 task.ti: ffff880078ea8000
[ 23.020981] RIP: 0010:[] [] ida\_remove+0x1f/0x120
[ 23.020981] RSP: 0018:ffff880078eabb60 EFLAGS: 00010a03
[ 23.020982] RAX: 4444444444444567 RBX: 0000000000000000 RCX: 000000000000001f
[ 23.020982] RDX: 000000000000014c RSI: 000000000000026f RDI: 0000000000000000
[ 23.020982] RBP: ffff880078eabb70 R08: 0000000000000004 R09: 0000000000000036
[ 23.020983] R10: 000000000000026f R11: 0000000000000000 R12: 000000000000026f
[ 23.020983] R13: 000000000000026f R14: ffff88007c944b40 R15: 000000000000026f
[ 23.020984] FS: 00007f9a2f3cc700(0000) GS:ffff88007fc00000(0000) knlGS:0000000000000000
[ 23.020984] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 23.020985] CR2: 0000000000000010 CR3: 000000006c81b000 CR4: 00000000001406f0
[ 23.020988] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 23.020988] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[ 23.020988] Stack:
[ 23.020989] 0000000000000000 000000000000026f ffff880078eabb90 ffffffff812a5a99
[ 23.020990] 0000000000000000 00000000fffffff4 ffff880078eabba8 ffffffff814f9cbe
[ 23.020991] ffff88007965c800 ffff880078eabbc8 ffffffff814eef43 fffffffffffffff4
[ 23.020991] Call Trace:
[ 23.021000] [] devpts\_kill\_index+0x29/0x50
[ 23.021002] [] pty\_unix98\_remove+0x2e/0x50
[ 23.021006] [] release\_tty+0xb3/0x1b0
[ 23.021007] [] tty\_init\_dev+0xd4/0x1c0
[ 23.021011] [] ptmx\_open+0xae/0x190
[ 23.021013] [] chrdev\_open+0xbf/0x1b0
[ 23.021015] [] do\_dentry\_open+0x203/0x310
[ 23.021016] [] ? cdev\_put+0x30/0x30
[ 23.021017] [] vfs\_open+0x54/0x80
[ 23.021018] [] ? may\_open+0x8c/0x100
[ 23.021019] [] path\_openat+0x2eb/0x1440
[ 23.021020] [] ? putname+0x54/0x60
[ 23.021022] [] ? n\_tty\_ioctl\_helper+0x27/0x100
[ 23.021023] [] do\_filp\_open+0x91/0x100
[ 23.021024] [] ? getname\_flags+0x56/0x1f0
[ 23.021026] [] ? \_\_alloc\_fd+0x46/0x190
[ 23.021027] [] do\_sys\_open+0x124/0x210
[ 23.021028] [] SyS\_open+0x1e/0x20
[ 23.021035] [] entry\_SYSCALL\_64\_fastpath+0x1e/0xa8
[ 23.021044] Code: 63 28 45 31 e4 eb dd 0f 1f 44 00 00 55 4c 63 d6 48 ba 89 88 88 88 88 88 88 88 4c 89 d0 b9 1f 00 00 00 48 f7 e2 48 89 e5 41 54 53 <8b> 47 10 48 89 fb 8d 3c c5 00 00 00 00 48 c1 ea 09 b8 01 00 00
[ 23.021045] RIP [] ida\_remove+0x1f/0x120
[ 23.021045] RSP
[ 23.021046] CR2: 0000000000000010
Signed-off-by: Colin Ian King
Signed-off-by: Greg Kroah-Hartman
commit 4be5c33b5e44b3beb78100a94192e51d597e16a1
Author: Rafael J. Wysocki
Date: Tue Jun 28 03:29:29 2016 +0200
cpufreq: Avoid false-positive WARN\_ON()s in cpufreq\_update\_policy()
commit 742c87bf27d3b715820da6f8a81d6357adbf18f8 upstream.
CPU notifications from the firmware coming in when cpufreq is
suspended cause cpufreq\_update\_current\_freq() to return 0 which
triggers the WARN\_ON() in cpufreq\_update\_policy() for no reason.
Avoid that by checking cpufreq\_suspended before calling
cpufreq\_update\_current\_freq().
Fixes: c9d9c929e674 (cpufreq: Abort cpufreq\_update\_current\_freq() for cpufreq\_suspended set)
Signed-off-by: Rafael J. Wysocki
Acked-by: Viresh Kumar
Signed-off-by: Greg Kroah-Hartman
commit 8b592e2ac932c3fa110fc820e9b2c1dc6b67df9c
Author: Miklos Szeredi
Date: Wed Jun 29 10:54:23 2016 +0200
9p: use file\_dentry()
commit b403f0e37a11f84f7ceaf40b0075499e5bcfd220 upstream.
v9fs may be used as lower layer of overlayfs and accessing f\_path.dentry
can lead to a crash. In this case it's a NULL pointer dereference in
p9\_fid\_create().
Fix by replacing direct access of file->f\_path.dentry with the
file\_dentry() accessor, which will always return a native object.
Reported-by: Alessio Igor Bogani
Signed-off-by: Miklos Szeredi
Tested-by: Alessio Igor Bogani
Fixes: 4bacc9c9234c ("overlayfs: Make f\_path always point to the overlay and f\_inode to the underlay")
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit af2be3d2862a451797c58edc677df0a0bf34d302
Author: Vegard Nossum
Date: Fri Jul 15 00:22:07 2016 -0400
ext4: verify extent header depth
commit 7bc9491645118c9461bd21099c31755ff6783593 upstream.
Although the extent tree depth of 5 should enough be for the worst
case of 2\*32 extents of length 1, the extent tree code does not
currently to merge nodes which are less than half-full with a sibling
node, or to shrink the tree depth if possible. So it's possible, at
least in theory, for the tree depth to be greater than 5. However,
even in the worst case, a tree depth of 32 is highly unlikely, and if
the file system is maliciously corrupted, an insanely large eh\_depth
can cause memory allocation failures that will trigger kernel warnings
(here, eh\_depth = 65280):
JBD2: ext4.exe wants too many credits credits:195849 rsv\_credits:0 max:256
------------[ cut here ]------------
WARNING: CPU: 0 PID: 50 at fs/jbd2/transaction.c:293 start\_this\_handle+0x569/0x580
CPU: 0 PID: 50 Comm: ext4.exe Not tainted 4.7.0-rc5+ #508
Stack:
604a8947 625badd8 0002fd09 00000000
60078643 00000000 62623910 601bf9bc
62623970 6002fc84 626239b0 900000125
Call Trace:
[<6001c2dc>] show\_stack+0xdc/0x1a0
[<601bf9bc>] dump\_stack+0x2a/0x2e
[<6002fc84>] \_\_warn+0x114/0x140
[<6002fdff>] warn\_slowpath\_null+0x1f/0x30
[<60165829>] start\_this\_handle+0x569/0x580
[<60165d4e>] jbd2\_\_journal\_start+0x11e/0x220
[<60146690>] \_\_ext4\_journal\_start\_sb+0x60/0xa0
[<60120a81>] ext4\_truncate+0x131/0x3a0
[<60123677>] ext4\_setattr+0x757/0x840
[<600d5d0f>] notify\_change+0x16f/0x2a0
[<600b2b16>] do\_truncate+0x76/0xc0
[<600c3e56>] path\_openat+0x806/0x1300
[<600c55c9>] do\_filp\_open+0x89/0xf0
[<600b4074>] do\_sys\_open+0x134/0x1e0
[<600b4140>] SyS\_open+0x20/0x30
[<6001ea68>] handle\_syscall+0x88/0x90
[<600295fd>] userspace+0x3fd/0x500
[<6001ac55>] fork\_handler+0x85/0x90
---[ end trace 08b0b88b6387a244 ]---
[ Commit message modified and the extent tree depath check changed
from 5 to 32 -- tytso ]
Cc: Darrick J. Wong
Signed-off-by: Vegard Nossum
Signed-off-by: Theodore Ts'o
Signed-off-by: Greg Kroah-Hartman
commit f7803b2f5df81030a22ffce4cddd79423d61f099
Author: Jeff Mahoney
Date: Tue Jul 5 17:32:30 2016 -0400
ecryptfs: don't allow mmap when the lower fs doesn't support it
commit f0fe970df3838c202ef6c07a4c2b36838ef0a88b upstream.
There are legitimate reasons to disallow mmap on certain files, notably
in sysfs or procfs. We shouldn't emulate mmap support on file systems
that don't offer support natively.
CVE-2016-1583
Signed-off-by: Jeff Mahoney
[tyhicks: clean up f\_op check by using ecryptfs\_file\_to\_lower()]
Signed-off-by: Tyler Hicks
Signed-off-by: Greg Kroah-Hartman
commit 9cd0ae8d3c586eb52190f2ac45570045fe710bd3
Author: Jeff Mahoney
Date: Tue Jul 5 17:32:29 2016 -0400
Revert "ecryptfs: forbid opening files without mmap handler"
commit 78c4e172412de5d0456dc00d2b34050aa0b683b5 upstream.
This reverts commit 2f36db71009304b3f0b95afacd8eba1f9f046b87.
It fixed a local root exploit but also introduced a dependency on
the lower file system implementing an mmap operation just to open a file,
which is a bit of a heavy hammer. The right fix is to have mmap depend
on the existence of the mmap handler instead.
Signed-off-by: Jeff Mahoney
Signed-off-by: Tyler Hicks
Signed-off-by: Greg Kroah-Hartman
commit e629d6d9094e8fb10c906061525dda3f86705d27
Author: Miklos Szeredi
Date: Fri Jul 1 14:56:07 2016 +0200
locks: use file\_inode()
commit 6343a2120862f7023006c8091ad95c1f16a32077 upstream.
(Another one for the f\_path debacle.)
ltp fcntl33 testcase caused an Oops in selinux\_file\_send\_sigiotask.
The reason is that generic\_add\_lease() used filp->f\_path.dentry->inode
while all the others use file\_inode(). This makes a difference for files
opened on overlayfs since the former will point to the overlay inode the
latter to the underlying inode.
So generic\_add\_lease() added the lease to the overlay inode and
generic\_delete\_lease() removed it from the underlying inode. When the file
was released the lease remained on the overlay inode's lock list, resulting
in use after free.
Reported-by: Eryu Guan
Fixes: 4bacc9c9234c ("overlayfs: Make f\_path always point to the overlay and f\_inode to the underlay")
Signed-off-by: Miklos Szeredi
Reviewed-by: Jeff Layton
Signed-off-by: J. Bruce Fields
Signed-off-by: Greg Kroah-Hartman
commit 3f0f77b6bb4fa56f6b22610f11d75464ac65743c
Author: Rhyland Klein
Date: Thu Jun 9 17:28:39 2016 -0400
power\_supply: power\_supply\_read\_temp only if use\_cnt > 0
commit 5bc28b93a36e3cb3acc2870fb75cb6ffb182fece upstream.
Change power\_supply\_read\_temp() to use power\_supply\_get\_property()
so that it will check the use\_cnt and ensure it is > 0. The use\_cnt
will be incremented at the end of \_\_power\_supply\_register, so this
will block to case where get\_property can be called before the supply
is fully registered. This fixes the issue show in the stack below:
[ 1.452598] power\_supply\_read\_temp+0x78/0x80
[ 1.458680] thermal\_zone\_get\_temp+0x5c/0x11c
[ 1.464765] thermal\_zone\_device\_update+0x34/0xb4
[ 1.471195] thermal\_zone\_device\_register+0x87c/0x8cc
[ 1.477974] \_\_power\_supply\_register+0x364/0x424
[ 1.484317] power\_supply\_register\_no\_ws+0x10/0x18
[ 1.490833] bq27xxx\_battery\_setup+0x10c/0x164
[ 1.497003] bq27xxx\_battery\_i2c\_probe+0xd0/0x1b0
[ 1.503435] i2c\_device\_probe+0x174/0x240
[ 1.509172] driver\_probe\_device+0x1fc/0x29c
[ 1.515167] \_\_driver\_attach+0xa4/0xa8
[ 1.520643] bus\_for\_each\_dev+0x58/0x98
[ 1.526204] driver\_attach+0x20/0x28
[ 1.531505] bus\_add\_driver+0x1c8/0x22c
[ 1.537067] driver\_register+0x68/0x108
[ 1.542630] i2c\_register\_driver+0x38/0x7c
[ 1.548457] bq27xxx\_battery\_i2c\_driver\_init+0x18/0x20
[ 1.555321] do\_one\_initcall+0x38/0x12c
[ 1.560886] kernel\_init\_freeable+0x148/0x1ec
[ 1.566972] kernel\_init+0x10/0xfc
[ 1.572101] ret\_from\_fork+0x10/0x40
Also make the same change to ps\_get\_max\_charge\_cntl\_limit() and
ps\_get\_cur\_chrage\_cntl\_limit() to be safe. Lastly, change the return
value of power\_supply\_get\_property() to -EAGAIN from -ENODEV if
use\_cnt <= 0.
Fixes: 297d716f6260 ("power\_supply: Change ownership from driver to core")
Signed-off-by: Rhyland Klein
Reviewed-by: Krzysztof Kozlowski
Signed-off-by: Sebastian Reichel
Signed-off-by: Greg Kroah-Hartman
commit 2644b9787694c3e18fc82ec74087daf15eef3249
Author: Daniel Bristot de Oliveira
Date: Wed Jun 22 17:28:41 2016 -0300
cgroup: Disable IRQs while holding css\_set\_lock
commit 82d6489d0fed2ec8a8c48c19e8d8a04ac8e5bb26 upstream.
While testing the deadline scheduler + cgroup setup I hit this
warning.
[ 132.612935] ------------[ cut here ]------------
[ 132.612951] WARNING: CPU: 5 PID: 0 at kernel/softirq.c:150 \_\_local\_bh\_enable\_ip+0x6b/0x80
[ 132.612952] Modules linked in: (a ton of modules...)
[ 132.612981] CPU: 5 PID: 0 Comm: swapper/5 Not tainted 4.7.0-rc2 #2
[ 132.612981] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.8.2-20150714\_191134- 04/01/2014
[ 132.612982] 0000000000000086 45c8bb5effdd088b ffff88013fd43da0 ffffffff813d229e
[ 132.612984] 0000000000000000 0000000000000000 ffff88013fd43de0 ffffffff810a652b
[ 132.612985] 00000096811387b5 0000000000000200 ffff8800bab29d80 ffff880034c54c00
[ 132.612986] Call Trace:
[ 132.612987]  [] dump\_stack+0x63/0x85
[ 132.612994] [] \_\_warn+0xcb/0xf0
[ 132.612997] [] ? push\_dl\_task.part.32+0x170/0x170
[ 132.612999] [] warn\_slowpath\_null+0x1d/0x20
[ 132.613000] [] \_\_local\_bh\_enable\_ip+0x6b/0x80
[ 132.613008] [] \_raw\_write\_unlock\_bh+0x1a/0x20
[ 132.613010] [] \_raw\_spin\_unlock\_bh+0xe/0x10
[ 132.613015] [] put\_css\_set+0x5c/0x60
[ 132.613016] [] cgroup\_free+0x7f/0xa0
[ 132.613017] [] \_\_put\_task\_struct+0x42/0x140
[ 132.613018] [] dl\_task\_timer+0xca/0x250
[ 132.613027] [] ? push\_dl\_task.part.32+0x170/0x170
[ 132.613030] [] \_\_hrtimer\_run\_queues+0xee/0x270
[ 132.613031] [] hrtimer\_interrupt+0xa8/0x190
[ 132.613034] [] local\_apic\_timer\_interrupt+0x38/0x60
[ 132.613035] [] smp\_apic\_timer\_interrupt+0x3d/0x50
[ 132.613037] [] apic\_timer\_interrupt+0x8c/0xa0
[ 132.613038]  [] ? native\_safe\_halt+0x6/0x10
[ 132.613043] [] default\_idle+0x1e/0xd0
[ 132.613044] [] arch\_cpu\_idle+0xf/0x20
[ 132.613046] [] default\_idle\_call+0x2a/0x40
[ 132.613047] [] cpu\_startup\_entry+0x2e7/0x340
[ 132.613048] [] start\_secondary+0x155/0x190
[ 132.613049] ---[ end trace f91934d162ce9977 ]---
The warn is the spin\_(lock|unlock)\_bh(&css\_set\_lock) in the interrupt
context. Converting the spin\_lock\_bh to spin\_lock\_irq(save) to avoid
this problem - and other problems of sharing a spinlock with an
interrupt.
Cc: Tejun Heo
Cc: Li Zefan
Cc: Johannes Weiner
Cc: Juri Lelli
Cc: Steven Rostedt
Cc: cgroups@vger.kernel.org
Cc: linux-kernel@vger.kernel.org
Reviewed-by: Rik van Riel
Reviewed-by: "Luis Claudio R. Goncalves"
Signed-off-by: Daniel Bristot de Oliveira
Acked-by: Zefan Li
Signed-off-by: Tejun Heo
Signed-off-by: Greg Kroah-Hartman
commit 65856851b6229563e43e256b3932d5c8513c047b
Author: Tejun Heo
Date: Thu May 26 15:42:13 2016 -0400
cgroup: set css->id to -1 during init
commit 8fa3b8d689a54d6d04ff7803c724fb7aca6ce98e upstream.
If percpu\_ref initialization fails during css\_create(), the free path
can end up trying to free css->id of zero. As ID 0 is unused, it
doesn't cause a critical breakage but it does trigger a warning
message. Fix it by setting css->id to -1 from init\_and\_link\_css().
Signed-off-by: Tejun Heo
Cc: Wenwei Tao
Fixes: 01e586598b22 ("cgroup: release css->id after css\_free")
Signed-off-by: Tejun Heo
Signed-off-by: Greg Kroah-Hartman
commit 64e7dc481cbb34dcf11623905d54e67fe7ffd035
Author: Wenwei Tao
Date: Fri May 13 22:59:20 2016 +0800
cgroup: remove redundant cleanup in css\_create
commit b00c52dae6d9ee8d0f2407118ef6544ae5524781 upstream.
When create css failed, before call css\_free\_rcu\_fn, we remove the css
id and exit the percpu\_ref, but we will do these again in
css\_free\_work\_fn, so they are redundant. Especially the css id, that
would cause problem if we remove it twice, since it may be assigned to
another css after the first remove.
tj: This was broken by two commits updating the free path without
synchronizing the creation failure path. This can be easily
triggered by trying to create more than 64k memory cgroups.
Signed-off-by: Wenwei Tao
Signed-off-by: Tejun Heo
Cc: Vladimir Davydov
Fixes: 9a1049da9bd2 ("percpu-refcount: require percpu\_ref to be exited explicitly")
Fixes: 01e586598b22 ("cgroup: release css->id after css\_free")
Signed-off-by: Greg Kroah-Hartman
commit 03cbdca3b8e2eb27f54d1d5831e07835df7f8fb4
Author: Alexander Shiyan
Date: Wed Jun 1 22:21:53 2016 +0300
pinctrl: imx: Do not treat a PIN without MUX register as an error
commit ba562d5e54fd3136bfea0457add3675850247774 upstream.
Some PINs do not have a MUX register, it is not an error.
It is necessary to allow the continuation of the PINs configuration,
otherwise the whole PIN-group will be configured incorrectly.
Signed-off-by: Alexander Shiyan
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit 4d5ce0095e067fac3f5e9aae1d8c6cb6911c52fa
Author: Tony Lindgren
Date: Tue May 31 14:17:06 2016 -0700
pinctrl: single: Fix missing flush of posted write for a wakeirq
commit 0ac3c0a4025f41748a083bdd4970cb3ede802b15 upstream.
With many repeated suspend resume cycles, the pin specific wakeirq
may not always work on omaps. This is because the write to enable the
pin interrupt may not have reached the device over the interconnect
before suspend happens.
Let's fix the issue with a flush of posted write with a readback.
Reported-by: Nishanth Menon
Signed-off-by: Tony Lindgren
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit c02b2ac1db18efb0ba2a596b6b1c2263a7453cbc
Author: Minfei Huang
Date: Fri May 27 14:17:10 2016 +0800
pvclock: Add CPU barriers to get correct version value
commit 749d088b8e7f4b9826ede02b9a043e417fa84aa1 upstream.
Protocol for the "version" fields is: hypervisor raises it (making it
uneven) before it starts updating the fields and raises it again (making
it even) when it is done. Thus the guest can make sure the time values
it got are consistent by checking the version before and after reading
them.
Add CPU barries after getting version value just like what function
vread\_pvclock does, because all of callees in this function is inline.
Fixes: 502dfeff239e8313bfbe906ca0a1a6827ac8481b
Signed-off-by: Minfei Huang
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit d056c1c7922bf20badf237ec27a389d65d21e24d
Author: Michael Welling
Date: Wed Jul 20 10:02:07 2016 -0700
Input: tsc200x - report proper input\_dev name
commit e9003c9cfaa17d26991688268b04244adb67ee2b upstream.
Passes input\_id struct to the common probe function for the tsc200x drivers
instead of just the bustype.
This allows for the use of the product variable to set the input\_dev->name
variable according to the type of touchscreen used. Note that when we
introduced support for TSC2004 we started calling everything TSC200X, so
let's keep this quirk.
Signed-off-by: Michael Welling
Acked-by: Pavel Machek
Acked-by: Pali Rohár
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 99d5232769dad5927482452cd0f1820479968aa1
Author: Andrew Duggan
Date: Tue Jul 19 17:53:59 2016 -0700
Input: synaptics-rmi4 - fix maximum size check for F12 control register 8
commit e4add7b6beaff4061693d0632bc1dcb306edba10 upstream.
According to the RMI4 spec the maximum size of F12 control register 8 is
15 bytes. The current code incorrectly reports an error if control 8 is
greater then 14. Making sensors with a control register 8 with 15 bytes
unusable.
Signed-off-by: Andrew Duggan
Reported-by: Chris Healy
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 0cc1789ce9d3360e7fb1482ea3fb6237efbc5d5a
Author: Dmitry Torokhov
Date: Thu Jul 14 09:33:41 2016 -0700
Revert "Input: wacom\_w8001 - drop use of ABS\_MT\_TOOL\_TYPE"
commit 3e9161bfe0482f26efeaf584d5fd69398c69313c upstream.
This reverts commit 5f7e5445a2de848c66d2d80ba5479197e8287c33 because
removal of input\_mt\_report\_slot\_state() means we no longer generate
tracking IDs for the reported contacts.
Acked-by: Peter Hutterer
Acked-by: Ping Cheng
commit 8316597e28d8d516ac9b7ec1ca90abc7c2aa1f6a
Author: Cameron Gutman
Date: Wed Jun 29 09:51:35 2016 -0700
Input: xpad - validate USB endpoint count during probe
commit caca925fca4fb30c67be88cacbe908eec6721e43 upstream.
This prevents a malicious USB device from causing an oops.
Signed-off-by: Cameron Gutman
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit fccb889282f611ad71f9b45ed3e36d9a262f4815
Author: Ping Cheng
Date: Thu Jun 23 10:55:11 2016 -0700
Input: wacom\_w8001 - ignore invalid pen data packets
commit 9e72ac7492149a229ce9039c680849cb682d7092 upstream.
ThinkPad X60 Tablet PC (pen only device) sometime posts
packets that are larger than W8001\_PKTLEN\_TPCPEN.
Reported-by: Chris J Arges
Tested-by: Chris J Arges
Signed-off-by: Ping Cheng
Reviewed-by: Peter Hutterer
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit d80f15e3de301d0dafa2568d236b5689092715f3
Author: Ping Cheng
Date: Thu Jun 23 10:54:17 2016 -0700
Input: wacom\_w8001 - w8001\_MAX\_LENGTH should be 13
commit 12afb34400eb2b301f06b2aa3535497d14faee59 upstream.
Somehow the patch that added two-finger touch support forgot to update
W8001\_MAX\_LENGTH from 11 to 13.
Signed-off-by: Ping Cheng
Reviewed-by: Peter Hutterer
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 28a4cb13ed87553992a095c2390e37ccdaf3a292
Author: Cameron Gutman
Date: Thu Jun 23 10:24:42 2016 -0700
Input: xpad - fix oops when attaching an unknown Xbox One gamepad
commit c7f1429389ec1aa25e042bb13451385fbb596f8c upstream.
Xbox One controllers have multiple interfaces which all have the
same class, subclass, and protocol. One of the these interfaces
has only a single endpoint. When Xpad attempts to bind to this
interface, it causes an oops when trying initialize the output URB
by trying to access the second endpoint's descriptor.
This situation was avoided for known Xbox One devices by checking
the XTYPE constant associated with the VID and PID tuple. However,
this breaks when new or previously unknown Xbox One controllers
are attached to the system.
This change addresses the problem by deriving the XTYPE for Xbox
One controllers based on the interface protocol before checking
the interface number.
Fixes: 1a48ff81b391 ("Input: xpad - add support for Xbox One controllers")
Signed-off-by: Cameron Gutman
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit a4c41dfb5f909138a30f84d47086f613a9409126
Author: Dmitry Torokhov
Date: Tue Jun 21 16:09:00 2016 -0700
Input: elantech - add more IC body types to the list
commit 226ba707744a51acb4244724e09caacb1d96aed9 upstream.
The touchpad in HP Pavilion 14-ab057ca reports it's version as 12 and
according to Elan both 11 and 12 are valid IC types and should be
identified as hw\_version 4.
Reported-by: Patrick Lessard
Tested-by: Patrick Lessard
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit bc05227cbb15b8a5107ddfac102a19b1ba72b4c0
Author: Sinclair Yeh
Date: Thu Jun 23 17:37:34 2016 -0700
Input: vmmouse - remove port reservation
commit 60842ef8128e7bf58c024814cd0dc14319232b6c upstream.
The VMWare EFI BIOS will expose port 0x5658 as an ACPI resource. This
causes the port to be reserved by the APCI module as the system comes up,
making it unavailable to be reserved again by other drivers, thus
preserving this VMWare port for special use in a VMWare guest.
This port is designed to be shared among multiple VMWare services, such as
the VMMOUSE. Because of this, VMMOUSE should not try to reserve this port
on its own.
The VMWare non-EFI BIOS does not do this to preserve compatibility with
existing/legacy VMs. It is known that there is small chance a VM may be
configured such that these ports get reserved by other non-VMWare devices,
and if this ever happens, the result is undefined.
Signed-off-by: Sinclair Yeh
Reviewed-by: Thomas Hellstrom
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 1fae440a4f2276050264c6f7029ac5740fa6f932
Author: Kangjie Lu
Date: Tue May 3 16:44:32 2016 -0400
ALSA: timer: Fix leak in events via snd\_timer\_user\_tinterrupt
commit e4ec8cc8039a7063e24204299b462bd1383184a5 upstream.
The stack object “r1” has a total size of 32 bytes. Its field
“event” and “val” both contain 4 bytes padding. These 8 bytes
padding bytes are sent to user without being initialized.
Signed-off-by: Kangjie Lu
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 5b6fc00bb4ae7e917519b4fb49c9d3befa3897e5
Author: Kangjie Lu
Date: Tue May 3 16:44:20 2016 -0400
ALSA: timer: Fix leak in events via snd\_timer\_user\_ccallback
commit 9a47e9cff994f37f7f0dbd9ae23740d0f64f9fe6 upstream.
The stack object “r1” has a total size of 32 bytes. Its field
“event” and “val” both contain 4 bytes padding. These 8 bytes
padding bytes are sent to user without being initialized.
Signed-off-by: Kangjie Lu
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 82a638a293d7f0a699d88fe669a43829e65b0911
Author: Kangjie Lu
Date: Tue May 3 16:44:07 2016 -0400
ALSA: timer: Fix leak in SNDRV\_TIMER\_IOCTL\_PARAMS
commit cec8f96e49d9be372fdb0c3836dcf31ec71e457e upstream.
The stack object “tread” has a total size of 32 bytes. Its field
“event” and “val” both contain 4 bytes padding. These 8 bytes
padding bytes are sent to user without being initialized.
Signed-off-by: Kangjie Lu
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 2e9aedc4a304dbb2fb99b77528ace3f7e9f6c71e
Author: Bob Liu
Date: Tue Jun 7 10:43:15 2016 -0400
xen-blkfront: don't call talk\_to\_blkback when already connected to blkback
commit efd1535270c1deb0487527bf0c3c827301a69c93 upstream.
Sometimes blkfront may twice receive blkback\_changed() notification
(XenbusStateConnected) after migration, which will cause
talk\_to\_blkback() to be called twice too and confuse xen-blkback.
The flow is as follow:
blkfront blkback
blkfront\_resume()
> talk\_to\_blkback()
> Set blkfront to XenbusStateInitialised
front changed()
> Connect()
> Set blkback to XenbusStateConnected
blkback\_changed()
> Skip talk\_to\_blkback()
because frontstate == XenbusStateInitialised
> blkfront\_connect()
> Set blkfront to XenbusStateConnected
-----
And here we get another XenbusStateConnected notification leading
to:
-----
blkback\_changed()
> because now frontstate != XenbusStateInitialised
talk\_to\_blkback() is also called again
> blkfront state changed from
XenbusStateConnected to XenbusStateInitialised
(Which is not correct!)
front\_changed():
> Do nothing because blkback
already in XenbusStateConnected
Now blkback is in XenbusStateConnected but blkfront is still
in XenbusStateInitialised - leading to no disks.
Poking of the XenbusStateConnected state is allowed (to deal with
block disk change) and has to be dealt with. The most likely
cause of this bug are custom udev scripts hooking up the disks
and then validating the size.
Signed-off-by: Bob Liu
Signed-off-by: Konrad Rzeszutek Wilk
Signed-off-by: Greg Kroah-Hartman
commit 1d8d6ed641f6ead2397db38f0a038a40d8483151
Author: Bob Liu
Date: Tue May 31 16:59:17 2016 +0800
xen-blkfront: fix resume issues after a migration
commit 2a6f71ad99cabe436e70c3f5fcf58072cb3bc07f upstream.
After a migrate to another host (which may not have multiqueue
support), the number of rings (block hardware queues)
may be changed and the ring info structure will also be reallocated.
This patch fixes two related bugs:
\* call blk\_mq\_update\_nr\_hw\_queues() to make blk-core know the number
of hardware queues have been changed.
\* Don't store rinfo pointer to hctx->driver\_data, because rinfo may be
reallocated so use hctx->queue\_num to get the rinfo structure instead.
Signed-off-by: Bob Liu
Signed-off-by: Konrad Rzeszutek Wilk
Signed-off-by: Greg Kroah-Hartman
commit 77bdc603be5635bee65c8cb2e5a78a20d9c15623
Author: Jan Beulich
Date: Thu Jul 7 01:32:04 2016 -0600
xenbus: don't bail early from xenbus\_dev\_request\_and\_reply()
commit 7469be95a487319514adce2304ad2af3553d2fc9 upstream.
xenbus\_dev\_request\_and\_reply() needs to track whether a transaction is
open. For XS\_TRANSACTION\_START messages it calls transaction\_start()
and for XS\_TRANSACTION\_END messages it calls transaction\_end().
If sending an XS\_TRANSACTION\_START message fails or responds with an
an error, the transaction is not open and transaction\_end() must be
called.
If sending an XS\_TRANSACTION\_END message fails, the transaction is
still open, but if an error response is returned the transaction is
closed.
Commit 027bd7e89906 ("xen/xenbus: Avoid synchronous wait on XenBus
stalling shutdown/restart") introduced a regression where failed
XS\_TRANSACTION\_START messages were leaving the transaction open. This
can cause problems with suspend (and migration) as all transactions
must be closed before suspending.
It appears that the problematic change was added accidentally, so just
remove it.
Signed-off-by: Jan Beulich
Cc: Konrad Rzeszutek Wilk
Signed-off-by: David Vrabel
Signed-off-by: Greg Kroah-Hartman
commit e8f5fe05d92952b19490e4d4567f4e2ecfa9045a
Author: Jan Beulich
Date: Thu Jul 7 01:23:57 2016 -0600
xenbus: don't BUG() on user mode induced condition
commit 0beef634b86a1350c31da5fcc2992f0d7c8a622b upstream.
Inability to locate a user mode specified transaction ID should not
lead to a kernel crash. For other than XS\_TRANSACTION\_START also
don't issue anything to xenbus if the specified ID doesn't match that
of any active transaction.
Signed-off-by: Jan Beulich
Signed-off-by: David Vrabel
Signed-off-by: Greg Kroah-Hartman
commit 61675789a6eaa26ce34c2535bf9122d6750a9fde
Author: Bob Liu
Date: Mon Jun 27 16:33:24 2016 +0800
xen-blkfront: save uncompleted reqs in blkfront\_resume()
commit 7b427a59538a98161321aa46c13f4ea81b43f4eb upstream.
Uncompleted reqs used to be 'saved and resubmitted' in blkfront\_recover() during
migration, but that's too late after multi-queue was introduced.
After a migrate to another host (which may not have multiqueue support), the
number of rings (block hardware queues) may be changed and the ring and shadow
structure will also be reallocated.
The blkfront\_recover() then can't 'save and resubmit' the real
uncompleted reqs because shadow structure have been reallocated.
This patch fixes this issue by moving the 'save' logic out of
blkfront\_recover() to earlier place in blkfront\_resume().
The 'resubmit' is not changed and still in blkfront\_recover().
Signed-off-by: Bob Liu
Signed-off-by: Konrad Rzeszutek Wilk
Signed-off-by: Greg Kroah-Hartman
commit 45e4b7047a524ccdf3a7d5334c4835603036b494
Author: Andrey Grodzovsky
Date: Tue Jun 21 14:26:36 2016 -0400
xen/pciback: Fix conf\_space read/write overlap check.
commit 02ef871ecac290919ea0c783d05da7eedeffc10e upstream.
Current overlap check is evaluating to false a case where a filter
field is fully contained (proper subset) of a r/w request. This
change applies classical overlap check instead to include all the
scenarios.
More specifically, for (Hilscher GmbH CIFX 50E-DP(M/S)) device driver
the logic is such that the entire confspace is read and written in 4
byte chunks. In this case as an example, CACHE\_LINE\_SIZE,
LATENCY\_TIMER and PCI\_BIST are arriving together in one call to
xen\_pcibk\_config\_write() with offset == 0xc and size == 4. With the
exsisting overlap check the LATENCY\_TIMER field (offset == 0xd, length
== 1) is fully contained in the write request and hence is excluded
from write, which is incorrect.
Signed-off-by: Andrey Grodzovsky
Reviewed-by: Boris Ostrovsky
Reviewed-by: Jan Beulich
Signed-off-by: David Vrabel
Signed-off-by: Greg Kroah-Hartman
commit 4d1fa7a0c5b83665a680fba6af948aa4c7952419
Author: Vineet Gupta
Date: Tue Jun 28 09:42:25 2016 +0530
ARC: unwind: ensure that .debug\_frame is generated (vs. .eh\_frame)
commit f52e126cc7476196f44f3c313b7d9f0699a881fc upstream.
With recent binutils update to support dwarf CFI pseudo-ops in gas, we
now get .eh\_frame vs. .debug\_frame. Although the call frame info is
exactly the same in both, the CIE differs, which the current kernel
unwinder can't cope with.
This broke both the kernel unwinder as well as loadable modules (latter
because of a new unhandled relo R\_ARC\_32\_PCREL from .rela.eh\_frame in
the module loader)
The ideal solution would be to switch unwinder to .eh\_frame.
For now however we can make do by just ensureing .debug\_frame is
generated by removing -fasynchronous-unwind-tables
.eh\_frame generated with -gdwarf-2 -fasynchronous-unwind-tables
.debug\_frame generated with -gdwarf-2
Fixes STAR 9001058196
Signed-off-by: Vineet Gupta
Signed-off-by: Greg Kroah-Hartman
commit bcd07ba65a34c21de49e164f2c86352a60dc21d7
Author: Alexey Brodkin
Date: Thu Jun 23 11:00:39 2016 +0300
arc: unwind: warn only once if DW2\_UNWIND is disabled
commit 9bd54517ee86cb164c734f72ea95aeba4804f10b upstream.
If CONFIG\_ARC\_DW2\_UNWIND is disabled every time arc\_unwind\_core()
gets called following message gets printed in debug console:
----------------->8---------------
CONFIG\_ARC\_DW2\_UNWIND needs to be enabled
----------------->8---------------
That message makes sense if user indeed wants to see a backtrace or
get nice function call-graphs in perf but what if user disabled
unwinder for the purpose? Why pollute his debug console?
So instead we'll warn user about possibly missing feature once and
let him decide if that was what he or she really wanted.
Signed-off-by: Alexey Brodkin
Signed-off-by: Vineet Gupta
Signed-off-by: Greg Kroah-Hartman
commit f6e9bad4cb245dac00bf99b568cce1168cf5cecf
Author: Josh Poimboeuf
Date: Mon Jun 13 02:32:09 2016 -0500
sched/debug: Fix deadlock when enabling sched events
commit eda8dca519269c92a0771668b3d5678792de7b78 upstream.
I see a hang when enabling sched events:
echo 1 > /sys/kernel/debug/tracing/events/sched/enable
The printk buffer shows:
BUG: spinlock recursion on CPU#1, swapper/1/0
lock: 0xffff88007d5d8c00, .magic: dead4ead, .owner: swapper/1/0, .owner\_cpu: 1
CPU: 1 PID: 0 Comm: swapper/1 Not tainted 4.7.0-rc2+ #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.8.1-20150318\_183358- 04/01/2014
...
Call Trace:
 [] dump\_stack+0x85/0xc2
[] spin\_dump+0x78/0xc0
[] do\_raw\_spin\_lock+0x11a/0x150
[] \_raw\_spin\_lock+0x61/0x80
[] ? try\_to\_wake\_up+0x256/0x4e0
[] try\_to\_wake\_up+0x256/0x4e0
[] ? \_raw\_spin\_unlock\_irqrestore+0x4a/0x80
[] wake\_up\_process+0x15/0x20
[] insert\_work+0x84/0xc0
[] \_\_queue\_work+0x18f/0x660
[] queue\_work\_on+0x46/0x90
[] drm\_fb\_helper\_dirty.isra.11+0xcb/0xe0 [drm\_kms\_helper]
[] drm\_fb\_helper\_sys\_imageblit+0x30/0x40 [drm\_kms\_helper]
[] soft\_cursor+0x1ad/0x230
[] bit\_cursor+0x649/0x680
[] ? update\_attr.isra.2+0x90/0x90
[] fbcon\_cursor+0x14a/0x1c0
[] hide\_cursor+0x28/0x90
[] vt\_console\_print+0x3bf/0x3f0
[] call\_console\_drivers.constprop.24+0x183/0x200
[] console\_unlock+0x3d4/0x610
[] vprintk\_emit+0x3c5/0x610
[] vprintk\_default+0x29/0x40
[] printk+0x57/0x73
[] enqueue\_entity+0xc2e/0xc70
[] enqueue\_task\_fair+0x59/0xab0
[] ? kvm\_sched\_clock\_read+0x9/0x20
[] ? sched\_clock+0x9/0x10
[] activate\_task+0x5c/0xa0
[] ttwu\_do\_activate+0x54/0xb0
[] sched\_ttwu\_pending+0x7a/0xb0
[] scheduler\_ipi+0x61/0x170
[] smp\_trace\_reschedule\_interrupt+0x4f/0x2a0
[] trace\_reschedule\_interrupt+0x96/0xa0
 [] ? native\_safe\_halt+0x6/0x10
[] ? trace\_hardirqs\_on+0xd/0x10
[] default\_idle+0x20/0x1a0
[] arch\_cpu\_idle+0xf/0x20
[] default\_idle\_call+0x2f/0x50
[] cpu\_startup\_entry+0x37e/0x450
[] start\_secondary+0x160/0x1a0
Note the hang only occurs when echoing the above from a physical serial
console, not from an ssh session.
The bug is caused by a deadlock where the task is trying to grab the rq
lock twice because printk()'s aren't safe in sched code.
Signed-off-by: Josh Poimboeuf
Cc: Linus Torvalds
Cc: Matt Fleming
Cc: Mel Gorman
Cc: Mike Galbraith
Cc: Peter Zijlstra
Cc: Srikar Dronamraju
Cc: Thomas Gleixner
Fixes: cb2517653fcc ("sched/debug: Make schedstats a runtime tunable that is disabled by default")
Link: http://lkml.kernel.org/r/20160613073209.gdvdybiruljbkn3p@treble
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 543a87abcf8080f62a449d5566332c48b4eecddb
Author: Andrey Ryabinin
Date: Thu Jun 9 15:20:05 2016 +0300
kernel/sysrq, watchdog, sched/core: Reset watchdog on all CPUs while processing sysrq-w
commit 57675cb976eff977aefb428e68e4e0236d48a9ff upstream.
Lengthy output of sysrq-w may take a lot of time on slow serial console.
Currently we reset NMI-watchdog on the current CPU to avoid spurious
lockup messages. Sometimes this doesn't work since softlockup watchdog
might trigger on another CPU which is waiting for an IPI to proceed.
We reset softlockup watchdogs on all CPUs, but we do this only after
listing all tasks, and this may be too late on a busy system.
So, reset watchdogs CPUs earlier, in for\_each\_process\_thread() loop.
Signed-off-by: Andrey Ryabinin
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Link: http://lkml.kernel.org/r/1465474805-14641-1-git-send-email-aryabinin@virtuozzo.com
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 266f1d626c17076cc9e91e8a5f71186e379c6ab7
Author: Jiri Slaby
Date: Wed Jul 20 15:45:08 2016 -0700
pps: do not crash when failed to register
commit 368301f2fe4b07e5fb71dba3cc566bc59eb6705f upstream.
With this command sequence:
modprobe plip
modprobe pps\_parport
rmmod pps\_parport
the partport\_pps modules causes this crash:
BUG: unable to handle kernel NULL pointer dereference at (null)
IP: parport\_detach+0x1d/0x60 [pps\_parport]
Oops: 0000 [#1] SMP
...
Call Trace:
parport\_unregister\_driver+0x65/0xc0 [parport]
SyS\_delete\_module+0x187/0x210
The sequence that builds up to this is:
1) plip is loaded and takes the parport device for exclusive use:
plip0: Parallel port at 0x378, using IRQ 7.
2) pps\_parport then fails to grab the device:
pps\_parport: parallel port PPS client
parport0: cannot grant exclusive access for device pps\_parport
pps\_parport: couldn't register with parport0
3) rmmod of pps\_parport is then killed because it tries to access
pardev->name, but pardev (taken from port->cad) is NULL.
So add a check for NULL in the test there too.
Link: http://lkml.kernel.org/r/20160714115245.12651-1-jslaby@suse.cz
Signed-off-by: Jiri Slaby
Acked-by: Rodolfo Giometti
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit d9e8be11d4f3801fde7a1ef6c45ead5532e52c1e
Author: Andrey Ryabinin
Date: Wed Jul 20 15:45:00 2016 -0700
radix-tree: fix radix\_tree\_iter\_retry() for tagged iterators.
commit 3cb9185c67304b2a7ea9be73e7d13df6fb2793a1 upstream.
radix\_tree\_iter\_retry() resets slot to NULL, but it doesn't reset tags.
Then NULL slot and non-zero iter.tags passed to radix\_tree\_next\_slot()
leading to crash:
RIP: radix\_tree\_next\_slot include/linux/radix-tree.h:473
find\_get\_pages\_tag+0x334/0x930 mm/filemap.c:1452
....
Call Trace:
pagevec\_lookup\_tag+0x3a/0x80 mm/swap.c:960
mpage\_prepare\_extent\_to\_map+0x321/0xa90 fs/ext4/inode.c:2516
ext4\_writepages+0x10be/0x2b20 fs/ext4/inode.c:2736
do\_writepages+0x97/0x100 mm/page-writeback.c:2364
\_\_filemap\_fdatawrite\_range+0x248/0x2e0 mm/filemap.c:300
filemap\_write\_and\_wait\_range+0x121/0x1b0 mm/filemap.c:490
ext4\_sync\_file+0x34d/0xdb0 fs/ext4/fsync.c:115
vfs\_fsync\_range+0x10a/0x250 fs/sync.c:195
vfs\_fsync fs/sync.c:209
do\_fsync+0x42/0x70 fs/sync.c:219
SYSC\_fdatasync fs/sync.c:232
SyS\_fdatasync+0x19/0x20 fs/sync.c:230
entry\_SYSCALL\_64\_fastpath+0x23/0xc1 arch/x86/entry/entry\_64.S:207
We must reset iterator's tags to bail out from radix\_tree\_next\_slot()
and go to the slow-path in radix\_tree\_next\_chunk().
Fixes: 46437f9a554f ("radix-tree: fix race in gang lookup")
Link: http://lkml.kernel.org/r/1468495196-10604-1-git-send-email-aryabinin@virtuozzo.com
Signed-off-by: Andrey Ryabinin
Reported-by: Dmitry Vyukov
Acked-by: Konstantin Khlebnikov
Cc: Matthew Wilcox
Cc: Hugh Dickins
Cc: Ross Zwisler
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit db70cd18d3da727a3a59694de428a9e41c620de7
Author: Johannes Weiner
Date: Wed Jul 20 15:44:57 2016 -0700
mm: memcontrol: fix cgroup creation failure after many small jobs
commit 73f576c04b9410ed19660f74f97521bee6e1c546 upstream.
The memory controller has quite a bit of state that usually outlives the
cgroup and pins its CSS until said state disappears. At the same time
it imposes a 16-bit limit on the CSS ID space to economically store IDs
in the wild. Consequently, when we use cgroups to contain frequent but
small and short-lived jobs that leave behind some page cache, we quickly
run into the 64k limitations of outstanding CSSs. Creating a new cgroup
fails with -ENOSPC while there are only a few, or even no user-visible
cgroups in existence.
Although pinning CSSs past cgroup removal is common, there are only two
instances that actually need an ID after a cgroup is deleted: cache
shadow entries and swapout records.
Cache shadow entries reference the ID weakly and can deal with the CSS
having disappeared when it's looked up later. They pose no hurdle.
Swap-out records do need to pin the css to hierarchically attribute
swapins after the cgroup has been deleted; though the only pages that
remain swapped out after offlining are tmpfs/shmem pages. And those
references are under the user's control, so they are manageable.
This patch introduces a private 16-bit memcg ID and switches swap and
cache shadow entries over to using that. This ID can then be recycled
after offlining when the CSS remains pinned only by objects that don't
specifically need it.
This script demonstrates the problem by faulting one cache page in a new
cgroup and deleting it again:
set -e
mkdir -p pages
for x in `seq 128000`; do
[ $((x % 1000)) -eq 0 ] && echo $x
mkdir /cgroup/foo
echo $$ >/cgroup/foo/cgroup.procs
echo trex >pages/$x
echo $$ >/cgroup/cgroup.procs
rmdir /cgroup/foo
done
When run on an unpatched kernel, we eventually run out of possible IDs
even though there are no visible cgroups:
[root@ham ~]# ./cssidstress.sh
[...]
65000
mkdir: cannot create directory '/cgroup/foo': No space left on device
After this patch, the IDs get released upon cgroup destruction and the
cache and css objects get released once memory reclaim kicks in.
[hannes@cmpxchg.org: init the IDR]
Link: http://lkml.kernel.org/r/20160621154601.GA22431@cmpxchg.org
Fixes: b2052564e66d ("mm: memcontrol: continue cache reclaim from offlined groups")
Link: http://lkml.kernel.org/r/20160617162516.GD19084@cmpxchg.org
Signed-off-by: Johannes Weiner
Reported-by: John Garcia
Reviewed-by: Vladimir Davydov
Acked-by: Tejun Heo
Cc: Nikolay Borisov
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 11a11016b6ef7f6100899c1d0706f7edb84d7b76
Author: Hugh Dickins
Date: Thu Jul 14 12:07:38 2016 -0700
mm: thp: refix false positive BUG in page\_move\_anon\_rmap()
commit 5a49973d7143ebbabd76e1dcd69ee42e349bb7b9 upstream.
The VM\_BUG\_ON\_PAGE in page\_move\_anon\_rmap() is more trouble than it's
worth: the syzkaller fuzzer hit it again. It's still wrong for some THP
cases, because linear\_page\_index() was never intended to apply to
addresses before the start of a vma.
That's easily fixed with a signed long cast inside linear\_page\_index();
and Dmitry has tested such a patch, to verify the false positive. But
why extend linear\_page\_index() just for this case? when the avoidance in
page\_move\_anon\_rmap() has already grown ugly, and there's no reason for
the check at all (nothing else there is using address or index).
Remove address arg from page\_move\_anon\_rmap(), remove VM\_BUG\_ON\_PAGE,
remove CONFIG\_DEBUG\_VM PageTransHuge adjustment.
And one more thing: should the compound\_head(page) be done inside or
outside page\_move\_anon\_rmap()? It's usually pushed down to the lowest
level nowadays (and mm/memory.c shows no other explicit use of it), so I
think it's better done in page\_move\_anon\_rmap() than by caller.
Fixes: 0798d3c022dc ("mm: thp: avoid false positive VM\_BUG\_ON\_PAGE in page\_move\_anon\_rmap()")
Link: http://lkml.kernel.org/r/alpine.LSU.2.11.1607120444540.12528@eggly.anvils
Signed-off-by: Hugh Dickins
Reported-by: Dmitry Vyukov
Acked-by: Kirill A. Shutemov
Cc: Mika Westerberg
Cc: Andrea Arcangeli
Cc: Rik van Riel
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit aa434e1181df7dfbdd551e9b2b5d602477f3d2af
Author: Dmitry Vyukov
Date: Thu Jul 14 12:07:29 2016 -0700
vmlinux.lds: account for destructor sections
commit e41f501d391265ff568f3e49d6128cc30856a36f upstream.
If CONFIG\_KASAN is enabled and gcc is configured with
--disable-initfini-array and/or gold linker is used, gcc emits
.ctors/.dtors and .text.startup/.text.exit sections instead of
.init\_array/.fini\_array. .dtors section is not explicitly accounted in
the linker script and messes vvar/percpu layout.
We want:
ffffffff822bfd80 D \_edata
ffffffff822c0000 D \_\_vvar\_beginning\_hack
ffffffff822c0000 A \_\_vvar\_page
ffffffff822c0080 0000000000000098 D vsyscall\_gtod\_data
ffffffff822c1000 A \_\_init\_begin
ffffffff822c1000 D init\_per\_cpu\_\_irq\_stack\_union
ffffffff822c1000 A \_\_per\_cpu\_load
ffffffff822d3000 D init\_per\_cpu\_\_gdt\_page
We got:
ffffffff8279a600 D \_edata
ffffffff8279b000 A \_\_vvar\_page
ffffffff8279c000 A \_\_init\_begin
ffffffff8279c000 D init\_per\_cpu\_\_irq\_stack\_union
ffffffff8279c000 A \_\_per\_cpu\_load
ffffffff8279e000 D \_\_vvar\_beginning\_hack
ffffffff8279e080 0000000000000098 D vsyscall\_gtod\_data
ffffffff827ae000 D init\_per\_cpu\_\_gdt\_page
This happens because \_\_vvar\_page and .vvar get different addresses in
arch/x86/kernel/vmlinux.lds.S:
. = ALIGN(PAGE\_SIZE);
\_\_vvar\_page = .;
.vvar : AT(ADDR(.vvar) - LOAD\_OFFSET) {
/\* work around gold bug 13023 \*/
\_\_vvar\_beginning\_hack = .;
Discard .dtors/.fini\_array/.text.exit, since we don't call dtors.
Merge .text.startup into init text.
Link: http://lkml.kernel.org/r/1467386363-120030-1-git-send-email-dvyukov@google.com
Signed-off-by: Dmitry Vyukov
Reviewed-by: Andrey Ryabinin
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 7ec7eb63fd2f08b61eb5ec42e6be14b777a32111
Author: Mel Gorman
Date: Thu Jul 14 12:07:23 2016 -0700
mm, meminit: ensure node is online before checking whether pages are uninitialised
commit ef70b6f41cda6270165a6f27b2548ed31cfa3cb2 upstream.
early\_page\_uninitialised looks up an arbitrary PFN. While a machine
without node 0 will boot with "mm, page\_alloc: Always return a valid
node from early\_pfn\_to\_nid", it works because it assumes that nodes are
always in PFN order. This is not guaranteed so this patch adds
robustness by always checking if the node being checked is online.
Link: http://lkml.kernel.org/r/1468008031-3848-4-git-send-email-mgorman@techsingularity.net
Signed-off-by: Mel Gorman
Acked-by: David Rientjes
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit f6ea62caa0d740d33cd74b7f190da0fce3ac8304
Author: Mel Gorman
Date: Thu Jul 14 12:07:20 2016 -0700
mm, meminit: always return a valid node from early\_pfn\_to\_nid
commit e4568d3803852d00effd41dcdd489e726b998879 upstream.
early\_pfn\_to\_nid can return node 0 if a PFN is invalid on machines that
has no node 0. A machine with only node 1 was observed to crash with
the following message:
BUG: unable to handle kernel paging request at 000000000002a3c8
PGD 0
Modules linked in:
Hardware name: Supermicro H8DSP-8/H8DSP-8, BIOS 080011 06/30/2006
task: ffffffff81c0d500 ti: ffffffff81c00000 task.ti: ffffffff81c00000
RIP: reserve\_bootmem\_region+0x6a/0xef
CR2: 000000000002a3c8 CR3: 0000000001c06000 CR4: 00000000000006b0
Call Trace:
free\_all\_bootmem+0x4b/0x12a
mem\_init+0x70/0xa3
start\_kernel+0x25b/0x49b
The problem is that early\_page\_uninitialised uses the early\_pfn\_to\_nid
helper which returns node 0 for invalid PFNs. No caller of
early\_pfn\_to\_nid cares except early\_page\_uninitialised. This patch has
early\_pfn\_to\_nid always return a valid node.
Link: http://lkml.kernel.org/r/1468008031-3848-3-git-send-email-mgorman@techsingularity.net
Signed-off-by: Mel Gorman
Acked-by: David Rientjes
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 3428b992f248b8637b8d4254c3ace4140d379947
Author: Mauro Carvalho Chehab
Date: Thu Jul 14 12:07:15 2016 -0700
uapi: export lirc.h header
commit 12cb22bb8ae9aff9d72a9c0a234f26d641b20eb6 upstream.
This header contains the userspace API for lirc.
This is a fixup for commit b7be755733dc ("[media] bz#75751: Move
internal header file lirc.h to uapi/"). It moved the header to the
right place, but it forgot to add it at Kbuild. So, despite being at
uapi, it is not copied to the right place.
Fixes: b7be755733dc44c72 ("[media] bz#75751: Move internal header file lirc.h to uapi/")
Link: http://lkml.kernel.org/r/320c765d32bfc82c582e336d52ffe1026c73c644.1468439021.git.mchehab@s-opensource.com
Signed-off-by: Mauro Carvalho Chehab
Cc: Alec Leamas
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 1a30fc84482c754907704796857f93a735c95580
Author: David Rientjes
Date: Thu Jul 14 12:06:50 2016 -0700
mm, compaction: prevent VM\_BUG\_ON when terminating freeing scanner
commit a46cbf3bc53b6a93fb84a5ffb288c354fa807954 upstream.
It's possible to isolate some freepages in a pageblock and then fail
split\_free\_page() due to the low watermark check. In this case, we hit
VM\_BUG\_ON() because the freeing scanner terminated early without a
contended lock or enough freepages.
This should never have been a VM\_BUG\_ON() since it's not a fatal
condition. It should have been a VM\_WARN\_ON() at best, or even handled
gracefully.
Regardless, we need to terminate anytime the full pageblock scan was not
done. The logic belongs in isolate\_freepages\_block(), so handle its
state gracefully by terminating the pageblock loop and making a note to
restart at the same pageblock next time since it was not possible to
complete the scan this time.
[rientjes@google.com: don't rescan pages in a pageblock]
Link: http://lkml.kernel.org/r/alpine.DEB.2.10.1607111244150.83138@chino.kir.corp.google.com
Link: http://lkml.kernel.org/r/alpine.DEB.2.10.1606291436300.145590@chino.kir.corp.google.com
Signed-off-by: David Rientjes
Reported-by: Minchan Kim
Tested-by: Minchan Kim
Cc: Joonsoo Kim
Cc: Hugh Dickins
Cc: Mel Gorman
Cc: Vlastimil Babka
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit bb01babba2780b72dfa386d0cd6f528031f333b9
Author: Torsten Hilbrich
Date: Fri Jun 24 14:50:18 2016 -0700
fs/nilfs2: fix potential underflow in call to crc32\_le
commit 63d2f95d63396059200c391ca87161897b99e74a upstream.
The value `bytes' comes from the filesystem which is about to be
mounted. We cannot trust that the value is always in the range we
expect it to be.
Check its value before using it to calculate the length for the crc32\_le
call. It value must be larger (or equal) sumoff + 4.
This fixes a kernel bug when accidentially mounting an image file which
had the nilfs2 magic value 0x3434 at the right offset 0x406 by chance.
The bytes 0x01 0x00 were stored at 0x408 and were interpreted as a
s\_bytes value of 1. This caused an underflow when substracting sumoff +
4 (20) in the call to crc32\_le.
BUG: unable to handle kernel paging request at ffff88021e600000
IP: crc32\_le+0x36/0x100
...
Call Trace:
nilfs\_valid\_sb.part.5+0x52/0x60 [nilfs2]
nilfs\_load\_super\_block+0x142/0x300 [nilfs2]
init\_nilfs+0x60/0x390 [nilfs2]
nilfs\_mount+0x302/0x520 [nilfs2]
mount\_fs+0x38/0x160
vfs\_kern\_mount+0x67/0x110
do\_mount+0x269/0xe00
SyS\_mount+0x9f/0x100
entry\_SYSCALL\_64\_fastpath+0x16/0x71
Link: http://lkml.kernel.org/r/1466778587-5184-2-git-send-email-konishi.ryusuke@lab.ntt.co.jp
Signed-off-by: Torsten Hilbrich
Tested-by: Torsten Hilbrich
Signed-off-by: Ryusuke Konishi
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 8f40a441eabf64a5a7481af0a76c2c89306bb61c
Author: David Rientjes
Date: Fri Jun 24 14:50:10 2016 -0700
mm, compaction: abort free scanner if split fails
commit a4f04f2c6955aff5e2c08dcb40aca247ff4d7370 upstream.
If the memory compaction free scanner cannot successfully split a free
page (only possible due to per-zone low watermark), terminate the free
scanner rather than continuing to scan memory needlessly. If the
watermark is insufficient for a free page of order <= cc->order, then
terminate the scanner since all future splits will also likely fail.
This prevents the compaction freeing scanner from scanning all memory on
very large zones (very noticeable for zones > 128GB, for instance) when
all splits will likely fail while holding zone->lock.
compaction\_alloc() iterating a 128GB zone has been benchmarked to take
over 400ms on some systems whereas any free page isolated and ready to
be split ends up failing in split\_free\_page() because of the low
watermark check and thus the iteration continues.
The next time compaction occurs, the freeing scanner will likely start
at the end of the zone again since no success was made previously and we
get the same lengthy iteration until the zone is brought above the low
watermark. All thp page faults can take >400ms in such a state without
this fix.
Link: http://lkml.kernel.org/r/alpine.DEB.2.10.1606211820350.97086@chino.kir.corp.google.com
Signed-off-by: David Rientjes
Acked-by: Vlastimil Babka
Cc: Minchan Kim
Cc: Joonsoo Kim
Cc: Mel Gorman
Cc: Hugh Dickins
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit af809c0ec310f620748bad6a1ea41f1034509fb5
Author: Lukasz Odzioba
Date: Fri Jun 24 14:50:01 2016 -0700
mm/swap.c: flush lru pvecs on compound page arrival
commit 8f182270dfec432e93fae14f9208a6b9af01009f upstream.
Currently we can have compound pages held on per cpu pagevecs, which
leads to a lot of memory unavailable for reclaim when needed. In the
systems with hundreads of processors it can be GBs of memory.
On of the way of reproducing the problem is to not call munmap
explicitly on all mapped regions (i.e. after receiving SIGTERM). After
that some pages (with THP enabled also huge pages) may end up on
lru\_add\_pvec, example below.
void main() {
#pragma omp parallel
{
size\_t size = 55 \* 1000 \* 1000; // smaller than MEM/CPUS
void \*p = mmap(NULL, size, PROT\_READ | PROT\_WRITE,
MAP\_PRIVATE | MAP\_ANONYMOUS , -1, 0);
if (p != MAP\_FAILED)
memset(p, 0, size);
//munmap(p, size); // uncomment to make the problem go away
}
}
When we run it with THP enabled it will leave significant amount of
memory on lru\_add\_pvec. This memory will be not reclaimed if we hit
OOM, so when we run above program in a loop:
for i in `seq 100`; do ./a.out; done
many processes (95% in my case) will be killed by OOM.
The primary point of the LRU add cache is to save the zone lru\_lock
contention with a hope that more pages will belong to the same zone and
so their addition can be batched. The huge page is already a form of
batched addition (it will add 512 worth of memory in one go) so skipping
the batching seems like a safer option when compared to a potential
excess in the caching which can be quite large and much harder to fix
because lru\_add\_drain\_all is way to expensive and it is not really clear
what would be a good moment to call it.
Similarly we can reproduce the problem on lru\_deactivate\_pvec by adding:
madvise(p, size, MADV\_FREE); after memset.
This patch flushes lru pvecs on compound page arrival making the problem
less severe - after applying it kill rate of above example drops to 0%,
due to reducing maximum amount of memory held on pvec from 28MB (with
THP) to 56kB per CPU.
Suggested-by: Michal Hocko
Link: http://lkml.kernel.org/r/1466180198-18854-1-git-send-email-lukasz.odzioba@intel.com
Signed-off-by: Lukasz Odzioba
Acked-by: Michal Hocko
Cc: Kirill Shutemov
Cc: Andrea Arcangeli
Cc: Vladimir Davydov
Cc: Ming Li
Cc: Minchan Kim
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit b31a27b8ac07c1bcc6b4329e018be27bed3b7aee
Author: Tejun Heo
Date: Fri Jun 24 14:49:58 2016 -0700
memcg: css\_alloc should return an ERR\_PTR value on error
commit ea3a9645866e12d2b198434f03df3c3e96fb86ce upstream.
mem\_cgroup\_css\_alloc() was returning NULL on failure while cgroup core
expected it to return an ERR\_PTR value leading to the following NULL
deref after a css allocation failure. Fix it by return
ERR\_PTR(-ENOMEM) instead. I'll also update cgroup core so that it
can handle NULL returns.
mkdir: page allocation failure: order:6, mode:0x240c0c0(GFP\_KERNEL|\_\_GFP\_COMP|\_\_GFP\_ZERO)
CPU: 0 PID: 8738 Comm: mkdir Not tainted 4.7.0-rc3+ #123
...
Call Trace:
dump\_stack+0x68/0xa1
warn\_alloc\_failed+0xd6/0x130
\_\_alloc\_pages\_nodemask+0x4c6/0xf20
alloc\_pages\_current+0x66/0xe0
alloc\_kmem\_pages+0x14/0x80
kmalloc\_order\_trace+0x2a/0x1a0
\_\_kmalloc+0x291/0x310
memcg\_update\_all\_caches+0x6c/0x130
mem\_cgroup\_css\_alloc+0x590/0x610
cgroup\_apply\_control\_enable+0x18b/0x370
cgroup\_mkdir+0x1de/0x2e0
kernfs\_iop\_mkdir+0x55/0x80
vfs\_mkdir+0xb9/0x150
SyS\_mkdir+0x66/0xd0
do\_syscall\_64+0x53/0x120
entry\_SYSCALL64\_slow\_path+0x25/0x25
...
BUG: unable to handle kernel NULL pointer dereference at 00000000000000d0
IP: init\_and\_link\_css+0x37/0x220
PGD 34b1e067 PUD 3a109067 PMD 0
Oops: 0002 [#1] SMP
Modules linked in:
CPU: 0 PID: 8738 Comm: mkdir Not tainted 4.7.0-rc3+ #123
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.9.2-20160422\_131301-anatol 04/01/2014
task: ffff88007cbc5200 ti: ffff8800666d4000 task.ti: ffff8800666d4000
RIP: 0010:[] [] init\_and\_link\_css+0x37/0x220
RSP: 0018:ffff8800666d7d90 EFLAGS: 00010246
RAX: 0000000000000000 RBX: 0000000000000000 RCX: 0000000000000000
RDX: ffffffff810f2499 RSI: 0000000000000000 RDI: 0000000000000008
RBP: ffff8800666d7db8 R08: 0000000000000003 R09: 0000000000000000
R10: 0000000000000001 R11: 0000000000000000 R12: ffff88005a5fb400
R13: ffffffff81f0f8a0 R14: ffff88005a5fb400 R15: 0000000000000010
FS: 00007fc944689700(0000) GS:ffff88007fc00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f3aed0d2b80 CR3: 000000003a1e8000 CR4: 00000000000006f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
cgroup\_apply\_control\_enable+0x1ac/0x370
cgroup\_mkdir+0x1de/0x2e0
kernfs\_iop\_mkdir+0x55/0x80
vfs\_mkdir+0xb9/0x150
SyS\_mkdir+0x66/0xd0
do\_syscall\_64+0x53/0x120
entry\_SYSCALL64\_slow\_path+0x25/0x25
Code: 89 f5 48 89 fb 49 89 d4 48 83 ec 08 8b 05 72 3b d8 00 85 c0 0f 85 60 01 00 00 4c 89 e7 e8 72 f7 ff ff 48 8d 7b 08 48 89 d9 31 c0 <48> c7 83 d0 00 00 00 00 00 00 00 48 83 e7 f8 48 29 f9 81 c1 d8
RIP init\_and\_link\_css+0x37/0x220
RSP
CR2: 00000000000000d0
---[ end trace a2d8836ae1e852d1 ]---
Link: http://lkml.kernel.org/r/20160621165740.GJ3262@mtj.duckdns.org
Signed-off-by: Tejun Heo
Reported-by: Johannes Weiner
Reviewed-by: Vladimir Davydov
Acked-by: Johannes Weiner
Acked-by: Michal Hocko
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 5acd89d31e10e5e17ad42f064dfa6976c9978c46
Author: Tejun Heo
Date: Fri Jun 24 14:49:54 2016 -0700
memcg: mem\_cgroup\_migrate() may be called with irq disabled
commit d93c4130a7d049b234b5d5a15808eaf5406f2789 upstream.
mem\_cgroup\_migrate() uses local\_irq\_disable/enable() but can be called
with irq disabled from migrate\_page\_copy(). This ends up enabling irq
while holding a irq context lock triggering the following lockdep
warning. Fix it by using irq\_save/restore instead.
=================================
[ INFO: inconsistent lock state ]
4.7.0-rc1+ #52 Tainted: G W
---------------------------------
inconsistent {IN-SOFTIRQ-W} -> {SOFTIRQ-ON-W} usage.
kcompactd0/151 [HC0[0]:SC0[0]:HE1:SE1] takes:
(&(&ctx->completion\_lock)->rlock){+.?.-.}, at: [<000000000038fd96>] aio\_migratepage+0x156/0x1e8
{IN-SOFTIRQ-W} state was registered at:
\_\_lock\_acquire+0x5b6/0x1930
lock\_acquire+0xee/0x270
\_raw\_spin\_lock\_irqsave+0x66/0xb0
aio\_complete+0x98/0x328
dio\_complete+0xe4/0x1e0
blk\_update\_request+0xd4/0x450
scsi\_end\_request+0x48/0x1c8
scsi\_io\_completion+0x272/0x698
blk\_done\_softirq+0xca/0xe8
\_\_do\_softirq+0xc8/0x518
irq\_exit+0xee/0x110
do\_IRQ+0x6a/0x88
io\_int\_handler+0x11a/0x25c
\_\_mutex\_unlock\_slowpath+0x144/0x1d8
\_\_mutex\_unlock\_slowpath+0x140/0x1d8
kernfs\_iop\_permission+0x64/0x80
\_\_inode\_permission+0x9e/0xf0
link\_path\_walk+0x6e/0x510
path\_lookupat+0xc4/0x1a8
filename\_lookup+0x9c/0x160
user\_path\_at\_empty+0x5c/0x70
SyS\_readlinkat+0x68/0x140
system\_call+0xd6/0x270
irq event stamp: 971410
hardirqs last enabled at (971409): migrate\_page\_move\_mapping+0x3ea/0x588
hardirqs last disabled at (971410): \_raw\_spin\_lock\_irqsave+0x3c/0xb0
softirqs last enabled at (970526): \_\_do\_softirq+0x460/0x518
softirqs last disabled at (970519): irq\_exit+0xee/0x110
other info that might help us debug this:
Possible unsafe locking scenario:
CPU0
----
lock(&(&ctx->completion\_lock)->rlock);
lock(&(&ctx->completion\_lock)->rlock);
\*\*\* DEADLOCK \*\*\*
3 locks held by kcompactd0/151:
#0: (&(&mapping->private\_lock)->rlock){+.+.-.}, at: aio\_migratepage+0x42/0x1e8
#1: (&ctx->ring\_lock){+.+.+.}, at: aio\_migratepage+0x5a/0x1e8
#2: (&(&ctx->completion\_lock)->rlock){+.?.-.}, at: aio\_migratepage+0x156/0x1e8
stack backtrace:
CPU: 20 PID: 151 Comm: kcompactd0 Tainted: G W 4.7.0-rc1+ #52
Call Trace:
show\_trace+0xea/0xf0
show\_stack+0x72/0xf0
dump\_stack+0x9a/0xd8
print\_usage\_bug.part.27+0x2d4/0x2e8
mark\_lock+0x17e/0x758
mark\_held\_locks+0xa2/0xd0
trace\_hardirqs\_on\_caller+0x140/0x1c0
mem\_cgroup\_migrate+0x266/0x370
aio\_migratepage+0x16a/0x1e8
move\_to\_new\_page+0xb0/0x260
migrate\_pages+0x8f4/0x9f0
compact\_zone+0x4dc/0xdc8
kcompactd\_do\_work+0x1aa/0x358
kcompactd+0xba/0x2c8
kthread+0x10a/0x110
kernel\_thread\_starter+0x6/0xc
kernel\_thread\_starter+0x0/0xc
INFO: lockdep is turned off.
Link: http://lkml.kernel.org/r/20160620184158.GO3262@mtj.duckdns.org
Link: http://lkml.kernel.org/g/5767CFE5.7080904@de.ibm.com
Fixes: 74485cf2bc85 ("mm: migrate: consolidate mem\_cgroup\_migrate() calls")
Signed-off-by: Tejun Heo
Reported-by: Christian Borntraeger
Acked-by: Johannes Weiner
Acked-by: Michal Hocko
Reviewed-by: Vladimir Davydov
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 521fe1d2ede834ad3caff5e2446e2e442589223d
Author: Mel Gorman
Date: Fri Jun 24 14:49:37 2016 -0700
mm, sl[au]b: add \_\_GFP\_ATOMIC to the GFP reclaim mask
commit e838a45f9392a5bd2be1cd3ab0b16ae85857461c upstream.
Commit d0164adc89f6 ("mm, page\_alloc: distinguish between being unable
to sleep, unwilling to sleep and avoiding waking kswapd") modified
\_\_GFP\_WAIT to explicitly identify the difference between atomic callers
and those that were unwilling to sleep. Later the definition was
removed entirely.
The GFP\_RECLAIM\_MASK is the set of flags that affect watermark checking
and reclaim behaviour but \_\_GFP\_ATOMIC was never added. Without it,
atomic users of the slab allocator strip the \_\_GFP\_ATOMIC flag and
cannot access the page allocator atomic reserves. This patch addresses
the problem.
The user-visible impact depends on the workload but potentially atomic
allocations unnecessarily fail without this path.
Link: http://lkml.kernel.org/r/20160610093832.GK2527@techsingularity.net
Signed-off-by: Mel Gorman
Reported-by: Marcin Wojtas
Acked-by: Vlastimil Babka
Acked-by: Michal Hocko
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit f883b9242712876e273bed6893932d70c00c0021
Author: Ludovic Desroches
Date: Thu May 12 16:54:10 2016 +0200
dmaengine: at\_xdmac: double FIFO flush needed to compute residue
commit 9295c41d77ca93aac79cfca6fa09fa1ca5cab66f upstream.
Due to the way CUBC register is updated, a double flush is needed to
compute an accurate residue. First flush aim is to get data from the DMA
FIFO and second one ensures that we won't report data which are not in
memory.
Signed-off-by: Ludovic Desroches
Fixes: e1f7c9eee707 ("dmaengine: at\_xdmac: creation of the atmel
eXtended DMA Controller driver")
Reviewed-by: Nicolas Ferre
Signed-off-by: Vinod Koul
Signed-off-by: Greg Kroah-Hartman
commit d1a41160ee77efcee8d150138f442b5faae2e61f
Author: Ludovic Desroches
Date: Thu May 12 16:54:09 2016 +0200
dmaengine: at\_xdmac: fix residue corruption
commit 53398f488821c2b5b15291e3debec6ad33f75d3d upstream.
An unexpected value of CUBC can lead to a corrupted residue. A more
complex sequence is needed to detect an inaccurate value for NCA or CUBC.
Signed-off-by: Ludovic Desroches
Fixes: e1f7c9eee707 ("dmaengine: at\_xdmac: creation of the atmel
eXtended DMA Controller driver")
Reviewed-by: Nicolas Ferre
Signed-off-by: Vinod Koul
Signed-off-by: Greg Kroah-Hartman
commit de46295628512d25cb8190dace8c220880aca8c3
Author: Ludovic Desroches
Date: Thu May 12 16:54:08 2016 +0200
dmaengine: at\_xdmac: align descriptors on 64 bits
commit 4a9723e8df68cfce4048517ee32e37f78854b6fb upstream.
Having descriptors aligned on 64 bits allows update CNDA and CUBC in an
atomic way.
Signed-off-by: Ludovic Desroches
Fixes: e1f7c9eee707 ("dmaengine: at\_xdmac: creation of the atmel
eXtended DMA Controller driver")
Reviewed-by: Nicolas Ferre
Signed-off-by: Vinod Koul
Signed-off-by: Greg Kroah-Hartman
commit 980d99cdd2d599695370c852efded2c33bcef120
Author: Lukas Wunner
Date: Sun Jun 12 12:31:53 2016 +0200
x86/quirks: Add early quirk to reset Apple AirPort card
commit abb2bafd295fe962bbadc329dbfb2146457283ac upstream.
The EFI firmware on Macs contains a full-fledged network stack for
downloading OS X images from osrecovery.apple.com. Unfortunately
on Macs introduced 2011 and 2012, EFI brings up the Broadcom 4331
wireless card on every boot and leaves it enabled even after
ExitBootServices has been called. The card continues to assert its IRQ
line, causing spurious interrupts if the IRQ is shared. It also corrupts
memory by DMAing received packets, allowing for remote code execution
over the air. This only stops when a driver is loaded for the wireless
card, which may be never if the driver is not installed or blacklisted.
The issue seems to be constrained to the Broadcom 4331. Chris Milsted
has verified that the newer Broadcom 4360 built into the MacBookPro11,3
(2013/2014) does not exhibit this behaviour. The chances that Apple will
ever supply a firmware fix for the older machines appear to be zero.
The solution is to reset the card on boot by writing to a reset bit in
its mmio space. This must be done as an early quirk and not as a plain
vanilla PCI quirk to successfully combat memory corruption by DMAed
packets: Matthew Garrett found out in 2012 that the packets are written
to EfiBootServicesData memory (http://mjg59.dreamwidth.org/11235.html).
This type of memory is made available to the page allocator by
efi\_free\_boot\_services(). Plain vanilla PCI quirks run much later, in
subsys initcall level. In-between a time window would be open for memory
corruption. Random crashes occurring in this time window and attributed
to DMAed packets have indeed been observed in the wild by Chris
Bainbridge.
When Matthew Garrett analyzed the memory corruption issue in 2012, he
sought to fix it with a grub quirk which transitions the card to D3hot:
http://git.savannah.gnu.org/cgit/grub.git/commit/?id=9d34bb85da56
This approach does not help users with other bootloaders and while it
may prevent DMAed packets, it does not cure the spurious interrupts
emanating from the card. Unfortunately the card's mmio space is
inaccessible in D3hot, so to reset it, we have to undo the effect of
Matthew's grub patch and transition the card back to D0.
Note that the quirk takes a few shortcuts to reduce the amount of code:
The size of BAR 0 and the location of the PM capability is identical
on all affected machines and therefore hardcoded. Only the address of
BAR 0 differs between models. Also, it is assumed that the BCMA core
currently mapped is the 802.11 core. The EFI driver seems to always take
care of this.
Michael Büsch, Bjorn Helgaas and Matt Fleming contributed feedback
towards finding the best solution to this problem.
The following should be a comprehensive list of affected models:
iMac13,1 2012 21.5" [Root Port 00:1c.3 = 8086:1e16]
iMac13,2 2012 27" [Root Port 00:1c.3 = 8086:1e16]
Macmini5,1 2011 i5 2.3 GHz [Root Port 00:1c.1 = 8086:1c12]
Macmini5,2 2011 i5 2.5 GHz [Root Port 00:1c.1 = 8086:1c12]
Macmini5,3 2011 i7 2.0 GHz [Root Port 00:1c.1 = 8086:1c12]
Macmini6,1 2012 i5 2.5 GHz [Root Port 00:1c.1 = 8086:1e12]
Macmini6,2 2012 i7 2.3 GHz [Root Port 00:1c.1 = 8086:1e12]
MacBookPro8,1 2011 13" [Root Port 00:1c.1 = 8086:1c12]
MacBookPro8,2 2011 15" [Root Port 00:1c.1 = 8086:1c12]
MacBookPro8,3 2011 17" [Root Port 00:1c.1 = 8086:1c12]
MacBookPro9,1 2012 15" [Root Port 00:1c.1 = 8086:1e12]
MacBookPro9,2 2012 13" [Root Port 00:1c.1 = 8086:1e12]
MacBookPro10,1 2012 15" [Root Port 00:1c.1 = 8086:1e12]
MacBookPro10,2 2012 13" [Root Port 00:1c.1 = 8086:1e12]
For posterity, spurious interrupts caused by the Broadcom 4331 wireless
card resulted in splats like this (stacktrace omitted):
irq 17: nobody cared (try booting with the "irqpoll" option)
handlers:
[] pcie\_isr
[] sdhci\_irq [sdhci] threaded [] sdhci\_thread\_irq [sdhci]
[] azx\_interrupt [snd\_hda\_codec]
Disabling IRQ #17
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=79301
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=111781
Bugzilla: https://bugzilla.redhat.com/show\_bug.cgi?id=728916
Bugzilla: https://bugzilla.redhat.com/show\_bug.cgi?id=895951#c16
Bugzilla: https://bugzilla.redhat.com/show\_bug.cgi?id=1009819
Bugzilla: https://bugzilla.redhat.com/show\_bug.cgi?id=1098621
Bugzilla: https://bugzilla.redhat.com/show\_bug.cgi?id=1149632#c5
Bugzilla: https://bugzilla.redhat.com/show\_bug.cgi?id=1279130
Bugzilla: https://bugzilla.redhat.com/show\_bug.cgi?id=1332732
Tested-by: Konstantin Simanov  # [MacBookPro8,1]
Tested-by: Lukas Wunner  # [MacBookPro9,1]
Tested-by: Bryan Paradis  # [MacBookPro9,2]
Tested-by: Andrew Worsley  # [MacBookPro10,1]
Tested-by: Chris Bainbridge  # [MacBookPro10,2]
Signed-off-by: Lukas Wunner
Acked-by: Rafał Miłecki
Acked-by: Matt Fleming
Cc: Andy Lutomirski
Cc: Bjorn Helgaas
Cc: Borislav Petkov
Cc: Brian Gerst
Cc: Chris Milsted
Cc: Denys Vlasenko
Cc: H. Peter Anvin
Cc: Josh Poimboeuf
Cc: Linus Torvalds
Cc: Matthew Garrett
Cc: Michael Buesch
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: Yinghai Lu
Cc: b43-dev@lists.infradead.org
Cc: linux-pci@vger.kernel.org
Cc: linux-wireless@vger.kernel.org
Link: http://lkml.kernel.org/r/48d0972ac82a53d460e5fce77a07b2560db95203.1465690253.git.lukas@wunner.de
[ Did minor readability edits. ]
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 7013ef909cbd8dff91f1de353b7815675c071463
Author: Lukas Wunner
Date: Sun Jun 12 12:31:53 2016 +0200
x86/quirks: Reintroduce scanning of secondary buses
commit 850c321027c2e31d0afc71588974719a4b565550 upstream.
We used to scan secondary buses until the following commit that
was applied in 2009:
8659c406ade3 ("x86: only scan the root bus in early PCI quirks")
which commit constrained early quirks to the root bus only. Its
motivation was to prevent application of the nvidia\_bugs quirk
on secondary buses.
We're about to add a quirk to reset the Broadcom 4331 wireless card on
2011/2012 Macs, which is located on a secondary bus behind a PCIe root
port. To facilitate that, reintroduce scanning of secondary buses.
The commit message of 8659c406ade3 notes that scanning only the root bus
"saves quite some unnecessary scanning work". The algorithm used prior
to 8659c406ade3 was particularly time consuming because it scanned
buses 0 to 31 brute force. To avoid lengthening boot time, employ a
recursive strategy which only scans buses that are actually reachable
from the root bus.
Yinghai Lu pointed out that the secondary bus number read from a
bridge's config space may be invalid, in particular a value of 0 would
cause an infinite loop. The PCI core goes beyond that and recurses to a
child bus only if its bus number is greater than the parent bus number
(see pci\_scan\_bridge()). Since the root bus is numbered 0, this implies
that secondary buses may not be 0. Do the same on early scanning.
If this algorithm is found to significantly impact boot time or cause
infinite loops on broken hardware, it would be possible to limit its
recursion depth: The Broadcom 4331 quirk applies at depth 1, all others
at depth 0, so the bus need not be scanned deeper than that for now. An
alternative approach would be to revert to scanning only the root bus,
and apply the Broadcom 4331 quirk to the root ports 8086:1c12, 8086:1e12
and 8086:1e16. Apple always positioned the card behind either of these
three ports. The quirk would then check presence of the card in slot 0
below the root port and do its deed.
Signed-off-by: Lukas Wunner
Cc: Andy Lutomirski
Cc: Bjorn Helgaas
Cc: Borislav Petkov
Cc: Brian Gerst
Cc: Denys Vlasenko
Cc: H. Peter Anvin
Cc: Josh Poimboeuf
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: Yinghai Lu
Cc: linux-pci@vger.kernel.org
Link: http://lkml.kernel.org/r/f0daa70dac1a9b2483abdb31887173eb6ab77bdf.1465690253.git.lukas@wunner.de
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 9c1700092c439fd1551464c2109a5ba7bb5e8a22
Author: Lukas Wunner
Date: Sun Jun 12 12:31:53 2016 +0200
x86/quirks: Apply nvidia\_bugs quirk only on root bus
commit 447d29d1d3aed839e74c2401ef63387780ac51ed upstream.
Since the following commit:
8659c406ade3 ("x86: only scan the root bus in early PCI quirks")
... early quirks are only applied to devices on the root bus.
The motivation was to prevent application of the nvidia\_bugs quirk on
secondary buses.
We're about to reintroduce scanning of secondary buses for a quirk to
reset the Broadcom 4331 wireless card on 2011/2012 Macs. To prevent
regressions, open code the requirement to apply nvidia\_bugs only on the
root bus.
Signed-off-by: Lukas Wunner
Cc: Andy Lutomirski
Cc: Bjorn Helgaas
Cc: Borislav Petkov
Cc: Brian Gerst
Cc: Denys Vlasenko
Cc: H. Peter Anvin
Cc: Josh Poimboeuf
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: Yinghai Lu
Link: http://lkml.kernel.org/r/4d5477c1d76b2f0387a780f2142bbcdd9fee869b.1465690253.git.lukas@wunner.de
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit e043a37e99233119cf7b601e4ed5fce994da64ec
Author: Michał Pecio
Date: Tue Jun 7 12:34:45 2016 +0200
USB: OHCI: Don't mark EDs as ED\_OPER if scheduling fails
commit c66f59ee5050447b3da92d36f5385a847990a894 upstream.
Since ed\_schedule begins with marking the ED as "operational",
the ED may be left in such state even if scheduling actually
fails.
This allows future submission attempts to smuggle this ED to the
hardware behind the scheduler's back and without linking it to
the ohci->eds\_in\_use list.
The former causes bandwidth saturation and data loss on isoc
endpoints, the latter crashes the kernel when attempt is made
to unlink such ED from this list.
Fix ed\_schedule to update ED state only on successful return.
Signed-off-by: Michal Pecio
Acked-by: Alan Stern
Signed-off-by: Greg Kroah-Hartman


=== Content from git.kernel.org_a938390c_20250126_025719.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.13.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Omar Sandoval <osandov@fb.com> | 2016-07-01 00:39:35 -0700 |
| --- | --- | --- |
| committer | Jens Axboe <axboe@fb.com> | 2016-07-01 08:39:24 -0600 |
| commit | [8ba8682107ee2ca3347354e018865d8e1967c5f4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)) | |
| tree | [3bd1064065c19b737eeb1f6d6258727f6ad49fe0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4) | |
| parent | [74524955556096a0b2a821a49b4d0abebad3ee16](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=74524955556096a0b2a821a49b4d0abebad3ee16) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4&id2=74524955556096a0b2a821a49b4d0abebad3ee16)) | |
| download | [linux-8ba8682107ee2ca3347354e018865d8e1967c5f4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8ba8682107ee2ca3347354e018865d8e1967c5f4.tar.gz) | |

block: fix use-after-free in sys\_ioprio\_get()get\_task\_ioprio() accesses the task->io\_context without holding the task
lock and thus can race with exit\_io\_context(), leading to a
use-after-free. The reproducer below hits this within a few seconds on
my 4-core QEMU VM:
#define \_GNU\_SOURCE
#include <assert.h>
#include <unistd.h>
#include <sys/syscall.h>
#include <sys/wait.h>
int main(int argc, char \*\*argv)
{
pid\_t pid, child;
long nproc, i;
/\* ioprio\_set(IOPRIO\_WHO\_PROCESS, 0, IOPRIO\_PRIO\_VALUE(IOPRIO\_CLASS\_IDLE, 0)); \*/
syscall(SYS\_ioprio\_set, 1, 0, 0x6000);
nproc = sysconf(\_SC\_NPROCESSORS\_ONLN);
for (i = 0; i < nproc; i++) {
pid = fork();
assert(pid != -1);
if (pid == 0) {
for (;;) {
pid = fork();
assert(pid != -1);
if (pid == 0) {
\_exit(0);
} else {
child = wait(NULL);
assert(child == pid);
}
}
}
pid = fork();
assert(pid != -1);
if (pid == 0) {
for (;;) {
/\* ioprio\_get(IOPRIO\_WHO\_PGRP, 0); \*/
syscall(SYS\_ioprio\_get, 2, 0);
}
}
}
for (;;) {
/\* ioprio\_get(IOPRIO\_WHO\_PGRP, 0); \*/
syscall(SYS\_ioprio\_get, 2, 0);
}
return 0;
}
This gets us KASAN dumps like this:
[ 35.526914] ==================================================================
[ 35.530009] BUG: KASAN: out-of-bounds in get\_task\_ioprio+0x7b/0x90 at addr ffff880066f34e6c
[ 35.530009] Read of size 2 by task ioprio-gpf/363
[ 35.530009] =============================================================================
[ 35.530009] BUG blkdev\_ioc (Not tainted): kasan: bad access detected
[ 35.530009] -----------------------------------------------------------------------------
[ 35.530009] Disabling lock debugging due to kernel taint
[ 35.530009] INFO: Allocated in create\_task\_io\_context+0x2b/0x370 age=0 cpu=0 pid=360
[ 35.530009] \_\_\_slab\_alloc+0x55d/0x5a0
[ 35.530009] \_\_slab\_alloc.isra.20+0x2b/0x40
[ 35.530009] kmem\_cache\_alloc\_node+0x84/0x200
[ 35.530009] create\_task\_io\_context+0x2b/0x370
[ 35.530009] get\_task\_io\_context+0x92/0xb0
[ 35.530009] copy\_process.part.8+0x5029/0x5660
[ 35.530009] \_do\_fork+0x155/0x7e0
[ 35.530009] SyS\_clone+0x19/0x20
[ 35.530009] do\_syscall\_64+0x195/0x3a0
[ 35.530009] return\_from\_SYSCALL\_64+0x0/0x6a
[ 35.530009] INFO: Freed in put\_io\_context+0xe7/0x120 age=0 cpu=0 pid=1060
[ 35.530009] \_\_slab\_free+0x27b/0x3d0
[ 35.530009] kmem\_cache\_free+0x1fb/0x220
[ 35.530009] put\_io\_context+0xe7/0x120
[ 35.530009] put\_io\_context\_active+0x238/0x380
[ 35.530009] exit\_io\_context+0x66/0x80
[ 35.530009] do\_exit+0x158e/0x2b90
[ 35.530009] do\_group\_exit+0xe5/0x2b0
[ 35.530009] SyS\_exit\_group+0x1d/0x20
[ 35.530009] entry\_SYSCALL\_64\_fastpath+0x1a/0xa4
[ 35.530009] INFO: Slab 0xffffea00019bcd00 objects=20 used=4 fp=0xffff880066f34ff0 flags=0x1fffe0000004080
[ 35.530009] INFO: Object 0xffff880066f34e58 @offset=3672 fp=0x0000000000000001
[ 35.530009] ==================================================================
Fix it by grabbing the task lock while we poke at the io\_context.
Cc: stable@vger.kernel.org
Reported-by: Dmitry Vyukov <dvyukov@google.com>
Signed-off-by: Omar Sandoval <osandov@fb.com>
Signed-off-by: Jens Axboe <axboe@fb.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)

| -rw-r--r-- | [block/ioprio.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/block/ioprio.c?id=8ba8682107ee2ca3347354e018865d8e1967c5f4) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/block/ioprio.c b/block/ioprio.cindex cc7800e9eb441e..01b8116298a13b 100644--- a/[block/ioprio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/block/ioprio.c?id=74524955556096a0b2a821a49b4d0abebad3ee16)+++ b/[block/ioprio.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/block/ioprio.c?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)@@ -150,8 +150,10 @@ static int get\_task\_ioprio(struct task\_struct \*p) if (ret) goto out; ret = IOPRIO\_PRIO\_VALUE(IOPRIO\_CLASS\_NONE, IOPRIO\_NORM);+ task\_lock(p); if (p->io\_context) ret = p->io\_context->ioprio;+ task\_unlock(p); out: return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-26 02:55:55 +0000



=== Content from git.kernel.org_8273acd4_20250124_190704.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Omar Sandoval <osandov@fb.com> | 2016-07-01 00:39:35 -0700 |
| --- | --- | --- |
| committer | Jens Axboe <axboe@fb.com> | 2016-07-01 08:39:24 -0600 |
| commit | [8ba8682107ee2ca3347354e018865d8e1967c5f4](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)) | |
| tree | [3bd1064065c19b737eeb1f6d6258727f6ad49fe0](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4) | |
| parent | [74524955556096a0b2a821a49b4d0abebad3ee16](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=74524955556096a0b2a821a49b4d0abebad3ee16) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4&id2=74524955556096a0b2a821a49b4d0abebad3ee16)) | |
| download | [linux-8ba8682107ee2ca3347354e018865d8e1967c5f4.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-8ba8682107ee2ca3347354e018865d8e1967c5f4.tar.gz) | |

block: fix use-after-free in sys\_ioprio\_get()get\_task\_ioprio() accesses the task->io\_context without holding the task
lock and thus can race with exit\_io\_context(), leading to a
use-after-free. The reproducer below hits this within a few seconds on
my 4-core QEMU VM:
#define \_GNU\_SOURCE
#include <assert.h>
#include <unistd.h>
#include <sys/syscall.h>
#include <sys/wait.h>
int main(int argc, char \*\*argv)
{
pid\_t pid, child;
long nproc, i;
/\* ioprio\_set(IOPRIO\_WHO\_PROCESS, 0, IOPRIO\_PRIO\_VALUE(IOPRIO\_CLASS\_IDLE, 0)); \*/
syscall(SYS\_ioprio\_set, 1, 0, 0x6000);
nproc = sysconf(\_SC\_NPROCESSORS\_ONLN);
for (i = 0; i < nproc; i++) {
pid = fork();
assert(pid != -1);
if (pid == 0) {
for (;;) {
pid = fork();
assert(pid != -1);
if (pid == 0) {
\_exit(0);
} else {
child = wait(NULL);
assert(child == pid);
}
}
}
pid = fork();
assert(pid != -1);
if (pid == 0) {
for (;;) {
/\* ioprio\_get(IOPRIO\_WHO\_PGRP, 0); \*/
syscall(SYS\_ioprio\_get, 2, 0);
}
}
}
for (;;) {
/\* ioprio\_get(IOPRIO\_WHO\_PGRP, 0); \*/
syscall(SYS\_ioprio\_get, 2, 0);
}
return 0;
}
This gets us KASAN dumps like this:
[ 35.526914] ==================================================================
[ 35.530009] BUG: KASAN: out-of-bounds in get\_task\_ioprio+0x7b/0x90 at addr ffff880066f34e6c
[ 35.530009] Read of size 2 by task ioprio-gpf/363
[ 35.530009] =============================================================================
[ 35.530009] BUG blkdev\_ioc (Not tainted): kasan: bad access detected
[ 35.530009] -----------------------------------------------------------------------------
[ 35.530009] Disabling lock debugging due to kernel taint
[ 35.530009] INFO: Allocated in create\_task\_io\_context+0x2b/0x370 age=0 cpu=0 pid=360
[ 35.530009] \_\_\_slab\_alloc+0x55d/0x5a0
[ 35.530009] \_\_slab\_alloc.isra.20+0x2b/0x40
[ 35.530009] kmem\_cache\_alloc\_node+0x84/0x200
[ 35.530009] create\_task\_io\_context+0x2b/0x370
[ 35.530009] get\_task\_io\_context+0x92/0xb0
[ 35.530009] copy\_process.part.8+0x5029/0x5660
[ 35.530009] \_do\_fork+0x155/0x7e0
[ 35.530009] SyS\_clone+0x19/0x20
[ 35.530009] do\_syscall\_64+0x195/0x3a0
[ 35.530009] return\_from\_SYSCALL\_64+0x0/0x6a
[ 35.530009] INFO: Freed in put\_io\_context+0xe7/0x120 age=0 cpu=0 pid=1060
[ 35.530009] \_\_slab\_free+0x27b/0x3d0
[ 35.530009] kmem\_cache\_free+0x1fb/0x220
[ 35.530009] put\_io\_context+0xe7/0x120
[ 35.530009] put\_io\_context\_active+0x238/0x380
[ 35.530009] exit\_io\_context+0x66/0x80
[ 35.530009] do\_exit+0x158e/0x2b90
[ 35.530009] do\_group\_exit+0xe5/0x2b0
[ 35.530009] SyS\_exit\_group+0x1d/0x20
[ 35.530009] entry\_SYSCALL\_64\_fastpath+0x1a/0xa4
[ 35.530009] INFO: Slab 0xffffea00019bcd00 objects=20 used=4 fp=0xffff880066f34ff0 flags=0x1fffe0000004080
[ 35.530009] INFO: Object 0xffff880066f34e58 @offset=3672 fp=0x0000000000000001
[ 35.530009] ==================================================================
Fix it by grabbing the task lock while we poke at the io\_context.
Cc: stable@vger.kernel.org
Reported-by: Dmitry Vyukov <dvyukov@google.com>
Signed-off-by: Omar Sandoval <osandov@fb.com>
Signed-off-by: Jens Axboe <axboe@fb.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)

| -rw-r--r-- | [block/ioprio.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/block/ioprio.c?id=8ba8682107ee2ca3347354e018865d8e1967c5f4) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/block/ioprio.c b/block/ioprio.cindex cc7800e9eb441e..01b8116298a13b 100644--- a/[block/ioprio.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/block/ioprio.c?id=74524955556096a0b2a821a49b4d0abebad3ee16)+++ b/[block/ioprio.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/block/ioprio.c?id=8ba8682107ee2ca3347354e018865d8e1967c5f4)@@ -150,8 +150,10 @@ static int get\_task\_ioprio(struct task\_struct \*p) if (ret) goto out; ret = IOPRIO\_PRIO\_VALUE(IOPRIO\_CLASS\_NONE, IOPRIO\_NORM);+ task\_lock(p); if (p->io\_context) ret = p->io\_context->ioprio;+ task\_unlock(p); out: return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 18:53:10 +0000



=== Content from source.android.com_c5f1c859_20250124_190709.html ===


[![Android Open Source Project](https://www.gstatic.com/devrel-devsite/prod/v2c0608cfe9941cacf4435921a2ece588be3719df069d9fba67130a84e4743128/androidsource/images/lockup.svg)](/)

`/`

* English
* Deutsch
* Español
* Español – América Latina
* Français
* Indonesia
* Italiano
* Polski
* Português
* Português – Brasil
* Tiếng Việt
* Türkçe
* Русский
* עברית
* العربيّة
* فارسی
* हिंदी
* বাংলা
* ภาษาไทย
* 中文 – 简体
* 中文 – 繁體
* 日本語
* 한국어

[Android Code Search](https://cs.android.com/android/platform/superproject/main)
Sign in

* [Documentation](https://source.android.com/docs)

[What's New?](https://source.android.com/docs/whatsnew)

[Getting Started](https://source.android.com/docs/setup)

[Security](https://source.android.com/docs/security)

[Core Topics](https://source.android.com/docs/core)

[Compatibility](https://source.android.com/docs/compatibility)

[Android Devices](https://source.android.com/docs/devices)

[Automotive](https://source.android.com/docs/automotive)

[Reference](https://source.android.com/reference)

[![Android Open Source Project](https://www.gstatic.com/devrel-devsite/prod/v2c0608cfe9941cacf4435921a2ece588be3719df069d9fba67130a84e4743128/androidsource/images/lockup.svg)](/)

* [Docs](/docs)
  + More
  + [What's New?](/docs/whatsnew)
  + [Getting Started](/docs/setup)
  + [Security](/docs/security)
  + [Core Topics](/docs/core)
  + [Compatibility](/docs/compatibility)
  + [Android Devices](/docs/devices)
  + [Automotive](/docs/automotive)
  + [Reference](/reference)
* [Android Code Search](https://cs.android.com/android/platform/superproject/main)

* [Overview](/docs/security)
* Security overview
  + [Secure an Android device](/docs/security/overview)
  + [Kernel security](/docs/security/overview/kernel-security)
  + [App security](/docs/security/overview/app-security)
  + [Implement security](/docs/security/overview/implement)
  + [Updates and resources](/docs/security/overview/updates-resources)
  + [ASPIRE](/docs/security/overview/aspire)
  + [Reports](/docs/security/overview/reports)
  + [Enhancements](/docs/security/enhancements)
  + [Acknowledgements](/docs/security/overview/acknowledgements)
* Android Security Bulletins
  + [Bulletins home](/docs/security/bulletin)
  + [Overview](/docs/security/bulletin/asb-overview)
  + 2025 bulletins
    - [January](/docs/security/bulletin/2025-01-01)
  + 2024 bulletins
    - [December](/docs/security/bulletin/2024-12-01)
    - [November](/docs/security/bulletin/2024-11-01)
    - [October](/docs/security/bulletin/2024-10-01)
    - [September](/docs/security/bulletin/2024-09-01)
    - [August](/docs/security/bulletin/2024-08-01)
    - [July](/docs/security/bulletin/2024-07-01)
    - [June](/docs/security/bulletin/2024-06-01)
    - [May](/docs/security/bulletin/2024-05-01)
    - [April](/docs/security/bulletin/2024-04-01)
    - [March](/docs/security/bulletin/2024-03-01)
    - [February](/docs/security/bulletin/2024-02-01)
    - [January](/docs/security/bulletin/2024-01-01)
    - [Android 15](/docs/security/bulletin/android-15)
  + 2023 bulletins
    - [December](/docs/security/bulletin/2023-12-01)
    - [November](/docs/security/bulletin/2023-11-01)
    - [October](/docs/security/bulletin/2023-10-01)
    - [September](/docs/security/bulletin/2023-09-01)
    - [August](/docs/security/bulletin/2023-08-01)
    - [July](/docs/security/bulletin/2023-07-01)
    - [June](/docs/security/bulletin/2023-06-01)
    - [May](/docs/security/bulletin/2023-05-01)
    - [April](/docs/security/bulletin/2023-04-01)
    - [March](/docs/security/bulletin/2023-03-01)
    - [February](/docs/security/bulletin/2023-02-01)
    - [January](/docs/security/bulletin/2023-01-01)
    - [Android 14](/docs/security/bulletin/android-14)
  + 2022 bulletins
    - [December](/docs/security/bulletin/2022-12-01)
    - [November](/docs/security/bulletin/2022-11-01)
    - [October](/docs/security/bulletin/2022-10-01)
    - [September](/docs/security/bulletin/2022-09-01)
    - [August](/docs/security/bulletin/2022-08-01)
    - [July](/docs/security/bulletin/2022-07-01)
    - [June](/docs/security/bulletin/2022-06-01)
    - [May](/docs/security/bulletin/2022-05-01)
    - [April](/docs/security/bulletin/2022-04-01)
    - [March](/docs/security/bulletin/2022-03-01)
    - [Android 12L](/docs/security/bulletin/android-12l)
    - [February](/docs/security/bulletin/2022-02-01)
    - [January](/docs/security/bulletin/2022-01-01)
    - [Android 13](/docs/security/bulletin/android-13)
    - [Index](/docs/security/bulletin/2022)
  + 2021 bulletins
    - [December](/docs/security/bulletin/2021-12-01)
    - [November](/docs/security/bulletin/2021-11-01)
    - [October](/docs/security/bulletin/2021-10-01)
    - [September](/docs/security/bulletin/2021-09-01)
    - [August](/docs/security/bulletin/2021-08-01)
    - [July](/docs/security/bulletin/2021-07-01)
    - [June](/docs/security/bulletin/2021-06-01)
    - [May](/docs/security/bulletin/2021-05-01)
    - [April](/docs/security/bulletin/2021-04-01)
    - [March](/docs/security/bulletin/2021-03-01)
    - [February](/docs/security/bulletin/2021-02-01)
    - [January](/docs/security/bulletin/2021-01-01)
    - [Android 12](/docs/security/bulletin/android-12)
    - [Index](/docs/security/bulletin/2021)
  + 2020 bulletins
    - [December](/docs/security/bulletin/2020-12-01)
    - [November](/docs/security/bulletin/2020-11-01)
    - [October](/docs/security/bulletin/2020-10-01)
    - [September](/docs/security/bulletin/2020-09-01)
    - [August](/docs/security/bulletin/2020-08-01)
    - [July](/docs/security/bulletin/2020-07-01)
    - [June](/docs/security/bulletin/2020-06-01)
    - [May](/docs/security/bulletin/2020-05-01)
    - [April](/docs/security/bulletin/2020-04-01)
    - [March](/docs/security/bulletin/2020-03-01)
    - [February](/docs/security/bulletin/2020-02-01)
    - [January](/docs/security/bulletin/2020-01-01)
    - [Android 11](/docs/security/bulletin/android-11)
    - [Index](/docs/security/bulletin/2020)
  + 2019 bulletins
    - [December](/docs/security/bulletin/2019-12-01)
    - [November](/docs/security/bulletin/2019-11-01)
    - [October](/docs/security/bulletin/2019-10-01)
    - [September](/docs/security/bulletin/2019-09-01)
    - [August](/docs/security/bulletin/2019-08-01)
    - [July](/docs/security/bulletin/2019-07-01)
    - [June](/docs/security/bulletin/2019-06-01)
    - [May](/docs/security/bulletin/2019-05-01)
    - [April](/docs/security/bulletin/2019-04-01)
    - [March](/docs/security/bulletin/2019-03-01)
    - [February](/docs/security/bulletin/2019-02-01)
    - [January](/docs/security/bulletin/2019-01-01)
    - [Android 10](/docs/security/bulletin/android-10)
    - [Index](/docs/security/bulletin/2019)
  + 2018 bulletins
    - [December](/docs/security/bulletin/2018-12-01)
    - [November](/docs/security/bulletin/2018-11-01)
    - [October](/docs/security/bulletin/2018-10-01)
    - [September](/docs/security/bulletin/2018-09-01)
    - [August](/docs/security/bulletin/2018-08-01)
    - [July](/docs/security/bulletin/2018-07-01)
    - [June](/docs/security/bulletin/2018-06-01)
    - [May](/docs/security/bulletin/2018-05-01)
    - [April](/docs/security/bulletin/2018-04-01)
    - [March](/docs/security/bulletin/2018-03-01)
    - [February](/docs/security/bulletin/2018-02-01)
    - [January](/docs/security/bulletin/2018-01-01)
    - [Index](/docs/security/bulletin/2018)
  + 2017 bulletins
    - [December](/docs/security/bulletin/2017-12-01)
    - [November](/docs/security/bulletin/2017-11-01)
    - [October](/docs/security/bulletin/2017-10-01)
    - [September](/docs/security/bulletin/2017-09-01)
    - [August](/docs/security/bulletin/2017-08-01)
    - [July](/docs/security/bulletin/2017-07-01)
    - [June](/docs/security/bulletin/2017-06-01)
    - [May](/docs/security/bulletin/2017-05-01)
    - [April](/docs/security/bulletin/2017-04-01)
    - [March](/docs/security/bulletin/2017-03-01)
    - [February](/docs/security/bulletin/2017-02-01)
    - [January](/docs/security/bulletin/2017-01-01)
    - [Index](/docs/security/bulletin/2017)
  + 2016 bulletins
    - [December](/docs/security/bulletin/2016-12-01)
    - [November](/docs/security/bulletin/2016-11-01)
    - [October](/docs/security/bulletin/2016-10-01)
    - [September](/docs/security/bulletin/2016-09-01)
    - [August](/docs/security/bulletin/2016-08-01)
    - [July](/docs/security/bulletin/2016-07-01)
    - [June](/docs/security/bulletin/2016-06-01)
    - [May](/docs/security/bulletin/2016-05-01)
    - [April](/docs/security/bulletin/2016-04-02)
    - [March](/docs/security/bulletin/2016-03-01)
    - [February](/docs/security/bulletin/2016-02-01)
    - [January](/docs/security/bulletin/2016-01-01)
    - [Index](/docs/security/bulletin/2016)
  + 2015 bulletins
    - [December](/docs/security/bulletin/2015-12-01)
    - [November](/docs/security/bulletin/2015-11-01)
    - [October](/docs/security/bulletin/2015-10-01)
    - [September](/docs/security/bulletin/2015-09-01)
    - [August](/docs/security/bulletin/2015-08-01)
    - [Index](/docs/security/bulletin/2015)
  + Pixel/Nexus bulletins
  + [Overview](/docs/security/bulletin/pixel)
  + 2025 bulletins
    - [January](/docs/security/bulletin/pixel/2025-01-01)
  + 2024 bulletins
    - [December](/docs/security/bulletin/pixel/2024-12-01)
    - [November](/docs/security/bulletin/pixel/2024-11-01)
    - [October](/docs/security/bulletin/pixel/2024-10-01)
    - [September](/docs/security/bulletin/pixel/2024-09-01)
    - [August](/docs/security/bulletin/pixel/2024-08-01)
    - [July](/docs/security/bulletin/pixel/2024-07-01)
    - [June](/docs/security/bulletin/pixel/2024-06-01)
    - [May](/docs/security/bulletin/pixel/2024-05-01)
    - [April](/docs/security/bulletin/pixel/2024-04-01)
    - [March](/docs/security/bulletin/pixel/2024-03-01)
    - [February](/docs/security/bulletin/pixel/2024-02-01)
    - [January](/docs/security/bulletin/pixel/2024-01-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/pixel/2023-12-01)
    - [November](/docs/security/bulletin/pixel/2023-11-01)
    - [October](/docs/security/bulletin/pixel/2023-10-01)
    - [September](/docs/security/bulletin/pixel/2023-09-01)
    - [August](/docs/security/bulletin/pixel/2023-08-01)
    - [July](/docs/security/bulletin/pixel/2023-07-01)
    - [June](/docs/security/bulletin/pixel/2023-06-01)
    - [May](/docs/security/bulletin/pixel/2023-05-01)
    - [April](/docs/security/bulletin/pixel/2023-04-01)
    - [March](/docs/security/bulletin/pixel/2023-03-01)
    - [February](/docs/security/bulletin/pixel/2023-02-01)
    - [January](/docs/security/bulletin/pixel/2023-01-01)
  + 2022 bulletins
    - [December](/docs/security/bulletin/pixel/2022-12-01)
    - [November](/docs/security/bulletin/pixel/2022-11-01)
    - [October](/docs/security/bulletin/pixel/2022-10-01)
    - [September](/docs/security/bulletin/pixel/2022-09-01)
    - [August](/docs/security/bulletin/pixel/2022-08-01)
    - [July](/docs/security/bulletin/pixel/2022-07-01)
    - [June](/docs/security/bulletin/pixel/2022-06-01)
    - [May](/docs/security/bulletin/pixel/2022-05-01)
    - [April](/docs/security/bulletin/pixel/2022-04-01)
    - [March](/docs/security/bulletin/pixel/2022-03-01)
    - [February](/docs/security/bulletin/pixel/2022-02-01)
    - [January](/docs/security/bulletin/pixel/2022-01-01)
  + 2021 bulletins
    - [December](/docs/security/bulletin/pixel/2021-12-01)
    - [November](/docs/security/bulletin/pixel/2021-11-01)
    - [October](/docs/security/bulletin/pixel/2021-10-01)
    - [September](/docs/security/bulletin/pixel/2021-09-01)
    - [August](/docs/security/bulletin/pixel/2021-08-01)
    - [July](/docs/security/bulletin/pixel/2021-07-01)
    - [June](/docs/security/bulletin/pixel/2021-06-01)
    - [May](/docs/security/bulletin/pixel/2021-05-01)
    - [April](/docs/security/bulletin/pixel/2021-04-01)
    - [March](/docs/security/bulletin/pixel/2021-03-01)
    - [February](/docs/security/bulletin/pixel/2021-02-01)
    - [January](/docs/security/bulletin/pixel/2021-01-01)
    - [Index](/docs/security/bulletin/pixel/2021)
  + 2020 bulletins
    - [December](/docs/security/bulletin/pixel/2020-12-01)
    - [November](/docs/security/bulletin/pixel/2020-11-01)
    - [October](/docs/security/bulletin/pixel/2020-10-01)
    - [September](/docs/security/bulletin/pixel/2020-09-01)
    - [August](/docs/security/bulletin/pixel/2020-08-01)
    - [July](/docs/security/bulletin/pixel/2020-07-01)
    - [June](/docs/security/bulletin/pixel/2020-06-01)
    - [May](/docs/security/bulletin/pixel/2020-05-01)
    - [April](/docs/security/bulletin/pixel/2020-04-01)
    - [March](/docs/security/bulletin/pixel/2020-03-01)
    - [February](/docs/security/bulletin/pixel/2020-02-01)
    - [January](/docs/security/bulletin/pixel/2020-01-01)
    - [Index](/docs/security/bulletin/pixel/2020)
  + 2019 bulletins
    - [December](/docs/security/bulletin/pixel/2019-12-01)
    - [November](/docs/security/bulletin/pixel/2019-11-01)
    - [October](/docs/security/bulletin/pixel/2019-10-01)
    - [September](/docs/security/bulletin/pixel/2019-09-01)
    - [August](/docs/security/bulletin/pixel/2019-08-01)
    - [July](/docs/security/bulletin/pixel/2019-07-01)
    - [June](/docs/security/bulletin/pixel/2019-06-01)
    - [May](/docs/security/bulletin/pixel/2019-05-01)
    - [April](/docs/security/bulletin/pixel/2019-04-01)
    - [March](/docs/security/bulletin/pixel/2019-03-01)
    - [February](/docs/security/bulletin/pixel/2019-02-01)
    - [January](/docs/security/bulletin/pixel/2019-01-01)
    - [Index](/docs/security/bulletin/pixel/2019)
  + 2018 bulletins
    - [December](/docs/security/bulletin/pixel/2018-12-01)
    - [November](/docs/security/bulletin/pixel/2018-11-01)
    - [October](/docs/security/bulletin/pixel/2018-10-01)
    - [September](/docs/security/bulletin/pixel/2018-09-01)
    - [August](/docs/security/bulletin/pixel/2018-08-01)
    - [July](/docs/security/bulletin/pixel/2018-07-01)
    - [June](/docs/security/bulletin/pixel/2018-06-01)
    - [May](/docs/security/bulletin/pixel/2018-05-01)
    - [April](/docs/security/bulletin/pixel/2018-04-01)
    - [March](/docs/security/bulletin/pixel/2018-03-01)
    - [February](/docs/security/bulletin/pixel/2018-02-01)
    - [January](/docs/security/bulletin/pixel/2018-01-01)
    - [Index](/docs/security/bulletin/pixel/2018)
  + 2017 bulletins
    - [December](/docs/security/bulletin/pixel/2017-12-01)
    - [November](/docs/security/bulletin/pixel/2017-11-01)
    - [October](/docs/security/bulletin/pixel/2017-10-01)
    - [Index](/docs/security/bulletin/pixel/2017)
  + Android Automotive
  + [Overview](/docs/security/bulletin/aaos)
  + 2025 bulletins
    - [January](/docs/security/bulletin/aaos/2025-01-01)
  + 2024 bulletins
    - [December](/docs/security/bulletin/aaos/2024-12-01)
    - [November](/docs/security/bulletin/aaos/2024-11-01)
    - [October](/docs/security/bulletin/aaos/2024-10-01)
    - [September](/docs/security/bulletin/aaos/2024-09-01)
    - [August](/docs/security/bulletin/aaos/2024-08-01)
    - [July](/docs/security/bulletin/aaos/2024-07-01)
    - [June](/docs/security/bulletin/aaos/2024-06-01)
    - [May](/docs/security/bulletin/aaos/2024-05-01)
    - [April](/docs/security/bulletin/aaos/2024-04-01)
    - [March](/docs/security/bulletin/aaos/2024-03-01)
    - [February](/docs/security/bulletin/aaos/2024-02-01)
    - [January](/docs/security/bulletin/aaos/2024-01-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/aaos/2023-12-01)
    - [November](/docs/security/bulletin/aaos/2023-11-01)
    - [October](/docs/security/bulletin/aaos/2023-10-01)
    - [September](/docs/security/bulletin/aaos/2023-09-01)
    - [August](/docs/security/bulletin/aaos/2023-08-01)
    - [July](/docs/security/bulletin/aaos/2023-07-01)
    - [June](/docs/security/bulletin/aaos/2023-06-01)
    - [May](/docs/security/bulletin/aaos/2023-05-01)
    - [April](/docs/security/bulletin/aaos/2023-04-01)
    - [March](/docs/security/bulletin/aaos/2023-03-01)
    - [February](/docs/security/bulletin/aaos/2023-02-01)
    - [January](/docs/security/bulletin/aaos/2023-01-01)
  + 2022 bulletins
    - [December](/docs/security/bulletin/aaos/2022-12-01)
    - [November](/docs/security/bulletin/aaos/2022-11-01)
    - [October](/docs/security/bulletin/aaos/2022-10-01)
    - [September](/docs/security/bulletin/aaos/2022-09-01)
    - [August](/docs/security/bulletin/aaos/2022-08-01)
    - [July](/docs/security/bulletin/aaos/2022-07-01)
    - [June](/docs/security/bulletin/aaos/2022-06-01)
    - [May](/docs/security/bulletin/aaos/2022-05-01)
    - [April](/docs/security/bulletin/aaos/2022-04-01)
    - [March](/docs/security/bulletin/aaos/2022-03-01)
    - [February](/docs/security/bulletin/aaos/2022-02-01)
    - [January](/docs/security/bulletin/aaos/2022-01-01)
  + 2021 bulletins
    - [December](/docs/security/bulletin/aaos/2021-12-01)
    - [November](/docs/security/bulletin/aaos/2021-11-01)
    - [October](/docs/security/bulletin/aaos/2021-10-01)
    - [September](/docs/security/bulletin/aaos/2021-09-01)
    - [August](/docs/security/bulletin/aaos/2021-08-01)
    - [July](/docs/security/bulletin/aaos/2021-07-01)
    - [June](/docs/security/bulletin/aaos/2021-06-01)
    - [May](/docs/security/bulletin/aaos/2021-05-01)
    - [April](/docs/security/bulletin/aaos/2021-04-01)
    - [March](/docs/security/bulletin/aaos/2021-03-01)
    - [February](/docs/security/bulletin/aaos/2021-02-01)
    - [January](/docs/security/bulletin/aaos/2021-01-01)
  + Chromecast
  + [Overview](/docs/security/bulletin/chromecast)
  + 2024 bulletins
    - [December](/docs/security/bulletin/chromecast/2024-12-01)
    - [September](/docs/security/bulletin/chromecast/2024-09-01)
    - [July](/docs/security/bulletin/chromecast/2024-07-01)
    - [March](/docs/security/bulletin/chromecast/2024-03-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/chromecast/2023-12-01)
    - [September](/docs/security/bulletin/chromecast/2023-07-01)
    - [June](/docs/security/bulletin/chromecast/2023-06-01)
    - [April](/docs/security/bulletin/chromecast/2023-04-01)
  + 2022 bulletins
    - [December](/docs/security/bulletin/chromecast/2022-12-01)
    - [October](/docs/security/bulletin/chromecast/2022-10-01)
    - [July](/docs/security/bulletin/chromecast/2022-07-01)
  + Wear
  + [Overview](/docs/security/bulletin/wear)
  + 2025 bulletins
    - [January](/docs/security/bulletin/wear/2025/2025-01-01)
  + 2024 bulletins
    - [December](/docs/security/bulletin/wear/2024/2024-12-01)
    - [November](/docs/security/bulletin/wear/2024/2024-11-01)
    - [October](/docs/security/bulletin/wear/2024/2024-10-01)
    - [September](/docs/security/bulletin/wear/2024/2024-09-01)
    - [August](/docs/security/bulletin/wear/2024/2024-08-01)
    - [July](/docs/security/bulletin/wear/2024/2024-07-01)
    - [June](/docs/security/bulletin/wear/2024/2024-06-01)
    - [May](/docs/security/bulletin/wear/2024/2024-05-01)
    - [April](/docs/security/bulletin/wear/2024/2024-04-01)
    - [March](/docs/security/bulletin/wear/2024/2024-03-01)
    - [February](/docs/security/bulletin/wear/2024/2024-02-01)
    - [January](/docs/security/bulletin/wear/2024/2024-01-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/wear/2023/2023-12-01)
    - [November](/docs/security/bulletin/wear/2023/2023-11-01)
    - [October](/docs/security/bulletin/wear/2023/2023-10-01)
    - [September](/docs/security/bulletin/wear/2023/2023-09-01)
    - [August](/docs/security/bulletin/wear/2023/2023-08-01)
  + Pixel Watch
  + [Overview](/docs/security/bulletin/pixel-watch)
  + 2024 bulletins
    - [December](/docs/security/bulletin/pixel-watch/2024-12-01)
    - [August](/docs/security/bulletin/pixel-watch/2024-08-01)
    - [July](/docs/security/bulletin/pixel-watch/2024-07-01)
    - [June](/docs/security/bulletin/pixel-watch/2024-06-01)
    - [May](/docs/security/bulletin/pixel-watch/2024-05-01)
    - [April](/docs/security/bulletin/pixel-watch/2024-04-01)
    - [March](/docs/security/bulletin/pixel-watch/2024-03-01)
    - [February](/docs/security/bulletin/pixel-watch/2024-02-01)
    - [January](/docs/security/bulletin/pixel-watch/2024-01-01)
  + 2023 bulletins
    - [December](/docs/security/bulletin/pixel-watch/2023/2023-12-01)
    - [September](/docs/security/bulletin/pixel-watch/2023/2023-09-01)
    - [June](/docs/security/bulletin/pixel-watch/2023/2023-06-01)
  + Advisories
  + [Overview](/docs/security/bulletin/advisory)
  + [March 2016](/docs/security/bulletin/advisory/2016-03-18)
* Features
  + [Overview](/docs/security/features)
  + [Application Sandbox](/docs/security/app-sandbox)
  + [OMAPI vendor stable interface](/docs/security/features/open-mobile-api)
  + App signing
    - [Overview](/docs/security/features/apksigning)
    - [APK signature scheme v2](/docs/security/features/apksigning/v2)
    - [APK signature scheme v3](/docs/security/features/apksigning/v3)
    - [APK signature scheme v3.1](/docs/security/features/apksigning/v3-1)
    - [APK signature scheme v4](/docs/security/features/apksigning/v4)
  + Authentication
    - [Overview](/docs/security/features/authentication)
    - [Gatekeeper](/docs/security/features/authentication/gatekeeper)
    - Biometrics
      * [Overview](/docs/security/features/biometric)
      * [Measure biometric security](/docs/security/features/biometric/measure)
      * [Fingerprint HIDL](/docs/security/features/authentication/fingerprint-hal)
      * [Face authentication HIDL](/docs/security/features/biometric/face-authentication)
    - Protected confirmation
      * [Overview](/docs/security/features/protected-confirmation)
      * [Implementation](/docs/security/features/protected-confirmation/implementation)
      * [Design guidelines](/docs/security/features/protected-confirmation/design)
      * [Accessibility](/docs/security/features/protected-confirmation/accessibility)
  + DICE
    - [Overview](/docs/security/features/dice)
    - [Applications of DICE](/docs/security/features/dice/applications-of-dice)
  + Encryption
    - [Overview](/docs/security/features/encryption)
    - [File-based encryption](/docs/security/features/encryption/file-based)
    - [Full-disk encryption](/docs/security/features/encryption/full-disk)
    - [Metadata encryption](/docs/security/features/encryption/metadata)
    - [Enable Adiantum](/docs/security/features/encryption/adiantum)
    - [Hardware-wrapped keys](/docs/security/features/encryption/hw-wrapped-keys)
  + Keystore
    - [Overview](/docs/security/features/keystore)
    - [Features](/docs/security/features/keystore/features)
    - [Key and ID attestation](/docs/security/features/keystore/attestation)
    - [Version binding](/docs/security/features/keystore/version-binding)
    - [Authorization tags](/docs/security/features/keystore/tags)
    - [Functions](/docs/security/features/keystore/implementer-ref)
  + Identity credential
    - [Overview](/docs/security/features/identity-credentials)
  + SELinux
    - [Overview](/docs/security/features/selinux)
    - [Concepts](/docs/security/features/selinux/concepts)
    - [Implementation](/docs/security/features/selinux/implement)
    - [Customization](/docs/security/features/selinux/customize)
    - [Build sepolicy](/docs/security/features/selinux/build)
    - [Compatibility](/docs/security/features/selinux/compatibility)
    - [Validation](/docs/security/features/selinux/validate)
    - [Write policy](/docs/security/features/selinux/device-policy)
    - [Vendor init](/docs/security/features/selinux/vendor-init)
  + Trusty TEE
    - [Overview](/docs/security/features/trusty)
    - [Download and build](/docs/security/features/trusty/download-and-build)
    - [Trusty API reference](/docs/security/features/trusty/trusty-ref)
  + Verified Boot
    - [Overview](/docs/security/features/verifiedboot)
    - [Device state](/docs/security/features/verifiedboot/device-state)
    - [Verify Boot](/docs/security/features/verifiedboot/verified-boot)
    - [Boot flow](/docs/security/features/verifiedboot/boot-flow)
    - [Implement dm-verity](/docs/security/features/verifiedboot/dm-verity)
    - [Verify system\_other partition](/docs/security/features/verifiedboot/verify-system-other-partition)
    - [Reference implementation](/docs/security/features/verifiedboot/avb)
  + Safety Center
    - [Overview](/docs/security/safety-center/overview)
    - [Customize Safety Center](/docs/security/safety-center/customize)
    - [Customize Safety Center UI](/docs/security/safety-center/customize-ui)
    - [Interact with Safety Center](/docs/security/safety-center/interact)
    - [Testing and validation](/docs/security/safety-center/test-requirements)
  + Cellular security
    - [Overview](/docs/security/features/cellular-security/overview)
    - [Disable 2G](/docs/security/features/cellular-security/disable-2g)
  + [Private space](/docs/security/features/private-space)
* Testing
  + [Overview](/docs/security/test/fuzz-sanitize)
  + [Memory safety](/docs/security/test/memory-safety)
  + Arm Memory Tagging Extension
  + [Overview](/docs/security/test/memory-safety/arm-mte)
  + [Bootloader support](/docs/security/test/memory-safety/bootloader-support)
  + [Understand MTE reports](/docs/security/test/memory-safety/mte-reports)
  + [MTE configuration](/docs/security/test/memory-safety/mte-configuration)
  + Sanitizers
  + [Overview](/docs/security/test/sanitizers)
  + [AddressSanitizer](/docs/security/test/asan)
  + [Kernel AddressSanitizer](/docs/security/test/kasan)
  + [Hardware-assisted AddressSanitizer](/docs/security/test/hwasan)
  + [Understand HWASan reports](/docs/security/test/memory-safety/hwasan-reports)
  + [UndefinedBehaviorSanitizer](/docs/security/test/ubsan)
  + Other topics
  + [Control flow integrity](/docs/security/test/cfi)
  + [Kernel control flow integrity](/docs/security/test/kcfi)
  + [Execute-only memory](/docs/security/test/execute-only-memory)
  + [Fuzz with libFuzzer](/docs/security/test/libfuzzer)
  + [GWP-ASan and KFENCE](/docs/security/test/memory-safety/gwp-asan-kfence)
  + [Security Test Suite development kit](/docs/security/test/sts-sdk)
  + [Scudo](/docs/security/test/scudo)
  + [ShadowCallStack](/docs/security/test/shadow-call-stack)
  + [Tagged pointers](/docs/security/test/tagged-pointers)
  + [Zero initialized memory](/docs/security/test/memory-safety/zero-initialized-memory)
* Best practices
  + [Overview](/docs/security/best-practices)
  + [Operational security](/docs/security/best-practices/ops)
  + [System security](/docs/security/best-practices/system)
  + [App security](/docs/security/best-practices/app)
  + [Network security](/docs/security/best-practices/network)
  + [Hardware security](/docs/security/best-practices/hardware)
  + [Privacy security](/docs/security/best-practices/privacy)

* What's new?
* [Release notes](/docs/whatsnew/release-notes)
* [Latest security bulletins](/docs/whatsnew/latest-security-bulletins)
* [Latest Compatibility Definition Document (CDD)](/docs/whatsnew/latest-cdd)
* [Site updates](/docs/whatsnew/site-updates)
* Getting Started
* [About](/docs/setup/about)
* [Start](/docs/setup/start)
* [Download](/docs/setup/download)
* [Build](/docs/setup/build)
* [Test](/docs/setup/test)
* [Create](/docs/setup/create/coding-tasks)
* [Contribute](/docs/setup/contribute)
* [Community](/docs/setup/community/cofc)
* [Tools, build, and related reference](/docs/setup/reference)
* Security
* [Overview](/docs/security/overview)
* [Bulletins](/docs/security/bulletin)
* [Features](/docs/security/features)
* [Testing](/docs/security/test/fuzz-sanitize)
* [Best Practices](/docs/security/best-practices)
* Core Topics
* [Architecture](/docs/core/architecture)
* [Audio](/docs/core/audio)
* [Camera](/docs/core/camera)
* [Connectivity](/docs/core/connect)
* [Data](/docs/core/data)
* [Display](/docs/core/display)
* [Fonts](/docs/core/fonts/custom-font-fallback)
* [Graphics](/docs/core/graphics)
* [Interaction](/docs/core/interaction)
* [Media](/docs/core/media)
* [Performance](/docs/core/perf)
* [Permissions](/docs/core/permissions)
* [Power](/docs/core/power)
* [Runtime](/docs/core/runtime)
* [Settings](/docs/core/settings)
* [Storage](/docs/core/storage)
* [Tests](/docs/core/tests)
* [Updates](/docs/core/ota)
* [Virtualization](/docs/core/virtualization)
* Compatibility
* [Compatibility Definition Document (CDD)](/docs/compatibility/cdd)
* [Compatibility Test Suite (CTS)](/docs/compatibility/cts)
* Android Devices
* [Cuttlefish](/docs/devices/cuttlefish)
* [Enterprise](/docs/devices/admin)
* [TV](/docs/devices/tv)
* Automotive
* [Get Started](/docs/automotive/start/what_automotive)
* [Guidelines for Development](/docs/automotive/guidelines)
* [Development Tools](/docs/automotive/dev-tools)
* [Testing Tools and Infrastructure](/docs/automotive/tools)
* [Release Details](/docs/automotive/start/releases)
* Reference
* [HIDL](/reference/hidl)
* [HAL](/reference/hal)
* [Trade Federation](/reference/tradefed/classes)
* [Security Test Suite](/reference/sts/classes)

* [AOSP](https://source.android.com/)
* [Security](https://source.android.com/docs/security)

# Android Security Bulletin—November 2016

Stay organized with collections

Save and categorize content based on your preferences.

*Published November 07, 2016 | Updated December 21, 2016*

The Android Security Bulletin contains details of security vulnerabilities
affecting Android devices. Alongside the bulletin, we have released a security
update to Google devices through an over-the-air (OTA) update. The Google device
firmware images have also been released to the
[Google Developer
site](https://developers.google.com/android/nexus/images). Security patch levels of November 06, 2016 or later address all of
these issues. Refer to the
[Pixel
and Nexus update schedule](https://support.google.com/pixelphone/answer/4457705#pixel_phones&nexus_devices) to learn how to check a device's security patch level.

Partners were notified of the issues described in the bulletin on October 20,
2016 or earlier. Where applicable, source code patches for these issues have
been released to the Android Open Source Project (AOSP) repository. This
bulletin also includes links to patches outside of AOSP.

The most severe of these issues is a Critical security vulnerability that could
enable remote code execution on an affected device through multiple methods such
as email, web browsing, and MMS when processing media files. The
[severity
assessment](/docs/security/overview/updates-resources#severity) is based on the effect that exploiting the vulnerability would
possibly have on an affected device, assuming the platform and service
mitigations are disabled for development purposes or if successfully bypassed.

We have had no reports of active customer exploitation or abuse of these newly
reported issues. Refer to the
[Android and Google service
mitigations](#mitigations) section for details on the
[Android
security platform protections](/docs/security/enhancements) and service protections such as
[SafetyNet](https://developer.android.com/training/safetynet/index.html),
which improve the security of the Android platform.

We encourage all customers to accept these updates to their devices.

## Announcements

* With the introduction of the Pixel and Pixel XL devices, the term for
  [all devices supported by Google](#google-devices) is
  "Google devices" instead of "Nexus devices."
* This bulletin has three security patch levels to provide Android partners
  with the flexibility to more quickly fix a subset of vulnerabilities that are
  similar across all Android devices. See
  [Common questions and answers](#common-questions-and-answers) for
  additional information:
  + **2016-11-01**: Partial security patch level. This security
    patch level indicates that all issues associated with 2016-11-01 (and all
    previous security patch level) are addressed.
  + **2016-11-05**: Complete security patch level. This security
    patch level indicates that all issues associated with 2016-11-01 and 2016-11-05
    (and all previous security patch levels) are addressed.
  + **Supplemental security patch levels**

    Supplemental security patch levels are provided to identify devices
    that contain fixes for issues that were publicly disclosed after the
    patch level was defined. Addressing these recently disclosed
    vulnerabilities is not required until the 2016-12-01 security patch level.

    - **2016-11-06**: This security patch level indicates that the
      device has addressed all issues associated with 2016-11-05 and CVE-2016-5195,
      which was publicly disclosed on October 19, 2016.
* Supported Google devices will receive a single OTA update with the November
  05, 2016 security patch level.

## Android and Google service mitigations

This is a summary of the mitigations provided by the
[Android
security platform](/docs/security/enhancements) and service protections, such as SafetyNet. These
capabilities reduce the likelihood that security vulnerabilities could be
successfully exploited on Android.

* Exploitation for many issues on Android is made more difficult by
  enhancements in newer versions of the Android platform. We encourage all users
  to update to the latest version of Android where possible.
* The Android Security team actively monitors for abuse with
  [Verify
  Apps and SafetyNet](/static/docs/security/overview/reports/Google_Android_Security_2015_Report_Final.pdf), which are designed to warn users about
  [Potentially
  Harmful Applications](http://static.googleusercontent.com/media/source.android.com/en//security/reports/Google_Android_Security_PHA_classifications.pdf). Verify Apps is enabled by default on devices with
  [Google Mobile Services](http://www.android.com/gms) and is especially
  important for users who install applications from outside of Google Play. Device
  rooting tools are prohibited within Google Play, but Verify Apps warns users
  when they attempt to install a detected rooting application—no matter where it
  comes from. Additionally, Verify Apps attempts to identify and block
  installation of known malicious applications that exploit a privilege escalation
  vulnerability. If such an application has already been installed, Verify Apps
  will notify the user and attempt to remove the detected application.
* As appropriate, Google Hangouts and Messenger applications do not
  automatically pass media to processes such as Mediaserver.

## Acknowledgements

We would like to thank these researchers for their contributions:

* Abhishek Arya, Oliver Chang, and Martin Barbella of Google Chrome Security
  Team: CVE-2016-6722
* Andrei Kapishnikov and Miriam Gershenson of Google: CVE-2016-6703
* Ao Wang ([@ArayzSegment](https://twitter.com/ArayzSegment)) and
  [Zinuo Han](http://weibo.com/ele7enxxh) of
  [PKAV](http://www.pkav.net), Silence Information Technology:
  CVE-2016-6700, CVE-2016-6702
* Askyshang of Security Platform Department, Tencent: CVE-2016-6713
* Billy Lau of Android Security: CVE-2016-6737
* Constantinos Patsakis and
  Efthimios Alepis of University of Piraeus:
  CVE-2016-6715
* dragonltx of Alibaba mobile security team: CVE-2016-6714
* Gal Beniamini of Project Zero: CVE-2016-6707, CVE-2016-6717
* Gengjia Chen ([@chengjia4574](http://twitter.com/chengjia4574))
  and [pjf](http://weibo.com/jfpan) of IceSword Lab,
  [Qihoo 360 Technology Co. Ltd](http://www.360.com).: CVE-2016-6725,
  CVE-2016-6738, CVE-2016-6740, CVE-2016-6741, CVE-2016-6742, CVE-2016-6744,
  CVE-2016-6745, CVE-2016-3906
* Guang Gong (龚广) ([@oldfresher](http://twitter.com/oldfresher)) of
  Alpha Team, [Qihoo 360 Technology Co. Ltd](http://www.360.com).:
  CVE-2016-6754
* Jianqiang Zhao ([@jianqiangzhao](http://twitter.com/jianqiangzhao)) and
  [pjf](http://weibo.com/jfpan) of IceSword Lab,
  [Qihoo 360 Technology Co. Ltd](http://www.360.com).: CVE-2016-6739,
  CVE-2016-3904, CVE-2016-3907, CVE-2016-6698
* Marco Grassi ([@marcograss](http://twitter.com/marcograss)) of
  Keen Lab of Tencent ([@keen\_lab](http://twitter.com/keen_lab)):
  CVE-2016-6828
* Mark Brand of Project Zero: CVE-2016-6706
* Mark Renouf of Google: CVE-2016-6724
* Michał Bednarski ([github.com/michalbednarski](https://github.com/michalbednarski)):
  CVE-2016-6710
* Min Chong of Android Security: CVE-2016-6743
* Peter Pi ([@heisecode](http://twitter.com/heisecode)) of Trend
  Micro: CVE-2016-6721
* Qidan He (何淇丹) ([@flanker\_hqd](http://twitter.com/flanker_hqd))
  and Gengming Liu (刘耕铭) ([@dmxcsnsbh](http://twitter.com/dmxcsnsbh))
  of KeenLab, Tencent: CVE-2016-6705
* Robin Lee of Google: CVE-2016-6708
* Scott Bauer ([@ScottyBauer1](http://twitter.com/ScottyBauer1)): CVE-2016-6751
* Sergey Bobrov ([@Black2Fan](http://twitter.com/Black2Fan)) of
  Kaspersky Lab: CVE-2016-6716
* Seven Shen ([@lingtongshen](http://twitter.com/lingtongshen)) of
  Trend Micro Mobile Threat Research Team: CVE-2016-6748, CVE-2016-6749,
  CVE-2016-6750, CVE-2016-6753
* Victor van der Veen, Herbert Bos, Kaveh Razavi, and Cristiano Giuffrida of
  Vrije Universiteit Amsterdam and Yanick Fratantonio, Martina Lindorfer, and
  Giovanni Vigna of University of California, Santa Barbara: CVE-2016-6728
* Weichao Sun ([@sunblate](https://twitter.com/sunblate)) of
  Alibaba Inc: CVE-2016-6712, CVE-2016-6699, CVE-2016-6711
* Wenke Dou (vancouverdou@gmail.com), Chiachih Wu
  ([@chiachih\_wu](https://twitter.com/chiachih_wu)), and Xuxian Jiang
  of [C0RE Team](http://c0reteam.org): CVE-2016-6720
* Wish Wu (吴潍浠) ([@wish\_wu](http://twitter.com/wish_wu)) of Trend
  Micro Inc.: CVE-2016-6704
* Yakov Shafranovich of
  [Nightwatch Cybersecurity](https://wwws.nightwatchcybersecurity.com):
  CVE-2016-6723
* Yuan-Tsung Lo,
  Yao Jun,
  Tong Lin, Chiachih Wu ([@chiachih\_wu](https://twitter.com/chiachih_wu)), and Xuxian Jiang of
  [C0RE Team](http://c0reteam.org): CVE-2016-6730, CVE-2016-6732,
  CVE-2016-6734, CVE-2016-6736
* Yuan-Tsung Lo,
  Yao Jun,
  Xiaodong Wang, Chiachih Wu ([@chiachih\_wu](https://twitter.com/chiachih_wu)), and Xuxian Jiang of
  [C0RE Team](http://c0reteam.org): CVE-2016-6731, CVE-2016-6733,
  CVE-2016-6735, CVE-2016-6746

Additional thanks to Zach Riggle of Android Security for his contributions
to several issues in this bulletin.

## 2016-11-01 security patch level—Vulnerability details

In the sections below, we provide details for each of the security
vulnerabilities that apply to the 2016-11-01 patch level. There is a description of
the issue, a severity rationale, and a table with the CVE, associated
references, severity, updated Google devices, updated AOSP versions (where
applicable), and date reported. When available, we will link the public change
that addressed the issue to the bug ID, like the AOSP change list. When multiple
changes relate to a single bug, additional references are linked to numbers
following the bug ID.

### Remote code execution vulnerability in Mediaserver

A remote code execution vulnerability in Mediaserver could enable an attacker
using a specially crafted file to cause memory corruption during media file and
data processing. This issue is rated as Critical due to the possibility of
remote code execution within the context of the Mediaserver process.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6699 | [A-31373622](https://android.googlesource.com/platform/frameworks/av/%2B/3b1c9f692c4d4b7a683c2b358fc89e831a641b88) | Critical | All | 7.0 | Jul 27, 2016 |

### Elevation of privilege vulnerability in libzipfile

An elevation of privilege vulnerability in libzipfile could enable a local
malicious application to execute arbitrary code within the context of a
privileged process. This issue is rated as Critical due to the possibility of a
local permanent device compromise, which may require reflashing the operating
system to repair the device.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6700 | A-30916186 | Critical | None\* | 4.4.4, 5.0.2, 5.1.1 | Aug 17, 2016 |

\* Supported Google devices on Android 7.0 or later that have installed all
available updates are not affected by this vulnerability.

### Remote code execution vulnerability in Skia

A remote code execution vulnerability in libskia could enable an attacker using
a specially crafted file to cause memory corruption during media file and data
processing. This issue is rated as High due to the possibility of remote code
execution within the context of the gallery process.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6701 | [A-30190637](https://android.googlesource.com/platform/external/skia/%2B/aca73722873e908633ff27375f6f93a08cbb7dd3) | High | All | 7.0 | Google internal |

### Remote code execution vulnerability in libjpeg

A remote code execution vulnerability in libjpeg could enable an attacker using
a specially crafted file to execute arbitrary code in the context of an
unprivileged process. This issue is rated as High due to the possibility of
remote code execution in an application that uses libjpeg.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6702 | A-30259087 | High | None\* | 4.4.4, 5.0.2, 5.1.1 | Jul 19, 2016 |

\* Supported Google devices on Android 7.0 or later that have installed all
available updates are not affected by this vulnerability.

### Remote code execution vulnerability in Android runtime

A remote code execution vulnerability in an Android runtime library could enable
an attacker using a specially crafted payload to execute arbitrary code in the
context of an unprivileged process. This issue is rated as High due to the
possibility of remote code execution in an application that uses the Android
runtime.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6703 | A-30765246 | High | None\* | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1 | Google internal |

\* Supported Google devices on Android 7.0 or later that have installed all
available updates are not affected by this vulnerability.

### Elevation of privilege vulnerability in Mediaserver

An elevation of privilege vulnerability in Mediaserver could enable a local
malicious application to execute arbitrary code within the context of a
privileged process. This issue is rated as High because it could be used to gain
local access to elevated capabilities, which are not normally accessible to a
third-party application.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6704 | [A-30229821](https://android.googlesource.com/platform/frameworks/av/%2B/c6c446f9e022adf20064e65a17574804f8af8e7d) [[2](https://android.googlesource.com/platform/hardware/qcom/audio/%2B/9cb9810ecb63c8ff55ecf4bc77431dc5b0688b5f)] [[3](https://android.googlesource.com/platform/system/media/%2B/a6274f03b4dfe1c3a22af51e3a17ea56a314e747)] | High | All | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Jul 19, 2016 |
| CVE-2016-6705 | [A-30907212](https://android.googlesource.com/platform/frameworks/av/%2B/3a03fa24d21f97e84e796ac5ef14b3f434c0e8f1) [[2](https://android.googlesource.com/platform/frameworks/av/%2B/bd04b47d38a89f1dada1c6da2ef4a3d235c166b8)] | High | All | 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Aug 16, 2016 |
| CVE-2016-6706 | [A-31385713](https://android.googlesource.com/platform/frameworks/av/%2B/1d4feebdb85db46e138530f360d9ff2490e14353) | High | All | 7.0 | Sep 8, 2016 |

### Elevation of privilege vulnerability in System Server

An elevation of privilege vulnerability in System Server could enable a local
malicious application to execute arbitrary code within the context of a
privileged process. This issue is rated as High because it could be used to gain
local access to elevated capabilities, which are not normally accessible to a
third-party application.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6707 | [A-31350622](https://android.googlesource.com/platform/frameworks/base/%2B/16024ea7c4bae08c972cf6b3734029aad33e8870) | High | All | 6.0, 6.0.1, 7.0 | Sep 7, 2016 |

### Elevation of privilege vulnerability in System UI

An elevation of privilege in the System UI could enable a local malicious user
to bypass the security prompt of a work profile in Multi-Window mode. This
issue is rated as High because it is a local bypass of user interaction
requirements for any developer or security setting modifications.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6708 | [A-30693465](https://android.googlesource.com/platform/frameworks/base/%2B/c9c73fde339b4db496f2c1ff8c18df1e9db5a7c1) | High | All | 7.0 | Google internal |

### Information disclosure vulnerability in Conscrypt

An information disclosure vulnerability in Conscrypt could enable
an attacker to gain access to sensitive information if a
legacy encryption API is used by an application. This issue is rated as High
because it could be used to access data without permission.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6709 | [A-31081987](https://android.googlesource.com/platform/external/conscrypt/%2B/44ef9535b9afb123d150d8e0362e4bb50794dd41) | High | All | 6.0, 6.0.1, 7.0 | Oct 9, 2015 |

### Information disclosure vulnerability in download manager

An information disclosure vulnerability in the download manager could enable a
local malicious application to bypass operating system protections that isolate
application data from other applications. This issue is rated as High because it
could be used to gain access to data that the application does not have access
to.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6710 | [A-30537115](https://android.googlesource.com/platform/frameworks/base/%2B/9fab683c9598d234dd8461335c276ed3e37c91e8) [[2](https://android.googlesource.com/platform/packages/providers/DownloadProvider/%2B/243e62949f7208d3b82eda3ee4ec22d3dbc1fb19)] | High | All | 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Jul 30, 2016 |

### Denial of service vulnerability in Bluetooth

A denial of service vulnerability in Bluetooth could enable a proximate attacker
to block Bluetooth access to an affected device. This issue is rated as High due
to the possibility of remote denial of service.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2014-9908 | A-28672558 | High | None\* | 4.4.4, 5.0.2, 5.1.1 | May 5, 2014 |

\* Supported Google devices on Android 7.0 or later that have installed all
available updates are not affected by this vulnerability.

### Denial of service vulnerability in OpenJDK

A remote denial of service vulnerability in OpenJDK could enable an attacker to
use a specially crafted file to cause a device hang or reboot. This issue is
rated as High due to the possibility of remote denial of service.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2015-0410 | [A-30703445](https://android.googlesource.com/platform/libcore/%2B/21098574528bdf99dd50a74a60e161573e999108) | High | All | 7.0 | Jan 16, 2015 |

### Denial of service vulnerability in Mediaserver

A remote denial of service vulnerability in Mediaserver could enable an attacker
to use a specially crafted file to cause a device hang or reboot. This issue is
rated as High due to the possibility of remote denial of service.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6711 | [A-30593765](https://android.googlesource.com/platform/external/libvpx/%2B/063be1485e0099bc81ace3a08b0ec9186dcad693) | High | None\* | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1 | Aug 1, 2016 |
| CVE-2016-6712 | [A-30593752](https://android.googlesource.com/platform/external/libvpx/%2B/fdb1b40e7bb147c07bda988c9501ad223795d12d) | High | None\* | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1 | Aug 1, 2016 |
| CVE-2016-6713 | [A-30822755](https://android.googlesource.com/platform/external/libavc/%2B/8cafca0e8b1ed8125918e203118c5a4e612fd56c) | High | All | 6.0, 6.0.1, 7.0 | Aug 11, 2016 |
| CVE-2016-6714 | [A-31092462](https://android.googlesource.com/platform/external/libavc/%2B/5bdb0a6b72782e505671a387bb5f83222d891d6a) | High | All | 6.0, 6.0.1, 7.0 | Aug 22, 2016 |

\* Supported Google devices on Android 7.0 or later that have installed all
available updates are not affected by this vulnerability.

### Elevation of privilege vulnerability in Framework APIs

An elevation of privilege vulnerability in the Framework APIs could allow a
local malicious application to record audio without the user's permission. This
issue is rated as Moderate because it is a local bypass of user interaction
requirements (access to functionality that would normally require either user
initiation or user permission).

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6715 | [A-29833954](https://android.googlesource.com/platform/frameworks/base/%2B/3de09838fb0996bb4b420630800ad34e828fd1b6) | Moderate | All | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Jun 28, 2016 |

### Elevation of privilege vulnerability in AOSP Launcher

An elevation of privilege vulnerability in the AOSP Launcher could allow a local
malicious application to create shortcuts that have elevated privileges without
the user's consent. This issue is rated as Moderate because it is a local bypass
of user interaction requirements (access to functionality that would normally
require either user initiation or user permission).

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6716 | [A-30778130](https://android.googlesource.com/platform/packages/apps/Launcher3/%2B/e83fc11c982e67dd0181966f5f3a239ea6b14924) | Moderate | All | 7.0 | Aug 5, 2016 |

### Elevation of privilege vulnerability in Mediaserver

An elevation of privilege vulnerability in Mediaserver could enable a local
malicious application to execute arbitrary code within the context of a
privileged process. This issue is rated as Moderate because it first requires
exploitation of a separate vulnerability.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6717 | [A-31350239](https://android.googlesource.com/platform/frameworks/av/%2B/45d9bbabbe7920bf4e0a68074b97d8260aef2e07) | Moderate | All | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Sep 7, 2016 |

### Elevation of privilege vulnerability in Account Manager Service

An elevation of privilege vulnerability in the Account Manager Service could
enable a local malicious application to retrieve sensitive information without
user interaction. This issue is rated as Moderate because it is a local bypass
of user interaction requirements (access to functionality that would normally
require either user initiation or user permission.)

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6718 | [A-30455516](https://android.googlesource.com/platform/frameworks/base/%2B/fecfd550edeca422c0d9f32a9c0abe73398a1ff1) | Moderate | All | 7.0 | Google internal |

### Elevation of privilege vulnerability in Bluetooth

An elevation of privilege vulnerability in the Bluetooth component could enable
a local malicious application to pair with any Bluetooth device without user
consent. This issue is rated as Moderate because it is a local bypass of user
interaction requirements (access to functionality that would normally require
either user initiation or user permission).

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6719 | [A-29043989](https://android.googlesource.com/platform/packages/apps/Bluetooth/%2B/e1b6db10e913c09d0b695368336137f6aabee462) [[2](https://android.googlesource.com/platform/frameworks/base/%2B/b1dc1757071ba46ee653d68f331486e86778b8e4)] | Moderate | All | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Google internal |

### Information disclosure vulnerability in Mediaserver

An information disclosure vulnerability in Mediaserver could enable a local
malicious application to access data outside of its permission levels. This
issue is rated as Moderate because it could be used to access sensitive data
without permission.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6720 | [A-29422020](https://android.googlesource.com/platform/frameworks/av/%2B/0f177948ae2640bfe4d70f8e4248e106406b3b0a) [[2](https://android.googlesource.com/platform/frameworks/av/%2B/2c75e1c3b98e4e94f50c63e2b7694be5f948477c)] [[3](https://android.googlesource.com/platform/frameworks/av/%2B/7c88b498fda1c2b608a9dd73960a2fd4d7b7e3f7)] [[4](https://android.googlesource.com/platform/frameworks/av/%2B/640b04121d7cd2cac90e2f7c82b97fce05f074a5)] | Moderate | All | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Jun 15, 2016 |
| CVE-2016-6721 | [A-30875060](https://android.googlesource.com/platform/frameworks/av/%2B/f6bf0102bdc1adff973e08d8ce9c869c4e2efade) | Moderate | All | 6.0, 6.0.1, 7.0 | Aug 13, 2016 |
| CVE-2016-6722 | [A-31091777](https://android.googlesource.com/platform/frameworks/av/%2B/89c03b3b9ff74a507a8b8334c50b08b334483556) | Moderate | All | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Aug 23, 2016 |

### Denial of service vulnerability in Proxy Auto Config

A denial of service vulnerability in Proxy Auto Config could enable a remote
attacker to use a specially crafted file to cause a device hang or reboot. This
issue is rated as Moderate because it requires an uncommon device configuration.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6723 | [A-30100884](https://android.googlesource.com/platform/frameworks/base/%2B/d5b0d0b1df2e1a7943a4bb2034fd21487edd0264) [[2](https://android.googlesource.com/platform/frameworks/base/%2B/31f351160cdfd9dbe9919682ebe41bde3bcf91c6)] | Moderate | All | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Jul 11, 2016 |

### Denial of service vulnerability in Input Manager Service

A denial of service vulnerability in the Input Manager Service could enable a
local malicious application to cause the device to continually reboot. This
issue is rated as Moderate because it is a temporary denial of service that
requires a factory reset to fix.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6724 | [A-30568284](https://android.googlesource.com/platform/frameworks/base/%2B/7625010a2d22f8c3f1aeae2ef88dde37cbebd0bf) | Moderate | All | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1, 7.0 | Google internal |

## 2016-11-05 security patch level—Vulnerability details

In the sections below, we provide details for each of the security
vulnerabilities that apply to the 2016-11-05 patch level. There is a description of
the issue, a severity rationale, and a table with the CVE, associated
references, severity, updated Google devices, updated AOSP versions (where
applicable), and date reported. When available, we will link the public change
that addressed the issue to the bug ID, like the AOSP change list. When multiple
changes relate to a single bug, additional references are linked to numbers
following the bug ID.

### Remote code execution vulnerability in Qualcomm crypto driver

A remote code execution vulnerability in the Qualcomm crypto driver could enable
a remote attacker to execute arbitrary code within the context of the kernel.
This issue is rated as Critical due to the possibility of remote code execution
in the context of the kernel.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6725 | A-30515053 [QC-CR#1050970](https://source.codeaurora.org/quic/la//kernel/msm-3.10/commit/?id=cc95d644ee8a043f2883d65dda20e16f95041de3) | Critical | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel, Pixel XL | Jul 25, 2016 |

### Elevation of privilege vulnerability in kernel file system

An elevation of privilege vulnerability in the kernel file system could enable a
local malicious application to execute arbitrary code within the context of the
kernel. This issue is rated as Critical due to the possibility of a local
permanent device compromise, which may require reflashing the operating system
to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2015-8961 | A-30952474  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=6934da9238da947628be83635e365df41064b09b) | Critical | Pixel, Pixel XL | Oct 18, 2015 |
| CVE-2016-7911 | A-30946378  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=8ba8682107ee2ca3347354e018865d8e1967c5f4) | Critical | Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Android One, Pixel C, Nexus Player, Pixel, Pixel XL | Jul 01, 2016 |
| CVE-2016-7910 | A-30942273  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=77da160530dd1dc94f6ae15a981f24e5f0021e84) | Critical | Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Android One, Pixel C, Nexus Player, Pixel, Pixel XL | Jul 29, 2016 |

### Elevation of privilege vulnerability in kernel SCSI driver

An elevation of privilege vulnerability in the kernel SCSI driver could enable a
local malicious application to execute arbitrary code within the context of the
kernel. This issue is rated as Critical due to the possibility of a local
permanent device compromise, which may require reflashing the operating system
to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2015-8962 | A-30951599  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=f3951a3709ff50990bf3e188c27d346792103432) | Critical | Pixel, Pixel XL | Oct 30, 2015 |

### Elevation of privilege vulnerability in kernel media driver

An elevation of privilege vulnerability in the kernel media driver could enable
a local malicious application to execute arbitrary code within the context of
the kernel. This issue is rated as Critical due to the possibility of a local
permanent device compromise, which may require reflashing the operating system
to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-7913 | A-30946097  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=8dfbcc4351a0b6d2f2d77f367552f48ffefafe18) | Critical | Nexus 6P, Android One, Nexus Player, Pixel, Pixel XL | Jan 28, 2016 |

### Elevation of privilege vulnerability in kernel USB driver

An elevation of privilege vulnerability in the kernel USB driver could enable a
local malicious application to execute arbitrary code within the context of the
kernel. This issue is rated as Critical due to the possibility of a local
permanent device compromise, which may require reflashing the operating system
to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-7912 | A-30950866  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=38740a5b87d53ceb89eb2c970150f6e94e00373a) | Critical | Pixel C, Pixel, Pixel XL | Apr 14, 2016 |

### Elevation of privilege vulnerability in kernel ION subsystem

An elevation of privilege vulnerability in the kernel ION subsystem could enable
a local malicious application to execute arbitrary code within the context of
the kernel. This issue is rated as Critical due to the possibility of a local
permanent device compromise, which may require reflashing the operating system
to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6728 | A-30400942\* | Critical | Nexus 5, Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Nexus Player, Pixel C, Android One | Jul 25, 2016 |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Elevation of privilege vulnerability in Qualcomm bootloader

An elevation of privilege vulnerability in the Qualcomm bootloader could enable
a local malicious application to execute arbitrary code within the context of
the kernel. This issue is rated as Critical due to the possibility of a local
permanent device compromise, which may require reflashing the operating system
to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6729 | A-30977990\*  QC-CR#977684 | Critical | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel, Pixel XL | Jul 25, 2016 |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Elevation of privilege vulnerability in NVIDIA GPU driver

An elevation of privilege vulnerability in the NVIDIA GPU driver could enable a
local malicious application to execute arbitrary code within the context of the
kernel. This issue is rated as Critical due to the possibility of a local
permanent device compromise, which may require reflashing the operating system
to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6730 | A-30904789\* N-CVE-2016-6730 | Critical | Pixel C | Aug 16, 2016 |
| CVE-2016-6731 | A-30906023\* N-CVE-2016-6731 | Critical | Pixel C | Aug 16, 2016 |
| CVE-2016-6732 | A-30906599\* N-CVE-2016-6732 | Critical | Pixel C | Aug 16, 2016 |
| CVE-2016-6733 | A-30906694\* N-CVE-2016-6733 | Critical | Pixel C | Aug 16, 2016 |
| CVE-2016-6734 | A-30907120\* N-CVE-2016-6734 | Critical | Pixel C | Aug 16, 2016 |
| CVE-2016-6735 | A-30907701\* N-CVE-2016-6735 | Critical | Pixel C | Aug 16, 2016 |
| CVE-2016-6736 | A-30953284\* N-CVE-2016-6736 | Critical | Pixel C | Aug 18, 2016 |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Elevation of privilege vulnerability in kernel networking subsystem

An elevation of privilege vulnerability in the kernel networking subsystem could
enable a local malicious application to execute arbitrary code within the
context of the kernel. This issue is rated as Critical due to the possibility of
a local permanent device compromise, which may require reflashing the operating
system to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6828 | A-31183296  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/include/net/tcp.h?id=bb1fceca22492109be12640d49f5ea5a544c6bb4) | Critical | Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Android One, Pixel C, Nexus Player, Pixel, Pixel XL | Aug 18, 2016 |

### Elevation of privilege vulnerability in kernel sound subsystem

An elevation of privilege vulnerability in the kernel sound subsystem could
enable a local malicious application to execute arbitrary code within the
context of the kernel. This issue is rated as Critical due to the possibility of
a local permanent device compromise, which may require reflashing the operating
system to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-2184 | A-30952477  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=836b34a935abc91e13e63053d0a83b24dfb5ea78) | Critical | Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Android One, Pixel C, Nexus Player, Pixel, Pixel XL | Mar 31, 2016 |

### Elevation of privilege vulnerability in kernel ION subsystem

An elevation of privilege vulnerability in the kernel ION subsystem could enable
a local malicious application to execute arbitrary code within the context of
the kernel. This issue is rated as Critical due to the possibility of a local
permanent device compromise, which may require reflashing the operating system
to repair the device.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6737 | A-30928456\* | Critical | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel C, Nexus Player, Pixel, Pixel XL | Google internal |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Vulnerabilities in Qualcomm components

The table below contains security vulnerabilities affecting Qualcomm components
and are described in further detail in Qualcomm AMSS June 2016 security
bulletin and Security Alert 80-NV606-17.

| CVE | References | Severity\* | Updated Google devices | Date reported |
| CVE-2016-6727 | A-31092400\*\* | Critical | Android One | Qualcomm internal |
| CVE-2016-6726 | A-30775830\*\* | High | Nexus 6, Android One | Qualcomm internal |

\* The severity rating for these vulnerabilities was determined by the vendor.

\*\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Remote code execution vulnerability in Expat

The table below contains security vulnerabilities affecting the Expat library.
The most severe of these issues is an elevation of privilege vulnerability in
the Expat XML parser, which could enable an attacker using a specially crafted
file to execute arbitrary code in an unprivileged process. This issue is rated
as High due to the possibility of arbitrary code execution in an application
that uses Expat.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-0718 | [A-28698301](https://android.googlesource.com/platform/external/expat/%2B/52ac633b73856ded34b33bd4adb4ab793bbbe963) | High | None\* | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1 | May 10, 2016 |
| CVE-2012-6702 | [A-29149404](https://android.googlesource.com/platform/external/expat/%2B/a11ff32280a863bff93df13ad643912ad9bf1302) | Moderate | None\* | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1 | Mar 06, 2016 |
| CVE-2016-5300 | [A-29149404](https://android.googlesource.com/platform/external/expat/%2B/a11ff32280a863bff93df13ad643912ad9bf1302) | Moderate | None\* | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1 | Jun 04, 2016 |
| CVE-2015-1283 | [A-27818751](https://android.googlesource.com/platform/external/expat/%2B/13b40c2040a17038b63a61e2b112c634da203d3b) | Low | None\* | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1 | Jul 24, 2015 |

\* Supported Google devices on Android 7.0 or later that have installed all
available updates are not affected by this vulnerability.

### Remote code execution vulnerability in Webview

A remote code execution vulnerability in Webview could enable a remote attacker
to execute arbitrary code when the user is navigating to a website. This issue
is rated as High due to the possibility of remote code execution in an
unprivileged process.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2016-6754 | A-31217937 | High | None\* | 5.0.2, 5.1.1, 6.0, 6.0.1 | Aug 23, 2016 |

\* Supported Google devices on Android 7.0 or later that have installed all
available updates are not affected by this vulnerability.

### Remote code execution vulnerability in Freetype

A remote code execution vulnerability in Freetype could enable a local malicious
application to load a specially crafted font to cause memory corruption in an
unprivileged process. This issue is rated as High due to the possibility of
remote code execution in applications that use Freetype.

| CVE | References | Severity | Updated Google devices | Updated AOSP versions | Date reported |
| CVE-2014-9675 | [A-24296662](https://android.googlesource.com/platform/external/freetype/%2B/f720f0dbcf012d6c984dbbefa0875ef9840458c6) [[2](https://android.googlesource.com/platform/external/pdfium/%2B/96f965ff7411f1edba72140fd70740e63cabec71)] | High | None\* | 4.4.4, 5.0.2, 5.1.1, 6.0, 6.0.1 | Google internal |

\* Supported Google devices on Android 7.0 or later that have installed all
available updates are not affected by this vulnerability.

### Elevation of privilege vulnerability in kernel performance subsystem

An elevation of privilege vulnerability in the kernel performance subsystem
could enable a local malicious application to execute arbitrary code within the
context of the kernel. This issue is rated as High because it first requires
compromising a privileged process.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2015-8963 | A-30952077  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=12ca6ad2e3a896256f086497a7c7406a547ee373) | High | Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Android One, Pixel C, Nexus Player, Pixel, Pixel XL | Dec 15, 2015 |

### Elevation of privilege vulnerability in kernel system-call auditing subsystem

An elevation of privilege vulnerability in the kernel system-call auditing
subsystem could enable a local malicious application to disrupt system-call
auditing in the kernel. This issue is rated as High because it is a general
bypass for a kernel-level defense in depth or exploit mitigation technology.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6136 | A-30956807  [Upstream kernel](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=43761473c254b45883a64441dd0bc85a42f3645c) | High | Android One, Pixel C, Nexus Player | Jul 1, 2016 |

### Elevation of privilege vulnerability in Qualcomm crypto engine driver

An elevation of privilege vulnerability in the Qualcomm crypto engine driver
could enable a local malicious application to execute arbitrary code within the
context of the kernel. This issue is rated as High because it first requires
compromising a privileged process.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6738 | A-30034511  [QC-CR#1050538](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id=a829c54236b455885c3e9c7c77ac528b62045e79) | High | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel, Pixel XL | Jul 7, 2016 |

### Elevation of privilege vulnerability in Qualcomm camera driver

An elevation of privilege vulnerability in the Qualcomm camera driver could
enable a local malicious application to execute arbitrary code within the
context of the kernel. This issue is rated as High because it first requires
compromising a privileged process.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6739 | A-30074605\* QC-CR#1049826 | High | Nexus 5X, Nexus 6P, Pixel, Pixel XL | Jul 11, 2016 |
| CVE-2016-6740 | A-30143904  [QC-CR#1056307](https://source.codeaurora.org/quic/la//kernel/msm-3.10/commit/?id=ef78bd62f0c064ae4c827e158d828b2c110ebcdc) | High | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel, Pixel XL | Jul 12, 2016 |
| CVE-2016-6741 | A-30559423  [QC-CR#1060554](https://source.codeaurora.org/quic/la//kernel/msm-3.18/commit/?id=d291eebd8e43bba3229ae7ef9146a132894dc293) | High | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel, Pixel XL | Jul 28, 2016 |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Elevation of privilege vulnerability in Qualcomm bus driver

An elevation of privilege vulnerability in the Qualcomm bus driver could enable
a local malicious application to execute arbitrary code within the context of
the kernel. This issue is rated as High because it first requires compromising a
privileged process.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-3904 | A-30311977  [QC-CR#1050455](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id=069683407ca9a820d05c914b57c587bcd3f16a3a) | High | Nexus 5X, Nexus 6P, Pixel, Pixel XL | Jul 22, 2016 |

### Elevation of privilege vulnerability in Synaptics touchscreen driver

An elevation of privilege vulnerability in the Synaptics touchscreen driver
could enable a local malicious application to execute arbitrary code within the
context of the kernel. This issue is rated as High because it first requires
compromising a privileged process.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6742 | A-30799828\* | High | Nexus 5X, Android One | Aug 9, 2016 |
| CVE-2016-6744 | A-30970485\* | High | Nexus 5X | Aug 19, 2016 |
| CVE-2016-6745 | A-31252388\* | High | Nexus 5X, Nexus 6P, Nexus 9, Android One, Pixel, Pixel XL | Sep 1, 2016 |
| CVE-2016-6743 | A-30937462\* | High | Nexus 9, Android One | Google internal |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Information disclosure vulnerability in kernel components

An information disclosure vulnerability in kernel components, including the
human interface device driver, file system, and Teletype driver, could enable a
local malicious application to access data outside of its permission levels.
This issue is rated as High because it could be used to access sensitive data
without explicit user permission.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2015-8964 | A-30951112  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=dd42bf1197144ede075a9d4793123f7689e164bc) | High | Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Android One, Pixel C, Nexus Player, Pixel, Pixel XL | Nov 27, 2015 |
| CVE-2016-7915 | A-30951261  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=50220dead1650609206efe91f0cc116132d59b3f) | High | Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Android One, Pixel C, Nexus Player, Pixel, Pixel XL | Jan 19, 2016 |
| CVE-2016-7914 | A-30513364  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=8d4a2ec1e0b41b0cf9a0c5cd4511da7f8e4f3de2) | High | Pixel C, Pixel, Pixel XL | Apr 06, 2016 |
| CVE-2016-7916 | A-30951939  [Upstream kernel](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=8148a73c9901a8794a50f950083c00ccf97d43b3) | High | Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Android One, Pixel C, Nexus Player, Pixel, Pixel XL | May 05, 2016 |

### Information disclosure vulnerability in NVIDIA GPU driver

An information disclosure vulnerability in the NVIDIA GPU driver could enable a
local malicious application to access data outside of its permission levels.
This issue is rated as High because it could be used to access sensitive data
without explicit user permission.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6746 | A-30955105\* N-CVE-2016-6746 | High | Pixel C | Aug 18, 2016 |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Denial of service vulnerability in Mediaserver

A denial of service vulnerability in Mediaserver could enable an attacker to use
a specially crafted file to cause a device hang or reboot. This issue is rated
as High due to the possibility of remote denial of service.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6747 | A-31244612\* N-CVE-2016-6747 | High | Nexus 9 | Google internal |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Information disclosure vulnerability in kernel components

An information disclosure vulnerability in kernel components, including the
process-grouping subsystem and the networking subsystem, could enable a local
malicious application to access data outside of its permission levels. This
issue is rated as Moderate because it first requires compromising a privileged
process.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-7917 | A-30947055  [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c58d6c93680f28ac58984af61d0a7ebf4319c241) | Moderate | Pixel C, Pixel, Pixel XL | Feb 02, 2016 |
| CVE-2016-6753 | A-30149174\* | Moderate | Nexus 5X, Nexus 6, Nexus 6P, Nexus 9, Pixel C, Nexus Player, Pixel, Pixel XL | Jul 13, 2016 |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

### Information disclosure vulnerability in Qualcomm components

An information disclosure vulnerability in Qualcomm components including the GPU
driver, power driver, SMSM Point-to-Point driver, and sound driver, could enable
a local malicious application to access data outside of its permission levels.
This issue is rated as Moderate because it first requires compromising a
privileged process.

| CVE | References | Severity | Updated Google devices | Date reported |
| CVE-2016-6748 | A-30076504  [QC-CR#987018](https://source.codeaurora.org/quic/la//kernel/msm-3.10/commit/?id=be651d020b122a1ba9410d23ca4ebbe9f5598df6) | Moderate | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel, Pixel XL | Jul 12, 2016 |
| CVE-2016-6749 | A-30228438  [QC-CR#1052818](https://source.codeaurora.org/quic/la//kernel/msm-3.10/commit/?id=f9185dc83b92e7d1ee341e32e8cf5ed00a7253a7) | Moderate | Nexus 5X, Nexus 6P, Pixel, Pixel XL | Jul 12, 2016 |
| CVE-2016-6750 | A-30312054  [QC-CR#1052825](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id=34bda711a1c7bc7f9fd7bea3a5be439ed00577e5) | Moderate | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel, Pixel XL | Jul 21, 2016 |
| CVE-2016-3906 | A-30445973  [QC-CR#1054344](https://source.codeaurora.org/quic/la/kernel/msm-3.18/commit/?id=b333d32745fec4fb1098ee1a03d4425f3c1b4c2e) | Moderate | Nexus 5X, Nexus 6P | Jul 27, 2016 |
| CVE-2016-3907 | A-30593266  [QC-CR#1054352](https://source.codeaurora.org/quic/la//kernel/msm-3.10/commit/?id=744330f4e5d70dce71c4c9e03c5b6a8b59bb0cda) | Moderate | Nexus 5X, Nexus 6P, Pixel, Pixel XL | Aug 2, 2016 |
| CVE-2016-6698 | A-30741851  [QC-CR#1058826](https://source.codeaurora.org/quic/la//kernel/msm-3.10/commit/?id=de90beb76ad0b80da821c3b857dd30cd36319e61) | Moderate | Nexus 5X, Nexus 6P, Android One, Pixel, Pixel XL | Aug 2, 2016 |
| CVE-2016-6751 | A-30902162\* QC-CR#1062271 | Moderate | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel, Pixel XL | Aug 15, 2016 |
| CVE-2016-6752 | A-31498159  [QC-CR#987051](https://source.codeaurora.org/quic/la//kernel/msm-3.18/commit/?h=0de2c7600c8f1f0152a2f421c6593f931186400a) | Moderate | Nexus 5X, Nexus 6, Nexus 6P, Android One, Pixel, Pixel XL | Google internal |

\* The patch for this issue is not publicly available. The update is contained in
the latest binary drivers for Google devices available from the [Google Developer
site](https://developers.google.com/android/nexus/drivers).

## 2016-11-06 security patch level—Vulnerability details

In the sections below, we provide details for each of the security
vulnerabilities listed in the
[2016-11-06 security patch level—Vulnerability
summary](#2016-11-06-summary) above. There is a description of
the issue, a severity rationale, and a table with the CVE, associated
references, severity, updated Google devices, updated AOSP versions (where
applicable), and date reported. When available, we will link the public change
that addressed the issue to the bug ID, like the AOSP change list. When multiple
changes relate to a single bug, additional references are linked to numbers
following the bug ID.

### Elevation of privilege vulnerability in kernel memory subsystem

An elevation of privilege vulnerability in the kernel memory subsystem could
enable a local malicious application to execute arbitrary code within the
context of the kernel. This issue is rated as Critical due to the possibility of
a local permanent device compromise, which may require reflashing the operating
system to repair the device.

**Note:** A security patch level of 2016-11-06 indicates that this
issue, as well as all issues associated with 2016-11-01 and 2016-11-05 are
addressed.

| CVE | References | Severity | Updated kernel versions | Date reported |
| --- | --- | --- | --- | --- |
| CVE-2016-5195 | A-32141528 [Upstream kernel](https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=9691eac5593ff1e2f82391ad327f21d90322aec1) [[2](https://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=e45a502bdeae5a075257c4f061d1ff4ff0821354)] | Critical | 3.10, 3.18 | Oct 12, 2016 |

## Common Questions and Answers

This section answers common questions that may occur after reading this
bulletin.

**1. How do I determine if my device is updated to address these issues?**

To learn how to check a device’s security patch level, read the instructions on the
[Pixel
and Nexus update schedule](https://support.google.com/pixelphone/answer/4457705#pixel_phones&nexus_devices).

* Security patch levels of 2016-11-01 or later address all issues associated
  with the 2016-11-01 security patch level.
* Security patch levels of 2016-11-05 or later address all issues associated
  with the 2016-11-05 security patch level and all previous patch levels.
* Security patch levels of 2016-11-06 or later address all issues associated
  with the 2016-11-06 security patch level and all previous patch
  levels.

Device manufacturers that include these updates should set the patch level
string to:

* [ro.build.version.security\_patch]:[2016-11-01]
* [ro.build.version.security\_patch]:[2016-11-05]
* [ro.build.version.security\_patch]:[2016-11-06].

**2. Why does this bulletin have three security patch levels?**

This bulletin has three security patch levels so that Android partners have the
flexibility to fix a subset of vulnerabilities that are similar across all
Android devices more quickly. Android partners are encouraged to fix all issues
in this bulletin and use the latest security patch level.

* Devices that use the November 1, 2016 security patch level must include all
  issues associated with that security patch level, as well as fixes for all
  issues reported in previous security bulletins.
* Devices that use the security patch level of November 5, 2016 or newer must
  include all applicable patches in this (and previous) security bulletins.
* Devices that use the security patch level of November 6, 2016 or newer must
  include all applicable patches in this (and previous) security
  bulletins.

Partners are encouraged to bundle the fixes for all issues they are addressing
in a single update.

**3. How do I determine which Google devices are affected by each
issue?**

In the
[2016-11-01](#2016-11-01-details),
[2016-11-05](#2016-11-05-details),
and
[2016-11-06](#2016-11-06-details)
security vulnerability details sections, each table has an *Updated Google
devices* column that covers the range of affected Google devices updated for
each issue. This column has a few options:

* **All Google devices**: If an issue affects all Nexus and Pixel
  devices, the table will have "All" in the *Updated Google devices*
  column. "All" encapsulates the following
  [supported
  devices](https://support.google.com/pixelphone/answer/4457705#pixel_phones&nexus_devices): Nexus 5, Nexus 5X, Nexus 6, Nexus 6P, Nexus 9,
  Android One, Nexus Player, Pixel C, Pixel, and Pixel XL.
* **Some Google devices**: If an issue doesn't affect all Google
  devices, the affected Google devices are listed in the *Updated Google
  devices* column.
* **No Google devices**: If no Google devices running Android 7.0
  are affected by the issue, the table will have "None" in the *Updated Google
  devices* column.

**4. What do the entries in the references column map to?**

Entries under the *References* column of the vulnerability details table
may contain a prefix identifying the organization to which the reference value
belongs. These prefixes map as follows:

| Prefix | Reference |
| --- | --- |
| A- | Android bug ID |
| QC- | Qualcomm reference number |
| M- | MediaTek reference number |
| N- | NVIDIA reference number |
| B- | Broadcom reference number |

## Revisions

* November 07, 2016: Bulletin published.
* November 08: Bulletin revised to include AOSP links and updated
  description for CVE-2016-6709.
* November 17: Bulletin revised to include attribution for CVE-2016-6828.
* December 21: Updated researcher credit.

Content and code samples on this page are subject to the licenses described in the [Content License](/license). Java and OpenJDK are trademarks or registered trademarks of Oracle and/or its affiliates.

Last updated 2024-08-26 UTC.

[[["Easy to understand","easyToUnderstand","thumb-up"],["Solved my problem","solvedMyProblem","thumb-up"],["Other","otherUp","thumb-up"]],[["Missing the information I need","missingTheInformationINeed","thumb-down"],["Too complicated / too many steps","tooComplicatedTooManySteps","thumb-down"],["Out of date","outOfDate","thumb-down"],["Samples / code issue","samplesCodeIssue","thumb-down"],["Other","otherDown","thumb-down"]],["Last updated 2024-08-26 UTC."],[],[]]

* ### Build

  + [Android repository](//android.googlesource.com)
  + [Requirements](/source/requirements)
  + [Downloading](/source/downloading)
  + [Preview binaries](//developers.google.com/android/blobs-preview/)
  + [Factory images](//developers.google.com/android/images/)
  + [Driver binaries](//developers.google.com/android/drivers/)
* ### Connect

  + [@Android on Twitter](//twitter.com/Android/)
  + [@AndroidDev on Twitter](//twitter.com/AndroidDev/)
  + [Android Blog](//blog.google/products/android/)
  + [Google Security Blog](//security.googleblog.com)
  + [Platform on Google Groups](//groups.google.com/forum/?fromgroups#!forum/android-platform/)
  + [Building on Google Groups](//groups.google.com/forum/?fromgroups#!forum/android-building/)
  + [Porting on Google Groups](//groups.google.com/forum/?fromgroups#!forum/android-porting/)
* ### Get help

  + [Android Help Center](//support.google.com/android/)
  + [Pixel Help Center](//support.google.com/pixelphone/)
  + [www.android.com](//www.android.com)
  + [Google Mobile Services](//www.android.com/gms/)
  + [Stack Overflow](//stackoverflow.com/questions/tagged/android-source/)
  + [Issue Tracker](//issuetracker.google.com/issues?q=status:open%20componentid:190923)

* [About Android](/source/)
* [Community](/source/community)
* [Legal](/legal)
* [License](/license)
* [Privacy](//policies.google.com/privacy)
* [Site feedback](//issuetracker.google.com/issues/new?component=191476)
* Manage cookies

* English
* Deutsch
* Español
* Español – América Latina
* Français
* Indonesia
* Italiano
* Polski
* Português
* Português – Brasil
* Tiếng Việt
* Türkçe
* Русский
* עברית
* العربيّة
* فارسی
* हिंदी
* বাংলা
* ภาษาไทย
* 中文 – 简体
* 中文 – 繁體
* 日本語
* 한국어



=== Content from github.com_8987791d_20250124_190718.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F8ba8682107ee2ca3347354e018865d8e1967c5f4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F8ba8682107ee2ca3347354e018865d8e1967c5f4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/8ba8682107ee2ca3347354e018865d8e1967c5f4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

block: fix use-after-free in sys\_ioprio\_get()

[Browse files](/torvalds/linux/tree/8ba8682107ee2ca3347354e018865d8e1967c5f4)
Browse the repository at this point in the history

```
get_task_ioprio() accesses the task->io_context without holding the task
lock and thus can race with exit_io_context(), leading to a
use-after-free. The reproducer below hits this within a few seconds on
my 4-core QEMU VM:

#define _GNU_SOURCE
#include <assert.h>
#include <unistd.h>
#include <sys/syscall.h>
#include <sys/wait.h>

int main(int argc, char **argv)
{
	pid_t pid, child;
	long nproc, i;

	/* ioprio_set(IOPRIO_WHO_PROCESS, 0, IOPRIO_PRIO_VALUE(IOPRIO_CLASS_IDLE, 0)); */
	syscall(SYS_ioprio_set, 1, 0, 0x6000);

	nproc = sysconf(_SC_NPROCESSORS_ONLN);

	for (i = 0; i < nproc; i++) {
		pid = fork();
		assert(pid != -1);
		if (pid == 0) {
			for (;;) {
				pid = fork();
				assert(pid != -1);
				if (pid == 0) {
					_exit(0);
				} else {
					child = wait(NULL);
					assert(child == pid);
				}
			}
		}

		pid = fork();
		assert(pid != -1);
		if (pid == 0) {
			for (;;) {
				/* ioprio_get(IOPRIO_WHO_PGRP, 0); */
				syscall(SYS_ioprio_get, 2, 0);
			}
		}
	}

	for (;;) {
		/* ioprio_get(IOPRIO_WHO_PGRP, 0); */
		syscall(SYS_ioprio_get, 2, 0);
	}

	return 0;
}

This gets us KASAN dumps like this:

[   35.526914] ==================================================================
[   35.530009] BUG: KASAN: out-of-bounds in get_task_ioprio+0x7b/0x90 at addr ffff880066f34e6c
[   35.530009] Read of size 2 by task ioprio-gpf/363
[   35.530009] =============================================================================
[   35.530009] BUG blkdev_ioc (Not tainted): kasan: bad access detected
[   35.530009] -----------------------------------------------------------------------------

[   35.530009] Disabling lock debugging due to kernel taint
[   35.530009] INFO: Allocated in create_task_io_context+0x2b/0x370 age=0 cpu=0 pid=360
[   35.530009] 	___slab_alloc+0x55d/0x5a0
[   35.530009] 	__slab_alloc.isra.20+0x2b/0x40
[   35.530009] 	kmem_cache_alloc_node+0x84/0x200
[   35.530009] 	create_task_io_context+0x2b/0x370
[   35.530009] 	get_task_io_context+0x92/0xb0
[   35.530009] 	copy_process.part.8+0x5029/0x5660
[   35.530009] 	_do_fork+0x155/0x7e0
[   35.530009] 	SyS_clone+0x19/0x20
[   35.530009] 	do_syscall_64+0x195/0x3a0
[   35.530009] 	return_from_SYSCALL_64+0x0/0x6a
[   35.530009] INFO: Freed in put_io_context+0xe7/0x120 age=0 cpu=0 pid=1060
[   35.530009] 	__slab_free+0x27b/0x3d0
[   35.530009] 	kmem_cache_free+0x1fb/0x220
[   35.530009] 	put_io_context+0xe7/0x120
[   35.530009] 	put_io_context_active+0x238/0x380
[   35.530009] 	exit_io_context+0x66/0x80
[   35.530009] 	do_exit+0x158e/0x2b90
[   35.530009] 	do_group_exit+0xe5/0x2b0
[   35.530009] 	SyS_exit_group+0x1d/0x20
[   35.530009] 	entry_SYSCALL_64_fastpath+0x1a/0xa4
[   35.530009] INFO: Slab 0xffffea00019bcd00 objects=20 used=4 fp=0xffff880066f34ff0 flags=0x1fffe0000004080
[   35.530009] INFO: Object 0xffff880066f34e58 [@offset](https://github.com/offset)=3672 fp=0x0000000000000001
[   35.530009] ==================================================================

Fix it by grabbing the task lock while we poke at the io_context.

Cc: stable@vger.kernel.org
Reported-by: Dmitry Vyukov <dvyukov@google.com>
Signed-off-by: Omar Sandoval <osandov@fb.com>
Signed-off-by: Jens Axboe <axboe@fb.com>
```

* Loading branch information

[![@osandov](https://avatars.githubusercontent.com/u/3682206?s=40&v=4)](/osandov) [![@axboe](https://avatars.githubusercontent.com/u/2619634?s=40&v=4)](/axboe)

[osandov](/torvalds/linux/commits?author=osandov "View all commits by osandov")
authored and
[axboe](/torvalds/linux/commits?author=axboe "View all commits by axboe")
committed
Jul 1, 2016

1 parent
[7452495](/torvalds/linux/commit/74524955556096a0b2a821a49b4d0abebad3ee16)

commit 8ba8682

Showing
**1 changed file**
with
**2 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[block/ioprio.c](#diff-fb2e40bb58780ead492a1b976fbacd445bb3f5af326b46109672f8f29c7fdd70 "block/ioprio.c")

Show comments

[View file](/torvalds/linux/blob/8ba8682107ee2ca3347354e018865d8e1967c5f4/block/ioprio.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -150,8 +150,10 @@ static int get\_task\_ioprio(struct task\_struct \*p) |
|  |  | if (ret) |
|  |  | goto out; |
|  |  | ret = IOPRIO\_PRIO\_VALUE(IOPRIO\_CLASS\_NONE, IOPRIO\_NORM); |
|  |  | task\_lock(p); |
|  |  | if (p->io\_context) |
|  |  | ret = p->io\_context->ioprio; |
|  |  | task\_unlock(p); |
|  |  | out: |
|  |  | return ret; |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8ba8682`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F8ba8682107ee2ca3347354e018865d8e1967c5f4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


