=== Content from www.openwall.com_f07234be_20250125_210330.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[thread-next>]](3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAAtdryMeBm=+QAMNSDNQZXJCgsCM4Mw=05ye1kS6bw6L+VaajQ@mail.gmail.com>
Date: Fri, 10 Jun 2016 16:10:29 +1000
From: Sam Saffron <sam.saffron@...il.com>
To: oss-security@...ts.openwall.com
Subject: Ruby gem rack-mini-profiler CVE-2016-4442

<https://github.com/MiniProfiler/rack-mini-profiler>

<https://rubygems.org/gems/rack-mini-profiler/>

Description: Carefully crafted requests can expose information about
strings and objects allocated during the request for unauthorised
users.

Fixed in: <https://github.com/MiniProfiler/rack-mini-profiler/commit/4273771d65f1a7411e3ef5843329308d0e2d257c>

Released public fix in version: 0.10.

----

I am not sure how to go about announcing this CVE, where else to I
need to post this?

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_edd767b6_20250126_115634.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMiniProfiler%2Frack-mini-profiler)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMiniProfiler%2Frack-mini-profiler)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=MiniProfiler%2Frack-mini-profiler)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MiniProfiler](/MiniProfiler)
/
**[rack-mini-profiler](/MiniProfiler/rack-mini-profiler)**
Public

* [Notifications](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler) You must be signed in to change notification settings
* [Fork
  406](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler)
* [Star
   3.8k](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler)

Profiler for your development and production Ruby rack apps.

### License

[MIT license](/MiniProfiler/rack-mini-profiler/blob/master/LICENSE)

[3.8k
stars](/MiniProfiler/rack-mini-profiler/stargazers) [406
forks](/MiniProfiler/rack-mini-profiler/forks) [Branches](/MiniProfiler/rack-mini-profiler/branches) [Tags](/MiniProfiler/rack-mini-profiler/tags) [Activity](/MiniProfiler/rack-mini-profiler/activity)
 [Star](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler)

 [Notifications](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler) You must be signed in to change notification settings

* [Code](/MiniProfiler/rack-mini-profiler)
* [Issues
  40](/MiniProfiler/rack-mini-profiler/issues)
* [Pull requests
  12](/MiniProfiler/rack-mini-profiler/pulls)
* [Actions](/MiniProfiler/rack-mini-profiler/actions)
* [Projects
  0](/MiniProfiler/rack-mini-profiler/projects)
* [Wiki](/MiniProfiler/rack-mini-profiler/wiki)
* [Security](/MiniProfiler/rack-mini-profiler/security)
* [Insights](/MiniProfiler/rack-mini-profiler/pulse)

Additional navigation options

* [Code](/MiniProfiler/rack-mini-profiler)
* [Issues](/MiniProfiler/rack-mini-profiler/issues)
* [Pull requests](/MiniProfiler/rack-mini-profiler/pulls)
* [Actions](/MiniProfiler/rack-mini-profiler/actions)
* [Projects](/MiniProfiler/rack-mini-profiler/projects)
* [Wiki](/MiniProfiler/rack-mini-profiler/wiki)
* [Security](/MiniProfiler/rack-mini-profiler/security)
* [Insights](/MiniProfiler/rack-mini-profiler/pulse)

# MiniProfiler/rack-mini-profiler

    master[Branches](/MiniProfiler/rack-mini-profiler/branches)[Tags](/MiniProfiler/rack-mini-profiler/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[907 Commits](/MiniProfiler/rack-mini-profiler/commits/master/) | | |
| [.github/workflows](/MiniProfiler/rack-mini-profiler/tree/master/.github/workflows "This path skips through empty directories") | | [.github/workflows](/MiniProfiler/rack-mini-profiler/tree/master/.github/workflows "This path skips through empty directories") |  |  |
| [lib](/MiniProfiler/rack-mini-profiler/tree/master/lib "lib") | | [lib](/MiniProfiler/rack-mini-profiler/tree/master/lib "lib") |  |  |
| [spec](/MiniProfiler/rack-mini-profiler/tree/master/spec "spec") | | [spec](/MiniProfiler/rack-mini-profiler/tree/master/spec "spec") |  |  |
| [test\_old](/MiniProfiler/rack-mini-profiler/tree/master/test_old "test_old") | | [test\_old](/MiniProfiler/rack-mini-profiler/tree/master/test_old "test_old") |  |  |
| [website](/MiniProfiler/rack-mini-profiler/tree/master/website "website") | | [website](/MiniProfiler/rack-mini-profiler/tree/master/website "website") |  |  |
| [.gitignore](/MiniProfiler/rack-mini-profiler/blob/master/.gitignore ".gitignore") | | [.gitignore](/MiniProfiler/rack-mini-profiler/blob/master/.gitignore ".gitignore") |  |  |
| [.rspec](/MiniProfiler/rack-mini-profiler/blob/master/.rspec ".rspec") | | [.rspec](/MiniProfiler/rack-mini-profiler/blob/master/.rspec ".rspec") |  |  |
| [.rubocop.yml](/MiniProfiler/rack-mini-profiler/blob/master/.rubocop.yml ".rubocop.yml") | | [.rubocop.yml](/MiniProfiler/rack-mini-profiler/blob/master/.rubocop.yml ".rubocop.yml") |  |  |
| [CHANGELOG.md](/MiniProfiler/rack-mini-profiler/blob/master/CHANGELOG.md "CHANGELOG.md") | | [CHANGELOG.md](/MiniProfiler/rack-mini-profiler/blob/master/CHANGELOG.md "CHANGELOG.md") |  |  |
| [Gemfile](/MiniProfiler/rack-mini-profiler/blob/master/Gemfile "Gemfile") | | [Gemfile](/MiniProfiler/rack-mini-profiler/blob/master/Gemfile "Gemfile") |  |  |
| [Guardfile](/MiniProfiler/rack-mini-profiler/blob/master/Guardfile "Guardfile") | | [Guardfile](/MiniProfiler/rack-mini-profiler/blob/master/Guardfile "Guardfile") |  |  |
| [LICENSE](/MiniProfiler/rack-mini-profiler/blob/master/LICENSE "LICENSE") | | [LICENSE](/MiniProfiler/rack-mini-profiler/blob/master/LICENSE "LICENSE") |  |  |
| [README.md](/MiniProfiler/rack-mini-profiler/blob/master/README.md "README.md") | | [README.md](/MiniProfiler/rack-mini-profiler/blob/master/README.md "README.md") |  |  |
| [Rakefile](/MiniProfiler/rack-mini-profiler/blob/master/Rakefile "Rakefile") | | [Rakefile](/MiniProfiler/rack-mini-profiler/blob/master/Rakefile "Rakefile") |  |  |
| [rack-mini-profiler.gemspec](/MiniProfiler/rack-mini-profiler/blob/master/rack-mini-profiler.gemspec "rack-mini-profiler.gemspec") | | [rack-mini-profiler.gemspec](/MiniProfiler/rack-mini-profiler/blob/master/rack-mini-profiler.gemspec "rack-mini-profiler.gemspec") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license
# rack-mini-profiler

Middleware that displays speed badge for every HTML page, along with (optional) flamegraphs and memory profiling. Designed to work both in production and in development.

[![Screenshot 2023-04-05 at 3 13 52 PM](https://user-images.githubusercontent.com/845662/229996538-0f2d9c48-23d9-4d53-a1de-8b4c84c87fbd.png)](https://user-images.githubusercontent.com/845662/229996538-0f2d9c48-23d9-4d53-a1de-8b4c84c87fbd.png)

#### Features

* Database profiling - Currently supports Mysql2, Postgres, Oracle (oracle\_enhanced ~> 1.5.0) and Mongoid3 (with fallback support to ActiveRecord)
* Call-stack profiling - Flame graphs showing time spent by gem
* Memory profiling - Per-request memory usage, GC stats, and global allocation metrics

#### Learn more

* [Visit our community](http://community.miniprofiler.com)
* [Watch the RailsCast](http://railscasts.com/episodes/368-miniprofiler)
* [Read about Flame graphs in rack-mini-profiler](http://samsaffron.com/archive/2013/03/19/flame-graphs-in-ruby-miniprofiler)
* [Read the announcement posts from 2012](http://samsaffron.com/archive/2012/07/12/miniprofiler-ruby-edition)

## rack-mini-profiler needs your help

We have decided to restructure our repository so there is a central UI repo and the various language implementations have their own.

**WE NEED HELP.**

* Help [triage issues](https://www.codetriage.com/miniprofiler/rack-mini-profiler) [![Open Source Helpers](https://camo.githubusercontent.com/bd32bd4db6d7f84287052fcad11d2821e9cd2febdf5bb5be6c607f4d24035241/68747470733a2f2f7777772e636f64657472696167652e636f6d2f6d696e6970726f66696c65722f7261636b2d6d696e692d70726f66696c65722f6261646765732f75736572732e737667)](https://www.codetriage.com/miniprofiler/rack-mini-profiler)

If you feel like taking on any of this start an issue and update us on your progress.

## Installation

Install/add to Gemfile in Ruby 2.6+

```
gem 'rack-mini-profiler'
```

NOTE: Be sure to require rack\_mini\_profiler below the `pg` and `mysql` gems in your Gemfile. rack\_mini\_profiler will identify these gems if they are loaded to insert instrumentation. If included too early no SQL will show up.

You can also include optional libraries to enable additional features.

```
# For memory profiling
gem 'memory_profiler'

# For call-stack profiling flamegraphs
gem 'stackprof'
```

#### Rails

All you have to do is to include the Gem and you're good to go in development. See notes below for use in production.

#### Upgrading to version 2.0.0

Prior to version 2.0.0, Mini Profiler patched various Rails methods to get the information it needed such as template rendering time. Starting from version 2.0.0, Mini Profiler doesn't patch any Rails methods by default and relies on `ActiveSupport::Notifications` to get the information it needs from Rails. If you want Mini Profiler to keep using its patches in version 2.0.0 and later, change the gem line in your `Gemfile` to the following:

If you want to manually require Mini Profiler:

```
gem 'rack-mini-profiler', require: ['enable_rails_patches']
```

If you don't want to manually require Mini Profiler:

```
gem 'rack-mini-profiler', require: ['enable_rails_patches', 'rack-mini-profiler']
```

#### `Net::HTTP` stack level too deep errors

If you start seeing `SystemStackError: stack level too deep` errors from `Net::HTTP` after installing Mini Profiler, this means there is another patch for `Net::HTTP#request` that conflicts with Mini Profiler's patch in your application. To fix this, change `rack-mini-profiler` gem line in your `Gemfile` to the following:

```
gem 'rack-mini-profiler', require: ['prepend_net_http_patch', 'rack-mini-profiler']
```

If you currently have `require: false`, remove the `'rack-mini-profiler'` string from the `require` array above so the gem line becomes like this:

```
gem 'rack-mini-profiler', require: ['prepend_net_http_patch']
```

This conflict happens when a ruby method is patched twice, once using module prepend, and once using method aliasing. See this [ruby issue](https://bugs.ruby-lang.org/issues/11120) for details. The fix is to apply all patches the same way. Mini Profiler by default will apply its patch using method aliasing, but you can change that to module prepend by adding `require: ['prepend_net_http_patch']` to the gem line as shown above.

#### `peek-mysql2` stack level too deep errors

If you use peek-mysql2 with Rails >= 5, you'll need to use this gem spec in your Gemfile:

```
gem 'rack-mini-profiler', require: ['prepend_mysql2_patch', 'rack-mini-profiler']
```

This should not be necessary with Rails < 5 because peek-mysql2 hooks into mysql2 gem in different ways depending on your Rails version.

#### `pg` stack level too deep errors

If you encounter `SystemStackError (stack level too deep)` from PG, you'll need to use this gem spec in your Gemfile:

```
gem 'rack-mini-profiler', require: ['prepend_pg_patch', 'rack-mini-profiler']
```

Or if you initially have `require: false`, then use

```
gem 'rack-mini-profiler', require: ['prepend_pg_patch']
```

#### Rails and manual initialization

In case you need to make sure rack\_mini\_profiler is initialized after all other gems, or you want to execute some code before rack\_mini\_profiler required:

```
gem 'rack-mini-profiler', require: false
```

Note the `require: false` part - if omitted, it will cause the Railtie for the mini-profiler to
be loaded outright, and an attempt to re-initialize it manually will raise an exception.

Then run the generator which will set up rack-mini-profiler in development:

```
bundle exec rails g rack_mini_profiler:install
```

#### Rack Builder

```
require 'rack-mini-profiler'

home = lambda { |env|
  [200, {'Content-Type' => 'text/html'}, ["<html><body>hello!</body></html>"]]
}

builder = Rack::Builder.new do
  use Rack::MiniProfiler
  map('/') { run home }
end

run builder
```

#### Sinatra

```
require 'rack-mini-profiler'
class MyApp < Sinatra::Base
  use Rack::MiniProfiler
end
```

#### Hanami

For working with hanami, you need to use rack integration. Also, you need to add `Hanami::View::Rendering::Partial#render` method for profile:

```
# config.ru
require 'rack-mini-profiler'
Rack::MiniProfiler.profile_method(Hanami::View::Rendering::Partial, :render) { "Render partial #{@options[:partial]}" }

use Rack::MiniProfiler
```

#### Patching ActiveRecord

A typical web application spends a lot of time querying the database. rack\_mini\_profiler will detect the ORM that is available
and apply patches to properly collect query statistics.

To make this work, declare the orm's gem before declaring `rack-mini-profiler` in the `Gemfile`:

```
gem 'pg'
gem 'mongoid'
gem 'rack-mini-profiler'
```

If you wish to override this behavior, the environment variable `RACK_MINI_PROFILER_PATCH` is available.

```
export RACK_MINI_PROFILER_PATCH="pg,mongoid"
# or
export RACK_MINI_PROFILER_PATCH="false"
# initializers/rack_profiler.rb: SqlPatches.patch %w(mongo)
```

#### Patching Net::HTTP

Other than databases, `rack-mini-profiler` applies a patch to `Net::HTTP`. You may want to disable this patch:

```
export RACK_MINI_PROFILER_PATCH_NET_HTTP="false"
```

### Flamegraphs

To generate [flamegraphs](http://samsaffron.com/archive/2013/03/19/flame-graphs-in-ruby-miniprofiler), add the [**stackprof**](https://rubygems.org/gems/stackprof) gem to your Gemfile.

Then, to view the flamegraph as a direct HTML response from your request, just visit any page in your app with `?pp=flamegraph` appended to the URL, or add the header `X-Rack-Mini-Profiler` to the request with the value `flamegraph`.

Conversely, if you want your regular response instead (which is specially useful for JSON and/or XHR requests), just append the `?pp=async-flamegraph` parameter to your request/fetch URL; the request will then return as normal, and the flamegraph data will be stored for later *async* viewing, both for this request and for all subsequent requests made by this page (based on the `REFERER` header). For viewing these async flamegraphs, use the 'flamegraph' link that will appear inside the MiniProfiler UI for these requests or path returned in the `X-MiniProfiler-Flamegraph-Path` header.

Note: Mini Profiler will not record SQL timings for a request if it asks for a flamegraph. The rationale behind this is to keep
Mini Profiler's methods that are responsible for generating the timings data out of the flamegraph.

### Memory Profiling

Memory allocations can be measured (using the [memory\_profiler](https://github.com/SamSaffron/memory_profiler) gem)
which will show allocations broken down by gem, file location, and class and will also highlight `String` allocations.

Add `?pp=profile-memory` to the URL of any request while Rack::MiniProfiler is enabled to generate the report.

Additional query parameters can be used to filter the results.

* `memory_profiler_allow_files` - filename pattern to include (default is all files)
* `memory_profiler_ignore_files` - filename pattern to exclude (default is no exclusions)
* `memory_profiler_top` - number of results per section (defaults to 50)

The allow/ignore patterns will be treated as regular expressions.

Example: `?pp=profile-memory&memory_profiler_allow_files=active_record|app`

There are two additional `pp` options that can be used to analyze memory which do not require the `memory_profiler` gem

* Use `?pp=profile-gc` to report on Garbage Collection statistics
* Use `?pp=analyze-memory` to report on ObjectSpace statistics

### Snapshots Sampling

In a complex web application, it's possible for a request to trigger rare conditions that result in poor performance. Mini Profiler ships with a feature to help detect those rare conditions and fix them. It works by enabling invisible profiling on one request every N requests, and saving the performance metrics that are collected during the request (a.k.a snapshot of the request) so that they can be viewed later. To turn this feature on, set the `snapshot_every_n_requests` config to a value larger than 0. The larger the value is, the less frequently requests are profiled.

Mini Profiler will exclude requests that are made to skipped paths (see `skip_paths` config below) from being sampled. Additionally, if profiling is enabled for a request that later finishes with a non-2xx status code, Mini Profiler will discard the snapshot and not save it (this behavior may change in the future).

After enabling snapshots sampling, you can see the snapshots that have been collected at `/mini-profiler-resources/snapshots` (or if you changed the `base_url_path` config, substitute `mini-profiler-resources` with your value of the config). You'll see on that page a table where each row represents a group of snapshots with the duration of the worst snapshot in that group. The worst snapshot in a group is defined as the snapshot whose request took longer than all of the snapshots in the same group. Snapshots grouped by HTTP method and path of the request, and if your application is a Rails app, Mini Profiler will try to convert the path to `controller#action` and group by that instead of request path. Clicking on a group will display the snapshots of that group sorted from worst to best. From there, you can click on a snapshot's ID to see the snapshot with all the performance metrics that were collected.

Access to the snapshots page is restricted to only those who can see the speed badge on their own requests, see the section below this one about access control.

Mini Profiler will keep a maximum of 50 snapshot groups and a maximum of 15 snapshots per group making the default maximum number of snapshots in the system 750. The default group and per group limits can be changed via the `max_snapshot_groups` and `max_snapshots_per_group` configuration options, see the configurations table below.

#### Snapshots Transporter

Mini Profiler can be configured so that it sends snapshots over HTTP using the snapshots transporter. The main use-case of the transporter is to allow the aggregation of snapshots from multiple applications/sources in a single place. To enable the snapshots transporter, you need to provide a destination URL to the `snapshots_transport_destination_url` config, and a secure key to the `snapshots_transport_auth_key` config (will be used for authorization). Both of these configs are required for the transporter to be enabled.

The transporter uses a buffer to temporarily hold snapshots in memory with a limit of 100 snapshots. Every 30 seconds, *if* the buffer is not empty, the transporter will make a `POST` request with the buffer content to the destination URL. Requests made by the transporter will have a `Mini-Profiler-Transport-Auth` header with the value of the `snapshots_transport_auth_key` config. The destination should only accept requests that include this header AND the header's value matches the key you set to the `snapshots_transport_auth_key` config.

If the specified destination responds with a non-200 status code, the transporter will increase the interval between requests by `2^n` seconds where `n` is the number of failed requests since the last successful request. The base interval between requests is 30 seconds. So if a request fails, the next request will be `30 + 2^1 = 32` seconds later. If the next request fails too, the next one will be `30 + 2^2 = 34` seconds later and so on until a request succeeds at which point the interval will return to 30 seconds. The interval will not go beyond 1 hour.

Requests made by the transporter can be optionally gzip-compressed by setting the `snapshots_transport_gzip_requests` config to true. The body of the requests (after decompression, if you opt for compression) is a JSON string with a single top-level key called `snapshots` and it has an array of snapshots. The structure of a snapshot is too complex to be explained here, but it has the same structure that Mini Profiler client expects. So if your use-case is to simply be able to view snapshots from multiple sources in one place, you should simply store the snapshots as-is, and then serve them to Mini Profiler client to consume. If the destination application also has Mini Profiler, you can simply use the API of the storage backends to store the incoming snapshots and Mini Profiler will treat them the same as local snapshots (e.g. they'll be grouped and displayed in the same manner described in the previous section).

Mini Profiler offers an API to add extra fields (a.k.a custom fields) to snapshots. For example, you may want to add whether the request was made by a logged-in or anonymous user, the version of your application or any other things that are specific to your application. To add custom fields to a snapshot, call the `Rack::MiniProfiler.add_snapshot_custom_field(<key>, <value>)` method anywhere during the lifetime of a request, and the snapshot of that request will include the fields you added. If you have a Rails app, you can call that method in an `after_action` callback. Custom fields are cleared between requests.

## Access control in non-development environments

rack-mini-profiler is designed with production profiling in mind. To enable that run `Rack::MiniProfiler.authorize_request` once you know a request is allowed to profile.

```
  # inside your ApplicationController

  before_action do
    if current_user && current_user.is_admin?
      Rack::MiniProfiler.authorize_request
    end
  end
```
> If your production application is running on more than one server (or more than one dyno) you will need to configure rack mini profiler's storage to use Redis or Memcache. See [storage](#storage) for information on changing the storage backend.

Note:

Out-of-the-box we will initialize the `authorization_mode` to `:allow_authorized` in production. However, in some cases we may not be able to do it:

* If you are running in development or test we will not enable the explicit authorization mode
* If you use `require: false` on rack\_mini\_profiler we are unlikely to be able to run the railtie
* If you are running outside of rails we will not run the railtie

In those cases use:

```
Rack::MiniProfiler.config.authorization_mode = :allow_authorized
```

When deciding to fully profile a page mini profiler consults with the `authorization_mode`

By default in production we attempt to set the authorization mode to `:allow_authorized` meaning that end user will only be able to see requests where somewhere `Rack::MiniProfiler.authorize_request` is invoked.

In development we run in the `:allow_all` authorization mode meaning every request is profiled and displayed to the end user.

## Configuration

Various aspects of rack-mini-profiler's behavior can be configured when your app boots.
For example in a Rails app, this should be done in an initializer:
**config/initializers/mini\_profiler.rb**

### Caching behavior

To fix some nasty bugs with rack-mini-profiler showing the wrong data, the middleware
will remove headers relating to caching (Date & Etag on responses, If-Modified-Since & If-None-Match on requests).
This probably won't ever break your application, but it can cause some unexpected behavior. For
example, in a Rails app, calls to `stale?` will always return true.

To disable this behavior, use the following config setting:

```
# Do not let rack-mini-profiler disable caching
Rack::MiniProfiler.config.disable_caching = false # defaults to true
```

### Storage

rack-mini-profiler stores its results so they can be shared later and aren't lost at the end of the request.

There are 4 storage options: `MemoryStore`, `RedisStore`, `MemcacheStore`, and `FileStore`.

`FileStore` is the default in Rails environments and will write files to `tmp/miniprofiler/*`. `MemoryStore` is the default otherwise.

```
# set MemoryStore
Rack::MiniProfiler.config.storage = Rack::MiniProfiler::MemoryStore

# set RedisStore
if Rails.env.production?
  Rack::MiniProfiler.config.storage_options = { url: ENV["REDIS_SERVER_URL"] }
  Rack::MiniProfiler.config.storage = Rack::MiniProfiler::RedisStore
end
```

`MemoryStore` stores results in a processes heap - something that does not work well in a multi process environment.
`FileStore` stores results in the file system - something that may not work well in a multi machine environment.
`RedisStore`/`MemcacheStore` work in multi process and multi machine environments (`RedisStore` only saves results for up to 24 hours so it won't continue to fill up Redis). You will need to add `gem redis`/`gem dalli` respectively to your `Gemfile` to use these stores.

Additionally you may implement an `AbstractStore` for your own provider.

### User result segregation

MiniProfiler will attempt to keep all user results isolated, out-of-the-box the user provider uses the ip address:

```
Rack::MiniProfiler.config.user_provider = Proc.new{|env| Rack::Request.new(env).ip}
```

You can override (something that is very important in a multi-machine production setup):

```
Rack::MiniProfiler.config.user_provider = Proc.new{ |env| CurrentUser.get(env) }
```

The string this function returns should be unique for each user on the system (for anonymous you may need to fall back to ip address)

### Profiling specific methods

You can increase the granularity of profiling by measuring the performance of specific methods. Add methods of interest to an initializer.

```
Rails.application.config.to_prepare do
  ::Rack::MiniProfiler.profile_singleton_method(User, :non_admins) { |a| "executing all_non_admins" }
  ::Rack::MiniProfiler.profile_method(User, :favorite_post) { |a| "executing favorite_post" }
end
```

### Profiling arbitrary block of code

It is also possible to profile any arbitrary block of code by passing a block to `Rack::MiniProfiler.step(name, opts=nil)`.

```
Rack::MiniProfiler.step('Adding two elements') do
  result = 1 + 2
end
```

### Using in SPA applications

Single page applications built using Ember, Angular or other frameworks need some special care, as routes often change without a full page load.

On route transition always call:

```
if (window.MiniProfiler !== undefined) {
  window.MiniProfiler.pageTransition();
}

```

This method will remove profiling information that was related to previous page and clear aggregate statistics.

#### MiniProfiler's speed badge on pages that are not generated via Rails

You need to inject the following in your SPA to load MiniProfiler's speed badge ([extra details surrounding this script](https://github.com/MiniProfiler/rack-mini-profiler/issues/139#issuecomment-192880706) and [credit for the script tag](https://github.com/MiniProfiler/rack-mini-profiler/issues/479#issue-782488320) to [@ivanyv](https://github.com/ivanyv)):

```
 <script type="text/javascript" id="mini-profiler"
        src="/mini-profiler-resources/includes.js?v=12b4b45a3c42e6e15503d7a03810ff33"
        data-css-url="/mini-profiler-resources/includes.css?v=12b4b45a3c42e6e15503d7a03810ff33"
        data-version="12b4b45a3c42e6e15503d7a03810ff33"
        data-path="/mini-profiler-resources/"
        data-horizontal-position="left"
        data-vertical-position="top"
        data-ids=""
        data-trivial="false"
        data-children="false"
        data-max-traces="20"
        data-controls="false"
        data-total-sql-count="false"
        data-authorized="true"
        data-toggle-shortcut="alt+p"
        data-start-hidden="false"
        data-collapse-results="true"
        data-html-container="body"
        data-hidden-custom-fields></script>
```

See an [example of how to do this in a React useEffect](https://gist.github.com/katelovescode/01cfc2b962c165193b160fd10af6c4d5).

*Note:* The GUID (`data-version` and the `?v=` parameter on the `src` and `data-css-url`) will change with each release of `rack_mini_profiler`. The MiniProfiler's speed badge will continue to work, although you will have to change the GUID to expire the script to fetch the most recent version.

#### Using MiniProfiler's built in route for apps without HTML responses

MiniProfiler also ships with a `/rack-mini-profiler/requests` route that displays the speed badge on a blank HTML page. This can be useful when profiling an application that does not render HTML.

#### Register MiniProfiler's assets in the Rails assets pipeline

MiniProfiler can be configured so it registers its assets in the assets pipeline. To do that, you'll need to provide a lambda (or proc) to the `assets_url` config (see the below section). The callback will receive 3 arguments which are: `name` represents asset name (currently it's either `rack-mini-profiling.js` or `rack-mini-profiling.css`), `assets_version` is a 32 characters long hash of MiniProfiler's assets, and `env` which is the `env` object of the request. MiniProfiler expects the `assets_url` callback to return a URL from which the asset can be loaded (the return value will be used as a `href`/`src` attribute in the DOM). If the `assets_url` callback is not set (the default) or it returns a non-truthy value, MiniProfiler will fallback to loading assets from its own middleware (`/mini-profiler-resources/*`). The following callback should work for most applications:

```
Rack::MiniProfiler.config.assets_url = ->(name, version, env) {
  ActionController::Base.helpers.asset_path(name)
}
```

### Configuration Options

You can set configuration options using the configuration accessor on `Rack::MiniProfiler`.
For example:

```
Rack::MiniProfiler.config.position = 'bottom-right'
Rack::MiniProfiler.config.start_hidden = true
```

The available configuration options are:

| Option | Default | Description |
| --- | --- | --- |
| pre\_authorize\_cb | Rails: dev onlyRack: always on | A lambda callback that returns true to make mini\_profiler visible on a given request. |
| position | `'top-left'` | Display mini\_profiler on `'top-right'`, `'top-left'`, `'bottom-right'` or `'bottom-left'`. |
| skip\_paths | `[]` | An array of paths that skip profiling. Both `String` and `Regexp` are acceptable in the array. |
| skip\_schema\_queries | Rails dev: `true`Othwerwise: `false` | `true` to skip schema queries. |
| auto\_inject | `true` | `true` to inject the miniprofiler script in the page. |
| backtrace\_ignores | `[]` | Regexes of lines to be removed from backtraces. |
| backtrace\_includes | Rails: `[/^\/?(app|config|lib|test)/]`Rack: `[]` | Regexes of lines to keep in backtraces. |
| backtrace\_remove | rails: `Rails.root`Rack: `nil` | A string or regex to remove part of each line in the backtrace. |
| toggle\_shortcut | Alt+P | Keyboard shortcut to toggle the mini\_profiler's visibility. See [jquery.hotkeys](https://github.com/jeresig/jquery.hotkeys). |
| start\_hidden | `false` | `false` to make mini\_profiler visible on page load. |
| backtrace\_threshold\_ms | `0` | Minimum SQL query elapsed time before a backtrace is recorded. |
| flamegraph\_sample\_rate | `0.5` | How often to capture stack traces for flamegraphs in milliseconds. |
| flamegraph\_mode | `:wall` | The [StackProf mode](https://github.com/tmm1/stackprof#all-options) to pass to `StackProf.run`. |
| flamegraph\_ignore\_gc | `false` | Whether to ignore garbage collection frames in flamegraphs. |
| base\_url\_path | `'/mini-profiler-resources/'` | Path for assets; added as a prefix when naming assets and sought when responding to requests. |
| cookie\_path | `'/'` | Set-Cookie header path for profile cookie |
| collapse\_results | `true` | If multiple timing results exist in a single page, collapse them till clicked. |
| max\_traces\_to\_show | 20 | Maximum number of mini profiler timing blocks to show on one page |
| html\_container | `body` | The HTML container (as a jQuery selector) to inject the mini\_profiler UI into |
| show\_total\_sql\_count | `false` | Displays the total number of SQL executions. |
| enable\_advanced\_debugging\_tools | `false` | Enables sensitive debugging tools that can be used via the UI. In production we recommend keeping this disabled as memory and environment debugging tools can expose contents of memory that may contain passwords. Defaults to `true` in development. |
| assets\_url | `nil` | See the "Register MiniProfiler's assets in the Rails assets pipeline" section above. |
| snapshot\_every\_n\_requests | `-1` | Determines how frequently snapshots are taken. See the "Snapshots Sampling" above for more details. |
| max\_snapshot\_groups | `50` | Determines how many snapshot groups Mini Profiler is allowed to keep. |
| max\_snapshots\_per\_group | `15` | Determines how many snapshots per group Mini Profiler is allowed to keep. |
| snapshot\_hidden\_custom\_fields | `[]` | Each snapshot custom field will have a dedicated column in the UI by default. Use this config to exclude certain custom fields from having their own columns. |
| snapshots\_transport\_destination\_url | `nil` | Set this config to a valid URL to enable snapshots transporter which will `POST` snapshots to the given URL. The transporter requires `snapshots_transport_auth_key` config to be set as well. |
| snapshots\_transport\_auth\_key | `nil` | `POST` requests made by the snapshots transporter to the destination URL will have a `Mini-Profiler-Transport-Auth` header with the value of this config. Make sure you use a secure and random key for this config. |
| snapshots\_redact\_sql\_queries | `true` | When this is true, SQL queries will be redacted from sampling snapshots, but the backtrace and duration of each SQL query will be saved with the snapshot to keep debugging performance issues possible. |
| snapshots\_transport\_gzip\_requests | `false` | Make the snapshots transporter gzip the requests it makes to `snapshots_transport_destination_url`. |
| content\_security\_policy\_nonce | Rails: Current nonceRack: nil | Set the content security policy nonce to use when inserting MiniProfiler's script block. Can be set to a static string, or a Proc which receives `env` and `response_headers` as arguments and returns the nonce. |
| enable\_hotwire\_turbo\_drive\_support | `false` | Enable support for Hotwire TurboDrive page transitions. |
| profile\_parameter | `'pp'` | The query parameter used to interact with this gem. |

### Using MiniProfiler with `Rack::Deflate` middleware

If you are using `Rack::Deflate` with Rails and `rack-mini-profiler` in its default configuration,
`Rack::MiniProfiler` will be injected (as always) at position 0 in the middleware stack,
which means it will run after `Rack::Deflate` on response processing. To prevent attempting to inject
HTML in already compressed response body MiniProfiler will suppress compression by setting
`identity` encoding in `Accept-Encoding` request header.

### Using MiniProfiler with Heroku Redis

If you are using Heroku Redis, you may need to add the following to your `config/initializers/mini_profiler.rb`, in order to get Mini Profiler to work:

```
if Rails.env.production?
  Rack::MiniProfiler.config.storage_options = {
    url: ENV["REDIS_URL"],
    ssl_params: { verify_mode: OpenSSL::SSL::VERIFY_NONE }
  }
  Rack::MiniProfiler.config.storage = Rack::MiniProfiler::RedisStore
end
```

The above code snippet is [Heroku's officially suggested workaround](https://help.heroku.com/HC0F8CUS/redis-connection-issues).

## Special query strings

If you include the query string `pp=help` at the end of your request you will see the various options available. You can use these options to extend or contract the amount of diagnostics rack-mini-profiler gathers.

## Development

If you want to contribute to this project, that's great, thank you! You can run the following rake task:

```
$ BUNDLE_GEMFILE=website/Gemfile bundle install
$ bundle exec rake client_dev

```

This will start a local Sinatra server at `http://localhost:9292` where you'll be able to preview your changes. Refreshing the page should be enough to see any changes you make to files in the `lib/html` directory.

Make sure to prepend `bundle exec` before any Rake tasks you run.

## Running the Specs

You need Memcached and Redis services running for the specs.

```
$ bundle exec rake build
$ bundle exec rake spec

```

## Licence

The MIT License (MIT)

Copyright (c) 2013 Sam Saffron

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

## About

Profiler for your development and production Ruby rack apps.

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)

[Activity](/MiniProfiler/rack-mini-profiler/activity)
[Custom properties](/MiniProfiler/rack-mini-profiler/custom-properties)
### Stars

[**3.8k**
stars](/MiniProfiler/rack-mini-profiler/stargazers)
### Watchers

[**59**
watching](/MiniProfiler/rack-mini-profiler/watchers)
### Forks

[**406**
forks](/MiniProfiler/rack-mini-profiler/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FMiniProfiler%2Frack-mini-profiler&report=MiniProfiler+%28user%29)

## [Releases 4](/MiniProfiler/rack-mini-profiler/releases)

[3.3.0
Latest

Dec 7, 2023](/MiniProfiler/rack-mini-profiler/releases/tag/v3.3.0)
[+ 3 releases](/MiniProfiler/rack-mini-profiler/releases)

## [Packages 0](/orgs/MiniProfiler/packages?repo_name=rack-mini-profiler)

No packages published

## [Used by 148k](/MiniProfiler/rack-mini-profiler/network/dependents)

[* ![@sibananda-k](https://avatars.githubusercontent.com/u/580762?s=64&v=4)
* ![@Shinonononon](https://avatars.githubusercontent.com/u/167385552?s=64&v=4)
* ![@hendragunz](https://avatars.githubusercontent.com/u/992950?s=64&v=4)
* ![@jinyuan0425](https://avatars.githubusercontent.com/u/108602250?s=64&v=4)
* ![@CDRH](https://avatars.githubusercontent.com/u/1234340?s=64&v=4)
* ![@CDRH](https://avatars.githubusercontent.com/u/1234340?s=64&v=4)
* ![@SauravDhillon](https://avatars.githubusercontent.com/u/38269441?s=64&v=4)
* ![@CDRH](https://avatars.githubusercontent.com/u/1234340?s=64&v=4)

+ 148,336](/MiniProfiler/rack-mini-profiler/network/dependents)

## [Contributors 193](/MiniProfiler/rack-mini-profiler/graphs/contributors)

[+ 179 contributors](/MiniProfiler/rack-mini-profiler/graphs/contributors)

## Languages

* [Ruby
  65.6%](/MiniProfiler/rack-mini-profiler/search?l=ruby)
* [JavaScript
  27.5%](/MiniProfiler/rack-mini-profiler/search?l=javascript)
* [CSS
  4.0%](/MiniProfiler/rack-mini-profiler/search?l=css)
* [SCSS
  2.7%](/MiniProfiler/rack-mini-profiler/search?l=scss)
* [HTML
  0.2%](/MiniProfiler/rack-mini-profiler/search?l=html)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4a1f861c_20250125_210333.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMiniProfiler%2Frack-mini-profiler%2Fcommit%2F4273771d65f1a7411e3ef5843329308d0e2d257c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMiniProfiler%2Frack-mini-profiler%2Fcommit%2F4273771d65f1a7411e3ef5843329308d0e2d257c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=MiniProfiler%2Frack-mini-profiler)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MiniProfiler](/MiniProfiler)
/
**[rack-mini-profiler](/MiniProfiler/rack-mini-profiler)**
Public

* [Notifications](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler) You must be signed in to change notification settings
* [Fork
  406](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler)
* [Star
   3.8k](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler)

* [Code](/MiniProfiler/rack-mini-profiler)
* [Issues
  40](/MiniProfiler/rack-mini-profiler/issues)
* [Pull requests
  12](/MiniProfiler/rack-mini-profiler/pulls)
* [Actions](/MiniProfiler/rack-mini-profiler/actions)
* [Projects
  0](/MiniProfiler/rack-mini-profiler/projects)
* [Wiki](/MiniProfiler/rack-mini-profiler/wiki)
* [Security](/MiniProfiler/rack-mini-profiler/security)
* [Insights](/MiniProfiler/rack-mini-profiler/pulse)

Additional navigation options

* [Code](/MiniProfiler/rack-mini-profiler)
* [Issues](/MiniProfiler/rack-mini-profiler/issues)
* [Pull requests](/MiniProfiler/rack-mini-profiler/pulls)
* [Actions](/MiniProfiler/rack-mini-profiler/actions)
* [Projects](/MiniProfiler/rack-mini-profiler/projects)
* [Wiki](/MiniProfiler/rack-mini-profiler/wiki)
* [Security](/MiniProfiler/rack-mini-profiler/security)
* [Insights](/MiniProfiler/rack-mini-profiler/pulse)

## Commit

[Permalink](/MiniProfiler/rack-mini-profiler/commit/4273771d65f1a7411e3ef5843329308d0e2d257c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

FEATURE: perform security checks earlier in the pipeline

[Browse files](/MiniProfiler/rack-mini-profiler/tree/4273771d65f1a7411e3ef5843329308d0e2d257c)
Browse the repository at this point in the history

```
This avoids needing to discard results and ensures no areas of mini profiler
can execute prior to a request being authorized

authorization token lasts for 30 minutes and is cycled after that
```

* Loading branch information

[![@SamSaffron](https://avatars.githubusercontent.com/u/5213?s=40&v=4)](/SamSaffron)

[SamSaffron](/MiniProfiler/rack-mini-profiler/commits?author=SamSaffron "View all commits by SamSaffron")
committed
May 18, 2016

1 parent
[bf33bd7](/MiniProfiler/rack-mini-profiler/commit/bf33bd7b578daf8752404b4179a91ea6211a0beb)

commit 4273771

 Show file tree

 Hide file tree

Showing
**31 changed files**
with
**435 additions**
and
**94 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Gemfile
  [Gemfile](#diff-d09ea66f8227784ff4393d88a19836f321c915ae10031d16c93d67e6283ab55f)
* Guardfile
  [Guardfile](#diff-ab03a64653d5f0be37ddb6e3cd5175f5470d5c92b21a4b4535c7c9d3cd476030)
* autotest

  + autotest/discover.rb
    [discover.rb](#diff-6c3480e33314c2345d6583e9be8975c4c7ea18109c6743524973f868e5d88050)
* lib

  + mini\_profiler

    - lib/mini\_profiler/client\_settings.rb
      [client\_settings.rb](#diff-d18e432f08826bdc65779224b521d1f9115756125e180278951ceea2e9bcc407)
    - lib/mini\_profiler/context.rb
      [context.rb](#diff-5c87f460c35098532d7135b42fc09a5f645a94f08e8cc8059b73f8d47a0c17e7)
    - lib/mini\_profiler/profiler.rb
      [profiler.rb](#diff-8e928adf7c0f1d3cba07c5845b056e7332ca41a5f63e3e72064217b7044e875e)
    - storage

      * lib/mini\_profiler/storage/abstract\_store.rb
        [abstract\_store.rb](#diff-b39b84f4227d1a58117e14ef0e96842735c86e4802ebd3987adb0dafb988e5e0)
      * lib/mini\_profiler/storage/file\_store.rb
        [file\_store.rb](#diff-bc043782e35769a33895e12c6ac1276fe119162754f8c0583eacb4e282c2c128)
      * lib/mini\_profiler/storage/memcache\_store.rb
        [memcache\_store.rb](#diff-440884385d836afa45fb87d70a1a4e45a5f48c80afcb4d253132bfb4f3ad33bd)
      * lib/mini\_profiler/storage/memory\_store.rb
        [memory\_store.rb](#diff-490c5ab20a936acb24b6c80320eb07ffb7df98fda00374be9a7ea0763b560303)
      * lib/mini\_profiler/storage/redis\_store.rb
        [redis\_store.rb](#diff-842351c05b45a853f7d30e6cf692dd7178da61b7b9d2d3b5c45e3abdf5790a0e)
  + lib/rack-mini-profiler.rb
    [rack-mini-profiler.rb](#diff-a92533c0db285904bf3d425c61ce513f97c6f5108f6cda389038973715ab1731)
* rack-mini-profiler.gemspec
  [rack-mini-profiler.gemspec](#diff-2f7c63fb4e2a39d0677df19179e6bba369eb102a53b698a3f7006d2148db2f8a)
* spec

  + components

    - spec/components/client\_settings\_spec.rb
      [client\_settings\_spec.rb](#diff-ff40d024d590306d682370aca5863d3d27df22ce8f69de25635e15c631c32daf)
  + integration

    - spec/integration/mini\_profiler\_spec.rb
      [mini\_profiler\_spec.rb](#diff-faf264662a699bdd6b521917f922e7262517e61c52e9aae0ef4d50e52c02fa14)
  + lib

    - spec/lib/client\_settings\_spec.rb
      [client\_settings\_spec.rb](#diff-958e570805377ab3e5f3730b69a10ce169ee4af7dc197d3614e2ef959ffda16b)
    - spec/lib/config\_spec.rb
      [config\_spec.rb](#diff-deb85a4e8558cbb012b679f31fc4e56f7bd0a8ae3d6724995aa5d6af5c7aa067)
    - spec/lib/gc\_profiler\_spec.rb
      [gc\_profiler\_spec.rb](#diff-781afb1fcfe48fb758cddb73898ca56dae6c54fc34a85dd2d55d7cefd5ebdf10)
    - spec/lib/profiler\_spec.rb
      [profiler\_spec.rb](#diff-8979b08e2bf6318dcce94adb06504204a35ea519f72ce5c5ee16853d0395e301)
    - spec/lib/sql\_patches\_spec.rb
      [sql\_patches\_spec.rb](#diff-c901b13476ab33ef96251b3acdacb00120eb0f2454de32cee4362e0130385691)
    - storage

      * spec/lib/storage/file\_store\_spec.rb
        [file\_store\_spec.rb](#diff-3ae9b3e0f75fecc48c95eb16911111303b868881fffa80e98865701d76041e01)
      * spec/lib/storage/memcache\_store\_spec.rb
        [memcache\_store\_spec.rb](#diff-5193f78872eb4e37e337016bf865f01c3fc668cea1e60ae0f4a7a9a017c0c983)
      * spec/lib/storage/memory\_store\_spec.rb
        [memory\_store\_spec.rb](#diff-58beacfa9368a359e2230f02ec3b3dce8943639091207dd8772b5f26c826e4c3)
      * spec/lib/storage/redis\_store\_spec.rb
        [redis\_store\_spec.rb](#diff-ddcfffef60dc313dddf02a8ab6fa1afb9eb435526d21aed54d7a6db63487b7b6)
    - timer\_struct

      * spec/lib/timer\_struct/client\_timer\_struct\_spec.rb
        [client\_timer\_struct\_spec.rb](#diff-925d96764ef02a7c8440465636031c1c2420bc9f9cb2242f80313f144da2848e)
      * spec/lib/timer\_struct/custom\_spec.rb
        [custom\_spec.rb](#diff-833625a6d366d824ab31cf0ef8680bba4c117a74caec356dc622197831be5d78)
      * spec/lib/timer\_struct/page\_timer\_struct\_spec.rb
        [page\_timer\_struct\_spec.rb](#diff-5d125c35fa13ce9fa80d72fac83dc61afdd55a62e70ab0811ae2ca79dbca51c8)
      * spec/lib/timer\_struct/request\_timer\_struct\_spec.rb
        [request\_timer\_struct\_spec.rb](#diff-ed2b847ad71efd0edbbbffa420830e899ac040ab6ddcf9fff982f409b5c35669)
      * spec/lib/timer\_struct/sql\_timer\_struct\_spec.rb
        [sql\_timer\_struct\_spec.rb](#diff-5ffa02d748243ed16ba95020f255feb0146cf20d94e42115289a7852fce003c1)
      * spec/lib/timer\_struct/timer\_struct\_spec.rb
        [timer\_struct\_spec.rb](#diff-c356dc2971ea8969f7a16d710bc385a45c58b4e0aa778f638ed963656a921201)
  + spec/spec\_helper.rb
    [spec\_helper.rb](#diff-89eebfcbc0f14b6d989517837ca1e94fce4e2ce9a03233641cd936f2b8d2ed94)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[Gemfile](#diff-d09ea66f8227784ff4393d88a19836f321c915ae10031d16c93d67e6283ab55f "Gemfile")

Show comments

[View file](/MiniProfiler/rack-mini-profiler/blob/4273771d65f1a7411e3ef5843329308d0e2d257c/Gemfile)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,4 +2,4 @@ source 'http://rubygems.org' |
|  |  |  |
|  |  | gemspec |
|  |  |  |
|  |  | gem 'codecov', :require => false, :group => :test |
|  |  | gem 'codecov', :require => false, :group => :test |

30 changes: 30 additions & 0 deletions

30
[Guardfile](#diff-ab03a64653d5f0be37ddb6e3cd5175f5470d5c92b21a4b4535c7c9d3cd476030 "Guardfile")

Show comments

[View file](/MiniProfiler/rack-mini-profiler/blob/4273771d65f1a7411e3ef5843329308d0e2d257c/Guardfile)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,30 @@ |
|  |  | # A sample Guardfile |
|  |  | # More info at https://github.com/guard/guard#readme |
|  |  |  |
|  |  | directories %w(lib spec) \ |
|  |  | .select{|d| Dir.exists?(d) ? d : UI.warning("Directory #{d} does not exist")} |
|  |  |  |
|  |  | ## Note: if you are using the `directories` clause above and you are not |
|  |  | ## watching the project directory ('.'), then you will want to move |
|  |  | ## the Guardfile to a watched dir and symlink it back, e.g. |
|  |  | # |
|  |  | # $ mkdir config |
|  |  | # $ mv Guardfile config/ |
|  |  | # $ ln -s config/Guardfile . |
|  |  | # |
|  |  | # and, you'll have to watch "config/Guardfile" instead of "Guardfile" |
|  |  |  |
|  |  | # Note: The cmd option is now required due to the increasing number of ways |
|  |  | # rspec may be run, below are examples of the most common uses. |
|  |  | # \* bundler: 'bundle exec rspec' |
|  |  | # \* bundler binstubs: 'bin/rspec' |
|  |  | # \* spring: 'bin/rsspec' (This will use spring if running and you have |
|  |  | # installed the spring binstubs per the docs) |
|  |  | # \* zeus: 'zeus rspec' (requires the server to be started separetly) |
|  |  | # \* 'just' rspec: 'rspec' |
|  |  | guard :rspec, cmd: 'bundle exec rspec', failed\_mode: :focus do |
|  |  | watch(%r{^spec/.+\_spec\.rb$}) |
|  |  | watch(%r{^lib/mini\_profiler/(.+)\.rb$}) { |m| "spec/lib/#{m[1]}\_spec.rb" } |
|  |  | watch('spec/spec\_helper.rb') { "spec" } |
|  |  | end |
|  |  |  |

2 changes: 0 additions & 2 deletions

2
[autotest/discover.rb](#diff-6c3480e33314c2345d6583e9be8975c4c7ea18109c6743524973f868e5d88050 "autotest/discover.rb")

Show comments

[View file](/MiniProfiler/rack-mini-profiler/blob/bf33bd7b578daf8752404b4179a91ea6211a0beb/autotest/discover.rb)
Edit file

Delete file

Load diff

This file was deleted.

Oops, something went wrong.

Retry

67 changes: 59 additions & 8 deletions

67
[lib/mini\_profiler/client\_settings.rb](#diff-d18e432f08826bdc65779224b521d1f9115756125e180278951ceea2e9bcc407 "lib/mini_profiler/client_settings.rb")

Show comments

[View file](/MiniProfiler/rack-mini-profiler/blob/4273771d65f1a7411e3ef5843329308d0e2d257c/lib/mini_profiler/client_settings.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,39 +12,90 @@ class ClientSettings |
|  |  | attr\_accessor :backtrace\_level |
|  |  |  |
|  |  |  |
|  |  | def initialize(env) |
|  |  | def initialize(env, store, start) |
|  |  | request = ::Rack::Request.new(env) |
|  |  | @cookie = request.cookies[COOKIE\_NAME] |
|  |  | @store = store |
|  |  | @start = start |
|  |  |  |
|  |  | @allowed\_tokens, @orig\_auth\_tokens = nil |
|  |  |  |
|  |  | if @cookie |
|  |  | @cookie.split(",").map{|pair| pair.split("=")}.each do |k,v| |
|  |  | @orig\_disable\_profiling = @disable\_profiling = (v=='t') if k == "dp" |
|  |  | @backtrace\_level = v.to\_i if k == "bt" |
|  |  | @orig\_auth\_tokens = v.to\_s.split("|") if k == "a" |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | @backtrace\_level = nil if !@backtrace\_level.nil? && (@backtrace\_level == 0 || @backtrace\_level > BACKTRACE\_NONE) |
|  |  | if !@backtrace\_level.nil? && (@backtrace\_level == 0 || @backtrace\_level > BACKTRACE\_NONE) |
|  |  | @backtrace\_level = nil |
|  |  | end |
|  |  |  |
|  |  | @orig\_backtrace\_level = @backtrace\_level |
|  |  |  |
|  |  | end |
|  |  |  |
|  |  | def handle\_cookie(result) |
|  |  | status,headers,\_body = result |
|  |  |  |
|  |  | if (MiniProfiler.config.authorization\_mode == :whitelist && !MiniProfiler.request\_authorized?) |
|  |  | # this is non-obvious, don't kill the profiling cookie on errors or short requests |
|  |  | # this ensures that stuff that never reaches the rails stack does not kill profiling |
|  |  | if status.to\_i >= 200 && status.to\_i < 300 && ((Time.now - @start) > 0.1) |
|  |  | discard\_cookie!(headers) |
|  |  | end |
|  |  | else |
|  |  | write!(headers) |
|  |  | end |
|  |  |  |
|  |  | result |
|  |  | end |
|  |  |  |
|  |  | def write!(headers) |
|  |  | if @orig\_disable\_profiling != @disable\_profiling || @orig\_backtrace\_level != @backtrace\_level || @cookie.nil? |
|  |  |  |
|  |  | tokens\_changed = false |
|  |  |  |
|  |  | if MiniProfiler.request\_authorized? && MiniProfiler.config.authorization\_mode == :whitelist |
|  |  | @allowed\_tokens ||= @store.allowed\_tokens |
|  |  | tokens\_changed = !@orig\_auth\_tokens || ((@allowed\_tokens - @orig\_auth\_tokens).length > 0) |
|  |  | end |
|  |  |  |
|  |  | if @orig\_disable\_profiling != @disable\_profiling || |
|  |  | @orig\_backtrace\_level != @backtrace\_level || |
|  |  | @cookie.nil? || |
|  |  | tokens\_changed |
|  |  |  |
|  |  | settings = {"p" => "t" } |
|  |  | settings["dp"] = "t" if @disable\_profiling |
|  |  | settings["bt"] = @backtrace\_level if @backtrace\_level |
|  |  | settings["dp"] = "t" if @disable\_profiling |
|  |  | settings["bt"] = @backtrace\_level if @backtrace\_level |
|  |  | settings["a"] = @allowed\_tokens.join("|") if @allowed\_tokens && MiniProfiler.request\_authorized? |
|  |  |  |
|  |  | settings\_string = settings.map{|k,v| "#{k}=#{v}"}.join(",") |
|  |  | Rack::Utils.set\_cookie\_header!(headers, COOKIE\_NAME, :value => settings\_string, :path => '/') |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | def discard\_cookie!(headers) |
|  |  | Rack::Utils.delete\_cookie\_header!(headers, COOKIE\_NAME, :path => '/') |
|  |  | if @cookie |
|  |  | Rack::Utils.delete\_cookie\_header!(headers, COOKIE\_NAME, :path => '/') |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | def has\_cookie? |
|  |  | !@cookie.nil? |
|  |  | def has\_valid\_cookie? |
|  |  | valid\_cookie = !@cookie.nil? |
|  |  |  |
|  |  | if (MiniProfiler.config.authorization\_mode == :whitelist) |
|  |  | @allowed\_tokens ||= @store.allowed\_tokens |
|  |  |  |
|  |  | valid\_cookie = (Array === @orig\_auth\_tokens) && |
|  |  | ((@allowed\_tokens & @orig\_auth\_tokens).length > 0) |
|  |  | end |
|  |  |  |
|  |  | valid\_cookie |
|  |  | end |
|  |  |  |
|  |  |  |
|  |  | def disable\_profiling? |
|  |  | @disable\_profiling |
|  |  | end |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[lib/mini\_profiler/context.rb](#diff-5c87f460c35098532d7135b42fc09a5f645a94f08e8cc8059b73f8d47a0c17e7 "lib/mini_profiler/context.rb")

Show comments

[View file](/MiniProfiler/rack-mini-profiler/blob/4273771d65f1a7411e3ef5843329308d0e2d257c/lib/mini_profiler/context.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,6 @@ |
|  |  | class Rack::MiniProfiler::Context |
|  |  | attr\_accessor :inject\_js,:current\_timer,:page\_struct,:skip\_backtrace,:full\_backtrace,:discard, :mpt\_init, :measure |
|  |  | attr\_accessor :inject\_js,:current\_timer,:page\_struct,:skip\_backtrace, |
|  |  | :full\_backtrace,:discard, :mpt\_init, :measure |
|  |  |  |
|  |  | def initialize(opts = {}) |
|  |  | opts["measure"] = true unless opts.key? "measure" |
| Expand Down | |  |

55 changes: 21 additions & 34 deletions

55
[lib/mini\_profiler/profiler.rb](#diff-8e928adf7c0f1d3cba07c5845b056e7332ca41a5f63e3e72064217b7044e875e "lib/mini_profiler/profiler.rb")

Show comments

[View file](/MiniProfiler/rack-mini-profiler/blob/4273771d65f1a7411e3ef5843329308d0e2d257c/lib/mini_profiler/profiler.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -149,7 +149,9 @@ def config |
|  |  |  |
|  |  | def call(env) |
|  |  |  |
|  |  | client\_settings = ClientSettings.new(env) |
|  |  | start = Time.now |
|  |  | client\_settings = ClientSettings.new(env, @storage, start) |
|  |  | MiniProfiler.deauthorize\_request if @config.authorization\_mode == :whitelist |
|  |  |  |
|  |  | status = headers = body = nil |
|  |  | query\_string = env['QUERY\_STRING'] |
| Expand All | | @@ -162,43 +164,39 @@ def call(env) |
|  |  | (@config.skip\_paths && @config.skip\_paths.any?{ |p| path.start\_with?(p) }) || |
|  |  | query\_string =~ /pp=skip/ |
|  |  |  |
|  |  | has\_profiling\_cookie = client\_settings.has\_cookie? |
|  |  |  |
|  |  | if skip\_it || (@config.authorization\_mode == :whitelist && !has\_profiling\_cookie) |
|  |  | status,headers,body = @app.call(env) |
|  |  | if !skip\_it && @config.authorization\_mode == :whitelist && !has\_profiling\_cookie && MiniProfiler.request\_authorized? |
|  |  | client\_settings.write!(headers) |
|  |  | end |
|  |  | return [status,headers,body] |
|  |  | if skip\_it || ( |
|  |  | @config.authorization\_mode == :whitelist && |
|  |  | !client\_settings.has\_valid\_cookie? |
|  |  | ) |
|  |  | return client\_settings.handle\_cookie(@app.call(env)) |
|  |  | end |
|  |  |  |
|  |  | # handle all /mini-profiler requests here |
|  |  | return serve\_html(env) if path.start\_with? @config.base\_url\_path |
|  |  | return client\_settings.handle\_cookie(serve\_html(env)) if path.start\_with? @config.base\_url\_path |
|  |  |  |
|  |  | has\_disable\_cookie = client\_settings.disable\_profiling? |
|  |  | # manual session disable / enable |
|  |  | if query\_string =~ /pp=disable/ || has\_disable\_cookie |
|  |  | skip\_it = true |
|  |  | end |
|  |  |  |
|  |  | if query\_string =~ /pp=enable/ && (@config.authorization\_mode != :whitelist || MiniProfiler.request\_authorized?) |
|  |  | if query\_string =~ /pp=enable/ |
|  |  | skip\_it = false |
|  |  | config.enabled = true |
|  |  | end |
|  |  |  |
|  |  | if skip\_it || !config.enabled |
|  |  | status,headers,body = @app.call(env) |
|  |  | client\_settings.disable\_profiling = true |
|  |  | client\_settings.write!(headers) |
|  |  | return [status,headers,body] |
|  |  | return client\_settings.handle\_cookie([status,headers,body]) |
|  |  | else |
|  |  | client\_settings.disable\_profiling = false |
|  |  | end |
|  |  |  |
|  |  | # profile gc |
|  |  | if query\_string =~ /pp=profile-gc/ |
|  |  | current.measure = false if current |
|  |  | return Rack::MiniProfiler::GCProfiler.new.profile\_gc(@app, env) |
|  |  | return client\_settings.handle\_cookie(Rack::MiniProfiler::GCProfiler.new.profile\_gc(@app, env)) |
|  |  | end |
|  |  |  |
|  |  | # profile memory |
| Expand All | | @@ -215,11 +213,10 @@ def call(env) |
|  |  | body.close if body.respond\_to? :close |
|  |  | end |
|  |  | report.pretty\_print(result) |
|  |  | return text\_result(result.string) |
|  |  | return client\_settings.handle\_cookie(text\_result(result.string)) |
|  |  | end |
|  |  |  |
|  |  | MiniProfiler.create\_current(env, @config) |
|  |  | MiniProfiler.deauthorize\_request if @config.authorization\_mode == :whitelist |
|  |  |  |
|  |  | if query\_string =~ /pp=normal-backtrace/ |
|  |  | client\_settings.backtrace\_level = ClientSettings::BACKTRACE\_DEFAULT |
| Expand All | | @@ -238,7 +235,6 @@ def call(env) |
|  |  | trace\_exceptions = query\_string =~ /pp=trace-exceptions/ && defined? TracePoint |
|  |  | status, headers, body, exceptions,trace = nil |
|  |  |  |
|  |  | start = Time.now |
|  |  |  |
|  |  | if trace\_exceptions |
|  |  | exceptions = [] |
| Expand Down  Expand Up | | @@ -281,43 +277,37 @@ def call(env) |
|  |  | else |
|  |  | status,headers,body = @app.call(env) |
|  |  | end |
|  |  | client\_settings.write!(headers) |
|  |  | ensure |
|  |  | trace.disable if trace |
|  |  | end |
|  |  |  |
|  |  | skip\_it = current.discard |
|  |  |  |
|  |  | if (config.authorization\_mode == :whitelist && !MiniProfiler.request\_authorized?) |
|  |  | # this is non-obvious, don't kill the profiling cookie on errors or short requests |
|  |  | # this ensures that stuff that never reaches the rails stack does not kill profiling |
|  |  | if status.to\_i >= 200 && status.to\_i < 300 && ((Time.now - start) > 0.1) |
|  |  | client\_settings.discard\_cookie!(headers) |
|  |  | end |
|  |  | skip\_it = true |
|  |  | end |
|  |  |  |
|  |  | return [status,headers,body] if skip\_it |
|  |  | return client\_settings.handle\_cookie([status,headers,body]) if skip\_it |
|  |  |  |
|  |  | # we must do this here, otherwise current[:discard] is not being properly treated |
|  |  | if trace\_exceptions |
|  |  | body.close if body.respond\_to? :close |
|  |  | return dump\_exceptions exceptions |
|  |  | return client\_settings.handle\_cookie(dump\_exceptions exceptions) |
|  |  | end |
|  |  |  |
|  |  | if query\_string =~ /pp=env/ && !config.disable\_env\_dump |
|  |  | body.close if body.respond\_to? :close |
|  |  | return dump\_env env |
|  |  | return client\_settings.handle\_cookie(dump\_env env) |
|  |  | end |
|  |  |  |
|  |  | if query\_string =~ /pp=analyze-memory/ |
|  |  | body.close if body.respond\_to? :close |
|  |  | return analyze\_memory |
|  |  | return client\_settings.handle\_cookie(analyze\_memory) |
|  |  | end |
|  |  |  |
|  |  | if query\_string =~ /pp=help/ |
|  |  | body.close if body.respond\_to? :close |
|  |  | return help(client\_settings, env) |
|  |  | return client\_settings.handle\_cookie(help(client\_settings, env)) |
|  |  | end |
|  |  |  |
|  |  | page\_struct = current.page\_struct |
| Expand All | | @@ -326,7 +316,7 @@ def call(env) |
|  |  |  |
|  |  | if flamegraph |
|  |  | body.close if body.respond\_to? :close |
|  |  | return self.flamegraph(flamegraph) |
|  |  | return client\_settings.handle\_cookie(self.flamegraph(flamegraph)) |
|  |  | end |
|  |  |  |
|  |  |  |
| Expand All | | @@ -337,18 +327,16 @@ def call(env) |
|  |  |  |
|  |  | # inject headers, script |
|  |  | if status >= 200 && status < 300 |
|  |  | client\_settings.write!(headers) |
|  |  | result = inject\_profiler(env,status,headers,body) |
|  |  | return result if result |
|  |  | return client\_settings.handle\_cookie(result) if result |
|  |  | end |
|  |  | rescue Exception => e |
|  |  | if @config.storage\_failure != nil |
|  |  | @config.storage\_failure.call(e) |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | client\_settings.write!(headers) |
|  |  | [status, headers, body] |
|  |  | client\_settings.handle\_cookie([status, headers, body]) |
|  |  |  |
|  |  | ensure |
|  |  | # Make sure this always happens |
| Expand Down  Expand Up | | @@ -543,7 +531,6 @@ def help(client\_settings, env) |
|  |  | </html> |
|  |  | " |
|  |  |  |
|  |  | client\_settings.write!(headers) |
|  |  | [200, headers, [body]] |
|  |  | end |
|  |  |  |
| Expand Down | |  |

8 changes: 8 additions & 0 deletions

8
[lib/mini\_profiler/storage/abstract\_store.rb](#diff-b39b84f4227d1a58117e14ef0e96842735c86e4802ebd3987adb0dafb988e5e0 "lib/mini_profiler/storage/abstract_store.rb")

Show comments

[View file](/MiniProfiler/rack-mini-profiler/blob/4273771d65f1a7411e3ef5843329308d0e2d257c/lib/mini_profiler/storage/abstract_store.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,6 +2,9 @@ module Rack |
|  |  | class MiniProfiler |
|  |  | class AbstractStore |
|  |  |  |
|  |  | # maximum age of allowed tokens before cycling in seconds |
|  |  | MAX\_TOKEN\_AGE = 1800 |
|  |  |  |
|  |  | def save(page\_struct) |
|  |  | raise NotImplementedError.new("save is not implemented") |
|  |  | end |
| Expand Down  Expand Up | | @@ -31,6 +34,11 @@ def diagnostics(user) |
|  |  | "" |
|  |  | end |
|  |  |  |
|  |  | # a list of tokens that are permitted to access profiler in whitelist mode |
|  |  | def allowed\_tokens |
|  |  | raise NotImplementedError.new("allowed\_tokens is not implemented") |
|  |  | end |
|  |  |  |
|  |  | end |
|  |  | end |
|  |  | end |

25 changes: 25 additions & 0 deletions

25
[lib/mini\_profiler/storage/file\_store.rb](#diff-bc043782e35769a33895e12c6ac1276fe119162754f8c0583eacb4e282c2c128 "lib/mini_profiler/storage/file_store.rb")

Show comments

[View file](/MiniProfiler/rack-mini-profiler/blob/4273771d65f1a7411e3ef5843329308d0e2d257c/lib/mini_profiler/storage/file_store.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,6 +51,9 @@ def initialize(args = nil) |
|  |  | @user\_view\_cache = FileCache.new(@path, "mp\_views") |
|  |  | @user\_view\_lock = Mutex.new |
|  |  |  |
|  |  | @auth\_token\_cache = FileCache.new(@path, "tokens") |
|  |  | @auth\_token\_lock = Mutex.new |
|  |  |  |
|  |  | me = self |
|  |  | t = CacheCleanupThread.new do |
|  |  | interval = 10 |
| Expand Down  Expand Up | | @@ -126,6 +129,28 @@ def get\_unviewed\_ids(user) |
|  |  | } |
|  |  | end |
|  |  |  |
|  |  | def flush\_tokens |
|  |  | @auth\_token\_lock.synchronize { |
|  |  | @auth\_token\_cache[""] = nil |
|  |  | } |
|  |  | end |
|  |  |  |
|  |  | def allowed\_tokens |
|  |  | @auth\_token\_lock.synchronize { |
|  |  | token1, token2, cycle\_at = @auth\_token\_cache[""] |
|  |  |  |
|  |  | unless cycle\_at && (Time === cycle\_at) && (cycle\_at > Time.now) |
|  |  | token2 = token1 |
|  |  | token1 = SecureRandom.hex |
|  |  | cycle\_at = Time.now + Rack::MiniProfiler::AbstractStore::MAX\_TOKEN\_AGE |
|  |  | end |
|  |  |  |
|  |  | @auth\_token\_cache[""] = [token1, token2, cycle\_at] |
|  |  |  |
|  |  | [token1, token2].compact |
|  |  | } |
|  |  | end |
|  |  |  |
|  |  | def cleanup\_cache |
|  |  | files = Dir.entries(@path) |
|  |  | @timer\_struct\_lock.synchronize { |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4273771`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMiniProfiler%2Frack-mini-profiler%2Fcommit%2F4273771d65f1a7411e3ef5843329308d0e2d257c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c27d6c25_20250125_210331.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMiniProfiler%2Frack-mini-profiler%2Fblob%2Fv0.10.1%2FCHANGELOG.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMiniProfiler%2Frack-mini-profiler%2Fblob%2Fv0.10.1%2FCHANGELOG.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=MiniProfiler%2Frack-mini-profiler)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MiniProfiler](/MiniProfiler)
/
**[rack-mini-profiler](/MiniProfiler/rack-mini-profiler)**
Public

* [Notifications](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler) You must be signed in to change notification settings
* [Fork
  406](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler)
* [Star
   3.8k](/login?return_to=%2FMiniProfiler%2Frack-mini-profiler)

* [Code](/MiniProfiler/rack-mini-profiler/tree/v0.10.1)
* [Issues
  40](/MiniProfiler/rack-mini-profiler/issues)
* [Pull requests
  12](/MiniProfiler/rack-mini-profiler/pulls)
* [Actions](/MiniProfiler/rack-mini-profiler/actions)
* [Projects
  0](/MiniProfiler/rack-mini-profiler/projects)
* [Wiki](/MiniProfiler/rack-mini-profiler/wiki)
* [Security](/MiniProfiler/rack-mini-profiler/security)
* [Insights](/MiniProfiler/rack-mini-profiler/pulse)

Additional navigation options

* [Code](/MiniProfiler/rack-mini-profiler/tree/v0.10.1)
* [Issues](/MiniProfiler/rack-mini-profiler/issues)
* [Pull requests](/MiniProfiler/rack-mini-profiler/pulls)
* [Actions](/MiniProfiler/rack-mini-profiler/actions)
* [Projects](/MiniProfiler/rack-mini-profiler/projects)
* [Wiki](/MiniProfiler/rack-mini-profiler/wiki)
* [Security](/MiniProfiler/rack-mini-profiler/security)
* [Insights](/MiniProfiler/rack-mini-profiler/pulse)

## Files

 v0.10.1
## Breadcrumbs

1. [rack-mini-profiler](/MiniProfiler/rack-mini-profiler/tree/v0.10.1)
/
# CHANGELOG.md

Copy path Blame  Blame
## Latest commit

## History

[History](/MiniProfiler/rack-mini-profiler/commits/v0.10.1/CHANGELOG.md)206 lines (159 loc) · 8.4 KB v0.10.1
## Breadcrumbs

1. [rack-mini-profiler](/MiniProfiler/rack-mini-profiler/tree/v0.10.1)
/
# CHANGELOG.md

Top
## File metadata and controls

* Preview
* Code
* Blame

206 lines (159 loc) · 8.4 KB[Raw](https://github.com/MiniProfiler/rack-mini-profiler/raw/refs/tags/v0.10.1/CHANGELOG.md)
# CHANGELOG

## 0.10.1 2016-05-18

* [FEATURE] push forward the security checks so no work is ever done if a valid production
  cookie is not available (@sam)

## 0.9.9.2 2016-03-06

* [FEATURE] on pageTransition collapse previously expanded timings

## 0.9.9.1 2016-03-06

* [FEATURE] expost MiniProfiler.pageTransition() for use by SPA web apps (@sam)

## 0.9.9 2016-03-06

* [FIX] removes alias\_method\_chain in favor of alias\_method until Ruby 1.9.3 (@ayfredlund)
* [FIX] Dont block mongo when already patched for another db (@rrooding @kbrock)
* [FIX] get\_profile\_script when running under passenger configured with RailsBaseURI (@nspring)
* [FEATURE] Add support for neo4j (@ProGM)
* [FIX] ArgumentError: comparison of String with 200 failed (@paweljw)
* [FEATURE] Add support for Riak (@janx)
* [PERF] GC profiler much faster (@dgynn)
* [FIX] If local storage is disabled don't bomb out (@elia)
* [FIX] Create tmp directory when actually using it (@kbrock)
* [ADDED] Default collapse\_results setting that collapses multiple timings on same page to a single one (@sam)
* [ADDED] Rack::MiniProfiler.profile\_singleton\_method (@kbrock)
* [CHANGE] Added Rack 2.0 support (and dropped support for Rack 1.1) (@dgynn)

## 0.9.8 - 2015-11-27 (Sam Saffron)

* [FEATURE] disable\_env\_dump config setting (@mathias)
* [FEATURE] set X-MiniProfiler-Ids for all 2XX reqs (@tymagu2)
* [FEATURE] add support for NoBrainer (rethinkdb) profiling (@niv)
* [FEATURE] add oracle enhanced adapter profiling (@rrooding)
* [FEATURE] pp=profile-memory can now parse query params (@dgynn)

## 0.9.7 - 2015-08-03 (Sam Saffron)

* [FEATURE] remove confusing pp=profile-gc-time (Nate Berkopec)
* [FEATURE] truncate strings in pp=analyze-memory (Nate Berkopec)
* [FEATURE] rename pp=profile-gc-ruby-head to pp=profile-memory (Nate Berkopec)

## 0.9.6 - 2015-07-08 (Sam Saffron)

* [FIX] incorrect truncation in pp=analyze-memory

## 0.9.5 - 2015-07-08 (Sam Saffron)

* [FEATURE] improve pp=analyze-memory

## 0.9.4 - 2015-07-08 (Sam Saffron)

* [UX] added a link to "more" actions in profiler
* [FEATURE] pp=help now displays links
* [FEATURE] simple memory report with pp=analyze-memory

## 0.9.2 - 2014-06-26 (Sam Saffron)

* [CHANGE] staging and other environments behave like production (Cedric Felizard)
* [DOC] CHANGELOG reorg (Olivier Lacan)
* [FIXED] Double calls to Rack::MiniProfilerRails.initialize! now raise an exception (Julik Tarkhanov)
* [FIXED] Add no-store header (George Mendoza)

## 0.9.1 - 2014-03-13 (Sam Saffron)

* [ADDED] Added back Ruby 1.8 support (thanks Malet)
* [IMPROVED] Amended Railstie so MiniProfiler can be launched with action view or action controller (Thanks Akira)
* [FIXED] Rails 3.0 support (thanks Zlatko)
* [FIXED] Possible XSS (admin only)
* [FIXED] Corrected Sql patching to avoid setting instance vars on nil which is frozen (thanks Andy, huoxito)

## 0.9.0.pre - 2013-12-12 (Sam Saffron)

* Bumped up version to reflect the stability of the project
* [IMPROVED] Reports for pp=profile-gc
* [IMPROVED] pp=flamegraph&flamegraph\_sample\_rate=1 , allow you to specify sampling rates

## 2013-09-17 (Ross Wilson)

* [IMPROVED] Instead of supressing all "/assets/" requests we now check the configured
  config.assets.prefix path since developers can rename the path to serve Asset Pipeline
  files from

## 2013-09-03

* [IMPROVED] Flamegraph now has much increased fidelity
* [REMOVED] Ripped out flamegraph so it can be isolated into a gem
* [REMOVED] Ripped out pp=sample it just was never really used

## 1.30 - 2013-08-30

* [ADDED] Rack::MiniProfiler.counter\_method(klass,name) for injecting counters
* [FIXED] Counters were not shifting the table correctly

## 1.29 - 2013-08-20

* [ADDED] Implemented exception tracing using TracePoint see pp=trace-exceptions
* [FIXED] SOLR patching had an incorrect monkey patch

## 1.28 - 2012-07-18

* [FIXED] Diagnostics in abstract storage was raising not implemented killing
  ?pp=env and others
* [FIXED] SOLR xml unescaped by mistake

## 1.27 - 2013-06-26

* [ADDED] Rack::MiniProfiler.config.backtrace\_threshold\_ms
* [ADDED] jQuery 2.0 support
* [FIXED] Disabled global ajax handlers on MP requests @JP

## 1.26 - 2013-04-11

* [IMPROVED] Allow Rack::MiniProfilerRails.initialize!(Rails.application), for post config intialization

## 1.25 - 2013-04-08

* [FIXED] Missed flamegraph.html from build

## 1.24 - 2013-04-08

* [ADDED] Flame Graph Support see: <http://samsaffron.com/archive/2013/03/19/flame-graphs-in-ruby-miniprofiler>
* [ADDED] New toggle\_shortcut and start\_hidden options
* [ADDED] Mongoid support
* [ADDED] Rack::MiniProfiler.counter counter\_name {}
* [ADDED] Net:HTTP profiling
* [ADDED] Ruby 1.8.7 support ... grrr
* [IMPROVED] More robust gc profiling
* [IMPROVED] Script tag initialized via data-attributes
* [IMPROVED] Allow usage of existing jQuery if its already loaded
* [IMPROVED] Pre-authorize to run in all non development? and production? modes
* [FIXED] AngularJS support and MooTools
* [FIXED] File retention leak in file\_store
* [FIXED] HTML5 implicit tags
* [FIXED] pp=enable

## 1.22 - 2012-09-20

* [FIXED] Permission issue in the gem

## 17-September-2012

* [IMPROVED] Allow rack-mini-profiler to be sourced from github
* [IMPROVED] Extracted the pp=profile-gc-time out, the object space profiler needs to disable gc

## 1.21 - 2012-09-17

* [ADDED] New MemchacedStore
* [ADDED] Rails 4 support

## 2012-09-12 (Sam Saffron)

* [ADDED] pp=profile-gc: allows you to profile the GC in Ruby 1.9.3

## 1.19 - 2012-09-10 (Sam Saffron)

* [FIXED] Compatibility issue with Ruby 1.8.7

## 1.17 - 2012-09-09 (Sam Saffron)

* [FIXED] pp=sample was bust unless stacktrace was installed

## 1.16 - 2012-09-05 (Sam Saffron)

* [IMPROVED] Implemented stacktrace properly
* [FIXED] Long standing problem specs (issue with memory store)
* [FIXED] Issue where profiler would be dumped when you got a 404 in production (and any time rails is bypassed)

## 1.15.pre - 2012-09-04 (Sam Saffron)

* [FIXED] Annoying bug where client settings were not sticking
* [FIXED] Long standing issue with Rack::ConditionalGet stopping MiniProfiler from working properly

## 1.13.pre - 2012-09-03 (Sam Saffron)

* [ADDED] Setting: config.backtrace\_ignores = [] - an array of regexes that match on caller lines that get ignored
* [ADDED] Setting: config.backtrace\_includes = [] - an array of regexes that get included in the trace by default
* [ADDED] pp=normal-backtrace to clear the "sticky" state
* [IMPROVED] Cleaned up the way client settings are stored
* [IMPROVED] Made pp=full-backtrace "sticky"
* [IMPROVED] Changed "pp=sample" to work with "caller" no need for stack trace gem
* [FIXED] pg gem prepared statements were not being logged correctly

## 1.12.pre - 2012-08-20 (Sam Saffron)

* [IMPROVED] Cap X-MiniProfiler-Ids at 10, otherwise the header can get killed

## 2012-08-10 (Sam Saffron)

* [ADDED] Basic prepared statement profiling for Postgres

## 2012-08-07 (Sam Saffron)

* [ADDED] Option to disable profiler for the current session (pp=disable / pp=enable)
* [ADDED] yajl compatability contributed by Sven Riedel

## 0.1.9 - 2012-07-30 (Sam Saffron)

* [IMPROVED] Made compliant with ancient versions of Rack (including Rack used by Rails2)
* [FIXED] Broken share link
* [FIXED] Crashes on startup (in MemoryStore and FileStore)
* [FIXED] Unicode issue

## 0.1.7 - 2012-07-18 (Sam Saffron)

* [ADDED] First Paint time for Google Chrome
* [FIXED] Ensure non Rails installs have mini profiler

## 2012-07-12 (Sam Saffron)

* [ADDED] Native PG and MySql2 interceptors, this gives way more accurate times
* [ADDED] some more client probing built in to rails
* [IMPROVED] Refactored context so its a proper class and not a hash
* [IMPROVED] More tests
* [FIXED] Incorrect profiling steps (was not indenting or measuring start time right

## 0.1.3 - 2012-07-09 (Sam Saffron)

* [ADDED] New option to display full backtraces pp=full-backtrace
* [IMPROVED] Cleaned up mechanism for profiling in production, all you need to do now
  is call Rack::MiniProfiler.authorize\_request to get profiling working in
  production
* [IMPROVED] Cleaned up railties, got rid of the post authorize callback

## 2012-06-28 (Sam Saffron)

* [ADDED] Started change log
* [ADDED] added MemcacheStore
* [IMPROVED] Corrected profiler so it properly captures POST requests (was supressing non 200s)
* [IMPROVED] Amended Rack.MiniProfiler.config[:user\_provider] to use ip addres for identity
* [IMPROVED] Supress all '/assets/' in the rails tie (makes debugging easier)
* [FIXED] Issue where unviewed missing ids never got cleared
* [FIXED] record\_sql was mega buggy

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from rubygems.org_8d2a4c75_20250126_115635.html ===


[⬢
RubyGems](/ "RubyGems") Navigation menu

Search Gems…

[Releases](https://rubygems.org/releases)
[Blog](https://blog.rubygems.org)
[Gems](/gems)
[Guides](https://guides.rubygems.org)
[Sign in](/sign_in)
[Sign up](/sign_up)

# [rack-mini-profiler](/gems/rack-mini-profiler) *3.3.1*

Profiling toolkit for Rack applications with Rails integration. Client Side profiling, DB profiling and Server profiling.

## Gemfile: =

## install: =

### Versions:

1. [3.3.1](/gems/rack-mini-profiler/versions/3.3.1)
   February 14, 2024
   (409 KB)
2. [3.3.0](/gems/rack-mini-profiler/versions/3.3.0)
   December 07, 2023
   (408 KB)
3. [3.2.1](/gems/rack-mini-profiler/versions/3.2.1)
   December 07, 2023
   (408 KB)
4. [3.2.0](/gems/rack-mini-profiler/versions/3.2.0)
   December 06, 2023
   (408 KB)
5. [3.1.1](/gems/rack-mini-profiler/versions/3.1.1)
   August 01, 2023
   (403 KB)

[Show all versions (82 total)](https://rubygems.org/gems/rack-mini-profiler/versions)

### Runtime Dependencies (1):

[**rack**](/gems/rack)
>= 1.2.0

### Development Dependencies (16):

[**dalli**](/gems/dalli)
>= 0

[**listen**](/gems/listen)
>= 0

[**mini\_racer**](/gems/mini_racer)
>= 0

[**nokogiri**](/gems/nokogiri)
>= 0

[**rack-test**](/gems/rack-test)
>= 0

[**rails**](/gems/rails)
~> 6.0

[**rake**](/gems/rake)
>= 0

[**redis**](/gems/redis)
>= 0

[**rspec**](/gems/rspec)
~> 3.12.0

[**rubocop**](/gems/rubocop)
>= 0

[**rubocop-discourse**](/gems/rubocop-discourse)
>= 0

[**rubyzip**](/gems/rubyzip)
>= 0

[**sassc**](/gems/sassc)
>= 0

[**stackprof**](/gems/stackprof)
>= 0

[**webmock**](/gems/webmock)
= 3.9.1

[**webpacker**](/gems/webpacker)
>= 0

[Show all transitive dependencies](/gems/rack-mini-profiler/versions/3.3.1/dependencies)

### Owners:

[![](/users/3424/avatar.jpeg?size=48&theme=light)](/profiles/samsaffron "samsaffron")[![](/users/62792/avatar.jpeg?size=48&theme=light)](/profiles/nateberkopec "nateberkopec")[![](/users/143660/avatar.jpeg?size=48&theme=light)](/profiles/discourse-rubygems "discourse-rubygems")
### Pushed by:

[![](/users/3424/avatar.jpeg?size=48&theme=light)](/profiles/samsaffron "samsaffron")
### Authors:

* Sam Saffron, Robin Ward, Aleks Totic

### SHA 256 checksum:

=

[← Previous version](/gems/rack-mini-profiler/versions/3.3.0)

## Total downloads 61,391,683

## For this version 3,681,798

## Version Released: February 14, 2024 10:44pm

## License: MIT

## Required Ruby Version: *>= 2.7.0*

### Links:

[Homepage](https://miniprofiler.com)
[Changelog](https://github.com/MiniProfiler/rack-mini-profiler/blob/master/CHANGELOG.md)
[Source Code](https://github.com/MiniProfiler/rack-mini-profiler)
[Download](/downloads/rack-mini-profiler-3.3.1.gem)
[Review changes](https://my.diffend.io/gems/rack-mini-profiler/prev/3.3.1)
[Badge](https://badge.fury.io/rb/rack-mini-profiler/install)
[Subscribe](/sign_in)
[RSS](/gems/rack-mini-profiler/versions.atom)
Report abuse
[Reverse dependencies](/gems/rack-mini-profiler/reverse_dependencies)

[Status](https://status.rubygems.org)
[Uptime](https://uptime.rubygems.org)
[Code](https://github.com/rubygems/rubygems.org)
[Data](/pages/data)
[Discuss](https://groups.google.com/group/rubygems-org)
[Stats](/stats)
[Contribute](https://guides.rubygems.org/contributing/)
[About](/pages/about)
Help
[API](https://guides.rubygems.org/rubygems-org-api)
[Security](/pages/security)

RubyGems.org is the Ruby community’s gem hosting service. Instantly [publish your gems](https://guides.rubygems.org/publishing/) and then [install them](https://guides.rubygems.org/command-reference/#gem-install). Use [the API](https://guides.rubygems.org/rubygems-org-api/) to find out more about [available gems](/gems). [Become a contributor](https://guides.rubygems.org/contributing/) and improve the site yourself.

RubyGems.org is made possible through a partnership with the greater Ruby community. [Fastly](https://www.fastly.com/) provides bandwidth and CDN support, [Ruby Central](https://www.rubycentral.org/) covers infrastructure costs, and funds ongoing development and ops work. [Learn more about our sponsors and how they work together](/pages/sponsors).

We need your help to fund the developer time that keeps RubyGems.org running smoothly for everyone. [Join Ruby Central today](https://rubycentral.org/#/portal/signup).

[Supported by
Ruby Central](https://rubycentral.org/)
[Designed by
DockYard](https://dockyard.com/ruby-on-rails-consulting)
[Resolved with
DNSimple](https://dnsimple.link/resolving-rubygems)
[Monitored by
Datadog](https://www.datadoghq.com/)
[Gems served by
Fastly](https://www.fastly.com/)
[Monitored by
Honeybadger](https://www.honeybadger.io/)
[Verified by
Domainr](https://domainr.com/)
[Secured by
Whitesource](https://mend.io/)

[English](/gems/rack-mini-profiler?locale=en)

[Nederlands](/gems/rack-mini-profiler?locale=nl)

[简体中文](/gems/rack-mini-profiler?locale=zh-CN)

[正體中文](/gems/rack-mini-profiler?locale=zh-TW)

[Português do Brasil](/gems/rack-mini-profiler?locale=pt-BR)

[Français](/gems/rack-mini-profiler?locale=fr)

[Español](/gems/rack-mini-profiler?locale=es)

[Deutsch](/gems/rack-mini-profiler?locale=de)

[日本語](/gems/rack-mini-profiler?locale=ja)


