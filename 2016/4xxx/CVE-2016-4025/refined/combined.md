=== Content from labs.nettitude.com_3d33ab55_20250124_235429.html ===


[Skip content](#content)

Global (English)

* [About us](/en/who-we-are/)
* [Client login](/en/client-portal/)
* [⚠️ Report a Cyber Incident](/en/emergency-incident-response-services/)
* [Contact us](/en/contact-us/)

[Logo](/en/)

Menu

Close

* Assurance 4.0

  + Back
  + [Assurance 4.0](/en/who-we-are/assurance-4/)
  + [Assure Assets and Management Systems](/en/assure-assets-and-management-systems/)
  + [Achieve Product Integrity](/en/achieve-product-integrity/)
  + [Source Responsibly](/en/source-responsibly/)
  + [Navigate the Energy Transition and Achieve Net Zero](/en/navigate-the-energy-transition-and-achieve-net-zero/)
  + [Strengthen Cyber Security Maturity](/en/strengthen-cybersecurity-maturity/)
* Sectors

  + Back
  + [Sectors](/en/sectors/)
  + [Food and Beverage](/en/food-beverage-hospitality/)
  + [Financial and Professional Services](/en/financial-and-professional-services/)
  + [Energy and Renewables](/en/energy-renewables/)
  + [Transportation and Mobility](/en/transport-logistics/)
  + [Technology and Telecommunications](/en/ict-telecoms/)
  + [Consumer Goods and Retail](/en/consumer-goods-and-retail/)
  + [Construction and Engineering](/en/construction-industry/)
  + [Healthcare and Medical](/en/healthcare-medical/)
  + [Can't see your sector?](/en/contact-us/)
* Services

  + Back
  + [Services](/en/services/)
  + Assessment and Certification

    - Back
    - [Assessment and Certification](/en/assessment-certification/)
    - [Transfer your Certification to LRQA](/en/transfer-certification-to-lrqa/)
    - Quality, Environment, Health and Safety

      * Back
      * [Quality, Environment, Health and Safety](/en/quality-health-and-safety-and-environmental/)
      * [ISO 9001 Certification](/en/iso-9001/)
      * [ISO 14001 Certification](/en/iso-14001/)
      * [ISO 45001 Certification](/en/iso-45001/)
    - Food and Beverage

      * Back
      * [Food and Beverage](/en/food-beverage-hospitality/)
      * [FSSC 22000 Certification](/en/fssc-22000/)
      * [BRCGS Certification](/en/brcgs-food-safety/)
      * [2nd Party Audits](/en/2nd-party-audit-programmes/)
      * [ISO 22000 Certification](/en/iso-22000/)
      * [IFS Certification](/en/ifs/)
      * [SQF Certification](/en/sqf-certification/)
      * [HACCP Certification](/en/haccp/)
      * [Food Labelling](/en/food-labelling-regulation-advisory-services/)
      * [GSA BAP Certification](/en/gsa-bap/)
      * [MSC Certification](/en/msc/)
      * [ASC Certification](/en/asc/)
    - Sustainability and Responsible Sourcing

      * Back
      * [Sustainability and Responsible Sourcing](/en/climate-change-sustainability/)
      * [ISO 14064 Certification](/en/iso-14064/)
      * [ISO 50001 Certification](/en/iso-50001/)
      * [ISO 46001 Certification](/en/iso-46001/)
      * [Sedex Members Ethical Trade Audit (SMETA)](/en/smeta/)
      * [Amfori BSCI](/en/amfori-bsci-business-social-compliance-initiative/)
      * [Farm First](/en/farm-first-assurance-scheme/)
      * [ERSA](/en/ersa-responsible-sourcing-assessment/)
      * [Social and Labour Convergence Programme (SLCP)](/en/social-labour-convergence-program-slcp/)
      * [Initiative for Compliance and Sustainability (ICS)](/en/initiative-for-compliance-and-sustainability/)
      * [Responsible Business Alliance - Validated Assessment Program (RBA-VAP)](/en/rba-vap-validated-assessment-program/)
      * [Worldwide Responsible Accredited Production (WRAP)](/en/worldwide-responsible-accredited-production/)
      * [EU ETS](/en/eu-ets/)
      * [Responsible Plastic Management](/en/responsible-plastic-management/)
    - Information Security Management

      * Back
      * [Information Security Management](/en/information-security-management/)
      * [ISO 27001 Certification](/en/iso-27001/)
      * [ISO 27701 Certification](/en/iso-27701/)
      * [ISO 20000-1 Certification](/en/iso-20000/)
      * [ISO 22301 Certification](/en/iso-22301/)
      * [CSA STAR Certification](/en/csa-star/)
      * [ISO 42001 Certification](/en/iso-42001-ai-management-system-certification/)
    - Automotive and Aerospace

      * Back
      * [Automotive and Aerospace](/en/automotive-aerospace/)
      * [IATF 16949 Certification](/en/iatf-16949/)
      * [AS 9100 Certification](/en/as9100/)
    - [Medical - ISO 13485 Certification](/en/iso-13485/)
    - [Oil and Gas - ISO 29001 Certification](/en/iso-29001/)
    - [Client-Specific Programmes](/en/client-specific-programmes/)
    - [LRQA Worker Surveys](/en/lrqa-worker-surveys/)
  + Inspection Services

    - Back
    - [Inspection Services](/en/inspection-services/)
    - Product, System and Process Certification

      * Back
      * [Product, System and Process Certification](/en/codes-standards-regulations/)
      * [ASME](/en/asme-code-services/)
      * [Pressure Equipment Directive (PED)](/en/pressure-equipment-directive/)
      * [National Approvals](/en/product-certification/national-approvals/)
      * [EU Directives](/en/product-certification/ce-marking-and-eu-directives/)
    - Welding and Material Services

      * Back
      * [Welding and Material Services](/en/materials-and-welding/)
      * [EN 10204 Type 3.2](/en/materials-and-welding/en-10204-type-3-2-certification-services/)
      * [ISO 3834 Certification](/en/materials-and-welding/iso-3834/)
      * [Welding Procedure and Welder Operator Qualification](/en/materials-and-welding/welding-operator-qualification/)
    - [Container Certification](/en/containers/)
    - [Type Approval](/en/product-certification/type-approval/)
    - [Utilities Schemes](/en/utilities/)
    - Construction Scheme

      * Back
      * [Construction Scheme](/en/construction-industry/)
      * [BIM and ISO 19650](/en/construction-industry/building-information-modelling-bim/)
      * [BOPAS](/en/construction-industry/buildoffsite-property-assurance-scheme-bopas/)
      * [Construction Products Regulation (CPR)](/en/construction-products-regulation/)
    - Energy Transition Services

      * Back
      * [Energy Transition Services](/en/energy-transition-services/)
      * [Hydrogen Projects](/en/hydrogen-net-zero-manufacturing/)
      * [Nuclear Projects](/en/nuclear-supply-chain-inspection/)
      * [Solar Projects](/en/solar-projects-assurance/)
      * [Wind Projects](/en/wind-projects-assurance/)
    - Technical Advisory

      * Back
      * Technical Advisory
      * [Additive Manufacturing](/en/additive-manufacturing/)
      * [Other Technical Advisory Services](/en/technical-advisory-services/)
    - Supply Chain and Vendor Inspection

      * Back
      * [Supply Chain and Vendor Inspection](/en/supply-chain-inspection/)
      * [Cranes and Lifting Equipment](/en/manufacturing-industry/cranes-lifting-equipment/)
    - [Remote Inspection](/en/remote-inspection/)
  + Cyber Security Services

    - Back
    - [Cyber Security Services](/en/cyber-security-services/)
    - [⚠️ Report a Cyber Incident](/en/emergency-incident-response-services/)
    - Cyber Advisory

      * Back
      * [Cyber Advisory](/en/cyber-security-advisory-services/)
      * [Threat Intelligence Services](/en/threat-intelligence-services/)
      * [Virtual CISO Services](/en/virtual-ciso/)
      * [ThreatWatcher](/en/threatwatcher/)
      * [Threat Modelling](/en/threat-modelling/)
      * [Regulatory Compliance Testing](/en/regulatory-compliance-testing/)
      * [Red Teaming](/en/red-teaming/)
      * [Purple Teaming](/en/purple-teaming/)
      * [Cyber Security Maturity Assessment](/en/cyber-security-maturity-assessment/)
      * [Merger and Aquisitions Due Diligence](/en/mergers-and-acquisition-due-diligence/)
      * [Offensive Cyber Security Training](/en/offensive-cyber-security-training/)
    - Governance, Risk and Compliance

      * Back
      * [Governance, Risk and Compliance](/en/governance-risk-compliance-services/)
      * [PCI DSS Consultancy and Assessments](/en/pci-dss-assessments/)
      * [Security Awareness Training](/en/security-awareness-training/)
      * [DORA Compliance](/en/dora-compliance/)
      * [ISO 27001 Certification](/en/iso-27001/)
      * [NIST Cyber Security Framework](/en/nist-cyber-security-framework/)
      * [NCSC 10 Steps to Cyber Security](/en/ncsc-ten-steps-to-cyber-security-assessment/)
      * [CAA ASSURE Cyber Audit](/en/caa-assure-cyber-audit/)
      * [Vendor Security Review](/en/vendor-security-review/)
      * [Policies Procedures Creation and Review](/en/policies-procedures-creation-review/)
      * [Cyber Essentials Certification](/en/cyber-essentials-certification/)
      * [Cyber Security Risk Assessment](/en/cyber-security-risk-assessment/)
      * [Cloud Security and Privacy](/en/information-security-management/)
      * [CMMC Compliance](/en/cmmc-compliance/)
    - Managed Cyber Security Services

      * Back
      * [Managed Cyber Security Services](/en/managed-security-services/)
      * [SOC-as-a-Service (SOCaaS)](/en/soc-as-a-service/)
      * [Network Detection and Response (NDR)](/en/network-detection-and-response/)
      * [Extended Detection and Response (XDR)](/en/extended-detection-and-response/)
      * [Managed Detection and Response (MDR)](/en/managed-detection-and-response/)
      * [Security Information and Event Management (SIEM)](/en/security-information-and-event-management-siem-services/)
      * [Endpoint Detection and Response (EDR)](/en/endpoint-detection-and-response/)
      * [Virtual CISO Services](/en/virtual-ciso/)
      * [Digital Forensics and Incident Response](/en/digital-forensics-and-incident-response/)
      * [Vulnerability Scanning](/en/managed-vulnerability-scanning/)
    - Incident Response

      * Back
      * [Incident Response](/en/incident-response-services/)
      * [Digital Forensics and Incident Response](/en/digital-forensics-and-incident-response/)
      * [Emergency Incident Response](/en/emergency-incident-response-services/)
    - Cyber Security Testing

      * Back
      * [Cyber Security Testing](/en/cyber-security-testing/)
      * [Penetration Testing Services](/en/penetration-testing/)
      * [Web Application Penetration Testing](/en/web-application-penetration-testing/)
      * [Mobile Application Penetration Testing](/en/mobile-application-penetration-testing/)
      * [Cloud Penetration Testing](/en/cloud-penetration-testing/)
      * [Continuous Assurance](/en/continuous-assurance/)
      * [Red Teaming](/en/red-teaming/)
      * [Purple Teaming](/en/purple-teaming/)
      * [Social Engineering](/en/social-engineering/)
      * [Bug Bounty Program](/en/bug-bounty-program/)
    - Cyber Insurance Services

      * Back
      * Cyber Insurance Services
      * [Cyber Insurance Partner](/en/cyber-insurance-service-partner/)
      * [Cyber Insurance](/en/cyber-insurance-services/)
  + Verification and Report Assurance

    - Back
    - [Verification and Report Assurance](/en/assurance-services/)
    - [CSRD](/en/csrd/)
    - [Organisational GHG and Carbon Verification](/en/organisational-ghg-carbon-verification/)
    - [Environmental and Social Verification](/en/environmental-social-verification/)
    - [Product Carbon Footprinting](/en/product-carbon-footprinting/)
    - [Carbon Neutrality](/en/carbon-neutrality/)
    - [Regulatory Emission Schemes](/en/regulatory-emission-schemes/)
    - [Sector Carbon Standards](/en/sector-carbon-standards/)
  + Training

    - Back
    - Training
    - All Training Courses

      * Back
      * [All Training Courses](/en/training/overview/)
      * [Quality, Environment, Health and Safety Training](/en/training/quality-environmental-health-and-safety/)
      * [Food, Beverage and Hospitality Training](/en/training/food-beverage-hospitality/)
      * [Medical Devices Training](/en/training/medical-devices/)
      * [Cybersecurity and Information Security Training](/en/training/infosecurity-cyber/)
      * [Climate Change and Sustainability Training](/en/training/climate-change-sustainability/)
      * [Automotive, Aerospace and Transport Training](/en/training/automotive-aerospace/)
      * [Manufacturing Codes and Standards Training](/en/training/manufacturing/)
    - Online Training

      * Back
      * [Online Training](/en/training/virtual-classroom-online-courses/)
      * [Virtual Classroom Courses](/en/training/virtual-classroom-courses/)
      * [eLearning](/en/training/elearning-courses/)
      * [Blended Training](/en/training/blended/)
    - [LRQA Training Academy](/en/training-academy/)
    - [Management System Solutions](/en/management-system-solutions/)
    - [Training Portal](https://training-portal.lrqa.com/lmt/clmsbrowsev2.prmain?site=lrqaext&in_lang=en&in_region=gl)
  + Advisory Services

    - Back
    - [Advisory Services](/en/advisory-services/)
    - [ESG Advisory](/en/esg-advisory/)
    - [CSDDD](/en/csddd/)
    - [CSRD](/en/csrd/)
    - Diagnostics

      * Back
      * [Diagnostics](/en/diagnostics/)
      * [Responsible Sourcing](/en/responsible-sourcing-in-supply-chains/)
      * [Human Rights Impact Assessment (HRIA)](/en/human-rights-impact-assessment/)
      * [Net Zero](/en/net-zero-climate-risk-service/)
      * [Double Materiality](/en/double-materiality-assessment/)
    - Strategy and Design

      * Back
      * [Strategy and Design](/en/strategy-and-design/)
      * [Supply Chain Risk Assessment and Segmentation](/en/supply-chain-risk-assessment-segmentation-service/)
      * [Carbon Footprint and Decarbonisation Strategy](/en/corporate-decarbonisation-strategy/)
      * [Safety Culture Ladder](/en/safety-culture-ladder/)
    - Implementation

      * Back
      * [Implementation](/en/implementation/)
      * [Grievance Mechanism](/en/grievance-mechanism/)
      * [GHG Inventory](/en/ghg-inventory-service/)
      * [Waste and Emissions Supply Chain Engagement](/en/waste-and-emissions-supply-chain-engagement/)
    - Reporting and Disclosure

      * Back
      * [Reporting and Disclosure](/en/reporting-and-disclosure/)
      * [Climate Disclosure](/en/climate-disclosure-service/)
      * [Sustainability Disclosure](/en/sustainability-disclosure/)
    - [Programme Management](/en/programme-management/)
    - [Technical Advisory](/en/technical-advisory-services/)
    - Training

      * Back
      * Training
      * [All Training Courses](/en/training/overview/)
      * [Online Training](/en/training/virtual-classroom-online-courses/)
      * [Management System Solutions](/en/management-system-solutions/)
      * [Training Portal](https://training-portal.lrqa.com/lmt/clmsbrowsev2.prmain?site=lrqaext&in_lang=en&in_region=gl)
    - [Management System Solutions](/en/management-system-solutions/)
    - [LRQA Worker Surveys](/en/lrqa-worker-surveys/)
  + Data and Analytics

    - Back
    - Data and Analytics
    - [LRQA's EiQ Platform](https://www.eiq.ai/)
    - [EiQ Lite](/en/eiq-lite/)
  + [Can't find the service you need?](/en/contact-us/)
* News and Insights

  + Back
  + News and Insights
  + [Latest News](/en/latest-news/)
  + [Thought Leadership Articles](/en/insights/articles/)
  + [Cyber Labs](/en/cyber-labs/)
  + [Case Studies](/en/case-studies/)
  + [Podcasts](/en/podcasts/)
  + [Downloadable Resources](/en/resources/)
  + [Legislation Map](/en/supply-chain-due-diligence-legislation-map/)
  + [Client Information Notes (CINs)](/en/resources/client-information-note/)
  + [Accreditations](/en/who-we-are/our-management-systems-accreditations/)
  + [Hall of fame](/nl-nl/case-studies/hall-of-fame/)
  + [Awards and Recognition](/en/who-we-are/awards-and-recognition/)
* [Events and Webinars](/en/events/)
* Careers

  + Back
  + [Careers](/en/careers/)
  + [What it's like to work here](/en/why-lrqa/)
  + [From application to onboarding](/en/career-faqs/)
  + Talent Community

    - Back
    - [Talent Community](/en/opportunities/)
    - [Assessment roles](/en/opportunities/assessment-roles/)
    - [Inspection Service roles](/en/opportunities/inspection-service-roles/)
    - [Cybersecurity roles](/en/opportunities/cybersecurity-roles/)
    - [Advisory and ESG roles](/en/opportunities/advisory-and-esg-roles/)
    - [Sales and Business Development roles](/en/opportunities/sales-roles/)
    - [Contractor roles](/en/opportunities/contractor-roles/)
    - [Corporate Function roles](/en/opportunities/corporate-function-roles/)
  + Apply now

    - Back
    - Apply now
    - [Advisory and ESG roles](https://elevatelimited.bamboohr.com/careers)
    - [All other roles](https://jobs.lrqa.com/)
* [About us](/en/who-we-are/)
* [Client login](/en/client-portal/)
* [⚠️ Report a Cyber Incident](/en/emergency-incident-response-services/)

Search

Close

Search form
Search open

Search

Are you looking for?

* [Events](/en/events/)
* [News](/en/latest-news/)
* [Case studies](/en/case-studies/)
* [Resource library](/en/resources/)
* [Client Portal](/en/client-portal/)
* [Client Information Notes](/en/resources/client-information-note/)

You are here:

1. [Home](/en/)
2. [Cyber Labs

   Back to previous page](/en/cyber-labs/)
3. **Escaping the Avast sandbox**

![](/static/assets/search-grey.svg)
![LRQA Cyber Labs](/cdn-cgi/image/width=1024,format=auto/globalassets/cyber-labs/lrqa-cyber-labs.jpg)

# Escaping the Avast sandbox

Kyriakos Economou

Senior R&D team member at Nettitude.

19 Apr 2016

An Avast Sandbox escape, CVE-2016-4025, is possible due to a design flaw in the Avast DeepScreen feature.  It is likely that this flaw will remain in supported Avast products for some time.

Breaking static AV detection signatures is quite trivial. The AV industry has started to understand that they cannot rely on this anymore nor on simple heuristics on known behavioural patterns, for example based on a certain logic of execution paths and function calls.
The next big thing in malware detection, from the AV point of view, is sandboxing an unknown sample and analysing it inside a fully controlled environment while monitoring its behaviour in a more generic way.
In addition, providing extra sandboxing capabilities that allow the user to execute untrusted applications in a safer way, and/or mitigate in common scenarios the impact of an exploit against a trusted one, such as a web browser, is something that can be very valuable. There is still a lot of work to do in this area, but this is the future for preventing 0-day malware infections.
In this article we will focus on a design flaw in the AVAST Sandbox/DeepScreen features, and the impact that this can have over the extra security layers that these features attempt to provide.
As a side note, after doing some research regarding this flaw, I discovered a few videos online named as “AVAST Sandbox Bypass”, which are not related with escaping from a fully sandboxed process. These videos just demonstrate that AVAST products do not always trigger the DeepScreen scan feature, and not how to escape from the sandbox while the process is already running inside it.
**The Avast Sandbox**
Avast is one of the first AV vendors that incorporated their own Sandbox in an AV product. This is not to be confused with other sandboxing techniques implemented at a userland level, for example by web browsers such as IE. These are usually implemented by lowering the integrity level of a process and/or by removing certain resource access related privileges from it.
The Avast Sandbox implementation is based on a kernel mode file system driver called “Avast Virtualization Driver” (aswSnx.sys) which is responsible for isolating a specific process from the rest of the system. In other words, it blocks a sandboxed process from interacting (code/remote thread injection) with other processes that run outside of the sandbox, as well as dropping new files and/or modifying existing ones.

[![Sandboxed Application](/globalassets/cyber-labs/escaping-avast-sandbox-using-single-ioctl-cve-2016-4025/sandboxed-application.png?epslanguage=en)](https://i0.wp.com/labs.nettitude.com/wp-content/uploads/2016/07/Sandboxed-Application.png?ssl=1)

Figure 1: Sandboxed Application

**[Avast’s Position](https://blog.avast.com/2015/09/09/what-does-the-avast-sandbox-do/)**
“The Avast Sandbox lets you run a questionable program without risking your computer.”
“The Avast Sandbox is a special security feature which allows you to run potentially suspicious applications automatically in a completely isolated environment.”
“…programs running within the sandbox have limited access to your files and system, so there is no risk to your computer or any of your other files.”
“The advantage of running an application in the Sandbox is that it allows you to check suspicious applications while remaining completely protected against any malicious actions that an infected application might try to perform”
**Avast ‘DeepScreen’ Scan**
This is actually a very nice feature of Avast AV products which attempts to raise the bar in terms of behavioural analysis of unknown executables. It takes advantage of the built-in sandbox to monitor the behaviour of an executable for 15 seconds the first time it runs.
During that time period the process runs inside the sandbox and if nothing suspicious is being detected by then end of it, the Avast will automatically restart the process which in the future will always run out of the sandbox.
That is of course, unless the user intentionally instructs the Avast software to run a specific executable in the sandbox next time it is executed or always.

[![DeepScreen Scan](/globalassets/cyber-labs/escaping-avast-sandbox-using-single-ioctl-cve-2016-4025/deepscreen-scan.png?epslanguage=en)](https://i0.wp.com/labs.nettitude.com/wp-content/uploads/2016/07/DeepScreen-Scan.png?ssl=1)

Figure 2: DeepScreen Scan

**[Avast’s Position](https://blog.avast.com/topic/DeepScreen)**
“When a file is “DeepScreened,” it is actually run in the Sandbox, which is mainly responsible for keeping things isolated while watching for various high-level events and behaviour of the program running.”
**Playing with Avast Sandbox…**
We started examining the security of the sandbox by trying to find a way to drop new files or modify existing ones through a sandboxed process, as well as try to execute code in the address space of another.
At first, we tried the most obvious actions which were only involving direct calls to Windows functions such as [CreateFile](https://msdn.microsoft.com/en-us/library/windows/desktop/aa363858%28v%3Dvs.85%29.aspx) and [OpenProcess](https://msdn.microsoft.com/en-us/library/windows/desktop/ms684320%28v%3Dvs.85%29.aspx). These attempts were successfully blocked by the sandbox, so we had to keep looking.
At this stage we started looking at the flexibility related capabilities of the sandbox, or in other words what happens if a user wants to save a file generated by a sandboxed process.
We started a sandboxed instance of notepad.exe, typed a few letters and then used the ‘Save As’ dialogue box to permanently save the text file on the hard drive. This attempt was successful, but then we were also going through a quite legitimate route. So, just to ensure that there isn’t some sort of white-listing we tried to directly save a file from a sandboxed instance of notepad. We manually injected some code that was invoking a direct call to *CreateFile* in the address space of that process which was successfully blocked as well.
At this stage, there were a couple of questions that we had to answer.
1. How does the ‘Save as’ functionality succeed in saving a file out of the sandbox?
2. How secure is this?
**Finding our way out…**
From the previous observations, we made a fair assumption that there must be an interaction with the kernel mode driver and from the title of this article you know where this is going.
Indeed, by using ‘API Monitor’ in order to look for calls to [DeviceIoControl](https://msdn.microsoft.com/en-us/library/windows/desktop/aa363216%28v%3Dvs.85%29.aspx) and CreateFile functions we discovered something very interesting happening when the ‘Save As’ dialogue was used.

[![Figure 3 API Monitor Calling DeviceIoControl](/globalassets/cyber-labs/escaping-avast-sandbox-using-single-ioctl-cve-2016-4025/figure-3-api-monitor-calling-deviceiocontrol.jpg?epslanguage=en)](https://i0.wp.com/labs.nettitude.com/wp-content/uploads/2016/07/Figure-3-API-Monitor-Calling-DeviceIoControl.jpg?ssl=1)

Figure 3: API Monitor – Calling DeviceIoControl

As you can see in the figure above, there is a combination of calls to *DeviceIoControl* and *CreateFile* functions. The interesting call that involves the interaction with the virtualization driver occurs through a proprietary module of Avast (*snxhk.dll*) which is loaded by the sandboxed notepad process.
Let’s have a more detailed look at this:

* *DeviceIoControl*
  + *Calling Module: snxhk.dll*
  + *Device: .aswsnx*
  + *Driver: aswSnx.sys [avast! Virtualization Driver]*
  + *IOCTL: 0x82AC0168*
  + InputBuffer\_Size:0x80C
  + OutputBuffer: Not Required

[![Figure 4: Calling DeviceIoControl](/globalassets/cyber-labs/escaping-avast-sandbox-using-single-ioctl-cve-2016-4025/figure-4-calling-deviceiocontrol.jpg?epslanguage=en)](https://i0.wp.com/labs.nettitude.com/wp-content/uploads/2016/07/Figure-4-Calling-DeviceIoControl.jpg?ssl=1)

Figure 4: Calling DeviceIoControl

At this point, it is important to mention that Figures 3 and 4 were created while analysing version 10.x of Avast Windows home user products. Later, in versions 11.x we noticed that there is an attempt to hide the existence of the *snxhk.dll* module which doesn’t appear any more in the list of loaded modules. This causes *‘API Monitor’* to miss those calls and gives some food for thought for other things as well.
This, however, is not really a problem since it doesn’t change the fact that the call to *DeviceIoControl* needs to be performed which then makes it trivial to find the module in the address space of the examined process as shown in following figure.

[![Figure 5 Locating snxhk.dll module in versions 11.x](/globalassets/cyber-labs/escaping-avast-sandbox-using-single-ioctl-cve-2016-4025/figure-5-locating-snxhk.dll-module-in-versions-11.x.jpg?epslanguage=en)](https://i0.wp.com/labs.nettitude.com/wp-content/uploads/2016/07/Figure-5-Locating-snxhk.dll-module-in-versions-11.x.jpg?ssl=1)

Figure 5: Locating snxhk.dll module in versions 11.x

That’s all we need to know in order to escape from a fully sandboxed process either this has been temporarily or permanently sandboxed by the user or during the 15 seconds time interval that the *‘DeepScreen’* scan offers.
Indeed, there is no further validation by the virtualization driver nor is the user going to be asked for his own permission to release a file out of the sandbox. Furthermore, using the aforementioned IOCTL we can also freely modify or let’s say infect or encrypt, in the case of a ransomware attack, any existing file that the user has read/write access permissions to this. All of that from the comfort and security confidence that the Avast sandbox claims to provide.
Keep in mind that for different versions of these products small modifications might be required in the parameters passed to the *DeviceIoControl* function, but these are trivial to figure out.
**Security vs Usability: 0 – 1**
We reported this issue to Avast at the beginning of November 2015 as soon as we discovered that it basically renders their most important security feature of all their Windows products basically useless.
This is clearly a very serious flaw, but according to them *“it’s quite hard to find the balance between security and usability”* and for that reason it didn’t qualify for a reward under their bug bounty scheme.
This vulnerability is still present as more than 4 months later their attempts to remediate this were insufficient . Recently, Avast claimed that they mitigated that issue during the *‘DeepScreen’* scan. However, Avast’s solution was not to allow the user to click on the *‘Save As’* dialogue of an application during those 15 seconds, but this doesn’t stop the application from using the *DeviceIoControl* function at will, just as we demonstrated. In other words, the attack surface remains the same.
**Products Affected**

* Home User Products
  + Avast Internet Security v11.x.x
  + Avast Pro Antivirus v11.x.x
  + Avast Premier v11.x.x
  + Avast Free Antivirus v11.x.x

* Avast For Business
  + Avast Business Security v11.x.x
  + Avast Endpoint Protection v8.x.x
  + Avast Endpoint Protection Plus v8.x.x
  + Avast Endpoint Protection Suite v8.x.x
  + Avast Endpoint Protection Suite Plus v8.x.x
  + Avast File Server Security v8.x.x
  + Avast Email Server Security v8.x.x

Earlier and the latest versions of these products are currently affected.
**Conclusion**
After exposing this issue, we hope Avast will work seriously on it and mitigate the impact that this might have. There are also other interesting IOCTLs that we encourage you to play with, but we will leave those as an exercise to the reader.
**Avast Sandbox – Escape during DeepScreen scan**

Video Player

00:00
01:35

**Avast Sandbox – Escape during permanent sandboxing**

Video Player

00:00
01:56

 **References**
AVAST Sandbox – <https://blog.avast.com/2015/09/09/what-does-the-avast-sandbox-do/>
AVAST DeepScreen – <https://blog.avast.com/topic/DeepScreen>

#

### **GitHub Projects**

Check out our latest projects at [GitHub](https://github.com/nettitude)

## **Latest Cyber Labs articles**

* ### Time Travel Debugging Shellcode with Binary Ninja

  ![](/cdn-cgi/image/width=432,format=auto/globalassets/cyber-security---images/headers-and-other-images/8---news/cyber-security-news-lrqa-2.jpg)

  Article

  Learn how to debug shellcode using Time Travel Debugging (TTD) in Binary Ninja. This guide walks you through...
* ### Binary Ninja Plugin

  ![](/cdn-cgi/image/width=1024,format=auto/globalassets/cyber-security---images/headers-and-other-images/8---news/cyber-security-news-lrqa-2.jpg)

  Article

  Recently, in response to a customer incident we needed to reverse engineer a malware sample of WhiteRabbit ransomware...
* ### This Badge is My Badge

  ![](/cdn-cgi/image/width=432,format=auto/globalassets/cyber-security---images/headers-and-other-images/8---news/cyber-security-news-lrqa-2.jpg)

  Article

  When it comes to covert entry assessments, successfully capturing RFID badge values can mean the difference between failure...
* ### Version Tracking in Ghidra

  ![](/cdn-cgi/image/width=432,format=auto/globalassets/cyber-security---images/headers-and-other-images/8---news/cyber-security-news-lrqa-2.jpg)

  Article

  When a binary is reverse engineered using Ghidra, various annotations are applied to aid in understanding the binary’s...
* ### Vulnerabilities in AI Agents

  ![](/cdn-cgi/image/width=432,format=auto/globalassets/cyber-security---images/headers-and-other-images/8---news/cyber-security-news-lrqa-2.jpg)

  Article

  LLMs are becoming increasingly accessible to everyone. It is very easy to create your own LLM system, however...
* ### Emulation with Qiling

  ![LRQA Cyber Labs](/cdn-cgi/image/width=432,format=auto/globalassets/cyber-labs/lrqa-cyber-labs.jpg)

  Article

  Qiling is an emulation framework that builds upon the Unicorn emulator by providing higher level functionality such as...
* ### CVE-2024-20356: Jailbreaking a Cisco appliance to run DOOM

  ![LRQA Cyber Labs](/cdn-cgi/image/width=1024,format=auto/globalassets/cyber-labs/lrqa-cyber-labs.jpg)

  Article

  A walkthrough of CVE-2024-20356, a high severity Command Injection vulnerability affecting a range of Cisco products. This vulnerability...
* ### Flaw in PuTTY P-521 ECDSA signature generation leaks SSH...

  ![](/cdn-cgi/image/width=432,format=auto/globalassets/cyber-security---images/headers-and-other-images/8---news/cyber-security-news-lrqa-2.jpg)

  Article

  This article provides a technical analysis of CVE-2024-31497, a vulnerability in PuTTY discovered by Fabian Bäumer and Marcus Brinkmann...
* ### Introducing SharpConflux

  ![](/cdn-cgi/image/width=432,format=auto/globalassets/cyber-security---images/headers-and-other-images/8---news/cyber-security-news-lrqa-2.jpg)

  Article

  Today, we are releasing a new tool called SharpConflux, a .NET application built to facilitate Confluence exploration. It...

Previous

Next

![](/cdn-cgi/image/width=120,format=auto/globalassets/logos/lrqa-white-logo---dark-background-cropped.png)

* [Who we are](/en/who-we-are/)
* [Careers](/en/careers/)
* [Resources](/en/resources/)

LRQA and any variants are trading names of LRQA Group Limited, its subsidiaries and affiliates. LRQA Group Limited, registered number 1217474, is a limited company registered in England and Wales. Registered office: 1, Trinity Park, Bickenhill Lane, Birmingham B37 7ES. © 2024 LRQA Group Limited.

* [Privacy notice](/en/privacy-notice/)
* [Cookie Policy](/en/cookies-policy/)
* [Terms of use](/en/terms-of-use/)
* [Modern Slavery Statement](/en/who-we-are/modern-slavery/)
* [Governance](/en/who-we-are/governance-policies/)


