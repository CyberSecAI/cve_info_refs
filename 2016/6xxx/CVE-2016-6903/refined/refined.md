### CVE-2016-6903
Based on the provided information, here's a breakdown of the vulnerability:

**Root Cause:**
The vulnerability stems from the `lshell`'s improper handling of multiline commands, allowing a user to bypass restrictions and execute arbitrary commands. Specifically, by inserting a control character sequence (`<CTRL+V><CTRL+J>`) after an allowed command, an attacker can inject and execute restricted commands.

**Weaknesses/Vulnerabilities Present:**
- Improper input sanitization: The `lshell` failed to properly sanitize or validate user input containing control characters and multiline sequences.
- Inadequate command parsing: The command parser failed to prevent the execution of arbitrary commands when the input included control characters followed by a restricted command.

**Impact of Exploitation:**
- Shell escape: An attacker can escape the restricted `lshell` environment and gain access to a full system shell (e.g., bash).
- Arbitrary command execution: Once the attacker has shell access, they can execute arbitrary commands on the system with the permissions of the restricted user.

**Attack Vectors:**
- Input of a control character sequence followed by a restricted command: The user enters an allowed command (e.g., `echo`), then inserts the control character sequence `<CTRL+V><CTRL+J>`, followed by a restricted command (e.g., `bash`).

**Required Attacker Capabilities/Position:**
- Access to a user account limited by `lshell`: The attacker needs access to a user account where `lshell` is configured as the login shell.
- Ability to input specific key combinations: The attacker needs to be able to send the control character sequence `<CTRL+V><CTRL+J>` through the terminal.

**Technical Details:**
- The vulnerability is triggered by the specific sequence `<CTRL+V><CTRL+J>`.
- The vulnerability was present in `lshell` version 0.9.16-1 and fixed in version 0.9.18-2+rm.
- The fix involved catching control escapes within the `lshell` code, specifically in `lshell/sec.py` and test cases were added in `test/test_functional.py`.