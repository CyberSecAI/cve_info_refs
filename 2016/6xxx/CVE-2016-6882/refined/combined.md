=== Content from people.redhat.com_ff74a1c0_20250125_083610.html ===
Factoring RSA Keys With TLS Perfect Forward Secrecy

Florian Weimer
Red Hat Product Security

September 2015

Abstract

This report describes the successful factorization of
RSA moduli, by connecting to faulty TLS servers
which enable forward secrecy and which use an
insuﬃciently hardened RSA-CRT implementation.
The history of this particular RSA-CRT implemen-
tation defect is discussed, and the current state of
countermeasures is reviewed. Some familiarity with
the RSA cryptosystem and the Transport Layer Se-
curity protocol suite is assumed.

1 The RSA-CRT optimization

The RSA cryptosystem works in a ring Z/nZ.
Knowledge of the private key pq = n allows one to
construct a ring isomorphism between Z/nZ and
Z/pZ ⊕ Z/qZ.

In practice, both p and q are about the size of
√
n. The cost of RSA operations grows quite a
bit faster than O(cid:0)(log n)2(cid:1), for typical implementa-
tions. Therefore, doing the computations in Z/pZ
and Z/qZ separately is more eﬃcient, even after
taking into account the cost of separating the input
and combining the result. (Not just are the moduli
much shorter, but the decryption exponent d can
be reduced as well, and many of the values needed
can be pre-computed during key generation.) This
optimization is usually called the Chinese Remain-
der Theorem (CRT) optimization.

With the CRT optimization, the bulk of the com-
putation happens in the ring Z/pZ ⊕ Z/qZ. If a
fault happens during the computation of a RSA sig-
nature in exactly one of the components, say Z/pZ,
and the attacker gets hold of that faulty signature
y, and the attacker knows the original value x which
is being signed, then

1 < gcd(ye − x, n) < n

(1)

over the integers, where e is the public RSA expo-
nent and a suitable integer representative for ye
(mod n) has been chosen. This means that the
greatest common divisor reveals a prime factor of
n.

Here is why this works, assuming such a fault
has occurred: The ring isomorphism ϕ : Z/nZ →
Z/pZ ⊕ Z/qZ behind the CRT optimization can be
realized as the reduction modulo p and q in the re-
spective components. Assume ϕ(y) = (yp, yq) for
a signature y which is faulty in the component yp,
then ϕ(ye) = (ye
q): the fault is still restricted
to the ﬁrst component. Writing the original value-
to-be-signed x in the form ϕ(x) = (xe
q), we see
that

p, xe

p, ye

ϕ(ye − x) = (a, 0)

for some a ∈ Z/pZ. But this means that any rep-
resentative of ye − x modulo n is a multiple of q.
If the representative is less than n (which is always
possible to arrange), the greatest common divisor
of ye − x with n is q, revealing the factorization.

1.1 Arjen Lenstra’s CRT attack

A widely-cited memo by Arjen Lenstra [1] points
out a problem with this optimization in the sense
that it can lead to an additional side-channel at-
tack. We summarize Lenstra’s observation below,
using slightly diﬀerent language.

1.2 Faults enabling Lenstra’s attack

The nature of the fault which aﬀects the CRT op-
timization can take various forms:

1. The arbitrary precision integer library used by
the RSA implementation could have a defect

1

that causes it to produce incorrect results (see
CVE-2014-3570 in [2], although the practical
impact of this particular defect is minimal, as
explained in the security advisory).

2. There could be a race condition involving data
access from multiple threads in an unsynchro-
nized fashion.

3. The arithmetic unit in the CPU could produce
incorrect results, either in a deterministic fash-
ion for some inputs (as described in [3]), or
randomly due to some environmental condi-
tions (perhaps after overheating, as a result of
its extensive use during an RSA operation).

4. Critical parts of the private key could have
been corrupted after all the integrity checks
(if any) have been performed (see [4]), causing
all future signatures to reveal the private key.

5. CPU caches, other caches, or main memory
could be defective and introduce bit errors into
intermediate results.

If the target is a smartcard (or other device which
is supposed to prevent even its owner from access-
ing the private key material), other forms of faults
may be relevant, typically deliberately introduced
by someone who has physical access to the device.
We are eventually interested in faults in TLS imple-
mentations where we do not have physical access,
which is why we did not consider these additional
faults further.

1.3 Countermeasures

The obvious countermeasure is to verify the cor-
rectness of the signature y by checking ye ≡ x
(mod n), using arithmetic in Z/nZ (without the
CRT optimization). This is already alluded to
in [1]. This veriﬁcation step is relatively cheap com-
pared to the signing operation itself because the
public encryption exponent is typically e = 65537,
which is much shorter than the private exponent
(even with the CRT optimization in place). The
diﬀerence is even more pronounced with the other
popular choice, e = 3,

In response to Klima and Rosa’s attack on the
secret key storage in some implementations of
OpenPGP [4], several RSA-CRT implementations

Implementation
cryptlib 3.4.2
GnuPG 1.4.18
GNUTLS
Go 1.4.1
libgcrypt 1.6.2
Nettle 3.0.0
NSS
ocaml-nocrypto 0.5.1
OpenJDK 8
OpenSSL 1.0.1l
OpenSwan 2.6.44
PolarSSL 1.3.9

Veriﬁcation
disabled by default
yes
see libgcrypt and Nettle
no
no
no
yes
no
yes (see text)
yes (see section 1.3.1)
no
no

Table 1: RSA-CRT and signature veriﬁcation

(notably GnuPG and OpenSSL) introduced hard-
ening against Lenstra’s RSA-CRT attack (because
it was used in the RSA part of the Klima/Rosa
attack). It has been conjectured that this kind of
hardening is no longer relevant (see [5] for a re-
cent example), at least not in the context of non-
smartcard implementations, so we examined the
state of current implementations.

Table 1 shows the result of a source code review
of the major free-software RSA implementations.
The versions reviewed were the most recent sta-
ble versions available at the time of review. All
of them implemented the RSA-CRT optimization.
The table reﬂects the default upstream implemen-
tation only and does not cover alternative RSA im-
plementations which may have been installed using
a plug-in mechanism (which is an optional feature
oﬀered by several of the cryptographic libraries sur-
veyed).

Cryptlib supports checking after CRT-based
RSA signing operations, but the conﬁguration op-
tion which controls this functionality is disabled by
default. The cryptlib author reports in [7] that “en-
abling this option” for general protection against
side-channel attacks “will slow down all private-key
operations by up to 10%”. The post-signing check
is deliberately included among the general protec-
tion mechanisms, so it is disabled by default as well.
NSS simply reports an error to the caller if a
signature fails to verify immediately after its com-
putation. We think this is the best way to deal
with this situation.

OpenJDK was ﬁxed prior to publication, in re-

2

sponse to this research, under the vulnerability
identiﬁer CVE-2015-0478 [6].

2 RSA use in TLS

1.3.1 Countermeasures in OpenSSL

The OpenSSL case is slightly complicated because
this library performs a veriﬁcation and re-computes
the signature without the CRT optimization if a
fault has been detected. We believe that this poses
no immediate danger—Lenstra’s attack on RSA-
CRT certainly does not work even if a second fault
occurs because of the unoptimized second compu-
tation. Depending on the nature of the faults, this
could conceivably still reveal the key over time, but
several thousand faulty signatures are needed for
current key sizes [1, 8], each one preceded by an
RSA-CRT fault. As shown in [8], it is possible to
construct a faulty CPU which indeed leaks keys
in this way, which is why there are some linger-
ing concerns about the reliability of the OpenSSL
hardening.

There may also be OpenSSL variants in cir-
culation which omit RSA-CRT veriﬁcation alto-
gether, either because they have been patched, or a
completely diﬀerent RSA implementation has been
swapped in, using the OpenSSL plug-in mecha-
nism. The comments in the preceding paragraph
apply only to current (1.0.1l) upstream sources and
the rsa_eay.c implementation.

1.4 RSA blinding

Since Lenstra has described his attack, RSA imple-
mentations have started to follow additional rec-
ommendations, particularly as a form of harden-
ing against timing attacks. One common hard-
ening measure is RSA blinding [9], which multi-
plies the value-to-be-signed with a random number
before computing the signature and compensates
for this additional factor afterwards (details vary).
But no matter how RSA blinding is actually imple-
mented, it will not propagate a computation error
which aﬀects only one CRT component to the other
component (again, this is a consequence of the ring
isomorphism ϕ), and RSA blinding does not stop
Lenstra’s attack.

Traditionally, SSL 3.0 and all TLS versions up
to 1.2 ([10], the current version) require that the
server performs an RSA decryption of a client-
supplied challenge as part of the handshake, thus
authenticating the server to the client. But this
approach does not work if the server uses an X.509
certiﬁcate which does not embed an encryption-
capable public key.
(Historically, such keys were
DSA keys.) To use such keys, SSL 3.0 provides
a diﬀerent authentication mechanism: the server
signs a message containing, among other things, a
client-supplied random string (to ensure freshness)
and parameters for establishing a session key us-
ing an instance of the Diﬃe-Hellman key agreement
scheme.

It was then noticed that it is possible to pretend
that RSA keys do not support encryption, and use
their signing capabilities only, just as one would
do with a DSA key. This protocol tweak has the
property that as long as there is no practical oﬄine
attack on the Diﬃe-Hellman variant being used,
it is not possible to recover the plaintext of TLS
sessions even if the server private key is leaked after
the fact, which is why this protocol variant goes
by the somewhat pompous name Perfect Forward
Secrecy, or just forward secrecy.

This protocol change opens up RSA keys to
Lenstra’s attack, assuming that the underlying
RSA-CRT implementation lacks appropriate check-
ing. (The Diﬃe-Hellman variant used for session
key negotiation does not matter here.)

Recall that Lenstra’s attack needs knowledge of
the value x which has been signed, in addition to
the corrupted signature y. This means that a deter-
ministic padding scheme is required for the attack
to work. Curiously, SSL 3.0 and all versions of TLS
up to 1.2 use a variant of the fully deterministic
PKCS #1 version 1.5 RSA signature padding [11].
Versions up to TLS 1.1 concatenate the MD5 and
SHA-1 hash of the message and do not include the
DER-encoded OID of the digest algorithm. TLS
1.2 added digest algorithm negotiation, switched
to a standard digest algorithm (no more concate-
nation of two digests), and includes the OID in the
padding.

But the key point remains: These schemes are all
deterministic. There have been discussions to use
randomized padding schemes for RSA signatures in

3

TLS (predominantly RSASSA-PSS [12]), and the
new negotiation capabilities in TLS 1.2 would have
provided a backwards-compatible way to introduce
them. It is surprising that this has not happened.
The actual key recovery attack can be described
in very simple terms: establish a TLS session, ne-
gotiate forward secrecy, and watch out for a mis-
computed signature.
If a signature mismatch is
detected, attempt Lenstra’s attack to recover the
RSA private key. Figure 1 shows the patch we
used to experimentally validate that the approach
works. The patch introduces the fault (the time
dependency will be used in section 4) and removes
OpenSSL’s countermeasure against faults during
the RSA-CRT computation.

3 The experiment

As explained above,
implementers no longer
consider hardening RSA-CRT signing operations
against faults a necessity. The increased deploy-
ment of TLS with forward secrecy provides a way
to test if this decision is reasonable: We imple-
mented a crawler which performs TLS handshakes
and looks for miscomputed RSA signatures. We
ran this crawler for several months.

The intention behind this conﬁguration is to
spread the load as widely as possible. We did
not want to target particular servers because that
might have been viewed as a denial-of-service at-
tack by individual server operators. We assumed
that if a vulnerable implementation is out in the
wild and it is somewhat widespread, this experi-
mental setup still ensures the collection of a fair
number of handshake samples to show its existence.
We believe this approach—probing many instal-
lations across the Internet, as opposed to stressing a
few in a lab—is a novel way to discover side-channel
vulnerabilities which has not been attempted be-
fore.

3.1 Setup

The crawler ran in two instances:

• One instance used the OpenSSL 1.0.1k-3 De-
bian package, recompiled to add back SSL
3.0 support (to reduce the amount of spuri-
ous handshake failures). It ran on a Debian 8
operating system (amd64 architecture).

• Another instance ran on Red Hat Enterprise
Linux 7.1, using the OpenSSL packages with
versions 1.0.1e-42.el7_1.6 and later (which
reject weak Diﬃe-Hellman primes).

An OpenSSL function, SSL_set_msg_callback,
is used to install a callback function which Open-
SSL invokes after processing handshake messages.
This enables the crawler to run with an unmodiﬁed
OpenSSL library (and will make it possible to re-
run the experiment in the future, potentially with
a diﬀerent OpenSSL version). The callback func-
tion is invoked even in the presence of handshake
failures.

We chose to include cipher suites without for-
ward secrecy in the client hello message, to make it
somewhat less obvious to server operators what we
were after in this experiment. The crawler adver-
tised TLS 1.2 support, but would retry connections
with TLS 1.0 and SSL 3.0 in response to certain
handshake failures.

Three diﬀerent forms of target selection were

used:

1. Domain-based target selection. The domain
list consisted of a manually curated list of crit-
ical domains, plus Hubert Kario’s domain list
used in his TLS scans [13]. We also included
domain names from a subset of the certiﬁ-
cates documented by the Rapid7 Sonar SSL
scans [14]. Later on, we added host names ex-
tracted from certiﬁcate transparency logs [15],
too.

The total set of targets had 25 million host
names (and IP addresses), and we saw hand-
shakes with forward secrecy for 8 million of
these targets. We conducted about 1.7 billion
TLS handshakes in total, of which 1.4 billion
involved forward secrecy.

2. IP-based target selection. We used IP ad-
dresses extracted from the same Rapid7 Sonar
SSL scans. We also experimented with the
University of Michigan ZMap data [16], but
the published data was not current at the time
we noticed its availability.1

1Originally, the published ZMap/zgrab data did not in-
clude the client hello and the complete ServerKeyExchange
message, so the TLS traces do not contain suﬃcient infor-
mation to attempt key recovery. The ZMap team has since
switched to publishing more complete data.

4

The consolidated target set contained 32 mil-
lion IP addresses, of which 10 million re-
sponded with a forward secrecy handshake.
Here, the number of TLS handshakes was
around 3.8 billion, of which 3.4 billion had for-
ward secrecy enabled.

3. Certiﬁcate-based target selection. We selected
targets based on X.509 certiﬁcate properties,
mainly vendor strings. There were 26,000 tar-
gets in that category, with about 40 million for-
ward secrecy handshakes combined, yielding a
high number of such handshakes per target.

In both cases, we switched, after a few probing
runs over the entire target set, to the subset of
targets which performed a TLS handshake which
involved a ServerKeyExchange message (because
that is the only way a key leak could occur).

We assumed that the ﬁrst option would yield bet-
ter results: Port scanning, without domain names,
should no longer be fully eﬀective because some
TLS servers require a valid Server Name Indication
before they complete the TLS handshake. But this
turned out not to be the case, and the second ap-
proach was far more eﬀective. As the results below
show, most of the aﬀected devices were not in the
browser PKI. They do not even contain a match-
ing host name in their X.509 certiﬁcates, and do
not show up in the certiﬁcate transparency logs.

In addition,

for the domain-based approach,
DNS resolution turned out to be a major bottle-
neck. We used the PowerDNS recursor on the
same machine, conﬁgured to cache records aggres-
sively (mostly by increasing the cache size and
ignoring server-provided TTL values). However,
this caching was only eﬀective while we were us-
ing a smaller set of host names, and we eventually
had to cache name resolution results in an SQLite
database, completely bypassing TTL values.

3.2 Key recovery implementation

If OpenSSL reports any handshake failure, the
RSA signature is extracted from the Server-
KeyExchange handshake message using a custom-
written partial TLS parser. A key recovery based
on equation (1) is attempted: y is the extracted
signature, e and n are extracted from the X.509
certiﬁcate sent by the server, and the expected sig-

nature value x is formed by applying PKCS#1 ver-
sion 1.5 padding to the appropriate digest value, as
required by the TLS protocol.

The dominating operation in equation (1) is the
public RSA operation, ye. Therefore, the key re-
covery computation is slightly more costly than ver-
ifying an RSA signature.

Key recovery can fail for various reasons:

1. If the signature is not actually faulty, then
ye ≡ x (mod n), and the handshake failed for
other reasons.

2. If the signature has faults in both CRT com-
ponents, the greatest common divisor gcd(ye −
x, n) will be 1, and not reveal a factorization.

(a) The public key in the X.509 certiﬁcate
and the private RSA key used to create
the signature do not match: The private
RSA key is internally consistent, and no
fault occurs during signature computa-
tion. The signature is just for the wrong
public key, and cannot be veriﬁed against
the public key in the X.509 certiﬁcate.

(b) Multiple faults occur during a RSA-CRT
computation, aﬀecting all CRT compo-
nents and not just one.

(c) A fault occurred, but the RSA-CRT op-
timization was not used to compute the
signature as it is disclosed to the client.
(This case includes the OpenSSL fallback
scenario, discussed in section 1.3.1 and
[8].)

(d) The ServerKeyExchange message was
corrupted after the signature was com-
puted (perhaps during transmission over
the Internet).

(e) The signature was computed correctly,
using the expected key, but over the
wrong digest. This can happen if the di-
gest was miscomputed on the server side,
or earlier handshake messages were cor-
rupted so that the client computes the
wrong expected digest.

Except in the last case, ye will not have valid
PKCS#1 version 1.5 padding.

We discuss key recovery failures in more detail in

section 3.4.

5

3.3 Results

Table 2 summarizes the results of the crawler.
“Vendor” refers to the putative device maker; see
below for a description how devices were attributed
to speciﬁc vendors.

The counts in the “Keys” column is based on the
number of distinct RSA moduli (and not full X.509
certiﬁcates, or device or IP address counts).

The “PKI” column indicates whether the pub-
lic key was signed by a certiﬁcate authority which
is part of the browser PKI; “expired” means the
certiﬁcate was expired at time of factorization.

The “Rate” column indicates how often the key
leaked; most key leaks were seen multiple times, but
the rate varied from one-time leaks (“very low”), to
the occasional odd handshake (“low”) to the ma-
jority of handshakes (“high”; at this point, faults
prevent leaks by happening in both CRT compo-
nents at the same time), or even all handshakes
(“always”). The location in the “Geo” column was
determined based on WHOIS data.

3.3.1 Discussion of individual key leaks

The two keys leaked ﬁrst were used by the same
organization, on devices with neighboring IP ad-
dresses. An investigation with the help of the
certiﬁcate authority and the system administrator
showed that the keys were stored in the same hard-
ware accelerator card of a TLS-terminating load
balancer, a Citrix Netscaler device. The load bal-
ancer was quite old and was already scheduled for
replacement. This replacement happened after we
contacted the system administrator, and the cer-
tiﬁcates were reissued.

The next key leak we observed was from a de-
vice made by Hillstone Networks. The ﬁrst leaked
key of this kind was picked up by accident dur-
ing our domain-based crawler runs. The certiﬁ-
cate was self-signed, and the subject distinguished
name in the X.509 certiﬁcate contained the strings
“Hillstone Networks” and “SG-6000”. Further
probing based on this vendor name identiﬁed more
than 200 additional public keys whose private key
leaked. Devices with the “DCFW-1800” string in
their X.509 certiﬁcates are from them same manu-
facturer and are included in these counts. Hillstone
Networks as since release a ﬁrmware update [17] to
correct this issue.

Vendor
Citrix
Hillstone

Networks

Alteon/
Nortel
Viprinet
QNO

ZyXEL

BEJY
Fortinet

2 DE

Keys Geo PKI
yes
231 CN no
no
1 CZ
1 PL
no
1 TH no
no
1 US
expired
1 US
no
1 US
1 NL
no
2 CN no
1 TW no
4 AT
no
1 CH no
no
1 DE
2 DK no
no
1 FR
no
7
IE
no
IT
1
no
2 NL
1
no
SE
5 UK no
no
1 US
yes
1 DE
no
1 US
no
IN
1

Rate
medium
low
low
low
low
low
high
high
always
medium
medium
low
low
low
low
low
low
low
low
low
low
low
low (?)
very low
very low

Table 2: Crawler results

6

The key leaks attributed to an Alteon/Nor-
tel device occured from two IP addresses on the
same subnet, and because of that proximity and
the similarity in behavior, we assumed it was
a single device. Only one of the certiﬁcates
embedded the string “Alteon/Nortel Generated
Certificate”, on which the attribution is based.
For both IP addresses failure rate was so high that
the TLS implementation was unable to complete
the majority of handshakes successfully. The va-
lidity periods of the the X.509 certiﬁcates suggest
that they were generated many years ago. If the
key is still loaded into the same device on which
it was generated, these two keys were leaked by an
old piece of equipment, like those from the Citrix
device.

In the case of the Viprinet device, the key
was apparently corrupted in memory or in persis-
tent storage because the RSA signature in every
ServerKeyExchange message generated by the de-
vice exposes the RSA private key. (This is similar
to what happens in case of the Klima/Rosa attack
[4].) See section 3.4.3 for another defect related to
this vendor.

The devices made by QNO Technology were ﬁrst
identiﬁed using the second probing approach (based
on IP addresses), followed by further tests target-
ing a subset of addresses based on X.509 certiﬁcate
properties (on which the attribution is based).

The ZyXEL devices we observed were discovered
in the same way. The Common Name attribute
in their X.509 certiﬁcates started with “zw110” or
“nxc2500”. ZyXEL conﬁrmed [18] that they had
already addressed this issue in a ﬁrmware update
in March 2013, but as a functionality defect and
not as a security vulnerability.

BEJY is a proprietary, custom Java implemen-
tation of RSA, TLS, and HTTP/HTTPS, which is
not based on the usual Java cryptographic frame-
works (JCE and JSSE). The server operator ﬁxed
the code rather quickly, and we only saw a single
key leak. This particular code base does not ap-
pear to be widely used, although JAR ﬁles with
the server code can be downloaded for free.

The Fortinet devices identiﬁed themselves with
a Common Name starting with “FG300B”. We ob-
served just two key leaks from two diﬀerent devices,
in over 90 million TLS handshakes with forward
secrecy, across many diﬀerent devices with simi-
lar certiﬁcates. Clearly, the TLS implementation

lacked RSA-CRT hardening, but beyond that, it
was unclear what was happening.

3.3.2 A note on interpreting the results

Various versions of the crawler ran over a time pe-
riod of nine months. As a result, lots of handshakes
were analyzed, but at 200 handshakes per second
on average, the number of handshakes is still just a
negligible fraction of all TLS handshakes on the In-
ternet during that time period. Very close to pub-
lication of this report, we picked up one case with
an extremely low key leak rate (Fortinet) by sheer
luck, and other such cases may exist as well.

In all likelihood, the distribution between ven-
dors and countries shown in table 2 does not ac-
curately reﬂect the actual distribution of devices
which leak RSA keys in this way. In order for the
crawler to pick up the device at all, a few require-
ments need to be met:

1. The device must implement TLS.

2. It must oﬀer a TLS service on port 443/TCP.

3. This TLS service must be accessible to the gen-

eral Internet.

The third item is not just a property of the de-
vice, but also depends on how the device is deployed
in the ﬁeld. An Internet service provider that in-
stalls customer premises equipment with a world-
accessible HTTPS management interface on port
443/TCP can easily shift these numbers, and some
of the observations in table 2 may be the result of
that.

3.3.3 A common root cause?

[20],

[19], Hillstone Networks

Citrix
and
ZyXEL [18] conﬁrmed that they use Cavium
as a hardware supplier.
Documentation [21]
from Radware (the company that acquired the
Alteon/Nortel product lines) suggests that they
use this that they use this supplier as well,
but we could not conﬁrm that the referenced
documentation actually applied to the device we
observed.

In case of Hillstone Networks and ZyXEL, Cav-
ium supplied custom versions of OpenSSL, which
are not available to the general public in source

7

code form. Both vendors disabled the hardware
acceleration in order to prevent the key leak and to
re-enable the RSA-CRT hardening present in the
OpenSSL upstream version.

Cavium kindly provided us with the following

statement [22]:

Cavium has issued a patch and noti-
ﬁed all customers (CVE-2015-5738) that
are using older SDK 2.x Cavium Cryp-
tographic Software under Linux on older
OCTEON II CN6xxx Hardware with de-
tails of the vulnerability. OCTEON II
running Simple Exec (SE-S) applications
and OCTEON III CN7xxx processors are
not aﬀected.

The relationship of QNO or Fortinet with this
hardware supplier is unknown. Viprinet and BEJY
do not use this supplier.

3.4 Other faulty signatures

In addition to faulty signatures which resulted in
recovery of the private key, we saw faulty signa-
tures were key recovery failed. As explained in sec-
tion 3.2, there are several potential causes. We
attempted to attribute these failures to speciﬁc
causes.

3.4.1 Public/private key mismatch

In this scenario, the server public key, as contained
in its X.509 certiﬁcate sent during the TLS hand-
shake, does not match the private key which is used
to compute the signature, but apart from that, the
signature is computed correctly.

We used the following approach to recover the
public key n from two faulty signatures (x, y),
(x(cid:48), y(cid:48)), where x, x(cid:48) are the expected padded values
over which the signature is computed, and y, y(cid:48) are
the server-provided signatures. Assuming the RSA
signatures have been computed correctly using the
same private key, n | ye − x and n | y(cid:48)e − x(cid:48), so that

n | gcd(ye − x, y(cid:48)e − x(cid:48)),

(2)

computed over Z. (If our assumption about correct
computation was incorrect, the greatest common
divisor will likely be 1 or a small integer, see below.)

It is still necessary to guess the public encryption
exponent e. We tried the values 3, 17, and 65537.
The latter makes the computation of the greatest
common divisor in (2) somewhat cumbersome, but
it is well within reach of modern systems.

ye − x and y(cid:48)e − x(cid:48) should be (pseudo-)random
multiples of n (otherwise, this might point to a ﬂaw
in the RSA cryptosystem), which means that the
respective cofactors of n are relatively prime with
probability 6π−2. (This result goes back to Dirich-
let, see exercise 4.5.2(10) in [23].) Consequently,
there is a good chance that (2) is, in fact, an equal-
ity. The greatest common divisor with additional
pairs can be computed to make sure that the in-
ferred value of n is indeed the right one.

We did not fully automate this process because
our main goal here was to weed out known causes
of miscomputed signatures. The handshake failure
due to this misconﬁguration is harmless because
it does not leak the private key, and so it does not
warrant further consideration as part of this report.

3.4.2 Accidental factors of a corrupted pub-

lic key

We observed one rather peculiar factorization of a
RSA modulus, involving factor 23. What happened
was that the public key in the X.509 certiﬁcate was
corrupted in some (there was a bit ﬂip, according to
the server operator), and equation (1) accidentally
revealed the factor 23. The corrupted modulus had
other small factors, too, and a large composite fac-
tor with an unknown factorization.

Even if a complete factorization of the corrupted
modulus had leaked, this would not have been use-
ful for attacking the correct modulus. The server
had RSA-CRT hardening, so a key leak was not
possible, but the operator quickly retired the de-
fective server and replaced the X.509 certiﬁcate as
a precaution.

3.4.3 No-op RSA

Several deployed VPN devices whose certiﬁcates
suggest they were manufactured by Viprinet con-
sistently generate ServerKeyExchange messages
where the RSA signature is unencrypted. That is,
x = y and e = d = 1 for the computation, although
the X.509 certiﬁcate says that the public exponent
is 65537. This defect leads to an interoperability

8

failure with properly behaving clients, but it does
not leak the server private key.

If this is not the result of memory implementa-
tion, but of a defect in the TLS implementation
which uses this no-op RSA variant, and this TLS
implementation is used on both ends, TLS will not
provide any cryptographic protection.

3.4.4 Zero RSA

Some servers occasionally or consistently produce
ServerKeyExchange messages which contain RSA
signatures which are zero. Encoding of the num-
ber zero varied. In some cases, zero or one bytes
were transmitted. Sometimes the length of the sig-
nature matched the size of the RSA modulus. The
latter suggests that the server implementation may
have omitted the copy of the computed signature.
This could happen if RSA-CRT hardening detects
a faulty signature, does not write the result to a
caller-provided buﬀer, returns an error. If the caller
is defective and ignores RSA signature computation
failures, it may then proceed to send out the un-
written buﬀer.

4 Browser behavior

The

This section presents a curious observation which
is only peripherally related to the main results.
timing dependency in our

corrupted
OpenSSL version (see ﬁgure 1) gives clients who
retry on handshake error a second chance. Most
web browsers perform such second tries to in-
crease compatibility, reducing security at the same
time (“insecure protocol downgrade”). To see
what this means in the presence of corrupted
forward secrecy signatures, we checked several
web browsers against the example web server in
OpenSSL (“openssl s_server -www”).

The results are shown in table 3. Most of the
tested browsers are binaries provided by Debian.
The Firefox binaries are oﬃcial builds from Mozilla.
Neither the Iceweasel nor the Firefox binaries use
the system NSS library. The test system was a De-
bian 7.8 amd64 installation, except for the Internet
Explorer test, where a German version of Windows
8.1 (updated to the January 2015 version) was used.
Most of the tested browsers hide server prob-
lems in the TLS signing operation. Between ver-

Browser
Chromium

37.0.2062.120-1~deb7u1
Iceweasel 31.4.0esr-1~deb7u1
Internet Explorer

11.0.9600.17498/11.0.15

Firefox 31.0
Firefox 32.0
...
Firefox 37.0
Firefox 38.0
w3m 0.5.3-8

Behavior
silent retry

silent retry
limited retry

silent retry
limited retry
...
limited retry
failure
failure

Table 3: Browser behavior in response to server
signature failures

sion 31.0 and 32.0, Firefox switched from an un-
conditional retry on this particular error to report-
ing a failure (with a “Try Again” button, though).
However, the error is only reported on subsequent
connection attempts during the same browser ses-
sion. Even in version 32.0 (and later versions up
to 37.0), Firefox silently retries a second time if
the error happens during the initial connection at-
(We believe this behavior is not related
tempt.
to TLS session resumption, but caused by a cache
introduced to reduce protocol downgrades due to
network glitches.) Beginning with version 38.0,
Firefox always reports handshake failures due to
faulty ServerKeyExchange signatures (with a “Try
Again” button).

The tested version of Internet Explorer shows the
reverse retry behavior: Initial connections with a
faulty signature fail, but if an unsuccessful session
resumption attempt leads to a full handshake with
a faulty signature, Internet Explorer silently retries
the connection, covering up the signing error.

We need to stress here that all these behavioral
variants in browsers are not themselves vulnerabil-
ities. But these silent retries help to hide the fact
that the server signing operation is vulnerable to
Lenstra’s attack.

5 Impact on other protocols

The RSA cryptosystem is used in other protocols
besides TLS, and deterministic padding schemes
such as PKCS #1 version 1.5 are widely used. How-

9

ever, some protocols make key leaks from miscom-
puted RSA signatures invisible to passive observers.

5.1 IPsec

The majority of the leaked keys aﬀected devices
whose X.509 certiﬁcates suggested they are used
as VPN gateways.
Some operating modes for
IPsec-based VPN gateways use RSA, and until re-
cently [24], there was not a standard option in the
Internet Key Exchange (IKE) to avoid determinis-
tic signatures when RSA keys are used. Therefore,
it is conceivable that IPsec VPN gateways with
faulty RSA implementations leak private key ma-
terial not just over their web front ends, but also
through IKE (that is, as part of regular IPsec op-
eration). Due to the early use of a Diﬃe-Hellman
key exchange in IKE protocol, such key leaks may
not be visible to passive observers, only to those
actively participating in the handshake.

Most VPN devices will not expose the admin-
istrative front end to the public Internet, which
means that the results presented in section 3.3
likely underestimate the number of aﬀected VPN
devices and the range of vendors. Further research,
using a diﬀerent crawler implementation, might be
able to settle this question.

5.2 SSH

Like IPsec, SSH performs a Diﬃe-Hellman key ex-
change early in the protocol, so active participation
in the handshake is required to observe key leaks.

5.3 DNSSEC

Due to its use of oﬄine signatures, DNSSEC is less
exposed than other RSA-using protocols. Further-
more, it is recommended practice to check zone ﬁles
for consistency and cryptographic correctness prior
to publication. A key-leaking RSA signature would
be noticed at this step, and prevent publication of
the zone.

6 Conclusion

This report shows that it is still possible to use
Lenstra’s attack to recover RSA private keys, al-
most two decades after the attack has been de-

scribed ﬁrst, and that fault-based side-channel at-
tacks can be relevant even in scenarios where the
attacker does not have physical access to the device.
Several factors had to contribute to make this

attack possible, namely:

1. Many RSA implementations still do not verify
signatures that have been computed with the
CRT optimization.

2. TLS with forward secrecy uses RSA signatures
with deterministic padding, which are, in prin-
ciple, vulnerable to Lenstra’s attack.

3. A campaign is under way to deploy forward
secrecy in TLS more widely, in eﬀect making
more servers potentially vulnerable to this at-
tack.

4. Browsers cover up faulty server-computed
RSA signatures, hiding even fairly high error
rates.

The net eﬀect is that a passive observer with vis-
ibility into global Internet traﬃc is likely able to
recover quite a few RSA keys in a completely non-
attributable fashion.

Initially, we suspected that these puzzle pieces
ﬁt together in a rather strange manner. But dis-
cussions with TLS library implementers showed
they assumed that they had good reasons to avoid
adding the check to RSA-CRT-based signing. The
campaign for Perfect Forward Secrecy is likely
based on its compelling name, and not on a care-
ful analysis of the security trade-oﬀs involved. The
browser fallback behavior appears just to be an un-
related accident.

In the short term, implementing a checked RSA-
CRT signing operation, like NSS or even OpenSSL
already do (despite some theoretical concerns about
the eﬀectiveness in the case of OpenSSL), seems a
very reasonable hardening measure. Longer term,
TLS should perhaps switch to a non-deterministic
signature scheme like RSASSA-PSS. However, none
of these measures will help those operators who
have been using unchecked RSA-CRT implemen-
tations for years, and are now wondering if their
RSA private keys have already leaked.

10

Acknowledgments

Nikos Mavrogiannopoulos kindly answered ques-
tions about the RSA implementations used by
GNUTLS. Xuelei Fan unearthed an online copy of
Lenstra’s 1996 memo, and Arjen Lenstra conﬁrmed
that is genuine. Werner Koch helped to link the in-
troduction of RSA-CRT checking to the attack by
Klima and Rosa. Hubert Kario provided helpful
comments on a draft of this report. Peter Gut-
mann answered questions regarding cryptlib. Paul
Wouters clariﬁed some IPsec aspects.

[7] Peter Gutmann, cryptlib Security Toolkit

Version 3.4.2. ftp://ftp.franken.de/pub/
crypt/cryptlib/manual.pdf (retrieved
2015-01-21)

[8] Andrea Pellegrini, Valeria Bertacco, Todd

Austin, Fault-Based Attack of RSA
Authentication. Design Automation and Test
in Europe (DATE), March 2010.
http://web.eecs.umich.edu/~valeria/
research/publications/DATE10RSA.pdf
(retrieved 2015-01-21)

References

[1] Arjen Lenstra, Memo on RSA signature
generation in the presence of faults.
https://infoscience.epfl.ch/record/
164524/files/nscan20.PDF (retrieved
2015-01-22)

[2] OpenSSL Project, OpenSSL Security

Advisory 08 Jan 2015. January 2015. http:
//openssl.org/news/secadv_20150108.txt
(retrieved 2015-01-21)

[3] Eli Biham, Yaniv Carmeli, Adi Shamir, Bug

Attacks. CRYPTO 2008.
http://iacr.org/archive/crypto2008/
51570222/51570222.pdf (retrieved
2015-06-15)

[4] Vlastimil Klíma and Tomáš Rosa, Attack on
Private Signature Keys of the OpenPGP
format, PGP programs and other applications
compatible with OpenPGP. March 2001.
http://eprint.iacr.org/2002/076.pdf
(retrieved 2015-01-24)

[5] Peter Gutmann, Vulnerability of RSA vs.

DLP to single-bit faults. Mailing list posting,
November 2014.
http://www.metzdowd.com/pipermail/
cryptography/2014-November/023464.html
(retrieved 2015-01-22)

[6] Oracle Corporation, Oracle Critical Patch

Update Advisory—April 2015.
http://www.oracle.com/technetwork/
topics/security/cpuapr2015-2365600.
html#AppendixJAVA (retrieved 2015-06-11)

[9] Paul C. Kocher, Timing Attacks on

Implementations of Diﬃe-Hellman, RSA,
DSS, and Other Systems. CRYPTO, 1996.
http://www.cryptography.com/public/
pdf/TimingAttacks.pdf (retrieved
2015-01-21)

[10] Tim Dierks, Eric Rescorla (eds.), The

Transport Layer Security (TLS) Protocol
Version 1.2. RFC 5246, August 2008.
http://tools.ietf.org/html/rfc5246
(retrieved 2015-01-22)

[11] Burt Kaliski, PKCS #1: RSA Encryption
Version 1.5. RFC 2313, March 1998.
http://tools.ietf.org/html/rfc2313
(retrieved 2015-01-22)

[12] Jakob Jonsson, Burt Kaliski, Public-Key

Cryptography Standards (PKCS) #1: RSA
Cryptography Speciﬁcations Version 2.1. RFC
3447, February 2003.
http://tools.ietf.org/html/rfc3447
(retrieved 2015-01-22)

[13] Hubert Kario, TLS landscape. January 2015.
https://securityblog.redhat.com/2014/
09/10/tls-landscape/ (retrieved
2015-01-24)

[14] Rapid 7, Project Sonar SSL Certiﬁcates.

January 2015.
https://scans.io/study/sonar.ssl
(retrieved 2015-01-22)

[15] Certiﬁcate Transparency—Known Logs.

http://www.certificate-transparency.
org/known-logs (retrieved 2015-02-03)

11

[16] University of Michigan, Full IPv4 HTTPS
Handshakes. https://scans.io/series/
443-https-tls-full_ipv4 (retrieved
2015-06-08)

[17] Hillstone Networks, 山石网科关于第三方某型号硬
件器件设计缺陷可能导致信息泄露问题的声明.
July 2015. http://www.hillstone.com.cn/
services/2015/0728/20150728.html
(retrieved 2015-08-26)

[18] ZyXEL Communications Corp., personal

communications, June 2015.

[19] Citrix Systems, Inc., personal
communications, April 2015.

[20] Hillstone Networks, personal
communications, June 2015.

[21] Radware, BP15958: Alteon Support for FIPS

140-2. http:
//kb.radware.com/Questions/Alteon/
Public/Alteon-Support-for-FIPS-140-2
(retrieved 2015-08-25)

[22] Cavium, Inc., personal communcations,

August 2015.

[23] Donald E. Knuth, The Art of Computer
Programming. Volume 2: Seminumerical
Algorithms. Second edition. Addison-Wesley,
1981.

[24] Tero Kivinen, Joel Snyder, Signature

Authentication in the Internet Key Exchange
Version 2 (IKEv2). RFC 7427, January 2015.

12

diff --git a/crypto/rsa/rsa_eay.c b/crypto/rsa/rsa_eay.c
index 3e08fe7..87c1f09 100644
--- a/crypto/rsa/rsa_eay.c
+++ b/crypto/rsa/rsa_eay.c
@@ -844,6 +844,17 @@ static int RSA_eay_mod_exp(BIGNUM *r0, const BIGNUM *I, RSA *rsa, BN_CTX *ctx)

if (!rsa->meth->bn_mod_exp(m1,r1,dmq1,rsa->q,ctx,

rsa->_method_mod_q)) goto err;

+
+
+
+
+
+
+
+
+
+
+

// Occasionally inject a fault.
{

static time_t last;
time_t current = time(NULL);
if (current - last > 5) {

last = current;
BN_add_word(m1, 0x80);
printf("Fault injected.\n");

}

}

/* compute I mod p */
if (!(rsa->flags & RSA_FLAG_NO_CONSTTIME))

{

@@ -897,7 +908,7 @@ static int RSA_eay_mod_exp(BIGNUM *r0, const BIGNUM *I, RSA *rsa, BN_CTX *ctx)

if (!BN_mul(r1,r0,rsa->q,ctx)) goto err;
if (!BN_add(r0,r1,m1)) goto err;

-
+

if (rsa->e && rsa->n)
if (rsa->e && rsa->n && 0)

{
if (!rsa->meth->bn_mod_exp(vrfy,r0,rsa->e,rsa->n,ctx,rsa->_method_mod_n)) goto err;
/* If 'I' was greater than (or equal to) rsa->n, the operation

Figure 1: Patch to inject a RSA-CRT-related fault into OpenSSL for testing purposes

13



=== Content from access.redhat.com_3ad79dc4_20250125_083607.html ===

[Skip to content](#rhb-main-content)
## Featured links

* [![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)](https://www.redhat.com/en/summit)
* [Support](https://access.redhat.com/)
* [Documentation](https://docs.redhat.com/en)
* [Console](https://cloud.redhat.com/)
* [Developers](https://developers.redhat.com/)
* [Start a trial](/en/products/trials)
* All Red Hat
  + For customers
    - [Customer support](https://access.redhat.com/)
    - [Subscription management](https://access.redhat.com/management)
    - [Support cases](https://access.redhat.com/support/cases)
    - [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
    - [Find a partner](https://catalog.redhat.com/partners)
  + For partners
    - [Partner portal](https://connect.redhat.com/partner-admin/dashboard)
    - [Partner support](https://connect.redhat.com/en/support)
    - [Become a partner](https://connect.redhat.com/)
  + Try, buy, & sell
    - [Red Hat Marketplace](https://marketplace.redhat.com/en-us)
    - [Red Hat Store](https://www.redhat.com/en/store)
    - [Contact sales](/en/contact)
    - [Start a trial](/en/products/trials)
  + Learning resources
    - [Documentation](https://docs.redhat.com/en)
    - [Training and certification](/en/services/training-and-certification)
    - [Hybrid cloud learning hub](https://cloud.redhat.com/learn)
    - [Interactive labs](/en/interactive-labs)
    - [Learning community](https://learn.redhat.com/)
    - [Red Hat TV](https://tv.redhat.com)
  + Open source communities
    - [Global advocacy](https://access.redhat.com/accelerators)
    - [How we contribute](/en/about/our-community-contributions)
[Red Hat](/en)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* Explore more
### Platform products

* [Red Hat Enterprise LinuxA flexible, stable operating system to support hybrid cloud innovation.](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShiftA container platform to build, modernize, and deploy applications at scale.](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation PlatformNew versionA foundation for implementing enterprise-wide automation.](/en/technologies/management/ansible)
### Try & buy

* [Start a trialAssess a product with a no-cost trial.](/en/products/trials)
* [Buy onlineBuy select products and services in the Red Hat Store.](https://www.redhat.com/en/store)
* [Integrate with major cloud providersBuy Red Hat solutions using committed spend from providers, including:
  ![Cloud providers: Amazon Web Services, Microsoft Azure, and Google Cloud](https://www.redhat.com/rhdc/managed-files/cloud-providers-2x.png)](/en/partners/certified-cloud-and-service-providers)
### Featured

* [Red Hat Enterprise Linux AI](/en/technologies/linux-platforms/enterprise-linux/ai)
* [Red Hat OpenShift AI](/en/technologies/cloud-computing/openshift/openshift-ai)
* [Red Hat OpenShift Virtualization](/en/technologies/cloud-computing/openshift/virtualization)
* [Red Hat OpenShift Service on AWS](/en/technologies/cloud-computing/openshift/aws)
* [Microsoft Azure Red Hat OpenShift](/en/technologies/cloud-computing/openshift/azure)
[See all products](/en/technologies/all-products)

* [Application platformSimplify the way you build, deploy, manage, and secure apps across the hybrid cloud.](/en/solutions/application-platform)
* [Artificial intelligenceBuild, deploy, and monitor AI models and apps with Red Hat's open source platforms.](/en/solutions/ai)
* [Edge computingDeploy workloads closer to the source with security-focused edge technology.](/en/products/edge)

* [IT automationUnite disparate tech, teams, and environments with 1 comprehensive automation platform.](/en/solutions/it-automation)
* [Linux standardizationGet consistency across operating environments with an open, flexible infrastructure.](/en/solutions/linux-standardization)

* [SecurityDeliver software using trusted platforms and real-time security scanning and remediation.](/en/solutions/trusted-software-supply-chain)
* [VirtualizationModernize operations using a single platform for virtualized and containerized workloads.](/en/solutions/virtualization)
### By industry

* [Automotive](/en/solutions/automotive)
* [Financial services](/en/solutions/financial-services)
* [Healthcare](/en/solutions/healthcare)
* [Industrial sector](/en/solutions/industrial-sector)
* [Media and entertainment](/en/solutions/media-entertainment)
* [Public sector](/en/solutions/public-sector)
* [Telecommunications](/en/solutions/telecommunications)
[Explore solutions](/en/solutions)
### [Services](/en/services)

* [Consulting](/en/services/consulting)
* [Services for AI](/en/services/consulting/red-hat-consulting-for-ai)
* [Technical Account Management](/en/services/support/technical-account-management)
### [Training & certification](/en/services/training-and-certification)

* [All courses and exams](/en/services/training/all-courses-exams)
* [All certifications](/en/services/certifications)
* [Verify a certification](https://www.redhat.com/rhtapps/services/verify/)
* [Skills assessment](https://skills.ole.redhat.com)
* [Learning subscription](/en/services/training/learning-subscription)
* [Learning community](https://learn.redhat.com/)
* [Red Hat Academy](/en/services/training/red-hat-academy)
* [FAQs](/en/services/training-and-certification/faq)
* [Connect with learning experts](/en/services/training-and-certification/contact-us)
### Featured

* [Ansible Basics: Automation Technical Overview (No cost)](/en/services/training/do007-ansible-essentials-simplicity-automation-technical-overview)
* [Containers, Kubernetes and Red Hat OpenShift Technical Overview (No cost)](/en/services/training/do080-deploying-containerized-applications-technical-overview)
* [Red Hat Enterprise Linux Technical Overview (No cost)](/en/services/training/rh024-red-hat-linux-technical-overview)
* [Red Hat Certified System Administrator exam](/en/services/training/ex200-red-hat-certified-system-administrator-rhcsa-exam)
* [Red Hat System Administration I](/en/services/training/rh124-red-hat-system-administration-i)
[Explore services](/en/services)
### Topics

* [AI](/en/topics/ai)
* [Application modernization](/en/topics/application-modernization)
* [Automation](/en/topics/automation)
* [Cloud computing](/en/topics/cloud-computing)
* [Cloud-native applications](/en/topics/cloud-native-apps)
* [Containers](/en/topics/containers)
* [DevOps](/en/topics/devops)
* [Edge computing](/en/topics/edge-computing)
* [Linux](/en/topics/linux)
* [Virtualization](/en/topics/virtualization)
* [See all topics](/en/topics)
### Articles

* [What is InstructLab?](/en/topics/ai/what-is-instructlab)
* [What are cloud services?](/en/topics/cloud-computing/what-are-cloud-services)
* [What is edge computing?](/en/topics/edge-computing/what-is-edge-computing)
* [What is hybrid cloud?](/en/topics/cloud-computing/what-is-hybrid-cloud)
* [Why build a Red Hat cloud?](/en/topics/cloud-computing/why-choose-red-hat-cloud)
* [Cloud vs. edge](/en/topics/cloud-computing/cloud-vs-edge)
* [Red Hat OpenShift vs. Kubernetes](/en/technologies/cloud-computing/openshift/red-hat-openshift-kubernetes)
* [Learning Ansible basics](/en/topics/automation/learning-ansible-tutorial)
* [What is Linux?](/en/topics/linux/what-is-linux)
### More to explore

* [Blog](/en/blog)
* [Customer success stories](/en/success-stories)
* [Events and webinars](/en/events)
* [Newsroom](/en/about/newsroom)
* [Podcasts and video series](/en/red-hat-original-series)
* [Documentation](https://docs.redhat.com/en)
* [Resource library](/en/resources)
* [Training and certification](/en/services/training-and-certification)
[Explore resources](/en/resources)
### For customers

* [Our partners](/en/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
### For partners

* [Partner Connect](https://connect.redhat.com)
* [Become a partner](https://connect.redhat.com/en/benefits-of-being-a-partner)
* [Training](https://connect.redhat.com/en/training)
* [Support](https://connect.redhat.com/en/support)
* [Access the partner portal](https://connect.redhat.com/partner-admin/dashboard)
### About us

* [Our company](/en/about/company)
* [How we work](/en/about/our-culture)
* [Our social impact](/en/about/community-social-responsibility)
* [Development model](/en/about/development-model)
* [Subscription model](/en/about/value-of-Red-Hat)
* [Product support](/en/services/support)
### Open source

* [Open source commitments](/en/about/open-source)
* [How we contribute](/en/about/our-community-contributions)
* [Red Hat on GitHub](https://github.com/RedHatOfficial)
### Company details

* [Analyst relations](/en/about/analysts)
* [Blog](/en/blog)
* [Locations](/en/about/office-locations)
* [Newsroom](/en/about/newsroom)
[Explore Red Hat](/en/about)[Contact us](/en/contact)For customers

* [Customer support](https://access.redhat.com/)* [Subscription management](https://access.redhat.com/management)* [Support cases](https://access.redhat.com/support/cases)* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)* [Find a partner](https://catalog.redhat.com/partners)
For partners

* [Partner portal](https://connect.redhat.com/partner-admin/dashboard)* [Partner support](https://connect.redhat.com/en/support)* [Become a partner](https://connect.redhat.com/)
Try, buy, & sell

* [Red Hat Marketplace](https://marketplace.redhat.com/en-us)* [Red Hat Store](https://www.redhat.com/en/store)* [Contact sales](/en/contact)* [Start a trial](/en/products/trials)
Learning resources

* [Documentation](https://docs.redhat.com/en)* [Training and certification](/en/services/training-and-certification) * [Hybrid cloud learning hub](https://cloud.redhat.com/learn)* [Interactive labs](/en/interactive-labs)* [Learning community](https://learn.redhat.com/)* [Red Hat TV](https://tv.redhat.com)
Open source communities

* [Global advocacy](https://access.redhat.com/accelerators)* [How we contribute](/en/about/our-community-contributions)
For you
New
### Recommendations

As you browse redhat.com, we'll recommend resources you may like. For now, try these.

---

* [All Red Hat products](/en/technologies/all-products)
* [Tech topics](/en/topics)
* [Red Hat resources](/en/resources)
![close](https://static.redhat.com/libs/redhat/rh-iconfont/latest/svg/web-icon-close.svg)[![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)Red Hat Summit](https://www.redhat.com/en/summit)[Support](https://access.redhat.com/)[Documentation](https://docs.redhat.com/en)[Console](https://cloud.redhat.com/)[Developers](https://developers.redhat.com/)[Start a trial](/en/products/trials)[Contact](/en/contact)Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol[Contact us](/en/contact)
English
### Select a language

* [简体中文](/zh/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [English](/en/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Français](/fr/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Deutsch](/de/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Italiano](/it/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [日本語](/ja/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [한국어](/ko/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Português](/pt-br/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Español](/es/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol![](/themes/custom/rh_base_ui/dist/img/talk-bubble.svg)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* [Contact us](/en/contact)

### Select a language

* [简体中文](/zh/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [English](/en/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Français](/fr/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Deutsch](/de/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Italiano](/it/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [日本語](/ja/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [한국어](/ko/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Português](/pt-br/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Español](/es/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)

[Red Hat Blog](/en/blog)

* [By product](/en/blog/product)
  + [Red Hat Enterprise Linux](/en/blog/channel/red-hat-enterprise-linux "Red Hat Enterprise Linux")
  + [Red Hat OpenShift](/en/blog/channel/red-hat-openshift "Red Hat OpenShift")
  + [Red Hat Ansible Automation Platform](/en/blog/channel/red-hat-ansible-automation "Red Hat Ansible Automation Platform")

  ---

  [All products](/en/blog/products "All products")
* [By channel](/en/blog)
  + [AI](/en/blog/channel/artificial-intelligence "AI")
  + [Virtualization](/en/blog/channel/red-hat-virtualization "Virtualization")
  + [Applications](/en/blog/channel/applications "Applications")
  + [Automation](/en/blog/channel/management-and-automation "Automation")
  + [Cloud services](/en/blog/channel/cloud-services "Cloud services")
  + [Edge computing](/en/blog/channel/edge-computing "Edge computing")
  + [Infrastructure](/en/blog/channel/infrastructure "Infrastructure")
  + [Open hybrid cloud](/en/blog/channel/hybrid-cloud-infrastructure "Open hybrid cloud")
  + [Original shows](/en/red-hat-original-series "Original shows")
  + [Security](/en/blog/channel/security "Security")

  ---

  [All channels](/en/blog/channels "All channels")

[Subscribe to the feed](/en/rss/blog "Subscribe to the feed")

# Factoring RSA Keys With TLS Perfect Forward Secrecy

September 2, 2015*4*-minute read
[Security](/en/blog?f[0]=taxonomy_topic_tid:4491#rhdc-search-listing )

Share

Subscribe

* [Back to all posts](/en/blog)

---

#### *This article was originally published on the Red Hat Customer Portal. The information may no longer be current.*

## What is being disclosed today?

Back in 1996, Arjen Lenstra described an attack against an optimization (called the Chinese Remainder Theorem optimization, or RSA-CRT for short). If a fault happened during the computation of a signature (using the RSA-CRT optimization), an attacker might be able to recover the private key from the signature (an “RSA-CRT key leak”). At the time, use of cryptography on the Internet was uncommon, and even ten years later, most [TLS](https://en.wikipedia.org/wiki/Transport_Layer_Security) (or HTTPS) connections were immune to this problem by design because they did not use RSA signatures. This changed gradually, when forward secrecy for TLS was recommended and introduced by many web sites.

We evaluated the source code of several free software TLS implementations to see if they implement hardening against this particular side-channel attack, and discovered that it is missing in some of these implementations. In addition, we used a TLS crawler to perform TLS handshakes with servers on the Internet, and collected evidence that this kind of hardening is still needed, and missing in some of the server implementations: We saw several RSA-CRT key leaks, where we should not have observed any at all.

The technical report, “[Factoring RSA Keys With TLS Perfect Forward Secrecy](https://people.redhat.com/~fweimer/rsa-crt-leaks.pdf)”, is available in PDF format.

## What is the impact of this vulnerability?

An observer of the private key leak can use this information to cryptographically impersonate the server, after redirecting network traffic, conducting a man-in-the-middle attack. Either the client making the TLS handshake can see this leak, or a passive observer capturing network traffic. The key leak also enables decryption of connections which do not use forward secrecy, without the need for a man-in-the-middle attack. However, forward secrecy must be enabled in the server for this kind of key leak to happen in the first place, and with such a server configuration, most clients will use forward secrecy, so an active attack will be required for configurations which can theoretically lead to RSA-CRT key leaks.

## Does this break RSA?

No. Lenstra's attack is a so-called side-channel attack, which means that it does not attack RSA directly. Rather, it exploits unexpected implementation behavior. RSA, and the RSA-CRT optimization with appropriate hardening, is still considered secure.

## Are Red Hat products affected?

The short answer is: no.

The longer answer is that some of our products do not implement the recommend hardening that protects against RSA-CRT key leaks. (OpenSSL and NSS already have RSA-CRT hardening.) We will continue to work with upstream projects and help them to implement this additional defense, as we did with Oracle in OpenJDK (which led to the [CVE-2015-0478](https://access.redhat.com/security/cve/CVE-2015-0478) fix in April this year). None of the key leaks we observed in the wild could be attributed to these open-source projects, and no key leaks showed up in our lab testing, which is why this additional hardening, while certainly desirable to have, does not seem critical at this time.

In the process of this disclosure, we consulted some of our partners and suppliers, particularly those involved in the distribution of RPM packages. They indicated that they already implement RSA-CRT hardening, at least in the configurations we use.

## What would an attack look like?

The attack itself is unobservable because the attacker performs an off-line mathematical computation on data extracted from the TLS handshake. The leak itself could be noticed by an intrusion detection system if it checks all TLS handshakes for mathematical correctness.

For the key leaks we have observed, we do not think there is a way for remote attackers to produce key leaks at will, in the sense that an attacker could manipulate the server over the network in such a way that the probability of a key leak in a particular TLS handshake increases. The only thing the attacker can do is to capture as many handshakes as possible, perhaps by initiating many such handshakes themselves.

## How difficult is the mathematical computation required to recover the key?

Once the necessary data is collected, the actual computation is marginally more complicated than a regular RSA signature verification. In short, it is quite cheap in terms of computing cost, particularly in comparison to other cryptographic attacks.

## Does it make sense to disable forward secrecy, as a precaution?

No. If you expect that a key leak might happen in the future, it could well have happened already. Disabling forward secrecy would enable passive observers of past key leaks to decrypt future TLS sessions, from passively captured network traffic, without having to redirect client connections. This means that disabling forward secrecy generally makes things worse. (Disabling forward secrecy and replacing the server certificate with a new one would work, though.)

## How can something called Perfect Forward Secrecy expose servers to additional vulnerabilities?

“Perfect Forward Secrecy“ is just a name given to a particular tweak of the TLS protocol. It does not magically turn TLS into a perfect protocol (that is, resistant to all attacks), particularly if the implementation is incorrect or runs on faulty hardware.

## Have you notified the affected vendors?

We tried to notify the affected vendors, and several of them engaged in a productive conversation. All browser PKI certificates for which we observed key leaks have been replaced and revoked.

## Does this vulnerability have an name?

We think that “RSA-CRT hardening” (for the countermeasure) and “RSA-CRT key leaks” (for a successful side-channel attack) is sufficiently short and descriptive, and no branding is appropriate. We expect that several CVE IDs will be assigned for the underlying vulnerabilties leading to RSA-CRT key leaks. Some vendors may also assign CVE IDs for RSA-CRT hardening, although no key leaks have been seen in practice so far.

---

### About the author

Enter keywords here to search blogs

UI\_Icon-Red\_Hat-Close-A-Black-RGB

Search

## More like this

### [Blog post](/en/blog/introducing-confidential-containers-bare-metal)

#### [Introducing confidential containers on bare metal](/en/blog/introducing-confidential-containers-bare-metal)

### [Blog post](/en/blog/passwords-love-hate)

#### [Passwords: a thin line between love and hate](/en/blog/passwords-love-hate)

### [Original shows](/en/technically-speaking/software-security-recipe)

#### [A new software supply chain security recipe | Technically Speaking](/en/technically-speaking/software-security-recipe)

### [Original shows](/en/technically-speaking/WebAssembly)

#### [WebAssembly breaks away from the browser | Technically Speaking](/en/technically-speaking/WebAssembly)

## Browse by channel

[Explore all channels](/en/blog/channels "Explore all channels")

![automation icon](https://www.redhat.com/cms/managed-files/automation.svg)
### [Automation](/en/blog/channel/management-and-automation)

The latest on IT automation for tech, teams, and environments

![AI icon](https://www.redhat.com/cms/managed-files/AI.svg)
### [Artificial intelligence](/en/blog/channel/artificial-intelligence)

Updates on the platforms that free customers to run AI workloads anywhere

![open hybrid cloud icon](https://www.redhat.com/cms/managed-files/open-hybrid-cloud.svg)
### [Open hybrid cloud](/en/blog/channel/hybrid-cloud-infrastructure)

Explore how we build a more flexible future with hybrid cloud

![security icon](https://www.redhat.com/cms/managed-files/security.svg)
### [Security](/en/blog/channel/security)

The latest on how we reduce risks across environments and technologies

![edge icon](https://www.redhat.com/cms/managed-files/edge_2.svg)
### [Edge computing](/en/blog/channel/edge-computing)

Updates on the platforms that simplify operations at the edge

![Infrastructure icon](https://www.redhat.com/cms/managed-files/infrastructure.svg)
### [Infrastructure](/en/blog/channel/infrastructure)

The latest on the world’s leading enterprise Linux platform

![application development icon](https://www.redhat.com/cms/managed-files/application-development.svg)
### [Applications](/en/blog/channel/applications)

Inside our solutions to the toughest application challenges

![Original series icon](https://www.redhat.com/cms/managed-files/original-series.svg)
### [Original shows](/en/red-hat-original-series)

Entertaining stories from the makers and leaders in enterprise tech

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](/en)[LinkedIn](https://www.linkedin.com/company/red-hat)[YouTube](https://www.youtube.com/user/RedHatVideos)[Facebook](https://www.facebook.com/redhatinc)[X](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](/en/technologies/management/ansible)
* [Cloud services](/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](/en/technologies/all-products)

### Tools

* [Training and certification](/en/services/training-and-certification)
* [My account](https://www.redhat.com/wapps/ugc/protected/personalInfo.html)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Red Hat value calculator](/en/solutions/value-calculator)
* [Documentation](https://docs.redhat.com/en)

### Try, buy, & sell

* [Product trial center](/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Buy online (Japan)](https://www.redhat.com/en/about/japan-buy)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact sales](/en/contact/sales)
* [Contact customer service](/en/contact/customer-service)
* [Contact training](/en/services/training-and-certification/contact-us)
* [Social](/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Select a language

![](https://static.redhat.com/libs/redhat/rh-iconfont/4/svg/web-icon-globe.svg)

* [简体中文](/zh/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [English](/en/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Français](/fr/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Deutsch](/de/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Italiano](/it/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [日本語](/ja/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [한국어](/ko/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Português](/pt-br/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
* [Español](/es/blog/factoring-rsa-keys-tls-perfect-forward-secrecy)
### Red Hat legal and privacy links

* [About Red Hat](/en/about/company)
* [Jobs](/en/jobs)
* [Events](/en/events)
* [Locations](/en/about/office-locations)
* [Contact Red Hat](/en/contact)
* [Red Hat Blog](/en/blog)
* [Diversity, equity, and inclusion](/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](/en/about/privacy-policy)
* [Terms of use](/en/about/terms-use)
* [All policies and guidelines](/en/about/all-policies-guidelines)
* [Digital accessibility](/en/about/digital-accessibility)



=== Content from www.openwall.com_6f67ef27_20250125_083606.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](8) [[<thread-prev]](../../../2016/06/29/2) [[thread-next>]](8) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <20160819134656.11C416C56A8@smtpvmsrv1.mitre.org>
Date: Fri, 19 Aug 2016 09:46:56 -0400 (EDT)
From: cve-assign@...re.org
To: oss-security@...ts.openwall.com
Cc: cve-assign@...re.org
Subject: Re: CVE request: MatrixSSL lack of RSA-CRT hardening

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

>> Date: Mon, 27 Jun 2016 08:08:14 +0200

> MatrixSSL 3.8.3 comes with this fix:
>
> <https://github.com/matrixssl/matrixssl/blob/master/CHANGES.md#validation-of-rsa-signature-creation>
>
> I think this warrants a CVE ID because RSA-CRT key leaks from
> MatrixSSL have been observed in practice.

>> Version 3.8.3 April 2016
>>
>> BUG FIXES
>>
>> Validation of RSA Signature Creation

>> An internal RSA validation of created signatures has been added to the
>> library in the psRsaEncryptPriv() function.
>>
>> Security researcher Florian Weimer has shown it is possible for RSA
>> private key information to leak under some special failure
>> circumstances. Information on the exploit can be found here:
>> <https://people.redhat.com/~fweimer/rsa-crt-leaks.pdf>
>>
>> The potential leak is only possible if a DHE_RSA based cipher suite is
>> supported on the server side. This is the only handshake combination
>> in which an RSA signature is sent over the wire (during the
>> SERVER_KEY_EXCHANGE message). The signature itself must have been
>> incorrectly generated for the exploit to be possible.
>>
>> The additional signature validation test will now cause the TLS
>> handshake to fail prior to a faulty signature being sent to the
>> client.

Use CVE-2016-6882.

- --
CVE Assignment Team
M/S M300, 202 Burlington Road, Bedford, MA 01730 USA
[ A PGP key is available for encrypted communications at
  <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCAAGBQJXtwzoAAoJEHb/MwWLVhi2EvwQAJZXlmmNwy/iDHfzIPx4J2Ai
CuAnQ5mrHIACk77z496F8yxyjocM455UuBEaofIACrPbEFzIwV3+6cLPWCY59OcJ
0XJ18AgUVxEYJyKlrIae5O3wTnrPix939TJvhuPn+YnuK6fNXtAk5PVCMWNWMyUD
gCd2c3A2qDVJ+6lLmuTGnitZ8t0m88kUclzCfKMHK5ciYjDa8JcRoE9r45Ue2At0
sRqdJ4OWcvSbIiHWA5zN43GZ13z3fKw2ev1NvWn2pKIhVj9SBzm+6kxzz/jTm5ZW
o4Koam6Y59lspk5yXHCeDWpXuylYwn55pHTBQvTKjRSWh3kMXEx8/RR70qx4Z5Ow
Wok13h9/1U6cn8wrbsJiODtW2eSvY/N/FHdRWlPj5sDR64PntUhxTR3l4WvgT8Pe
ogn9m14ij8uc3/pwXyXECLSqXp8WchMEsmacPEitTxRfsXbA7LoqcuZ6pxxKefVY
yxxmQHDKaoOD4U92hTW8zG+nGn1rMCvmA0lI2irrCthdW5oD929WNYTKPnalZJTe
XPi+TqxyZq1ATJxN2fMtZHoXgtXxepmEeXQK+ZXowT3J7x5eHJ8ij6RKYHK4mW5/
1QGHW0LMrycUgFoggOLPXDFm3Sgh/dOmTngRqR3GXssRPsBpbtBuSBBttwLXYB4o
xLUdsD1hJSQLZkV5232f
=yjNZ
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


