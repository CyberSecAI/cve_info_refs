=== Content from www.openwall.com_fa98cf98_20250124_113524.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2016/08/10/2) [[next>]](2) [[thread-next>]](../../../2016/08/19/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CABuU+O1eQnw21SVtGAf6YQyqEPpm=f4ntDLT0O9k37w9-fZ-MQ@mail.gmail.com>
Date: Thu, 11 Aug 2016 12:49:25 +0200
From: "F. Alonso" <rs@...skills.cz>
To: oss-security@...ts.openwall.com
Cc: CVE ID Requests <cve-assign@...re.org>
Subject: CVE Requests Facebook HHVM

Hi,

The following commits patched several security flaws that I recently
reported to Facebook's complete toolchain for the PHP language, HHVM [1]
version 3.14.2 and 3.14.3.

Could you assing CVEs for those issues?

-Fix out of bounds write access in
mb_detect_encoding, mb_send_mail, mb_detect_order.
<https://github.com/facebook/hhvm/commit/365abe807cab2d60dc9ec307292a06181f77a9c2>

-Fix buffer overrun due to integer overflow in bcmath
<https://github.com/facebook/hhvm/commit/c00fc9d3003eb06226b58b6a48555f1456ee2475>

-Fix integer overflow in StringUtil::implode
<https://github.com/facebook/hhvm/commit/2c9a8fcc73a151608634d3e712973d192027c271>

-Fix self recursion in compact
<https://github.com/facebook/hhvm/commit/e264f04ae825a5d97758130cf8eec99862517e7e>

-Fix recursion checks in array_*_recursive
<https://github.com/facebook/hhvm/commit/05e706d98f748f609b19d8697e490eaab5007d69>

-Fix infinite recursion in wddx
<https://github.com/facebook/hhvm/commit/1888810e77b446a79a7674784d5f139fcfa605e2>

[1] <https://github.com/facebook/hhvm>

Thank you,

--

Francisco Alonso.
<http://twitter.com/revskills>
PGP: 0xE2E64DCA
--

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_826b2145_20250124_113524.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2016/08/18/24) [[next>]](2) [[<thread-prev]](../../../2016/08/11/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <20160819001841.A0F926DC092@smtpvmsrv1.mitre.org>
Date: Thu, 18 Aug 2016 20:18:41 -0400 (EDT)
From: cve-assign@...re.org
To: rs@...skills.cz
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: CVE Requests Facebook HHVM

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

> -Fix out of bounds write access in
> mb_detect_encoding, mb_send_mail, mb_detect_order.
> <https://github.com/facebook/hhvm/commit/365abe807cab2d60dc9ec307292a06181f77a9c2>

Use CVE-2016-6870. The scope of this CVE is all of the incorrect uses
of strndup that were fixed in this commit. The commit message
references t11337047, which possibly is a bug that was discovered much
earlier. However, because we don't know of any earlier public
disclosure of t11337047, there isn't a separate CVE ID for t11337047.

> -Fix buffer overrun due to integer overflow in bcmath
> <https://github.com/facebook/hhvm/commit/c00fc9d3003eb06226b58b6a48555f1456ee2475>

Use CVE-2016-6871.

> -Fix integer overflow in StringUtil::implode
> <https://github.com/facebook/hhvm/commit/2c9a8fcc73a151608634d3e712973d192027c271>

Use CVE-2016-6872.

> -Fix self recursion in compact
> <https://github.com/facebook/hhvm/commit/e264f04ae825a5d97758130cf8eec99862517e7e>

Use CVE-2016-6873.

> -Fix recursion checks in array_*_recursive
> <https://github.com/facebook/hhvm/commit/05e706d98f748f609b19d8697e490eaab5007d69>

Use CVE-2016-6874.

> -Fix infinite recursion in wddx
> <https://github.com/facebook/hhvm/commit/1888810e77b446a79a7674784d5f139fcfa605e2>

Use CVE-2016-6875.

- --
CVE Assignment Team
M/S M300, 202 Burlington Road, Bedford, MA 01730 USA
[ A PGP key is available for encrypted communications at
  <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCAAGBQJXtk/uAAoJEHb/MwWLVhi2OFwP/Aig7rJ2rCVEyv+/KwDJBC+a
ufukAbNgsFbzHChTJxntRrWS3PJt7DKkZ4a2wlPzdUd4rQKGFObmMMm4OIWw2xaj
TiBngAelDRJNDNP/ZmkEySj9RGS33UMg+6QnI5pOFI3r7uXIqBau+cjIyq3diqUC
NFlaiFy2TcIb82bYRET3r4SIk8019uaP2rfN5CDLKuNPpYIM3d/Xo0490MwufTHh
QyTiFtFDwsZdtCQz5wFR949Lt+B6rEFdhzYDaqjJr9We6POxvy799/8LUI2UGtwN
P6UiCzS1o/ybx6QCh+Lx7wDNBuT/3t0aeFhWx1FJuFodtF9yiILMxD4BpaARlnva
4Nv/+TNhCmcGGLyE3wCrcAVeCX/QcsAaM9fXYVGy2SuqRmljW7sQIhpkaCIzQCwq
EEGCZMeqPBZ1pMlIJgKmWa0PvKfkv0nDtNhQqNN57hS3YcePE8rShO7+/HYRQaYL
zMe8u6OWVZr432Iwcia1Zjxnmi6ix1g3Ua8gz8oWAGrvw5/6T0gEzRyz+OB79+y+
3OKeE/GDQA/aVRutZciQrrHT30uzkgwtoAQdafur5Cna0cEqRQnclcwFxUfPdpr4
qJJFWH2vmPncge0xx2auUaDv8+7OBOonUvlmEWIfowSdg66D0Qm6EyqN6UNZqm5a
tVSy0zt3nnIATS36SGDd
=tBiw
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_5db1e3da_20250126_005231.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fhhvm%2Fcommit%2F05e706d98f748f609b19d8697e490eaab5007d69)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fhhvm%2Fcommit%2F05e706d98f748f609b19d8697e490eaab5007d69)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=facebook%2Fhhvm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[facebook](/facebook)
/
**[hhvm](/facebook/hhvm)**
Public

* [Notifications](/login?return_to=%2Ffacebook%2Fhhvm) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Ffacebook%2Fhhvm)
* [Star
   18.3k](/login?return_to=%2Ffacebook%2Fhhvm)

* [Code](/facebook/hhvm)
* [Issues
  453](/facebook/hhvm/issues)
* [Pull requests
  85](/facebook/hhvm/pulls)
* [Discussions](/facebook/hhvm/discussions)
* [Actions](/facebook/hhvm/actions)
* [Wiki](/facebook/hhvm/wiki)
* [Security](/facebook/hhvm/security)
* [Insights](/facebook/hhvm/pulse)

Additional navigation options

* [Code](/facebook/hhvm)
* [Issues](/facebook/hhvm/issues)
* [Pull requests](/facebook/hhvm/pulls)
* [Discussions](/facebook/hhvm/discussions)
* [Actions](/facebook/hhvm/actions)
* [Wiki](/facebook/hhvm/wiki)
* [Security](/facebook/hhvm/security)
* [Insights](/facebook/hhvm/pulse)

## Commit

[Permalink](/facebook/hhvm/commit/05e706d98f748f609b19d8697e490eaab5007d69)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix recursion checks in array\_\*\_recursive

[Browse files](/facebook/hhvm/tree/05e706d98f748f609b19d8697e490eaab5007d69)
Browse the repository at this point in the history

```
Summary:
array_merge_recursive and array_replace_recursive do recursion checks,
but use the fact that normal arrays can't contain cycles except
through references to avoid most of the checking.

Unfortunately the $GLOBALS array is special, and /can/ contain cycles
without references, and ProxyArrays could potentially do the same (via
an as-yet unimplemented extension).

Reviewed By: mxw

Differential Revision: D3622612

fbshipit-source-id: ed90b747096a05919a80c4793e2a2b7c57584d56
```

* Loading branch information

mwilliams@fb.com
authored and
Hhvm Bot
committed
Aug 1, 2016

1 parent
[f7ae929](/facebook/hhvm/commit/f7ae929354165357b0a8fd0a8315d19291d89bf8)

commit 05e706d

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**58 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* hphp

  + runtime/ext/array

    - hphp/runtime/ext/array/ext\_array.cpp
      [ext\_array.cpp](#diff-e3d59c78e254d6d8ddce89c5ba6110e0df3ddbdba3300ffb91b7a878f7e60cad)
  + test/slow/array\_functions

    - hphp/test/slow/array\_functions/self\_recursive.php
      [self\_recursive.php](#diff-0154da328a3e1979efea1642a93fea5f37d31863107617130dd586ddf5b1d781)
    - hphp/test/slow/array\_functions/self\_recursive.php.expectf
      [self\_recursive.php.expectf](#diff-8f9fa1deb69004473d3233cd3fa93e3ebdbe36a449eb8947f23bf64452f455a1)

## There are no files selected for viewing

41 changes: 26 additions & 15 deletions

41
[hphp/runtime/ext/array/ext\_array.cpp](#diff-e3d59c78e254d6d8ddce89c5ba6110e0df3ddbdba3300ffb91b7a878f7e60cad "hphp/runtime/ext/array/ext_array.cpp")

Show comments

[View file](/facebook/hhvm/blob/05e706d98f748f609b19d8697e490eaab5007d69/hphp/runtime/ext/array/ext_array.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -379,14 +379,17 @@ static void php\_array\_merge(Array &arr1, const Array& arr2) { |
|  |  | arr1.merge(arr2); |
|  |  | } |
|  |  |  |
|  |  | static bool couldRecur(const Variant& v, const Array& arr) { |
|  |  | return v.isReferenced() || |
|  |  | arr.get()->kind() == ArrayData::kGlobalsKind || |
|  |  | arr.get()->kind() == ArrayData::kProxyKind; |
|  |  | } |
|  |  |  |
|  |  | static void php\_array\_merge\_recursive(PointerSet &seen, bool check, |
|  |  | Array &arr1, const Array& arr2) { |
|  |  | if (check) { |
|  |  | if (seen.find((void\*)arr1.get()) != seen.end()) { |
|  |  | raise\_warning("array\_merge\_recursive(): recursion detected"); |
|  |  | return; |
|  |  | } |
|  |  | seen.insert((void\*)arr1.get()); |
|  |  | if (check && !seen.insert((void\*)arr1.get()).second) { |
|  |  | raise\_warning("array\_merge\_recursive(): recursion detected"); |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | for (ArrayIter iter(arr2); iter; ++iter) { |
| Expand All | | @@ -399,7 +402,9 @@ static void php\_array\_merge\_recursive(PointerSet &seen, bool check, |
|  |  | // in the array. |
|  |  | Variant &v = arr1.lvalAt(key, AccessFlags::Key); |
|  |  | auto subarr1 = v.toArray().copy(); |
|  |  | php\_array\_merge\_recursive(seen, v.isReferenced(), subarr1, |
|  |  | php\_array\_merge\_recursive(seen, |
|  |  | couldRecur(v, subarr1), |
|  |  | subarr1, |
|  |  | value.toArray()); |
|  |  | v.unset(); // avoid contamination of the value that was strongly bound |
|  |  | v = subarr1; |
| Expand Down  Expand Up | | @@ -566,12 +571,18 @@ static void php\_array\_replace(Array &arr1, const Array& arr2) { |
|  |  |  |
|  |  | static void php\_array\_replace\_recursive(PointerSet &seen, bool check, |
|  |  | Array &arr1, const Array& arr2) { |
|  |  | if (check) { |
|  |  | if (seen.find((void\*)arr1.get()) != seen.end()) { |
|  |  | raise\_warning("array\_replace\_recursive(): recursion detected"); |
|  |  | return; |
|  |  | } |
|  |  | seen.insert((void\*)arr1.get()); |
|  |  | if (arr1.get() == arr2.get()) { |
|  |  | // This is an optimization, but it also avoids an assert in |
|  |  | // setWithRef (Variant::setWithRef asserts that its source |
|  |  | // and destination are not the same). |
|  |  | // If the arrays are self recursive, this does change the behavior |
|  |  | // slightly - it skips the "recursion detected" warning. |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | if (check && !seen.insert((void\*)arr1.get()).second) { |
|  |  | raise\_warning("array\_replace\_recursive(): recursion detected"); |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | for (ArrayIter iter(arr2); iter; ++iter) { |
| Expand All | | @@ -582,8 +593,8 @@ static void php\_array\_replace\_recursive(PointerSet &seen, bool check, |
|  |  | if (v.isArray()) { |
|  |  | Array subarr1 = v.toArray(); |
|  |  | const ArrNR& arr\_value = value.toArrNR(); |
|  |  | php\_array\_replace\_recursive(seen, v.isReferenced(), subarr1, |
|  |  | arr\_value); |
|  |  | php\_array\_replace\_recursive(seen, couldRecur(v, subarr1), |
|  |  | subarr1, arr\_value); |
|  |  | v = subarr1; |
|  |  | } else { |
|  |  | arr1.set(key, value, true); |
| Expand Down | |  |

20 changes: 20 additions & 0 deletions

20
[hphp/test/slow/array\_functions/self\_recursive.php](#diff-0154da328a3e1979efea1642a93fea5f37d31863107617130dd586ddf5b1d781 "hphp/test/slow/array_functions/self_recursive.php")

Show comments

[View file](/facebook/hhvm/blob/05e706d98f748f609b19d8697e490eaab5007d69/hphp/test/slow/array_functions/self_recursive.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,20 @@ |
|  |  | <?php |
|  |  |  |
|  |  | function test($g) { |
|  |  | $GLOBALS['g'] = $GLOBALS; |
|  |  |  |
|  |  | array\_replace\_recursive($GLOBALS, $g); |
|  |  |  |
|  |  | $GLOBALS['g'] = $GLOBALS; |
|  |  | array\_merge\_recursive($GLOBALS, $g); |
|  |  | } |
|  |  |  |
|  |  | function main() { |
|  |  | $a = array(); |
|  |  | $a['g'] = &$a; |
|  |  |  |
|  |  | test($a); |
|  |  | test($GLOBALS); |
|  |  | } |
|  |  |  |
|  |  | main(); |

12 changes: 12 additions & 0 deletions

12
[hphp/test/slow/array\_functions/self\_recursive.php.expectf](#diff-8f9fa1deb69004473d3233cd3fa93e3ebdbe36a449eb8947f23bf64452f455a1 "hphp/test/slow/array_functions/self_recursive.php.expectf")

Show comments

[View file](/facebook/hhvm/blob/05e706d98f748f609b19d8697e490eaab5007d69/hphp/test/slow/array_functions/self_recursive.php.expectf)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,12 @@ |
|  |  |  |
|  |  | Warning: array\_replace\_recursive(): recursion detected in %s/test/slow/array\_functions/self\_recursive.php on line 6 |
|  |  |  |
|  |  | Warning: array\_merge\_recursive(): recursion detected in %s/test/slow/array\_functions/self\_recursive.php on line 9 |
|  |  |  |
|  |  | Warning: array\_merge\_recursive(): recursion detected in %s/test/slow/array\_functions/self\_recursive.php on line 9 |
|  |  |  |
|  |  | Warning: array\_merge\_recursive(): recursion detected in %s/test/slow/array\_functions/self\_recursive.php on line 9 |
|  |  |  |
|  |  | Warning: array\_merge\_recursive(): recursion detected in %s/test/slow/array\_functions/self\_recursive.php on line 9 |
|  |  |  |
|  |  | Warning: array\_merge\_recursive(): recursion detected in %s/test/slow/array\_functions/self\_recursive.php on line 9 |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `05e706d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fhhvm%2Fcommit%2F05e706d98f748f609b19d8697e490eaab5007d69) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_aafe73a0_20250126_005230.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fhhvm%2Fcommit%2F1888810e77b446a79a7674784d5f139fcfa605e2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fhhvm%2Fcommit%2F1888810e77b446a79a7674784d5f139fcfa605e2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=facebook%2Fhhvm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[facebook](/facebook)
/
**[hhvm](/facebook/hhvm)**
Public

* [Notifications](/login?return_to=%2Ffacebook%2Fhhvm) You must be signed in to change notification settings
* [Fork
  3k](/login?return_to=%2Ffacebook%2Fhhvm)
* [Star
   18.3k](/login?return_to=%2Ffacebook%2Fhhvm)

* [Code](/facebook/hhvm)
* [Issues
  453](/facebook/hhvm/issues)
* [Pull requests
  85](/facebook/hhvm/pulls)
* [Discussions](/facebook/hhvm/discussions)
* [Actions](/facebook/hhvm/actions)
* [Wiki](/facebook/hhvm/wiki)
* [Security](/facebook/hhvm/security)
* [Insights](/facebook/hhvm/pulse)

Additional navigation options

* [Code](/facebook/hhvm)
* [Issues](/facebook/hhvm/issues)
* [Pull requests](/facebook/hhvm/pulls)
* [Discussions](/facebook/hhvm/discussions)
* [Actions](/facebook/hhvm/actions)
* [Wiki](/facebook/hhvm/wiki)
* [Security](/facebook/hhvm/security)
* [Insights](/facebook/hhvm/pulse)

## Commit

[Permalink](/facebook/hhvm/commit/1888810e77b446a79a7674784d5f139fcfa605e2)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix infinite recursion in wddx

[Browse files](/facebook/hhvm/tree/1888810e77b446a79a7674784d5f139fcfa605e2)
Browse the repository at this point in the history

```
Summary:
It wasn't checking for infinite recursion due to references or self-referential
objects. As it turns out closures always return themselves when converted to an
array. Raising a warning and returning is how PHP-src deals with this problem,
nothing special is done for closures.

Reviewed By: alexmalyshev

Differential Revision: D3465655

fbshipit-source-id: a42bc34d30cf4825faf33596139c0c05f8e4f5f1
```

* Loading branch information

[![@Orvid](https://avatars.githubusercontent.com/u/709247?s=40&v=4)](/Orvid)

[Orvid](/facebook/hhvm/commits?author=Orvid "View all commits by Orvid")
authored and
Hhvm Bot
committed
Aug 1, 2016

1 parent
[999e2f1](/facebook/hhvm/commit/999e2f1166ecb27e2333958d9eb5026154eccf09)

commit 1888810

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**54 additions**
and
**9 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* hphp

  + runtime/ext/wddx

    - hphp/runtime/ext/wddx/ext\_wddx.cpp
      [ext\_wddx.cpp](#diff-7417aa531c88744cfde99b6a70f9c26c1399b7521942429f442a40817cdcdbd4)
    - hphp/runtime/ext/wddx/ext\_wddx.h
      [ext\_wddx.h](#diff-13114cbb17b5b3c0fbbd8992c06233f8984d999e081ca89a4a76e80eb8caec1a)
  + test/slow/ext\_wddx

    - hphp/test/slow/ext\_wddx/recursion.php
      [recursion.php](#diff-e637e672a44948be11d5b1565578621b51ee254840833e97cf9c0ec392875bba)
    - hphp/test/slow/ext\_wddx/recursion.php.expectf
      [recursion.php.expectf](#diff-008fa0941274095e8523ca4f71c2702d3a6050a2fd865b28d5800e95f85b79fe)

## There are no files selected for viewing

37 changes: 29 additions & 8 deletions

37
[hphp/runtime/ext/wddx/ext\_wddx.cpp](#diff-7417aa531c88744cfde99b6a70f9c26c1399b7521942429f442a40817cdcdbd4 "hphp/runtime/ext/wddx/ext_wddx.cpp")

Show comments

[View file](/facebook/hhvm/blob/1888810e77b446a79a7674784d5f139fcfa605e2/hphp/runtime/ext/wddx/ext_wddx.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -66,22 +66,43 @@ bool WddxPacket::serialize\_value(const Variant& varVariant) { |
|  |  | bool WddxPacket::recursiveAddVar(const String& varName, |
|  |  | const Variant& varVariant, |
|  |  | bool hasVarTag) { |
|  |  | SeenContainers seen; |
|  |  | return recursiveAddVarImpl(varName, varVariant, hasVarTag, seen); |
|  |  | } |
|  |  |  |
|  |  | bool WddxPacket::recursiveAddVarImpl(const String& varName, |
|  |  | const Variant& varVariant, |
|  |  | bool hasVarTag, |
|  |  | SeenContainers& seen) { |
|  |  | bool isArray = varVariant.isArray(); |
|  |  | bool isObject = varVariant.isObject(); |
|  |  |  |
|  |  | if (isArray || isObject) { |
|  |  | Array varAsArray; |
|  |  | Object varAsObject; |
|  |  | ArrayOrObject ptr; |
|  |  | if (isArray) { |
|  |  | varAsArray = varVariant.toArray(); |
|  |  | ptr = varAsArray.get(); |
|  |  | } |
|  |  | if (isObject) { |
|  |  | varAsObject = varVariant.toObject(); |
|  |  | varAsArray = varAsObject.toArray(); |
|  |  | ptr = varAsObject.get(); |
|  |  | } |
|  |  | assert(!ptr.isNull()); |
|  |  | if (!seen.emplace(ptr).second) { |
|  |  | raise\_warning("recursion detected"); |
|  |  | return false; |
|  |  | } |
|  |  | SCOPE\_EXIT { seen.erase(ptr); }; |
|  |  |  |
|  |  | if (hasVarTag) { |
|  |  | m\_packetString.append("<var name='"); |
|  |  | m\_packetString.append(varName.data()); |
|  |  | m\_packetString.append("'>"); |
|  |  | } |
|  |  |  |
|  |  | Array varAsArray; |
|  |  | Object varAsObject = varVariant.toObject(); |
|  |  | if (isArray) varAsArray = varVariant.toArray(); |
|  |  | if (isObject) varAsArray = varAsObject.toArray(); |
|  |  |  |
|  |  | int length = varAsArray.length(); |
|  |  | if (length > 0) { |
|  |  | ArrayIter it = ArrayIter(varAsArray); |
| Expand All | | @@ -99,9 +120,9 @@ bool WddxPacket::recursiveAddVar(const String& varName, |
|  |  | m\_packetString.append("'>"); |
|  |  | } |
|  |  | for (ArrayIter it(varAsArray); it; ++it) { |
|  |  | Variant key = it.first(); |
|  |  | Variant value = it.second(); |
|  |  | recursiveAddVar(key.toString(), value, isObject); |
|  |  | auto key = it.first(); |
|  |  | auto const& value = it.secondRef(); |
|  |  | recursiveAddVarImpl(key.toString(), value, isObject, seen); |
|  |  | } |
|  |  | if (isObject) { |
|  |  | m\_packetString.append("</struct>"); |
| Expand Down | |  |

13 changes: 12 additions & 1 deletion

13
[hphp/runtime/ext/wddx/ext\_wddx.h](#diff-13114cbb17b5b3c0fbbd8992c06233f8984d999e081ca89a4a76e80eb8caec1a "hphp/runtime/ext/wddx/ext_wddx.h")

Show comments

[View file](/facebook/hhvm/blob/1888810e77b446a79a7674784d5f139fcfa605e2/hphp/runtime/ext/wddx/ext_wddx.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,7 +38,7 @@ struct WddxPacket : ResourceData { |
|  |  | String packet\_end(); |
|  |  | bool serialize\_value(const Variant& varVariant); |
|  |  | bool recursiveAddVar(const String& varName, const Variant& varVariant, |
|  |  | bool hasVarTag ); |
|  |  | bool hasVarTag); |
|  |  |  |
|  |  | private: |
|  |  | String getWddxEncoded(const String& varType, |
| Expand All | | @@ -52,6 +52,17 @@ struct WddxPacket : ResourceData { |
|  |  | const String& varName, |
|  |  | bool hasVarTag); |
|  |  |  |
|  |  | using ArrayOrObject = Either<ArrayData\*,ObjectData\*>; |
|  |  | struct EitherHash { |
|  |  | size\_t operator()(const ArrayOrObject data) const { |
|  |  | return data.toOpaque(); |
|  |  | } |
|  |  | }; |
|  |  | using SeenContainers = req::hash\_set<ArrayOrObject, EitherHash>; |
|  |  |  |
|  |  | bool recursiveAddVarImpl(const String& varName, const Variant& varVariant, |
|  |  | bool hasVarTag, SeenContainers& seen); |
|  |  |  |
|  |  | StringBuffer m\_packetString; |
|  |  | bool m\_packetClosed; |
|  |  | bool m\_manualPacketCreation; |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[hphp/test/slow/ext\_wddx/recursion.php](#diff-e637e672a44948be11d5b1565578621b51ee254840833e97cf9c0ec392875bba "hphp/test/slow/ext_wddx/recursion.php")

Show comments

[View file](/facebook/hhvm/blob/1888810e77b446a79a7674784d5f139fcfa605e2/hphp/test/slow/ext_wddx/recursion.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,7 @@ |
|  |  | <?php |
|  |  | $s1 = wddx\_serialize\_value(function () {}); |
|  |  | var\_dump($s1); |
|  |  |  |
|  |  | $a = []; $a[] =& $a; |
|  |  | $s2 = wddx\_serialize\_value($a); |
|  |  | var\_dump($s2); |

6 changes: 6 additions & 0 deletions

6
[hphp/test/slow/ext\_wddx/recursion.php.expectf](#diff-008fa0941274095e8523ca4f71c2702d3a6050a2fd865b28d5800e95f85b79fe "hphp/test/slow/ext_wddx/recursion.php.expectf")

Show comments

[View file](/facebook/hhvm/blob/1888810e77b446a79a7674784d5f139fcfa605e2/hphp/test/slow/ext_wddx/recursion.php.expectf)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,6 @@ |
|  |  |  |
|  |  | Warning: recursion detected in %s/recursion.php on line 2 |
|  |  | string(%d) "<wddxPacket version='1.0'><header/><data><struct><var name='php\_class\_name'><string>Closure$;%s$%s$</string></var></struct></data></wddxPacket>" |
|  |  |  |
|  |  | Warning: recursion detected in %s/recursion.php on line 6 |
|  |  | string(87) "<wddxPacket version='1.0'><header/><data><array length='1'></array></data></wddxPacket>" |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1888810`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Fhhvm%2Fcommit%2F1888810e77b446a79a7674784d5f139fcfa605e2) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


