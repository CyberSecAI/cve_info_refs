Based on the provided content, here's a breakdown of the vulnerability associated with CVE-2016-6870:

**Root Cause of Vulnerability:**

The root cause is the incorrect usage of the `strndup` function in multiple locations within the HHVM codebase. `strndup` does not handle embedded null characters correctly, potentially shortening strings unexpectedly.  The code tracked the expected length of the string, but `strndup` could copy fewer characters when encountering null bytes, leading to out-of-bounds writes.

**Weaknesses/Vulnerabilities Present:**

*   **Out-of-bounds write:**  The primary vulnerability is an out-of-bounds write. Due to `strndup` potentially returning a shorter string than expected (when null bytes are present), subsequent code might write past the allocated buffer.
*   **Use of strndup with potentially null-terminated strings:** The code was using `strndup` to duplicate strings, some of which could contain embedded null bytes.

**Impact of Exploitation:**

*   **Memory corruption:** Out-of-bounds writes can lead to memory corruption. This can cause a denial-of-service (crashes) or potentially allow for arbitrary code execution if carefully crafted.
*   **Unexpected behavior:**  The unexpected shortening of strings might also cause logic errors within the application.

**Attack Vectors:**

*   Crafting input strings containing embedded null characters when calling functions like `mb_detect_encoding`, `mb_send_mail`, and `mb_detect_order` with user-controlled values.
*   The specific places where `strndup` was used incorrectly were:
    *   `php_mb_parse_encoding_list`
    *   `HHVM_FUNCTION(mb_parse_str,`
    *   `HHVM_FUNCTION(mb_send_mail,`

**Required Attacker Capabilities/Position:**

*   The attacker needs to be able to control, or influence the input string used in the vulnerable functions within HHVM.
*   No special privileges or local access to the server are needed; the vulnerability can be triggered via normal execution of the vulnerable functions.

**Additional details from the provided content:**

* The fix was to replace `strndup` with `req::strndup`, which can handle embedded nulls properly.
* The commit that fixed this vulnerability also fixed t11337047, but it was not assigned a separate CVE since there was no earlier public disclosure.
* A test case (`mbstring-oob.php`) was added to verify the fix.
* The scope of CVE-2016-6870 covers all the incorrect uses of `strndup` fixed in the specified commit.