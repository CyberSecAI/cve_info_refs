=== Content from open.edx.org_0ea01254_20250124_141022.html ===


[Skip to content](#content)

[![Open Edx Logo](https://openedx.org/wp-content/uploads/2020/12/Open-edX-horz-WHITE.svg)](https://openedx.org)

* The Platform
  + [Open edX Primer](https://openedx.org/open-edx-primer/)
  + [Overview](https://openedx.org/the-platform/)
  + [Learning Experiences](https://openedx.org/the-platform/learning-experiences/)
  + [Public Roadmap](https://openedx.org/public-roadmap/)
  + [Trademark & Licensing](https://openedx.org/trademark-licensing-details/)
  + [List of Features](https://openedx.org/the-platform/features/)
  + [Extensions Directory](https://openedx.org/the-platform/extensions-directory/)
  + [Use Cases](https://openedx.org/the-platform/use-cases/)
  + Industry Solutions
    - [Higher Education](https://openedx.org/the-platform/use-cases/higher-education/)
    - [Enterprise](https://openedx.org/the-platform/use-cases/enterprises/)
    - [Government and NGOs](https://openedx.org/the-platform/use-cases/government-and-ngos/)
* Get Started
  + [Open edX Providers](https://openedx.org/marketplace-category/open-edx-installation-and-hosting/)
  + [Open edX Sandbox](https://openedx.org/open-edx-sandbox/)
  + [Self Managed](https://openedx.org/get-started/get-started-self-managed/)
  + [Fully Managed](https://openedx.org/get-started/)
* Resources
  + [Documentation](https://openedx.org/community/documentation/)
  + [Events](https://openedx.org/events/)
  + [Video](https://openedx.org/category/video/)
  + [Blog](https://openedx.org/blog)
  + [FAQ](https://openedx.org/faq/)
* [About The Open edX Project](https://openedx.org/about-open-edx/)
* [Contact us](https://openedx.org/community/connect/)
* Community
  + [Overview](https://openedx.org/community/)
  + [Marketplace Provider Feedback](https://openedx.org/marketplace-provider-feedback/)
  + [Join the Open edX Provider Network](https://openedx.org/join-the-open-edx-provider-network/)
  + [Working Groups](https://openedx.org/open-edx-community-working-groups/)
  + [The Open edX Technical Oversight Committee](https://openedx.org/community/the-open-edx-technical-oversight-committee/)

* The Platform
  + [Open edX Primer](https://openedx.org/open-edx-primer/)
  + [Overview](https://openedx.org/the-platform/)
  + [Learning Experiences](https://openedx.org/the-platform/learning-experiences/)
  + [Public Roadmap](https://openedx.org/public-roadmap/)
  + [Trademark & Licensing](https://openedx.org/trademark-licensing-details/)
  + [List of Features](https://openedx.org/the-platform/features/)
  + [Extensions Directory](https://openedx.org/the-platform/extensions-directory/)
  + [Use Cases](https://openedx.org/the-platform/use-cases/)
  + Industry Solutions
    - [Higher Education](https://openedx.org/the-platform/use-cases/higher-education/)
    - [Enterprise](https://openedx.org/the-platform/use-cases/enterprises/)
    - [Government and NGOs](https://openedx.org/the-platform/use-cases/government-and-ngos/)
* Get Started
  + [Open edX Providers](https://openedx.org/marketplace-category/open-edx-installation-and-hosting/)
  + [Open edX Sandbox](https://openedx.org/open-edx-sandbox/)
  + [Self Managed](https://openedx.org/get-started/get-started-self-managed/)
  + [Fully Managed](https://openedx.org/get-started/)
* Resources
  + [Documentation](https://openedx.org/community/documentation/)
  + [Events](https://openedx.org/events/)
  + [Video](https://openedx.org/category/video/)
  + [Blog](https://openedx.org/blog)
  + [FAQ](https://openedx.org/faq/)
* [About The Open edX Project](https://openedx.org/about-open-edx/)
* [Contact us](https://openedx.org/community/connect/)
* Community
  + [Overview](https://openedx.org/community/)
  + [Marketplace Provider Feedback](https://openedx.org/marketplace-provider-feedback/)
  + [Join the Open edX Provider Network](https://openedx.org/join-the-open-edx-provider-network/)
  + [Working Groups](https://openedx.org/open-edx-community-working-groups/)
  + [The Open edX Technical Oversight Committee](https://openedx.org/community/the-open-edx-technical-oversight-committee/)

# Cross Site Request Forgery Bug in edX LMS

## June 10, 2016 | By

## [Ed Zarecor (edX)](https://openedx.org/author/ed-zarecor-edx/)

# Security Alert

| **Severity:** | High |
| --- | --- |
| **Category:** | CSRF |
| **Affected Projects:** | [edx-platform](https://github.com/edx/edx-platform) |
| **Reporter:** | self-reported |
| **Permanent URL:** |  |

During a review of the edX platform code some side-effecting HTTP GET requests were discovered.  Such requests are generally undesirable and do not enforce Cross Site Request Forgery (CSRF) protection.  In one specific case users could potentially escalate their privileges via an attack against staff or super users.

# More Information

This patch fixes an issue where a malicious user could lure an instructor to view a page that could in turn grant the malicious user additional privileges.

Although the platform is already using Django’s Cross-Site Request Forgery (CSRF) middleware protection, some endpoints with side effects were found to be using GET methods. The patch forces these endpoints to require POST, which also properly enables CSRF protection.

For more information, see:

– <https://docs.djangoproject.com/en/1.9/ref/csrf/>

We strongly advise you to patch your instances as soon as possible.

**Patch for those tracking master closely:**

[https://github.com/edx/edx-platform/commit/d54f79f5bf3e1af17063937df1abc…](https://github.com/edx/edx-platform/commit/d54f79f5bf3e1af17063937df1abc0026843412d.patch)

**Patch for named-release dogwood**:

[https://github.com/edx/edx-platform/commit/d929c1cd8ca11d801a03232f200c9…](https://github.com/edx/edx-platform/commit/d929c1cd8ca11d801a03232f200c9f47f45bb7b4.patch)

 ![Loading](https://openedx.org/wp-content/plugins/page-views-count/ajax-loader-2x.gif)

Start the discussion at [discuss.openedx.org](https://discuss.openedx.org/t/cross-site-request-forgery-bug-in-edx-lms/11217)

## Resources

* [Blog](https://openedx.org/category/blog/)
* [Video](https://openedx.org/category/video/)
* [Events](https://openedx.org/events/)

### Time For More? **Check out the articles below.**

[* July 7, 2021

###### Open edX platform earns LTI® Advantage Certification](https://openedx.org/blog/open-edx-platform-earns-lti-advantage-certification/)

[* July 9, 2020

###### Juniper is here!](https://openedx.org/announcements/juniper-is-here/)

[* April 28, 2020

###### edX Sponsorship Demos](https://openedx.org/extender/edx-sponsorship-demos/)

[* March 30, 2020

###### Cancelling the 2020 Open edX Conference](https://openedx.org/blog/cancelling-the-2020-open-edx-conference/)

[Facebook-f](https://www.facebook.com/openedX)

[Twitter](https://twitter.com/OpenEdX)

[Linkedin-in](https://www.linkedin.com/company/openedx/)

* [About The Open edX Project](https://openedx.org/about-open-edx/)
* [Code of Conduct](https://openedx.org/code-of-conduct/)
* [Contact](https://openedx.org/community/connect/)

* [About The Open edX Project](https://openedx.org/about-open-edx/)
* [Code of Conduct](https://openedx.org/code-of-conduct/)
* [Contact](https://openedx.org/community/connect/)

© 2025 Axim Collaborative, Inc. All Rights Reserved. edX and Open edX are registered trademarks of edX LLC.[Terms of Use](https://www.axim.org/terms-of-service) and [Privacy Policy](https://www.axim.org/privacy-policy). [Trademark / Licensing Details](https://openedx.org/trademark-licensing-details/)

* The Platform
  + [Open edX Primer](https://openedx.org/open-edx-primer/)
  + [Overview](https://openedx.org/the-platform/)
  + [Learning Experiences](https://openedx.org/the-platform/learning-experiences/)
  + [Public Roadmap](https://openedx.org/public-roadmap/)
  + [Trademark & Licensing](https://openedx.org/trademark-licensing-details/)
  + [List of Features](https://openedx.org/the-platform/features/)
  + [Extensions Directory](https://openedx.org/the-platform/extensions-directory/)
  + [Use Cases](https://openedx.org/the-platform/use-cases/)
  + Industry Solutions
    - [Higher Education](https://openedx.org/the-platform/use-cases/higher-education/)
    - [Enterprise](https://openedx.org/the-platform/use-cases/enterprises/)
    - [Government and NGOs](https://openedx.org/the-platform/use-cases/government-and-ngos/)
* Get Started
  + [Open edX Providers](https://openedx.org/marketplace-category/open-edx-installation-and-hosting/)
  + [Open edX Sandbox](https://openedx.org/open-edx-sandbox/)
  + [Self Managed](https://openedx.org/get-started/get-started-self-managed/)
  + [Fully Managed](https://openedx.org/get-started/)
* Resources
  + [Documentation](https://openedx.org/community/documentation/)
  + [Events](https://openedx.org/events/)
  + [Video](https://openedx.org/category/video/)
  + [Blog](https://openedx.org/blog)
  + [FAQ](https://openedx.org/faq/)
* [About The Open edX Project](https://openedx.org/about-open-edx/)
* [Contact us](https://openedx.org/community/connect/)
* Community
  + [Overview](https://openedx.org/community/)
  + [Marketplace Provider Feedback](https://openedx.org/marketplace-provider-feedback/)
  + [Join the Open edX Provider Network](https://openedx.org/join-the-open-edx-provider-network/)
  + [Working Groups](https://openedx.org/open-edx-community-working-groups/)
  + [The Open edX Technical Oversight Committee](https://openedx.org/community/the-open-edx-technical-oversight-committee/)

Join the Open edX Conference 2025!

The 2025 Open edX Conference will present innovative use cases for one of the world’s best open source online learning management systems, the Open edX platform, and discover the latest advancements in instructional design, course constellation, and methods for operating & extending the Open edX platform, including breakthrough technologies, such as generative AI.

[Register Now](https://www.eventbrite.com/e/open-edx-conference-2025-tickets-1073314696149?aff=oddtdtcreator)



=== Content from github.com_85e50bfb_20250124_141021.html ===
From d54f79f5bf3e1af17063937df1abc0026843412d Mon Sep 17 00:00:00 2001
From: Robert Raposa
Date: Mon, 6 Jun 2016 09:41:02 -0400
Subject: [PATCH] Switch dashboard from GET to POST.
---
lms/djangoapps/instructor/tests/test\_api.py | 389 ++++++++++++------
lms/djangoapps/instructor/views/api.py | 168 ++++----
.../instructor\_dashboard/data\_download.coffee | 8 +
.../instructor\_dashboard/extensions.coffee | 4 +
.../instructor\_dashboard/membership.coffee | 4 +
.../instructor\_dashboard/send\_email.coffee | 2 +
.../instructor\_dashboard/student\_admin.coffee | 12 +
.../src/instructor\_dashboard/util.coffee | 2 +
.../js/instructor\_dashboard/ecommerce.js | 2 +
.../student\_admin\_spec.js | 34 +-
.../js/spec/staff\_debug\_actions\_spec.js | 6 +-
lms/static/js/staff\_debug\_actions.js | 2 +-
12 files changed, 399 insertions(+), 234 deletions(-)
diff --git a/lms/djangoapps/instructor/tests/test\_api.py b/lms/djangoapps/instructor/tests/test\_api.py
index 2e7d864e2bd..35c90402c96 100644
--- a/lms/djangoapps/instructor/tests/test\_api.py
+++ b/lms/djangoapps/instructor/tests/test\_api.py
@@ -17,7 +17,7 @@
from django.contrib.auth.models import User
from django.core import mail
from django.core.files.uploadedfile import SimpleUploadedFile
-from django.core.urlresolvers import reverse
+from django.core.urlresolvers import reverse as django\_reverse
from django.http import HttpRequest, HttpResponse
from django.test import RequestFactory, TestCase
from django.test.utils import override\_settings
@@ -34,7 +34,9 @@
from bulk\_email.models import BulkEmailFlag
from course\_modes.models import CourseMode
from courseware.models import StudentModule
-from courseware.tests.factories import StaffFactory, InstructorFactory, BetaTesterFactory, UserProfileFactory
+from courseware.tests.factories import (
+ BetaTesterFactory, GlobalStaffFactory, InstructorFactory, StaffFactory, UserProfileFactory
+)
from courseware.tests.helpers import LoginEnrollmentTestCase
from django\_comment\_common.models import FORUM\_ROLE\_COMMUNITY\_TA
from django\_comment\_common.utils import seed\_permissions\_roles
@@ -131,6 +133,82 @@
)
+INSTRUCTOR\_GET\_ENDPOINTS = set([
+ 'get\_anon\_ids',
+ 'get\_coupon\_codes',
+ 'get\_issued\_certificates',
+ 'get\_sale\_order\_records',
+ 'get\_sale\_records',
+])
+INSTRUCTOR\_POST\_ENDPOINTS = set([
+ 'active\_registration\_codes',
+ 'add\_users\_to\_cohorts',
+ 'bulk\_beta\_modify\_access',
+ 'calculate\_grades\_csv',
+ 'change\_due\_date',
+ 'export\_ora2\_data',
+ 'generate\_registration\_codes',
+ 'get\_enrollment\_report',
+ 'get\_exec\_summary\_report',
+ 'get\_grading\_config',
+ 'get\_problem\_responses',
+ 'get\_proctored\_exam\_results',
+ 'get\_registration\_codes',
+ 'get\_student\_progress\_url',
+ 'get\_students\_features',
+ 'get\_students\_who\_may\_enroll',
+ 'get\_user\_invoice\_preference',
+ 'list\_background\_email\_tasks',
+ 'list\_course\_role\_members',
+ 'list\_email\_content',
+ 'list\_entrance\_exam\_instructor\_tasks',
+ 'list\_financial\_report\_downloads',
+ 'list\_forum\_members',
+ 'list\_instructor\_tasks',
+ 'list\_report\_downloads',
+ 'mark\_student\_can\_skip\_entrance\_exam',
+ 'modify\_access',
+ 'register\_and\_enroll\_students',
+ 'rescore\_entrance\_exam',
+ 'rescore\_problem',
+ 'reset\_due\_date',
+ 'reset\_student\_attempts',
+ 'reset\_student\_attempts\_for\_entrance\_exam',
+ 'sale\_validation',
+ 'show\_student\_extensions',
+ 'show\_unit\_extensions',
+ 'send\_email',
+ 'spent\_registration\_codes',
+ 'students\_update\_enrollment',
+ 'update\_forum\_role\_membership',
+])
+
+
+def reverse(endpoint, args=None, kwargs=None, is\_dashboard\_endpoint=True):
+ """
+ Simple wrapper of Django's reverse that first ensures that we have declared
+ each endpoint under test.
+
+ Arguments:
+ args: The args to be passed through to reverse.
+ endpoint: The endpoint to be passed through to reverse.
+ kwargs: The kwargs to be passed through to reverse.
+ is\_dashboard\_endpoint: True if this is an instructor dashboard endpoint
+ that must be declared in the INSTRUCTOR\_GET\_ENDPOINTS or
+ INSTRUCTOR\_GET\_ENDPOINTS sets, or false otherwise.
+
+ Returns:
+ The return of Django's reverse function
+
+ """
+ is\_endpoint\_declared = endpoint in INSTRUCTOR\_GET\_ENDPOINTS or endpoint in INSTRUCTOR\_POST\_ENDPOINTS
+ if is\_dashboard\_endpoint and is\_endpoint\_declared is False:
+ # Verify that all endpoints are declared so we can ensure they are
+ # properly validated elsewhere.
+ raise ValueError("The endpoint {} must be declared in ENDPOINTS before use.".format(endpoint))
+ return django\_reverse(endpoint, args=args, kwargs=kwargs)
+
+
@common\_exceptions\_400
def view\_success(request): # pylint: disable=unused-argument
"A dummy view for testing that returns a simple HTTP response"
@@ -191,6 +269,61 @@ def test\_alreadyrunningerror\_ajax(self):
self.assertIn("Task is already running", result["error"])
+@attr('shard\_1')
+@ddt.ddt
+class TestEndpointHttpMethods(SharedModuleStoreTestCase, LoginEnrollmentTestCase):
+ """
+ Ensure that users can make GET requests against endpoints that allow GET,
+ and not against those that don't allow GET.
+ """
+
+ @classmethod
+ def setUpClass(cls):
+ """
+ Set up test course.
+ """
+ super(TestEndpointHttpMethods, cls).setUpClass()
+ cls.course = CourseFactory.create()
+
+ def setUp(self):
+ """
+ Set up global staff role so authorization will not fail.
+ """
+ super(TestEndpointHttpMethods, self).setUp()
+ global\_user = GlobalStaffFactory()
+ self.client.login(username=global\_user.username, password='test')
+
+ @ddt.data(\*INSTRUCTOR\_POST\_ENDPOINTS)
+ def test\_endpoints\_reject\_get(self, data):
+ """
+ Tests that POST endpoints are rejected with 405 when using GET.
+ """
+ url = reverse(data, kwargs={'course\_id': unicode(self.course.id)})
+ response = self.client.get(url)
+
+ self.assertEqual(
+ response.status\_code, 405,
+ "Endpoint {} returned status code {} instead of a 405. It should not allow GET.".format(
+ data, response.status\_code
+ )
+ )
+
+ @ddt.data(\*INSTRUCTOR\_GET\_ENDPOINTS)
+ def test\_endpoints\_accept\_get(self, data):
+ """
+ Tests that GET endpoints are not rejected with 405 when using GET.
+ """
+ url = reverse(data, kwargs={'course\_id': unicode(self.course.id)})
+ response = self.client.get(url)
+
+ self.assertNotEqual(
+ response.status\_code, 405,
+ "Endpoint {} returned status code 405 where it shouldn't, since it should allow GET.".format(
+ data
+ )
+ )
+
+
@attr('shard\_1')
@patch('bulk\_email.models.html\_to\_text', Mock(return\_value='Mocking CourseEmail.text\_message', autospec=True))
class TestInstructorAPIDenyLevels(SharedModuleStoreTestCase, LoginEnrollmentTestCase):
@@ -271,10 +404,10 @@ def \_access\_endpoint(self, endpoint, args, status\_code, msg):
msg: message to display if assertion fails.
"""
url = reverse(endpoint, kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- if endpoint in ['send\_email', 'students\_update\_enrollment', 'bulk\_beta\_modify\_access']:
- response = self.client.post(url, args)
- else:
+ if endpoint in INSTRUCTOR\_GET\_ENDPOINTS:
response = self.client.get(url, args)
+ else:
+ response = self.client.post(url, args)
self.assertEqual(
response.status\_code,
status\_code,
@@ -1919,13 +2052,13 @@ def setUp(self):
def test\_modify\_access\_noparams(self):
""" Test missing all query parameters. """
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url)
+ response = self.client.post(url)
self.assertEqual(response.status\_code, 400)
def test\_modify\_access\_bad\_action(self):
""" Test with an invalid action parameter. """
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.other\_staff.email,
'rolename': 'staff',
'action': 'robot-not-an-action',
@@ -1935,7 +2068,7 @@ def test\_modify\_access\_bad\_action(self):
def test\_modify\_access\_bad\_role(self):
""" Test with an invalid action parameter. """
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.other\_staff.email,
'rolename': 'robot-not-a-roll',
'action': 'revoke',
@@ -1944,7 +2077,7 @@ def test\_modify\_access\_bad\_role(self):
def test\_modify\_access\_allow(self):
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.other\_user.email,
'rolename': 'staff',
'action': 'allow',
@@ -1953,7 +2086,7 @@ def test\_modify\_access\_allow(self):
def test\_modify\_access\_allow\_with\_uname(self):
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.other\_instructor.username,
'rolename': 'staff',
'action': 'allow',
@@ -1962,7 +2095,7 @@ def test\_modify\_access\_allow\_with\_uname(self):
def test\_modify\_access\_revoke(self):
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.other\_staff.email,
'rolename': 'staff',
'action': 'revoke',
@@ -1971,7 +2104,7 @@ def test\_modify\_access\_revoke(self):
def test\_modify\_access\_revoke\_with\_username(self):
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.other\_staff.username,
'rolename': 'staff',
'action': 'revoke',
@@ -1980,7 +2113,7 @@ def test\_modify\_access\_revoke\_with\_username(self):
def test\_modify\_access\_with\_fake\_user(self):
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': 'GandalfTheGrey',
'rolename': 'staff',
'action': 'revoke',
@@ -1997,7 +2130,7 @@ def test\_modify\_access\_with\_inactive\_user(self):
self.other\_user.is\_active = False
self.other\_user.save() # pylint: disable=no-member
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.other\_user.username,
'rolename': 'beta',
'action': 'allow',
@@ -2013,7 +2146,7 @@ def test\_modify\_access\_with\_inactive\_user(self):
def test\_modify\_access\_revoke\_not\_allowed(self):
""" Test revoking access that a user does not have. """
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.other\_staff.email,
'rolename': 'instructor',
'action': 'revoke',
@@ -2025,7 +2158,7 @@ def test\_modify\_access\_revoke\_self(self):
Test that an instructor cannot remove instructor privelages from themself.
"""
url = reverse('modify\_access', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.instructor.email,
'rolename': 'instructor',
'action': 'revoke',
@@ -2044,20 +2177,20 @@ def test\_modify\_access\_revoke\_self(self):
def test\_list\_course\_role\_members\_noparams(self):
""" Test missing all query parameters. """
url = reverse('list\_course\_role\_members', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url)
+ response = self.client.post(url)
self.assertEqual(response.status\_code, 400)
def test\_list\_course\_role\_members\_bad\_rolename(self):
""" Test with an invalid rolename parameter. """
url = reverse('list\_course\_role\_members', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'rolename': 'robot-not-a-rolename',
})
self.assertEqual(response.status\_code, 400)
def test\_list\_course\_role\_members\_staff(self):
url = reverse('list\_course\_role\_members', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'rolename': 'staff',
})
self.assertEqual(response.status\_code, 200)
@@ -2079,7 +2212,7 @@ def test\_list\_course\_role\_members\_staff(self):
def test\_list\_course\_role\_members\_beta(self):
url = reverse('list\_course\_role\_members', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'rolename': 'beta',
})
self.assertEqual(response.status\_code, 200)
@@ -2112,7 +2245,7 @@ def assert\_update\_forum\_role\_membership(self, current\_user, identifier, rolename
Get unique\_student\_identifier, rolename and action and update forum role.
"""
url = reverse('update\_forum\_role\_membership', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(
+ response = self.client.post(
url,
{
'unique\_student\_identifier': identifier,
@@ -2185,7 +2318,7 @@ def register\_with\_redemption\_code(self, user, code):
"""
enroll user using a registration code
"""
- redeem\_url = reverse('register\_code\_redemption', args=[code])
+ redeem\_url = reverse('shoppingcart.views.register\_code\_redemption', args=[code], is\_dashboard\_endpoint=False)
self.client.login(username=user.username, password='test')
response = self.client.get(redeem\_url)
self.assertEquals(response.status\_code, 200)
@@ -2265,10 +2398,16 @@ def test\_get\_sale\_order\_records\_features\_csv(self):
mode\_slug=CourseMode.HONOR
)
# update the quantity of the cart item paid\_course\_reg\_item
- resp = self.client.post(reverse('shoppingcart.views.update\_user\_cart'), {'ItemId': paid\_course\_reg\_item.id, 'qty': '4'})
+ resp = self.client.post(
+ reverse('shoppingcart.views.update\_user\_cart', is\_dashboard\_endpoint=False),
+ {'ItemId': paid\_course\_reg\_item.id, 'qty': '4'}
+ )
self.assertEqual(resp.status\_code, 200)
# apply the coupon code to the item in the cart
- resp = self.client.post(reverse('shoppingcart.views.use\_code'), {'code': coupon.code})
+ resp = self.client.post(
+ reverse('shoppingcart.views.use\_code', is\_dashboard\_endpoint=False),
+ {'code': coupon.code}
+ )
self.assertEqual(resp.status\_code, 200)
self.cart.purchase()
# get the updated item
@@ -2277,7 +2416,7 @@ def test\_get\_sale\_order\_records\_features\_csv(self):
coupon\_redemption = CouponRedemption.objects.select\_related('coupon').filter(order=self.cart)
sale\_order\_url = reverse('get\_sale\_order\_records', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(sale\_order\_url)
+ response = self.client.post(sale\_order\_url)
self.assertEqual(response['Content-Type'], 'text/csv')
self.assertIn('36', response.content.split('\r\n')[1])
self.assertIn(str(item.unit\_cost), response.content.split('\r\n')[1],)
@@ -2301,11 +2440,18 @@ def test\_coupon\_redeem\_count\_in\_ecommerce\_section(self):
PaidCourseRegistration.add\_to\_order(self.cart, self.course.id)
# apply the coupon code to the item in the cart
- resp = self.client.post(reverse('shoppingcart.views.use\_code'), {'code': coupon.code})
+ resp = self.client.post(
+ reverse('shoppingcart.views.use\_code', is\_dashboard\_endpoint=False),
+ {'code': coupon.code}
+ )
self.assertEqual(resp.status\_code, 200)
# URL for instructor dashboard
- instructor\_dashboard = reverse('instructor\_dashboard', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
+ instructor\_dashboard = reverse(
+ 'instructor\_dashboard',
+ kwargs={'course\_id': self.course.id.to\_deprecated\_string()},
+ is\_dashboard\_endpoint=False
+ )
# visit the instructor dashboard page and
# check that the coupon redeem count should be 0
resp = self.client.get(instructor\_dashboard)
@@ -2342,7 +2488,7 @@ def test\_get\_sale\_records\_features\_csv(self):
'get\_sale\_records',
kwargs={'course\_id': self.course.id.to\_deprecated\_string()}
)
- response = self.client.get(url + '/csv', {})
+ response = self.client.post(url + '/csv', {})
self.assertEqual(response['Content-Type'], 'text/csv')
def test\_get\_sale\_records\_features\_json(self):
@@ -2361,7 +2507,7 @@ def test\_get\_sale\_records\_features\_json(self):
course\_registration\_code.save()
url = reverse('get\_sale\_records', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertIn('sale', res\_json)
@@ -2411,7 +2557,7 @@ def test\_get\_sale\_records\_features\_with\_multiple\_invoices(self):
course\_registration\_code.save()
url = reverse('get\_sale\_records', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertIn('sale', res\_json)
@@ -2459,7 +2605,7 @@ def test\_get\_problem\_responses\_invalid\_location(self):
)
problem\_location = ''
- response = self.client.get(url, {'problem\_location': problem\_location})
+ response = self.client.post(url, {'problem\_location': problem\_location})
res\_json = json.loads(response.content)
self.assertEqual(res\_json, 'Could not find problem with this location.')
@@ -2494,7 +2640,7 @@ def test\_get\_problem\_responses\_successful(self):
)
problem\_location = ''
- response = self.client.get(url, {'problem\_location': problem\_location})
+ response = self.client.post(url, {'problem\_location': problem\_location})
res\_json = json.loads(response.content)
self.assertIn('status', res\_json)
status = res\_json['status']
@@ -2515,7 +2661,7 @@ def test\_get\_problem\_responses\_already\_running(self):
with patch('instructor\_task.api.submit\_calculate\_problem\_responses\_csv') as submit\_task\_function:
error = AlreadyRunningError()
submit\_task\_function.side\_effect = error
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertIn('status', res\_json)
self.assertIn('already in progress', res\_json['status'])
@@ -2529,7 +2675,7 @@ def test\_get\_students\_features(self):
student.profile.city = "Mos Eisley {}".format(student.id)
student.profile.save()
url = reverse('get\_students\_features', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertIn('students', res\_json)
for student in self.students:
@@ -2551,7 +2697,7 @@ def test\_get\_students\_features\_cohorted(self, is\_cohorted):
url = reverse('get\_students\_features', kwargs={'course\_id': unicode(self.course.id)})
set\_course\_cohort\_settings(self.course.id, is\_cohorted=is\_cohorted)
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertEqual('cohort' in res\_json['feature\_names'], is\_cohorted)
@@ -2571,7 +2717,7 @@ def test\_get\_students\_features\_teams(self, has\_teams):
url = reverse('get\_students\_features', kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertEqual('team' in res\_json['feature\_names'], has\_teams)
@@ -2587,7 +2733,7 @@ def test\_get\_students\_who\_may\_enroll(self):
kwargs={'course\_id': unicode(self.course.id)}
)
# Successful case:
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertIn('status', res\_json)
self.assertNotIn('currently being created', res\_json['status'])
@@ -2595,7 +2741,7 @@ def test\_get\_students\_who\_may\_enroll(self):
with patch('instructor\_task.api.submit\_calculate\_may\_enroll\_csv') as submit\_task\_function:
error = AlreadyRunningError()
submit\_task\_function.side\_effect = error
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertIn('status', res\_json)
self.assertIn('currently being created', res\_json['status'])
@@ -2610,7 +2756,7 @@ def test\_get\_student\_exam\_results(self):
kwargs={'course\_id': unicode(self.course.id)}
)
# Successful case:
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertIn('status', res\_json)
self.assertNotIn('currently being created', res\_json['status'])
@@ -2618,7 +2764,7 @@ def test\_get\_student\_exam\_results(self):
with patch('instructor\_task.api.submit\_proctored\_exam\_results\_report') as submit\_task\_function:
error = AlreadyRunningError()
submit\_task\_function.side\_effect = error
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
res\_json = json.loads(response.content)
self.assertIn('status', res\_json)
self.assertIn('currently being created', res\_json['status'])
@@ -2704,7 +2850,7 @@ def test\_enrollment\_report\_features\_csv(self):
self.client.login(username=self.instructor.username, password='test')
url = reverse('get\_enrollment\_report', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertIn('The detailed enrollment report is being created.', response.content)
def test\_bulk\_purchase\_detailed\_report(self):
@@ -2716,11 +2862,16 @@ def test\_bulk\_purchase\_detailed\_report(self):
"""
paid\_course\_reg\_item = PaidCourseRegistration.add\_to\_order(self.cart, self.course.id)
# update the quantity of the cart item paid\_course\_reg\_item
- resp = self.client.post(reverse('shoppingcart.views.update\_user\_cart'),
- {'ItemId': paid\_course\_reg\_item.id, 'qty': '4'})
+ resp = self.client.post(
+ reverse('shoppingcart.views.update\_user\_cart', is\_dashboard\_endpoint=False),
+ {'ItemId': paid\_course\_reg\_item.id, 'qty': '4'}
+ )
self.assertEqual(resp.status\_code, 200)
# apply the coupon code to the item in the cart
- resp = self.client.post(reverse('shoppingcart.views.use\_code'), {'code': self.coupon\_code})
+ resp = self.client.post(
+ reverse('shoppingcart.views.use\_code', is\_dashboard\_endpoint=False),
+ {'code': self.coupon\_code}
+ )
self.assertEqual(resp.status\_code, 200)
self.cart.purchase()
@@ -2754,7 +2905,7 @@ def test\_bulk\_purchase\_detailed\_report(self):
self.client.login(username=self.instructor.username, password='test')
url = reverse('get\_enrollment\_report', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertIn('The detailed enrollment report is being created.', response.content)
def test\_create\_registration\_code\_without\_invoice\_and\_order(self):
@@ -2776,7 +2927,7 @@ def test\_create\_registration\_code\_without\_invoice\_and\_order(self):
self.client.login(username=self.instructor.username, password='test')
url = reverse('get\_enrollment\_report', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertIn('The detailed enrollment report is being created.', response.content)
def test\_invoice\_payment\_is\_still\_pending\_for\_registration\_codes(self):
@@ -2801,7 +2952,7 @@ def test\_invoice\_payment\_is\_still\_pending\_for\_registration\_codes(self):
self.client.login(username=self.instructor.username, password='test')
url = reverse('get\_enrollment\_report', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertIn('The detailed enrollment report is being created.', response.content)
@patch.object(instructor.views.api, 'anonymous\_id\_for\_user', Mock(return\_value='42'))
@@ -2811,7 +2962,7 @@ def test\_get\_anon\_ids(self):
Test the CSV output for the anonymized user ids.
"""
url = reverse('get\_anon\_ids', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertEqual(response['Content-Type'], 'text/csv')
body = response.content.replace('\r', '')
self.assertTrue(body.startswith(
@@ -2829,7 +2980,7 @@ def test\_list\_report\_downloads(self):
('mock\_file\_name\_1', 'https://1.mock.url'),
('mock\_file\_name\_2', 'https://2.mock.url'),
]
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
expected\_response = {
"downloads": [
@@ -2858,12 +3009,12 @@ def test\_calculate\_report\_csv\_success(self, report\_type, instructor\_api\_endpoint
success\_status = "The {report\_type} report is being created.".format(report\_type=report\_type)
if report\_type == 'problem responses':
with patch(task\_api\_endpoint):
- response = self.client.get(url, {'problem\_location': ''})
+ response = self.client.post(url, {'problem\_location': ''})
self.assertIn(success\_status, response.content)
else:
CourseFinanceAdminRole(self.course.id).add\_users(self.instructor)
with patch(task\_api\_endpoint):
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertIn(success\_status, response.content)
@ddt.data(\*EXECUTIVE\_SUMMARY\_DATA)
@@ -2881,7 +3032,7 @@ def test\_executive\_summary\_report\_success(
CourseFinanceAdminRole(self.course.id).add\_users(self.instructor)
with patch(task\_api\_endpoint):
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
success\_status = "The {report\_type} report is being created." \
" To view the status of the report, see Pending" \
" Tasks below".format(report\_type=report\_type)
@@ -2903,7 +3054,7 @@ def test\_executive\_summary\_report\_already\_running(
CourseFinanceAdminRole(self.course.id).add\_users(self.instructor)
with patch(task\_api\_endpoint) as mock:
mock.side\_effect = AlreadyRunningError()
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
already\_running\_status = "The {report\_type} report is currently being created." \
" To view the status of the report, see Pending Tasks below." \
" You will be able to download the report" \
@@ -2916,7 +3067,7 @@ def test\_get\_ora2\_responses\_success(self):
with patch('instructor\_task.api.submit\_export\_ora2\_data') as mock\_submit\_ora2\_task:
mock\_submit\_ora2\_task.return\_value = True
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
success\_status = "The ORA data report is being generated."
self.assertIn(success\_status, response.content)
@@ -2925,17 +3076,15 @@ def test\_get\_ora2\_responses\_already\_running(self):
with patch('instructor\_task.api.submit\_export\_ora2\_data') as mock\_submit\_ora2\_task:
mock\_submit\_ora2\_task.side\_effect = AlreadyRunningError()
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
already\_running\_status = "An ORA data report generation task is already in progress."
self.assertIn(already\_running\_status, response.content)
def test\_get\_student\_progress\_url(self):
""" Test that progress\_url is in the successful response. """
url = reverse('get\_student\_progress\_url', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- url += "?unique\_student\_identifier={}".format(
- quote(self.students[0].email.encode("utf-8"))
- )
- response = self.client.get(url)
+ data = {'unique\_student\_identifier': self.students[0].email.encode("utf-8")}
+ response = self.client.post(url, data)
self.assertEqual(response.status\_code, 200)
res\_json = json.loads(response.content)
self.assertIn('progress\_url', res\_json)
@@ -2943,10 +3092,8 @@ def test\_get\_student\_progress\_url(self):
def test\_get\_student\_progress\_url\_from\_uname(self):
""" Test that progress\_url is in the successful response. """
url = reverse('get\_student\_progress\_url', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- url += "?unique\_student\_identifier={}".format(
- quote(self.students[0].username.encode("utf-8"))
- )
- response = self.client.get(url)
+ data = {'unique\_student\_identifier': self.students[0].username.encode("utf-8")}
+ response = self.client.post(url, data)
self.assertEqual(response.status\_code, 200)
res\_json = json.loads(response.content)
self.assertIn('progress\_url', res\_json)
@@ -2954,13 +3101,13 @@ def test\_get\_student\_progress\_url\_from\_uname(self):
def test\_get\_student\_progress\_url\_noparams(self):
""" Test that the endpoint 404's without the required query params. """
url = reverse('get\_student\_progress\_url', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url)
+ response = self.client.post(url)
self.assertEqual(response.status\_code, 400)
def test\_get\_student\_progress\_url\_nostudent(self):
""" Test that the endpoint 400's when requesting an unknown email. """
url = reverse('get\_student\_progress\_url', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url)
+ response = self.client.post(url)
self.assertEqual(response.status\_code, 400)
@@ -3001,7 +3148,7 @@ def setUp(self):
def test\_reset\_student\_attempts\_deletall(self):
""" Make sure no one can delete all students state on a problem. """
url = reverse('reset\_student\_attempts', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_to\_reset': self.problem\_urlname,
'all\_students': True,
'delete\_module': True,
@@ -3011,7 +3158,7 @@ def test\_reset\_student\_attempts\_deletall(self):
def test\_reset\_student\_attempts\_single(self):
""" Test reset single student attempts. """
url = reverse('reset\_student\_attempts', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_to\_reset': self.problem\_urlname,
'unique\_student\_identifier': self.student.email,
})
@@ -3028,7 +3175,7 @@ def test\_reset\_student\_attempts\_single(self):
def test\_reset\_student\_attempts\_all(self, act):
""" Test reset all student attempts. """
url = reverse('reset\_student\_attempts', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_to\_reset': self.problem\_urlname,
'all\_students': True,
})
@@ -3038,7 +3185,7 @@ def test\_reset\_student\_attempts\_all(self, act):
def test\_reset\_student\_attempts\_missingmodule(self):
""" Test reset for non-existant problem. """
url = reverse('reset\_student\_attempts', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_to\_reset': 'robot-not-a-real-module',
'unique\_student\_identifier': self.student.email,
})
@@ -3047,7 +3194,7 @@ def test\_reset\_student\_attempts\_missingmodule(self):
def test\_reset\_student\_attempts\_delete(self):
""" Test delete single student state. """
url = reverse('reset\_student\_attempts', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_to\_reset': self.problem\_urlname,
'unique\_student\_identifier': self.student.email,
'delete\_module': True,
@@ -3066,7 +3213,7 @@ def test\_reset\_student\_attempts\_delete(self):
def test\_reset\_student\_attempts\_nonsense(self):
""" Test failure with both unique\_student\_identifier and all\_students. """
url = reverse('reset\_student\_attempts', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_to\_reset': self.problem\_urlname,
'unique\_student\_identifier': self.student.email,
'all\_students': True,
@@ -3077,7 +3224,7 @@ def test\_reset\_student\_attempts\_nonsense(self):
def test\_rescore\_problem\_single(self, act):
""" Test rescoring of a single student. """
url = reverse('rescore\_problem', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_to\_reset': self.problem\_urlname,
'unique\_student\_identifier': self.student.email,
})
@@ -3088,7 +3235,7 @@ def test\_rescore\_problem\_single(self, act):
def test\_rescore\_problem\_single\_from\_uname(self, act):
""" Test rescoring of a single student. """
url = reverse('rescore\_problem', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_to\_reset': self.problem\_urlname,
'unique\_student\_identifier': self.student.username,
})
@@ -3099,7 +3246,7 @@ def test\_rescore\_problem\_single\_from\_uname(self, act):
def test\_rescore\_problem\_all(self, act):
""" Test rescoring for all students. """
url = reverse('rescore\_problem', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_to\_reset': self.problem\_urlname,
'all\_students': True,
})
@@ -3111,7 +3258,7 @@ def test\_course\_has\_entrance\_exam\_in\_student\_attempts\_reset(self):
""" Test course has entrance exam id set while resetting attempts"""
url = reverse('reset\_student\_attempts\_for\_entrance\_exam',
kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'all\_students': True,
'delete\_module': False,
})
@@ -3121,7 +3268,7 @@ def test\_course\_has\_entrance\_exam\_in\_student\_attempts\_reset(self):
def test\_rescore\_entrance\_exam\_with\_invalid\_exam(self):
""" Test course has entrance exam id set while re-scoring. """
url = reverse('rescore\_entrance\_exam', kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
})
self.assertEqual(response.status\_code, 400)
@@ -3225,7 +3372,7 @@ def test\_reset\_entrance\_exam\_student\_attempts\_deletall(self):
""" Make sure no one can delete all students state on entrance exam. """
url = reverse('reset\_student\_attempts\_for\_entrance\_exam',
kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'all\_students': True,
'delete\_module': True,
})
@@ -3235,7 +3382,7 @@ def test\_reset\_entrance\_exam\_student\_attempts\_single(self):
""" Test reset single student attempts for entrance exam. """
url = reverse('reset\_student\_attempts\_for\_entrance\_exam',
kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
})
self.assertEqual(response.status\_code, 200)
@@ -3253,7 +3400,7 @@ def test\_reset\_entrance\_exam\_all\_student\_attempts(self, act):
""" Test reset all student attempts for entrance exam. """
url = reverse('reset\_student\_attempts\_for\_entrance\_exam',
kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'all\_students': True,
})
self.assertEqual(response.status\_code, 200)
@@ -3263,7 +3410,7 @@ def test\_reset\_student\_attempts\_invalid\_entrance\_exam(self):
""" Test reset for invalid entrance exam. """
url = reverse('reset\_student\_attempts\_for\_entrance\_exam',
kwargs={'course\_id': unicode(self.course\_with\_invalid\_ee.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
})
self.assertEqual(response.status\_code, 400)
@@ -3272,7 +3419,7 @@ def test\_entrance\_exam\_sttudent\_delete\_state(self):
""" Test delete single student entrance exam state. """
url = reverse('reset\_student\_attempts\_for\_entrance\_exam',
kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
'delete\_module': True,
})
@@ -3288,7 +3435,7 @@ def test\_entrance\_exam\_delete\_state\_with\_staff(self):
self.client.login(username=staff\_user.username, password='test')
url = reverse('reset\_student\_attempts\_for\_entrance\_exam',
kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
'delete\_module': True,
})
@@ -3298,7 +3445,7 @@ def test\_entrance\_exam\_reset\_student\_attempts\_nonsense(self):
""" Test failure with both unique\_student\_identifier and all\_students. """
url = reverse('reset\_student\_attempts\_for\_entrance\_exam',
kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
'all\_students': True,
})
@@ -3308,7 +3455,7 @@ def test\_entrance\_exam\_reset\_student\_attempts\_nonsense(self):
def test\_rescore\_entrance\_exam\_single\_student(self, act):
""" Test re-scoring of entrance exam for single student. """
url = reverse('rescore\_entrance\_exam', kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
})
self.assertEqual(response.status\_code, 200)
@@ -3317,7 +3464,7 @@ def test\_rescore\_entrance\_exam\_single\_student(self, act):
def test\_rescore\_entrance\_exam\_all\_student(self):
""" Test rescoring for all students. """
url = reverse('rescore\_entrance\_exam', kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'all\_students': True,
})
self.assertEqual(response.status\_code, 200)
@@ -3325,7 +3472,7 @@ def test\_rescore\_entrance\_exam\_all\_student(self):
def test\_rescore\_entrance\_exam\_all\_student\_and\_single(self):
""" Test re-scoring with both all students and single student parameters. """
url = reverse('rescore\_entrance\_exam', kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
'all\_students': True,
})
@@ -3334,7 +3481,7 @@ def test\_rescore\_entrance\_exam\_all\_student\_and\_single(self):
def test\_rescore\_entrance\_exam\_with\_invalid\_exam(self):
""" Test re-scoring of entrance exam with invalid exam. """
url = reverse('rescore\_entrance\_exam', kwargs={'course\_id': unicode(self.course\_with\_invalid\_ee.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
})
self.assertEqual(response.status\_code, 400)
@@ -3343,13 +3490,13 @@ def test\_list\_entrance\_exam\_instructor\_tasks\_student(self):
""" Test list task history for entrance exam AND student. """
# create a re-score entrance exam task
url = reverse('rescore\_entrance\_exam', kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
})
self.assertEqual(response.status\_code, 200)
url = reverse('list\_entrance\_exam\_instructor\_tasks', kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
})
self.assertEqual(response.status\_code, 200)
@@ -3362,7 +3509,7 @@ def test\_list\_entrance\_exam\_instructor\_tasks\_student(self):
def test\_list\_entrance\_exam\_instructor\_tasks\_all\_student(self):
""" Test list task history for entrance exam AND all student. """
url = reverse('list\_entrance\_exam\_instructor\_tasks', kwargs={'course\_id': unicode(self.course.id)})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertEqual(response.status\_code, 200)
# check response
@@ -3373,7 +3520,7 @@ def test\_list\_entrance\_exam\_instructor\_with\_invalid\_exam\_key(self):
""" Test list task history for entrance exam failure if course has invalid exam. """
url = reverse('list\_entrance\_exam\_instructor\_tasks',
kwargs={'course\_id': unicode(self.course\_with\_invalid\_ee.id)})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'unique\_student\_identifier': self.student.email,
})
self.assertEqual(response.status\_code, 400)
@@ -3589,7 +3736,7 @@ def test\_list\_instructor\_tasks\_running(self, act):
mock\_factory = MockCompletionInfo()
with patch('instructor.views.instructor\_task\_helpers.get\_task\_completion\_info') as mock\_completion\_info:
mock\_completion\_info.side\_effect = mock\_factory.mock\_get\_task\_completion\_info
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertEqual(response.status\_code, 200)
# check response
@@ -3608,7 +3755,7 @@ def test\_list\_background\_email\_tasks(self, act):
mock\_factory = MockCompletionInfo()
with patch('instructor.views.instructor\_task\_helpers.get\_task\_completion\_info') as mock\_completion\_info:
mock\_completion\_info.side\_effect = mock\_factory.mock\_get\_task\_completion\_info
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertEqual(response.status\_code, 200)
# check response
@@ -3627,7 +3774,7 @@ def test\_list\_instructor\_tasks\_problem(self, act):
mock\_factory = MockCompletionInfo()
with patch('instructor.views.instructor\_task\_helpers.get\_task\_completion\_info') as mock\_completion\_info:
mock\_completion\_info.side\_effect = mock\_factory.mock\_get\_task\_completion\_info
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_location\_str': self.problem\_urlname,
})
self.assertEqual(response.status\_code, 200)
@@ -3648,7 +3795,7 @@ def test\_list\_instructor\_tasks\_problem\_student(self, act):
mock\_factory = MockCompletionInfo()
with patch('instructor.views.instructor\_task\_helpers.get\_task\_completion\_info') as mock\_completion\_info:
mock\_completion\_info.side\_effect = mock\_factory.mock\_get\_task\_completion\_info
- response = self.client.get(url, {
+ response = self.client.post(url, {
'problem\_location\_str': self.problem\_urlname,
'unique\_student\_identifier': self.student.email,
})
@@ -3709,7 +3856,7 @@ def get\_email\_content\_response(self, num\_emails, task\_history\_request, with\_fail
url = reverse('list\_email\_content', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
with patch('instructor.views.api.CourseEmail.objects.get') as mock\_email\_info:
mock\_email\_info.side\_effect = self.get\_matching\_mock\_email
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertEqual(response.status\_code, 200)
return response
@@ -3760,7 +3907,7 @@ def test\_list\_email\_content\_error(self, task\_history\_request):
invalid\_task.make\_invalid\_input()
task\_history\_request.return\_value = [invalid\_task]
url = reverse('list\_email\_content', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertEqual(response.status\_code, 200)
self.assertTrue(task\_history\_request.called)
@@ -3786,7 +3933,7 @@ def test\_list\_email\_with\_no\_successes(self, task\_history\_request):
url = reverse('list\_email\_content', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
with patch('instructor.views.api.CourseEmail.objects.get') as mock\_email\_info:
mock\_email\_info.return\_value = email
- response = self.client.get(url, {})
+ response = self.client.post(url, {})
self.assertEqual(response.status\_code, 200)
self.assertTrue(task\_history\_request.called)
@@ -3937,7 +4084,7 @@ def setUp(self):
def test\_change\_due\_date(self):
url = reverse('change\_due\_date', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'student': self.user1.username,
'url': self.week1.location.to\_deprecated\_string(),
'due\_datetime': '12/30/2013 00:00'
@@ -3948,7 +4095,7 @@ def test\_change\_due\_date(self):
def test\_change\_to\_invalid\_due\_date(self):
url = reverse('change\_due\_date', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'student': self.user1.username,
'url': self.week1.location.to\_deprecated\_string(),
'due\_datetime': '01/01/2009 00:00'
@@ -3961,7 +4108,7 @@ def test\_change\_to\_invalid\_due\_date(self):
def test\_change\_nonexistent\_due\_date(self):
url = reverse('change\_due\_date', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'student': self.user1.username,
'url': self.week3.location.to\_deprecated\_string(),
'due\_datetime': '12/30/2013 00:00'
@@ -3975,7 +4122,7 @@ def test\_change\_nonexistent\_due\_date(self):
def test\_reset\_date(self):
self.test\_change\_due\_date()
url = reverse('reset\_due\_date', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'student': self.user1.username,
'url': self.week1.location.to\_deprecated\_string(),
})
@@ -3987,7 +4134,7 @@ def test\_reset\_date(self):
def test\_reset\_nonexistent\_extension(self):
url = reverse('reset\_due\_date', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'student': self.user1.username,
'url': self.week1.location.to\_deprecated\_string(),
})
@@ -3997,7 +4144,7 @@ def test\_show\_unit\_extensions(self):
self.test\_change\_due\_date()
url = reverse('show\_unit\_extensions',
kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {'url': self.week1.location.to\_deprecated\_string()})
+ response = self.client.post(url, {'url': self.week1.location.to\_deprecated\_string()})
self.assertEqual(response.status\_code, 200, response.content)
self.assertEqual(json.loads(response.content), {
u'data': [{u'Extended Due Date': u'2013-12-30 00:00',
@@ -4011,7 +4158,7 @@ def test\_show\_student\_extensions(self):
self.test\_change\_due\_date()
url = reverse('show\_student\_extensions',
kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {'student': self.user1.username})
+ response = self.client.post(url, {'student': self.user1.username})
self.assertEqual(response.status\_code, 200, response.content)
self.assertEqual(json.loads(response.content), {
u'data': [{u'Extended Due Date': u'2013-12-30 00:00',
@@ -4105,7 +4252,7 @@ def test\_reset\_extension\_to\_deleted\_date(self):
"""
url = reverse('change\_due\_date', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'student': self.user1.username,
'url': self.week1.location.to\_deprecated\_string(),
'due\_datetime': '12/30/2013 00:00'
@@ -4118,7 +4265,7 @@ def test\_reset\_extension\_to\_deleted\_date(self):
self.week1 = self.store.update\_item(self.week1, self.user1.id)
# Now, week1's normal due date is deleted but the extension still exists.
url = reverse('reset\_due\_date', kwargs={'course\_id': self.course.id.to\_deprecated\_string()})
- response = self.client.get(url, {
+ response = self.client.post(url, {
'student': self.user1.username,
'url': self.week1.location.to\_deprecated\_string(),
})
@@ -4166,14 +4313,14 @@ def test\_certificates\_features\_against\_status(self):
for \_\_ in xrange(certificate\_count):
self.generate\_certificate(course\_id=self.course.id, mode='honor', status=CertificateStatuses.generating)
- response = self.client.get(url)
+ response = self.client.post(url)
res\_json = json.loads(response.content)
self.assertIn('certificates', res\_json)
self.assertEqual(len(res\_json['certificates']), 0)
# Certificates with status 'downloadable' should be in response.
self.generate\_certificate(course\_id=self.course.id, mode='honor', status=CertificateStatuses.downloadable)
- response = self.client.get(url)
+ response = self.client.post(url)
res\_json = json.loads(response.content)
self.assertIn('certificates', res\_json)
self.assertEqual(len(res\_json['certificates']), 1)
@@ -4188,7 +4335,7 @@ def test\_certificates\_features\_group\_by\_mode(self):
for \_\_ in xrange(certificate\_count):
self.generate\_certificate(course\_id=self.course.id, mode='honor', status=CertificateStatuses.downloadable)
- response = self.client.get(url)
+ response = self.client.post(url)
res\_json = json.loads(response.content)
self.assertIn('certificates', res\_json)
self.assertEqual(len(res\_json['certificates']), 1)
@@ -4207,7 +4354,7 @@ def test\_certificates\_features\_group\_by\_mode(self):
status=CertificateStatuses.downloadable
)
- response = self.client.get(url)
+ response = self.client.post(url)
res\_json = json.loads(response.content)
self.assertIn('certificates', res\_json)
@@ -4224,14 +4371,13 @@ def test\_certificates\_features\_csv(self):
Test for certificate csv features.
"""
url = reverse('get\_issued\_certificates', kwargs={'course\_id': unicode(self.course.id)})
- url += '?csv=true'
# firstly generating downloadable certificates with 'honor' mode
certificate\_count = 3
for \_\_ in xrange(certificate\_count):
self.generate\_certificate(course\_id=self.course.id, mode='honor', status=CertificateStatuses.downloadable)
current\_date = datetime.date.today().strftime("%B %d, %Y")
- response = self.client.get(url)
+ response = self.client.get(url, {'csv': 'true'})
self.assertEqual(response['Content-Type'], 'text/csv')
self.assertEqual(response['Content-Disposition'], 'attachment; filename={0}'.format('issued\_certificates.csv'))
self.assertEqual(
@@ -4680,7 +4826,7 @@ def test\_get\_historical\_coupon\_codes(self):
)
coupon.save()
- response = self.client.get(get\_coupon\_code\_url)
+ response = self.client.post(get\_coupon\_code\_url)
self.assertEqual(response.status\_code, 200, response.content)
# filter all the coupons
for coupon in Coupon.objects.all():
@@ -4721,7 +4867,7 @@ def setUp(self):
self.tempdir = tempfile.mkdtemp()
self.addCleanup(shutil.rmtree, self.tempdir)
- def call\_add\_users\_to\_cohorts(self, csv\_data, suffix='.csv', method='POST'):
+ def call\_add\_users\_to\_cohorts(self, csv\_data, suffix='.csv'):
"""
Call `add\_users\_to\_cohorts` with a file generated from `csv\_data`.
"""
@@ -4731,10 +4877,7 @@ def call\_add\_users\_to\_cohorts(self, csv\_data, suffix='.csv', method='POST'):
file\_pointer.write(csv\_data.encode('utf-8'))
with open(file\_name, 'r') as file\_pointer:
url = reverse('add\_users\_to\_cohorts', kwargs={'course\_id': unicode(self.course.id)})
- if method == 'POST':
- return self.client.post(url, {'uploaded-file': file\_pointer})
- elif method == 'GET':
- return self.client.get(url, {'uploaded-file': file\_pointer})
+ return self.client.post(url, {'uploaded-file': file\_pointer})
def expect\_error\_on\_file\_content(self, file\_content, error, file\_suffix='.csv'):
"""
@@ -4803,14 +4946,6 @@ def test\_non\_staff\_no\_access(self):
response = self.call\_add\_users\_to\_cohorts('')
self.assertEqual(response.status\_code, 403)
- def test\_post\_only(self):
- """
- Verify that we can't call the view when we aren't using POST.
- """
- self.client.login(username=self.staff\_user.username, password='test')
- response = self.call\_add\_users\_to\_cohorts('', method='GET')
- self.assertEqual(response.status\_code, 405)
-
@patch('instructor.views.api.instructor\_task.api.submit\_cohort\_students')
@patch('instructor.views.api.store\_uploaded\_file')
def test\_success\_username(self, mock\_store\_upload, mock\_cohort\_task):
diff --git a/lms/djangoapps/instructor/views/api.py b/lms/djangoapps/instructor/views/api.py
index ca68e241909..02145576860 100644
--- a/lms/djangoapps/instructor/views/api.py
+++ b/lms/djangoapps/instructor/views/api.py
@@ -140,51 +140,14 @@ def wrapped(request, \*args, \*\*kwargs): # pylint: disable=missing-docstring
return wrapped
-def require\_query\_params(\*args, \*\*kwargs):
- """
- Checks for required paremters or renders a 400 error.
- (decorator with arguments)
-
- `args` is a \*list of required GET parameter names.
- `kwargs` is a \*\*dict of required GET parameter names
- to string explanations of the parameter
- """
- required\_params = []
- required\_params += [(arg, None) for arg in args]
- required\_params += [(key, kwargs[key]) for key in kwargs]
- # required\_params = e.g. [('action', 'enroll or unenroll'), ['emails', None]]
-
- def decorator(func): # pylint: disable=missing-docstring
- def wrapped(\*args, \*\*kwargs): # pylint: disable=missing-docstring
- request = args[0]
-
- error\_response\_data = {
- 'error': 'Missing required query parameter(s)',
- 'parameters': [],
- 'info': {},
- }
-
- for (param, extra) in required\_params:
- default = object()
- if request.GET.get(param, default) == default:
- error\_response\_data['parameters'].append(param)
- error\_response\_data['info'][param] = extra
-
- if len(error\_response\_data['parameters']) > 0:
- return JsonResponse(error\_response\_data, status=400)
- else:
- return func(\*args, \*\*kwargs)
- return wrapped
- return decorator
-
-
def require\_post\_params(\*args, \*\*kwargs):
"""
Checks for required parameters or renders a 400 error.
(decorator with arguments)
- Functions like 'require\_query\_params', but checks for
- POST parameters rather than GET parameters.
+ `args` is a \*list of required POST parameter names.
+ `kwargs` is a \*\*dict of required POST parameter names
+ to string explanations of the parameter
"""
required\_params = []
required\_params += [(arg, None) for arg in args]
@@ -314,6 +277,7 @@ def wrapped(request, course\_id): # pylint: disable=missing-docstring
COUNTRY\_INDEX = 3
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -604,6 +568,7 @@ def create\_and\_enroll\_user(email, username, name, country, password, course\_id,
return errors
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -768,6 +733,7 @@ def students\_update\_enrollment(request, course\_id):
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('instructor')
@@ -848,11 +814,12 @@ def bulk\_beta\_modify\_access(request, course\_id):
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('instructor')
@common\_exceptions\_400
-@require\_query\_params(
+@require\_post\_params(
unique\_student\_identifier="email or username of user to change access",
rolename="'instructor', 'staff', 'beta', or 'ccx\_coach'",
action="'allow' or 'revoke'"
@@ -874,10 +841,10 @@ def modify\_access(request, course\_id):
request.user, 'instructor', course\_id, depth=None
)
try:
- user = get\_student\_from\_identifier(request.GET.get('unique\_student\_identifier'))
+ user = get\_student\_from\_identifier(request.POST.get('unique\_student\_identifier'))
except User.DoesNotExist:
response\_payload = {
- 'unique\_student\_identifier': request.GET.get('unique\_student\_identifier'),
+ 'unique\_student\_identifier': request.POST.get('unique\_student\_identifier'),
'userDoesNotExist': True,
}
return JsonResponse(response\_payload)
@@ -892,8 +859,8 @@ def modify\_access(request, course\_id):
}
return JsonResponse(response\_payload)
- rolename = request.GET.get('rolename')
- action = request.GET.get('action')
+ rolename = request.POST.get('rolename')
+ action = request.POST.get('action')
if rolename not in ROLES:
error = strip\_tags("unknown rolename '{}'".format(rolename))
@@ -928,10 +895,11 @@ def modify\_access(request, course\_id):
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('instructor')
-@require\_query\_params(rolename="'instructor', 'staff', or 'beta'")
+@require\_post\_params(rolename="'instructor', 'staff', or 'beta'")
def list\_course\_role\_members(request, course\_id):
"""
List instructors and staff.
@@ -956,7 +924,7 @@ def list\_course\_role\_members(request, course\_id):
request.user, 'instructor', course\_id, depth=None
)
- rolename = request.GET.get('rolename')
+ rolename = request.POST.get('rolename')
if rolename not in ROLES:
return HttpResponseBadRequest()
@@ -980,6 +948,7 @@ def extract\_user\_info(user):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -996,7 +965,7 @@ def get\_problem\_responses(request, course\_id):
Responds with BadRequest if problem location is faulty.
"""
course\_key = CourseKey.from\_string(course\_id)
- problem\_location = request.GET.get('problem\_location', '')
+ problem\_location = request.POST.get('problem\_location', '')
try:
problem\_key = UsageKey.from\_string(problem\_location)
@@ -1025,6 +994,7 @@ def get\_problem\_responses(request, course\_id):
return JsonResponse({"status": already\_running\_status})
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -1223,6 +1193,7 @@ def get\_issued\_certificates(request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -1315,6 +1286,7 @@ def get\_students\_features(request, course\_id, csv=False): # pylint: disable=red
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -1422,6 +1394,7 @@ def get\_coupon\_codes(request, course\_id): # pylint: disable=unused-argument
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -1446,6 +1419,7 @@ def get\_enrollment\_report(request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -1471,6 +1445,7 @@ def get\_exec\_summary\_report(request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -1495,6 +1470,7 @@ def get\_course\_survey\_results(request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -1901,11 +1877,12 @@ def csv\_response(filename, header, rows):
return csv\_response(course\_id.to\_deprecated\_string().replace('/', '-') + '-anon-ids.csv', header, rows)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@common\_exceptions\_400
@require\_level('staff')
-@require\_query\_params(
+@require\_post\_params(
unique\_student\_identifier="email or username of student for whom to get progress url"
)
def get\_student\_progress\_url(request, course\_id):
@@ -1913,13 +1890,13 @@ def get\_student\_progress\_url(request, course\_id):
Get the progress url of a student.
Limited to staff access.
- Takes query paremeter unique\_student\_identifier and if the student exists
+ Takes query parameter unique\_student\_identifier and if the student exists
returns e.g. {
'progress\_url': '/../...'
}
"""
course\_id = SlashSeparatedCourseKey.from\_deprecated\_string(course\_id)
- user = get\_student\_from\_identifier(request.GET.get('unique\_student\_identifier'))
+ user = get\_student\_from\_identifier(request.POST.get('unique\_student\_identifier'))
progress\_url = reverse('student\_progress', kwargs={'course\_id': course\_id.to\_deprecated\_string(), 'student\_id': user.id})
@@ -1931,10 +1908,11 @@ def get\_student\_progress\_url(request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
-@require\_query\_params(
+@require\_post\_params(
problem\_to\_reset="problem urlname to reset"
)
@common\_exceptions\_400
@@ -1961,13 +1939,13 @@ def reset\_student\_attempts(request, course\_id):
request.user, 'staff', course\_id, depth=None
)
- problem\_to\_reset = strip\_if\_string(request.GET.get('problem\_to\_reset'))
- student\_identifier = request.GET.get('unique\_student\_identifier', None)
+ problem\_to\_reset = strip\_if\_string(request.POST.get('problem\_to\_reset'))
+ student\_identifier = request.POST.get('unique\_student\_identifier', None)
student = None
if student\_identifier is not None:
student = get\_student\_from\_identifier(student\_identifier)
- all\_students = request.GET.get('all\_students', False) in ['true', 'True', True]
- delete\_module = request.GET.get('delete\_module', False) in ['true', 'True', True]
+ all\_students = request.POST.get('all\_students', False) in ['true', 'True', True]
+ delete\_module = request.POST.get('delete\_module', False) in ['true', 'True', True]
# parameter combinations
if all\_students and student:
@@ -2019,6 +1997,7 @@ def reset\_student\_attempts(request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2049,12 +2028,12 @@ def reset\_student\_attempts\_for\_entrance\_exam(request, course\_id): # pylint: dis
\_("Course has no entrance exam section.")
)
- student\_identifier = request.GET.get('unique\_student\_identifier', None)
+ student\_identifier = request.POST.get('unique\_student\_identifier', None)
student = None
if student\_identifier is not None:
student = get\_student\_from\_identifier(student\_identifier)
- all\_students = request.GET.get('all\_students', False) in ['true', 'True', True]
- delete\_module = request.GET.get('delete\_module', False) in ['true', 'True', True]
+ all\_students = request.POST.get('all\_students', False) in ['true', 'True', True]
+ delete\_module = request.POST.get('delete\_module', False) in ['true', 'True', True]
# parameter combinations
if all\_students and student:
@@ -2085,10 +2064,11 @@ def reset\_student\_attempts\_for\_entrance\_exam(request, course\_id): # pylint: dis
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('instructor')
-@require\_query\_params(problem\_to\_reset="problem urlname to reset")
+@require\_post\_params(problem\_to\_reset="problem urlname to reset")
@common\_exceptions\_400
def rescore\_problem(request, course\_id):
"""
@@ -2103,13 +2083,13 @@ def rescore\_problem(request, course\_id):
all\_students and unique\_student\_identifier cannot both be present.
"""
course\_id = SlashSeparatedCourseKey.from\_deprecated\_string(course\_id)
- problem\_to\_reset = strip\_if\_string(request.GET.get('problem\_to\_reset'))
- student\_identifier = request.GET.get('unique\_student\_identifier', None)
+ problem\_to\_reset = strip\_if\_string(request.POST.get('problem\_to\_reset'))
+ student\_identifier = request.POST.get('unique\_student\_identifier', None)
student = None
if student\_identifier is not None:
student = get\_student\_from\_identifier(student\_identifier)
- all\_students = request.GET.get('all\_students') in ['true', 'True', True]
+ all\_students = request.POST.get('all\_students') in ['true', 'True', True]
if not (problem\_to\_reset and (all\_students or student)):
return HttpResponseBadRequest("Missing query parameters.")
@@ -2141,6 +2121,7 @@ def rescore\_problem(request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('instructor')
@@ -2161,12 +2142,12 @@ def rescore\_entrance\_exam(request, course\_id):
request.user, 'staff', course\_id, depth=None
)
- student\_identifier = request.GET.get('unique\_student\_identifier', None)
+ student\_identifier = request.POST.get('unique\_student\_identifier', None)
student = None
if student\_identifier is not None:
student = get\_student\_from\_identifier(student\_identifier)
- all\_students = request.GET.get('all\_students') in ['true', 'True', True]
+ all\_students = request.POST.get('all\_students') in ['true', 'True', True]
if not course.entrance\_exam\_id:
return HttpResponseBadRequest(
@@ -2193,6 +2174,7 @@ def rescore\_entrance\_exam(request, course\_id):
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2211,6 +2193,7 @@ def list\_background\_email\_tasks(request, course\_id): # pylint: disable=unused-a
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2229,6 +2212,7 @@ def list\_email\_content(request, course\_id): # pylint: disable=unused-argument
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2243,8 +2227,8 @@ def list\_instructor\_tasks(request, course\_id):
history for problem AND student (intersection)
"""
course\_id = SlashSeparatedCourseKey.from\_deprecated\_string(course\_id)
- problem\_location\_str = strip\_if\_string(request.GET.get('problem\_location\_str', False))
- student = request.GET.get('unique\_student\_identifier', None)
+ problem\_location\_str = strip\_if\_string(request.POST.get('problem\_location\_str', False))
+ student = request.POST.get('unique\_student\_identifier', None)
if student is not None:
student = get\_student\_from\_identifier(student)
@@ -2274,6 +2258,7 @@ def list\_instructor\_tasks(request, course\_id):
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2287,7 +2272,7 @@ def list\_entrance\_exam\_instructor\_tasks(request, course\_id): # pylint: disable=
"""
course\_id = SlashSeparatedCourseKey.from\_deprecated\_string(course\_id)
course = get\_course\_by\_id(course\_id)
- student = request.GET.get('unique\_student\_identifier', None)
+ student = request.POST.get('unique\_student\_identifier', None)
if student is not None:
student = get\_student\_from\_identifier(student)
@@ -2308,6 +2293,7 @@ def list\_entrance\_exam\_instructor\_tasks(request, course\_id): # pylint: disable=
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2327,6 +2313,7 @@ def list\_report\_downloads(\_request, course\_id):
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2348,6 +2335,7 @@ def list\_financial\_report\_downloads(\_request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2373,6 +2361,7 @@ def export\_ora2\_data(request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2394,6 +2383,7 @@ def calculate\_grades\_csv(request, course\_id):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2420,10 +2410,11 @@ def problem\_grade\_report(request, course\_id):
})
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
-@require\_query\_params('rolename')
+@require\_post\_params('rolename')
def list\_forum\_members(request, course\_id):
"""
Lists forum members of a certain rolename.
@@ -2442,7 +2433,7 @@ def list\_forum\_members(request, course\_id):
request.user, course\_id, FORUM\_ROLE\_ADMINISTRATOR
)
- rolename = request.GET.get('rolename')
+ rolename = request.POST.get('rolename')
# default roles require either (staff & forum admin) or (instructor)
if not (has\_forum\_admin or has\_instructor\_access):
@@ -2483,6 +2474,7 @@ def extract\_user\_info(user):
@transaction.non\_atomic\_requests
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
@@ -2539,10 +2531,11 @@ def send\_email(request, course\_id):
return JsonResponse(response\_payload)
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
-@require\_query\_params(
+@require\_post\_params(
unique\_student\_identifier="email or username of user to change access",
rolename="the forum role",
action="'allow' or 'revoke'",
@@ -2569,9 +2562,9 @@ def update\_forum\_role\_membership(request, course\_id):
request.user, course\_id, FORUM\_ROLE\_ADMINISTRATOR
)
- unique\_student\_identifier = request.GET.get('unique\_student\_identifier')
- rolename = request.GET.get('rolename')
- action = request.GET.get('action')
+ unique\_student\_identifier = request.POST.get('unique\_student\_identifier')
+ rolename = request.POST.get('rolename')
+ action = request.POST.get('action')
# default roles require either (staff & forum admin) or (instructor)
if not (has\_forum\_admin or has\_instructor\_access):
@@ -2629,18 +2622,19 @@ def \_display\_unit(unit):
@handle\_dashboard\_error
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
-@require\_query\_params('student', 'url', 'due\_datetime')
+@require\_post\_params('student', 'url', 'due\_datetime')
def change\_due\_date(request, course\_id):
"""
Grants a due date extension to a student for a particular unit.
"""
course = get\_course\_by\_id(SlashSeparatedCourseKey.from\_deprecated\_string(course\_id))
- student = require\_student\_from\_identifier(request.GET.get('student'))
- unit = find\_unit(course, request.GET.get('url'))
- due\_date = parse\_datetime(request.GET.get('due\_datetime'))
+ student = require\_student\_from\_identifier(request.POST.get('student'))
+ unit = find\_unit(course, request.POST.get('url'))
+ due\_date = parse\_datetime(request.POST.get('due\_datetime'))
set\_due\_date\_extension(course, unit, student, due\_date)
return JsonResponse(\_(
@@ -2650,17 +2644,18 @@ def change\_due\_date(request, course\_id):
@handle\_dashboard\_error
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
-@require\_query\_params('student', 'url')
+@require\_post\_params('student', 'url')
def reset\_due\_date(request, course\_id):
"""
Rescinds a due date extension for a student on a particular unit.
"""
course = get\_course\_by\_id(SlashSeparatedCourseKey.from\_deprecated\_string(course\_id))
- student = require\_student\_from\_identifier(request.GET.get('student'))
- unit = find\_unit(course, request.GET.get('url'))
+ student = require\_student\_from\_identifier(request.POST.get('student'))
+ unit = find\_unit(course, request.POST.get('url'))
set\_due\_date\_extension(course, unit, student, None)
if not getattr(unit, "due", None):
# It's possible the normal due date was deleted after an extension was granted:
@@ -2676,30 +2671,32 @@ def reset\_due\_date(request, course\_id):
@handle\_dashboard\_error
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
-@require\_query\_params('url')
+@require\_post\_params('url')
def show\_unit\_extensions(request, course\_id):
"""
Shows all of the students which have due date extensions for the given unit.
"""
course = get\_course\_by\_id(SlashSeparatedCourseKey.from\_deprecated\_string(course\_id))
- unit = find\_unit(course, request.GET.get('url'))
+ unit = find\_unit(course, request.POST.get('url'))
return JsonResponse(dump\_module\_extensions(course, unit))
@handle\_dashboard\_error
+@require\_POST
@ensure\_csrf\_cookie
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_level('staff')
-@require\_query\_params('student')
+@require\_post\_params('student')
def show\_student\_extensions(request, course\_id):
"""
Shows all of the due date extensions granted to a particular student in a
particular course.
"""
- student = require\_student\_from\_identifier(request.GET.get('student'))
+ student = require\_student\_from\_identifier(request.POST.get('student'))
course = get\_course\_by\_id(SlashSeparatedCourseKey.from\_deprecated\_string(course\_id))
return JsonResponse(dump\_student\_extensions(course, student))
@@ -3076,7 +3073,6 @@ def generate\_certificate\_exceptions(request, course\_id, generate\_for=None):
return JsonResponse(response\_payload)
-@csrf\_exempt
@cache\_control(no\_cache=True, no\_store=True, must\_revalidate=True)
@require\_global\_staff
@require\_POST
diff --git a/lms/static/coffee/src/instructor\_dashboard/data\_download.coffee b/lms/static/coffee/src/instructor\_dashboard/data\_download.coffee
index 7d2ab57af64..4fe762965aa 100644
--- a/lms/static/coffee/src/instructor\_dashboard/data\_download.coffee
+++ b/lms/static/coffee/src/instructor\_dashboard/data\_download.coffee
@@ -110,6 +110,7 @@ class DataDownload
url = @$list\_proctored\_exam\_results\_csv\_btn.data 'endpoint'
# display html from proctored exam results config endpoint
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
error: (std\_ajax\_err) =>
@@ -129,6 +130,7 @@ class DataDownload
url = @$survey\_results\_csv\_btn.data 'endpoint'
# display html from survey results config endpoint
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
error: (std\_ajax\_err) =>
@@ -153,6 +155,7 @@ class DataDownload
url += '/csv'
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
error: (std\_ajax\_err) =>
@@ -171,6 +174,7 @@ class DataDownload
# fetch user list
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
error: (std\_ajax\_err) =>
@@ -199,6 +203,7 @@ class DataDownload
url = @$list\_problem\_responses\_csv\_btn.data 'endpoint'
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
data:
@@ -215,6 +220,7 @@ class DataDownload
url = @$list\_may\_enroll\_csv\_btn.data 'endpoint'
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
error: (std\_ajax\_err) =>
@@ -228,6 +234,7 @@ class DataDownload
url = @$grade\_config\_btn.data 'endpoint'
# display html from grading config endpoint
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
error: (std\_ajax\_err) =>
@@ -244,6 +251,7 @@ class DataDownload
@clear\_display()
url = $(e.target).data 'endpoint'
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
error: std\_ajax\_err =>
diff --git a/lms/static/coffee/src/instructor\_dashboard/extensions.coffee b/lms/static/coffee/src/instructor\_dashboard/extensions.coffee
index a615d315249..a45cffce67b 100644
--- a/lms/static/coffee/src/instructor\_dashboard/extensions.coffee
+++ b/lms/static/coffee/src/instructor\_dashboard/extensions.coffee
@@ -45,6 +45,7 @@ class Extensions
due\_datetime: @$due\_datetime\_input.val()
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$change\_due\_date.data 'endpoint'
data: send\_data
@@ -60,6 +61,7 @@ class Extensions
url: @$url\_input.val()
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$reset\_due\_date.data 'endpoint'
data: send\_data
@@ -75,6 +77,7 @@ class Extensions
send\_data =
url: @$url\_input.val()
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
data: send\_data
@@ -90,6 +93,7 @@ class Extensions
send\_data =
student: @$student\_input.val()
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
data: send\_data
diff --git a/lms/static/coffee/src/instructor\_dashboard/membership.coffee b/lms/static/coffee/src/instructor\_dashboard/membership.coffee
index 8888f6b8566..194f0cd4a32 100644
--- a/lms/static/coffee/src/instructor\_dashboard/membership.coffee
+++ b/lms/static/coffee/src/instructor\_dashboard/membership.coffee
@@ -137,6 +137,7 @@ class AuthListWidget extends MemberListWidget
# `cb` is called with cb(error, member\_list)
get\_member\_list: (cb) ->
$.ajax
+ type: 'POST'
dataType: 'json'
url: @list\_endpoint
data: rolename: @rolename
@@ -151,6 +152,7 @@ class AuthListWidget extends MemberListWidget
# `cb` is called with cb(error, data)
modify\_member\_access: (unique\_student\_identifier, action, cb) ->
$.ajax
+ type: 'POST'
dataType: 'json'
url: @modify\_endpoint
data:
@@ -645,6 +647,7 @@ class AuthList
# the endpoint comes from data-endpoint of the table
$.ajax
dataType: 'json'
+ type: 'POST'
url: @$display\_table.data 'endpoint'
data: rolename: @rolename
success: load\_auth\_list
@@ -664,6 +667,7 @@ class AuthList
access\_change: (email, action, cb) ->
$.ajax
dataType: 'json'
+ type: 'POST'
url: @$add\_section.data 'endpoint'
data:
email: email
diff --git a/lms/static/coffee/src/instructor\_dashboard/send\_email.coffee b/lms/static/coffee/src/instructor\_dashboard/send\_email.coffee
index 2de77698c5a..6edf49d1966 100644
--- a/lms/static/coffee/src/instructor\_dashboard/send\_email.coffee
+++ b/lms/static/coffee/src/instructor\_dashboard/send\_email.coffee
@@ -99,6 +99,7 @@ class @SendEmail
@$btn\_task\_history\_email.click =>
url = @$btn\_task\_history\_email.data 'endpoint'
$.ajax
+ type: 'POST'
dataType: 'json'
url: url
success: (data) =>
@@ -115,6 +116,7 @@ class @SendEmail
@$btn\_task\_history\_email\_content.click =>
url = @$btn\_task\_history\_email\_content.data 'endpoint'
$.ajax
+ type: 'POST'
dataType: 'json'
url : url
success: (data) =>
diff --git a/lms/static/coffee/src/instructor\_dashboard/student\_admin.coffee b/lms/static/coffee/src/instructor\_dashboard/student\_admin.coffee
index 8dd8a19bcd4..c9de7cba742 100644
--- a/lms/static/coffee/src/instructor\_dashboard/student\_admin.coffee
+++ b/lms/static/coffee/src/instructor\_dashboard/student\_admin.coffee
@@ -76,6 +76,7 @@ class @StudentAdmin
full\_error\_message = \_.template(error\_message)({student\_id: unique\_student\_identifier})
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$progress\_link.data 'endpoint'
data: unique\_student\_identifier: unique\_student\_identifier
@@ -101,6 +102,7 @@ class @StudentAdmin
full\_error\_message = \_.template(error\_message)({problem\_id: problem\_to\_reset, student\_id: unique\_student\_identifier})
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_reset\_attempts\_single.data 'endpoint'
data: send\_data
@@ -127,6 +129,7 @@ class @StudentAdmin
full\_error\_message = \_.template(error\_message)({student\_id: unique\_student\_identifier, problem\_id: problem\_to\_reset})
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_delete\_state\_single.data 'endpoint'
data: send\_data
@@ -153,6 +156,7 @@ class @StudentAdmin
full\_error\_message = \_.template(error\_message)({student\_id: unique\_student\_identifier, problem\_id: problem\_to\_reset})
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_rescore\_problem\_single.data 'endpoint'
data: send\_data
@@ -174,6 +178,7 @@ class @StudentAdmin
full\_error\_message = \_.template(error\_message)({student\_id: unique\_student\_identifier, problem\_id: problem\_to\_reset})
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_task\_history\_single.data 'endpoint'
data: send\_data
@@ -191,6 +196,7 @@ class @StudentAdmin
delete\_module: false
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_reset\_entrance\_exam\_attempts.data 'endpoint'
data: send\_data
@@ -212,6 +218,7 @@ class @StudentAdmin
unique\_student\_identifier: unique\_student\_identifier
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_rescore\_entrance\_exam.data 'endpoint'
data: send\_data
@@ -256,6 +263,7 @@ class @StudentAdmin
delete\_module: true
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_delete\_entrance\_exam\_state.data 'endpoint'
data: send\_data
@@ -277,6 +285,7 @@ class @StudentAdmin
unique\_student\_identifier: unique\_student\_identifier
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_entrance\_exam\_task\_history.data 'endpoint'
data: send\_data
@@ -304,6 +313,7 @@ class @StudentAdmin
full\_error\_message = \_.template(error\_message)({problem\_id: problem\_to\_reset})
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_reset\_attempts\_all.data 'endpoint'
data: send\_data
@@ -330,6 +340,7 @@ class @StudentAdmin
full\_error\_message = \_.template(error\_message)({problem\_id: problem\_to\_reset})
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_rescore\_problem\_all.data 'endpoint'
data: send\_data
@@ -348,6 +359,7 @@ class @StudentAdmin
return @$request\_response\_error\_all.text gettext("Please enter a problem location.")
$.ajax
+ type: 'POST'
dataType: 'json'
url: @$btn\_task\_history\_all.data 'endpoint'
data: send\_data
diff --git a/lms/static/coffee/src/instructor\_dashboard/util.coffee b/lms/static/coffee/src/instructor\_dashboard/util.coffee
index 1f2395efeb8..5782107b22c 100644
--- a/lms/static/coffee/src/instructor\_dashboard/util.coffee
+++ b/lms/static/coffee/src/instructor\_dashboard/util.coffee
@@ -336,6 +336,7 @@ class @PendingInstructorTasks
reload\_running\_tasks\_list: =>
list\_endpoint = @$table\_running\_tasks.data 'endpoint'
$.ajax
+ type: 'POST'
dataType: 'json'
url: list\_endpoint
success: (data) =>
@@ -392,6 +393,7 @@ class ReportDownloads
reload\_report\_downloads: ->
endpoint = @$report\_downloads\_table.data 'endpoint'
$.ajax
+ type: 'POST'
dataType: 'json'
url: endpoint
success: (data) =>
diff --git a/lms/static/js/instructor\_dashboard/ecommerce.js b/lms/static/js/instructor\_dashboard/ecommerce.js
index 69f0e767344..7f2f67d06cc 100644
--- a/lms/static/js/instructor\_dashboard/ecommerce.js
+++ b/lms/static/js/instructor\_dashboard/ecommerce.js
@@ -45,6 +45,7 @@ var edx = edx || {};
$('input[name="user-enrollment-report"]').click(function(){
var url = $(this).data('endpoint');
$.ajax({
+ type: 'POST',
dataType: "json",
url: url,
success: function (data) {
@@ -64,6 +65,7 @@ var edx = edx || {};
$('input[name="exec-summary-report"]').click(function(){
var url = $(this).data('endpoint');
$.ajax({
+ type: 'POST',
dataType: "json",
url: url,
success: function (data) {
diff --git a/lms/static/js/spec/instructor\_dashboard/student\_admin\_spec.js b/lms/static/js/spec/instructor\_dashboard/student\_admin\_spec.js
index 662930be639..ca07df9f8f5 100644
--- a/lms/static/js/spec/instructor\_dashboard/student\_admin\_spec.js
+++ b/lms/static/js/spec/instructor\_dashboard/student\_admin\_spec.js
@@ -36,15 +36,15 @@ define(['jquery', 'coffee/src/instructor\_dashboard/student\_admin', 'common/js/sp
// Spy on AJAX requests
var requests = AjaxHelpers.requests(this);
- studentadmin.$field\_entrance\_exam\_student\_select\_grade.val(unique\_student\_identifier)
+ studentadmin.$field\_entrance\_exam\_student\_select\_grade.val(unique\_student\_identifier);
studentadmin.$btn\_reset\_entrance\_exam\_attempts.click();
// Verify that the client contacts the server to start instructor task
var params = $.param({
unique\_student\_identifier: unique\_student\_identifier,
delete\_module: false
});
- var url = dashboard\_api\_url + '/reset\_student\_attempts\_for\_entrance\_exam?' + params;
- AjaxHelpers.expectJsonRequest(requests, 'GET', url);
+ var url = dashboard\_api\_url + '/reset\_student\_attempts\_for\_entrance\_exam';
+ AjaxHelpers.expectPostRequest(requests, url, params);
// Simulate a success response from the server
AjaxHelpers.respondWithJson(requests, {
@@ -63,8 +63,8 @@ define(['jquery', 'coffee/src/instructor\_dashboard/student\_admin', 'common/js/sp
unique\_student\_identifier: unique\_student\_identifier,
delete\_module: false
});
- var url = dashboard\_api\_url + '/reset\_student\_attempts\_for\_entrance\_exam?' + params;
- AjaxHelpers.expectJsonRequest(requests, 'GET', url);
+ var url = dashboard\_api\_url + '/reset\_student\_attempts\_for\_entrance\_exam';
+ AjaxHelpers.expectPostRequest(requests, url, params);
// Simulate an error response from the server
AjaxHelpers.respondWithError(requests, 400,{});
@@ -96,8 +96,8 @@ define(['jquery', 'coffee/src/instructor\_dashboard/student\_admin', 'common/js/sp
var params = $.param({
unique\_student\_identifier: unique\_student\_identifier
});
- var url = dashboard\_api\_url + '/rescore\_entrance\_exam?' + params;
- AjaxHelpers.expectJsonRequest(requests, 'GET', url);
+ var url = dashboard\_api\_url + '/rescore\_entrance\_exam';
+ AjaxHelpers.expectPostRequest(requests, url, params);
// Simulate a success response from the server
AjaxHelpers.respondWithJson(requests, {
@@ -115,8 +115,8 @@ define(['jquery', 'coffee/src/instructor\_dashboard/student\_admin', 'common/js/sp
var params = $.param({
unique\_student\_identifier: unique\_student\_identifier
});
- var url = dashboard\_api\_url + '/rescore\_entrance\_exam?' + params;
- AjaxHelpers.expectJsonRequest(requests, 'GET', url);
+ var url = dashboard\_api\_url + '/rescore\_entrance\_exam';
+ AjaxHelpers.expectPostRequest(requests, url, params);
// Simulate an error response from the server
AjaxHelpers.respondWithError(requests, 400,{});
@@ -195,8 +195,8 @@ define(['jquery', 'coffee/src/instructor\_dashboard/student\_admin', 'common/js/sp
unique\_student\_identifier: unique\_student\_identifier,
delete\_module: true
});
- var url = dashboard\_api\_url + '/reset\_student\_attempts\_for\_entrance\_exam?' + params;
- AjaxHelpers.expectJsonRequest(requests, 'GET', url);
+ var url = dashboard\_api\_url + '/reset\_student\_attempts\_for\_entrance\_exam';
+ AjaxHelpers.expectPostRequest(requests, url, params);
// Simulate a success response from the server
AjaxHelpers.respondWithJson(requests, {
@@ -215,8 +215,8 @@ define(['jquery', 'coffee/src/instructor\_dashboard/student\_admin', 'common/js/sp
unique\_student\_identifier: unique\_student\_identifier,
delete\_module: true
});
- var url = dashboard\_api\_url + '/reset\_student\_attempts\_for\_entrance\_exam?' + params;
- AjaxHelpers.expectJsonRequest(requests, 'GET', url);
+ var url = dashboard\_api\_url + '/reset\_student\_attempts\_for\_entrance\_exam';
+ AjaxHelpers.expectPostRequest(requests, url, params);
// Simulate an error response from the server
AjaxHelpers.respondWithError(requests, 400,{});
@@ -248,8 +248,8 @@ define(['jquery', 'coffee/src/instructor\_dashboard/student\_admin', 'common/js/sp
var params = $.param({
unique\_student\_identifier: unique\_student\_identifier
});
- var url = dashboard\_api\_url + '/list\_entrance\_exam\_instructor\_tasks?' + params;
- AjaxHelpers.expectJsonRequest(requests, 'GET', url);
+ var url = dashboard\_api\_url + '/list\_entrance\_exam\_instructor\_tasks';
+ AjaxHelpers.expectPostRequest(requests, url, params);
// Simulate a success response from the server
AjaxHelpers.respondWithJson(requests, {
@@ -279,8 +279,8 @@ define(['jquery', 'coffee/src/instructor\_dashboard/student\_admin', 'common/js/sp
var params = $.param({
unique\_student\_identifier: unique\_student\_identifier
});
- var url = dashboard\_api\_url + '/list\_entrance\_exam\_instructor\_tasks?' + params;
- AjaxHelpers.expectJsonRequest(requests, 'GET', url);
+ var url = dashboard\_api\_url + '/list\_entrance\_exam\_instructor\_tasks';
+ AjaxHelpers.expectPostRequest(requests, url, params);
// Simulate an error response from the server
AjaxHelpers.respondWithError(requests, 400,{});
diff --git a/lms/static/js/spec/staff\_debug\_actions\_spec.js b/lms/static/js/spec/staff\_debug\_actions\_spec.js
index 3486fd7267d..bbc63e18554 100644
--- a/lms/static/js/spec/staff\_debug\_actions\_spec.js
+++ b/lms/static/js/spec/staff\_debug\_actions\_spec.js
@@ -91,7 +91,7 @@ define([
spyOn($, 'ajax');
StaffDebug.reset(locationName, location);
- expect($.ajax.calls.mostRecent().args[0].type).toEqual('GET');
+ expect($.ajax.calls.mostRecent().args[0].type).toEqual('POST');
expect($.ajax.calls.mostRecent().args[0].data).toEqual({
'problem\_to\_reset': location,
'unique\_student\_identifier': 'userman',
@@ -110,7 +110,7 @@ define([
spyOn($, 'ajax');
StaffDebug.sdelete(locationName, location);
- expect($.ajax.calls.mostRecent().args[0].type).toEqual('GET');
+ expect($.ajax.calls.mostRecent().args[0].type).toEqual('POST');
expect($.ajax.calls.mostRecent().args[0].data).toEqual({
'problem\_to\_reset': location,
'unique\_student\_identifier': 'userman',
@@ -130,7 +130,7 @@ define([
spyOn($, 'ajax');
StaffDebug.rescore(locationName, location);
- expect($.ajax.calls.mostRecent().args[0].type).toEqual('GET');
+ expect($.ajax.calls.mostRecent().args[0].type).toEqual('POST');
expect($.ajax.calls.mostRecent().args[0].data).toEqual({
'problem\_to\_reset': location,
'unique\_student\_identifier': 'userman',
diff --git a/lms/static/js/staff\_debug\_actions.js b/lms/static/js/staff\_debug\_actions.js
index 5774a433569..ef77a416cf7 100644
--- a/lms/static/js/staff\_debug\_actions.js
+++ b/lms/static/js/staff\_debug\_actions.js
@@ -31,7 +31,7 @@ var StaffDebug = (function (){
'delete\_module': action.delete\_module
};
$.ajax({
- type: "GET",
+ type: "POST",
url: get\_url(action.method),
data: pdata,
success: function(data){

