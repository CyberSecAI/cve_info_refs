=== Content from github.com_9555f4a1_20250124_201925.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnodejs%2Fnode%2Fissues%2F7388)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnodejs%2Fnode%2Fissues%2F7388)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=nodejs%2Fnode)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nodejs](/nodejs)
/
**[node](/nodejs/node)**
Public

* [Notifications](/login?return_to=%2Fnodejs%2Fnode) You must be signed in to change notification settings
* [Fork
  30.4k](/login?return_to=%2Fnodejs%2Fnode)
* [Star
   109k](/login?return_to=%2Fnodejs%2Fnode)

* [Code](/nodejs/node)
* [Issues
  1.6k](/nodejs/node/issues)
* [Pull requests
  508](/nodejs/node/pulls)
* [Discussions](/nodejs/node/discussions)
* [Actions](/nodejs/node/actions)
* [Projects
  2](/nodejs/node/projects)
* [Security](/nodejs/node/security)
* [Insights](/nodejs/node/pulse)

Additional navigation options

* [Code](/nodejs/node)
* [Issues](/nodejs/node/issues)
* [Pull requests](/nodejs/node/pulls)
* [Discussions](/nodejs/node/discussions)
* [Actions](/nodejs/node/actions)
* [Projects](/nodejs/node/projects)
* [Security](/nodejs/node/security)
* [Insights](/nodejs/node/pulse)

# Error: toString failed #7388

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Error: toString failed](#top)#7388Copy linkAssignees [![MylesBorins](https://avatars.githubusercontent.com/u/498775?s=64&v=4)](/MylesBorins)Labels[bufferIssues and PRs related to the buffer subsystem.](https://github.com/nodejs/node/issues?q=state%3Aopen%20label%3A%22buffer%22)Issues and PRs related to the buffer subsystem.[netIssues and PRs related to the net subsystem.](https://github.com/nodejs/node/issues?q=state%3Aopen%20label%3A%22net%22)Issues and PRs related to the net subsystem.[questionIssues that look for answers.](https://github.com/nodejs/node/issues?q=state%3Aopen%20label%3A%22question%22)Issues that look for answers.[![@Alchemystic](https://avatars.githubusercontent.com/u/4026896?u=64a69ceef8a26d92efa5b47a6b38dadf20ad3295&v=4&size=80)](/Alchemystic)
## Description

[![@Alchemystic](https://avatars.githubusercontent.com/u/4026896?u=64a69ceef8a26d92efa5b47a6b38dadf20ad3295&v=4&size=48)](/Alchemystic)[Alchemystic](https://github.com/Alchemystic)opened [on Jun 23, 2016](https://github.com/nodejs/node/issues/7388#issue-161962143)

* **Version**: v4.4.5
* **Platform**: Linux 3.19.0-61-generic [Add `major`, `minor`, and `patch` labels to PRs, Issues #69](https://github.com/nodejs/node/issues/69)~14.04.1-Ubuntu SMP Thu Jun 9 09:09:13 UTC 2016 x86\_64 x86\_64 x86\_64 GNU/Linux

Node server using socket.io is getting hit by some kind of attack that makes it crash, with the error "toString failed". At first I thought I'm just trying to process some really long string sent via sockets by an user, but it's not, it crashes even without doing anything with the messages coming in from the socket events. The code below is the most barebones I could get the actual server while still having it be vulnerable to whatever this is. The "socketio-wildcard" was only added to this so I could see all the events sent in, but there is none when it's actually crashing, just a new connection opening then it goes down. It's definitely some sort of attack or exploit, cloning the server to a different IP made it stop, until after the new was released to the public (site put back online). There were also some spikes in traffic but they didn't coincide with the actual crashes so I'm gonna assume they were just some failed ddos attempts not related to this issue. Anyone encountered this before?

Code:

```
var port=3001;

var toobusy = require('toobusy-js');
var app = require('express')();
var http = require('http').Server(app);
var io = require('socket.io')(http);
var middleware = require('socketio-wildcard')(); //only using this to catch all events, usually only listening for specific events

var Ddos = require('ddos'); //added this later, didn't seem to help
var ddos = new Ddos;
app.use(ddos.express);

io.use(middleware);

http.listen(port, function() {
    console.log('Socket listening on *:'+port);
});

app.use(function(req, res, next) {
    if (toobusy()) {
        console.log('Server is too busy, returning 503.');
        res.send(503, "I'm busy right now, sorry.");
    } else {
        next();
    }
});

// Add headers
app.use(function (req, res, next) {
    // Website you wish to allow to connect
    res.setHeader('Access-Control-Allow-Origin', 'http://siteurl.com');
    // Request methods you wish to allow
    res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE, UPGRADE');
    // Request headers you wish to allow
    res.setHeader('Access-Control-Allow-Headers', 'X-Requested-With,content-type');
    res.setHeader('Access-Control-Allow-Credentials', false);
    next();
});

io.on('connection', function(socket) {
    console.log('new connection: '+socket.id);
    console.log(socket);
    socket.on('*', function(data){
        console.log('new socket message: ');
        console.log(data);
    });
});

process.on('SIGINT', function() {
    console.log('Closing server...');
    toobusy.shutdown();
    process.exit();
});

process.on('exit', function () {
    console.log('About to exit.');
});
```

Error:

```
Error: toString failed
    at Buffer.toString (buffer.js:377:11)
    at /home/alex/node_modules/socket.io/node_modules/engine.io/node_modules/ws/lib/Receiver.js:477:39
    at Receiver.applyExtensions (/home/alex/node_modules/socket.io/node_modules/engine.io/node_modules/ws/lib/Receiver.js:364:5)
    at /home/alex/node_modules/socket.io/node_modules/engine.io/node_modules/ws/lib/Receiver.js:466:14
    at Receiver.flush (/home/alex/node_modules/socket.io/node_modules/engine.io/node_modules/ws/lib/Receiver.js:340:3)
    at Receiver.opcodes.1.finish (/home/alex/node_modules/socket.io/node_modules/engine.io/node_modules/ws/lib/Receiver.js:482:12)
    at Receiver.expectHandler (/home/alex/node_modules/socket.io/node_modules/engine.io/node_modules/ws/lib/Receiver.js:451:33)
    at Receiver.add (/home/alex/node_modules/socket.io/node_modules/engine.io/node_modules/ws/lib/Receiver.js:95:24)
    at Socket.realHandler (/home/alex/node_modules/socket.io/node_modules/engine.io/node_modules/ws/lib/WebSocket.js:800:20)
    at emitOne (events.js:77:13)
    at Socket.emit (events.js:169:7)

```

Full log of the output when crashing:

<http://pastebin.com/EvAxGQj6>

Couldn't do anymore logging because after some time the "attack" stopped, it used to keep going even after the server crashed, but right now it seems to be more "calculated" so to speak, stopping as soon as the server crashes, making it really difficult for me to debug anything.

👍1
## Metadata

### Assignees

* [![@MylesBorins](https://avatars.githubusercontent.com/u/498775?s=64&v=4)MylesBorins](/MylesBorins)
### Labels

[bufferIssues and PRs related to the buffer subsystem.](https://github.com/nodejs/node/issues?q=state%3Aopen%20label%3A%22buffer%22)Issues and PRs related to the buffer subsystem.[netIssues and PRs related to the net subsystem.](https://github.com/nodejs/node/issues?q=state%3Aopen%20label%3A%22net%22)Issues and PRs related to the net subsystem.[questionIssues that look for answers.](https://github.com/nodejs/node/issues?q=state%3Aopen%20label%3A%22question%22)Issues that look for answers.
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


