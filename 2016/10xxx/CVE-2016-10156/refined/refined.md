```
{
  "cveId": "CVE-2016-10156",
  "description": "The vulnerability exists in systemd version 228. The `touch_file` function in `fs-util.c` incorrectly uses `MODE_INVALID` which results in the creation of world-writable SUID files. This allows a local attacker to gain root privileges by injecting malicious code into these files and executing them. This is because `mode_t` is unsigned and `MODE_INVALID` is a negative value which when evaluated as an unsigned value becomes a large positive number. This caused files to be created with mode 07777 which includes the SUID bit.",
  "vulnerabilityDetails": {
    "rootCause": "The `touch_file` function in `src/basic/fs-util.c` uses `MODE_INVALID` incorrectly, leading to the creation of files with the mode 07777 (world-writable SUID).",
     "weaknesses": [
        "Incorrect use of MODE_INVALID",
        "Creation of world-writable SUID files"
      ],
    "impact": "Local privilege escalation to root.",
    "attackVectors": [
      "Local attacker can write malicious code to world-writable SUID files",
      "Execution of malicious code as root"
    ],
    "attackerCapabilities": "Local user access is required to exploit this vulnerability."
  },
  "affectedVersions": [
    "systemd v228"
  ],
  "fixDetails": {
     "fixCommit": "The fix was implemented in commit `06eeacb6fe029804f296b065b3ce91e796e1cd0e` by modifying the `touch_file` function in `src/basic/fs-util.c` to properly check for `MODE_INVALID`.",
      "fixDescription": "The fix ensures that if the provided mode is 0 or MODE_INVALID then the default mode 0644 is used instead of using the provided mode value directly. This prevents the creation of SUID files.",
      "fixCommitDetails": "```diff\n--- a/src/basic/fs-util.c\n+++ b/src/basic/fs-util.c\n@@ -341,7 +341,8 @@\n         if (parents)\n                 mkdir_parents(path, 0755);\n \n-        fd = open(path, O_WRONLY|O_CREAT|O_CLOEXEC|O_NOCTTY, mode > 0 ? mode : 0644);\n+        fd = open(path, O_WRONLY|O_CREAT|O_CLOEXEC|O_NOCTTY,\n+                        (mode == 0 || mode == MODE_INVALID) ? 0644 : mode);\n         if (fd < 0)\n                 return -errno;\n```"
  },
   "additionalNotes": [
    "The vulnerability was introduced by commit `ee735086f8670be1591fa9593e80dd60163a7a2f` which started using `MODE_INVALID` as an invalid value for mode_t.",
    "Affected files may include `/var/lib/systemd/timers/stamp-fstrim.timer` and others.",
    "The issue was initially considered as a DoS vulnerability but was later identified as a local root privilege escalation.",
        "SUSE and openSUSE provided patches to address this issue.",
        "The fix also includes logic to adjust the permissions of existing files to prevent them from being exploitable."
  ]
}
```