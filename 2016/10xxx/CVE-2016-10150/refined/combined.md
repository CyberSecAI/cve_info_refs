=== Content from access.redhat.com_d6c96b63_20250126_010254.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from git.kernel.org_1307fd9e_20250124_121407.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dan Carpenter <dan.carpenter@oracle.com> | 2016-11-30 22:21:05 +0300 |
| --- | --- | --- |
| committer | Radim Krčmář <rkrcmar@redhat.com> | 2016-12-01 16:10:50 +0100 |
| commit | [a0f1d21c1ccb1da66629627a74059dd7f5ac9c61](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61)) | |
| tree | [50974c8b8a1564bd35353043f3202510f7cec4de](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61) | |
| parent | [0f4828a1da3342be81e812b28fbcf29261146d25](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0f4828a1da3342be81e812b28fbcf29261146d25) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61&id2=0f4828a1da3342be81e812b28fbcf29261146d25)) | |
| download | [linux-a0f1d21c1ccb1da66629627a74059dd7f5ac9c61.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-a0f1d21c1ccb1da66629627a74059dd7f5ac9c61.tar.gz) | |

KVM: use after free in kvm\_ioctl\_create\_device()We should move the ops->destroy(dev) after the list\_del(&dev->vm\_node)
so that we don't use "dev" after freeing it.
Fixes: a28ebea2adc4 ("KVM: Protect device ops->create and list\_add with kvm->lock")
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Reviewed-by: David Hildenbrand <david@redhat.com>
Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61)

| -rw-r--r-- | [virt/kvm/kvm\_main.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/virt/kvm/kvm_main.c?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/virt/kvm/kvm\_main.c b/virt/kvm/kvm\_main.cindex 5c360347a1e9fc..7f9ee2929cfea3 100644--- a/[virt/kvm/kvm\_main.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/virt/kvm/kvm_main.c?id=0f4828a1da3342be81e812b28fbcf29261146d25)+++ b/[virt/kvm/kvm\_main.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/virt/kvm/kvm_main.c?id=a0f1d21c1ccb1da66629627a74059dd7f5ac9c61)@@ -2889,10 +2889,10 @@ static int kvm\_ioctl\_create\_device(struct kvm \*kvm,  ret = anon\_inode\_getfd(ops->name, &kvm\_device\_fops, dev, O\_RDWR | O\_CLOEXEC); if (ret < 0) {- ops->destroy(dev); mutex\_lock(&kvm->lock); list\_del(&dev->vm\_node); mutex\_unlock(&kvm->lock);+ ops->destroy(dev); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 12:12:44 +0000



=== Content from bugzilla.redhat.com_46592c4a_20250124_121410.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1414506)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1414506)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1414506)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1414506

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1414506**](show_bug.cgi?id=1414506)
(CVE-2016-10150)
- [CVE-2016-10150](https://access.redhat.com/security/cve/CVE-2016-10150) Kernel: Kvm: a use-after-free while creating devices

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2016-10150 Kernel: Kvm: a use-after-free while creating devices

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2016-10150 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1414507](show_bug.cgi?id=1414507 "CLOSED ERRATA - CVE-2016-10150 Kernel: Kvm: a use-after-free while creating devices [fedora-all]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1413879](show_bug.cgi?id=1413879) | | TreeView+ | [depends on](buglist.cgi?bug_id=1414506&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1414506&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2017-01-18 16:58 UTC by Prasad Pandit | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-17 02:45 UTC ([History](show_activity.cgi?id=1414506)) | | [CC List:](page.cgi?id=fields.html#cclist) | 29 users (show)  aquini arm-mgr bhu dhoward fhrbata gansalmon iboverma ichavero itamar jforbes jkacur joelsmith jonathan jross jwboyer kernel-maint kernel-mgr labbott lgoncalv madhu.chinakonda matt mchehab mcressma nmurray pholasek plougher rt-maint rvrbovsk williams | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2019-06-08 03:05:42 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1414506#c0)  Prasad Pandit    2017-01-18 16:58:50 UTC  ``` Linux kernel built with the Kernel-based Virtual Machine(CONFIG_KVM) support is vulnerable to a use-after-free flaw. It could occur while creating devices, via ioctl('/dev/kvm', ...) calls.  A user/process could use this flaw to crash the host kernel resulting in DoS or potentially escalate their privileges on a system.  Upstream patch: ---------------   -> <https://git.kernel.org/linus/a0f1d21c1ccb1da66629627a74059dd7f5ac9c61>  Reference: ----------   -> <http://www.openwall.com/lists/oss-security/2017/01/18/10>   ```  [Comment 1](show_bug.cgi?id=1414506#c1)  Prasad Pandit    2017-01-18 16:59:58 UTC  ```  Created kernel tracking bugs for this issue:  Affects: fedora-all [[bug 1414507](show_bug.cgi?id=1414507 "CLOSED ERRATA - CVE-2016-10150 Kernel: Kvm: a use-after-free while creating devices [fedora-all]")]   ```  [Comment 3](show_bug.cgi?id=1414506#c3)  Prasad Pandit    2017-01-18 17:03:32 UTC  ``` Statement:  This issue does not affect the versions of the kernel package as shipped with Red Hat Enterprise Linux 5, 6, 7 and Red Hat Enterprise MRG 2.   ```  [Comment 4](show_bug.cgi?id=1414506#c4)  Justin M. Forbes    2017-01-18 17:17:49 UTC  ``` This issue was corrected in 4.8.13 kernels available across all current fedora releases on 2016-12-12.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1414506&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from github.com_c7705236_20250124_121412.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa0f1d21c1ccb1da66629627a74059dd7f5ac9c61)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa0f1d21c1ccb1da66629627a74059dd7f5ac9c61)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/a0f1d21c1ccb1da66629627a74059dd7f5ac9c61)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

KVM: use after free in kvm\_ioctl\_create\_device()

[Browse files](/torvalds/linux/tree/a0f1d21c1ccb1da66629627a74059dd7f5ac9c61)
Browse the repository at this point in the history

```
We should move the ops->destroy(dev) after the list_del(&dev->vm_node)
so that we don't use "dev" after freeing it.

Fixes: [a28ebea](https://github.com/torvalds/linux/commit/a28ebea2adc4a2bef5989a5a181ec238f59fbcad) ("KVM: Protect device ops->create and list_add with kvm->lock")
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Reviewed-by: David Hildenbrand <david@redhat.com>
Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
```

* Loading branch information

[![@rkrcmar](https://avatars.githubusercontent.com/u/18557206?s=40&v=4)](/rkrcmar)

Dan Carpenter
authored and
[rkrcmar](/torvalds/linux/commits?author=rkrcmar "View all commits by rkrcmar")
committed
Dec 1, 2016

1 parent
[0f4828a](/torvalds/linux/commit/0f4828a1da3342be81e812b28fbcf29261146d25)

commit a0f1d21

Showing
**1 changed file**
with
**1 addition**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[virt/kvm/kvm\_main.c](#diff-e7514a224c92c2e47224f99919405a37ee7edc4612953135229cfb6e07a680d8 "virt/kvm/kvm_main.c")

Show comments

[View file](/torvalds/linux/blob/a0f1d21c1ccb1da66629627a74059dd7f5ac9c61/virt/kvm/kvm_main.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2889,10 +2889,10 @@ static int kvm\_ioctl\_create\_device(struct kvm \*kvm, |
|  |  |  |
|  |  | ret = anon\_inode\_getfd(ops->name, &kvm\_device\_fops, dev, O\_RDWR | O\_CLOEXEC); |
|  |  | if (ret < 0) { |
|  |  | ops->destroy(dev); |
|  |  | mutex\_lock(&kvm->lock); |
|  |  | list\_del(&dev->vm\_node); |
|  |  | mutex\_unlock(&kvm->lock); |
|  |  | ops->destroy(dev); |
|  |  | return ret; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a0f1d21`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa0f1d21c1ccb1da66629627a74059dd7f5ac9c61) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.kernel.org_ff813627_20250124_121408.html ===
commit 55d64c0b3c15cb5fb4d5a5bdebde9522e4ed52ff
Author: Greg Kroah-Hartman
Date: Thu Dec 8 07:16:36 2016 +0100
Linux 4.8.13
commit a4edb1a2b04597df75558d9fa6dbab7b28254895
Author: James Morse
Date: Tue Oct 18 11:27:48 2016 +0100
arm64: suspend: Reconfigure PSTATE after resume from idle
commit d08544127d9fb4505635e3cb6871fd50a42947bd upstream.
The suspend/resume path in kernel/sleep.S, as used by cpu-idle, does not
save/restore PSTATE. As a result of this cpufeatures that were detected
and have bits in PSTATE get lost when we resume from idle.
UAO gets set appropriately on the next context switch. PAN will be
re-enabled next time we return from user-space, but on a preemptible
kernel we may run work accessing user space before this point.
Add code to re-enable theses two features in \_\_cpu\_suspend\_exit().
We re-use uao\_thread\_switch() passing current.
Signed-off-by: James Morse
Cc: Lorenzo Pieralisi
Signed-off-by: Will Deacon
Signed-off-by: Greg Kroah-Hartman
commit 6353400d91305273452dbe0d26a1dfd3c975ae91
Author: James Morse
Date: Tue Oct 18 11:27:47 2016 +0100
arm64: mm: Set PSTATE.PAN from the cpu\_enable\_pan() call
commit 7209c868600bd8926e37c10b9aae83124ccc1dd8 upstream.
Commit 338d4f49d6f7 ("arm64: kernel: Add support for Privileged Access
Never") enabled PAN by enabling the 'SPAN' feature-bit in SCTLR\_EL1.
This means the PSTATE.PAN bit won't be set until the next return to the
kernel from userspace. On a preemptible kernel we may schedule work that
accesses userspace on a CPU before it has done this.
Now that cpufeature enable() calls are scheduled via stop\_machine(), we
can set PSTATE.PAN from the cpu\_enable\_pan() call.
Add WARN\_ON\_ONCE(in\_interrupt()) to check the PSTATE value we updated
is not immediately discarded.
Reported-by: Tony Thompson
Reported-by: Vladimir Murzin
Signed-off-by: James Morse
[will: fixed typo in comment]
Signed-off-by: Will Deacon
Signed-off-by: Greg Kroah-Hartman
commit b49b1ae6d341f2a0940413338d3c2351c27a7537
Author: James Morse
Date: Tue Oct 18 11:27:46 2016 +0100
arm64: cpufeature: Schedule enable() calls instead of calling them via IPI
commit 2a6dcb2b5f3e21592ca8dfa198dcce7bec09b020 upstream.
The enable() call for a cpufeature/errata is called using on\_each\_cpu().
This issues a cross-call IPI to get the work done. Implicitly, this
stashes the running PSTATE in SPSR when the CPU receives the IPI, and
restores it when we return. This means an enable() call can never modify
PSTATE.
To allow PAN to do this, change the on\_each\_cpu() call to use
stop\_machine(). This schedules the work on each CPU which allows
us to modify PSTATE.
This involves changing the protype of all the enable() functions.
enable\_cpu\_capabilities() is called during boot and enables the feature
on all online CPUs. This path now uses stop\_machine(). CPU features for
hotplug'd CPUs are enabled by verify\_local\_cpu\_features() which only
acts on the local CPU, and can already modify the running PSTATE as it
is called from secondary\_start\_kernel().
Reported-by: Tony Thompson
Reported-by: Vladimir Murzin
Signed-off-by: James Morse
Cc: Suzuki K Poulose
Signed-off-by: Will Deacon
[Removed enable() hunks for A53 workaround]
Signed-off-by: James Morse
Signed-off-by: Greg Kroah-Hartman
commit e4e77deda20081cdd9b5217dc41b6d00356bf15f
Author: Sven Eckelmann
Date: Sat Oct 29 09:18:43 2016 +0200
batman-adv: Detect missing primaryif during tp\_send as error
commit e13258f38e927b61cdb5f4ad25309450d3b127d1 upstream.
The throughput meter detects different situations as problems for the
current test. It stops the test after these and reports it to userspace.
This also has to be done when the primary interface disappeared during the
test.
Fixes: 33a3bb4a3345 ("batman-adv: throughput meter implementation")
Reported-by: Joe Perches
Signed-off-by: Sven Eckelmann
Signed-off-by: Simon Wunderlich
Signed-off-by: Greg Kroah-Hartman
commit f106de5604ddb831df2a1a8f7e4b564a74514d66
Author: Stéphan Rafin
Date: Fri Nov 4 00:53:56 2016 +0100
clk: sunxi: Fix M factor computation for APB1
commit ac95330b96376550ae7a533d1396272d675adfa2 upstream.
commit cfa636886033 ("clk: sunxi: factors: Consolidate get\_factors
parameters into a struct") introduced a regression for m factor
computation in sun4i\_get\_apb1\_factors function.
The old code reassigned the "parent\_rate" parameter to the targeted
divisor value and was buggy for the returned frequency but not for the
computed factors. Now, returned frequency is good but m factor is
incorrectly computed (its max value 31 is always set resulting in a
significantly slower frequency than the requested one...)
This patch simply restores the original proper computation for m while
keeping the good changes for returned rate.
Fixes: cfa636886033 ("clk: sunxi: factors: Consolidate get\_factors parameters into a struct")
Signed-off-by: Stéphan Rafin
Signed-off-by: Maxime Ripard
Signed-off-by: Greg Kroah-Hartman
commit 9e2d9e95094a9326b140ac8bd173f3dc07a26c12
Author: Johannes Weiner
Date: Tue Nov 22 10:57:42 2016 +0100
perf/x86: Restore TASK\_SIZE check on frame pointer
commit ae31fe51a3cceaa0cabdb3058f69669ecb47f12e upstream.
The following commit:
75925e1ad7f5 ("perf/x86: Optimize stack walk user accesses")
... switched from copy\_from\_user\_nmi() to \_\_copy\_from\_user\_nmi() with a manual
access\_ok() check.
Unfortunately, copy\_from\_user\_nmi() does an explicit check against TASK\_SIZE,
whereas the access\_ok() uses whatever the current address limit of the task is.
We are getting NMIs when \_\_probe\_kernel\_read() has switched to KERNEL\_DS, and
then see vmalloc faults when we access what looks like pointers into vmalloc
space:
[] WARNING: CPU: 3 PID: 3685731 at arch/x86/mm/fault.c:435 vmalloc\_fault+0x289/0x290
[] CPU: 3 PID: 3685731 Comm: sh Tainted: G W 4.6.0-5\_fbk1\_223\_gdbf0f40 #1
[] Call Trace:
[]  [] dump\_stack+0x4d/0x6c
[] [] \_\_warn+0xd3/0xf0
[] [] warn\_slowpath\_null+0x1d/0x20
[] [] vmalloc\_fault+0x289/0x290
[] [] \_\_do\_page\_fault+0x330/0x490
[] [] do\_page\_fault+0xc/0x10
[] [] page\_fault+0x22/0x30
[] [] ? perf\_callchain\_user+0x100/0x2a0
[] [] get\_perf\_callchain+0x17f/0x190
[] [] perf\_callchain+0x67/0x80
[] [] perf\_prepare\_sample+0x2a0/0x370
[] [] perf\_event\_output+0x20/0x60
[] [] ? perf\_event\_update\_userpage+0xc7/0x130
[] [] \_\_perf\_event\_overflow+0x181/0x1d0
[] [] perf\_event\_overflow+0x14/0x20
[] [] intel\_pmu\_handle\_irq+0x1d3/0x490
[] [] ? copy\_user\_enhanced\_fast\_string+0x7/0x10
[] [] ? vunmap\_page\_range+0x1a1/0x2f0
[] [] ? unmap\_kernel\_range\_noflush+0x11/0x20
[] [] ? ghes\_copy\_tofrom\_phys+0x116/0x1f0
[] [] ? x2apic\_send\_IPI\_self+0x1d/0x20
[] [] perf\_event\_nmi\_handler+0x2d/0x50
[] [] nmi\_handle+0x61/0x110
[] [] default\_do\_nmi+0x44/0x110
[] [] do\_nmi+0xdb/0x150
[] [] end\_repeat\_nmi+0x1a/0x1e
[] [] ? copy\_user\_enhanced\_fast\_string+0x7/0x10
[] [] ? copy\_user\_enhanced\_fast\_string+0x7/0x10
[] [] ? copy\_user\_enhanced\_fast\_string+0x7/0x10
[] <>  [] ? \_\_probe\_kernel\_read+0x3e/0xa0
Fix this by moving the valid\_user\_frame() check to before the uaccess
that loads the return address and the pointer to the next frame.
Signed-off-by: Johannes Weiner
Signed-off-by: Peter Zijlstra (Intel)
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Stephane Eranian
Cc: Thomas Gleixner
Cc: Vince Weaver
Cc: linux-kernel@vger.kernel.org
Fixes: 75925e1ad7f5 ("perf/x86: Optimize stack walk user accesses")
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit ab34b429a01f608488016ce207ab7dda1fcdcfe3
Author: Matthias Brugger
Date: Fri Nov 18 11:06:10 2016 +0100
drm/mediatek: fix null pointer dereference
commit 5ad45307d990020b25a8f7486178b6e033790f70 upstream.
The probe function requests the interrupt before initializing
the ddp component. Which leads to a null pointer dereference at boot.
Fix this by requesting the interrput after all components got
initialized properly.
Fixes: 119f5173628a ("drm/mediatek: Add DRM Driver for Mediatek SoC MT8173.")
Signed-off-by: Matthias Brugger
Signed-off-by: Greg Kroah-Hartman
Change-Id: I57193a7ab554dfb37c35a455900689333adf511c
commit 43b5bb262711e0e81ea348072a01ef1744b157ca
Author: Johan Hovold
Date: Tue Nov 1 11:46:39 2016 +0100
pwm: Fix device reference leak
commit 0e1614ac84f1719d87bed577963bb8140d0c9ce8 upstream.
Make sure to drop the reference to the parent device taken by
class\_find\_device() after "unexporting" any children when deregistering
a PWM chip.
Fixes: 0733424c9ba9 ("pwm: Unexport children before chip removal")
Signed-off-by: Johan Hovold
Signed-off-by: Thierry Reding
Signed-off-by: Greg Kroah-Hartman
commit 6c69476139799ccf8d3e76edfc892c64ced80bc4
Author: Dan Carpenter
Date: Wed Nov 30 22:21:05 2016 +0300
KVM: use after free in kvm\_ioctl\_create\_device()
commit a0f1d21c1ccb1da66629627a74059dd7f5ac9c61 upstream.
We should move the ops->destroy(dev) after the list\_del(&dev->vm\_node)
so that we don't use "dev" after freeing it.
Fixes: a28ebea2adc4 ("KVM: Protect device ops->create and list\_add with kvm->lock")
Signed-off-by: Dan Carpenter
Reviewed-by: David Hildenbrand
Signed-off-by: Radim Krčmář
Signed-off-by: Greg Kroah-Hartman
commit ff8b06b4efa608c9d4d78f32df5ec7af8fcc9f0e
Author: Sudeep Holla
Date: Wed Nov 16 17:31:31 2016 +0000
arm64: dts: juno: fix cluster sleep state entry latency on all SoC versions
commit 909e481e2467f202b97d42beef246e8829416a85 upstream.
The core and the cluster sleep state entry latencies can't be same as
cluster sleep involves more work compared to core level e.g. shared
cache maintenance.
Experiments have shown on an average about 100us more latency for the
cluster sleep state compared to the core level sleep. This patch fixes
the entry latency for the cluster sleep state.
Fixes: 28e10a8f3a03 ("arm64: dts: juno: Add idle-states to device tree")
Cc: Lorenzo Pieralisi
Cc: "Jon Medhurst (Tixy)"
Reviewed-by: Liviu Dudau
Signed-off-by: Sudeep Holla
Signed-off-by: Arnd Bergmann
Signed-off-by: Greg Kroah-Hartman
commit f67b89acdfa14ce83c8101e52f239b31910e8d83
Author: Alex Deucher
Date: Mon Nov 28 17:23:40 2016 -0500
drm/radeon: fix check for port PM availability
commit bcfdd5d5105087e6f33dfeb08a1ca6b2c0287b61 upstream.
The ATPX method does not always exist on the dGPU, it may be located at
the iGPU. The parent device of the iGPU is the root port for which
bridge\_d3 is false. This accidentally enables the legacy PM method which
conflicts with port PM and prevented the dGPU from powering on.
Ported from amdgpu commit:
drm/amdgpu: fix check for port PM availability
from Peter Wu.
Fixes: d3ac31f3b4bf9fad (drm/radeon: fix power state when port pm is unavailable (v2))
Signed-off-by: Alex Deucher
Cc: Peter Wu
Signed-off-by: Greg Kroah-Hartman
commit 835bb5cd36539d8a5f44a49d32f5e835c6c3f03b
Author: Peter Wu
Date: Sat Nov 26 15:05:01 2016 +0100
drm/amdgpu: fix check for port PM availability
commit 7ac33e47d5769632010e537964c7e45498f8dc26 upstream.
The ATPX method does not always exist on the dGPU, it may be located at
the iGPU. The parent device of the iGPU is the root port for which
bridge\_d3 is false. This accidentally enables the legacy PM method which
conflicts with port PM and prevented the dGPU from powering on.
Fixes: 1db4496f167b ("drm/amdgpu: fix power state when port pm is unavailable")
Reported-and-tested-by: Mike Lothian
Signed-off-by: Peter Wu
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 972d595824b65485db7e6a0da5767019b7a50797
Author: Peter Wu
Date: Wed Nov 23 02:22:25 2016 +0100
drm/radeon: fix power state when port pm is unavailable (v2)
commit d3ac31f3b4bf9fade93d69770cb9c34912e017be upstream.
When PCIe port PM is not enabled (system BIOS is pre-2015 or the
pcie\_port\_pm=off parameter is set), legacy ATPX PM should still be
marked as supported. Otherwise the GPU can fail to power on after
runtime suspend. This affected a Dell Inspiron 5548.
Ideally the BIOS date in the PCI core is lowered to 2013 (the first year
where hybrid graphics platforms using power resources was introduced),
but that seems more risky at this point and would not solve the
pcie\_port\_pm=off issue.
v2: agd: fix typo
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=98505
Signed-off-by: Peter Wu
Signed-off-by: Alex Deucher
Reviewed-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit be1b75edf20b721c5439c2378b0a7c779880205e
Author: Peter Wu
Date: Wed Nov 23 02:22:24 2016 +0100
drm/amdgpu: fix power state when port pm is unavailable
commit 1db4496f167bcc7c6541d449355ade2e7d339d52 upstream.
When PCIe port PM is not enabled (system BIOS is pre-2015 or the
pcie\_port\_pm=off parameter is set), legacy ATPX PM should still be
marked as supported. Otherwise the GPU can fail to power on after
runtime suspend. This affected a Dell Inspiron 5548.
Ideally the BIOS date in the PCI core is lowered to 2013 (the first year
where hybrid graphics platforms using power resources was introduced),
but that seems more risky at this point and would not solve the
pcie\_port\_pm=off issue.
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=98505
Reported-and-tested-by: Nayan Deshmukh
Signed-off-by: Peter Wu
Signed-off-by: Alex Deucher
Acked-by: Christian König
Reviewed-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit bd78c077f8fecf9f4dd86e8fde918dbd9c1bf8ce
Author: Matthew Auld
Date: Mon Nov 28 10:36:48 2016 +0000
drm/i915: drop the struct\_mutex when wedged or trying to reset
commit e411072d5740a49cdc9d0713798c30440757e451 upstream.
We grab the struct\_mutex in intel\_crtc\_page\_flip, but if we are wedged
or a reset is in progress we bail early but never seem to actually
release the lock.
Fixes: 7f1847ebf48b ("drm/i915: Simplify checking of GPU reset\_counter in display pageflips")
Cc: Chris Wilson
Signed-off-by: Matthew Auld
Link: http://patchwork.freedesktop.org/patch/msgid/20161128103648.9235-1-matthew.auld@intel.com
Reviewed-by: Joonas Lahtinen
Reviewed-by: Chris Wilson
Signed-off-by: Chris Wilson
(cherry picked from commit ddbb271aea87fc6004d3c8bcdb0710e980c7ec85)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 5dd86b6e587387b71f01690777d49ae6b240e00a
Author: Chris Wilson
Date: Mon Nov 14 11:29:30 2016 +0000
drm/i915: Don't touch NULL sg on i915\_gem\_object\_get\_pages\_gtt() error
commit 2420489bcb8910188578acc0c11c75445c2e4b92 upstream.
On the DMA mapping error path, sg may be NULL (it has already been
marked as the last scatterlist entry), and we should avoid dereferencing
it again.
Reported-by: Dan Carpenter
Fixes: e227330223a7 ("drm/i915: avoid leaking DMA mappings")
Signed-off-by: Chris Wilson
Cc: Imre Deak
Link: http://patchwork.freedesktop.org/patch/msgid/20161114112930.2033-1-chris@chris-wilson.co.uk
Reviewed-by: Matthew Auld
(cherry picked from commit b17993b7b29612369270567643bcff814f4b3d7f)
Signed-off-by: Jani Nikula
Signed-off-by: Greg Kroah-Hartman
commit 05abe7452b71c5c30f5f46a9d3f7f73a32671f3e
Author: Marc Zyngier
Date: Wed Nov 23 10:11:21 2016 +0000
KVM: arm/arm64: vgic: Don't notify EOI for non-SPIs
commit 8ca18eec2b2276b449c1dc86b98bf083c5fe4e09 upstream.
When we inject a level triggerered interrupt (and unless it
is backed by the physical distributor - timer style), we request
a maintenance interrupt. Part of the processing for that interrupt
is to feed to the rest of KVM (and to the eventfd subsystem) the
information that the interrupt has been EOIed.
But that notification only makes sense for SPIs, and not PPIs
(such as the PMU interrupt). Skip over the notification if
the interrupt is not an SPI.
Fixes: 140b086dd197 ("KVM: arm/arm64: vgic-new: Add GICv2 world switch backend")
Fixes: 59529f69f504 ("KVM: arm/arm64: vgic-new: Add GICv3 world switch backend")
Reported-by: Catalin Marinas
Tested-by: Catalin Marinas
Acked-by: Christoffer Dall
Signed-off-by: Marc Zyngier
Signed-off-by: Greg Kroah-Hartman
commit ca42bd35d3084fd832cb31152b11d2f7e17aa51a
Author: Brian Norris
Date: Tue Nov 8 18:28:24 2016 -0800
mwifiex: printk() overflow with 32-byte SSIDs
commit fcd2042e8d36cf644bd2d69c26378d17158b17df upstream.
SSIDs aren't guaranteed to be 0-terminated. Let's cap the max length
when we print them out.
This can be easily noticed by connecting to a network with a 32-octet
SSID:
[ 3903.502925] mwifiex\_pcie 0000:01:00.0: info: trying to associate to
'0123456789abcdef0123456789abcdef ' bssid
xx:xx:xx:xx:xx:xx
Fixes: 5e6e3a92b9a4 ("wireless: mwifiex: initial commit for Marvell mwifiex driver")
Signed-off-by: Brian Norris
Acked-by: Amitkumar Karwar
Signed-off-by: Kalle Valo
Signed-off-by: Greg Kroah-Hartman
commit de9ba13ebfdbb79330ea7688063b0168de2cfd1d
Author: Johannes Thumshirn
Date: Wed Nov 23 10:56:28 2016 -0600
PCI: Set Read Completion Boundary to 128 iff Root Port supports it (\_HPX)
commit e42010d8207f9d15a605ceb8e321bcd9648071b0 upstream.
Per PCIe spec r3.0, sec 2.3.1.1, the Read Completion Boundary (RCB)
determines the naturally aligned address boundaries on which a Read Request
may be serviced with multiple Completions:
- For a Root Complex, RCB is 64 bytes or 128 bytes
This value is reported in the Link Control Register
Note: Bridges and Endpoints may implement a corresponding command bit
which may be set by system software to indicate the RCB value for the
Root Complex, allowing the Bridge/Endpoint to optimize its behavior
when the Root Complex’s RCB is 128 bytes.
- For all other system elements, RCB is 128 bytes
Per sec 7.8.7, if a Root Port only supports a 64-byte RCB, the RCB of all
downstream devices must be clear, indicating an RCB of 64 bytes. If the
Root Port supports a 128-byte RCB, we may optionally set the RCB of
downstream devices so they know they can generate larger Completions.
Some BIOSes supply an \_HPX that tells us to set RCB, even though the Root
Port doesn't have RCB set, which may lead to Malformed TLP errors if the
Endpoint generates completions larger than the Root Port can handle.
The IBM x3850 X6 with BIOS version -[A8E120CUS-1.30]- 08/22/2016 supplies
such an \_HPX and a Mellanox MT27500 ConnectX-3 device fails to initialize:
mlx4\_core 0000:41:00.0: command 0xfff timed out (go bit not cleared)
mlx4\_core 0000:41:00.0: device is going to be reset
mlx4\_core 0000:41:00.0: Failed to obtain HW semaphore, aborting
mlx4\_core 0000:41:00.0: Fail to reset HCA
------------[ cut here ]------------
kernel BUG at drivers/net/ethernet/mellanox/mlx4/catas.c:193!
After 6cd33649fa83 ("PCI: Add pci\_configure\_device() during enumeration")
and 7a1562d4f2d0 ("PCI: Apply \_HPX Link Control settings to all devices
with a link"), we apply \_HPX settings to \*all\* devices, not just those
hot-added after boot.
Before 7a1562d4f2d0, we didn't touch the Mellanox RCB, and the device
worked. After 7a1562d4f2d0, we set its RCB to 128, and it failed.
Set the RCB to 128 iff the Root Port supports a 128-byte RCB. Otherwise,
set RCB to 64 bytes. This effectively ignores what \_HPX tells us about
RCB.
Note that this change only affects \_HPX handling. If we have no \_HPX, this
does nothing with RCB.
[bhelgaas: changelog, clear RCB if not set for Root Port]
Fixes: 6cd33649fa83 ("PCI: Add pci\_configure\_device() during enumeration")
Fixes: 7a1562d4f2d0 ("PCI: Apply \_HPX Link Control settings to all devices with a link")
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=187781
Tested-by: Frank Danapfel
Signed-off-by: Johannes Thumshirn
Signed-off-by: Bjorn Helgaas
Acked-by: Myron Stowe
Signed-off-by: Greg Kroah-Hartman
commit 4f4857148b4ae50b2936b0aed991fd18e8c3ba44
Author: Johannes Thumshirn
Date: Wed Nov 2 16:35:51 2016 -0600
PCI: Export pcie\_find\_root\_port
commit e784930bd645e7df78c66e7872fec282b0620075 upstream.
Export pcie\_find\_root\_port() so we can use it outside of PCIe-AER error
injection.
Signed-off-by: Johannes Thumshirn
Signed-off-by: Bjorn Helgaas
Signed-off-by: Greg Kroah-Hartman
commit 27dce9bcad4df5a26bb89c21c353b667a32a8972
Author: Michal Hocko
Date: Fri Dec 2 17:26:45 2016 -0800
mm: workingset: fix NULL ptr in count\_shadow\_nodes
commit 20ab67a563f5299c09a234164c372aba5a59add8 upstream.
Commit 0a6b76dd23fa ("mm: workingset: make shadow node shrinker memcg
aware") has made the workingset shadow nodes shrinker memcg aware. The
implementation is not correct though because memcg\_kmem\_enabled() might
become true while we are doing a global reclaim when the sc->memcg might
be NULL which is exactly what Marek has seen:
BUG: unable to handle kernel NULL pointer dereference at 0000000000000400
IP: [] mem\_cgroup\_node\_nr\_lru\_pages+0x20/0x40
PGD 0
Oops: 0000 [#1] SMP
CPU: 0 PID: 60 Comm: kswapd0 Tainted: G O 4.8.10-12.pvops.qubes.x86\_64 #1
task: ffff880011863b00 task.stack: ffff880011868000
RIP: mem\_cgroup\_node\_nr\_lru\_pages+0x20/0x40
RSP: e02b:ffff88001186bc70 EFLAGS: 00010293
RAX: 0000000000000000 RBX: ffff88001186bd20 RCX: 0000000000000002
RDX: 000000000000000c RSI: 0000000000000000 RDI: 0000000000000000
RBP: ffff88001186bc70 R08: 28f5c28f5c28f5c3 R09: 0000000000000000
R10: 0000000000006c34 R11: 0000000000000333 R12: 00000000000001f6
R13: ffffffff81c6f6a0 R14: 0000000000000000 R15: 0000000000000000
FS: 0000000000000000(0000) GS:ffff880013c00000(0000) knlGS:ffff880013d00000
CS: e033 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000000000000400 CR3: 00000000122f2000 CR4: 0000000000042660
Call Trace:
count\_shadow\_nodes+0x9a/0xa0
shrink\_slab.part.42+0x119/0x3e0
shrink\_node+0x22c/0x320
kswapd+0x32c/0x700
kthread+0xd8/0xf0
ret\_from\_fork+0x1f/0x40
Code: 66 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 44 00 00 3b 35 dd eb b1 00 55 48 89 e5 73 2c 89 d2 31 c9 31 c0 4c 63 ce 48 0f a3 ca 73 13 <4a> 8b b4 cf 00 04 00 00 41 89 c8 4a 03 84 c6 80 00 00 00 83 c1
RIP mem\_cgroup\_node\_nr\_lru\_pages+0x20/0x40
RSP
CR2: 0000000000000400
---[ end trace 100494b9edbdfc4d ]---
This patch fixes the issue by checking sc->memcg rather than
memcg\_kmem\_enabled() which is sufficient because shrink\_slab makes sure
that only memcg aware shrinkers will get non-NULL memcgs and only if
memcg\_kmem\_enabled is true.
Fixes: 0a6b76dd23fa ("mm: workingset: make shadow node shrinker memcg aware")
Link: http://lkml.kernel.org/r/20161201132156.21450-1-mhocko@kernel.org
Signed-off-by: Michal Hocko
Reported-by: Marek Marczykowski-Górecki
Tested-by: Marek Marczykowski-Górecki
Acked-by: Vladimir Davydov
Acked-by: Johannes Weiner
Acked-by: Balbir Singh
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 60e33689a06e9d39fba8a43adf4e4d912000601a
Author: Ding Tianhong
Date: Wed Jun 15 15:27:36 2016 +0800
rcu: Fix soft lockup for rcu\_nocb\_kthread
commit bedc1969150d480c462cdac320fa944b694a7162 upstream.
Carrying out the following steps results in a softlockup in the
RCU callback-offload (rcuo) kthreads:
1. Connect to ixgbevf, and set the speed to 10Gb/s.
2. Use ifconfig to bring the nic up and down repeatedly.
[ 317.005148] IPv6: ADDRCONF(NETDEV\_CHANGE): eth2: link becomes ready
[ 368.106005] BUG: soft lockup - CPU#1 stuck for 22s! [rcuos/1:15]
[ 368.106005] Hardware name: Bochs Bochs, BIOS Bochs 01/01/2011
[ 368.106005] task: ffff88057dd8a220 ti: ffff88057dd9c000 task.ti: ffff88057dd9c000
[ 368.106005] RIP: 0010:[] [] fib\_table\_lookup+0x14/0x390
[ 368.106005] RSP: 0018:ffff88061fc83ce8 EFLAGS: 00000286
[ 368.106005] RAX: 0000000000000001 RBX: 00000000020155c0 RCX: 0000000000000001
[ 368.106005] RDX: ffff88061fc83d50 RSI: ffff88061fc83d70 RDI: ffff880036d11a00
[ 368.106005] RBP: ffff88061fc83d08 R08: 0000000000000001 R09: 0000000000000000
[ 368.106005] R10: ffff880036d11a00 R11: ffffffff819e0900 R12: ffff88061fc83c58
[ 368.106005] R13: ffffffff816154dd R14: ffff88061fc83d08 R15: 00000000020155c0
[ 368.106005] FS: 0000000000000000(0000) GS:ffff88061fc80000(0000) knlGS:0000000000000000
[ 368.106005] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 368.106005] CR2: 00007f8c2aee9c40 CR3: 000000057b222000 CR4: 00000000000407e0
[ 368.106005] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[ 368.106005] DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
[ 368.106005] Stack:
[ 368.106005] 00000000010000c0 ffff88057b766000 ffff8802e380b000 ffff88057af03e00
[ 368.106005] ffff88061fc83dc0 ffffffff815349a6 ffff88061fc83d40 ffffffff814ee146
[ 368.106005] ffff8802e380af00 00000000e380af00 ffffffff819e0900 020155c0010000c0
[ 368.106005] Call Trace:
[ 368.106005]
[ 368.106005]
[ 368.106005] [] ip\_route\_input\_noref+0x516/0xbd0
[ 368.106005] [] ? skb\_release\_data+0xd6/0x110
[ 368.106005] [] ? kfree\_skb+0x3a/0xa0
[ 368.106005] [] ip\_rcv\_finish+0x29f/0x350
[ 368.106005] [] ip\_rcv+0x234/0x380
[ 368.106005] [] \_\_netif\_receive\_skb\_core+0x676/0x870
[ 368.106005] [] \_\_netif\_receive\_skb+0x18/0x60
[ 368.106005] [] process\_backlog+0xae/0x180
[ 368.106005] [] net\_rx\_action+0x152/0x240
[ 368.106005] [] \_\_do\_softirq+0xef/0x280
[ 368.106005] [] call\_softirq+0x1c/0x30
[ 368.106005]
[ 368.106005]
[ 368.106005] [] do\_softirq+0x65/0xa0
[ 368.106005] [] local\_bh\_enable+0x94/0xa0
[ 368.106005] [] rcu\_nocb\_kthread+0x232/0x370
[ 368.106005] [] ? wake\_up\_bit+0x30/0x30
[ 368.106005] [] ? rcu\_start\_gp+0x40/0x40
[ 368.106005] [] kthread+0xcf/0xe0
[ 368.106005] [] ? kthread\_create\_on\_node+0x140/0x140
[ 368.106005] [] ret\_from\_fork+0x58/0x90
[ 368.106005] [] ? kthread\_create\_on\_node+0x140/0x140
==================================cut here==============================
It turns out that the rcuos callback-offload kthread is busy processing
a very large quantity of RCU callbacks, and it is not reliquishing the
CPU while doing so. This commit therefore adds an cond\_resched\_rcu\_qs()
within the loop to allow other tasks to run.
Signed-off-by: Ding Tianhong
[ paulmck: Substituted cond\_resched\_rcu\_qs for cond\_resched. ]
Signed-off-by: Paul E. McKenney
Cc: Dhaval Giani
Signed-off-by: Greg Kroah-Hartman
commit b6f9e236b7efef399bac7819f979e4ecc51f5115
Author: Dmitry Torokhov
Date: Sat Nov 12 10:45:48 2016 -0800
Input: psmouse - disable automatic probing of BYD touchpads
commit e9fb7cc63801d3dc71b60ca11c4d08f68f879a53 upstream.
BYD automatic protocol detection is extremely unreliable and is often
triggers false positives on regular mice, Sentelic touchpads, and other
devices. BYD has several documents that have recommended detection
sequence, but they conflict with each other and, as far as I can see, still
would not produce unique enough output to reliably differentiate BYD from
other PS/2 devices.
OEMs sourcing BYD devices also do not do us any favors by not supplying any
reasonable DMI data and instead leaving turds like "To Be Filled By O.E.M."
in place of vendor data, or "System Serial Number" as serial number.
On top of that BYD is not truly modern multitouch controller, but rather a
single-touch transitional device that only reports absolute coordinates at
the beginning of finger contact and then reverts to reporting
displacements, and thus not very precise; the only benefit from using BYD
mode vs the legacy PS/2 mode is possibility of edge scrolling.
Given the above, and the fact that BYD devices are somewhat uncommon, let's
disable automatic detection of BYD devices. Users who know they have BYD
trackpads or want to experiment can attempt to activate BYD protocol via
sysfs:
echo -n "byd" > /sys/bus/serio/devices/serio1/drvctl
Fixes: https://bugzilla.kernel.org/show\_bug.cgi?id=151691
Fixes: https://bugzilla.kernel.org/show\_bug.cgi?id=175421
Fixes: https://bugzilla.kernel.org/show\_bug.cgi?id=120781
Fixes: https://bugzilla.kernel.org/show\_bug.cgi?id=121281
Fixes: 98ee37714493 ("Input: byd - add BYD PS/2 touchpad driver")
Reviewed-by: Pali Rohár
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 6ca8ab7052c4d16a3ea9b8eb9cea0b41b6ffb562
Author: Ping Cheng
Date: Mon Nov 28 13:20:51 2016 -0800
Input: change KEY\_DATA from 0x275 to 0x277
commit 2425f1808123bf69a8f66d4ec90e0d0e302c2613 upstream.
0x275 is used by KEY\_FASTREVERSE.
Fixes: 488326947cd1 ("Input: add HDMI CEC specific keycodes")
Signed-off-by: Ping Cheng
Acked-by: Hans Verkuil
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 600bec25b855cfa9ae72d17806899bed7e4d5057
Author: Miklos Szeredi
Date: Tue Nov 29 10:20:24 2016 +0100
ovl: fix d\_real() for stacked fs
commit c4fcfc1619ea43a8a89ad2f83ff23905eee088bd upstream.
Handling of recursion in d\_real() is completely broken. Recursion is only
done in the 'inode != NULL' case. But when opening the file we have
'inode == NULL' hence d\_real() will return an overlay dentry. This won't
work since overlayfs doesn't define its own file operations, so all file
ops will fail.
Fix by doing the recursion first and the check against the inode second.
Bash script to reproduce the issue written by Quentin:
- 8< - - - - - 8< - - - - - 8< - - - - - 8< - - - -
tmpdir=$(mktemp -d)
pushd ${tmpdir}
mkdir -p {upper,lower,work}
echo -n 'rocks' > lower/ksplice
mount -t overlay level\_zero upper -o lowerdir=lower,upperdir=upper,workdir=work
cat upper/ksplice
tmpdir2=$(mktemp -d)
pushd ${tmpdir2}
mkdir -p {upper,work}
mount -t overlay level\_one upper -o lowerdir=${tmpdir}/upper,upperdir=upper,workdir=work
ls -l upper/ksplice
cat upper/ksplice
- 8< - - - - - 8< - - - - - 8< - - - - - 8< - - - -
Reported-by: Quentin Casasnovas
Signed-off-by: Miklos Szeredi
Fixes: 2d902671ce1c ("vfs: merge .d\_select\_inode() into .d\_real()")
Signed-off-by: Greg Kroah-Hartman
commit 5661a69268715cde3489a668251926b314a59173
Author: Kirill A. Shutemov
Date: Wed Nov 30 15:54:19 2016 -0800
mm: fix false-positive WARN\_ON() in truncate/invalidate for hugetlb
commit 5cbc198ae08d84bd416b672ad8bd1222acd0855c upstream.
Hugetlb pages have ->index in size of the huge pages (PMD\_SIZE or
PUD\_SIZE), not in PAGE\_SIZE as other types of pages. This means we
cannot user page\_to\_pgoff() to check whether we've got the right page
for the radix-tree index.
Let's introduce page\_to\_index() which would return radix-tree index for
given page.
We will be able to get rid of this once hugetlb will be switched to
multi-order entries.
Fixes: fc127da085c2 ("truncate: handle file thp")
Link: http://lkml.kernel.org/r/20161123093053.mjbnvn5zwxw5e6lk@black.fi.intel.com
Signed-off-by: Kirill A. Shutemov
Reported-by: Doug Nelson
Tested-by: Doug Nelson
Reviewed-by: Naoya Horiguchi
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 48b6b50a2ba5fa74399e9fb0abf3c26982a0048e
Author: Dmitry Vyukov
Date: Wed Nov 30 15:54:13 2016 -0800
kasan: update kasan\_global for gcc 7
commit 045d599a286bc01daa3510d59272440a17b23c2e upstream.
kasan\_global struct is part of compiler/runtime ABI. gcc revision
241983 has added a new field to kasan\_global struct. Update kernel
definition of kasan\_global struct to include the new field.
Without this patch KASAN is broken with gcc 7.
Link: http://lkml.kernel.org/r/1479219743-28682-1-git-send-email-dvyukov@google.com
Signed-off-by: Dmitry Vyukov
Acked-by: Andrey Ryabinin
Cc: Alexander Potapenko
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit db04d354b7f1ea4f47142174195cada01e9f40b7
Author: Takashi Iwai
Date: Wed Nov 30 15:54:08 2016 -0800
zram: fix unbalanced idr management at hot removal
commit 529e71e16403830ae0d737a66c55c5f360f3576b upstream.
The zram hot removal code calls idr\_remove() even when zram\_remove()
returns an error (typically -EBUSY). This results in a leftover at the
device release, eventually leading to a crash when the module is
reloaded.
As described in the bug report below, the following procedure would
cause an Oops with zram:
- provision three zram devices via modprobe zram num\_devices=3
- configure a size for each device
+ echo "1G" > /sys/block/$zram\_name/disksize
- mkfs and mount zram0 only
- attempt to hot remove all three devices
+ echo 2 > /sys/class/zram-control/hot\_remove
+ echo 1 > /sys/class/zram-control/hot\_remove
+ echo 0 > /sys/class/zram-control/hot\_remove
- zram0 removal fails with EBUSY, as expected
- unmount zram0
- try zram0 hot remove again
+ echo 0 > /sys/class/zram-control/hot\_remove
- fails with ENODEV (unexpected)
- unload zram kernel module
+ completes successfully
- zram0 device node still exists
- attempt to mount /dev/zram0
+ mount command is killed
+ following BUG is encountered
BUG: unable to handle kernel paging request at ffffffffa0002ba0
IP: get\_disk+0x16/0x50
Oops: 0000 [#1] SMP
CPU: 0 PID: 252 Comm: mount Not tainted 4.9.0-rc6 #176
Call Trace:
exact\_lock+0xc/0x20
kobj\_lookup+0xdc/0x160
get\_gendisk+0x2f/0x110
\_\_blkdev\_get+0x10c/0x3c0
blkdev\_get+0x19d/0x2e0
blkdev\_open+0x56/0x70
do\_dentry\_open.isra.19+0x1ff/0x310
vfs\_open+0x43/0x60
path\_openat+0x2c9/0xf30
do\_filp\_open+0x79/0xd0
do\_sys\_open+0x114/0x1e0
SyS\_open+0x19/0x20
entry\_SYSCALL\_64\_fastpath+0x13/0x94
This patch adds the proper error check in hot\_remove\_store() not to call
idr\_remove() unconditionally.
Fixes: 17ec4cd98578 ("zram: don't call idr\_remove() from zram\_remove()")
Bugzilla: https://bugzilla.opensuse.org/show\_bug.cgi?id=1010970
Link: http://lkml.kernel.org/r/20161121132140.12683-1-tiwai@suse.de
Signed-off-by: Takashi Iwai
Reviewed-by: David Disseldorp
Reported-by: David Disseldorp
Tested-by: David Disseldorp
Acked-by: Minchan Kim
Acked-by: Sergey Senozhatsky
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 010020900006394ffc7b3a3ccde3ec029e1ca61c
Author: Kirill A. Shutemov
Date: Wed Nov 30 15:54:05 2016 -0800
thp: fix corner case of munlock() of PTE-mapped THPs
commit 655548bf6271b212cd1e4c259da9dbe616348d38 upstream.
The following program triggers BUG() in munlock\_vma\_pages\_range():
// autogenerated by syzkaller (http://github.com/google/syzkaller)
#include
int main()
{
mmap((void\*)0x20105000ul, 0xc00000ul, 0x2ul, 0x2172ul, -1, 0);
mremap((void\*)0x201fd000ul, 0x4000ul, 0xc00000ul, 0x3ul, 0x203f0000ul);
return 0;
}
The test-case constructs the situation when munlock\_vma\_pages\_range()
finds PTE-mapped THP-head in the middle of page table and, by mistake,
skips HPAGE\_PMD\_NR pages after that.
As result, on the next iteration it hits the middle of PMD-mapped THP
and gets upset seeing mlocked tail page.
The solution is only skip HPAGE\_PMD\_NR pages if the THP was mlocked
during munlock\_vma\_page(). It would guarantee that the page is
PMD-mapped as we never mlock PTE-mapeed THPs.
Fixes: e90309c9f772 ("thp: allow mlocked THP again")
Link: http://lkml.kernel.org/r/20161115132703.7s7rrgmwttegcdh4@black.fi.intel.com
Signed-off-by: Kirill A. Shutemov
Reported-by: Dmitry Vyukov
Cc: Konstantin Khlebnikov
Cc: Andrey Ryabinin
Cc: syzkaller
Cc: Andrea Arcangeli
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 08fd95de5eee8c32b963fa0551cfc03dca429681
Author: Jérémy Lefaure
Date: Wed Nov 30 15:54:02 2016 -0800
mm, thp: propagation of conditional compilation in khugepaged.c
commit e1465d125d2189e667029b9fa8a6f455180fbcf2 upstream.
Commit b46e756f5e47 ("thp: extract khugepaged from mm/huge\_memory.c")
moved code from huge\_memory.c to khugepaged.c. Some of this code should
be compiled only when CONFIG\_SYSFS is enabled but the condition around
this code was not moved into khugepaged.c.
The result is a compilation error when CONFIG\_SYSFS is disabled:
mm/built-in.o: In function `khugepaged\_defrag\_store': khugepaged.c:(.text+0x2d095): undefined reference to `single\_hugepage\_flag\_store'
mm/built-in.o: In function `khugepaged\_defrag\_show': khugepaged.c:(.text+0x2d0ab): undefined reference to `single\_hugepage\_flag\_show'
This commit adds the #ifdef CONFIG\_SYSFS around the code related to
sysfs.
Link: http://lkml.kernel.org/r/20161114203448.24197-1-jeremy.lefaure@lse.epita.fr
Signed-off-by: Jérémy Lefaure
Acked-by: Kirill A. Shutemov
Acked-by: Hillf Danton
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 76e59ecacd5409c8bc500d5ee417d0d57c66e750
Author: Vineet Gupta
Date: Wed Nov 23 17:43:17 2016 -0800
ARC: Don't use "+l" inline asm constraint
commit 3c7c7a2fc8811bc7097479f69acf2527693d7562 upstream.
Apparenty this is coming in the way of gcc fix which inhibits the usage
of LP\_COUNT as a gpr.
Signed-off-by: Vineet Gupta
Signed-off-by: Greg Kroah-Hartman
commit b43fb9f6f162ac4bff8cfe836b19a28439291bae
Author: Yuriy Kolerov
Date: Mon Nov 28 07:07:17 2016 +0300
ARC: mm: PAE40: Fix crash at munmap
commit 6a8b2ca702b279bea0e8f0363056439352e2081c upstream.
commit 1c3c90930392 broke PAE40. Macro pfn\_pte(pfn, prot) creates paddr
from pfn, but the page shift was getting truncated to 32 bits since we lost
the proper cast to 64 bits (for PAE400
Instead of reverting that commit, use a better helper which is 32/64 bits
safe just like ARM implementation.
Fixes: 1c3c90930392 ("ARC: mm: fix build breakage with STRICT\_MM\_TYPECHECKS")
Signed-off-by: Yuriy Kolerov
[vgupta: massaged changelog]
Signed-off-by: Vineet Gupta
Signed-off-by: Greg Kroah-Hartman
commit 8d1ee7b245ef50b497f1f1f57b74cae3285accf2
Author: Johannes Thumshirn
Date: Thu Nov 17 12:50:23 2016 +0100
scsi: libfc: fix seconds\_since\_last\_reset miscalculation
commit 208da78e8ec8b6d6ce3747ab0e5c120458e08ae6 upstream.
Commit 540eb1eef0ab ("scsi: libfc: fix seconds\_since\_last\_reset calculation")
removed the use of 'struct timespec' from fc\_get\_host\_stats(). This broke the
output of 'fcoeadm -s' after kernel 4.8-rc1.
Signed-off-by: Johannes Thumshirn
Fixes: 540eb1eef0ab ("scsi: libfc: fix seconds\_since\_last\_reset calculation")
Acked-by: Arnd Bergmann
Reviewed-by: Bart Van Assche
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 10e2627377b01b5dbfae039573cea2e4fa508483
Author: Hannes Reinecke
Date: Thu Nov 17 12:15:56 2016 +0100
scsi: hpsa: use bus '3' for legacy HBA devices
commit 7630b3a599e2c6d1c042945d32ff2debc855ad29 upstream.
Older controllers use SCSI target id '0' for the first internal disk. As
the controllers are now placed on the same bus as the internal disks
this leads to a clash with the SCSI target id of controller. This patch
checks the SCSI revision, and moves older controller to bus '3' to be
compatible with older releases and avoid this problem.
[mkp: fixed uninitialized variable]
Fixes: 09371d623c9 ("hpsa: Change SAS transport devices to bus 0.")
Signed-off-by: Hannes Reinecke
Acked-by: Don Brace
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit e170c1003c025ae3289a079507f481cf6eaf1e44
Author: Hannes Reinecke
Date: Mon Oct 31 21:06:58 2016 +0100
libata-scsi: Fixup ata\_gen\_passthru\_sense()
commit e0029dcb5b6e1c23e68f578ce7a3d6c5caba0501 upstream.
There's a typo in ata\_gen\_passthru\_sense(), where the first byte
would be overwritten incorrectly later on.
Reported-by: Charles Machalow
Signed-off-by: Hannes Reinecke
Fixes: 11093cb1ef56 ("libata-scsi: generate correct ATA pass-through sense")
Signed-off-by: Tejun Heo
Signed-off-by: Greg Kroah-Hartman


=== Content from www.openwall.com_b48da469_20250124_121409.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](9) [[next>]](11) [[thread-next>]](../../../2017/01/19/6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <alpine.LFD.2.20.1701182308090.22270@wniryva>
Date: Wed, 18 Jan 2017 23:10:19 +0530 (IST)
From: P J P <ppandit@...hat.com>
To: oss security list <oss-security@...ts.openwall.com>
cc: NCSC Security <security@...c.gov.uk>
Subject: CVE request Kernel: kvm: use-after-free issue while creating
 devices

   Hello,

Linux kernel built with the Kernel-based Virtual Machine(CONFIG_KVM) support
is vulnerable to a use-after-free flaw. It could occur while creating devices,
via ioctl('/dev/kvm', ...) calls.

A user/process could use this flaw to crash the host kernel resulting in DoS
or potentially escalate their privileges on a system.

Upstream patch:
---------------
   -> <https://git.kernel.org/linus/a0f1d21c1ccb1da66629627a74059dd7f5ac9c61>

Reference:
----------
   -> <https://bugzilla.redhat.com/show_bug.cgi?id=1414506>

Thank you.
--
Prasad J Pandit / Red Hat Product Security Team
47AF CE69 3A90 54AA 9045 1053 DD13 3D32 FE5B 041F

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


