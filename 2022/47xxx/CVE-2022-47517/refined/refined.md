```
{
  "vulnerability": {
    "root_cause": "An off-by-one error in the `url_canonize2` function within the libsofia-sip library leads to a heap-based buffer over-read.",
    "weaknesses": [
      "Heap-based buffer over-read",
       "Off-by-one error"
    ],
    "impact": "A remote attacker can cause a denial-of-service (daemon crash) by sending a specially crafted UDP message.",
    "attack_vector": "The vulnerability is triggered through processing a crafted SIP message, specifically when parsing a URL within the `Contact` header. This is done through the network via UDP packets.",
    "attacker_capabilities": "The attacker needs to be able to send UDP packets to the vulnerable service."
  },
  "commits": [
    {
      "commit_id": "22c1bd191f0acbf11f0c0fbea1845d9bf9dcd47e",
      "description": "Initial fix for the off-by-one error in `url_canonize2`.",
        "changes": "The commit modified the `url_canonize2` function to check if `h1` is a null pointer and to prevent out-of-bounds access. The `strlen(s) - 1` check was removed."
    },
    {
        "commit_id": "bfc79d85c8f3a4798a3305fb98f5a11c11d0d29f",
        "description": "A better fix for the previous commit addressing the off-by-one error.",
        "changes":"The commit further refines the fix for the off-by-one error in `url_canonize2`, adding checks for null and handling the `h1` and `h2` variables. Also, the `strlen(s) -1` check was readded."
    },
      {
      "commit_id": "51841eb53679434a386fb2dcbca925dcc48d58ba",
      "description": "Fix Out-of-bound read in url_canonize2 and url_canonize3",
          "changes": "This commit addresses the out-of-bounds read in both `url_canonize2` and `url_canonize3` functions by adding a check for null before accessing `s[i+1]`."
    },
      {
          "commit_id": "77e79d2d917fc2bac1f416b4da48284a3eaaf5be",
          "description": "fix url_canonize3() heap overflow as mentioned in drachtio/drachtio-server#243",
          "changes": "This commit addresses the heap overflow in url_canonize3() by adding a check for null before accessing `s[i+1]`."
    }

  ],
  "cve_references": [
    "https://nvd.nist.gov/vuln/detail/CVE-2022-47517",
      "https://github.com/drachtio/drachtio-server/issues/243",
      "https://github.com/davehorton/sofia-sip/commit/22c1bd191f0acbf11f0c0fbea1845d9bf9dcd47e",
      "https://github.com/davehorton/sofia-sip/commit/bfc79d85c8f3a4798a3305fb98f5a11c11d0d29f",
       "https://github.com/freeswitch/sofia-sip/commit/51841eb53679434a386fb2dcbca925dcc48d58ba",
      "https://github.com/davehorton/sofia-sip/commit/77e79d2d917fc2bac1f416b4da48284a3eaaf5be"
  ],
    "affected_versions": "before 0.8.19",
    "patched_versions": "0.8.19-rc14 and later"
}
```