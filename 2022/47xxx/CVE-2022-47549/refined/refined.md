```json
{
  "related": true,
  "summary": "This document describes a vulnerability in OP-TEE where a successful electromagnetic fault injection attack can bypass signature verification, allowing a malicious TA to be loaded. This occurs because the TEE_SUCCESS value is 0x0, which can be achieved by clearing a register using EM pulses. The document also discusses other related attacks, including UUID confusion and using SIGSEGV to leak encryption keys.",
  "details": [
    {
      "vulnerability": "Bypass signature verification",
      "description": "An electromagnetic fault injection attack can be used to clear registers, causing a bypass of the signature verification step when loading a Trusted Application (TA). This is possible because the TEE_SUCCESS return value is 0x0, allowing an attacker to set a register to this value and bypass the check.  The attack involves injecting EM pulses at specific assembly instructions that update register values, which determines whether to error out or not, clearing these values to 0x0.",
      "root_cause": "The root cause is that the TEE_SUCCESS value is 0x0, which is easily achievable by zeroing out a register value using EM pulses. The lack of hardware protections (like metallic shields) also contributes.",
      "impact": "Loading of self-signed TAs, allowing malicious code to run in the secure environment.",
       "attack_vectors": [
        "Electromagnetic fault injection"
      ],
      "attacker_capabilities": "Physical access to the device with EM injection equipment capable of precise and timed pulses."
    },
    {
      "vulnerability": "UUID Confusion",
      "description": "OP-TEE allows two different TAs to share the same UUID. When a client application (CA) initiates a session with a specific UUID, OP-TEE prioritizes non-persistent TAs. This allows a malicious TA with the same UUID as the Gatekeeper TA to intercept and hijack communications intended for the legitimate Gatekeeper TA. This can break source authentication and access control.",
      "root_cause": "The root cause is the lack of a uniqueness check for UUIDs and the preference of non-persistent TAs during session initiation within OP-TEE.",
       "impact": "Man-in-the-middle attack, bypassing source authentication and access control.",
      "attack_vectors": [
        "UUID spoofing"
      ],
       "attacker_capabilities": "Ability to load a malicious TA onto the system."
    },
     {
      "vulnerability": "SIGSEGV based key leakage",
       "description": "An attacker can force a SIGSEGV signal during the encryption/signing process on the client side, causing a coredump that contains the encryption and signing keys. This is possible even with protections like SeCReT because the keys are present in memory for a short time during encryption/signing and the coredump captures this memory state.",
      "root_cause": "The root cause is the combination of coredumps being enabled and the vulnerability window where the encryption keys are available in client application memory, combined with the ability to induce SIGSEGV signals through faults.",
       "impact": "Leakage of encryption and signing keys, enabling decryption and spoofing of communications.",
      "attack_vectors": [
        "SIGSEGV signal induction through EM pulses or kill command",
        "Analysis of coredump files"
      ],
       "attacker_capabilities": "Ability to inject faults to create SIGSEGV signals, and/or ability to send kill commands to the targeted process (remote/physical access)."
    }
  ],
  "affected_versions": "OP-TEE <= 3.19.0",
   "patched_versions": "OP-TEE 3.20",
  "cwe": "No CWEs listed in the document",
  "countermeasures": [
    "Use SoCs with hardware security features such as voltage drop sensing, clock change detection, or physical shielding.",
    "Change the TEE_SUCCESS return value to a non-zero value to prevent simple register clearing attacks.",
    "Enforce UUID uniqueness on the TEE OS side.",
    "Disable coredumps in the normal world kernel."
  ]
}
```