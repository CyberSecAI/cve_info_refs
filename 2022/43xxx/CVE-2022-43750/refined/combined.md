=== Content from git.kernel.org_7b6a28c3_20250114_210744.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=a659daf63d16aa883be42f3f34ff84235c302198)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a659daf63d16aa883be42f3f34ff84235c302198)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a659daf63d16aa883be42f3f34ff84235c302198)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a659daf63d16aa883be42f3f34ff84235c302198)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tadeusz Struk <tadeusz.struk@linaro.org> | 2022-09-19 14:59:57 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-09-22 15:52:29 +0200 |
| commit | [a659daf63d16aa883be42f3f34ff84235c302198](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a659daf63d16aa883be42f3f34ff84235c302198) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=a659daf63d16aa883be42f3f34ff84235c302198)) | |
| tree | [1b717123a9999105c3de77229e0fdb247a935ecd](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a659daf63d16aa883be42f3f34ff84235c302198) | |
| parent | [5032b269203287c17064d33c72be1ebf30c04a95](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=5032b269203287c17064d33c72be1ebf30c04a95) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a659daf63d16aa883be42f3f34ff84235c302198&id2=5032b269203287c17064d33c72be1ebf30c04a95)) | |
| download | [linux-a659daf63d16aa883be42f3f34ff84235c302198.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-a659daf63d16aa883be42f3f34ff84235c302198.tar.gz) | |

usb: mon: make mmapped memory read onlySyzbot found an issue in usbmon module, where the user space client can
corrupt the monitor's internal memory, causing the usbmon module to
crash the kernel with segfault, UAF, etc.
The reproducer mmaps the /dev/usbmon memory to user space, and
overwrites it with arbitrary data, which causes all kinds of issues.
Return an -EPERM error from mon\_bin\_mmap() if the flag VM\_WRTIE is set.
Also clear VM\_MAYWRITE to make it impossible to change it to writable
later.
Cc: "Dmitry Vyukov" <dvyukov@google.com>
Cc: stable <stable@kernel.org>
Fixes: 6f23ee1fefdc ("USB: add binary API to usbmon")
Suggested-by: PaX Team <pageexec@freemail.hu> # for the VM\_MAYRITE portion
Link: <https://syzkaller.appspot.com/bug?id=2eb1f35d6525fa4a74d75b4244971e5b1411c95a>
Reported-by: syzbot+23f57c5ae902429285d7@syzkaller.appspotmail.com
Signed-off-by: Tadeusz Struk <tadeusz.struk@linaro.org>
Link: [https://lore.kernel.org/r/20220919215957.205681-1-tadeusz.struk@linaro.org](https://lore.kernel.org/r/20220919215957.205681-1-tadeusz.struk%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a659daf63d16aa883be42f3f34ff84235c302198)

| -rw-r--r-- | [drivers/usb/mon/mon\_bin.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/usb/mon/mon_bin.c?id=a659daf63d16aa883be42f3f34ff84235c302198) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/drivers/usb/mon/mon\_bin.c b/drivers/usb/mon/mon\_bin.cindex f48a23adbc35dd..094e812e9e6922 100644--- a/[drivers/usb/mon/mon\_bin.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/usb/mon/mon_bin.c?id=5032b269203287c17064d33c72be1ebf30c04a95)+++ b/[drivers/usb/mon/mon\_bin.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/usb/mon/mon_bin.c?id=a659daf63d16aa883be42f3f34ff84235c302198)@@ -1268,6 +1268,11 @@ static int mon\_bin\_mmap(struct file \*filp, struct vm\_area\_struct \*vma) { /\* don't do anything here: "fault" will set up page table entries \*/ vma->vm\_ops = &mon\_bin\_vm\_ops;++ if (vma->vm\_flags & VM\_WRITE)+ return -EPERM;++ vma->vm\_flags &= ~VM\_MAYWRITE; vma->vm\_flags |= VM\_DONTEXPAND | VM\_DONTDUMP; vma->vm\_private\_data = filp->private\_data; mon\_bin\_vma\_open(vma); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:06:20 +0000



=== Content from cdn.kernel.org_794397e1_20250114_210742.html ===
commit fbd56ddcecab5a3623a89c8e941fdbcc55b41045
Author: Greg Kroah-Hartman
Date: Wed Oct 12 09:39:05 2022 +0200
Linux 6.0.1
Link: https://lore.kernel.org/r/20221010070330.159911806@linuxfoundation.org
Tested-by: Luna Jernberg
Tested-by: Fenil Jain
Tested-by: Linux Kernel Functional Testing
Tested-by: Justin M. Forbes
Tested-by: Florian Fainelli
Tested-by: Ronald Warsow
Tested-by: Shuah Khan
Tested-by: Zan Aziz
Tested-by: Slade Watkins
Tested-by: Guenter Roeck
Tested-by: Rudi Heitbaum
Tested-by: Bagas Sanjaya
Tested-by: Jon Hunter
Tested-by: Sudip Mukherjee
Tested-by: Ron Economos
Signed-off-by: Greg Kroah-Hartman
commit 3c6b036fe5c8ed8b6c4cbdc03605929882907ef0
Author: Tetsuo Handa
Date: Fri Sep 2 20:23:48 2022 +0900
Bluetooth: use hdev->workqueue when queuing hdev->{cmd,ncmd}\_timer works
commit deee93d13d385103205879a8a0915036ecd83261 upstream.
syzbot is reporting attempt to schedule hdev->cmd\_work work from system\_wq
WQ into hdev->workqueue WQ which is under draining operation [1], for
commit c8efcc2589464ac7 ("workqueue: allow chained queueing during
destruction") does not allow such operation.
The check introduced by commit 877afadad2dce8aa ("Bluetooth: When HCI work
queue is drained, only queue chained work") was incomplete.
Use hdev->workqueue WQ when queuing hdev->{cmd,ncmd}\_timer works because
hci\_{cmd,ncmd}\_timeout() calls queue\_work(hdev->workqueue). Also, protect
the queuing operation with RCU read lock in order to avoid calling
queue\_delayed\_work() after cancel\_delayed\_work() completed.
Link: https://syzkaller.appspot.com/bug?extid=243b7d89777f90f7613b [1]
Reported-by: syzbot
Signed-off-by: Tetsuo Handa
Fixes: 877afadad2dce8aa ("Bluetooth: When HCI work queue is drained, only queue chained work")
Signed-off-by: Luiz Augusto von Dentz
Signed-off-by: Greg Kroah-Hartman
commit 390ba6a7755d6db79e8000d5501096c24f3b8bfd
Author: Jules Irenge
Date: Wed Sep 7 16:24:20 2022 +0100
bpf: Fix resetting logic for unreferenced kptrs
commit 9fad7fe5b29803584c7f17a2abe6c2936fec6828 upstream.
Sparse reported a warning at bpf\_map\_free\_kptrs()
"warning: Using plain integer as NULL pointer"
During the process of fixing this warning, it was discovered that the current
code erroneously writes to the pointer variable instead of deferencing and
writing to the actual kptr. Hence, Sparse tool accidentally helped to uncover
this problem. Fix this by doing WRITE\_ONCE(\*p, 0) instead of WRITE\_ONCE(p, 0).
Note that the effect of this bug is that unreferenced kptrs will not be cleared
during check\_and\_free\_fields. It is not a problem if the clearing is not done
during map\_free stage, as there is nothing to free for them.
Fixes: 14a324f6a67e ("bpf: Wire up freeing of referenced kptr")
Signed-off-by: Jules Irenge
Link: https://lore.kernel.org/r/Yxi3pJaK6UDjVJSy@playground
Signed-off-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit 448faed285b9a0dc4101ffb6a256aa261fcd0979
Author: Daniel Golle
Date: Fri Sep 30 01:56:53 2022 +0100
net: ethernet: mtk\_eth\_soc: fix state in \_\_mtk\_foe\_entry\_clear
commit ae3ed15da5889263de372ff9df2e83e16acca4cb upstream.
Setting ib1 state to MTK\_FOE\_STATE\_UNBIND in \_\_mtk\_foe\_entry\_clear
routine as done by commit 0e80707d94e4c8 ("net: ethernet: mtk\_eth\_soc:
fix typo in \_\_mtk\_foe\_entry\_clear") breaks flow offloading, at least
on older MTK\_NETSYS\_V1 SoCs, OpenWrt users have confirmed the bug on
MT7622 and MT7621 systems.
Felix Fietkau suggested to use MTK\_FOE\_STATE\_INVALID instead which
works well on both, MTK\_NETSYS\_V1 and MTK\_NETSYS\_V2.
Tested on MT7622 (Linksys E8450) and MT7986 (BananaPi BPI-R3).
Suggested-by: Felix Fietkau
Fixes: 0e80707d94e4c8 ("net: ethernet: mtk\_eth\_soc: fix typo in \_\_mtk\_foe\_entry\_clear")
Fixes: 33fc42de33278b ("net: ethernet: mtk\_eth\_soc: support creating mac address based offload entries")
Signed-off-by: Daniel Golle
Link: https://lore.kernel.org/r/YzY+1Yg0FBXcnrtc@makrotopia.org
Signed-off-by: Jakub Kicinski
Signed-off-by: Greg Kroah-Hartman
commit 50fe01fa7640bc216bb1a47754a1f799c20eff8e
Author: Kumar Kartikeya Dwivedi
Date: Wed Sep 21 16:35:50 2022 +0200
bpf: Gate dynptr API behind CAP\_BPF
commit 8addbfc7b308d591f8a5f2f6bb24d08d9d79dfbb upstream.
This has been enabled for unprivileged programs for only one kernel
release, hence the expected annoyances due to this move are low. Users
using ringbuf can stick to non-dynptr APIs. The actual use cases dynptr
is meant to serve may not make sense in unprivileged BPF programs.
Hence, gate these helpers behind CAP\_BPF and limit use to privileged
BPF programs.
Fixes: 263ae152e962 ("bpf: Add bpf\_dynptr\_from\_mem for local dynptrs")
Fixes: bc34dee65a65 ("bpf: Dynptr support for ring buffers")
Fixes: 13bbbfbea759 ("bpf: Add bpf\_dynptr\_read and bpf\_dynptr\_write")
Fixes: 34d4ef5775f7 ("bpf: Add dynptr data slices")
Signed-off-by: Kumar Kartikeya Dwivedi
Link: https://lore.kernel.org/r/20220921143550.30247-1-memxor@gmail.com
Acked-by: Andrii Nakryiko
Signed-off-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit 64517c21fd0f28b40a75d0d3121276b31399278e
Author: Palmer Dabbelt
Date: Tue Sep 20 13:45:18 2022 -0700
RISC-V: Print SSTC in canonical order
commit 61a41d16ad20657f93613229a8b17766c51dc849 upstream.
This got out of order during a merge conflict, fix it by putting the
entries in the correct order.
Fixes: 7ab52f75a9cf ("RISC-V: Add Sstc extension support")
Signed-off-by: Palmer Dabbelt
Reviewed-by: Conor Dooley
Reviewed-by: Heiko Stuebner
Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/20220920204518.10988-1-palmer@rivosinc.com/
Signed-off-by: Palmer Dabbelt
Signed-off-by: Greg Kroah-Hartman
commit d3b5e30e87b52404765b25d9ee156a85c3d8caf6
Author: Mario Limonciello
Date: Tue Aug 2 23:25:00 2022 -0500
gpiolib: acpi: Add a quirk for Asus UM325UAZ
commit 0ea76c401f9245ac209f1b1ce03a7e1fb9de36e5 upstream.
Asus UM325UAZ has GPIO 18 programmed as both an interrupt and a wake
source, but confirmed with internal team on this design this pin is
floating and shouldn't have been programmed. This causes lots of
spurious IRQs on the system and horrendous battery life.
Add a quirk to ignore attempts to program this pin on this system.
Reported-by: Pavel Krc
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=216208
Reviewed-by: Hans de Goede
Signed-off-by: Mario Limonciello
Reviewed-by: Mika Westerberg
Signed-off-by: Andy Shevchenko
Signed-off-by: Greg Kroah-Hartman
commit 359e1b7a7f79738e00a59f367dbe0d3a819d1754
Author: Mario Limonciello
Date: Tue Aug 2 23:24:59 2022 -0500
gpiolib: acpi: Add support to ignore programming an interrupt
commit 6b6af7bd5718f4e45a9b930533aec1158387d552 upstream.
gpiolib-acpi already had support for ignoring a pin for wakeup, but
if an OEM configures a floating pin as an interrupt source then
stopping it from being a wakeup won't do much good to stop the
interrupt storm.
Add support for a module parameter and quirk infrastructure to
ignore interrupts as well.
Signed-off-by: Mario Limonciello
Reviewed-by: Hans de Goede
Reviewed-by: Mika Westerberg
Signed-off-by: Andy Shevchenko
Signed-off-by: Greg Kroah-Hartman
commit 94e14d5193c5692faa589b733e9a360154d4696b
Author: Johan Hovold
Date: Tue Sep 13 16:53:12 2022 +0200
USB: serial: ftdi\_sio: fix 300 bps rate for SIO
commit 7bd7ad3c310cd6766f170927381eea0aa6f46c69 upstream.
The 300 bps rate of SIO devices has been mapped to 9600 bps since
2003... Let's fix the regression.
Cc: stable@vger.kernel.org
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 08e2c70e549b77f5f3af9c76da00779d5756f997
Author: Tadeusz Struk
Date: Mon Sep 19 14:59:57 2022 -0700
usb: mon: make mmapped memory read only
commit a659daf63d16aa883be42f3f34ff84235c302198 upstream.
Syzbot found an issue in usbmon module, where the user space client can
corrupt the monitor's internal memory, causing the usbmon module to
crash the kernel with segfault, UAF, etc.
The reproducer mmaps the /dev/usbmon memory to user space, and
overwrites it with arbitrary data, which causes all kinds of issues.
Return an -EPERM error from mon\_bin\_mmap() if the flag VM\_WRTIE is set.
Also clear VM\_MAYWRITE to make it impossible to change it to writable
later.
Cc: "Dmitry Vyukov"
Cc: stable
Fixes: 6f23ee1fefdc ("USB: add binary API to usbmon")
Suggested-by: PaX Team  # for the VM\_MAYRITE portion
Link: https://syzkaller.appspot.com/bug?id=2eb1f35d6525fa4a74d75b4244971e5b1411c95a
Reported-by: syzbot+23f57c5ae902429285d7@syzkaller.appspotmail.com
Signed-off-by: Tadeusz Struk
Link: https://lore.kernel.org/r/20220919215957.205681-1-tadeusz.struk@linaro.org
Signed-off-by: Greg Kroah-Hartman
commit 3a93bbb581f85367b3227a685aa24a051230229c
Author: Aleksa Savic
Date: Wed Sep 14 13:43:27 2022 +0200
hwmon: (aquacomputer\_d5next) Fix Quadro fan speed offsets
commit b7f3e9650f12d1e06b94a0257bcb90279f691bf5 upstream.
The offsets for setting speeds of fans connected to Quadro are off by one.
Set them to their correct values.
The offsets as shown point to registers for setting the fan control mode,
which will be explored in future patches, but slipped in here. When
setting fan speeds, the resulting values were overlapping, which made the
fans still run in my initial testing.
Fixes: cdbe34da01e3 ("hwmon: (aquacomputer\_d5next) Add support for Aquacomputer Quadro fan controller")
Signed-off-by: Aleksa Savic
Link: https://lore.kernel.org/r/20220914114327.6941-1-savicaleksa83@gmail.com
Cc: stable@vger.kenrel.org
Signed-off-by: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman
commit 4ec318d06084a807df8eb212e321120236915fd6
Author: Shuah Khan
Date: Thu Sep 1 15:23:19 2022 -0600
docs: update mediator information in CoC docs
commit 8bfdfa0d6b929ede7b6189e0e546ceb6a124d05d upstream.
Update mediator information in the CoC interpretation document.
Signed-off-by: Shuah Khan
Link: https://lore.kernel.org/r/20220901212319.56644-1-skhan@linuxfoundation.org
Cc: stable@vger.kernel.org
Signed-off-by: Jonathan Corbet
Signed-off-by: Greg Kroah-Hartman
commit 49a49d65e21085c088d2a96e583282d59769926b
Author: Kees Cook
Date: Thu Sep 29 22:57:43 2022 -0700
hardening: Remove Clang's enable flag for -ftrivial-auto-var-init=zero
commit 607e57c6c62c00965ae276902c166834ce73014a upstream.
Now that Clang's -enable-trivial-auto-var-init-zero-knowing-it-will-be-removed-from-clang
option is no longer required, remove it from the command line. Clang 16
and later will warn when it is used, which will cause Kconfig to think
it can't use -ftrivial-auto-var-init=zero at all. Check for whether it
is required and only use it when so.
Cc: Nathan Chancellor
Cc: Masahiro Yamada
Cc: Nick Desaulniers
Cc: linux-kbuild@vger.kernel.org
Cc: llvm@lists.linux.dev
Cc: stable@vger.kernel.org
Fixes: f02003c860d9 ("hardening: Avoid harmless Clang option under CONFIG\_INIT\_STACK\_ALL\_ZERO")
Signed-off-by: Kees Cook
Signed-off-by: Greg Kroah-Hartman
commit a3c72efe3d6143b0964642435d8d8bf42e4fbf75
Author: Sami Tolvanen
Date: Fri Sep 30 20:33:10 2022 +0000
Makefile.extrawarn: Move -Wcast-function-type-strict to W=1
commit 2120635108b35ecad9c59c8b44f6cbdf4f98214e upstream.
We enable -Wcast-function-type globally in the kernel to warn about
mismatching types in function pointer casts. Compilers currently
warn only about ABI incompability with this flag, but Clang 16 will
enable a stricter version of the check by default that checks for an
exact type match. This will be very noisy in the kernel, so disable
-Wcast-function-type-strict without W=1 until the new warnings have
been addressed.
Cc: stable@vger.kernel.org
Link: https://reviews.llvm.org/D134831
Link: https://github.com/ClangBuiltLinux/linux/issues/1724
Suggested-by: Nathan Chancellor
Signed-off-by: Sami Tolvanen
Signed-off-by: Kees Cook
Link: https://lore.kernel.org/r/20220930203310.4010564-1-samitolvanen@google.com
Signed-off-by: Greg Kroah-Hartman
commit df3d15181e00f1e63d778c29d252a25e04f6b046
Author: Bart Van Assche
Date: Tue Aug 30 13:58:42 2022 -0700
sparc: Unbreak the build
commit 17006e86a7641fa3c50324cfb602f0e74dac8527 upstream.
Fix the following build errors:
arch/sparc/mm/srmmu.c: In function ‘smp\_flush\_page\_for\_dma’:
arch/sparc/mm/srmmu.c:1639:13: error: cast between incompatible function types from ‘void (\*)(long unsigned int)’ to ‘void (\*)(long unsigned int, long unsigned int, long unsigned int, long unsigned int, long unsigned int)’ [-Werror=cast-function-type]
1639 | xc1((smpfunc\_t) local\_ops->page\_for\_dma, page);
| ^
arch/sparc/mm/srmmu.c: In function ‘smp\_flush\_cache\_mm’:
arch/sparc/mm/srmmu.c:1662:29: error: cast between incompatible function types from ‘void (\*)(struct mm\_struct \*)’ to ‘void (\*)(long unsigned int, long unsigned int, long unsigned int, long unsigned int, long unsigned int)’ [-Werror=cast-function-type]
1662 | xc1((smpfunc\_t) local\_ops->cache\_mm, (unsigned long) mm);
|
[ ... ]
Compile-tested only.
Fixes: 552a23a0e5d0 ("Makefile: Enable -Wcast-function-type")
Cc: stable@vger.kernel.org
Signed-off-by: Bart Van Assche
Tested-by: Andreas Larsson
Signed-off-by: Kees Cook
Link: https://lore.kernel.org/r/20220830205854.1918026-1-bvanassche@acm.org
Signed-off-by: Greg Kroah-Hartman
commit 79bc9ee841abf982affb75c8417abe9091e64304
Author: Al Viro
Date: Mon Oct 3 20:26:08 2022 -0400
fix coredump breakage
commit 4f526fef91b24197d489ff86789744c67f475bb4 upstream.
Let me count the ways in which I'd screwed up:
\* when emitting a page, handling of gaps in coredump should happen
before fetching the current file position.
\* fix for a problem that occurs on rather uncommon setups (and hadn't
been observed in the wild) had been sent very late in the cycle.
\* ... with badly insufficient testing, introducing an easily
reproducible breakage. Without giving it time to soak in -next.
Fucked-up-by: Al Viro
Reported-by: "J. R. Okajima"
Tested-by: "J. R. Okajima"
Fixes: 06bbaa6dc53c "[coredump] don't use \_\_kernel\_write() on kmap\_local\_page()"
Cc: stable@kernel.org # v6.0-only
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 2a96b532098284ecf8e4849b8b9e5fc7a28bdee9
Author: Dongliang Mu
Date: Tue Aug 16 12:08:58 2022 +0800
fs: fix UAF/GPF bug in nilfs\_mdt\_destroy
commit 2e488f13755ffbb60f307e991b27024716a33b29 upstream.
In alloc\_inode, inode\_init\_always() could return -ENOMEM if
security\_inode\_alloc() fails, which causes inode->i\_private
uninitialized. Then nilfs\_is\_metadata\_file\_inode() returns
true and nilfs\_free\_inode() wrongly calls nilfs\_mdt\_destroy(),
which frees the uninitialized inode->i\_private
and leads to crashes(e.g., UAF/GPF).
Fix this by moving security\_inode\_alloc just prior to
this\_cpu\_inc(nr\_inodes)
Link: https://lkml.kernel.org/r/CAFcO6XOcf1Jj2SeGt=jJV59wmhESeSKpfR0omdFRq+J9nD1vfQ@mail.gmail.com
Reported-by: butt3rflyh4ck
Reported-by: Hao Sun
Reported-by: Jiacheng Xu
Reviewed-by: Christian Brauner (Microsoft)
Signed-off-by: Dongliang Mu
Cc: Al Viro
Cc: stable@vger.kernel.org
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit a53f14b0a934de4c0ee6935c7ee224e979460a7b
Author: Jalal Mostafa
Date: Wed Sep 21 13:57:01 2022 +0000
xsk: Inherit need\_wakeup flag for shared sockets
commit 60240bc26114543fcbfcd8a28466e67e77b20388 upstream.
The flag for need\_wakeup is not set for xsks with `XDP\_SHARED\_UMEM`
flag and of different queue ids and/or devices. They should inherit
the flag from the first socket buffer pool since no flags can be
specified once `XDP\_SHARED\_UMEM` is specified.
Fixes: b5aea28dca134 ("xsk: Add shared umem support between queue ids")
Signed-off-by: Jalal Mostafa
Signed-off-by: Daniel Borkmann
Acked-by: Magnus Karlsson
Link: https://lore.kernel.org/bpf/20220921135701.10199-1-jalal.a.mostapha@gmail.com
Signed-off-by: Greg Kroah-Hartman


=== Content from lists.debian.org_fd6e070d_20250114_210751.html ===


---

[[Date Prev](msg00033.html)][[Date Next](msg00035.html)]
[[Thread Prev](msg00033.html)][[Thread Next](msg00035.html)]
[[Date Index](maillist.html#00034)]
[[Thread Index](threads.html#00034)]

# [SECURITY] [DLA 3245-1] linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3245-1] linux security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Fri, 23 Dec 2022 23:16:58 +0100
* *Message-id*: <[[🔎]](/msgid-search/1bbd98236848af2b95e3e5504023b5363cf93d77.camel%40debian.org) [1bbd98236848af2b95e3e5504023b5363cf93d77.camel@debian.org](msg00034.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3245-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
December 21, 2022                             <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux
Version        : 4.19.269-1
CVE ID         : CVE-2022-2978 CVE-2022-3521 CVE-2022-3524 CVE-2022-3564
                 CVE-2022-3565 CVE-2022-3594 CVE-2022-3621 CVE-2022-3628
                 CVE-2022-3640 CVE-2022-3643 CVE-2022-3646 CVE-2022-3649
                 CVE-2022-4378 CVE-2022-20369 CVE-2022-29901 CVE-2022-40768
                 CVE-2022-41849 CVE-2022-41850 CVE-2022-42328 CVE-2022-42329
                 CVE-2022-42895 CVE-2022-42896 CVE-2022-43750

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2022-2978

    "butt3rflyh4ck", Hao Sun, and Jiacheng Xu reported a flaw in the
    nilfs2 filesystem driver which can lead to a use-after-free.  A
    local use might be able to exploit this to cause a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2022-3521

    The syzbot tool found a race condition in the KCM subsystem
    which could lead to a crash.

    This subsystem is not enabled in Debian's official kernel
    configurations.

CVE-2022-3524

    The syzbot tool found a race condition in the IPv6 stack which
    could lead to a memory leak.  A local user could exploit this to
    cause a denial of service (memory exhaustion).

CVE-2022-3564

    A flaw was discovered in the Bluetooh L2CAP subsystem which
    would lead to a use-after-free.  This might be exploitable
    to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-3565

    A flaw was discovered in the mISDN driver which would lead to a
    use-after-free.  This might be exploitable to cause a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2022-3594

    Andrew Gaul reported that the r8152 Ethernet driver would log
    excessive numbers of messages in response to network errors.  A
    remote attacker could possibly exploit this to cause a denial of
    service (resource exhaustion).

CVE-2022-3621, CVE-2022-3646

    The syzbot tool found flaws in the nilfs2 filesystem driver which
    can lead to a null pointer dereference or memory leak.  A user
    permitted to mount arbitrary filesystem images could use these to
    cause a denial of service (crash or resource exhaustion).

CVE-2022-3628

    Dokyung Song, Jisoo Jang, and Minsuk Kang reported a potential
    heap-based buffer overflow in the brcmfmac Wi-Fi driver.  A user
    able to connect a malicious USB device could exploit this to cause
    a denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2022-3640

    A flaw was discovered in the Bluetooh L2CAP subsystem which
    would lead to a use-after-free.  This might be exploitable
    to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-3643 (XSA-423)

    A flaw was discovered in the Xen network backend driver that would
    result in it generating malformed packet buffers.  If these
    packets were forwarded to certain other network devices, a Xen
    guest could exploit this to cause a denial of service (crash or
    device reset).

CVE-2022-3649

    The syzbot tool found flaws in the nilfs2 filesystem driver which
    can lead to a use-after-free.  A user permitted to mount arbitrary
    filesystem images could use these to cause a denial of service
    (crash or memory corruption) or possibly for privilege escalation.

CVE-2022-4378

    Kyle Zeng found a flaw in procfs that would cause a stack-based
    buffer overflow.  A local user permitted to write to a sysctl
    could use this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2022-20369

    A flaw was found in the v4l2-mem2mem media driver that would lead
    to an out-of-bounds write.  A local user with access to such a
    device could exploit this for privilege escalation.

CVE-2022-29901

    Johannes Wikner and Kaveh Razavi reported that for Intel
    processors (Intel Core generation 6, 7 and 8), protections against
    speculative branch target injection attacks were insufficient in
    some circumstances, which may allow arbitrary speculative code
    execution under certain microarchitecture-dependent conditions.

    More information can be found at
    <https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/advisory-guidance/return-stack-buffer-underflow.html>

CVE-2022-40768

    "hdthky" reported that the stex SCSI adapter driver did not fully
    initialise a structure that is copied to user-space.  A local user
    with access to such a device could exploit this to leak sensitive
    information.

CVE-2022-41849

    A race condition was discovered in the smscufx graphics driver,
    which could lead to a use-after-free.  A user able to remove the
    physical device while also accessing its device node could exploit
    this to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-41850

    A race condition was discovered in the hid-roccat input driver,
    which could lead to a use-after-free.  A local user able to access
    such a device could exploit this to cause a denial of service
    (crash or memory corruption) or possibly for privilege escalation.

CVE-2022-42328, CVE-2022-42329 (XSA-424)

    Yang Yingliang reported that the Xen network backend driver did
    not use the proper function to free packet buffers in one case,
    which could lead to a deadlock.  A Xen guest could exploit this to
    cause a denial of service (hang).

CVE-2022-42895

    Tamás Koczka reported a flaw in the Bluetooh L2CAP subsystem
    that would result in reading uninitialised memory.  A nearby
    attacker able to make a Bluetooth connection could exploit
    this to leak sensitive information.

CVE-2022-42896

    Tamás Koczka reported flaws in the Bluetooh L2CAP subsystem that
    can lead to a use-after-free.  A nearby attacker able to make a
    Bluetooth SMP connection could exploit this to cause a denial of
    service (crash or memory corruption) or possibly for remote code
    execution.

CVE-2022-43750

    The syzbot tool found that the USB monitor (usbmon) driver allowed
    user-space programs to overwrite the driver's data structures.  A
    local user permitted to access a USB monitor device could exploit
    this to cause a denial of service (memory corruption or crash) or
    possibly for privilege escalation.  However, by default only the
    root user can access such devices.

For Debian 10 buster, these problems have been fixed in version
4.19.269-1.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS
teams

```

**Attachment:
[signature.asc](pgpJBRnFmtPRG.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from github.com_07507c00_20250114_210750.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa659daf63d16aa883be42f3f34ff84235c302198)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa659daf63d16aa883be42f3f34ff84235c302198)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.8k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  434](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/a659daf63d16aa883be42f3f34ff84235c302198)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

usb: mon: make mmapped memory read only

[Browse files](/torvalds/linux/tree/a659daf63d16aa883be42f3f34ff84235c302198)
Browse the repository at this point in the history

```
Syzbot found an issue in usbmon module, where the user space client can
corrupt the monitor's internal memory, causing the usbmon module to
crash the kernel with segfault, UAF, etc.

The reproducer mmaps the /dev/usbmon memory to user space, and
overwrites it with arbitrary data, which causes all kinds of issues.

Return an -EPERM error from mon_bin_mmap() if the flag VM_WRTIE is set.
Also clear VM_MAYWRITE to make it impossible to change it to writable
later.

Cc: "Dmitry Vyukov" <dvyukov@google.com>
Cc: stable <stable@kernel.org>
Fixes: [6f23ee1](https://github.com/torvalds/linux/commit/6f23ee1fefdc1f80bd8a3ab04a1c41ab2dec14c9) ("USB: add binary API to usbmon")
Suggested-by: PaX Team <pageexec@freemail.hu>	# for the VM_MAYRITE portion
Link: <https://syzkaller.appspot.com/bug?id=2eb1f35d6525fa4a74d75b4244971e5b1411c95a>
Reported-by: syzbot+23f57c5ae902429285d7@syzkaller.appspotmail.com
Signed-off-by: Tadeusz Struk <tadeusz.struk@linaro.org>
Link: [https://lore.kernel.org/r/20220919215957.205681-1-tadeusz.struk@linaro.org](https://lore.kernel.org/r/20220919215957.205681-1-tadeusz.struk%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
```

* Loading branch information

[![@tstruk](https://avatars.githubusercontent.com/u/1063257?s=40&v=4)](/tstruk) [![@gregkh](https://avatars.githubusercontent.com/u/14953?s=40&v=4)](/gregkh)

[tstruk](/torvalds/linux/commits?author=tstruk "View all commits by tstruk")
authored and
[gregkh](/torvalds/linux/commits?author=gregkh "View all commits by gregkh")
committed
Sep 22, 2022

1 parent
[5032b26](/torvalds/linux/commit/5032b269203287c17064d33c72be1ebf30c04a95)

commit a659daf

Showing
**1 changed file**
with
**5 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

5 changes: 5 additions & 0 deletions

5
[drivers/usb/mon/mon\_bin.c](#diff-15a3873003b2931bed21fb9694808cb953f459b1e4a82595c93362fbd8658468 "drivers/usb/mon/mon_bin.c")

Show comments

[View file](/torvalds/linux/blob/a659daf63d16aa883be42f3f34ff84235c302198/drivers/usb/mon/mon_bin.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1268,6 +1268,11 @@ static int mon\_bin\_mmap(struct file \*filp, struct vm\_area\_struct \*vma) |
|  |  | { |
|  |  | /\* don't do anything here: "fault" will set up page table entries \*/ |
|  |  | vma->vm\_ops = &mon\_bin\_vm\_ops; |
|  |  |  |
|  |  | if (vma->vm\_flags & VM\_WRITE) |
|  |  | return -EPERM; |
|  |  |  |
|  |  | vma->vm\_flags &= ~VM\_MAYWRITE; |
|  |  | vma->vm\_flags |= VM\_DONTEXPAND | VM\_DONTDUMP; |
|  |  | vma->vm\_private\_data = filp->private\_data; |
|  |  | mon\_bin\_vma\_open(vma); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a659daf`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa659daf63d16aa883be42f3f34ff84235c302198) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.debian.org_22dbde1f_20250114_210751.html ===


---

[[Date Prev](msg00000.html)][[Date Next](msg00002.html)]
[[Thread Prev](msg00000.html)][[Thread Next](msg00002.html)]
[[Date Index](maillist.html#00001)]
[[Thread Index](threads.html#00001)]

# [SECURITY] [DLA 3173-1] linux-5.10 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3173-1] linux-5.10 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Tue, 01 Nov 2022 21:57:30 +0100
* *Message-id*: <[[🔎]](/msgid-search/0aec38207ef1e766fe4df3040c33d06da80343ec.camel%40debian.org) [0aec38207ef1e766fe4df3040c33d06da80343ec.camel@debian.org](msg00001.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3173-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
November 1, 2022                              <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-5.10
Version        : 5.10.149-2~deb10u1
CVE ID         : CVE-2021-4037 CVE-2022-0171 CVE-2022-1184 CVE-2022-1679
                 CVE-2022-2153 CVE-2022-2602 CVE-2022-2663 CVE-2022-2905
                 CVE-2022-3028 CVE-2022-3061 CVE-2022-3176 CVE-2022-3303
                 CVE-2022-3586 CVE-2022-3621 CVE-2022-3625 CVE-2022-3629
                 CVE-2022-3633 CVE-2022-3635 CVE-2022-3646 CVE-2022-3649
                 CVE-2022-20421 CVE-2022-20422 CVE-2022-39188 CVE-2022-39190
                 CVE-2022-39842 CVE-2022-40307 CVE-2022-41222 CVE-2022-41674
                 CVE-2022-42719 CVE-2022-42720 CVE-2022-42721 CVE-2022-42722
                 CVE-2022-43750
Debian Bug     : 1017425 1019248

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2021-4037

    Christian Brauner reported that the inode_init_owner function for
    the XFS filesystem in the Linux kernel allows local users to
    create files with an unintended group ownership allowing attackers
    to escalate privileges by making a plain file executable and SGID.

CVE-2022-0171

    Mingwei Zhang reported that a cache incoherence issue in the SEV
    API in the KVM subsystem may result in denial of service.

CVE-2022-1184

    A flaw was discovered in the ext4 filesystem driver which can lead
    to a use-after-free. A local user permitted to mount arbitrary
    filesystems could exploit this to cause a denial of service (crash
    or memory corruption) or possibly for privilege escalation.

CVE-2022-1679

    The syzbot tool found a race condition in the ath9k_htc driver
    which can lead to a use-after-free.  This might be exploitable to
    cause a denial service (crash or memory corruption) or possibly
    for privilege escalation.

CVE-2022-2153

    "kangel" reported a flaw in the KVM implementation for x86
    processors which could lead to a null pointer dereference. A local
    user permitted to access /dev/kvm could exploit this to cause a
    denial of service (crash).

CVE-2022-2602

    A race between handling an io_uring request and the Unix socket
    garbage collector was discovered. An attacker can take advantage
    of this flaw for local privilege escalation.

CVE-2022-2663

    David Leadbeater reported flaws in the nf_conntrack_irc
    connection-tracking protocol module. When this module is enabled
    on a firewall, an external user on the same IRC network as an
    internal user could exploit its lax parsing to open arbitrary TCP
    ports in the firewall, to reveal their public IP address, or to
    block their IRC connection at the firewall.

CVE-2022-2905

    Hsin-Wei Hung reported a flaw in the eBPF verifier which can lead
    to an out-of-bounds read.  If unprivileged use of eBPF is enabled,
    this could leak sensitive information.  This was already disabled
    by default, which would fully mitigate the vulnerability.

CVE-2022-3028

    Abhishek Shah reported a race condition in the AF_KEY subsystem,
    which could lead to an out-of-bounds write or read.  A local user
    could exploit this to cause a denial of service (crash or memory
    corruption), to obtain sensitive information, or possibly for
    privilege escalation.

CVE-2022-3061

    A flaw was discovered in the i740 driver which may result in
    denial of service.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2022-3176

    A use-after-free flaw was discovered in the io_uring subsystem
    which may result in local privilege escalation to root.

CVE-2022-3303

    A race condition in the snd_pcm_oss_sync function in the sound
    subsystem in the Linux kernel due to improper locking may result
    in denial of service.

CVE-2022-3586 (ZDI-22-1452)

    The Zero Day Initiative reported a flaw in the sch_sfb network
    scheduler, which may lead to a use-after-free and leak of
    sensitive information from the kernel.

CVE-2022-3621, CVE-2022-3646

    The syzbot tool found flaws in the nilfs2 filesystem driver which
    can lead to a null pointer dereference or memory leak.  A user
    permitted to mount arbitrary filesystem images could use these to
    cause a denial of service (crash or resource exhaustion).

CVE-2022-3625

    A flaw was discovered in the devlink subsystem which can lead to
    a use-after-free.  The security impact of this is unclear.

CVE-2022-3629

    The syzbot tool found a memory leak in the Virtual Socket Protocol
    implementation.  A local user could exploit this to cause a denial
    of service (resource exhaustion).

CVE-2022-3633

    The Linux Verification Center found a memory leak in the SAE J1939
    protocol implementation.  A local user could exploit this to cause
    a denial of service (resource exhaustion).

CVE-2022-3635

    Several race conditions were discovered in the idt77252 ATM
    driver, which can lead to a use-after-free if the module is
    removed.  The security impact of this is unclear.

CVE-2022-3649

    The syzbot tool found flaws in the nilfs2 filesystem driver which
    can lead to a use-after-free.  A user permitted to mount arbitrary
    filesystem images could use these to cause a denial of service
    (crash or memory corruption) or possibly for privilege escalation.

CVE-2022-20421

    A use-after-free vulnerability was discovered in the
    binder_inc_ref_for_node function in the Android binder driver. On
    systems where the binder driver is loaded, a local user could
    exploit this for privilege escalation.

CVE-2022-20422

    A race condition was discovered in the instruction emulator for
    64-bit Arm systems.  Concurrent changes to the sysctls that
    control the emulator could result in a null pointer dereference.
    The security impact of this is unclear.

CVE-2022-39188

    Jann Horn reported a race condition in the kernel's handling of
    unmapping of certain memory ranges. When a driver created a memory
    mapping with the VM_PFNMAP flag, which many GPU drivers do, the
    memory mapping could be removed and freed before it was flushed
    from the CPU TLBs. This could result in a page use-after-free. A
    local user with access to such a device could exploit this to
    cause a denial of service (crash or memory corruption) or possibly
    for privilege escalation.

CVE-2022-39190

    Gwangun Jung reported a flaw in the nf_tables subsystem.  A local
    user could exploit this to cause a denial of service (crash).

CVE-2022-39842

    An integer overflow was discovered in the pxa3xx-gcu video driver
    which could lead to a heap out-of-bounds write.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2022-40307

    A race condition was discovered in the EFI capsule-loader driver,
    which could lead to use-after-free. A local user permitted to
    access this device (/dev/efi_capsule_loader) could exploit this to
    cause a denial of service (crash or memory corruption) or possibly
    for privilege escalation. However, this device is normally only
    accessible by the root user.

CVE-2022-41222

    A race condition was discovered in the memory management subsystem
    that can lead to stale TLB entries.  A local user could exploit
    this to cause a denial of service (memory corruption or crash),
    information leak, or privilege escalation.

CVE-2022-41674, CVE-2022-42719, CVE-2022-42720, CVE-2022-42721,
CVE-2022-42722

    Soenke Huster discovered several vulnerabilities in the mac80211
    subsystem triggered by WLAN frames which may result in denial of
    service or the execution of arbitrary code.

CVE-2022-43750

    The syzbot tool found that the USB monitor (usbmon) driver allowed
    user-space programs to overwrite the driver's data structures.  A
    local user permitted to access a USB monitor device could exploit
    this to cause a denial of service (memory corruption or crash) or
    possibly for privilege escalation.  However, by default only the
    root user can access such devices.

For Debian 10 buster, these problems have been fixed in version
5.10.149-2~deb10u1.  This update also fixes a regression for some
older 32-bit PCs (bug #1017425), and enables the i10nm_edac driver
(bug #1019248).  It additionally includes many more bug fixes from
stable updates 5.10.137-5.10.149 inclusive.

We recommend that you upgrade your linux-5.10 packages.

For the detailed security status of linux-5.10 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-5.10>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams

```

**Attachment:
[signature.asc](pgpf2IA2J90bh.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from cdn.kernel.org_d386078a_20250114_210742.html ===
commit 51dd976781da8c0b47e106ed59a96d7c28972ce4
Author: Greg Kroah-Hartman
Date: Wed Oct 12 09:51:26 2022 +0200
Linux 5.19.15
Link: https://lore.kernel.org/r/20221010070333.676316214@linuxfoundation.org
Tested-by: Linux Kernel Functional Testing
Tested-by: Justin M. Forbes
Tested-by: Florian Fainelli
Tested-by: Shuah Khan
Tested-by: Bagas Sanjaya
Link: https://lore.kernel.org/r/20221010191212.200768859@linuxfoundation.org
Tested-by: Florian Fainelli
Tested-by: Slade Watkins
Tested-by: Ron Economos
Tested-by: Linux Kernel Functional Testing
Tested-by: Shuah Khan
Tested-by: Guenter Roeck
Tested-by: Jon Hunter
Tested-by: Sudip Mukherjee
Signed-off-by: Greg Kroah-Hartman
commit 04bd2a779511e04892b522d41abbdb0e5c072abf
Author: Sasha Levin
Date: Tue Oct 11 08:58:00 2022 -0400
Revert "clk: ti: Stop using legacy clkctrl names for omap4 and 5"
This reverts commit 67c830a6de835a36b4e19fe4d968dbaf8dc4e9c6.
Which was upstream commit 255584b138343d4a28c6d25bd82d04b09460d672.
Reported as causing boot failures.
Signed-off-by: Sasha Levin
commit c4635cf3d845a7324c25c52d549b70c8bd7ad4c7
Author: Tetsuo Handa
Date: Fri Sep 2 20:23:48 2022 +0900
Bluetooth: use hdev->workqueue when queuing hdev->{cmd,ncmd}\_timer works
commit deee93d13d385103205879a8a0915036ecd83261 upstream.
syzbot is reporting attempt to schedule hdev->cmd\_work work from system\_wq
WQ into hdev->workqueue WQ which is under draining operation [1], for
commit c8efcc2589464ac7 ("workqueue: allow chained queueing during
destruction") does not allow such operation.
The check introduced by commit 877afadad2dce8aa ("Bluetooth: When HCI work
queue is drained, only queue chained work") was incomplete.
Use hdev->workqueue WQ when queuing hdev->{cmd,ncmd}\_timer works because
hci\_{cmd,ncmd}\_timeout() calls queue\_work(hdev->workqueue). Also, protect
the queuing operation with RCU read lock in order to avoid calling
queue\_delayed\_work() after cancel\_delayed\_work() completed.
Link: https://syzkaller.appspot.com/bug?extid=243b7d89777f90f7613b [1]
Reported-by: syzbot
Signed-off-by: Tetsuo Handa
Fixes: 877afadad2dce8aa ("Bluetooth: When HCI work queue is drained, only queue chained work")
Signed-off-by: Luiz Augusto von Dentz
Signed-off-by: Greg Kroah-Hartman
commit 6954cee8826819340594ef614341e4d634af3d4a
Author: Jules Irenge
Date: Wed Sep 7 16:24:20 2022 +0100
bpf: Fix resetting logic for unreferenced kptrs
commit 9fad7fe5b29803584c7f17a2abe6c2936fec6828 upstream.
Sparse reported a warning at bpf\_map\_free\_kptrs()
"warning: Using plain integer as NULL pointer"
During the process of fixing this warning, it was discovered that the current
code erroneously writes to the pointer variable instead of deferencing and
writing to the actual kptr. Hence, Sparse tool accidentally helped to uncover
this problem. Fix this by doing WRITE\_ONCE(\*p, 0) instead of WRITE\_ONCE(p, 0).
Note that the effect of this bug is that unreferenced kptrs will not be cleared
during check\_and\_free\_fields. It is not a problem if the clearing is not done
during map\_free stage, as there is nothing to free for them.
Fixes: 14a324f6a67e ("bpf: Wire up freeing of referenced kptr")
Signed-off-by: Jules Irenge
Link: https://lore.kernel.org/r/Yxi3pJaK6UDjVJSy@playground
Signed-off-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit 292b46c49675fcff39547b643d48d0fec27cdbb9
Author: Daniel Golle
Date: Fri Sep 30 01:56:53 2022 +0100
net: ethernet: mtk\_eth\_soc: fix state in \_\_mtk\_foe\_entry\_clear
commit ae3ed15da5889263de372ff9df2e83e16acca4cb upstream.
Setting ib1 state to MTK\_FOE\_STATE\_UNBIND in \_\_mtk\_foe\_entry\_clear
routine as done by commit 0e80707d94e4c8 ("net: ethernet: mtk\_eth\_soc:
fix typo in \_\_mtk\_foe\_entry\_clear") breaks flow offloading, at least
on older MTK\_NETSYS\_V1 SoCs, OpenWrt users have confirmed the bug on
MT7622 and MT7621 systems.
Felix Fietkau suggested to use MTK\_FOE\_STATE\_INVALID instead which
works well on both, MTK\_NETSYS\_V1 and MTK\_NETSYS\_V2.
Tested on MT7622 (Linksys E8450) and MT7986 (BananaPi BPI-R3).
Suggested-by: Felix Fietkau
Fixes: 0e80707d94e4c8 ("net: ethernet: mtk\_eth\_soc: fix typo in \_\_mtk\_foe\_entry\_clear")
Fixes: 33fc42de33278b ("net: ethernet: mtk\_eth\_soc: support creating mac address based offload entries")
Signed-off-by: Daniel Golle
Link: https://lore.kernel.org/r/YzY+1Yg0FBXcnrtc@makrotopia.org
Signed-off-by: Jakub Kicinski
Signed-off-by: Greg Kroah-Hartman
commit 9783292253fdc4001268729e1bd08777ba9248c5
Author: Kumar Kartikeya Dwivedi
Date: Wed Sep 21 16:35:50 2022 +0200
bpf: Gate dynptr API behind CAP\_BPF
commit 8addbfc7b308d591f8a5f2f6bb24d08d9d79dfbb upstream.
This has been enabled for unprivileged programs for only one kernel
release, hence the expected annoyances due to this move are low. Users
using ringbuf can stick to non-dynptr APIs. The actual use cases dynptr
is meant to serve may not make sense in unprivileged BPF programs.
Hence, gate these helpers behind CAP\_BPF and limit use to privileged
BPF programs.
Fixes: 263ae152e962 ("bpf: Add bpf\_dynptr\_from\_mem for local dynptrs")
Fixes: bc34dee65a65 ("bpf: Dynptr support for ring buffers")
Fixes: 13bbbfbea759 ("bpf: Add bpf\_dynptr\_read and bpf\_dynptr\_write")
Fixes: 34d4ef5775f7 ("bpf: Add dynptr data slices")
Signed-off-by: Kumar Kartikeya Dwivedi
Link: https://lore.kernel.org/r/20220921143550.30247-1-memxor@gmail.com
Acked-by: Andrii Nakryiko
Signed-off-by: Alexei Starovoitov
Signed-off-by: Greg Kroah-Hartman
commit 7d3f5d0353b4d30216a6c6eedba962c3279fa635
Author: Krzysztof Kozlowski
Date: Thu May 19 09:33:28 2022 +0200
rpmsg: qcom: glink: replace strncpy() with strscpy\_pad()
commit 766279a8f85df32345dbda03b102ca1ee3d5ddea upstream.
The use of strncpy() is considered deprecated for NUL-terminated
strings[1]. Replace strncpy() with strscpy\_pad(), to keep existing
pad-behavior of strncpy, similarly to commit 08de420a8014 ("rpmsg:
glink: Replace strncpy() with strscpy\_pad()"). This fixes W=1 warning:
In function ‘qcom\_glink\_rx\_close’,
inlined from ‘qcom\_glink\_work’ at ../drivers/rpmsg/qcom\_glink\_native.c:1638:4:
drivers/rpmsg/qcom\_glink\_native.c:1549:17: warning: ‘strncpy’ specified bound 32 equals destination size [-Wstringop-truncation]
1549 | strncpy(chinfo.name, channel->name, sizeof(chinfo.name));
[1] https://www.kernel.org/doc/html/latest/process/deprecated.html#strncpy-on-nul-terminated-strings
Signed-off-by: Krzysztof Kozlowski
Reviewed-by: Stephen Boyd
Signed-off-by: Bjorn Andersson
Link: https://lore.kernel.org/r/20220519073330.7187-1-krzysztof.kozlowski@linaro.org
Signed-off-by: Andrew Chernyakov
Signed-off-by: Greg Kroah-Hartman
commit 165ae42fc1cf3c27a4cd077d4622eec4d5621914
Author: Brian Norris
Date: Tue Sep 13 18:40:10 2022 -0700
mmc: core: Terminate infinite loop in SD-UHS voltage switch
commit e9233917a7e53980664efbc565888163c0a33c3f upstream.
This loop intends to retry a max of 10 times, with some implicit
termination based on the SD\_{R,}OCR\_S18A bit. Unfortunately, the
termination condition depends on the value reported by the SD card
(\*rocr), which may or may not correctly reflect what we asked it to do.
Needless to say, it's not wise to rely on the card doing what we expect;
we should at least terminate the loop regardless. So, check both the
input and output values, so we ensure we will terminate regardless of
the SD card behavior.
Note that SDIO learned a similar retry loop in commit 0797e5f1453b
("mmc: core: Fixup signal voltage switch"), but that used the 'ocr'
result, and so the current pre-terminating condition looks like:
rocr & ocr & R4\_18V\_PRESENT
(i.e., it doesn't have the same bug.)
This addresses a number of crash reports seen on ChromeOS that look
like the following:
... // lots of repeated: ...
<4>[13142.846061] mmc1: Skipping voltage switch
<4>[13143.406087] mmc1: Skipping voltage switch
<4>[13143.964724] mmc1: Skipping voltage switch
<4>[13144.526089] mmc1: Skipping voltage switch
<4>[13145.086088] mmc1: Skipping voltage switch
<4>[13145.645941] mmc1: Skipping voltage switch
<3>[13146.153969] INFO: task halt:30352 blocked for more than 122 seconds.
...
Fixes: f2119df6b764 ("mmc: sd: add support for signal voltage switch procedure")
Cc:
Signed-off-by: Brian Norris
Reviewed-by: Guenter Roeck
Link: https://lore.kernel.org/r/20220914014010.2076169-1-briannorris@chromium.org
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit b2afdaddaa8c33818986cc8e355de566636328b1
Author: ChanWoo Lee
Date: Wed Jul 6 09:48:40 2022 +0900
mmc: core: Replace with already defined values for readability
commit e427266460826bea21b70f9b2bb29decfb2c2620 upstream.
SD\_ROCR\_S18A is already defined and is used to check the rocr value, so
let's replace with already defined values for readability.
Signed-off-by: ChanWoo Lee
Reviewed-by: Linus Walleij
Link: https://lore.kernel.org/r/20220706004840.24812-1-cw9316.lee@samsung.com
Signed-off-by: Ulf Hansson
Signed-off-by: Brian Norris
Signed-off-by: Greg Kroah-Hartman
commit 0b0f40745ab405777e9df8d8a46dd4302f40d45c
Author: Mario Limonciello
Date: Tue Aug 2 23:25:00 2022 -0500
gpiolib: acpi: Add a quirk for Asus UM325UAZ
commit 0ea76c401f9245ac209f1b1ce03a7e1fb9de36e5 upstream.
Asus UM325UAZ has GPIO 18 programmed as both an interrupt and a wake
source, but confirmed with internal team on this design this pin is
floating and shouldn't have been programmed. This causes lots of
spurious IRQs on the system and horrendous battery life.
Add a quirk to ignore attempts to program this pin on this system.
Reported-by: Pavel Krc
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=216208
Reviewed-by: Hans de Goede
Signed-off-by: Mario Limonciello
Reviewed-by: Mika Westerberg
Signed-off-by: Andy Shevchenko
Signed-off-by: Greg Kroah-Hartman
commit aa476c7b637521457b099edb18b2c33d1c645109
Author: Mario Limonciello
Date: Tue Aug 2 23:24:59 2022 -0500
gpiolib: acpi: Add support to ignore programming an interrupt
commit 6b6af7bd5718f4e45a9b930533aec1158387d552 upstream.
gpiolib-acpi already had support for ignoring a pin for wakeup, but
if an OEM configures a floating pin as an interrupt source then
stopping it from being a wakeup won't do much good to stop the
interrupt storm.
Add support for a module parameter and quirk infrastructure to
ignore interrupts as well.
Signed-off-by: Mario Limonciello
Reviewed-by: Hans de Goede
Reviewed-by: Mika Westerberg
Signed-off-by: Andy Shevchenko
Signed-off-by: Greg Kroah-Hartman
commit a9d2ce58126ca8b7f2a2a8a863c84b857100fe9c
Author: Johan Hovold
Date: Tue Sep 13 16:53:12 2022 +0200
USB: serial: ftdi\_sio: fix 300 bps rate for SIO
commit 7bd7ad3c310cd6766f170927381eea0aa6f46c69 upstream.
The 300 bps rate of SIO devices has been mapped to 9600 bps since
2003... Let's fix the regression.
Cc: stable@vger.kernel.org
Signed-off-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 9de74019cd44ddddaaca3c677343750ac78b6f73
Author: Tadeusz Struk
Date: Mon Sep 19 14:59:57 2022 -0700
usb: mon: make mmapped memory read only
commit a659daf63d16aa883be42f3f34ff84235c302198 upstream.
Syzbot found an issue in usbmon module, where the user space client can
corrupt the monitor's internal memory, causing the usbmon module to
crash the kernel with segfault, UAF, etc.
The reproducer mmaps the /dev/usbmon memory to user space, and
overwrites it with arbitrary data, which causes all kinds of issues.
Return an -EPERM error from mon\_bin\_mmap() if the flag VM\_WRTIE is set.
Also clear VM\_MAYWRITE to make it impossible to change it to writable
later.
Cc: "Dmitry Vyukov"
Cc: stable
Fixes: 6f23ee1fefdc ("USB: add binary API to usbmon")
Suggested-by: PaX Team  # for the VM\_MAYRITE portion
Link: https://syzkaller.appspot.com/bug?id=2eb1f35d6525fa4a74d75b4244971e5b1411c95a
Reported-by: syzbot+23f57c5ae902429285d7@syzkaller.appspotmail.com
Signed-off-by: Tadeusz Struk
Link: https://lore.kernel.org/r/20220919215957.205681-1-tadeusz.struk@linaro.org
Signed-off-by: Greg Kroah-Hartman
commit c2423912d5c93fc25fec1f11699b4406cc07e4f7
Author: Zhang Qilong
Date: Thu Sep 29 22:30:38 2022 +0800
i2c: davinci: fix PM disable depth imbalance in davinci\_i2c\_probe
[ Upstream commit e2062df704dea47efe16edcaa2316d7b5ecca64f ]
The pm\_runtime\_enable will increase power disable depth. Thus a
pairing decrement is needed on the error handling path to keep
it balanced according to context.
Fixes: 17f88151ff190 ("i2c: davinci: Add PM Runtime Support")
Signed-off-by: Zhang Qilong
Reviewed-by: Bartosz Golaszewski
Signed-off-by: Wolfram Sang
Signed-off-by: Sasha Levin
commit 71c41e04d9d8f89525bd153e80f6b4ac01ee0834
Author: Al Viro
Date: Mon Sep 26 11:59:14 2022 -0400
don't use \_\_kernel\_write() on kmap\_local\_page()
[ Upstream commit 06bbaa6dc53cb72040db952053432541acb9adc7 ]
passing kmap\_local\_page() result to \_\_kernel\_write() is unsafe -
random ->write\_iter() might (and 9p one does) get unhappy when
passed ITER\_KVEC with pointer that came from kmap\_local\_page().
Fix by providing a variant of \_\_kernel\_write() that takes an iov\_iter
from caller (\_\_kernel\_write() becomes a trivial wrapper) and adding
dump\_emit\_page() that parallels dump\_emit(), except that instead of
\_\_kernel\_write() it uses \_\_kernel\_write\_iter() with ITER\_BVEC source.
Fixes: 3159ed57792b "fs/coredump: use kmap\_local\_page()"
Signed-off-by: Al Viro
Signed-off-by: Sasha Levin
commit 5dac20360a7b4acc8f418198edee259972cc7c9b
Author: Kan Liang
Date: Wed Aug 31 07:27:02 2022 -0700
perf/x86/intel: Fix unchecked MSR access error for Alder Lake N
[ Upstream commit 24919fdea6f8b31d7cdf32ac291bc5dd0b023878 ]
For some Alder Lake N machine, the below unchecked MSR access error may be
triggered.
[ 0.088017] rcu: Hierarchical SRCU implementation.
[ 0.088017] unchecked MSR access error: WRMSR to 0x38f (tried to write
0x0001000f0000003f) at rIP: 0xffffffffb5684de8 (native\_write\_msr+0x8/0x30)
[ 0.088017] Call Trace:
[ 0.088017]
[ 0.088017] \_\_intel\_pmu\_enable\_all.constprop.46+0x4a/0xa0
The Alder Lake N only has e-cores. The X86\_FEATURE\_HYBRID\_CPU flag is
not set. The perf cannot retrieve the correct CPU type via
get\_this\_hybrid\_cpu\_type(). The model specific get\_hybrid\_cpu\_type() is
hardcode to p-core. The wrong CPU type is given to the PMU of the
Alder Lake N.
Since Alder Lake N isn't in fact a hybrid CPU, remove ALDERLAKE\_N from
the rest of {ALDER,RAPTOP}LAKE and create a non-hybrid PMU setup.
The differences between Gracemont and the previous Tremont are,
- Number of GP counters
- Load and store latency Events
- PEBS event\_constraints
- Instruction Latency support
- Data source encoding
- Memory access latency encoding
Fixes: c2a960f7c574 ("perf/x86: Add new Alder Lake and Raptor Lake support")
Reported-by: Jianfeng Gao
Suggested-by: Peter Zijlstra (Intel)
Signed-off-by: Kan Liang
Signed-off-by: Peter Zijlstra (Intel)
Link: https://lkml.kernel.org/r/20220831142702.153110-1-kan.liang@linux.intel.com
Signed-off-by: Sasha Levin
commit 3682460b932761598f2e0254ef6ed25b2064b990
Author: Dmytro Laktyushkin
Date: Wed Jul 27 13:02:44 2022 -0400
drm/amd/display: increase dcn315 pstate change latency
[ Upstream commit dcc2527df918edfe297c5074ccc1f05eae361ca6 ]
[Why & How]
Update after new measurment came in
Reviewed-by: Jun Lei
Acked-by: Wayne Lin
Signed-off-by: Dmytro Laktyushkin
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 94d49c380b9a8e6da6a05d2997f5fa637e294ae7
Author: Cruise Hung
Date: Thu Sep 8 22:04:09 2022 +0800
drm/amd/display: Fix DP MST timeslot issue when fallback happened
[ Upstream commit 20c6168b3c8aadef7d2853c925d99eb546bd5e1c ]
[Why]
When USB4 DP link training failed and fell back to lower link rate,
the time slot calculation uses the verified\_link\_cap.
And the verified\_link\_cap was not updated to the new one.
It caused the wrong VC payload time-slot was allocated.
[How]
Updated verified\_link\_cap with the new one from cur\_link\_settings
after the LT completes successfully.
Reviewed-by: Jun Lei
Acked-by: Wayne Lin
Signed-off-by: Cruise Hung
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 4fb0b18590c660c30c949da57966a99c4395e188
Author: zhikzhai
Date: Fri Aug 26 19:44:50 2022 +0800
drm/amd/display: skip audio setup when audio stream is enabled
[ Upstream commit 65fbfb02c2734cacffec5e3f492e1b4f1dabcf98 ]
[why]
We have minimal pipe split transition method to avoid pipe
allocation outage.However, this method will invoke audio setup
which cause audio output stuck once pipe reallocate.
[how]
skip audio setup for pipelines which audio stream has been enabled
Reviewed-by: Charlene Liu
Acked-by: Wayne Lin
Signed-off-by: zhikzhai
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 3c15b295ae2f0c1ddd310c71402b04310f157e6b
Author: Hugo Hu
Date: Thu Sep 1 10:08:35 2022 +0800
drm/amd/display: update gamut remap if plane has changed
[ Upstream commit 52bb21499cf54fa65b56d97cd0d68579c90207dd ]
[Why]
The desktop plane and full-screen game plane may have different
gamut remap coefficients, if switching between desktop and
full-screen game without updating the gamut remap will cause
incorrect color.
[How]
Update gamut remap if planes change.
Reviewed-by: Dmytro Laktyushkin
Acked-by: Wayne Lin
Signed-off-by: Hugo Hu
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 89d3870658033807941fea5ffa5143cd9526ace9
Author: Michael Strauss
Date: Wed Aug 31 15:10:43 2022 -0400
drm/amd/display: Assume an LTTPR is always present on fixed\_vs links
[ Upstream commit 29956d0fded036a570bd8e7d4ea4b1a1730307d2 ]
[WHY]
LTTPRs can in very rare instsances fail to increment DPCD LTTPR count.
This results in aux-i LTTPR requests to be sent to the wrong DPCD
address, which causes link training failure.
[HOW]
Override internal repeater count if fixed\_vs flag is set for a given link
Reviewed-by: George Shen
Acked-by: Wayne Lin
Signed-off-by: Michael Strauss
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit d1137c3c03d83c8705863b1b22dc178e0be93d48
Author: Leo Li
Date: Tue Aug 30 16:38:16 2022 -0400
drm/amd/display: Fix double cursor on non-video RGB MPO
[ Upstream commit b261509952bc19d1012cf732f853659be6ebc61e ]
[Why]
DC makes use of layer\_index (zpos) when picking the HW plane to enable
HW cursor on. However, some compositors will not attach zpos information
to each DRM plane. Consequently, in amdgpu, we default layer\_index to 0
and do not update it.
This causes said DC logic to enable HW cursor on all planes of the same
layer\_index, which manifests as a double cursor issue if one of the
planes is scaled (and hence scaling the cursor as well).
[How]
Use DRM core helpers to calculate a normalized\_zpos value for each
drm\_plane\_state under each crtc, within the atomic state.
This helper will first consider existing zpos values, and if
identical/unset, fallback to plane ID ordering.
The normalized\_zpos is then passed to dc\_plane\_info during atomic check
for later use by the cursor logic.
Reviewed-by: Bhawanpreet Lakha
Acked-by: Wayne Lin
Signed-off-by: Leo Li
Tested-by: Daniel Wheeler
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 32c1dde16f0a5c8da320b9525bbf35b7c404da12
Author: Janis Schoetterl-Glausch
Date: Thu Aug 25 21:25:40 2022 +0200
KVM: s390: Pass initialized arg even if unused
[ Upstream commit b3cefd6bf16e7234ffbd4209f6083060f4e35f59 ]
This silences smatch warnings reported by kbuild bot:
arch/s390/kvm/gaccess.c:859 guest\_range\_to\_gpas() error: uninitialized symbol 'prot'.
arch/s390/kvm/gaccess.c:1064 access\_guest\_with\_key() error: uninitialized symbol 'prot'.
This is because it cannot tell that the value is not used in this case.
The trans\_exc\* only examine prot if code is PGM\_PROTECTION.
Pass a dummy value for other codes.
Reported-by: kernel test robot
Reported-by: Dan Carpenter
Signed-off-by: Janis Schoetterl-Glausch
Reviewed-by: Claudio Imbrenda
Link: https://lore.kernel.org/r/20220825192540.1560559-1-scgl@linux.ibm.com
Signed-off-by: Christian Borntraeger
Signed-off-by: Janosch Frank
Signed-off-by: Sasha Levin
commit 5b4e1c1ffba3d6a30990eace8e41b2ec8040c209
Author: Jianglei Nie
Date: Wed Sep 14 09:42:38 2022 +0800
net: atlantic: fix potential memory leak in aq\_ndev\_close()
[ Upstream commit 65e5d27df61283e5390f04b09dc79cd832f95607 ]
If aq\_nic\_stop() fails, aq\_ndev\_close() returns err without calling
aq\_nic\_deinit() to release the relevant memory and resource, which
will lead to a memory leak.
We can fix it by deleting the if condition judgment and goto statement to
call aq\_nic\_deinit() directly after aq\_nic\_stop() to fix the memory leak.
Signed-off-by: Jianglei Nie
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit cfaf7f090a4098a5780d805d70ac21f53b11775e
Author: David Gow
Date: Wed Sep 21 14:48:55 2022 +0800
arch: um: Mark the stack non-executable to fix a binutils warning
[ Upstream commit bd71558d585ac61cfd799db7f25e78dca404dd7a ]
Since binutils 2.39, ld will print a warning if any stack section is
executable, which is the default for stack sections on files without a
.note.GNU-stack section.
This was fixed for x86 in commit ffcf9c5700e4 ("x86: link vdso and boot with -z noexecstack --no-warn-rwx-segments"),
but remained broken for UML, resulting in several warnings:
/usr/bin/ld: warning: arch/x86/um/vdso/vdso.o: missing .note.GNU-stack section implies executable stack
/usr/bin/ld: NOTE: This behaviour is deprecated and will be removed in a future version of the linker
/usr/bin/ld: warning: .tmp\_vmlinux.kallsyms1 has a LOAD segment with RWX permissions
/usr/bin/ld: warning: .tmp\_vmlinux.kallsyms1.o: missing .note.GNU-stack section implies executable stack
/usr/bin/ld: NOTE: This behaviour is deprecated and will be removed in a future version of the linker
/usr/bin/ld: warning: .tmp\_vmlinux.kallsyms2 has a LOAD segment with RWX permissions
/usr/bin/ld: warning: .tmp\_vmlinux.kallsyms2.o: missing .note.GNU-stack section implies executable stack
/usr/bin/ld: NOTE: This behaviour is deprecated and will be removed in a future version of the linker
/usr/bin/ld: warning: vmlinux has a LOAD segment with RWX permissions
Link both the VDSO and vmlinux with -z noexecstack, fixing the warnings
about .note.GNU-stack sections. In addition, pass --no-warn-rwx-segments
to dodge the remaining warnings about LOAD segments with RWX permissions
in the kallsyms objects. (Note that this flag is apparently not
available on lld, so hide it behind a test for BFD, which is what the
x86 patch does.)
Link: https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ffcf9c5700e49c0aee42dcba9a12ba21338e8136
Link: https://sourceware.org/git/?p=binutils-gdb.git;a=commit;h=ba951afb99912da01a6e8434126b8fac7aa75107
Signed-off-by: David Gow
Reviewed-by: Lukas Straub
Tested-by: Lukas Straub
Acked-by: Randy Dunlap  # build-tested
Signed-off-by: Richard Weinberger
Signed-off-by: Sasha Levin
commit a460f846d580952278793974849e2543b2aecbd5
Author: Linus Walleij
Date: Thu Sep 15 22:32:54 2022 +0200
gpio: ftgpio010: Make irqchip immutable
[ Upstream commit ab637d48363d7b8ee67ae089808a8bc6051d53c4 ]
This turns the FTGPIO010 irqchip immutable.
Tested on the D-Link DIR-685.
Cc: Marc Zyngier
Signed-off-by: Linus Walleij
Acked-by: Marc Zyngier
Signed-off-by: Bartosz Golaszewski
Signed-off-by: Sasha Levin
commit d71f03dbcc17e6ba4bc90daf6bdd7dad93a20764
Author: Lukas Straub
Date: Fri Aug 26 15:29:31 2022 +0000
um: Cleanup compiler warning in arch/x86/um/tls\_32.c
[ Upstream commit d27fff3499671dc23a08efd01cdb8b3764a391c4 ]
arch.tls\_array is statically allocated so checking for NULL doesn't
make sense. This causes the compiler warning below.
Remove the checks to silence these warnings.
../arch/x86/um/tls\_32.c: In function 'get\_free\_idx':
../arch/x86/um/tls\_32.c:68:13: warning: the comparison will always evaluate as 'true' for the address of 'tls\_array' will never be NULL [-Waddress]
68 | if (!t->arch.tls\_array)
| ^
In file included from ../arch/x86/um/asm/processor.h:10,
from ../include/linux/rcupdate.h:30,
from ../include/linux/rculist.h:11,
from ../include/linux/pid.h:5,
from ../include/linux/sched.h:14,
from ../arch/x86/um/tls\_32.c:7:
../arch/x86/um/asm/processor\_32.h:22:31: note: 'tls\_array' declared here
22 | struct uml\_tls\_struct tls\_array[GDT\_ENTRY\_TLS\_ENTRIES];
| ^~~~~~~~~
../arch/x86/um/tls\_32.c: In function 'get\_tls\_entry':
../arch/x86/um/tls\_32.c:243:13: warning: the comparison will always evaluate as 'true' for the address of 'tls\_array' will never be NULL [-Waddress]
243 | if (!t->arch.tls\_array)
| ^
../arch/x86/um/asm/processor\_32.h:22:31: note: 'tls\_array' declared here
22 | struct uml\_tls\_struct tls\_array[GDT\_ENTRY\_TLS\_ENTRIES];
| ^~~~~~~~~
Signed-off-by: Lukas Straub
Acked-by: Randy Dunlap  # build-tested
Signed-off-by: Richard Weinberger
Signed-off-by: Sasha Levin
commit c7105d2a77a63eb36309ada16e3183c1fb45eda0
Author: Lukas Straub
Date: Fri Aug 26 15:29:27 2022 +0000
um: Cleanup syscall\_handler\_t cast in syscalls\_32.h
[ Upstream commit 61670b4d270c71219def1fbc9441debc2ac2e6e9 ]
Like in f4f03f299a56ce4d73c5431e0327b3b6cb55ebb9
"um: Cleanup syscall\_handler\_t definition/cast, fix warning",
remove the cast to to fix the compiler warning.
Signed-off-by: Lukas Straub
Acked-by: Randy Dunlap  # build-tested
Signed-off-by: Richard Weinberger
Signed-off-by: Sasha Levin
commit 9cdbc61abaa0611d9d2cb169586e7bb0daa128e1
Author: Jaroslav Kysela
Date: Tue Sep 13 09:02:16 2022 +0200
ALSA: hda/hdmi: Fix the converter reuse for the silent stream
[ Upstream commit 5f80d6bd2b01de4cafac3302f58456bf860322fc ]
When the user space pcm stream uses the silent stream converter,
it is no longer allocated for the silent stream. Clear the appropriate
flag in the hdmi\_pcm\_open() function. The silent stream setup may
be applied in hdmi\_pcm\_close() (and the error path - open fcn) again.
If the flag is not cleared, the reuse conditions for the silent
stream converter in hdmi\_choose\_cvt() may improperly share
this converter.
Cc: Kai Vehmanen
Signed-off-by: Jaroslav Kysela
Link: https://lore.kernel.org/r/20220913070216.3233974-1-perex@perex.cz
Signed-off-by: Takashi Iwai
Signed-off-by: Sasha Levin
commit 7480deff597a5b959ced9587622596c3c3773aa2
Author: Oleksandr Mazur
Date: Thu Sep 8 16:14:46 2022 +0300
net: marvell: prestera: add support for for Aldrin2
[ Upstream commit 9124dbcc2dd6c51e81f97f63f7807118c4eb140a ]
Aldrin2 (98DX8525) is a Marvell Prestera PP, with 100G support.
Signed-off-by: Oleksandr Mazur
V2:
- retarget to net tree instead of net-next;
- fix missed colon in patch subject ('net marvell' vs 'net: mavell');
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit be248292a4836a5f110d422ccdbae9f04cb5574b
Author: Haimin Zhang
Date: Thu Sep 8 20:19:27 2022 +0800
net/ieee802154: fix uninit value bug in dgram\_sendmsg
[ Upstream commit 94160108a70c8af17fa1484a37e05181c0e094af ]
There is uninit value bug in dgram\_sendmsg function in
net/ieee802154/socket.c when the length of valid data pointed by the
msg->msg\_name isn't verified.
We introducing a helper function ieee802154\_sockaddr\_check\_size to
check namelen. First we check there is addr\_type in ieee802154\_addr\_sa.
Then, we check namelen according to addr\_type.
Also fixed in raw\_bind, dgram\_bind, dgram\_connect.
Signed-off-by: Haimin Zhang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit ce57f7b2e61404e28453cd75afa2a013c263c34f
Author: Letu Ren
Date: Fri Nov 12 20:06:41 2021 +0800
scsi: qedf: Fix a UAF bug in \_\_qedf\_probe()
[ Upstream commit fbfe96869b782364caebae0445763969ddb6ea67 ]
In \_\_qedf\_probe(), if qedf->cdev is NULL which means
qed\_ops->common->probe() failed, then the program will goto label err1, and
scsi\_host\_put() will free lport->host pointer. Because the memory qedf
points to is allocated by libfc\_host\_alloc(), it will be freed by
scsi\_host\_put(). However, the if statement below label err0 only checks
whether qedf is NULL but doesn't check whether the memory has been freed.
So a UAF bug can occur.
There are two ways to reach the statements below err0. The first one is
described as before, "qedf" should be set to NULL. The second one is goto
"err0" directly. In the latter scenario qedf hasn't been changed and it has
the initial value NULL. As a result the if statement is not reachable in
any situation.
The KASAN logs are as follows:
[ 2.312969] BUG: KASAN: use-after-free in \_\_qedf\_probe+0x5dcf/0x6bc0
[ 2.312969]
[ 2.312969] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.12.0-59-gc9ba5276e321-prebuilt.qemu.org 04/01/2014
[ 2.312969] Call Trace:
[ 2.312969] dump\_stack\_lvl+0x59/0x7b
[ 2.312969] print\_address\_description+0x7c/0x3b0
[ 2.312969] ? \_\_qedf\_probe+0x5dcf/0x6bc0
[ 2.312969] \_\_kasan\_report+0x160/0x1c0
[ 2.312969] ? \_\_qedf\_probe+0x5dcf/0x6bc0
[ 2.312969] kasan\_report+0x4b/0x70
[ 2.312969] ? kobject\_put+0x25d/0x290
[ 2.312969] kasan\_check\_range+0x2ca/0x310
[ 2.312969] \_\_qedf\_probe+0x5dcf/0x6bc0
[ 2.312969] ? selinux\_kernfs\_init\_security+0xdc/0x5f0
[ 2.312969] ? trace\_rpm\_return\_int\_rcuidle+0x18/0x120
[ 2.312969] ? rpm\_resume+0xa5c/0x16e0
[ 2.312969] ? qedf\_get\_generic\_tlv\_data+0x160/0x160
[ 2.312969] local\_pci\_probe+0x13c/0x1f0
[ 2.312969] pci\_device\_probe+0x37e/0x6c0
Link: https://lore.kernel.org/r/20211112120641.16073-1-fantasquex@gmail.com
Reported-by: Zheyu Ma
Acked-by: Saurav Kashyap
Co-developed-by: Wende Tan
Signed-off-by: Wende Tan
Signed-off-by: Letu Ren
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
commit 5f2f005094963accab7c01f66b439f969a050a45
Author: Yifan Zhang
Date: Tue Aug 30 23:18:47 2022 +0800
drm/amdgpu/mes: zero the sdma\_hqd\_mask of 2nd SDMA engine for SDMA 6.0.1
[ Upstream commit 0af4ed0c329ebb4cef95fda4fcdbfcdea0255442 ]
there is only one SDMA engine in SDMA 6.0.1, the sdma\_hqd\_mask has to be
zeroed for the 2nd engine, otherwise MES scheduler will consider 2nd
engine exists and map/unmap SDMA queues to the non-existent engine.
Signed-off-by: Yifan Zhang
Reviewed-by: Tim Huang
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit f8895cfb48b004c30470e757f2022d3416dd199d
Author: Sergei Antonov
Date: Wed Sep 7 20:53:41 2022 +0300
ARM: dts: fix Moxa SDIO 'compatible', remove 'sdhci' misnomer
[ Upstream commit 02181e68275d28cab3c3f755852770367f1bc229 ]
Driver moxart-mmc.c has .compatible = "moxa,moxart-mmc".
But moxart .dts/.dtsi and the documentation file moxa,moxart-dma.txt
contain compatible = "moxa,moxart-sdhci".
Change moxart .dts/.dtsi files and moxa,moxart-dma.txt to match the driver.
Replace 'sdhci' with 'mmc' in names too, since SDHCI is a different
controller from FTSDC010.
Suggested-by: Arnd Bergmann
Signed-off-by: Sergei Antonov
Cc: Jonas Jensen
Link: https://lore.kernel.org/r/20220907175341.1477383-1-saproj@gmail.com'
Signed-off-by: Arnd Bergmann
Signed-off-by: Sasha Levin
commit 7e834ee927a512fe0901f46f58622bef0d6e84bd
Author: Jason A. Donenfeld
Date: Mon Sep 5 19:22:46 2022 +0200
wifi: iwlwifi: don't spam logs with NSS>2 messages
[ Upstream commit 4d8421f2dd88583cc7a4d6c2a5532c35e816a52a ]
I get a log line like this every 4 seconds when connected to my AP:
[15650.221468] iwlwifi 0000:09:00.0: Got NSS = 4 - trimming to 2
Looking at the code, this seems to be related to a hardware limitation,
and there's nothing to be done. In an effort to keep my dmesg
manageable, downgrade this error to "debug" rather than "info".
Cc: Johannes Berg
Signed-off-by: Jason A. Donenfeld
Signed-off-by: Kalle Valo
Link: https://lore.kernel.org/r/20220905172246.105383-1-Jason@zx2c4.com
Signed-off-by: Sasha Levin
commit 229769759ef817596cf295b38fa2e04e7a62c719
Author: Swati Agarwal
Date: Wed Aug 17 11:41:25 2022 +0530
dmaengine: xilinx\_dma: Report error in case of dma\_set\_mask\_and\_coherent API failure
[ Upstream commit 8f2b6bc79c32f0fa60df000ae387a790ec80eae9 ]
The driver does not handle the failure case while calling
dma\_set\_mask\_and\_coherent API.
In case of failure, capture the return value of API and then report an
error.
Addresses-coverity: Unchecked return value (CHECKED\_RETURN)
Signed-off-by: Swati Agarwal
Reviewed-by: Radhey Shyam Pandey
Link: https://lore.kernel.org/r/20220817061125.4720-4-swati.agarwal@xilinx.com
Signed-off-by: Vinod Koul
Signed-off-by: Sasha Levin
commit e38f675825679c7e09bf31fcbddcbe9d95a7b294
Author: Swati Agarwal
Date: Wed Aug 17 11:41:24 2022 +0530
dmaengine: xilinx\_dma: cleanup for fetching xlnx,num-fstores property
[ Upstream commit 462bce790e6a7e68620a4ce260cc38f7ed0255d5 ]
Free the allocated resources for missing xlnx,num-fstores property.
Signed-off-by: Swati Agarwal
Link: https://lore.kernel.org/r/20220817061125.4720-3-swati.agarwal@xilinx.com
Signed-off-by: Vinod Koul
Signed-off-by: Sasha Levin
commit 92f8963831f164573f7fb1265ebee9478c99cf68
Author: Swati Agarwal
Date: Wed Aug 17 11:41:23 2022 +0530
dmaengine: xilinx\_dma: Fix devm\_platform\_ioremap\_resource error handling
[ Upstream commit 91df7751eb890e970afc08f50b8f0fa5ea39e03d ]
Add missing cleanup in devm\_platform\_ioremap\_resource().
When probe fails remove dma channel resources and disable clocks in
accordance with the order of resources allocated .
Signed-off-by: Swati Agarwal
Link: https://lore.kernel.org/r/20220817061125.4720-2-swati.agarwal@xilinx.com
Signed-off-by: Vinod Koul
Signed-off-by: Sasha Levin
commit 666f5be3593c5795a1bbaeaa6cf0037ae1a23eb2
Author: Frank Wunderlich
Date: Sun Aug 21 14:19:29 2022 +0200
arm64: dts: rockchip: fix upper usb port on BPI-R2-Pro
[ Upstream commit 388f9f0a7ff84b7890a24499a3a1fea0cad21373 ]
- extcon is no more needed in 5.19 - so drop it
commit 51a9b2c03dd3 ("phy: rockchip-inno-usb2: Handle ID IRQ")
- dr\_mode was changed from host to otg in rk356x.dtsi
commit bc405bb3eeee ("arm64: dts: rockchip: enable otg/drd
operation of usb\_host0\_xhci in rk356x")
change it back on board level as id-pin on r2pro is not connected
Signed-off-by: Frank Wunderlich
Link: https://lore.kernel.org/r/20220821121929.244112-1-linux@fw-web.de
Signed-off-by: Heiko Stuebner
Signed-off-by: Sasha Levin
commit edc5c66d15f96617e2deeb194eb73f13732a3443
Author: Cristian Marussi
Date: Wed Aug 17 18:27:31 2022 +0100
firmware: arm\_scmi: Add SCMI PM driver remove routine
[ Upstream commit dea796fcab0a219830831c070b8dc367d7e0f708 ]
Currently, when removing the SCMI PM driver not all the resources
registered with genpd subsystem are properly de-registered.
As a side effect of this after a driver unload/load cycle you get a
splat with a few warnings like this:
| debugfs: Directory 'BIG\_CPU0' with parent 'pm\_genpd' already present!
| debugfs: Directory 'BIG\_CPU1' with parent 'pm\_genpd' already present!
| debugfs: Directory 'LITTLE\_CPU0' with parent 'pm\_genpd' already present!
| debugfs: Directory 'LITTLE\_CPU1' with parent 'pm\_genpd' already present!
| debugfs: Directory 'LITTLE\_CPU2' with parent 'pm\_genpd' already present!
| debugfs: Directory 'LITTLE\_CPU3' with parent 'pm\_genpd' already present!
| debugfs: Directory 'BIG\_SSTOP' with parent 'pm\_genpd' already present!
| debugfs: Directory 'LITTLE\_SSTOP' with parent 'pm\_genpd' already present!
| debugfs: Directory 'DBGSYS' with parent 'pm\_genpd' already present!
| debugfs: Directory 'GPUTOP' with parent 'pm\_genpd' already present!
Add a proper scmi\_pm\_domain\_remove callback to the driver in order to
take care of all the needed cleanups not handled by devres framework.
Link: https://lore.kernel.org/r/20220817172731.1185305-7-cristian.marussi@arm.com
Signed-off-by: Cristian Marussi
Signed-off-by: Sudeep Holla
Signed-off-by: Sasha Levin
commit 8e880f30946fd4d8a864defeeada8a9a5b48848a
Author: Cristian Marussi
Date: Wed Aug 17 18:27:28 2022 +0100
firmware: arm\_scmi: Harden accesses to the sensor domains
[ Upstream commit 76f89c954788763db575fb512a40bd483864f1e9 ]
Accessing sensor domains descriptors by the index upon the SCMI drivers
requests through the SCMI sensor operations interface can potentially
lead to out-of-bound violations if the SCMI driver misbehave.
Add an internal consistency check before any such domains descriptors
accesses.
Link: https://lore.kernel.org/r/20220817172731.1185305-4-cristian.marussi@arm.com
Signed-off-by: Cristian Marussi
Signed-off-by: Sudeep Holla
Signed-off-by: Sasha Levin
commit 41bf1b0ad95395ec6d5172fb58540323788d9397
Author: Cristian Marussi
Date: Wed Aug 17 18:27:27 2022 +0100
firmware: arm\_scmi: Improve checks in the info\_get operations
[ Upstream commit 1ecb7d27b1af6705e9a4e94415b4d8cc8cf2fbfb ]
SCMI protocols abstract and expose a number of protocol specific
resources like clocks, sensors and so on. Information about such
specific domain resources are generally exposed via an `info\_get`
protocol operation.
Improve the sanity check on these operations where needed.
Link: https://lore.kernel.org/r/20220817172731.1185305-3-cristian.marussi@arm.com
Signed-off-by: Cristian Marussi
Signed-off-by: Sudeep Holla
Signed-off-by: Sasha Levin
commit 81de80330fa6907aec32eb54c5619059e6e36452
Author: Dongliang Mu
Date: Tue Aug 16 12:08:58 2022 +0800
fs: fix UAF/GPF bug in nilfs\_mdt\_destroy
commit 2e488f13755ffbb60f307e991b27024716a33b29 upstream.
In alloc\_inode, inode\_init\_always() could return -ENOMEM if
security\_inode\_alloc() fails, which causes inode->i\_private
uninitialized. Then nilfs\_is\_metadata\_file\_inode() returns
true and nilfs\_free\_inode() wrongly calls nilfs\_mdt\_destroy(),
which frees the uninitialized inode->i\_private
and leads to crashes(e.g., UAF/GPF).
Fix this by moving security\_inode\_alloc just prior to
this\_cpu\_inc(nr\_inodes)
Link: https://lkml.kernel.org/r/CAFcO6XOcf1Jj2SeGt=jJV59wmhESeSKpfR0omdFRq+J9nD1vfQ@mail.gmail.com
Reported-by: butt3rflyh4ck
Reported-by: Hao Sun
Reported-by: Jiacheng Xu
Reviewed-by: Christian Brauner (Microsoft)
Signed-off-by: Dongliang Mu
Cc: Al Viro
Cc: stable@vger.kernel.org
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 8529dfb5ef724a2edb1c1b3567688376b3db441d
Author: Jalal Mostafa
Date: Wed Sep 21 13:57:01 2022 +0000
xsk: Inherit need\_wakeup flag for shared sockets
commit 60240bc26114543fcbfcd8a28466e67e77b20388 upstream.
The flag for need\_wakeup is not set for xsks with `XDP\_SHARED\_UMEM`
flag and of different queue ids and/or devices. They should inherit
the flag from the first socket buffer pool since no flags can be
specified once `XDP\_SHARED\_UMEM` is specified.
Fixes: b5aea28dca134 ("xsk: Add shared umem support between queue ids")
Signed-off-by: Jalal Mostafa
Signed-off-by: Daniel Borkmann
Acked-by: Magnus Karlsson
Link: https://lore.kernel.org/bpf/20220921135701.10199-1-jalal.a.mostapha@gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 7ebe331054cfb8ad97c8542e46d10a3887be1e01
Author: Shuah Khan
Date: Thu Sep 1 15:23:19 2022 -0600
docs: update mediator information in CoC docs
commit 8bfdfa0d6b929ede7b6189e0e546ceb6a124d05d upstream.
Update mediator information in the CoC interpretation document.
Signed-off-by: Shuah Khan
Link: https://lore.kernel.org/r/20220901212319.56644-1-skhan@linuxfoundation.org
Cc: stable@vger.kernel.org
Signed-off-by: Jonathan Corbet
Signed-off-by: Greg Kroah-Hartman
commit 3b760c94de19c8296a6aa861845b348f14f335f7
Author: Kees Cook
Date: Thu Sep 29 22:57:43 2022 -0700
hardening: Remove Clang's enable flag for -ftrivial-auto-var-init=zero
commit 607e57c6c62c00965ae276902c166834ce73014a upstream.
Now that Clang's -enable-trivial-auto-var-init-zero-knowing-it-will-be-removed-from-clang
option is no longer required, remove it from the command line. Clang 16
and later will warn when it is used, which will cause Kconfig to think
it can't use -ftrivial-auto-var-init=zero at all. Check for whether it
is required and only use it when so.
Cc: Nathan Chancellor
Cc: Masahiro Yamada
Cc: Nick Desaulniers
Cc: linux-kbuild@vger.kernel.org
Cc: llvm@lists.linux.dev
Cc: stable@vger.kernel.org
Fixes: f02003c860d9 ("hardening: Avoid harmless Clang option under CONFIG\_INIT\_STACK\_ALL\_ZERO")
Signed-off-by: Kees Cook
Signed-off-by: Greg Kroah-Hartman
commit 19a4cb1c4eb8f15a72700a20f778c52028e687b7
Author: Sami Tolvanen
Date: Fri Sep 30 20:33:10 2022 +0000
Makefile.extrawarn: Move -Wcast-function-type-strict to W=1
commit 2120635108b35ecad9c59c8b44f6cbdf4f98214e upstream.
We enable -Wcast-function-type globally in the kernel to warn about
mismatching types in function pointer casts. Compilers currently
warn only about ABI incompability with this flag, but Clang 16 will
enable a stricter version of the check by default that checks for an
exact type match. This will be very noisy in the kernel, so disable
-Wcast-function-type-strict without W=1 until the new warnings have
been addressed.
Cc: stable@vger.kernel.org
Link: https://reviews.llvm.org/D134831
Link: https://github.com/ClangBuiltLinux/linux/issues/1724
Suggested-by: Nathan Chancellor
Signed-off-by: Sami Tolvanen
Signed-off-by: Kees Cook
Link: https://lore.kernel.org/r/20220930203310.4010564-1-samitolvanen@google.com
Signed-off-by: Greg Kroah-Hartman
commit 8dc610c9478ccb0094d70663b345e46c16dbd5e7
Author: Bart Van Assche
Date: Tue Aug 30 13:58:42 2022 -0700
sparc: Unbreak the build
commit 17006e86a7641fa3c50324cfb602f0e74dac8527 upstream.
Fix the following build errors:
arch/sparc/mm/srmmu.c: In function ‘smp\_flush\_page\_for\_dma’:
arch/sparc/mm/srmmu.c:1639:13: error: cast between incompatible function types from ‘void (\*)(long unsigned int)’ to ‘void (\*)(long unsigned int, long unsigned int, long unsigned int, long unsigned int, long unsigned int)’ [-Werror=cast-function-type]
1639 | xc1((smpfunc\_t) local\_ops->page\_for\_dma, page);
| ^
arch/sparc/mm/srmmu.c: In function ‘smp\_flush\_cache\_mm’:
arch/sparc/mm/srmmu.c:1662:29: error: cast between incompatible function types from ‘void (\*)(struct mm\_struct \*)’ to ‘void (\*)(long unsigned int, long unsigned int, long unsigned int, long unsigned int, long unsigned int)’ [-Werror=cast-function-type]
1662 | xc1((smpfunc\_t) local\_ops->cache\_mm, (unsigned long) mm);
|
[ ... ]
Compile-tested only.
Fixes: 552a23a0e5d0 ("Makefile: Enable -Wcast-function-type")
Cc: stable@vger.kernel.org
Signed-off-by: Bart Van Assche
Tested-by: Andreas Larsson
Signed-off-by: Kees Cook
Link: https://lore.kernel.org/r/20220830205854.1918026-1-bvanassche@acm.org
Signed-off-by: Greg Kroah-Hartman

