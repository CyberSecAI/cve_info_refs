=== Content from github.com_6f15a64d_20250115_102308.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fecjia%2Fecjia-daojia%2Fblob%2Fdfb322387e8d3d50719e44d23d793072616ff789%2Fcontent%2Fapps%2Finstaller%2Fclasses%2FControllers%2FIndexController.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fecjia%2Fecjia-daojia%2Fblob%2Fdfb322387e8d3d50719e44d23d793072616ff789%2Fcontent%2Fapps%2Finstaller%2Fclasses%2FControllers%2FIndexController.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ecjia%2Fecjia-daojia)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ecjia](/ecjia)
/
**[ecjia-daojia](/ecjia/ecjia-daojia)**
Public

* [Notifications](/login?return_to=%2Fecjia%2Fecjia-daojia) You must be signed in to change notification settings
* [Fork
  258](/login?return_to=%2Fecjia%2Fecjia-daojia)
* [Star
   571](/login?return_to=%2Fecjia%2Fecjia-daojia)

* [Code](/ecjia/ecjia-daojia)
* [Issues
  1](/ecjia/ecjia-daojia/issues)
* [Pull requests
  0](/ecjia/ecjia-daojia/pulls)
* [Actions](/ecjia/ecjia-daojia/actions)
* [Projects
  0](/ecjia/ecjia-daojia/projects)
* [Wiki](/ecjia/ecjia-daojia/wiki)
* [Security](/ecjia/ecjia-daojia/security)
* [Insights](/ecjia/ecjia-daojia/pulse)

Additional navigation options

* [Code](/ecjia/ecjia-daojia)
* [Issues](/ecjia/ecjia-daojia/issues)
* [Pull requests](/ecjia/ecjia-daojia/pulls)
* [Actions](/ecjia/ecjia-daojia/actions)
* [Projects](/ecjia/ecjia-daojia/projects)
* [Wiki](/ecjia/ecjia-daojia/wiki)
* [Security](/ecjia/ecjia-daojia/security)
* [Insights](/ecjia/ecjia-daojia/pulse)

## Files

 dfb3223
## Breadcrumbs

1. [ecjia-daojia](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789)
2. /[content](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content)
3. /[apps](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps)
4. /[installer](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer)
5. /[classes](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes)
6. /[Controllers](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes/Controllers)
/
# IndexController.php

Copy path Blame  Blame
## Latest commit

## History

[History](/ecjia/ecjia-daojia/commits/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes/Controllers/IndexController.php)710 lines (593 loc) · 28.2 KB dfb3223
## Breadcrumbs

1. [ecjia-daojia](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789)
2. /[content](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content)
3. /[apps](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps)
4. /[installer](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer)
5. /[classes](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes)
6. /[Controllers](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes/Controllers)
/
# IndexController.php

Top
## File metadata and controls

* Code
* Blame

710 lines (593 loc) · 28.2 KB[Raw](https://github.com/ecjia/ecjia-daojia/raw/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes/Controllers/IndexController.php)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710<?php//// \_\_\_\_\_\_ \_\_\_\_\_\_ \_\_ \_\_ \_\_\_\_\_\_// /\ \_\_\_\ /\ \_\_\_\ /\\_\ /\\_\ /\ \_\_ \// \/\ \_\_\ \/\ \\_\_\_\_ \/\\_\ \/\\_\ \/\ \\_\ \// \/\\_\_\_\_\_\ \/\\_\_\_\_\_\ /\\_\/\\_\ \/\\_\ \/\\_\ \\_\// \/\_\_\_\_\_/ \/\_\_\_\_\_/ \/\_\_\/\_/ \/\_/ \/\_/ /\_///// 上海商创网络科技有限公司//// ---------------------------------------------------------------------------------//// 一、协议的许可和权利//// 1. 您可以在完全遵守本协议的基础上，将本软件应用于商业用途；// 2. 您可以在协议规定的约束和限制范围内修改本产品源代码或界面风格以适应您的要求；// 3. 您拥有使用本产品中的全部内容资料、商品信息及其他信息的所有权，并独立承担与其内容相关的// 法律义务；// 4. 获得商业授权之后，您可以将本软件应用于商业用途，自授权时刻起，在技术支持期限内拥有通过// 指定的方式获得指定范围内的技术支持服务；//// 二、协议的约束和限制//// 1. 未获商业授权之前，禁止将本软件用于商业用途（包括但不限于企业法人经营的产品、经营性产品// 以及以盈利为目的或实现盈利产品）；// 2. 未获商业授权之前，禁止在本产品的整体或在任何部分基础上发展任何派生版本、修改版本或第三// 方版本用于重新开发；// 3. 如果您未能遵守本协议的条款，您的授权将被终止，所被许可的权利将被收回并承担相应法律责任；//// 三、有限担保和免责声明//// 1. 本软件及所附带的文件是作为不提供任何明确的或隐含的赔偿或担保的形式提供的；// 2. 用户出于自愿而使用本软件，您必须了解使用本软件的风险，在尚未获得商业授权之前，我们不承// 诺提供任何形式的技术支持、使用担保，也不承担任何因使用本软件而产生问题的相关责任；// 3. 上海商创网络科技有限公司不对使用本产品构建的商城中的内容信息承担责任，但在不侵犯用户隐// 私信息的前提下，保留以任何方式获取用户信息及商品信息的权利；//// 有关本产品最终用户授权协议、商业授权与技术服务的详细内容，均由上海商创网络科技有限公司独家// 提供。上海商创网络科技有限公司拥有在不事先通知的情况下，修改授权协议的权力，修改后的协议对// 改变之日起的新授权用户生效。电子文本形式的授权协议如同双方书面签署的协议一样，具有完全的和// 等同的法律效力。您一旦开始修改、安装或使用本产品，即被视为完全理解并接受本协议的各项条款，// 在享有上述条款授予的权力的同时，受到相关的约束和限制。协议许可范围以外的行为，将直接违反本// 授权协议并构成侵权，我们有权随时终止授权，责令停止损害，并保留追究相关责任的权力。//// ---------------------------------------------------------------------------------//
namespace Ecjia\App\Installer\Controllers;
use Ecjia\System\BaseController\SimpleController;use RC\_App;use RC\_Uri;use RC\_Config;use RC\_Cache;use Ecjia\App\Installer\Helper;use ecjia;use RC\_Script;use RC\_Style;
class IndexController extends SimpleController{
 private $\_\_FILE\_\_;
 public function \_\_construct() {
 $this->\_\_FILE\_\_ = dirname(dirname(\_\_FILE\_\_));
 parent::\_\_construct();
 //安装脚本不限制超时时间 set\_time\_limit(0); define('DATA\_PATH', dirname($this->\_\_FILE\_\_).'/data/');
 /\* js与css加载路径\*/ $this->assign('front\_url', RC\_App::apps\_url('statics/front', $this->\_\_FILE\_\_)); $this->assign('system\_statics\_url', RC\_Uri::admin\_url('statics')); $this->assign('logo\_pic', RC\_App::apps\_url('statics/front/images/logo\_pic.png', $this->\_\_FILE\_\_));
 $this->assign('version', RC\_Config::get('release.version')); $this->assign('build', RC\_Config::get('release.build')); }
 protected function load\_default\_script\_style() { //自定义加载 RC\_Style::enqueue\_style('installer-normalize', RC\_App::apps\_url('statics/front/css/normalize.css', $this->\_\_FILE\_\_)); RC\_Style::enqueue\_style('installer-grid', RC\_App::apps\_url('statics/front/css/grid.css', $this->\_\_FILE\_\_)); RC\_Style::enqueue\_style('installer-style', RC\_App::apps\_url('statics/front/css/style.css', $this->\_\_FILE\_\_));  //系统加载样式 RC\_Style::enqueue\_style('ecjia-ui'); RC\_Style::enqueue\_style('install-bootstrap', RC\_App::apps\_url('statics/front/css/bootstrap.min.css', $this->\_\_FILE\_\_)); RC\_Style::enqueue\_style('bootstrap-responsive-nodeps'); RC\_Style::enqueue\_style('chosen'); RC\_Style::enqueue\_style('uniform-aristo'); RC\_Style::enqueue\_style('fontello');  //系统加载脚本 RC\_Script::enqueue\_script('ecjia-jquery-chosen'); RC\_Script::enqueue\_script('jquery-migrate'); RC\_Script::enqueue\_script('jquery-uniform'); RC\_Script::enqueue\_script('smoke'); RC\_Script::enqueue\_script('jquery-cookie');  RC\_Script::enqueue\_script('ecjia-installer', RC\_App::apps\_url('statics/front/js/install.js', $this->\_\_FILE\_\_), array('ecjia-front'), false, true); RC\_Script::localize\_script('ecjia-installer', 'js\_lang', config('app-installer::jslang.installer\_page')); }
 /\*\* \* 欢迎页面加载 \*/ public function init() { $this->check\_installed();
 $this->unset\_cookie(); setcookie('install\_step1', 1);
 $this->assign('ecjia\_step', 1);
 return $this->displayAppTemplate('installer', 'front/welcome.dwt'); }
 /\* \* 检查环境页面加载 \*/ public function detect() { $this->check\_installed(); $this->check\_step(2); setcookie('install\_step2', 1);
 $name = $\_SERVER['SCRIPT\_NAME']; $php\_path = '1'; if ($name != '/index.php') { $path\_name = substr($name, 0, -9); $this->assign('path\_error', sprintf(\_\_('抱歉，当前程序运行在 %s 目录下，ECJia到家程序必须运行在网站根目录下/，请您更换目录后再重新运行安装程序。','installer'), $path\_name)); $php\_path = '0'; }
 $ok = '<i class="fontello-icon-ok"></i>'; $cancel = '<i class="fontello-icon-cancel"></i>'; $info = '<i class="fontello-icon-info-circled"></i>';
 //操作系统 $os\_array = array('Linux', 'FreeBSD', 'WINNT', 'Darwin'); $sys\_info['os'] = PHP\_OS;
 $php\_os = '0'; if (in\_array($sys\_info['os'], $os\_array)) { $php\_os = '1'; } $sys\_info['os\_info'] = $php\_os == 1 ? $ok : $cancel;
 $sys\_info['ip'] = $\_SERVER['SERVER\_ADDR']; $sys\_info['web\_server'] = $\_SERVER['SERVER\_SOFTWARE'];
 //WEB服务器 if (stristr($sys\_info['web\_server'], 'nginx') || stristr($sys\_info['web\_server'], 'apache') || stristr($sys\_info['web\_server'], 'iis')) { $sys\_info['web\_server\_info'] = $ok; } else { $sys\_info['web\_server\_info'] = $info; } $domain = $\_SERVER['SERVER\_NAME'];
 $position = strpos($domain, ':'); //查找域名是否带端口号 if ($position !== false) { $domain = substr($domain, 0, $position); } $domain = strtolower($domain);
 $sys\_info['php\_dns'] = preg\_match("/^[0-9.]{7,15}$/", @gethostbyname($domain)) ? $ok : $cancel; $sys\_info['php\_ver'] = PHP\_VERSION;
 $sys\_info['safe\_mode'] = (boolean) ini\_get('safe\_mode') ? \_\_('是', 'installer') : \_\_('否', 'installer'); $sys\_info['safe\_mode\_gid'] = (boolean) ini\_get('safe\_mode\_gid') ? $ok : $cancel; $sys\_info['timezone'] = function\_exists("date\_default\_timezone\_get") ? date\_default\_timezone\_get() : \_\_('无需设置', 'installer');
 //MySQLi $php\_mysqli = '0'; if (extension\_loaded('mysqli')) $php\_mysqli = '1'; $sys\_info['mysqli'] = $php\_mysqli == 1 ? $ok : $cancel;
 //PDO pdo\_mysql $php\_pdo = '0'; if (extension\_loaded('PDO') && extension\_loaded('pdo\_mysql')) $php\_pdo = '1'; $sys\_info['pdo'] = $php\_pdo == 1 ? $ok : $cancel;
 //openssl $php\_openssl = '0'; if (extension\_loaded('openssl')) $php\_openssl = '1'; $sys\_info['openssl'] = $php\_openssl == 1 ? $ok : $cancel;
 //socket $php\_socket = '0'; if (function\_exists('fsockopen')) $php\_socket = '1'; $sys\_info['socket'] = $php\_socket == 1 ? $ok : $cancel;
 //GD $php\_gd = '0'; $gd\_info = $cancel; if (extension\_loaded('gd')) { $gd\_info = $ok; $gd\_info\_file = ''; if (function\_exists('imagepng')) $gd\_info\_file .= 'png'; if (function\_exists('imagejpeg')) $gd\_info\_file .= ' / jpg'; if (function\_exists('imagegif')) $gd\_info\_file .= ' / gif'; $gd\_info .= sprintf(\_\_("支持（%s）", 'installer'), $gd\_info\_file);
 $php\_gd = '1'; } $sys\_info['gd'] = $php\_gd == 1 ? $gd\_info : $cancel; $sys\_info['gd\_info'] = $php\_gd == 1 ? $ok : $cancel;
 //curl $php\_curl = '0'; if (extension\_loaded('curl')) $php\_curl = '1'; $sys\_info['curl'] = $php\_curl == 1 ? $ok : $cancel;
 //fileinfo $php\_fileinfo = '0'; if (extension\_loaded('fileinfo')) $php\_fileinfo = '1'; $sys\_info['fileinfo'] = $php\_fileinfo == 1 ? $ok : $cancel;
 //zlib $php\_zlib = '0'; if (function\_exists('gzclose')) $php\_zlib = '1'; $sys\_info['zlib'] = $php\_zlib == 1 ? $ok : $cancel;
 $sys\_info['php\_check'] = version\_compare(PHP\_VERSION, '5.5.9', '>=');
 //检测必须开启项是否开启 $sys\_info['is\_right'] = $php\_path && $php\_os && $sys\_info['php\_check'] && $php\_mysqli && $php\_pdo && $php\_openssl && $php\_socket && $php\_gd && $php\_curl && $php\_fileinfo && $php\_zlib ? 1 : 0;
// //目录检测// $Upload\_Current\_Path = str\_replace(SITE\_ROOT, '', RC\_Upload::upload\_path());// $Cache\_Current\_Path = str\_replace(SITE\_ROOT, '', SITE\_CACHE\_PATH);//// $dir['/'] = '';// $dir['content/configs'] = str\_replace(SITE\_ROOT, '', SITE\_CONTENT\_PATH) . 'configs';// $dir['content/uploads'] = $Upload\_Current\_Path;// $dir['content/storages'] = $Cache\_Current\_Path;//// $list = array();////// /\* 检查目录 \*/// foreach ($dir AS $key => $val) {// $mark = RC\_File::file\_mode\_info(SITE\_ROOT . $val);// if ($mark&4 <= 0) {// $sys\_info['is\_right'] = 0;// }// if ($mark&8 < 1) {//// }// $list[] = array('item' => $key . \_\_('目录'), 'r' => $mark&1, 'w' => $mark&2, 'm' => $mark&4);// }
 $dirPermission = Helper::getCheckDirPermission();
 collect($dirPermission)->each(function ($item) use (& $sys\_info) { if ($item['m'] <= 0) { $sys\_info['is\_right'] = 0; return false; } });
 //检测模板目录是否具有修改权限 if ($dirPermission['content/themes']['mark'] & 8 < 1) { $has\_unwritable\_tpl = 'yes'; } else { $has\_unwritable\_tpl = 'no'; }
 $this->assign('list', $dirPermission); $this->assign('has\_unwritable\_tpl', $has\_unwritable\_tpl);
 if ($sys\_info['is\_right'] == 1) { setcookie('install\_config', 1); } elseif ($sys\_info['is\_right'] == 0) { setcookie('install\_config', 0); }
 /\* 允许上传的最大文件大小 \*/ $sys\_info['max\_filesize'] = ini\_get('upload\_max\_filesize'); $filesize = '0'; if($sys\_info['max\_filesize'] >= 2){ $filesize = '1'; } $sys\_info['filesize'] = $filesize == 1 ? $ok : $cancel; $this->assign('ecjia\_version', VERSION); $this->assign('ecjia\_release', RELEASE); $this->assign('sys\_info', $sys\_info);
 $this->assign('ecjia\_step', 2);
 return $this->displayAppTemplate('installer', 'front/detect.dwt'); }
 /\*\* \* 配置项目包信息页面加载 \*/ public function deploy() { $this->check\_installed(); $this->check\_step(3); setcookie('install\_step3', 1);
 $installer\_lang = 'zh\_cn'; $prefix = 'ecjia\_'; $show\_timezone = 'yes'; $timezones = Helper::getTimezones($installer\_lang);
 $this->assign('timezones', $timezones); $this->assign('show\_timezone', $show\_timezone); $this->assign('local\_timezone', Helper::getLocalTimezone()); $this->assign('correct\_img', RC\_App::apps\_url('statics/front/images/correct.png', $this->\_\_FILE\_\_)); $this->assign('error\_img', RC\_App::apps\_url('statics/front/images/error.png', $this->\_\_FILE\_\_));
 $this->assign('ecjia\_step', 3);
 return $this->displayAppTemplate('installer', 'front/deploy.dwt'); }
 /\*\* \* 完成页面 \*/ public function finish() { $result = $this->check\_step(4); if (!$result) { $this->check\_installed(); //安装完成后的一些善后处理 Helper::updateInstallDate(); Helper::updateEcjiaVersion(); Helper::updateHashCode(); Helper::updateDemoApiUrl(); Helper::createStorageDirectory(); Helper::saveInstallLock();
 $admin\_name = RC\_Cache::app\_cache\_get('admin\_name', 'install'); $admin\_password = RC\_Cache::app\_cache\_get('admin\_password', 'install');
 $index\_url = RC\_Uri::home\_url(); $h5\_url = RC\_Uri::home\_url().'/sites/m/'; $admin\_url = RC\_Uri::home\_url().'/sites/admincp/'; $merchant\_url = RC\_Uri::home\_url().'/sites/merchant/';
 $this->assign('index\_url', $index\_url); $this->assign('h5\_url', $h5\_url); $this->assign('admin\_url', $admin\_url); $this->assign('merchant\_url', $merchant\_url); $this->assign('admin\_name', $admin\_name); $this->assign('admin\_password', $admin\_password);
 $finish\_message = \_\_('恭喜您，安装成功!', 'installer'); $this->assign('finish\_message', $finish\_message);
 $this->assign('ecjia\_step', 5);
 return $this->displayAppTemplate('installer', 'front/finish.dwt'); } else { //@todo else没有判断 } }
 /\*\* \* 已经安装过的提示页 \*/ public function installed() { $this->unset\_cookie();
 $finish\_message = \_\_('安装程序已经被锁定。', 'installer'); $locked\_message = sprintf(\_\_('如果您确定要重新安装ECJia到家，请删除%s目录下的%s。', 'installer'), 'content/storages/data', 'install.lock'); $this->assign('finish\_message', $finish\_message); $this->assign('locked\_message', $locked\_message);
 $index\_url = RC\_Uri::home\_url(); $h5\_url = RC\_Uri::home\_url().'/sites/m/'; $admin\_url = RC\_Uri::home\_url().'/sites/admincp/'; $merchant\_url = RC\_Uri::home\_url().'/sites/merchant/';
 $this->assign('index\_url', $index\_url); $this->assign('h5\_url', $h5\_url); $this->assign('admin\_url', $admin\_url); $this->assign('merchant\_url', $merchant\_url);
 if (! Helper::checkInstallLock()) { return $this->redirect(RC\_Uri::url('installer/index/init')); }
 $this->assign('ecjia\_step', 5);
 return $this->displayAppTemplate('installer', 'front/finish.dwt'); }
 /\*\* \* 检查数据库密码是否正确 \* \* return string \*/ public function check\_db\_correct() { $this->check\_installed();
 $db\_host = isset($\_POST['db\_host']) ? trim($\_POST['db\_host']) : ''; $db\_port = isset($\_POST['db\_port']) ? trim($\_POST['db\_port']) : ''; $db\_user = isset($\_POST['db\_user']) ? trim($\_POST['db\_user']) : ''; $db\_pass = isset($\_POST['db\_pass']) ? trim($\_POST['db\_pass']) : '';
 $databases = Helper::getDataBases($db\_host, $db\_port, $db\_user, $db\_pass); if (is\_ecjia\_error($databases)) { return $this->showmessage(\_\_('连接数据库失败，请检查您输入的数据库帐号是否正确。', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); } $check\_version = Helper::getMysqlVersion($db\_host, $db\_port, $db\_user, $db\_pass); if (is\_ecjia\_error($check\_version)) { return $this->showmessage(\_\_('连接数据库失败，请检查您输入的数据库帐号是否正确。', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); }
 if (version\_compare($check\_version, '5.5', '<')) { return $this->showmessage(\_\_('MySQL数据库版本过低，请使用5.5以上版本。', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); }
 $check\_result = Helper::checkMysqlSupport($db\_host, $db\_port, $db\_user, $db\_pass); if (is\_ecjia\_error($check\_result)) { return $this->showmessage(\_\_('连接数据库失败，请检查您输入的数据库帐号是否正确。', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); }
 foreach ($check\_result as $k => $v) { if ($v['Variable\_name'] == 'have\_innodb' && $v['Value'] != 'YES') { return $this->showmessage(\_\_('当前MySQL数据库不支持InnoDB引擎，请检查后再进行安装。', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); } } return $this->showmessage('', ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_SUCCESS); }
 /\*\* \* 获取数据库列表 \*/ public function check\_db\_exists() { $this->check\_installed();
 $db\_host = isset($\_POST['db\_host']) ? trim($\_POST['db\_host']) : ''; $db\_port = isset($\_POST['db\_port']) ? trim($\_POST['db\_port']) : ''; $db\_user = isset($\_POST['db\_user']) ? trim($\_POST['db\_user']) : ''; $db\_pass = isset($\_POST['db\_pass']) ? trim($\_POST['db\_pass']) : ''; $db\_database = isset($\_POST['dbdatabase']) ? trim($\_POST['dbdatabase']) : '';
 $databases = Helper::getDataBases($db\_host, $db\_port, $db\_user, $db\_pass); if (is\_ecjia\_error($databases)) { return $this->showmessage(\_\_('连接数据库失败，请检查您输入的数据库帐号是否正确。', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); } else { if ($databases->contains($db\_database)) { return $this->showmessage('', ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_SUCCESS, array('is\_exist' => true)); } else { return $this->showmessage('', ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_SUCCESS, array('is\_exist' => false)); } } }
 /\*\* \* 创建配置文件 \*/ public function create\_config\_file() { $this->check\_installed();
 $db\_host = isset($\_POST['db\_host']) ? trim($\_POST['db\_host']) : ''; $db\_port = isset($\_POST['db\_port']) ? trim($\_POST['db\_port']) : ''; $db\_name = isset($\_POST['db\_name']) ? trim($\_POST['db\_name']) : ''; $db\_user = isset($\_POST['db\_user']) ? trim($\_POST['db\_user']) : ''; $db\_pass = isset($\_POST['db\_pass']) ? trim($\_POST['db\_pass']) : ''; $prefix = isset($\_POST['db\_prefix']) ? trim($\_POST['db\_prefix']) : ''; $timezone = isset($\_POST['timezone']) ? trim($\_POST['timezone']) : 'Asia/Shanghai'; $auth\_key = Helper::getAuthKey();
 $data = array( 'DB\_HOST' => $db\_host, 'DB\_PORT' => $db\_port, 'DB\_DATABASE' => $db\_name, 'DB\_USERNAME' => $db\_user, 'DB\_PASSWORD' => $db\_pass, 'DB\_PREFIX' => $prefix, 'TIMEZONE' => $timezone, 'AUTH\_KEY' => $auth\_key, );
 Helper::createEnv(); $result = Helper::modifyEnv($data);
 if (is\_ecjia\_error($result)) { return $this->showmessage($result->get\_error\_message(), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); } else { $percent = $this->get\_percent('create\_config\_file'); return $this->showmessage('', ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_SUCCESS, array('percent' => $percent)); } }
 /\*\* \* 创建数据库 \*/ public function create\_database() { $this->check\_installed();
 $db\_host = isset($\_POST['db\_host']) ? trim($\_POST['db\_host']) : ''; $db\_port = isset($\_POST['db\_port']) ? trim($\_POST['db\_port']) : ''; $db\_user = isset($\_POST['db\_user']) ? trim($\_POST['db\_user']) : ''; $db\_pass = isset($\_POST['db\_pass']) ? trim($\_POST['db\_pass']) : ''; $db\_name = isset($\_POST['db\_name']) ? trim($\_POST['db\_name']) : '';
 $result = Helper::createDatabase($db\_host, $db\_port, $db\_user, $db\_pass, $db\_name); if (is\_ecjia\_error($result)) { return $this->showmessage($result->get\_error\_message(), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); } else { $percent = $this->get\_percent('create\_database'); return $this->showmessage('', ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_SUCCESS, array('percent' => $percent)); } }
 /\*\* \* 安装数据库结构 \*/ public function install\_structure() { $this->check\_installed();
 $limit = 20;
 $result = Helper::installStructure($limit);
 if (is\_ecjia\_error($result)) { return $this->showmessage($result->get\_error\_message(), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); }
 //还剩余多少个脚本未执行 $over = Helper::getWillMigrationFilesCount();
 if (is\_ecjia\_error($over)) { return $this->showmessage($over->get\_error\_message(), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); } $more = 0; if ($over > 0 ) { $more = $over; }
 $percent = $this->get\_percent('install\_structure'); return $this->showmessage('', ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_SUCCESS, array('percent' => $percent, 'more' => $more)); }
 /\*\* \* 安装基本数据 \*/ public function install\_base\_data() { $this->check\_installed();
 $result = Helper::installBaseData();
 if (is\_ecjia\_error($result)) { return $this->showmessage($result->get\_error\_message(), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); } else { $percent = $this->get\_percent('install\_base\_data'); return $this->showmessage('', ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_SUCCESS, array('percent' => $percent)); } }
 /\*\* \* 安装演示数据 \*/ public function install\_demo\_data() { $this->check\_installed();
 $result = Helper::installDemoData();
 if (is\_ecjia\_error($result)) { return $this->showmessage($result->get\_error\_message(), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); } else { $percent = $this->get\_percent('install\_demo\_data'); return $this->showmessage('', ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_SUCCESS, array('percent' => $percent)); } }
 /\*\* \* 创建管理员 \*/ public function create\_admin\_passport() { $this->check\_installed();  $admin\_name = isset($\_POST['admin\_name']) ? trim($\_POST['admin\_name']) : ''; $admin\_password = isset($\_POST['admin\_password']) ? trim($\_POST['admin\_password']) : ''; $admin\_password2 = isset($\_POST['admin\_password2']) ? trim($\_POST['admin\_password2']) : ''; $admin\_email = isset($\_POST['admin\_email']) ? trim($\_POST['admin\_email']) : '';
 RC\_Cache::app\_cache\_set('admin\_name', $admin\_name, 'install'); RC\_Cache::app\_cache\_set('admin\_password', $admin\_password, 'install');
 if (! $admin\_name) { return $this->showmessage(\_\_('管理员名称不能为空', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); }
 if (! $admin\_password) { return $this->showmessage(\_\_('密码不能为空', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); }
 if (!(strlen($admin\_password) >= 8 && preg\_match("/\d+/",$admin\_password) && preg\_match("/[a-zA-Z]+/",$admin\_password))) { return $this->showmessage(\_\_('密码必须同时包含字母及数字', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); }
 if (!(strlen($admin\_password2) >= 8 && preg\_match("/\d+/",$admin\_password2) && preg\_match("/[a-zA-Z]+/",$admin\_password2))) { return $this->showmessage(\_\_('密码必须同时包含字母及数字', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); }
 if ($admin\_password != $admin\_password2) { return $this->showmessage(\_\_('密码不相同', 'installer'), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); }
 $result = Helper::createAdminPassport($admin\_name, $admin\_password, $admin\_email);
 if (is\_ecjia\_error($result)) { return $this->showmessage($result->get\_error\_message(), ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_ERROR); } else { $percent = $this->get\_percent('create\_admin\_passport'); return $this->showmessage('', ecjia::MSGTYPE\_JSON | ecjia::MSGSTAT\_SUCCESS, array('percent' => $percent)); } }
 /\*\* \* 检查操作步骤 \*/ private function check\_step($step) { if ($step > 1) { if (!isset($\_COOKIE['install\_step1']) || !isset($\_COOKIE['agree'])) { $this->redirectWithExited(RC\_Uri::url('installer/index/init')); } if ($step > 2) { if (!isset($\_COOKIE['install\_step2']) || $\_COOKIE['install\_config'] != 1) { $this->redirectWithExited(RC\_Uri::url('installer/index/detect')); } else { if ($step > 3) { if (!isset($\_COOKIE['install\_step3']) || !isset($\_COOKIE['install\_step4'])) { $this->redirectWithExited(RC\_Uri::url('installer/index/deploy')); } } } } } return false; }
 /\*\* \* 检测是否已安装程序 \*/ private function check\_installed() { /\* 初始化流程控制变量 \*/ if (Helper::checkInstallLock()) { $this->redirectWithExited(RC\_Uri::url('installer/index/installed')); } }
 /\*\* \* 清除流程cookie \*/ private function unset\_cookie() { setcookie('install\_step1', '', time()-3600); setcookie('install\_step2', '', time()-3600); setcookie('install\_step3', '', time()-3600); setcookie('install\_step4', '', time()-3600); setcookie('install\_config', '', time()-3600); setcookie('agree', '', time()-3600); }  private function get\_percent($step) {  $sqlcount = count(scandir(royalcms('path').'/content/database/migrations'))-2;  if($step == 'create\_config\_file') { $past = 20; } else if($step == 'create\_database') { $past = 40; } else if($step == 'install\_structure') { $over = Helper::getWillMigrationFilesCount(); if (!is\_ecjia\_error($over)) $past = 40 + $sqlcount - $over; } else if($step == 'install\_base\_data') { $past = 40 + $sqlcount + 20; } else if($step == 'install\_demo\_data') { $past = 40 + $sqlcount + 40; } else if($step == 'create\_admin\_passport') { // $past = 4 + $\_SESSION['temp']['sqlcount'] + 6; return 100; } $total = $sqlcount + 20 + 20 + 20 + 20;   return $percent = floor($past / $total \* 100);  }}
//end

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_49660e2a_20250115_102316.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fecjia%2Fecjia-daojia%2Fissues%2F20)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fecjia%2Fecjia-daojia%2Fissues%2F20)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=ecjia%2Fecjia-daojia)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ecjia](/ecjia)
/
**[ecjia-daojia](/ecjia/ecjia-daojia)**
Public

* [Notifications](/login?return_to=%2Fecjia%2Fecjia-daojia) You must be signed in to change notification settings
* [Fork
  258](/login?return_to=%2Fecjia%2Fecjia-daojia)
* [Star
   571](/login?return_to=%2Fecjia%2Fecjia-daojia)

* [Code](/ecjia/ecjia-daojia)
* [Issues
  1](/ecjia/ecjia-daojia/issues)
* [Pull requests
  0](/ecjia/ecjia-daojia/pulls)
* [Actions](/ecjia/ecjia-daojia/actions)
* [Projects
  0](/ecjia/ecjia-daojia/projects)
* [Wiki](/ecjia/ecjia-daojia/wiki)
* [Security](/ecjia/ecjia-daojia/security)
* [Insights](/ecjia/ecjia-daojia/pulse)

Additional navigation options

* [Code](/ecjia/ecjia-daojia)
* [Issues](/ecjia/ecjia-daojia/issues)
* [Pull requests](/ecjia/ecjia-daojia/pulls)
* [Actions](/ecjia/ecjia-daojia/actions)
* [Projects](/ecjia/ecjia-daojia/projects)
* [Wiki](/ecjia/ecjia-daojia/wiki)
* [Security](/ecjia/ecjia-daojia/security)
* [Insights](/ecjia/ecjia-daojia/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fecjia%2Fecjia-daojia%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fecjia%2Fecjia-daojia%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# information leakage #20

Closed

[spiderlronman](/spiderlronman) opened this issue
Mar 8, 2022
· 2 comments

Closed

# [information leakage](#top) #20

[spiderlronman](/spiderlronman) opened this issue
Mar 8, 2022
· 2 comments

## Comments

[![@spiderlronman](https://avatars.githubusercontent.com/u/44356519?s=80&u=7bf51e5e88a2405a00a3eb14ae19ce7ed7bcccc3&v=4)](/spiderlronman)

Copy link

### **[spiderlronman](/spiderlronman)** commented [Mar 8, 2022](#issue-1162546895)

| helper.php file line 315 creates the .env file Content is：$envPath = base\_path() . DIRECTORY\_SEPARATOR . '.env'; Its content is to create a .env file in the root directory and write the database account, password, and database name |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@royalwang](https://avatars.githubusercontent.com/u/1106638?s=80&u=b3341cb484596ea52e2e162f7796afdd45516c58&v=4)](/royalwang)

Copy link

Contributor

### **[royalwang](/royalwang)** commented [Apr 11, 2022](#issuecomment-1094581582)

| What is the problem? |
| --- |

All reactions

Sorry, something went wrong.

[![@royalwang](https://avatars.githubusercontent.com/u/1106638?s=40&u=b3341cb484596ea52e2e162f7796afdd45516c58&v=4)](/royalwang)
[royalwang](/royalwang)
closed this as [completed](/ecjia/ecjia-daojia/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Apr 11, 2022](#event-6405996562)

[![@spiderlronman](https://avatars.githubusercontent.com/u/44356519?s=80&u=7bf51e5e88a2405a00a3eb14ae19ce7ed7bcccc3&v=4)](/spiderlronman)

Copy link

Author

### **[spiderlronman](/spiderlronman)** commented [Apr 16, 2022](#issuecomment-1100629117)

| 问题是什么？ Help during system installation The PHP file is created on line 315 Env file content and write some sensitive information of the server, resulting in the leakage of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fecjia%2Fecjia-daojia%2Fissues%2F20)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@royalwang](https://avatars.githubusercontent.com/u/1106638?s=52&v=4)](/royalwang) [![@spiderlronman](https://avatars.githubusercontent.com/u/44356519?s=52&v=4)](/spiderlronman)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_dc8e1605_20250115_102313.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fecjia%2Fecjia-daojia%2Fblob%2Fdfb322387e8d3d50719e44d23d793072616ff789%2Fcontent%2Fapps%2Finstaller%2Fclasses%2FHelper.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fecjia%2Fecjia-daojia%2Fblob%2Fdfb322387e8d3d50719e44d23d793072616ff789%2Fcontent%2Fapps%2Finstaller%2Fclasses%2FHelper.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ecjia%2Fecjia-daojia)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ecjia](/ecjia)
/
**[ecjia-daojia](/ecjia/ecjia-daojia)**
Public

* [Notifications](/login?return_to=%2Fecjia%2Fecjia-daojia) You must be signed in to change notification settings
* [Fork
  258](/login?return_to=%2Fecjia%2Fecjia-daojia)
* [Star
   571](/login?return_to=%2Fecjia%2Fecjia-daojia)

* [Code](/ecjia/ecjia-daojia)
* [Issues
  1](/ecjia/ecjia-daojia/issues)
* [Pull requests
  0](/ecjia/ecjia-daojia/pulls)
* [Actions](/ecjia/ecjia-daojia/actions)
* [Projects
  0](/ecjia/ecjia-daojia/projects)
* [Wiki](/ecjia/ecjia-daojia/wiki)
* [Security](/ecjia/ecjia-daojia/security)
* [Insights](/ecjia/ecjia-daojia/pulse)

Additional navigation options

* [Code](/ecjia/ecjia-daojia)
* [Issues](/ecjia/ecjia-daojia/issues)
* [Pull requests](/ecjia/ecjia-daojia/pulls)
* [Actions](/ecjia/ecjia-daojia/actions)
* [Projects](/ecjia/ecjia-daojia/projects)
* [Wiki](/ecjia/ecjia-daojia/wiki)
* [Security](/ecjia/ecjia-daojia/security)
* [Insights](/ecjia/ecjia-daojia/pulse)

## Files

 dfb3223
## Breadcrumbs

1. [ecjia-daojia](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789)
2. /[content](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content)
3. /[apps](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps)
4. /[installer](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer)
5. /[classes](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes)
/
# Helper.php

Copy path Blame  Blame
## Latest commit

## History

[History](/ecjia/ecjia-daojia/commits/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes/Helper.php)585 lines (506 loc) · 19.6 KB dfb3223
## Breadcrumbs

1. [ecjia-daojia](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789)
2. /[content](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content)
3. /[apps](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps)
4. /[installer](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer)
5. /[classes](/ecjia/ecjia-daojia/tree/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes)
/
# Helper.php

Top
## File metadata and controls

* Code
* Blame

585 lines (506 loc) · 19.6 KB[Raw](https://github.com/ecjia/ecjia-daojia/raw/dfb322387e8d3d50719e44d23d793072616ff789/content/apps/installer/classes/Helper.php)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585<?php//// \_\_\_\_\_\_ \_\_\_\_\_\_ \_\_ \_\_ \_\_\_\_\_\_// /\ \_\_\_\ /\ \_\_\_\ /\\_\ /\\_\ /\ \_\_ \// \/\ \_\_\ \/\ \\_\_\_\_ \/\\_\ \/\\_\ \/\ \\_\ \// \/\\_\_\_\_\_\ \/\\_\_\_\_\_\ /\\_\/\\_\ \/\\_\ \/\\_\ \\_\// \/\_\_\_\_\_/ \/\_\_\_\_\_/ \/\_\_\/\_/ \/\_/ \/\_/ /\_///// 上海商创网络科技有限公司//// ---------------------------------------------------------------------------------//// 一、协议的许可和权利//// 1. 您可以在完全遵守本协议的基础上，将本软件应用于商业用途；// 2. 您可以在协议规定的约束和限制范围内修改本产品源代码或界面风格以适应您的要求；// 3. 您拥有使用本产品中的全部内容资料、商品信息及其他信息的所有权，并独立承担与其内容相关的// 法律义务；// 4. 获得商业授权之后，您可以将本软件应用于商业用途，自授权时刻起，在技术支持期限内拥有通过// 指定的方式获得指定范围内的技术支持服务；//// 二、协议的约束和限制//// 1. 未获商业授权之前，禁止将本软件用于商业用途（包括但不限于企业法人经营的产品、经营性产品// 以及以盈利为目的或实现盈利产品）；// 2. 未获商业授权之前，禁止在本产品的整体或在任何部分基础上发展任何派生版本、修改版本或第三// 方版本用于重新开发；// 3. 如果您未能遵守本协议的条款，您的授权将被终止，所被许可的权利将被收回并承担相应法律责任；//// 三、有限担保和免责声明//// 1. 本软件及所附带的文件是作为不提供任何明确的或隐含的赔偿或担保的形式提供的；// 2. 用户出于自愿而使用本软件，您必须了解使用本软件的风险，在尚未获得商业授权之前，我们不承// 诺提供任何形式的技术支持、使用担保，也不承担任何因使用本软件而产生问题的相关责任；// 3. 上海商创网络科技有限公司不对使用本产品构建的商城中的内容信息承担责任，但在不侵犯用户隐// 私信息的前提下，保留以任何方式获取用户信息及商品信息的权利；//// 有关本产品最终用户授权协议、商业授权与技术服务的详细内容，均由上海商创网络科技有限公司独家// 提供。上海商创网络科技有限公司拥有在不事先通知的情况下，修改授权协议的权力，修改后的协议对// 改变之日起的新授权用户生效。电子文本形式的授权协议如同双方书面签署的协议一样，具有完全的和// 等同的法律效力。您一旦开始修改、安装或使用本产品，即被视为完全理解并接受本协议的各项条款，// 在享有上述条款授予的权力的同时，受到相关的约束和限制。协议许可范围以外的行为，将直接违反本// 授权协议并构成侵权，我们有权随时终止授权，责令停止损害，并保留追究相关责任的权力。//// ---------------------------------------------------------------------------------//
namespace Ecjia\App\Installer;
use Royalcms\Component\Database\Connection;use Royalcms\Component\Database\QueryException;use Royalcms\Component\Exception\RecoverableErrorException;use Ecjia\System\Database\Seeder;use Ecjia\System\Database\Migrate;use RC\_Package;use RC\_Lang;use RC\_Time;use RC\_DB;use RC\_File;use RC\_Config;use RC\_Uri;use RC\_Ip;use RC\_Upload;use PDO;use PDOException;use Exception;use ecjia\_error;use ecjia\_cloud;
class Helper{  const DB\_CHARSET = 'utf8mb4';  /\*\* \* 获得服务器所在时区 \* \* @access public \* @return string 返回时区串，形如Asia/Shanghai \*/ public static function getLocalTimezone()  { $local\_timezone = date\_default\_timezone\_get(); return $local\_timezone; }  /\*\* \* 获得时区列表，如有重复值，只保留第一个 \* \* @access public \* @return array \*/ public static function getTimezones($lang)  { $timezones = RC\_Package::package('app::installer')->loadConfig('timezones\_zh\_CN'); return array\_unique($timezones); }  /\*\* \* 获得数据库列表 \* \* @access public \* @param string $host 主机 \* @param string $port 端口号 \* @param string $user 用户名 \* @param string $pass 密码 \* @return mixed 成功返回数据库列表组成的数组，失败返回false \*/ public static function getDataBases($host, $port, $user, $pass) { $conn = self::createDatabaseConnection($host, $port, $user, $pass); if (is\_ecjia\_error($conn)) { return new ecjia\_error('connect\_failed', \_\_('连接数据库失败，请检查您输入的数据库帐号是否正确。','installer')); } $r = $conn->select("SHOW DATABASES"); return collect($r)->lists('Database'); }
 /\*\* \* 检测目录权限 \*/ public static function getCheckDirPermission() { $dirs = [ '/' => '', 'content/configs' => str\_replace(SITE\_ROOT, '', SITE\_CONTENT\_PATH) . 'configs', 'content/uploads' => str\_replace(SITE\_ROOT, '', RC\_Upload::upload\_path()), 'content/storages' => str\_replace(SITE\_ROOT, '', storage\_path()), 'content/themes' => str\_replace(SITE\_ROOT, '', SITE\_THEME\_PATH), ];
 $list = array();
 /\* 检查目录 \*/ foreach ($dirs AS $key => $val) { $mark = RC\_File::file\_mode\_info(SITE\_ROOT . $val);
 $list[] = array( 'item' => $key . \_\_('目录', 'installer'), 'mark' => $mark, 'r' => $mark & 1, 'w' => $mark & 2, 'm' => $mark & 4 );
 }
 return $list; }  /\*\* \* 创建数据库连接 \* \* @access public \* @param string $host 主机 \* @param string $port 端口号 \* @param string $user 用户名 \* @param string $pass 密码 \* @return \Royalcms\Component\Database\Connection | ecjia\_error 成功返回数据库连接对象，失败返回false \*/ public static function createDatabaseConnection($host, $port, $user, $pass, $database = null) { try {  $dsn = "mysql:host=$host;port=$port"; if ($database) { $dsn .= ";dbname=$database"; } $db = new \PDO($dsn, $user, $pass); $db->setAttribute(PDO::ATTR\_ERRMODE, PDO::ERRMODE\_EXCEPTION); $db->setAttribute(PDO::ATTR\_DEFAULT\_FETCH\_MODE, PDO::FETCH\_ASSOC);
 $connection = new Connection($db); $connection->setFetchMode(config('database.fetch')); return $connection; } catch (PDOException $e) {  return new ecjia\_error('connect\_failed', \_\_('连接数据库失败，请检查您输入的数据库帐号是否正确。', 'installer')); } }  /\*\* \* 创建指定名字的数据库 \* \* @access public \* @param string $host 主机 \* @param string $port 端口号 \* @param string $user 用户名 \* @param string $pass 密码 \* @param string $database 数据库名 \* @return boolean | ecjia\_error 成功返回true，失败返回false \*/ public static function createDatabase($host, $port, $user, $pass, $database)  { try {  $conn = self::createDatabaseConnection($host, $port, $user, $pass); if (is\_ecjia\_error($conn)) { return new ecjia\_error('connect\_failed', \_\_('连接数据库失败，请检查您输入的数据库帐号是否正确。', 'installer')); } $result = $conn->unprepared("CREATE DATABASE `$database`"); return true;  } catch (QueryException $e) { return new ecjia\_error('cannt\_create\_database', \_\_('连接数据库失败，无法创建数据库', 'installer')); }   }  public static function createInstallConnection()  { $db\_host = env('DB\_HOST'); $db\_user = env('DB\_USERNAME'); $db\_pass = env('DB\_PASSWORD'); $db\_name = env('DB\_DATABASE'); $db\_port = env('DB\_PORT', 3306); $prefix = env('DB\_PREFIX');
 $conn = self::createDatabaseConnection($db\_host, $db\_port, $db\_user, $db\_pass, $db\_name); if (is\_ecjia\_error($conn)) { return $conn; }  $conn->setTablePrefix($prefix);
 return $conn; }
 /\*\* \* 创建管理员帐号 \* \* @access public \* @param string $admin\_name \* @param string $admin\_password \* @param string $admin\_password2 \* @param string $admin\_email \* @return boolean | ecjia\_error 成功返回true，失败返回false \*/ public static function createAdminPassport($admin\_name, $admin\_password, $admin\_email)  { $nav\_list = join(',', RC\_Lang::get('installer::installer.admin\_user'));
 try { $conn = self::createInstallConnection(); if (is\_ecjia\_error($conn)) { return $conn; }  $data = array( 'user\_name' => $admin\_name, 'email' => $admin\_email, 'password' => md5($admin\_password), 'add\_time' => RC\_Time::gmtime(), 'action\_list' => 'all', 'nav\_list' => $nav\_list );  //清空数据表 RC\_DB::table('admin\_user')->truncate(); return RC\_DB::table('admin\_user')->insert($data);  } catch (QueryException $e) { return new ecjia\_error('create\_passport\_failed', \_\_('创建管理员帐号失败', 'installer').'【'.$e->getMessage().'】'); } }  /\*\* \* 获取一个新的auth\_key \* @return string \*/ public static function getAuthKey() { return rc\_random(32, 'AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789'); }  /\*\* \* 修改.env文件 \* @param array $data \* @return string | null | ecjia\_error \*/ public static function modifyEnv(array $data)  { try { $envPath = base\_path() . DIRECTORY\_SEPARATOR . '.env';
 $contentArray = collect(file($envPath, FILE\_IGNORE\_NEW\_LINES));  $contentArray->transform(function ($item) use ($data){ foreach ($data as $key => $value) { if (str\_contains($item, $key)) { return $key . '=' . $value; } }  return $item; });  $content = implode($contentArray->toArray(), "\n");
 return RC\_File::put($envPath, $content);  } catch (Exception $e) { return new ecjia\_error('write\_config\_file\_failed', \_\_('写入配置文件出错', 'installer')); }  }  /\*\* \* 创建.env文件 \*/ public static function createEnv() { $envExamplePath = DATA\_PATH . 'env.example'; $envPath = base\_path() . DIRECTORY\_SEPARATOR . '.env';  if (RC\_File::exists($envExamplePath)) { RC\_File::copy($envExamplePath, $envPath); } }  /\*\* \* 安装数据 \* \* @access public \* @param array $sql\_files SQL文件路径组成的数组 \* @return boolean 成功返回true，失败返回false \*/ public static function installData($sql\_files)  { RC\_Package::package('app::installer')->loadClass('sql\_query', false);  $prefix = env('DB\_PREFIX');  $conn = self::createInstallConnection(); if (is\_ecjia\_error($conn)) { return $conn; } $sql\_query = new sql\_query($conn, self::DB\_CHARSET, 'ecjia\_', $prefix);  $result = $sql\_query->runAll($sql\_files); if ($result === false) { return $sql\_query->getError(); } return true; }  /\*\* \* 安装数据库结构 \*  \* @return boolean | ecjia\_error 成功返回true，失败返回ecjia\_error \*/ public static function installStructure($limit = 20) { try { $migrate = new Migrate();  return $migrate->fire($limit); }  catch (QueryException $e) {  return new ecjia\_error($e->getCode(), $e->getMessage()); } }
 /\*\* \* 获取将要安装的脚本数量 \*/ public static function getWillMigrationFilesCount() { try { $migrate = new Migrate();
 return $migrate->getWillMigrationFilesCount(); } catch (QueryException $e) {
 return new ecjia\_error($e->getCode(), $e->getMessage()); } }
  /\*\* \* 填充数据表基础数据 \* \* @return boolean | ecjia\_error 成功返回true，失败返回ecjia\_error \*/ public static function installBaseData() { try { $seeder = new Seeder('InitDatabaseSeeder');  $seeder->fire();  return true; } catch (QueryException $e) {  return new ecjia\_error($e->getCode(), $e->getMessage()); } catch (RecoverableErrorException $e) {  return new ecjia\_error('recoverable\_error\_exception', $e->getMessage()); } }  /\*\* \* 填充数据表演示数据 \* \* @return boolean | ecjia\_error 成功返回true，失败返回ecjia\_error \*/ public static function installDemoData() { try { $seeder = new Seeder('DemoDatabaseSeeder');  $seeder->fire();  return true; } catch (QueryException $e) {  return new ecjia\_error($e->getCode(), $e->getMessage()); } catch (RecoverableErrorException $e) {  return new ecjia\_error('recoverable\_error\_exception', $e->getMessage()); } }   /\*\* \* 更新 ECJIA 安装日期 \* @return array | ecjia\_error \*/ public static function updateInstallDate() { try { return RC\_DB::table('shop\_config')->where('code', 'install\_date')->update(array('value' => RC\_Time::gmtime())); } catch (QueryException $e) { return new ecjia\_error($e->getCode(), $e->getMessage()); } }  /\*\* \* 更新 ECJIA 版本 \* @return ecjia\_error \*/ public static function updateEcjiaVersion() { try { $version = RC\_Config::get('release.version', '1.3.0'); RC\_DB::table('shop\_config')->where('code', 'mobile\_app\_version')->update(array('value' => $version)); return RC\_DB::table('shop\_config')->where('code', 'ecjia\_version')->update(array('value' => $version)); } catch (QueryException $e) { return new ecjia\_error($e->getCode(), $e->getMessage()); } }  /\*\* \* 写入 hash\_code，做为网站唯一性密钥 \* @return ecjia\_error \*/ public static function updateHashCode() { $dbhash = md5(SITE\_ROOT . env('DB\_HOST') . env('DB\_USERNAME') . env('DB\_PASSWORD') . env('DB\_DATABASE')); $hash\_code = md5(md5(time()) . md5($dbhash) . md5(time()));  $data = array( 'shop\_url' => RC\_Uri::home\_url(), 'hash\_code' => $hash\_code, 'ip' => RC\_Ip::server\_ip(), 'shop\_type' => RC\_Config::get('site.shop\_type'), 'version' => RC\_Config::get('release.version'), 'release' => RC\_Config::get('release.build'), 'language' => RC\_Config::get('system.locale'), 'charset' => 'utf-8', 'php\_ver' => PHP\_VERSION, 'mysql\_ver' => self::getMysqlVersionByConnection(RC\_DB::connection()), 'ecjia\_version' => VERSION, 'ecjia\_release' => RELEASE, 'royalcms\_version' => \Royalcms\Component\Foundation\Royalcms::VERSION, 'royalcms\_release' => \Royalcms\Component\Foundation\Royalcms::RELEASE, ); ecjia\_cloud::instance()->api('product/analysis/install')->data($data)->run();  try { return RC\_DB::table('shop\_config')->where('code', 'hash\_code')->update(array('value' => $hash\_code)); } catch (QueryException $e) { return new ecjia\_error($e->getCode(), $e->getMessage()); } }  /\*\* \* 更新PC内嵌的H5地址 \*/ public static function updateDemoApiUrl() { try { $url = RC\_Uri::home\_url() . '/sites/m/';  return RC\_DB::table('shop\_config')->where('code', 'mobile\_touch\_url')->update(array('value' => $url)); } catch (QueryException $e) { return new ecjia\_error($e->getCode(), $e->getMessage()); } }  /\*\* \* 创建存储目录 \*/ public static function createStorageDirectory() { $dirs = RC\_Package::package('app::installer')->loadConfig('checking\_dirs'); collect($dirs)->map(function ($dir) { if (!RC\_File::isDirectory($dir)) { RC\_File::makeDirectory($dir); } }); }   /\*\* \* 写入安装锁定文件 \*/ public static function saveInstallLock() {  $path = storage\_path() . '/data/install.lock'; return RC\_File::put($path, 'ECJIA INSTALLED'); }  /\*\* \* 判断安装锁文件是否存在 \*/ public static function checkInstallLock() { $path = storage\_path() . '/data/install.lock'; return RC\_File::exists($path); }  /\*\* \* 检测mysql数据引擎 \*/ public static function checkMysqlSupport($host, $port, $user, $pass) { $conn = self::createDatabaseConnection($host, $port, $user, $pass); if (is\_ecjia\_error($conn)) { return new ecjia\_error('connect\_failed', \_\_('连接数据库失败，请检查您输入的数据库帐号是否正确。', 'installer')); } $r = $conn->select("SHOW variables like 'have\_%';"); return collect($r); }  /\*\* \* 获取mysql版本 \*/ public static function getMysqlVersion($host, $port, $user, $pass) { $conn = self::createDatabaseConnection($host, $port, $user, $pass); if (is\_ecjia\_error($conn)) { return new ecjia\_error('connect\_failed', \_\_('连接数据库失败，请检查您输入的数据库帐号是否正确。', 'installer')); } $r = $conn->select("select version() as version;"); $version = collect(collect($r)->lists('version'))->first(); $ver = strstr($version, '-', true); if ( $ver ) { return $ver; } else { return $version; } }  public static function getMysqlVersionByConnection(Connection $connection) { $r = $connection->select("select version() as version;"); $version = collect(collect($r)->lists('version'))->first(); $ver = strstr($version, '-', true); if ( $ver ) { return $ver; } else { return $version; } }}
//end

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


