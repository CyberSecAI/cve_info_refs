=== Content from github.com_0ba3a652_20250114_235058.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmichaelrsweet%2Fhtmldoc%2Fissues%2F471)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmichaelrsweet%2Fhtmldoc%2Fissues%2F471)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=michaelrsweet%2Fhtmldoc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[michaelrsweet](/michaelrsweet)
/
**[htmldoc](/michaelrsweet/htmldoc)**
Public

* [Notifications](/login?return_to=%2Fmichaelrsweet%2Fhtmldoc) You must be signed in to change notification settings
* [Fork
  46](/login?return_to=%2Fmichaelrsweet%2Fhtmldoc)
* [Star
   214](/login?return_to=%2Fmichaelrsweet%2Fhtmldoc)

* [Code](/michaelrsweet/htmldoc)
* [Issues
  14](/michaelrsweet/htmldoc/issues)
* [Pull requests
  0](/michaelrsweet/htmldoc/pulls)
* [Discussions](/michaelrsweet/htmldoc/discussions)
* [Actions](/michaelrsweet/htmldoc/actions)
* [Projects
  0](/michaelrsweet/htmldoc/projects)
* [Security](/michaelrsweet/htmldoc/security)
* [Insights](/michaelrsweet/htmldoc/pulse)

Additional navigation options

* [Code](/michaelrsweet/htmldoc)
* [Issues](/michaelrsweet/htmldoc/issues)
* [Pull requests](/michaelrsweet/htmldoc/pulls)
* [Discussions](/michaelrsweet/htmldoc/discussions)
* [Actions](/michaelrsweet/htmldoc/actions)
* [Projects](/michaelrsweet/htmldoc/projects)
* [Security](/michaelrsweet/htmldoc/security)
* [Insights](/michaelrsweet/htmldoc/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmichaelrsweet%2Fhtmldoc%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmichaelrsweet%2Fhtmldoc%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Two Integer Overflow bugs in image.cxx #471

Closed

[Zzero00](/Zzero00) opened this issue
Mar 10, 2022
· 5 comments

Closed

# [Two Integer Overflow bugs in image.cxx](#top) #471

[Zzero00](/Zzero00) opened this issue
Mar 10, 2022
· 5 comments

Assignees
[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&v=4)](/michaelrsweet)

Labels
[bug](/michaelrsweet/htmldoc/labels/bug)
Something isn't working
[priority-high](/michaelrsweet/htmldoc/labels/priority-high)

Milestone
[Stable](/michaelrsweet/htmldoc/milestone/1 "Stable")

## Comments

[![@Zzero00](https://avatars.githubusercontent.com/u/95515995?s=80&u=d4e49d68393810894f45939cb17a3ae25cd1d221&v=4)](/Zzero00)

Copy link

### **[Zzero00](/Zzero00)** commented [Mar 10, 2022](#issue-1164787186) • edited Loading

| Hi, there is two integer overflow bugs in the latest version of htmldoc. They are similar to [CVE-2021-20308](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-20308).  os: ubuntu 20.04 version: 1.9.16(the latest) First First, in image\_load\_jpeg function, image.cxx. When it calls malloc，'img->width' and 'img->height' are enough large to cause an integer overflow So, the malloc function may return a heap block smaller than the expected size, and it will cause a buffer overflow/Address boundary error in the jpeg\_read\_scanlines function.     [htmldoc/htmldoc/image.cxx](https://github.com/michaelrsweet/htmldoc/blob/cb4cdeefa80ecdd7b647e9677ca307a817d1d5bf/htmldoc/image.cxx#L1390-L1395)  Lines 1390 to 1395 in [cb4cdee](/michaelrsweet/htmldoc/commit/cb4cdeefa80ecdd7b647e9677ca307a817d1d5bf)   |  | static int /\* O - 0 = success, -1 = fail \*/ | | --- | --- | |  | image\_load\_jpeg(image\_t \*img, /\* I - Image pointer \*/ | |  | FILE \*fp, /\* I - File to load from \*/ | |  | int gray, /\* I - 0 = color, 1 = grayscale \*/ | |  | int load\_data)/\* I - 1 = load image data, 0 = just info \*/ | |  | { |      [htmldoc/htmldoc/image.cxx](https://github.com/michaelrsweet/htmldoc/blob/cb4cdeefa80ecdd7b647e9677ca307a817d1d5bf/htmldoc/image.cxx#L1452-L1466)  Lines 1452 to 1466 in [cb4cdee](/michaelrsweet/htmldoc/commit/cb4cdeefa80ecdd7b647e9677ca307a817d1d5bf)   |  | img->pixels = (uchar \*)malloc((size\_t)(img->width \* img->height \* img->depth)); | | --- | --- | |  |  | |  | if (img->pixels == NULL) | |  | { | |  | jpeg\_destroy\_decompress(&cinfo); | |  | return (-1); | |  | } | |  |  | |  | jpeg\_start\_decompress(&cinfo); | |  |  | |  | while (cinfo.output\_scanline < cinfo.output\_height) | |  | { | |  | row = (JSAMPROW)(img->pixels + (size\_t)cinfo.output\_scanline \* (size\_t)cinfo.output\_width \* (size\_t)cinfo.output\_components); | |  | jpeg\_read\_scanlines(&cinfo, &row, (JDIMENSION)1); | |  | } |      Asan report:  ``` ./htmldoc --webpage -f out.pdf ./test.html PAGES: 4 Corrupt JPEG data: premature end of data segment AddressSanitizer:DEADLYSIGNAL ================================================================= ==1326478==ERROR: AddressSanitizer: SEGV on unknown address 0x621000020000 (pc 0x7f0bd38812e1 bp 0x7ffd6a49c500 sp 0x7ffd6a49c460 T0) ==1326478==The signal is caused by a WRITE memory access.     #0 0x7f0bd38812e1  (/lib/x86_64-linux-gnu/libjpeg.so.8+0x422e1)  AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV (/lib/x86_64-linux-gnu/libjpeg.so.8+0x422e1) ==1326478==ABORTING  ```  And this is the poc file： [poc1.zip](https://github.com/michaelrsweet/htmldoc/files/8220592/poc1.zip) Second There is another integer overflow bug in image\_load\_png function, image.cxx, similar to the first one.   [htmldoc/htmldoc/image.cxx](https://github.com/michaelrsweet/htmldoc/blob/cb4cdeefa80ecdd7b647e9677ca307a817d1d5bf/htmldoc/image.cxx#L1631-L1647)  Lines 1631 to 1647 in [cb4cdee](/michaelrsweet/htmldoc/commit/cb4cdeefa80ecdd7b647e9677ca307a817d1d5bf)   |  | img->pixels = (uchar \*)calloc(1, (size\_t)(img->width \* img->height \* depth)); | | --- | --- | |  |  | |  | /\* | |  | \* Allocate pointers... | |  | \*/ | |  |  | |  | rows = (png\_bytep \*)calloc(png\_get\_image\_height(pp, info), sizeof(png\_bytep)); | |  |  | |  | for (i = 0; i < (int)png\_get\_image\_height(pp, info); i ++) | |  | rows[i] = img->pixels + i \* img->width \* depth; | |  |  | |  | /\* | |  | \* Read the image, handling interlacing as needed... | |  | \*/ | |  |  | |  | for (i = png\_set\_interlace\_handling(pp); i > 0; i --) | |  | png\_read\_rows(pp, rows, NULL, (png\_uint\_32)img->height); |      It calls calloc to get heap block. However, the width and height of the png file are both four bytes long, so 'img->width' and 'img->height' are enough large to cause an integer overflow. The calloc function may return a heap block smaller than the expected size, and finally cause a heap overflow in the png\_read\_rows function when memcpy.  This is the Asan report:  ``` ./htmldoc --webpage -f out.pdf ./test.html PAGES: 4 ================================================================= ==1327797==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000008631 at pc 0x000000434be3 bp 0x7ffc5424be70 sp 0x7ffc5424b630 WRITE of size 196608 at 0x602000008631 thread T0     #0 0x434be2 in memcpy (/root/fuzz_workdir/htmldoc/install/bin/htmldoc+0x434be2)     #1 0x7f847c9e379c  (/lib/x86_64-linux-gnu/libpng16.so.16+0x1d79c)     #2 0x7f847c9d680b in png_read_row (/lib/x86_64-linux-gnu/libpng16.so.16+0x1080b)     #3 0x7f847c9d81d8 in png_read_rows (/lib/x86_64-linux-gnu/libpng16.so.16+0x121d8)     #4 0x5e8c0b in image_load_png(image_t*, _IO_FILE*, int, int) /root/fuzz_workdir/tmp/htmldoc/htmldoc/image.cxx:1647:5     #5 0x5e169d in image_load /root/fuzz_workdir/tmp/htmldoc/htmldoc/image.cxx:845:14     #6 0x54314f in write_image(_IO_FILE*, render_str*, int) /root/fuzz_workdir/tmp/htmldoc/htmldoc/ps-pdf.cxx:10305:5     #7 0x55015e in pdf_write_page(_IO_FILE*, int) /root/fuzz_workdir/tmp/htmldoc/htmldoc/ps-pdf.cxx:2695:13     #8 0x5175c6 in pdf_write_outpage(_IO_FILE*, int) /root/fuzz_workdir/tmp/htmldoc/htmldoc/ps-pdf.cxx:2607:9     #9 0x5175c6 in pdf_write_document(unsigned char*, unsigned char*, unsigned char*, unsigned char*, unsigned char*, unsigned char*, tree_str*, tree_str*) /root/fuzz_workdir/tmp/htmldoc/htmldoc/ps-pdf.cxx:2321:5     #10 0x5175c6 in pspdf_export /root/fuzz_workdir/tmp/htmldoc/htmldoc/ps-pdf.cxx:910:7     #11 0x4e30ca in main /root/fuzz_workdir/tmp/htmldoc/htmldoc/htmldoc.cxx:1291:3     #12 0x7f847c3d60b2 in __libc_start_main /build/glibc-sMfBJT/glibc-2.31/csu/../csu/libc-start.c:308:16     #13 0x41e86d in _start (/root/fuzz_workdir/htmldoc/install/bin/htmldoc+0x41e86d)  0x602000008631 is located 0 bytes to the right of 1-byte region [0x602000008630,0x602000008631) allocated by thread T0 here:     #0 0x499c42 in calloc (/root/fuzz_workdir/htmldoc/install/bin/htmldoc+0x499c42)     #1 0x5e897d in image_load_png(image_t*, _IO_FILE*, int, int) /root/fuzz_workdir/tmp/htmldoc/htmldoc/image.cxx:1631:26     #2 0x5e169d in image_load /root/fuzz_workdir/tmp/htmldoc/htmldoc/image.cxx:845:14     #3 0x54314f in write_image(_IO_FILE*, render_str*, int) /root/fuzz_workdir/tmp/htmldoc/htmldoc/ps-pdf.cxx:10305:5     #4 0x55015e in pdf_write_page(_IO_FILE*, int) /root/fuzz_workdir/tmp/htmldoc/htmldoc/ps-pdf.cxx:2695:13  SUMMARY: AddressSanitizer: heap-buffer-overflow (/root/fuzz_workdir/htmldoc/install/bin/htmldoc+0x434be2) in memcpy Shadow bytes around the buggy address:   0x0c047fff9070: fa fa 00 02 fa fa 00 02 fa fa 00 02 fa fa 00 02   0x0c047fff9080: fa fa 00 02 fa fa 06 fa fa fa 06 fa fa fa 07 fa   0x0c047fff9090: fa fa 06 fa fa fa 02 fa fa fa 00 07 fa fa fd fd   0x0c047fff90a0: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fd   0x0c047fff90b0: fa fa fd fa fa fa fd fd fa fa fd fa fa fa fd fa =>0x0c047fff90c0: fa fa fd fa fa fa[01]fa fa fa fa fa fa fa fa fa   0x0c047fff90d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff90e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff90f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff9100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff9110: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==1327797==ABORTING  ```  And this is the poc file: [poc2.zip](https://github.com/michaelrsweet/htmldoc/files/8220755/poc2.zip) (wrong poc) This is the correct poc: [real\_poc2.zip](https://github.com/michaelrsweet/htmldoc/files/8229112/real_poc2.zip) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)
[michaelrsweet](/michaelrsweet)
self-assigned this
[Mar 10, 2022](#event-6220475899)

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)
[michaelrsweet](/michaelrsweet)
added
[bug](/michaelrsweet/htmldoc/labels/bug)
Something isn't working
[priority-high](/michaelrsweet/htmldoc/labels/priority-high)
labels
[Mar 10, 2022](#event-6220476241)

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)
[michaelrsweet](/michaelrsweet)
added this to the [Stable](/michaelrsweet/htmldoc/milestone/1) milestone
[Mar 10, 2022](#event-6220476410)

[michaelrsweet](/michaelrsweet)
added a commit
that referenced
this issue
[Mar 10, 2022](#ref-commit-31f7804)
[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)

`[Fix a potential integer overflow bug in the JPEG and PNG loaders (Issue](/michaelrsweet/htmldoc/commit/31f780487e5ddc426888638786cdc47631687275 "Fix a potential integer overflow bug in the JPEG and PNG loaders (Issue #471)

All images are now limited to 4GiB of memory usage (37837x37837 pixels).")`
…

`[31f7804](/michaelrsweet/htmldoc/commit/31f780487e5ddc426888638786cdc47631687275)`

```
[#471](https://github.com/michaelrsweet/htmldoc/issues/471))

All images are now limited to 4GiB of memory usage (37837x37837 pixels).
```

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=80&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)

Copy link

Owner

### **[michaelrsweet](/michaelrsweet)** commented [Mar 10, 2022](#issuecomment-1064477306)

| I wasn't able to reproduce the issue with poc2, but I added range checks to the JPEG and PNG load functions to limit images to <4GiB - a little lazy but for the intended usage I don't see a problem limiting images like this.  [master [31f7804](https://github.com/michaelrsweet/htmldoc/commit/31f780487e5ddc426888638786cdc47631687275)] Fix a potential integer overflow bug in the JPEG and PNG loaders (Issue [#471](https://github.com/michaelrsweet/htmldoc/issues/471)) |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)
[michaelrsweet](/michaelrsweet)
closed this as [completed](/michaelrsweet/htmldoc/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Mar 10, 2022](#event-6220555312)

[![@Zzero00](https://avatars.githubusercontent.com/u/95515995?s=80&u=d4e49d68393810894f45939cb17a3ae25cd1d221&v=4)](/Zzero00)

Copy link

Author

### **[Zzero00](/Zzero00)** commented [Mar 11, 2022](#issuecomment-1064664242) • edited Loading

| I wasn't able to reproduce the issue with poc2, but I added range checks to the JPEG and PNG load functions to limit images to <4GiB - a little lazy but for the intended usage I don't see a problem limiting images like this.  [master [31f7804](https://github.com/michaelrsweet/htmldoc/commit/31f780487e5ddc426888638786cdc47631687275)] Fix a potential integer overflow bug in the JPEG and PNG loaders (Issue [#471](https://github.com/michaelrsweet/htmldoc/issues/471))  Oh, I‘m sorry, this is the correct poc2 file: [real\_poc2.zip](https://github.com/michaelrsweet/htmldoc/files/8228196/real_poc2.zip)  I forgot to modify the html file in the above poc2 file. As follows:  ``` $ unzip real_poc2.zip Archive:  real_poc2.zip   inflating: poc.png   inflating: test.html $ ls htmldoc*  htmldoc_noasan*  poc.png  real_poc2.zip  test.html $ ./htmldoc_noasan --webpage -f out.pdf ./test.html PAGES: 4 fish: “./htmldoc_noasan --webpage -f o…” terminated by signal SIGSEGV (Address boundary error) $ ./htmldoc --webpage -f out.pdf ./test.html PAGES: 4 ================================================================= ==1369912==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000008631 at pc 0x000000434be3 bp 0x7ffe31cc2070 sp 0x7ffe31cc1830 WRITE of size 196608 at 0x602000008631 thread T0 ......  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=80&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)

Copy link

Owner

### **[michaelrsweet](/michaelrsweet)** commented [Mar 14, 2022](#issuecomment-1067057574)

| Re-confirmed that the changes I pushed also address this test file. |
| --- |

All reactions

Sorry, something went wrong.

[![@BrianInglis](https://avatars.githubusercontent.com/u/23089181?s=80&u=ce33c53e0a73d366f288de13eff1acf578888553&v=4)](/BrianInglis)

Copy link

### **[BrianInglis](/BrianInglis)** commented [May 21, 2022](#issuecomment-1133771697) • edited Loading

| Currently tracked as `htmldoc` **1.9.16** vulnerabilty [CVE-2022-27114](https://nvd.nist.gov/vuln/detail/CVE-2022-27114) score [5.5 MEDIUM](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?name=CVE-2022-27114&vector=AV:L/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:H&version=3.1&source=NIST). Please consider making an updated release soon or ask to have the affected version corrected. |
| --- |

All reactions

Sorry, something went wrong.

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=80&u=4e7b123b09469a7af9afd8350920ebdd6d7c2a66&v=4)](/michaelrsweet)

Copy link

Owner

### **[michaelrsweet](/michaelrsweet)** commented [May 22, 2022](#issuecomment-1133851770)

| [@BrianInglis](https://github.com/BrianInglis) a release was done a few days ago.  Please refamiliarize yourself with the license terms of this free software that comes with no warranties or guarantees of any kind! |
| --- |

All reactions

Sorry, something went wrong.

Repository owner
locked as **resolved** and limited conversation to collaborators
[May 22, 2022](#event-6655882956)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmichaelrsweet%2Fhtmldoc%2Fissues%2F471).

Assignees

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&v=4)](/michaelrsweet) [michaelrsweet](/michaelrsweet)

Labels

[bug](/michaelrsweet/htmldoc/labels/bug)
Something isn't working
[priority-high](/michaelrsweet/htmldoc/labels/priority-high)

Projects

None yet

Milestone

 [**Stable**](/michaelrsweet/htmldoc/milestone/1 "Stable")

Development

No branches or pull requests

3 participants

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=52&v=4)](/michaelrsweet) [![@BrianInglis](https://avatars.githubusercontent.com/u/23089181?s=52&v=4)](/BrianInglis) [![@Zzero00](https://avatars.githubusercontent.com/u/95515995?s=52&v=4)](/Zzero00)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_65d24d8a_20250114_235054.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmichaelrsweet%2Fhtmldoc%2Fcommit%2F31f780487e5ddc426888638786cdc47631687275)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmichaelrsweet%2Fhtmldoc%2Fcommit%2F31f780487e5ddc426888638786cdc47631687275)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=michaelrsweet%2Fhtmldoc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[michaelrsweet](/michaelrsweet)
/
**[htmldoc](/michaelrsweet/htmldoc)**
Public

* [Notifications](/login?return_to=%2Fmichaelrsweet%2Fhtmldoc) You must be signed in to change notification settings
* [Fork
  46](/login?return_to=%2Fmichaelrsweet%2Fhtmldoc)
* [Star
   214](/login?return_to=%2Fmichaelrsweet%2Fhtmldoc)

* [Code](/michaelrsweet/htmldoc)
* [Issues
  14](/michaelrsweet/htmldoc/issues)
* [Pull requests
  0](/michaelrsweet/htmldoc/pulls)
* [Discussions](/michaelrsweet/htmldoc/discussions)
* [Actions](/michaelrsweet/htmldoc/actions)
* [Projects
  0](/michaelrsweet/htmldoc/projects)
* [Security](/michaelrsweet/htmldoc/security)
* [Insights](/michaelrsweet/htmldoc/pulse)

Additional navigation options

* [Code](/michaelrsweet/htmldoc)
* [Issues](/michaelrsweet/htmldoc/issues)
* [Pull requests](/michaelrsweet/htmldoc/pulls)
* [Discussions](/michaelrsweet/htmldoc/discussions)
* [Actions](/michaelrsweet/htmldoc/actions)
* [Projects](/michaelrsweet/htmldoc/projects)
* [Security](/michaelrsweet/htmldoc/security)
* [Insights](/michaelrsweet/htmldoc/pulse)

## Commit

[Permalink](/michaelrsweet/htmldoc/commit/31f780487e5ddc426888638786cdc47631687275)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix a potential integer overflow bug in the JPEG and PNG loaders (Issue

[Browse files](/michaelrsweet/htmldoc/tree/31f780487e5ddc426888638786cdc47631687275)
Browse the repository at this point in the history

```
[#471](https://github.com/michaelrsweet/htmldoc/issues/471))

All images are now limited to 4GiB of memory usage (37837x37837 pixels).
```

* Loading branch information

[![@michaelrsweet](https://avatars.githubusercontent.com/u/488103?s=40&v=4)](/michaelrsweet)

[michaelrsweet](/michaelrsweet/htmldoc/commits?author=michaelrsweet "View all commits by michaelrsweet")
committed
Mar 10, 2022

1 parent
[cb4cdee](/michaelrsweet/htmldoc/commit/cb4cdeefa80ecdd7b647e9677ca307a817d1d5bf)

commit 31f7804

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**24 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGES.md
  [CHANGES.md](#diff-d975bf659606195d2165918f93e1cf680ef68ea3c9cab994f033705fea8238b2)
* htmldoc

  + htmldoc/image.cxx
    [image.cxx](#diff-65fe596e4c3fa8759de89bf71af4e09bb99699a67da468fbb4556171f37dbbd9)

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[CHANGES.md](#diff-d975bf659606195d2165918f93e1cf680ef68ea3c9cab994f033705fea8238b2 "CHANGES.md")

Show comments

[View file](/michaelrsweet/htmldoc/blob/31f780487e5ddc426888638786cdc47631687275/CHANGES.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,7 +1,8 @@ |
|  |  | # Changes in HTMLDOC v1.9.16 |
|  |  |  |
|  |  | - Updated the GUI interface for current display fonts. |
|  |  | - Fixed a potential image overflow bug with JPEG and PNG images (Issue #471) |
|  |  | - Fixed some minor Coverity warnings. |
|  |  | - Updated the GUI interface for current display fonts. |
|  |  |  |
|  |  |  |
|  |  | # Changes in HTMLDOC v1.9.15 |
| Expand Down | |  |

25 changes: 22 additions & 3 deletions

25
[htmldoc/image.cxx](#diff-65fe596e4c3fa8759de89bf71af4e09bb99699a67da468fbb4556171f37dbbd9 "htmldoc/image.cxx")

Show comments

[View file](/michaelrsweet/htmldoc/blob/31f780487e5ddc426888638786cdc47631687275/htmldoc/image.cxx)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,6 +26,13 @@ extern "C" { /\* Workaround for JPEG header problems... \*/ |
|  |  | #endif // HAVE\_LIBPNG |
|  |  |  |
|  |  |  |
|  |  | /\* |
|  |  | \* Limits... |
|  |  | \*/ |
|  |  |  |
|  |  | #define IMAGE\_MAX\_DIM 37837 // Maximum dimension - sqrt(4GiB / 3) |
|  |  |  |
|  |  |  |
|  |  | /\* |
|  |  | \* GIF definitions... |
|  |  | \*/ |
| Expand Down  Expand Up | | @@ -926,7 +933,7 @@ image\_load\_bmp(image\_t \*img, /\* I - Image to load into \*/ |
|  |  | colors\_used = (int)read\_dword(fp); |
|  |  | read\_dword(fp); |
|  |  |  |
|  |  | if (img->width <= 0 || img->width > 8192 || img->height <= 0 || img->height > 8192 || info\_size < 0) |
|  |  | if (img->width <= 0 || img->width > IMAGE\_MAX\_DIM || img->height <= 0 || img->height > IMAGE\_MAX\_DIM || info\_size < 0) |
|  |  | return (-1); |
|  |  |  |
|  |  | if (info\_size > 40) |
| Expand Down  Expand Up | | @@ -1278,7 +1285,7 @@ image\_load\_gif(image\_t \*img, /\* I - Image pointer \*/ |
|  |  | img->height = (buf[9] << 8) | buf[8]; |
|  |  | ncolors = 2 << (buf[10] & 0x07); |
|  |  |  |
|  |  | if (img->width <= 0 || img->width > 32767 || img->height <= 0 || img->height > 32767) |
|  |  | if (img->width <= 0 || img->width > IMAGE\_MAX\_DIM || img->height <= 0 || img->height > IMAGE\_MAX\_DIM) |
|  |  | return (-1); |
|  |  |  |
|  |  | // If we are writing an encrypted PDF file, bump the use count so we create |
| Expand Down  Expand Up | | @@ -1326,7 +1333,7 @@ image\_load\_gif(image\_t \*img, /\* I - Image pointer \*/ |
|  |  | img->height = (buf[7] << 8) | buf[6]; |
|  |  | img->depth = gray ? 1 : 3; |
|  |  |  |
|  |  | if (img->width <= 0 || img->width > 32767 || img->height <= 0 || img->height > 32767) |
|  |  | if (img->width <= 0 || img->width > IMAGE\_MAX\_DIM || img->height <= 0 || img->height > IMAGE\_MAX\_DIM) |
|  |  | return (-1); |
|  |  |  |
|  |  | if (transparent >= 0) |
| Expand Down  Expand Up | | @@ -1443,6 +1450,12 @@ JSAMPROW row; /\* Sample row pointer \*/ |
|  |  | img->height = (int)cinfo.output\_height; |
|  |  | img->depth = (int)cinfo.output\_components; |
|  |  |  |
|  |  | if (img->width <= 0 || img->width > IMAGE\_MAX\_DIM || img->height <= 0 || img->height > IMAGE\_MAX\_DIM) |
|  |  | { |
|  |  | jpeg\_destroy\_decompress(&cinfo); |
|  |  | return (-1); |
|  |  | } |
|  |  |  |
|  |  | if (!load\_data) |
|  |  | { |
|  |  | jpeg\_destroy\_decompress(&cinfo); |
| Expand Down  Expand Up | | @@ -1598,6 +1611,12 @@ image\_load\_png(image\_t \*img, /\* I - Image pointer \*/ |
|  |  | img->width = (int)png\_get\_image\_width(pp, info); |
|  |  | img->height = (int)png\_get\_image\_height(pp, info); |
|  |  |  |
|  |  | if (img->width <= 0 || img->width > IMAGE\_MAX\_DIM || img->height <= 0 || img->height > IMAGE\_MAX\_DIM) |
|  |  | { |
|  |  | png\_destroy\_read\_struct(&pp, &info, NULL); |
|  |  | return (-1); |
|  |  | } |
|  |  |  |
|  |  | if (color\_type & PNG\_COLOR\_MASK\_ALPHA) |
|  |  | { |
|  |  | if ((PSLevel == 0 && PDFVersion >= 14) || PSLevel == 3) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `31f7804`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmichaelrsweet%2Fhtmldoc%2Fcommit%2F31f780487e5ddc426888638786cdc47631687275) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.debian.org_f1abd6d9_20250114_235058.html ===


---

[[Date Prev](msg00013.html)][[Date Next](msg00015.html)]
[[Thread Prev](msg00013.html)][[Thread Next](msg00015.html)]
[[Date Index](maillist.html#00014)]
[[Thread Index](threads.html#00014)]

# [SECURITY] [DLA 3004-1] htmldoc security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3004-1] htmldoc security update
* *From*: "Chris Lamb" <lamby@debian.org>
* *Date*: Fri, 13 May 2022 14:12:26 -0400 (EDT)
* *Message-id*: <[[🔎]](/msgid-search/165246551132.142178.16579692213194340802%40copycat) [165246551132.142178.16579692213194340802@copycat](msg00014.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3004-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                           Chris Lamb
May 13, 2022                                  <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : htmldoc
Version        : 1.8.27-8+deb9u3
CVE ID         : CVE-2022-27114

It was discovered that there was an integer overflow vulnerabiliity
in htmldoc, a HTML processor that generates indexed HTML, PS and PDF
files. This was caused by a programming error in image_load_jpeg
function due to a conflation or confusion of
declared/expected/observed image dimensions.

For Debian 9 "Stretch", this problem has been fixed in version
1.8.27-8+deb9u3.

We recommend that you upgrade your htmldoc packages.

For the detailed security status of htmldoc please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/htmldoc>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEwv5L0nHBObhsUz5GHpU+J9QxHlgFAmJ+n2UACgkQHpU+J9Qx
HlhtuRAAuS2HuhtGbtBPUifJGqDTyb/6wcKidIAKDG07FzGzAOnzJEgCmFh77/Ni
WKBMCHAV+1LUXTFqSv9gp4+Sqa+EnMq6iBJ0QDxA0SNhQRhIP+NDE1Grmb+q2D01
I9VuiNNCenfjTUDy2Vp7PGoEydcraEJULZX8qVCkIs12OshdeXQMI3sVARURzswb
w6reQaQwgIBaf2LkOjtfHQZLLIOPgudpWMw48fVCi0jAYShZF0EQKzSAvUGPmfI4
yH9BBJqCC8mWbHym2R0dGYoVqesPZzso8fvi2py33EkkuPgY7FiJI7iJoPYhjfym
IKX4rvVJepwrd+YApRTnzilhHCZaxFQZzbFs7ddhJ8xeKqbv4bFDN1Rgd/BuF8QR
BOZMCqgG/8dQR0oLK4ca0btexz1fdGDVr/TiNX90Vme11bsnUWR0cu8PxAGmopU9
ma68BXoRM3oClIflAwEK220iqu6SLB6kE6/1xMHhNqhB+3vxLeRGaLVEyvxIIs+T
nW35yFia1c6bIhC7cAmj2bF7P3mxTMAkpYBfzuMc44b7QNf2rTwQvy3jrwDo2e98
Pywu/ty8vncJRKstxV1XbFjZ5WzJttT2mv+RHWTbSmJIscTHQTyHqAcVbjJefTfw
hJHB4I8sGh7op36y2tRr5Q+f5G/9U1r5jgLSzWscu86GTCYIHjA=
=9C82
-----END PGP SIGNATURE-----

```

---


