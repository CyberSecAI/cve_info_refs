=== Content from bugzilla.mozilla.org_3ed88f6d_20250114_224406.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1721220)
* [XML](/show_bug.cgi?ctype=xml&id=1721220)

Closed
[Bug 1721220](/show_bug.cgi?id=1721220)
(CVE-2022-34469)

Opened 3 years ago
Closed 3 years ago

# TLS certificate exceptions are possible despite HSTS

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

TLS certificate exceptions are possible despite HSTS

## Categories

### (GeckoView :: General, defect, P1)

[Product:](/describecomponents.cgi?product=GeckoView)

GeckoView
▾

GeckoView
The GeckoView components for Android
[See Open Bugs in This Product](/buglist.cgi?product=GeckoView&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=GeckoView)
Watch This Product

[Component:](/describecomponents.cgi?product=GeckoView&component=General#General)

General
▾

GeckoView :: General
The GeckoView embedding widget for Android
[See Open Bugs in This Component](/buglist.cgi?product=GeckoView&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=GeckoView&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=GeckoView&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Android

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### (firefox-esr91 wontfix, firefox100 wontfix, firefox101 wontfix, firefox102 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

102 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox100 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix) |
| firefox101 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=wontfix) |
| firefox102 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr91 |  | wontfix |
| firefox100 |  | wontfix |
| firefox101 |  | wontfix |
| firefox102 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: pege, Assigned: calu)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/7d36bab00e1e08005d8871257e7bc73a?d=mm&size=40)  [calu](/user_profile?user_id=693351)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/386e2b57f6d13b249489f5511de9a0c2?d=mm&size=40)  [pege](/user_profile?user_id=587835)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/418efed494240195b86667307fe63d5c?d=mm&size=40)  [owlish](/user_profile?user_id=579431)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1771054](/show_bug.cgi?id=1771054 "RESOLVED FIXED - Users should not be able to bypass TLS certificate error for sites using HSTS (Fenix UI part)")

[1771261](/show_bug.cgi?id=1771261 "RESOLVED FIXED - Add a test API to clear HSTS state")

Dependency [tree](/showdependencytree.cgi?id=1721220&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1721220)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[mozilla-hub.atlassian.net/browse/FNXV...](https://mozilla-hub.atlassian.net/browse/FNXV2-20458 "https://mozilla-hub.atlassian.net/browse/FNXV2-20458")

## Details

### (Keywords: csectype-spoof, sec-moderate, Whiteboard: [geckoview:m100] [geckoview:m101] [geckoview:m102][adv-main102+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-34469

[Keywords:](/describekeywords.cgi)

[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[geckoview:m100] [geckoview:m101] [geckoview:m102][adv-main102+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Firefox Desktop, here handling is correct.](/attachment.cgi?id=9231981)  [3 years ago](#c1)  [Peter Gerber (:pege)](/user_profile?user_id=587835)   99.45 KB, image/png |  | [Details](/attachment.cgi?id=9231981&action=edit) |
| --- | --- | --- |
| [Bug 1721220 - Add BAD\_STS\_CERT error](/attachment.cgi?id=9276321)  [3 years ago](#c15)  [Cathy Lu [:calu]](/user_profile?user_id=693351)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9276321&action=edit) | [Review](/attachment.cgi?id=9276321) |
| [advisory.txt](/attachment.cgi?id=9282611)  [3 years ago](#c21)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   496 bytes, text/plain |  | [Details](/attachment.cgi?id=9282611&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Peter Gerber (:pege)](/user_profile?user_id=587835)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1721220#c0)• 3 years ago |
|  | |

On Firefox 90 for Android and Nightly, on websites where previously an [HSTS](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security) header has been received and is still an effect, certificate errors have an "Accept the Risk and Continue" button.

As per [RFC 6797 Section 12.1](https://datatracker.ietf.org/doc/html/rfc6797#section-12.1) of the HSTS specification, such a button should not be present:

> Failing secure connection establishment on any warnings or errors
>
> (per Section 8.4 ("Errors in Secure Transport Establishment")) should
>
> be done with "no user recourse". This means that the user should not
>
> be presented with a dialog giving her the option to proceed. Rather,
>
> it should be treated similarly to a server error where there is
>
> nothing further the user can do with respect to interacting with the
>
> target web application, other than wait and retry.

In Firefox Desktop, this is done correctly and it is not possible proceed to the web page if certificate validation fails:

<https://gitlab.com/uploads/-/system/user/1406255/480f835f498d94c1b8576e52216345ac/ff.png>

## Steps to Reproduce - includeSubDomains

1. Go to <https://tocco.ch> to pick up the following HSTS header:

   `Strict-Transport-Security: max-age=2592000;includeSubDomains`
2. Go to <http://abc.tocco.ch>. As requested by the HSTS header, the request is upgraded to HTTPS and a certificate error is shown. It's possible to continue, however.

Here we use a domain that uses includeSubDomains as it is easier to reproduce; there is no need to replace the certificate after fetching the HSTS header. However, I also tried this on a page without includeSubDomains by temporarily replacing the certificate with a invalid one. The result was the same.

## Steps to Reproduce - Preloaded

1. Go to <https://may.arbitrary.ch>. Incorrectly, an "Accept the Risk and Continue" presented. The button (luckily) doesn't actually work.

arbitrary.ch is on the [HSTS preload list](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security#preloading_strict_transport_security) and it should be impossible to visit it or any subdomain if a certificate error is presented.

|  | [Peter Gerber (:pege)](/user_profile?user_id=587835)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1721220#c1)• 3 years ago |
|  | |

Attached image
[Firefox Desktop, here handling is correct.](attachment.cgi?id=9231981)
— [Details](attachment.cgi?id=9231981&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1721220#c2)• 3 years ago |
|  | |

rating this `sec-moderate` because it requires the user to explicitly bypass the scary warning, but this is wrong and dangerous.

Flags: needinfo?(dveditz)Keywords: [csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1721220#c3)• 3 years ago |
|  | |

@agi: Afaik when showing an error page from A-C then we cannot know whether it's okay to show this?

Flags: needinfo?(agi)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1721220#c4)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1721220&comment_id=15511457 "2 revisions") |
|  | |

~~I don't understand why this is a security bug if the only problem here is that we present a button? The error cannot be actually bypassed, is that correct?~~ I see the `includeSubDomains` can actually be bypassed.

Sebastian, yeah I don't think you can (but I need to double check). The solution for all these problems is a chrome-only API that can let you know when an error is overridable or not (see [Bug 1696841 Comment 15](/show_bug.cgi?id=1696841#c15 "VERIFIED FIXED - can't click \"Accept the risk and continue\" on secure connection failed page") and later)

Flags: needinfo?(agi)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1721220#c5)• 3 years ago |
|  | |

Interestingly when I try to navigate to `abc.tocco.ch` after navigating to `tocco.ch` I don't get upgraded to HTTPS. I wonder if HSTS is also failing here (at least for me)

|  | [Peter Gerber (:pege)](/user_profile?user_id=587835)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1721220#c6)• 3 years ago |
|  | |

> I don't understand why this is a security bug if the only problem here is that we present a button? The error cannot be actually bypassed, is that correct?

@agi, no this is wrong, the error can be bypassed. That is the *Accept the Risk and Continue* works. The one exception here is domains on the preload list. There the error can't be bypassed.

|  | [Peter Gerber (:pege)](/user_profile?user_id=587835)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1721220#c7)• 3 years ago |
|  | |

> Interestingly when I try to navigate to abc.tocco.ch after navigating to tocco.ch I don't get upgraded to HTTPS. I wonder if HSTS is also failing here (at least for me)

I just noticed that too. Looks like the is something wrong on the Nightly builds. The icon appears to be wrong. When clicking into the URL bar I actually see an https:// address and even on the error page there is a strike though the lock icon. There also appears to be some issue when tapping on the lock icon, the certificate isn't shown.

(Looks like there was a certificate issued for abc.tocco.ch by accident. I removed it again. Just in case you wondered why no error was shown, that's why.)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1721220#c8)• 3 years ago |
|  | |

(In reply to Peter Gerber (:pege) from [comment #7](/show_bug.cgi?id=1721220#c7 "RESOLVED FIXED - TLS certificate exceptions are possible despite HSTS"))

> > Interestingly when I try to navigate to abc.tocco.ch after navigating to tocco.ch I don't get upgraded to HTTPS. I wonder if HSTS is also failing here (at least for me)
>
> I just noticed that too. Looks like the is something wrong on the Nightly builds. The icon appears to be wrong. When clicking into the URL bar I actually see an https:// address and even on the error page there is a strike though the lock icon.

mh interesting, when clicking on the URL bar I see `http://abc.tocco.ch` and also the network developer tools do confirm it's connecting to the HTTP server. I'll debug a little bit to see what's going on there.

> There also appears to be some issue when tapping on the lock icon, the certificate isn't shown.

Yes I noticed that too earlier and opened [Bug 1723578](/show_bug.cgi?id=1723578 "RESOLVED FIXED - No Certificate information on Fenix nightly") for that.

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1721220#c9)• 3 years ago |
|  | |

As to why we allow upgrading, this bit of info is stored in the `cssClass` property which GV doesn't use at all: <https://searchfox.org/mozilla-central/rev/7b1de5e29d878cc163dec7beaf9b57a2f0f41aaa/docshell/base/nsDocShell.cpp#3515-3517> there's probably a lot of this kind of bugs around error pages.

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1721220#c10)• 3 years ago |
|  | |

This look like we need GV work first to get the correct error codes.

Component: Security: Android → GeneralProduct: Fenix → GeckoView

|  | [Emily Toop (:fluffyemily)](/user_profile?user_id=540010) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1721220#c11)• 3 years ago |
|  | |

We need to take a look at this and see what needs to happen and whether there are any dependencies on other teams.

Flags: needinfo?(agi)Priority: -- → P1Whiteboard: [geckoview:m100]

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1721220#c12)• 3 years ago |
|  | |

I think most of the changes to make this happen are in nsDocShell, which is not really owned by anyone AFAIK. I have an old patch that fixes this that I can resurrect.

Flags: needinfo?(agi)

|  | [Chris Peterson [:cpeterson]](/user_profile?user_id=430528) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1721220#c13)• 3 years ago |
|  | |

We'd like to fix this bug in 101.

Severity: normal → S3Status: UNCONFIRMED → NEWEver confirmed: trueWhiteboard: [geckoview:m100] → [geckoview:m100] [geckoview:m101]

|  | [Chris Peterson [:cpeterson]](/user_profile?user_id=430528) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1721220#c14)• 3 years ago |
|  | |

(In reply to Agi Sferro | :agi | [slow ni? rn sorry] | ⏰ PST | he/him from [comment #12](/show_bug.cgi?id=1721220#c12 "RESOLVED FIXED - TLS certificate exceptions are possible despite HSTS"))

> I think most of the changes to make this happen are in nsDocShell, which is not really owned by anyone AFAIK. I have an old patch that fixes this that I can resurrect.

Agi, do you think you will be able to fix this during the Nightly 101 cycle? This bug has the `[geckoview:m101]` tag.

Should we move this bug from the GeckoView::General component to some Core component?

Flags: needinfo?(agi)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a24448196_421286)• 3 years ago |

Flags: needinfo?(agi)

|  | [Chris Peterson [:cpeterson]](/user_profile?user_id=430528) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a24460282_430528)• 3 years ago |

Whiteboard: [geckoview:m100] [geckoview:m101] → [geckoview:m100] [geckoview:m101] [geckoview:m102]

|  | [Cathy Lu [:calu]](/user_profile?user_id=693351)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a25668150_693351)• 3 years ago |

Assignee: nobody → calu

|  | [Cathy Lu [:calu]](/user_profile?user_id=693351)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1721220#c15)• 3 years ago |
|  | |

Attached file
[Bug 1721220 - Add BAD\_STS\_CERT error](attachment.cgi?id=9276321)
— [Details](attachment.cgi?id=9276321&action=edit)

HSTS (HTTP Strict Transport Security) headers are added to inform browsers that the website should only access urls with https. Any attempts to access http will automatically be converted to https. The bug that this patch fixes is that even though Firefox has the HSTS header loaded, certificate error pages still have the “Accept risk and continue” button, when there should not be an option. This works on desktop but not on Android, so this patch creates a boolean when desktop determines it is a bad sts cert issue, by detecting if it is a sts host or a pinned host. Then it passes the new error code to HandleLoadError. This was manually tested by loading an HSTS header through this website <https://preloaded-hsts.badssl.com/> and then accessing <https://subdomain.preloaded-hsts.badssl.com/>. It was verified that ERROR\_BAD\_STS\_CERT was returned.

|  | [Chris Peterson [:cpeterson]](/user_profile?user_id=430528) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1721220#c16)• 3 years ago |
|  | |

Cathy, will Fenix and GVE need to add frontend code to handle the new `ERROR_BAD_STS_CERT` error code? Or will their existing cert error handling cover this new error code?

[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=affected)
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=affected)
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)Flags: needinfo?(calu)OS: Unspecified → Android

|  | [Cathy Lu [:calu]](/user_profile?user_id=693351)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1721220#c17)• 3 years ago |
|  | |

Hey Chris, yes they will need to handle the new error and not show the button "Accept Risk and Continue"

Flags: needinfo?(calu)

|  | [Chris Peterson [:cpeterson]](/user_profile?user_id=430528) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1721220#c18)• 3 years ago |
|  | |

I filed a new Fenix bug for them to handle the new error: <https://mozilla-hub.atlassian.net/browse/FNXV2-20458>

Setting status-firefox101=wontfix because there's no need to uplift this fix if Fenix 101 isn't handling the new ERROR\_BAD\_STS\_CERT error code.

[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix)
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=wontfix)See Also: → <https://mozilla-hub.atlassian.net/browse/FNXV2-20458>

|  | [Cathy Lu [:calu]](/user_profile?user_id=693351)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1721220#c19)• 3 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #2](/show_bug.cgi?id=1721220#c2 "RESOLVED FIXED - TLS certificate exceptions are possible despite HSTS"))

> rating this `sec-moderate` because it requires the user to explicitly bypass the scary warning, but this is wrong and dangerous.

Hey Daniel, would you be able to take a look at this and see if we should land or uplift the bug fix? Fenix isn't handling the new error code yet. Will this be a security problem if landed or uplifted?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a26708127_1689)• 3 years ago |

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a26708143_1689)• 3 years ago |

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a26726036_1689)• 3 years ago |

Blocks: [1771054](/show_bug.cgi?id=1771054 "RESOLVED FIXED - Users should not be able to bypass TLS certificate error for sites using HSTS (Fenix UI part)")

|  | [Cathy Lu [:calu]](/user_profile?user_id=693351)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a26820645_693351)• 3 years ago |

Blocks: [1771261](/show_bug.cgi?id=1771261 "RESOLVED FIXED - Add a test API to clear HSTS state")

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1721220#c20)• 3 years ago |
|  | |

Add BAD\_STS\_CERT error r=geckoview-reviewers,nika,agi,owlish

<https://hg.mozilla.org/integration/autoland/rev/2a017ac54d0492d3cdbe1f0e7bde176e95185760>

<https://hg.mozilla.org/mozilla-central/rev/2a017ac54d04>

Group: mobile-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 3 years ago
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 102 Branch

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a29098525_551058)• 3 years ago |

QA Whiteboard: [post-critsmash-triage]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a29124723_578488)• 3 years ago |

Whiteboard: [geckoview:m100] [geckoview:m101] [geckoview:m102] → [geckoview:m100] [geckoview:m101] [geckoview:m102][adv-main102+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1721220#c21)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9282611)
— [Details](attachment.cgi?id=9282611&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a29379868_578488)• 3 years ago |

Alias: CVE-2022-34469

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a47215672_1689)• 2 years ago |

Group: core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1721220#a58336689_1689)• 2 years ago |

Flags: needinfo?(dveditz)
You need to [log in](/show_bug.cgi?id=1721220&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Peter Gerber (:pege)](/user_profile?user_id=587835)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_f096317f_20250114_224407.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-24

## Security Vulnerabilities fixed in Firefox 102

Announced
June 28, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 102

*Note*: While [Bug 1771084](https://bugzilla.mozilla.org/show_bug.cgi?id=1771084) does not represent a specific vulnerability that was fixed, we recommend anyone rebasing patches to include it. 102 branch: Patch [1](https://hg.mozilla.org/releases/mozilla-beta/rev/82e3067ad2e7) and [2](https://hg.mozilla.org/releases/mozilla-beta/rev/6e4639dc3614). 91 Branch: Patch [1](https://hg.mozilla.org/releases/mozilla-esr91/rev/72bca7a337e4) and [2](https://hg.mozilla.org/releases/mozilla-esr91/rev/befef01949f2) (Despite saying Parts 2 and 3, there is no Part 1)

#### [#CVE-2022-34479: A popup window could be resized in a way to overlay the address bar with web content](#CVE-2022-34479)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A malicious website that could create a popup could have resized the popup to overlay the address bar with its own content, resulting in potential user confusion or spoofing attacks.
*This bug only affects Firefox for Linux. Other operating systems are unaffected.*

##### References

* [Bug 1745595](https://bugzilla.mozilla.org/show_bug.cgi?id=1745595)

#### [#CVE-2022-34470: Use-after-free in nsSHistory](#CVE-2022-34470)

Reporter
Armin Ebert
Impact
high
##### Description

Session history navigations may have led to a use-after-free and potentially exploitable crash.

##### References

* [Bug 1765951](https://bugzilla.mozilla.org/show_bug.cgi?id=1765951)

#### [#CVE-2022-34468: CSP sandbox header without "allow-scripts" can be bypassed via retargeted javascript: URI](#CVE-2022-34468)

Reporter
Armin Ebert
Impact
high
##### Description

An iframe that was not permitted to run scripts could do so if the user clicked on a `javascript:` link.

##### References

* [Bug 1768537](https://bugzilla.mozilla.org/show_bug.cgi?id=1768537)

#### [#CVE-2022-34482: Drag and drop of malicious image could have led to malicious executable and potential code execution](#CVE-2022-34482)

Reporter
Attila Suszter
Impact
moderate
##### Description

An attacker who could have convinced a user to drag and drop an image to a filesystem could have manipulated the resulting filename to contain an executable extension, and by extension potentially tricked the user into executing malicious code. While very similar, this is a separate issue from CVE-2022-34483.

##### References

* [Bug 845880](https://bugzilla.mozilla.org/show_bug.cgi?id=845880)

#### [#CVE-2022-34483: Drag and drop of malicious image could have led to malicious executable and potential code execution](#CVE-2022-34483)

Reporter
Eduardo Braun Prado
Impact
moderate
##### Description

An attacker who could have convinced a user to drag and drop an image to a filesystem could have manipulated the resulting filename to contain an executable extension, and by extension potentially tricked the user into executing malicious code. While very similar, this is a separate issue from CVE-2022-34482.

##### References

* [Bug 1335845](https://bugzilla.mozilla.org/show_bug.cgi?id=1335845)

#### [#CVE-2022-34476: ASN.1 parser could have been tricked into accepting malformed ASN.1](#CVE-2022-34476)

Reporter
Gustavo Grieco
Impact
moderate
##### Description

ASN.1 parsing of an indefinite SEQUENCE inside an indefinite GROUP could have resulted in the parser accepting malformed ASN.1.

##### References

* [Bug 1387919](https://bugzilla.mozilla.org/show_bug.cgi?id=1387919)

#### [#CVE-2022-34481: Potential integer overflow in ReplaceElementsAt](#CVE-2022-34481)

Reporter
Ronald Crane
Impact
moderate
##### Description

In the `nsTArray_Impl::ReplaceElementsAt()` function, an integer overflow could have occurred when the number of elements to replace was too large for the container.

##### References

* [Bug 1497246](https://bugzilla.mozilla.org/show_bug.cgi?id=1497246)
* [Bug 1483699](https://bugzilla.mozilla.org/show_bug.cgi?id=1483699)

#### [#CVE-2022-34474: Sandboxed iframes could redirect to external schemes](#CVE-2022-34474)

Reporter
Amazon Malvertising Team
Impact
moderate
##### Description

Even when an iframe was sandboxed with `allow-top-navigation-by-user-activation`, if it received a redirect header to an external protocol the browser would process the redirect and prompt the user as appropriate.

##### References

* [Bug 1677138](https://bugzilla.mozilla.org/show_bug.cgi?id=1677138)

#### [#CVE-2022-34469: TLS certificate errors on HSTS-protected domains could be bypassed by the user on Firefox for Android](#CVE-2022-34469)

Reporter
Peter Gerber
Impact
moderate
##### Description

When a TLS Certificate error occurs on a domain protected by the HSTS header, the browser should not allow the user to bypass the certificate error. On Firefox for Android, the user was presented with the option to bypass the error; this could only have been done by the user explicitly.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1721220](https://bugzilla.mozilla.org/show_bug.cgi?id=1721220)

#### [#CVE-2022-34471: Compromised server could trick a browser into an addon downgrade](#CVE-2022-34471)

Reporter
Rob Wu
Impact
moderate
##### Description

When downloading an update for an addon, the downloaded addon update's version was not verified to match the version selected from the manifest. If the manifest had been tampered with on the server, an attacker could trick the browser into downgrading the addon to a prior version.

##### References

* [Bug 1766047](https://bugzilla.mozilla.org/show_bug.cgi?id=1766047)

#### [#CVE-2022-34472: Unavailable PAC file resulted in OCSP requests being blocked](#CVE-2022-34472)

Reporter
Laurent Bigonville
Impact
moderate
##### Description

If there was a PAC URL set and the server that hosts the PAC was not reachable, OCSP requests would have been blocked, resulting in incorrect error pages being shown.

##### References

* [Bug 1770123](https://bugzilla.mozilla.org/show_bug.cgi?id=1770123)

#### [#CVE-2022-34478: Microsoft protocols can be attacked if a user accepts a prompt](#CVE-2022-34478)

Reporter
Gijs
Impact
moderate
##### Description

The `ms-msdt`, `search`, and `search-ms` protocols deliver content to Microsoft applications, bypassing the browser, when a user accepts a prompt. These applications have had known vulnerabilities, exploited in the wild (although we know of none exploited through Firefox), so in this release Firefox has blocked these protocols from prompting the user to open them.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1773717](https://bugzilla.mozilla.org/show_bug.cgi?id=1773717)

#### [#CVE-2022-2200: Undesired attributes could be set as part of prototype pollution](#CVE-2022-2200)

Reporter
Manfred Paul via Trend Micro's Zero Day Initiative
Impact
moderate
##### Description

If an object prototype was corrupted by an attacker, they would have been able to set undesired attributes on a JavaScript object, leading to privileged code execution.

##### References

* [Bug 1771381](https://bugzilla.mozilla.org/show_bug.cgi?id=1771381)

#### [#CVE-2022-34480: Free of uninitialized pointer in lg\_init](#CVE-2022-34480)

Reporter
Ronald Crane
Impact
low
##### Description

Within the `lg_init()` function, if several allocations succeed but then one fails, an uninitialized pointer would have been freed despite never being allocated.

##### References

* [Bug 1454072](https://bugzilla.mozilla.org/show_bug.cgi?id=1454072)

#### [#CVE-2022-34477: MediaError message property leaked information on cross-origin same-site pages](#CVE-2022-34477)

Reporter
jannis
Impact
low
##### Description

The MediaError message property should be consistent to avoid leaking information about cross-origin resources; however for a same-site cross-origin resource, the message could have leaked information enabling XS-Leaks attacks.

##### References

* [Bug 1731614](https://bugzilla.mozilla.org/show_bug.cgi?id=1731614)

#### [#CVE-2022-34475: HTML Sanitizer could have been bypassed via same-origin script via use tags](#CVE-2022-34475)

Reporter
Gareth Heyes
Impact
low
##### Description

SVG `<use>` tags that referenced a same-origin document could have resulted in script execution if attacker input was sanitized via the HTML Sanitizer API. This would have required the attacker to reference a same-origin JavaScript file containing the script to be executed.

##### References

* [Bug 1757210](https://bugzilla.mozilla.org/show_bug.cgi?id=1757210)

#### [#CVE-2022-34473: HTML Sanitizer could have been bypassed via use tags](#CVE-2022-34473)

Reporter
Armin Ebert
Impact
low
##### Description

The HTML Sanitizer should have sanitized the `href` attribute of SVG `<use>` tags; however it incorrectly did not sanitize `xlink:href` attributes.

##### References

* [Bug 1770888](https://bugzilla.mozilla.org/show_bug.cgi?id=1770888)

#### [#CVE-2022-34484: Memory safety bugs fixed in Firefox 102 and Firefox ESR 91.11](#CVE-2022-34484)

Reporter
Mozilla developers and community
Impact
high
##### Description

The Mozilla Fuzzing Team reported potential vulnerabilities present in Firefox 101 and Firefox ESR 91.10. Some of these bugs showed evidence of JavaScript prototype or memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 102 and Firefox ESR 91.11](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1763634%2C1772651)

#### [#CVE-2022-34485: Memory safety bugs fixed in Firefox 102](#CVE-2022-34485)

Reporter
Mozilla developers and community
Impact
moderate
##### Description

Mozilla developers Bryce Seager van Dyk and the Mozilla Fuzzing Team reported potential vulnerabilities present in Firefox 101. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 102](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1768409%2C1768578)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


