=== Content from bugzilla.mozilla.org_0bf7a79e_20250115_102639.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1677138)
* [XML](/show_bug.cgi?ctype=xml&id=1677138)

Closed
[Bug 1677138](/show_bug.cgi?id=1677138)
(CVE-2022-34474)

Opened 4 years ago
Closed 3 years ago

# sandboxed iframes can "redirect" to external schemes

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

sandboxed iframes can "redirect" to external schemes

## Categories

### (Core :: DOM: Core & HTML, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

102 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox-esr91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox83 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox83&o1=equals&v1=wontfix) |
| firefox84 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox84&o1=equals&v1=wontfix) |
| firefox85 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=wontfix) |
| firefox86 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=wontfix) |
| firefox100 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix) |
| firefox101 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=wontfix) |
| firefox102 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 |  | wontfix |
| firefox-esr91 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox83 |  | wontfix |
| firefox84 |  | wontfix |
| firefox85 |  | wontfix |
| firefox86 |  | wontfix |
| firefox100 |  | wontfix |
| firefox101 |  | wontfix |
| firefox102 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: tjr, Assigned: emz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/46f58cc04758e80835820f0f1d5646bb?d=mm&size=40)  [emz](/user_profile?user_id=636491)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/6822db445808be789b12cfae22d118dc?d=mm&size=40)  [tjr](/user_profile?user_id=578488)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b89a42ca4c4d59c27f33c399bb1ecc7b?d=mm&size=40)  [farre](/user_profile?user_id=566192)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1766828](/show_bug.cgi?id=1766828 "RESOLVED FIXED - Ship external protocol sandbox restrictions")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1677138&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1677138)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, Whiteboard: [Fixed by Bug 1766828][post-critsmash-triage][adv-main102+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-34474

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[Fixed by Bug 1766828][post-critsmash-triage][adv-main102+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [btot](/user_profile?user_id=553429) | [qe-verify](#a47771562_553429 "3 years ago") | - |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [ad.html](/attachment.cgi?id=9187695)  [4 years ago](#c0)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   528 bytes, text/html |  | [Details](/attachment.cgi?id=9187695&action=edit) |
| --- | --- | --- |
| [malicious-ad-server.py](/attachment.cgi?id=9187696)  [4 years ago](#c1)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   806 bytes, text/plain |  | [Details](/attachment.cgi?id=9187696&action=edit) |
| [publisher.py](/attachment.cgi?id=9187697)  [4 years ago](#c2)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   1.53 KB, text/plain |  | [Details](/attachment.cgi?id=9187697&action=edit) |
| [advisory.txt](/attachment.cgi?id=9282620)  [3 years ago](#c32)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   306 bytes, text/plain |  | [Details](/attachment.cgi?id=9282620&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1677138#c0)• 4 years ago |
|  | |

Attached file
[ad.html](attachment.cgi?id=9187695)
— [Details](attachment.cgi?id=9187695&action=edit)

This was sent into the security list:

We’ve recently discovered a malicious ad campaign that is taking advantage of iFrames to attempt to redirect the user to a different app. When the ad is served in an iFrame in the publisher page and ad server sends a redirect header, we have observed that Firefox in macOS and Android does not actually ignore these redirect attempts but asks the user the permission to redirect to the app even when the iFrame is appropriately sandboxed with allow-top-navigation-by-user-activation. We have so far tested this with the schemes listed below as the value of the "Location" parameter for the header:

MacOS Schemes

* "itms-apps://",
* "itms-appss://",
* "itms://",
* "itmss://",
* "<https://itunes.apple.com/app/>",
* "ibooks://",
* "itms-books://",
* "itms-bookss://",
* "contact://",
* "message://",
* "sms://",
* "music://",
* "musics://",
* "podcasts://",
* "itms-podcasts://",
* "podcast://",
* "tel://"

Android Schemes

* "Intent://"

For example, when the "Location" value of the header is "itms-apps://itunes.apple.com/app/id378458261", Firefox attempted to open the app with id id378458261 in AppStore in MacOS. When the "Location" value of the header is "intent://#Intent;package=com.vtaxi.app;S.market\_referrer=appmetrica\_tracking\_id%253D602904027453287968%2526ym\_tracking\_id%253D9847664011024495609;end", Firefox redirected to the Google Play page of that app.

I have produced a working POC with Firefox 78.4.0esr (64-bit) on my macOs 10.15.7 and with Firefox 82.1.3 (Build #2015774645) on Pixel 4 with Android 11.

I have also attached the proof of concept code that performs the attack. I have produced a working POC using the setup I described below:

1. Run malicious-ad-server.py with python3 to serve ad.html in an iFrame using ngrok on port 8000.
2. Run publisher.py with python3 to serve PUBLISHER-DOMAIN/safe and PUBLISHER-DOMAIN/unsafe paths using ngrok, on a different machine than the malicious server. (You also need to change "src" value of the iFrames in publisher.py to "MALICIOUS-SERVER-DOMAIN/ad.html"). PUBLISHER-DOMAIN/unsafe serves the ad in an iFrame without sandbox attributes whereas PUBLISHER-DOMAIN/safe serves the ad in a sandboxed iframe with attributes:

* "allow-top-navigation-by-user-activation"
* "allow-forms"
* "allow-pointer-lock"
* "allow-popups"
* "allow-popups-to-escape-sandbox"
* "allow-same-origin"
* "allow-scripts"

3. Using a 3rd device, visit publisher site's /safe and /unsafe pages.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1677138#c1)• 4 years ago |
|  | |

Attached file
[malicious-ad-server.py](attachment.cgi?id=9187696)
— [Details](attachment.cgi?id=9187696&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1677138#c2)• 4 years ago |
|  | |

Attached file
[publisher.py](attachment.cgi?id=9187697)
— [Details](attachment.cgi?id=9187697&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1677138#c3)• 4 years ago |
|  | |

After clarifying, they confirmed this was an issue on macOS (Desktop) and Firefox for Android; not Firefox for iOS.

I'm moving the the OSX component but the Fenix fix may be different...

Group: mobile-core-security → core-securityComponent: Security: Android → Widget: CocoaFlags: needinfo?(sarentz)Product: Fenix → Core

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a14811_159069)• 4 years ago |

[Attachment #9187696](/attachment.cgi?id=9187696&action=edit "malicious-ad-server.py") -
Attachment mime type: text/x-python-script → text/plain

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a14825_159069)• 4 years ago |

[Attachment #9187697](/attachment.cgi?id=9187697&action=edit "publisher.py") -
Attachment mime type: text/x-python-script → text/plain

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1677138#c4)• 4 years ago |
|  | |

If the navigation happens that's an issue with iframe sandboxing, not with cocoa widget code, so moving over there.

Note that from the attached testcase, I guess the frame has:

> sandbox="allow-top-navigation-by-user-activation allow-forms allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"

so I think this is maybe expected, because of `allow-popups` and `allow-popups-to-escape-sandbox` ? But I am not au fait with the current discussions around sandboxing, so perhaps Anne or Christoph can look?

This also feels like something we have on file, perhaps not as a sec bug, but I don't have a bug to hand.

Group: core-security → dom-core-securityComponent: Widget: Cocoa → DOM: SecurityFlags: needinfo?(ckerschb)Flags: needinfo?(annevk)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1677138#c5)• 4 years ago |
|  | |

Johann and Paul are tackling non-browser URL schemes so I'll let them speak to this. (See also [bug 1565574](/show_bug.cgi?id=1565574 "VERIFIED FIXED - 'Always allow' for external protocol / scheme handling should be a per-origin permission").)

Flags: needinfo?(pbz)Flags: needinfo?(jhofmann)Flags: needinfo?(ckerschb)Flags: needinfo?(annevk)

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1677138#c6)• 4 years ago |
|  | |

So, without having run the POC, is it correct to summarize that the issue is that iframes can open external protocols without user interaction, even in a sandbox?

I think we're currently coming to the conclusion that even without a sandbox, this capability might be problematic for most protocols, which is what we're trying to change in <https://github.com/whatwg/html/issues/6111> by adding a permissions policy attribute to restrict this by default. Paul is currently adding Telemetry for that.

Independent of that there's probably still a bug here, though, as the navigation itself shouldn't happen because of the sandbox? I haven't looked into that. It seems like a valid security issue.

Flags: needinfo?(jhofmann)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1677138#c7)• 4 years ago |
|  | |

With respect to `allow-popups-to-escape-sandbox`, is the link opened in a popup-way, e.g., with a `target` attribute or `window.open()`? Otherwise it seems that should not apply (although maybe, the rules on these URL schemes are not written down) and only `allow-top-navigation-by-user-activation` would be the potential escape here (if there was user activation).

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1677138#c8)• 4 years ago |
|  | |

(Note that popups also need user activation to open)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1677138#c9)• 4 years ago |
|  | |

(In reply to Johann Hofmann [:johannh] from [comment #6](/show_bug.cgi?id=1677138#c6 "RESOLVED FIXED - sandboxed iframes can \"redirect\" to external schemes"))

> Independent of that there's probably still a bug here, though, as the navigation itself shouldn't happen because of the sandbox? I haven't looked into that. It seems like a valid security issue.

Yes, I think we shouldn't allow the prompt / forward to the protocol handler in this case.

The problem is probably that the actual navigation to the external protocol is not happening top level, but in the frame. We then prompt and open the handler either top level in a new tab (web handler) or launch the external application. Perhaps navigation to external protocols should always be treated as a top level navigation sandbox wise, since we handle it that way.

Flags: needinfo?(pbz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a350795_1689)• 4 years ago |

Component: DOM: Security → DOM: Core & HTML

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a350864_1689)• 4 years ago |

Summary: Redirects from iframes occurring despite restrictions via iframe sandbox → sandboxed iframes can "redirect" to external schemes

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1677138#c10)• 4 years ago |
|  | |

Paul, can you test what other browsers are doing here? Is it worth including sandboxed as a key in our new telemetry?

Thanks!

Flags: needinfo?(pbz)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1677138#c11)• 4 years ago |
|  | |

The telemetry for [Bug 1672344](/show_bug.cgi?id=1672344 "RESOLVED FIXED - Add telemetry for measuring usage of external protocol navigations initiated by third-party iframes") now also checks for null principal.

Flags: needinfo?(pbz)

|  | [amazon.malvertising.outreach](/user_profile?user_id=674443) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1677138#c12)• 4 years ago |
|  | |

Hi Mozilla security,

This vulnerability is being actively exploited in the wild. Do you have an ETA for a fix?

Thanks,

Amazon malvertising team

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1677138#c13)• 4 years ago |
|  | |

Side note: Since the change in [Bug 1679456](/show_bug.cgi?id=1679456 "RESOLVED FIXED - Remove popup opening tokens (replacing them by user activation consumption).") we're requiring user activation for frames to redirect to external protocols. This should partially mitigate this issue.

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1677138#c14)• 4 years ago |
|  | |

We should check that [bug 1680721](/show_bug.cgi?id=1680721 "RESOLVED FIXED - Zoom links from google calendar no longer auto-open with dom.delay.block_external_protocol_in_iframes.enabled=false") will keep this bug fixed and close it as resolved then. Depending on the frequency of this being exploited in the wild we should have a follow-up discussion around whether we can uplift that changeset to Beta.

Severity: -- → S3
[status-firefox84](/buglist.cgi?f1=cf_status_firefox84&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox84&o1=equals&v1=affected)
[status-firefox85](/buglist.cgi?f1=cf_status_firefox85&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=affected)Flags: needinfo?(jhofmann)Flags: needinfo?(emilio)Priority: -- → P1

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a2096923_522029)• 4 years ago |

[status-firefox83](/buglist.cgi?f1=cf_status_firefox83&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox83&o1=equals&v1=wontfix)Flags: needinfo?(jhofmann)

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a2096962_522029)• 4 years ago |

Flags: needinfo?(jhofmann)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1677138#c15)• 4 years ago |
|  | |

Yeah, I think the main question is whether we want to uplift those patches *and* turn `dom.delay.block_external_protocol_in_iframes.enabled=false` everywhere (which should be fine).

I'm not on mac but I suspect that bug will keep it fixed, if my reading of [comment 0](/show_bug.cgi?id=1677138#c0 "RESOLVED FIXED - sandboxed iframes can \"redirect\" to external schemes") is right, as it relies on a cross-origin iframe which wouldn't be allowed to do this without user-activation.

Flags: needinfo?(emilio)

|  | [Emilio Cobos Álvarez (:emilio)](/user_profile?user_id=546716) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1677138#c16)• 4 years ago |
|  | |

Ah, hold on, or maybe not, if the frame is embedded by the top level page. We should still probably have tighter checks for sandboxed frames in any case though.

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1677138#c17)• 4 years ago |
|  | |

(In reply to Emilio Cobos Álvarez (:emilio) from [comment #15](/show_bug.cgi?id=1677138#c15 "RESOLVED FIXED - sandboxed iframes can \"redirect\" to external schemes"))

> Yeah, I think the main question is whether we want to uplift those patches *and* turn `dom.delay.block_external_protocol_in_iframes.enabled=false` everywhere (which should be fine).

Yes that would be my suggestion, too.. I can't really imagine that we'd be breaking a lot of sites by going from "every 10s" to "once then with user interaction". (Unless I'm misinterpreting the effect of that pref here)

> I'm not on mac but I suspect that bug will keep it fixed, if my reading of [comment 0](/show_bug.cgi?id=1677138#c0 "RESOLVED FIXED - sandboxed iframes can \"redirect\" to external schemes") is right, as it relies on a cross-origin iframe which wouldn't be allowed to do this without user-activation.

Yes, this is about sandboxed iframes specifically, which are always cross-origin. I guess

> Ah, hold on, or maybe not, if the frame is embedded by the top level page. We should still probably have tighter checks for sandboxed frames in any case though.

If it's cross-origin (e.g. an opaque origin) it should still not get the free initial protocol navigation without user interaction, right? So we're a bit better already.

The complete fix to this bug is probably to enact the sandbox restrictions proposed in <https://github.com/whatwg/html/issues/2191>. So it makes sense to leave it open to track that work.

Reporter, did you report this issue to other browser vendors? Looking at the standards issue this should be an issue in other browsers, too.

Thanks!

Flags: needinfo?(sarentz)Flags: needinfo?(jhofmann)Flags: needinfo?(amazon.malvertising.outreach)

|  | [amazon.malvertising.outreach](/user_profile?user_id=674443) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1677138#c18)• 4 years ago |
|  | |

> Reporter, did you report this issue to other browser vendors? Looking at the standards issue this should be an issue in other browsers, too.
>
> Thanks!

Yes, we have reported this issue to Chrome security team as well.

Flags: needinfo?(amazon.malvertising.outreach)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a2875845_1689)• 4 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [amazon.malvertising.outreach](/user_profile?user_id=674443) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1677138#c19)• 4 years ago |
|  | |

Hi Firefox Security teams,

After 90 days we will share the vulnerability with selected trusted threat sharing partners regardless of whether it has been fixed in order to protect end users.

Thanks,

Amazon malvertising team

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a4581020_580382)• 4 years ago |

[status-firefox84](/buglist.cgi?f1=cf_status_firefox84&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox84&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox84&o1=equals&v1=wontfix)
[status-firefox86](/buglist.cgi?f1=cf_status_firefox86&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected)

|  | [Neha Kochar [:neha]](/user_profile?user_id=627348) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1677138#c20)• 4 years ago |
|  | |

Anne, what is your recommendation for next steps here? Looks like Chrome's bug is closed as wontfix.

Flags: needinfo?(annevk)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1677138#c21)• 4 years ago |
|  | |

Do you have a reference to Chrome's bug? I don't see it.

There's two pieces here:

1. How to deal with custom URL schemes in general. [Bug 1626068](/show_bug.cgi?id=1626068 "NEW - Try to not expose known/unknown protocols so easily.") will tackle that.
2. How to deal with them in sandboxed environments as pointed out in [comment 17](/show_bug.cgi?id=1677138#c17 "RESOLVED FIXED - sandboxed iframes can \"redirect\" to external schemes"). The solution from <https://github.com/whatwg/html/issues/2191> to only allow fetch schemes in a sandboxed environment seems still rather attractive, but would require some amount of investigation.

(Also, initially we allowed this without user activation which is no longer the case. So it's not clear to me this bug needs to remain closed.)

Flags: needinfo?(annevk) → needinfo?(nkochar)

|  | [Neha Kochar [:neha]](/user_profile?user_id=627348) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1677138#c22)• 4 years ago |
|  | |

Oh, the Chrome's bug that I was referring is for #2 from [comment 17](/show_bug.cgi?id=1677138#c17 "RESOLVED FIXED - sandboxed iframes can \"redirect\" to external schemes"). The bug is <https://bugs.chromium.org/p/chromium/issues/detail?id=329000> which is referenced from <https://github.com/whatwg/html/issues/2191> .

Flags: needinfo?(nkochar)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1677138#c23)• 4 years ago |
|  | |

I see, that's an old bug specific to iOS, so I would expect Chrome to still be willing to make changes here as per Mike West's comments in the HTML issue.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1677138#c24)• 3 years ago |
|  | |

Johann, what's the status here? You talked about some other bug being fixed, and it has been fixed. Thanks.

Flags: needinfo?(jhofmann)

|  | [Stefan Arentz | :st3fan | ⏰ EST | he/him](/user_profile?user_id=388264) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1677138#c25)• 3 years ago |
|  | |

This bug needs to be verified on Fenix and Focus Android too. Who can help with that?

|  | [amazon.malvertising.outreach](/user_profile?user_id=674443) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1677138#c26)• 3 years ago |
|  | |

Hi Firefox Security teams,

We have tested the vulnerability again on Firefox 92.0 (64 bit) on Mac and we can confirm that the vulnerability is not fixed.

Could you give an update on the ETA please?

Thanks,

Amazon malvertising team

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1677138#c27)• 3 years ago |
|  | |

Both Chrome and us are still waiting on Microsoft Teams to ship an update that adds the correct sandbox flags before we can start enacting the restriction proposed in <https://github.com/whatwg/html/issues/2191>.

Paul (:pbz) is directly in contact with Microsoft and will follow-up once they get to a solution.

Flags: needinfo?(mail) → needinfo?(pbz)

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1677138#c28)• 3 years ago |
|  | |

After chatting with Ethan, assigning to Paul and adjusting the priority.

Mentor: pbzPriority: P1 → P2

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1677138#c29)• 3 years ago |
|  | |

(In reply to Hsin-Yi Tsai [:hsinyi] from [comment #28](/show_bug.cgi?id=1677138#c28 "RESOLVED FIXED - sandboxed iframes can \"redirect\" to external schemes"))

> After chatting with Ethan, assigning to Paul and adjusting the priority.

Going to assume you meant to actually assign, not make Paul the mentor...

Assignee: nobody → pbzMentor: pbz

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1677138#c30)• 3 years ago |
|  | |

Looks like we have alignment with Microsoft now. They've submitted a PR to add a new sandbox flag `allow-top-navigation-to-custom-protocols`. There is also a patch for Chromium, behind a feature flag: <https://chromestatus.com/feature/5680742077038592>

I think we can follow this approach and start enforcing sandbox for custom protocol navigation in Nightly.

Flags: needinfo?(pbz)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1677138#c31)• 3 years ago |
|  | |

I've submitted patches in [Bug 1735746](/show_bug.cgi?id=1735746 "RESOLVED FIXED - Block external protocol handler with sandbox.").

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a46378286_636491)• 3 years ago |

Status: NEW → RESOLVEDClosed: 3 years ago
[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix)
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=wontfix)
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed)
[status-firefox85](/buglist.cgi?f1=cf_status_firefox85&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=wontfix)
[status-firefox86](/buglist.cgi?f1=cf_status_firefox86&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=wontfix)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)Resolution: --- → FIXEDWhiteboard: [Fixed by Bug 1766828]Target Milestone: --- → 102 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a46435846_75935)• 3 years ago |

Group: dom-core-security → core-security-release
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)Depends on: [1766828](/show_bug.cgi?id=1766828 "RESOLVED FIXED - Ship external protocol sandbox restrictions")

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a47771562_553429)• 3 years ago |

Flags: qe-verify-Whiteboard: [Fixed by Bug 1766828] → [Fixed by Bug 1766828][post-critsmash-triage]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a50570622_578488)• 3 years ago |

Whiteboard: [Fixed by Bug 1766828][post-critsmash-triage] → [Fixed by Bug 1766828][post-critsmash-triage][adv-main102+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Reporter |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1677138#c32)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9282620)
— [Details](attachment.cgi?id=9282620&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a50800830_578488)• 3 years ago |

Alias: CVE-2022-34474

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1677138#a68646740_1689)• 2 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1677138&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Tom Ritter [:tjr]](/user_profile?user_id=578488)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_f096317f_20250115_102640.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-24

## Security Vulnerabilities fixed in Firefox 102

Announced
June 28, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 102

*Note*: While [Bug 1771084](https://bugzilla.mozilla.org/show_bug.cgi?id=1771084) does not represent a specific vulnerability that was fixed, we recommend anyone rebasing patches to include it. 102 branch: Patch [1](https://hg.mozilla.org/releases/mozilla-beta/rev/82e3067ad2e7) and [2](https://hg.mozilla.org/releases/mozilla-beta/rev/6e4639dc3614). 91 Branch: Patch [1](https://hg.mozilla.org/releases/mozilla-esr91/rev/72bca7a337e4) and [2](https://hg.mozilla.org/releases/mozilla-esr91/rev/befef01949f2) (Despite saying Parts 2 and 3, there is no Part 1)

#### [#CVE-2022-34479: A popup window could be resized in a way to overlay the address bar with web content](#CVE-2022-34479)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A malicious website that could create a popup could have resized the popup to overlay the address bar with its own content, resulting in potential user confusion or spoofing attacks.
*This bug only affects Firefox for Linux. Other operating systems are unaffected.*

##### References

* [Bug 1745595](https://bugzilla.mozilla.org/show_bug.cgi?id=1745595)

#### [#CVE-2022-34470: Use-after-free in nsSHistory](#CVE-2022-34470)

Reporter
Armin Ebert
Impact
high
##### Description

Session history navigations may have led to a use-after-free and potentially exploitable crash.

##### References

* [Bug 1765951](https://bugzilla.mozilla.org/show_bug.cgi?id=1765951)

#### [#CVE-2022-34468: CSP sandbox header without "allow-scripts" can be bypassed via retargeted javascript: URI](#CVE-2022-34468)

Reporter
Armin Ebert
Impact
high
##### Description

An iframe that was not permitted to run scripts could do so if the user clicked on a `javascript:` link.

##### References

* [Bug 1768537](https://bugzilla.mozilla.org/show_bug.cgi?id=1768537)

#### [#CVE-2022-34482: Drag and drop of malicious image could have led to malicious executable and potential code execution](#CVE-2022-34482)

Reporter
Attila Suszter
Impact
moderate
##### Description

An attacker who could have convinced a user to drag and drop an image to a filesystem could have manipulated the resulting filename to contain an executable extension, and by extension potentially tricked the user into executing malicious code. While very similar, this is a separate issue from CVE-2022-34483.

##### References

* [Bug 845880](https://bugzilla.mozilla.org/show_bug.cgi?id=845880)

#### [#CVE-2022-34483: Drag and drop of malicious image could have led to malicious executable and potential code execution](#CVE-2022-34483)

Reporter
Eduardo Braun Prado
Impact
moderate
##### Description

An attacker who could have convinced a user to drag and drop an image to a filesystem could have manipulated the resulting filename to contain an executable extension, and by extension potentially tricked the user into executing malicious code. While very similar, this is a separate issue from CVE-2022-34482.

##### References

* [Bug 1335845](https://bugzilla.mozilla.org/show_bug.cgi?id=1335845)

#### [#CVE-2022-34476: ASN.1 parser could have been tricked into accepting malformed ASN.1](#CVE-2022-34476)

Reporter
Gustavo Grieco
Impact
moderate
##### Description

ASN.1 parsing of an indefinite SEQUENCE inside an indefinite GROUP could have resulted in the parser accepting malformed ASN.1.

##### References

* [Bug 1387919](https://bugzilla.mozilla.org/show_bug.cgi?id=1387919)

#### [#CVE-2022-34481: Potential integer overflow in ReplaceElementsAt](#CVE-2022-34481)

Reporter
Ronald Crane
Impact
moderate
##### Description

In the `nsTArray_Impl::ReplaceElementsAt()` function, an integer overflow could have occurred when the number of elements to replace was too large for the container.

##### References

* [Bug 1497246](https://bugzilla.mozilla.org/show_bug.cgi?id=1497246)
* [Bug 1483699](https://bugzilla.mozilla.org/show_bug.cgi?id=1483699)

#### [#CVE-2022-34474: Sandboxed iframes could redirect to external schemes](#CVE-2022-34474)

Reporter
Amazon Malvertising Team
Impact
moderate
##### Description

Even when an iframe was sandboxed with `allow-top-navigation-by-user-activation`, if it received a redirect header to an external protocol the browser would process the redirect and prompt the user as appropriate.

##### References

* [Bug 1677138](https://bugzilla.mozilla.org/show_bug.cgi?id=1677138)

#### [#CVE-2022-34469: TLS certificate errors on HSTS-protected domains could be bypassed by the user on Firefox for Android](#CVE-2022-34469)

Reporter
Peter Gerber
Impact
moderate
##### Description

When a TLS Certificate error occurs on a domain protected by the HSTS header, the browser should not allow the user to bypass the certificate error. On Firefox for Android, the user was presented with the option to bypass the error; this could only have been done by the user explicitly.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1721220](https://bugzilla.mozilla.org/show_bug.cgi?id=1721220)

#### [#CVE-2022-34471: Compromised server could trick a browser into an addon downgrade](#CVE-2022-34471)

Reporter
Rob Wu
Impact
moderate
##### Description

When downloading an update for an addon, the downloaded addon update's version was not verified to match the version selected from the manifest. If the manifest had been tampered with on the server, an attacker could trick the browser into downgrading the addon to a prior version.

##### References

* [Bug 1766047](https://bugzilla.mozilla.org/show_bug.cgi?id=1766047)

#### [#CVE-2022-34472: Unavailable PAC file resulted in OCSP requests being blocked](#CVE-2022-34472)

Reporter
Laurent Bigonville
Impact
moderate
##### Description

If there was a PAC URL set and the server that hosts the PAC was not reachable, OCSP requests would have been blocked, resulting in incorrect error pages being shown.

##### References

* [Bug 1770123](https://bugzilla.mozilla.org/show_bug.cgi?id=1770123)

#### [#CVE-2022-34478: Microsoft protocols can be attacked if a user accepts a prompt](#CVE-2022-34478)

Reporter
Gijs
Impact
moderate
##### Description

The `ms-msdt`, `search`, and `search-ms` protocols deliver content to Microsoft applications, bypassing the browser, when a user accepts a prompt. These applications have had known vulnerabilities, exploited in the wild (although we know of none exploited through Firefox), so in this release Firefox has blocked these protocols from prompting the user to open them.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1773717](https://bugzilla.mozilla.org/show_bug.cgi?id=1773717)

#### [#CVE-2022-2200: Undesired attributes could be set as part of prototype pollution](#CVE-2022-2200)

Reporter
Manfred Paul via Trend Micro's Zero Day Initiative
Impact
moderate
##### Description

If an object prototype was corrupted by an attacker, they would have been able to set undesired attributes on a JavaScript object, leading to privileged code execution.

##### References

* [Bug 1771381](https://bugzilla.mozilla.org/show_bug.cgi?id=1771381)

#### [#CVE-2022-34480: Free of uninitialized pointer in lg\_init](#CVE-2022-34480)

Reporter
Ronald Crane
Impact
low
##### Description

Within the `lg_init()` function, if several allocations succeed but then one fails, an uninitialized pointer would have been freed despite never being allocated.

##### References

* [Bug 1454072](https://bugzilla.mozilla.org/show_bug.cgi?id=1454072)

#### [#CVE-2022-34477: MediaError message property leaked information on cross-origin same-site pages](#CVE-2022-34477)

Reporter
jannis
Impact
low
##### Description

The MediaError message property should be consistent to avoid leaking information about cross-origin resources; however for a same-site cross-origin resource, the message could have leaked information enabling XS-Leaks attacks.

##### References

* [Bug 1731614](https://bugzilla.mozilla.org/show_bug.cgi?id=1731614)

#### [#CVE-2022-34475: HTML Sanitizer could have been bypassed via same-origin script via use tags](#CVE-2022-34475)

Reporter
Gareth Heyes
Impact
low
##### Description

SVG `<use>` tags that referenced a same-origin document could have resulted in script execution if attacker input was sanitized via the HTML Sanitizer API. This would have required the attacker to reference a same-origin JavaScript file containing the script to be executed.

##### References

* [Bug 1757210](https://bugzilla.mozilla.org/show_bug.cgi?id=1757210)

#### [#CVE-2022-34473: HTML Sanitizer could have been bypassed via use tags](#CVE-2022-34473)

Reporter
Armin Ebert
Impact
low
##### Description

The HTML Sanitizer should have sanitized the `href` attribute of SVG `<use>` tags; however it incorrectly did not sanitize `xlink:href` attributes.

##### References

* [Bug 1770888](https://bugzilla.mozilla.org/show_bug.cgi?id=1770888)

#### [#CVE-2022-34484: Memory safety bugs fixed in Firefox 102 and Firefox ESR 91.11](#CVE-2022-34484)

Reporter
Mozilla developers and community
Impact
high
##### Description

The Mozilla Fuzzing Team reported potential vulnerabilities present in Firefox 101 and Firefox ESR 91.10. Some of these bugs showed evidence of JavaScript prototype or memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 102 and Firefox ESR 91.11](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1763634%2C1772651)

#### [#CVE-2022-34485: Memory safety bugs fixed in Firefox 102](#CVE-2022-34485)

Reporter
Mozilla developers and community
Impact
moderate
##### Description

Mozilla developers Bryce Seager van Dyk and the Mozilla Fuzzing Team reported potential vulnerabilities present in Firefox 101. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 102](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1768409%2C1768578)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


