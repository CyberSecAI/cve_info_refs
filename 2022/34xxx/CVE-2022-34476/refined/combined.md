=== Content from www.mozilla.org_f096317f_20250114_210500.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-24

## Security Vulnerabilities fixed in Firefox 102

Announced
June 28, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 102

*Note*: While [Bug 1771084](https://bugzilla.mozilla.org/show_bug.cgi?id=1771084) does not represent a specific vulnerability that was fixed, we recommend anyone rebasing patches to include it. 102 branch: Patch [1](https://hg.mozilla.org/releases/mozilla-beta/rev/82e3067ad2e7) and [2](https://hg.mozilla.org/releases/mozilla-beta/rev/6e4639dc3614). 91 Branch: Patch [1](https://hg.mozilla.org/releases/mozilla-esr91/rev/72bca7a337e4) and [2](https://hg.mozilla.org/releases/mozilla-esr91/rev/befef01949f2) (Despite saying Parts 2 and 3, there is no Part 1)

#### [#CVE-2022-34479: A popup window could be resized in a way to overlay the address bar with web content](#CVE-2022-34479)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A malicious website that could create a popup could have resized the popup to overlay the address bar with its own content, resulting in potential user confusion or spoofing attacks.
*This bug only affects Firefox for Linux. Other operating systems are unaffected.*

##### References

* [Bug 1745595](https://bugzilla.mozilla.org/show_bug.cgi?id=1745595)

#### [#CVE-2022-34470: Use-after-free in nsSHistory](#CVE-2022-34470)

Reporter
Armin Ebert
Impact
high
##### Description

Session history navigations may have led to a use-after-free and potentially exploitable crash.

##### References

* [Bug 1765951](https://bugzilla.mozilla.org/show_bug.cgi?id=1765951)

#### [#CVE-2022-34468: CSP sandbox header without "allow-scripts" can be bypassed via retargeted javascript: URI](#CVE-2022-34468)

Reporter
Armin Ebert
Impact
high
##### Description

An iframe that was not permitted to run scripts could do so if the user clicked on a `javascript:` link.

##### References

* [Bug 1768537](https://bugzilla.mozilla.org/show_bug.cgi?id=1768537)

#### [#CVE-2022-34482: Drag and drop of malicious image could have led to malicious executable and potential code execution](#CVE-2022-34482)

Reporter
Attila Suszter
Impact
moderate
##### Description

An attacker who could have convinced a user to drag and drop an image to a filesystem could have manipulated the resulting filename to contain an executable extension, and by extension potentially tricked the user into executing malicious code. While very similar, this is a separate issue from CVE-2022-34483.

##### References

* [Bug 845880](https://bugzilla.mozilla.org/show_bug.cgi?id=845880)

#### [#CVE-2022-34483: Drag and drop of malicious image could have led to malicious executable and potential code execution](#CVE-2022-34483)

Reporter
Eduardo Braun Prado
Impact
moderate
##### Description

An attacker who could have convinced a user to drag and drop an image to a filesystem could have manipulated the resulting filename to contain an executable extension, and by extension potentially tricked the user into executing malicious code. While very similar, this is a separate issue from CVE-2022-34482.

##### References

* [Bug 1335845](https://bugzilla.mozilla.org/show_bug.cgi?id=1335845)

#### [#CVE-2022-34476: ASN.1 parser could have been tricked into accepting malformed ASN.1](#CVE-2022-34476)

Reporter
Gustavo Grieco
Impact
moderate
##### Description

ASN.1 parsing of an indefinite SEQUENCE inside an indefinite GROUP could have resulted in the parser accepting malformed ASN.1.

##### References

* [Bug 1387919](https://bugzilla.mozilla.org/show_bug.cgi?id=1387919)

#### [#CVE-2022-34481: Potential integer overflow in ReplaceElementsAt](#CVE-2022-34481)

Reporter
Ronald Crane
Impact
moderate
##### Description

In the `nsTArray_Impl::ReplaceElementsAt()` function, an integer overflow could have occurred when the number of elements to replace was too large for the container.

##### References

* [Bug 1497246](https://bugzilla.mozilla.org/show_bug.cgi?id=1497246)
* [Bug 1483699](https://bugzilla.mozilla.org/show_bug.cgi?id=1483699)

#### [#CVE-2022-34474: Sandboxed iframes could redirect to external schemes](#CVE-2022-34474)

Reporter
Amazon Malvertising Team
Impact
moderate
##### Description

Even when an iframe was sandboxed with `allow-top-navigation-by-user-activation`, if it received a redirect header to an external protocol the browser would process the redirect and prompt the user as appropriate.

##### References

* [Bug 1677138](https://bugzilla.mozilla.org/show_bug.cgi?id=1677138)

#### [#CVE-2022-34469: TLS certificate errors on HSTS-protected domains could be bypassed by the user on Firefox for Android](#CVE-2022-34469)

Reporter
Peter Gerber
Impact
moderate
##### Description

When a TLS Certificate error occurs on a domain protected by the HSTS header, the browser should not allow the user to bypass the certificate error. On Firefox for Android, the user was presented with the option to bypass the error; this could only have been done by the user explicitly.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1721220](https://bugzilla.mozilla.org/show_bug.cgi?id=1721220)

#### [#CVE-2022-34471: Compromised server could trick a browser into an addon downgrade](#CVE-2022-34471)

Reporter
Rob Wu
Impact
moderate
##### Description

When downloading an update for an addon, the downloaded addon update's version was not verified to match the version selected from the manifest. If the manifest had been tampered with on the server, an attacker could trick the browser into downgrading the addon to a prior version.

##### References

* [Bug 1766047](https://bugzilla.mozilla.org/show_bug.cgi?id=1766047)

#### [#CVE-2022-34472: Unavailable PAC file resulted in OCSP requests being blocked](#CVE-2022-34472)

Reporter
Laurent Bigonville
Impact
moderate
##### Description

If there was a PAC URL set and the server that hosts the PAC was not reachable, OCSP requests would have been blocked, resulting in incorrect error pages being shown.

##### References

* [Bug 1770123](https://bugzilla.mozilla.org/show_bug.cgi?id=1770123)

#### [#CVE-2022-34478: Microsoft protocols can be attacked if a user accepts a prompt](#CVE-2022-34478)

Reporter
Gijs
Impact
moderate
##### Description

The `ms-msdt`, `search`, and `search-ms` protocols deliver content to Microsoft applications, bypassing the browser, when a user accepts a prompt. These applications have had known vulnerabilities, exploited in the wild (although we know of none exploited through Firefox), so in this release Firefox has blocked these protocols from prompting the user to open them.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1773717](https://bugzilla.mozilla.org/show_bug.cgi?id=1773717)

#### [#CVE-2022-2200: Undesired attributes could be set as part of prototype pollution](#CVE-2022-2200)

Reporter
Manfred Paul via Trend Micro's Zero Day Initiative
Impact
moderate
##### Description

If an object prototype was corrupted by an attacker, they would have been able to set undesired attributes on a JavaScript object, leading to privileged code execution.

##### References

* [Bug 1771381](https://bugzilla.mozilla.org/show_bug.cgi?id=1771381)

#### [#CVE-2022-34480: Free of uninitialized pointer in lg\_init](#CVE-2022-34480)

Reporter
Ronald Crane
Impact
low
##### Description

Within the `lg_init()` function, if several allocations succeed but then one fails, an uninitialized pointer would have been freed despite never being allocated.

##### References

* [Bug 1454072](https://bugzilla.mozilla.org/show_bug.cgi?id=1454072)

#### [#CVE-2022-34477: MediaError message property leaked information on cross-origin same-site pages](#CVE-2022-34477)

Reporter
jannis
Impact
low
##### Description

The MediaError message property should be consistent to avoid leaking information about cross-origin resources; however for a same-site cross-origin resource, the message could have leaked information enabling XS-Leaks attacks.

##### References

* [Bug 1731614](https://bugzilla.mozilla.org/show_bug.cgi?id=1731614)

#### [#CVE-2022-34475: HTML Sanitizer could have been bypassed via same-origin script via use tags](#CVE-2022-34475)

Reporter
Gareth Heyes
Impact
low
##### Description

SVG `<use>` tags that referenced a same-origin document could have resulted in script execution if attacker input was sanitized via the HTML Sanitizer API. This would have required the attacker to reference a same-origin JavaScript file containing the script to be executed.

##### References

* [Bug 1757210](https://bugzilla.mozilla.org/show_bug.cgi?id=1757210)

#### [#CVE-2022-34473: HTML Sanitizer could have been bypassed via use tags](#CVE-2022-34473)

Reporter
Armin Ebert
Impact
low
##### Description

The HTML Sanitizer should have sanitized the `href` attribute of SVG `<use>` tags; however it incorrectly did not sanitize `xlink:href` attributes.

##### References

* [Bug 1770888](https://bugzilla.mozilla.org/show_bug.cgi?id=1770888)

#### [#CVE-2022-34484: Memory safety bugs fixed in Firefox 102 and Firefox ESR 91.11](#CVE-2022-34484)

Reporter
Mozilla developers and community
Impact
high
##### Description

The Mozilla Fuzzing Team reported potential vulnerabilities present in Firefox 101 and Firefox ESR 91.10. Some of these bugs showed evidence of JavaScript prototype or memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 102 and Firefox ESR 91.11](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1763634%2C1772651)

#### [#CVE-2022-34485: Memory safety bugs fixed in Firefox 102](#CVE-2022-34485)

Reporter
Mozilla developers and community
Impact
moderate
##### Description

Mozilla developers Bryce Seager van Dyk and the Mozilla Fuzzing Team reported potential vulnerabilities present in Firefox 101. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 102](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1768409%2C1768578)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_6e5ac95a_20250114_210459.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1387919)
* [XML](/show_bug.cgi?ctype=xml&id=1387919)

Closed
[Bug 1387919](/show_bug.cgi?id=1387919)
(CVE-2022-34476)

Opened 7 years ago
Closed 3 years ago

# "consumed == child->consumed" assert failed in sec\_asn1d\_reuse\_encoding

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"consumed == child->consumed" assert failed in sec\_asn1d\_reuse\_encoding

## Categories

### (NSS :: Libraries, defect, P3)

[Product:](/describecomponents.cgi?product=NSS)

NSS
▾

NSS
Network Security Services - a cross-platform
security library ([more info](http://www.mozilla.org/projects/security/pki/nss/))
[See Open Bugs in This Product](/buglist.cgi?product=NSS&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=NSS)
Watch This Product

[Component:](/describecomponents.cgi?product=NSS&component=Libraries#Libraries)

Libraries
▾

NSS :: Libraries
Libraries for client support of SSL v2 and v3, TLS, PKCS #5,
PKCS #7, PKCS #11, PKCS #12, S/MIME, X.509 v3 certificates,
and other security standards
[See Open Bugs in This Component](/buglist.cgi?product=NSS&component=Libraries&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=NSS&component=Libraries&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=NSS&component=Libraries)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### (firefox-esr91 wontfix, firefox100 wontfix, firefox101 wontfix, firefox102 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

3.79

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox100 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix) |
| firefox101 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=wontfix) |
| firefox102 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr91 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox100 |  | wontfix |
| firefox101 |  | wontfix |
| firefox102 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gustavo.grieco, Assigned: jschanck)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/291ff310b7805a4159d7f46af196813e?d=mm&size=40)  [jschanck](/user_profile?user_id=689878)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d45770fad3540fd15ed3fc155dafc8f5?d=mm&size=40)  [gustavo.grieco](/user_profile?user_id=543907)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/38f561698d679a724938d4600c0f8b52?d=mm&size=40)  [beurdouche](/user_profile?user_id=622637)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1349226](/show_bug.cgi?id=1349226 "NEW - [Meta] ASN.1 Issues")

Dependency [tree](/showdependencytree.cgi?id=1387919&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1387919)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1330268](/show_bug.cgi?id=1330268 "RESOLVED DUPLICATE - Assertion failure: consumed == child->consumed, at ../../lib/util/secasn1d.c:1565")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, sec-moderate, Whiteboard: [post-critsmash-triage][adv-main102+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-34476

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main102+]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#c16 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | [qe-verify](#a150891433_553429 "3 years ago") | - |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [crash.asn1](/attachment.cgi?id=8894384)  [7 years ago](#c0)  [Gustavo Grieco](/user_profile?user_id=543907)   361 bytes, application/octet-stream |  | [Details](/attachment.cgi?id=8894384&action=edit) |
| --- | --- | --- |
| [Bug 1387919 - Fix secasn1d parsing of indefinite SEQUENCE inside indefinite GROUP. r=keeler](/attachment.cgi?id=9270954)  [3 years ago](#c10)  [John Schanck [:jschanck]](/user_profile?user_id=689878)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9270954&action=edit) | [Review](/attachment.cgi?id=9270954) |
| [advisory.txt](/attachment.cgi?id=9282674)  [3 years ago](#c15)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   214 bytes, text/plain |  | [Details](/attachment.cgi?id=9282674&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gustavo Grieco](/user_profile?user_id=543907)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1387919#c0)• 7 years ago |
|  | |

Attached file
[crash.asn1](attachment.cgi?id=8894384)
— [Details](attachment.cgi?id=8894384&action=edit)

User Agent: Mozilla/5.0 (X11; Linux x86\_64; rv:54.0) Gecko/20100101 Firefox/54.0
Build ID: 20170630112252
Steps to reproduce:
Hi,
We found a failed assertion in the last revision of nss (a0a4e05dcdd5) when we try to print a certificate using pp.
To reproduce execute: ./pp -t c -i crash.asn1
Actual results:
It aborts:
Certificate:
Assertion failure: consumed == child->consumed, at secasn1d.c:1565
Using gdb, we can obtain the backtrace:
Program received signal SIGABRT, Aborted.
0x00007f66a124f8c0 in raise () from /usr/lib/libc.so.6
(gdb) bt
#0 0x00007f66a124f8c0 in raise () from /usr/lib/libc.so.6
#1 0x00007f66a1250f72 in abort () from /usr/lib/libc.so.6
#2 0x00007f66a22148b2 in PR\_Assert (s=0x7f66a28879ee "consumed == child->consumed", file=0x7f66a2887480 "secasn1d.c", ln=1565)
at ../../../../pr/src/io/prlog.c:553
#3 0x00007f66a28741f0 in sec\_asn1d\_reuse\_encoding (state=0x100231908) at secasn1d.c:1565
#4 0x00007f66a287616c in SEC\_ASN1DecoderUpdate\_Util (cx=0x100231810, buf=0x100230597 "0\200\030", '\060' <repeats 49 times>, "\030\001\060", len=78)
at secasn1d.c:2804
#5 0x00007f66a287681e in SEC\_ASN1Decode\_Util (poolp=0x100230dc0, dest=0x100230ef0, theTemplate=0x7f66a1d545e0 <CERT\_CertificateTemplate>,
buf=0x100230490 "0\200\002\002\200", len=341) at secasn1d.c:3107
#6 0x00007f66a2876880 in SEC\_ASN1DecodeItem\_Util (poolp=0x100230dc0, dest=0x100230ef0, theTemplate=0x7f66a1d545e0 <CERT\_CertificateTemplate>,
src=0x1002301c0) at secasn1d.c:3121
#7 0x000000010000cb3a in SECU\_PrintCertificate (out=0x7f66a15bd580 <\_IO\_2\_1\_stdout\_>, der=0x1002301c0, m=0x10001250b "Data", level=1)
at secutil.c:2384
#8 0x000000010000f205 in secu\_PrintSignedDataSigOpt (out=0x7f66a15bd580 <\_IO\_2\_1\_stdout\_>, der=0x7fffffffdf50, m=0x10001175b "Certificate", level=0,
inner=0x10000cab6 <SECU\_PrintCertificate>, withSignature=withSignature) at secutil.c:3194
#9 0x000000010000f2e4 in SECU\_PrintSignedData (out=0x7f66a15bd580 <\_IO\_2\_1\_stdout\_>, der=0x7fffffffdf50, m=0x10001175b "Certificate", level=0,
inner=0x10000cab6 <SECU\_PrintCertificate>) at secutil.c:3212
#10 0x0000000100004b96 in main (argc=5, argv=0x7fffffffe058) at pp.c:150
Expected results:
It shouldn't abort.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1387919#c1)• 7 years ago |
|  | |

Aren't PR\_Assert()s always fatal at runtime? If so this is probably not exploitable in any way.Flags: needinfo?(ttaubert)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a313443_1689)• 7 years ago |

Flags: needinfo?(franziskuskiefer)

|  | [Franziskus Kiefer [:franziskus]](/user_profile?user_id=397236) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1387919#c2)• 7 years ago |
|  | |

PR\_Assert() are no-ops in release builds. So this works fine in release builds but will fail in debug builds, which is what we want I think. I'll have a look if there's anything here that we should fix but the assert is what we want.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1387919#c3)• 7 years ago |
|  | |

(In reply to Franziskus Kiefer [:fkiefer or :franziskus] from [comment #2](/show_bug.cgi?id=1387919#c2 "RESOLVED FIXED - \"consumed == child->consumed\" assert failed in sec_asn1d_reuse_encoding"))
> PR\_Assert() are no-ops in release builds.
PR\_ASSERT() are no-ops, but PR\_Assert() always fire. But this location turns out to be PORT\_Assert() which is mapped to PR\_ASSERT() and not PR\_Assert() as I would naively expect from the lowercase letters.
> works fine in release builds but will fail in debug builds, which is what we
> want I think. I'll have a look if there's anything here that we should fix but
> the assert is what we want.
Please close or unhide the bug as appropriate when you're done with that investigation.

|  | [Tim Taubert [:ttaubert] (inactive)](/user_profile?user_id=402526) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1387919#c4)• 7 years ago |
|  | |

We'll take a closer look at this in the near future. Let's keep it hidden until then.Blocks: [1349226](/show_bug.cgi?id=1349226 "NEW - [Meta] ASN.1 Issues")Status: UNCONFIRMED → NEWEver confirmed: trueFlags: needinfo?(ttaubert)Flags: needinfo?(franziskuskiefer)Priority: -- → P2

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1387919#c5)• 7 years ago |
|  | |

Leaving the needinfo on Tim to assign an appropriate security rating.Flags: needinfo?(ttaubert)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1387919#c6)• 7 years ago |
|  | |

Emailing Tim to follow up.

|  | [Tim Taubert [:ttaubert] (inactive)](/user_profile?user_id=402526) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1387919#c7)• 7 years ago |
|  | |

Let's call this sec-moderate. I'm inclined to think that this would mostly confuse the parser and cause it to either skip or re-read parts of the input and thus fail to parse invalid ASN.1. It's hard to exactly tell if there might be other ramifications, given the complexity of the parser.Flags: needinfo?(ttaubert)Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a97683304_520206)• 4 years ago |

QA Contact: jjones

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1387919#c8)• 3 years ago |
|  | |

Took a look at this today, but did not finish. Some notes below.

Here's a [der-ascii](https://github.com/google/der-ascii) formatted reproducer.

```
SEQUENCE {
  SEQUENCE {
    INTEGER { 0 }
    SEQUENCE {
      OBJECT_IDENTIFIER { 0 }
    }
    SEQUENCE indefinite {
      SET indefinite {
        SEQUENCE indefinite {
          OBJECT_IDENTIFIER { 2.5.4.10 }
          PrintableString { "xxxxxxxx" }
        }
      }
    }
    SEQUENCE {
      UTCTime { "000000000000Z" }
      UTCTime { "999999999999Z" }
    }
  }
  SEQUENCE {
    OBJECT_IDENTIFIER { 2.5.4.6 }
  }
  BIT_STRING { 0 }
}

```

The issue is in the handling of

```
    SEQUENCE indefinite {
      SET indefinite {
        SEQUENCE indefinite {
          OBJECT_IDENTIFIER { 2.5.4.10 }
          PrintableString { "xxxxxxxx" }
        }
      }
    }

```

We read this chunk twice. We first save the entire sequence into a CERTCertificate `derIssuer` field. Then we parse it into the `issuer` field. On the second pass we seem to lose the "indefinite" flag while decoding the outer sequence and we leave an EOC unconsumed.

Apart from the assertion, this doesn't cause any problems. That's because we update the buffer position based on the number of bytes consumed in the first pass, `consumed`, rather than in the second `child->consumed`.

```
    PORT_Assert(consumed == child->consumed);
[...]
    state->consumed += consumed;

```

My sense right now is that this is a bug rather than a security issue.

Of course there's clearly a correctness problem, and it's possible that it can manifest in a more dangerous way.

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1387919#c9)• 3 years ago |
|  | |

An error occurs when parsing an indefinite-length encoded SEQUENCE that is inside an indefinite-length encoded GROUP (SEQUENCE-OF or SET-OF).

tldr; the parser interprets a single EOC as ending both the SEQUENCE and the GROUP containing it.

In an iteration over elements of a GROUP (`sec_asn1d_next_in_group`), the child of the current state is responsible for parsing the GROUP's end-of-contents octets---a call to `sec_asn1d_parse_end_of_contents(state->child)` sets the `endofcontents` flag for `state->child` and a later call to `sec_asn1d_next_in_group` checks `state->child->endofcontents` and terminates the iteration ([here](https://searchfox.org/mozilla-central/rev/911d1ebfb02cce4ff20f7ef965def04becfee710/security/nss/lib/util/secasn1d.c#1967)).

An iteration over elements of a SEQUENCE (`sec_asn1d_next_in_sequence`), on the other hand, terminates when the child's template points to a template terminator ([here](https://searchfox.org/mozilla-central/rev/911d1ebfb02cce4ff20f7ef965def04becfee710/security/nss/lib/util/secasn1d.c#2122-2161)). The current state, not its child, handles the end-of-contents octets, and a call to `sec_asn1d_parse_end_of_contents(state)` sets the `endofcontents` flag for `state` even though this is not needed to signal the end of iteration over the SEQUENCE.

The error occurs when `state` points to an indefinite-length encoded `GROUP` and `state->child` points to an indefinite-length encoded SEQUENCE. The call to `sec_asn1d_parse_end_of_contents` to read the SEQUENCE's end-of-contents octets sets the `endofcontents` flag for `state->child`, and this is misinterpreted as an end-of-iteration signal for the surrounding GROUP.

When the GROUP's end-of-contents octets are present, this always leads to a decoding error. When they are not present, the decoder can mistakenly accept malformed ASN.1.

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1387919#c10)• 3 years ago |
|  | |

Attached file
[Bug 1387919 - Fix secasn1d parsing of indefinite SEQUENCE inside indefinite GROUP. r=keeler](attachment.cgi?id=9270954)
— [Details](attachment.cgi?id=9270954&action=edit)

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a147114145_689878)• 3 years ago |

Assignee: nobody → jschanckPriority: P2 → P3

|  | [Gustavo Grieco](/user_profile?user_id=543907)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1387919#c11)• 3 years ago |
|  | |

I'm the original reporter of this issue and I'm happy to see some activity 5 years after this was found.

> When they are not present, the decoder can mistakenly accept malformed ASN.1.

Giver your analysis, I'm wondering if this affects certificates parsed by Firefox or it is just localized in the specific calls of the NSS printer.

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1387919#c12)• 3 years ago |
|  | |

This affects a legacy decoder that is not used to parse WebPKI X.509 certificates in Firefox. We need to do some further investigation to rule out an impact on PKCS#7 and PKCS#12 as used in Firefox. Our current assessment is that any possible impact is quite limited. To expand on my "accept malformed ASN.1" comment: I suspect the worst-case here is that the decoder admits an item that is missing a trailing EOC.

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1387919#c14)• 3 years ago |
|  | |

<https://hg.mozilla.org/projects/nss/rev/1811eec2499702da599293e49a8827bccda77ca4>

Status: NEW → RESOLVEDClosed: 3 years agoResolution: --- → FIXED

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a150662290_689878)• 3 years ago |

Target Milestone: --- → 3.79

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a150678150_75935)• 3 years ago |

Group: crypto-core-security → core-security-release
[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix)
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=wontfix)
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)QA Contact: jc

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a150891433_553429)• 3 years ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a153767549_578488)• 3 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main102+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1387919#c15)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9282674)
— [Details](attachment.cgi?id=9282674&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a154011022_578488)• 3 years ago |

Alias: CVE-2022-34476

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a154838827_428608)• 3 years ago |

Flags: sec-bounty?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1387919#c16)• 3 years ago |
|  | |

We are awarding a bounty for this issue, but it's a bit on the small end I'm afraid. Our bounty program only covers NSS to the extent it's used in Firefox and this one doesn't seem to.

Flags: sec-bounty? → sec-bounty+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a171856929_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1387919#a215013925_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1387919&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gustavo Grieco](/user_profile?user_id=543907)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


