=== Content from gerrit.wikimedia.org_e39232ea_20250114_191724.html ===




=== Content from gerrit.wikimedia.org_58fa816e_20250114_191724.html ===




=== Content from phabricator.wikimedia.org_baa3fc2c_20250114_191726.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT308659)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T308659
# Validate lemma length in Special:NewLexeme(Alpha) and label/description/aliases length in Special:NewProperty (CVE-2022-34750)Closed, Resolved[Public](/policy/explain/PHID-TASK-qvwy7rtxglof3li4ux2g/view/)3 Estimated Story PointsSecurityActions

* [Edit Task](/maniphest/task/edit/308659/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/308659/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-qvwy7rtxglof3li4ux2g/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-qvwy7rtxglof3li4ux2g/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-qvwy7rtxglof3li4ux2g/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-qvwy7rtxglof3li4ux2g/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-qvwy7rtxglof3li4ux2g/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-qvwy7rtxglof3li4ux2g/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-qvwy7rtxglof3li4ux2g/)
* [Protect as security issue](/wmf/escalate-task/308659/)
* [Award Token](/token/give/PHID-TASK-qvwy7rtxglof3li4ux2g/)
* [Flag For Later](/flag/edit/PHID-TASK-qvwy7rtxglof3li4ux2g/)

Assigned To

|  | [Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) |
| --- | --- |

Authored By

|  | [Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) |
| --- | --- |
| May 18 2022, 11:25 AM2022-05-18 11:25:22 (UTC+0) |

Tags

* [Security-Team](/tag/security-team/) [(Our Part Is Done)](/project/board/1179/)
* [Security](/tag/security/)
* [Wikidata](/tag/wikidata/) [(incoming)](/project/board/71/)
* [Wikidata Lexicographical data](/tag/wikidata_lexicographical_data/) [(incoming)](/project/board/2292/)
* [Vuln-DoS](/tag/vuln-dos/) [(Tracked)](/project/board/1446/)
* [Patch-For-Review](/tag/patch-for-review/)
* [Special:NewLexeme revival (Special:NewLexeme revival - sprint 11)](/project/view/6005/) [(Done)](/project/board/6005/)
* [MW-1.39-notes (1.39.0-wmf.21; 2022-07-18)](/project/view/6027/)
Referenced Files

|  | [F35169060: 0001-SECURITY-Validate-lemma-length-in-Special-NewLexeme-.patch](/F35169060) |
| --- | --- |
| May 23 2022, 10:24 AM2022-05-23 10:24:59 (UTC+0) |

|  | [F35151954: 0001-SECURITY-Validate-term-length-in-Special-NewProperty.patch](/F35151954) |
| --- | --- |
| May 18 2022, 4:46 PM2022-05-18 16:46:47 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [Erdinc\_Ciftci\_WMDE](/p/Erdinc_Ciftci_WMDE/) |
| --- | --- |

|  | [guergana.tzatchkova](/p/guergana.tzatchkova/) |
| --- | --- |

|  | [ItamarWMDE](/p/ItamarWMDE/) |
| --- | --- |

|  | [karapayneWMDE](/p/karapayneWMDE/) |
| --- | --- |

|  | [Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) |
| --- | --- |

|  | [Lydia\_Pintscher](/p/Lydia_Pintscher/) |
| --- | --- |

[View All 13 Subscribers](/subscriptions/list/PHID-TASK-qvwy7rtxglof3li4ux2g/)
# Description

The lemma of a Lexeme is supposed to be no longer than 1000 characters (code points, mb\_strlen), but this is currently not validated when creating a new Lexeme through Special:NewLexeme, or through the no-JS version of Special:NewLexemeAlpha. (The JS version of Special:NewLexemeAlpha uses the API to create the Lexeme, where the lemma length is properly validated.) This lets you create a Lexeme with a lemma much longer than should be supported (I tested 32768 ü§îs, which was enough to start slowing down the browser), where the lemma can‚Äôt afterwards be edited unless you make it short enough to be below the limit.

Update: Likewise, the label, description and aliases of a new Property should also be limited to a certain length (though in this case the limit is configurable instead of hard-coded), see [T308659#7939007](/T308659#7939007).

# Details

Risk Rating Low Author Affiliation Wikimedia Deutschland

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [Clean up lemma length validation](https://gerrit.wikimedia.org/r/c/809203) | [mediawiki/extensions/WikibaseLexeme](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme/%2B/master) | +71 -25 |
|  | [SECURITY: Validate lemma length in Special:NewLexeme](https://gerrit.wikimedia.org/r/c/809604) | [mediawiki/extensions/WikibaseLexeme](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme) | [REL1\_35](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme/%2B/REL1_35) | +18 -1 |
|  | [SECURITY: Validate term length in Special:NewProperty](https://gerrit.wikimedia.org/r/c/809601) | [mediawiki/extensions/Wikibase](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Wikibase) | [REL1\_35](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Wikibase/%2B/REL1_35) | +168 -56 |
|  | [SECURITY: Validate lemma length in Special:NewLexeme](https://gerrit.wikimedia.org/r/c/809603) | [mediawiki/extensions/WikibaseLexeme](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme) | [REL1\_37](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme/%2B/REL1_37) | +18 -1 |
|  | [SECURITY: Validate term length in Special:NewProperty](https://gerrit.wikimedia.org/r/c/809572) | [mediawiki/extensions/Wikibase](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Wikibase) | [REL1\_37](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Wikibase/%2B/REL1_37) | +178 -60 |
|  | [SECURITY: Validate lemma length in Special:NewLexeme(Alpha)](https://gerrit.wikimedia.org/r/c/808949) | [mediawiki/extensions/WikibaseLexeme](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme) | [REL1\_38](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme/%2B/REL1_38) | +36 -2 |
|  | [SECURITY: Validate term length in Special:NewProperty](https://gerrit.wikimedia.org/r/c/808948) | [mediawiki/extensions/Wikibase](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Wikibase) | [REL1\_38](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Wikibase/%2B/REL1_38) | +175 -57 |
|  | [SECURITY: Validate term length in Special:NewProperty](https://gerrit.wikimedia.org/r/c/808989) | [mediawiki/extensions/Wikibase](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Wikibase) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/Wikibase/%2B/master) | +175 -57 |
|  | [SECURITY: Validate lemma length in Special:NewLexeme(Alpha)](https://gerrit.wikimedia.org/r/c/808990) | [mediawiki/extensions/WikibaseLexeme](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/WikibaseLexeme/%2B/master) | +36 -2 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T308659)
# Related Objects

* Mentions

Mentioned In [T313027: MUL - Do not allow adding term descriptions with the language code mul on Wikidata](/T313027)
[T305209: Write and send supplementary release announcement for extensions and skins with security patches (1.35.7/1.37.3/1.38.2)](/T305209)
[T305854: Per-field inline validation and error messages for invalid input in lemma, language, spelling variant or lexical category field](/T305854) Mentioned Here [T305209: Write and send supplementary release announcement for extensions and skins with security patches (1.35.7/1.37.3/1.38.2)](/T305209)
### Event Timeline

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) created this task.[May 18 2022, 11:25 AM2022-05-18 11:25:22 (UTC+0)](#7938033)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  ¬∑ [View Herald Transcript](/herald/transcript/4771223/)[May 18 2022, 11:25 AM2022-05-18 11:25:24 (UTC+0)](#7938044)[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added projects: [Wikidata](/tag/wikidata/), [Wikidata Lexicographical data](/tag/wikidata_lexicographical_data/), [Special:NewLexeme revival](/tag/special_newlexeme_revival/).[May 18 2022, 11:26 AM2022-05-18 11:26:36 (UTC+0)](#7938045)[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added subscribers: [Lydia\_Pintscher](/p/Lydia_Pintscher/), [‚Ä¢ Manuel](/p/Manuel/), [karapayneWMDE](/p/karapayneWMDE/) and [5 others](/subscriptions/transaction/add/PHID-XACT-TASK-as47wrib7pzjwoq/).

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[May 18 2022, 11:29 AM2022-05-18 11:29:35 (UTC+0)](#7938057)Comment Actions

Also, if you make the lemma shorter, you can still restore an old revision with the long lemma, both via regular MediaWiki ‚Äúundo‚Äù and via the Wikibase-specific ‚Äúrestore‚Äù feature. This surprises me (I would have thought that restoring old revisions would go through the ChangeOp mechanism, which seems to be where the lemma length validation happens), but I‚Äôm not sure if we should fix it.

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[May 18 2022, 11:36 AM2022-05-18 11:36:57 (UTC+0)](#7938066)Comment Actions

Also, Lexemes with overlong lemmas can be merged into other Lexemes, so in theory you can ‚Äúedit‚Äù the overlong lemma:

* change lemma to something short and with a different language code
* create new Lexeme with edited language code (spelling variant)
* merge that Lexeme into the original one
* remove short lemma again

This is probably not worth fixing separately, once it‚Äôs impossible to create these Lexemes in the first place it should no longer be an issue.

---

The Wikidata Query Service doesn‚Äôt find any existing Lexemes with a lemma above 1000 UTF-16 code units ([query](https://query.wikidata.org/#SELECT%20%2a%20WHERE%20%7B%0A%20%20%3Flexeme%20wikibase%3Alemma%20%3Flemma.%0A%20%20FILTER%28STRLEN%28%3Flemma%29%20%3E%201000%29%0A%7D) ‚Äì [Blazegraph STRLEN() counts code units not code points](https://query.wikidata.org/#SELECT%20%28STRLEN%28%22%F0%9F%A4%94%22%29%20AS%20%3Flen%29%20%7B%7D)); since code units ‚â• code points, I think that means there are no Lexemes with a lemma that‚Äôs too long in Wikidata at the moment.

[‚Ä¢ Manuel](/p/Manuel/) added a comment.[May 18 2022, 1:22 PM2022-05-18 13:22:28 (UTC+0)](#7938334)Comment Actions

Good catch, Lucas! Am I right to assume that the team will work on things like this with a high priority even without me doing something about it specifically?

[ItamarWMDE](/p/ItamarWMDE/) mentioned this in [T305854: Per-field inline validation and error messages for invalid input in lemma, language, spelling variant or lexical category field](/T305854).[May 18 2022, 1:40 PM2022-05-18 13:40:44 (UTC+0)](#7938478)

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) claimed this task.[May 18 2022, 1:47 PM2022-05-18 13:47:40 (UTC+0)](#7938491)[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) edited projects, added [Special:NewLexeme revival (Special:NewLexeme revival - sprint 8)](/project/view/5937/); removed [Special:NewLexeme revival](/tag/special_newlexeme_revival/).[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) moved this task from [To Do](/project/board/5937/) to [Doing](/project/board/5937/) on the [Special:NewLexeme revival (Special:NewLexeme revival - sprint 8)](/project/view/5937/) board.Comment Actions

Yeah, I can look into it now (we agreed to pull it into the sprint).

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[May 18 2022, 3:58 PM2022-05-18 15:58:40 (UTC+0)](#7939007)Comment Actions

This turns out to affect Special:NewProperty as well, it doesn‚Äôt validate the label, description and aliases using the general term validators. (Special:NewItem does validate them.)

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) moved this task from [Doing](/project/board/5937/) to [Peer Review](/project/board/5937/) on the [Special:NewLexeme revival (Special:NewLexeme revival - sprint 8)](/project/view/5937/) board.Edited ¬∑ [May 18 2022, 4:46 PM2022-05-18 16:46:47 (UTC+0)](#7939191)Comment Actions

Wikibase patch for Special:NewProperty:

0001-SECURITY-Validate-term-length-in-Special-NewProperty.patch20 KB[Download](https://phab.wmfusercontent.org/file/download/sexscifdtj5c4rw7vpzm/PHID-FILE-np54ygpy5o62cbfjde2o/0001-SECURITY-Validate-term-length-in-Special-NewProperty.patch)

I‚Äôll do Special:NewLexeme(Alpha) ~~tomorrow~~ on Friday, probably.

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) renamed this task from Validate lemma length in Special:NewLexeme(Alpha) to Validate lemma length in Special:NewLexeme(Alpha) and label/description/aliases length in Special:NewProperty.[May 18 2022, 5:16 PM2022-05-18 17:16:15 (UTC+0)](#7939377)[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-x3z6blaraj7qowx/)[Michael](/p/Michael/) added a comment.[May 23 2022, 9:37 AM2022-05-23 09:37:01 (UTC+0)](#7949180)Comment Actions
> In [T308659#7939191](/T308659#7939191), [@Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) wrote:
>
> Wikibase patch for Special:NewProperty:
>
> 0001-SECURITY-Validate-term-length-in-Special-NewProperty.patch20 KB[Download](https://phab.wmfusercontent.org/file/download/sexscifdtj5c4rw7vpzm/PHID-FILE-np54ygpy5o62cbfjde2o/0001-SECURITY-Validate-term-length-in-Special-NewProperty.patch)
>
> I‚Äôll do Special:NewLexeme(Alpha) ~~tomorrow~~ on Friday, probably.

While that would be a fine patch on Gerrit, it does touch quite a bit of code. Do we actually need the cleanup changes to Special:NewItem in this security patch, when the actual issue we want to fix is in Special:NewProperty? Maybe this is ok though if the actual security release is done very soon

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[May 23 2022, 9:56 AM2022-05-23 09:56:20 (UTC+0)](#7949271)Comment Actions

We don‚Äôt really need them, but I would prefer to do them at the same time so that we don‚Äôt forget about it or have the two special pages inconsistent with one another for longer than is necessary. Looking at the [Release policy](https://www.mediawiki.org/wiki/Version_lifecycle#Release_policy) and [News](https://www.mediawiki.org/wiki/News), it looks like we can expect the next security release by the end of June, which feels soon enough to me.

[Michael](/p/Michael/) added a comment.[May 23 2022, 10:14 AM2022-05-23 10:14:55 (UTC+0)](#7949358)Comment Actions

Mh, ok. After trying it out locally, the patch seems to work fine. And given that Special:NewItem and Special:NewProperty shouldn't seeing that many changes, I think going forward with it in its current form is ok. Let's make sure we really get that end-of-june security release though.

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[May 23 2022, 10:24 AM2022-05-23 10:24:59 (UTC+0)](#7949381)Comment Actions

Okay, and here‚Äôs a WikibaseLexeme patch (shorter, because the relevant WikibaseLexeme code is more likely to have other changes in the coming weeks, so in this case it‚Äôs probably better to err on the side of caution and keep the security patch minimal):

0001-SECURITY-Validate-lemma-length-in-Special-NewLexeme-.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/qomg5z3ijejcfbsxxa73/PHID-FILE-qj5giemqxdybxgdh7ntz/0001-SECURITY-Validate-lemma-length-in-Special-NewLexeme-.patch)

[sbassett](/p/sbassett/) subscribed.[May 24 2022, 6:50 PM2022-05-24 18:50:45 (UTC+0)](#7954230)Comment Actions
> In [T308659#7949381](/T308659#7949381), [@Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) wrote:
>
> Okay, and here‚Äôs a WikibaseLexeme patch (shorter, because the relevant WikibaseLexeme code is more likely to have other changes in the coming weeks, so in this case it‚Äôs probably better to err on the side of caution and keep the security patch minimal):

+1 to this as an efficient security patch, for now, though I didn't test. The logic seems simple and correct enough. I assume the TODOs imply this patch might not be directly backported in gerrit, but improved upon once deployed?

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[May 25 2022, 8:07 AM2022-05-25 08:07:42 (UTC+0)](#7955574)Comment Actions

My thinking was that the patch could be pushed to Gerrit and merged as is (together with other patches for the next security release), and then the TODO could be addressed afterwards.

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[May 25 2022, 2:09 PM2022-05-25 14:09:38 (UTC+0)](#7957106)Comment Actions

Though I‚Äôm interested what workflow you would prefer for improving security changes once deployed ‚Äì should we leave instructions in the commit messages about how the changes are to be combined for Gerrit (git rebase --autosquash style, perhaps), or directly squash patches together, altering history in /src/mediwiki-staging and committing changes to existing patch files in /srv/patches?

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[May 25 2022, 2:34 PM2022-05-25 14:34:28 (UTC+0)](#7957153)Comment Actions

Alright, Wikibase and WikibaseLexeme patches deployed‚ÄØ(tested on Test Wikidata). <https://sal.toolforge.org/log/kF-j-4AB8Fs0LHO5NIzv>

[sbassett](/p/sbassett/) added a comment.[May 25 2022, 2:40 PM2022-05-25 14:40:36 (UTC+0)](#7957208)Comment Actions
> In [T308659#7955574](/T308659#7955574), [@Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) wrote:
>
> My thinking was that the patch could be pushed to Gerrit and merged as is (together with other patches for the next security release), and then the TODO could be addressed afterwards.
>
> ...
>
> Though I‚Äôm interested what workflow you would prefer for improving security changes once deployed ‚Äì should we leave instructions in the commit messages about how the changes are to be combined for Gerrit (git rebase --autosquash style, perhaps), or directly squash patches together, altering history in /src/mediwiki-staging and committing changes to existing patch files in /srv/patches?

We don't have any official guidance for this as it's generally been handled on a case-by-case basis, IME. I think it comes down to a judgment call on how "sloppy" the security patches are. If they're hastily developed and intended as a *very temporary* fix and/or involve multiple patches due to iterative bug-fixing, then we'd likely recommend refactoring/squashing before backporting in gerrit. If the patches themselves are mostly fine but *could* or *should* be cleaned up later, such follow-up work can happen at a later date, after the initial security patch backports are merged in gerrit, at the discretion of the code maintainers.

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[May 25 2022, 2:45 PM2022-05-25 14:45:28 (UTC+0)](#7957234)Comment Actions

Alright, thanks. I‚Äôd see this as the latter category, i.e. I don‚Äôt plan to further work on it until the current patches have been published as part of the next security release.

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) edited projects, added [Special:NewLexeme revival](/tag/special_newlexeme_revival/); removed [Special:NewLexeme revival (Special:NewLexeme revival - sprint 8)](/project/view/5937/).[May 25 2022, 4:06 PM2022-05-25 16:06:17 (UTC+0)](#7957537)[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) moved this task from [Backlog](/project/board/5674/) to [Tech backlog](/project/board/5674/) on the [Special:NewLexeme revival](/tag/special_newlexeme_revival/) board.[Mstyles](/p/Mstyles/) mentioned this in [T305209: Write and send supplementary release announcement for extensions and skins with security patches (1.35.7/1.37.3/1.38.2)](/T305209).[Jun 3 2022, 7:43 PM2022-06-03 19:43:05 (UTC+0)](#7979927)[sbassett](/p/sbassett/) moved this task from [Incoming](/project/board/1179/) to [Watching](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Jun 6 2022, 4:28 PM2022-06-06 16:28:26 (UTC+0)](#7983365)[sbassett](/p/sbassett/) added a project: [Vuln-DoS](/tag/vuln-dos/).[Jun 24 2022, 6:33 PM2022-06-24 18:33:21 (UTC+0)](#8026272)[sbassett](/p/sbassett/) added a comment.[Jun 24 2022, 6:52 PM2022-06-24 18:52:33 (UTC+0)](#8026302)Comment Actions

Hey [@Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) - The security team is attempting to get the next supplemental security release ([T305209](/T305209)) out within the next week or two, and we were hoping to include this bug. I know there was some discussion above about polishing the two existing security patches a bit more. Would you still prefer to do that or should we try to push what exists now up to gerrit, get them merged so we can remove the patches from production and have something available for the supplemental release? I'd perfer that approach but I'm also fine with waiting and keeping this bug locked down for a while longer, perhaps until next quarter's supplemental security release, but likely not after that.

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[Jun 27 2022, 7:58 AM2022-06-27 07:58:57 (UTC+0)](#8028299)Comment Actions

Feel free to upload and merge them now, the intention was to polish them afterwards (and it should be fine if the polishing patches don‚Äôt make it into the security release ‚Äì they‚Äôd only make the code more maintainable, without changing anything at runtime, so they‚Äôre mostly important for the master branch).

[sbassett](/p/sbassett/) triaged this task as Low priority.[Jun 27 2022, 6:45 PM2022-06-27 18:45:18 (UTC+0)](#8030686)[sbassett](/p/sbassett/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-pjzga44msnqhrsx/)" to "Public (No Login Required)".[sbassett](/p/sbassett/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-yjt2kalcjgly3si/)" to "All Users".[sbassett](/p/sbassett/) changed Risk Rating from N/A to Low.[gerritbot](/p/gerritbot/) added a comment.[Jun 27 2022, 6:45 PM2022-06-27 18:45:43 (UTC+0)](#8030690)Comment Actions

Change 808989 had a related patch set uploaded (by SBassett; author: Lucas Werkmeister (WMDE)):

[mediawiki/extensions/Wikibase@master] SECURITY: Validate term length in Special:NewProperty

<https://gerrit.wikimedia.org/r/808989>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Jun 27 2022, 6:45 PM2022-06-27 18:45:43 (UTC+0)](#8030691)[gerritbot](/p/gerritbot/) added a comment.[Jun 27 2022, 6:49 PM2022-06-27 18:49:37 (UTC+0)](#8030697)Comment Actions

Change 808990 had a related patch set uploaded (by SBassett; author: Lucas Werkmeister (WMDE)):

[mediawiki/extensions/WikibaseLexeme@master] SECURITY: Validate lemma length in Special:NewLexeme(Alpha)

<https://gerrit.wikimedia.org/r/808990>

[gerritbot](/p/gerritbot/) added a comment.[Jun 27 2022, 7:01 PM2022-06-27 19:01:27 (UTC+0)](#8030767)Comment Actions

Change 808948 had a related patch set uploaded (by SBassett; author: Lucas Werkmeister (WMDE)):

[mediawiki/extensions/Wikibase@REL1\_38] SECURITY: Validate term length in Special:NewProperty

<https://gerrit.wikimedia.org/r/808948>

[gerritbot](/p/gerritbot/) added a comment.[Jun 27 2022, 7:02 PM2022-06-27 19:02:02 (UTC+0)](#8030769)Comment Actions

Change 808949 had a related patch set uploaded (by SBassett; author: Lucas Werkmeister (WMDE)):

[mediawiki/extensions/WikibaseLexeme@REL1\_38] SECURITY: Validate lemma length in Special:NewLexeme(Alpha)

<https://gerrit.wikimedia.org/r/808949>

[gerritbot](/p/gerritbot/) added a comment.[Jun 27 2022, 7:56 PM2022-06-27 19:56:58 (UTC+0)](#8030950)Comment Actions

Change 808989 **merged** by jenkins-bot:

[mediawiki/extensions/Wikibase@master] SECURITY: Validate term length in Special:NewProperty

<https://gerrit.wikimedia.org/r/808989>

[gerritbot](/p/gerritbot/) added a comment.[Jun 27 2022, 7:57 PM2022-06-27 19:57:04 (UTC+0)](#8030951)Comment Actions

Change 808990 **merged** by jenkins-bot:

[mediawiki/extensions/WikibaseLexeme@master] SECURITY: Validate lemma length in Special:NewLexeme(Alpha)

<https://gerrit.wikimedia.org/r/808990>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added a project: [MW-1.39-notes (1.39.0-wmf.18; 2022-06-27)](/project/view/5966/).[Jun 27 2022, 8:00 PM2022-06-27 20:00:30 (UTC+0)](#8030956)[Zabe](/p/Zabe/) subscribed.[Jun 27 2022, 8:17 PM2022-06-27 20:17:55 (UTC+0)](#8031034)[gerritbot](/p/gerritbot/) added a comment.[Jun 28 2022, 9:03 AM2022-06-28 09:03:54 (UTC+0)](#8032150)Comment Actions

Change 808948 **merged** by jenkins-bot:

[mediawiki/extensions/Wikibase@REL1\_38] SECURITY: Validate term length in Special:NewProperty

<https://gerrit.wikimedia.org/r/808948>

[gerritbot](/p/gerritbot/) added a comment.[Jun 28 2022, 9:30 AM2022-06-28 09:30:48 (UTC+0)](#8032278)Comment Actions

Change 808949 **merged** by jenkins-bot:

[mediawiki/extensions/WikibaseLexeme@REL1\_38] SECURITY: Validate lemma length in Special:NewLexeme(Alpha)

<https://gerrit.wikimedia.org/r/808949>

[karapayneWMDE](/p/karapayneWMDE/) edited projects, added [Special:NewLexeme revival (Special:NewLexeme revival - sprint 11)](/project/view/6005/); removed [Special:NewLexeme revival](/tag/special_newlexeme_revival/).[Jun 28 2022, 9:31 AM2022-06-28 09:31:35 (UTC+0)](#8032280)[karapayneWMDE](/p/karapayneWMDE/) set Summary to 3.[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) moved this task from [To Do](/project/board/6005/) to [Doing](/project/board/6005/) on the [Special:NewLexeme revival (Special:NewLexeme revival - sprint 11)](/project/view/6005/) board.[Jun 28 2022, 2:47 PM2022-06-28 14:47:43 (UTC+0)](#8033480)[karapayneWMDE](/p/karapayneWMDE/) removed Summary.[Jun 28 2022, 2:48 PM2022-06-28 14:48:45 (UTC+0)](#8033481)[karapayneWMDE](/p/karapayneWMDE/) set the point value for this task to 3.[gerritbot](/p/gerritbot/) added a comment.[Jun 28 2022, 3:31 PM2022-06-28 15:31:45 (UTC+0)](#8033649)Comment Actions

Change 809203 had a related patch set uploaded (by Lucas Werkmeister (WMDE); author: Lucas Werkmeister (WMDE)):

[mediawiki/extensions/WikibaseLexeme@master] Clean up lemma length validation

<https://gerrit.wikimedia.org/r/809203>

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) moved this task from [Doing](/project/board/6005/) to [Peer Review](/project/board/6005/) on the [Special:NewLexeme revival (Special:NewLexeme revival - sprint 11)](/project/view/6005/) board.[Jun 28 2022, 3:49 PM2022-06-28 15:49:49 (UTC+0)](#8033722)[MoritzMuehlenhoff](/p/MoritzMuehlenhoff/) subscribed.[Jun 29 2022, 9:37 AM2022-06-29 09:37:13 (UTC+0)](#8036319)Comment Actions

This appeared in the CVE feed as <https://www.cve.org/CVERecord?id=CVE-2022-34750>

[MoritzMuehlenhoff](/p/MoritzMuehlenhoff/) renamed this task from Validate lemma length in Special:NewLexeme(Alpha) and label/description/aliases length in Special:NewProperty to Validate lemma length in Special:NewLexeme(Alpha) and label/description/aliases length in Special:NewProperty (CVE-2022-34750).[Jun 29 2022, 9:37 AM2022-06-29 09:37:25 (UTC+0)](#8036320)[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2022, 10:52 AM2022-06-29 10:52:44 (UTC+0)](#8036526)Comment Actions

Change 809572 had a related patch set uploaded (by Lucas Werkmeister (WMDE); author: Lucas Werkmeister (WMDE)):

[mediawiki/extensions/Wikibase@REL1\_37] SECURITY: Validate term length in Special:NewProperty

<https://gerrit.wikimedia.org/r/809572>

[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2022, 1:47 PM2022-06-29 13:47:31 (UTC+0)](#8037149)Comment Actions

Change 809601 had a related patch set uploaded (by Lucas Werkmeister (WMDE); author: Lucas Werkmeister (WMDE)):

[mediawiki/extensions/Wikibase@REL1\_35] SECURITY: Validate term length in Special:NewProperty

<https://gerrit.wikimedia.org/r/809601>

[sbassett](/p/sbassett/) added a comment.[Jun 29 2022, 1:50 PM2022-06-29 13:50:07 (UTC+0)](#8037167)Comment Actions
> In [T308659#8036319](/T308659#8036319), [@MoritzMuehlenhoff](/p/MoritzMuehlenhoff/) wrote:
>
> This appeared in the CVE feed as <https://www.cve.org/CVERecord?id=CVE-2022-34750>

Yes, I requested that ID a couple of days ago and forgot to update the task title here. Thanks for doing that.

[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2022, 1:52 PM2022-06-29 13:52:38 (UTC+0)](#8037181)Comment Actions

Change 809603 had a related patch set uploaded (by Lucas Werkmeister (WMDE); author: Lucas Werkmeister (WMDE)):

[mediawiki/extensions/WikibaseLexeme@REL1\_37] SECURITY: Validate lemma length in Special:NewLexeme

<https://gerrit.wikimedia.org/r/809603>

[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2022, 1:52 PM2022-06-29 13:52:57 (UTC+0)](#8037182)Comment Actions

Change 809604 had a related patch set uploaded (by Lucas Werkmeister (WMDE); author: Lucas Werkmeister (WMDE)):

[mediawiki/extensions/WikibaseLexeme@REL1\_35] SECURITY: Validate lemma length in Special:NewLexeme

<https://gerrit.wikimedia.org/r/809604>

[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2022, 2:04 PM2022-06-29 14:04:30 (UTC+0)](#8037232)Comment Actions

Change 809572 **merged** by jenkins-bot:

[mediawiki/extensions/Wikibase@REL1\_37] SECURITY: Validate term length in Special:NewProperty

<https://gerrit.wikimedia.org/r/809572>

[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2022, 2:52 PM2022-06-29 14:52:42 (UTC+0)](#8037449)Comment Actions

Change 809603 **merged** by jenkins-bot:

[mediawiki/extensions/WikibaseLexeme@REL1\_37] SECURITY: Validate lemma length in Special:NewLexeme

<https://gerrit.wikimedia.org/r/809603>

[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2022, 2:53 PM2022-06-29 14:53:37 (UTC+0)](#8037452)Comment Actions

Change 809601 **merged** by jenkins-bot:

[mediawiki/extensions/Wikibase@REL1\_35] SECURITY: Validate term length in Special:NewProperty

<https://gerrit.wikimedia.org/r/809601>

[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2022, 3:25 PM2022-06-29 15:25:08 (UTC+0)](#8037522)Comment Actions

Change 809604 **merged** by Lucas Werkmeister (WMDE):

[mediawiki/extensions/WikibaseLexeme@REL1\_35] SECURITY: Validate lemma length in Special:NewLexeme

<https://gerrit.wikimedia.org/r/809604>

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) added a comment.[Jun 29 2022, 3:32 PM2022-06-29 15:32:34 (UTC+0)](#8037573)Comment Actions

Backported the patches to REL1\_35 and REL1\_37 (1.36 is out of support). Leaving the task open for review of the [cleanup patch](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/WikibaseLexeme/%2B/809203) (which doesn‚Äôt need backporting).

[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2022, 4:23 PM2022-06-29 16:23:20 (UTC+0)](#8037765)Comment Actions

Change 809203 **merged** by jenkins-bot:

[mediawiki/extensions/WikibaseLexeme@master] Clean up lemma length validation

<https://gerrit.wikimedia.org/r/809203>

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) closed this task as Resolved.[Jun 29 2022, 4:29 PM2022-06-29 16:29:54 (UTC+0)](#8037779)[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) moved this task from [Peer Review](/project/board/6005/) to [Done](/project/board/6005/) on the [Special:NewLexeme revival (Special:NewLexeme revival - sprint 11)](/project/view/6005/) board.Comment Actions

I think we‚Äôre done here (but please reopen if the task should still be open for security release process purposes).

[sbassett](/p/sbassett/) moved this task from [Watching](/project/board/1179/) to [Our Part Is Done](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Jun 29 2022, 4:33 PM2022-06-29 16:33:18 (UTC+0)](#8037789)Comment Actions
> In [T308659#8037779](/T308659#8037779), [@Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) wrote:
>
> I think we‚Äôre done here (but please reopen if the task should still be open for security release process purposes).

Yes, looks good. This will be (re-)announced via the upcoming supplemental security release, due out tomorrow or early next week. And thanks for shepherding all of those additional backports.

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) edited projects, added [MW-1.39-notes (1.39.0-wmf.21; 2022-07-18)](/project/view/6027/); removed [MW-1.39-notes (1.39.0-wmf.18; 2022-06-27)](/project/view/5966/).[Jul 11 2022, 9:02 PM2022-07-11 21:02:01 (UTC+0)](#8070722)[Stashbot](/p/Stashbot/) added a comment.[Jul 20 2022, 1:54 PM2022-07-20 13:54:11 (UTC+0)](#8091309)Comment Actions

[Mentioned in SAL (#wikimedia-operations)](https://sal.toolforge.org/log/UBzjG4IBa_6PSCT9MiSQ) [2022-07-20T13:54:10Z] <Lucas\_WMDE> lucaswerkmeister-wmde@deploy1002 /srv/mediawiki-staging (master $ u=) $ git -C php-1.39.0-wmf.19/extensions/WikibaseLexeme am --skip # [T308659](/T308659) backport already applied

[Lucas\_Werkmeister\_WMDE](/p/Lucas_Werkmeister_WMDE/) mentioned this in [T313027: MUL - Do not allow adding term descriptions with the language code mul on Wikidata](/T313027).[Nov 2 2022, 9:51 AM2022-11-02 09:51:05 (UTC+0)](#8362180)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. ¬∑ [Wikimedia Foundation](https://wikimediafoundation.org/) ¬∑ [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) ¬∑ [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) ¬∑ [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) ¬∑ [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) ¬∑ [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) ¬∑ [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) ¬∑ [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
