=== Content from phabricator.wikimedia.org_2d3a3843_20250114_214339.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT309894)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T309894
# CVE-2022-41765: HTMLUserTextField exposes existence of hidden usersClosed, Resolved[Public](/policy/explain/PHID-TASK-zaqmcqdr7xzetyevfrah/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/309894/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/309894/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-zaqmcqdr7xzetyevfrah/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-zaqmcqdr7xzetyevfrah/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-zaqmcqdr7xzetyevfrah/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-zaqmcqdr7xzetyevfrah/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-zaqmcqdr7xzetyevfrah/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-zaqmcqdr7xzetyevfrah/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-zaqmcqdr7xzetyevfrah/)
* [Protect as security issue](/wmf/escalate-task/309894/)
* [Award Token](/token/give/PHID-TASK-zaqmcqdr7xzetyevfrah/)
* [Flag For Later](/flag/edit/PHID-TASK-zaqmcqdr7xzetyevfrah/)

Assigned To

|  | [matmarex](/p/matmarex/) |
| --- | --- |

Authored By

|  | [RhinosF1](/p/RhinosF1/) |
| --- | --- |
| Jun 3 2022, 8:26 PM2022-06-03 20:26:02 (UTC+0) |

Tags

* [Security-Team](/tag/security-team/) [(In Progress)](/project/board/1179/)
* [Security](/tag/security/)
* [MediaWiki-HTMLForm](/tag/mediawiki-htmlform/) [(Backlog)](/project/board/540/)
* [Vuln-Infoleak](/tag/vuln-infoleak/)
* [MediaWiki-extensions-CentralAuth](/tag/mediawiki-extensions-centralauth/) [(Backlog)](/project/board/167/)
* [MW-1.38-release](/tag/mw-1.38-release/) [(Blocker)](/project/board/5407/)
* [MW-1.37-release](/tag/mw-1.37-release/) [(Not a blocker)](/project/board/4928/)
* [MW-1.35-release](/tag/mw-1.35-release/) [(Blocker)](/project/board/4035/)
* [MediaWiki-Blocks](/tag/mediawiki-blocks/) [(Backlog)](/project/board/4731/)
* [Platform Engineering](/tag/platform_engineering/) [(Inbox)](/project/board/3654/)
* [Patch-For-Review](/tag/patch-for-review/)
* [affects-Miraheze](/tag/affects-miraheze/) [(Backlog)](/project/board/6096/)
* [MW-1.39-release](/tag/mw-1.39-release/) [(Blocker)](/project/board/5694/)
Referenced Files

|  | [F35321391: 01-T309894.patch](/F35321391) |
| --- | --- |
| Jul 19 2022, 9:04 AM2022-07-19 09:04:13 (UTC+0) |

|  | [F35316520: v2-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch](/F35316520) |
| --- | --- |
| Jul 14 2022, 1:22 AM2022-07-14 01:22:50 (UTC+0) |

|  | [F35316519: v1-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch](/F35316519) |
| --- | --- |
| Jul 14 2022, 1:22 AM2022-07-14 01:22:50 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [AntiCompositeNumber](/p/AntiCompositeNumber/) |
| --- | --- |

|  | [gerritbot](/p/gerritbot/) |
| --- | --- |

|  | [MacFan4000](/p/MacFan4000/) |
| --- | --- |

|  | [matmarex](/p/matmarex/) |
| --- | --- |

|  | [mmartorana](/p/mmartorana/) |
| --- | --- |

|  | [Reception123](/p/Reception123/) |
| --- | --- |

[View All 13 Subscribers](/subscriptions/list/PHID-TASK-zaqmcqdr7xzetyevfrah/)
# Description

At Miraheze, we use the UserTextField to allow users to assign wikis to a user on CreateWiki. See <https://github.com/miraheze/CreateWiki/blob/master/includes/CreateWiki/SpecialCreateWiki.php#L36>

When I attempt to input a locked & hidden user, while autocomplete doesn't suggest it, it still succeeds perfectly fine if I enter it manually and submit the form.

This seems to be a info leak to me. I discussed with [@AntiCompositeNumber](/p/AntiCompositeNumber/) on IRC too

# Details

Risk Rating Low Author Affiliation Other (Please specify in description)

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them](https://gerrit.wikimedia.org/r/c/836911) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/master) | +5 -1 |
|  | [SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them](https://gerrit.wikimedia.org/r/c/836906) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_39](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_39) | +5 -1 |
|  | [SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them](https://gerrit.wikimedia.org/r/c/836901) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_38](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_38) | +5 -1 |
|  | [SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them](https://gerrit.wikimedia.org/r/c/836897) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_37](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_37) | +5 -1 |
|  | [SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them](https://gerrit.wikimedia.org/r/c/836892) | [mediawiki/core](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core) | [REL1\_35](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/%2B/REL1_35) | +5 -1 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T309894)
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T311775 [Release MediaWiki 1.35.8/1.37.5/1.38.3](/T311775) |
|  |  | Resolved |  | [Reedy](/p/Reedy/) | T311776 [Tracking bug for MediaWiki 1.35.8/1.37.5/1.38.3](/T311776) |
|  |  | Resolved | Security | [matmarex](/p/matmarex/) | T309894 [CVE-2022-41765: HTMLUserTextField exposes existence of hidden users](/T309894) |

Mentioned In [T311777: Obtain CVEs for 1.35.8/1.37.5/1.38.3 security releases](/T311777)
[T311776: Tracking bug for MediaWiki 1.35.8/1.37.5/1.38.3](/T311776) Mentioned Here [T311775: Release MediaWiki 1.35.8/1.37.5/1.38.3](/T311775)
[T177329: The code in HTMLUserTextField, as used on Special:Block, would incorrectly check IP ranges (if it worked)](/T177329)
[T311948: Give a error message when using invalid user names on Special:Contributions (HTMLUserTextField does the validation wrong)](/T311948)
### Event Timeline

[RhinosF1](/p/RhinosF1/) created this task.[Jun 3 2022, 8:26 PM2022-06-03 20:26:02 (UTC+0)](#7980029)Restricted Application added a project: [User-RhinosF1](/tag/user-rhinosf1/).  · [View Herald Transcript](/herald/transcript/4798419/)[Jun 3 2022, 8:26 PM2022-06-03 20:26:04 (UTC+0)](#7980041)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/4798419/)[RhinosF1](/p/RhinosF1/) added projects: [MediaWiki-HTMLForm](/tag/mediawiki-htmlform/), [Vuln-Infoleak](/tag/vuln-infoleak/).[Jun 3 2022, 8:26 PM2022-06-03 20:26:50 (UTC+0)](#7980045)[RhinosF1](/p/RhinosF1/) added projects: [MediaWiki-extensions-CentralAuth](/tag/mediawiki-extensions-centralauth/), [MW-1.38-release](/tag/mw-1.38-release/), [MW-1.37-release](/tag/mw-1.37-release/), [MW-1.35-release](/tag/mw-1.35-release/).[RhinosF1](/p/RhinosF1/) added subscribers: [Universal\_Omega](/p/Universal_Omega/), [Reception123](/p/Reception123/), [MacFan4000](/p/MacFan4000/).[AntiCompositeNumber](/p/AntiCompositeNumber/) added a comment.[Jun 3 2022, 8:30 PM2022-06-03 20:30:22 (UTC+0)](#7980062)Comment Actions

While this could be handled in downstream code, I think it would make more sense (and prevent accidental disclosures) to handle it by default in HTMLUserTextField, when checking for user existence. That would make the default behavior consistent with other pages like Special:Contribs.

[RhinosF1](/p/RhinosF1/) added a comment.[Jun 3 2022, 8:44 PM2022-06-03 20:44:27 (UTC+0)](#7980098)Comment Actions

Not sure if it was clear but Miraheze use CentralAuth. Not sure if that is the issue or just the forms system in general.

[sbassett](/p/sbassett/) subscribed.[Jun 8 2022, 2:41 AM2022-06-08 02:41:29 (UTC+0)](#7987574)Comment Actions

So addressing this within HTMLUserTextField would likely involve adding a check of $user->getBlock()->getHideName() within [this conditional block](https://github.com/wikimedia/mediawiki/blob/2107920a8cf86f2b3762bcd204279a411785cdd6/includes/htmlform/fields/HTMLUserTextField.php#L55-L69), though not sure if it makes more sense in the if or elseif, given the slight differences in error messages.

[mmartorana](/p/mmartorana/) changed the task status from Open to In Progress.[Jun 13 2022, 10:03 AM2022-06-13 10:03:26 (UTC+0)](#7998066)[mmartorana](/p/mmartorana/) triaged this task as Low priority.[mmartorana](/p/mmartorana/) changed Risk Rating from N/A to Low.[taavi](/p/taavi/) added a project: [MediaWiki-Blocks](/tag/mediawiki-blocks/).[Jun 14 2022, 6:48 AM2022-06-14 06:48:25 (UTC+0)](#8001228)

[taavi](/p/taavi/) added subscribers: [mmartorana](/p/mmartorana/), [taavi](/p/taavi/).[Jun 14 2022, 7:02 AM2022-06-14 07:02:32 (UTC+0)](#8001273)Comment Actions

[@mmartorana](/p/mmartorana/): hi, you changed this to 'In Progress' - who exactly is working on this?

> In [T309894#7987574](/T309894#7987574), [@sbassett](/p/sbassett/) wrote:
>
> So addressing this within HTMLUserTextField would likely involve adding a check of $user->getBlock()->getHideName() within [this conditional block](https://github.com/wikimedia/mediawiki/blob/2107920a8cf86f2b3762bcd204279a411785cdd6/includes/htmlform/fields/HTMLUserTextField.php#L55-L69), though not sure if it makes more sense in the if or elseif, given the slight differences in error messages.

htmlform-user-not-exists sounds like the correct one in this case I think.

[mmartorana](/p/mmartorana/) added a project: [Platform Engineering](/tag/platform_engineering/).[Jun 16 2022, 11:01 AM2022-06-16 11:01:31 (UTC+0)](#8008502)[mmartorana](/p/mmartorana/) added a project: [Editing-team](/tag/editing-team/).[Jun 16 2022, 11:17 AM2022-06-16 11:17:53 (UTC+0)](#8008523)Comment Actions

Hi @Majavah, in progress means that we are actively processing this task, not necessarily that we are working on a patch.

In this case, since this pertains MediaWiki core, [Platform Engineering](/tag/platform_engineering/) and [Editing-team](/tag/editing-team/) should be in charge of that.

[matmarex](/p/matmarex/) subscribed.[Jun 30 2022, 4:15 PM2022-06-30 16:15:02 (UTC+0)](#8041282)Comment Actions

Can you explain why [Editing-team](/tag/editing-team/)? Sure, we would be able to help if there's somehow no one else capable of resolving this, but I am very confused why anyone would think we're responsible for it…

[sbassett](/p/sbassett/) moved this task from [Incoming](/project/board/1179/) to [In Progress](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Jul 6 2022, 5:17 PM2022-07-06 17:17:36 (UTC+0)](#8056583)[Reedy](/p/Reedy/) moved this task from [Blocker](/project/board/4928/) to [Not a blocker](/project/board/4928/) on the [MW-1.37-release](/tag/mw-1.37-release/) board.[Jul 8 2022, 4:58 PM2022-07-08 16:58:44 (UTC+0)](#8065895)[mmartorana](/p/mmartorana/) added a comment.[Jul 11 2022, 9:29 AM2022-07-11 09:29:23 (UTC+0)](#8068720)Comment Actions

Hi [@matmarex](/p/matmarex/) - we may have made a mistake in our assignment, but the reasoning was likely due to the fact that you are part of the [Editing-team](/tag/editing-team/).

Could you please point me to someone capable of resolving this?

Thank you

[sbassett](/p/sbassett/) removed a project: [Editing-team](/tag/editing-team/).[Jul 11 2022, 4:08 PM2022-07-11 16:08:46 (UTC+0)](#8069930)[matmarex](/p/matmarex/) claimed this task.[Jul 14 2022, 12:59 AM2022-07-14 00:59:17 (UTC+0)](#8076745)Comment Actions

I imagine any engineer would be capable, [@sbassett](/p/sbassett/) has pretty much already solved it in his comment [T309894#7987574](/T309894#7987574).

But if you're looking for someone responsible for it, then there is no one. In the past, members of the Security team would have resolved security issues with no maintainers like this.

I'm happy to write the patch, but I want to make it clear that it's in my volunteer capacity. [Editing-team](/tag/editing-team/) has never worked on this code, and it's not an area that it would make sense for us be responsible for.

[matmarex](/p/matmarex/) added a project: [Patch-For-Review](/tag/patch-for-review/).Edited · [Jul 14 2022, 1:22 AM2022-07-14 01:22:50 (UTC+0)](#8076784)Comment Actions

Security patch: v1-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/5ey34ttyd5bcb3cy6xln/PHID-FILE-weusuo6tyi3lgdveslyn/v1-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch)

There are several non-security bugs in the existing logic though: [T177329](/T177329), [T311948](/T311948). I submitted a patch to fix those to Gerrit: <https://gerrit.wikimedia.org/r/c/813727>. If it is merged, this is the security patch to use instead: v2-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/dnguoonqm3tk7ew3pzfk/PHID-FILE-sx2p6rxi472soym53qw2/v2-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch)

The behavior can be most easily tested on Special:EmailUser.

[mmartorana](/p/mmartorana/) added a comment.[Jul 18 2022, 9:01 AM2022-07-18 09:01:02 (UTC+0)](#8083627)Comment Actions

[@matmarex](/p/matmarex/) thanks a lot.

[sbassett](/p/sbassett/) added a comment.[Jul 18 2022, 9:40 PM2022-07-18 21:40:15 (UTC+0)](#8086210)Comment Actions

Hey all -

I just [deployed](https://sal.toolforge.org/log/l4s9E4IB8Fs0LHO5VLj_) [@matmarex](/p/matmarex/)'s v1 patch from above (thanks again) to 1.39.0-wmf.19. Tested with [enwiki:Special:EmailUser](https://en.wikipedia.org/wiki/Special%3AEmailUser) on mwdebug1002 and then in prod and all looks good - it seems to be throwing the correct error message for hidden users now. No related errors in logstash either. If anybody sees anything off about it, let me know. Otherwise, this task/patch **should be held** for the next mediawiki security release ([T311775](/T311775)).

[sbassett](/p/sbassett/) added a parent task: [T311776: Tracking bug for MediaWiki 1.35.8/1.37.5/1.38.3](/T311776).[Jul 18 2022, 9:40 PM2022-07-18 21:40:39 (UTC+0)](#8086213)[sbassett](/p/sbassett/) added a comment.[Jul 18 2022, 10:28 PM2022-07-18 22:28:40 (UTC+0)](#8086253)Comment Actions
> In [T309894#8076745](/T309894#8076745), [@matmarex](/p/matmarex/) wrote:
>
> But if you're looking for someone responsible for it, then there is no one. In the past, members of the Security team would have resolved security issues with no maintainers like this.

Just a follow-up note on this - yes, this is true in that members of the Security Team were traditionally tasked with "resolving" security issues reported for any Wikimedia codebase. Unfortunately, given [the enormous backlog of security issues that accumulated under this policy](https://phabricator.wikimedia.org/maniphest/query/JIDnMC4FOIzf/#R), this was never a sustainable policy and is quite far from the industry standard of code maintainers owning the risk for their security issues. I think we've failed as a team in communicating this concept to the Foundation and Community over the past several years, but this is going to change in the very near future when our team begins pushing smaller, more frequent updates out over multiple communications channels. It is hoped that this will better set expectations regarding responsibilities, policies and workflows related to the current incarnation of the Security Team.

[Urbanecm](/p/Urbanecm/) subscribed.[Jul 19 2022, 9:04 AM2022-07-19 09:04:13 (UTC+0)](#8086935)Comment Actions
> In [T309894#8086210](/T309894#8086210), [@sbassett](/p/sbassett/) wrote:
>
> Hey all -
>
> I just [deployed](https://sal.toolforge.org/log/l4s9E4IB8Fs0LHO5VLj_) [@matmarex](/p/matmarex/)'s v1 patch from above (thanks again) to 1.39.0-wmf.19.

Thanks for the deployment. I ran into your patch when doing another, unrelated deployment (the applied version of the patch did not have any prefix identifying it as a secpatch, so I had to check whether it is an unmarked sec patch, or uncommitted code). Since it turns out to be a sec patch, I slightly changed the patch file to include the SECURITY: prefix, to avoid confusing others. FTR, this is the currently applied version:

01-T309894.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/lkb5vdmafto646bpekzp/PHID-FILE-xry6qvxfyfoofjfsei35/01-T309894.patch)

[matmarex](/p/matmarex/) added a comment.[Jul 19 2022, 10:06 AM2022-07-19 10:06:44 (UTC+0)](#8087050)Comment Actions
> In [T309894#8086253](/T309894#8086253), [@sbassett](/p/sbassett/) wrote:
> > In [T309894#8076745](/T309894#8076745), [@matmarex](/p/matmarex/) wrote:
> >
> > But if you're looking for someone responsible for it, then there is no one. In the past, members of the Security team would have resolved security issues with no maintainers like this.
>
> Just a follow-up note on this - yes, this is true in that members of the Security Team were traditionally tasked with "resolving" security issues reported for any Wikimedia codebase. Unfortunately, given [the enormous backlog of security issues that accumulated under this policy](https://phabricator.wikimedia.org/maniphest/query/JIDnMC4FOIzf/#R), this was never a sustainable policy and is quite far from the industry standard of code maintainers owning the risk for their security issues. I think we've failed as a team in communicating this concept to the Foundation and Community over the past several years, but this is going to change in the very near future when our team begins pushing smaller, more frequent updates out over multiple communications channels. It is hoped that this will better set expectations regarding responsibilities, policies and workflows related to the current incarnation of the Security Team.

I understand, and I don't mean to say that you *should* be responsible for it, I agree that it's a bad situation to have a "security team" fixing all the issues in other people's code. However, there really is no one else responsible for it, and I'm afraid that just communicating that won't solve that issue – I think it's a management/leadership problem. I would actually enjoy doing more of this work, but right now I feel like I'm neglecting my more "official" responsibilities when I do.

[sbassett](/p/sbassett/) added a comment.[Jul 21 2022, 8:49 PM2022-07-21 20:49:39 (UTC+0)](#8096079)Comment Actions
> In [T309894#8086935](/T309894#8086935), [@Urbanecm](/p/Urbanecm/) wrote:
>
> Thanks for the deployment. I ran into your patch when doing another, unrelated deployment (the applied version of the patch did not have any prefix identifying it as a secpatch, so I had to check whether it is an unmarked sec patch, or uncommitted code). Since it turns out to be a sec patch, I slightly changed the patch file to include the SECURITY: prefix, to avoid confusing others. FTR, this is the currently applied version:

Ok, thanks for fixing that and cleaning everything up on deployment.

> In [T309894#8087050](/T309894#8087050), [@matmarex](/p/matmarex/) wrote:
>
> I understand, and I don't mean to say that you *should* be responsible for it, I agree that it's a bad situation to have a "security team" fixing all the issues in other people's code. However, there really is no one else responsible for it, and I'm afraid that just communicating that won't solve that issue – I think it's a management/leadership problem. I would actually enjoy doing more of this work, but right now I feel like I'm neglecting my more "official" responsibilities when I do.

Agreed. I think some combination of efforts will be necessary to enact any real change. Better communication and expectation-setting on the part of the [Security-Team](/tag/security-team/) is one small thing we can easily change which could have an impact. I think some members of our team would also like to help write and CR more security patches, but we'll need to find a middle-ground between not doing any of this work and doing all of it, neither of which are reasonable positions IMO.

[matmarex](/p/matmarex/) added a comment.[Jul 21 2022, 10:33 PM2022-07-21 22:33:53 (UTC+0)](#8096314)Comment Actions

(<https://gerrit.wikimedia.org/r/c/813727> was merged, so you'll need to v2 patch for next WMF branch)

[sbassett](/p/sbassett/) added a comment.[Jul 22 2022, 2:33 PM2022-07-22 14:33:40 (UTC+0)](#8097585)Comment Actions
> In [T309894#8096314](/T309894#8096314), [@matmarex](/p/matmarex/) wrote:
>
> (<https://gerrit.wikimedia.org/r/c/813727> was merged, so you'll need to v2 patch for next WMF branch)

Ok, thanks for the heads up. Looks like this didn't make 1.39.0-wmf.21, but I'll go ahead and update the patch on deployment for next week's train.

[RhinosF1](/p/RhinosF1/) edited projects, added [affects-Miraheze](/tag/affects-miraheze/); removed [User-RhinosF1](/tag/user-rhinosf1/).[Aug 15 2022, 5:24 PM2022-08-15 17:24:43 (UTC+0)](#8154787)[sbassett](/p/sbassett/) added a comment.[Aug 17 2022, 2:10 AM2022-08-17 02:10:08 (UTC+0)](#8160189)Comment Actions

Sadly, it looks like the v2 patch fell off of production releases for a bit, but is now back on wmf.23 and wmf.25 and redeployed ([sal 1](https://sal.toolforge.org/log/b1uCqYIB6FQ6iqKie-5K), [sal 2](https://sal.toolforge.org/log/eKmHqYIBa_6PSCT9KFzy)).

[Reedy](/p/Reedy/) added a project: [MW-1.39-release](/tag/mw-1.39-release/).[Sep 25 2022, 6:44 PM2022-09-25 18:44:59 (UTC+0)](#8258231)[Reedy](/p/Reedy/) mentioned this in [T311776: Tracking bug for MediaWiki 1.35.8/1.37.5/1.38.3](/T311776).[Sep 25 2022, 7:05 PM2022-09-25 19:05:15 (UTC+0)](#8258239)[Reedy](/p/Reedy/) mentioned this in [T311777: Obtain CVEs for 1.35.8/1.37.5/1.38.3 security releases](/T311777).[Sep 25 2022, 7:11 PM2022-09-25 19:11:17 (UTC+0)](#8258248)

[Reedy](/p/Reedy/) subscribed.[Sep 25 2022, 7:17 PM2022-09-25 19:17:31 (UTC+0)](#8258251)Comment Actions
> In [T309894#8076784](/T309894#8076784), [@matmarex](/p/matmarex/) wrote:
>
> Security patch: v1-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/5ey34ttyd5bcb3cy6xln/PHID-FILE-weusuo6tyi3lgdveslyn/v1-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch)
>
> There are several non-security bugs in the existing logic though: [T177329](/T177329), [T311948](/T311948). I submitted a patch to fix those to Gerrit: <https://gerrit.wikimedia.org/r/c/813727>. If it is merged, this is the security patch to use instead: v2-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/dnguoonqm3tk7ew3pzfk/PHID-FILE-sx2p6rxi472soym53qw2/v2-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch)
>
> The behavior can be most easily tested on Special:EmailUser.

TLDR here/for confirmation...

[https://gerrit.wikimedia.org/r/c/mediawiki/core/+/813727](https://gerrit.wikimedia.org/r/c/mediawiki/core/%2B/813727) made it into REL1\_39 (and master), so it should get v2-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/dnguoonqm3tk7ew3pzfk/PHID-FILE-sx2p6rxi472soym53qw2/v2-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch), which was superceded by 01-T309894.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/lkb5vdmafto646bpekzp/PHID-FILE-xry6qvxfyfoofjfsei35/01-T309894.patch)

For <= REL1\_38, we should use v1-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/5ey34ttyd5bcb3cy6xln/PHID-FILE-weusuo6tyi3lgdveslyn/v1-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch) (or some variant thereof, modifying as needed for backporting) ?

[matmarex](/p/matmarex/) added a comment.[Sep 27 2022, 7:21 PM2022-09-27 19:21:55 (UTC+0)](#8266128)Comment Actions

01-T309894.patch ([F35321391](/F35321391)) doesn't apply for me on master. It looks identical to my v1 patch. I wonder if you uploaded the right file?

[Reedy](/p/Reedy/) added a comment.[Sep 27 2022, 7:23 PM2022-09-27 19:23:04 (UTC+0)](#8266133)Comment Actions
> In [T309894#8266128](/T309894#8266128), [@matmarex](/p/matmarex/) wrote:
>
> 01-T309894.patch ([F35321391](/F35321391)) doesn't apply for me on master. It looks identical to my v1 patch. I wonder if you uploaded the right file?

I didn't upload any files, I just reused the linked files from above..

[matmarex](/p/matmarex/) added a comment.[Sep 27 2022, 8:15 PM2022-09-27 20:15:23 (UTC+0)](#8266294)Comment Actions

Oh, my bad, I didn't notice where it came from.

It looks like it was a replacement for the v1 patch with a tweaked commit message:

> In [T309894#8086935](/T309894#8086935), [@Urbanecm](/p/Urbanecm/) wrote:
>
> Thanks for the deployment. I ran into your patch when doing another, unrelated deployment (the applied version of the patch did not have any prefix identifying it as a secpatch, so I had to check whether it is an unmarked sec patch, or uncommitted code). Since it turns out to be a sec patch, I slightly changed the patch file to include the SECURITY: prefix, to avoid confusing others. FTR, this is the currently applied version:
>
> 01-T309894.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/lkb5vdmafto646bpekzp/PHID-FILE-xry6qvxfyfoofjfsei35/01-T309894.patch)

So, I think the correct procedure is: use the original patches on whichever branches they apply to, but change the commit message of both to read:

```
SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them
```

…as I used the wrong convention for the prefix.

[Reedy](/p/Reedy/) added a comment.[Sep 27 2022, 8:40 PM2022-09-27 20:40:36 (UTC+0)](#8266407)Comment Actions

Yeah, I usually fix up descriptions etc when I apply the patches.

It's just trying to confirm upfront which patches should be applied, especially when we have multiple versions flying around.

> In [T309894#8076784](/T309894#8076784), [@matmarex](/p/matmarex/) wrote:
>
> Security patch: v1-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/5ey34ttyd5bcb3cy6xln/PHID-FILE-weusuo6tyi3lgdveslyn/v1-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch)
>
> There are several non-security bugs in the existing logic though: [T177329](/T177329), [T311948](/T311948). I submitted a patch to fix those to Gerrit: <https://gerrit.wikimedia.org/r/c/813727>. If it is merged, this is the security patch to use instead: v2-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/dnguoonqm3tk7ew3pzfk/PHID-FILE-sx2p6rxi472soym53qw2/v2-SECURITY-HTMLUserTextField-Treat-hidden-users-as-unr.patch)
>
> The behavior can be most easily tested on Special:EmailUser.

^ I was going based on that, as <https://gerrit.wikimedia.org/r/c/813727> had been merged, and then the superceded one...

[Reedy](/p/Reedy/) renamed this task from HTMLUserTextField exposes existence of hidden users to CVE-2022-41765: HTMLUserTextField exposes existence of hidden users.[Sep 29 2022, 5:28 PM2022-09-29 17:28:06 (UTC+0)](#8273413)[Reedy](/p/Reedy/) added a subscriber: [gerritbot](/p/gerritbot/).[Reedy](/p/Reedy/) closed this task as Resolved.[Sep 29 2022, 5:55 PM2022-09-29 17:55:04 (UTC+0)](#8273608)[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 6:57 PM2022-09-29 18:57:25 (UTC+0)](#8273740)Comment Actions

Change 836892 had a related patch set uploaded (by Reedy; author: Bartosz Dziewoński):

[mediawiki/core@REL1\_35] SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836892>

[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 6:58 PM2022-09-29 18:58:06 (UTC+0)](#8273745)Comment Actions

Change 836897 had a related patch set uploaded (by Reedy; author: Bartosz Dziewoński):

[mediawiki/core@REL1\_37] SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836897>

[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 6:58 PM2022-09-29 18:58:36 (UTC+0)](#8273748)Comment Actions

Change 836901 had a related patch set uploaded (by Reedy; author: Bartosz Dziewoński):

[mediawiki/core@REL1\_38] HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836901>

[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 6:59 PM2022-09-29 18:59:09 (UTC+0)](#8273754)Comment Actions

Change 836906 had a related patch set uploaded (by Reedy; author: Bartosz Dziewoński):

[mediawiki/core@REL1\_39] SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836906>

[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 7:00 PM2022-09-29 19:00:40 (UTC+0)](#8273760)Comment Actions

Change 836911 had a related patch set uploaded (by Reedy; author: Bartosz Dziewoński):

[mediawiki/core@master] SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836911>

[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 7:13 PM2022-09-29 19:13:07 (UTC+0)](#8273836)Comment Actions

Change 836892 **merged** by jenkins-bot:

[mediawiki/core@REL1\_35] SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836892>

[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 7:28 PM2022-09-29 19:28:25 (UTC+0)](#8273850)Comment Actions

Change 836897 **merged** by Reedy:

[mediawiki/core@REL1\_37] SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836897>

[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 7:36 PM2022-09-29 19:36:55 (UTC+0)](#8273884)Comment Actions

Change 836901 **merged** by Reedy:

[mediawiki/core@REL1\_38] SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836901>

[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 8:21 PM2022-09-29 20:21:25 (UTC+0)](#8273961)Comment Actions

Change 836911 **merged** by jenkins-bot:

[mediawiki/core@master] SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836911>

[gerritbot](/p/gerritbot/) added a comment.[Sep 29 2022, 8:30 PM2022-09-29 20:30:09 (UTC+0)](#8273996)Comment Actions

Change 836906 **merged** by jenkins-bot:

[mediawiki/core@REL1\_39] SECURITY: HTMLUserTextField: Treat hidden users as unregistered if current user can't view them

<https://gerrit.wikimedia.org/r/836906>

[Reedy](/p/Reedy/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-klq5c5nljchk3wb/)" to "Public (No Login Required)".[Nov 1 2022, 6:07 PM2022-11-01 18:07:01 (UTC+0)](#8360769)[Reedy](/p/Reedy/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-i36kzmxaeob2ujo/)" to "All Users".Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from security.gentoo.org_ae3e6eb7_20250114_214339.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# MediaWiki: Multiple Vulnerabilities — GLSA **202305-24**

Multiple vulnerabilities have been found in MediaWiki, the worst of which could result in denial of service.

### Affected packages

| Package | **www-apps/mediawiki** on all architectures |
| --- | --- |
| Affected versions | < **1.38.5** |
| Unaffected versions | >= **1.38.5** |

### Background

MediaWiki is a collaborative editing software, used by big projects like Wikipedia.

### Description

Multiple vulnerabilities have been discovered in MediaWiki. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All MediaWiki users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-apps/mediawiki-1.38.5"

```
### References

* [CVE-2021-41798](https://nvd.nist.gov/vuln/detail/CVE-2021-41798)
* [CVE-2021-41799](https://nvd.nist.gov/vuln/detail/CVE-2021-41799)
* [CVE-2021-41800](https://nvd.nist.gov/vuln/detail/CVE-2021-41800)
* [CVE-2021-44854](https://nvd.nist.gov/vuln/detail/CVE-2021-44854)
* [CVE-2021-44855](https://nvd.nist.gov/vuln/detail/CVE-2021-44855)
* [CVE-2021-44856](https://nvd.nist.gov/vuln/detail/CVE-2021-44856)
* [CVE-2021-44857](https://nvd.nist.gov/vuln/detail/CVE-2021-44857)
* [CVE-2021-44858](https://nvd.nist.gov/vuln/detail/CVE-2021-44858)
* [CVE-2021-45038](https://nvd.nist.gov/vuln/detail/CVE-2021-45038)
* [CVE-2022-28202](https://nvd.nist.gov/vuln/detail/CVE-2022-28202)
* [CVE-2022-28205](https://nvd.nist.gov/vuln/detail/CVE-2022-28205)
* [CVE-2022-28206](https://nvd.nist.gov/vuln/detail/CVE-2022-28206)
* [CVE-2022-28209](https://nvd.nist.gov/vuln/detail/CVE-2022-28209)
* [CVE-2022-31090](https://nvd.nist.gov/vuln/detail/CVE-2022-31090)
* [CVE-2022-31091](https://nvd.nist.gov/vuln/detail/CVE-2022-31091)
* [CVE-2022-34911](https://nvd.nist.gov/vuln/detail/CVE-2022-34911)
* [CVE-2022-34912](https://nvd.nist.gov/vuln/detail/CVE-2022-34912)
* [CVE-2022-41765](https://nvd.nist.gov/vuln/detail/CVE-2022-41765)
* [CVE-2022-41766](https://nvd.nist.gov/vuln/detail/CVE-2022-41766)
* [CVE-2022-41767](https://nvd.nist.gov/vuln/detail/CVE-2022-41767)
* [CVE-2022-47927](https://nvd.nist.gov/vuln/detail/CVE-2022-47927)

**Release date**

May 21, 2023

**Latest revision**

May 21, 2023: 1

**Severity**

low

**Exploitable**

remote

**Bugzilla entries**

* [815376](https://bugs.gentoo.org/show_bug.cgi?id=815376)
* [829302](https://bugs.gentoo.org/show_bug.cgi?id=829302)
* [836430](https://bugs.gentoo.org/show_bug.cgi?id=836430)
* [855965](https://bugs.gentoo.org/show_bug.cgi?id=855965)
* [873385](https://bugs.gentoo.org/show_bug.cgi?id=873385)
* [888041](https://bugs.gentoo.org/show_bug.cgi?id=888041)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


