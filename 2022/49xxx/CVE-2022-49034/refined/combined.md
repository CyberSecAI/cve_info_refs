=== Content from git.kernel.org_b2165b9c_20250114_205011.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8fbb57eabfc8ae67115cb47f904614c99d626a89)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8fbb57eabfc8ae67115cb47f904614c99d626a89)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8fbb57eabfc8ae67115cb47f904614c99d626a89)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8fbb57eabfc8ae67115cb47f904614c99d626a89)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2022-07-14 16:41:36 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 10:59:40 +0100 |
| commit | [8fbb57eabfc8ae67115cb47f904614c99d626a89](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8fbb57eabfc8ae67115cb47f904614c99d626a89) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8fbb57eabfc8ae67115cb47f904614c99d626a89)) | |
| tree | [1a011f709da335083299f5fca51a411b04771d47](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8fbb57eabfc8ae67115cb47f904614c99d626a89) | |
| parent | [8ed7793f6f589b4e1f0b38f8448578d2a48f9c82](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ed7793f6f589b4e1f0b38f8448578d2a48f9c82) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8fbb57eabfc8ae67115cb47f904614c99d626a89&id2=8ed7793f6f589b4e1f0b38f8448578d2a48f9c82)) | |
| download | [linux-8fbb57eabfc8ae67115cb47f904614c99d626a89.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8fbb57eabfc8ae67115cb47f904614c99d626a89.tar.gz) | |

sh: cpuinfo: Fix a warning for CONFIG\_CPUMASK\_OFFSTACKcommit 3c891f7c6a4e90bb1199497552f24b26e46383bc upstream.
When CONFIG\_CPUMASK\_OFFSTACK and CONFIG\_DEBUG\_PER\_CPU\_MAPS are selected,
cpu\_max\_bits\_warn() generates a runtime warning similar as below when
showing /proc/cpuinfo. Fix this by using nr\_cpu\_ids (the runtime limit)
instead of NR\_CPUS to iterate CPUs.
[ 3.052463] ------------[ cut here ]------------
[ 3.059679] WARNING: CPU: 3 PID: 1 at include/linux/cpumask.h:108 show\_cpuinfo+0x5e8/0x5f0
[ 3.070072] Modules linked in: efivarfs autofs4
[ 3.076257] CPU: 0 PID: 1 Comm: systemd Not tainted 5.19-rc5+ #1052
[ 3.099465] Stack : 9000000100157b08 9000000000f18530 9000000000cf846c 9000000100154000
[ 3.109127] 9000000100157a50 0000000000000000 9000000100157a58 9000000000ef7430
[ 3.118774] 90000001001578e8 0000000000000040 0000000000000020 ffffffffffffffff
[ 3.128412] 0000000000aaaaaa 1ab25f00eec96a37 900000010021de80 900000000101c890
[ 3.138056] 0000000000000000 0000000000000000 0000000000000000 0000000000aaaaaa
[ 3.147711] ffff8000339dc220 0000000000000001 0000000006ab4000 0000000000000000
[ 3.157364] 900000000101c998 0000000000000004 9000000000ef7430 0000000000000000
[ 3.167012] 0000000000000009 000000000000006c 0000000000000000 0000000000000000
[ 3.176641] 9000000000d3de08 9000000001639390 90000000002086d8 00007ffff0080286
[ 3.186260] 00000000000000b0 0000000000000004 0000000000000000 0000000000071c1c
[ 3.195868] ...
[ 3.199917] Call Trace:
[ 3.203941] [<90000000002086d8>] show\_stack+0x38/0x14c
[ 3.210666] [<9000000000cf846c>] dump\_stack\_lvl+0x60/0x88
[ 3.217625] [<900000000023d268>] \_\_warn+0xd0/0x100
[ 3.223958] [<9000000000cf3c90>] warn\_slowpath\_fmt+0x7c/0xcc
[ 3.231150] [<9000000000210220>] show\_cpuinfo+0x5e8/0x5f0
[ 3.238080] [<90000000004f578c>] seq\_read\_iter+0x354/0x4b4
[ 3.245098] [<90000000004c2e90>] new\_sync\_read+0x17c/0x1c4
[ 3.252114] [<90000000004c5174>] vfs\_read+0x138/0x1d0
[ 3.258694] [<90000000004c55f8>] ksys\_read+0x70/0x100
[ 3.265265] [<9000000000cfde9c>] do\_syscall+0x7c/0x94
[ 3.271820] [<9000000000202fe4>] handle\_syscall+0xc4/0x160
[ 3.281824] ---[ end trace 8b484262b4b8c24c ]---
Cc: stable@vger.kernel.org
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Reviewed-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Tested-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8fbb57eabfc8ae67115cb47f904614c99d626a89)

| -rw-r--r-- | [arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/sh/kernel/cpu/proc.c?id=8fbb57eabfc8ae67115cb47f904614c99d626a89) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/sh/kernel/cpu/proc.c b/arch/sh/kernel/cpu/proc.cindex 85961b4f9c6956..136b4aefd73bbb 100644--- a/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=8ed7793f6f589b4e1f0b38f8448578d2a48f9c82)+++ b/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=8fbb57eabfc8ae67115cb47f904614c99d626a89)@@ -133,7 +133,7 @@ static int show\_cpuinfo(struct seq\_file \*m, void \*v)  static void \*c\_start(struct seq\_file \*m, loff\_t \*pos) {- return \*pos < NR\_CPUS ? cpu\_data + \*pos : NULL;+ return \*pos < nr\_cpu\_ids ? cpu\_data + \*pos : NULL; } static void \*c\_next(struct seq\_file \*m, void \*v, loff\_t \*pos) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:48:48 +0000



=== Content from git.kernel.org_69c11d49_20250114_205009.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=701e32900683378d93693fec15d133e2c5f7ada2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=701e32900683378d93693fec15d133e2c5f7ada2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=701e32900683378d93693fec15d133e2c5f7ada2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=701e32900683378d93693fec15d133e2c5f7ada2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2022-07-14 16:41:36 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 14:02:55 +0100 |
| commit | [701e32900683378d93693fec15d133e2c5f7ada2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=701e32900683378d93693fec15d133e2c5f7ada2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=701e32900683378d93693fec15d133e2c5f7ada2)) | |
| tree | [8364c324b5e3890b81e5f28fe69177adc6ddcc7a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=701e32900683378d93693fec15d133e2c5f7ada2) | |
| parent | [12f52e373d63f008ee386f371bdd82a3a3779199](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=12f52e373d63f008ee386f371bdd82a3a3779199) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=701e32900683378d93693fec15d133e2c5f7ada2&id2=12f52e373d63f008ee386f371bdd82a3a3779199)) | |
| download | [linux-701e32900683378d93693fec15d133e2c5f7ada2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-701e32900683378d93693fec15d133e2c5f7ada2.tar.gz) | |

sh: cpuinfo: Fix a warning for CONFIG\_CPUMASK\_OFFSTACKcommit 3c891f7c6a4e90bb1199497552f24b26e46383bc upstream.
When CONFIG\_CPUMASK\_OFFSTACK and CONFIG\_DEBUG\_PER\_CPU\_MAPS are selected,
cpu\_max\_bits\_warn() generates a runtime warning similar as below when
showing /proc/cpuinfo. Fix this by using nr\_cpu\_ids (the runtime limit)
instead of NR\_CPUS to iterate CPUs.
[ 3.052463] ------------[ cut here ]------------
[ 3.059679] WARNING: CPU: 3 PID: 1 at include/linux/cpumask.h:108 show\_cpuinfo+0x5e8/0x5f0
[ 3.070072] Modules linked in: efivarfs autofs4
[ 3.076257] CPU: 0 PID: 1 Comm: systemd Not tainted 5.19-rc5+ #1052
[ 3.099465] Stack : 9000000100157b08 9000000000f18530 9000000000cf846c 9000000100154000
[ 3.109127] 9000000100157a50 0000000000000000 9000000100157a58 9000000000ef7430
[ 3.118774] 90000001001578e8 0000000000000040 0000000000000020 ffffffffffffffff
[ 3.128412] 0000000000aaaaaa 1ab25f00eec96a37 900000010021de80 900000000101c890
[ 3.138056] 0000000000000000 0000000000000000 0000000000000000 0000000000aaaaaa
[ 3.147711] ffff8000339dc220 0000000000000001 0000000006ab4000 0000000000000000
[ 3.157364] 900000000101c998 0000000000000004 9000000000ef7430 0000000000000000
[ 3.167012] 0000000000000009 000000000000006c 0000000000000000 0000000000000000
[ 3.176641] 9000000000d3de08 9000000001639390 90000000002086d8 00007ffff0080286
[ 3.186260] 00000000000000b0 0000000000000004 0000000000000000 0000000000071c1c
[ 3.195868] ...
[ 3.199917] Call Trace:
[ 3.203941] [<90000000002086d8>] show\_stack+0x38/0x14c
[ 3.210666] [<9000000000cf846c>] dump\_stack\_lvl+0x60/0x88
[ 3.217625] [<900000000023d268>] \_\_warn+0xd0/0x100
[ 3.223958] [<9000000000cf3c90>] warn\_slowpath\_fmt+0x7c/0xcc
[ 3.231150] [<9000000000210220>] show\_cpuinfo+0x5e8/0x5f0
[ 3.238080] [<90000000004f578c>] seq\_read\_iter+0x354/0x4b4
[ 3.245098] [<90000000004c2e90>] new\_sync\_read+0x17c/0x1c4
[ 3.252114] [<90000000004c5174>] vfs\_read+0x138/0x1d0
[ 3.258694] [<90000000004c55f8>] ksys\_read+0x70/0x100
[ 3.265265] [<9000000000cfde9c>] do\_syscall+0x7c/0x94
[ 3.271820] [<9000000000202fe4>] handle\_syscall+0xc4/0x160
[ 3.281824] ---[ end trace 8b484262b4b8c24c ]---
Cc: stable@vger.kernel.org
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Reviewed-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Tested-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=701e32900683378d93693fec15d133e2c5f7ada2)

| -rw-r--r-- | [arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/sh/kernel/cpu/proc.c?id=701e32900683378d93693fec15d133e2c5f7ada2) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/sh/kernel/cpu/proc.c b/arch/sh/kernel/cpu/proc.cindex a306bcd6b34130..5f6d0e827baeb0 100644--- a/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=12f52e373d63f008ee386f371bdd82a3a3779199)+++ b/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=701e32900683378d93693fec15d133e2c5f7ada2)@@ -132,7 +132,7 @@ static int show\_cpuinfo(struct seq\_file \*m, void \*v)  static void \*c\_start(struct seq\_file \*m, loff\_t \*pos) {- return \*pos < NR\_CPUS ? cpu\_data + \*pos : NULL;+ return \*pos < nr\_cpu\_ids ? cpu\_data + \*pos : NULL; } static void \*c\_next(struct seq\_file \*m, void \*v, loff\_t \*pos) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:48:46 +0000



=== Content from git.kernel.org_46db23b0_20250114_205009.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3c891f7c6a4e90bb1199497552f24b26e46383bc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c891f7c6a4e90bb1199497552f24b26e46383bc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c891f7c6a4e90bb1199497552f24b26e46383bc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c891f7c6a4e90bb1199497552f24b26e46383bc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2022-07-14 16:41:36 +0800 |
| --- | --- | --- |
| committer | John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de> | 2024-11-30 13:54:36 +0100 |
| commit | [3c891f7c6a4e90bb1199497552f24b26e46383bc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c891f7c6a4e90bb1199497552f24b26e46383bc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3c891f7c6a4e90bb1199497552f24b26e46383bc)) | |
| tree | [0becdeab9d2cfc93ae91e90a62e0861a97bd36b2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3c891f7c6a4e90bb1199497552f24b26e46383bc) | |
| parent | [9852d85ec9d492ebef56dc5f229416c925758edc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9852d85ec9d492ebef56dc5f229416c925758edc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c891f7c6a4e90bb1199497552f24b26e46383bc&id2=9852d85ec9d492ebef56dc5f229416c925758edc)) | |
| download | [linux-3c891f7c6a4e90bb1199497552f24b26e46383bc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3c891f7c6a4e90bb1199497552f24b26e46383bc.tar.gz) | |

sh: cpuinfo: Fix a warning for CONFIG\_CPUMASK\_OFFSTACKWhen CONFIG\_CPUMASK\_OFFSTACK and CONFIG\_DEBUG\_PER\_CPU\_MAPS are selected,
cpu\_max\_bits\_warn() generates a runtime warning similar as below when
showing /proc/cpuinfo. Fix this by using nr\_cpu\_ids (the runtime limit)
instead of NR\_CPUS to iterate CPUs.
[ 3.052463] ------------[ cut here ]------------
[ 3.059679] WARNING: CPU: 3 PID: 1 at include/linux/cpumask.h:108 show\_cpuinfo+0x5e8/0x5f0
[ 3.070072] Modules linked in: efivarfs autofs4
[ 3.076257] CPU: 0 PID: 1 Comm: systemd Not tainted 5.19-rc5+ #1052
[ 3.099465] Stack : 9000000100157b08 9000000000f18530 9000000000cf846c 9000000100154000
[ 3.109127] 9000000100157a50 0000000000000000 9000000100157a58 9000000000ef7430
[ 3.118774] 90000001001578e8 0000000000000040 0000000000000020 ffffffffffffffff
[ 3.128412] 0000000000aaaaaa 1ab25f00eec96a37 900000010021de80 900000000101c890
[ 3.138056] 0000000000000000 0000000000000000 0000000000000000 0000000000aaaaaa
[ 3.147711] ffff8000339dc220 0000000000000001 0000000006ab4000 0000000000000000
[ 3.157364] 900000000101c998 0000000000000004 9000000000ef7430 0000000000000000
[ 3.167012] 0000000000000009 000000000000006c 0000000000000000 0000000000000000
[ 3.176641] 9000000000d3de08 9000000001639390 90000000002086d8 00007ffff0080286
[ 3.186260] 00000000000000b0 0000000000000004 0000000000000000 0000000000071c1c
[ 3.195868] ...
[ 3.199917] Call Trace:
[ 3.203941] [<90000000002086d8>] show\_stack+0x38/0x14c
[ 3.210666] [<9000000000cf846c>] dump\_stack\_lvl+0x60/0x88
[ 3.217625] [<900000000023d268>] \_\_warn+0xd0/0x100
[ 3.223958] [<9000000000cf3c90>] warn\_slowpath\_fmt+0x7c/0xcc
[ 3.231150] [<9000000000210220>] show\_cpuinfo+0x5e8/0x5f0
[ 3.238080] [<90000000004f578c>] seq\_read\_iter+0x354/0x4b4
[ 3.245098] [<90000000004c2e90>] new\_sync\_read+0x17c/0x1c4
[ 3.252114] [<90000000004c5174>] vfs\_read+0x138/0x1d0
[ 3.258694] [<90000000004c55f8>] ksys\_read+0x70/0x100
[ 3.265265] [<9000000000cfde9c>] do\_syscall+0x7c/0x94
[ 3.271820] [<9000000000202fe4>] handle\_syscall+0xc4/0x160
[ 3.281824] ---[ end trace 8b484262b4b8c24c ]---
Cc: stable@vger.kernel.org
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Reviewed-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Tested-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3c891f7c6a4e90bb1199497552f24b26e46383bc)

| -rw-r--r-- | [arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/sh/kernel/cpu/proc.c?id=3c891f7c6a4e90bb1199497552f24b26e46383bc) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/sh/kernel/cpu/proc.c b/arch/sh/kernel/cpu/proc.cindex a306bcd6b34130..5f6d0e827baeb0 100644--- a/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=9852d85ec9d492ebef56dc5f229416c925758edc)+++ b/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=3c891f7c6a4e90bb1199497552f24b26e46383bc)@@ -132,7 +132,7 @@ static int show\_cpuinfo(struct seq\_file \*m, void \*v)  static void \*c\_start(struct seq\_file \*m, loff\_t \*pos) {- return \*pos < NR\_CPUS ? cpu\_data + \*pos : NULL;+ return \*pos < nr\_cpu\_ids ? cpu\_data + \*pos : NULL; } static void \*c\_next(struct seq\_file \*m, void \*v, loff\_t \*pos) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:48:46 +0000



=== Content from git.kernel.org_fb68233f_20250114_205008.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=39373f6f89f52770a5405d30dddd08a27d097872)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=39373f6f89f52770a5405d30dddd08a27d097872)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=39373f6f89f52770a5405d30dddd08a27d097872)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=39373f6f89f52770a5405d30dddd08a27d097872)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2022-07-14 16:41:36 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-05 13:54:20 +0100 |
| commit | [39373f6f89f52770a5405d30dddd08a27d097872](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=39373f6f89f52770a5405d30dddd08a27d097872) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=39373f6f89f52770a5405d30dddd08a27d097872)) | |
| tree | [d70bb602974347771ce6671bcb4df57e3625c3ab](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=39373f6f89f52770a5405d30dddd08a27d097872) | |
| parent | [e9d36f7e71a907ec507f84ee5d60a622c345cac4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e9d36f7e71a907ec507f84ee5d60a622c345cac4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=39373f6f89f52770a5405d30dddd08a27d097872&id2=e9d36f7e71a907ec507f84ee5d60a622c345cac4)) | |
| download | [linux-39373f6f89f52770a5405d30dddd08a27d097872.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-39373f6f89f52770a5405d30dddd08a27d097872.tar.gz) | |

sh: cpuinfo: Fix a warning for CONFIG\_CPUMASK\_OFFSTACKcommit 3c891f7c6a4e90bb1199497552f24b26e46383bc upstream.
When CONFIG\_CPUMASK\_OFFSTACK and CONFIG\_DEBUG\_PER\_CPU\_MAPS are selected,
cpu\_max\_bits\_warn() generates a runtime warning similar as below when
showing /proc/cpuinfo. Fix this by using nr\_cpu\_ids (the runtime limit)
instead of NR\_CPUS to iterate CPUs.
[ 3.052463] ------------[ cut here ]------------
[ 3.059679] WARNING: CPU: 3 PID: 1 at include/linux/cpumask.h:108 show\_cpuinfo+0x5e8/0x5f0
[ 3.070072] Modules linked in: efivarfs autofs4
[ 3.076257] CPU: 0 PID: 1 Comm: systemd Not tainted 5.19-rc5+ #1052
[ 3.099465] Stack : 9000000100157b08 9000000000f18530 9000000000cf846c 9000000100154000
[ 3.109127] 9000000100157a50 0000000000000000 9000000100157a58 9000000000ef7430
[ 3.118774] 90000001001578e8 0000000000000040 0000000000000020 ffffffffffffffff
[ 3.128412] 0000000000aaaaaa 1ab25f00eec96a37 900000010021de80 900000000101c890
[ 3.138056] 0000000000000000 0000000000000000 0000000000000000 0000000000aaaaaa
[ 3.147711] ffff8000339dc220 0000000000000001 0000000006ab4000 0000000000000000
[ 3.157364] 900000000101c998 0000000000000004 9000000000ef7430 0000000000000000
[ 3.167012] 0000000000000009 000000000000006c 0000000000000000 0000000000000000
[ 3.176641] 9000000000d3de08 9000000001639390 90000000002086d8 00007ffff0080286
[ 3.186260] 00000000000000b0 0000000000000004 0000000000000000 0000000000071c1c
[ 3.195868] ...
[ 3.199917] Call Trace:
[ 3.203941] [<90000000002086d8>] show\_stack+0x38/0x14c
[ 3.210666] [<9000000000cf846c>] dump\_stack\_lvl+0x60/0x88
[ 3.217625] [<900000000023d268>] \_\_warn+0xd0/0x100
[ 3.223958] [<9000000000cf3c90>] warn\_slowpath\_fmt+0x7c/0xcc
[ 3.231150] [<9000000000210220>] show\_cpuinfo+0x5e8/0x5f0
[ 3.238080] [<90000000004f578c>] seq\_read\_iter+0x354/0x4b4
[ 3.245098] [<90000000004c2e90>] new\_sync\_read+0x17c/0x1c4
[ 3.252114] [<90000000004c5174>] vfs\_read+0x138/0x1d0
[ 3.258694] [<90000000004c55f8>] ksys\_read+0x70/0x100
[ 3.265265] [<9000000000cfde9c>] do\_syscall+0x7c/0x94
[ 3.271820] [<9000000000202fe4>] handle\_syscall+0xc4/0x160
[ 3.281824] ---[ end trace 8b484262b4b8c24c ]---
Cc: stable@vger.kernel.org
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Reviewed-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Tested-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=39373f6f89f52770a5405d30dddd08a27d097872)

| -rw-r--r-- | [arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/sh/kernel/cpu/proc.c?id=39373f6f89f52770a5405d30dddd08a27d097872) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/sh/kernel/cpu/proc.c b/arch/sh/kernel/cpu/proc.cindex a306bcd6b34130..5f6d0e827baeb0 100644--- a/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=e9d36f7e71a907ec507f84ee5d60a622c345cac4)+++ b/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=39373f6f89f52770a5405d30dddd08a27d097872)@@ -132,7 +132,7 @@ static int show\_cpuinfo(struct seq\_file \*m, void \*v)  static void \*c\_start(struct seq\_file \*m, loff\_t \*pos) {- return \*pos < NR\_CPUS ? cpu\_data + \*pos : NULL;+ return \*pos < nr\_cpu\_ids ? cpu\_data + \*pos : NULL; } static void \*c\_next(struct seq\_file \*m, void \*v, loff\_t \*pos) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:48:45 +0000



=== Content from git.kernel.org_93b966c8_20250114_205011.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2022-07-14 16:41:36 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:51:16 +0100 |
| commit | [e2b91997db286a5dd3cca6d5d9c20004851f22eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb)) | |
| tree | [13a54d11af744273b6a11c3580769d4e16dd4c04](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb) | |
| parent | [bef9a2835011668c221851a7572b6c8433087f85](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bef9a2835011668c221851a7572b6c8433087f85) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb&id2=bef9a2835011668c221851a7572b6c8433087f85)) | |
| download | [linux-e2b91997db286a5dd3cca6d5d9c20004851f22eb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e2b91997db286a5dd3cca6d5d9c20004851f22eb.tar.gz) | |

sh: cpuinfo: Fix a warning for CONFIG\_CPUMASK\_OFFSTACKcommit 3c891f7c6a4e90bb1199497552f24b26e46383bc upstream.
When CONFIG\_CPUMASK\_OFFSTACK and CONFIG\_DEBUG\_PER\_CPU\_MAPS are selected,
cpu\_max\_bits\_warn() generates a runtime warning similar as below when
showing /proc/cpuinfo. Fix this by using nr\_cpu\_ids (the runtime limit)
instead of NR\_CPUS to iterate CPUs.
[ 3.052463] ------------[ cut here ]------------
[ 3.059679] WARNING: CPU: 3 PID: 1 at include/linux/cpumask.h:108 show\_cpuinfo+0x5e8/0x5f0
[ 3.070072] Modules linked in: efivarfs autofs4
[ 3.076257] CPU: 0 PID: 1 Comm: systemd Not tainted 5.19-rc5+ #1052
[ 3.099465] Stack : 9000000100157b08 9000000000f18530 9000000000cf846c 9000000100154000
[ 3.109127] 9000000100157a50 0000000000000000 9000000100157a58 9000000000ef7430
[ 3.118774] 90000001001578e8 0000000000000040 0000000000000020 ffffffffffffffff
[ 3.128412] 0000000000aaaaaa 1ab25f00eec96a37 900000010021de80 900000000101c890
[ 3.138056] 0000000000000000 0000000000000000 0000000000000000 0000000000aaaaaa
[ 3.147711] ffff8000339dc220 0000000000000001 0000000006ab4000 0000000000000000
[ 3.157364] 900000000101c998 0000000000000004 9000000000ef7430 0000000000000000
[ 3.167012] 0000000000000009 000000000000006c 0000000000000000 0000000000000000
[ 3.176641] 9000000000d3de08 9000000001639390 90000000002086d8 00007ffff0080286
[ 3.186260] 00000000000000b0 0000000000000004 0000000000000000 0000000000071c1c
[ 3.195868] ...
[ 3.199917] Call Trace:
[ 3.203941] [<90000000002086d8>] show\_stack+0x38/0x14c
[ 3.210666] [<9000000000cf846c>] dump\_stack\_lvl+0x60/0x88
[ 3.217625] [<900000000023d268>] \_\_warn+0xd0/0x100
[ 3.223958] [<9000000000cf3c90>] warn\_slowpath\_fmt+0x7c/0xcc
[ 3.231150] [<9000000000210220>] show\_cpuinfo+0x5e8/0x5f0
[ 3.238080] [<90000000004f578c>] seq\_read\_iter+0x354/0x4b4
[ 3.245098] [<90000000004c2e90>] new\_sync\_read+0x17c/0x1c4
[ 3.252114] [<90000000004c5174>] vfs\_read+0x138/0x1d0
[ 3.258694] [<90000000004c55f8>] ksys\_read+0x70/0x100
[ 3.265265] [<9000000000cfde9c>] do\_syscall+0x7c/0x94
[ 3.271820] [<9000000000202fe4>] handle\_syscall+0xc4/0x160
[ 3.281824] ---[ end trace 8b484262b4b8c24c ]---
Cc: stable@vger.kernel.org
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Reviewed-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Tested-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb)

| -rw-r--r-- | [arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/sh/kernel/cpu/proc.c?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/sh/kernel/cpu/proc.c b/arch/sh/kernel/cpu/proc.cindex a306bcd6b34130..5f6d0e827baeb0 100644--- a/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=bef9a2835011668c221851a7572b6c8433087f85)+++ b/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=e2b91997db286a5dd3cca6d5d9c20004851f22eb)@@ -132,7 +132,7 @@ static int show\_cpuinfo(struct seq\_file \*m, void \*v)  static void \*c\_start(struct seq\_file \*m, loff\_t \*pos) {- return \*pos < NR\_CPUS ? cpu\_data + \*pos : NULL;+ return \*pos < nr\_cpu\_ids ? cpu\_data + \*pos : NULL; } static void \*c\_next(struct seq\_file \*m, void \*v, loff\_t \*pos) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:48:48 +0000



=== Content from git.kernel.org_c212a7d1_20250114_205012.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2022-07-14 16:41:36 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:44:37 +0100 |
| commit | [f8f26cf69003a37ffa947631fc0e6fe6daee624a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a)) | |
| tree | [2ebca6972e49fb9fd1058fbb270edfa370b3e40a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a) | |
| parent | [376c7f0beb8f6f3800fc3013ef2f422d0cbfbf92](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=376c7f0beb8f6f3800fc3013ef2f422d0cbfbf92) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a&id2=376c7f0beb8f6f3800fc3013ef2f422d0cbfbf92)) | |
| download | [linux-f8f26cf69003a37ffa947631fc0e6fe6daee624a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f8f26cf69003a37ffa947631fc0e6fe6daee624a.tar.gz) | |

sh: cpuinfo: Fix a warning for CONFIG\_CPUMASK\_OFFSTACKcommit 3c891f7c6a4e90bb1199497552f24b26e46383bc upstream.
When CONFIG\_CPUMASK\_OFFSTACK and CONFIG\_DEBUG\_PER\_CPU\_MAPS are selected,
cpu\_max\_bits\_warn() generates a runtime warning similar as below when
showing /proc/cpuinfo. Fix this by using nr\_cpu\_ids (the runtime limit)
instead of NR\_CPUS to iterate CPUs.
[ 3.052463] ------------[ cut here ]------------
[ 3.059679] WARNING: CPU: 3 PID: 1 at include/linux/cpumask.h:108 show\_cpuinfo+0x5e8/0x5f0
[ 3.070072] Modules linked in: efivarfs autofs4
[ 3.076257] CPU: 0 PID: 1 Comm: systemd Not tainted 5.19-rc5+ #1052
[ 3.099465] Stack : 9000000100157b08 9000000000f18530 9000000000cf846c 9000000100154000
[ 3.109127] 9000000100157a50 0000000000000000 9000000100157a58 9000000000ef7430
[ 3.118774] 90000001001578e8 0000000000000040 0000000000000020 ffffffffffffffff
[ 3.128412] 0000000000aaaaaa 1ab25f00eec96a37 900000010021de80 900000000101c890
[ 3.138056] 0000000000000000 0000000000000000 0000000000000000 0000000000aaaaaa
[ 3.147711] ffff8000339dc220 0000000000000001 0000000006ab4000 0000000000000000
[ 3.157364] 900000000101c998 0000000000000004 9000000000ef7430 0000000000000000
[ 3.167012] 0000000000000009 000000000000006c 0000000000000000 0000000000000000
[ 3.176641] 9000000000d3de08 9000000001639390 90000000002086d8 00007ffff0080286
[ 3.186260] 00000000000000b0 0000000000000004 0000000000000000 0000000000071c1c
[ 3.195868] ...
[ 3.199917] Call Trace:
[ 3.203941] [<90000000002086d8>] show\_stack+0x38/0x14c
[ 3.210666] [<9000000000cf846c>] dump\_stack\_lvl+0x60/0x88
[ 3.217625] [<900000000023d268>] \_\_warn+0xd0/0x100
[ 3.223958] [<9000000000cf3c90>] warn\_slowpath\_fmt+0x7c/0xcc
[ 3.231150] [<9000000000210220>] show\_cpuinfo+0x5e8/0x5f0
[ 3.238080] [<90000000004f578c>] seq\_read\_iter+0x354/0x4b4
[ 3.245098] [<90000000004c2e90>] new\_sync\_read+0x17c/0x1c4
[ 3.252114] [<90000000004c5174>] vfs\_read+0x138/0x1d0
[ 3.258694] [<90000000004c55f8>] ksys\_read+0x70/0x100
[ 3.265265] [<9000000000cfde9c>] do\_syscall+0x7c/0x94
[ 3.271820] [<9000000000202fe4>] handle\_syscall+0xc4/0x160
[ 3.281824] ---[ end trace 8b484262b4b8c24c ]---
Cc: stable@vger.kernel.org
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Reviewed-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Tested-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a)

| -rw-r--r-- | [arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/sh/kernel/cpu/proc.c?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/sh/kernel/cpu/proc.c b/arch/sh/kernel/cpu/proc.cindex 85961b4f9c6956..136b4aefd73bbb 100644--- a/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=376c7f0beb8f6f3800fc3013ef2f422d0cbfbf92)+++ b/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=f8f26cf69003a37ffa947631fc0e6fe6daee624a)@@ -133,7 +133,7 @@ static int show\_cpuinfo(struct seq\_file \*m, void \*v)  static void \*c\_start(struct seq\_file \*m, loff\_t \*pos) {- return \*pos < NR\_CPUS ? cpu\_data + \*pos : NULL;+ return \*pos < nr\_cpu\_ids ? cpu\_data + \*pos : NULL; } static void \*c\_next(struct seq\_file \*m, void \*v, loff\_t \*pos) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:48:49 +0000



=== Content from git.kernel.org_ccc68927_20250114_205007.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2022-07-14 16:41:36 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-09 10:32:50 +0100 |
| commit | [09faf32c682ea4a547200b8b9e04d8b3c8e84b55](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55)) | |
| tree | [f15df87da28ab46acb2f8d7ebc8552502f846fbd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55) | |
| parent | [8204dd589c4f25a7618eece5da3f0871e02af8ae](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8204dd589c4f25a7618eece5da3f0871e02af8ae) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55&id2=8204dd589c4f25a7618eece5da3f0871e02af8ae)) | |
| download | [linux-09faf32c682ea4a547200b8b9e04d8b3c8e84b55.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-09faf32c682ea4a547200b8b9e04d8b3c8e84b55.tar.gz) | |

sh: cpuinfo: Fix a warning for CONFIG\_CPUMASK\_OFFSTACKcommit 3c891f7c6a4e90bb1199497552f24b26e46383bc upstream.
When CONFIG\_CPUMASK\_OFFSTACK and CONFIG\_DEBUG\_PER\_CPU\_MAPS are selected,
cpu\_max\_bits\_warn() generates a runtime warning similar as below when
showing /proc/cpuinfo. Fix this by using nr\_cpu\_ids (the runtime limit)
instead of NR\_CPUS to iterate CPUs.
[ 3.052463] ------------[ cut here ]------------
[ 3.059679] WARNING: CPU: 3 PID: 1 at include/linux/cpumask.h:108 show\_cpuinfo+0x5e8/0x5f0
[ 3.070072] Modules linked in: efivarfs autofs4
[ 3.076257] CPU: 0 PID: 1 Comm: systemd Not tainted 5.19-rc5+ #1052
[ 3.099465] Stack : 9000000100157b08 9000000000f18530 9000000000cf846c 9000000100154000
[ 3.109127] 9000000100157a50 0000000000000000 9000000100157a58 9000000000ef7430
[ 3.118774] 90000001001578e8 0000000000000040 0000000000000020 ffffffffffffffff
[ 3.128412] 0000000000aaaaaa 1ab25f00eec96a37 900000010021de80 900000000101c890
[ 3.138056] 0000000000000000 0000000000000000 0000000000000000 0000000000aaaaaa
[ 3.147711] ffff8000339dc220 0000000000000001 0000000006ab4000 0000000000000000
[ 3.157364] 900000000101c998 0000000000000004 9000000000ef7430 0000000000000000
[ 3.167012] 0000000000000009 000000000000006c 0000000000000000 0000000000000000
[ 3.176641] 9000000000d3de08 9000000001639390 90000000002086d8 00007ffff0080286
[ 3.186260] 00000000000000b0 0000000000000004 0000000000000000 0000000000071c1c
[ 3.195868] ...
[ 3.199917] Call Trace:
[ 3.203941] [<90000000002086d8>] show\_stack+0x38/0x14c
[ 3.210666] [<9000000000cf846c>] dump\_stack\_lvl+0x60/0x88
[ 3.217625] [<900000000023d268>] \_\_warn+0xd0/0x100
[ 3.223958] [<9000000000cf3c90>] warn\_slowpath\_fmt+0x7c/0xcc
[ 3.231150] [<9000000000210220>] show\_cpuinfo+0x5e8/0x5f0
[ 3.238080] [<90000000004f578c>] seq\_read\_iter+0x354/0x4b4
[ 3.245098] [<90000000004c2e90>] new\_sync\_read+0x17c/0x1c4
[ 3.252114] [<90000000004c5174>] vfs\_read+0x138/0x1d0
[ 3.258694] [<90000000004c55f8>] ksys\_read+0x70/0x100
[ 3.265265] [<9000000000cfde9c>] do\_syscall+0x7c/0x94
[ 3.271820] [<9000000000202fe4>] handle\_syscall+0xc4/0x160
[ 3.281824] ---[ end trace 8b484262b4b8c24c ]---
Cc: stable@vger.kernel.org
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Reviewed-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Tested-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55)

| -rw-r--r-- | [arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/sh/kernel/cpu/proc.c?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/sh/kernel/cpu/proc.c b/arch/sh/kernel/cpu/proc.cindex a306bcd6b34130..5f6d0e827baeb0 100644--- a/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=8204dd589c4f25a7618eece5da3f0871e02af8ae)+++ b/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=09faf32c682ea4a547200b8b9e04d8b3c8e84b55)@@ -132,7 +132,7 @@ static int show\_cpuinfo(struct seq\_file \*m, void \*v)  static void \*c\_start(struct seq\_file \*m, loff\_t \*pos) {- return \*pos < NR\_CPUS ? cpu\_data + \*pos : NULL;+ return \*pos < nr\_cpu\_ids ? cpu\_data + \*pos : NULL; } static void \*c\_next(struct seq\_file \*m, void \*v, loff\_t \*pos) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:48:44 +0000



=== Content from git.kernel.org_2279edbf_20250114_205007.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2022-07-14 16:41:36 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:54:03 +0100 |
| commit | [2b6b8e011fab680a223b5e07a3c64774156ec6fe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe)) | |
| tree | [65b43888e6fa4845ace0a2892df2dddbe7dd6960](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe) | |
| parent | [dc5251b1af5c9a0749322bf58bd5aa673f545fe2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dc5251b1af5c9a0749322bf58bd5aa673f545fe2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe&id2=dc5251b1af5c9a0749322bf58bd5aa673f545fe2)) | |
| download | [linux-2b6b8e011fab680a223b5e07a3c64774156ec6fe.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2b6b8e011fab680a223b5e07a3c64774156ec6fe.tar.gz) | |

sh: cpuinfo: Fix a warning for CONFIG\_CPUMASK\_OFFSTACKcommit 3c891f7c6a4e90bb1199497552f24b26e46383bc upstream.
When CONFIG\_CPUMASK\_OFFSTACK and CONFIG\_DEBUG\_PER\_CPU\_MAPS are selected,
cpu\_max\_bits\_warn() generates a runtime warning similar as below when
showing /proc/cpuinfo. Fix this by using nr\_cpu\_ids (the runtime limit)
instead of NR\_CPUS to iterate CPUs.
[ 3.052463] ------------[ cut here ]------------
[ 3.059679] WARNING: CPU: 3 PID: 1 at include/linux/cpumask.h:108 show\_cpuinfo+0x5e8/0x5f0
[ 3.070072] Modules linked in: efivarfs autofs4
[ 3.076257] CPU: 0 PID: 1 Comm: systemd Not tainted 5.19-rc5+ #1052
[ 3.099465] Stack : 9000000100157b08 9000000000f18530 9000000000cf846c 9000000100154000
[ 3.109127] 9000000100157a50 0000000000000000 9000000100157a58 9000000000ef7430
[ 3.118774] 90000001001578e8 0000000000000040 0000000000000020 ffffffffffffffff
[ 3.128412] 0000000000aaaaaa 1ab25f00eec96a37 900000010021de80 900000000101c890
[ 3.138056] 0000000000000000 0000000000000000 0000000000000000 0000000000aaaaaa
[ 3.147711] ffff8000339dc220 0000000000000001 0000000006ab4000 0000000000000000
[ 3.157364] 900000000101c998 0000000000000004 9000000000ef7430 0000000000000000
[ 3.167012] 0000000000000009 000000000000006c 0000000000000000 0000000000000000
[ 3.176641] 9000000000d3de08 9000000001639390 90000000002086d8 00007ffff0080286
[ 3.186260] 00000000000000b0 0000000000000004 0000000000000000 0000000000071c1c
[ 3.195868] ...
[ 3.199917] Call Trace:
[ 3.203941] [<90000000002086d8>] show\_stack+0x38/0x14c
[ 3.210666] [<9000000000cf846c>] dump\_stack\_lvl+0x60/0x88
[ 3.217625] [<900000000023d268>] \_\_warn+0xd0/0x100
[ 3.223958] [<9000000000cf3c90>] warn\_slowpath\_fmt+0x7c/0xcc
[ 3.231150] [<9000000000210220>] show\_cpuinfo+0x5e8/0x5f0
[ 3.238080] [<90000000004f578c>] seq\_read\_iter+0x354/0x4b4
[ 3.245098] [<90000000004c2e90>] new\_sync\_read+0x17c/0x1c4
[ 3.252114] [<90000000004c5174>] vfs\_read+0x138/0x1d0
[ 3.258694] [<90000000004c55f8>] ksys\_read+0x70/0x100
[ 3.265265] [<9000000000cfde9c>] do\_syscall+0x7c/0x94
[ 3.271820] [<9000000000202fe4>] handle\_syscall+0xc4/0x160
[ 3.281824] ---[ end trace 8b484262b4b8c24c ]---
Cc: stable@vger.kernel.org
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Reviewed-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Tested-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe)

| -rw-r--r-- | [arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/sh/kernel/cpu/proc.c?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/sh/kernel/cpu/proc.c b/arch/sh/kernel/cpu/proc.cindex a306bcd6b34130..5f6d0e827baeb0 100644--- a/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=dc5251b1af5c9a0749322bf58bd5aa673f545fe2)+++ b/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=2b6b8e011fab680a223b5e07a3c64774156ec6fe)@@ -132,7 +132,7 @@ static int show\_cpuinfo(struct seq\_file \*m, void \*v)  static void \*c\_start(struct seq\_file \*m, loff\_t \*pos) {- return \*pos < NR\_CPUS ? cpu\_data + \*pos : NULL;+ return \*pos < nr\_cpu\_ids ? cpu\_data + \*pos : NULL; } static void \*c\_next(struct seq\_file \*m, void \*v, loff\_t \*pos) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:48:44 +0000



=== Content from git.kernel.org_e345540b_20250114_205010.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=77755dc95ff2f9a3e473acc1e039f498629949ea)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=77755dc95ff2f9a3e473acc1e039f498629949ea)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=77755dc95ff2f9a3e473acc1e039f498629949ea)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=77755dc95ff2f9a3e473acc1e039f498629949ea)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Huacai Chen <chenhuacai@loongson.cn> | 2022-07-14 16:41:36 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-12-14 19:48:11 +0100 |
| commit | [77755dc95ff2f9a3e473acc1e039f498629949ea](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=77755dc95ff2f9a3e473acc1e039f498629949ea) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=77755dc95ff2f9a3e473acc1e039f498629949ea)) | |
| tree | [c97d012f5a41c4481494e53ff568e1057e27436a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=77755dc95ff2f9a3e473acc1e039f498629949ea) | |
| parent | [35f8f72b45791a6a71b81140c59d02a6183b6f3b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35f8f72b45791a6a71b81140c59d02a6183b6f3b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=77755dc95ff2f9a3e473acc1e039f498629949ea&id2=35f8f72b45791a6a71b81140c59d02a6183b6f3b)) | |
| download | [linux-77755dc95ff2f9a3e473acc1e039f498629949ea.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-77755dc95ff2f9a3e473acc1e039f498629949ea.tar.gz) | |

sh: cpuinfo: Fix a warning for CONFIG\_CPUMASK\_OFFSTACKcommit 3c891f7c6a4e90bb1199497552f24b26e46383bc upstream.
When CONFIG\_CPUMASK\_OFFSTACK and CONFIG\_DEBUG\_PER\_CPU\_MAPS are selected,
cpu\_max\_bits\_warn() generates a runtime warning similar as below when
showing /proc/cpuinfo. Fix this by using nr\_cpu\_ids (the runtime limit)
instead of NR\_CPUS to iterate CPUs.
[ 3.052463] ------------[ cut here ]------------
[ 3.059679] WARNING: CPU: 3 PID: 1 at include/linux/cpumask.h:108 show\_cpuinfo+0x5e8/0x5f0
[ 3.070072] Modules linked in: efivarfs autofs4
[ 3.076257] CPU: 0 PID: 1 Comm: systemd Not tainted 5.19-rc5+ #1052
[ 3.099465] Stack : 9000000100157b08 9000000000f18530 9000000000cf846c 9000000100154000
[ 3.109127] 9000000100157a50 0000000000000000 9000000100157a58 9000000000ef7430
[ 3.118774] 90000001001578e8 0000000000000040 0000000000000020 ffffffffffffffff
[ 3.128412] 0000000000aaaaaa 1ab25f00eec96a37 900000010021de80 900000000101c890
[ 3.138056] 0000000000000000 0000000000000000 0000000000000000 0000000000aaaaaa
[ 3.147711] ffff8000339dc220 0000000000000001 0000000006ab4000 0000000000000000
[ 3.157364] 900000000101c998 0000000000000004 9000000000ef7430 0000000000000000
[ 3.167012] 0000000000000009 000000000000006c 0000000000000000 0000000000000000
[ 3.176641] 9000000000d3de08 9000000001639390 90000000002086d8 00007ffff0080286
[ 3.186260] 00000000000000b0 0000000000000004 0000000000000000 0000000000071c1c
[ 3.195868] ...
[ 3.199917] Call Trace:
[ 3.203941] [<90000000002086d8>] show\_stack+0x38/0x14c
[ 3.210666] [<9000000000cf846c>] dump\_stack\_lvl+0x60/0x88
[ 3.217625] [<900000000023d268>] \_\_warn+0xd0/0x100
[ 3.223958] [<9000000000cf3c90>] warn\_slowpath\_fmt+0x7c/0xcc
[ 3.231150] [<9000000000210220>] show\_cpuinfo+0x5e8/0x5f0
[ 3.238080] [<90000000004f578c>] seq\_read\_iter+0x354/0x4b4
[ 3.245098] [<90000000004c2e90>] new\_sync\_read+0x17c/0x1c4
[ 3.252114] [<90000000004c5174>] vfs\_read+0x138/0x1d0
[ 3.258694] [<90000000004c55f8>] ksys\_read+0x70/0x100
[ 3.265265] [<9000000000cfde9c>] do\_syscall+0x7c/0x94
[ 3.271820] [<9000000000202fe4>] handle\_syscall+0xc4/0x160
[ 3.281824] ---[ end trace 8b484262b4b8c24c ]---
Cc: stable@vger.kernel.org
Signed-off-by: Huacai Chen <chenhuacai@loongson.cn>
Reviewed-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Tested-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: John Paul Adrian Glaubitz <glaubitz@physik.fu-berlin.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=77755dc95ff2f9a3e473acc1e039f498629949ea)

| -rw-r--r-- | [arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/sh/kernel/cpu/proc.c?id=77755dc95ff2f9a3e473acc1e039f498629949ea) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/arch/sh/kernel/cpu/proc.c b/arch/sh/kernel/cpu/proc.cindex a306bcd6b34130..5f6d0e827baeb0 100644--- a/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=35f8f72b45791a6a71b81140c59d02a6183b6f3b)+++ b/[arch/sh/kernel/cpu/proc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/sh/kernel/cpu/proc.c?id=77755dc95ff2f9a3e473acc1e039f498629949ea)@@ -132,7 +132,7 @@ static int show\_cpuinfo(struct seq\_file \*m, void \*v)  static void \*c\_start(struct seq\_file \*m, loff\_t \*pos) {- return \*pos < NR\_CPUS ? cpu\_data + \*pos : NULL;+ return \*pos < nr\_cpu\_ids ? cpu\_data + \*pos : NULL; } static void \*c\_next(struct seq\_file \*m, void \*v, loff\_t \*pos) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:48:47 +0000


