=== Content from lists.debian.org_fd6e070d_20250114_190444.html ===


---

[[Date Prev](msg00033.html)][[Date Next](msg00035.html)]
[[Thread Prev](msg00033.html)][[Thread Next](msg00035.html)]
[[Date Index](maillist.html#00034)]
[[Thread Index](threads.html#00034)]

# [SECURITY] [DLA 3245-1] linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3245-1] linux security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Fri, 23 Dec 2022 23:16:58 +0100
* *Message-id*: <[[üîé]](/msgid-search/1bbd98236848af2b95e3e5504023b5363cf93d77.camel%40debian.org)¬†[1bbd98236848af2b95e3e5504023b5363cf93d77.camel@debian.org](msg00034.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3245-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
December 21, 2022                             <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux
Version        : 4.19.269-1
CVE ID         : CVE-2022-2978 CVE-2022-3521 CVE-2022-3524 CVE-2022-3564
                 CVE-2022-3565 CVE-2022-3594 CVE-2022-3621 CVE-2022-3628
                 CVE-2022-3640 CVE-2022-3643 CVE-2022-3646 CVE-2022-3649
                 CVE-2022-4378 CVE-2022-20369 CVE-2022-29901 CVE-2022-40768
                 CVE-2022-41849 CVE-2022-41850 CVE-2022-42328 CVE-2022-42329
                 CVE-2022-42895 CVE-2022-42896 CVE-2022-43750

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2022-2978

    "butt3rflyh4ck", Hao Sun, and Jiacheng Xu reported a flaw in the
    nilfs2 filesystem driver which can lead to a use-after-free.  A
    local use might be able to exploit this to cause a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2022-3521

    The syzbot tool found a race condition in the KCM subsystem
    which could lead to a crash.

    This subsystem is not enabled in Debian's official kernel
    configurations.

CVE-2022-3524

    The syzbot tool found a race condition in the IPv6 stack which
    could lead to a memory leak.  A local user could exploit this to
    cause a denial of service (memory exhaustion).

CVE-2022-3564

    A flaw was discovered in the Bluetooh L2CAP subsystem which
    would lead to a use-after-free.  This might be exploitable
    to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-3565

    A flaw was discovered in the mISDN driver which would lead to a
    use-after-free.  This might be exploitable to cause a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2022-3594

    Andrew Gaul reported that the r8152 Ethernet driver would log
    excessive numbers of messages in response to network errors.  A
    remote attacker could possibly exploit this to cause a denial of
    service (resource exhaustion).

CVE-2022-3621, CVE-2022-3646

    The syzbot tool found flaws in the nilfs2 filesystem driver which
    can lead to a null pointer dereference or memory leak.  A user
    permitted to mount arbitrary filesystem images could use these to
    cause a denial of service (crash or resource exhaustion).

CVE-2022-3628

    Dokyung Song, Jisoo Jang, and Minsuk Kang reported a potential
    heap-based buffer overflow in the brcmfmac Wi-Fi driver.  A user
    able to connect a malicious USB device could exploit this to cause
    a denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2022-3640

    A flaw was discovered in the Bluetooh L2CAP subsystem which
    would lead to a use-after-free.  This might be exploitable
    to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-3643 (XSA-423)

    A flaw was discovered in the Xen network backend driver that would
    result in it generating malformed packet buffers.  If these
    packets were forwarded to certain other network devices, a Xen
    guest could exploit this to cause a denial of service (crash or
    device reset).

CVE-2022-3649

    The syzbot tool found flaws in the nilfs2 filesystem driver which
    can lead to a use-after-free.  A user permitted to mount arbitrary
    filesystem images could use these to cause a denial of service
    (crash or memory corruption) or possibly for privilege escalation.

CVE-2022-4378

    Kyle Zeng found a flaw in procfs that would cause a stack-based
    buffer overflow.  A local user permitted to write to a sysctl
    could use this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2022-20369

    A flaw was found in the v4l2-mem2mem media driver that would lead
    to an out-of-bounds write.  A local user with access to such a
    device could exploit this for privilege escalation.

CVE-2022-29901

    Johannes Wikner and Kaveh Razavi reported that for Intel
    processors (Intel Core generation 6, 7 and 8), protections against
    speculative branch target injection attacks were insufficient in
    some circumstances, which may allow arbitrary speculative code
    execution under certain microarchitecture-dependent conditions.

    More information can be found at
    <https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/advisory-guidance/return-stack-buffer-underflow.html>

CVE-2022-40768

    "hdthky" reported that the stex SCSI adapter driver did not fully
    initialise a structure that is copied to user-space.  A local user
    with access to such a device could exploit this to leak sensitive
    information.

CVE-2022-41849

    A race condition was discovered in the smscufx graphics driver,
    which could lead to a use-after-free.  A user able to remove the
    physical device while also accessing its device node could exploit
    this to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-41850

    A race condition was discovered in the hid-roccat input driver,
    which could lead to a use-after-free.  A local user able to access
    such a device could exploit this to cause a denial of service
    (crash or memory corruption) or possibly for privilege escalation.

CVE-2022-42328, CVE-2022-42329 (XSA-424)

    Yang Yingliang reported that the Xen network backend driver did
    not use the proper function to free packet buffers in one case,
    which could lead to a deadlock.  A Xen guest could exploit this to
    cause a denial of service (hang).

CVE-2022-42895

    Tam√°s Koczka reported a flaw in the Bluetooh L2CAP subsystem
    that would result in reading uninitialised memory.  A nearby
    attacker able to make a Bluetooth connection could exploit
    this to leak sensitive information.

CVE-2022-42896

    Tam√°s Koczka reported flaws in the Bluetooh L2CAP subsystem that
    can lead to a use-after-free.  A nearby attacker able to make a
    Bluetooth SMP connection could exploit this to cause a denial of
    service (crash or memory corruption) or possibly for remote code
    execution.

CVE-2022-43750

    The syzbot tool found that the USB monitor (usbmon) driver allowed
    user-space programs to overwrite the driver's data structures.  A
    local user permitted to access a USB monitor device could exploit
    this to cause a denial of service (memory corruption or crash) or
    possibly for privilege escalation.  However, by default only the
    root user can access such devices.

For Debian 10 buster, these problems have been fixed in version
4.19.269-1.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS
teams

```

**Attachment:
[signature.asc](pgpJBRnFmtPRG.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from lore.kernel.org_0facbca8_20250114_190444.html ===

```
[linux-fsdevel.vger.kernel.org archive mirror](../../?t=20220825194533)
 [help](../../_/text/help/) / [color](../../_/text/color/) / [mirror](../../_/text/mirror/) / [Atom feed](../../new.atom)
```
```
[*](#ee8111bf2a3f8007cca793b54199a4dd8322aabd0) [PATCH v2] fs: fix UAF/GPF bug in nilfs_mdt_destroy
@ 2022-08-16  4:08 Dongliang Mu
  2022-08-16 10:46 ` [Christian Brauner](#mce7454190265c6ce89575661e778286bed202e35)
  2022-08-25 19:45 ` [Eric Sandeen](#ma4f9cdbe52039cd940b65d4d7501d6f8d39c7b57)
  [0 siblings, 2 replies; 3+ messages in thread](#re8111bf2a3f8007cca793b54199a4dd8322aabd0)
From: Dongliang Mu @ 2022-08-16  4:08 UTC ([permalink](../../20220816040859.659129-1-dzm91%40hust.edu.cn/) / [raw](../../20220816040859.659129-1-dzm91%40hust.edu.cn/raw))
  To: Alexander Viro
  Cc: Dongliang Mu, butt3rflyh4ck, Hao Sun, Jiacheng Xu, [stable](../../../stable/?t=20220816073240),
	[linux-fsdevel](../../../linux-fsdevel/?t=20220816073240), [linux-kernel](../../../lkml/?t=20220816073240)

From: Dongliang Mu <mudongliangabcd@gmail.com>

In alloc_inode, inode_init_always() could return -ENOMEM if
security_inode_alloc() fails, which causes inode->i_private
uninitialized. Then nilfs_is_metadata_file_inode() returns
true and nilfs_free_inode() wrongly calls nilfs_mdt_destroy(),
which frees the uninitialized inode->i_private
and leads to crashes(e.g., UAF/GPF).

Fix this by moving security_inode_alloc just prior to
this_cpu_inc(nr_inodes)

Link:¬†[https://lkml.kernel.org/r/CAFcO6XOcf1Jj2SeGt=jJV59wmhESeSKpfR0omdFRq+J9nD1vfQ@mail.gmail.com](https://lkml.kernel.org/r/CAFcO6XOcf1Jj2SeGt%3DjJV59wmhESeSKpfR0omdFRq%2BJ9nD1vfQ%40mail.gmail.com)
Reported-by: butt3rflyh4ck <butterflyhuangxx@gmail.com>
Reported-by: Hao Sun <sunhao.th@gmail.com>
Reported-by: Jiacheng Xu <stitch@zju.edu.cn>
Signed-off-by: Dongliang Mu <mudongliangabcd@gmail.com>
Cc: Al Viro <viro@zeniv.linux.org.uk>
Cc: stable@vger.kernel.org
---
v1->v2: move security_inode_alloc at the very end according to Al Viro
	other than initializing i_private before security_inode_alloc.
 [fs/inode.c](#Z2e.:..:20220816040859.659129-1-dzm91::40hust.edu.cn:1fs:inode.c) | 5 +++--
 1 file [changed](#ee8111bf2a3f8007cca793b54199a4dd8322aabd0), 3 insertions(+), 2 deletions(-)

[diff](#iZ2e.:..:20220816040859.659129-1-dzm91::40hust.edu.cn:1fs:inode.c) --git a/fs/inode.c b/fs/inode.c
index 6462276dfdf0..49d1eb91728c 100644
--- a/fs/inode.c
+++ b/fs/inode.c
@@ -192,8 +192,6 @@ int inode_init_always(struct super_block *sb, struct inode *inode)
 	inode->i_wb_frn_history = 0;
 #endif

-	if (security_inode_alloc(inode))
-		goto out;
 	spin_lock_init(&inode->i_lock);
 	lockdep_set_class(&inode->i_lock, &sb->s_type->i_lock_key);

@@ -228,6 +226,9 @@ int inode_init_always(struct super_block *sb, struct inode *inode)
 	inode->i_fsnotify_mask = 0;
 #endif
 	inode->i_flctx = NULL;
+
+	if (security_inode_alloc(inode))
+		goto out;
 	this_cpu_inc(nr_inodes);

 	return 0;
--
2.35.1

[^](#me8111bf2a3f8007cca793b54199a4dd8322aabd0) [permalink](../../20220816040859.659129-1-dzm91%40hust.edu.cn/) [raw](../../20220816040859.659129-1-dzm91%40hust.edu.cn/raw) [reply](../../20220816040859.659129-1-dzm91%40hust.edu.cn/#R) [related](../../20220816040859.659129-1-dzm91%40hust.edu.cn/#related)	[[flat](../../20220816040859.659129-1-dzm91%40hust.edu.cn/T/#u)|[nested](../../20220816040859.659129-1-dzm91%40hust.edu.cn/t/#u)] [3+ messages in thread](#re8111bf2a3f8007cca793b54199a4dd8322aabd0)
```

---

```
[*](#ece7454190265c6ce89575661e778286bed202e35) Re: [PATCH v2] fs: fix UAF/GPF bug in nilfs_mdt_destroy
  2022-08-16  4:08 [[PATCH v2] fs: fix UAF/GPF bug in nilfs_mdt_destroy](#me8111bf2a3f8007cca793b54199a4dd8322aabd0) Dongliang Mu
@ 2022-08-16 10:46 ` Christian Brauner
  2022-08-25 19:45 ` [Eric Sandeen](#ma4f9cdbe52039cd940b65d4d7501d6f8d39c7b57)
  [1 sibling, 0 replies; 3+ messages in thread](#rce7454190265c6ce89575661e778286bed202e35)
From: Christian Brauner @ 2022-08-16 10:46 UTC ([permalink](../../20220816104642.qmjegdtthyzy5xbv%40wittgenstein/) / [raw](../../20220816104642.qmjegdtthyzy5xbv%40wittgenstein/raw))
  To: Dongliang Mu
  Cc: Alexander Viro, Dongliang Mu, butt3rflyh4ck, Hao Sun, Jiacheng Xu,
	[stable](../../../stable/?t=20220816113048), [linux-fsdevel](../../../linux-fsdevel/?t=20220816113048), [linux-kernel](../../../lkml/?t=20220816113048)

On Tue, Aug 16, 2022 at 12:08:58PM +0800, Dongliang Mu wrote:
> From: Dongliang Mu <mudongliangabcd@gmail.com>
>
> In alloc_inode, inode_init_always() could return -ENOMEM if
> security_inode_alloc() fails, which causes inode->i_private
> uninitialized. Then nilfs_is_metadata_file_inode() returns
> true and nilfs_free_inode() wrongly calls nilfs_mdt_destroy(),
> which frees the uninitialized inode->i_private
> and leads to crashes(e.g., UAF/GPF).
>
> Fix this by moving security_inode_alloc just prior to
> this_cpu_inc(nr_inodes)
>
> Link:¬†[https://lkml.kernel.org/r/CAFcO6XOcf1Jj2SeGt=jJV59wmhESeSKpfR0omdFRq+J9nD1vfQ@mail.gmail.com](https://lkml.kernel.org/r/CAFcO6XOcf1Jj2SeGt%3DjJV59wmhESeSKpfR0omdFRq%2BJ9nD1vfQ%40mail.gmail.com)
> Reported-by: butt3rflyh4ck <butterflyhuangxx@gmail.com>
> Reported-by: Hao Sun <sunhao.th@gmail.com>
> Reported-by: Jiacheng Xu <stitch@zju.edu.cn>
> Signed-off-by: Dongliang Mu <mudongliangabcd@gmail.com>
> Cc: Al Viro <viro@zeniv.linux.org.uk>
> Cc: stable@vger.kernel.org
> ---

Looks good to me,
Reviewed-by: Christian Brauner (Microsoft) <brauner@kernel.org>

[^](#mce7454190265c6ce89575661e778286bed202e35) [permalink](../../20220816104642.qmjegdtthyzy5xbv%40wittgenstein/) [raw](../../20220816104642.qmjegdtthyzy5xbv%40wittgenstein/raw) [reply](../../20220816104642.qmjegdtthyzy5xbv%40wittgenstein/#R)	[[flat](../../20220816104642.qmjegdtthyzy5xbv%40wittgenstein/T/#u)|[nested](../../20220816104642.qmjegdtthyzy5xbv%40wittgenstein/t/#u)] [3+ messages in thread](#rce7454190265c6ce89575661e778286bed202e35)
```

---

```
[*](#ea4f9cdbe52039cd940b65d4d7501d6f8d39c7b57) Re: [PATCH v2] fs: fix UAF/GPF bug in nilfs_mdt_destroy
  2022-08-16  4:08 [[PATCH v2] fs: fix UAF/GPF bug in nilfs_mdt_destroy](#me8111bf2a3f8007cca793b54199a4dd8322aabd0) Dongliang Mu
  2022-08-16 10:46 ` [Christian Brauner](#mce7454190265c6ce89575661e778286bed202e35)
@ 2022-08-25 19:45 ` Eric Sandeen
  [1 sibling, 0 replies; 3+ messages in thread](#ra4f9cdbe52039cd940b65d4d7501d6f8d39c7b57)
From: Eric Sandeen @ 2022-08-25 19:45 UTC ([permalink](../../4ccd8b01-24ae-87de-3cfa-bf99a8bb6b3b%40sandeen.net/) / [raw](../../4ccd8b01-24ae-87de-3cfa-bf99a8bb6b3b%40sandeen.net/raw))
  To: Dongliang Mu, Alexander Viro
  Cc: Dongliang Mu, butt3rflyh4ck, Hao Sun, Jiacheng Xu, [stable](../../../stable/?t=20220825194533),
	[linux-fsdevel](../../../linux-fsdevel/?t=20220825194533), [linux-kernel](../../../lkml/?t=20220825194533)

On 8/15/22 11:08 PM, Dongliang Mu wrote:
> From: Dongliang Mu <mudongliangabcd@gmail.com>
>
> In alloc_inode, inode_init_always() could return -ENOMEM if
> security_inode_alloc() fails, which causes inode->i_private
> uninitialized. Then nilfs_is_metadata_file_inode() returns
> true and nilfs_free_inode() wrongly calls nilfs_mdt_destroy(),
> which frees the uninitialized inode->i_private
> and leads to crashes(e.g., UAF/GPF).
>
> Fix this by moving security_inode_alloc just prior to
> this_cpu_inc(nr_inodes)
>
> Link:¬†[https://lkml.kernel.org/r/CAFcO6XOcf1Jj2SeGt=jJV59wmhESeSKpfR0omdFRq+J9nD1vfQ@mail.gmail.com](https://lkml.kernel.org/r/CAFcO6XOcf1Jj2SeGt%3DjJV59wmhESeSKpfR0omdFRq%2BJ9nD1vfQ%40mail.gmail.com)
> Reported-by: butt3rflyh4ck <butterflyhuangxx@gmail.com>
> Reported-by: Hao Sun <sunhao.th@gmail.com>
> Reported-by: Jiacheng Xu <stitch@zju.edu.cn>
> Signed-off-by: Dongliang Mu <mudongliangabcd@gmail.com>
> Cc: Al Viro <viro@zeniv.linux.org.uk>
> Cc: stable@vger.kernel.org
> ---
> v1->v2: move security_inode_alloc at the very end according to Al Viro
> 	other than initializing i_private before security_inode_alloc.
>  fs/inode.c | 5 +++--
>  1 file changed, 3 insertions(+), 2 deletions(-)
>
> diff --git a/fs/inode.c b/fs/inode.c
> index 6462276dfdf0..49d1eb91728c 100644
> --- a/fs/inode.c
> +++ b/fs/inode.c
> @@ -192,8 +192,6 @@ int inode_init_always(struct super_block *sb, struct inode *inode)
>  	inode->i_wb_frn_history = 0;
>  #endif
>
> -	if (security_inode_alloc(inode))
> -		goto out;
>  	spin_lock_init(&inode->i_lock);
>  	lockdep_set_class(&inode->i_lock, &sb->s_type->i_lock_key);
>
> @@ -228,6 +226,9 @@ int inode_init_always(struct super_block *sb, struct inode *inode)
>  	inode->i_fsnotify_mask = 0;
>  #endif
>  	inode->i_flctx = NULL;
> +
> +	if (security_inode_alloc(inode))
> +		goto out;

Seems like the out: label could be removed, and simply return -ENOMEM directly here,
but that's just a nitpick.

-Eric

>  	this_cpu_inc(nr_inodes);
>
>  	return 0;

[^](#ma4f9cdbe52039cd940b65d4d7501d6f8d39c7b57) [permalink](../../4ccd8b01-24ae-87de-3cfa-bf99a8bb6b3b%40sandeen.net/) [raw](../../4ccd8b01-24ae-87de-3cfa-bf99a8bb6b3b%40sandeen.net/raw) [reply](../../4ccd8b01-24ae-87de-3cfa-bf99a8bb6b3b%40sandeen.net/#R)	[[flat](../../4ccd8b01-24ae-87de-3cfa-bf99a8bb6b3b%40sandeen.net/T/#u)|[nested](../../4ccd8b01-24ae-87de-3cfa-bf99a8bb6b3b%40sandeen.net/t/#u)] [3+ messages in thread](#ra4f9cdbe52039cd940b65d4d7501d6f8d39c7b57)
```

---

```
end of thread, other threads:[[~2022-08-25 19:45 UTC](../../?t=20220825194533) | [newest](../../)]

Thread overview: 3+ messages (download: [mbox.gz](../t.mbox.gz) follow: [Atom feed](../t.atom)
-- links below jump to the message on this page --
2022-08-16  4:08 [[PATCH v2] fs: fix UAF/GPF bug in nilfs_mdt_destroy](#me8111bf2a3f8007cca793b54199a4dd8322aabd0) Dongliang Mu
2022-08-16 10:46 ` [Christian Brauner](#mce7454190265c6ce89575661e778286bed202e35)
2022-08-25 19:45 ` [Eric Sandeen](#ma4f9cdbe52039cd940b65d4d7501d6f8d39c7b57)

```

---

```
This is a public inbox, see [mirroring instructions](../../_/text/mirror/)
for how to clone and mirror all data and code used for this inbox;
as well as URLs for NNTP newsgroup(s).
```

