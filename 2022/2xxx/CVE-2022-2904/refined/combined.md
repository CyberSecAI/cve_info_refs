=== Content from gitlab.com_b022002f_20250114_232741.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-2904.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-2904.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-2904.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-2904.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Oct 28, 2022

  [0dbda426](/gitlab-org/cves/-/commit/0dbda4267616778162f83679a119dfb16b249301)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/0dbda4267616778162f83679a119dfb16b249301)
  繚
  0dbda426

  [ GitLab Bot ](/gitlab-bot) authored Oct 28, 2022

  0dbda426

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/0dbda4267616778162f83679a119dfb16b249301)
  [ GitLab Bot ](/gitlab-bot) authored Oct 28, 2022

Loading



=== Content from gitlab.com_da07b4bf_20250114_232743.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Content injection via `Status checks` widget in Merge requests

**[HackerOne report #1628009](https://hackerone.com/reports/1628009)** by `yvvdwf` on 2022-07-06, assigned to `H1 Triage`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#steps-to-reproduce)

## Triager's Note

* In [this update](https://gitlab.com/gitlab-org/gitlab/-/issues/367408#note_1021167792 "Content injection via `Status checks` widget in Merge requests"), the reporter indicates that he was able to accomplish the same exploitation against Browser performance, Load performance, Metrics reports, etc. Be sure to review this part of the report as well.
* Additionally, there appears to be an inconsistency in successfully exploiting this vulnerability across the environments. For example, this was able to be confirmed in a current version of self-hosted EE and on `.com`, but not on staging. If there is a non-context-specific explanation for this behavior, please ping @galfaro2 so we can pass on this note to the H1 triage team.

## Report

Content injection via `Status checks` widget in Merge requests

[External Status Checks](https://docs.gitlab.com/ee/user/project/merge_requests/status_checks.html) is a feature available only in Gitlab Utimate. Consequently the attacker need to hold an Gitlab utimate account to perform this attack (this can be achieved via free trials).

`Service name` in `Status check` allows attackers to inject any HTML content that is although sanitized latter by `v-safe-html` directive. There exists `data-disable-with` attribute that is not sanitized and allows attackers to inject *any* HTML content. Consequently attackers may get full XSS in the Gitlab self-managed instances that are not protected by a restricted CSP as [I reported](https://hackerone.com/reports/1579645)

Furthermore, the `Status check` is in merge requests, thus attackers may send arbitrary POST requests on behalf of victims. This leads to the possibility of admin user escalation or account takeover (when the account was created via a third party provider.

The following steps shows a demo of account takeover attack on Gitlab.com

## Step to reproduce

* These steps will be done on Gitlab.com. They require two things:

  + access to an utimate subscription (this can be achieved on Gitlab.com via a free trial)
  + a third party account that is not registered on Gitlab.com (such as, a Google, Github, Twitter, Bitbucket, or Saleforce user)
* On an existing project or create a new project with `Initialize repository with a README` is checked
* Goto `Settings/General`, then `Merge request` section, then click on `Add status check` button. Then fill the form as the following, then click `Add status check`:

  + Service name: `<a class=js-issuable-todo data-create-path=/-/profile/password?_method=put&user%5Bnew_password%5D=12345678&user%5Bpassword_confirmation%5D=12345678>Service check`
  + API to check: `http://gitlab.com` (or can be any url as you want)

[![status-check-setting.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/e802ff6003d3e9aa2bae3dce187ca27dac8a2911/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65666162316430322d323537332d343738382d396230632d3037306535396661343739652f7374617475732d636865636b2d73657474696e672e706e67)

* Now go back to the repository file list, then do some modification in `README.md` file as you want, then commit the modification in a new branch, such as `dev` with `Start a new merge request with these changes`  is checked (please see the image)

[![edit-file.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/e2093bf60a7e83ff187a906737bcff3a246c05a4/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39623536383261362d373537662d346239622d386432382d3238313464653964383331652f656469742d66696c652e706e67)

* After clicking on `Commit changes`button, You will be redirected in a `New merge request` page. Click on `Create merge request` button.
* You can expand `Status checks` tab, then click on `Service check: http://gitlab.com` link, you will see a `POST` request is sent to gitlab.com. This `POST` request will modify password of victim if the victim account is created via third party provider.

[![trigger-post-request.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/ae6c5f75c2358cc1ba9ae0b66d4d2c4dc74b07d7/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f62653762653439642d666336612d343564342d396135382d6237663730373239343037382f747269676765722d706f73742d726571756573742e706e67)

* Now logout Gitlab.com, then login with a third party provider to generate a new account on Gitlab.com
* (If the attack project is not public, then we need to invite the victim to be a member of the project so that the victim can access to the merge request page)
* As the victim, visit the merge request page and click on the `Service check: http://gitlab.com` link as in Step
* Refresh the page, you should now be logged out from Gitlab.com as your password was changed

### Impact

HTML injection allows attackers to (1) get full XSS in the Gitlab self-managed instances that are not protected by a restricted CSP, or (2) to send arbitrary POST request on behalf of victims that can lead to permission escalation or even account takeover, etc.

#### Impact

HTML injection allows attackers to (1) get full XSS in the Gitlab self-managed instances that are not protected by a restricted CSP, or (2) to send arbitrary POST request on behalf of victims that can lead to permission escalation or even account takeover, etc.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!
%% REDACTED %%

Edited Oct 31, 2022 by [Greg Alfaro](/truegreg)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


