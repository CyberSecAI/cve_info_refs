The content is related to CVE-2022-2347.

**Root cause of vulnerability:**
The U-Boot DFU implementation does not validate the length field in USB DFU download setup packets and does not verify that the transfer direction matches the specified command.

**Weaknesses/vulnerabilities present:**
- Unchecked length field in USB DFU download setup packets. The `wLength` field from the setup packet is used directly to set the length of the USB transfer without any bounds checking.
- Lack of transfer direction verification. The direction bit (`USB_DIR_IN`) of the setup packet is not validated against the DFU command type (download), allowing a device to host transfer to occur when a host to device transfer was expected.

**Impact of exploitation:**
- Writing beyond the heap-allocated request buffer (`req->buf`), leading to potential memory corruption.
- Reading data from `req->buf` (and possibly beyond it), allowing a malicious host to potentially exfiltrate sensitive data from the device.
- Potential for malicious host to gain code execution on the device by corrupting memory.

**Attack vectors:**
- A physical attacker with a malicious USB host can connect to the device running U-Boot in DFU mode.
- The attacker can craft a malicious USB DFU download setup packet with an oversized `wLength` or with the `USB_DIR_IN` bit set.

**Required attacker capabilities/position:**
- Physical access to the device running U-Boot.
- Ability to act as a USB host and craft malicious USB DFU packets.
- The target device must be in DFU mode.