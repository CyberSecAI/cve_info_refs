=== Content from git.kernel.org_25011db4_20250114_191854.html ===


| [cgit logo](/) | [index](/) : [kernel/git/deller/linux-fbdev.git](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/) | fbdev-5.18-1 fbdev-5.18-2 fbdev-5.19-1 fbdev-5.19-2 fbdev-5.19-3 fbdev-5.20-1 fbdev-6.0-2 fbdev-6.1-1 fbdev-6.1-2 fbdev-6.10-1 fbdev-6.11-1 fbdev-6.12-1 fbdev-6.12-2 fbdev-6.12-3 fbdev-6.12-4 fbdev-6.13-1 fbdev-6.2-1 fbdev-6.2-2 fbdev-6.2-3 fbdev-6.3-1 fbdev-6.4-1 fbdev-6.4-2 fbdev-6.4-3 fbdev-6.4-4 fbdev-6.5-1 fbdev-6.5-2 fbdev-6.6-1 fbdev-6.6-2 fbdev-6.7-1 fbdev-6.8-1 fbdev-6.8-2 fbdev-6.9-1 fbdev-tbd fbdev-wii for-next for-next-next master |
| --- | --- | --- |
| Linux Framebuffer maintenance tree | Helge Deller |

| [about](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/about/?h=for-next)[summary](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/?h=for-next)[refs](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/refs/?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8)[log](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/log/?h=for-next)[tree](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/tree/?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8)[commit](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/commit/?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8)[diff](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/diff/?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8)[stats](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/stats/?h=for-next) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Helge Deller <deller@gmx.de> | 2022-02-27 08:43:56 +0100 |
| --- | --- | --- |
| committer | Helge Deller <deller@gmx.de> | 2022-02-27 08:43:56 +0100 |
| commit | [bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/commit/?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8) ([patch](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/patch/?id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8)) | |
| tree | [21186273f7b32374c7605edf9c85afbe3c9403bb](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/tree/?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8) | |
| parent | [997403e7782a3b9aa6e2b28c6b78793659483af3](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/commit/?h=for-next&id=997403e7782a3b9aa6e2b28c6b78793659483af3) ([diff](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/diff/?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8&id2=997403e7782a3b9aa6e2b28c6b78793659483af3)) | |
| download | [linux-fbdev-bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8.tar.gz](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/snapshot/linux-fbdev-bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8.tar.gz) | |

video: fbdev: sm712fb: Fix crash in smtcfb\_read()Zheyu Ma reported this crash in the sm712fb driver when reading
three bytes from the framebuffer:
BUG: unable to handle page fault for address: ffffc90001ffffff
RIP: 0010:smtcfb\_read+0x230/0x3e0
Call Trace:
vfs\_read+0x198/0xa00
? do\_sys\_openat2+0x27d/0x350
? \_\_fget\_light+0x54/0x340
ksys\_read+0xce/0x190
do\_syscall\_64+0x43/0x90
Fix it by removing the open-coded endianess fixup-code and
by moving the pointer post decrement out the fb\_readl() function.
Reported-by: Zheyu Ma <zheyuma97@gmail.com>
Signed-off-by: Helge Deller <deller@gmx.de>
Tested-by: Zheyu Ma <zheyuma97@gmail.com>
Cc: stable@vger.kernel.org
[Diffstat](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/diff/?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8)

| -rw-r--r-- | [drivers/video/fbdev/sm712fb.c](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/diff/drivers/video/fbdev/sm712fb.c?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8) | 25 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 18 deletions

| diff --git a/drivers/video/fbdev/sm712fb.c b/drivers/video/fbdev/sm712fb.cindex 0dbc6bf8268acf..b60a2730f0a8a8 100644--- a/[drivers/video/fbdev/sm712fb.c](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/tree/drivers/video/fbdev/sm712fb.c?h=for-next&id=997403e7782a3b9aa6e2b28c6b78793659483af3)+++ b/[drivers/video/fbdev/sm712fb.c](/pub/scm/linux/kernel/git/deller/linux-fbdev.git/tree/drivers/video/fbdev/sm712fb.c?h=for-next&id=bd771cf5c4254511cc4abb88f3dab3bd58bdf8e8)@@ -1047,7 +1047,7 @@ static ssize\_t smtcfb\_read(struct fb\_info \*info, char \_\_user \*buf, if (count + p > total\_size) count = total\_size - p; - buffer = kmalloc((count > PAGE\_SIZE) ? PAGE\_SIZE : count, GFP\_KERNEL);+ buffer = kmalloc(PAGE\_SIZE, GFP\_KERNEL); if (!buffer) return -ENOMEM; @@ -1059,24 +1059,13 @@ static ssize\_t smtcfb\_read(struct fb\_info \*info, char \_\_user \*buf, while (count) { c = (count > PAGE\_SIZE) ? PAGE\_SIZE : count; dst = buffer;- for (i = c >> 2; i--;) {- \*dst = fb\_readl(src++);- \*dst = big\_swap(\*dst);- dst++;- }- if (c & 3) {- u8 \*dst8 = (u8 \*)dst;- u8 \_\_iomem \*src8 = (u8 \_\_iomem \*)src;+ for (i = (c + 3) >> 2; i--;) {+ u32 val; - for (i = c & 3; i--;) {- if (i & 1) {- \*dst8++ = fb\_readb(++src8);- } else {- \*dst8++ = fb\_readb(--src8);- src8 += 2;- }- }- src = (u32 \_\_iomem \*)src8;+ val = fb\_readl(src);+ \*dst = big\_swap(val);+ src++;+ dst++; }  if (copy\_to\_user(buf, buffer, c)) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 19:17:30 +0000


