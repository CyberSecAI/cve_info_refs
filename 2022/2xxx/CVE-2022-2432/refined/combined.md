=== Content from plugins.trac.wordpress.org_42598c21_20250114_200229.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2755658%2540ecwid-shopping-cart%252Ftrunk%26old%3D2754114%2540ecwid-shopping-cart%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2754114/ecwid-shopping-cart/trunk?old=2755658&old_path=%2Fecwid-shopping-cart%2Ftrunk)

---

# Changes in [ecwid-shopping-cart/trunk](/browser/ecwid-shopping-cart/trunk?rev=2755658 "Show entry in browser") [[2754114:2755658]](/log/ecwid-shopping-cart/trunk?rev=2755658&stop_rev=2754114 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[ecwid-shopping-cart/trunk](/browser/ecwid-shopping-cart/trunk?rev=2755658)
Files:

5 edited

* [ecwid-shopping-cart.php](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2755634 "Show entry in browser")
  (modified)
  ([6 diffs](#file0 "Show differences"))
* [includes/class-ecwid-help-page.php](/browser/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?rev=2755634 "Show entry in browser")
  (modified)
  ([4 diffs](#file1 "Show differences"))
* [readme.txt](/browser/ecwid-shopping-cart/trunk/readme.txt?rev=2755658 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [templates/admin-params.php](/browser/ecwid-shopping-cart/trunk/templates/admin-params.php?rev=2755634 "Show entry in browser")
  (modified)
  ([3 diffs](#file3 "Show differences"))
* [templates/help.php](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634 "Show entry in browser")
  (modified)
  ([9 diffs](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [ecwid-shopping-cart/trunk/ecwid-shopping-cart.php](/changeset/2755634/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?old=2754113&old_path=ecwid-shopping-cart%2Ftrunk%2Fecwid-shopping-cart.php "Show the [2754114:2755658] differences restricted to ecwid-shopping-cart/trunk/ecwid-shopping-cart.php")

  | [r2754114](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2754113#L6 "Show revision 2754114 of this file in browser") | [r2755658](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2755634#L6 "Show revision 2755658 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | Text Domain: ecwid-shopping-cart |
  | 7 | 7 | Author: Ecwid Ecommerce |
  | 8 |  | Version: 6.10.2~~3~~ |
  |  | 8 | Version: 6.10.24 |
  | 9 | 9 | Author URI: https://ecwid.to/ecwid-site |
  | 10 | 10 | License: GPLv2 or later |
  | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2754113#L1723) | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2755634#L1723) |  |
  | 1723 | 1723 | function ecwid\_plugin\_activation\_redirect( $plugin ) { |
  | 1724 | 1724 |  |
  | 1725 |  | $is\_nonce\_set = isset($\_POST['\_wpnonce']) && wp\_verify\_nonce( ~~$\_POST['\_wpnonce'], 'bulk-plugins' );~~ |
  |  | 1725 | $is\_nonce\_set = isset($\_POST['\_wpnonce']) && wp\_verify\_nonce( wp\_unslash( $\_POST['\_wpnonce'] ), 'bulk-plugins' ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 1726 | 1726 |  |
  | 1727 | 1727 | $is\_bulk\_activation = $is\_nonce\_set |
  | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2754113#L1967) | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2755634#L1967) |  |
  | 1967 | 1967 | } |
  | 1968 | 1968 |  |
  | 1969 |  | if ( isset($\_POST['wp-nonce']) && !wp\_verify\_nonce(sanitize\_text\_field(wp\_unslash($\_POST['wp-nonce'])), ecwid\_get\_update\_params\_action()) ) { |
  |  | 1969 | if ( ! isset( $\_POST['\_wpnonce'] ) ) { |
  |  | 1970 | wp\_die( \_\_( 'Sorry, you are not allowed to access this page.' ) ); |
  |  | 1971 | } |
  |  | 1972 |  |
  |  | 1973 | if ( ! wp\_verify\_nonce( wp\_unslash( $\_POST['\_wpnonce'] ), ecwid\_get\_update\_params\_action() ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 1970 | 1974 | wp\_die( \_\_( 'Sorry, you are not allowed to access this page.' ) ); |
  | 1971 | 1975 | } |
  | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2754113#L2104) | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2755634#L2108) |  |
  | 2104 | 2108 | function ecwid\_settings\_api\_init() { |
  | 2105 | 2109 |  |
  | 2106 |  | if ( isset( $\_POST['settings\_section'] ) && wp\_verify\_nonce( ~~$\_POST['\_wpnonce'], 'ecwid\_options\_page-options' ) ) {~~ |
  |  | 2110 | if ( isset( $\_POST['settings\_section'] ) && wp\_verify\_nonce( wp\_unslash( $\_POST['\_wpnonce'] ), 'ecwid\_options\_page-options' ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 2107 | 2111 |  |
  | 2108 | 2112 | switch ( $\_POST['settings\_section'] ) { |
  | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2754113#L2132) | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2755634#L2136) |  |
  | 2132 | 2136 | } |
  | 2133 | 2137 |  |
  | 2134 |  | if ( isset( $\_POST['ecwid\_store\_id'] ) && wp\_verify\_nonce( ~~$\_POST['\_wpnonce'], 'ecwid\_options\_page-options' )  ) {~~ |
  |  | 2138 | if ( isset( $\_POST['ecwid\_store\_id'] ) && wp\_verify\_nonce( wp\_unslash( $\_POST['\_wpnonce'] ), 'ecwid\_options\_page-options' )  ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 2135 | 2139 |  |
  | 2136 | 2140 | $new\_store\_id = sanitize\_text\_field(wp\_unslash($\_POST['ecwid\_store\_id'])); |
  | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2754113#L2424) | […](/browser/ecwid-shopping-cart/trunk/ecwid-shopping-cart.php?rev=2755634#L2428) |  |
  | 2424 | 2428 | } |
  | 2425 | 2429 |  |
  | 2426 |  | if ( isset($\_GET['force\_store\_id']) && wp\_verify\_nonce(~~$\_GET['\_wpnonce'], 'ec\_admin') ) {~~ |
  |  | 2430 | if ( isset($\_GET['force\_store\_id']) && wp\_verify\_nonce( wp\_unslash( $\_GET['\_wpnonce'] ), 'ec\_admin' ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 2427 | 2431 |  |
  | 2428 | 2432 | $force\_store\_id = sanitize\_text\_field(wp\_unslash($\_GET['force\_store\_id'])); |
* ## [ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php](/changeset/2755634/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?old=2640505&old_path=ecwid-shopping-cart%2Ftrunk%2Fincludes%2Fclass-ecwid-help-page.php "Show the [2754114:2755658] differences restricted to ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php")

  | [r2754114](/browser/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?rev=2640505#L4 "Show revision 2754114 of this file in browser") | [r2755658](/browser/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?rev=2755634#L4 "Show revision 2755658 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | const CONTACT\_US\_ACTION\_NAME = 'ecwid\_contact\_us'; |
  | 5 | 5 | public function \_\_construct() { |
  | 6 |  | add\_action(~~'wp\_ajax\_' . self::CONTACT\_US\_ACTION\_NAME, array( $this, 'submit\_contact\_us'~~) ); |
  |  | 6 | add\_action( 'wp\_ajax\_' . self::CONTACT\_US\_ACTION\_NAME, array( $this, 'submit\_contact\_us' ) ); |
  | 7 | 7 | } |
  | 8 | 8 |  |
  | 9 | 9 | public function submit\_contact\_us() { |
  | 10 | 10 |  |
  | 11 |  | if ( !current\_user\_can('administrator') ) { |
  | 12 |  | header('403 Access Denied'); |
  | 13 |  |  |
  |  | 11 | if ( ! current\_user\_can( 'administrator' ) ) { |
  |  | 12 | header( '403 Access Denied' ); |
  | 14 | 13 | die(); |
  | 15 | 14 | } |
  | 16 | 15 |  |
  | 17 |  | if ( !isset($\_POST['wp-nonce']) && !wp\_verify\_nonce(sanitize\_text\_field(wp\_unslash($\_POST['wp-nonce'])), self::CONTACT\_US\_ACTION\_NAME) ) { |
  | 18 |  | header('403 Access Denied'); |
  |  | 16 | if ( ! isset( $\_POST['\_wpnonce'] ) ) { |
  |  | 17 | header( '403 Access Denied' ); |
  |  | 18 | die(); |
  |  | 19 | } |
  | 19 | 20 |  |
  |  | 21 | if ( ! wp\_verify\_nonce( wp\_unslash( $\_POST['\_wpnonce'] ), self::CONTACT\_US\_ACTION\_NAME ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  |  | 22 | header( '403 Access Denied' ); |
  | 20 | 23 | die(); |
  | 21 | 24 | } |
  | […](/browser/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?rev=2640505#L24) | […](/browser/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?rev=2755634#L27) |  |
  | 24 | 27 |  |
  | 25 | 28 | $body\_lines = array(); |
  | 26 |  | if ( !ecwid\_is\_demo\_store() ) { |
  |  | 29 | if ( ! ecwid\_is\_demo\_store() ) { |
  | 27 | 30 | $body\_lines[] = 'Store ID: ' . get\_ecwid\_store\_id(); |
  | 28 | 31 | } |
  | 29 | 32 | $body\_lines[] = 'Store URL: ' . Ecwid\_Store\_Page::get\_store\_url(); |
  | 30 | 33 | $body\_lines[] = 'Wp theme: ' . ecwid\_get\_theme\_name(); |
  | 31 |  | $body\_lines[] = 'Ecwid plugin version: ' . get\_option(~~'ecwid\_plugin\_version'~~); |
  | 32 |  | $body\_lines[] = 'Word~~press version: '  . get\_bloginfo('version'~~); |
  |  | 34 | $body\_lines[] = 'Ecwid plugin version: ' . get\_option( 'ecwid\_plugin\_version' ); |
  |  | 35 | $body\_lines[] = 'WordPress version: ' . get\_bloginfo( 'version' ); |
  | 33 | 36 | $body\_lines[] = ''; |
  | 34 | 37 | $body\_lines[] = 'Message:'; |
  | 35 | 38 | $body\_lines[] = ''; |
  | 36 |  | $body\_lines[] = (~~isset($\_POST['body'])) ? sanitize\_textarea\_field(wp\_unslash( $\_POST['body'] )~~) : ''; |
  |  | 39 | $body\_lines[] = ( isset( $\_POST['body'] ) ) ? sanitize\_textarea\_field( wp\_unslash( $\_POST['body'] ) ) : ''; |
  | 37 | 40 |  |
  | 38 | 41 | global $current\_user; |
  | […](/browser/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?rev=2640505#L41) | […](/browser/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?rev=2755634#L44) |  |
  | 41 | 44 | $result = wp\_mail( |
  | 42 | 45 | $to, |
  | 43 |  | (~~isset($\_POST['subject'])) ? sanitize\_text\_field(wp\_unslash($\_POST['subject'])~~) : '', |
  | 44 |  | implode(~~PHP\_EOL, $body\_lines~~), |
  |  | 46 | ( isset( $\_POST['subject'] ) ) ? sanitize\_text\_field( wp\_unslash( $\_POST['subject'] ) ) : '', |
  |  | 47 | implode( PHP\_EOL, $body\_lines ), |
  | 45 | 48 | 'Reply-To:' . $reply\_to |
  | 46 | 49 | ); |
  | 47 | 50 |  |
  | 48 |  | if (~~$result~~) { |
  |  | 51 | if ( $result ) { |
  | 49 | 52 | $nonce = wp\_create\_nonce( self::CONTACT\_US\_ACTION\_NAME ); |
  | 50 | 53 |  |
  | 51 | 54 | echo json\_encode( |
  | 52 | 55 | array( |
  | 53 |  | 'nonce' => $nonce |
  |  | 56 | 'nonce' => $nonce, |
  | 54 | 57 | ) |
  | 55 | 58 | ); |
  | 56 | 59 | wp\_die(); |
  | 57 | 60 | } else { |
  | 58 |  | header(~~'500 Send mail failed'~~); |
  |  | 61 | header( '500 Send mail failed' ); |
  | 59 | 62 | die(); |
  | 60 | 63 | } |
  | […](/browser/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?rev=2640505#L72) | […](/browser/ecwid-shopping-cart/trunk/includes/class-ecwid-help-page.php?rev=2755634#L75) |  |
  | 72 | 75 | foreach ( $faqs as $idx => $faq ) { |
  | 73 | 76 | if ( isset( $faq['priority'] ) && $faq['priority'] == 'guaranteed\_3' ) { |
  | 74 |  | $guaranteed\_3 = array(); |
  |  | 77 | $guaranteed\_3   = array(); |
  | 75 | 78 | $guaranteed\_3[] = $faq; |
  | 76 |  | unset( $faqs[~~$idx~~] ); |
  |  | 79 | unset( $faqs[ $idx ] ); |
  | 77 | 80 | break; |
  | 78 | 81 | } |
  | 79 | 82 | } |
  | 80 |  |  |
  |  | 83 |  |
  | 81 | 84 | $result = array(); |
  | 82 | 85 | foreach ( $faqs as $idx => $faq ) { |
  | 83 |  | if ( isset(~~$faq['priority']~~) && $faq['priority'] == 'newbie\_with\_woo' ) { |
  |  | 86 | if ( isset( $faq['priority'] ) && $faq['priority'] == 'newbie\_with\_woo' ) { |
  | 84 | 87 | $installed\_within\_two\_weeks = time() - get\_option( 'ecwid\_installation\_date' ) < 60 \* 60 \* 24 \* 14; |
  | 85 | 88 |  |
  | 86 | 89 | if ( ecwid\_get\_woocommerce\_status() && $installed\_within\_two\_weeks ) { |
  | 87 | 90 | $result[] = $faq; |
  | 88 |  | unset(~~$faqs[$idx]~~); |
  |  | 91 | unset( $faqs[ $idx ] ); |
  | 89 | 92 | } |
  | 90 | 93 | } |
  | 91 | 94 | } |
  | 92 |  | $faqs = array\_values(~~$faqs~~); |
  |  | 95 | $faqs = array\_values( $faqs ); |
  | 93 | 96 |  |
  | 94 |  | while ( count(~~$result~~) < $max + ( $guaranteed\_3 ? 1 : 0 ) ) { |
  | 95 |  | $rand ~~= rand(0, count($faqs) - 1~~); |
  | 96 |  | $result[] = $faqs[~~$rand~~]; |
  |  | 97 | while ( count( $result ) < $max + ( $guaranteed\_3 ? 1 : 0 ) ) { |
  |  | 98 | $rand     = rand( 0, count( $faqs ) - 1 ); |
  |  | 99 | $result[] = $faqs[ $rand ]; |
  | 97 | 100 |  |
  | 98 |  | unset(~~$faqs[$rand]~~); |
  | 99 |  | $faqs = array\_values(~~$faqs~~); |
  |  | 101 | unset( $faqs[ $rand ] ); |
  |  | 102 | $faqs = array\_values( $faqs ); |
  | 100 | 103 | } |
  | 101 | 104 |  |
  | 102 | 105 | array\_splice( $result, 2, 0, $guaranteed\_3 ); |
  | 103 |  |  |
  |  | 106 |  |
  | 104 | 107 | $faqs = $result; |
  | 105 | 108 |  |
  | 106 | 109 | $result = array(); |
  | 107 |  | foreach (~~$faqs as $faq~~) { |
  | 108 |  | $faq['body'] = preg\_replace(~~'!<img alt="" src="([^"]\*)"!', '<img alt="" src="' . ECWID\_PLUGIN\_URL . '/images/help/' . '$1"', $faq['body']~~); |
  |  | 110 | foreach ( $faqs as $faq ) { |
  |  | 111 | $faq['body'] = preg\_replace( '!<img alt="" src="([^"]\*)"!', '<img alt="" src="' . ECWID\_PLUGIN\_URL . '/images/help/' . '$1"', $faq['body'] ); |
  | 109 | 112 |  |
  | 110 | 113 | $result[] = (object) $faq; |
* ## [ecwid-shopping-cart/trunk/readme.txt](/changeset/2755658/ecwid-shopping-cart/trunk/readme.txt?old=2754114&old_path=ecwid-shopping-cart%2Ftrunk%2Freadme.txt "Show the [2754114:2755658] differences restricted to ecwid-shopping-cart/trunk/readme.txt")

  | [r2754114](/browser/ecwid-shopping-cart/trunk/readme.txt?rev=2754114#L1 "Show revision 2754114 of this file in browser") | [r2755658](/browser/ecwid-shopping-cart/trunk/readme.txt?rev=2755658#L1 "Show revision 2755658 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | === Ecwid Ecommerce Shopping Cart === |
  |  | 1 | ﻿=== Ecwid Ecommerce Shopping Cart === |
  | 2 | 2 | Contributors: Ecwid |
  | 3 | 3 | Tags: ecommerce, e-commerce, storefront, shopping cart, online store |
  | 4 | 4 | Requires at least: 4.4 |
  | 5 | 5 | Tested up to: 6.0 |
  | 6 |  | Stable tag: 6.10.2~~3~~ |
  |  | 6 | Stable tag: 6.10.24 |
  | 7 | 7 |  |
  | 8 | 8 | Powerful, easy to use ecommerce shopping cart for WordPress. Sell on Facebook and Instagram. iPhone & Android apps. Superb support. Free plan available. |
  | […](/browser/ecwid-shopping-cart/trunk/readme.txt?rev=2754114#L152) | […](/browser/ecwid-shopping-cart/trunk/readme.txt?rev=2755658#L152) |  |
  | 152 | 152 |  |
  | 153 | 153 | == Changelog == |
  |  | 154 |  |
  |  | 155 | = 6.10.24 - Jul 13, 2022 = |
  |  | 156 | - Improved security of handling plugin settings with the WordPress plugin marketplace requirements. Ecwid ecommerce shopping cart plugin update is recommended. |
  | 154 | 157 |  |
  | 155 | 158 | = 6.10.23 - Jul 10, 2022 = |
* ## [ecwid-shopping-cart/trunk/templates/admin-params.php](/changeset/2755634/ecwid-shopping-cart/trunk/templates/admin-params.php?old=2613010&old_path=ecwid-shopping-cart%2Ftrunk%2Ftemplates%2Fadmin-params.php "Show the [2754114:2755658] differences restricted to ecwid-shopping-cart/trunk/templates/admin-params.php")

  | [r2754114](/browser/ecwid-shopping-cart/trunk/templates/admin-params.php?rev=2613010#L5 "Show revision 2754114 of this file in browser") | [r2755658](/browser/ecwid-shopping-cart/trunk/templates/admin-params.php?rev=2755634#L5 "Show revision 2755658 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | <br /> |
  | 6 | 6 | <br /> |
  | 7 |  | Having a problem working with the Online store plugin? Visit our <a target="\_blank" href="https://support.ecwid.com">Help center</a> if you haven't yet. |
  |  | 7 | Having a problem working with the Online store plugin? Visit our <a target="\_blank" href="https://support.ecwid.com">Help center</a> if you haven't yet. |
  | 8 | 8 | </div> |
  | 9 | 9 | <br /> |
  | […](/browser/ecwid-shopping-cart/trunk/templates/admin-params.php?rev=2613010#L11) | […](/browser/ecwid-shopping-cart/trunk/templates/admin-params.php?rev=2755634#L11) |  |
  | 11 | 11 | <form method="POST" type="multipart/form-data" action="admin-post.php?action=<?php echo ecwid\_get\_update\_params\_action(); ?>"> |
  | 12 | 12 |  |
  | 13 |  | <input type="hidden" name="nonce" value="<?php echo wp\_create\_nonce( ecwid\_get\_update\_params\_action() ); ?>" /> |
  |  | 13 | <input type="hidden" name="\_wpnonce" value="<?php echo wp\_create\_nonce( ecwid\_get\_update\_params\_action() ); ?>" /> |
  | 14 | 14 |  |
  | 15 | 15 | <style type="text/css"> |
  | […](/browser/ecwid-shopping-cart/trunk/templates/admin-params.php?rev=2613010#L22) | […](/browser/ecwid-shopping-cart/trunk/templates/admin-params.php?rev=2755634#L22) |  |
  | 22 | 22 | <table id="ec-params-table"> |
  | 23 | 23 |  |
  | 24 |  | <?php foreach ( ecwid\_get\_update\_params\_options() as $key => $option ): ?> |
  |  | 24 | <?php foreach ( ecwid\_get\_update\_params\_options() as $key => $option ) : ?> |
  | 25 | 25 | <tr style="padding: 0 0 5px;"> |
  | 26 | 26 | <td><?php echo $key; ?>: </td> |
  | 27 | 27 | <td> |
  | 28 |  | <?php if ( @$option['type'] == 'bool' ): ?> |
  |  | 28 | <?php if ( @$option['type'] == 'bool' ) : ?> |
  | 29 | 29 | <select name="option[<?php echo $key; ?>]"> |
  | 30 |  | <option value=""<?php if (get\_option($key) == ''):?> selected="selected"<?php endif; ?>>off</option> |
  | 31 |  | <option value="Y"<?php if (get\_option($key) ):?> selected="selected"<?php endif; ?>>on</option> |
  |  | 30 | <option value="" |
  |  | 31 | <?php |
  |  | 32 | if ( get\_option( $key ) == '' ) : |
  |  | 33 | ?> |
  |  | 34 | selected="selected"<?php endif; ?>>off</option> |
  |  | 35 | <option value="Y" |
  |  | 36 | <?php |
  |  | 37 | if ( get\_option( $key ) ) : |
  |  | 38 | ?> |
  |  | 39 | selected="selected"<?php endif; ?>>on</option> |
  | 32 | 40 | </select> |
  | 33 |  | <?php elseif ( @$option['type'] == 'string'~~)~~: ?> |
  | 34 |  | <input type="text" name="option[<?php echo $key; ?>]" value="<?php echo esc\_attr(~~get\_option( $key )~~); ?>"> |
  | 35 |  | <?php elseif ( @$option['type'] == 'html'~~)~~: ?> |
  | 36 |  | <textarea name="option[<?php echo $key; ?>]" style="width:500px"><?php echo htmlentities( get\_option( $key ) ); ?></textarea> |
  | 37 |  | ~~<?php elseif ( @$option['values'] )~~: ?> |
  |  | 41 | <?php elseif ( @$option['type'] == 'string' ) : ?> |
  |  | 42 | <input type="text" name="option[<?php echo $key; ?>]" value="<?php echo esc\_attr( get\_option( $key ) ); ?>"> |
  |  | 43 | <?php elseif ( @$option['type'] == 'html' ) : ?> |
  |  | 44 | <textarea name="option[<?php echo $key; ?>]" style="width:500px"><?php echo htmlentities( get\_option( $key ) ); ?></textarea> |
  |  | 45 | <?php elseif ( @$option['values'] ) : ?> |
  | 38 | 46 | <select name="option[<?php echo $key; ?>]"> |
  | 39 |  | <?php foreach ( @$option['values'] as $value ): ?> |
  | 40 |  | <option value="<?php echo $value; ?>"<?php if ( $value == get\_option($key)): ?> selected="selected"<?php endif; ?>><?php echo $value; ?></option> |
  |  | 47 | <?php foreach ( @$option['values'] as $value ) : ?> |
  |  | 48 | <option value="<?php echo $value; ?>" |
  |  | 49 | <?php |
  |  | 50 | if ( $value == get\_option( $key ) ) : |
  |  | 51 | ?> |
  |  | 52 | selected="selected"<?php endif; ?>><?php echo $value; ?></option> |
  | 41 | 53 | <?php endforeach; ?> |
  | 42 | 54 | </select> |
  | 43 | 55 | <?php endif; ?> |
  | 44 | 56 |  |
  | 45 |  | <?php echo esc\_attr( get\_option(~~$key~~) ); ?> |
  |  | 57 | <?php echo esc\_attr( get\_option( $key ) ); ?> |
  | 46 | 58 |  |
  | 47 | 59 | </td> |
* ## [ecwid-shopping-cart/trunk/templates/help.php](/changeset/2755634/ecwid-shopping-cart/trunk/templates/help.php?old=2640505&old_path=ecwid-shopping-cart%2Ftrunk%2Ftemplates%2Fhelp.php "Show the [2754114:2755658] differences restricted to ecwid-shopping-cart/trunk/templates/help.php")

  | [r2754114](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2640505#L13 "Show revision 2754114 of this file in browser") | [r2755658](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634#L13 "Show revision 2755658 of this file in browser") |  |
  | --- | --- | --- |
  | 13 | 13 | <div class="hds-container"> |
  | 14 | 14 | <div class="hds-wrapper"> |
  | 15 |  | <form class="hds-form" method="get" target="\_blank" data-action="<?php \_e( 'https://support.ecwid.com/hc/en-us/search', 'ecwid-shopping-cart'); ?>" onsubmit="help-page searchquerysubmited"> |
  |  | 15 | <form class="hds-form" method="get" target="\_blank" data-action="<?php \_e( 'https://support.ecwid.com/hc/en-us/search', 'ecwid-shopping-cart' ); ?>" onsubmit="help-page searchquerysubmited"> |
  | 16 | 16 | <div class="input-wrapper input-prepend"> |
  | 17 | 17 | <input type="text" class="form-control q" value="" id="q" placeholder="<?php \_e( 'E.g. How to set up shipping', 'ecwid-shopping-cart' ); ?> " autocomplete="off"/> |
  | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2640505#L25) | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634#L25) |  |
  | 25 | 25 | </div> |
  | 26 | 26 | </div> |
  | 27 |  | <div class="block-search block-search-kb-link"> |
  | 28 |  | ~~<?php echo sprintf( \_\_( 'or <a %s>Browse the Help Center', 'ecwid-shopping-cart'~~), 'href="https://support.ecwid.com/"' ); ?> |
  | 29 |  | </div> |
  |  | 27 | <div class="block-search block-search-kb-link"> |
  |  | 28 | <?php echo sprintf( \_\_( 'or <a %s>Browse the Help Center', 'ecwid-shopping-cart' ), 'href="https://support.ecwid.com/"' ); ?> |
  |  | 29 | </div> |
  | 30 | 30 | </div> |
  | 31 | 31 |  |
  | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2640505#L34) | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634#L34) |  |
  | 34 | 34 | <div class="block-faq-wrap"> |
  | 35 | 35 | <ul class="block-faq-list"> |
  | 36 |  | <?php foreach ($faqs as $idx => $faq): if ($idx % 2 == 0): ?> |
  | 37 |  | <li class="index-article<?php if ($idx >= $col\_size) echo ' index-article--hidden' ?>"> |
  |  | 36 | <?php |
  |  | 37 | foreach ( $faqs as $idx => $faq ) : |
  |  | 38 | if ( $idx % 2 == 0 ) : |
  |  | 39 | ?> |
  |  | 40 | <li class="index-article |
  |  | 41 | <?php |
  |  | 42 | if ( $idx >= $col\_size ) { |
  |  | 43 | echo ' index-article--hidden';} |
  |  | 44 | ?> |
  |  | 45 | "> |
  | 38 | 46 | <a class="index-article-title" href="#" onclick="return false;"> |
  | 39 | 47 | <i class="icon-down"></i><?php echo $faq->title; ?> |
  | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2640505#L44) | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634#L52) |  |
  | 44 | 52 | </li> |
  | 45 | 53 |  |
  | 46 |  | <?php endif; endforeach; ?> |
  |  | 54 | <?php |
  |  | 55 | endif; |
  |  | 56 | endforeach; |
  |  | 57 | ?> |
  | 47 | 58 | </ul> |
  | 48 | 59 |  |
  | 49 | 60 | <ul class="block-faq-list"> |
  | 50 |  | <?php foreach ($faqs as $idx => $faq): if ($idx % 2 == 1): ?> |
  | 51 |  | <li class="index-article<?php if ($idx >= $col\_size) echo ' index-article--hidden' ?>"> |
  |  | 61 | <?php |
  |  | 62 | foreach ( $faqs as $idx => $faq ) : |
  |  | 63 | if ( $idx % 2 == 1 ) : |
  |  | 64 | ?> |
  |  | 65 | <li class="index-article |
  |  | 66 | <?php |
  |  | 67 | if ( $idx >= $col\_size ) { |
  |  | 68 | echo ' index-article--hidden';} |
  |  | 69 | ?> |
  |  | 70 | "> |
  | 52 | 71 | <a class="index-article-title" href="#" onclick="return false;"> |
  | 53 | 72 | <i class="icon-down"></i><?php echo $faq->title; ?> |
  | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2640505#L57) | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634#L76) |  |
  | 57 | 76 | </div> |
  | 58 | 77 | </li> |
  | 59 |  | <?php endif; endforeach; ?> |
  |  | 78 | <?php |
  |  | 79 | endif; |
  |  | 80 | endforeach; |
  |  | 81 | ?> |
  | 60 | 82 | </ul> |
  | 61 | 83 |  |
  | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2640505#L182) | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634#L204) |  |
  | 182 | 204 | </div> |
  | 183 | 205 |  |
  | 184 |  | <?php if (~~isset($\_SERVER['REMOTE\_ADDR']) && !in\_array($\_SERVER['REMOTE\_ADDR'], array('127.0.0.1', '::1')))~~: ?> |
  |  | 206 | <?php if ( isset( $\_SERVER['REMOTE\_ADDR'] ) && ! in\_array( $\_SERVER['REMOTE\_ADDR'], array( '127.0.0.1', '::1' ) ) ) : ?> |
  | 185 | 207 | <div class="block-contact"> |
  | 186 | 208 | <h2><?php \_e( 'Send a message to our support team', 'ecwid-shopping-cart' ); ?> </h2> |
  | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2640505#L189) | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634#L211) |  |
  | 189 | 211 | <form action="admin-post.php" enctype="multipart/form-data" class="new\_email" id="new\_email" method="post" novalidate="novalidate"> |
  | 190 | 212 | <input type="hidden" name="action" value="ecwid\_contact\_us" /> |
  | 191 |  | <input type="hidden" name="wp-nonce" id="wp-nonce" value="<?php echo wp\_create\_nonce( Ecwid\_Help\_Page::CONTACT\_US\_ACTION\_NAME ); ?>" /> |
  | 192 |  | <input id="email\_subject" maxlength="100" name="email[subject]" type="text" class="form-control" value="<?php if ( !empty($\_GET['contact\_us\_subject']) ) echo \_\_(sanitize\_text\_field(wp\_unslash( $\_GET['contact\_us\_subject']))); ?>" placeholder="<?php \_e( 'Subject', 'ecwid-shopping-cart' ); ?>  "> |
  | 193 |  | <textarea id="email\_body" name="email[body]" class="form-control" placeholder="<?php \_e( 'Type in your message here', 'ecwid-shopping-cart' ); ?>   "><?php if ( !empty($\_GET['contact\_us\_message']) ) echo sanitize\_text\_field(wp\_unslash($\_GET['contact\_us\_message'])); ?></textarea> |
  |  | 213 | <input type="hidden" name="\_wpnonce" id="wp-nonce" value="<?php echo wp\_create\_nonce( Ecwid\_Help\_Page::CONTACT\_US\_ACTION\_NAME ); ?>" /> |
  |  | 214 | <input id="email\_subject" maxlength="100" name="email[subject]" type="text" class="form-control" value=" |
  |  | 215 | <?php |
  |  | 216 | if ( ! empty( $\_GET['contact\_us\_subject'] ) ) { |
  |  | 217 | echo \_\_( sanitize\_text\_field( wp\_unslash( $\_GET['contact\_us\_subject'] ) ) );} |
  |  | 218 | ?> |
  |  | 219 | " placeholder="<?php \_e( 'Subject', 'ecwid-shopping-cart' ); ?> "> |
  |  | 220 | <textarea id="email\_body" name="email[body]" class="form-control" placeholder="<?php \_e( 'Type in your message here', 'ecwid-shopping-cart' ); ?>   "> |
  |  | 221 | <?php |
  |  | 222 | if ( ! empty( $\_GET['contact\_us\_message'] ) ) { |
  |  | 223 | echo sanitize\_text\_field( wp\_unslash( $\_GET['contact\_us\_message'] ) );} |
  |  | 224 | ?> |
  |  | 225 | </textarea> |
  | 194 | 226 | <div class="btn-container"> |
  | 195 | 227 | <button id="contact-ecwid-support" class="btn btn-medium btn-aqua" type="submit"> |
  | 196 |  | <span class="btn-text"><?php \_e( 'Send Message', 'ecwid-shopping-cart'); ?></span> |
  |  | 228 | <span class="btn-text"><?php \_e( 'Send Message', 'ecwid-shopping-cart' ); ?></span> |
  | 197 | 229 | <div class="loader"> |
  | 198 | 230 | <div class="ecwid-spinner spin-right"> |
  | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2640505#L205) | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634#L237) |  |
  | 205 | 237 | </div> |
  | 206 | 238 | </button> |
  | 207 |  | <div class="send-error"><?php \_e(~~'Send message failed', 'ecwid-shopping-cart'~~); ?></div> |
  |  | 239 | <div class="send-error"><?php \_e( 'Send message failed', 'ecwid-shopping-cart' ); ?></div> |
  | 208 | 240 | </div> |
  | 209 | 241 | </form> |
  | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2640505#L211) | […](/browser/ecwid-shopping-cart/trunk/templates/help.php?rev=2755634#L243) |  |
  | 211 | 243 | </div> |
  | 212 | 244 | <div class="block-sent"> |
  | 213 |  | <h2><?php \_e( 'Your email has been sent', 'ecwid-shopping-cart'); ?></h2> |
  | 214 |  | <p><?php \_e(~~' Thank you very much for contacting us! We will get back to you shortly.', 'ecwid-shopping-cart'~~); ?></p> |
  | 215 |  | <p><a id="show-ecwid-contact-again" href="#"><?php \_e( 'You can send a new request here.', 'ecwid-shopping-cart'); ?></a></p> |
  |  | 245 | <h2><?php \_e( 'Your email has been sent', 'ecwid-shopping-cart' ); ?></h2> |
  |  | 246 | <p><?php \_e( ' Thank you very much for contacting us! We will get back to you shortly.', 'ecwid-shopping-cart' ); ?></p> |
  |  | 247 | <p><a id="show-ecwid-contact-again" href="#"><?php \_e( 'You can send a new request here.', 'ecwid-shopping-cart' ); ?></a></p> |
  | 216 | 248 |  |
  | 217 | 249 | </div> |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2755658&old=2754114&new_path=%2Fecwid-shopping-cart%2Ftrunk&old_path=%2Fecwid-shopping-cart%2Ftrunk)
* [Zip Archive](?format=zip&new=2755658&old=2754114&new_path=%2Fecwid-shopping-cart%2Ftrunk&old_path=%2Fecwid-shopping-cart%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_3669c503_20250114_200231.html ===


![](https://www.wordfence.com/wp-content/uploads/2022/08/Cross-Site-Request-Forgery-Vulnerability-Patched-in-Ecwid-Ecommerce-Shopping-Cart-Plugin.png)

[![](https://secure.gravatar.com/avatar/680d477d7c41e2495d76bb142a238b06?s=80&d=mm&r=g)Marco Wotschka](https://www.wordfence.com/blog/author/wfmarco/)

August 4, 2022

# Cross-Site Request Forgery Vulnerability Patched in Ecwid Ecommerce Shopping Cart Plugin

On June 24, 2022, the Wordfence Threat Intelligence team initiated the responsible disclosure process for a Cross-Site Request Forgery vulnerability we discovered in Ecwid Ecommerce Shopping Cart, a WordPress plugin installed on over 30,000 sites. This vulnerability made it possible for attackers to modify some of the plugin’s more advanced settings via a forged request.

We attempted to reach out to the developer on June, 24, 2022 via their ticketing system. After several plugin updates did not address the issue and we received no response from the developer, we disclosed this vulnerability to the plugins team on July 11, 2022. The vulnerabilities were fixed a few days later in version 6.10.24 on July 13, 2022.

Due to the nature of Cross-Site Request Forgery vulnerabilities, which involve tricking administrators into performing actions they are allowed to perform, it is not possible to provide adequate protection for these vulnerabilities without blocking legitimate requests. As such, we highly recommend updating to version 6.10.24 or higher of Ecwid Ecommerce Shopping Cart to ensure that your site is protected against any exploits targeting this vulnerability.

**Description**: Cross-Site Request Forgery to Settings/Options Update

**Affected Plugin**: [Ecwid Ecommerce Shopping Cart](https://wordpress.org/plugins/ecwid-shopping-cart/)

**Plugin Slug**: ecwid-shopping-cart

**Affected Versions**: <= 6.10.23

**CVE ID**: [CVE-2022-2432](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-2432)

**CVSS Score**: 8.8 (High)

**CVSS Vector**: [CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H)

**Researcher/s**: Marco Wotschka

**Fully Patched Version**: 6.10.24

Ecwid Ecommerce Shopping Cart is a plugin offered by Lightspeed that allows site owners to set up an eCommerce store on a WordPress website and then sync it across various services such as Amazon and social media. It also offers ad integration and access to marketing tools. As part of the plugin’s functionality, there were some more advanced settings that could be managed. Unfortunately, this was implemented insecurely making it possible for attackers to update these settings via a forged request.

More specifically, the plugin provides the following `admin_post` action hooked to the ‘`ecwid_update_plugin_params`‘ function for that purpose:

```
add_action('admin_post_' . ecwid_get_update_params_action(), 'ecwid_update_plugin_params');
```

An initial check in the ‘`ecwid_update_plugin_params`‘ function ensures that the current user is allowed to manage site options, which is a capability that belongs to administrators. However, the nonce check performed shortly after is only executed if a nonce is set due to how the function uses `&&` to combine the checks to validate that a nonce is present in the request and to verify that the nonce is valid. This means that if the `wp-nonce` parameter is not supplied in the request, the verification step is skipped. This makes the functionality susceptible to Cross-Site Request Forgery attacks in vulnerable versions.

```
add_action('admin_post_' . ecwid_get_update_params_action(), 'ecwid_update_plugin_params');
function ecwid_update_plugin_params()
{
   if ( !current_user_can('manage_options') ) {
      wp_die( __( 'Sorry, you are not allowed to access this page.' ) );
   }

   if ( isset($_POST['wp-nonce']) && !wp_verify_nonce(sanitize_text_field(wp_unslash($_POST['wp-nonce'])), ecwid_get_update_params_action()) ) {
      wp_die( __( 'Sorry, you are not allowed to access this page.' ) );
   }

   $options = ecwid_get_update_params_options();

   $options4update = array();

   foreach ( $options as $key => $option ) {
      if( !isset($_POST['option'][$key]) ) {
         continue;
      }

      if ( isset($option['type']) && $option['type'] == 'html' ) {
         $options4update[$key] = sanitize_textarea_field(wp_unslash( $_POST['option'][$key] ));
      } else {
         $options4update[$key] = sanitize_text_field(wp_unslash( $_POST['option'][$key] ));
      }

      if( $key == 'ecwid_store_id' ) {
         $options4update[$key] = intval($options4update[$key]);
      }
   }

   foreach ($options4update as $name => $value) {
      update_option($name, $value);
   }

   wp_safe_redirect('admin.php?page=ec-params');
   exit();
}
```

This makes it possible for an attacker to change the `ecwid_store_id`, which uniquely identifies the store and is needed for support requests as well as for embedding the store on other sites. Another site option that could be modified is the site’s `ecwid_store_page_id`, which is the storefront page in the WordPress installation. Both of these settings may result in a loss of availability of the storefront if changed to an invalid store ID. There are several other settings that could be affected in addition to those two. The plugin does not provide a direct link to the settings page in any of its menus and a warning on the page suggests that modifying these settings may significantly affect the plugin functionality.

## The Importance of Properly Implementing Nonces

Nonces are a critical component used to prevent Cross-Site Request Forgery vulnerabilities. As such, it’s important to ensure they are properly implemented throughout plugin and theme code to prevent unauthorized execution of that code. Fortunately, WordPress provides several mechanisms to create and validate proper nonces.

### Nonce Creation

The first step to proper nonce implementation is nonce creation.

One option to properly implement nonce creation involves the `wp_nonce_url()` function. This function expects a target URL as well as an action and an optional nonce name. The nonce will be added to a URL and can be verified by a nonce validation function that is executed in the same or subsequent function. This makes it possible for developers to provide links to perform actions such as deletion of posts with a proper nonce that allows the code to verify that the action was initiated from within the site as opposed to a click on a link elsewhere, such as in an email.

An additional option is adding a nonce to a form to secure any submissions originating from that form. The function `wp_nonce_field()` is frequently used in these cases and expects an action string. This will add a hidden input field to the form. Upon form submission, the created nonce can be checked and verified.

Finally, a nonce can also be generated using `wp_create_nonce()`, which accepts an action string argument and returns just a nonce. This can be implemented in a variety of different ways and allows more flexibility as a developer to implement nonce validation. We frequently see this function contained in HTML on setting pages that is later used to validate the origin of the request when saving those settings.

Remember that nonces are specific to individual users and sessions and are invalidated after 24 hours, or on logout.

### Nonce Validation

The second step to proper nonce implementation involves nonce verification. A plugin can implement an appropriate nonce on a form or settings update, but without proper validation of that nonce, there won’t be adequate protection.

The first option to properly validate a nonce involves the use of the `check_admin_referer()` function. This function accepts the protected action as well as the name of the nonce as an argument and checks the nonce as well as the referer, thus helping to ensure that the nonce provided is correct and that the request was initiated from an admin page.

When implementing an AJAX action, the `check_ajax_referer()` function can be used. This will verify the nonce but will not check the referer like the `check_admin_referer()` function does although it will validate that the request is an AJAX request.

A final option for validating a nonce is the more general `wp_verify_nonce()` function. With this function, an action and nonce name will need to be supplied, and it will verify that the proper nonce was set. This provides the most flexible implementation of nonce validation for developers.

In the case of today’s disclosure, the nonce was created on the settings form itself with `wp_create_nonce()`:

```
	<input type="hidden" name="nonce" value="<?php echo wp_create_nonce( ecwid_get_update_params_action() ); ?>" />
```

However, the nonce verification was not performed correctly:

```

	if ( isset($_POST['wp-nonce']) && !wp_verify_nonce(sanitize_text_field(wp_unslash($_POST['wp-nonce'])), ecwid_get_update_params_action()) ) {
		wp_die( __( 'Sorry, you are not allowed to access this page.' ) );
	}
```

As you can see, this statement will call `wp_verify_nonce()` but only if the nonce is set due to the `if (isset($_POST['wp-nonce'])` check and the use of `&&` in combination with the `wp_verify_nonce()` function. Therefore, if the nonce is omitted, this check will not take place.

This serves as an important reminder to not only properly implement nonces and validation checks but also to ensure that the check fails when the nonce value is empty or otherwise not present.

As a final important note: never rely on nonce checks alone. Developers should always remember to include a capability check using a function like `current_user_can()` in order to ensure the user initiating the action is indeed allowed to perform it. Nonces should never be used for authentication, authorization or any form of access control as they are simply intended to verify the origin of the request, and do not perform any authorization.

## Timeline

* **June 24, 2022** – Initial outreach to the plugin developer.
* **July 11, 2022** – We escalate the issue to the WordPress.org plugins team and send them the full disclosure details.
* **July 13, 2022** – The vulnerability is patched in version 6.10.24.

## Conclusion

In today’s post, we covered a vulnerability in the Ecwid Ecommerce Shopping Cart plugin that could be used to trick site administrators into updating plugin settings due to improper nonce verification. The vulnerability was patched by ensuring that a proper nonce was set and by verifying it.

Please remember that due to the nature of Cross-Site Request Forgery vulnerabilities, it is not possible to provide adequate protection via the Wordfence firewall without blocking legitimate requests. As such, we highly recommend updating to version 6.10.24 or higher of Ecwid Ecommerce Shopping Cart to ensure that your site is protected against any exploits targeting this vulnerability.

If you believe your site has been compromised as a result of this vulnerability or any other vulnerability, we offer Incident Response services via [Wordfence Care](https://www.wordfence.com/products/wordfence-care/). If you need your site cleaned immediately, [Wordfence Response](https://www.wordfence.com/products/wordfence-response/) offers the same service with 24/7/365 availability and a 1-hour response time. Both of these products include hands-on support in case you need further assistance.

If you have any friends or colleagues who are using this plugin, please share this announcement with them and encourage them to update to the latest patched version of Ecwid Ecommerce Shopping Cart as soon as possible.

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2022%2F08%2Fcross-site-request-forgery-vulnerability-patched-in-ecwid-ecommerce-shopping-cart-plugin%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2022%2F08%2Fcross-site-request-forgery-vulnerability-patched-in-ecwid-ecommerce-shopping-cart-plugin%2F&text=Cross-Site%20Request%20Forgery%20Vulnerability%20Patched%20in%20Ecwid%20Ecommerce%20Shopping%20Cart%20Plugin&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2022%2F08%2Fcross-site-request-forgery-vulnerability-patched-in-ecwid-ecommerce-shopping-cart-plugin%2F)

## Comments

2 Comments

* ![](https://secure.gravatar.com/avatar/7b6a5a0d3a5ef7d42a3824f6a4551679?s=96&d=mm&r=g)
  Ilnur
  August 8, 2022
   1:17 am

  Hi, Marko!

  This is Ilnur from Ecwid by Lightspeed team.

  Thanks for your report! Appreciate it!

  Unfortunately, on June 24 we did not receive your letter on this issue. We would fix it right away. Anyway, thank you.

  If you have any reports to submit, please contact us at whitehat AT ecwid.com. More about our bug bounty program here https://github.com/Ecwid/security-bug-bounty.

+ ![](https://secure.gravatar.com/avatar/680d477d7c41e2495d76bb142a238b06?s=96&d=mm&r=g)
  Marco Wotschka
  August 8, 2022
   10:07 am

  Thanks for sharing this information! We were not aware you had a disclosure program, and did not find those details when we made our initial outreach. We will be sure to use that address if we ever discover any issues in the future. Hopefully this information can also help any other security researchers that may discover any issues.

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save


