=== Content from gitlab.com_ae7611c2_20250114_200647.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# XSS in ZenTao integration affecting self hosted instances without strict CSP

**[HackerOne report #1542510](https://hackerone.com/reports/1542510)** by `joaxcar` on 2022-04-16, assigned to [@ngeorge1](/ngeorge1 "Nikhil George"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

The ZenTao issue integration (premium feature) is susceptible to an XSS attack by delivering modified API responses to GitLab.

This is related and similar to my report <https://hackerone.com/reports/1533976> but this time affecting the ZenTao integration.

A user can create a project and configure ZenTao to be used as an external issue tracker. [ducumentation](https://docs.gitlab.com/ee/user/project/integrations/zentao.html). If this is done on a `premium` instance the integration will add an `issue list` to the project displaying ZenTao issues, and clicking one of these issues will display issue details for a single ZenTao issue. The URL for a single issue looks like

<https://gitlab.example.com/GROUP/PROJECT/-/integrations/zentao/issues/story-1>

Visiting this page will trigger the GitLab backend to make an API request to the configured ZenTao instance like this

<https://zentao.example.net/api.php/v1/issues/story-1>

and the response from such a request looks like

```
{
    "issue": {
        "id": "story-1",
        "title": "story",
        "labels": [ ],
        "pri": 3,
        "openedDate": "2021-08-10T08:25:18Z",
        "openedBy": {
            "id": 1,
            "account": "admin",
            "realname": "admin",
            "avatar": "https://www.gravatar.com/avatar/21232f297a57a5a743894a0e4a801fc3?d=identicon&s=80",
            "url": "https://jihudemo.zentao.net/index.php?m=user&f=profile&userID=1"
        },
        "lastEditedDate": "2021-08-10T08:25:18Z",
        "lastEditedBy": "admin",
        "status": "opened",
        "url": "https://jihudemo.zentao.net/index.php?m=story&f=view&storyID=32",
        "desc": "",
        "assignedTo": [],
        "comments": [ ]
    }
}
```

This response is serialized by [ee/app/serializers/integrations/zentao\_serializers/issue\_entity.rb](https://gitlab.com/gitlab-org/gitlab/-/blob/master/ee/app/serializers/integrations/zentao_serializers/issue_entity.rb)

The interesting part of this file is

```
     expose :web_url do |item|
        item['url']
      end
```

and also

```
      expose :id do |item|
        sanitize(item['id'])
      end
```

The `:web_url` does not check for correctness of the URL and can thus be given a JavaScript URL such as `javascript:alert(document.domain)`. The `:id` is sanitized by ruby sanitizer, but is not HTML encoded. This will open up a "safe" HTML injection, which we can use to make the attack easier to pull of.

When viewing a ZenTao issue details page the `:web_url` and `:id` is used to create the last part of the breadcrumb links. By adding this to our API response

```
{
   "id": "<img src=# height=10000 width=10000>",
   "url": "javascript:alert(document.domain)"
}
```

The details page will now display a giant image that on click will trigger the XSS.

Here I use an image tag just to prove that the injection. The `:id` HTML injection can be customized to have the victim more prone to clicking the link.

Infected page:

[![link.jpg](data:image/gif;base64...)](https://user-content.gitlab-static.net/8a645e9cd7e5245ff98179cffbc9aa4f909c97a6/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65653733396666312d663632662d343961362d626363652d3666366432663661613635352f6c696e6b2e6a7067)

Popup:

[![popup.jpg](data:image/gif;base64...)](https://user-content.gitlab-static.net/54296201ea1d8d31fc64f256ec22c502aa24c784/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f38646231333935662d326535642d343132362d613638372d6330383464626639306336312f706f7075702e6a7067)

##### Steps to reproduce

Using my hosted server (see example further down for self hosting the attack):

1. Log in with a user on a self hosted GitLab instance with premium subscription (call the user `user1`)
2. Create a new project, call it `project1`
3. Go to <https://gitlab.example.com/user1/project1/-/integrations/zentao/edit>
4. Fill in the form. Put `https://joaxcar.com` in the server field. Leave the API field empty, add anything in the username and password.
5. Go to

   <https://gitlab.example.com/user1/project1/-/integrations/zentao/issues/story-1>
6. Click the big white square
7. XSS triggered

To self host the API make sure to host a server that will deliver this payload with a `application/json` response to calls to `/api.php/v1/issues/story-1`

payload

```
{
    "issue": {
        "id": "<img src=# height=10000 width=10000>",
        "title": "Attack",
        "labels": [],
        "pri": 3,
        "openedDate": "2021-08-10T08:25:18Z",
        "openedBy": {
            "id": 1,
            "account": "asd",
            "realname": "admin",
            "avatar": "https://www.gravatar.com/avatar/21232f297a57a5a743894a0e4a801fc3?d=identicon&s=80",
            "url": "https://example.com"
        },
        "lastEditedDate": "2021-08-10T08:25:18Z",
        "lastEditedBy": "asd",
        "status": "asd",
        "url": "javascript:alert(document.domain)",
        "desc": "description",
        "assignedTo": [],
        "comments": []
    }
}
```

##### Impact

Full XSS on self hosted GitLab instances. A victim needs to visit the infected page and made to click a special link (can be made easy to click)

##### What is the current *bug* behavior?

ZenTao issue URLs are not sanitized

##### What is the expected *correct* behavior?

Javasript URLs should be filtered

##### CSP

This attack does not work on GitLab.com as the CSP rules block any JavaScript URL. I don't know of any bypass to this. But it does affect self-hosted instances that have not configured CSP. I calculated my CVSS score as per attacking a self-hosted instance. GitLab team can modify this according to your current treatment of these issues!

##### Ruby sanitation

The ZenTao issues uses a lot of `ruby sanatize` sanitization. This is strict enough to prevent any serious code injection but still allows for some HTML tags to be included where they are supposed not to be. Like in ID in this issue.

Best regards

Johan

#### Impact

Full XSS on self hosted GitLab instances. A victim needs to visit the infected page and made to click a special link (can be made easy to click)

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [popup.jpg](https://h1.sec.gitlab.net/a/8db1395f-2e5d-4126-a687-c084dbf90c61/popup.jpg)
* [link.jpg](https://h1.sec.gitlab.net/a/ee739ff1-f62f-49a6-bcce-6f6d2f6aa655/link.jpg)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_634055a4_20250114_200646.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-2235.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-2235.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-2235.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-2235.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Jul 01, 2022

  [276ddf93](/gitlab-org/cves/-/commit/276ddf934b7142e04d6656613db8266f642e8a69)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/276ddf934b7142e04d6656613db8266f642e8a69)
  ·
  276ddf93

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jul 01, 2022

  276ddf93

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/276ddf934b7142e04d6656613db8266f642e8a69)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jul 01, 2022

Loading


