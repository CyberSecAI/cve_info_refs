=== Content from gitlab.com_60d99aad_20250114_184110.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-2527.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-2527.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-2527.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-2527.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Oct 17, 2022

  [ecd3ba36](/gitlab-org/cves/-/commit/ecd3ba36a0aca8a4808ce40986bdda5423dfc1cf)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/ecd3ba36a0aca8a4808ce40986bdda5423dfc1cf)
  ·
  ecd3ba36

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Oct 17, 2022

  ecd3ba36

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/ecd3ba36a0aca8a4808ce40986bdda5423dfc1cf)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Oct 17, 2022

Loading



=== Content from gitlab.com_b11967e6_20250114_184110.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Content injection via Incidents Timeline description

**[HackerOne report #1647446](https://hackerone.com/reports/1647446)** by `yvvdwf` on 2022-07-23, assigned to [@nmalcolm](/nmalcolm "Nick Malcolm"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Content injection via Incidents Timeline description

Gitlab recently relased a [feature](https://about.gitlab.com/releases/2022/07/22/gitlab-15-2-released/#incident-timeline) allowing to add descriptions in the timeline of an incident. Its markdown description is filtered by `TimelineEventPipeline` pipeline which includes `Filter::ImageLinkFilter` filter. The latter is vulnerable to arbitrary content injection, thus leads to XSS.

This is the [venerable code](https://gitlab.com/gitlab-org/gitlab/-/blob/688e874e97af822d6afe117a34f764306cef8163/lib/banzai/filter/image_link_filter.rb#L37) because `link_replaces_image` is true in `TimelineEventPipeline`.

```
  link.children = if link_replaces_image
           img['alt'] || img['data-src'] || img['src']
    else
            img.clone
     end
```

Consequently, we can inject any HTML content by using `alt` attribute whose value is not sanitized. Although the injected HTML content will be sanitized one more times using Dompurify when showing in Web browser, but there are few exceptions:

* there exists `data-disable-with` attribute that is not sanitized and allows attackers to inject *any* HTML content, even `<iframe>`, `<script` tags, etc. Attackers may get full XSS in the Gitlab self-managed instances that are not protected by a restricted CSP as [I reported](https://hackerone.com/reports/1579645)
* when combining with other gadgets, the `class` attribute allows attackers may send arbitrary POST requests on behalf of victims. This leads to the possibility of admin user escalation or account takeover (when the account was created via a third party provider.

The following steps shows a demo of account takeover attack on Gitlab.com. The exploitation should be the same as in [1628009](https://hackerone.com/reports/1628009).

### Step to reproduce

* These steps will be done on Gitlab.com. You need to have a victim account to take over. This account is registered on Gitlab.com by logging in via a third provider, such as, a Google, Github, Twitter, Bitbucket, or Saleforce.
* On an existing project (or create a new project), Goto `Monitor/Incidents`, then click on `Create incident` button to create a new incident. Then fill the form as you want. Then click `Create issue` to create a new incident. You will be redirected to the result.
* Now click on `Timeline` link, then click on `Add new timeline event` and fill the `Timeline text` using the following payload:

```
<img src=x alt="<a class='js-issuable-todo fixed-top fixed-bottom text-hide cursor-defaul' data-create-path=/-/profile/password?_method=put&user%5Bnew_password%5D=12345678&user%5Bpassword_confirmation%5D=12345678><style> .tab-content>.tab-pane{display: block !important}</style>">
```

[![payload.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/1299574c23800668f3e33afce62d1556df0ed456/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39343435393733632d393530352d343465342d623930312d3735653366656539373034662f7061796c6f61642e706e67)

* Click on `Save` button.
* You may notice that:

  + the timeline is shown by default (not summary of incident). This is caused by the content in `<style>` tag we injected
  + a transparent layer on the top of the web page. If you click on that layer, you will trigger a POST request.

    [![post-request.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/4d4a511f11c1845a71256cb82fe786ffeded1f72/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61663661303962392d316136302d343336332d623630392d6431626461373834323931622f706f73742d726571756573742e706e67)
* Now logout Gitlab.com, then login with a third party provider to generate a new account on Gitlab.com

  [![third-party-app-login.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/414fbfef3de0eb79cdf70ee0d8c21810f11280ff/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f37363931373930332d633564372d343061332d396334302d3565643064343864313261332f74686972642d70617274792d6170702d6c6f67696e2e706e67)
* (If the attack project is not public, then we need to invite the victim to be a member of the project so that the victim can access to the incident page)
* As the victim, visit the incident page and click anywhere (the topmost transparent layer)
* Refresh the page, you should now be logged out from Gitlab.com as your password was changed
* Here is an example, that is in a private project: <https://gitlab.com/yvvdwf/xss/-/issues/incident/11>

### Impact

HTML injection allows attackers to (1) get full XSS in the Gitlab self-managed instances that are not protected by a restricted CSP, or (2) to send arbitrary POST request on behalf of victims that can lead to permission escalation or even account takeover, etc.

#### Impact

HTML injection allows attackers to (1) get full XSS in the Gitlab self-managed instances that are not protected by a restricted CSP, or (2) to send arbitrary POST request on behalf of victims that can lead to permission escalation or even account takeover, etc.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [payload.png](https://h1.sec.gitlab.net/a/9445973c-9505-44e4-b901-75e3fee9704f/payload.png)
* [post-request.png](https://h1.sec.gitlab.net/a/af6a09b9-1a60-4363-b609-d1bda784291b/post-request.png)
* [third-party-app-login.png](https://h1.sec.gitlab.net/a/76917903-c5d7-40a3-9c40-5ed0d48d12a3/third-party-app-login.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


