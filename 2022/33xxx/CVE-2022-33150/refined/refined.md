- **Root cause of vulnerability**: The vulnerability stems from the improper handling of user-controlled filenames in the `js_package` binary. Specifically, the `js_package` binary uses `sysprintf` (which is a wrapper around `vsnprintf` and `system`) to execute a `tar` command, taking the user-provided filename directly as input without proper sanitization.
- **Weaknesses/vulnerabilities present**: OS command injection. The program constructs a command using user-provided input, specifically the filename of a uploaded file. This allows the injection of arbitrary commands into the executed `tar` command, leading to arbitrary command execution on the system.
- **Impact of exploitation**: Successful exploitation allows an attacker to execute arbitrary commands on the vulnerable system with the privileges of the process executing the `js_package` binary. This can lead to complete compromise of the device.
- **Attack vectors**: The attack is performed by sending a sequence of HTTP requests to the device:
    1. A multipart request to `/action/import_nodejs_app/` is used to upload a file with a crafted filename, which will be stored in the global `FILENAME` variable. The filename must end with `.tar` to trigger the vulnerable `tar` command execution within the `js_package` binary. The malicious command injection is included in this filename (e.g., `test.tar; id > /tmp/out`).
    2. A request to `/ajax/system_nodejs_app_upgrade_start/` API is sent to start the installation, which triggers the execution of the `js_package` binary and the injection.
- **Required attacker capabilities/position**: The attacker needs to have network access to the device and be able to send HTTP requests. The attacker needs to be authenticated to the web interface, since the API is protected. The attacker needs to know the structure of multipart/form-data and the API endpoints.