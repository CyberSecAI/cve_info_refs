=== Content from jvn.jp_e1088f1b_20250114_181438.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2022/07/12  Last Updated:2022/07/20
# JVNVU#97846460 U-Boot squashfs filesystem implementation vulnerable to heap-based buffer overflow

## Overview

squashfs filesystem implementation of U-Boot contains a heap-based buffer overflow vulnerability.

## Products Affected

* U-Boot versions from v2020.10-rc2 to v2022.07-rc5

## Description

U-Boot is a boot loader for multiple platforms, and squashfs filesystem feature is provided since v2020.10-rc2 ([commit c5100613](https://source.denx.de/u-boot/u-boot/-/commit/c51006130370b48b7eb5a93ada745385aa27f6bf)). squashfs filesystem implementation of U-Boot contains a heap-based buffer overflow vulnerability ([CWE-122](//cwe.mitre.org/data/definitions/122.html)) due to a defect in the metadata reading process.

## Impact

Loading a specially crafted squashfs image may lead to a denial-of-service (DoS) condition or an arbitrary code being executed.

## Solution

**Update the Software**

Update the software to the latest version according to the information provided by the developer.

The developer has included the fix in U-Boot v2022.07-rc6.

## Vendor Status

| Vendor | Link |
| --- | --- |
| DENX Software Engineering | [U-Boot](https://www.denx.de/project/u-boot/) |
|  | [U-Boot mailing list: [v2] fs/squashfs: Use kcalloc when relevant](https://lists.denx.de/pipermail/u-boot/2022-June/487467.html) |
|  | [Commit 7f7fb993: fs/squashfs: Use kcalloc when relevant](https://source.denx.de/u-boot/u-boot/-/commit/7f7fb9937c6cb49dd35153bd6708872b390b0a44) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

CVSS v3
CVSS:3.0/AV:P/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H
Base Score:
6.6

| Attack Vector(AV) | Physical (P) | Local (L) | Adjacent (A) | Network (N) |
| --- | --- | --- | --- | --- |
| Attack Complexity(AC) | High (H) | Low (L) |
| Privileges Required(PR) | High (H) | Low (L) | None (N) |
| User Interaction(UI) | Required (R) | None (N) |
| Scope(S) | Unchanged (U) | Changed (C) |
| Confidentiality Impact(C) | None (N) | Low (L) | High (H) |
| Integrity Impact(I) | None (N) | Low (L) | High (H) |
| Availability Impact(A) | None (N) | Low (L) | High (H) |

## Credit

Tatsuhiko Yasumatsu of Sony Corporation reported this vulnerability to JPCERT/CC.

JPCERT/CC coordinated between the reporter and the developer.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2022-33967](https://www.cve.org/CVERecord?id=CVE-2022-33967) |
| JVN iPedia |  |

## Update History

2022/07/20
Version information under the section [Products Affected], [Description] and [Solution] are updated.

* JVN
* [HOME](/en/index.html)
* [What is JVN ?](/en/nav/jvn.html)
* [Instructions](/en/nav/jvnhelp.html)
* [List of Vulnerability Report](/en/report/index.html)
* [VN\_JP](/en/jp/index.html)
* [VN\_JP(Unreachable)](/en/adj/index.html)
* [VN\_VU](/en/vu/index.html)
* [TA](/en/ta/index.html)
* [TRnotes](/en/tr/index.html)
* [JVN iPedia](http://jvndb.jvn.jp/en/)
* [MyJVN](http://jvndb.jvn.jp/en/apis/myjvn/index.html)
* [JVNJS/RSS](/en/rss/index.html)
* [Vendor List](/en/nav/index.html)
* [List of unreachable developers](/en/reply/index.html)
* [Contact](/en/contact/index.html)

Copyright (c) 2000-2022 JPCERT/CC and IPA. All rights reserved.



=== Content from source.denx.de_d8bc3a04_20250114_181440.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Register](/users/sign_up)

**Commit
7f7fb993**

authored
Jun 27, 2022
by
**![Miquel Raynal's avatar](https://secure.gravatar.com/avatar/e0d6005ccd0644fa3c47b707e1aef1fb9431ddca9084aa6eb5b42648518bb7f4?s=48&d=identicon "Miquel Raynal")
Miquel Raynal**
Committed by
[Tom Rini](/trini)
Jun 28, 2022

[Browse files](/u-boot/u-boot/-/tree/7f7fb9937c6cb49dd35153bd6708872b390b0a44)

### fs/squashfs: Use kcalloc when relevant

```

A crafted squashfs image could embed a huge number of empty metadata
blocks in order to make the amount of malloc()'d memory overflow and be
much smaller than expected. Because of this flaw, any random code
positioned at the right location in the squashfs image could be memcpy'd
from the squashfs structures into U-Boot code location while trying to
access the rearmost blocks, before being executed.

In order to prevent this vulnerability from being exploited in eg. a
secure boot environment, let's add a check over the amount of data
that is going to be allocated. Such a check could look like:

if (!elem_size || n > SIZE_MAX / elem_size)
	return NULL;

The right way to do it would be to enhance the calloc() implementation
but this is quite an impacting change for such a small fix. Another
solution would be to add the check before the malloc call in the
squashfs implementation, but this does not look right. So for now, let's
use the kcalloc() compatibility function from Linux, which has this
check.

Fixes: [c5100613](/u-boot/u-boot/-/commit/c51006130370b48b7eb5a93ada745385aa27f6bf "fs/squashfs: new filesystem") ("fs/squashfs: new filesystem")
Reported-by: ![default avatar](https://secure.gravatar.com/avatar/08845b7197a7755962b7e941e3318b0c15c797f356a400d7dee80cf0e6b005d7?s=32&d=identicon)Tatsuhiko Yasumatsu <Tatsuhiko.Yasumatsu@sony.com>
Signed-off-by: ![default avatar](https://secure.gravatar.com/avatar/e0d6005ccd0644fa3c47b707e1aef1fb9431ddca9084aa6eb5b42648518bb7f4?s=32&d=identicon)Miquel Raynal <miquel.raynal@bootlin.com>
Tested-by: ![default avatar](https://secure.gravatar.com/avatar/08845b7197a7755962b7e941e3318b0c15c797f356a400d7dee80cf0e6b005d7?s=32&d=identicon)Tatsuhiko Yasumatsu <Tatsuhiko.Yasumatsu@sony.com>
```

parent
[8f8c04bf](/u-boot/u-boot/-/commit/8f8c04bf1ebbd2f72f1643e7ad9617dafa6e5409)

Loading

Loading

Loading

* [Changes
  1](/u-boot/u-boot/-/commit/7f7fb9937c6cb49dd35153bd6708872b390b0a44)

[Hide whitespace changes](/u-boot/u-boot/-/commit/7f7fb9937c6cb49dd35153bd6708872b390b0a44?action=show&controller=projects%2Fcommit&id=7f7fb9937c6cb49dd35153bd6708872b390b0a44&namespace_id=u-boot&project_id=u-boot&w=1)
[Inline](/u-boot/u-boot/-/commit/7f7fb9937c6cb49dd35153bd6708872b390b0a44?view=inline)
[Side-by-side](/u-boot/u-boot/-/commit/7f7fb9937c6cb49dd35153bd6708872b390b0a44?view=parallel)

Loading

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment

[Imprint](https://www.denx.de/en/AboutUs/DenxSEImpressum) & [Privacy Policy](https://www.denx.de/en/AboutUs/DatenSchutzErklaerung)



=== Content from lists.denx.de_c95b8d21_20250114_181440.html ===

# [PATCH v2] fs/squashfs: Use kcalloc when relevant

**Miquel Raynal**
miquel.raynal at bootlin.com

*Mon Jun 27 12:20:03 CEST 2022*

* Previous message (by thread): [[GIT PULL] xilinx patches for v2022.10](487481.html)
* Next message (by thread): [[PATCH v2] fs/squashfs: Use kcalloc when relevant](487625.html)
* **Messages sorted by:**
  [[ date ]](date.html#487467)
  [[ thread ]](thread.html#487467)
  [[ subject ]](subject.html#487467)
  [[ author ]](author.html#487467)

---

```
A crafted squashfs image could embed a huge number of empty metadata
blocks in order to make the amount of malloc()'d memory overflow and be
much smaller than expected. Because of this flaw, any random code
positioned at the right location in the squashfs image could be memcpy'd
from the squashfs structures into U-Boot code location while trying to
access the rearmost blocks, before being executed.

In order to prevent this vulnerability from being exploited in eg. a
secure boot environment, let's add a check over the amount of data
that is going to be allocated. Such a check could look like:

if (!elem_size || n > SIZE_MAX / elem_size)
	return NULL;

The right way to do it would be to enhance the calloc() implementation
but this is quite an impacting change for such a small fix. Another
solution would be to add the check before the malloc call in the
squashfs implementation, but this does not look right. So for now, let's
use the kcalloc() compatibility function from Linux, which has this
check.

Fixes: c5100613037 ("fs/squashfs: new filesystem")
Reported-by: Tatsuhiko Yasumatsu <[Tatsuhiko.Yasumatsu at sony.com](https://lists.denx.de/listinfo/u-boot)>
Signed-off-by: Miquel Raynal <[miquel.raynal at bootlin.com](https://lists.denx.de/listinfo/u-boot)>
Tested-by: Tatsuhiko Yasumatsu <[Tatsuhiko.Yasumatsu at sony.com](https://lists.denx.de/listinfo/u-boot)>
---

Changes in v2:
* Fixed the title prefix: s/sqashfs/squashfs
* Rebased on master to avoid a conflit with a headers change
* Added a Fixes tag
* Added the Tested-by from Tatsuhiko sent privately

 fs/squashfs/sqfs.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/fs/squashfs/sqfs.c b/fs/squashfs/sqfs.c
index 40361ffa6d6..9f98d086070 100644
--- a/fs/squashfs/sqfs.c
+++ b/fs/squashfs/sqfs.c
@@ -13,6 +13,7 @@
 #include <fs.h>
 #include <linux/types.h>
 #include <asm/byteorder.h>
+#include <linux/compat.h>
 #include <memalign.h>
 #include <stdlib.h>
 #include <string.h>
@@ -726,7 +727,8 @@ static int sqfs_read_inode_table(unsigned char **inode_table)
 		goto free_itb;
 	}

-	*inode_table = malloc(metablks_count * SQFS_METADATA_BLOCK_SIZE);
+	*inode_table = kcalloc(metablks_count, SQFS_METADATA_BLOCK_SIZE,
+			       GFP_KERNEL);
 	if (!*inode_table) {
 		ret = -ENOMEM;
 		printf("Error: failed to allocate squashfs inode_table of size %i, increasing CONFIG_SYS_MALLOC_LEN could help\n",
--
2.34.1

```

---

* Previous message (by thread): [[GIT PULL] xilinx patches for v2022.10](487481.html)
* Next message (by thread): [[PATCH v2] fs/squashfs: Use kcalloc when relevant](487625.html)
* **Messages sorted by:**
  [[ date ]](date.html#487467)
  [[ thread ]](thread.html#487467)
  [[ subject ]](subject.html#487467)
  [[ author ]](author.html#487467)

---

[More information about the U-Boot
mailing list](https://lists.denx.de/listinfo/u-boot)



=== Content from www.denx.de_bf36ea87_20250114_181441.html ===


[Skip to content](#content)

+49 8142 6 69 89 0 info@denx.deKirchenstr. 5 82194 Groebenzell Germany
DENX Software Engineering
the Embedded Linux Experts
[![DENX Software Engineering](https://www.denx.de/wp-content/uploads/2021/07/logo-denx-icon-84x84-1.png)![DENX Software Engineering](https://www.denx.de/wp-content/uploads/2021/07/logo-denx-icon-42x42-1.png)](https://www.denx.de/)

* [Home](https://www.denx.de/)
* [About company](https://www.denx.de/about-company/)
* [News](https://www.denx.de/category/denx/)
* [Open Source](https://www.denx.de/projects/)
* [Services](https://www.denx.de/services/)
* [Developer’s blog](https://www.denx.de/category/develop-blog/)
* [Training](https://www.denx.de/training/)
* [Contact](https://www.denx.de/contact/)

Search:
Search

* [Home](https://www.denx.de/)
* [About company](https://www.denx.de/about-company/)
* [News](https://www.denx.de/category/denx/)
* [Open Source](https://www.denx.de/projects/)
* [Services](https://www.denx.de/services/)
* [Developer’s blog](https://www.denx.de/category/develop-blog/)
* [Training](https://www.denx.de/training/)
* [Contact](https://www.denx.de/contact/)

# U-Boot

You are here:

1. [Home](https://www.denx.de/ "Home")
2. [Project](https://www.denx.de/project/ "Project")
3. U-Boot

![](data:image/svg+xml...)

Everything has a beginning. You cannot have a running device with Embedded Linux without a bootloader that initializes the hardware and load and start the OS.

U-Boot (subtitled “the Universal Boot Loader” and often shortened to **U-Boot)**, started by Wolfgang Denx more than 20 years ago,has become a de-facto standard for Embedded Linux Device and not only. It is available for a large number of different computer architectures, including 68k, ARM, Blackfin, MicroBlaze, MIPS, Nios, SuperH, PPC, RISC-V and x86.

The project started as an MPC 8xx PowerPC bootloader . Wolfgang Denk moved the project to SourceForge.net and renamed it to **PPCBoot**, because SF.net did not allow project names starting with digits.[[8]](https://en.wikipedia.org/wiki/Das_U-Boot#cite_note-ppc-9) Version 0.4.1 of PPCBoot was first publicly released July 19, 2000.

In 2002 a previous version of the [source code](https://en.wikipedia.org/wiki/Source_code "Source code") was briefly [forked](https://en.wikipedia.org/wiki/Fork_%28software_development%29 "Fork (software development)") into a product called **ARMBoot**, but was merged back into the PPCBoot project shortly thereafter. On October 31, 2002 **PPCBoot−2.0.0** was released. This marked the last release under the PPCBoot name, as it was renamed to reflect its ability to work on other architectures besides the PPC ISA. PPCBoot−2.0.0 became **U−Boot−0.1.0** in November 2002, expanded to work on the [x86](https://en.wikipedia.org/wiki/X86 "X86") processor architecture. Additional architecture capabilities were added in the following months: [MIPS32](https://en.wikipedia.org/wiki/MIPS32 "MIPS32") in March 2003, [MIPS64](https://en.wikipedia.org/wiki/MIPS64 "MIPS64") in April, [Nios II](https://en.wikipedia.org/wiki/Nios_II "Nios II") in October, [ColdFire](https://en.wikipedia.org/wiki/ColdFire "ColdFire") in December, and [MicroBlaze](https://en.wikipedia.org/wiki/MicroBlaze "MicroBlaze") in April 2004. The May 2004 release of U-Boot-1.1.2 worked on the products of 216 board manufacturers across the various architectures.[[10]](https://en.wikipedia.org/wiki/Das_U-Boot#cite_note-history-11)

The current name **Das U-Boot** adds a [German definite article](https://en.wikipedia.org/wiki/German_articles#Definite_article "Read-only memory"), to create a bilingual [pun](https://en.wikipedia.org/wiki/Pun "Pun") on the classic 1981 German submarine film [Das Boot](https://en.wikipedia.org/wiki/Das_Boot "Das Boot"), which takes place on a World War II German [U-boat](https://en.wikipedia.org/wiki/U-boat "U-boat"). It is [free software](https://en.wikipedia.org/wiki/Free_software) released under the terms of the [GNU General Public License](https://en.wikipedia.org/wiki/GNU_General_Public_License "GNU General Public License"). It can be built on an x86 PC for any of its intended architectures using a cross development GNU [toolchain.](https://en.wikipedia.org/wiki/Programming_tool "Programming tool")

The importance of U-Boot in embedded Linux systems is quite succinctly stated in the book *Building Embedded Linux Systems*, by Karim Yaghmour, whose text about U-Boot begins, “Though there are quite a few other bootloaders, ‘Das U-Boot’, the universal bootloader, is arguably the richest, most flexible, and most actively developed open source bootloader available.”

Here the current [documentation](https://u-boot.readthedocs.io/) for the project and its [Source Code](https://source.denx.de/u-boot).

Older and not anymore updated [documentation](https://www.denx.de/wiki/U-Boot):

* [Release Cycle and Release Schedule](https://www.denx.de/wiki/U-Boot/ReleaseCycle)
* [List of custodians and their `git` repositories](https://www.denx.de/wiki/U-Boot/Custodians)
* [Workflow for custodian `git` repositories](https://www.denx.de/wiki/U-Boot/CustodianGitTrees)
* [Development Process](https://www.denx.de/wiki/U-Boot/DevelopmentProcess)
* [Coding Style](https://www.denx.de/wiki/U-Boot/CodingStyle)
* [Patches](https://www.denx.de/wiki/U-Boot/Patches)
* [Tasks](https://www.denx.de/wiki/U-Boot/Tasks)
* [Mailing List](http://lists.denx.de/mailman/listinfo/u-boot)
* Mailing List Archive:

  <http://lists.denx.de/pipermail/u-boot/>

  <http://dir.gmane.org/gmane.comp.boot-loaders.u-boot>

  <http://marc.info/?l=u-boot>

[View online](https://source.denx.de/u-boot)Category: [Bootloader](https://www.denx.de/project-category/bootloader/)[By prometheus](https://www.denx.de/author/prometheus/ "View all posts by prometheus")2021-07-30
## Project navigation

[PreviousPrevious project:Linux Kernel](https://www.denx.de/project/linux-kernel/)

### Related projects

Recent news

* [![](data:image/svg+xml...)](https://www.denx.de/meet-denx-in-hall-4-booth-4-581/)[Meet DENX in Hall 4 Booth 4-581](https://www.denx.de/meet-denx-in-hall-4-booth-4-581/)
  2024-04-02
* [DENX gitlab reorganization](https://www.denx.de/denx-gitlab-reorganization/)
  2021-07-18
Contact info

* Location:
  Kirchenstr. 5, 82194 Gröbenzell - Germany
* Phone numbers:
  +49 8142 6 69 89 0
* E-mail:
  info@denx.de
Contact usName \*
E-mail \*
Message

 By using this form you agree with the storage and handling of your data by this website.

Submit

[![DENX Software Engineering](https://www.denx.de/wp-content/uploads/2021/07/logo-denx-icon-84x84-1.png)](https://www.denx.de/)
Copyright 2023 DENX Software Engineering

* [Imprint](/contact#Imprint)
* [News](https://www.denx.de/category/denx/)
* [Cookie Policy (EU)](https://www.denx.de/cookie-policy-eu/)

Navigation

Go to Top

Manage Cookie Consent

To provide the best experiences, we use technologies like cookies to store and/or access device information. Consenting to these technologies will allow us to process data such as browsing behavior or unique IDs on this site. Not consenting or withdrawing consent, may adversely affect certain features and functions.

Functional
Functional

Always active

The technical storage or access is strictly necessary for the legitimate purpose of enabling the use of a specific service explicitly requested by the subscriber or user, or for the sole purpose of carrying out the transmission of a communication over an electronic communications network.

Preferences
Preferences

The technical storage or access is necessary for the legitimate purpose of storing preferences that are not requested by the subscriber or user.

Statistics

Statistics

The technical storage or access that is used exclusively for statistical purposes.
The technical storage or access that is used exclusively for anonymous statistical purposes. Without a subpoena, voluntary compliance on the part of your Internet Service Provider, or additional records from a third party, information stored or retrieved for this purpose alone cannot usually be used to identify you.

Marketing

Marketing

The technical storage or access is required to create user profiles to send advertising, or to track the user on a website or across several websites for similar marketing purposes.

Manage options
Manage services
Manage vendors
[Read more about these purposes](https://cookiedatabase.org/tcf/purposes/)

Accept
Deny
View preferences
Save preferences
View preferences

{title}
{title}
{title}

Manage consent


