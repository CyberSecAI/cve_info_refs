=== Content from github.com_6d1e8696_20250114_190119.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fweb2py%2Fweb2py%2Fcommit%2Fd9805606f88f00c0be56438247605cefde73e14e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fweb2py%2Fweb2py%2Fcommit%2Fd9805606f88f00c0be56438247605cefde73e14e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=web2py%2Fweb2py)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[web2py](/web2py)
/
**[web2py](/web2py/web2py)**
Public

* [Notifications](/login?return_to=%2Fweb2py%2Fweb2py) You must be signed in to change notification settings
* [Fork
  904](/login?return_to=%2Fweb2py%2Fweb2py)
* [Star
   2.1k](/login?return_to=%2Fweb2py%2Fweb2py)

* [Code](/web2py/web2py)
* [Issues
  360](/web2py/web2py/issues)
* [Pull requests
  3](/web2py/web2py/pulls)
* [Actions](/web2py/web2py/actions)
* [Projects
  0](/web2py/web2py/projects)
* [Wiki](/web2py/web2py/wiki)
* [Security](/web2py/web2py/security)
* [Insights](/web2py/web2py/pulse)

Additional navigation options

* [Code](/web2py/web2py)
* [Issues](/web2py/web2py/issues)
* [Pull requests](/web2py/web2py/pulls)
* [Actions](/web2py/web2py/actions)
* [Projects](/web2py/web2py/projects)
* [Wiki](/web2py/web2py/wiki)
* [Security](/web2py/web2py/security)
* [Insights](/web2py/web2py/pulse)

## Commit

[Permalink](/web2py/web2py/commit/d9805606f88f00c0be56438247605cefde73e14e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

improved open redirect prevention

[Browse files](/web2py/web2py/tree/d9805606f88f00c0be56438247605cefde73e14e)
Browse the repository at this point in the history

* Loading branch information

[![@mdipierro](https://avatars.githubusercontent.com/u/965839?s=40&v=4)](/mdipierro)

[mdipierro](/web2py/web2py/commits?author=mdipierro "View all commits by mdipierro")
committed
May 30, 2022

1 parent
[9863a93](/web2py/web2py/commit/9863a9386050f9b3ef3ff83ebbea2add3ec09386)

commit d980560

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**345 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* gluon

  + gluon/digest.py
    [digest.py](#diff-8f5d22f9740cf0f7ad69b889535d270c74067e7a5048678847b891cec21c41c7)
  + gluon/form.py
    [form.py](#diff-511017605d5511de1818f7a81f03df8f89f2c7b998e21e744a8099b69e4b3d82)
  + packages

    - gluon/packages/dal
      [dal](#diff-b4faf3b61a6c7887cd7fc694d40f15e8d2766a2022abdd614779fc62800999ce)
  + tests

    - gluon/tests/test\_tools.py
      [test\_tools.py](#diff-5a935ab687446793dd1feacc6131387dff4901cd9b0cf283846f2cc6f93cf766)
  + gluon/tools.py
    [tools.py](#diff-c1d01f37ee54d813815718760b9c4d7b274e2be7ad18f65552cd564336ab593b)

## There are no files selected for viewing

62 changes: 62 additions & 0 deletions

62
[gluon/digest.py](#diff-8f5d22f9740cf0f7ad69b889535d270c74067e7a5048678847b891cec21c41c7 "gluon/digest.py")

Show comments

[View file](/web2py/web2py/blob/d9805606f88f00c0be56438247605cefde73e14e/gluon/digest.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,62 @@ |
|  |  | #!/usr/bin/env python |
|  |  | # -\*- coding: utf-8 -\*- |
|  |  |  |
|  |  | """ |
|  |  | | This file is part of the web2py Web Framework |
|  |  | | Copyrighted by Massimo Di Pierro <mdipierro@cs.depaul.edu> |
|  |  | | License: LGPLv3 (http://www.gnu.org/licenses/lgpl.html) |
|  |  |  |
|  |  | This file specifically includes utilities for security. |
|  |  | -------------------------------------------------------- |
|  |  | """ |
|  |  |  |
|  |  | import hashlib |
|  |  | import hmac |
|  |  | from gluon.\_compat import basestring, pickle, PY2, xrange, to\_bytes, to\_native |
|  |  |  |
|  |  | def pbkdf2\_hex(data, salt, iterations=1000, keylen=24, hashfunc=None): |
|  |  | hashfunc = hashfunc or sha1 |
|  |  | hmac = hashlib.pbkdf2\_hmac(hashfunc().name, to\_bytes(data), |
|  |  | to\_bytes(salt), iterations, keylen) |
|  |  | return binascii.hexlify(hmac) |
|  |  |  |
|  |  |  |
|  |  | def simple\_hash(text, key='', salt='', digest\_alg='md5'): |
|  |  | """Generate hash with the given text using the specified digest algorithm.""" |
|  |  | text = to\_bytes(text) |
|  |  | key = to\_bytes(key) |
|  |  | salt = to\_bytes(salt) |
|  |  | if not digest\_alg: |
|  |  | raise RuntimeError("simple\_hash with digest\_alg=None") |
|  |  | elif not isinstance(digest\_alg, str): # manual approach |
|  |  | h = digest\_alg(text + key + salt) |
|  |  | elif digest\_alg.startswith('pbkdf2'): # latest and coolest! |
|  |  | iterations, keylen, alg = digest\_alg[7:-1].split(',') |
|  |  | return to\_native(pbkdf2\_hex(text, salt, int(iterations), |
|  |  | int(keylen), get\_digest(alg))) |
|  |  | elif key: # use hmac |
|  |  | digest\_alg = get\_digest(digest\_alg) |
|  |  | h = hmac.new(key + salt, text, digest\_alg) |
|  |  | else: # compatible with third party systems |
|  |  | h = get\_digest(digest\_alg)() |
|  |  | h.update(text + salt) |
|  |  | return h.hexdigest() |
|  |  |  |
|  |  |  |
|  |  | def get\_digest(value): |
|  |  | """Return a hashlib digest algorithm from a string.""" |
|  |  | if isinstance(value, str): |
|  |  | value = value.lower() |
|  |  | if value not in ('md5', 'sha1', 'sha224', 'sha256', 'sha384', 'sha512'): |
|  |  | raise ValueError("Invalid digest algorithm: %s" % value) |
|  |  | value = getattr(hashlib, value) |
|  |  | return value |
|  |  |  |
|  |  | DIGEST\_ALG\_BY\_SIZE = { |
|  |  | 128 // 4: 'md5', |
|  |  | 160 // 4: 'sha1', |
|  |  | 224 // 4: 'sha224', |
|  |  | 256 // 4: 'sha256', |
|  |  | 384 // 4: 'sha384', |
|  |  | 512 // 4: 'sha512', |
|  |  | } |

228 changes: 228 additions & 0 deletions

228
[gluon/form.py](#diff-511017605d5511de1818f7a81f03df8f89f2c7b998e21e744a8099b69e4b3d82 "gluon/form.py")

Show comments

[View file](/web2py/web2py/blob/d9805606f88f00c0be56438247605cefde73e14e/gluon/form.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,228 @@ |
|  |  | from gluon.dal import DAL |
|  |  | from gluon.storage import Storage |
|  |  | from gluon.utils import web2py\_uuid |
|  |  | try: |
|  |  | # web3py |
|  |  | from gluon.current import current |
|  |  | from gluon.url import URL |
|  |  | from gluon.helpers import \* |
|  |  | except: |
|  |  | # web2py |
|  |  | from gluon import current |
|  |  | from gluon.html import \* |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | def FormStyleDefault(table, vars, errors, readonly, deletable): |
|  |  |  |
|  |  | form = FORM(TABLE(),\_method='POST',\_action='#',\_enctype='multipart/form-data') |
|  |  | for field in table: |
|  |  |  |
|  |  | input\_id = '%s\_%s' % (field.tablename, field.name) |
|  |  | value = field.formatter(vars.get(field.name)) |
|  |  | error = errors.get(field.name) |
|  |  | field\_class = field.type.split()[0].replace(':','-') |
|  |  |  |
|  |  | if field.type == 'blob': # never display blobs (mistake?) |
|  |  | continue |
|  |  | elif readonly or field.type=='id': |
|  |  | if not field.readable: |
|  |  | continue |
|  |  | else: |
|  |  | control = field.represent and field.represent(value) or value or '' |
|  |  | elif not field.writable: |
|  |  | continue |
|  |  | elif field.widget: |
|  |  | control = field.widget(table, value) |
|  |  | elif field.type == 'text': |
|  |  | control = TEXTAREA(value or '', \_id=input\_id,\_name=field.name) |
|  |  | elif field.type == 'boolean': |
|  |  | control = INPUT(\_type='checkbox', \_id=input\_id, \_name=field.name, |
|  |  | \_value='ON', \_checked = value) |
|  |  | elif field.type == 'upload': |
|  |  | control = DIV(INPUT(\_type='file', \_id=input\_id, \_name=field.name)) |
|  |  | if value: |
|  |  | control.append(A('download', |
|  |  | \_href=URL('default','download',args=value))) |
|  |  | control.append(INPUT(\_type='checkbox',\_value='ON', |
|  |  | \_name='\_delete\_'+field.name)) |
|  |  | control.append('(check to remove)') |
|  |  | elif hasattr(field.requires, 'options'): |
|  |  | multiple = field.type.startswith('list:') |
|  |  | value = value if isinstance(value, list) else [value] |
|  |  | options = [OPTION(v,\_value=k,\_selected=(k in value)) |
|  |  | for k,v in field.requires.options()] |
|  |  | control = SELECT(\*options, \_id=input\_id, \_name=field.name, |
|  |  | \_multiple=multiple) |
|  |  | else: |
|  |  | field\_type = 'password' if field.type == 'password' else 'text' |
|  |  | control = INPUT(\_type=field\_type, \_id=input\_id, \_name=field.name, |
|  |  | \_value=value, \_class=field\_class) |
|  |  |  |
|  |  | form[0].append(TR(TD(LABEL(field.label,\_for=input\_id)), |
|  |  | TD(control,DIV(error,\_class='error') if error else ''), |
|  |  | TD(field.comment or ''))) |
|  |  |  |
|  |  | td = TD(INPUT(\_type='submit',\_value='Submit')) |
|  |  | if deletable: |
|  |  | td.append(INPUT(\_type='checkbox',\_value='ON',\_name='\_delete')) |
|  |  | td.append('(check to delete)') |
|  |  | form[0].append(TR(TD(),td,TD())) |
|  |  | return form |
|  |  |  |
|  |  | # ################################################################ |
|  |  | # Form object (replaced SQLFORM) |
|  |  | # ################################################################ |
|  |  |  |
|  |  | class Form(object): |
|  |  | """ |
|  |  | Usage in web2py controller: |
|  |  |  |
|  |  | def index(): |
|  |  | form = Form(db.thing, record=1) |
|  |  | if form.accepted: ... |
|  |  | elif form.errors: ... |
|  |  | else: ... |
|  |  | return dict(form=form) |
|  |  |  |
|  |  | Arguments: |
|  |  | - table: a DAL table or a list of fields (equivalent to old SQLFORM.factory) |
|  |  | - record: a DAL record or record id |
|  |  | - readonly: set to True to make a readonly form |
|  |  | - deletable: set to False to disallow deletion of record |
|  |  | - formstyle: a function that renders the form using helpers (FormStyleDefault) |
|  |  | - dbio: set to False to prevent any DB write |
|  |  | - keepvalues: (NOT IMPLEMENTED) |
|  |  | - formname: the optional name of this form |
|  |  | - csrf: set to False to disable CRSF protection |
|  |  | """ |
|  |  |  |
|  |  | def \_\_init\_\_(self, |
|  |  | table, |
|  |  | record=None, |
|  |  | readonly=False, |
|  |  | deletable=True, |
|  |  | formstyle=FormStyleDefault, |
|  |  | dbio=True, |
|  |  | keepvalues=False, |
|  |  | formname=False, |
|  |  | hidden=None, |
|  |  | csrf=True): |
|  |  |  |
|  |  | if isinstance(table, list): |
|  |  | dbio = False |
|  |  | # mimic a table from a list of fields without calling define\_table |
|  |  | formname = formname or 'none' |
|  |  | for field in table: field.tablename = getattr(field,'tablename',formname) |
|  |  |  |
|  |  | if isinstance(record, (int, long, basestring)): |
|  |  | record\_id = int(str(record)) |
|  |  | self.record = table[record\_id] |
|  |  | else: |
|  |  | self.record = record |
|  |  |  |
|  |  | self.table = table |
|  |  | self.readonly = readonly |
|  |  | self.deletable = deletable and not readonly and self.record |
|  |  | self.formstyle = formstyle |
|  |  | self.dbio = dbio |
|  |  | self.keepvalues = True if keepvalues or self.record else False |
|  |  | self.csrf = csrf |
|  |  | self.vars = Storage() |
|  |  | self.errors = Storage() |
|  |  | self.submitted = False |
|  |  | self.deleted = False |
|  |  | self.accepted = False |
|  |  | self.cached\_helper = False |
|  |  | self.formname = formname or table.\_tablename |
|  |  | self.hidden = hidden |
|  |  | self.formkey = None |
|  |  |  |
|  |  | request = current.request |
|  |  |  |
|  |  | if readonly or request.method=='GET': |
|  |  | if self.record: |
|  |  | self.vars = self.record |
|  |  | else: |
|  |  | post\_vars = request.post\_vars |
|  |  | print post\_vars |
|  |  | self.submitted = True |
|  |  | # check for CSRF |
|  |  | if csrf and self.formname in (current.session.\_formkeys or {}): |
|  |  | self.formkey = current.session.\_formkeys[self.formname] |
|  |  | # validate fields |
|  |  | if not csrf or post\_vars.\_formkey == self.formkey: |
|  |  | if not post\_vars.\_delete: |
|  |  | for field in self.table: |
|  |  | if field.writable: |
|  |  | value = post\_vars.get(field.name) |
|  |  | # FIX THIS deal with set\_self\_id before validate |
|  |  | (value, error) = field.validate(value) |
|  |  | if field.type == 'upload': |
|  |  | delete = post\_vars.get('\_delete\_'+field.name) |
|  |  | if value is not None and hasattr(value,'file'): |
|  |  | value = field.store(value.file, |
|  |  | value.filename, |
|  |  | field.uploadfolder) |
|  |  | elif self.record and not delete: |
|  |  | value = self.record.get(field.name) |
|  |  | else: |
|  |  | value = None |
|  |  | self.vars[field.name] = value |
|  |  | if error: |
|  |  | self.errors[field.name] = error |
|  |  | if self.record: |
|  |  | self.vars.id = self.record.id |
|  |  | if not self.errors: |
|  |  | self.accepted = True |
|  |  | if dbio: |
|  |  | self.update\_or\_insert() |
|  |  | elif dbio: |
|  |  | self.deleted = True |
|  |  | self.record.delete\_record() |
|  |  | # store key for future CSRF |
|  |  | if csrf: |
|  |  | session = current.session |
|  |  | if not session.\_formkeys: |
|  |  | session.\_formkeys = {} |
|  |  | if self.formname not in current.session.\_formkeys: |
|  |  | session.\_formkeys[self.formname] = web2py\_uuid() |
|  |  | self.formkey = session.\_formkeys[self.formname] |
|  |  |  |
|  |  | def update\_or\_insert(self): |
|  |  | if self.record: |
|  |  | self.record.update\_record(\*\*self.vars) |
|  |  | else: |
|  |  | # warning, should we really insert if record |
|  |  | self.vars.id = self.table.insert(\*\*self.vars) |
|  |  |  |
|  |  | def clear(): |
|  |  | self.vars.clear() |
|  |  | self.errors.clear() |
|  |  | for field in self.table: |
|  |  | self.vars[field.name] = field.default |
|  |  |  |
|  |  | def helper(self): |
|  |  | if not self.cached\_helper: |
|  |  | cached\_helper = self.formstyle(self.table, |
|  |  | self.vars, |
|  |  | self.errors, |
|  |  | self.readonly, |
|  |  | self.deletable) |
|  |  | if self.csrf: |
|  |  | cached\_helper.append(INPUT(\_type='hidden',\_name='\_formkey', |
|  |  | \_value=self.formkey)) |
|  |  | for key in self.hidden or {}: |
|  |  | cached\_helper.append(INPUT(\_type='hidden',\_name=key, |
|  |  | \_value=self.hidden[key])) |
|  |  | self.cached\_helper = cached\_helper |
|  |  | return cached\_helper |
|  |  |  |
|  |  | def xml(self): |
|  |  | return self.helper().xml() |
|  |  |  |
|  |  | def \_\_unicode\_\_(self): |
|  |  | return self.xml() |
|  |  |  |
|  |  | def \_\_str\_\_(self): |
|  |  | return self.xml().encode('utf8') |

2 changes: 1 addition & 1 deletion

2
[gluon/packages/dal](#diff-b4faf3b61a6c7887cd7fc694d40f15e8d2766a2022abdd614779fc62800999ce "gluon/packages/dal")

Show comments

Submodule [dal](https://github.com/web2py/pydal)
updated
[16 files](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b)

| +0  −17 |  | [pydal/\_gae.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-910dde3ebb4a5d4fbbce8dd15f6c854817123513dcc7da002d7d29b3049d4896) |
| --- | --- | --- |
| +4  −4 |  | [pydal/adapters/\_\_init\_\_.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-bf72b8768467c07621b929acfff477a5bea2c66365b31ffadfd56720622fc62b) |
| +99  −272 |  | [pydal/adapters/google.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-721f36e6ba71a29128a3b5fe5cf6ee5f60c16e06e34cb17912ed6dbb2320a684) |
| +358  −0 |  | [pydal/adapters/ndb.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-ac7bba652270db50a8ee769352ae72ac41b2e2796b6664611163ccde1f581ca9) |
| +4  −5 |  | [pydal/dialects/\_\_init\_\_.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-ab6c31e2c36c0b5b3bab0c7c8adb365cecee8d904f9a51cd106c90cd15c43d9f) |
| +15  −162 |  | [pydal/dialects/google.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-ad4a76667705ebb7880a8d8c936cce56c49efaef7e217ac25cf83a1ddf9e7769) |
| +192  −0 |  | [pydal/dialects/ndb.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-2d85076d990c71a6316adabe847a5d4431339731d9261f64171b50b6faa742b9) |
| +9  −7 |  | [pydal/drivers.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-5e2e8a4833dfa1ee18339d92fa74073ec04e9019d823a8a42b963572b138941b) |
| +0  −36 |  | [pydal/helpers/gae.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-2235acded7a08816b26699586a5ab02f29c6b5692e66eab57d611ef4fc997a87) |
| +56  −0 |  | [pydal/ndb.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-d0bdfac4f5a317069e679ecd15cf536f231719178c3261faf8327f3de92b7a9d) |
| +1  −2 |  | [pydal/objects.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-99358b7a56b8908dba0bb73c0a5d8cbaa01bbd10ddf3db683ae1e01e8ecdbc64) |
| +4  −5 |  | [pydal/parsers/\_\_init\_\_.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-d15ca0073b470c70e9d7e1b6005860c75ae2f89e2ec80e43d31bedff852a2b5b) |
| +14  −0 |  | [pydal/parsers/ndb.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-78eeedd446b5728e906e010bef4c245dfd0f6a7bae54bee77c67edee11f8d70c) |
| +4  −4 |  | [pydal/representers/\_\_init\_\_.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-1af6d5a51780fa6b13963260afded0a357b48894410037de7697beb538e69976) |
| +45  −0 |  | [pydal/representers/ndb.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-df0d25fd2f7b316ae4ba59f2cc81d89cb4ee9cdd44da848ab511d1244c162c97) |
| +2  −3 |  | [pydal/validators.py](/web2py/pydal/compare/d7b24a9ecf0fd7e9c1ed2aa29e0d235105006774...09ace32a71cd45ac5195335fcc5c18676974072b#diff-68a42581a5f2cac3cad29373f130105483591e95eb3d34d24a0db494ecee65f5) |

34 changes: 33 additions & 1 deletion

34
[gluon/tests/test\_tools.py](#diff-5a935ab687446793dd1feacc6131387dff4901cd9b0cf283846f2cc6f93cf766 "gluon/tests/test_tools.py")

Show comments

[View file](/web2py/web2py/blob/d9805606f88f00c0be56438247605cefde73e14e/gluon/tests/test_tools.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,7 +17,7 @@ |
|  |  | from gluon.dal import DAL, Field |
|  |  | from pydal.objects import Table |
|  |  | from gluon import tools |
|  |  | from gluon.tools import Auth, Mail, Recaptcha2, prettydate, Expose |
|  |  | from gluon.tools import Auth, Mail, Recaptcha2, prettydate, Expose, prevent\_open\_redirect |
|  |  | from gluon.\_compat import PY2, to\_bytes |
|  |  | from gluon.globals import Request, Response, Session |
|  |  | from gluon.storage import Storage |
| Expand Down  Expand Up | | @@ -1380,3 +1380,35 @@ def test\_file\_not\_found(self): |
|  |  | def test\_not\_authorized(self): |
|  |  | with self.assertRaises(HTTP): |
|  |  | self.make\_expose(base='inside', show='link\_to\_file3') |
|  |  |  |
|  |  |  |
|  |  | class Test\_OpenRedirectPrevention(unittest.TestCase): |
|  |  |  |
|  |  | def test\_open\_redirect(self): |
|  |  | bad\_urls = [ |
|  |  | "/", |
|  |  | "//", |
|  |  | "~/", |
|  |  | "//example.com", |
|  |  | "/\example.com" |
|  |  | "~/example.com" |
|  |  | "//example.com/a/b/c", |
|  |  | "//example.com/a/b/c", |
|  |  | "~/example.com/a/b/c" |
|  |  | ] |
|  |  | good\_urls = [ |
|  |  | "a/b/c", |
|  |  | "/a", |
|  |  | "/a/b", |
|  |  | "/a/b/c", |
|  |  | ] |
|  |  | prefixes = ["", ":", "http:", "https:", "ftp:"] |
|  |  | for prefix in prefixes: |
|  |  | for url in bad\_urls: |
|  |  | self.assertEqual(prevent\_open\_redirect(prefix + url), None) |
|  |  | for prefix in prefixes: |
|  |  | for url in good\_urls: |
|  |  | self.assertEqual(prevent\_open\_redirect(prefix + url), prefix + url) |
|  |  |  |
|  |  |  |
|  |  |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d980560`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fweb2py%2Fweb2py%2Fcommit%2Fd9805606f88f00c0be56438247605cefde73e14e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jvn.jp_6aaa0c68_20250114_190121.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2022/06/23  Last Updated:2022/06/23
# JVN#02158640 web2py vulnerable to open redirect

## Overview

web2py contains an open redirect vulnerability.

## Products Affected

* web2py versions prior to 2.22.5

## Description

web2py contains an open redirect vulnerability ([CWE-601](//cwe.mitre.org/data/definitions/601.html)).

## Impact

When accessing a specially crafted URL, the user may be redirected to an arbitrary website. As a result, the user may become a victim of a phishing attack.

## Solution

**Update the Software**

Update the software to the latest version according to the information provided by the developer.

## Vendor Status

| Vendor | Link |
| --- | --- |
| web2py | [web2py Web Framework](http://web2py.com/) |
|  | [web2py improved open redirect prevention](https://github.com/web2py/web2py/commit/d9805606f88f00c0be56438247605cefde73e14e#diff-c1d01f37ee54d813815718760b9c4d7b274e2be7ad18f65552cd564336ab593bR110) |
|  | [web2py added validation of send attribute in admin](https://github.com/web2py/web2py/commit/a181b855a43cb8b479d276b082cfcde385768451) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

CVSS v3
CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:N/I:L/A:N
Base Score:
4.7

| Attack Vector(AV) | Physical (P) | Local (L) | Adjacent (A) | Network (N) |
| --- | --- | --- | --- | --- |
| Attack Complexity(AC) | High (H) | Low (L) |
| Privileges Required(PR) | High (H) | Low (L) | None (N) |
| User Interaction(UI) | Required (R) | None (N) |
| Scope(S) | Unchanged (U) | Changed (C) |
| Confidentiality Impact(C) | None (N) | Low (L) | High (H) |
| Integrity Impact(I) | None (N) | Low (L) | High (H) |
| Availability Impact(A) | None (N) | Low (L) | High (H) |

CVSS v2
AV:N/AC:H/Au:N/C:N/I:P/A:N
Base Score:
2.6

| Access Vector(AV) | Local (L) | Adjacent Network (A) | Network (N) |
| --- | --- | --- | --- |
| Access Complexity(AC) | High (H) | Medium (M) | Low (L) |
| Authentication(Au) | Multiple (M) | Single (S) | None (N) |
| Confidentiality Impact(C) | None (N) | Partial (P) | Complete (C) |
| Integrity Impact(I) | None (N) | Partial (P) | Complete (C) |
| Availability Impact(A) | None (N) | Partial (P) | Complete (C) |

## Credit

Yuji Tounai of Mitsui Bussan Secure Directions, Inc. reported this vulnerability to IPA.

JPCERT/CC coordinated with the developer under Information Security Early Warning Partnership.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2022-33146](https://www.cve.org/CVERecord?id=CVE-2022-33146) |
| JVN iPedia | [JVNDB-2022-000047](https://jvndb.jvn.jp/jvndb/JVNDB-2022-000047) |

* JVN
* [HOME](/en/index.html)
* [What is JVN ?](/en/nav/jvn.html)
* [Instructions](/en/nav/jvnhelp.html)
* [List of Vulnerability Report](/en/report/index.html)
* [VN\_JP](/en/jp/index.html)
* [VN\_JP(Unreachable)](/en/adj/index.html)
* [VN\_VU](/en/vu/index.html)
* [TA](/en/ta/index.html)
* [TRnotes](/en/tr/index.html)
* [JVN iPedia](http://jvndb.jvn.jp/en/)
* [MyJVN](http://jvndb.jvn.jp/en/apis/myjvn/index.html)
* [JVNJS/RSS](/en/rss/index.html)
* [Vendor List](/en/nav/index.html)
* [List of unreachable developers](/en/reply/index.html)
* [Contact](/en/contact/index.html)

Copyright (c) 2000-2022 JPCERT/CC and IPA. All rights reserved.



=== Content from web2py.com_f7c27a05_20250114_190116.html ===


* [Home](/init/default/index)
* [About](/init/default/what)
* [Download](/init/default/download)
* [Docs & Resources](/init/default/documentation)
* [Support](/init/default/support)
* [Contributors](/init/default/who)

web2py 2.27.1 is the last version of web2py supporting python 2.7

Future versions of web2py will require 3.9 or greater.

While we will continue some limited support for web2py, for future development, we no longer recommend it. We strongly recommend instead web2py's successor: [py4web](https://py4web.com). It is smaller and 10x faster. It uses the same pydal and the same templates as web2py. It includes better Auth, Form, and Grid. Porting web2py apps to py4web is easy. Ask for help on the [py4web google group](https://groups.google.com/g/py4web).

### Web Framework

Free open source full-stack framework for rapid development of fast, scalable, [secure](http://www.web2py.com/book/default/chapter/01#Security) and portable database-driven web-based applications. Written and programmable in [Python](http://www.python.org) (version 3 and 2.7).

|  |  |  |
| --- | --- | --- |

Current version: [3.0.11-stable+timestamp.2024.12.28.14.24.26 ([LGPLv3 License](http://www.gnu.org/licenses/lgpl.html))](/init/default/download)

[![](/init/static/images/infoworld2012.jpeg)](http://www.infoworld.com/slideshow/24605/infoworlds-2012-technology-of-the-year-award-winners-183313#slide23)
[Download Now](/init/default/download)
[Quick Examples](/init/default/examples)
[Try it now online](https://www.pythonanywhere.com/try-web2py)
[Sites Powered by web2py](http://web2py.com/poweredby)

##### [Batteries Included](/init/default/what)

Everything you need in one package including fast multi-threaded web server, SQL database and web-based interface. No third party dependencies but works with [third party tools](/init/default/what).

##### [Web-Based IDE](http://web2py.com/demo_admin)

Create, modify, deploy and manage application from anywhere using your browser. One web2py instance can run multiple web sites using different databases. Try the [interactive demo](http://www.web2py.com/demo_admin).

##### [Extensive Docs](/init/default/documentation)

Start with some [quick examples](/init/default/examples), then read the [manual](http://www.web2py.com/book) and the [Sphinx docs](http://web2py.readthedocs.org/en/latest/), watch [videos](http://vimeo.com/album/178500), and join a [user group](/init/default/usergroups) for discussion. Take advantage of the [layouts](http://www.web2py.com/layouts), [plugins](http://www.web2pyslices.com/home?content_type=Package), [appliances](http://www.web2py.com/appliances), and [recipes](http://web2pyslices.com).

Copyright @ 2016 - Powered by Web2py



=== Content from github.com_a3ffb06c_20250114_190117.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fweb2py%2Fweb2py%2Fcommit%2Fa181b855a43cb8b479d276b082cfcde385768451)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fweb2py%2Fweb2py%2Fcommit%2Fa181b855a43cb8b479d276b082cfcde385768451)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=web2py%2Fweb2py)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[web2py](/web2py)
/
**[web2py](/web2py/web2py)**
Public

* [Notifications](/login?return_to=%2Fweb2py%2Fweb2py) You must be signed in to change notification settings
* [Fork
  904](/login?return_to=%2Fweb2py%2Fweb2py)
* [Star
   2.1k](/login?return_to=%2Fweb2py%2Fweb2py)

* [Code](/web2py/web2py)
* [Issues
  360](/web2py/web2py/issues)
* [Pull requests
  3](/web2py/web2py/pulls)
* [Actions](/web2py/web2py/actions)
* [Projects
  0](/web2py/web2py/projects)
* [Wiki](/web2py/web2py/wiki)
* [Security](/web2py/web2py/security)
* [Insights](/web2py/web2py/pulse)

Additional navigation options

* [Code](/web2py/web2py)
* [Issues](/web2py/web2py/issues)
* [Pull requests](/web2py/web2py/pulls)
* [Actions](/web2py/web2py/actions)
* [Projects](/web2py/web2py/projects)
* [Wiki](/web2py/web2py/wiki)
* [Security](/web2py/web2py/security)
* [Insights](/web2py/web2py/pulse)

## Commit

[Permalink](/web2py/web2py/commit/a181b855a43cb8b479d276b082cfcde385768451)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

added validation of send attribute in admin

[Browse files](/web2py/web2py/tree/a181b855a43cb8b479d276b082cfcde385768451)
Browse the repository at this point in the history

* Loading branch information

[![@mdipierro](https://avatars.githubusercontent.com/u/965839?s=40&v=4)](/mdipierro)

[mdipierro](/web2py/web2py/commits?author=mdipierro "View all commits by mdipierro")
committed
Jun 4, 2022

1 parent
[842994d](/web2py/web2py/commit/842994def40ca565aa954a13aa065d2da1090948)

commit a181b85

Showing
**1 changed file**
with
**2 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[applications/admin/controllers/default.py](#diff-155b2f1babb867a1895319a2be6afe866f8190a1569a3eb12f2bc0971588021f "applications/admin/controllers/default.py")

Show comments

[View file](/web2py/web2py/blob/a181b855a43cb8b479d276b082cfcde385768451/applications/admin/controllers/default.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,7 +12,7 @@ |
|  |  | from gluon.admin import \* |
|  |  | from gluon.fileutils import abspath, read\_file, write\_file |
|  |  | from gluon.utils import web2py\_uuid |
|  |  | from gluon.tools import Config |
|  |  | from gluon.tools import Config, prevent\_open\_redirect |
|  |  | from gluon.compileapp import find\_exposed\_functions |
|  |  | from glob import glob |
|  |  | from gluon.\_compat import iteritems, PY2, pickle, xrange, urlopen, to\_bytes, StringIO, to\_native, reload |
| Expand Down  Expand Up | | @@ -118,7 +118,7 @@ def get\_app(name=None): |
|  |  | def index(): |
|  |  | """ Index handler """ |
|  |  |  |
|  |  | send = request.vars.send |
|  |  | send = prevent\_open\_redirect(request.vars.send) |
|  |  | if DEMO\_MODE: |
|  |  | session.authorized = True |
|  |  | session.last\_time = t0 |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a181b85`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fweb2py%2Fweb2py%2Fcommit%2Fa181b855a43cb8b479d276b082cfcde385768451) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


