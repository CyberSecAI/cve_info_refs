=== Content from github.com_ea20046e_20250114_183625.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F3a754740d5414e362512ee981eefba41561a63a6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F3a754740d5414e362512ee981eefba41561a63a6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Commit

[Permalink](/tensorflow/tensorflow/commit/3a754740d5414e362512ee981eefba41561a63a6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[tfg] Fix null type attribute

[Browse files](/tensorflow/tensorflow/tree/3a754740d5414e362512ee981eefba41561a63a6)
Browse the repository at this point in the history

```
Type attributes can be null and the input should be `dyn_cast_or_null`.

PiperOrigin-RevId: 449889247
```

* Loading branch information

[![@tensorflower-gardener](https://avatars.githubusercontent.com/u/17151892?s=40&v=4)](/tensorflower-gardener)

[tensorflower-gardener](/tensorflow/tensorflow/commits?author=tensorflower-gardener "View all commits by tensorflower-gardener")
committed
May 20, 2022

1 parent
[4b04497](/tensorflow/tensorflow/commit/4b044975249523ec3c7f3174627e40b557e21569)

commit 3a75474

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**26 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tensorflow/core/ir/importexport

  + tensorflow/core/ir/importexport/graphdef\_import.cc
    [graphdef\_import.cc](#diff-1da289a4109310b3776f5d4e4109a383aea5457e611c6171f88255f69facf4df)
  + tests/graphdef\_to\_mlir

    - tensorflow/core/ir/importexport/tests/graphdef\_to\_mlir/invalid\_backedge\_input\_size.pbtxt
      [invalid\_backedge\_input\_size.pbtxt](#diff-2576bbd3501a867e4c9f760e5e61b44ad03e8cf2db31c0fa20ac251bd3cbbb46)

## There are no files selected for viewing

8 changes: 5 additions & 3 deletions

8
[tensorflow/core/ir/importexport/graphdef\_import.cc](#diff-1da289a4109310b3776f5d4e4109a383aea5457e611c6171f88255f69facf4df "tensorflow/core/ir/importexport/graphdef_import.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/3a754740d5414e362512ee981eefba41561a63a6/tensorflow/core/ir/importexport/graphdef_import.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -699,7 +699,8 @@ StatusOr<unsigned> GraphDefImporter::ArgNumType(const NamedAttrList &attrs, |
|  |  | SmallVectorImpl<Type> &types) { |
|  |  | // Check whether a type list attribute is specified. |
|  |  | if (!arg\_def.type\_list\_attr().empty()) { |
|  |  | if (auto v = attrs.get(arg\_def.type\_list\_attr()).dyn\_cast<ArrayAttr>()) { |
|  |  | if (auto v = |
|  |  | attrs.get(arg\_def.type\_list\_attr()).dyn\_cast\_or\_null<ArrayAttr>()) { |
|  |  | for (Attribute attr : v) { |
|  |  | if (auto dtype = attr.dyn\_cast<TypeAttr>()) { |
|  |  | types.push\_back(UnrankedTensorType::get(dtype.getValue())); |
| Expand All | | @@ -716,7 +717,8 @@ StatusOr<unsigned> GraphDefImporter::ArgNumType(const NamedAttrList &attrs, |
|  |  | unsigned num = 1; |
|  |  | // Check whether a number attribute is specified. |
|  |  | if (!arg\_def.number\_attr().empty()) { |
|  |  | if (auto v = attrs.get(arg\_def.number\_attr()).dyn\_cast<IntegerAttr>()) { |
|  |  | if (auto v = |
|  |  | attrs.get(arg\_def.number\_attr()).dyn\_cast\_or\_null<IntegerAttr>()) { |
|  |  | num = v.getValue().getZExtValue(); |
|  |  | } else { |
|  |  | return NotFound("Type attr not found: ", arg\_def.number\_attr()); |
| Expand All | | @@ -731,7 +733,7 @@ StatusOr<unsigned> GraphDefImporter::ArgNumType(const NamedAttrList &attrs, |
|  |  | return InvalidArgument("Arg '", arg\_def.name(), |
|  |  | "' has invalid type and no type attribute"); |
|  |  | } else { |
|  |  | if (auto v = attrs.get(arg\_def.type\_attr()).dyn\_cast<TypeAttr>()) { |
|  |  | if (auto v = attrs.get(arg\_def.type\_attr()).dyn\_cast\_or\_null<TypeAttr>()) { |
|  |  | dtype = v.getValue(); |
|  |  | } else { |
|  |  | return NotFound("Type attr not found: ", arg\_def.type\_attr()); |
| Expand Down | |  |

21 changes: 21 additions & 0 deletions

21
[tensorflow/core/ir/importexport/tests/graphdef\_to\_mlir/invalid\_backedge\_input\_size.pbtxt](#diff-2576bbd3501a867e4c9f760e5e61b44ad03e8cf2db31c0fa20ac251bd3cbbb46 "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_backedge_input_size.pbtxt")

Show comments

[View file](/tensorflow/tensorflow/blob/3a754740d5414e362512ee981eefba41561a63a6/tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_backedge_input_size.pbtxt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,21 @@ |
|  |  | # RUN: not tfg-translate -graphdef-to-mlir %s 2>&1 | FileCheck %s |
|  |  |  |
|  |  | # CHECK: Type attr not found |
|  |  |  |
|  |  | library { |
|  |  | function { |
|  |  | signature { |
|  |  | name: "\344\264\264" |
|  |  | description: "value" |
|  |  | is\_distributed\_communication: true |
|  |  | } |
|  |  | node\_def { |
|  |  | op: "Const" |
|  |  | input: "|" |
|  |  | } |
|  |  | control\_ret { |
|  |  | key: "" |
|  |  | value: "" |
|  |  | } |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3a75474`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F3a754740d5414e362512ee981eefba41561a63a6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_eb43f192_20250114_183626.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fsecurity%2Fadvisories%2FGHSA-7j3m-8g3c-9qqq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fsecurity%2Fadvisories%2FGHSA-7j3m-8g3c-9qqq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

# Null-dereference in `mlir::tfg::TFOp::nameAttr`

Low

[pak-laura](/pak-laura)
published
GHSA-7j3m-8g3c-9qqq
Sep 15, 2022

## Package

pip

tensorflow, tensorflow-cpu, tensorflow-gpu
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 2.10.0

## Patched versions

2.7.4, 2.8.3, 2.9.2, 2.10.0

## Description

### Impact

When [`mlir::tfg::TFOp::nameAttr`](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/ir/importexport/graphdef_import.cc) receives null type list attributes, it crashes.

```
StatusOr<unsigned> GraphDefImporter::ArgNumType(const NamedAttrList &attrs,
                                                const OpDef::ArgDef &arg_def,
                                                SmallVectorImpl<Type> &types) {
  // Check whether a type list attribute is specified.
  if (!arg_def.type_list_attr().empty()) {
    if (auto v = attrs.get(arg_def.type_list_attr()).dyn_cast<ArrayAttr>()) {
      for (Attribute attr : v) {
        if (auto dtype = attr.dyn_cast<TypeAttr>()) {
          types.push_back(UnrankedTensorType::get(dtype.getValue()));
        } else {
          return InvalidArgument("Expected '", arg_def.type_list_attr(),
                                 "' to be a list of types");
        }
      }
      return v.size();
    }
    return NotFound("Type attr not found: ", arg_def.type_list_attr());
  }

  unsigned num = 1;
  // Check whether a number attribute is specified.
  if (!arg_def.number_attr().empty()) {
    if (auto v = attrs.get(arg_def.number_attr()).dyn_cast<IntegerAttr>()) {
      num = v.getValue().getZExtValue();
    } else {
      return NotFound("Type attr not found: ", arg_def.number_attr());
    }
  }

  // Check for a type or type attribute.
  Type dtype;
  if (arg_def.type() != DataType::DT_INVALID) {
    TF_RETURN_IF_ERROR(ConvertDataType(arg_def.type(), b_, &dtype));
  } else if (arg_def.type_attr().empty()) {
    return InvalidArgument("Arg '", arg_def.name(),
                           "' has invalid type and no type attribute");
  } else {
    if (auto v = attrs.get(arg_def.type_attr()).dyn_cast<TypeAttr>()) {
      dtype = v.getValue();
    } else {
      return NotFound("Type attr not found: ", arg_def.type_attr());
    }
  }
  types.append(num, UnrankedTensorType::get(dtype));
  return num;
}
```
### Patches

We have patched the issue in GitHub commits [3a754740d5414e362512ee981eefba41561a63a6](https://github.com/tensorflow/tensorflow/commit/3a754740d5414e362512ee981eefba41561a63a6) and [a0f0b9a21c9270930457095092f558fbad4c03e5](https://github.com/tensorflow/tensorflow/commit/a0f0b9a21c9270930457095092f558fbad4c03e5).

The fix will be included in TensorFlow 2.10.0. We will also cherrypick this commit on TensorFlow 2.9.1, TensorFlow 2.8.1, and TensorFlow 2.7.2, as these are also affected and still in supported range.

### For more information

Please consult [our security guide](https://github.com/tensorflow/tensorflow/blob/master/SECURITY.md) for more information regarding the security model and how to contact us with issues and questions.

### Severity

Low

### CVE ID

CVE-2022-36014

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4ccf081c_20250114_183624.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fblob%2Fmaster%2Ftensorflow%2Fcore%2Fir%2Fimportexport%2Fgraphdef_import.cc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fblob%2Fmaster%2Ftensorflow%2Fcore%2Fir%2Fimportexport%2Fgraphdef_import.cc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Files

 master
## Breadcrumbs

1. [tensorflow](/tensorflow/tensorflow/tree/master)
2. /[tensorflow](/tensorflow/tensorflow/tree/master/tensorflow)
3. /[core](/tensorflow/tensorflow/tree/master/tensorflow/core)
4. /[ir](/tensorflow/tensorflow/tree/master/tensorflow/core/ir)
5. /[importexport](/tensorflow/tensorflow/tree/master/tensorflow/core/ir/importexport)
/
# graphdef\_import.cc

Copy path Blame  Blame
## Latest commit

## History

[History](/tensorflow/tensorflow/commits/master/tensorflow/core/ir/importexport/graphdef_import.cc)939 lines (847 loc) · 36 KB master
## Breadcrumbs

1. [tensorflow](/tensorflow/tensorflow/tree/master)
2. /[tensorflow](/tensorflow/tensorflow/tree/master/tensorflow)
3. /[core](/tensorflow/tensorflow/tree/master/tensorflow/core)
4. /[ir](/tensorflow/tensorflow/tree/master/tensorflow/core/ir)
5. /[importexport](/tensorflow/tensorflow/tree/master/tensorflow/core/ir/importexport)
/
# graphdef\_import.cc

Top
## File metadata and controls

* Code
* Blame

939 lines (847 loc) · 36 KB[Raw](https://github.com/tensorflow/tensorflow/raw/refs/heads/master/tensorflow/core/ir/importexport/graphdef_import.cc)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939/\* Copyright 2022 The TensorFlow Authors. All Rights Reserved.
Licensed under the Apache License, Version 2.0 (the "License");you may not use this file except in compliance with the License.You may obtain a copy of the License at
 http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an "AS IS" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.==============================================================================\*/
#include "tensorflow/core/ir/importexport/graphdef\_import.h"
#include <iterator>#include <memory>#include <string>#include <tuple>#include <utility>#include <vector>
#include "absl/container/flat\_hash\_map.h"#include "llvm/ADT/STLExtras.h"#include "llvm/ADT/ScopeExit.h"#include "llvm/Support/raw\_ostream.h"#include "mlir/IR/Builders.h" // from @llvm-project#include "mlir/IR/BuiltinAttributes.h" // from @llvm-project#include "mlir/IR/BuiltinOps.h" // from @llvm-project#include "mlir/IR/BuiltinTypes.h" // from @llvm-project#include "mlir/IR/Location.h" // from @llvm-project#include "mlir/IR/MLIRContext.h" // from @llvm-project#include "mlir/IR/OperationSupport.h" // from @llvm-project#include "mlir/IR/OwningOpRef.h" // from @llvm-project#include "mlir/IR/Threading.h" // from @llvm-project#include "mlir/Support/LLVM.h" // from @llvm-project#include "mlir/Support/LogicalResult.h" // from @llvm-project#include "tensorflow/core/framework/full\_type.pb.h"#include "tensorflow/core/framework/function.h"#include "tensorflow/core/framework/function.pb.h"#include "tensorflow/core/framework/graph.pb.h"#include "tensorflow/core/framework/graph\_debug\_info.pb.h"#include "tensorflow/core/framework/node\_def.pb.h"#include "tensorflow/core/framework/node\_def\_util.h"#include "tensorflow/core/framework/op.h"#include "tensorflow/core/framework/op\_def.pb.h"#include "tensorflow/core/framework/op\_def\_builder.h"#include "tensorflow/core/framework/versions.pb.h"#include "tensorflow/core/graph/graph.h"#include "tensorflow/core/graph/graph\_debug\_info\_builder.h"#include "tensorflow/core/graph/tensor\_id.h"#include "tensorflow/core/ir/dialect.h"#include "tensorflow/core/ir/importexport/convert\_attributes.h"#include "tensorflow/core/ir/importexport/convert\_types.h"#include "tensorflow/core/ir/importexport/functiondef\_import.h"#include "tensorflow/core/ir/ops.h"#include "tensorflow/core/ir/types/dialect.h"#include "tensorflow/core/platform/errors.h"#include "tensorflow/core/platform/statusor.h"#include "tensorflow/core/platform/stringpiece.h"
using tensorflow::DataType;using tensorflow::DataTypeVector;using tensorflow::FullTypeDef;using tensorflow::FunctionDef;using tensorflow::FunctionLibraryDefinition;using tensorflow::Graph;using tensorflow::GraphDebugInfo;using tensorflow::GraphDef;using tensorflow::NodeDef;using tensorflow::OpDef;using tensorflow::OpRegistrationData;using tensorflow::OpRegistry;using tensorflow::StackTracesMap;using tensorflow::Status;using tensorflow::StatusOr;using tensorflow::StringPiece;using tensorflow::TensorId;using tensorflow::VersionDef;using tensorflow::errors::InvalidArgument;using tensorflow::errors::NotFound;
namespace mlir {namespace tfg {namespace {// This class implements an importer for GraphDef directly to TFG.class GraphDefImporter { public: // Initialize the importer. GraphDefImporter(TFGraphDialect \*dialect, const OpRegistry &registry, const GraphDebugInfo &debug\_info) : ctx\_(dialect->getContext()), dialect\_(dialect), b\_(ctx\_), registry\_(registry), debug\_info\_(debug\_info), unknown\_loc\_(UnknownLoc::get(ctx\_)), placeholder\_state\_(unknown\_loc\_, "tfg.\_mlir\_placeholder") { placeholder\_state\_.addTypes(dialect\_->getControlType()); stack\_traces\_ = LoadTracesFromDebugInfo(debug\_info); }
 // Convert a GraphDef to MLIR module. absl::StatusOr<OwningOpRef<ModuleOp>> ConvertGraphDef(const GraphDef &graph);
 private: // Convert a function. This function must be thread-safe. Status ConvertFunctionDef( GraphFuncOp func\_op, const absl::flat\_hash\_map<StringPiece, StringPiece> &gradient\_map, const FunctionDef &function);
 // A result ID representing an output of `node`. E.g. // "foo" -> {0, "foo", ""} // "foo:2" -> {2, "foo", ""} // "foo:output:0" -> {0, "foo", "output"} struct ResultId { // The result or result segment index. int index; // The name of the parent node. StringRef node; // An optional result segment name. StringRef output;
 // Returns true if the result ID references the control token. bool IsControl() const { return index == tensorflow::Graph::kControlSlot; } };
 // An unresolved backedge. struct Backedge { // The edge name and index. ResultId id; // The OpOperand to resolve; OpOperand \*operand; };
 // Cached info about the result of an operation. struct ResultInfo { // This flag is true if the results of the operation have been resolved; the // operation has been created and its `data` and `control` results have been // populated. If false, the placeholder should be used. bool resolved = false; // The control result. Value control; // All data results. ValueRange data; // Data results organized by output name. absl::flat\_hash\_map<StringPiece, ValueRange> outputs; // A list of unresolved backedges. std::vector<Backedge> backedges; };
 // State when converting a list of nodes. class ConversionState : public absl::flat\_hash\_map<StringPiece, std::unique\_ptr<ResultInfo>> { public: // Create a conversion state with a placeholder value. Put the plaecholder // in the block so that it is owned. explicit ConversionState(Block \*block, const OperationState &placeholder\_state) : placeholder\_op\_( OpBuilder::atBlockBegin(block).create(placeholder\_state)), placeholder\_(placeholder\_op\_->getResult(0)) {}
 // Get the placeholder value. Value GetPlaceholder() { return placeholder\_; }
 // Finalize the conversion. The placeholder is destroyed. void Finalize() { placeholder\_op\_->erase(); }
 private: // The placeholder operation. Operation \*placeholder\_op\_; // The placeholder value. Value placeholder\_; }; // Convert a list a nodes to operations. Status ConvertNodes( OpBuilder &builder, ConversionState &s, const tensorflow::protobuf::RepeatedPtrField<NodeDef> &nodes, Block \*block); // Convert a node to an operation. Status ConvertNodeDef(OpBuilder &builder, ConversionState &s, const NodeDef &node); // Resolve a data result reference. static absl::StatusOr<Value> ResolveDataResult(const ResultId &id, ResultInfo \*info);
 // Get a named result. struct Result { Value control; Value data; ResultId id; ResultInfo \*info = nullptr; }; absl::StatusOr<Result> GetResult(ConversionState &s, StringPiece name);
 // Convert TF datatypes to unranked MLIR tensor types. Status ConvertDataTypesToUnrankedTensorTypes(const DataTypeVector &dtypes, SmallVectorImpl<Type> &results); // Extracts the actual data types from `attrs` based on its definition in // `arg\_def` and converts them to unranked tensors. Returns the number of // added types. // // TODO(jeffniu): This is a re-implementation of `ArgNumType` in // `core/framework/function.cc` on `NamedAttrList` because the default // attributes need to be added. Find a way to do this in one pass. absl::StatusOr<unsigned int> ArgNumType(const NamedAttrList &attrs, const OpDef::ArgDef &arg\_def, SmallVectorImpl<Type> &types); // Convert function attributes to MLIR attributes. Status ConvertFunctionAttributes( const absl::flat\_hash\_map<StringPiece, StringPiece> &gradient\_map, const FunctionDef &function, GraphFuncOp op, NamedAttrList &attrs); // Convert function argument attributes to MLIR attributes. Status ConvertArgumentAttributes(const OpDef::ArgDef &def, NamedAttrList &attrs); // Create a location for a node. Location ConvertLocation(const NodeDef &node); // Convert the location of a node from the debug info. If it has no debug // info, return a NameLoc. Location ConvertLocation(StringRef node\_name, StringRef func\_name);
 // The MLIR context. MLIRContext \*ctx\_; // Reference to the TFG dialect. TFGraphDialect \*dialect\_; // The builder instance. Builder b\_; // The TF op registry to use. const OpRegistry &registry\_; // The debug info about the graph. const GraphDebugInfo &debug\_info\_; // Cached unknown location. Location unknown\_loc\_; // Operation state for creating placeholder ops. OperationState placeholder\_state\_;
 StackTracesMap stack\_traces\_;
 // Map of function OpDefs. absl::flat\_hash\_map<StringPiece, const OpDef \*> function\_op\_defs\_;};} // namespace
// Convert a VersionDef to an MLIR version attribute.static VersionAttr ConvertVersionAttr(MLIRContext \*context, const VersionDef &version) { ArrayRef<int32\_t> bad\_consumers(version.bad\_consumers().data(), version.bad\_consumers().size()); return VersionAttr::get(context, version.producer(), version.min\_consumer(), bad\_consumers);}
// Returns true if the function is a generic function, i.e. it contains// placeholder attributes.//// TODO(jeffniu): Having to iterate over every function just to check for// placeholder attributes is slow. Since most functions are not generic, we can// speculate by converting all functions as non-generic until we see a// placeholder attribute, bail out, and fall back to the generic function// converter.static bool IsGenericFunction(const FunctionDef &fdef) { for (const NodeDef &node : fdef.node\_def()) for (const auto &named\_attr : node.attr()) if (!named\_attr.second.placeholder().empty()) return true;
 return false;}
absl::StatusOr<OwningOpRef<ModuleOp>> GraphDefImporter::ConvertGraphDef( const GraphDef &graph) { // Create the module. OwningOpRef<ModuleOp> module = ModuleOp::create(unknown\_loc\_);
 // Create the graph op. auto builder = OpBuilder::atBlockBegin(module->getBody()); auto graph\_op = builder.create<GraphOp>( module->getLoc(), ConvertVersionAttr(ctx\_, graph.versions())); graph\_op.getNodes().push\_back(new Block);
 // Populate the function op defs. function\_op\_defs\_.reserve(graph.library().function\_size()); for (const FunctionDef &function : graph.library().function()) { function\_op\_defs\_.emplace(function.signature().name(), &function.signature()); }
 // Build a map from function name to gradient function name. absl::flat\_hash\_map<StringPiece, StringPiece> gradient\_map; gradient\_map.reserve(graph.library().gradient\_size()); for (const tensorflow::GradientDef &gradient : graph.library().gradient()) gradient\_map.emplace(gradient.function\_name(), gradient.gradient\_func());
 // Convert the graph. ConversionState s(&graph\_op.getNodes().front(), placeholder\_state\_); TF\_RETURN\_IF\_ERROR( ConvertNodes(builder, s, graph.node(), &graph\_op.getNodes().front()));
 // A function to convert a generic or non-generic function. const auto convert\_func = [this, &gradient\_map](GraphFuncOp func\_op, const FunctionDef &function) { if (IsGenericFunction(function)) { // Generic functions aren't on the hot path so just call the old // importer. OpBuilder builder(ctx\_); TF\_RETURN\_WITH\_CONTEXT\_IF\_ERROR( ConvertGenericFunction(func\_op, function, builder), "While importing generic function: ", function.signature().name()); } else { TF\_RETURN\_WITH\_CONTEXT\_IF\_ERROR( ConvertFunctionDef(func\_op, gradient\_map, function), "While importing function: ", function.signature().name()); } return absl::OkStatus(); };
 // TODO(jeffniu): Don't import functions in parallel if there are too few (how // few?) or if the functions are too small (how small?). if (ctx\_->isMultithreadingEnabled()) { ctx\_->enterMultiThreadedExecution(); auto exit = llvm::make\_scope\_exit([this] { ctx\_->exitMultiThreadedExecution(); });
 // Prepare the arguments to parallel for each. struct Argument { GraphFuncOp func; const FunctionDef &def; Status status; }; std::vector<Argument> args; args.reserve(graph.library().function\_size()); for (const FunctionDef &function : graph.library().function()) { args.push\_back( Argument{builder.create<GraphFuncOp>(unknown\_loc\_), function}); } const auto process\_func = [&convert\_func](Argument &arg) { arg.status = convert\_func(arg.func, arg.def); return success(arg.status.ok()); };
 // Execute the imports in parallel. if (failed(failableParallelForEach(ctx\_, args, process\_func))) { Status result; for (const Argument &arg : args) { result.Update(arg.status); } return result; } } else { // Convert the functions. for (const FunctionDef &function : graph.library().function()) { auto func\_op = builder.create<GraphFuncOp>(unknown\_loc\_); TF\_RETURN\_IF\_ERROR(convert\_func(func\_op, function)); } }
 return module;}
Status GraphDefImporter::ConvertFunctionAttributes( const absl::flat\_hash\_map<StringPiece, StringPiece> &gradient\_map, const FunctionDef &function, GraphFuncOp op, NamedAttrList &attrs) { // Import the function attributes with a `tf.` prefix to match the current // infratructure expectations. for (const auto &name\_attr : function.attr()) { if (name\_attr.first.empty()) { return InvalidArgument("Function ", function.signature().name(), " has an empty attr name"); } // TODO(b/230143351): `ConvertAttributeValue` is a little slow due to // `ConvertTensorProto` and `ConvertTensorShapeProto`. TF\_ASSIGN\_OR\_RETURN(Attribute attr, ConvertAttributeValue(name\_attr.second, b\_)); attrs.append(absl::StrCat("tf.", name\_attr.first), attr); }
 // Convert the first-class attributes. const tensorflow::OpDef &signature = function.signature(); if (signature.name().empty()) return InvalidArgument("Function without a name"); attrs.append(op.getSymNameAttrName(), b\_.getStringAttr(signature.name()));
 if (!signature.description().empty()) { attrs.append(op.getDescriptionAttrName(), b\_.getStringAttr(signature.description())); } if (signature.is\_stateful()) attrs.append(op.getIsStatefulAttrName(), b\_.getUnitAttr()); auto grad\_it = gradient\_map.find(signature.name()); if (grad\_it != gradient\_map.end()) { StringPiece name = grad\_it->second; attrs.append(op.getGradientAttrName(), FlatSymbolRefAttr::get(ctx\_, {name.data(), name.size()})); }
 // The resource\_arg\_unique\_id is a list of `pair<int, int>`, we import it // as two arrays of integer right now. if (function.resource\_arg\_unique\_id\_size()) { SmallVector<int32\_t> resource\_arg\_unique\_ids\_keys; SmallVector<int32\_t> resource\_arg\_unique\_ids\_values; resource\_arg\_unique\_ids\_keys.reserve( function.resource\_arg\_unique\_id\_size()); resource\_arg\_unique\_ids\_values.reserve( function.resource\_arg\_unique\_id\_size()); for (const auto &unique\_id : function.resource\_arg\_unique\_id()) { resource\_arg\_unique\_ids\_keys.push\_back(unique\_id.first); resource\_arg\_unique\_ids\_values.push\_back(unique\_id.second); } attrs.append(op.getResourceArgUniqueIdsKeysAttrName(), b\_.getI32TensorAttr(resource\_arg\_unique\_ids\_keys)); attrs.append(op.getResourceArgUniqueIdsValuesAttrName(), b\_.getI32TensorAttr(resource\_arg\_unique\_ids\_values)); } return absl::OkStatus();}
Status GraphDefImporter::ConvertArgumentAttributes(const OpDef::ArgDef &def, NamedAttrList &attrs) { attrs.append(dialect\_->getTfgNameAttrIdentifier(), b\_.getStringAttr(def.name())); if (!def.description().empty()) { attrs.append(dialect\_->getTfgDescriptionAttrIdentifier(), b\_.getStringAttr(def.description())); } if (def.is\_ref()) attrs.append(dialect\_->getTfgIsRefAttrIdentifier(), b\_.getUnitAttr()); if (def.handle\_data\_size()) { TF\_ASSIGN\_OR\_RETURN(Attribute handle\_data, ConvertHandleData(b\_, def.handle\_data())); attrs.append(dialect\_->getTfgHandleDataAttrIdentifier(), handle\_data); } if (def.has\_experimental\_full\_type()) { TF\_ASSIGN\_OR\_RETURN(tf\_type::FullTypeAttr full\_type, ConvertAttribute(def.experimental\_full\_type(), b\_)); attrs.append(dialect\_->getTfgFullTypeAttrIdentifier(), full\_type); } return absl::OkStatus();}
Location GraphDefImporter::ConvertLocation(const NodeDef &node) { if (!node.has\_experimental\_debug\_info()) return unknown\_loc\_;
 const auto &debug\_info = node.experimental\_debug\_info(); const auto &original\_nodes = debug\_info.original\_node\_names(); const auto &original\_funcs = debug\_info.original\_func\_names(); if (original\_nodes.empty()) return unknown\_loc\_;
 SmallVector<Location> node\_locs; node\_locs.reserve(original\_nodes.size()); for (const auto &it : llvm::enumerate(original\_nodes)) { std::string func\_name = it.index() < original\_funcs.size() ? original\_funcs[it.index()] : ""; node\_locs.push\_back(ConvertLocation(it.value(), func\_name)); } return b\_.getFusedLoc(node\_locs);}
// This is a re-implementation of GetLocation in `import.cc`.Location GraphDefImporter::ConvertLocation(StringRef node\_name, StringRef func\_name) { // Concatenate the node name with the function name to match how the key is // formed in Python. std::string debug\_info\_key = (node\_name + "@" + func\_name).str(); std::string name\_loc = func\_name.empty() ? node\_name.str() : debug\_info\_key; auto name\_loc\_id = b\_.getStringAttr(name\_loc);
 SmallVector<Location> locs;
 // Try to find a stack trace to convert to locations. auto it = stack\_traces\_.find(name\_loc); if (it == stack\_traces\_.end()) { it = stack\_traces\_.find(debug\_info\_key); } if (it != stack\_traces\_.end()) { std::shared\_ptr<tensorflow::AbstractStackTrace> trace = it->second; auto frames = trace->ToFrames(); locs.reserve(frames.size()); for (const auto &frame : frames) { auto file\_attr = b\_.getStringAttr(frame.file\_name); locs.push\_back(FileLineColLoc::get(file\_attr, frame.line\_number, 1)); } }
 if (locs.empty()) return NameLoc::get(name\_loc\_id);
 // Use the first location to generate a name location. Location node\_name\_loc = NameLoc::get(name\_loc\_id, locs.front()); // Generate a stack trace using the remaining locations. ArrayRef<Location> callsite\_locs = llvm::ArrayRef(locs).drop\_front(); return callsite\_locs.empty() ? node\_name\_loc : CallSiteLoc::get(node\_name\_loc, callsite\_locs);}
absl::StatusOr<Value> GraphDefImporter::ResolveDataResult(const ResultId &id, ResultInfo \*info) { if (id.output.empty()) { if (id.index >= info->data.size()) { return InvalidArgument("Result #", id.index, " of node '", id.node.str(), "' is out of bounds"); } return info->data[id.index]; }
 auto it = info->outputs.find({id.output.data(), id.output.size()}); if (it == info->outputs.end()) { return InvalidArgument("Node '", id.node.str(), "' has no output called '", id.output.str(), "'"); } if (id.index >= it->second.size()) { return InvalidArgument("Result #", id.index, " of segment '", id.node.str(), ":", id.output.str(), "' is out of bounds"); } return it->second[id.index];}
absl::StatusOr<GraphDefImporter::Result> GraphDefImporter::GetResult( ConversionState &s, StringPiece name) { TensorId tensor\_id = tensorflow::ParseTensorName(name); ResultId id{tensor\_id.index()}; std::tie(id.node, id.output) = StringRef(tensor\_id.node().data(), tensor\_id.node().size()).split(':'); std::unique\_ptr<ResultInfo> &info = s[{id.node.data(), id.node.size()}]; if (!info) { info = std::make\_unique<ResultInfo>(); }
 // If the result is unresolved, return the placeholder; if (!info->resolved) { if (id.IsControl()) { return Result{s.GetPlaceholder(), Value(), id, info.get()}; } return Result{Value(), s.GetPlaceholder(), id, info.get()}; }
 // If the result is the control token, return it. if (id.IsControl()) { return Result{info->control, Value()}; }
 TF\_ASSIGN\_OR\_RETURN(Value value, ResolveDataResult(id, info.get())); return Result{Value(), value};}
Status GraphDefImporter::ConvertFunctionDef( GraphFuncOp func\_op, const absl::flat\_hash\_map<StringPiece, StringPiece> &gradient\_map, const FunctionDef &function) { const OpDef &signature = function.signature(); // TODO(jeffniu): Does the name need to be mangled?
 func\_op.getBody().push\_back(new Block); Block \*body = &func\_op.getBody().front(); auto builder = OpBuilder::atBlockBegin(func\_op.SingleBlock::getBody());
 // Convert the attributes. NamedAttrList func\_attrs; TF\_RETURN\_IF\_ERROR( ConvertFunctionAttributes(gradient\_map, function, func\_op, func\_attrs));
 SmallVector<Attribute> arg\_attrs, res\_attrs, control\_ret\_attrs; SmallVector<Type> arg\_types, res\_types;
 // Convert the arguments and argument attributes. for (const auto &it : llvm::enumerate(signature.input\_arg())) { Type dtype; TF\_RETURN\_IF\_ERROR(ConvertDataType(it.value().type(), b\_, &dtype)); BlockArgument data = body->addArgument(UnrankedTensorType::get(dtype), unknown\_loc\_); BlockArgument ctl = body->addArgument(dialect\_->getControlType(), data.getLoc());
 NamedAttrList attrs; TF\_RETURN\_IF\_ERROR(ConvertArgumentAttributes(it.value(), attrs)); auto attr\_it = function.arg\_attr().find(it.index()); if (attr\_it != function.arg\_attr().end()) { for (const auto &name\_attr : attr\_it->second.attr()) { TF\_ASSIGN\_OR\_RETURN(Attribute attr, ConvertAttributeValue(name\_attr.second, b\_)); attrs.append("tf." + name\_attr.first, attr); } }
 arg\_attrs.append({attrs.getDictionary(ctx\_), b\_.getDictionaryAttr({})}); arg\_types.append({data.getType(), ctl.getType()}); }
 // Iterate over the arguments again and map them. We have to add them first // otherwise the ranges will be invalidated. ConversionState s(body, placeholder\_state\_); for (const auto &it : llvm::enumerate(signature.input\_arg())) { s.emplace(it.value().name(), absl::WrapUnique(new ResultInfo{ /\*resolved=\*/true, body->getArgument(it.index() \* 2 + 1), body->getArguments().slice(it.index() \* 2, 1)})); } TF\_RETURN\_IF\_ERROR(ConvertNodes(builder, s, function.node\_def(), body));
 // Convert the results and the result attributes. SmallVector<Value> return\_operands; return\_operands.reserve(signature.output\_arg\_size() + signature.control\_output\_size()); for (const OpDef::ArgDef &def : function.signature().output\_arg()) { Type dtype; TF\_RETURN\_IF\_ERROR(ConvertDataType(def.type(), b\_, &dtype)); NamedAttrList attrs; TF\_RETURN\_IF\_ERROR(ConvertArgumentAttributes(def, attrs)); res\_attrs.push\_back(attrs.getDictionary(ctx\_)); res\_types.push\_back(UnrankedTensorType::get(dtype));
 auto ret\_it = function.ret().find(def.name()); if (ret\_it == function.ret().end()) { return InvalidArgument("Output '", def.name(), "' was not found in 'ret'"); } TF\_ASSIGN\_OR\_RETURN(Result result, GetResult(s, ret\_it->second)); if (result.info) return InvalidArgument("Return '", ret\_it->second, "' was not found"); if (result.control) return InvalidArgument("Unexpected control result: ", ret\_it->second); return\_operands.push\_back(result.data); }
 // Convert the control results. for (const std::string &control\_ret : signature.control\_output()) { auto ret\_it = function.control\_ret().find(control\_ret); if (ret\_it == function.control\_ret().end()) { return InvalidArgument("Control output '", control\_ret, "' was not found in 'control\_ret'"); } std::unique\_ptr<ResultInfo> &result = s[ret\_it->second]; if (!result || !result->resolved) { return InvalidArgument("Control return ", ret\_it->second, " was not found"); } return\_operands.push\_back(result->control); control\_ret\_attrs.push\_back(b\_.getDictionaryAttr(NamedAttribute( dialect\_->getTfgNameAttrIdentifier(), b\_.getStringAttr(control\_ret)))); } builder.create<ReturnOp>(unknown\_loc\_, return\_operands, b\_.getArrayAttr(control\_ret\_attrs));
 // Finalize the function attributes. func\_attrs.append(func\_op.getArgAttrsAttrName(), b\_.getArrayAttr(arg\_attrs)); func\_attrs.append(func\_op.getResAttrsAttrName(), b\_.getArrayAttr(res\_attrs)); func\_attrs.append(func\_op.getFunctionTypeAttrName(), TypeAttr::get(b\_.getFunctionType(arg\_types, res\_types))); func\_op->setAttrs(func\_attrs.getDictionary(ctx\_));
 return absl::OkStatus();}
Status GraphDefImporter::ConvertNodes( OpBuilder &builder, ConversionState &s, const tensorflow::protobuf::RepeatedPtrField<NodeDef> &nodes, Block \*block) { OpBuilder::InsertionGuard ig(builder); builder.setInsertionPointToStart(block); for (const NodeDef &node : nodes) { TF\_RETURN\_IF\_ERROR(ConvertNodeDef(builder, s, node)); }
 // If the placeholder has remaining uses, then an input is missing. if (TF\_PREDICT\_FALSE(!s.GetPlaceholder().use\_empty())) { // Stringify a result ID. const auto id\_to\_str = [](const ResultId &id) { std::string name = id.node.str(); if (id.IsControl()) return absl::StrCat("^", name); if (id.output.empty()) return id.index ? absl::StrCat(id.node.str(), ":", id.index) : name; return absl::StrCat(name, ":", id.output.str(), ":", id.index); }; // Gather all missing input edges. std::vector<std::pair<std::string, std::string>> missing\_edges; for (const ResultInfo &info : llvm::make\_pointee\_range(llvm::make\_second\_range(s))) { if (info.backedges.empty()) continue; const Backedge &edge = info.backedges.front(); missing\_edges.emplace\_back(id\_to\_str(edge.id), TFOp(edge.operand->getOwner()).name().str()); } assert(!missing\_edges.empty() && "placeholder had remaining uses but found no unresolved backedges"); // Destroy the invalid IR. block->erase(); // Report the missing edges in alphabetical order. llvm::sort(missing\_edges); std::string error\_message; llvm::raw\_string\_ostream os(error\_message); llvm::interleave( missing\_edges, os, [&](const auto &edge) { os << "Non-existent input " << edge.first << " in node " << edge.second; }, "\n"); return InvalidArgument(std::move(os.str())); } // The placeholder has no uses and should not acquire any more uses. Safely // delete it from the IR. s.Finalize();
 return absl::OkStatus();}
absl::StatusOr<unsigned int> GraphDefImporter::ArgNumType( const NamedAttrList &attrs, const OpDef::ArgDef &arg\_def, SmallVectorImpl<Type> &types) { // Check whether a type list attribute is specified. if (!arg\_def.type\_list\_attr().empty()) { if (auto v = mlir::dyn\_cast\_or\_null<ArrayAttr>( attrs.get(arg\_def.type\_list\_attr()))) { for (Attribute attr : v) { if (auto dtype = mlir::dyn\_cast<TypeAttr>(attr)) { types.push\_back(UnrankedTensorType::get(dtype.getValue())); } else { return InvalidArgument("Expected '", arg\_def.type\_list\_attr(), "' to be a list of types"); } } return v.size(); } return NotFound("Type attr not found: ", arg\_def.type\_list\_attr()); }
 unsigned num = 1; // Check whether a number attribute is specified. if (!arg\_def.number\_attr().empty()) { if (auto v = mlir::dyn\_cast\_or\_null<IntegerAttr>( attrs.get(arg\_def.number\_attr()))) { num = v.getValue().getZExtValue(); } else { return NotFound("Type attr not found: ", arg\_def.number\_attr()); } }
 // Check for a type or type attribute. Type dtype; if (arg\_def.type() != DataType::DT\_INVALID) { TF\_RETURN\_IF\_ERROR(ConvertDataType(arg\_def.type(), b\_, &dtype)); } else if (arg\_def.type\_attr().empty()) { return InvalidArgument("Arg '", arg\_def.name(), "' has invalid type and no type attribute"); } else { if (auto v = mlir::dyn\_cast\_or\_null<TypeAttr>(attrs.get(arg\_def.type\_attr()))) { dtype = v.getValue(); } else { return NotFound("Type attr not found: ", arg\_def.type\_attr()); } } types.append(num, UnrankedTensorType::get(dtype)); return num;}
Status GraphDefImporter::ConvertNodeDef(OpBuilder &builder, ConversionState &s, const NodeDef &node) { VLOG(4) << "Importing: " << node.name(); if (node.op().empty()) return InvalidArgument("Node ", node.name(), " has an empty op name");
 OperationState state(ConvertLocation(node), absl::StrCat("tfg.", node.op()));
 // The GraphImporter does light shape inference, but here we will defer all of // that to the shape inference pass. const OpDef \*op\_def; const OpRegistrationData \*op\_reg\_data = nullptr; if ((op\_reg\_data = registry\_.LookUp(node.op()))) { op\_def = &op\_reg\_data->op\_def; } else { auto it = function\_op\_defs\_.find(node.op()); if (it == function\_op\_defs\_.end()) return InvalidArgument("Unable to find OpDef for ", node.op()); op\_def = it->second; }
 // Import the attributes. Reserve `+3` for `device`,`name`, and `fulltype`. state.attributes.reserve(node.attr\_size() + 3); if (!node.device().empty()) { state.addAttribute(dialect\_->getDeviceAttrIdentifier(), b\_.getStringAttr(node.device())); } if (!node.name().empty()) { state.addAttribute(dialect\_->getNameAttrIdentifier(), b\_.getStringAttr(node.name())); }
 // If the op doesn't have a FullType, try to infer one. const auto add\_full\_type = [&](const FullTypeDef &full\_type\_def) { TF\_ASSIGN\_OR\_RETURN(tf\_type::FullTypeAttr full\_type, ConvertAttribute(full\_type\_def, b\_)); state.addAttribute(dialect\_->getFullTypeAttrIdentifier(), full\_type); return absl::OkStatus(); }; if (node.has\_experimental\_type()) { TF\_RETURN\_IF\_ERROR(add\_full\_type(node.experimental\_type())); } else if (op\_reg\_data && op\_reg\_data->type\_ctor) { FullTypeDef full\_type\_def; TF\_RETURN\_IF\_ERROR( tensorflow::full\_type::SpecializeType(node, \*op\_def, full\_type\_def)); TF\_RETURN\_IF\_ERROR(add\_full\_type(full\_type\_def)); }
 for (auto &name\_attr : node.attr()) { if (name\_attr.first.empty()) return InvalidArgument("Node ", node.name(), " has an empty attr name"); TF\_ASSIGN\_OR\_RETURN(Attribute attr, ConvertAttributeValue(name\_attr.second, b\_)); state.addAttribute(name\_attr.first, attr); }
 // Add missing default attributes. for (const auto &attr\_def : op\_def->attr()) { if (attr\_def.has\_default\_value() && !state.attributes.get(attr\_def.name())) { TF\_ASSIGN\_OR\_RETURN(Attribute attr, ConvertAttributeValue(attr\_def.default\_value(), b\_)); state.addAttribute(attr\_def.name(), attr); } }
 // Get the result types. Ops can have multiple named results. Track the // segment sizes. SmallVector<std::pair<unsigned, unsigned>> result\_segments;
 if (op\_def->output\_arg\_size() < 0) return InvalidArgument("Node ", node.name(), " output arg size < 0"); result\_segments.reserve(op\_def->output\_arg\_size()); state.types.reserve(op\_def->output\_arg\_size() + 1); for (const OpDef::ArgDef &def : op\_def->output\_arg()) { unsigned index = state.types.size(); TF\_ASSIGN\_OR\_RETURN(unsigned size, ArgNumType(state.attributes, def, state.types)); result\_segments.emplace\_back(index, size); } state.types.push\_back(dialect\_->getControlType());
 // Collect the operands. Set backedges to a placeholder and resolve them // later. state.operands.reserve(node.input\_size()); SmallVector<Value> control\_operands; struct BackedgeResolution { ResultInfo \*info; size\_t operand\_index; ResultId id; }; SmallVector<BackedgeResolution> unresolved\_data\_operands, unresolved\_control\_operands; for (const std::string &input : node.input()) { TF\_ASSIGN\_OR\_RETURN(Result result, GetResult(s, input)); if (result.control) { if (result.info) { unresolved\_control\_operands.push\_back(BackedgeResolution{ result.info, control\_operands.size(), result.id}); } control\_operands.push\_back(result.control); } else { if (result.info) { unresolved\_data\_operands.push\_back( BackedgeResolution{result.info, state.operands.size(), result.id}); } state.operands.push\_back(result.data); } } unsigned num\_data\_operands = state.operands.size(); state.addOperands(control\_operands);
 // Create the op and record any unresolved operands. Operation \*op = builder.create(state); for (const BackedgeResolution &r : unresolved\_data\_operands) { r.info->backedges.push\_back( Backedge{r.id, &op->getOpOperand(r.operand\_index)}); } for (const BackedgeResolution &r : unresolved\_control\_operands) { r.info->backedges.push\_back( Backedge{r.id, &op->getOpOperand(num\_data\_operands + r.operand\_index)}); }
 std::unique\_ptr<ResultInfo> &info = s[node.name()]; if (!info) { info = std::make\_unique<ResultInfo>(); } info->resolved = true; info->control = \*std::prev(op->result\_end()); info->data = op->getResults().drop\_back(); for (auto it : llvm::zip(result\_segments, op\_def->output\_arg())) { const std::pair<unsigned, unsigned> &segment = std::get<0>(it); info->outputs.emplace(std::get<1>(it).name(), info->data.slice(segment.first, segment.second)); }
 // Resolve any associated backedges. for (const Backedge &backedge : info->backedges) { Value value; if (backedge.id.IsControl()) { value = info->control; } else { TF\_ASSIGN\_OR\_RETURN(value, ResolveDataResult(backedge.id, info.get())); } backedge.operand->set(value); } info->backedges.clear();
 return absl::OkStatus();}
Status GraphDefImporter::ConvertDataTypesToUnrankedTensorTypes( const DataTypeVector &dtypes, SmallVectorImpl<Type> &results) { Type dtype; for (DataType tf\_dtype : dtypes) { TF\_RETURN\_IF\_ERROR(ConvertDataType(tf\_dtype, b\_, &dtype)); results.push\_back(UnrankedTensorType::get(dtype)); } return absl::OkStatus();}
absl::StatusOr<OwningOpRef<ModuleOp>> ImportGraphDef( MLIRContext \*context, const GraphDebugInfo &debug\_info, const GraphDef &graph\_def) { GraphDefImporter importer(context->getOrLoadDialect<TFGraphDialect>(), \*OpRegistry::Global(), debug\_info); return importer.ConvertGraphDef(graph\_def);}
absl::StatusOr<OwningOpRef<ModuleOp>> ImportGraphAndFunctionsToMlir( MLIRContext \*context, const GraphDebugInfo &debug\_info, const Graph &graph, const FunctionLibraryDefinition &flib\_def) { // TODO(b/231723721): This conversion path is slow because both the graph and // the function library are converted to GraphDef. GraphDef graph\_def; graph.ToGraphDef(&graph\_def); \*graph\_def.mutable\_library() = flib\_def.ToProto(); return ImportGraphDef(context, debug\_info, graph\_def);}
} // namespace tfg} // namespace mlir

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8e4f3c88_20250114_183626.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2Fa0f0b9a21c9270930457095092f558fbad4c03e5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2Fa0f0b9a21c9270930457095092f558fbad4c03e5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Commit

[Permalink](/tensorflow/tensorflow/commit/a0f0b9a21c9270930457095092f558fbad4c03e5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[TF] NodeDefs without an op name are invalid, return error on import

[Browse files](/tensorflow/tensorflow/tree/a0f0b9a21c9270930457095092f558fbad4c03e5)
Browse the repository at this point in the history

```
PiperOrigin-RevId: 453711926
```

* Loading branch information

[![@tensorflower-gardener](https://avatars.githubusercontent.com/u/17151892?s=40&v=4)](/tensorflower-gardener)

[tensorflower-gardener](/tensorflow/tensorflow/commits?author=tensorflower-gardener "View all commits by tensorflower-gardener")
committed
Jun 8, 2022

1 parent
[7709a78](/tensorflow/tensorflow/commit/7709a78b3fadf174613a66290ff8dff6760782a4)

commit a0f0b9a

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**23 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tensorflow/core/ir/importexport

  + tensorflow/core/ir/importexport/graphdef\_import.cc
    [graphdef\_import.cc](#diff-1da289a4109310b3776f5d4e4109a383aea5457e611c6171f88255f69facf4df)
  + tests/graphdef\_to\_mlir

    - tensorflow/core/ir/importexport/tests/graphdef\_to\_mlir/invalid\_op\_name.pbtxt
      [invalid\_op\_name.pbtxt](#diff-5000dfa1f27834f3d16cd52005ed1d6fbde6e4238359aee6163257f3251c8252)

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[tensorflow/core/ir/importexport/graphdef\_import.cc](#diff-1da289a4109310b3776f5d4e4109a383aea5457e611c6171f88255f69facf4df "tensorflow/core/ir/importexport/graphdef_import.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/a0f0b9a21c9270930457095092f558fbad4c03e5/tensorflow/core/ir/importexport/graphdef_import.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -746,6 +746,9 @@ StatusOr<unsigned> GraphDefImporter::ArgNumType(const NamedAttrList &attrs, |
|  |  | Status GraphDefImporter::ConvertNodeDef(OpBuilder &builder, ConversionState &s, |
|  |  | const NodeDef &node) { |
|  |  | VLOG(4) << "Importing: " << node.name(); |
|  |  | if (node.op().empty()) |
|  |  | return InvalidArgument("Node ", node.name(), " has an empty op name"); |
|  |  |  |
|  |  | OperationState state(ConvertLocation(node), absl::StrCat("tfg.", node.op())); |
|  |  |  |
|  |  | // The GraphImporter does light shape inference, but here we will defer all of |
| Expand Down | |  |

20 changes: 20 additions & 0 deletions

20
[tensorflow/core/ir/importexport/tests/graphdef\_to\_mlir/invalid\_op\_name.pbtxt](#diff-5000dfa1f27834f3d16cd52005ed1d6fbde6e4238359aee6163257f3251c8252 "tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_op_name.pbtxt")

Show comments

[View file](/tensorflow/tensorflow/blob/a0f0b9a21c9270930457095092f558fbad4c03e5/tensorflow/core/ir/importexport/tests/graphdef_to_mlir/invalid_op_name.pbtxt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,20 @@ |
|  |  | # RUN: not tfg-translate -graphdef-to-mlir %s 2>&1 | FileCheck %s |
|  |  |  |
|  |  | # CHECK: Node has an empty op name |
|  |  |  |
|  |  | library { |
|  |  | function { |
|  |  | signature { |
|  |  | name: "\\344\\264\\264" |
|  |  | description: "value" |
|  |  | is\_distributed\_communication: true |
|  |  | } |
|  |  | node\_def { |
|  |  | input: "|" |
|  |  | } |
|  |  | control\_ret { |
|  |  | key: "" |
|  |  | value: "" |
|  |  | } |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a0f0b9a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2Fa0f0b9a21c9270930457095092f558fbad4c03e5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


