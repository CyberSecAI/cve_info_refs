=== Content from access.redhat.com_3a575bee_20250115_112144.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.redhat.com_69d503fb_20250114_181739.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2060129)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2060129)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2060129)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2060129

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2060129**](show_bug.cgi?id=2060129)
(CVE-2022-0852)
- [CVE-2022-0852](https://access.redhat.com/security/cve/CVE-2022-0852) convert2rhel: Red Hat account password passed via command line by code

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2022-0852 convert2rhel: Red Hat account password passed via command line ...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2022-0852 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [2060225](show_bug.cgi?id=2060225) [2060226](show_bug.cgi?id=2060226) [2077963](show_bug.cgi?id=2077963) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [2054854](show_bug.cgi?id=2054854) | | TreeView+ | [depends on](buglist.cgi?bug_id=2060129&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2060129&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2022-03-02 19:09 UTC by Todd Cullum | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2022-07-06 15:43 UTC ([History](show_activity.cgi?id=2060129)) | | [CC List:](page.cgi?id=fields.html#cclist) | 5 users (show)  ansyed egustavs mbocek security-response-team tkuratom | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: | There is a flaw in convert2rhel. convert2rhel passes the Red Hat account password to subscription-manager via the command line, which could allow unauthorized users locally on the machine to view the password via the process command line via e.g. htop or ps. The specific impact varies upon the privileges of the Red Hat account in question, but it could affect the integrity, availability, and/or data confidentiality of other systems that are administered by that account. This occurs regardless of how the password is supplied to convert2rhel. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2022-04-27 11:45:33 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2022:1599](https://access.redhat.com/errata/RHSA-2022%3A1599) | 0 | None | None | None | 2022-04-27 06:28:51 UTC | | Red Hat Product Errata | [RHSA-2022:1617](https://access.redhat.com/errata/RHSA-2022%3A1617) | 0 | None | None | None | 2022-04-27 07:22:39 UTC | | Red Hat Product Errata | [RHSA-2022:1618](https://access.redhat.com/errata/RHSA-2022%3A1618) | 0 | None | None | None | 2022-04-27 07:23:31 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2060129#c0)  Todd Cullum    2022-03-02 19:09:41 UTC  ``` In convert2rhel's subscription.py file, code to register a system passes the password via the commandline. This could result in disclosure of the password to all users with local access to the system.  Reference:  1. <https://github.com/oamg/convert2rhel/blob/main/convert2rhel/subscription.py#L156>   ```  [Comment 3](show_bug.cgi?id=2060129#c3)  errata-xmlrpc    2022-04-27 06:28:49 UTC  ``` This issue has been addressed in the following products:    Convert2RHEL for RHEL-8  Via RHSA-2022:1599 [https://access.redhat.com/errata/RHSA-2022:1599](https://access.redhat.com/errata/RHSA-2022%3A1599)   ```  [Comment 4](show_bug.cgi?id=2060129#c4)  errata-xmlrpc    2022-04-27 07:22:36 UTC  ``` This issue has been addressed in the following products:    Convert2RHEL for RHEL-7  Via RHSA-2022:1617 [https://access.redhat.com/errata/RHSA-2022:1617](https://access.redhat.com/errata/RHSA-2022%3A1617)   ```  [Comment 5](show_bug.cgi?id=2060129#c5)  errata-xmlrpc    2022-04-27 07:23:29 UTC  ``` This issue has been addressed in the following products:    Convert2RHEL for RHEL-6  Via RHSA-2022:1618 [https://access.redhat.com/errata/RHSA-2022:1618](https://access.redhat.com/errata/RHSA-2022%3A1618)   ```  [Comment 6](show_bug.cgi?id=2060129#c6)  Product Security DevOps Team    2022-04-27 11:45:31 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2022-0852>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2060129&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from github.com_bb31d64d_20250115_112144.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-fjvj-w876-8mc2)

**CVE-2022-0852**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-fjvj-w876-8mc2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2022-0852](/advisories/GHSA-fjvj-w876-8mc2)

## There is a flaw in convert2rhel. convert2rhel passes the...

Moderate severity

Unreviewed

Published
Aug 29, 2022
to the GitHub Advisory Database
•
Updated Feb 13, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-fjvj-w876-8mc2/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

There is a flaw in convert2rhel. convert2rhel passes the Red Hat account password to subscription-manager via the command line, which could allow unauthorized users locally on the machine to view the password via the process command line via e.g. htop or ps. The specific impact varies upon the privileges of the Red Hat account in question, but it could affect the integrity, availability, and/or data confidentiality of other systems that are administered by that account. This occurs regardless of how the password is supplied to convert2rhel.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2022-0852>
* [oamg/convert2rhel#492](https://github.com/oamg/convert2rhel/pull/492)
* [oamg/convert2rhel@8d72fb0](https://github.com/oamg/convert2rhel/commit/8d72fb030ed31116fdb256b327d299337b000af4)
* <https://access.redhat.com/security/cve/CVE-2022-0852>
* <https://bugzilla.redhat.com/show_bug.cgi?id=2060129>
* <https://issues.redhat.com/browse/RHELC-432>
* [https://access.redhat.com/errata/RHSA-2022:1599](https://access.redhat.com/errata/RHSA-2022%3A1599)
* [https://access.redhat.com/errata/RHSA-2022:1617](https://access.redhat.com/errata/RHSA-2022%3A1617)
* [https://access.redhat.com/errata/RHSA-2022:1618](https://access.redhat.com/errata/RHSA-2022%3A1618)

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2022-0852)
Aug 29, 2022

Published to the GitHub Advisory Database
Aug 29, 2022

Last updated
Feb 13, 2023

### Severity

Moderate

5.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N

### [EPSS score](https://www.first.org/epss/user-guide)

0.067%
 (32nd percentile)

### Weaknesses

[CWE-359](/advisories?query=cwe%3A359) [CWE-668](/advisories?query=cwe%3A668)

### CVE ID

CVE-2022-0852

### GHSA ID

GHSA-fjvj-w876-8mc2

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-fjvj-w876-8mc2/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_799ff9a8_20250114_181745.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foamg%2Fconvert2rhel%2Fpull%2F492)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foamg%2Fconvert2rhel%2Fpull%2F492)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=oamg%2Fconvert2rhel)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[oamg](/oamg)
/
**[convert2rhel](/oamg/convert2rhel)**
Public

* [Notifications](/login?return_to=%2Foamg%2Fconvert2rhel) You must be signed in to change notification settings
* [Fork
  86](/login?return_to=%2Foamg%2Fconvert2rhel)
* [Star
   108](/login?return_to=%2Foamg%2Fconvert2rhel)

* [Code](/oamg/convert2rhel)
* [Issues
  11](/oamg/convert2rhel/issues)
* [Pull requests
  11](/oamg/convert2rhel/pulls)
* [Discussions](/oamg/convert2rhel/discussions)
* [Actions](/oamg/convert2rhel/actions)
* [Projects
  0](/oamg/convert2rhel/projects)
* [Wiki](/oamg/convert2rhel/wiki)
* [Security](/oamg/convert2rhel/security)
* [Insights](/oamg/convert2rhel/pulse)

Additional navigation options

* [Code](/oamg/convert2rhel)
* [Issues](/oamg/convert2rhel/issues)
* [Pull requests](/oamg/convert2rhel/pulls)
* [Discussions](/oamg/convert2rhel/discussions)
* [Actions](/oamg/convert2rhel/actions)
* [Projects](/oamg/convert2rhel/projects)
* [Wiki](/oamg/convert2rhel/wiki)
* [Security](/oamg/convert2rhel/security)
* [Insights](/oamg/convert2rhel/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Foamg%2Fconvert2rhel%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Foamg%2Fconvert2rhel%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Do not put the subscription-manager password onto the command line. #492

 Merged

[bocekm](/bocekm)
merged 11 commits into
[oamg:main](/oamg/convert2rhel/tree/main "oamg/convert2rhel:main")
from
[abadger:fix-sub-mgr-cli-call](/abadger/convert2rhel/tree/fix-sub-mgr-cli-call "abadger/convert2rhel:fix-sub-mgr-cli-call")

May 27, 2022

 Merged

# [Do not put the subscription-manager password onto the command line.](#top) #492

[bocekm](/bocekm)
merged 11 commits into
[oamg:main](/oamg/convert2rhel/tree/main "oamg/convert2rhel:main")
from
[abadger:fix-sub-mgr-cli-call](/abadger/convert2rhel/tree/fix-sub-mgr-cli-call "abadger/convert2rhel:fix-sub-mgr-cli-call")

May 27, 2022

[Conversation
72](/oamg/convert2rhel/pull/492)
[Commits
11](/oamg/convert2rhel/pull/492/commits)
[Checks
0](/oamg/convert2rhel/pull/492/checks)
[Files changed](/oamg/convert2rhel/pull/492/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![abadger](https://avatars.githubusercontent.com/u/209242?s=60&v=4)](/abadger)

Copy link

Member

### @abadger **[abadger](/abadger)** commented [May 10, 2022](#issue-1230925913) • edited Loading

Passing values on the command line is insecure. With this change,

the rhsm password is passed interactively to subscription-manager

instead of being passed on the commandline when we shell out to it.

The structure of this change deserves a bit of description. Previously,

we called one function to assemble all of the information needed to

invoke subscription-manager and then returned that as a string that

could be run as a command line. We called a second function with that

string to actually run the command.

To send the password interactively, we need to stop adding the password

to the string of command line arguments but it still makes sense to keep

the code that figures out the password together with the code which

finds the other command line args. So it makes sense to keep a single

function to do that but return the password and other args separately.

We could use a dict, a class, or a tuple as the return value from the

function. That doesn't feel too ugly. But then we need to pass that

structure into the function which takes care of invoking

subscription-manager on the command line and that *does* feel ugly.

That function would have to care about the structure of the data we pass

in (If a tuple, what is the order? If a dict, what are the field

names?, etc). To take care of this, we can make the data structure that

we return from assembling the data a class and the function which calls

subscription-manager a method of that class because it's quite natural

for a method to have knowledge of what attributes the class contains.

Hmm... but now that we have a class with behaviours (methods), it starts

to feel like we could do some more things. A function that fills in the

values of a class, validates that the data is proper, and then returns

an instance of that class is really a constructor, right? So it makes

sense to move the function which assembles the data and returns the

class a constructor. But that particular function isn't very generic:

it uses knowledge of our global toolopts.tool\_opts to populate the

class. So let's write a simple **init**() that takes all of the values

needed as separate parameters and then create an alternative constructor

(an [@classmethod](https://github.com/classmethod) which returns an instance of the class) which gets the

data from a ToolOpt, and then calls **init**() with those values and

returns the resulting class.

Okay, things are much cleaner now, but there's one more thing that we

can do. We now have a class that has a constructor to read in data and

a single method that we can call to return some results. What do we

call an object that can be called to return a result? A function or

more generically, in python, a Callable. We can turn this class into a

callable by renaming the method which actually invokes

subscription-manager **call**().

What we have at the end of all this is a way to create a function which

knows about the settings in tool\_opts which we can then call to perform

our subscription-manager needs::

```
registration_command = RegistrationCommand.from_tool_opts()
return_code = registration_command()

```

OAMG-6551 #done convert2rhel now passes the rhsm password to subscription-manager securely.

* Modify the hiding of secret to hide both --password SECRET and

  --password=SECRET. Currently we only use it with passwords that we

  are passing in the second form (to subscription-manager) but catching

  both will future proof us in case we use this function for more things

  in the future. (Eric Gustavsson)

  + Note: using generator expressions was tried here but found that they

    only bind the variable being iterated over at definition time, the

    rest of the variables are bound when the generator is used. This

    means that constructing a set of generators in a loop doesn't really

    work as the loop variables that you use in the generator will have a

    different value by the time you're done.

    So a nested for loop and if-else is the way to implement this.
* Add a comment about activation\_key being insecure for now. We can fix

  this once subscription-manager implements <https://issues.redhat.com/browse/ENT-4724>

  (Eric Gustavsson)

Unittest enhancements for the subscription RegisterCommand change:

* Add global\_tool\_opts fixture to conftest.py which monkeypatches a

  fresh ToolOpts into convert2rhel.toolopts.tool\_opts. That way tests

  can modify that without worrying about polluting other tests.

  + How toolopts is imported in the code makes a difference whether this

    fixture is sufficient or if you need to do a little more work. If

    the import is::

    from convert2rhel import toolopts

    do\_something(toolopts.tool\_opts.username)

  then your test can just do::

  ```
  def test_thing_that_uses_toolopts(global_tool_opts):
      global_tool_opts.username = 'badger'

  ```

  Most of our code, though, imports like this::

  ```
  # In subscription.py, for instance
  from convert2rhel.toolopts import tool_opts
  do_something(tool_opts.username)

  ```

  so the tests should do something like this::

  ```
  def test_toolopts_differently(global_test_opts, monkeypatch):
      monkeypatch.setattr(subscription, 'tool_opts', global_tool_opts)

  ```
* Add unittests for utils.run\_cmd\_in\_pty()
* Add unittests for the subscription.RegistrationCommand object.
* subscription\_test.py::test\_hide\_secrets was expanded to test without

  equals sign
* Flaky test appeared within systeminfo\_test.py::test\_generate\_rpm\_va

  due to changes to tool\_opts in other tests. A temporary fix is added

  until the whole test class is changed from unittest to pytest
* Fix failing unittests for RegistrationCommand
* Sometimes a process will close stdout before it is done processing.

  When that happens, we need to wait() for the process to end before

  closing the pty. If we don't wait, the process will receive a HUP

  signal which may end it before it is done.

  + But on RHEL7, pexpect.wait() will throw an exception if you wait on

    an already finished process. So we need to ignore that exception

    there.
* Add integration test Check for cve fixes, add 'psutil' to

  install-testing-depends playbook
* Fix Pexpect.spawn truncating lines on RHEL7.

  Along with a comment on why the change fixes the bug.

Fixes: <https://issues.redhat.com/browse/RHELC-432>

Sorry, something went wrong.

All reactions

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [May 10, 2022](#issuecomment-1122194820) • edited Loading

|  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/oamg/convert2rhel/pull/492?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg) Report Merging [#492](https://codecov.io/gh/oamg/convert2rhel/pull/492?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg) ([960490a](https://github.com/oamg/convert2rhel/commit/960490a16daa9ffa4032703c1e7ed7de1d28271a)) into [main](https://codecov.io/gh/oamg/convert2rhel/commit/8658831de98488e6851f87a59de2aee81d31e592?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg) ([8658831](https://github.com/oamg/convert2rhel/commit/8658831de98488e6851f87a59de2aee81d31e592)) will **increase** coverage by `1.19%`. The diff coverage is `100.00%`.  ``` @@            Coverage Diff             @@ ##             main     #492      +/-   ## ========================================== + Coverage   82.46%   83.65%   +1.19%      ==========================================   Files          16       16                 Lines        2258     2319      +61        Branches      383      403      +20      ========================================== + Hits         1862     1940      +78      + Misses        331      314      -17        Partials       65       65               ```  | [Impacted Files](https://codecov.io/gh/oamg/convert2rhel/pull/492?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg) | Coverage Δ |  | | --- | --- | --- | | [convert2rhel/subscription.py](https://codecov.io/gh/oamg/convert2rhel/pull/492/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg#diff-Y29udmVydDJyaGVsL3N1YnNjcmlwdGlvbi5weQ==) | `83.80% <100.00%> (+3.27%)` | ⬆️ | | [convert2rhel/utils.py](https://codecov.io/gh/oamg/convert2rhel/pull/492/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg#diff-Y29udmVydDJyaGVsL3V0aWxzLnB5) | `69.69% <100.00%> (+5.91%)` | ⬆️ |   ---   [Continue to review full report at Codecov](https://codecov.io/gh/oamg/convert2rhel/pull/492?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg).  **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg) `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data` Powered by [Codecov](https://codecov.io/gh/oamg/convert2rhel/pull/492?src=pr&el=footer&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg). Last update [8658831...960490a](https://codecov.io/gh/oamg/convert2rhel/pull/492?src=pr&el=lastupdated&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=oamg). |

All reactions

Sorry, something went wrong.

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 10, 2022](#issuecomment-1122197484)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [18edac5](https://github.com/oamg/convert2rhel/commit/18edac5de1eec6ba3eb6ead84f2cf95d3497a2e6) into [23fe45a](https://github.com/oamg/convert2rhel/commit/23fe45aab3a1eee301a71ab835a60e11e74cd108) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-fecc39d980f8dec65c208f9f5b8b05fb7c2d4166)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=80&v=4)](/abadger)

Copy link

Member

Author

### **[abadger](/abadger)** commented [May 10, 2022](#issuecomment-1122204211)

| I believe the lgtm errors are false positives but I would appreciate it if someone else would take a look as lgtm is flagging them as security issues (revealing of private data). |
| --- |

All reactions

Sorry, something went wrong.

[![Venefilyn](https://avatars.githubusercontent.com/u/6598829?s=60&v=4)](/Venefilyn)

**[Venefilyn](/Venefilyn)**
reviewed
[May 10, 2022](#pullrequestreview-967632419)

 [View reviewed changes](/oamg/convert2rhel/pull/492/files)

[convert2rhel/utils.py](/oamg/convert2rhel/pull/492/files#diff-ed1ca2e4a8b27f1bee13d608562d4e94eceb2972790eccf4d84f366b750f221d)

Comment on lines
+238
 to
+240

|  |  | class PexpectSizedWindowSpawn(pexpect.spawn): |
| --- | --- | --- |
|  |  | # https://github.com/pexpect/pexpect/issues/134 |
|  |  | def setwinsize(self, rows, cols): |
|  |  | super(PexpectSizedWindowSpawn, self).setwinsize(rows, 120) |

Copy link

Member

### @Venefilyn **[Venefilyn](/Venefilyn)** [May 10, 2022](#discussion_r869144113)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

We're removing this workaround in [#475](https://github.com/oamg/convert2rhel/pull/475) for 0.27 and won't fix it for 0.26

Sorry, something went wrong.

All reactions

[![@Venefilyn](https://avatars.githubusercontent.com/u/6598829?s=80&u=0837b54ef07f2c1527af538e64195856bab54c3a&v=4)](/Venefilyn)

Copy link

Member

### **[Venefilyn](/Venefilyn)** commented [May 10, 2022](#issuecomment-1122396280)

| [@abadger](https://github.com/abadger) was there any difference between this and the patch? |
| --- |

All reactions

Sorry, something went wrong.

[![Venefilyn](https://avatars.githubusercontent.com/u/6598829?s=60&v=4)](/Venefilyn)

**[Venefilyn](/Venefilyn)**
reviewed
[May 10, 2022](#pullrequestreview-967855047)

 [View reviewed changes](/oamg/convert2rhel/pull/492/files)

Copy link

Member

### @Venefilyn **[Venefilyn](/Venefilyn)** left a comment • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The LGTM warnings seem like false positives

Sorry, something went wrong.

All reactions

[convert2rhel/subscription.py](/oamg/convert2rhel/pull/492/files#diff-51e9ff11d39778d3b26778b293fc350430a82e2feed0dab2938da7c0069ffdc6)
Outdated

Show resolved

Hide resolved

[convert2rhel/unit\_tests/subscription\_test.py](/oamg/convert2rhel/pull/492/files#diff-85aca69500c4cab553d197c040b272a598d62826cf671eb68743e12980becd49)
Outdated

Show resolved

Hide resolved

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=80&v=4)](/abadger)

Copy link

Member

Author

### **[abadger](/abadger)** commented [May 10, 2022](#issuecomment-1122531165)

| [@abadger](https://github.com/abadger) was there any difference between this and the patch?  There were quite a few conflicts (there have been changes from Rodolfo and Andrew which were merged after the patch was created) which I had to resolve. (I have asked both of them to take a look at this PR specifically to see whether their changes are still intact.) |
| --- |

All reactions

Sorry, something went wrong.

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 10, 2022](#issuecomment-1122543756)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [12dc446](https://github.com/oamg/convert2rhel/commit/12dc4464dff0dbb7ff5e1ef0b5ed66ac48b02772) into [23fe45a](https://github.com/oamg/convert2rhel/commit/23fe45aab3a1eee301a71ab835a60e11e74cd108) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-e10e37cbc105f066592481115738c433074f32f4)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 10, 2022](#issuecomment-1122559409)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [c2a1150](https://github.com/oamg/convert2rhel/commit/c2a115067aeff62cfa7d841c2df813d052652f9a) into [23fe45a](https://github.com/oamg/convert2rhel/commit/23fe45aab3a1eee301a71ab835a60e11e74cd108) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-617f6c3b3deabce2531ccdac1ebb073e9eb936c9)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 10, 2022](#issuecomment-1122612871)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [68e7ad8](https://github.com/oamg/convert2rhel/commit/68e7ad8d66389ecf41370bff57f80455713df864) into [23fe45a](https://github.com/oamg/convert2rhel/commit/23fe45aab3a1eee301a71ab835a60e11e74cd108) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-dbedc3db4109346fb783f6e05ac97615f6adb2ab)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

 [![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)
[abadger](/abadger)
[force-pushed](/oamg/convert2rhel/compare/68e7ad8d66389ecf41370bff57f80455713df864..085fb1157932d66efdab8c6a5797bd6304994392)
the
fix-sub-mgr-cli-call

branch
from
[`68e7ad8`](/oamg/convert2rhel/commit/68e7ad8d66389ecf41370bff57f80455713df864) to
[`085fb11`](/oamg/convert2rhel/commit/085fb1157932d66efdab8c6a5797bd6304994392)  [Compare](/oamg/convert2rhel/compare/68e7ad8d66389ecf41370bff57f80455713df864..085fb1157932d66efdab8c6a5797bd6304994392)
[May 10, 2022 17:14](#event-6583807757)

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 10, 2022](#issuecomment-1122669276)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [085fb11](https://github.com/oamg/convert2rhel/commit/085fb1157932d66efdab8c6a5797bd6304994392) into [23fe45a](https://github.com/oamg/convert2rhel/commit/23fe45aab3a1eee301a71ab835a60e11e74cd108) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-b19a9ff6cdbb75a8462553946857c48a1dfb210e)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![@r0x0d](https://avatars.githubusercontent.com/u/2881357?s=80&u=7e65f90e189e5f1d843239b022867d37f59a99c2&v=4)](/r0x0d)

Copy link

Member

### **[r0x0d](/r0x0d)** commented [May 10, 2022](#issuecomment-1122741878)

| [@abadger](https://github.com/abadger) was there any difference between this and the patch?  There were quite a few conflicts (there have been changes from Rodolfo and Andrew which were merged after the patch was created) which I had to resolve. (I have asked both of them to take a look at this PR specifically to see whether their changes are still intact.)  Looking at the changes right now. |
| --- |

All reactions

Sorry, something went wrong.

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 10, 2022](#issuecomment-1122799318)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [b26c1c6](https://github.com/oamg/convert2rhel/commit/b26c1c6faab69148a5c45a991dcb9aced1c20e25) into [23fe45a](https://github.com/oamg/convert2rhel/commit/23fe45aab3a1eee301a71ab835a60e11e74cd108) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-59eefce241239514ef1ee469d52ee4e919efe204)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

 [![@Venefilyn](https://avatars.githubusercontent.com/u/6598829?s=40&u=0837b54ef07f2c1527af538e64195856bab54c3a&v=4)](/Venefilyn)
[Venefilyn](/Venefilyn)
requested review from
[r0x0d](/r0x0d) and
[Andrew-ang9](/Andrew-ang9)
[May 11, 2022 09:06](#event-6588298171)

[![r0x0d](https://avatars.githubusercontent.com/u/2881357?s=60&v=4)](/r0x0d)

**[r0x0d](/r0x0d)**
previously approved these changes
[May 11, 2022](#pullrequestreview-969220722)

 [View reviewed changes](/oamg/convert2rhel/pull/492/files)

Copy link

Member

### @r0x0d **[r0x0d](/r0x0d)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@abadger](https://github.com/abadger) most of the changes I proposed here are more aesthetic ones, thus, feel free to accept or deny them!

In an overral, from what I remember from my code in `subscription.py`, everything looks fine with the modifications and merges you did, don't think you missed anything!

Sorry, something went wrong.

All reactions

[convert2rhel/subscription.py](/oamg/convert2rhel/pull/492/files#diff-51e9ff11d39778d3b26778b293fc350430a82e2feed0dab2938da7c0069ffdc6)
Outdated

Show resolved

Hide resolved

[convert2rhel/subscription.py](/oamg/convert2rhel/pull/492/files#diff-51e9ff11d39778d3b26778b293fc350430a82e2feed0dab2938da7c0069ffdc6)
Outdated

Show resolved

Hide resolved

[convert2rhel/subscription.py](/oamg/convert2rhel/pull/492/files#diff-51e9ff11d39778d3b26778b293fc350430a82e2feed0dab2938da7c0069ffdc6)
Outdated

Show resolved

Hide resolved

[convert2rhel/subscription.py](/oamg/convert2rhel/pull/492/files#diff-51e9ff11d39778d3b26778b293fc350430a82e2feed0dab2938da7c0069ffdc6)
Outdated

Show resolved

Hide resolved

[convert2rhel/subscription.py](/oamg/convert2rhel/pull/492/files#diff-51e9ff11d39778d3b26778b293fc350430a82e2feed0dab2938da7c0069ffdc6)
Outdated

Show resolved

Hide resolved

11 hidden conversations

Load more…

[convert2rhel/utils.py](/oamg/convert2rhel/pull/492/files#diff-ed1ca2e4a8b27f1bee13d608562d4e94eceb2972790eccf4d84f366b750f221d)
Outdated

Show resolved

Hide resolved

[convert2rhel/utils.py](/oamg/convert2rhel/pull/492/files#diff-ed1ca2e4a8b27f1bee13d608562d4e94eceb2972790eccf4d84f366b750f221d)
Outdated

Show resolved

Hide resolved

[plans/tier0.fmf](/oamg/convert2rhel/pull/492/files#diff-f492464e8c082d17dacf3c2fae94c1466c96b67e097b931c682e14e4dc334f92)

Show resolved

Hide resolved

[plans/tier0.fmf](/oamg/convert2rhel/pull/492/files#diff-f492464e8c082d17dacf3c2fae94c1466c96b67e097b931c682e14e4dc334f92)
Outdated

Show resolved

Hide resolved

[tests/integration/tier0/check-cve-2022-1662/main.fmf](/oamg/convert2rhel/pull/492/files#diff-527eaefe6b34c14ff3f13eb93ffbe6626b8716cbe8f75bc05a010461cb985def)
Outdated

Show resolved

Hide resolved

[![@r0x0d](https://avatars.githubusercontent.com/u/2881357?s=80&u=7e65f90e189e5f1d843239b022867d37f59a99c2&v=4)](/r0x0d)

Copy link

Member

### **[r0x0d](/r0x0d)** commented [May 11, 2022](#issuecomment-1123861705)

| Note: it was not an approval, I selected the `comment` option when submitting the review. Don't know what went wrong. |
| --- |

All reactions

Sorry, something went wrong.

 [![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)
[abadger](/abadger)
dismissed
[r0x0d](/r0x0d)’s [stale review](#pullrequestreview-969220722)
via
`[eeeabe1](/oamg/convert2rhel/commit/eeeabe1900ba6bbda900d9153a82203284b110d3)`
[May 11, 2022 20:45](#event-6593539866)

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 11, 2022](#issuecomment-1124288622)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [7cbe6a8](https://github.com/oamg/convert2rhel/commit/7cbe6a8c574a3b3477aa685fe9efac0ddc67d326) into [37b3a00](https://github.com/oamg/convert2rhel/commit/37b3a00995705dfd69d4f34d7beaecb933a9f180) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-7c05ebbaee9b0b77ca89c09e329bd7d1b709d055)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 11, 2022](#issuecomment-1124296086)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [0bf9ebb](https://github.com/oamg/convert2rhel/commit/0bf9ebb7bd68049a585dc0012efeaf6c192252b2) into [37b3a00](https://github.com/oamg/convert2rhel/commit/37b3a00995705dfd69d4f34d7beaecb933a9f180) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-53aef73212dbadd68df9c3e27bfc408ebeff5efd)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

 [![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)
[abadger](/abadger)
[force-pushed](/oamg/convert2rhel/compare/0bf9ebb7bd68049a585dc0012efeaf6c192252b2..5671a9433ada1b240de9752ea2be83fcaba60036)
the
fix-sub-mgr-cli-call

branch
from
[`0bf9ebb`](/oamg/convert2rhel/commit/0bf9ebb7bd68049a585dc0012efeaf6c192252b2) to
[`5671a94`](/oamg/convert2rhel/commit/5671a9433ada1b240de9752ea2be83fcaba60036)  [Compare](/oamg/convert2rhel/compare/0bf9ebb7bd68049a585dc0012efeaf6c192252b2..5671a9433ada1b240de9752ea2be83fcaba60036)
[May 11, 2022 21:26](#event-6593737267)

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 11, 2022](#issuecomment-1124319651)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [5671a94](https://github.com/oamg/convert2rhel/commit/5671a9433ada1b240de9752ea2be83fcaba60036) into [37b3a00](https://github.com/oamg/convert2rhel/commit/37b3a00995705dfd69d4f34d7beaecb933a9f180) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-ad2f4ffab7bbc1c39aa4bbc3a625cb4a04a70572)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![bocekm](https://avatars.githubusercontent.com/u/9884110?s=60&v=4)](/bocekm)

**[bocekm](/bocekm)**
previously approved these changes
[May 11, 2022](#pullrequestreview-970069838)

 [View reviewed changes](/oamg/convert2rhel/pull/492/files)

 [![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)
[abadger](/abadger)
dismissed
[bocekm](/bocekm)’s [stale review](#pullrequestreview-970069838)
via
`[e84faff](/oamg/convert2rhel/commit/e84faff4e2bb716b8daadce144619296dfaed2b9)`
[May 12, 2022 19:05](#event-6600770525)

 [![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)
[abadger](/abadger)
[force-pushed](/oamg/convert2rhel/compare/5671a9433ada1b240de9752ea2be83fcaba60036..e84faff4e2bb716b8daadce144619296dfaed2b9)
the
fix-sub-mgr-cli-call

branch
from
[`5671a94`](/oamg/convert2rhel/commit/5671a9433ada1b240de9752ea2be83fcaba60036) to
[`e84faff`](/oamg/convert2rhel/commit/e84faff4e2bb716b8daadce144619296dfaed2b9)  [Compare](/oamg/convert2rhel/compare/5671a9433ada1b240de9752ea2be83fcaba60036..e84faff4e2bb716b8daadce144619296dfaed2b9)
[May 12, 2022 19:05](#event-6600770535)

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=80&v=4)](/abadger)

Copy link

Member

Author

### **[abadger](/abadger)** commented [May 12, 2022](#issuecomment-1125330017)

| Rebased to pick up the fixes for ubi8 |
| --- |

All reactions

Sorry, something went wrong.

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)
[abadger](/abadger)
mentioned this pull request
[May 12, 2022](#ref-pullrequest-1197721185)

[[RHELC-570] Cleanup pexpect terminal size
#475](/oamg/convert2rhel/pull/475)
 Merged

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 12, 2022](#issuecomment-1125335218)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [e84faff](https://github.com/oamg/convert2rhel/commit/e84faff4e2bb716b8daadce144619296dfaed2b9) into [68bf0ac](https://github.com/oamg/convert2rhel/commit/68bf0acfe299f4001ac2d90a3539c4948678d0aa) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-0259a3f270430be6e810d248214be9b9f5c41f78)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 12, 2022](#issuecomment-1125506526)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [29ab9b8](https://github.com/oamg/convert2rhel/commit/29ab9b84499b76c7d2e6952f6925238f264790e0) into [68bf0ac](https://github.com/oamg/convert2rhel/commit/68bf0acfe299f4001ac2d90a3539c4948678d0aa) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-c49cc76bb0c45607e5e392ab19da13d625db26ff)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

12 hidden items

Load more…

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 16, 2022](#issuecomment-1127955961)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [36e0e98](https://github.com/oamg/convert2rhel/commit/36e0e98815c13f40468a3a244bbd1dbaa125de50) into [a921086](https://github.com/oamg/convert2rhel/commit/a921086c4ab400a8f5b36ee1efc6b6f4b27e7811) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-51dbbeb043002ebf939b8dc29f25f0fdda3ed507)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

 [![@danmyway](https://avatars.githubusercontent.com/u/8378124?s=40&u=1ef89af7ccef083cb2a8b8f8c27851990f8571c2&v=4)](/danmyway)
[danmyway](/danmyway)
[force-pushed](/oamg/convert2rhel/compare/36e0e98815c13f40468a3a244bbd1dbaa125de50..e9816db691b6c50be3a08b6a7a7ae6ba9d17ca96)
the
fix-sub-mgr-cli-call

branch
from
[`36e0e98`](/oamg/convert2rhel/commit/36e0e98815c13f40468a3a244bbd1dbaa125de50) to
[`e9816db`](/oamg/convert2rhel/commit/e9816db691b6c50be3a08b6a7a7ae6ba9d17ca96)  [Compare](/oamg/convert2rhel/compare/36e0e98815c13f40468a3a244bbd1dbaa125de50..e9816db691b6c50be3a08b6a7a7ae6ba9d17ca96)
[May 16, 2022 20:50](#event-6619316940)

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 16, 2022](#issuecomment-1128132100)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [e9816db](https://github.com/oamg/convert2rhel/commit/e9816db691b6c50be3a08b6a7a7ae6ba9d17ca96) into [a921086](https://github.com/oamg/convert2rhel/commit/a921086c4ab400a8f5b36ee1efc6b6f4b27e7811) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-64d0406dc182a5cca75de654523797890fa068bf)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 17, 2022](#issuecomment-1128301062)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [34fcd31](https://github.com/oamg/convert2rhel/commit/34fcd3195de89236fca116b0cbe2aea6d83818c8) into [a921086](https://github.com/oamg/convert2rhel/commit/a921086c4ab400a8f5b36ee1efc6b6f4b27e7811) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-a4e053c9870871700e4428a2a9a34f9dac595b0b)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![@danmyway](https://avatars.githubusercontent.com/u/8378124?s=80&u=1ef89af7ccef083cb2a8b8f8c27851990f8571c2&v=4)](/danmyway)

Copy link

Member

### **[danmyway](/danmyway)** commented [May 26, 2022](#issuecomment-1138256222)

| All tests have passed, [@bocekm](https://github.com/bocekm) |
| --- |

All reactions

Sorry, something went wrong.

[![@danmyway](https://avatars.githubusercontent.com/u/8378124?s=40&u=1ef89af7ccef083cb2a8b8f8c27851990f8571c2&v=4)](/danmyway)
[danmyway](/danmyway)
added
the
[need-final-approval](/oamg/convert2rhel/labels/need-final-approval)
label
[May 26, 2022](#event-6685251001)

[![bocekm](https://avatars.githubusercontent.com/u/9884110?s=60&v=4)](/bocekm)

**[bocekm](/bocekm)**
previously approved these changes
[May 26, 2022](#pullrequestreview-986206727)

 [View reviewed changes](/oamg/convert2rhel/pull/492/files)

[![@r0x0d](https://avatars.githubusercontent.com/u/2881357?s=80&u=7e65f90e189e5f1d843239b022867d37f59a99c2&v=4)](/r0x0d)

Copy link

Member

### **[r0x0d](/r0x0d)** commented [May 26, 2022](#issuecomment-1138588467)

| [@abadger](https://github.com/abadger) +1 for that toolopts fixture. |
| --- |

All reactions

Sorry, something went wrong.

[![r0x0d](https://avatars.githubusercontent.com/u/2881357?s=60&v=4)](/r0x0d)

**[r0x0d](/r0x0d)**
previously approved these changes
[May 26, 2022](#pullrequestreview-986275739)

 [View reviewed changes](/oamg/convert2rhel/pull/492/files)

 [abadger](/abadger)
and others
added 11 commits
[May 26, 2022 07:31](#commits-pushed-b312278)

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Do not put the subscription-manager password onto the command line.](/oamg/convert2rhel/pull/492/commits/b31227818bcecafa050e6167c5938e2d523873f8 "Do not put the subscription-manager password onto the command line.

Fixes CVE-2022-0852

Passing values on the command line is insecure.  With this change,
the rhsm password is passed interactively to subscription-manager
instead of being passed on the commandline when we shell out to it.

The structure of this change deserves a bit of description.  Previously,
we called one function to assemble all of the information needed to
invoke subscription-manager and then returned that as a string that
could be run as a command line.  We called a second function with that
string to actually run the command.

To send the password interactively, we need to stop adding the password
to the string of command line arguments but it still makes sense to keep
the code that figures out the password together with the code which
finds the other command line args.  So it makes sense to keep a single
function to do that but return the password and other args separately.

We could use a dict, a class, or a tuple as the return value from the
function.  That doesn't feel too ugly.  But then we need to pass that
structure into the function which takes care of invoking
subscription-manager on the command line and that *does* feel ugly.
That function would have to care about the structure of the data we pass
in (If a tuple, what is the order?  If a dict, what are the field
names?, etc).  To take care of this, we can make the data structure that
we return from assembling the data a class and the function which calls
subscription-manager a method of that class because it's quite natural
for a method to have knowledge of what attributes the class contains.

Hmm... but now that we have a class with behaviours (methods), it starts
to feel like we could do some more things.  A function that fills in the
values of a class, validates that the data is proper, and then returns
an instance of that class is really a constructor, right?  So it makes
sense to move the function which assembles the data and returns the
class a constructor.  But that particular function isn't very generic:
it uses knowledge of our global toolopts.tool_opts to populate the
class.  So let's write a simple __init__() that takes all of the values
needed as separate parameters and then create an alternative constructor
(an @classmethod which returns an instance of the class) which gets the
data from a ToolOpt, and then calls __init__() with those values and
returns the resulting class.

Okay, things are much cleaner now, but there's one more thing that we
can do.  We now have a class that has a constructor to read in data and
a single method that we can call to return some results.  What do we
call an object that can be called to return a result?  A function or
more generically, in python, a Callable.  We can turn this class into a
callable by renaming the method which actually invokes
subscription-manager __call__().

What we have at the end of all this is a way to create a function which
knows about the settings in tool_opts which we can then call to perform
our subscription-manager needs::

    registration_command = RegistrationCommand.from_tool_opts()
    return_code = registration_command()

OAMG-6551 #done  convert2rhel now passes the rhsm password to subscription-manager securely.

* Modify the hiding of secret to hide both --password SECRET and
  --password=SECRET.  Currently we only use it with passwords that we
  are passing in the second form (to subscription-manager) but catching
  both will future proof us in case we use this function for more things
  in the future. (Eric Gustavsson)
  * Note: using generator expressions was tried here but found that they
    only bind the variable being iterated over at definition time, the
    rest of the variables are bound when the generator is used.  This
    means that constructing a set of generators in a loop doesn't really
    work as the loop variables that you use in the generator will have a
    different value by the time you're done.

    So a nested for loop and if-else is the way to implement this.

* Add a comment about activation_key being insecure for now.  We can fix
  this once subscription-manager implements https://issues.redhat.com/browse/ENT-4724
  (Eric Gustavsson)

Unittest enhancements for the subscription RegisterCommand change:

* Add global_tool_opts fixture to conftest.py which monkeypatches a
  fresh ToolOpts into convert2rhel.toolopts.tool_opts.  That way tests
  can modify that without worrying about polluting other tests.

  * How toolopts is imported in the code makes a difference whether this
    fixture is sufficient or if you need to do a little more work. If
    the import is::

      from convert2rhel import toolopts
      do_something(toolopts.tool_opts.username)

   then your test can just do::

      def test_thing_that_uses_toolopts(global_tool_opts):
          global_tool_opts.username = 'badger'

   Most of our code, though, imports like this::

      # In subscription.py, for instance
      from convert2rhel.toolopts import tool_opts
      do_something(tool_opts.username)

   so the tests should do something like this::

      def test_toolopts_differently(global_test_opts, monkeypatch):
          monkeypatch.setattr(subscription, 'tool_opts', global_tool_opts)

* Add unittests for utils.run_cmd_in_pty()
* Add unittests for the subscription.RegistrationCommand object.
* subscription_test.py::test_hide_secrets was expanded to test without
  equals sign
* Flaky test appeared within systeminfo_test.py::test_generate_rpm_va
  due to changes to tool_opts in other tests. A temporary fix is added
  until the whole test class is changed from unittest to pytest
* Fix failing unittests for RegistrationCommand

* Sometimes a process will close stdout before it is done processing.
  When that happens, we need to wait() for the process to end before
  closing the pty.  If we don't wait, the process will receive a HUP
  signal which may end it before it is done.
  * But on RHEL7, pexpect.wait() will throw an exception if you wait on
    an already finished process.  So we need to ignore that exception
    there.

* Add integration test Check for cve fixes, add 'psutil' to
  install-testing-depends playbook

* Fix Pexpect.spawn truncating lines on RHEL7.
  Along with a comment on why the change fixes the bug.")`
 …

`[b312278](/oamg/convert2rhel/pull/492/commits/b31227818bcecafa050e6167c5938e2d523873f8)`

```
Fixes [CVE-2022-0852](https://github.com/advisories/GHSA-fjvj-w876-8mc2 "CVE-2022-0852")

Passing values on the command line is insecure.  With this change,
the rhsm password is passed interactively to subscription-manager
instead of being passed on the commandline when we shell out to it.

The structure of this change deserves a bit of description.  Previously,
we called one function to assemble all of the information needed to
invoke subscription-manager and then returned that as a string that
could be run as a command line.  We called a second function with that
string to actually run the command.

To send the password interactively, we need to stop adding the password
to the string of command line arguments but it still makes sense to keep
the code that figures out the password together with the code which
finds the other command line args.  So it makes sense to keep a single
function to do that but return the password and other args separately.

We could use a dict, a class, or a tuple as the return value from the
function.  That doesn't feel too ugly.  But then we need to pass that
structure into the function which takes care of invoking
subscription-manager on the command line and that *does* feel ugly.
That function would have to care about the structure of the data we pass
in (If a tuple, what is the order?  If a dict, what are the field
names?, etc).  To take care of this, we can make the data structure that
we return from assembling the data a class and the function which calls
subscription-manager a method of that class because it's quite natural
for a method to have knowledge of what attributes the class contains.

Hmm... but now that we have a class with behaviours (methods), it starts
to feel like we could do some more things.  A function that fills in the
values of a class, validates that the data is proper, and then returns
an instance of that class is really a constructor, right?  So it makes
sense to move the function which assembles the data and returns the
class a constructor.  But that particular function isn't very generic:
it uses knowledge of our global toolopts.tool_opts to populate the
class.  So let's write a simple __init__() that takes all of the values
needed as separate parameters and then create an alternative constructor
(an [@classmethod](https://github.com/classmethod) which returns an instance of the class) which gets the
data from a ToolOpt, and then calls __init__() with those values and
returns the resulting class.

Okay, things are much cleaner now, but there's one more thing that we
can do.  We now have a class that has a constructor to read in data and
a single method that we can call to return some results.  What do we
call an object that can be called to return a result?  A function or
more generically, in python, a Callable.  We can turn this class into a
callable by renaming the method which actually invokes
subscription-manager __call__().

What we have at the end of all this is a way to create a function which
knows about the settings in tool_opts which we can then call to perform
our subscription-manager needs::

    registration_command = RegistrationCommand.from_tool_opts()
    return_code = registration_command()

OAMG-6551 #done  convert2rhel now passes the rhsm password to subscription-manager securely.

* Modify the hiding of secret to hide both --password SECRET and
  --password=SECRET.  Currently we only use it with passwords that we
  are passing in the second form (to subscription-manager) but catching
  both will future proof us in case we use this function for more things
  in the future. (Eric Gustavsson)
  * Note: using generator expressions was tried here but found that they
    only bind the variable being iterated over at definition time, the
    rest of the variables are bound when the generator is used.  This
    means that constructing a set of generators in a loop doesn't really
    work as the loop variables that you use in the generator will have a
    different value by the time you're done.

    So a nested for loop and if-else is the way to implement this.

* Add a comment about activation_key being insecure for now.  We can fix
  this once subscription-manager implements <https://issues.redhat.com/browse/ENT-4724>
  (Eric Gustavsson)

Unittest enhancements for the subscription RegisterCommand change:

* Add global_tool_opts fixture to conftest.py which monkeypatches a
  fresh ToolOpts into convert2rhel.toolopts.tool_opts.  That way tests
  can modify that without worrying about polluting other tests.

  * How toolopts is imported in the code makes a difference whether this
    fixture is sufficient or if you need to do a little more work. If
    the import is::

      from convert2rhel import toolopts
      do_something(toolopts.tool_opts.username)

   then your test can just do::

      def test_thing_that_uses_toolopts(global_tool_opts):
          global_tool_opts.username = 'badger'

   Most of our code, though, imports like this::

      # In subscription.py, for instance
      from convert2rhel.toolopts import tool_opts
      do_something(tool_opts.username)

   so the tests should do something like this::

      def test_toolopts_differently(global_test_opts, monkeypatch):
          monkeypatch.setattr(subscription, 'tool_opts', global_tool_opts)

* Add unittests for utils.run_cmd_in_pty()
* Add unittests for the subscription.RegistrationCommand object.
* subscription_test.py::test_hide_secrets was expanded to test without
  equals sign
* Flaky test appeared within systeminfo_test.py::test_generate_rpm_va
  due to changes to tool_opts in other tests. A temporary fix is added
  until the whole test class is changed from unittest to pytest
* Fix failing unittests for RegistrationCommand

* Sometimes a process will close stdout before it is done processing.
  When that happens, we need to wait() for the process to end before
  closing the pty.  If we don't wait, the process will receive a HUP
  signal which may end it before it is done.
  * But on RHEL7, pexpect.wait() will throw an exception if you wait on
    an already finished process.  So we need to ignore that exception
    there.

* Add integration test Check for cve fixes, add 'psutil' to
  install-testing-depends playbook

* Fix Pexpect.spawn truncating lines on RHEL7.
  Along with a comment on why the change fixes the bug.
```

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Fix missing colon in testing farm metadata](/oamg/convert2rhel/pull/492/commits/e2d8992f75a1b9e47cbc9f47628b2e31a6b11a2d "Fix missing colon in testing farm metadata")`

`[e2d8992](/oamg/convert2rhel/pull/492/commits/e2d8992f75a1b9e47cbc9f47628b2e31a6b11a2d)`

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Ignore false positives from lgtm](/oamg/convert2rhel/pull/492/commits/09ec2529958e88f87eb36b35e75f088b20c29e96 "Ignore false positives from lgtm

lgtm is flagging some cases where it thinks we are logging sensitive
data.  Here's why we're ignoring lgtm:

* One case logs the username to the terminal as a hint for the user as
  to what account is being used.  We consider username to not be
  sensitive.
* One case logs the subscription-manager invocation.  We run the command
  line through hide_secrets() to remove private information when we do
  this.
* The last case logs which argument was passed to subscription-manager
  without a secret attached to it.  ie: \"--password\" is passed to
  subscription-manager without a password being added afterwards.  In
  this case, the string \"--password\" will be logged.")`
 …

`[09ec252](/oamg/convert2rhel/pull/492/commits/09ec2529958e88f87eb36b35e75f088b20c29e96)`

```
lgtm is flagging some cases where it thinks we are logging sensitive
data.  Here's why we're ignoring lgtm:

* One case logs the username to the terminal as a hint for the user as
  to what account is being used.  We consider username to not be
  sensitive.
* One case logs the subscription-manager invocation.  We run the command
  line through hide_secrets() to remove private information when we do
  this.
* The last case logs which argument was passed to subscription-manager
  without a secret attached to it.  ie: "--password" is passed to
  subscription-manager without a password being added afterwards.  In
  this case, the string "--password" will be logged.
```

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Update subscription-manager interaction to expect password or Password](/oamg/convert2rhel/pull/492/commits/a7ac4327a4293397c319926befb811afeaca250e "Update subscription-manager interaction to expect password or Password

* Use a regular expression to find either \"Password: \" or \"password: \"
  when waiting for subscription-manager to prompt for the rhsm password.
* Fix unittests that were using Mock.called_once_with().  That doesn't exist
  so the Mock() was translating it to a function that did nothing.
  Instead, use assert_called_once_with() which will assert if the Mock
  object was not called with the proper parameters.")`
 …

`[a7ac432](/oamg/convert2rhel/pull/492/commits/a7ac4327a4293397c319926befb811afeaca250e)`

```
* Use a regular expression to find either "Password: " or "password: "
  when waiting for subscription-manager to prompt for the rhsm password.
* Fix unittests that were using Mock.called_once_with().  That doesn't exist
  so the Mock() was translating it to a function that did nothing.
  Instead, use assert_called_once_with() which will assert if the Mock
  object was not called with the proper parameters.
```

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Rename cve integration test.](/oamg/convert2rhel/pull/492/commits/0220f842739c980042ddc150eacfc44e4dc04fe6 "Rename cve integration test.

Now that we know the cve number, use it in the name of the integration
test.")`
 …

`[0220f84](/oamg/convert2rhel/pull/492/commits/0220f842739c980042ddc150eacfc44e4dc04fe6)`

```
Now that we know the cve number, use it in the name of the integration
test.
```

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Apply changes from Rodolfo's code review.](/oamg/convert2rhel/pull/492/commits/2382f1d6bb94c0157ebb63b49fdf560d6641e122 "Apply changes from Rodolfo's code review.")`

`[2382f1d](/oamg/convert2rhel/pull/492/commits/2382f1d6bb94c0157ebb63b49fdf560d6641e122)`

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Add docstrings](/oamg/convert2rhel/pull/492/commits/77a04f6d867773dc0c412b83c72e14ad262dfabb "Add docstrings

Add docstrings for the RegistrationCommand.args properyy and
hide_secrets() function")`
 …

`[77a04f6](/oamg/convert2rhel/pull/492/commits/77a04f6d867773dc0c412b83c72e14ad262dfabb)`

```
Add docstrings for the RegistrationCommand.args properyy and
hide_secrets() function
```

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Fix sample password used in the integration test to not trigger gitle…](/oamg/convert2rhel/pull/492/commits/facbbcf789b81f77d0ddd5dd36cfd0ebaecaaf14 "Fix sample password used in the integration test to not trigger gitleaks.

gitleaks scans the repository for passwords which might have been
committed by accident.  Adding EXAMPLE to the password string should
allow gitleaks to recognize this as test data rather than a valid
credential.")`
 …

`[facbbcf](/oamg/convert2rhel/pull/492/commits/facbbcf789b81f77d0ddd5dd36cfd0ebaecaaf14)`

```
…aks.

gitleaks scans the repository for passwords which might have been
committed by accident.  Adding EXAMPLE to the password string should
allow gitleaks to recognize this as test data rather than a valid
credential.
```

[![@danmyway](https://avatars.githubusercontent.com/u/8378124?s=40&v=4)](/danmyway) [![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Edit testing dependencies playbook](/oamg/convert2rhel/pull/492/commits/564ec4eb6548b5741379e36001effb9a07da57cc "Edit testing dependencies playbook

Testing farm doesn't have python-devel installed.
We need that to install psutil needed as a testing dependency.

Edit test_user_response, as one of the child.expect_exact() is not
configured right.")`
 …

`[564ec4e](/oamg/convert2rhel/pull/492/commits/564ec4eb6548b5741379e36001effb9a07da57cc)`

```
Testing farm doesn't have python-devel installed.
We need that to install psutil needed as a testing dependency.

Edit test_user_response, as one of the child.expect_exact() is not
configured right.
```

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Add comment about why FakeSpawn in unittests is not global](/oamg/convert2rhel/pull/492/commits/df1b793311dafa11fa16d604d1b2ef9e4f3419e1 "Add comment about why FakeSpawn in unittests is not global

Would need to be made a bit more generic before making it available to
all tests.")`
 …

`[df1b793](/oamg/convert2rhel/pull/492/commits/df1b793311dafa11fa16d604d1b2ef9e4f3419e1)`

```
Would need to be made a bit more generic before making it available to
all tests.
```

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)

`[Implement .gitleaks.toml to ignore gitleaks false positive.](/oamg/convert2rhel/pull/492/commits/960490a16daa9ffa4032703c1e7ed7de1d28271a "Implement .gitleaks.toml to ignore gitleaks false positive.

gitleaks continues to warn about passwords in the repo.  Use .gitleaks
to specify that the passwords in the test file are not valid and should
not be warned about.")`
 …

`[960490a](/oamg/convert2rhel/pull/492/commits/960490a16daa9ffa4032703c1e7ed7de1d28271a)`

```
gitleaks continues to warn about passwords in the repo.  Use .gitleaks
to specify that the passwords in the test file are not valid and should
not be warned about.
```

 [![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)
[abadger](/abadger)
dismissed stale reviews from [r0x0d](/r0x0d) and [bocekm](/bocekm)
via
`[960490a](/oamg/convert2rhel/commit/960490a16daa9ffa4032703c1e7ed7de1d28271a)`
[May 26, 2022 14:34](#event-6686133833)

 [![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)
[abadger](/abadger)
[force-pushed](/oamg/convert2rhel/compare/34fcd3195de89236fca116b0cbe2aea6d83818c8..960490a16daa9ffa4032703c1e7ed7de1d28271a)
the
fix-sub-mgr-cli-call

branch
from
[`34fcd31`](/oamg/convert2rhel/commit/34fcd3195de89236fca116b0cbe2aea6d83818c8) to
[`960490a`](/oamg/convert2rhel/commit/960490a16daa9ffa4032703c1e7ed7de1d28271a)  [Compare](/oamg/convert2rhel/compare/34fcd3195de89236fca116b0cbe2aea6d83818c8..960490a16daa9ffa4032703c1e7ed7de1d28271a)
[May 26, 2022 14:34](#event-6686133848)

[![r0x0d](https://avatars.githubusercontent.com/u/2881357?s=60&v=4)](/r0x0d)

**[r0x0d](/r0x0d)**
approved these changes
[May 26, 2022](#pullrequestreview-986317378)

 [View reviewed changes](/oamg/convert2rhel/pull/492/files/960490a16daa9ffa4032703c1e7ed7de1d28271a)

[![@lgtm-com](https://avatars.githubusercontent.com/in/17324?s=80&v=4)](/apps/lgtm-com)

Copy link

Contributor

### **[lgtm-com](/apps/lgtm-com) bot** commented [May 26, 2022](#issuecomment-1138659713)

| This pull request **introduces 3 alerts** and **fixes 1** when merging [960490a](https://github.com/oamg/convert2rhel/commit/960490a16daa9ffa4032703c1e7ed7de1d28271a) into [8658831](https://github.com/oamg/convert2rhel/commit/8658831de98488e6851f87a59de2aee81d31e592) - [view on LGTM.com](https://lgtm.com/projects/g/oamg/convert2rhel/rev/pr-a22b253f92462678ff3802018b6383adf41a47da)  **new alerts:**   * 3 for Clear-text logging of sensitive information   **fixed alerts:**   * 1 for Clear-text logging of sensitive information |
| --- |

All reactions

Sorry, something went wrong.

[![@bocekm](https://avatars.githubusercontent.com/u/9884110?s=40&u=15bfa3e939e28edeae18670819a44461d9b0d54e&v=4)](/bocekm)
[bocekm](/bocekm)
merged commit [`8d72fb0`](/oamg/convert2rhel/commit/8d72fb030ed31116fdb256b327d299337b000af4)
into
oamg:main

[May 27, 2022](https://github.com/oamg/convert2rhel/pull/492#event-6690476581)

[r0x0d](/r0x0d)
pushed a commit
to r0x0d/convert2rhel
that referenced
this pull request
[Jun 1, 2022](#ref-commit-00e1f6f)
[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger) [![@danmyway](https://avatars.githubusercontent.com/u/8378124?s=40&u=1ef89af7ccef083cb2a8b8f8c27851990f8571c2&v=4)](/danmyway) [![@r0x0d](https://avatars.githubusercontent.com/u/2881357?s=40&v=4)](/r0x0d)

`[Do not put the subscription-manager password onto the command line. (](/r0x0d/convert2rhel/commit/00e1f6fb98bf0e6d9a0fcd9563ec6a660aabcba2 "Do not put the subscription-manager password onto the command line. (#492)

* Do not put the subscription-manager password onto the command line.

Fixes CVE-2022-0852

Passing values on the command line is insecure.  With this change,
the rhsm password is passed interactively to subscription-manager
instead of being passed on the commandline when we shell out to it.

The structure of this change deserves a bit of description.  Previously,
we called one function to assemble all of the information needed to
invoke subscription-manager and then returned that as a string that
could be run as a command line.  We called a second function with that
string to actually run the command.

To send the password interactively, we need to stop adding the password
to the string of command line arguments but it still makes sense to keep
the code that figures out the password together with the code which
finds the other command line args.  So it makes sense to keep a single
function to do that but return the password and other args separately.

We could use a dict, a class, or a tuple as the return value from the
function.  That doesn't feel too ugly.  But then we need to pass that
structure into the function which takes care of invoking
subscription-manager on the command line and that *does* feel ugly.
That function would have to care about the structure of the data we pass
in (If a tuple, what is the order?  If a dict, what are the field
names?, etc).  To take care of this, we can make the data structure that
we return from assembling the data a class and the function which calls
subscription-manager a method of that class because it's quite natural
for a method to have knowledge of what attributes the class contains.

Hmm... but now that we have a class with behaviours (methods), it starts
to feel like we could do some more things.  A function that fills in the
values of a class, validates that the data is proper, and then returns
an instance of that class is really a constructor, right?  So it makes
sense to move the function which assembles the data and returns the
class a constructor.  But that particular function isn't very generic:
it uses knowledge of our global toolopts.tool_opts to populate the
class.  So let's write a simple __init__() that takes all of the values
needed as separate parameters and then create an alternative constructor
(an @classmethod which returns an instance of the class) which gets the
data from a ToolOpt, and then calls __init__() with those values and
returns the resulting class.

Okay, things are much cleaner now, but there's one more thing that we
can do.  We now have a class that has a constructor to read in data and
a single method that we can call to return some results.  What do we
call an object that can be called to return a result?  A function or
more generically, in python, a Callable.  We can turn this class into a
callable by renaming the method which actually invokes
subscription-manager __call__().

What we have at the end of all this is a way to create a function which
knows about the settings in tool_opts which we can then call to perform
our subscription-manager needs::

    registration_command = RegistrationCommand.from_tool_opts()
    return_code = registration_command()

OAMG-6551 #done  convert2rhel now passes the rhsm password to subscription-manager securely.

* Modify the hiding of secret to hide both --password SECRET and
  --password=SECRET.  Currently we only use it with passwords that we
  are passing in the second form (to subscription-manager) but catching
  both will future proof us in case we use this function for more things
  in the future. (Eric Gustavsson)
  * Note: using generator expressions was tried here but found that they
    only bind the variable being iterated over at definition time, the
    rest of the variables are bound when the generator is used.  This
    means that constructing a set of generators in a loop doesn't really
    work as the loop variables that you use in the generator will have a
    different value by the time you're done.

    So a nested for loop and if-else is the way to implement this.

* Add global_tool_opts fixture to conftest.py which monkeypatches a
  fresh ToolOpts into convert2rhel.toolopts.tool_opts.  That way tests
  can modify that without worrying about polluting other tests.

  * How toolopts is imported in the code makes a difference whether this
    fixture is sufficient or if you need to do a little more work. If
    the import is::

      from convert2rhel import toolopts
      do_something(toolopts.tool_opts.username)

   then your test can just do::

      def test_thing_that_uses_toolopts(global_tool_opts):
          global_tool_opts.username = 'badger'

   Most of our code, though, imports like this::

      # In subscription.py, for instance
      from convert2rhel.toolopts import tool_opts
      do_something(tool_opts.username)

   so the tests should do something like this::

      def test_toolopts_differently(global_test_opts, monkeypatch):
          monkeypatch.setattr(subscription, 'tool_opts', global_tool_opts)

* Sometimes a process will close stdout before it is done processing.
  When that happens, we need to wait() for the process to end before
  closing the pty.  If we don't wait, the process will receive a HUP
  signal which may end it before it is done.
  * But on RHEL7, pexpect.wait() will throw an exception if you wait on
    an already finished process.  So we need to ignore that exception
    there.

lgtm is flagging some cases where it thinks we are logging sensitive
data.  Here's why we're ignoring lgtm:

* One case logs the username to the terminal as a hint for the user as
  to what account is being used.  We consider username to not be
  sensitive.
* One case logs the subscription-manager invocation.  We run the command
  line through hide_secrets() to remove private information when we do
  this.
* The last case logs which argument was passed to subscription-manager
  without a secret attached to it.  ie: \"--password\" is passed to
  subscription-manager without a password being added afterwards.  In
  this case, the string \"--password\" will be logged.

Testing farm doesn't have python-devel installed.
We need that to install psutil needed as a testing dependency.

Co-authored-by: Daniel Diblik <ddiblik@redhat.com>")[o…](https://github.com/oamg/convert2rhel/pull/492)`
…

`[00e1f6f](/r0x0d/convert2rhel/commit/00e1f6fb98bf0e6d9a0fcd9563ec6a660aabcba2)`

```
[…amg#492](https://github.com/oamg/convert2rhel/pull/492))

* Do not put the subscription-manager password onto the command line.

Fixes [CVE-2022-0852](https://github.com/advisories/GHSA-fjvj-w876-8mc2 "CVE-2022-0852")

Passing values on the command line is insecure.  With this change,
the rhsm password is passed interactively to subscription-manager
instead of being passed on the commandline when we shell out to it.

The structure of this change deserves a bit of description.  Previously,
we called one function to assemble all of the information needed to
invoke subscription-manager and then returned that as a string that
could be run as a command line.  We called a second function with that
string to actually run the command.

To send the password interactively, we need to stop adding the password
to the string of command line arguments but it still makes sense to keep
the code that figures out the password together with the code which
finds the other command line args.  So it makes sense to keep a single
function to do that but return the password and other args separately.

We could use a dict, a class, or a tuple as the return value from the
function.  That doesn't feel too ugly.  But then we need to pass that
structure into the function which takes care of invoking
subscription-manager on the command line and that *does* feel ugly.
That function would have to care about the structure of the data we pass
in (If a tuple, what is the order?  If a dict, what are the field
names?, etc).  To take care of this, we can make the data structure that
we return from assembling the data a class and the function which calls
subscription-manager a method of that class because it's quite natural
for a method to have knowledge of what attributes the class contains.

Hmm... but now that we have a class with behaviours (methods), it starts
to feel like we could do some more things.  A function that fills in the
values of a class, validates that the data is proper, and then returns
an instance of that class is really a constructor, right?  So it makes
sense to move the function which assembles the data and returns the
class a constructor.  But that particular function isn't very generic:
it uses knowledge of our global toolopts.tool_opts to populate the
class.  So let's write a simple __init__() that takes all of the values
needed as separate parameters and then create an alternative constructor
(an [@classmethod](https://github.com/classmethod) which returns an instance of the class) which gets the
data from a ToolOpt, and then calls __init__() with those values and
returns the resulting class.

Okay, things are much cleaner now, but there's one more thing that we
can do.  We now have a class that has a constructor to read in data and
a single method that we can call to return some results.  What do we
call an object that can be called to return a result?  A function or
more generically, in python, a Callable.  We can turn this class into a
callable by renaming the method which actually invokes
subscription-manager __call__().

What we have at the end of all this is a way to create a function which
knows about the settings in tool_opts which we can then call to perform
our subscription-manager needs::

    registration_command = RegistrationCommand.from_tool_opts()
    return_code = registration_command()

OAMG-6551 #done  convert2rhel now passes the rhsm password to subscription-manager securely.

* Modify the hiding of secret to hide both --password SECRET and
  --password=SECRET.  Currently we only use it with passwords that we
  are passing in the second form (to subscription-manager) but catching
  both will future proof us in case we use this function for more things
  in the future. (Eric Gustavsson)
  * Note: using generator expressions was tried here but found that they
    only bind the variable being iterated over at definition time, the
    rest of the variables are bound when the generator is used.  This
    means that constructing a set of generators in a loop doesn't really
    work as the loop variables that you use in the generator will have a
    different value by the time you're done.

    So a nested for loop and if-else is the way to implement this.

* Add global_tool_opts fixture to conftest.py which monkeypatches a
  fresh ToolOpts into convert2rhel.toolopts.tool_opts.  That way tests
  can modify that without worrying about polluting other tests.

  * How toolopts is imported in the code makes a difference whether this
    fixture is sufficient or if you need to do a little more work. If
    the import is::

      from convert2rhel import toolopts
      do_something(toolopts.tool_opts.username)

   then your test can just do::

      def test_thing_that_uses_toolopts(global_tool_opts):
          global_tool_opts.username = 'badger'

   Most of our code, though, imports like this::

      # In subscription.py, for instance
      from convert2rhel.toolopts import tool_opts
      do_something(tool_opts.username)

   so the tests should do something like this::

      def test_toolopts_differently(global_test_opts, monkeypatch):
          monkeypatch.setattr(subscription, 'tool_opts', global_tool_opts)

* Sometimes a process will close stdout before it is done processing.
  When that happens, we need to wait() for the process to end before
  closing the pty.  If we don't wait, the process will receive a HUP
  signal which may end it before it is done.
  * But on RHEL7, pexpect.wait() will throw an exception if you wait on
    an already finished process.  So we need to ignore that exception
    there.

lgtm is flagging some cases where it thinks we are logging sensitive
data.  Here's why we're ignoring lgtm:

* One case logs the username to the terminal as a hint for the user as
  to what account is being used.  We consider username to not be
  sensitive.
* One case logs the subscription-manager invocation.  We run the command
  line through hide_secrets() to remove private information when we do
  this.
* The last case logs which argument was passed to subscription-manager
  without a secret attached to it.  ie: "--password" is passed to
  subscription-manager without a password being added afterwards.  In
  this case, the string "--password" will be logged.

Testing farm doesn't have python-devel installed.
We need that to install psutil needed as a testing dependency.

Co-authored-by: Daniel Diblik <ddiblik@redhat.com>
```

[![@Venefilyn](https://avatars.githubusercontent.com/u/6598829?s=40&u=0837b54ef07f2c1527af538e64195856bab54c3a&v=4)](/Venefilyn)
[Venefilyn](/Venefilyn)
mentioned this pull request
[Jun 3, 2022](#ref-pullrequest-1259862471)

[Bump version to 0.26
#506](/oamg/convert2rhel/pull/506)
 Merged

[Andrew-ang9](/Andrew-ang9)
pushed a commit
to Andrew-ang9/convert2rhel
that referenced
this pull request
[Jun 17, 2022](#ref-commit-d698b01)
[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger) [![@danmyway](https://avatars.githubusercontent.com/u/8378124?s=40&u=1ef89af7ccef083cb2a8b8f8c27851990f8571c2&v=4)](/danmyway) [![@Andrew-ang9](https://avatars.githubusercontent.com/u/91086569?s=40&v=4)](/Andrew-ang9)

`[Do not put the subscription-manager password onto the command line. (](/Andrew-ang9/convert2rhel/commit/d698b01c534264eb091d18d3194322d2240389d4 "Do not put the subscription-manager password onto the command line. (#492)

* Do not put the subscription-manager password onto the command line.

Fixes CVE-2022-0852

Passing values on the command line is insecure.  With this change,
the rhsm password is passed interactively to subscription-manager
instead of being passed on the commandline when we shell out to it.

The structure of this change deserves a bit of description.  Previously,
we called one function to assemble all of the information needed to
invoke subscription-manager and then returned that as a string that
could be run as a command line.  We called a second function with that
string to actually run the command.

To send the password interactively, we need to stop adding the password
to the string of command line arguments but it still makes sense to keep
the code that figures out the password together with the code which
finds the other command line args.  So it makes sense to keep a single
function to do that but return the password and other args separately.

We could use a dict, a class, or a tuple as the return value from the
function.  That doesn't feel too ugly.  But then we need to pass that
structure into the function which takes care of invoking
subscription-manager on the command line and that *does* feel ugly.
That function would have to care about the structure of the data we pass
in (If a tuple, what is the order?  If a dict, what are the field
names?, etc).  To take care of this, we can make the data structure that
we return from assembling the data a class and the function which calls
subscription-manager a method of that class because it's quite natural
for a method to have knowledge of what attributes the class contains.

Hmm... but now that we have a class with behaviours (methods), it starts
to feel like we could do some more things.  A function that fills in the
values of a class, validates that the data is proper, and then returns
an instance of that class is really a constructor, right?  So it makes
sense to move the function which assembles the data and returns the
class a constructor.  But that particular function isn't very generic:
it uses knowledge of our global toolopts.tool_opts to populate the
class.  So let's write a simple __init__() that takes all of the values
needed as separate parameters and then create an alternative constructor
(an @classmethod which returns an instance of the class) which gets the
data from a ToolOpt, and then calls __init__() with those values and
returns the resulting class.

Okay, things are much cleaner now, but there's one more thing that we
can do.  We now have a class that has a constructor to read in data and
a single method that we can call to return some results.  What do we
call an object that can be called to return a result?  A function or
more generically, in python, a Callable.  We can turn this class into a
callable by renaming the method which actually invokes
subscription-manager __call__().

What we have at the end of all this is a way to create a function which
knows about the settings in tool_opts which we can then call to perform
our subscription-manager needs::

    registration_command = RegistrationCommand.from_tool_opts()
    return_code = registration_command()

OAMG-6551 #done  convert2rhel now passes the rhsm password to subscription-manager securely.

* Modify the hiding of secret to hide both --password SECRET and
  --password=SECRET.  Currently we only use it with passwords that we
  are passing in the second form (to subscription-manager) but catching
  both will future proof us in case we use this function for more things
  in the future. (Eric Gustavsson)
  * Note: using generator expressions was tried here but found that they
    only bind the variable being iterated over at definition time, the
    rest of the variables are bound when the generator is used.  This
    means that constructing a set of generators in a loop doesn't really
    work as the loop variables that you use in the generator will have a
    different value by the time you're done.

    So a nested for loop and if-else is the way to implement this.

* Add global_tool_opts fixture to conftest.py which monkeypatches a
  fresh ToolOpts into convert2rhel.toolopts.tool_opts.  That way tests
  can modify that without worrying about polluting other tests.

  * How toolopts is imported in the code makes a difference whether this
    fixture is sufficient or if you need to do a little more work. If
    the import is::

      from convert2rhel import toolopts
      do_something(toolopts.tool_opts.username)

   then your test can just do::

      def test_thing_that_uses_toolopts(global_tool_opts):
          global_tool_opts.username = 'badger'

   Most of our code, though, imports like this::

      # In subscription.py, for instance
      from convert2rhel.toolopts import tool_opts
      do_something(tool_opts.username)

   so the tests should do something like this::

      def test_toolopts_differently(global_test_opts, monkeypatch):
          monkeypatch.setattr(subscription, 'tool_opts', global_tool_opts)

* Sometimes a process will close stdout before it is done processing.
  When that happens, we need to wait() for the process to end before
  closing the pty.  If we don't wait, the process will receive a HUP
  signal which may end it before it is done.
  * But on RHEL7, pexpect.wait() will throw an exception if you wait on
    an already finished process.  So we need to ignore that exception
    there.

lgtm is flagging some cases where it thinks we are logging sensitive
data.  Here's why we're ignoring lgtm:

* One case logs the username to the terminal as a hint for the user as
  to what account is being used.  We consider username to not be
  sensitive.
* One case logs the subscription-manager invocation.  We run the command
  line through hide_secrets() to remove private information when we do
  this.
* The last case logs which argument was passed to subscription-manager
  without a secret attached to it.  ie: \"--password\" is passed to
  subscription-manager without a password being added afterwards.  In
  this case, the string \"--password\" will be logged.

Testing farm doesn't have python-devel installed.
We need that to install psutil needed as a testing dependency.

Co-authored-by: Daniel Diblik <ddiblik@redhat.com>")[o…](https://github.com/oamg/convert2rhel/pull/492)`
…

`[d698b01](/Andrew-ang9/convert2rhel/commit/d698b01c534264eb091d18d3194322d2240389d4)`

```
[…amg#492](https://github.com/oamg/convert2rhel/pull/492))

* Do not put the subscription-manager password onto the command line.

Fixes [CVE-2022-0852](https://github.com/advisories/GHSA-fjvj-w876-8mc2 "CVE-2022-0852")

Passing values on the command line is insecure.  With this change,
the rhsm password is passed interactively to subscription-manager
instead of being passed on the commandline when we shell out to it.

The structure of this change deserves a bit of description.  Previously,
we called one function to assemble all of the information needed to
invoke subscription-manager and then returned that as a string that
could be run as a command line.  We called a second function with that
string to actually run the command.

To send the password interactively, we need to stop adding the password
to the string of command line arguments but it still makes sense to keep
the code that figures out the password together with the code which
finds the other command line args.  So it makes sense to keep a single
function to do that but return the password and other args separately.

We could use a dict, a class, or a tuple as the return value from the
function.  That doesn't feel too ugly.  But then we need to pass that
structure into the function which takes care of invoking
subscription-manager on the command line and that *does* feel ugly.
That function would have to care about the structure of the data we pass
in (If a tuple, what is the order?  If a dict, what are the field
names?, etc).  To take care of this, we can make the data structure that
we return from assembling the data a class and the function which calls
subscription-manager a method of that class because it's quite natural
for a method to have knowledge of what attributes the class contains.

Hmm... but now that we have a class with behaviours (methods), it starts
to feel like we could do some more things.  A function that fills in the
values of a class, validates that the data is proper, and then returns
an instance of that class is really a constructor, right?  So it makes
sense to move the function which assembles the data and returns the
class a constructor.  But that particular function isn't very generic:
it uses knowledge of our global toolopts.tool_opts to populate the
class.  So let's write a simple __init__() that takes all of the values
needed as separate parameters and then create an alternative constructor
(an [@classmethod](https://github.com/classmethod) which returns an instance of the class) which gets the
data from a ToolOpt, and then calls __init__() with those values and
returns the resulting class.

Okay, things are much cleaner now, but there's one more thing that we
can do.  We now have a class that has a constructor to read in data and
a single method that we can call to return some results.  What do we
call an object that can be called to return a result?  A function or
more generically, in python, a Callable.  We can turn this class into a
callable by renaming the method which actually invokes
subscription-manager __call__().

What we have at the end of all this is a way to create a function which
knows about the settings in tool_opts which we can then call to perform
our subscription-manager needs::

    registration_command = RegistrationCommand.from_tool_opts()
    return_code = registration_command()

OAMG-6551 #done  convert2rhel now passes the rhsm password to subscription-manager securely.

* Modify the hiding of secret to hide both --password SECRET and
  --password=SECRET.  Currently we only use it with passwords that we
  are passing in the second form (to subscription-manager) but catching
  both will future proof us in case we use this function for more things
  in the future. (Eric Gustavsson)
  * Note: using generator expressions was tried here but found that they
    only bind the variable being iterated over at definition time, the
    rest of the variables are bound when the generator is used.  This
    means that constructing a set of generators in a loop doesn't really
    work as the loop variables that you use in the generator will have a
    different value by the time you're done.

    So a nested for loop and if-else is the way to implement this.

* Add global_tool_opts fixture to conftest.py which monkeypatches a
  fresh ToolOpts into convert2rhel.toolopts.tool_opts.  That way tests
  can modify that without worrying about polluting other tests.

  * How toolopts is imported in the code makes a difference whether this
    fixture is sufficient or if you need to do a little more work. If
    the import is::

      from convert2rhel import toolopts
      do_something(toolopts.tool_opts.username)

   then your test can just do::

      def test_thing_that_uses_toolopts(global_tool_opts):
          global_tool_opts.username = 'badger'

   Most of our code, though, imports like this::

      # In subscription.py, for instance
      from convert2rhel.toolopts import tool_opts
      do_something(tool_opts.username)

   so the tests should do something like this::

      def test_toolopts_differently(global_test_opts, monkeypatch):
          monkeypatch.setattr(subscription, 'tool_opts', global_tool_opts)

* Sometimes a process will close stdout before it is done processing.
  When that happens, we need to wait() for the process to end before
  closing the pty.  If we don't wait, the process will receive a HUP
  signal which may end it before it is done.
  * But on RHEL7, pexpect.wait() will throw an exception if you wait on
    an already finished process.  So we need to ignore that exception
    there.

lgtm is flagging some cases where it thinks we are logging sensitive
data.  Here's why we're ignoring lgtm:

* One case logs the username to the terminal as a hint for the user as
  to what account is being used.  We consider username to not be
  sensitive.
* One case logs the subscription-manager invocation.  We run the command
  line through hide_secrets() to remove private information when we do
  this.
* The last case logs which argument was passed to subscription-manager
  without a secret attached to it.  ie: "--password" is passed to
  subscription-manager without a password being added afterwards.  In
  this case, the string "--password" will be logged.

Testing farm doesn't have python-devel installed.
We need that to install psutil needed as a testing dependency.

Co-authored-by: Daniel Diblik <ddiblik@redhat.com>
```

 [![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger)
[abadger](/abadger)
deleted the
fix-sub-mgr-cli-call

branch
[July 21, 2022 17:06](#event-7040079452)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Foamg%2Fconvert2rhel%2Fpull%2F492)

Reviewers

[![@Venefilyn](https://avatars.githubusercontent.com/u/6598829?s=40&v=4)](/Venefilyn) [Venefilyn](/Venefilyn)

Venefilyn left review comments

[![@r0x0d](https://avatars.githubusercontent.com/u/2881357?s=40&v=4)](/r0x0d) [r0x0d](/r0x0d)

r0x0d approved these changes

[![@bocekm](https://avatars.githubusercontent.com/u/9884110?s=40&v=4)](/bocekm) [bocekm](/bocekm)

bocekm left review comments

[![@Andrew-ang9](https://avatars.githubusercontent.com/u/91086569?s=40&v=4)](/Andrew-ang9) [Andrew-ang9](/Andrew-ang9)

 Awaiting requested review from Andrew-ang9

Assignees

No one assigned

Labels

[need-final-approval](/oamg/convert2rhel/labels/need-final-approval)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

5 participants

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=52&v=4)](/abadger) [![@Venefilyn](https://avatars.githubusercontent.com/u/6598829?s=52&v=4)](/Venefilyn) [![@r0x0d](https://avatars.githubusercontent.com/u/2881357?s=52&v=4)](/r0x0d) [![@danmyway](https://avatars.githubusercontent.com/u/8378124?s=52&v=4)](/danmyway) [![@bocekm](https://avatars.githubusercontent.com/u/9884110?s=52&v=4)](/bocekm)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from issues.redhat.com_e91a122c_20250114_181746.html ===


[Log in](/login.jsp?os_destination=%2Fbrowse%2FRHELC-432)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoading…[![Red Hat Issue Tracker](/s/ohohy8/9120015/10le950/_/jira-logo-scaled.png)](https://issues.redhat.com/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* [Help](https://docs.atlassian.com/jira/jcore-docs-0912/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-0912/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FRHELC-432)
* [Sign Up](https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/registrations?client_id=redhat-jira-confluence-registration&redirect_uri=https%3A%2F%2Fissues.redhat.com&response_type=code&scope=openid/register?service=https%3A%2F%2Fissues.redhat.com)

![Uploaded image for project: 'RHEL Conversions'](https://issues.redhat.com/secure/projectavatar?pid=12332030&avatarId=12567)

1. [RHEL Conversions](/browse/RHELC)
2. [RHELC-432](/browse/RHELC-432)

## Pass the rhsm password securely to subscription-manager

[Log In](/login.jsp?os_destination=%2Fbrowse%2FRHELC-432 "Log In")ClosedExportnullXMLWordPrintable
### Details

* **Type:**
  ![Icon: Task](/secure/viewavatar?size=xsmall&avatarId=13278&avatarType=issuetype "Task - Represents a small unit of work that is not end-user facing.") Task
* **Resolution:**
  Done
* **Priority:**
  ![Icon: Critical](/images/icons/priorities/critical.svg "Critical - To be worked on immediately following BLOCKER issues.") Critical
* **Fix Version/s:**
  [0.25-4](/issues/?jql=project+%3D+RHELC+AND+fixVersion+%3D+0.25-4 "0.25-4 Convert2RHEL version 0.25-4")
* **Affects Version/s:**
  None
* **Component/s:**
  [convert2rhel](/issues/?jql=project+%3D+RHELC+AND+component+%3D+convert2rhel "convert2rhel convert2rhel")
* **Labels:**
  None

* [**Field Tab**](#customfield-panel-1)
* [**Prioritization**](#customfield-panel-2)

* **Epic Link:**
  [RHELC-187](/browse/RHELC-187)
* **Ready:**
  False
* **Blocked:**
  False

* **Story Points:**
  8

### Description

When convert2rhel registers a system with subscription-manager, it shells out to the subscription-manager program.  If the user gave convert2rhel a password to authenticate with subscription-manager, this ends up being passed on the subscription-manager command line.  Passing secrets on the command line is insecure because unprivileged users can read the process list which includes the command and all arguments to the command.

In the short term we can handle this problem by invoking subscription-manager via pexpect.spawn() without giving it the password.  In this case, subscription-manager will interactively prompt for the password and we can then use pexpect to send the password.

Longer term, subscription-manager is going to add the ability to pass the password via a file and we can then use that to pass in the password:

<https://issues.redhat.com/browse/ENT-4724>

Embargo lift date: TBD

### Attachments

### Attachments

* Options
  + - [Sort By Name](/browse/RHELC-432?attachmentSortBy=fileName#attachmentmodule "viewissue.subtasks.tab.show.all.name")
    - [Sort By Date](/browse/RHELC-432?attachmentSortBy=dateTime#attachmentmodule "Sort By Date")
    - [Ascending](/browse/RHELC-432?attachmentOrder=asc#attachmentmodule "Ascending")
    - [Descending](/browse/RHELC-432?attachmentOrder=desc#attachmentmodule "Descending")
    - [Thumbnails](/browse/RHELC-432?attachmentViewMode=gallery#attachmentmodule "Thumbnails")
    - [List](/browse/RHELC-432?attachmentViewMode=list#attachmentmodule "List")
    - [Download All](/secure/attachmentzip/14497628.zip "Download all attachments as a ZIP file")

1. [0000-backport-Do-not-put-the-subscription-manager-password-onto-th.patch](/secure/attachment/12704910/0000-backport-Do-not-put-the-subscription-manager-password-onto-th.patch "0000-backport-Do-not-put-the-subscription-manager-password-onto-th.patch - Latest 2022/04/06 1:29 PM - Daniel Diblik")56 kB2022/04/06 1:29 PM
2. [0000-Do-not-put-the-subscription-manager-password-onto-th.patch](/secure/attachment/12704911/0000-Do-not-put-the-subscription-manager-password-onto-th.patch "0000-Do-not-put-the-subscription-manager-password-onto-th.patch - Latest 2022/04/06 1:29 PM - Daniel Diblik")59 kB2022/04/06 1:29 PM
3. [0001-backport-Do-not-put-the-subscription-manager-password-onto-th.patch](/secure/attachment/12703313/0001-backport-Do-not-put-the-subscription-manager-password-onto-th.patch "0001-backport-Do-not-put-the-subscription-manager-password-onto-th.patch - Latest 2022/04/01 10:21 AM - Toshio Kuratomi")51 kB2022/04/01 10:21 AM
4. [0001-Do-not-put-the-subscription-manager-password-onto-th.patch](/secure/attachment/12703961/0001-Do-not-put-the-subscription-manager-password-onto-th.patch "0001-Do-not-put-the-subscription-manager-password-onto-th.patch - Latest 2022/04/04 6:40 PM - Toshio Kuratomi")55 kB2022/04/04 6:40 PM
5. [0002-backport-Fix-the-expect-script.patch](/secure/attachment/12703314/0002-backport-Fix-the-expect-script.patch "0002-backport-Fix-the-expect-script.patch - Latest 2022/04/01 10:22 AM - Toshio Kuratomi")3 kB2022/04/01 10:22 AM
6. [0002-fix-Flaky-tests-and-improve-existing-tests.patch](/secure/attachment/12697504/0002-fix-Flaky-tests-and-improve-existing-tests.patch "0002-fix-Flaky-tests-and-improve-existing-tests.patch - Latest 2022/03/14 7:49 PM - Freya Gustavsson")5 kB2022/03/14 7:49 PM
7. [0002-Fix-the-expect-script-for-sending-rhsm-password.patch](/secure/attachment/12703962/0002-Fix-the-expect-script-for-sending-rhsm-password.patch "0002-Fix-the-expect-script-for-sending-rhsm-password.patch - Latest 2022/04/04 6:40 PM - Toshio Kuratomi")3 kB2022/04/04 6:40 PM
8. [0003-backport-Fix-for-pexpect.wait-on-RHEL7.patch](/secure/attachment/12703343/0003-backport-Fix-for-pexpect.wait-on-RHEL7.patch "0003-backport-Fix-for-pexpect.wait-on-RHEL7.patch - Latest 2022/04/01 3:27 PM - Toshio Kuratomi")1 kB2022/04/01 3:27 PM
9. [0003-Fix-for-pexpect.wait-on-RHEL7.patch](/secure/attachment/12703963/0003-Fix-for-pexpect.wait-on-RHEL7.patch "0003-Fix-for-pexpect.wait-on-RHEL7.patch - Latest 2022/04/04 6:40 PM - Toshio Kuratomi")1 kB2022/04/04 6:40 PM
10. [0004-Add-integration-test.patch](/secure/attachment/12704872/0004-Add-integration-test.patch "0004-Add-integration-test.patch - Latest 2022/04/06 8:42 AM - Daniel Diblik")3 kB2022/04/06 8:42 AM
11. [0004-backport-Add-integration-test.patch](/secure/attachment/12704599/0004-backport-Add-integration-test.patch "0004-backport-Add-integration-test.patch - Latest 2022/04/05 5:20 PM - Daniel Diblik")4 kB2022/04/05 5:20 PM
12. [0005-backport-Fix-Pexpect.spawn-truncating-lines-on-RHEL7.patch](/secure/attachment/12706217/0005-backport-Fix-Pexpect.spawn-truncating-lines-on-RHEL7.patch "0005-backport-Fix-Pexpect.spawn-truncating-lines-on-RHEL7.patch - Latest 2022/04/08 5:45 PM - Toshio Kuratomi")3 kB2022/04/08 5:45 PM
13. [0005-Fix-Pexpect.spawn-truncating-lines-on-RHEL7.patch](/secure/attachment/12706214/0005-Fix-Pexpect.spawn-truncating-lines-on-RHEL7.patch "0005-Fix-Pexpect.spawn-truncating-lines-on-RHEL7.patch - Latest 2022/04/08 5:39 PM - Toshio Kuratomi")3 kB2022/04/08 5:39 PM
14. [2022-04-08a-Do-not-put-the-subscription-manager-password-onto-th.patch](/secure/attachment/12706215/2022-04-08a-Do-not-put-the-subscription-manager-password-onto-th.patch "2022-04-08a-Do-not-put-the-subscription-manager-password-onto-th.patch - Latest 2022/04/08 5:43 PM - Toshio Kuratomi")60 kB2022/04/08 5:43 PM
15. [2022-04-08-backport-Do-not-put-the-subscription-manager-password-onto-th.patch](/secure/attachment/12706218/2022-04-08-backport-Do-not-put-the-subscription-manager-password-onto-th.patch "2022-04-08-backport-Do-not-put-the-subscription-manager-password-onto-th.patch - Latest 2022/04/08 5:48 PM - Toshio Kuratomi")57 kB2022/04/08 5:48 PM
16. [convert2rhel-0.25-cve-fix.el7.noarch.rpm](/secure/attachment/12700581/convert2rhel-0.25-cve-fix.el7.noarch.rpm "convert2rhel-0.25-cve-fix.el7.noarch.rpm - Latest 2022/03/23 5:27 PM - Michal Bocek")131 kB2022/03/23 5:27 PM
17. [convert2rhel-0.25-cve-fix.el8.noarch.rpm](/secure/attachment/12700582/convert2rhel-0.25-cve-fix.el8.noarch.rpm "convert2rhel-0.25-cve-fix.el8.noarch.rpm - Latest 2022/03/23 5:27 PM - Michal Bocek")134 kB2022/03/23 5:27 PM
18. [convert2rhel-0.25-cvefix2.el6.noarch.rpm](/secure/attachment/12703357/convert2rhel-0.25-cvefix2.el6.noarch.rpm "convert2rhel-0.25-cvefix2.el6.noarch.rpm - Latest 2022/04/01 5:06 PM - Toshio Kuratomi")132 kB2022/04/01 5:06 PM
19. [convert2rhel-0.25-cvefix2.el7.noarch.rpm](/secure/attachment/12703349/convert2rhel-0.25-cvefix2.el7.noarch.rpm "convert2rhel-0.25-cvefix2.el7.noarch.rpm - Latest 2022/04/01 3:45 PM - Toshio Kuratomi")131 kB2022/04/01 3:45 PM
20. [convert2rhel-0.25-cvefix2.el8.noarch.rpm](/secure/attachment/12703350/convert2rhel-0.25-cvefix2.el8.noarch.rpm "convert2rhel-0.25-cvefix2.el8.noarch.rpm - Latest 2022/04/01 3:50 PM - Toshio Kuratomi")134 kB2022/04/01 3:50 PM
### Easy Agile Planning Poker

### Activity

### People

Assignee:

![ddiblik@redhat.com](https://issues.redhat.com/secure/useravatar?size=small&avatarId=17288)
Daniel Diblik

Reporter:

![tkuratom@redhat.com](https://issues.redhat.com/secure/useravatar?size=small&avatarId=10282)
Toshio Kuratomi

Contributors:

 Daniel Diblik,  Freya Gustavsson,  Michal Bocek

Votes:
0
Vote for this issue

Watchers:
5
Start watching this issue

### Dates

Created:

2022/02/22 6:29 PM

Updated:

2022/10/13 4:18 PM

Resolved:

2022/04/21 12:35 PM

* In case of any question or problem, please **email Red Hat Jira administrators** |
  **[Privacy statement](https://www.redhat.com/en/about/privacy-policy)**

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

[Atlassian](http://www.atlassian.com/)



=== Content from github.com_68523679_20250114_181741.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foamg%2Fconvert2rhel%2Fcommit%2F8d72fb030ed31116fdb256b327d299337b000af4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foamg%2Fconvert2rhel%2Fcommit%2F8d72fb030ed31116fdb256b327d299337b000af4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=oamg%2Fconvert2rhel)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[oamg](/oamg)
/
**[convert2rhel](/oamg/convert2rhel)**
Public

* [Notifications](/login?return_to=%2Foamg%2Fconvert2rhel) You must be signed in to change notification settings
* [Fork
  86](/login?return_to=%2Foamg%2Fconvert2rhel)
* [Star
   108](/login?return_to=%2Foamg%2Fconvert2rhel)

* [Code](/oamg/convert2rhel)
* [Issues
  11](/oamg/convert2rhel/issues)
* [Pull requests
  11](/oamg/convert2rhel/pulls)
* [Discussions](/oamg/convert2rhel/discussions)
* [Actions](/oamg/convert2rhel/actions)
* [Projects
  0](/oamg/convert2rhel/projects)
* [Wiki](/oamg/convert2rhel/wiki)
* [Security](/oamg/convert2rhel/security)
* [Insights](/oamg/convert2rhel/pulse)

Additional navigation options

* [Code](/oamg/convert2rhel)
* [Issues](/oamg/convert2rhel/issues)
* [Pull requests](/oamg/convert2rhel/pulls)
* [Discussions](/oamg/convert2rhel/discussions)
* [Actions](/oamg/convert2rhel/actions)
* [Projects](/oamg/convert2rhel/projects)
* [Wiki](/oamg/convert2rhel/wiki)
* [Security](/oamg/convert2rhel/security)
* [Insights](/oamg/convert2rhel/pulse)

## Commit

[Permalink](/oamg/convert2rhel/commit/8d72fb030ed31116fdb256b327d299337b000af4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Do not put the subscription-manager password onto the command line. ([#…](https://github.com/oamg/convert2rhel/pull/492)

[Browse files](/oamg/convert2rhel/tree/8d72fb030ed31116fdb256b327d299337b000af4)
Browse the repository at this point in the history

```
[…492](https://github.com/oamg/convert2rhel/pull/492))

* Do not put the subscription-manager password onto the command line.

Fixes [CVE-2022-0852](https://github.com/advisories/GHSA-fjvj-w876-8mc2 "CVE-2022-0852")

Passing values on the command line is insecure.  With this change,
the rhsm password is passed interactively to subscription-manager
instead of being passed on the commandline when we shell out to it.

The structure of this change deserves a bit of description.  Previously,
we called one function to assemble all of the information needed to
invoke subscription-manager and then returned that as a string that
could be run as a command line.  We called a second function with that
string to actually run the command.

To send the password interactively, we need to stop adding the password
to the string of command line arguments but it still makes sense to keep
the code that figures out the password together with the code which
finds the other command line args.  So it makes sense to keep a single
function to do that but return the password and other args separately.

We could use a dict, a class, or a tuple as the return value from the
function.  That doesn't feel too ugly.  But then we need to pass that
structure into the function which takes care of invoking
subscription-manager on the command line and that *does* feel ugly.
That function would have to care about the structure of the data we pass
in (If a tuple, what is the order?  If a dict, what are the field
names?, etc).  To take care of this, we can make the data structure that
we return from assembling the data a class and the function which calls
subscription-manager a method of that class because it's quite natural
for a method to have knowledge of what attributes the class contains.

Hmm... but now that we have a class with behaviours (methods), it starts
to feel like we could do some more things.  A function that fills in the
values of a class, validates that the data is proper, and then returns
an instance of that class is really a constructor, right?  So it makes
sense to move the function which assembles the data and returns the
class a constructor.  But that particular function isn't very generic:
it uses knowledge of our global toolopts.tool_opts to populate the
class.  So let's write a simple __init__() that takes all of the values
needed as separate parameters and then create an alternative constructor
(an [@classmethod](https://github.com/classmethod) which returns an instance of the class) which gets the
data from a ToolOpt, and then calls __init__() with those values and
returns the resulting class.

Okay, things are much cleaner now, but there's one more thing that we
can do.  We now have a class that has a constructor to read in data and
a single method that we can call to return some results.  What do we
call an object that can be called to return a result?  A function or
more generically, in python, a Callable.  We can turn this class into a
callable by renaming the method which actually invokes
subscription-manager __call__().

What we have at the end of all this is a way to create a function which
knows about the settings in tool_opts which we can then call to perform
our subscription-manager needs::

    registration_command = RegistrationCommand.from_tool_opts()
    return_code = registration_command()

OAMG-6551 #done  convert2rhel now passes the rhsm password to subscription-manager securely.

* Modify the hiding of secret to hide both --password SECRET and
  --password=SECRET.  Currently we only use it with passwords that we
  are passing in the second form (to subscription-manager) but catching
  both will future proof us in case we use this function for more things
  in the future. (Eric Gustavsson)
  * Note: using generator expressions was tried here but found that they
    only bind the variable being iterated over at definition time, the
    rest of the variables are bound when the generator is used.  This
    means that constructing a set of generators in a loop doesn't really
    work as the loop variables that you use in the generator will have a
    different value by the time you're done.

    So a nested for loop and if-else is the way to implement this.

* Add global_tool_opts fixture to conftest.py which monkeypatches a
  fresh ToolOpts into convert2rhel.toolopts.tool_opts.  That way tests
  can modify that without worrying about polluting other tests.

  * How toolopts is imported in the code makes a difference whether this
    fixture is sufficient or if you need to do a little more work. If
    the import is::

      from convert2rhel import toolopts
      do_something(toolopts.tool_opts.username)

   then your test can just do::

      def test_thing_that_uses_toolopts(global_tool_opts):
          global_tool_opts.username = 'badger'

   Most of our code, though, imports like this::

      # In subscription.py, for instance
      from convert2rhel.toolopts import tool_opts
      do_something(tool_opts.username)

   so the tests should do something like this::

      def test_toolopts_differently(global_test_opts, monkeypatch):
          monkeypatch.setattr(subscription, 'tool_opts', global_tool_opts)

* Sometimes a process will close stdout before it is done processing.
  When that happens, we need to wait() for the process to end before
  closing the pty.  If we don't wait, the process will receive a HUP
  signal which may end it before it is done.
  * But on RHEL7, pexpect.wait() will throw an exception if you wait on
    an already finished process.  So we need to ignore that exception
    there.

lgtm is flagging some cases where it thinks we are logging sensitive
data.  Here's why we're ignoring lgtm:

* One case logs the username to the terminal as a hint for the user as
  to what account is being used.  We consider username to not be
  sensitive.
* One case logs the subscription-manager invocation.  We run the command
  line through hide_secrets() to remove private information when we do
  this.
* The last case logs which argument was passed to subscription-manager
  without a secret attached to it.  ie: "--password" is passed to
  subscription-manager without a password being added afterwards.  In
  this case, the string "--password" will be logged.

Testing farm doesn't have python-devel installed.
We need that to install psutil needed as a testing dependency.

Co-authored-by: Daniel Diblik <ddiblik@redhat.com>
```

* Loading branch information

[![@abadger](https://avatars.githubusercontent.com/u/209242?s=40&v=4)](/abadger) [![@danmyway](https://avatars.githubusercontent.com/u/8378124?s=40&v=4)](/danmyway)

[abadger](/oamg/convert2rhel/commits?author=abadger "View all commits by abadger")
and
[danmyway](/oamg/convert2rhel/commits?author=danmyway "View all commits by danmyway")
authored
May 27, 2022

1 parent
[8658831](/oamg/convert2rhel/commit/8658831de98488e6851f87a59de2aee81d31e592)

commit 8d72fb0

 Show file tree

 Hide file tree

Showing
**13 changed files**
with
**983 additions**
and
**287 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .gitleaks.toml
  [.gitleaks.toml](#diff-f40ac94aac00bf364ae4ebef5689f7a2b61d63788030902c529d48d6d7d30ffc)
* convert2rhel

  + convert2rhel/subscription.py
    [subscription.py](#diff-51e9ff11d39778d3b26778b293fc350430a82e2feed0dab2938da7c0069ffdc6)
  + unit\_tests

    - convert2rhel/unit\_tests/README.md
      [README.md](#diff-4a5320a3f535b7f29bf01ca09a270fc9b669a6081a4b09bcefeeaf18b4861196)
    - convert2rhel/unit\_tests/conftest.py
      [conftest.py](#diff-5e3cb561d2263ca737f1312e44ef68c0111b983e85fd78514fd0344aac509608)
    - convert2rhel/unit\_tests/subscription\_test.py
      [subscription\_test.py](#diff-85aca69500c4cab553d197c040b272a598d62826cf671eb68743e12980becd49)
    - convert2rhel/unit\_tests/systeminfo\_test.py
      [systeminfo\_test.py](#diff-09c893179e5a5511c5687d58cf78843237537844bb9d76f23ac3bc8e44174d37)
    - convert2rhel/unit\_tests/utils\_test.py
      [utils\_test.py](#diff-fdbcd3d7fbd0e82dce56b04c2458b1e1da26910bfe943462ecc047abd5988fa3)
  + convert2rhel/utils.py
    [utils.py](#diff-ed1ca2e4a8b27f1bee13d608562d4e94eceb2972790eccf4d84f366b750f221d)
* plans

  + plans/tier0.fmf
    [tier0.fmf](#diff-f492464e8c082d17dacf3c2fae94c1466c96b67e097b931c682e14e4dc334f92)
* tests

  + ansible\_collections/roles/install-testing-deps/tasks

    - tests/ansible\_collections/roles/install-testing-deps/tasks/main.yml
      [main.yml](#diff-5d80f086f3959b835a9758030c9c0b02dfd3707f65a383f19c1088293a9f566d)
  + integration/tier0

    - check-cve-2022-1662

      * tests/integration/tier0/check-cve-2022-1662/main.fmf
        [main.fmf](#diff-527eaefe6b34c14ff3f13eb93ffbe6626b8716cbe8f75bc05a010461cb985def)
      * tests/integration/tier0/check-cve-2022-1662/test\_cve\_fixes.py
        [test\_cve\_fixes.py](#diff-66fb550331bff7c776cb2c630c806f154c1f95b1691dd938f61c5a51c8a49165)
    - check-user-response

      * tests/integration/tier0/check-user-response/test\_user\_response.py
        [test\_user\_response.py](#diff-844f83818fd95adc1de86a406c1a71c0eec27de7f4d4c69dde5c121c717c4120)

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[.gitleaks.toml](#diff-f40ac94aac00bf364ae4ebef5689f7a2b61d63788030902c529d48d6d7d30ffc ".gitleaks.toml")

Show comments

[View file](/oamg/convert2rhel/blob/8d72fb030ed31116fdb256b327d299337b000af4/.gitleaks.toml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,4 @@ |
|  |  | [allowlist] |
|  |  | paths = [ |
|  |  | '''tests/integration/tier0/check-cve/test\_cve\_fixes.py''', |
|  |  | ] |

246 changes: 195 additions & 51 deletions

246
[convert2rhel/subscription.py](#diff-51e9ff11d39778d3b26778b293fc350430a82e2feed0dab2938da7c0069ffdc6 "convert2rhel/subscription.py")

Show comments

[View file](/oamg/convert2rhel/blob/8d72fb030ed31116fdb256b327d299337b000af4/convert2rhel/subscription.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -109,21 +109,21 @@ def register\_system(): |
|  |  |  |
|  |  | # Loop the registration process until successful registration |
|  |  | attempt = 0 |
|  |  | while True and attempt < MAX\_NUM\_OF\_ATTEMPTS\_TO\_SUBSCRIBE: |
|  |  | registration\_cmd = get\_registration\_cmd() |
|  |  |  |
|  |  | while attempt < MAX\_NUM\_OF\_ATTEMPTS\_TO\_SUBSCRIBE: |
|  |  | registration\_cmd = RegistrationCommand.from\_tool\_opts(tool\_opts) |
|  |  | attempt\_msg = "" |
|  |  | if attempt > 0: |
|  |  | attempt\_msg = "Attempt %d of %d: " % (attempt + 1, MAX\_NUM\_OF\_ATTEMPTS\_TO\_SUBSCRIBE) |
|  |  | loggerinst.info("%sRegistering the system using subscription-manager ...", attempt\_msg) |
|  |  |  |
|  |  | output, ret\_code = call\_registration\_cmd(registration\_cmd) |
|  |  | output, ret\_code = registration\_cmd() |
|  |  | if ret\_code == 0: |
|  |  | # Handling a signal interrupt that was previously handled by |
|  |  | # subscription-manager. |
|  |  | if "user interrupted process" in output.lower(): |
|  |  | raise KeyboardInterrupt |
|  |  | return |
|  |  |  |
|  |  | loggerinst.info("System registration failed with return code = %s" % str(ret\_code)) |
|  |  | if tool\_opts.credentials\_thru\_cli: |
|  |  | loggerinst.warning( |
| Expand All | | @@ -138,65 +138,209 @@ def register\_system(): |
|  |  | loggerinst.critical("Unable to register the system through subscription-manager.") |
|  |  |  |
|  |  |  |
|  |  | def get\_registration\_cmd(): |
|  |  | """Build a command for subscription-manager for registering the system.""" |
|  |  | loggerinst.info("Building subscription-manager command ... ") |
|  |  | registration\_cmd = ["subscription-manager", "register", "--force"] |
|  |  |  |
|  |  | loggerinst.info("Checking for activation key ...") |
|  |  | if tool\_opts.activation\_key: |
|  |  | # Activation key has been passed |
|  |  | # -> username/password not required |
|  |  | # -> organization required |
|  |  | loggerinst.info(" ... activation key detected: %s" % tool\_opts.activation\_key) |
|  |  |  |
|  |  | # TODO: Parse the output of 'subscription-manager orgs' and let the |
|  |  | # user choose from the available organizations. If there's just one, |
|  |  | # pick it automatically. |
|  |  | # Organization is required when activation key is used |
|  |  | class RegistrationCommand(object): |
|  |  | def \_\_init\_\_(self, activation\_key=None, org=None, username=None, password=None, server\_url=None): |
|  |  | """ |
|  |  | A callable that can register a system with subscription-manager. |
|  |  |  |
|  |  | :kwarg server\_url: Optional URL to the subscription-manager backend. |
|  |  | Useful when the customer has an on-prem subscription-manager instance. |
|  |  | :kwarg activation\_key: subscription-manager activation\_key that can be |
|  |  | used to register the system. Org must be specified if this was given. |
|  |  | :kwarg org: The organization that the activation\_key is associated with. |
|  |  | It is required if activation\_key is specified. |
|  |  | :kwarg username: Username to authenticate with subscription-manager. |
|  |  | Required if password is specified. |
|  |  | :kwarg password: Password to authenticate with subscription-manager. |
|  |  | It is required if username is specified. |
|  |  |  |
|  |  | .. note:: Either activation\_key and org or username and password must |
|  |  | be specified. |
|  |  | """ |
|  |  | self.cmd = "subscription-manager" |
|  |  | self.server\_url = server\_url |
|  |  |  |
|  |  | if activation\_key and not org: |
|  |  | raise ValueError("org must be specified if activation\_key is used") |
|  |  |  |
|  |  | self.activation\_key = activation\_key |
|  |  | self.org = org |
|  |  |  |
|  |  | self.password = password |
|  |  | self.username = username |
|  |  |  |
|  |  | if (password and not username) or (username and not password): |
|  |  | raise ValueError("username and password must be used together") |
|  |  |  |
|  |  | elif not password: |
|  |  | # No password set |
|  |  | if not self.activation\_key: |
|  |  | raise ValueError("activation\_key and org or username and password must be specified") |
|  |  |  |
|  |  | @classmethod |
|  |  | def from\_tool\_opts(cls, tool\_opts): |
|  |  | """ |
|  |  | Alternate constructor that gets subscription-manager args from ToolOpts. |
|  |  |  |
|  |  | convert2rhel's command-line contains the information needed to register |
|  |  | with subscription-manager. Get the information from the passed in |
|  |  | ToolOpts structure to create the RegistrationCommand. |
|  |  |  |
|  |  | :arg tool\_opts: The :class:`convert2rhel.toolopts.ToolOpts` structure to |
|  |  | retrieve the subscription-manager information from. |
|  |  | """ |
|  |  | loggerinst.info("Gathering subscription-manager registration info ... ") |
|  |  |  |
|  |  | registration\_attributes = {} |
|  |  | if tool\_opts.org: |
|  |  | loggerinst.info(" ... org detected") |
|  |  |  |
|  |  | org = tool\_opts.org |
|  |  | while not org: |
|  |  | org = utils.prompt\_user("Organization: ") |
|  |  |  |
|  |  | registration\_cmd.extend(("--activationkey=%s" % tool\_opts.activation\_key, "--org=%s" % org)) |
|  |  | else: |
|  |  | loggerinst.info(" ... activation key not found, username and password required") |
|  |  | loggerinst.info(" ... organization detected") |
|  |  | registration\_attributes["org"] = tool\_opts.org |
|  |  |  |
|  |  | if tool\_opts.activation\_key: |
|  |  | # Activation key has been passed |
|  |  | # -> username/password not required |
|  |  | # -> organization required |
|  |  | loggerinst.info(" ... activation key detected") |
|  |  | registration\_attributes["activation\_key"] = tool\_opts.activation\_key |
|  |  |  |
|  |  | while "org" not in registration\_attributes: |
|  |  | loggerinst.info(" ... activation key requires organization") |
|  |  | # Organization is required when activation key is used |
|  |  | # TODO: Parse the output of 'subscription-manager orgs' and let the |
|  |  | # user choose from the available organizations. If there's just one, |
|  |  | # pick it automatically. |
|  |  | org = utils.prompt\_user("Organization: ").strip() |
|  |  | # In case the user entered the empty string |
|  |  | if org: |
|  |  | registration\_attributes["org"] = org |
|  |  | else: |
|  |  | # No activation key -> username/password required |
|  |  | if tool\_opts.username and tool\_opts.password: |
|  |  | loggerinst.info(" ... activation key not found, using given username and password") |
|  |  | else: |
|  |  | loggerinst.info(" ... activation key not found, username and password required") |
|  |  |  |
|  |  | if tool\_opts.username: |
|  |  | loggerinst.info(" ... username detected") |
|  |  | username = tool\_opts.username |
|  |  | else: |
|  |  | username = "" |
|  |  | while not username: |
|  |  | username = utils.prompt\_user("Username: ") |
|  |  |  |
|  |  | registration\_attributes["username"] = username |
|  |  |  |
|  |  | if tool\_opts.password: |
|  |  | loggerinst.info(" ... password detected") |
|  |  | password = tool\_opts.password |
|  |  | else: |
|  |  | if tool\_opts.username: |
|  |  | # Hint user for which username they need to enter pswd |
|  |  | loggerinst.info("Username: %s", username) # lgtm[py/clear-text-logging-sensitive-data] |
|  |  | password = "" |
|  |  | while not password: |
|  |  | password = utils.prompt\_user("Password: ", password=True) |
|  |  |  |
|  |  | registration\_attributes["password"] = password |
|  |  |  |
|  |  | if tool\_opts.serverurl: |
|  |  | loggerinst.debug(" ... using custom RHSM URL") |
|  |  | registration\_attributes["server\_url"] = tool\_opts.serverurl |
|  |  |  |
|  |  | return cls(\*\*registration\_attributes) |
|  |  |  |
|  |  | @property |
|  |  | def args(self): |
|  |  | """ |
|  |  | This property is a list of the command-line arguments that will be passed to |
|  |  | subscription-manager to register the system. Set the individual attributes for |
|  |  | :attr:`server\_url`, :attr:`activation\_key`, etc to affect the values here. |
|  |  |  |
|  |  | .. note:: :attr:`password` is not passed on the command line. Instead, |
|  |  | it is sent to the running subscription-manager process via pexpect. |
|  |  | """ |
|  |  | args = ["register", "--force"] |
|  |  |  |
|  |  | if self.server\_url: |
|  |  | args.append("--serverurl=%s" % self.server\_url) |
|  |  |  |
|  |  | if self.activation\_key: |
|  |  | args.append("--activationkey=%s" % self.activation\_key) |
|  |  |  |
|  |  | if self.org: |
|  |  | args.append("--org=%s" % self.org) |
|  |  |  |
|  |  | if self.username: |
|  |  | args.append("--username=%s" % self.username) |
|  |  |  |
|  |  | return args |
|  |  |  |
|  |  | def \_\_call\_\_(self): |
|  |  | """ |
|  |  | Run the subscription-manager command. |
|  |  |  |
|  |  | Wrapper for running the subscription-manager command that keeps |
|  |  | secrets secure. |
|  |  | """ |
|  |  | if self.password: |
|  |  | loggerinst.debug( |
|  |  | "Calling command '%s %s'" % (self.cmd, " ".join(hide\_secrets(self.args))) |
|  |  | ) # lgtm[py/clear-text-logging-sensitive-data] |
|  |  | output, ret\_code = utils.run\_cmd\_in\_pty( |
|  |  | [self.cmd] + self.args, expect\_script=(("[Pp]assword: ", self.password + "\n"),), print\_cmd=False |
|  |  | ) |
|  |  | else: |
|  |  | # Warning: Currently activation\_key can only be specified on the CLI. This is insecure |
|  |  | # but there's nothing we can do about it for now. Once subscription-manager issue: |
|  |  | # https://issues.redhat.com/browse/ENT-4724 is implemented, we can change both password |
|  |  | # and activation\_key to use a file-based approach to passing the secrets. |
|  |  | output, ret\_code = utils.run\_subprocess([self.cmd] + self.args, print\_cmd=False) |
|  |  |  |
|  |  | if tool\_opts.username: |
|  |  | loggerinst.info(" ... username detected") |
|  |  | return output, ret\_code |
|  |  |  |
|  |  | username = tool\_opts.username |
|  |  | while not username: |
|  |  | username = utils.prompt\_user("Username: ") |
|  |  |  |
|  |  | if tool\_opts.password: |
|  |  | loggerinst.info(" ... password detected") |
|  |  | def hide\_secrets(args): |
|  |  | """ |
|  |  | Replace secret values with asterisks. |
|  |  |  |
|  |  | password = tool\_opts.password |
|  |  | while not password: |
|  |  | password = utils.prompt\_user("Password: ", password=True) |
|  |  | This function takes a list of arguments which will be passed to |
|  |  | subscription-manager on the command line and returns a new list |
|  |  | that has any secret values obscured with asterisks. |
|  |  |  |
|  |  | registration\_cmd.extend(("--username=%s" % username, "--password=%s" % password)) |
|  |  | :arg args: An argument list for subscription-manager which may contain |
|  |  | secret values. |
|  |  | :returns: A new list of arguments with secret values hidden. |
|  |  | """ |
|  |  | obfuscation\_string = "\*" \* 5 |
|  |  | secret\_args = frozenset(("--password", "--activationkey", "--token")) |
|  |  |  |
|  |  | if tool\_opts.serverurl: |
|  |  | loggerinst.debug(" ... using custom RHSM URL") |
|  |  | registration\_cmd.append("--serverurl=%s" % tool\_opts.serverurl) |
|  |  | sanitized\_list = [] |
|  |  | hide\_next = False |
|  |  | for arg in args: |
|  |  | if hide\_next: |
|  |  | # Second part of a two part secret argument (like --password \*SECRET\*) |
|  |  | arg = obfuscation\_string |
|  |  | hide\_next = False |
|  |  |  |
|  |  | return registration\_cmd |
|  |  | elif arg in secret\_args: |
|  |  | # First part of a two part secret argument (like \*--password\* SECRET) |
|  |  | hide\_next = True |
|  |  |  |
|  |  | else: |
|  |  | # A secret argument in one part (like --password=SECRET) |
|  |  | for problem\_arg in secret\_args: |
|  |  | if arg.startswith(problem\_arg + "="): |
|  |  | arg = "{0}={1}".format(problem\_arg, obfuscation\_string) |
|  |  |  |
|  |  | def call\_registration\_cmd(registration\_cmd): |
|  |  | """Wrapper for run\_subprocess that avoids leaking password in the log.""" |
|  |  | loggerinst.debug("Calling command '%s'" % hide\_password(" ".join(registration\_cmd))) |
|  |  | return utils.run\_subprocess(registration\_cmd, print\_cmd=False) |
|  |  | sanitized\_list.append(arg) |
|  |  |  |
|  |  | if hide\_next: |
|  |  | loggerinst.debug( |
|  |  | "Passed arguments had unexpected secret argument," |
|  |  | " '{0}', without a secret".format(sanitized\_list[-1]) # lgtm[py/clear-text-logging-sensitive-data] |
|  |  | ) |
|  |  |  |
|  |  | def hide\_password(cmd): |
|  |  | """Replace plaintext password with asterisks.""" |
|  |  | return re.sub('--password=".\*?"', '--password="\*\*\*\*\*"', cmd) |
|  |  | return sanitized\_list |
|  |  |  |
|  |  |  |
|  |  | def replace\_subscription\_manager(): |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[convert2rhel/unit\_tests/README.md](#diff-4a5320a3f535b7f29bf01ca09a270fc9b669a6081a4b09bcefeeaf18b4861196 "convert2rhel/unit_tests/README.md")

Show comments

[View file](/oamg/convert2rhel/blob/8d72fb030ed31116fdb256b327d299337b000af4/convert2rhel/unit_tests/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -49,7 +49,7 @@ def test\_check\_for\_yum\_updates(monkeypatch): |
|  |  | monkeypatch.setattr(package\_handler, "get\_packages\_to\_update", value=packages\_to\_update\_mock) |
|  |  |  |
|  |  | assert package\_handler.get\_packages\_to\_update() is not None |
|  |  | assert packages\_to\_update\_mock.assert\_called\_once\_with(["package-1", "package-2"]) |
|  |  | packages\_to\_update\_mock.assert\_called\_once\_with(["package-1", "package-2"]) |
|  |  | ``` |
|  |  |  |
|  |  | And this other example, of a test that don't need any mocks for external |
| Expand Down | |  |

9 changes: 8 additions & 1 deletion

9
[convert2rhel/unit\_tests/conftest.py](#diff-5e3cb561d2263ca737f1312e44ef68c0111b983e85fd78514fd0344aac509608 "convert2rhel/unit_tests/conftest.py")

Show comments

[View file](/oamg/convert2rhel/blob/8d72fb030ed31116fdb256b327d299337b000af4/convert2rhel/unit_tests/conftest.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,7 +2,7 @@ |
|  |  |  |
|  |  | import pytest |
|  |  |  |
|  |  | from convert2rhel import redhatrelease, utils |
|  |  | from convert2rhel import redhatrelease, toolopts, utils |
|  |  | from convert2rhel.logger import setup\_logger\_handler |
|  |  | from convert2rhel.systeminfo import system\_info |
|  |  | from convert2rhel.toolopts import tool\_opts |
| Expand Down  Expand Up | | @@ -60,6 +60,13 @@ def setup\_logger(tmpdir): |
|  |  | setup\_logger\_handler(log\_name="convert2rhel", log\_dir=str(tmpdir)) |
|  |  |  |
|  |  |  |
|  |  | @pytest.fixture |
|  |  | def global\_tool\_opts(monkeypatch): |
|  |  | local\_tool\_opts = toolopts.ToolOpts() |
|  |  | monkeypatch.setattr(toolopts, "tool\_opts", local\_tool\_opts) |
|  |  | return local\_tool\_opts |
|  |  |  |
|  |  |  |
|  |  | @pytest.fixture() |
|  |  | def pretend\_os(request, pkg\_root, monkeypatch): |
|  |  | """Parametric fixture to pretend to be one of available OS for convertion. |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8d72fb0`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foamg%2Fconvert2rhel%2Fcommit%2F8d72fb030ed31116fdb256b327d299337b000af4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


