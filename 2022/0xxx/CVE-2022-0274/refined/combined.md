=== Content from huntr.dev_344c3b2b_20250114_192345.html ===


* [![logo](/horizontal-logo-wh.svg)](/)
* [Bounties](/bounties)
* [Partners](/partners)
* Community
* Info
[SUBMIT REPORT](/bounties/disclose)

Supported by [Protect AI](https://protectai.com/) and leading the way to [MLSecOps](https://mlsecops.com) and greater AI security.

© 2024

[Privacy Policy](/privacy)[Terms of Service](/terms)[Code of Conduct](/code-of-conduct)Cookie Preferences[Contact Us](/contact-us)

=== Content from github.com_bd0790fd_20250114_192343.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Forchardcms%2Forchardcore%2Fcommit%2F218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Forchardcms%2Forchardcore%2Fcommit%2F218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OrchardCMS%2FOrchardCore)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OrchardCMS](/OrchardCMS)
/
**[OrchardCore](/OrchardCMS/OrchardCore)**
Public

* [Notifications](/login?return_to=%2FOrchardCMS%2FOrchardCore) You must be signed in to change notification settings
* [Fork
  2.4k](/login?return_to=%2FOrchardCMS%2FOrchardCore)
* [Star
   7.5k](/login?return_to=%2FOrchardCMS%2FOrchardCore)

* [Code](/OrchardCMS/OrchardCore)
* [Issues
  928](/OrchardCMS/OrchardCore/issues)
* [Pull requests
  29](/OrchardCMS/OrchardCore/pulls)
* [Discussions](/OrchardCMS/OrchardCore/discussions)
* [Actions](/OrchardCMS/OrchardCore/actions)
* [Security](/OrchardCMS/OrchardCore/security)
* [Insights](/OrchardCMS/OrchardCore/pulse)

Additional navigation options

* [Code](/OrchardCMS/OrchardCore)
* [Issues](/OrchardCMS/OrchardCore/issues)
* [Pull requests](/OrchardCMS/OrchardCore/pulls)
* [Discussions](/OrchardCMS/OrchardCore/discussions)
* [Actions](/OrchardCMS/OrchardCore/actions)
* [Security](/OrchardCMS/OrchardCore/security)
* [Insights](/OrchardCMS/OrchardCore/pulse)

## Commit

[Permalink](/OrchardCMS/OrchardCore/commit/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix localization and sanitization usages ([#11034](https://github.com/OrchardCMS/OrchardCore/pull/11034))

[Browse files](/OrchardCMS/OrchardCore/tree/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4)
Browse the repository at this point in the history

* Loading branch information

[![@sebastienros](https://avatars.githubusercontent.com/u/1165805?s=40&v=4)](/sebastienros)

[sebastienros](/OrchardCMS/OrchardCore/commits?author=sebastienros "View all commits by sebastienros")
authored
Jan 18, 2022

1 parent
[99ba2a9](/OrchardCMS/OrchardCore/commit/99ba2a979c861af21c13cc6af2a8e30150985ca9)

commit 218f25d

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**144 additions**
and
**21 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + OrchardCore.Modules

    - OrchardCore.ContentFields/Drivers

      * src/OrchardCore.Modules/OrchardCore.ContentFields/Drivers/LinkFieldDisplayDriver.cs
        [LinkFieldDisplayDriver.cs](#diff-87ec2b98107b37357008af4e90e911a79dad4e9380e4cd1a10ac789764deab7c)
    - OrchardCore.Contents/AuditTrail/Controllers

      * src/OrchardCore.Modules/OrchardCore.Contents/AuditTrail/Controllers/AuditTrailContentController.cs
        [AuditTrailContentController.cs](#diff-c20abe1a4e9d0dcbc1b3f5e279d7beb6eeb1320bd8dc7332c2be3769bda3f557)
    - OrchardCore.Menu/Drivers

      * src/OrchardCore.Modules/OrchardCore.Menu/Drivers/HtmlMenuItemPartDisplayDriver.cs
        [HtmlMenuItemPartDisplayDriver.cs](#diff-bac2639b9fb72d6facb7e8700e9da08d2df5d0e2832e2e1fc2b03538db515133)
      * src/OrchardCore.Modules/OrchardCore.Menu/Drivers/LinkMenuItemPartDisplayDriver.cs
        [LinkMenuItemPartDisplayDriver.cs](#diff-7c74fc2ce4498ac231ec1d3d2cd95b2ebf76b9a16bd032dd4d1db7c76106395d)
    - OrchardCore.Users/Workflows/Activities

      * src/OrchardCore.Modules/OrchardCore.Users/Workflows/Activities/RegisterUserTask.cs
        [RegisterUserTask.cs](#diff-5b52fd8eeb9d7e5b8b1b7211e21db9dce54c867eb0433e6c36deffdbbd985f73)
    - OrchardCore.Workflows

      * Activities

        + src/OrchardCore.Modules/OrchardCore.Workflows/Activities/NotifyTask.cs
          [NotifyTask.cs](#diff-0e0d41fdff1366634913091a85ca23a6331395f102751ff193e74ad160df1ad7)
      * Views

        + Items

          - src/OrchardCore.Modules/OrchardCore.Workflows/Views/Items/UserTaskEvent.Fields.Design.cshtml
            [UserTaskEvent.Fields.Design.cshtml](#diff-683679b7ac97f09cf2b5ef800d558136b52ca0c5cc090213a39ad3866e205bb7)
        + Workflow

          - src/OrchardCore.Modules/OrchardCore.Workflows/Views/Workflow/Details.cshtml
            [Details.cshtml](#diff-8669b28c36599646635362501d0f3663d75241eda336bd66d83d6c60b84339fe)
          - src/OrchardCore.Modules/OrchardCore.Workflows/Views/Workflow/Index.cshtml
            [Index.cshtml](#diff-fd1e47ac7dc71b6e56e1e0eb57ab272f141cef5940cf8860e0d6245d84957123)
  + OrchardCore/OrchardCore.Workflows.Abstractions/Helpers

    - src/OrchardCore/OrchardCore.Workflows.Abstractions/Helpers/ActivityExtensions.cs
      [ActivityExtensions.cs](#diff-f3111ec69fd288928db5897bfaefc8f635c50ff1f2c52b9ae54530858b746a87)

## There are no files selected for viewing

22 changes: 18 additions & 4 deletions

22
[src/OrchardCore.Modules/OrchardCore.ContentFields/Drivers/LinkFieldDisplayDriver.cs](#diff-87ec2b98107b37357008af4e90e911a79dad4e9380e4cd1a10ac789764deab7c "src/OrchardCore.Modules/OrchardCore.ContentFields/Drivers/LinkFieldDisplayDriver.cs")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore.Modules/OrchardCore.ContentFields/Drivers/LinkFieldDisplayDriver.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,5 @@ |
|  |  | using System; |
|  |  | using System.Text.Encodings.Web; |
|  |  | using System.Threading.Tasks; |
|  |  | using Microsoft.AspNetCore.Mvc.Infrastructure; |
|  |  | using Microsoft.AspNetCore.Mvc.Routing; |
| Expand All | | @@ -11,6 +12,7 @@ |
|  |  | using OrchardCore.ContentManagement.Metadata.Models; |
|  |  | using OrchardCore.DisplayManagement.ModelBinding; |
|  |  | using OrchardCore.DisplayManagement.Views; |
|  |  | using OrchardCore.Infrastructure.Html; |
|  |  | using OrchardCore.Mvc.ModelBinding; |
|  |  |  |
|  |  | namespace OrchardCore.ContentFields.Drivers |
| Expand All | | @@ -20,15 +22,21 @@ public class LinkFieldDisplayDriver : ContentFieldDisplayDriver<LinkField> |
|  |  | private readonly IUrlHelperFactory \_urlHelperFactory; |
|  |  | private readonly IActionContextAccessor \_actionContextAccessor; |
|  |  | private readonly IStringLocalizer S; |
|  |  | private readonly IHtmlSanitizerService \_htmlSanitizerService; |
|  |  | private readonly HtmlEncoder \_htmlencoder; |
|  |  |  |
|  |  | public LinkFieldDisplayDriver( |
|  |  | IUrlHelperFactory urlHelperFactory, |
|  |  | IActionContextAccessor actionContextAccessor, |
|  |  | IStringLocalizer<LinkFieldDisplayDriver> localizer) |
|  |  | IStringLocalizer<LinkFieldDisplayDriver> localizer, |
|  |  | IHtmlSanitizerService htmlSanitizerService, |
|  |  | HtmlEncoder htmlencoder) |
|  |  | { |
|  |  | \_urlHelperFactory = urlHelperFactory; |
|  |  | \_actionContextAccessor = actionContextAccessor; |
|  |  | S = localizer; |
|  |  | \_htmlSanitizerService = htmlSanitizerService; |
|  |  | \_htmlencoder = htmlencoder; |
|  |  | } |
|  |  |  |
|  |  | public override IDisplayResult Display(LinkField field, BuildFieldDisplayContext context) |
| Expand Down  Expand Up | | @@ -91,6 +99,15 @@ public override async Task<IDisplayResult> UpdateAsync(LinkField field, IUpdateM |
|  |  | { |
|  |  | updater.ModelState.AddModelError(Prefix, nameof(field.Url), S["{0} is an invalid url.", field.Url]); |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | var link = $"<a href=\"{\_htmlencoder.Encode(urlToValidate)}\"></a>"; |
|  |  |  |
|  |  | if (!String.Equals(link, \_htmlSanitizerService.Sanitize(link), StringComparison.OrdinalIgnoreCase)) |
|  |  | { |
|  |  | updater.ModelState.AddModelError(Prefix, nameof(field.Url), S["{0} is an invalid url.", field.Url]); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // Validate Text |
|  |  | if (settings.LinkTextMode == LinkTextMode.Required && String.IsNullOrWhiteSpace(field.Text)) |
| Expand All | | @@ -101,9 +118,6 @@ public override async Task<IDisplayResult> UpdateAsync(LinkField field, IUpdateM |
|  |  | { |
|  |  | updater.ModelState.AddModelError(Prefix, nameof(field.Text), S["The text default value is required for {0}.", context.PartFieldDefinition.DisplayName()]); |
|  |  | } |
|  |  |  |
|  |  | // Run this through a sanitizer in case someone puts html in it. |
|  |  | // No settings. |
|  |  | } |
|  |  |  |
|  |  | return Edit(field, context); |
| Expand Down | |  |

5 changes: 4 additions & 1 deletion

5
[...rdCore.Modules/OrchardCore.Contents/AuditTrail/Controllers/AuditTrailContentController.cs](#diff-c20abe1a4e9d0dcbc1b3f5e279d7beb6eeb1320bd8dc7332c2be3769bda3f557 "src/OrchardCore.Modules/OrchardCore.Contents/AuditTrail/Controllers/AuditTrailContentController.cs")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore.Modules/OrchardCore.Contents/AuditTrail/Controllers/AuditTrailContentController.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -111,12 +111,15 @@ public async Task<ActionResult> Restore(string auditTrailEventId) |
|  |  | } |
|  |  |  |
|  |  | var result = await \_contentManager.RestoreAsync(contentItem); |
|  |  |  |
|  |  | if (!result.Succeeded) |
|  |  | { |
|  |  | await \_notifier.WarningAsync(H["'{0}' was not restored, the version is not valid.", contentItem.DisplayText]); |
|  |  |  |
|  |  | foreach (var error in result.Errors) |
|  |  | { |
|  |  | await \_notifier.WarningAsync(new LocalizedHtmlString(error.ErrorMessage, error.ErrorMessage)); |
|  |  | // Pass ErrorMessage as an argument to ensure it is encoded |
|  |  | await \_notifier.WarningAsync(new LocalizedHtmlString(nameof(AuditTrailContentController.Restore), "{0}", false, error.ErrorMessage)); |
|  |  | } |
|  |  |  |
|  |  | return RedirectToAction("Index", "Admin", new { area = "OrchardCore.AuditTrail" }); |
| Expand Down | |  |

50 changes: 49 additions & 1 deletion

50
[src/OrchardCore.Modules/OrchardCore.Menu/Drivers/HtmlMenuItemPartDisplayDriver.cs](#diff-bac2639b9fb72d6facb7e8700e9da08d2df5d0e2832e2e1fc2b03538db515133 "src/OrchardCore.Modules/OrchardCore.Menu/Drivers/HtmlMenuItemPartDisplayDriver.cs")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore.Modules/OrchardCore.Menu/Drivers/HtmlMenuItemPartDisplayDriver.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,9 @@ |
|  |  | using System; |
|  |  | using System.Text.Encodings.Web; |
|  |  | using System.Threading.Tasks; |
|  |  | using Microsoft.AspNetCore.Mvc.Infrastructure; |
|  |  | using Microsoft.AspNetCore.Mvc.Routing; |
|  |  | using Microsoft.Extensions.Localization; |
|  |  | using OrchardCore.ContentManagement.Display.ContentDisplay; |
|  |  | using OrchardCore.ContentManagement.Display.Models; |
|  |  | using OrchardCore.DisplayManagement.ModelBinding; |
| Expand All | | @@ -12,11 +17,25 @@ namespace OrchardCore.Menu.Drivers |
|  |  | { |
|  |  | public class HtmlMenuItemPartDisplayDriver : ContentPartDisplayDriver<HtmlMenuItemPart> |
|  |  | { |
|  |  | private readonly IUrlHelperFactory \_urlHelperFactory; |
|  |  | private readonly IActionContextAccessor \_actionContextAccessor; |
|  |  | private readonly IHtmlSanitizerService \_htmlSanitizerService; |
|  |  | private readonly HtmlEncoder \_htmlencoder; |
|  |  | private readonly IStringLocalizer S; |
|  |  |  |
|  |  | public HtmlMenuItemPartDisplayDriver(IHtmlSanitizerService htmlSanitizerService) |
|  |  | public HtmlMenuItemPartDisplayDriver( |
|  |  | IUrlHelperFactory urlHelperFactory, |
|  |  | IActionContextAccessor actionContextAccessor, |
|  |  | IStringLocalizer<HtmlMenuItemPartDisplayDriver> localizer, |
|  |  | IHtmlSanitizerService htmlSanitizerService, |
|  |  | HtmlEncoder htmlencoder |
|  |  | ) |
|  |  | { |
|  |  | \_urlHelperFactory = urlHelperFactory; |
|  |  | \_actionContextAccessor = actionContextAccessor; |
|  |  | \_htmlSanitizerService = htmlSanitizerService; |
|  |  | \_htmlencoder = htmlencoder; |
|  |  | S = localizer; |
|  |  | } |
|  |  |  |
|  |  | public override IDisplayResult Display(HtmlMenuItemPart part, BuildPartDisplayContext context) |
| Expand Down  Expand Up | | @@ -62,6 +81,35 @@ public override async Task<IDisplayResult> UpdateAsync(HtmlMenuItemPart part, IU |
|  |  | part.ContentItem.DisplayText = model.Name; |
|  |  | part.Html = settings.SanitizeHtml ? \_htmlSanitizerService.Sanitize(model.Html) : model.Html; |
|  |  | part.Url = model.Url; |
|  |  |  |
|  |  | var urlToValidate = part.Url; |
|  |  |  |
|  |  | if (!String.IsNullOrEmpty(urlToValidate)) |
|  |  | { |
|  |  | urlToValidate = urlToValidate.Split('#', 2)[0]; |
|  |  |  |
|  |  | if (urlToValidate.StartsWith("~/", StringComparison.Ordinal)) |
|  |  | { |
|  |  | var urlHelper = \_urlHelperFactory.GetUrlHelper(\_actionContextAccessor.ActionContext); |
|  |  | urlToValidate = urlHelper.Content(urlToValidate); |
|  |  | } |
|  |  |  |
|  |  | urlToValidate = urlToValidate.ToUriComponents(); |
|  |  |  |
|  |  | if (!Uri.IsWellFormedUriString(urlToValidate, UriKind.RelativeOrAbsolute)) |
|  |  | { |
|  |  | updater.ModelState.AddModelError(nameof(part.Url), S["{0} is an invalid url.", part.Url]); |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | var link = $"<a href=\"{\_htmlencoder.Encode(urlToValidate)}\"></a>"; |
|  |  |  |
|  |  | if (!String.Equals(link, \_htmlSanitizerService.Sanitize(link), StringComparison.OrdinalIgnoreCase)) |
|  |  | { |
|  |  | updater.ModelState.AddModelError(nameof(part.Url), S["{0} is an invalid url.", part.Url]); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return Edit(part, context); |
| Expand Down | |  |

57 changes: 57 additions & 0 deletions

57
[src/OrchardCore.Modules/OrchardCore.Menu/Drivers/LinkMenuItemPartDisplayDriver.cs](#diff-7c74fc2ce4498ac231ec1d3d2cd95b2ebf76b9a16bd032dd4d1db7c76106395d "src/OrchardCore.Modules/OrchardCore.Menu/Drivers/LinkMenuItemPartDisplayDriver.cs")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore.Modules/OrchardCore.Menu/Drivers/LinkMenuItemPartDisplayDriver.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,15 +1,41 @@ |
|  |  | using System; |
|  |  | using System.Text.Encodings.Web; |
|  |  | using System.Threading.Tasks; |
|  |  | using Microsoft.AspNetCore.Mvc.Infrastructure; |
|  |  | using Microsoft.AspNetCore.Mvc.Routing; |
|  |  | using Microsoft.Extensions.Localization; |
|  |  | using OrchardCore.ContentManagement.Display.ContentDisplay; |
|  |  | using OrchardCore.ContentManagement.Display.Models; |
|  |  | using OrchardCore.DisplayManagement.ModelBinding; |
|  |  | using OrchardCore.DisplayManagement.Views; |
|  |  | using OrchardCore.Infrastructure.Html; |
|  |  | using OrchardCore.Menu.Models; |
|  |  | using OrchardCore.Menu.ViewModels; |
|  |  |  |
|  |  | namespace OrchardCore.Menu.Drivers |
|  |  | { |
|  |  | public class LinkMenuItemPartDisplayDriver : ContentPartDisplayDriver<LinkMenuItemPart> |
|  |  | { |
|  |  | private readonly IUrlHelperFactory \_urlHelperFactory; |
|  |  | private readonly IActionContextAccessor \_actionContextAccessor; |
|  |  | private readonly IHtmlSanitizerService \_htmlSanitizerService; |
|  |  | private readonly HtmlEncoder \_htmlencoder; |
|  |  | private readonly IStringLocalizer S; |
|  |  |  |
|  |  | public LinkMenuItemPartDisplayDriver( |
|  |  | IUrlHelperFactory urlHelperFactory, |
|  |  | IActionContextAccessor actionContextAccessor, |
|  |  | IStringLocalizer<LinkMenuItemPartDisplayDriver> localizer, |
|  |  | IHtmlSanitizerService htmlSanitizerService, |
|  |  | HtmlEncoder htmlencoder |
|  |  | ) |
|  |  | { |
|  |  | \_urlHelperFactory = urlHelperFactory; |
|  |  | \_actionContextAccessor = actionContextAccessor; |
|  |  | \_htmlSanitizerService = htmlSanitizerService; |
|  |  | \_htmlencoder = htmlencoder; |
|  |  | S = localizer; |
|  |  | } |
|  |  |  |
|  |  | public override IDisplayResult Display(LinkMenuItemPart part, BuildPartDisplayContext context) |
|  |  | { |
| Expand Down  Expand Up | | @@ -45,11 +71,42 @@ public override async Task<IDisplayResult> UpdateAsync(LinkMenuItemPart part, IU |
|  |  | { |
|  |  | part.Url = model.Url; |
|  |  | part.ContentItem.DisplayText = model.Name; |
|  |  |  |
|  |  | // This code can be removed in a later release. |
|  |  | #pragma warning disable 0618 |
|  |  | part.Name = model.Name; |
|  |  | #pragma warning restore 0618 |
|  |  |  |
|  |  | var urlToValidate = part.Url; |
|  |  |  |
|  |  | if (!String.IsNullOrEmpty(urlToValidate)) |
|  |  | { |
|  |  | urlToValidate = urlToValidate.Split('#', 2)[0]; |
|  |  |  |
|  |  | if (urlToValidate.StartsWith("~/", StringComparison.Ordinal)) |
|  |  | { |
|  |  | var urlHelper = \_urlHelperFactory.GetUrlHelper(\_actionContextAccessor.ActionContext); |
|  |  | urlToValidate = urlHelper.Content(urlToValidate); |
|  |  | } |
|  |  |  |
|  |  | urlToValidate = urlToValidate.ToUriComponents(); |
|  |  |  |
|  |  | if (!Uri.IsWellFormedUriString(urlToValidate, UriKind.RelativeOrAbsolute)) |
|  |  | { |
|  |  | updater.ModelState.AddModelError(nameof(part.Url), S["{0} is an invalid url.", part.Url]); |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | var link = $"<a href=\"{\_htmlencoder.Encode(urlToValidate)}\"></a>"; |
|  |  |  |
|  |  | if (!String.Equals(link, \_htmlSanitizerService.Sanitize(link), StringComparison.OrdinalIgnoreCase)) |
|  |  | { |
|  |  | updater.ModelState.AddModelError(nameof(part.Url), S["{0} is an invalid url.", part.Url]); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return Edit(part); |
|  |  | } |
|  |  | } |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[src/OrchardCore.Modules/OrchardCore.Users/Workflows/Activities/RegisterUserTask.cs](#diff-5b52fd8eeb9d7e5b8b1b7211e21db9dce54c867eb0433e6c36deffdbbd985f73 "src/OrchardCore.Modules/OrchardCore.Users/Workflows/Activities/RegisterUserTask.cs")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore.Modules/OrchardCore.Users/Workflows/Activities/RegisterUserTask.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -134,15 +134,14 @@ public override async Task<ActivityExecutionResult> ExecuteAsync(WorkflowExecuti |
|  |  | workflowContext.Properties["EmailConfirmationUrl"] = uri; |
|  |  |  |
|  |  | var subject = await \_expressionEvaluator.EvaluateAsync(ConfirmationEmailSubject, workflowContext, null); |
|  |  | var localizedSubject = new LocalizedString(nameof(RegisterUserTask), subject); |
|  |  |  |
|  |  | var body = await \_expressionEvaluator.EvaluateAsync(ConfirmationEmailTemplate, workflowContext, \_htmlEncoder); |
|  |  | var localizedBody = new LocalizedHtmlString(nameof(RegisterUserTask), body); |
|  |  |  |
|  |  | var message = new MailMessage() |
|  |  | { |
|  |  | To = email, |
|  |  | Subject = localizedSubject.ResourceNotFound ? subject : localizedSubject.Value, |
|  |  | Body = localizedBody.IsResourceNotFound ? body : localizedBody.Value, |
|  |  | Subject = subject, |
|  |  | Body = body, |
|  |  | IsBodyHtml = true |
|  |  | }; |
|  |  | var smtpService = \_httpContextAccessor.HttpContext.RequestServices.GetService<ISmtpService>(); |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[src/OrchardCore.Modules/OrchardCore.Workflows/Activities/NotifyTask.cs](#diff-0e0d41fdff1366634913091a85ca23a6331395f102751ff193e74ad160df1ad7 "src/OrchardCore.Modules/OrchardCore.Workflows/Activities/NotifyTask.cs")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore.Modules/OrchardCore.Workflows/Activities/NotifyTask.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -55,6 +55,8 @@ public override IEnumerable<Outcome> GetPossibleOutcomes(WorkflowExecutionContex |
|  |  | public override async Task<ActivityExecutionResult> ExecuteAsync(WorkflowExecutionContext workflowContext, ActivityContext activityContext) |
|  |  | { |
|  |  | var message = await \_expressionEvaluator.EvaluateAsync(Message, workflowContext, \_htmlEncoder); |
|  |  |  |
|  |  | // The notification message can contain HTML by design |
|  |  | await \_notifier.AddAsync(NotificationType, new LocalizedHtmlString(nameof(NotifyTask), message)); |
|  |  |  |
|  |  | return Outcomes("Done"); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/OrchardCore.Modules/OrchardCore.Workflows/Views/Items/UserTaskEvent.Fields.Design.cshtml](#diff-683679b7ac97f09cf2b5ef800d558136b52ca0c5cc090213a39ad3866e205bb7 "src/OrchardCore.Modules/OrchardCore.Workflows/Views/Items/UserTaskEvent.Fields.Design.cshtml")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore.Modules/OrchardCore.Workflows/Views/Items/UserTaskEvent.Fields.Design.cshtml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,7 +8,7 @@ |
|  |  | @if (Model.Activity.Actions.Any()) |
|  |  | { |
|  |  | <span>@T["Request any user action of <em>{0}</em>", string.Join(", ", Model.Activity.Actions)]</span><br /> |
|  |  | <span>@T["Required roles: <em>{0}</em>", Model.Activity.Roles.Any() ? new LocalizedHtmlString("RequiredRoles", string.Join(", ", Model.Activity.Roles)) : T["Any"]]</span> |
|  |  | <span>@T["Required roles: <em>{0}</em>", Model.Activity.Roles.Any() ? Html.Raw(Html.Encode(string.Join(", ", Model.Activity.Roles))) : T["Any"]]</span> |
|  |  | } |
|  |  | else |
|  |  | { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/OrchardCore.Modules/OrchardCore.Workflows/Views/Workflow/Details.cshtml](#diff-8669b28c36599646635362501d0f3663d75241eda336bd66d83d6c60b84339fe "src/OrchardCore.Modules/OrchardCore.Workflows/Views/Workflow/Details.cshtml")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore.Modules/OrchardCore.Workflows/Views/Workflow/Details.cshtml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,7 +44,7 @@ |
|  |  | </div> |
|  |  | <div class="col"> |
|  |  | <label>@T["Status"]</label> |
|  |  | <span>@Model.Workflow.Status.GetLocalizedStatus(T)</span> |
|  |  | <span>@T.GetLocalizedStatus(Model.Workflow.Status)</span> |
|  |  | </div> |
|  |  | @if (Model.Workflow.Status == WorkflowStatus.Faulted) |
|  |  | { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/OrchardCore.Modules/OrchardCore.Workflows/Views/Workflow/Index.cshtml](#diff-fd1e47ac7dc71b6e56e1e0eb57ab272f141cef5940cf8860e0d6245d84957123 "src/OrchardCore.Modules/OrchardCore.Workflows/Views/Workflow/Index.cshtml")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore.Modules/OrchardCore.Workflows/Views/Workflow/Index.cshtml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -104,7 +104,7 @@ |
|  |  | <span class="hint">@T["Created {0}", (object)(await DisplayAsync(await New.TimeSpan(Utc: entry.Workflow.CreatedUtc)))]</span> |
|  |  | <div class="info"> |
|  |  | <span class="badge badge-@statusCss"> |
|  |  | @entry.Workflow.Status.GetLocalizedStatus(T) |
|  |  | @T.GetLocalizedStatus(entry.Workflow.Status) |
|  |  | </span> |
|  |  | </div> |
|  |  | </div> |
| Expand Down | |  |

16 changes: 8 additions & 8 deletions

16
[src/OrchardCore/OrchardCore.Workflows.Abstractions/Helpers/ActivityExtensions.cs](#diff-f3111ec69fd288928db5897bfaefc8f635c50ff1f2c52b9ae54530858b746a87 "src/OrchardCore/OrchardCore.Workflows.Abstractions/Helpers/ActivityExtensions.cs")

Show comments

[View file](/OrchardCMS/OrchardCore/blob/218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4/src/OrchardCore/OrchardCore.Workflows.Abstractions/Helpers/ActivityExtensions.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,8 +8,6 @@ namespace OrchardCore.Workflows.Helpers |
|  |  | { |
|  |  | public static class ActivityExtensions |
|  |  | { |
|  |  | private static IHtmlLocalizer H; |
|  |  |  |
|  |  | public static bool IsEvent(this IActivity activity) |
|  |  | { |
|  |  | return activity is IEvent; |
| Expand All | | @@ -18,14 +16,16 @@ public static bool IsEvent(this IActivity activity) |
|  |  | public static LocalizedHtmlString GetTitleOrDefault(this IActivity activity, Func<LocalizedHtmlString> defaultTitle) |
|  |  | { |
|  |  | var title = activity.As<ActivityMetadata>().Title; |
|  |  | return !string.IsNullOrEmpty(title) ? new LocalizedHtmlString(title, title) : defaultTitle(); |
|  |  |  |
|  |  | // A string used in LocalizedHtmlString won't be encoded so it needs to be pre-encoded. |
|  |  | // Passing the title as an argument so it uses the HtmlEncoder when rendered |
|  |  | // Another options would be to use new LocalizedHtmlString(Html.Encode(title)) but it's not available in the current context |
|  |  |  |
|  |  | return !string.IsNullOrEmpty(title) ? new LocalizedHtmlString(nameof(ActivityExtensions.GetTitleOrDefault), "{0}", false, title) : defaultTitle(); |
|  |  | } |
|  |  |  |
|  |  | public static LocalizedHtmlString GetLocalizedStatus(this WorkflowStatus status, IHtmlLocalizer localizer) |
|  |  | public static LocalizedHtmlString GetLocalizedStatus(this IHtmlLocalizer H, WorkflowStatus status) |
|  |  | { |
|  |  | // Field for PoExtractor compatibility |
|  |  | H = localizer; |
|  |  |  |
|  |  | return status switch |
|  |  | { |
|  |  | WorkflowStatus.Aborted => H["Aborted"], |
| Expand All | | @@ -36,7 +36,7 @@ public static LocalizedHtmlString GetLocalizedStatus(this WorkflowStatus status, |
|  |  | WorkflowStatus.Idle => H["Idle"], |
|  |  | WorkflowStatus.Resuming => H["Resuming"], |
|  |  | WorkflowStatus.Starting => H["Starting"], |
|  |  | \_ => new LocalizedHtmlString(status.ToString(), status.ToString()), |
|  |  | \_ => throw new NotSupportedException(), |
|  |  | }; |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `218f25d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Forchardcms%2Forchardcore%2Fcommit%2F218f25ddfadb66a54de7a82dffe3ab2e4ab7c4b4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


