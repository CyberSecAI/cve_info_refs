=== Content from lore.kernel.org_502e219d_20250115_090704.html ===

```
[linux-kernel.vger.kernel.org archive mirror](../../?t=20220115073656)
 [help](../../_/text/help/) / [color](../../_/text/color/) / [mirror](../../_/text/mirror/) / [Atom feed](../../new.atom)
```
```
[*](#ea2c89a6bee5f604d940116918fb4ab807c995aa1) A null-ptr-deref bug be triggered when write to an ICB inode
@ 2022-01-13 10:57 butt3rflyh4ck
  2022-01-14 17:23 ` [Jan Kara](#me83f2858f0536bd4d46ce987d768939b8ccb050d)
  [0 siblings, 1 reply; 3+ messages in thread](#ra2c89a6bee5f604d940116918fb4ab807c995aa1)
From: butt3rflyh4ck @ 2022-01-13 10:57 UTC ([permalink](../../CAFcO6XOHm6wx5f1OCA5DOUhSUpJpzL6i0h%2BMhQtMagD191q38Q%40mail.gmail.com/) / [raw](../../CAFcO6XOHm6wx5f1OCA5DOUhSUpJpzL6i0h%2BMhQtMagD191q38Q%40mail.gmail.com/raw))
  To: jack; +Cc: [LKML](../../../lkml/?t=20220113105746)

[[-- Attachment #1: Type: text/plain, Size: 6669 bytes --]](../../CAFcO6XOHm6wx5f1OCA5DOUhSUpJpzL6i0h%2BMhQtMagD191q38Q%40mail.gmail.com/1-a.txt)

Hi, there is a null pointer dereference bug that would be triggered
when writing something to an ICB inode, I reproduce in the latest
kernel.

First mount a malicious udf image, secondly create a dir named
"./file0", then create a file named "file1" in the file0 directory.
Then write something to "./file0/file1", then invoke
udf_file_write_iter function.

the udf_file_write_iter code:
```
static ssize_t udf_file_write_iter(struct kiocb *iocb, struct iov_iter *from)
{
ssize_t retval;
struct file *file = iocb->ki_filp;
struct inode *inode = file_inode(file);
struct udf_inode_info *iinfo = UDF_I(inode);
int err;

inode_lock(inode);

retval = generic_write_checks(iocb, from);
if (retval <= 0)
goto out;

down_write(&iinfo->i_data_sem);
if (iinfo->i_alloc_type == ICBTAG_FLAG_AD_IN_ICB) {   ///[1 ]
loff_t end = iocb->ki_pos + iov_iter_count(from);   ///[2] end =
iocb->ki_pos + i->count = iocb->ki_pos + user_write_size

if (inode->i_sb->s_blocksize <
(udf_file_entry_alloc_offset(inode) + end)) {  /// [3]
err = udf_expand_file_adinicb(inode);

....

}
```
[1] if the inode is ICBTAG_FLAG_AD_IN_ICB type, [2] then get a end,
[3] compare blocksize and end, if blocksize is smaller then invoke
udf_expand_file_adinicb to modify inode.
Next, in the process of expanding the block, trigger the bug.

the crash log:
```
[   82.827914][ T6441] loop0: detected capacity change from 0 to 5656
[   82.830192][ T6441] UDF-fs: warning (device loop0): udf_load_vrs:
No anchor found
[   82.831014][ T6441] UDF-fs: Scanning with blocksize 512 failed
[   82.833515][ T6441] UDF-fs: INFO Mounting volume 'LinuxUDF',
timestamp 2020/09/19 18:44 (1000)
[   82.835323][ T6441] general protection fault, probably for
non-canonical address 0xdffffc0000000015: 0000 [#1] PREEMPT SMP KASAN
[   82.836556][ T6441] KASAN: null-ptr-deref in range
[0x00000000000000a8-0x00000000000000af]
[   82.837437][ T6441] CPU: 0 PID: 6441 Comm: percpu_counter_ Not
tainted 5.16.0+ #34
[   82.838242][ T6441] Hardware name: QEMU Standard PC (i440FX + PIIX,
1996), BIOS 1.13.0-1ubuntu1 04/01/2014
[   82.838885][   T26] audit: type=1800 audit(1642070781.843:2):
pid=6441 uid=0 auid=0 ses=1 subj==unconfined op=collect_data
cause=failed(directio) comm="percpu_count0
[   82.843723][ T6441] RIP: 0010:percpu_counter_add_batch+0x3e/0x130
[   82.843757][ T6441] Code: 53 48 63 da e8 73 44 b4 fd 4c 8d 7d 20 48
c7 c7 40 0d dd 88 e8 c3 63 94 04 4c 89 fa 48 b8 00 00 00 00 00 fc ff
df 48 c1 ea 03 <80> 3c 02 0d
[   82.843760][ T6441] RSP: 0018:ffffc9000634f9e8 EFLAGS: 00010012
[   82.843765][ T6441] RAX: dffffc0000000000 RBX: 0000000000000010
RCX: 1ffffffff1a443f8
[   82.843768][ T6441] RDX: 0000000000000015 RSI: ffffffff88dd0d40
RDI: ffffffff88dac160
[   82.843769][ T6441] RBP: 0000000000000088 R08: 0000000000000004
R09: fffff940000bb9b9
[   82.843771][ T6441] R10: ffffea00005dcdc7 R11: fffff940000bb9b8
R12: 0000000000000000
[   82.843772][ T6441] R13: 0000000000000001 R14: 0000000000000001
R15: 00000000000000a8
[   82.843776][ T6441] FS:  00000000014e5880(0000)
GS:ffff88802d400000(0000) knlGS:0000000000000000
[   82.843780][ T6441] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   82.843785][ T6441] CR2: 0000000020000000 CR3: 00000000185a2000
CR4: 00000000000006f0
[   82.843791][ T6441] Call Trace:
[   82.843795][ T6441]  <TASK>
[   82.843799][ T6441]  __folio_start_writeback+0x64f/0x7b0
[   82.843805][ T6441]  ? domain_dirty_limits+0x350/0x350
[   82.843808][ T6441]  ? udf_get_block+0x208/0x4d0
[   82.843813][ T6441]  ? errseq_set+0x7b/0xe0
[   82.843817][ T6441]  __block_write_full_page+0x9b0/0xdc0
[   82.843822][ T6441]  ? udf_block_map+0x250/0x250
[   82.843824][ T6441]  ? end_buffer_write_sync+0xb0/0xb0
[   82.843827][ T6441]  udf_expand_file_adinicb+0x3bc/0xcc0
[   82.843830][ T6441]  ? udf_update_inode+0x3370/0x3370
[   82.843833][ T6441]  udf_file_write_iter+0x298/0x440
[   82.843835][ T6441]  ? _raw_spin_lock+0x88/0x110
[   82.843844][ T6441]  new_sync_write+0x37f/0x620
[   82.843848][ T6441]  ? new_sync_read+0x610/0x610
[   82.843850][ T6441]  ? common_file_perm+0x196/0x5f0
[   82.843855][ T6441]  ? apparmor_path_rmdir+0x20/0x20
[   82.843857][ T6441]  ? kmem_cache_free+0x9a/0x490
[   82.843860][ T6441]  ? security_file_permission+0x49/0x570
[   82.843864][ T6441]  vfs_write+0x41d/0x7b0
[   82.892153][ T6441]  ksys_write+0xe8/0x1c0
[   82.894156][ T6441]  ? __ia32_sys_read+0xa0/0xa0
[   82.895079][ T6441]  do_syscall_64+0x35/0xb0
[   82.895830][ T6441]  entry_SYSCALL_64_after_hwframe+0x44/0xae
[   82.896810][ T6441] RIP: 0033:0x44eafd
[   82.897449][ T6441] Code: 02 b8 ff ff ff ff c3 66 0f 1f 44 00 00 f3
0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b
4c 24 08 0f 05 <48> 3d 01 f8
[   82.900627][ T6441] RSP: 002b:00007ffec490a868 EFLAGS: 00000246
ORIG_RAX: 0000000000000001
[   82.901996][ T6441] RAX: ffffffffffffffda RBX: 0000000000400530
RCX: 000000000044eafd
[   82.903311][ T6441] RDX: 000000000000fdef RSI: 0000000020000080
RDI: 0000000000000004
[   82.904625][ T6441] RBP: 00007ffec490a880 R08: 0000000000000000
R09: 0000000000000000
[   82.905919][ T6441] R10: 0000000000000000 R11: 0000000000000246
R12: 0000000000403b00
[   82.907212][ T6441] R13: 0000000000000000 R14: 00000000004c6018
R15: 0000000000000000
[   82.908522][ T6441]  </TASK>
[   82.909026][ T6441] Modules linked in:
[   82.909671][ T6441] ---[ end trace 99ae3d17814cae89 ]---
[   82.910556][ T6441] RIP: 0010:percpu_counter_add_batch+0x3e/0x130
[   82.911627][ T6441] Code: 53 48 63 da e8 73 44 b4 fd 4c 8d 7d 20 48
c7 c7 40 0d dd 88 e8 c3 63 94 04 4c 89 fa 48 b8 00 00 00 00 00 fc ff
df 48 c1 ea 03 <80> 3c 02 0d
[   82.914533][ T6441] RSP: 0018:ffffc9000634f9e8 EFLAGS: 00010012
[   82.915482][ T6441] RAX: dffffc0000000000 RBX: 0000000000000010
RCX: 1ffffffff1a443f8
[   82.916677][ T6441] RDX: 0000000000000015 RSI: ffffffff88dd0d40
RDI: ffffffff88dac160
[   82.917868][ T6441] RBP: 0000000000000088 R08: 0000000000000004
R09: fffff940000bb9b9
[   82.919086][ T6441] R10: ffffea00005dcdc7 R11: fffff940000bb9b8
R12: 0000000000000000
[   82.920262][ T6441] R13: 0000000000000001 R14: 0000000000000001
R15: 00000000000000a8
[   82.921457][ T6441] FS:  00000000014e5880(0000)
GS:ffff88802d400000(0000) knlGS:0000000000000000
[   82.922825][ T6441] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   82.923845][ T6441] CR2: 0000000020000000 CR3: 00000000185a2000
CR4: 00000000000006f0
[   82.925080][ T6441] Kernel panic - not syncing: Fatal exception
[   82.926163][ T6441] Kernel Offset: disabled
[   82.926853][ T6441] Rebooting in 86400 seconds..

```
The attachment is a reproduce.

Regards,
 butt3rflyh4ck.

--
Active Defense Lab of Venustech

[[-- Attachment #2: crash --]
[-- Type: application/octet-stream, Size: 897912 bytes --]](../../CAFcO6XOHm6wx5f1OCA5DOUhSUpJpzL6i0h%2BMhQtMagD191q38Q%40mail.gmail.com/2-crash)

[^](#ma2c89a6bee5f604d940116918fb4ab807c995aa1) [permalink](../../CAFcO6XOHm6wx5f1OCA5DOUhSUpJpzL6i0h%2BMhQtMagD191q38Q%40mail.gmail.com/) [raw](../../CAFcO6XOHm6wx5f1OCA5DOUhSUpJpzL6i0h%2BMhQtMagD191q38Q%40mail.gmail.com/raw) [reply](../../CAFcO6XOHm6wx5f1OCA5DOUhSUpJpzL6i0h%2BMhQtMagD191q38Q%40mail.gmail.com/#R)	[[flat](../../CAFcO6XOHm6wx5f1OCA5DOUhSUpJpzL6i0h%2BMhQtMagD191q38Q%40mail.gmail.com/T/#u)|[nested](../../CAFcO6XOHm6wx5f1OCA5DOUhSUpJpzL6i0h%2BMhQtMagD191q38Q%40mail.gmail.com/t/#u)] [3+ messages in thread](#ra2c89a6bee5f604d940116918fb4ab807c995aa1)
```

---

```
[*](#ee83f2858f0536bd4d46ce987d768939b8ccb050d) Re: A null-ptr-deref bug be triggered when write to an ICB inode
  2022-01-13 10:57 [A null-ptr-deref bug be triggered when write to an ICB inode](#ma2c89a6bee5f604d940116918fb4ab807c995aa1) butt3rflyh4ck
@ 2022-01-14 17:23 ` Jan Kara
  2022-01-15  7:36   ` [butt3rflyh4ck](#mf78a8d2974511bccff39f27d99fa45da1829dba9)
  [0 siblings, 1 reply; 3+ messages in thread](#re83f2858f0536bd4d46ce987d768939b8ccb050d)
From: Jan Kara @ 2022-01-14 17:23 UTC ([permalink](../../20220114172329.ygzry5rlz64ua2nr%40quack3.lan/) / [raw](../../20220114172329.ygzry5rlz64ua2nr%40quack3.lan/raw))
  To: butt3rflyh4ck; +Cc: jack, [LKML](../../../lkml/?t=20220114172333)

On Thu 13-01-22 18:57:28, butt3rflyh4ck wrote:
> Hi, there is a null pointer dereference bug that would be triggered
> when writing something to an ICB inode, I reproduce in the latest
> kernel.
>
> First mount a malicious udf image, secondly create a dir named
> "./file0", then create a file named "file1" in the file0 directory.
> Then write something to "./file0/file1", then invoke
> udf_file_write_iter function.
>
> the udf_file_write_iter code:
> ```
> static ssize_t udf_file_write_iter(struct kiocb *iocb, struct iov_iter *from)
> {
> ssize_t retval;
> struct file *file = iocb->ki_filp;
> struct inode *inode = file_inode(file);
> struct udf_inode_info *iinfo = UDF_I(inode);
> int err;
>
> inode_lock(inode);
>
> retval = generic_write_checks(iocb, from);
> if (retval <= 0)
> goto out;
>
> down_write(&iinfo->i_data_sem);
> if (iinfo->i_alloc_type == ICBTAG_FLAG_AD_IN_ICB) {   ///[1 ]
> loff_t end = iocb->ki_pos + iov_iter_count(from);   ///[2] end =
> iocb->ki_pos + i->count = iocb->ki_pos + user_write_size
>
> if (inode->i_sb->s_blocksize <
> (udf_file_entry_alloc_offset(inode) + end)) {  /// [3]
> err = udf_expand_file_adinicb(inode);
>
> ....
>
> }
> ```
> [1] if the inode is ICBTAG_FLAG_AD_IN_ICB type, [2] then get a end,
> [3] compare blocksize and end, if blocksize is smaller then invoke
> udf_expand_file_adinicb to modify inode.
> Next, in the process of expanding the block, trigger the bug.
>
> the crash log:
> ```
> [   82.827914][ T6441] loop0: detected capacity change from 0 to 5656
> [   82.830192][ T6441] UDF-fs: warning (device loop0): udf_load_vrs:
> No anchor found
> [   82.831014][ T6441] UDF-fs: Scanning with blocksize 512 failed
> [   82.833515][ T6441] UDF-fs: INFO Mounting volume 'LinuxUDF',
> timestamp 2020/09/19 18:44 (1000)
> [   82.835323][ T6441] general protection fault, probably for
> non-canonical address 0xdffffc0000000015: 0000 [#1] PREEMPT SMP KASAN
> [   82.836556][ T6441] KASAN: null-ptr-deref in range
> [0x00000000000000a8-0x00000000000000af]
> [   82.837437][ T6441] CPU: 0 PID: 6441 Comm: percpu_counter_ Not
> tainted 5.16.0+ #34
> [   82.838242][ T6441] Hardware name: QEMU Standard PC (i440FX + PIIX,
> 1996), BIOS 1.13.0-1ubuntu1 04/01/2014
> [   82.838885][   T26] audit: type=1800 audit(1642070781.843:2):
> pid=6441 uid=0 auid=0 ses=1 subj==unconfined op=collect_data
> cause=failed(directio) comm="percpu_count0
> [   82.843723][ T6441] RIP: 0010:percpu_counter_add_batch+0x3e/0x130
> [   82.843757][ T6441] Code: 53 48 63 da e8 73 44 b4 fd 4c 8d 7d 20 48
> c7 c7 40 0d dd 88 e8 c3 63 94 04 4c 89 fa 48 b8 00 00 00 00 00 fc ff
> df 48 c1 ea 03 <80> 3c 02 0d
> [   82.843760][ T6441] RSP: 0018:ffffc9000634f9e8 EFLAGS: 00010012
> [   82.843765][ T6441] RAX: dffffc0000000000 RBX: 0000000000000010
> RCX: 1ffffffff1a443f8
> [   82.843768][ T6441] RDX: 0000000000000015 RSI: ffffffff88dd0d40
> RDI: ffffffff88dac160
> [   82.843769][ T6441] RBP: 0000000000000088 R08: 0000000000000004
> R09: fffff940000bb9b9
> [   82.843771][ T6441] R10: ffffea00005dcdc7 R11: fffff940000bb9b8
> R12: 0000000000000000
> [   82.843772][ T6441] R13: 0000000000000001 R14: 0000000000000001
> R15: 00000000000000a8
> [   82.843776][ T6441] FS:  00000000014e5880(0000)
> GS:ffff88802d400000(0000) knlGS:0000000000000000
> [   82.843780][ T6441] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
> [   82.843785][ T6441] CR2: 0000000020000000 CR3: 00000000185a2000
> CR4: 00000000000006f0
> [   82.843791][ T6441] Call Trace:
> [   82.843795][ T6441]  <TASK>
> [   82.843799][ T6441]  __folio_start_writeback+0x64f/0x7b0
> [   82.843805][ T6441]  ? domain_dirty_limits+0x350/0x350
> [   82.843808][ T6441]  ? udf_get_block+0x208/0x4d0
> [   82.843813][ T6441]  ? errseq_set+0x7b/0xe0
> [   82.843817][ T6441]  __block_write_full_page+0x9b0/0xdc0
> [   82.843822][ T6441]  ? udf_block_map+0x250/0x250
> [   82.843824][ T6441]  ? end_buffer_write_sync+0xb0/0xb0
> [   82.843827][ T6441]  udf_expand_file_adinicb+0x3bc/0xcc0
> [   82.843830][ T6441]  ? udf_update_inode+0x3370/0x3370
> [   82.843833][ T6441]  udf_file_write_iter+0x298/0x440
> [   82.843835][ T6441]  ? _raw_spin_lock+0x88/0x110
> [   82.843844][ T6441]  new_sync_write+0x37f/0x620
> [   82.843848][ T6441]  ? new_sync_read+0x610/0x610
> [   82.843850][ T6441]  ? common_file_perm+0x196/0x5f0
> [   82.843855][ T6441]  ? apparmor_path_rmdir+0x20/0x20
> [   82.843857][ T6441]  ? kmem_cache_free+0x9a/0x490
> [   82.843860][ T6441]  ? security_file_permission+0x49/0x570
> [   82.843864][ T6441]  vfs_write+0x41d/0x7b0
> [   82.892153][ T6441]  ksys_write+0xe8/0x1c0
> [   82.894156][ T6441]  ? __ia32_sys_read+0xa0/0xa0
> [   82.895079][ T6441]  do_syscall_64+0x35/0xb0
> [   82.895830][ T6441]  entry_SYSCALL_64_after_hwframe+0x44/0xae
> [   82.896810][ T6441] RIP: 0033:0x44eafd
> [   82.897449][ T6441] Code: 02 b8 ff ff ff ff c3 66 0f 1f 44 00 00 f3
> 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b
> 4c 24 08 0f 05 <48> 3d 01 f8
> [   82.900627][ T6441] RSP: 002b:00007ffec490a868 EFLAGS: 00000246
> ORIG_RAX: 0000000000000001
> [   82.901996][ T6441] RAX: ffffffffffffffda RBX: 0000000000400530
> RCX: 000000000044eafd
> [   82.903311][ T6441] RDX: 000000000000fdef RSI: 0000000020000080
> RDI: 0000000000000004
> [   82.904625][ T6441] RBP: 00007ffec490a880 R08: 0000000000000000
> R09: 0000000000000000
> [   82.905919][ T6441] R10: 0000000000000000 R11: 0000000000000246
> R12: 0000000000403b00
> [   82.907212][ T6441] R13: 0000000000000000 R14: 00000000004c6018
> R15: 0000000000000000
> [   82.908522][ T6441]  </TASK>
> [   82.909026][ T6441] Modules linked in:
> [   82.909671][ T6441] ---[ end trace 99ae3d17814cae89 ]---
> [   82.910556][ T6441] RIP: 0010:percpu_counter_add_batch+0x3e/0x130
> [   82.911627][ T6441] Code: 53 48 63 da e8 73 44 b4 fd 4c 8d 7d 20 48
> c7 c7 40 0d dd 88 e8 c3 63 94 04 4c 89 fa 48 b8 00 00 00 00 00 fc ff
> df 48 c1 ea 03 <80> 3c 02 0d
> [   82.914533][ T6441] RSP: 0018:ffffc9000634f9e8 EFLAGS: 00010012
> [   82.915482][ T6441] RAX: dffffc0000000000 RBX: 0000000000000010
> RCX: 1ffffffff1a443f8
> [   82.916677][ T6441] RDX: 0000000000000015 RSI: ffffffff88dd0d40
> RDI: ffffffff88dac160
> [   82.917868][ T6441] RBP: 0000000000000088 R08: 0000000000000004
> R09: fffff940000bb9b9
> [   82.919086][ T6441] R10: ffffea00005dcdc7 R11: fffff940000bb9b8
> R12: 0000000000000000
> [   82.920262][ T6441] R13: 0000000000000001 R14: 0000000000000001
> R15: 00000000000000a8
> [   82.921457][ T6441] FS:  00000000014e5880(0000)
> GS:ffff88802d400000(0000) knlGS:0000000000000000
> [   82.922825][ T6441] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
> [   82.923845][ T6441] CR2: 0000000020000000 CR3: 00000000185a2000
> CR4: 00000000000006f0
> [   82.925080][ T6441] Kernel panic - not syncing: Fatal exception
> [   82.926163][ T6441] Kernel Offset: disabled
> [   82.926853][ T6441] Rebooting in 86400 seconds..
>
> ```
> The attachment is a reproduce.

Thanks for report. Do you have a source code for the reproducer? Or the
corrupted UDF image to share?

								Honza
--
Jan Kara <jack@suse.com>
SUSE Labs, CR

[^](#me83f2858f0536bd4d46ce987d768939b8ccb050d) [permalink](../../20220114172329.ygzry5rlz64ua2nr%40quack3.lan/) [raw](../../20220114172329.ygzry5rlz64ua2nr%40quack3.lan/raw) [reply](../../20220114172329.ygzry5rlz64ua2nr%40quack3.lan/#R)	[[flat](../../20220114172329.ygzry5rlz64ua2nr%40quack3.lan/T/#u)|[nested](../../20220114172329.ygzry5rlz64ua2nr%40quack3.lan/t/#u)] [3+ messages in thread](#re83f2858f0536bd4d46ce987d768939b8ccb050d)
```

---

```
[*](#ef78a8d2974511bccff39f27d99fa45da1829dba9) Re: A null-ptr-deref bug be triggered when write to an ICB inode
  2022-01-14 17:23 ` [Jan Kara](#me83f2858f0536bd4d46ce987d768939b8ccb050d)
@ 2022-01-15  7:36   ` butt3rflyh4ck
  [0 siblings, 0 replies; 3+ messages in thread](#rf78a8d2974511bccff39f27d99fa45da1829dba9)
From: butt3rflyh4ck @ 2022-01-15  7:36 UTC ([permalink](../../CAFcO6XPUciTsXVDYr7XW-CoJyo2Kq61XBgymha2wBAf34tJaCg%40mail.gmail.com/) / [raw](../../CAFcO6XPUciTsXVDYr7XW-CoJyo2Kq61XBgymha2wBAf34tJaCg%40mail.gmail.com/raw))
  To: Jan Kara; +Cc: jack, [LKML](../../../lkml/?t=20220115073656)

[[-- Attachment #1: Type: text/plain, Size: 7623 bytes --]](../../CAFcO6XPUciTsXVDYr7XW-CoJyo2Kq61XBgymha2wBAf34tJaCg%40mail.gmail.com/1-a.txt)

Here you go.

Regards,
 butt3rflyh4ck.

On Sat, Jan 15, 2022 at 1:23 AM Jan Kara <jack@suse.cz> wrote:
>
> On Thu 13-01-22 18:57:28, butt3rflyh4ck wrote:
> > Hi, there is a null pointer dereference bug that would be triggered
> > when writing something to an ICB inode, I reproduce in the latest
> > kernel.
> >
> > First mount a malicious udf image, secondly create a dir named
> > "./file0", then create a file named "file1" in the file0 directory.
> > Then write something to "./file0/file1", then invoke
> > udf_file_write_iter function.
> >
> > the udf_file_write_iter code:
> > ```
> > static ssize_t udf_file_write_iter(struct kiocb *iocb, struct iov_iter *from)
> > {
> > ssize_t retval;
> > struct file *file = iocb->ki_filp;
> > struct inode *inode = file_inode(file);
> > struct udf_inode_info *iinfo = UDF_I(inode);
> > int err;
> >
> > inode_lock(inode);
> >
> > retval = generic_write_checks(iocb, from);
> > if (retval <= 0)
> > goto out;
> >
> > down_write(&iinfo->i_data_sem);
> > if (iinfo->i_alloc_type == ICBTAG_FLAG_AD_IN_ICB) {   ///[1 ]
> > loff_t end = iocb->ki_pos + iov_iter_count(from);   ///[2] end =
> > iocb->ki_pos + i->count = iocb->ki_pos + user_write_size
> >
> > if (inode->i_sb->s_blocksize <
> > (udf_file_entry_alloc_offset(inode) + end)) {  /// [3]
> > err = udf_expand_file_adinicb(inode);
> >
> > ....
> >
> > }
> > ```
> > [1] if the inode is ICBTAG_FLAG_AD_IN_ICB type, [2] then get a end,
> > [3] compare blocksize and end, if blocksize is smaller then invoke
> > udf_expand_file_adinicb to modify inode.
> > Next, in the process of expanding the block, trigger the bug.
> >
> > the crash log:
> > ```
> > [   82.827914][ T6441] loop0: detected capacity change from 0 to 5656
> > [   82.830192][ T6441] UDF-fs: warning (device loop0): udf_load_vrs:
> > No anchor found
> > [   82.831014][ T6441] UDF-fs: Scanning with blocksize 512 failed
> > [   82.833515][ T6441] UDF-fs: INFO Mounting volume 'LinuxUDF',
> > timestamp 2020/09/19 18:44 (1000)
> > [   82.835323][ T6441] general protection fault, probably for
> > non-canonical address 0xdffffc0000000015: 0000 [#1] PREEMPT SMP KASAN
> > [   82.836556][ T6441] KASAN: null-ptr-deref in range
> > [0x00000000000000a8-0x00000000000000af]
> > [   82.837437][ T6441] CPU: 0 PID: 6441 Comm: percpu_counter_ Not
> > tainted 5.16.0+ #34
> > [   82.838242][ T6441] Hardware name: QEMU Standard PC (i440FX + PIIX,
> > 1996), BIOS 1.13.0-1ubuntu1 04/01/2014
> > [   82.838885][   T26] audit: type=1800 audit(1642070781.843:2):
> > pid=6441 uid=0 auid=0 ses=1 subj==unconfined op=collect_data
> > cause=failed(directio) comm="percpu_count0
> > [   82.843723][ T6441] RIP: 0010:percpu_counter_add_batch+0x3e/0x130
> > [   82.843757][ T6441] Code: 53 48 63 da e8 73 44 b4 fd 4c 8d 7d 20 48
> > c7 c7 40 0d dd 88 e8 c3 63 94 04 4c 89 fa 48 b8 00 00 00 00 00 fc ff
> > df 48 c1 ea 03 <80> 3c 02 0d
> > [   82.843760][ T6441] RSP: 0018:ffffc9000634f9e8 EFLAGS: 00010012
> > [   82.843765][ T6441] RAX: dffffc0000000000 RBX: 0000000000000010
> > RCX: 1ffffffff1a443f8
> > [   82.843768][ T6441] RDX: 0000000000000015 RSI: ffffffff88dd0d40
> > RDI: ffffffff88dac160
> > [   82.843769][ T6441] RBP: 0000000000000088 R08: 0000000000000004
> > R09: fffff940000bb9b9
> > [   82.843771][ T6441] R10: ffffea00005dcdc7 R11: fffff940000bb9b8
> > R12: 0000000000000000
> > [   82.843772][ T6441] R13: 0000000000000001 R14: 0000000000000001
> > R15: 00000000000000a8
> > [   82.843776][ T6441] FS:  00000000014e5880(0000)
> > GS:ffff88802d400000(0000) knlGS:0000000000000000
> > [   82.843780][ T6441] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
> > [   82.843785][ T6441] CR2: 0000000020000000 CR3: 00000000185a2000
> > CR4: 00000000000006f0
> > [   82.843791][ T6441] Call Trace:
> > [   82.843795][ T6441]  <TASK>
> > [   82.843799][ T6441]  __folio_start_writeback+0x64f/0x7b0
> > [   82.843805][ T6441]  ? domain_dirty_limits+0x350/0x350
> > [   82.843808][ T6441]  ? udf_get_block+0x208/0x4d0
> > [   82.843813][ T6441]  ? errseq_set+0x7b/0xe0
> > [   82.843817][ T6441]  __block_write_full_page+0x9b0/0xdc0
> > [   82.843822][ T6441]  ? udf_block_map+0x250/0x250
> > [   82.843824][ T6441]  ? end_buffer_write_sync+0xb0/0xb0
> > [   82.843827][ T6441]  udf_expand_file_adinicb+0x3bc/0xcc0
> > [   82.843830][ T6441]  ? udf_update_inode+0x3370/0x3370
> > [   82.843833][ T6441]  udf_file_write_iter+0x298/0x440
> > [   82.843835][ T6441]  ? _raw_spin_lock+0x88/0x110
> > [   82.843844][ T6441]  new_sync_write+0x37f/0x620
> > [   82.843848][ T6441]  ? new_sync_read+0x610/0x610
> > [   82.843850][ T6441]  ? common_file_perm+0x196/0x5f0
> > [   82.843855][ T6441]  ? apparmor_path_rmdir+0x20/0x20
> > [   82.843857][ T6441]  ? kmem_cache_free+0x9a/0x490
> > [   82.843860][ T6441]  ? security_file_permission+0x49/0x570
> > [   82.843864][ T6441]  vfs_write+0x41d/0x7b0
> > [   82.892153][ T6441]  ksys_write+0xe8/0x1c0
> > [   82.894156][ T6441]  ? __ia32_sys_read+0xa0/0xa0
> > [   82.895079][ T6441]  do_syscall_64+0x35/0xb0
> > [   82.895830][ T6441]  entry_SYSCALL_64_after_hwframe+0x44/0xae
> > [   82.896810][ T6441] RIP: 0033:0x44eafd
> > [   82.897449][ T6441] Code: 02 b8 ff ff ff ff c3 66 0f 1f 44 00 00 f3
> > 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b
> > 4c 24 08 0f 05 <48> 3d 01 f8
> > [   82.900627][ T6441] RSP: 002b:00007ffec490a868 EFLAGS: 00000246
> > ORIG_RAX: 0000000000000001
> > [   82.901996][ T6441] RAX: ffffffffffffffda RBX: 0000000000400530
> > RCX: 000000000044eafd
> > [   82.903311][ T6441] RDX: 000000000000fdef RSI: 0000000020000080
> > RDI: 0000000000000004
> > [   82.904625][ T6441] RBP: 00007ffec490a880 R08: 0000000000000000
> > R09: 0000000000000000
> > [   82.905919][ T6441] R10: 0000000000000000 R11: 0000000000000246
> > R12: 0000000000403b00
> > [   82.907212][ T6441] R13: 0000000000000000 R14: 00000000004c6018
> > R15: 0000000000000000
> > [   82.908522][ T6441]  </TASK>
> > [   82.909026][ T6441] Modules linked in:
> > [   82.909671][ T6441] ---[ end trace 99ae3d17814cae89 ]---
> > [   82.910556][ T6441] RIP: 0010:percpu_counter_add_batch+0x3e/0x130
> > [   82.911627][ T6441] Code: 53 48 63 da e8 73 44 b4 fd 4c 8d 7d 20 48
> > c7 c7 40 0d dd 88 e8 c3 63 94 04 4c 89 fa 48 b8 00 00 00 00 00 fc ff
> > df 48 c1 ea 03 <80> 3c 02 0d
> > [   82.914533][ T6441] RSP: 0018:ffffc9000634f9e8 EFLAGS: 00010012
> > [   82.915482][ T6441] RAX: dffffc0000000000 RBX: 0000000000000010
> > RCX: 1ffffffff1a443f8
> > [   82.916677][ T6441] RDX: 0000000000000015 RSI: ffffffff88dd0d40
> > RDI: ffffffff88dac160
> > [   82.917868][ T6441] RBP: 0000000000000088 R08: 0000000000000004
> > R09: fffff940000bb9b9
> > [   82.919086][ T6441] R10: ffffea00005dcdc7 R11: fffff940000bb9b8
> > R12: 0000000000000000
> > [   82.920262][ T6441] R13: 0000000000000001 R14: 0000000000000001
> > R15: 00000000000000a8
> > [   82.921457][ T6441] FS:  00000000014e5880(0000)
> > GS:ffff88802d400000(0000) knlGS:0000000000000000
> > [   82.922825][ T6441] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
> > [   82.923845][ T6441] CR2: 0000000020000000 CR3: 00000000185a2000
> > CR4: 00000000000006f0
> > [   82.925080][ T6441] Kernel panic - not syncing: Fatal exception
> > [   82.926163][ T6441] Kernel Offset: disabled
> > [   82.926853][ T6441] Rebooting in 86400 seconds..
> >
> > ```
> > The attachment is a reproduce.
>
> Thanks for report. Do you have a source code for the reproducer? Or the
> corrupted UDF image to share?
>
>                                                                 Honza
> --
> Jan Kara <jack@suse.com>
> SUSE Labs, CR

--
Active Defense Lab of Venustech

[[-- Attachment #2: repro.cprog --]
[-- Type: application/octet-stream, Size: 14819 bytes --]](../../CAFcO6XPUciTsXVDYr7XW-CoJyo2Kq61XBgymha2wBAf34tJaCg%40mail.gmail.com/2-repro.cprog)

// autogenerated by syzkaller (<https://github.com/google/syzkaller>)

#define _GNU_SOURCE

#include <endian.h>
#include <errno.h>
#include <fcntl.h>
#include <stddef.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ioctl.h>
#include <sys/mount.h>
#include <sys/stat.h>
#include <sys/syscall.h>
#include <sys/types.h>
#include <unistd.h>

#include <linux/loop.h>

static unsigned long long procid;

struct fs_image_segment {
	void* data;
	uintptr_t size;
	uintptr_t offset;
};

#define IMAGE_MAX_SEGMENTS 4096
#define IMAGE_MAX_SIZE (129 << 20)

#define sys_memfd_create 319

static unsigned long fs_image_segment_check(unsigned long size, unsigned long nsegs, struct fs_image_segment* segs)
{
	if (nsegs > IMAGE_MAX_SEGMENTS)
		nsegs = IMAGE_MAX_SEGMENTS;
	for (size_t i = 0; i < nsegs; i++) {
		if (segs[i].size > IMAGE_MAX_SIZE)
			segs[i].size = IMAGE_MAX_SIZE;
		segs[i].offset %= IMAGE_MAX_SIZE;
		if (segs[i].offset > IMAGE_MAX_SIZE - segs[i].size)
			segs[i].offset = IMAGE_MAX_SIZE - segs[i].size;
		if (size < segs[i].offset + segs[i].offset)
			size = segs[i].offset + segs[i].offset;
	}
	if (size > IMAGE_MAX_SIZE)
		size = IMAGE_MAX_SIZE;
	return size;
}
static int setup_loop_device(long unsigned size, long unsigned nsegs, struct fs_image_segment* segs, const char* loopname, int* memfd_p, int* loopfd_p)
{
	int err = 0, loopfd = -1;
	size = fs_image_segment_check(size, nsegs, segs);
	int memfd = syscall(sys_memfd_create, "syzkaller", 0);
	if (memfd == -1) {
		err = errno;
		goto error;
	}
	if (ftruncate(memfd, size)) {
		err = errno;
		goto error_close_memfd;
	}
	for (size_t i = 0; i < nsegs; i++) {
		if (pwrite(memfd, segs[i].data, segs[i].size, segs[i].offset) < 0) {
		}
	}
	loopfd = open(loopname, O_RDWR);
	if (loopfd == -1) {
		err = errno;
		goto error_close_memfd;
	}
	if (ioctl(loopfd, LOOP_SET_FD, memfd)) {
		if (errno != EBUSY) {
			err = errno;
			goto error_close_loop;
		}
		ioctl(loopfd, LOOP_CLR_FD, 0);
		usleep(1000);
		if (ioctl(loopfd, LOOP_SET_FD, memfd)) {
			err = errno;
			goto error_close_loop;
		}
	}
	*memfd_p = memfd;
	*loopfd_p = loopfd;
	return 0;

error_close_loop:
	close(loopfd);
error_close_memfd:
	close(memfd);
error:
	errno = err;
	return -1;
}

static long syz_mount_image(volatile long fsarg, volatile long dir, volatile unsigned long size, volatile unsigned long nsegs, volatile long segments, volatile long flags, volatile long optsarg)
{
	struct fs_image_segment* segs = (struct fs_image_segment*)segments;
	int res = -1, err = 0, loopfd = -1, memfd = -1, need_loop_device = !!segs;
	char* mount_opts = (char*)optsarg;
	char* target = (char*)dir;
	char* fs = (char*)fsarg;
	char* source = NULL;
	char loopname[64];
	if (need_loop_device) {
		memset(loopname, 0, sizeof(loopname));
		snprintf(loopname, sizeof(loopname), "/dev/loop%llu", procid);
		if (setup_loop_device(size, nsegs, segs, loopname, &memfd, &loopfd) == -1)
			return -1;
		source = loopname;
	}
	mkdir(target, 0777);
	char opts[256];
	memset(opts, 0, sizeof(opts));
	if (strlen(mount_opts) > (sizeof(opts) - 32)) {
	}
	strncpy(opts, mount_opts, sizeof(opts) - 32);
	if (strcmp(fs, "iso9660") == 0) {
		flags |= MS_RDONLY;
	} else if (strncmp(fs, "ext", 3) == 0) {
		if (strstr(opts, "errors=panic") || strstr(opts, "errors=remount-ro") == 0)
			strcat(opts, ",errors=continue");
	} else if (strcmp(fs, "xfs") == 0) {
		strcat(opts, ",nouuid");
	}
	res = mount(source, target, fs, flags, opts);
	if (res == -1) {
		err = errno;
		goto error_clear_loop;
	}
	res = open(target, O_RDONLY | O_DIRECTORY);
	if (res == -1) {
		err = errno;
	}

error_clear_loop:
	if (need_loop_device) {
		ioctl(loopfd, LOOP_CLR_FD, 0);
		close(loopfd);
		close(memfd);
	}
	errno = err;
	return res;
}

uint64_t r[2] = {0xffffffffffffffff, 0xffffffffffffffff};

int main(void)
{
		syscall(__NR_mmap, 0x1ffff000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);
	syscall(__NR_mmap, 0x20000000ul, 0x1000000ul, 7ul, 0x32ul, -1, 0ul);
	syscall(__NR_mmap, 0x21000000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);
				intptr_t res = 0;
memcpy((void*)0x20000000, "udf\000", 4);
memcpy((void*)0x20000100, "./file0\000", 8);
*(uint64_t*)0x20000200 = 0x20010000;
memcpy((void*)0x20010000, "\000BEA01", 6);
*(uint64_t*)0x20000208 = 6;
*(uint64_t*)0x20000210 = 0x8000;
*(uint64_t*)0x20000218 = 0x20010100;
memcpy((void*)0x20010100, "\000NSR03", 6);
*(uint64_t*)0x20000220 = 6;
*(uint64_t*)0x20000228 = 0x8800;
*(uint64_t*)0x20000230 = 0x20010300;
memcpy((void*)0x20010300, "\x01\x00\x03\x00\x60\x00\x01\x00\x15\xf5\xf0\x01\x60\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x08\x4c\x69\x6e\x75\x78\x55\x44\x46\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x01\x00\x01\x00\x03\x00\x03\x00\x01\x00\x00\x00\x01\x00\x00\x00\x08\x31\x32\x33\x34\x35\x36\x37\x38\x31\x32\x33\x34\x35\x36\x37\x38\x4c\x69\x6e\x75\x78\x55\x44\x46", 97);
*(uint64_t*)0x20000238 = 0x61;
*(uint64_t*)0x20000240 = 0x18000;
*(uint64_t*)0x20000248 = 0x20010400;
memcpy((void*)0x20010400, "\x00\x00\x00\x00\x00\x00\x00\x19\x00\x4f\x53\x54\x41\x20\x43\x6f\x6d\x70\x72\x65\x73\x73\x65\x64\x20\x55\x6e\x69\x63\x6f\x64\x65\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x4f\x53\x54\x41\x20\x43\x6f\x6d\x70\x72\x65\x73\x73\x65\x64\x20\x55\x6e\x69\x63\x6f\x64\x65\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a\x4c\x69\x6e\x75\x78\x20\x6d\x6b\x75\x64\x66\x66\x73\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x05\x00\x00\x00\x00\x00\x00\x78\x10\xe4\x07\x09\x13\x14\x2c\x19\x62\x37\x63\x00\x2a\x4c\x69\x6e\x75\x78\x20\x55\x44\x46\x46\x53\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x05", 222);
*(uint64_t*)0x20000250 = 0xde;
*(uint64_t*)0x20000258 = 0x180c0;
*(uint64_t*)0x20000260 = 0x20010500;
memcpy((void*)0x20010500, "\x00\x00\x00\x00\x00\x00\x00\x00\x01", 9);
*(uint64_t*)0x20000268 = 9;
*(uint64_t*)0x20000270 = 0x181e0;
*(uint64_t*)0x20000278 = 0x20010600;
memcpy((void*)0x20010600, "\x06\x00\x03\x00\x25\x00\x01\x00\x22\xaf\xe8\x01\x61\x00\x00\x00\x02\x00\x00\x00\x00\x4f\x53\x54\x41\x20\x43\x6f\x6d\x70\x72\x65\x73\x73\x65\x64\x20\x55\x6e\x69\x63\x6f\x64\x65\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x4c\x69\x6e\x75\x78\x55\x44\x46", 93);
*(uint64_t*)0x20000280 = 0x5d;
*(uint64_t*)0x20000288 = 0x18400;
*(uint64_t*)0x20000290 = 0x20010700;
memcpy((void*)0x20010700, "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x00\x04\x00\x00\x00\x2a\x4f\x53\x54\x41\x20\x55\x44\x46\x20\x43\x6f\x6d\x70\x6c\x69\x61\x6e\x74\x00\x00\x00\x00\x01\x02\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x20\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x40\x00\x00\x00\x01\x00\x00\x00\x00\x2a\x4c\x69\x6e\x75\x78\x20\x55\x44\x46\x46\x53\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x05", 106);
*(uint64_t*)0x20000298 = 0x6a;
*(uint64_t*)0x200002a0 = 0x184c0;
*(uint64_t*)0x200002a8 = 0x20010800;
memcpy((void*)0x20010800, "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x80\x00\x00\x00\x02\x40\x00\x00\x00\x2a\x55\x44\x46\x20\x53\x70\x61\x72\x61\x62\x6c\x65\x20\x50\x61\x72\x74\x69\x74\x69\x6f\x6e\x01\x02\x04\x05\x00\x00\x00\x00\x01\x00\x00\x00\x20\x00\x02\x00\x38\x01\x00\x00\xa0\x00\x00\x00\xe0\x07", 78);
*(uint64_t*)0x200002b0 = 0x4e;
*(uint64_t*)0x200002b8 = 0x185a0;
*(uint64_t*)0x200002c0 = 0x20010900;
memcpy((void*)0x20010900, "\x05\x00\x03\x00\x12\x00\x01\x00\xa7\x0f\xf0\x01\x62\x00\x00\x00\x05\x00\x00\x00\x01\x00\x00\x00\x00\x2b\x4e\x53\x52\x30\x33\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04", 66);
*(uint64_t*)0x200002c8 = 0x42;
*(uint64_t*)0x200002d0 = 0x18800;
*(uint64_t*)0x200002d8 = 0x20010a00;
memcpy((void*)0x20010a00, "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x20\x05\x00\x00\xa0\x02\x00\x00\x00\x2a\x4c\x69\x6e\x75\x78\x20\x55\x44\x46\x46\x53\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x05", 62);
*(uint64_t*)0x200002e0 = 0x3e;
*(uint64_t*)0x200002e8 = 0x188a0;
*(uint64_t*)0x200002f0 = 0x20010f00;
memcpy((void*)0x20010f00, "\x09\x00\x03\x00\xa4\x00\x01\x00\x46\x5b\x76\x00\x80\x00\x00\x00\x00\x10\xe4\x07\x09\x13\x12\x2c\x1a\x3c\x15\x0c\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x17\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x2e\x00\x00\x00\x8a\x02\x00\x00\xa0\x02\x00\x00\x00\x2a\x4c\x69\x6e\x75\x78\x20\x55\x44\x46\x46\x53\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x05\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x02\x00\x00\x00\x01\x02\x01\x02\x01\x02", 134);
*(uint64_t*)0x200002f8 = 0x86;
*(uint64_t*)0x20000300 = 0x20000;
*(uint64_t*)0x20000308 = 0x20011300;
memcpy((void*)0x20011300, "\x02\x00\x03\x00\x14\x00\x01\x00\x8d\x8f\xf0\x01\x00\x01\x00\x00\x00\x80\x00\x00\x60\x00\x00\x00\x00\x80\x00\x00\xc0\x07", 30);
*(uint64_t*)0x20000310 = 0x1e;
*(uint64_t*)0x20000318 = 0x40000;
*(uint64_t*)0x20000320 = 0x20011500;
memcpy((void*)0x20011500, "\x00\x01\x03\x00\x56\x00\x01\x00\x05\x3b\xf0\x01\x20\x00\x00\x00\x78\x10\xe4\x07\x09\x13\x14\x2c\x19\x62\x37\x63\x03\x00\x03\x00\x01\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x4f\x53\x54\x41\x20\x43\x6f\x6d\x70\x72\x65\x73\x73\x65\x64\x20\x55\x6e\x69\x63\x6f\x64\x65\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x4c\x69\x6e\x75\x78\x55\x44\x46", 121);
*(uint64_t*)0x20000328 = 0x79;
*(uint64_t*)0x20000330 = 0x150000;
*(uint64_t*)0x20000338 = 0x20011600;
memcpy((void*)0x20011600, "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x00\x4f\x53\x54\x41\x20\x43\x6f\x6d\x70\x72\x65\x73\x73\x65\x64\x20\x55\x6e\x69\x63\x6f\x64\x65\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x4c\x69\x6e\x75\x78\x55\x44\x46\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x08\x43\x6f\x70\x79\x72\x69\x67\x68\x74\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0a\x08\x41\x62\x73\x74\x72\x61\x63\x74\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x09\x00\x04\x00\x00\x60\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a\x4f\x53\x54\x41\x20\x55\x44\x46\x20\x43\x6f\x6d\x70\x6c\x69\x61\x6e\x74\x00\x00\x00\x00\x01\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x40", 245);
*(uint64_t*)0x20000340 = 0xf5;
*(uint64_t*)0x20000348 = 0x1500e0;
*(uint64_t*)0x20000350 = 0x20011900;
memcpy((void*)0x20011900, "\x0a\x01\x03\x00\xb3\x00\x01\x00\x95\xde\xd0\x01\x60\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x01\x00\x00\x04\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\xa5\x3c\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x08\x01\x00\x00\x00\x00\x00\x00\x08\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\xe4\x07\x09\x13\x12\x2c\x19\x62\x37\x63\x00\x10\xe4\x07\x09\x13\x12\x2c\x1a\x3b\x0e\x49\x00\x10\xe4\x07\x09\x13\x12\x2c\x19\x62\x37\x63\x00\x10\xe4\x07\x09\x13\x12\x2c\x1a\x3b\x0e\x49\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a\x4c\x69\x6e\x75\x78\x20\x55\x44\x46\x46\x53\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x01\x00\x00\x01\x01\x03\x00\xe1\x00\x01\x00\x33\x30\x18\x00\x60\x00\x00\x00\x01\x00\x0a\x00\x00\x04\x00\x00\x60\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x03\x00\xc8\x00\x01\x00\xf3\x53\x1c\x00\x60\x00\x00\x00\x01\x00\x02\x06\x00\x04\x00\x00\x61\x00\x00\x00\x00\x00\x00\x00\x10\x00\x00\x00\x00\x00\x08\x66\x69\x6c\x65\x30\x01\x01\x03\x00\xbf\x00\x01\x00\xb7\x86\x1c\x00\x60\x00\x00\x00\x01\x00\x00\x06\x00\x04\x00\x00\x66\x00\x00\x00\x00\x00\x00\x00\x13\x00\x00\x00\x00\x00\x08\x66\x69\x6c\x65\x31\x01\x01\x03\x00\x39\x00\x01\x00\x2c\x8b\x1c\x00\x60\x00\x00\x00\x01\x00\x00\x06\x00\x04\x00\x00\x67\x00\x00\x00\x00\x00\x00\x00\x14\x00\x00\x00\x00\x00\x08\x66\x69\x6c\x65\x32\x01\x01\x03\x00\x92\x00\x01\x00\x78\x98\x1c\x00\x60\x00\x00\x00\x01\x00\x00\x06\x00\x04\x00\x00\x67\x00\x00\x00\x00\x00\x00\x00\x15\x00\x00\x00\x00\x00\x08\x66\x69\x6c\x65\x33\x01\x01\x03\x00\x80\x00\x01\x00\xdc\x1e\x20\x00\x60\x00\x00\x00\x01\x00\x00\x0a\x00\x04\x00\x00\x71\x00\x00\x00\x00\x00\x00\x00\x16\x00\x00\x00\x00\x00\x08\x66\x69\x6c\x65\x2e\x63\x6f\x6c\x64", 480);
*(uint64_t*)0x20000358 = 0x1e0;
*(uint64_t*)0x20000360 = 0x160000;
*(uint64_t*)0x20000368 = 0x20012500;
memcpy((void*)0x20012500, "\x0a\x01\x03\x00\x7e\x00\x01\x00\x65\xd2\xd2\x00\x66\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x01\x00\x00\x05\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\xa5\x7c\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x0a\x00\x00\x00\x00\x00\x00\x00\x0a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\xe4\x07\x09\x13\x12\x2c\x1a\x3b\x0e\x49\x00\x10\xe4\x07\x09\x13\x12\x2c\x1a\x3b\x0e\x49\x00\x10\xe4\x07\x09\x13\x12\x2c\x1a\x3b\x0e\x49\x00\x10\xe4\x07\x09\x13\x12\x2c\x1a\x3b\x0e\x49\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2a\x4c\x69\x6e\x75\x78\x20\x55\x44\x46\x46\x53\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x05\x00\x00\x00\x00\x00\x00\x13\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0a\x00\x00\x00\x73\x79\x7a\x6b\x61\x6c\x6c\x65\x72\x73", 226);
*(uint64_t*)0x20000370 = 0xe2;
*(uint64_t*)0x20000378 = 0x161800;
syz_mount_image(0x20000000, 0x20000100, 0, 0x10, 0x20000200, 0, 0x20013900);// mount a udf image
memcpy((void*)0x200001c0, "./file0\000", 8);
	res = syscall(__NR_openat, 0xffffffffffffff9cul, 0x200001c0ul, 0x343400ul, 0ul);
	if (res != -1)
		r[0] = res;
memcpy((void*)0x20000040, "./file1\000", 8);
	res = syscall(__NR_openat, r[0], 0x20000040ul, 0x105042ul, 0ul);//create a file0 dir and create a ./file0/file1 file
	if (res != -1)
		r[1] = res;
memset((void*)0x20000080, 169, 1);
	syscall(__NR_write, r[1], 0x20000080ul, 0xfdeful); // write something to ./file0/file1 path.
	return 0;
}

[^](#mf78a8d2974511bccff39f27d99fa45da1829dba9) [permalink](../../CAFcO6XPUciTsXVDYr7XW-CoJyo2Kq61XBgymha2wBAf34tJaCg%40mail.gmail.com/) [raw](../../CAFcO6XPUciTsXVDYr7XW-CoJyo2Kq61XBgymha2wBAf34tJaCg%40mail.gmail.com/raw) [reply](../../CAFcO6XPUciTsXVDYr7XW-CoJyo2Kq61XBgymha2wBAf34tJaCg%40mail.gmail.com/#R)	[[flat](../../CAFcO6XPUciTsXVDYr7XW-CoJyo2Kq61XBgymha2wBAf34tJaCg%40mail.gmail.com/T/#u)|[nested](../../CAFcO6XPUciTsXVDYr7XW-CoJyo2Kq61XBgymha2wBAf34tJaCg%40mail.gmail.com/t/#u)] [3+ messages in thread](#rf78a8d2974511bccff39f27d99fa45da1829dba9)
```

---

```
end of thread, other threads:[[~2022-01-15  7:36 UTC](../../?t=20220115073656) | [newest](../../)]

Thread overview: 3+ messages (download: [mbox.gz](../t.mbox.gz) follow: [Atom feed](../t.atom)
-- links below jump to the message on this page --
2022-01-13 10:57 [A null-ptr-deref bug be triggered when write to an ICB inode](#ma2c89a6bee5f604d940116918fb4ab807c995aa1) butt3rflyh4ck
2022-01-14 17:23 ` [Jan Kara](#me83f2858f0536bd4d46ce987d768939b8ccb050d)
2022-01-15  7:36   ` [butt3rflyh4ck](#mf78a8d2974511bccff39f27d99fa45da1829dba9)

```

---

```
This is a public inbox, see [mirroring instructions](../../_/text/mirror/)
for how to clone and mirror all data and code used for this inbox;
as well as URLs for NNTP newsgroup(s).
```


=== Content from lists.debian.org_1447e1a3_20250115_090703.html ===


---

[[Date Prev](msg00011.html)][[Date Next](msg00013.html)]
[[Thread Prev](msg00011.html)][[Thread Next](msg00013.html)]
[[Date Index](maillist.html#00012)]
[[Thread Index](threads.html#00012)]

# [SECURITY] [DLA 2941-1] linux-4.19 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2941-1] linux-4.19 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Wed, 9 Mar 2022 13:40:55 +0100
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/YiigV99QQ%2BwYNpB3%40decadent.org.uk)Â [YiigV99QQ+wYNpB3@decadent.org.uk](msg00012.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-2941-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
March 09, 2022                                <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-4.19
Version        : 4.19.232-1~deb9u1
CVE ID         : CVE-2020-29374 CVE-2020-36322 CVE-2021-3640 CVE-2021-3744
                 CVE-2021-3752 CVE-2021-3760 CVE-2021-3764 CVE-2021-3772
                 CVE-2021-4002 CVE-2021-4083 CVE-2021-4135 CVE-2021-4155
                 CVE-2021-4203 CVE-2021-20317 CVE-2021-20321 CVE-2021-20322
                 CVE-2021-22600 CVE-2021-28711 CVE-2021-28712 CVE-2021-28713
                 CVE-2021-28714 CVE-2021-28715 CVE-2021-28950 CVE-2021-38300
                 CVE-2021-39685 CVE-2021-39686 CVE-2021-39698 CVE-2021-39713
                 CVE-2021-41864 CVE-2021-42739 CVE-2021-43389 CVE-2021-43975
                 CVE-2021-43976 CVE-2021-44733 CVE-2021-45095 CVE-2021-45469
                 CVE-2021-45480 CVE-2022-0001 CVE-2022-0002 CVE-2022-0322
                 CVE-2022-0330 CVE-2022-0435 CVE-2022-0487 CVE-2022-0492
                 CVE-2022-0617 CVE-2022-0644 CVE-2022-22942 CVE-2022-24448
                 CVE-2022-24959 CVE-2022-25258 CVE-2022-25375
Debian Bug     : 988044 989285 990411 994050

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2020-29374

    Jann Horn of Google reported a flaw in Linux's virtual memory
    management.  A parent and child process initially share all their
    memory, but when either writes to a shared page, the page is
    duplicated and unshared (copy-on-write).  However, in case an
    operation such as vmsplice() required the kernel to take an
    additional reference to a shared page, and a copy-on-write occurs
    during this operation, the kernel might have accessed the wrong
    process's memory.  For some programs, this could lead to an
    information leak or data corruption.

    This issue was already fixed for most architectures, but not on
    MIPS and System z.  This update corrects that.

CVE-2020-36322, CVE-2021-28950

    The syzbot tool found that the FUSE (filesystem-in-user-space)
    implementation did not correctly handle a FUSE server returning
    invalid attributes for a file.  A local user permitted to run a
    FUSE server could use this to cause a denial of service (crash).

    The original fix for this introduced a different potential denial
    of service (infinite loop in kernel space), which has also been
    fixed.

CVE-2021-3640

    Lin Ma discovered a race condiiton in the Bluetooth protocol
    implementation that can lead to a use-after-free.  A local
    user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2021-3744, CVE-2021-3764

    minihanshen reported bugs in the ccp driver for AMD
    Cryptographic Coprocessors that could lead to a resource leak.
    On systems using this driver, a local user could exploit this to
    cause a denial of service.

CVE-2021-3752

    Likang Luo of NSFOCUS Security Team discovered a flaw in the
    Bluetooth L2CAP implementation that can lead to a user-after-free.
    A local user could exploit this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2021-3760, CVE-2021-4202

    Lin Ma discovered race conditions in the NCI (NFC Controller
    Interface) driver, which could lead to a use-after-free.  A local
    user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-3772

    A flaw was found in the SCTP protocol implementation, which would
    allow a networked attacker to break an SCTP association.  The
    attacker would only need to know or guess the IP addresses and
    ports for the association.

CVE-2021-4002

    It was discovered that hugetlbfs, the virtual filesystem used by
    applications to allocate huge pages in RAM, did not flush the
    CPU's TLB in one case where it was necessary.  In some
    circumstances a local user would be able to read and write huge
    pages after they are freed and reallocated to a different process.
    This could lead to privilege escalation, denial of service or
    information leaks.

CVE-2021-4083

    Jann Horn reported a race condition in the local (Unix) sockets
    garbage collector, that can lead to use-after-free.  A local user
    could exploit this to cause a denial of service (memory corruption
    or crash) or possibly for privilege escalation.

CVE-2021-4135

    A flaw was found in the netdevsim driver which would lead to an
    information leak.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-4155

    Kirill Tkhai discovered a data leak in the way the XFS_IOC_ALLOCSP
    IOCTL in the XFS filesystem allowed for a size increase of files
    with unaligned size. A local attacker can take advantage of this
    flaw to leak data on the XFS filesystem.

CVE-2021-4203

    Jann Horn reported a race condition in the local (Unix) sockets
    implementation that can lead to a use-after-free.  A local user
    could exploit this to leak sensitive information from the kernel.

CVE-2021-20317

    It was discovered that the timer queue structure could become
    corrupt, leading to waiting tasks never being woken up.  A local
    user with certain privileges could exploit this to cause a denial
    of service (system hang).

CVE-2021-20321

    A race condition was discovered in the overlayfs filesystem
    driver.  A local user with access to an overlayfs mount and to its
    underlying upper directory could exploit this for privilege
    escalation.

CVE-2021-20322

    An information leak was discovered in the IPv4 implementation.  A
    remote attacker could exploit this to quickly discover which UDP
    ports a system is using, making it easier for them to carry out a
    DNS poisoning attack against that system.

CVE-2021-22600

    The syzbot tool found a flaw in the packet socket (AF_PACKET)
    implementation which could lead to incorrectly freeing memory.  A
    local user with CAP_NET_RAW capability (in any user namespace)
    could exploit this for denial of service (memory corruption or
    crash) or possibly for privilege escalation.

CVE-2021-28711, CVE-2021-28712, CVE-2021-28713 (XSA-391)

    Juergen Gross reported that malicious PV backends can cause a denial
    of service to guests being serviced by those backends via high
    frequency events, even if those backends are running in a less
    privileged environment.

CVE-2021-28714, CVE-2021-28715 (XSA-392)

    Juergen Gross discovered that Xen guests can force the Linux
    netback driver to hog large amounts of kernel memory, resulting in
    denial of service.

CVE-2021-38300

    Piotr Krysiuk discovered a flaw in the classic BPF (cBPF) JIT
    compiler for MIPS architectures.  A local user could exploit
    this to excute arbitrary code in the kernel.

    This issue is mitigated by setting sysctl
    net.core.bpf_jit_enable=0, which is the default.  It is *not*
    mitigated by disabling unprivileged use of eBPF.

CVE-2021-39685

    Szymon Heidrich discovered a buffer overflow vulnerability in the
    USB gadget subsystem, resulting in information disclosure, denial of
    service or privilege escalation.

CVE-2021-39686

    A race condition was discovered in the Android binder driver, that
    could lead to incorrect security checks.  On systems where the
    binder driver is loaded, a local user could exploit this for
    privilege escalation.

CVE-2021-39698

    Linus Torvalds reported a flaw in the file polling implementation,
    which could lead to a use-after-free.  A local user could exploit
    this for denial of service (memory corruption or crash) or
    possibly for privilege escalation.

CVE-2021-39713

    The syzbot tool found a race condition in the network scheduling
    subsystem which could lead to a use-after-free.  A local user
    could exploit this for denial of service (memory corruption or
    crash) or possibly for privilege escalation.

CVE-2021-41864

    An integer overflow was discovered in the Extended BPF (eBPF)
    subsystem.  A local user could exploit this for denial of service
    (memory corruption or crash), or possibly for privilege
    escalation.

    This can be mitigated by setting sysctl
    kernel.unprivileged_bpf_disabled=1, which disables eBPF use by
    unprivileged users.

CVE-2021-42739

    A heap buffer overflow was discovered in the firedtv driver for
    FireWire-connected DVB receivers.  A local user with access to a
    firedtv device could exploit this for denial of service (memory
    corruption or crash), or possibly for privilege escalation.

CVE-2021-43389

    The Active Defense Lab of Venustech discovered a flaw in the CMTP
    subsystem as used by Bluetooth, which could lead to an
    out-of-bounds read and object type confusion.  A local user with
    CAP_NET_ADMIN capability in the initial user namespace could
    exploit this for denial of service (memory corruption or crash),
    or possibly for privilege escalation.

CVE-2021-43975

    Brendan Dolan-Gavitt reported a flaw in the
    hw_atl_utils_fw_rpc_wait() function in the aQuantia AQtion ethernet
    device driver which can result in denial of service or the execution
    of arbitrary code.

CVE-2021-43976

    Zekun Shen and Brendan Dolan-Gavitt discovered a flaw in the
    mwifiex_usb_recv() function of the Marvell WiFi-Ex USB Driver. An
    attacker able to connect a crafted USB device can take advantage of
    this flaw to cause a denial of service.

CVE-2021-44733

    A race condition was discovered in the Trusted Execution
    Environment (TEE) subsystem for Arm processors, which could lead
    to a use-after-free.  A local user permitted to access a TEE
    device could exploit this for denial of service (memory corruption
    or crash) or possibly for privilege escalation.

CVE-2021-45095

    It was discovered that the Phone Network protocol (PhoNet) driver
    has a reference count leak in the pep_sock_accept() function.

CVE-2021-45469

    Wenqing Liu reported an out-of-bounds memory access in the f2fs
    implementation if an inode has an invalid last xattr entry. An
    attacker able to mount a specially crafted image can take advantage
    of this flaw for denial of service.

CVE-2021-45480

    A memory leak flaw was discovered in the __rds_conn_create()
    function in the RDS (Reliable Datagram Sockets) protocol subsystem.

CVE-2022-0001 (INTEL-SA-00598)

    Researchers at VUSec discovered that the Branch History Buffer in
    Intel processors can be exploited to create information side-
    channels with speculative execution.  This issue is similar to
    Spectre variant 2, but requires additional mitigations on some
    processors.

    This can be exploited to obtain sensitive information from a
    different security context, such as from user-space to the kernel,
    or from a KVM guest to the kernel.

CVE-2022-0002 (INTEL-SA-00598)

    This is a similar issue to CVE-2022-0001, but covers exploitation
    within a security context, such as from JIT-compiled code in a
    sandbox to hosting code in the same process.

    This can be partly mitigated by disabling eBPF for unprivileged
    users with the sysctl: kernel.unprivileged_bpf_disabled=2.  This
    update does that by default.

CVE-2022-0322

    Eiichi Tsukata discovered a flaw in the sctp_make_strreset_req()
    function in the SCTP network protocol implementation which can
    result in denial of service.

CVE-2022-0330

    Sushma Venkatesh Reddy discovered a missing GPU TLB flush in the
    i915 driver, resulting in denial of service or privilege escalation.

CVE-2022-0435

    Samuel Page and Eric Dumazet reported a stack overflow in the
    networking module for the Transparent Inter-Process Communication
    (TIPC) protocol, resulting in denial of service or potentially the
    execution of arbitrary code.

CVE-2022-0487

    A use-after-free was discovered in the MOXART SD/MMC Host Controller
    support driver. This flaw does not impact the Debian binary packages
    as CONFIG_MMC_MOXART is not set.

CVE-2022-0492

    Yiqi Sun and Kevin Wang reported that the cgroup-v1 subsystem does
    not properly restrict access to the release-agent feature. A local
    user can take advantage of this flaw for privilege escalation and
    bypass of namespace isolation.

CVE-2022-0617

    butt3rflyh4ck discovered a NULL pointer dereference in the UDF
    filesystem. A local user that can mount a specially crafted UDF
    image can use this flaw to crash the system.

CVE-2022-0644

    Hao Sun reported a missing check for file read permission in the
    finit_module() and kexec_file_load() system calls.  The security
    impact of this is unclear, since these system calls are usually
    only available to the root user.

CVE-2022-22942

    It was discovered that wrong file file descriptor handling in the
    VMware Virtual GPU driver (vmwgfx) could result in information leak
    or privilege escalation.

CVE-2022-24448

    Lyu Tao reported a flaw in the NFS implementation in the Linux
    kernel when handling requests to open a directory on a regular file,
    which could result in a information leak.

CVE-2022-24959

    A memory leak was discovered in the yam_siocdevprivate() function of
    the YAM driver for AX.25, which could result in denial of service.

CVE-2022-25258

    Szymon Heidrich reported the USB Gadget subsystem lacks certain
    validation of interface OS descriptor requests, resulting in memory
    corruption.

CVE-2022-25375

    Szymon Heidrich reported that the RNDIS USB gadget lacks validation
    of the size of the RNDIS_MSG_SET command, resulting in information
    leak from kernel memory.

For Debian 9 stretch, these problems have been fixed in version
4.19.232-1~deb9u1.  This update additionally includes many more bug
fixes from stable updates 4.19.209-4.19.232 inclusive.

We recommend that you upgrade your linux-4.19 packages.

For the detailed security status of linux-4.19 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-4.19>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpTZkVodrlDJ.pgp)**

*Description:* PGP signature

---



=== Content from git.kernel.org_27a8c45c_20250115_221106.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=ea8569194b43f0f01f0a84c689388542c7254a1f)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=ea8569194b43f0f01f0a84c689388542c7254a1f)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ea8569194b43f0f01f0a84c689388542c7254a1f)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=ea8569194b43f0f01f0a84c689388542c7254a1f)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jan Kara <jack@suse.cz> | 2022-01-18 09:57:25 +0100 |
| --- | --- | --- |
| committer | Jan Kara <jack@suse.cz> | 2022-01-24 14:45:02 +0100 |
| commit | [ea8569194b43f0f01f0a84c689388542c7254a1f](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ea8569194b43f0f01f0a84c689388542c7254a1f) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=ea8569194b43f0f01f0a84c689388542c7254a1f)) | |
| tree | [bdabba9ed18aab1a83dfbef27495b955d42fbac6](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=ea8569194b43f0f01f0a84c689388542c7254a1f) | |
| parent | [7fc3b7c2981bbd1047916ade327beccb90994eee](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=7fc3b7c2981bbd1047916ade327beccb90994eee) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=ea8569194b43f0f01f0a84c689388542c7254a1f&id2=7fc3b7c2981bbd1047916ade327beccb90994eee)) | |
| download | [linux-ea8569194b43f0f01f0a84c689388542c7254a1f.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-ea8569194b43f0f01f0a84c689388542c7254a1f.tar.gz) | |

udf: Restore i\_lenAlloc when inode expansion failsWhen we fail to expand inode from inline format to a normal format, we
restore inode to contain the original inline formatting but we forgot to
set i\_lenAlloc back. The mismatch between i\_lenAlloc and i\_size was then
causing further problems such as warnings and lost data down the line.
Reported-by: butt3rflyh4ck <butterflyhuangxx@gmail.com>
CC: stable@vger.kernel.org
Fixes: 7e49b6f2480c ("udf: Convert UDF to new truncate calling sequence")
Reviewed-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Jan Kara <jack@suse.cz>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=ea8569194b43f0f01f0a84c689388542c7254a1f)

| -rw-r--r-- | [fs/udf/inode.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/udf/inode.c?id=ea8569194b43f0f01f0a84c689388542c7254a1f) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/fs/udf/inode.c b/fs/udf/inode.cindex d6aa506b6b5840..ea8f6cd01f5016 100644--- a/[fs/udf/inode.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/udf/inode.c?id=7fc3b7c2981bbd1047916ade327beccb90994eee)+++ b/[fs/udf/inode.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/udf/inode.c?id=ea8569194b43f0f01f0a84c689388542c7254a1f)@@ -315,6 +315,7 @@ int udf\_expand\_file\_adinicb(struct inode \*inode) unlock\_page(page); iinfo->i\_alloc\_type = ICBTAG\_FLAG\_AD\_IN\_ICB; inode->i\_data.a\_ops = &udf\_adinicb\_aops;+ iinfo->i\_lenAlloc = inode->i\_size; up\_write(&iinfo->i\_data\_sem); } put\_page(page); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 22:09:43 +0000



=== Content from www.debian.org_ef4e306b_20250115_090705.html ===


---

[[Date Prev](msg00061.html)][[Date Next](msg00063.html)]
[[Thread Prev](msg00061.html)][[Thread Next](msg00063.html)]
[[Date Index](maillist.html#00062)]
[[Thread Index](threads.html#00062)]

# [SECURITY] [DSA 5095-1] linux security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5095-1] linux security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Wed, 09 Mar 2022 15:30:29 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/E1nRyGj-0004KZ-1r%40seger.debian.org)Â [E1nRyGj-0004KZ-1r@seger.debian.org](msg00062.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5095-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
March 09, 2022                        <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : linux
CVE ID         : CVE-2020-36310 CVE-2022-0001 CVE-2022-0002 CVE-2022-0487
                 CVE-2022-0492 CVE-2022-0617 CVE-2022-25636
Debian Bug     : 990279

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2020-36310

    A flaw was discovered in the KVM implementation for AMD processors,
    which could lead to an infinite loop.  A malicious VM guest could
    exploit this to cause a denial of service.

CVE-2022-0001 (INTEL-SA-00598)

    Researchers at VUSec discovered that the Branch History Buffer in
    Intel processors can be exploited to create information side-
    channels with speculative execution.  This issue is similar to
    Spectre variant 2, but requires additional mitigations on some
    processors.

    This can be exploited to obtain sensitive information from a
    different security context, such as from user-space to the kernel,
    or from a KVM guest to the kernel.

CVE-2022-0002 (INTEL-SA-00598)

    This is a similar issue to CVE-2022-0001, but covers exploitation
    within a security context, such as from JIT-compiled code in a
    sandbox to hosting code in the same process.

    This is partly mitigated by disabling eBPF for unprivileged users
    with the sysctl: kernel.unprivileged_bpf_disabled=2.  This is
    already the default in Debian 11 "bullseye".

CVE-2022-0487

    A use-after-free was discovered in the MOXART SD/MMC Host Controller
    support driver. This flaw does not impact the Debian binary packages
    as CONFIG_MMC_MOXART is not set.

CVE-2022-0492

    Yiqi Sun and Kevin Wang reported that the cgroup-v1 subsystem does
    not properly restrict access to the release-agent feature. A local
    user can take advantage of this flaw for privilege escalation and
    bypass of namespace isolation.

CVE-2022-0617

    butt3rflyh4ck discovered a NULL pointer dereference in the UDF
    filesystem. A local user that can mount a specially crafted UDF
    image can use this flaw to crash the system.

CVE-2022-25636

    Nick Gregory reported a heap out-of-bounds write flaw in the
    netfilter subsystem. A user with the CAP_NET_ADMIN capability could
    use this for denial of service or possibly for privilege escalation.

For the stable distribution (bullseye), these problems have been fixed
in version 5.10.103-1.  This update additionally includes many more
bug fixes from stable updates 5.10.93-5.10.103 inclusive.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAmIotmRfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0Qajw//WLCg/HhmykP7eobsnnn7A0U0ONBbZi+Un6Ltueaambvlhme54l5eR4uh
f8fLSehpKhEN4bzfWRnDe0vKbws557zsNnd+a000ylfkO6BqEoNL8VwMp0yOVvUt
+nB39/ySIM1inH375JAWZ5M2+H8YJVBPrlm0kGxUtBwObC279atwGUINov4xrI5C
RzcNa/FQ7tjUMaeBgdGAAJPImnP+zT6shhCUTlR5QLhvB9gyvthtb/OtvhbMcWlM
5gd7papoMFgWBspN21+NPmbadSEXDIpeyPanpfKu9S8Zmht69rTS+pEim6Hm682q
64m/Fb4NgCBgVUH9o8+QJUvJkHv8Z/lNDyfjSn90Eu7kcALDBqh/n+Y0q+SEwKhZ
b6UPzuH+hObZk+7GDUY32t9JwlNu0qUk55nCufLVM01bVYkN5ukaXAWCyuCU83ky
yY/nHRNHVISFuy6mdfiFRR7lvMcgBD0IPoU9T+cpZPl+WkwzEwyHx16RN/EDVlo6
NomcMiX07XRSwSG7h7wgFs+YxCv9TjvBoAqKS9Q7GwBX6lunItWMwz44+DxcW9SM
lJPHFMju9hmqMBHI+UTUX8FMY9aq8Qyk+WFthl7eDZjOJ+lKtkEpTR3b50FXzbdc
lTYZEMcNtr7AlThbIxH564DntN8YV3DCV4+Ba/DozvxSJ6kSmrA=
=DHkG
-----END PGP SIGNATURE-----

```

---



=== Content from lists.debian.org_7676cc5f_20250115_090702.html ===


---

[[Date Prev](msg00010.html)][[Date Next](msg00012.html)]
[[Thread Prev](msg00010.html)][[Thread Next](msg00012.html)]
[[Date Index](maillist.html#00011)]
[[Thread Index](threads.html#00011)]

# [SECURITY] [DLA 2940-1] linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2940-1] linux security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Wed, 9 Mar 2022 13:40:13 +0100
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/YiigLdP8SkTDoPqa%40decadent.org.uk)Â [YiigLdP8SkTDoPqa@decadent.org.uk](msg00011.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-2940-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
March 09, 2022                                <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux
Version        : 4.9.303-1
CVE ID         : CVE-2021-3640 CVE-2021-3752 CVE-2021-4002 CVE-2021-4083
                 CVE-2021-4155 CVE-2021-4202 CVE-2021-28711 CVE-2021-28712
                 CVE-2021-28713 CVE-2021-28714 CVE-2021-28715 CVE-2021-29264
                 CVE-2021-33033 CVE-2021-39685 CVE-2021-39686 CVE-2021-39698
                 CVE-2021-39714 CVE-2021-43976 CVE-2021-45095 CVE-2022-0001
                 CVE-2022-0002 CVE-2022-0330 CVE-2022-0435 CVE-2022-0487
                 CVE-2022-0492 CVE-2022-0617 CVE-2022-24448 CVE-2022-25258
                 CVE-2022-25375
Debian Bug     : 990411

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2021-3640

    LinMa of BlockSec Team discovered a race condition in the
    Bluetooth SCO implementation that can lead to a use-after-free.  A
    local user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2021-3752

    Likang Luo of NSFOCUS Security Team discovered a flaw in the
    Bluetooth L2CAP implementation that can lead to a user-after-free.
    A local user could exploit this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2021-4002

    It was discovered that hugetlbfs, the virtual filesystem used by
    applications to allocate huge pages in RAM, did not flush the
    CPU's TLB in one case where it was necessary.  In some
    circumstances a local user would be able to read and write huge
    pages after they are freed and reallocated to a different process.
    This could lead to privilege escalation, denial of service or
    information leaks.

CVE-2021-4083

    Jann Horn reported a race condition in the local (Unix) sockets
    garbage collector, that can lead to use-after-free.  A local user
    could exploit this to cause a denial of service (memory corruption
    or crash) or possibly for privilege escalation.

CVE-2021-4155

    Kirill Tkhai discovered a data leak in the way the XFS_IOC_ALLOCSP
    IOCTL in the XFS filesystem allowed for a size increase of files
    with unaligned size. A local attacker can take advantage of this
    flaw to leak data on the XFS filesystem.

CVE-2021-4202

    Lin Ma discovered a race condition in the NCI (NFC Controller
    Interface) driver, which could lead to a use-after-free.  A local
    user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

    This protocol is not enabled in Debian's official kernel
    configurations.

CVE-2021-28711, CVE-2021-28712, CVE-2021-28713 (XSA-391)

    Juergen Gross reported that malicious PV backends can cause a denial
    of service to guests being serviced by those backends via high
    frequency events, even if those backends are running in a less
    privileged environment.

CVE-2021-28714, CVE-2021-28715 (XSA-392)

    Juergen Gross discovered that Xen guests can force the Linux
    netback driver to hog large amounts of kernel memory, resulting in
    denial of service.

CVE-2021-29264

    It was discovered that the "gianfar" Ethernet driver used with
    some Freescale SoCs did not correctly handle a Rx queue overrun
    when jumbo packets were enabled.  On systems using this driver and
    jumbo packets, an attacker on the network could exploit this to
    cause a denial of service (crash).

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-33033

    The syzbot tool found a reference counting bug in the CIPSO
    implementation that can lead to a use-after-free.

    This protocol is not enabled in Debian's official kernel
    configurations.

CVE-2021-39685

    Szymon Heidrich discovered a buffer overflow vulnerability in the
    USB gadget subsystem, resulting in information disclosure, denial of
    service or privilege escalation.

CVE-2021-39686

    A race condition was discovered in the Android binder driver, that
    could lead to incorrect security checks.  On systems where the
    binder driver is loaded, a local user could exploit this for
    privilege escalation.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-39698

    Linus Torvalds reported a flaw in the file polling implementation,
    which could lead to a use-after-free.  A local user could exploit
    this for denial of service (memory corruption or crash) or
    possibly for privilege escalation.

CVE-2021-39714

    A potential reference count overflow was found in the Android Ion
    driver.  On systems where the Ion driver is loaded, a local user
    could exploit this for denial of service (memory corruption or
    crash) or possibly for privilege escalation.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-43976

    Zekun Shen and Brendan Dolan-Gavitt discovered a flaw in the
    mwifiex_usb_recv() function of the Marvell WiFi-Ex USB Driver. An
    attacker able to connect a crafted USB device can take advantage of
    this flaw to cause a denial of service.

CVE-2021-45095

    It was discovered that the Phone Network protocol (PhoNet) driver
    has a reference count leak in the pep_sock_accept() function.

CVE-2022-0001 (INTEL-SA-00598)

    Researchers at VUSec discovered that the Branch History Buffer in
    Intel processors can be exploited to create information side-
    channels with speculative execution.  This issue is similar to
    Spectre variant 2, but requires additional mitigations on some
    processors.

    This can be exploited to obtain sensitive information from a
    different security context, such as from user-space to the kernel,
    or from a KVM guest to the kernel.

CVE-2022-0002 (INTEL-SA-00598)

    This is a similar issue to CVE-2022-0001, but covers exploitation
    within a security context, such as from JIT-compiled code in a
    sandbox to hosting code in the same process.

    This can be partly mitigated by disabling eBPF for unprivileged
    users with the sysctl: kernel.unprivileged_bpf_disabled=2.  This
    update does that by default.

CVE-2022-0330

    Sushma Venkatesh Reddy discovered a missing GPU TLB flush in the
    i915 driver, resulting in denial of service or privilege escalation.

CVE-2022-0435

    Samuel Page and Eric Dumazet reported a stack overflow in the
    networking module for the Transparent Inter-Process Communication
    (TIPC) protocol, resulting in denial of service or potentially the
    execution of arbitrary code.

CVE-2022-0487

    A use-after-free was discovered in the MOXART SD/MMC Host Controller
    support driver. This flaw does not impact the Debian binary packages
    as CONFIG_MMC_MOXART is not set.

CVE-2022-0492

    Yiqi Sun and Kevin Wang reported that the cgroup-v1 subsystem does
    not properly restrict access to the release-agent feature. A local
    user can take advantage of this flaw for privilege escalation and
    bypass of namespace isolation.

CVE-2022-0617

    butt3rflyh4ck discovered a NULL pointer dereference in the UDF
    filesystem. A local user that can mount a specially crafted UDF
    image can use this flaw to crash the system.

CVE-2022-24448

    Description

CVE-2022-25258

    Szymon Heidrich reported the USB Gadget subsystem lacks certain
    validation of interface OS descriptor requests, resulting in memory
    corruption.

CVE-2022-25375

    Szymon Heidrich reported that the RNDIS USB gadget lacks validation
    of the size of the RNDIS_MSG_SET command, resulting in information
    leak from kernel memory.

For Debian 9 stretch, these problems have been fixed in version
4.9.303-1.  This update additionally includes many more bug fixes from
stable updates 4.9.291-4.9.303 inclusive.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpo0_CcRu5I0.pgp)**

*Description:* PGP signature

---



=== Content from www.openwall.com_0a9d2fac_20250115_090701.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAFcO6XPukbwY3wK6AqP6qJ-3-3KPN760pAJCDu0tV-EXSGRecA@mail.gmail.com>
Date: Wed, 13 Apr 2022 23:42:18 +0800
From: butt3rflyh4ck <butterflyhuangxx@...il.com>
To: oss-security@...ts.openwall.com
Subject: CVE-2022-0617: udf:A null-ptr-deref bug be triggered
 when write to an ICB inode

A NULL pointer dereference was found in the Linux kernelâ€™s UDF file
system functionality in the way the user triggers the
udf_file_write_iter function for a malicious UDF image. Actual from
Linux kernel 4.2-rc1 till 5.17-rc2.

#Root Cause
udf_expand_file_adinicb() calls directly ->writepage to write data
expanded into a page. This however misses to setup inode for writeback
properly and so we can crash on inode->i_wb dereference when submitting
page for IO like:

  BUG: kernel NULL pointer dereference, address: 0000000000000158
  #PF: supervisor read access in kernel mode
...
  <TASK>
  __folio_start_writeback+0x2ac/0x350
  __block_write_full_page+0x37d/0x490
  udf_expand_file_adinicb+0x255/0x400 [udf]
  udf_file_write_iter+0xbe/0x1b0 [udf]
  new_sync_write+0x125/0x1c0
  vfs_write+0x28e/0x400

Fix the problem by marking the page dirty and going through the standard
writeback path to write the page. Strictly speaking we would not even
have to write the page but we want to catch e.g. ENOSPC errors early.

#Fix
1.<https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=7fc3b7c2981bbd1047916ade327beccb90994eee>
2.<https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ea8569194b43f0f01f0a84c689388542c7254a1f>

#CVE
Red Hat has assigned CVE-2022-0617 to this issue.
1. <https://access.redhat.com/security/cve/CVE-2022-0617>
2. <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0617>

#Credit
this issue is reported by Active Defense Lab of Venustech.

Regards,
 butt3rflyh4ck.

--
Active Defense Lab of Venustech

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.debian.org_9dfdb833_20250115_090706.html ===


---

[[Date Prev](msg00062.html)][[Date Next](msg00064.html)]
[[Thread Prev](msg00062.html)][[Thread Next](msg00064.html)]
[[Date Index](maillist.html#00063)]
[[Thread Index](threads.html#00063)]

# [SECURITY] [DSA 5096-1] linux security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5096-1] linux security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Wed, 09 Mar 2022 15:30:58 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/E1nRyHC-0004Le-Lx%40seger.debian.org)Â [E1nRyHC-0004Le-Lx@seger.debian.org](msg00063.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5096-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
March 09, 2022                        <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : linux
CVE ID         : CVE-2020-29374 CVE-2020-36322 CVE-2021-3640 CVE-2021-3744
                 CVE-2021-3752 CVE-2021-3760 CVE-2021-3764 CVE-2021-3772
                 CVE-2021-4002 CVE-2021-4083 CVE-2021-4135 CVE-2021-4155
                 CVE-2021-4203 CVE-2021-20317 CVE-2021-20321 CVE-2021-20322
                 CVE-2021-22600 CVE-2021-28711 CVE-2021-28712 CVE-2021-28713
                 CVE-2021-28714 CVE-2021-28715 CVE-2021-28950 CVE-2021-38300
                 CVE-2021-39685 CVE-2021-39686 CVE-2021-39698 CVE-2021-39713
                 CVE-2021-41864 CVE-2021-42739 CVE-2021-43389 CVE-2021-43975
                 CVE-2021-43976 CVE-2021-44733 CVE-2021-45095 CVE-2021-45469
                 CVE-2021-45480 CVE-2022-0001 CVE-2022-0002 CVE-2022-0322
                 CVE-2022-0330 CVE-2022-0435 CVE-2022-0487 CVE-2022-0492
                 CVE-2022-0617 CVE-2022-0644 CVE-2022-22942 CVE-2022-24448
                 CVE-2022-24959 CVE-2022-25258 CVE-2022-25375
Debian Bug     : 988044 989285 990411 994050

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2020-29374

    Jann Horn of Google reported a flaw in Linux's virtual memory
    management.  A parent and child process initially share all their
    memory, but when either writes to a shared page, the page is
    duplicated and unshared (copy-on-write).  However, in case an
    operation such as vmsplice() required the kernel to take an
    additional reference to a shared page, and a copy-on-write occurs
    during this operation, the kernel might have accessed the wrong
    process's memory.  For some programs, this could lead to an
    information leak or data corruption.

    This issue was already fixed for most architectures, but not on
    MIPS and System z.  This update corrects that.

CVE-2020-36322, CVE-2021-28950

    The syzbot tool found that the FUSE (filesystem-in-user-space)
    implementation did not correctly handle a FUSE server returning
    invalid attributes for a file.  A local user permitted to run a
    FUSE server could use this to cause a denial of service (crash).

    The original fix for this introduced a different potential denial
    of service (infinite loop in kernel space), which has also been
    fixed.

CVE-2021-3640

    Lin Ma discovered a race condiiton in the Bluetooth protocol
    implementation that can lead to a use-after-free.  A local
    user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2021-3744, CVE-2021-3764

    minihanshen reported bugs in the ccp driver for AMD
    Cryptographic Coprocessors that could lead to a resource leak.
    On systems using this driver, a local user could exploit this to
    cause a denial of service.

CVE-2021-3752

    Likang Luo of NSFOCUS Security Team discovered a flaw in the
    Bluetooth L2CAP implementation that can lead to a user-after-free.
    A local user could exploit this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2021-3760, CVE-2021-4202

    Lin Ma discovered race conditions in the NCI (NFC Controller
    Interface) driver, which could lead to a use-after-free.  A local
    user could exploit this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-3772

    A flaw was found in the SCTP protocol implementation, which would
    allow a networked attacker to break an SCTP association.  The
    attacker would only need to know or guess the IP addresses and
    ports for the association.

CVE-2021-4002

    It was discovered that hugetlbfs, the virtual filesystem used by
    applications to allocate huge pages in RAM, did not flush the
    CPU's TLB in one case where it was necessary.  In some
    circumstances a local user would be able to read and write huge
    pages after they are freed and reallocated to a different process.
    This could lead to privilege escalation, denial of service or
    information leaks.

CVE-2021-4083

    Jann Horn reported a race condition in the local (Unix) sockets
    garbage collector, that can lead to use-after-free.  A local user
    could exploit this to cause a denial of service (memory corruption
    or crash) or possibly for privilege escalation.

CVE-2021-4135

    A flaw was found in the netdevsim driver which would lead to an
    information leak.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2021-4155

    Kirill Tkhai discovered a data leak in the way the XFS_IOC_ALLOCSP
    IOCTL in the XFS filesystem allowed for a size increase of files
    with unaligned size. A local attacker can take advantage of this
    flaw to leak data on the XFS filesystem.

CVE-2021-4203

    Jann Horn reported a race condition in the local (Unix) sockets
    implementation that can lead to a use-after-free.  A local user
    could exploit this to leak sensitive information from the kernel.

CVE-2021-20317

    It was discovered that the timer queue structure could become
    corrupt, leading to waiting tasks never being woken up.  A local
    user with certain privileges could exploit this to cause a denial
    of service (system hang).

CVE-2021-20321

    A race condition was discovered in the overlayfs filesystem
    driver.  A local user with access to an overlayfs mount and to its
    underlying upper directory could exploit this for privilege
    escalation.

CVE-2021-20322

    An information leak was discovered in the IPv4 implementation.  A
    remote attacker could exploit this to quickly discover which UDP
    ports a system is using, making it easier for them to carry out a
    DNS poisoning attack against that system.

CVE-2021-22600

    The syzbot tool found a flaw in the packet socket (AF_PACKET)
    implementation which could lead to incorrectly freeing memory.  A
    local user with CAP_NET_RAW capability (in any user namespace)
    could exploit this for denial of service (memory corruption or
    crash) or possibly for privilege escalation.

CVE-2021-28711, CVE-2021-28712, CVE-2021-28713 (XSA-391)

    Juergen Gross reported that malicious PV backends can cause a denial
    of service to guests being serviced by those backends via high
    frequency events, even if those backends are running in a less
    privileged environment.

CVE-2021-28714, CVE-2021-28715 (XSA-392)

    Juergen Gross discovered that Xen guests can force the Linux
    netback driver to hog large amounts of kernel memory, resulting in
    denial of service.

CVE-2021-38300

    Piotr Krysiuk discovered a flaw in the classic BPF (cBPF) JIT
    compiler for MIPS architectures.  A local user could exploit
    this to excute arbitrary code in the kernel.

    This issue is mitigated by setting sysctl
    net.core.bpf_jit_enable=0, which is the default.  It is *not*
    mitigated by disabling unprivileged use of eBPF.

CVE-2021-39685

    Szymon Heidrich discovered a buffer overflow vulnerability in the
    USB gadget subsystem, resulting in information disclosure, denial of
    service or privilege escalation.

CVE-2021-39686

    A race condition was discovered in the Android binder driver, that
    could lead to incorrect security checks.  On systems where the
    binder driver is loaded, a local user could exploit this for
    privilege escalation.

CVE-2021-39698

    Linus Torvalds reported a flaw in the file polling implementation,
    which could lead to a use-after-free.  A local user could exploit
    this for denial of service (memory corruption or crash) or
    possibly for privilege escalation.

CVE-2021-39713

    The syzbot tool found a race condition in the network scheduling
    subsystem which could lead to a use-after-free.  A local user
    could exploit this for denial of service (memory corruption or
    crash) or possibly for privilege escalation.

CVE-2021-41864

    An integer overflow was discovered in the Extended BPF (eBPF)
    subsystem.  A local user could exploit this for denial of service
    (memory corruption or crash), or possibly for privilege
    escalation.

    This can be mitigated by setting sysctl
    kernel.unprivileged_bpf_disabled=1, which disables eBPF use by
    unprivileged users.

CVE-2021-42739

    A heap buffer overflow was discovered in the firedtv driver for
    FireWire-connected DVB receivers.  A local user with access to a
    firedtv device could exploit this for denial of service (memory
    corruption or crash), or possibly for privilege escalation.

CVE-2021-43389

    The Active Defense Lab of Venustech discovered a flaw in the CMTP
    subsystem as used by Bluetooth, which could lead to an
    out-of-bounds read and object type confusion.  A local user with
    CAP_NET_ADMIN capability in the initial user namespace could
    exploit this for denial of service (memory corruption or crash),
    or possibly for privilege escalation.

CVE-2021-43975

    Brendan Dolan-Gavitt reported a flaw in the
    hw_atl_utils_fw_rpc_wait() function in the aQuantia AQtion ethernet
    device driver which can result in denial of service or the execution
    of arbitrary code.

CVE-2021-43976

    Zekun Shen and Brendan Dolan-Gavitt discovered a flaw in the
    mwifiex_usb_recv() function of the Marvell WiFi-Ex USB Driver. An
    attacker able to connect a crafted USB device can take advantage of
    this flaw to cause a denial of service.

CVE-2021-44733

    A race condition was discovered in the Trusted Execution
    Environment (TEE) subsystem for Arm processors, which could lead
    to a use-after-free.  A local user permitted to access a TEE
    device could exploit this for denial of service (memory corruption
    or crash) or possibly for privilege escalation.

CVE-2021-45095

    It was discovered that the Phone Network protocol (PhoNet) driver
    has a reference count leak in the pep_sock_accept() function.

CVE-2021-45469

    Wenqing Liu reported an out-of-bounds memory access in the f2fs
    implementation if an inode has an invalid last xattr entry. An
    attacker able to mount a specially crafted image can take advantage
    of this flaw for denial of service.

CVE-2021-45480

    A memory leak flaw was discovered in the __rds_conn_create()
    function in the RDS (Reliable Datagram Sockets) protocol subsystem.

CVE-2022-0001 (INTEL-SA-00598)

    Researchers at VUSec discovered that the Branch History Buffer in
    Intel processors can be exploited to create information side-
    channels with speculative execution.  This issue is similar to
    Spectre variant 2, but requires additional mitigations on some
    processors.

    This can be exploited to obtain sensitive information from a
    different security context, such as from user-space to the kernel,
    or from a KVM guest to the kernel.

CVE-2022-0002 (INTEL-SA-00598)

    This is a similar issue to CVE-2022-0001, but covers exploitation
    within a security context, such as from JIT-compiled code in a
    sandbox to hosting code in the same process.

    This can be partly mitigated by disabling eBPF for unprivileged
    users with the sysctl: kernel.unprivileged_bpf_disabled=2.  This
    update does that by default.

CVE-2022-0322

    Eiichi Tsukata discovered a flaw in the sctp_make_strreset_req()
    function in the SCTP network protocol implementation which can
    result in denial of service.

CVE-2022-0330

    Sushma Venkatesh Reddy discovered a missing GPU TLB flush in the
    i915 driver, resulting in denial of service or privilege escalation.

CVE-2022-0435

    Samuel Page and Eric Dumazet reported a stack overflow in the
    networking module for the Transparent Inter-Process Communication
    (TIPC) protocol, resulting in denial of service or potentially the
    execution of arbitrary code.

CVE-2022-0487

    A use-after-free was discovered in the MOXART SD/MMC Host Controller
    support driver. This flaw does not impact the Debian binary packages
    as CONFIG_MMC_MOXART is not set.

CVE-2022-0492

    Yiqi Sun and Kevin Wang reported that the cgroup-v1 subsystem does
    not properly restrict access to the release-agent feature. A local
    user can take advantage of this flaw for privilege escalation and
    bypass of namespace isolation.

CVE-2022-0617

    butt3rflyh4ck discovered a NULL pointer dereference in the UDF
    filesystem. A local user that can mount a specially crafted UDF
    image can use this flaw to crash the system.

CVE-2022-0644

    Hao Sun reported a missing check for file read permission in the
    finit_module() and kexec_file_load() system calls.  The security
    impact of this is unclear, since these system calls are usually
    only available to the root user.

CVE-2022-22942

    It was discovered that wrong file file descriptor handling in the
    VMware Virtual GPU driver (vmwgfx) could result in information leak
    or privilege escalation.

CVE-2022-24448

    Lyu Tao reported a flaw in the NFS implementation in the Linux
    kernel when handling requests to open a directory on a regular file,
    which could result in a information leak.

CVE-2022-24959

    A memory leak was discovered in the yam_siocdevprivate() function of
    the YAM driver for AX.25, which could result in denial of service.

CVE-2022-25258

    Szymon Heidrich reported the USB Gadget subsystem lacks certain
    validation of interface OS descriptor requests, resulting in memory
    corruption.

CVE-2022-25375

    Szymon Heidrich reported that the RNDIS USB gadget lacks validation
    of the size of the RNDIS_MSG_SET command, resulting in information
    leak from kernel memory.

For the oldstable distribution (buster), these problems have been
fixed in version 4.19.232-1.  This update additionally includes many
more bug fixes from stable updates 4.19.209-4.19.232 inclusive.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAmIotm1fFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0RcGg//QBgf4RfElxd+11a+BZ9HWJFBjA5Wp2VStf1+inoZ7X/En7W9QBpVvmks
Jum5QFpvA1waEP0zk0/O5MKXHtMbRMFdj0UUYQM7Vi3/vfeP73C10YmXv2yfG2Fw
dTGnVHpvvdJSbNzxMG4jruNY5b0Bf/WEQSqtuOM6V2aBiI7Y2pSI6Ak/dvexiu+0
ycz6PTDkX66e/p7NONw+B33L8yTMj9yu1cCdoYdrDihVlrESgbMLHUWO9JKRQykk
tsI2a79OIEkaj+yQwfkJu9njoPUTn6OZYUYxD8XaN8XtkDpwx1oVsiyqpslJEmgR
vaS1DOEnIZXsq2pscSPeKfFM30uFgqAxkQm/zUpjGGSXib58xaaf/c61LCQoMU2g
cSc+8+N1S2Lbcscdxd9TumvrOGJVuP/q/FqcOl4npcz1WLZRmc9f9IprdqUEy2iJ
+YLSrFFOfhgMMP0El6KJvG/8Jz60UEAiWuYutT508w1jIRrvMRLW4i6V3NXHrNkx
GDofOfPF8jNdt2Www+2sqEY51f+w2kffOSAnHGGPCASvWpuXFOw9ZyxnuyRRKKBE
no9PH0X71a636sZGh8bIU25PSKQlhtlAfCP+0Fef7PeEKTz1MJf8Nvo+vgCIsani
eGWa9jzdkVxHDEjxplX0stsByglCYyud7JSI1ZE9oLtJU1/xDBc=
=5fQT
-----END PGP SIGNATURE-----

```

---



=== Content from www.openwall.com_ff0141a7_20250115_221106.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

# blists - web interface to mailing list archives

blists is a web interface to mailing list archives that works off indexed mbox files.
There are two programs: *bindex* and *bit*.
*bindex* generates or updates the index file (yes, incremental updates are supported).
*bit* is a CGI/SSI program that generates web pages on the fly.
Both programs are written in C and are very fast.

You can view the latest <README> file,
which describes blists in more detail and provides installation instructions.
It is also included in the archive below.

Download ([release notes](/lists/announce/2017/11/19/1)):

* [blists 2.0](blists-2.0.tar.gz) and
  its [signature](blists-2.0.tar.gz.sign)* [blists 1.0](blists-1.0.tar.gz) and
    its [signature](blists-1.0.tar.gz.sign)

These files are also
[available from the Openwall file archive](https://download.openwall.net/pub/projects/blists/).
The source code of blists can be browsed on
[GitHub](https://github.com/openwall/blists) or via
[CVSweb](https://cvsweb.openwall.com/blists).

Follow [this link](/signatures/) for information on verifying the signatures.

To see blists in action, check out our
[Open Source and information security mailing list archives](https://lists.openwall.net).

blists is a registered project with
[Open Hub](https://www.openhub.net/p/blists).

Quick Comment:

412069



=== Content from access.redhat.com_c3b5f2c2_20250115_221107.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [FranÃ§ais](https://access.redhat.com/changeLanguage?language=fr)
* [í•œêµ­ì–´](https://access.redhat.com/changeLanguage?language=ko)
* [æ—¥æœ¬èªž](https://access.redhat.com/changeLanguage?language=ja)
* [ä¸­æ–‡ (ä¸­å›½)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 Â© 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from git.kernel.org_d5af53b9_20250115_090702.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=7fc3b7c2981bbd1047916ade327beccb90994eee)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=7fc3b7c2981bbd1047916ade327beccb90994eee)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=7fc3b7c2981bbd1047916ade327beccb90994eee)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=7fc3b7c2981bbd1047916ade327beccb90994eee)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jan Kara <jack@suse.cz> | 2022-01-17 18:22:13 +0100 |
| --- | --- | --- |
| committer | Jan Kara <jack@suse.cz> | 2022-01-24 14:45:02 +0100 |
| commit | [7fc3b7c2981bbd1047916ade327beccb90994eee](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=7fc3b7c2981bbd1047916ade327beccb90994eee) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=7fc3b7c2981bbd1047916ade327beccb90994eee)) | |
| tree | [410cae0a02add6911b15af81d8472738e50d0d8b](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=7fc3b7c2981bbd1047916ade327beccb90994eee) | |
| parent | [dd81e1c7d5fb126e5fbc5c9e334d7b3ec29a16a0](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=dd81e1c7d5fb126e5fbc5c9e334d7b3ec29a16a0) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=7fc3b7c2981bbd1047916ade327beccb90994eee&id2=dd81e1c7d5fb126e5fbc5c9e334d7b3ec29a16a0)) | |
| download | [linux-7fc3b7c2981bbd1047916ade327beccb90994eee.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-7fc3b7c2981bbd1047916ade327beccb90994eee.tar.gz) | |

udf: Fix NULL ptr deref when converting from inline formatudf\_expand\_file\_adinicb() calls directly ->writepage to write data
expanded into a page. This however misses to setup inode for writeback
properly and so we can crash on inode->i\_wb dereference when submitting
page for IO like:
BUG: kernel NULL pointer dereference, address: 0000000000000158
#PF: supervisor read access in kernel mode
...
<TASK>
\_\_folio\_start\_writeback+0x2ac/0x350
\_\_block\_write\_full\_page+0x37d/0x490
udf\_expand\_file\_adinicb+0x255/0x400 [udf]
udf\_file\_write\_iter+0xbe/0x1b0 [udf]
new\_sync\_write+0x125/0x1c0
vfs\_write+0x28e/0x400
Fix the problem by marking the page dirty and going through the standard
writeback path to write the page. Strictly speaking we would not even
have to write the page but we want to catch e.g. ENOSPC errors early.
Reported-by: butt3rflyh4ck <butterflyhuangxx@gmail.com>
CC: stable@vger.kernel.org
Fixes: 52ebea749aae ("writeback: make backing\_dev\_info host cgroup-specific bdi\_writebacks")
Reviewed-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Jan Kara <jack@suse.cz>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=7fc3b7c2981bbd1047916ade327beccb90994eee)

| -rw-r--r-- | [fs/udf/inode.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/udf/inode.c?id=7fc3b7c2981bbd1047916ade327beccb90994eee) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 5 deletions

| diff --git a/fs/udf/inode.c b/fs/udf/inode.cindex 1d6b7a50736bac..d6aa506b6b5840 100644--- a/[fs/udf/inode.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/udf/inode.c?id=dd81e1c7d5fb126e5fbc5c9e334d7b3ec29a16a0)+++ b/[fs/udf/inode.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/udf/inode.c?id=7fc3b7c2981bbd1047916ade327beccb90994eee)@@ -258,10 +258,6 @@ int udf\_expand\_file\_adinicb(struct inode \*inode) char \*kaddr; struct udf\_inode\_info \*iinfo = UDF\_I(inode); int err;- struct writeback\_control udf\_wbc = {- .sync\_mode = WB\_SYNC\_NONE,- .nr\_to\_write = 1,- };  WARN\_ON\_ONCE(!inode\_is\_locked(inode)); if (!iinfo->i\_lenAlloc) {@@ -305,8 +301,10 @@ int udf\_expand\_file\_adinicb(struct inode \*inode) iinfo->i\_alloc\_type = ICBTAG\_FLAG\_AD\_LONG; /\* from now on we have normal address\_space methods \*/ inode->i\_data.a\_ops = &udf\_aops;+ set\_page\_dirty(page);+ unlock\_page(page); up\_write(&iinfo->i\_data\_sem);- err = inode->i\_data.a\_ops->writepage(page, &udf\_wbc);+ err = filemap\_fdatawrite(inode->i\_mapping); if (err) { /\* Restore everything back so that we don't lose data... \*/ lock\_page(page); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:05:39 +0000


