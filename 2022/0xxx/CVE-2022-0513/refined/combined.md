=== Content from plugins.trac.wordpress.org_8b6d740c_20250114_210932.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2671297%2Fwp-statistics%2Ftrunk%2Fincludes%2Fclass-wp-statistics-hits.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2626597/wp-statistics/trunk/includes/class-wp-statistics-hits.php "Changeset 2626597 for wp-statistics/trunk/includes/class-wp-statistics-hits.php")
* [Next Change](/changeset/2679983/wp-statistics/trunk/includes/class-wp-statistics-hits.php "Changeset 2679983 for wp-statistics/trunk/includes/class-wp-statistics-hits.php") →

---

# Changeset [2671297](/changeset/2671297 "Show full changeset") for [wp-statistics/trunk/includes/class-wp-statistics-hits.php](/browser/wp-statistics/trunk/includes/class-wp-statistics-hits.php?rev=2671297 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/02/2022 12:54:26 PM
([3 years](/timeline?from=2022-02-02T12%3A54%3A26Z&precision=second "See timeline at 02/02/2022 12:54:26 PM") ago)

Author:
mostafa.s1990
Message:

Version 13.1.5

File:

1 edited

* [wp-statistics/trunk/includes/class-wp-statistics-hits.php](/browser/wp-statistics/trunk/includes/class-wp-statistics-hits.php?rev=2671297 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-statistics/trunk/includes/class-wp-statistics-hits.php](/changeset/2671297/wp-statistics/trunk/includes/class-wp-statistics-hits.php "Show the changeset 2671297 restricted to wp-statistics/trunk/includes/class-wp-statistics-hits.php")

  | [r2626597](/browser/wp-statistics/trunk/includes/class-wp-statistics-hits.php?rev=2626597#L123 "Show revision 2626597 of this file in browser") | [r2671297](/browser/wp-statistics/trunk/includes/class-wp-statistics-hits.php?rev=2671297#L123 "Show revision 2671297 of this file in browser") |  |
  | --- | --- | --- |
  | 123 | 123 | { |
  | 124 | 124 |  |
  | 125 |  | if (isset($this->rest\_hits->exclusion\_match) and isset($this->rest\_hits->exclusion\_reason)) { |
  |  | 125 | if (isset($this->rest\_hits->exclusion\_match) and isset($this->rest\_hits->exclusion\_reason) and in\_array($this->rest\_hits->exclusion\_reason, Exclusion::exclusion\_list()) == true) { |
  | 126 | 126 | return array( |
  | 127 | 127 | 'exclusion\_match'  => $this->rest\_hits->exclusion\_match == 'yes', |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2671297)
* [Zip Archive](?format=zip&new=2671297)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_3a57c28d_20250114_210933.html ===


![](https://www.wordfence.com/wp-content/uploads/2022/02/Unauthenticated-SQL-Injection-Vulnerability-Patched-in-WordPress-Statistics-Plugin.png)

[![](https://secure.gravatar.com/avatar/9bf72594e071c28445ed7a1be0de1a23?s=80&d=mm&r=g)Chloe Chamberland](https://www.wordfence.com/blog/author/wfchloe/)

February 10, 2022

# Unauthenticated SQL Injection Vulnerability Patched in WordPress Statistics Plugin

On February 7, 2022, Security Researcher Cyku Hong from DEVCORE reported a vulnerability to us that they discovered in WP Statistics, a WordPress plugin installed on over 600,000 sites. This vulnerability made it possible for unauthenticated attackers to execute arbitrary SQL queries by appending them to an existing SQL query. This could be used to extract sensitive information like password hashes and secret keys from the database. On request, we assigned them the vulnerability identifier: CVE-2022-0513.

All Wordfence users, including [Free](https://www.wordfence.com/products/wordfence-free/), [Premium](https://www.wordfence.com/products/wordfence-premium/), [Care](https://www.wordfence.com/products/wordfence-care/), and [Response](https://www.wordfence.com/products/wordfence-response/), are protected from exploits targeting this vulnerability thanks to the Wordfence Firewall’s built-in SQL Injection protection.

Even though Wordfence provides protection against this vulnerability, we strongly recommend ensuring that your site has been updated to the latest patched version of “WP Statistics,” which is version 13.1.5 at the time of this publication.

---

**Description:** Unauthenticated Blind SQL Injection

**Affected Plugin:** [WP Statistics](https://wordpress.org/plugins/wp-statistics/)

**Plugin Slug:** wp-statistics

**Plugin Developer:** VeronaLabs

**Affected Versions:** <=13.1.4

**CVE ID:** [CVE-2022-0513](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0513)

**CVSS Score:** 9.8 (Critical)

**CVSS Vector:** [CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

**Researcher/s:** Cyku Hong from DEVCORE

**Fully Patched Version:** 13.1.5

WP Statistics is a WordPress plugin designed to provide a centralized hub for all of a WordPress site’s statistics, such as visitor data, and it emphasizes storing this data locally to the WordPress site to preserve user privacy. As such, it is reasonable to expect that the plugin would implement a lot of functionality to store and retrieve information from the database through the use of SQL queries. Unfortunately, the implementation of one of these queries was insecure, creating a SQL Injection vulnerability.

When the “Record Exclusions” feature was enabled, this vulnerability became exploitable. The “Record Exclusions” feature is designed to record when a visit, or a “hit”, is excluded from the site’s statistics, such as visits by users with specific roles, login page access, and anything else that a site owner may have explicitly selected to exclude. It records that data to a separate database table so as not to contaminate the main statistical data the plugin collects.

In order to record these hits when a caching plugin was enabled, the plugin registered a REST route `/wp-json/wp-statistics/v2/hit` that would call the `hit_callback()` function. This function would then call the `record()` function from the ‘Hits’ class which checks to see if the request should be excluded and determines what exclusion the request correlates to, prior to calling the next appropriate `record()` function.

```
    public static function record()
    {

        # Check Exclusion This Hits
        $exclusion = Exclusion::check();

        # Record Hits Exclusion
        if ($exclusion['exclusion_match'] === true) {
            Exclusion::record($exclusion);
        }

        # Record User Visits
        if (Visit::active() and $exclusion['exclusion_match'] === false) {
            Visit::record();
        }

        # Record Visitor Detail
        if (Visitor::active()) {
            $visitor_id = Visitor::record($exclusion);
        }
```

When the `exclusion_match` parameter is set to true in a request, the data is then passed to the `record()` function from the ‘Exclusion’ class where the plugin attempts to update the count of an exclusion reason for the day if it is present in the database. If the exclusion reason isn’t present in the database for the current date the initial query will return false and trigger the next query to add a new record count to the table for the reason.

```
    public static function record($exclusion = array())
    {
        global $wpdb;

        // If we're not storing exclusions, just return.
        if (self::record_active() != true) {
            return;
        }

        // Check Exist this Exclusion in this day
        $result = $wpdb->query("UPDATE " . DB::table('exclusions') . " SET `count` = `count` + 1 WHERE `date` = '" . TimeZone::getCurrentDate('Y-m-d') . "' AND `reason` = '{$exclusion['exclusion_reason']}'");
        if (!$result) {
            $insert = $wpdb->insert(
                DB::table('exclusions'),
                array(
                    'date'   => TimeZone::getCurrentDate('Y-m-d'),
                    'reason' => $exclusion['exclusion_reason'],
                    'count'  => 1,
                )
            );
            if (!$insert) {
                if (!empty($wpdb->last_error)) {
                    \WP_Statistics::log($wpdb->last_error);
                }
            }
```

The `$wpdb->query()` function was used for the initial UPDATE query and used the user-supplied ‘`exclusion_reason`‘ value as part of the query. Due to the fact that there was no escaping on the user supplied value, or parameterization on the query, attackers could easily append additional SQL queries to the existing query via the ‘`exclusion_reason`‘ and extract sensitive information from the database.

Since no data from the SQL query was returned in the response, and the response did not indicate a boolean answer, an attacker would need to use a Time-Based blind approach to extract information from the database. This means that they would need to use SQL CASE statements along with the `SLEEP()` command while observing the response time of each request to steal information from the database. This is an intricate, yet frequently successful method to obtain information from a database when exploiting SQL Injection vulnerabilities.

Upon further analysis, we uncovered that a user could also simply pass the `exclusion_match` parameter equal to yes, the `exclusion_reason` parameter set to the SQLi payload, and the `wp_statistics_hit_rest` parameter set to true, along with passing the string `wp-json/` in the request URI to trigger the same `record()` function from the ‘Exclusions’ class. This method did not require a caching plugin to be enabled to obtain a valid nonce to trigger the REST endpoint. This is due to the `is_rest_request()` function returning true when the `$_SERVER['REQUEST_URI']` contains the REST prefix, `wp-json/`, even if the request isn’t a genuine REST request. This ultimately triggers the entire record process.

## Conclusion

In today’s post, we detailed a flaw in the “WP Statistics” plugin that made it possible for unauthenticated attackers to inject arbitrary SQL queries to steal sensitive information from a database. This flaw has been [fully patched in version 13.1.5.](https://wordpress.org/plugins/wp-statistics/)

We recommend that WordPress site owners immediately verify that their site has been updated to the latest patched version available, which is version 13.1.5 at the time of this publication.

All Wordfence users, including [Free](https://www.wordfence.com/products/wordfence-free/), [Premium](https://www.wordfence.com/products/wordfence-premium/), [Care](https://www.wordfence.com/products/wordfence-care/), and [Response](https://www.wordfence.com/products/wordfence-response/), are protected from exploits targeting this vulnerability thanks to the Wordfence Firewall’s built-in SQL Injection protection.

If you believe your site has been compromised as a result of this vulnerability or any other vulnerability, we offer Incident Response services via [Wordfence Care](https://www.wordfence.com/products/wordfence-care/). If you need your site cleaned immediately, [Wordfence Response](https://www.wordfence.com/products/wordfence-response/) offers the same service with 24/7/365 availability and a 1-hour response time. Both these products include hands-on support in case you need further assistance.

If you know a friend or colleague who is using this plugin on their site, we highly recommend forwarding this advisory to them to help keep their sites protected as this is a serious vulnerability that can lead to complete site takeover.

*Congratulations to Cyku Hong from [DEVCORE](https://devco.re/) for discovering and responsibly disclosing this vulnerability to the plugin’s developers. As a reminder, Wordfence is a CVE Numbering Authority (CNA) and we can assign CVE IDs to your vulnerability discoveries in WordPress Plugins, Themes, and Core. If you need a CVE for one of your WordPress finds, [please fill out our form here](https://www.wordfence.com/request-cve/). Your vulnerability discovery may be featured on our blog with your permission!*

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2022%2F02%2Funauthenticated-sql-injection-vulnerability-patched-in-wordpress-statistics-plugin%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2022%2F02%2Funauthenticated-sql-injection-vulnerability-patched-in-wordpress-statistics-plugin%2F&text=Unauthenticated%20SQL%20Injection%20Vulnerability%20Patched%20in%20WordPress%20Statistics%20Plugin&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2022%2F02%2Funauthenticated-sql-injection-vulnerability-patched-in-wordpress-statistics-plugin%2F)

## Comments

No Comments

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save


