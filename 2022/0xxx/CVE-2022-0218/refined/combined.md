=== Content from plugins.trac.wordpress.org_ed9beb85_20250114_194705.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2656984%2Fwp-html-mail%2Ftrunk%2Fincludes%2Fclass-template-designer.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2466288/wp-html-mail/trunk/includes/class-template-designer.php "Changeset 2466288 for wp-html-mail/trunk/includes/class-template-designer.php")
* [Next Change](/changeset/2690771/wp-html-mail/trunk/includes/class-template-designer.php "Changeset 2690771 for wp-html-mail/trunk/includes/class-template-designer.php") →

---

# Changeset [2656984](/changeset/2656984 "Show full changeset") for [wp-html-mail/trunk/includes/class-template-designer.php](/browser/wp-html-mail/trunk/includes/class-template-designer.php?rev=2656984 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
01/13/2022 06:26:33 AM
([3 years](/timeline?from=2022-01-13T06%3A26%3A33Z&precision=second "See timeline at 01/13/2022 06:26:33 AM") ago)

Author:
haet
Message:
# 3.1

* Changed initialization of default options to fix some notices in WooCommerce add-on
* Improved settings REST API security
* Improved font formatting toolbars in editor

File:

1 edited

* [wp-html-mail/trunk/includes/class-template-designer.php](/browser/wp-html-mail/trunk/includes/class-template-designer.php?rev=2656984 "Show entry in browser")
  (modified)
  ([3 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-html-mail/trunk/includes/class-template-designer.php](/changeset/2656984/wp-html-mail/trunk/includes/class-template-designer.php "Show the changeset 2656984 restricted to wp-html-mail/trunk/includes/class-template-designer.php")

  | [r2466288](/browser/wp-html-mail/trunk/includes/class-template-designer.php?rev=2466288#L1 "Show revision 2466288 of this file in browser") | [r2656984](/browser/wp-html-mail/trunk/includes/class-template-designer.php?rev=2656984#L1 "Show revision 2656984 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | <?php if (~~! defined( 'ABSPATH' )~~ ) exit; |
  |  | 1 | <?php if (!defined('ABSPATH')) exit; |
  | 2 | 2 |  |
  | 3 |  | class Haet\_TemplateDesigner { |
  |  | 3 | class Haet\_TemplateDesigner |
  |  | 4 | { |
  | 4 | 5 | private $api\_base = 'whm/v3'; |
  | 5 | 6 |  |
  | 6 |  | function \_\_construct(){ |
  | 7 |  | add\_action( 'admin\_enqueue\_scripts', [ $this, 'admin\_page\_scripts\_and\_styles' ] ); |
  | 8 |  | add\_action( 'rest\_api\_init', [ $this, 'rest\_api\_init' ] ); |
  |  | 7 | function \_\_construct() |
  |  | 8 | { |
  |  | 9 | add\_action('admin\_enqueue\_scripts', [$this, 'admin\_page\_scripts\_and\_styles']); |
  |  | 10 | add\_action('rest\_api\_init', [$this, 'rest\_api\_init']); |
  | 9 | 11 |  |
  | 10 |  | add\_action(~~'admin\_notices', [ $this, 'showTemplateDesignerUpdateNotice' ]~~ ); |
  |  | 12 | add\_action('admin\_notices', [$this, 'showTemplateDesignerUpdateNotice']); |
  | 11 | 13 | } |
  | 12 |  |  |
  | 13 |  |  |
  | 14 |  |  |
  | 15 |  | public function admin\_page\_scripts\_and\_styles($page){ |
  | 16 |  | if(strpos($page, 'wp-html-mail') && ( !array\_key\_exists( 'tab', $\_GET ) || $\_GET['tab'] =="template" ) ){ |
  | 17 |  |  |
  |  | 14 |  |
  |  | 15 |  |
  |  | 16 |  |
  |  | 17 | public function admin\_page\_scripts\_and\_styles($page) |
  |  | 18 | { |
  |  | 19 | if (strpos($page, 'wp-html-mail') && (!array\_key\_exists('tab', $\_GET) || $\_GET['tab'] == "template")) { |
  |  | 20 |  |
  | 18 | 21 | // style our options panel like the block editor |
  | 19 |  | wp\_enqueue\_style(~~'wp-editor'~~ ); |
  | 20 |  | wp\_enqueue\_style(~~'wp-components'~~ ); |
  | 21 |  | wp\_enqueue\_style(~~'forms'~~ ); |
  |  | 22 | wp\_enqueue\_style('wp-editor'); |
  |  | 23 | wp\_enqueue\_style('wp-components'); |
  |  | 24 | wp\_enqueue\_style('forms'); |
  | 22 | 25 |  |
  | 23 | 26 | // https://developer.wordpress.org/block-editor/packages/packages-dependency-extraction-webpack-plugin/ |
  | 24 |  | $script\_path = HAET\_MAIL\_PATH . 'js/template-designer/' . (~~$this->isScriptDebug() ? 'dev' : 'dist'~~ ) . '/main.js'; |
  | 25 |  | $script\_asset\_path = HAET\_MAIL\_PATH . 'js/template-designer/' . (~~$this->isScriptDebug() ? 'dev' : 'dist'~~ ) . '/main.asset.php'; |
  | 26 |  | $script\_asset      = file\_exists(~~$script\_asset\_path~~ ) |
  | 27 |  | ? require(~~$script\_asset\_path~~ ) |
  | 28 |  | : array(~~'dependencies' => array(), 'version' => filemtime( $script\_path )~~ ); |
  | 29 |  | $script\_url = HAET\_MAIL\_URL . 'js/template-designer/' . (~~$this->isScriptDebug() ? 'dev' : 'dist'~~ ) . '/main.js'; |
  |  | 27 | $script\_path = HAET\_MAIL\_PATH . 'js/template-designer/' . ($this->isScriptDebug() ? 'dev' : 'dist') . '/main.js'; |
  |  | 28 | $script\_asset\_path = HAET\_MAIL\_PATH . 'js/template-designer/' . ($this->isScriptDebug() ? 'dev' : 'dist') . '/main.asset.php'; |
  |  | 29 | $script\_asset      = file\_exists($script\_asset\_path) |
  |  | 30 | ? require($script\_asset\_path) |
  |  | 31 | : array('dependencies' => array(), 'version' => filemtime($script\_path)); |
  |  | 32 | $script\_url = HAET\_MAIL\_URL . 'js/template-designer/' . ($this->isScriptDebug() ? 'dev' : 'dist') . '/main.js'; |
  | 30 | 33 |  |
  | 31 | 34 | wp\_enqueue\_script('wp-html-mail-template-designer', $script\_url, $script\_asset['dependencies'], $script\_asset['version']); |
  | 32 | 35 | wp\_localize\_script('wp-html-mail-template-designer', 'mailTemplateDesigner', [ |
  | 33 | 36 | 'restUrl'               => $this->getRestUrl(), |
  | 34 |  | 'nonce'                 => wp\_create\_nonce(~~'wp\_rest'~~ ), |
  |  | 37 | 'nonce'                 => wp\_create\_nonce('wp\_rest'), |
  | 35 | 38 | 'fonts'                 => $this->getAvailableFonts(), |
  | 36 | 39 | 'templateLibraryUrl'    => Haet\_Mail()->get\_tab\_url('template-library'), |
  | 37 | 40 | 'isMultiLanguageSite'   => Haet\_Mail()->multilanguage->is\_multilanguage\_site(), |
  | 38 |  | 'currentLanguage'       => Haet\_Mail()->multilanguage->get\_current\_language() |
  |  | 41 | 'currentLanguage'       => Haet\_Mail()->multilanguage->get\_current\_language(), |
  |  | 42 | 'nonce'                 => wp\_create\_nonce('wp\_rest') |
  | 39 | 43 | ]); |
  | 40 | 44 | wp\_enqueue\_media(); |
  | 41 | 45 | wp\_enqueue\_editor(); |
  | 42 |  | } |
  |  | 46 | } |
  | 43 | 47 | } |
  | 44 | 48 |  |
  | 45 | 49 |  |
  | 46 | 50 |  |
  | 47 |  | public function rest\_api\_init() { |
  | 48 |  | register\_rest\_route( $this->api\_base, '/themesettings', array( |
  | 49 |  | 'methods' => 'GET', |
  | 50 |  | 'callback' => [ $this, 'getThemeSettings' ], |
  | 51 |  | 'permission\_callback' => '\_\_return\_true' |
  |  | 51 | public function rest\_api\_init() |
  |  | 52 | { |
  |  | 53 | register\_rest\_route($this->api\_base, '/themesettings', array( |
  |  | 54 | 'methods' => 'GET', |
  |  | 55 | 'callback' => [$this, 'getThemeSettings'], |
  |  | 56 | 'permission\_callback' => function () { |
  |  | 57 | return current\_user\_can('manage\_options'); |
  |  | 58 | } |
  | 52 | 59 | )); |
  | 53 |  |  |
  | 54 |  | register\_rest\_route( $this->api\_base, '/themesettings', array( |
  | 55 |  | 'methods' => 'POST', |
  | 56 |  | 'callback' => [ $this, 'saveThemeSettings' ], |
  | 57 |  | 'permission\_callback' => '\_\_return\_true' |
  |  | 60 |  |
  |  | 61 | register\_rest\_route($this->api\_base, '/themesettings', array( |
  |  | 62 | 'methods' => 'POST', |
  |  | 63 | 'callback' => [$this, 'saveThemeSettings'], |
  |  | 64 | 'permission\_callback' => function () { |
  |  | 65 | return current\_user\_can('manage\_options'); |
  |  | 66 | } |
  | 58 | 67 | )); |
  | 59 | 68 | } |
  | 60 | 69 |  |
  | 61 | 70 |  |
  | 62 |  | public function getThemeSettings(){ |
  |  | 71 | public function getThemeSettings() |
  |  | 72 | { |
  | 63 | 73 | $theme\_options = Haet\_Mail()->get\_theme\_options('default'); |
  | 64 | 74 |  |
  | 65 |  | ~~return new \WP\_REST\_Response( $theme\_options~~ ); |
  |  | 75 | return new \WP\_REST\_Response($theme\_options); |
  | 66 | 76 | } |
  | 67 |  |  |
  | 68 |  | public function saveThemeSettings( $request ){ |
  | 69 |  | if( $request->get\_params() ){ |
  |  | 77 |  |
  |  | 78 | public function saveThemeSettings($request) |
  |  | 79 | { |
  |  | 80 | if ($request->get\_params()) { |
  | 70 | 81 | $theme\_options = $request->get\_params(); |
  | 71 | 82 | update\_option('haet\_mail\_theme\_options', $theme\_options); |
  | 72 | 83 | } |
  | 73 |  |  |
  |  | 84 |  |
  | 74 | 85 | $options = Haet\_Mail()->get\_options(); |
  | 75 | 86 | $plugin\_options = Haet\_Sender\_Plugin::get\_plugin\_options(); |
  | 76 | 87 |  |
  | 77 |  | $preview = Haet\_Mail()->get\_preview(~~Haet\_Sender\_Plugin::get\_active\_plugins(), 'template', $options, $plugin\_options, $theme\_options~~ ); |
  | 78 |  | return new \WP\_REST\_Response(~~['preview' => $preview]~~ ); |
  |  | 88 | $preview = Haet\_Mail()->get\_preview(Haet\_Sender\_Plugin::get\_active\_plugins(), 'template', $options, $plugin\_options, $theme\_options); |
  |  | 89 | return new \WP\_REST\_Response(['preview' => $preview]); |
  | 79 | 90 | } |
  | 80 | 91 |  |
  | 81 |  | private function getAvailableFonts(){ |
  |  | 92 | private function getAvailableFonts() |
  |  | 93 | { |
  | 82 | 94 | $fonts = Haet\_Mail()->get\_fonts(); |
  | 83 | 95 | $fonts\_select\_options = []; |
  | 84 |  | foreach~~( $fonts as $value => $label )~~{ |
  |  | 96 | foreach ($fonts as $value => $label) { |
  | 85 | 97 | $fonts\_select\_options[] = [ |
  | 86 | 98 | 'value' => $value, |
  | […](/browser/wp-html-mail/trunk/includes/class-template-designer.php?rev=2466288#L88) | […](/browser/wp-html-mail/trunk/includes/class-template-designer.php?rev=2656984#L100) |  |
  | 88 | 100 | ]; |
  | 89 | 101 | } |
  | 90 |  | return $fonts\_select\_options; |
  |  | 102 | return $fonts\_select\_options; |
  | 91 | 103 | } |
  | 92 | 104 |  |
  | 93 | 105 |  |
  | 94 | 106 |  |
  | 95 |  | private function getRestUrl( $endpoint = '' ) { |
  | 96 |  | return get\_rest\_url( null, $this->api\_base . '/' . $endpoint ); |
  |  | 107 | private function getRestUrl($endpoint = '') |
  |  | 108 | { |
  |  | 109 | return get\_rest\_url(null, $this->api\_base . '/' . $endpoint); |
  | 97 | 110 | } |
  | 98 |  |  |
  | 99 | 111 |  |
  | 100 |  | public function isScriptDebug() { |
  | 101 |  | return defined('SCRIPT\_DEBUG') && SCRIPT\_DEBUG === true; |
  |  | 112 |  |
  |  | 113 | public function isScriptDebug() |
  |  | 114 | { |
  |  | 115 | return defined('SCRIPT\_DEBUG') && SCRIPT\_DEBUG === true; |
  | 102 | 116 | } |
  | 103 |  |  |
  | 104 |  | public function isWPVersionCompatible(){ |
  |  | 117 |  |
  |  | 118 | public function isWPVersionCompatible() |
  |  | 119 | { |
  | 105 | 120 | // our new JavaScript based editor relies on some WordPress React components available in 5.4 |
  | 106 |  | return version\_compare(~~get\_bloginfo( 'version' ), '5.4', '>='~~ ); |
  |  | 121 | return version\_compare(get\_bloginfo('version'), '5.4', '>='); |
  | 107 | 122 | } |
  | 108 | 123 |  |
  | […](/browser/wp-html-mail/trunk/includes/class-template-designer.php?rev=2466288#L112) | […](/browser/wp-html-mail/trunk/includes/class-template-designer.php?rev=2656984#L127) |  |
  | 112 | 127 | \* either to tell the users to check their settings in the new editor or to tell them to better update WP to see the new editor |
  | 113 | 128 | \*/ |
  | 114 |  | public function showTemplateDesignerUpdateNotice(){ |
  | 115 |  | if( $this->isWPVersionCompatible() ){ |
  |  | 129 | public function showTemplateDesignerUpdateNotice() |
  |  | 130 | { |
  |  | 131 | if ($this->isWPVersionCompatible()) { |
  | 116 | 132 | $options = Haet\_Mail()->get\_options(); |
  | 117 |  | if~~( !array\_key\_exists( 'user\_checked\_settings\_in\_v3', $options ) || !$options['user\_checked\_settings\_in\_v3'] )~~{ |
  | 118 |  | ?> |
  |  | 133 | if (!array\_key\_exists('user\_checked\_settings\_in\_v3', $options) || !$options['user\_checked\_settings\_in\_v3']) { |
  |  | 134 | ?> |
  | 119 | 135 | <div class="notice notice-success"> |
  | 120 |  | <p><?php echo sprintf(~~\_\_( 'You successfully upgraded to our <strong>new email editor</strong>! Please <a href="%1$s">review your settings</a> to make sure everything still looks as expected.', 'wp-html-mail' ), get\_admin\_url(null,'options-general.php?page=wp-html-mail')~~ ); ?></p> |
  |  | 136 | <p><?php echo sprintf(\_\_('You successfully upgraded to our <strong>new email editor</strong>! Please <a href="%1$s">review your settings</a> to make sure everything still looks as expected.', 'wp-html-mail'), get\_admin\_url(null, 'options-general.php?page=wp-html-mail')); ?></p> |
  | 121 | 137 | </div> |
  | 122 |  | <?php |
  |  | 138 | <?php |
  | 123 | 139 | } |
  | 124 |  | }~~elseif( array\_key\_exists( 'page', $\_GET ) && $\_GET['page'] == "wp-html-mail" )~~{ |
  |  | 140 | } elseif (array\_key\_exists('page', $\_GET) && $\_GET['page'] == "wp-html-mail") { |
  | 125 | 141 | ?> |
  | 126 | 142 | <div class="notice notice-warning"> |
  | 127 |  | <p><?php \_e(~~'In order to use our <strong>new email editor</strong> you need to upgrade to WordPress 5.4 or higher. In the meanwhile you can still use our classic settings pages.', 'wp-html-mail'~~ ); ?></p> |
  |  | 143 | <p><?php \_e('In order to use our <strong>new email editor</strong> you need to upgrade to WordPress 5.4 or higher. In the meanwhile you can still use our classic settings pages.', 'wp-html-mail'); ?></p> |
  | 128 | 144 | </div> |
  | 129 |  | <?php |
  |  | 145 | <?php |
  | 130 | 146 | } |
  | 131 | 147 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2656984)
* [Zip Archive](?format=zip&new=2656984)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_55582178_20250114_194707.html ===


![](https://www.wordfence.com/wp-content/uploads/2022/01/Unauthenticated-XSS-Vulnerability-Patched-in-HTML-Email-Template-Designer-Plugin.png)

[![](https://secure.gravatar.com/avatar/9bf72594e071c28445ed7a1be0de1a23?s=80&d=mm&r=g)Chloe Chamberland](https://www.wordfence.com/blog/author/wfchloe/)

January 19, 2022

# Unauthenticated XSS Vulnerability Patched in HTML Email Template Designer Plugin

On December 23, 2021 the Wordfence Threat Intelligence team initiated the responsible disclosure process for a vulnerability we discovered in “WordPress Email Template Designer – WP HTML Mail”, a WordPress plugin that is installed on over 20,000 sites. This flaw made it possible for an unauthenticated attacker to inject malicious JavaScript that would execute whenever a site administrator accessed the template editor. This vulnerability would also allow them to modify the email template to contain arbitrary data that could be used to perform a phishing attack against anyone who received emails from the compromised site.

[Wordfence Premium](https://www.wordfence.com/wordfence-signup/?promo_id=blog20220119&promo_name=get-premium&promo_creative=txt&promo_position=introduction) users received a firewall rule to protect against any exploits targeting this vulnerability on December 23, 2021. Sites still using the free version of Wordfence will receive the same protection on January 22, 2022.

We sent the full disclosure details to the developer on January 10, 2022, after multiple attempts to contact the developer and eventually receiving a response. The developer quickly acknowledged the report and released a patch on January 13, 2022.

We strongly recommend ensuring that your site has been updated to the latest patched version of “WordPress Email Template Designer – WP HTML Mail”, which is version 3.1 at the time of this publication.

**Description**: Unprotected REST-API Endpoint to Unauthenticated Stored Cross-Site Scripting and Data Modification

**Affected Plugin:** [WordPress Email Template Designer – WP HTML Mail](https://wordpress.org/plugins/wp-html-mail/)

**Plugin Slug:** wp-html-mail

**Plugin Developer:** codemiq

**Affected Versions:** <= 3.0.9

**CVE ID:** [CVE-2022-0218](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0218)

**CVSS Score:** 8.3 (High)

**CVSS Vector:** [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

**Researcher/s:** Chloe Chamberland

**Fully Patched Version:** 3.1

WP HTML Mail is a WordPress plugin developed to make designing custom emails simpler for WordPress site owners. It is compatible with various WordPress plugins like WooCommerce, Ninja Forms, BuddyPress, and more. The plugin registers two REST-API routes which are used to retrieve email template settings and update email template settings. Unfortunately, these were insecurely implemented making it possible for unauthenticated users to access these endpoints.

More specifically, the plugin registers the `/themesettings` endpoint, which calls the `saveThemeSettings` function or the `getThemeSettings` function depending on the request method. The REST-API endpoint did use the `permission_callback` function, however, it was set to `__return_true` which meant that no authentication was required to execute the functions. Therefore, any user had access to execute the REST-API endpoint to save the email’s theme settings or retrieve the email’s theme settings.

```
	public function rest_api_init() {
		register_rest_route( $this->api_base, '/themesettings', array(
            'methods' => 'GET',
			'callback' => [ $this, 'getThemeSettings' ],
			'permission_callback' => '__return_true'
		));

		register_rest_route( $this->api_base, '/themesettings', array(
            'methods' => 'POST',
			'callback' => [ $this, 'saveThemeSettings' ],
			'permission_callback' => '__return_true'
		));
	}
```

As this functionality was designed to implement setting changes for the email template, an unauthenticated user could easily make changes to the email template that could aid in phishing attempts against users that receive emails from the targeted site. Worse yet, unauthenticated attackers could inject malicious JavaScript into the mail template that would execute anytime a site administrator accessed the HTML mail editor.

As always, cross-site scripting vulnerabilities can be used to inject code that can add new administrative users, redirect victims to malicious sites, inject backdoors into theme and plugin files, and so much more. Combined with the fact that the vulnerability can be exploited by attackers with no privileges on a vulnerable site, this means that there is a high chance that unauthenticated attackers could gain administrative user access on sites running the vulnerable version of the plugin when successfully exploited. As such, we strongly recommend that you verify that your site is running the most up to date version of the plugin immediately.

## Timeline

**December 23, 2021** – Conclusion of the plugin analysis that led to the discovery of a Stored Cross-Site Scripting Vulnerability in the “WordPress Email Template Designer – WP HTML Mail” plugin. We develop and release a firewall rule to protect Wordfence users. Wordfence Premium users receive this rule immediately. We attempt to initiate contact with the developer.

**January 4, 2022** – We send an additional outreach attempt to the developer.

**January 10, 2022** – The developer confirms the inbox for handling the discussion. We send over the full disclosure details.

**January 11, 2022** – The developer acknowledges the report and indicates that they will work on a fix.

**January 13, 2022** – A fully patched version of the plugin is released as version 3.1.

**January 22, 2022** – The firewall rule becomes available to free Wordfence users.

## Conclusion

In today’s post, we detailed a flaw in the “[WordPress Email Template Designer – WP HTML Mail](https://wordpress.org/plugins/wp-html-mail/)” plugin that made it possible for unauthenticated attackers to inject malicious web scripts that would execute whenever a site owner accessed the mail editor area plugin, which could lead to complete site compromise. This flaw has been fully patched in version 3.1.

We recommend that WordPress site owners immediately verify that their site has been updated to the latest patched version available, which is version 3.1 at the time of this publication.

[Wordfence Premium](https://www.wordfence.com/wordfence-signup/?promo_id=blog20220119&promo_name=get-premium&promo_creative=txt&promo_position=conclusion) users received a firewall rule to protect against any exploits targeting this vulnerability on December 23, 2021. Sites still using the free version of Wordfence will receive the same protection on January 22, 2022.

If you know a friend or colleague who is using this plugin on their site, we highly recommend forwarding this advisory to them to help keep their sites protected as this is a serious vulnerability that can lead to complete site takeover.

If your site has been compromised by an attack on this or any other plugin, our [Professional Site Cleaning services](https://www.wordfence.com/wordfence-site-cleanings/?promo_id=top-get-help&promo_name=get-site-clean&promo_creative=yellow-txt&promo_position=sw-top) can help you get back in business.

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2022%2F01%2Funauthenticated-xss-vulnerability-patched-in-html-email-template-designer-plugin%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2022%2F01%2Funauthenticated-xss-vulnerability-patched-in-html-email-template-designer-plugin%2F&text=Unauthenticated%20XSS%20Vulnerability%20Patched%20in%20HTML%20Email%20Template%20Designer%20Plugin&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2022%2F01%2Funauthenticated-xss-vulnerability-patched-in-html-email-template-designer-plugin%2F)

## Comments

No Comments

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save


