=== Content from access.redhat.com_82f72db5_20250114_190424.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [FranÃ§ais](https://access.redhat.com/changeLanguage?language=fr)
* [í•œêµ­ì–´](https://access.redhat.com/changeLanguage?language=ko)
* [æ—¥æœ¬èªž](https://access.redhat.com/changeLanguage?language=ja)
* [ä¸­æ–‡ (ä¸­å›½)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 Â© 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from github.com_a326ab4b_20250114_190425.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhaproxy%2Fhaproxy%2Fcommit%2Fbfb15ab34ead85f64cd6da0e9fb418c9cd14cee8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhaproxy%2Fhaproxy%2Fcommit%2Fbfb15ab34ead85f64cd6da0e9fb418c9cd14cee8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=haproxy%2Fhaproxy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[haproxy](/haproxy)
/
**[haproxy](/haproxy/haproxy)**
Public

* [Notifications](/login?return_to=%2Fhaproxy%2Fhaproxy) You must be signed in to change notification settings
* [Fork
  811](/login?return_to=%2Fhaproxy%2Fhaproxy)
* [Star
   5.2k](/login?return_to=%2Fhaproxy%2Fhaproxy)

* [Code](/haproxy/haproxy)
* [Issues
  287](/haproxy/haproxy/issues)
* [Pull requests
  0](/haproxy/haproxy/pulls)
* [Actions](/haproxy/haproxy/actions)
* [Projects
  0](/haproxy/haproxy/projects)
* [Wiki](/haproxy/haproxy/wiki)
* [Security](/haproxy/haproxy/security)
* [Insights](/haproxy/haproxy/pulse)

Additional navigation options

* [Code](/haproxy/haproxy)
* [Issues](/haproxy/haproxy/issues)
* [Pull requests](/haproxy/haproxy/pulls)
* [Actions](/haproxy/haproxy/actions)
* [Projects](/haproxy/haproxy/projects)
* [Wiki](/haproxy/haproxy/wiki)
* [Security](/haproxy/haproxy/security)
* [Insights](/haproxy/haproxy/pulse)

## Commit

[Permalink](/haproxy/haproxy/commit/bfb15ab34ead85f64cd6da0e9fb418c9cd14cee8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

BUG/MAJOR: http/htx: prevent unbounded loop in http\_manage\_server\_sidâ€¦

[Browse files](/haproxy/haproxy/tree/bfb15ab34ead85f64cd6da0e9fb418c9cd14cee8)
Browse the repository at this point in the history

```
â€¦e_cookies

Ensure calls to http_find_header() terminate. If a "Set-Cookie2"
header is found then the while(1) loop in
http_manage_server_side_cookies() will never terminate, resulting in
the watchdog firing and the process terminating via SIGABRT.

The while(1) loop becomes unbounded because an unmatched call to
http_find_header("Set-Cookie") will leave ctx->blk=NULL. Subsequent
calls to check for "Set-Cookie2" will now enumerate from the beginning
of all the blocks and will once again match on subsequent
passes (assuming a match first time around), hence the loop becoming
unbounded.

This issue was introduced with HTX and this fix should be backported
to all versions supporting HTX.

Many thanks to Grant Spence (gspence@redhat.com) for working through
this issue with me.
```

* Loading branch information

[![@frobware](https://avatars.githubusercontent.com/u/943903?s=40&v=4)](/frobware) [![@wtarreau](https://avatars.githubusercontent.com/u/8141789?s=40&v=4)](/wtarreau)

[frobware](/haproxy/haproxy/commits?author=frobware "View all commits by frobware")
authored and
[wtarreau](/haproxy/haproxy/commits?author=wtarreau "View all commits by wtarreau")
committed
Feb 16, 2022

1 parent
[1d5fdc5](/haproxy/haproxy/commit/1d5fdc526b5ebf402e6359a3616a4fc3cc2269b3)

commit bfb15ab

Showing
**1 changed file**
with
**1 addition**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[src/http\_ana.c](#diff-a14c673145cd3a7ed833f30e9f2c283df1754427877b6bca8bd72868fa5b0d6c "src/http_ana.c")

Show comments

[View file](/haproxy/haproxy/blob/bfb15ab34ead85f64cd6da0e9fb418c9cd14cee8/src/http_ana.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3418,7 +3418,7 @@ static void http\_manage\_server\_side\_cookies(struct stream \*s, struct channel \*re |
|  |  | while (1) { |
|  |  | int is\_first = 1; |
|  |  |  |
|  |  | if (!http\_find\_header(htx, ist("Set-Cookie"), &ctx, 1)) { |
|  |  | if (is\_cookie2 || !http\_find\_header(htx, ist("Set-Cookie"), &ctx, 1)) { |
|  |  | if (!http\_find\_header(htx, ist("Set-Cookie2"), &ctx, 1)) |
|  |  | break; |
|  |  | is\_cookie2 = 1; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 4 comments on commit `bfb15ab`

[![@tcherel](https://avatars.githubusercontent.com/u/49148015?s=80&v=4)](/tcherel)

Copy link

### @tcherel **[tcherel](/tcherel)** commented on `[bfb15ab](/haproxy/haproxy/commit/bfb15ab34ead85f64cd6da0e9fb418c9cd14cee8)` [Mar 7, 2022](#commitcomment-68146970)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@frobware](https://github.com/frobware) [@wtarreau](https://github.com/wtarreau) any plan to backport this in a stable haproxy release (2.4 or 2.5)?

Thanks.

Sorry, something went wrong.

All reactions

[![@capflam](https://avatars.githubusercontent.com/u/159766?s=80&v=4)](/capflam)

Copy link

Member

### @capflam **[capflam](/capflam)** commented on `[bfb15ab](/haproxy/haproxy/commit/bfb15ab34ead85f64cd6da0e9fb418c9cd14cee8)` [Mar 7, 2022](#commitcomment-68147461)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The fix was backported in all affected versions. Last 2.5 and 2.4 releases include it. It is also true for last 2.3 and 2.2 releases. The next 2.0 will ship it too. It will be released this week.

Sorry, something went wrong.

All reactions

[![@wtarreau](https://avatars.githubusercontent.com/u/8141789?s=80&v=4)](/wtarreau)

Copy link

Member

### @wtarreau **[wtarreau](/wtarreau)** commented on `[bfb15ab](/haproxy/haproxy/commit/bfb15ab34ead85f64cd6da0e9fb418c9cd14cee8)` [Mar 7, 2022](#commitcomment-68147502)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@tcherel](https://github.com/tcherel) that was done a month ago already (2.4.13 and 2.5.2). If you're running on up-to-date versions (2.4.14 or 2.5.4), you already have it.

Sorry, something went wrong.

All reactions

[![@tcherel](https://avatars.githubusercontent.com/u/49148015?s=80&v=4)](/tcherel)

Copy link

### @tcherel **[tcherel](/tcherel)** commented on `[bfb15ab](/haproxy/haproxy/commit/bfb15ab34ead85f64cd6da0e9fb418c9cd14cee8)` [Mar 7, 2022](#commitcomment-68168300)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Totally missed that, sorry.

Thanks a lot.

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhaproxy%2Fhaproxy%2Fcommit%2Fbfb15ab34ead85f64cd6da0e9fb418c9cd14cee8) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from www.mail-archive.com_9bfeaaf8_20250114_190428.html ===


[Skip to site navigation (Press enter)](#nav)

# [[ANNOUNCE] haproxy-2.5.2](/search?l=haproxy@formilux.org&q=subject:%22%5C%5BANNOUNCE%5C%5D+haproxy%5C-2.5.2%22&o=newest)

[Willy Tarreau](/search?l=haproxy@formilux.org&q=from:%22Willy+Tarreau%22)
[Wed, 16 Feb 2022 07:28:06 -0800](/search?l=haproxy@formilux.org&q=date:20220216)

```
Hi,

HAProxy 2.5.2 was released on 2022/02/16. It added 44 new commits
after version 2.5.1.
```
```

This version addresses a few long-term bugs that have been keeping us
quite busy for far too long, but ultimately it's satisfying to know that
these ones are gone and that they won't be casting a doubt over every
single bug report.

The main issues fixed in this version are:
  - a tiny race condition in the scheduler affecting the rare multi-
    threaded tasks. In some cases, a task could be finishing to run
    on one thread and expiring on another one, just in the process
    of being requeued to the position being in the process of being
    calculated by the thread finishing with it. The most likely case
    was the peers task disabling the expiration while waiting for other
    peers to be locked, causing such a non-expirable task to be queued
    and to block all other timers from expiring (typically health checks,
    peers and resolvers, but others were affected). This could only
    happen at high peers traffic rate but it definitely did. When built
    with the suitable options such as DEBUG_STRICT it would immediately
    crash (which is how it was detected). This bug was present since 2.0.

  - a bug in the Set-Cookie2 response parser may result in an infinite
    loop triggering the watchdog if a server sends this while it belongs
    to a backend configured with cookie persistence. Usually cookie-based
    persistence is not used with untrusted servers, but if that was the
    case, the following rule would be usable as a workaround for the time
    it takes to upgrade:

         http-response del-header Set-Cookie2

    It reminded us that 2.5 years ago we were discussing about completely
    dropping Set-Cookie2 which never succeeded in field, Tim has opened an
    issue so that we don't forget to remove it after 2.6. This issue was
    diagnosed, reported and fixed by Andrew McDermott and Grant Spence.
    This bug was there since 1.9.

  - a bug in the SPOE error handling. When a connection to an agent dies,
    there may still be requests pending that are tied to this connection.
    The list of such requests is scanned so that they can be aborted,
    except that the condition to scan the list was incorrect, and when
    these requests were finally aborted upon processing timeout, they were
    updating the memory area they used to point to, which could have been
    reused for anything, causing random crashes very commonly seen in
    libc's malloc/free va openssl, or haproxy pools with corrupted pointers.
    In short, anyone using SPOE must absolutely update to apply the fix
    otherwise any bug they face cannot be trusted as we know there's a rare
    but real case of memory corruption there. This bug was present since
    1.8.

  - there was a possible race condition on the listeners where it was
    sometimes possible to wake up a temporarily paused listener just after
    it had failed to rebind upon a failed attempt to reload. This would
    access fdtab[-1] causing memory corruption or crashes. It's been there
    since 2.2 but really started to have an effect with 2.3.

  - the master CLI could remain stuck forever if extra characters followed
    by a shutdown were sent before the end of a response. In this case, each
    such connection would remain unusable, and a script doing this would
    face a connection failure after the 10th attempt (master's maxconn). A
    few related issues could also cause it to loop forever (e.g. too long
    pipelined requests, and empty buffers after wrapping).

  - the connection stopping list introduced in 2.4 to deal with idle
    frontend connection on reloads missed a deletion, and could leave link
    elements in the list after their containing structure was freed, causing
    occasional crashes of the old process upon reload.

  - there is an ambiguity in the definition of dynamic table size updates
    between the HTTP/2 spec (RFC7540) and the HPACK spec (RFC7541) which
    can be read two ways. HAProxy and a few servers interpret it one way
    and a few clients and other servers interpret it another way (and
    generally clients win, as usual). One client, nghttp, enforces it
    strictly, causing interoperability issues with haproxy and a few other
    ones when the table size is set below 4096. We had a long discussion
    with other participants of the HTTP working group to find the best
    path forward that resulted in a nice update of the H2 spec that
    preserves the best interoperability with existing components while
    clarifying all points. This update is present in this version and
    will be progressively backported to older ones after some time (I
    managed to mess up with the first attempt).

  - the HTTP client might not always start to send requests which were
    ready in advance (before the connection is requested), it used to work
    most of the time thanks to the scheduling of events but was a bit
    fragile and could easily crash if the sequencing of events changed a
    bit.

  - there was an issue with the data transfer in the HTX layer, however
    I'm not very clear on the impact, I think it can sometimes cause data
    to be truncated or just blocked.

  - it was possible to temporarily lose the stats sockets upon reloads in
    master-worker mode in case of early error (e.g. missing config file),
    in which case the socket transfer from the older process couldn't
    happen.

  - the "set server ssl" CLI command introduced in 2.4 had the undesirable
    side effect of modifying the data path and the check path at the same
    time (by mimmicking the configration), which causes quite some trouble.
    Now the doc was updated to clearly state that only the data path is
    updated, and the code does that (otherwise it is unusable anyway).

  - there were still a number of other issues of lower level of importance,
    such as the CLI being extremely slow to parse pipelined requests because
    it was looking for the line feed first, hence the larger the buffer, the
    slower it was with batch updates like ACL/map updates; there were a few
    issues in the JWT code on exit (double free in deinit etc), missing
    headers in the HTTP client, a possibly truncated pidfile in master mode.

Some debugging options were added and backported. One that recently helped
us is DEBUG_POOL_INTEGRITY combined with the existing DEBUG_DONT_SHARE_POOLS
and DEBUG_STRICT. The first two ones will provide sort of an equivalent of
the use-after-free debug option that was not suitable for production, by
checking if released memory areas were tampered with between their last
free() and the next malloc(). This slightly increases CPU usage (1-2%
typically) but will catch most memory corruptions much earlier and much
cleaner than what happened over the last weeks: instead of crashing at
random places that are victims of a change, the crash happens much closer
to the bad actor, and with more context to figure what happened.

And quite frankly for all those who can afford it (i.e. all those not running
at more than 98% CPU), I would kindly ask to add these 4 options to their
build command line so that their future bug reports are much more accurate:

  $ make ... DEBUG="-DDEBUG_STRICT -DDEBUG_MEMORY_POOLS \
                    -DDEBUG_DONT_SHARE_POOLS -DDEBUG_POOL_INTEGRITY"

This also allows developers to quickly rule out many potential causes and
provide responses faster. By the way we're always running with all debugging
turned full-throttle on haproxy.org and recently switched from DEBUG_UAF to
DEBUG_POOL_INTEGRITY.

Maybe that would even be a nice improvement for distros to provide these
by default starting with 2.6 or maybe even 2.5.

Older stable versions are following with essentially the same set of fixes.
2.4 is in the blocks already, and 2.3+2.2+2.0 probably next week.

I would like to address sincere and warm thanks to Christian Ruppert,
Yves Lafon and Pierre Cheynier for having provided lots of help and traces,
deployed and rebuilt almost daily with extra debug code over the last few
weeks to address the painful series of issues above. Their participation
was invaluable and their continued efforts finally pay for all of us.
Keep up the great job guys!

Please find the usual URLs below :
   Site index       : <http://www.haproxy.org/>
   Discourse        : <http://discourse.haproxy.org/>
   Slack channel    : <https://slack.haproxy.org/>
   Issue tracker    : <https://github.com/haproxy/haproxy/issues>
   Wiki             : <https://github.com/haproxy/wiki/wiki>
   Sources          : <http://www.haproxy.org/download/2.5/src/>
   Git repository   : <http://git.haproxy.org/git/haproxy-2.5.git/>
   Git Web browsing : <http://git.haproxy.org/?p=haproxy-2.5.git>
   Changelog        : <http://www.haproxy.org/download/2.5/src/CHANGELOG>
   Cyril's HTML doc : <http://cbonte.github.io/haproxy-dconv/>

Willy
---
Complete changelog :
Andrew McDermott (1):
      BUG/MAJOR: http/htx: prevent unbounded loop in
http_manage_server_side_cookies

Christopher Faulet (4):
      BUG/MEDIUM: htx: Adjust length to add DATA block in an empty HTX buffer
      BUG/MEDIUM: cli: Never wait for more data on client shutdown
      BUG/MINOR: httpclient: Revisit HC request and response buffers allocation
      BUG/MEDIUM: httpclient: Xfer the request when the stream is created

David Carlier (1):
      BUILD/MINOR: fix solaris build with clang.

Remi Tricot-Le Breton (5):
      REGTESTS: ssl: Fix ssl_errors regtest with OpenSSL 1.0.2
      BUG/MINOR: ssl: Remove empty lines from "show ssl ocsp-response <id>"
output
      BUG/MINOR: jwt: Double free in deinit function
      BUG/MINOR: jwt: Missing pkey free during cleanup
      BUG/MINOR: jwt: Memory leak if same key is used in multiple jwt_verify
calls

William Dauchy (1):
      BUG/MEDIUM: server: avoid changing healthcheck ctx with set server ssl

William Lallemand (7):
      BUG/MINOR: httpclient: don't send an empty body
      BUG/MINOR: httpclient: set default Accept and User-Agent headers
      BUG/MINOR: httpclient/lua: don't pop the lua stack when getting headers
      DOC: management: mark "set server ssl" as deprecated
      BUG/MINOR: mworker: does not add the -sf in wait mode
      BUG/MINOR: mworker: does not erase the pidfile upon reload
      BUG/MINOR: httpclient/cli: display junk characters in vsn

Willy Tarreau (25):
      BUG/MEDIUM: connection: properly leave stopping list on error
      MEDIUM: cli: yield between each pipelined command
      MINOR: channel: add new function co_getdelim() to support multiple
delimiters
      BUG/MINOR: cli: avoid O(bufsize) parsing cost on pipelined commands
      MEDIUM: h2/hpack: emit a Dynamic Table Size Update after settings change
      BUG/MEDIUM: mcli: do not try to parse empty buffers
      BUG/MEDIUM: mcli: always realign wrapping buffers before parsing them
      BUG/MINOR: stream: make the call_rate only count the no-progress calls
      DEBUG: cli: add a new "debug dev fd" expert command
      BUILD: debug/cli: condition test of O_ASYNC to its existence
      DEBUG: pools: add new build option DEBUG_POOL_INTEGRITY
      BUG/MEDIUM: mworker: don't lose the stats socket on failed reload
      BUG/MINOR: pools: always flush pools about to be destroyed
      DEBUG: pools: add extra sanity checks when picking objects from a local
cache
      DEBUG: pools: let's add reverse mapping from cache heads to thread and
pool
      DEBUG: pools: replace the link pointer with the caller's address on
pool_free()
      BUG/MAJOR: sched: prevent rare concurrent wakeup of multi-threaded tasks
      DEBUG: fd: make sure we never try to insert/delete an impossible FD number
      MINOR: listener: replace the listener's spinlock with an rwlock
      BUG/MEDIUM: listener: read-lock the listener during accept()
      BUG/MAJOR: spoe: properly detach all agents when releasing the applet
      REGTESTS: server: close an occasional race on dynamic_server_ssl.vtc
      REGTESTS: peers: leave a bit more time to peers to synchronize
      BUG/MEDIUM: h2/hpack: fix emission of HPACK DTSU after settings change
      BUG/MINOR: mux-h2: update the session's idle delay before creating the
stream

---

```

* [Previous message](msg41832.html)
* [View by thread](index.html#41833)
* [View by date](maillist.html#41833)
* [Next message](msg41835.html)

* [ANNOUNCE] haproxy-2.5.2 Willy Tarreau
* + [Re: [ANNOUNCE] haproxy-2.5.2](msg41835.html) Vincent Bernat
  + - [Re: [ANNOUNCE] haproxy-2.5.2](msg41836.html) Willy Tarreau
    - * [Re: [ANNOUNCE] haproxy-2.5.2](msg41838.html) Vincent Bernat
      * + [Re: [ANNOUNCE] haproxy-2.5.2](msg41839.html) Willy Tarreau
        + - [Re: [ANNOUNCE] haproxy-2.5.2](msg41840.html) William Lallemand
    - [Re: [ANNOUNCE] haproxy-2.5.2](msg41837.html) Willy Tarreau
    - * [More dynamic debugging [was: [ANNOUNCE] hap...](msg41867.html) Willy Tarreau

## Reply via email to

[![The Mail Archive](/logo.png)](/)

Search the site

* [The Mail Archive home](/)
* [haproxy - all messages](/haproxy%40formilux.org/)
* [haproxy - about the list](/haproxy%40formilux.org/info.html)
* [Expand](/search?l=haproxy@formilux.org&q=subject:%22%5C%5BANNOUNCE%5C%5D+haproxy%5C-2.5.2%22&o=newest&f=1 "e")
* [Previous message](msg41832.html "p")
* [Next message](msg41835.html "n")

![haproxy](/haproxy@formilux.org/logo.png)

* [The Mail Archive home](/)
* [Add your mailing list](/faq.html#newlist)
* [FAQ](/faq.html)
* [Support](/faq.html#support)
* [Privacy](/faq.html#privacy)
* 20220216152725.GA28120@1wt.eu



=== Content from www.debian.org_18086bb3_20250114_190425.html ===


---

[[Date Prev](msg00069.html)][[Date Next](msg00071.html)]
[[Thread Prev](msg00069.html)][[Thread Next](msg00071.html)]
[[Date Index](maillist.html#00070)]
[[Thread Index](threads.html#00070)]

# [SECURITY] [DSA 5102-1] haproxy security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5102-1] haproxy security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Sun, 13 Mar 2022 16:26:19 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/E1nTR2x-0007iF-1n%40seger.debian.org)Â [E1nTR2x-0007iF-1n@seger.debian.org](msg00070.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5102-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
March 13, 2022                        <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : haproxy
CVE ID         : CVE-2022-0711

A flaw was discovered in the way HAProxy, a fast and reliable load
balancing reverse proxy, processes HTTP responses containing the
"Set-Cookie2" header, which can result in an unbounded loop, causing a
denial of service.

For the stable distribution (bullseye), this problem has been fixed in
version 2.2.9-2+deb11u3.

We recommend that you upgrade your haproxy packages.

For the detailed security status of haproxy please refer to its security
tracker page at:
<https://security-tracker.debian.org/tracker/haproxy>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAmIuGfxfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0RrZw//aNpAVlMRbWU7tIGnQpJvX0zYPeNhRw+bfJxFLU8qQTjRXY7Qhhab29R5
+YjLFmrEAP7JAGDdxsVN5tR1cB8wyO7lCI9bBFoSXMv2JK8g8AJWkERq/3AgVbV6
FLGD6652E0fb51e5Ai9pUo7af1Pm8bzjasu6IKf6DnDTeHjUpHxGNhHddp/JEA0Z
0YoVVKl8DGTG+q8qJMy5+IRHMceWJbfmSEa/djItJD1J9oAUq8FHV4ttRoyjORs6
ZbL/qOA8PBtdnOp0Y64TCzVxQdcJZBja7lUkGtCljIjdDr19V3BS1+ZZQ/LPS+rM
CA1kmXSRIlLtPVhwkqCeI763NSw7nvBUbZ5/fDn29y3r1knqGYJHMT5Z7skVKxmG
Csu1KbfoCnok5ZwTCAFHmmdxNy+386pUkY0HmRU2PEgLPlmmNKIHDIY9Rp1DXvPo
0AR3fEyCKIgU8LZDtSEACovaZbdxiwU/MjcHd2SQ/U19upEAcVH2zb7LX3DKk0JY
Cxy0/mJglCN/X3jMgERWcHTGMlhbkXgKprg2LnONS5VTOsrYifWaIl5wYBZVcBRe
yFBvevl/28drsDCFgbvjAGo0cN0r8zBxFUY97/RTXGNCrcPSar+qBhd/ja8lqz4p
qcXCEehBiU8hrtIvPKZ2mLOm4N96KfbyUhYhWQwoguv+aM2lj7I=
=WVe1
-----END PGP SIGNATURE-----

```

---


