=== Content from git.kernel.org_dd4ace1c_20250115_083815.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jan Kara <jack@suse.cz> | 2022-05-10 12:36:04 +0200 |
| --- | --- | --- |
| committer | Jan Kara <jack@suse.cz> | 2022-05-10 13:30:32 +0200 |
| commit | [c1ad35dd0548ce947d97aaf92f7f2f9a202951cf](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf)) | |
| tree | [8c521e3875bf2837889b9a7df519363ebe013870](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf) | |
| parent | [846a3351ddfe4a86eede4bb26a205c3f38ef84d3](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=846a3351ddfe4a86eede4bb26a205c3f38ef84d3) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf&id2=846a3351ddfe4a86eede4bb26a205c3f38ef84d3)) | |
| download | [linux-c1ad35dd0548ce947d97aaf92f7f2f9a202951cf.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-c1ad35dd0548ce947d97aaf92f7f2f9a202951cf.tar.gz) | |

udf: Avoid using stale lengthOfImpUseudf\_write\_fi() uses lengthOfImpUse of the entry it is writing to.
However this field has not yet been initialized so it either contains
completely bogus value or value from last directory entry at that place.
In either case this is wrong and can lead to filesystem corruption or
kernel crashes.
Reported-by: butt3rflyh4ck <butterflyhuangxx@gmail.com>
CC: stable@vger.kernel.org
Fixes: 979a6e28dd96 ("udf: Get rid of 0-length arrays in struct fileIdentDesc")
Signed-off-by: Jan Kara <jack@suse.cz>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf)

| -rw-r--r-- | [fs/udf/namei.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/udf/namei.c?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 4 deletions

| diff --git a/fs/udf/namei.c b/fs/udf/namei.cindex 0ed4861b038f6a..b3d5f97f16cdb1 100644--- a/[fs/udf/namei.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/udf/namei.c?id=846a3351ddfe4a86eede4bb26a205c3f38ef84d3)+++ b/[fs/udf/namei.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/udf/namei.c?id=c1ad35dd0548ce947d97aaf92f7f2f9a202951cf)@@ -75,11 +75,11 @@ int udf\_write\_fi(struct inode \*inode, struct fileIdentDesc \*cfi,  if (fileident) { if (adinicb || (offset + lfi < 0)) {- memcpy(udf\_get\_fi\_ident(sfi), fileident, lfi);+ memcpy(sfi->impUse + liu, fileident, lfi); } else if (offset >= 0) { memcpy(fibh->ebh->b\_data + offset, fileident, lfi); } else {- memcpy(udf\_get\_fi\_ident(sfi), fileident, -offset);+ memcpy(sfi->impUse + liu, fileident, -offset); memcpy(fibh->ebh->b\_data, fileident - offset, lfi + offset); }@@ -88,11 +88,11 @@ int udf\_write\_fi(struct inode \*inode, struct fileIdentDesc \*cfi, offset += lfi;  if (adinicb || (offset + padlen < 0)) {- memset(udf\_get\_fi\_ident(sfi) + lfi, 0x00, padlen);+ memset(sfi->impUse + liu + lfi, 0x00, padlen); } else if (offset >= 0) { memset(fibh->ebh->b\_data + offset, 0x00, padlen); } else {- memset(udf\_get\_fi\_ident(sfi) + lfi, 0x00, -offset);+ memset(sfi->impUse + liu + lfi, 0x00, -offset); memset(fibh->ebh->b\_data, 0x00, padlen + offset); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:36:52 +0000


