=== Content from www.mozilla.org_08ed189d_20250115_083706.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-15

## Security Vulnerabilities fixed in Thunderbird 91.8

Announced
April 5, 2022
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 91.8

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2022-1097: Use-after-free in NSSToken objects](#CVE-2022-1097)

Reporter
Randell Jesup
Impact
high
##### Description

`NSSToken` objects were referenced via direct points, and could have been accessed in an unsafe way on different threads, leading to a use-after-free and potentially exploitable crash.

##### References

* [Bug 1745667](https://bugzilla.mozilla.org/show_bug.cgi?id=1745667)

#### [#CVE-2022-28281: Out of bounds write due to unexpected WebAuthN Extensions](#CVE-2022-28281)

Reporter
Axel '0vercl0k' Souchet
Impact
high
##### Description

If a compromised content process sent an unexpected number of WebAuthN Extensions in a Register command to the parent process, an out of bounds write would have occurred leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1755621](https://bugzilla.mozilla.org/show_bug.cgi?id=1755621)

#### [#CVE-2022-1197: OpenPGP revocation information was ignored](#CVE-2022-1197)

Reporter
Thunderbird user Johannes König
Impact
moderate
##### Description

When importing a revoked key that specified key compromise as the revocation reason, Thunderbird did not update the existing copy of the key that was not yet revoked, and the existing key was kept as non-revoked. Revocation statements that used another revocation reason, or that didn't specify a revocation reason, were unaffected.

##### References

* [Bug 1754985](https://bugzilla.mozilla.org/show_bug.cgi?id=1754985)

#### [#CVE-2022-1196: Use-after-free after VR Process destruction](#CVE-2022-1196)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
moderate
##### Description

After a VR Process is destroyed, a reference to it may have been retained and used, leading to a use-after-free and potentially exploitable crash.

##### References

* [Bug 1750679](https://bugzilla.mozilla.org/show_bug.cgi?id=1750679)

#### [#CVE-2022-28282: Use-after-free in DocumentL10n::TranslateDocument](#CVE-2022-28282)

Reporter
Kirin
Impact
moderate
##### Description

By using a link with `rel="localization"` a use-after-free could have been triggered by destroying an object during JavaScript execution and then referencing the object through a freed pointer, leading to a potential exploitable crash.

##### References

* [Bug 1751609](https://bugzilla.mozilla.org/show_bug.cgi?id=1751609)

#### [#CVE-2022-28285: Incorrect AliasSet used in JIT Codegen](#CVE-2022-28285)

Reporter
Lukas Bernhard
Impact
moderate
##### Description

When generating the assembly code for `MLoadTypedArrayElementHole`, an incorrect AliasSet was used. In conjunction with another vulnerability this could have been used for an out of bounds memory read.

##### References

* [Bug 1756957](https://bugzilla.mozilla.org/show_bug.cgi?id=1756957)

#### [#CVE-2022-28286: iframe contents could be rendered outside the border](#CVE-2022-28286)

Reporter
prada960808
Impact
low
##### Description

Due to a layout change, iframe contents could have been rendered outside of its border. This could have led to user confusion or spoofing attacks.

##### References

* [Bug 1735265](https://bugzilla.mozilla.org/show_bug.cgi?id=1735265)

#### [#CVE-2022-24713: Denial of Service via complex regular expressions](#CVE-2022-24713)

Reporter
Addison Crump and Jan-Erik Rediger
Impact
low
##### Description

The rust regex crate did not properly prevent crafted regular expressions from taking an arbitrary amount of time during parsing. If an attacker was able to supply input to this crate, they could have caused a denial of service in the browser.

##### References

* [Bug 1758509](https://bugzilla.mozilla.org/show_bug.cgi?id=1758509)

#### [#CVE-2022-28289: Memory safety bugs fixed in Thunderbird 91.8](#CVE-2022-28289)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Nika Layzell, Andrew McCreight, Gabriele Svelto, and the Mozilla Fuzzing Team reported memory safety bugs present in Thunderbird 91.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1663508%2C1744525%2C1753508%2C1757476%2C1757805%2C1758549%2C1758776)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_d827746b_20250115_083657.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-14

## Security Vulnerabilities fixed in Firefox ESR 91.8

Announced
April 5, 2022
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 91.8

#### [#CVE-2022-1097: Use-after-free in NSSToken objects](#CVE-2022-1097)

Reporter
Randell Jesup
Impact
high
##### Description

`NSSToken` objects were referenced via direct points, and could have been accessed in an unsafe way on different threads, leading to a use-after-free and potentially exploitable crash.

##### References

* [Bug 1745667](https://bugzilla.mozilla.org/show_bug.cgi?id=1745667)

#### [#CVE-2022-28281: Out of bounds write due to unexpected WebAuthN Extensions](#CVE-2022-28281)

Reporter
Axel '0vercl0k' Souchet
Impact
high
##### Description

If a compromised content process sent an unexpected number of WebAuthN Extensions in a Register command to the parent process, an out of bounds write would have occurred leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1755621](https://bugzilla.mozilla.org/show_bug.cgi?id=1755621)

#### [#CVE-2022-1196: Use-after-free after VR Process destruction](#CVE-2022-1196)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
moderate
##### Description

After a VR Process is destroyed, a reference to it may have been retained and used, leading to a use-after-free and potentially exploitable crash.

##### References

* [Bug 1750679](https://bugzilla.mozilla.org/show_bug.cgi?id=1750679)

#### [#CVE-2022-28282: Use-after-free in DocumentL10n::TranslateDocument](#CVE-2022-28282)

Reporter
Kirin
Impact
moderate
##### Description

By using a link with `rel="localization"` a use-after-free could have been triggered by destroying an object during JavaScript execution and then referencing the object through a freed pointer, leading to a potential exploitable crash.

##### References

* [Bug 1751609](https://bugzilla.mozilla.org/show_bug.cgi?id=1751609)

#### [#CVE-2022-28285: Incorrect AliasSet used in JIT Codegen](#CVE-2022-28285)

Reporter
Lukas Bernhard
Impact
moderate
##### Description

When generating the assembly code for `MLoadTypedArrayElementHole`, an incorrect AliasSet was used. In conjunction with another vulnerability this could have been used for an out of bounds memory read.

##### References

* [Bug 1756957](https://bugzilla.mozilla.org/show_bug.cgi?id=1756957)

#### [#CVE-2022-28286: iframe contents could be rendered outside the border](#CVE-2022-28286)

Reporter
prada960808
Impact
low
##### Description

Due to a layout change, iframe contents could have been rendered outside of its border. This could have led to user confusion or spoofing attacks.

##### References

* [Bug 1735265](https://bugzilla.mozilla.org/show_bug.cgi?id=1735265)

#### [#CVE-2022-24713: Denial of Service via complex regular expressions](#CVE-2022-24713)

Reporter
Addison Crump and Jan-Erik Rediger
Impact
low
##### Description

The rust regex crate did not properly prevent crafted regular expressions from taking an arbitrary amount of time during parsing. If an attacker was able to supply input to this crate, they could have caused a denial of service in the browser.

##### References

* [Bug 1758509](https://bugzilla.mozilla.org/show_bug.cgi?id=1758509)

#### [#CVE-2022-28289: Memory safety bugs fixed in Firefox 99 and Firefox ESR 91.8](#CVE-2022-28289)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Nika Layzell, Andrew McCreight, Gabriele Svelto, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 98 and Firefox ESR 91.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 99 and Firefox ESR 91.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1663508%2C1744525%2C1753508%2C1757476%2C1757805%2C1758549%2C1758776)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_a2b5a920_20250115_083656.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1750679)
* [XML](/show_bug.cgi?ctype=xml&id=1750679)

Closed
[Bug 1750679](/show_bug.cgi?id=1750679)
(CVE-2022-1196)

Opened 3 years ago
Closed 3 years ago

# heap-use-after-free of VRProcessParent

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

heap-use-after-free of VRProcessParent

## Categories

### (Core :: WebVR, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=WebVR#WebVR)

WebVR
▾

Core :: WebVR
Bugs with the WebVR functionality, including devices, graphics and integration
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=WebVR&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=WebVR&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=WebVR)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

98 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | [99+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=99%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) |
| firefox96 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix) |
| firefox97 | --- | [disabled](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=disabled) |
| firefox98 | [+](/buglist.cgi?f1=cf_tracking_firefox98&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr91 | 99+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox96 |  | wontfix |
| firefox97 |  | disabled |
| firefox98 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bo13oy, Assigned: jld)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/84498180dcf721a7f90d287ce37eec9d?d=mm&size=40)  [bo13oy](/user_profile?user_id=652881)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1750902](/show_bug.cgi?id=1750902 "RESOLVED FIXED - Disable WebVR by default")

Dependency [tree](/showdependencytree.cgi?id=1750679&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1750679)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1758812](/show_bug.cgi?id=1758812 "RESOLVED DUPLICATE - Ensure that WebVR attack surface isn't exposed over IPC when dom.vr.enabled is false"), [1758549](/show_bug.cgi?id=1758549 "RESOLVED FIXED - Prevent the creation of WebVR IPDL actors when WebVR is disabled")

## Details

### (5 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-esr91.8+][adv-main98+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-1196

[Keywords:](/describekeywords.cgi)

[csectype-race](/buglist.cgi?keywords=csectype-race&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][adv-esr91.8+][adv-main98+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1867761_1689 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [mboldan](/user_profile?user_id=551058) | [qe-verify](#a1848837_551058 "3 years ago") | - |
| --- | --- | --- |
| [mboldan](/user_profile?user_id=551058) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Bug 1750679.](/attachment.cgi?id=9261368)  [3 years ago](#c6)  [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-esr91+](#c15 "3 years ago") | [Details](/attachment.cgi?id=9261368&action=edit) | [Review](/attachment.cgi?id=9261368) |
| --- | --- | --- |
| [advisory.txt](/attachment.cgi?id=9270247)  [3 years ago](#c17)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   221 bytes, text/plain |  | [Details](/attachment.cgi?id=9270247&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | Multiple Authors |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1750679#c0)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1750679&comment_id=15737419 "1 revision") |
|  | |

Tested Version: Window 10 Pro 20H2 x64 memory 32G + win64-fuzzing-asan-opt(96.0.2)

There is no way to reproduce the vulnerability, temporarily can not provide poc samples,I feel that this is a conditional competition vulnerability，The conditions for triggering this vulnerability are demanding,the crash report is as follows:

```
=================================================================
==21636==ERROR: AddressSanitizer: heap-use-after-free on address 0x1254e68ea0b0 at pc 0x7fff352febc2 bp 0x00db761fc6a0 sp 0x00db761fc6e8
READ of size 8 at 0x1254e68ea0b0 thread T0
    #0 0x7fff352febc1 in mozilla::gfx::VRProcessParent::InitAfterConnect /builds/worker/checkouts/gecko/gfx/vr/ipc/VRProcessParent.cpp:165
    #1 0x7fff3360613d in mozilla::ipc::TaskFactory<mozilla::net::SocketProcessHost>::TaskWrapper<mozilla::ipc::TaskFactory<mozilla::net::SocketProcessHost>::RunnableMethod<void (mozilla::net::SocketProcessHost::*)(),Tuple0> >::Run /builds/worker/workspace/obj-build/dist/include/mozilla/ipc/TaskFactory.h:37
    #2 0x7fff324c3c5e in mozilla::RunnableTask::Run /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:468
    #3 0x7fff3247dc88 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:771
    #4 0x7fff3247a62c in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:607
    #5 0x7fff3247aff4 in mozilla::TaskController::ProcessPendingMTTask /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:391
    #6 0x7fff324ca6a1 in mozilla::detail::RunnableFunction<`lambda at /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:124:7'>::Run /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:531
    #7 0x7fff324a66d4 in nsThread::ProcessNextEvent /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1195
    #8 0x7fff324b6b3c in NS_ProcessNextEvent /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:467
    #9 0x7fff338c823d in mozilla::ipc::MessagePump::Run /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:85
    #10 0x7fff337e12d5 in MessageLoop::RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324
    #11 0x7fff337e10a5 in MessageLoop::Run /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:306
    #12 0x7fff3b367e1a in nsBaseAppShell::Run /builds/worker/checkouts/gecko/widget/nsBaseAppShell.cpp:137
    #13 0x7fff3b554d6a in nsAppShell::Run /builds/worker/checkouts/gecko/widget/windows/nsAppShell.cpp:603
    #14 0x7fff3f3bb68b in nsAppStartup::Run /builds/worker/checkouts/gecko/toolkit/components/startup/nsAppStartup.cpp:295
    #15 0x7fff3f66f01c in XREMain::XRE_mainRun /builds/worker/checkouts/gecko/toolkit/xre/nsAppRunner.cpp:5317
    #16 0x7fff3f67518e in XREMain::XRE_main /builds/worker/checkouts/gecko/toolkit/xre/nsAppRunner.cpp:5502
    #17 0x7fff3f67640a in XRE_main /builds/worker/checkouts/gecko/toolkit/xre/nsAppRunner.cpp:5561
    #18 0x7ff7523e2588 in NS_internal_main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:395
    #19 0x7ff7523e17ad in wmain /builds/worker/checkouts/gecko/toolkit/xre/nsWindowsWMain.cpp:147
    #20 0x7ff7524dca27 in __scrt_common_main_seh d:\agent\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:288
    #21 0x7fff8bc37033 in BaseThreadInitThunk+0x13 (C:\WINDOWS\System32\KERNEL32.DLL+0x180017033)
    #22 0x7fff8d002650 in RtlUserThreadStart+0x20 (C:\WINDOWS\SYSTEM32\ntdll.dll+0x180052650)

0x1254e68ea0b0 is located 560 bytes inside of 584-byte region [0x1254e68e9e80,0x1254e68ea0c8)
freed by thread T5 here:
    #0 0x7fff58067cdb in free Z:\task_163722766350223\fetches\llvm-project\llvm\projects\compiler-rt\lib\asan\asan_malloc_win.cpp:82
    #1 0x7fff352ff30c in mozilla::gfx::VRProcessParent::~VRProcessParent /builds/worker/checkouts/gecko/gfx/vr/ipc/VRProcessParent.cpp:45
    #2 0x7fff33891303 in mozilla::MozPromise<void *,mozilla::ipc::LaunchError,0>::ThenValue<`lambda at /builds/worker/checkouts/gecko/ipc/glue/GeckoChildProcessHost.cpp:487:19'>::DoResolveOrRejectInternal /builds/worker/workspace/obj-build/dist/include/mozilla/MozPromise.h:914
    #3 0x7fff3190552e in mozilla::MozPromise<bool,nsresult,1>::ThenValueBase::ResolveOrRejectRunnable::Run /builds/worker/workspace/obj-build/dist/include/mozilla/MozPromise.h:487
    #4 0x7fff337e2ab4 in MessageLoop::DeferOrRunPendingTask /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:463
    #5 0x7fff337e4120 in MessageLoop::DoWork /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:538
    #6 0x7fff337b537b in base::MessagePumpForIO::DoRunLoop /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_pump_win.cc:419
    #7 0x7fff337b6198 in base::MessagePumpWin::Run /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_pump_win.h:79
    #8 0x7fff337e12d5 in MessageLoop::RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324
    #9 0x7fff337f1f9e in base::Thread::ThreadMain /builds/worker/checkouts/gecko/ipc/chromium/src/base/thread.cc:187
    #10 0x7fff337b77d6 in `anonymous namespace'::ThreadFunc /builds/worker/checkouts/gecko/ipc/chromium/src/base/platform_thread_win.cc:19
    #11 0x7fff58072273 in __asan::AsanThread::ThreadStart Z:\task_163722766350223\fetches\llvm-project\llvm\projects\compiler-rt\lib\asan\asan_thread.cpp:278
    #12 0x7fff8bc37033 in BaseThreadInitThunk+0x13 (C:\WINDOWS\System32\KERNEL32.DLL+0x180017033)
    #13 0x7fff66783817 in patched_BaseThreadInitThunk /builds/worker/checkouts/gecko/toolkit/xre/dllservices/mozglue/WindowsDllBlocklist.cpp:570
    #14 0x7fff8d002650 in RtlUserThreadStart+0x20 (C:\WINDOWS\SYSTEM32\ntdll.dll+0x180052650)

previously allocated by thread T0 here:
    #0 0x7fff58067deb in malloc Z:\task_163722766350223\fetches\llvm-project\llvm\projects\compiler-rt\lib\asan\asan_malloc_win.cpp:98
    #1 0x7fff6667134d in moz_xmalloc /builds/worker/checkouts/gecko/memory/mozalloc/mozalloc.cpp:52
    #2 0x7fff352fc9a0 in mozilla::gfx::VRProcessManager::LaunchVRProcess /builds/worker/checkouts/gecko/gfx/vr/ipc/VRProcessManager.cpp:67
    #3 0x7fff3529d926 in mozilla::gfx::GPUChild::RecvCreateVRProcess /builds/worker/checkouts/gecko/gfx/ipc/GPUChild.cpp:147
    #4 0x7fff33c694f7 in mozilla::gfx::PGPUChild::OnMessageReceived /builds/worker/workspace/obj-build/ipc/ipdl/PGPUChild.cpp:1253
    #5 0x7fff338becf4 in mozilla::ipc::MessageChannel::DispatchAsyncMessage /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:2043
    #6 0x7fff338bb160 in mozilla::ipc::MessageChannel::DispatchMessage /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1968
    #7 0x7fff338bcf37 in mozilla::ipc::MessageChannel::RunMessage /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1827
    #8 0x7fff338bd4e8 in mozilla::ipc::MessageChannel::MessageTask::Run /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1855
    #9 0x7fff324c3c5e in mozilla::RunnableTask::Run /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:468
    #10 0x7fff3247dc88 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:771
    #11 0x7fff3247a62c in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:607
    #12 0x7fff3247aff4 in mozilla::TaskController::ProcessPendingMTTask /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:391
    #13 0x7fff324ca6a1 in mozilla::detail::RunnableFunction<`lambda at /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:124:7'>::Run /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.h:531
    #14 0x7fff324a66d4 in nsThread::ProcessNextEvent /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1195
    #15 0x7fff324b6b3c in NS_ProcessNextEvent /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:467
    #16 0x7fff338c823d in mozilla::ipc::MessagePump::Run /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:85
    #17 0x7fff337e12d5 in MessageLoop::RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:324

Thread T5 created by T0 here:
    #0 0x7fff580731d2 in __asan_wrap_CreateThread Z:\task_163722766350223\fetches\llvm-project\llvm\projects\compiler-rt\lib\asan\asan_win.cpp:146
    #1 0x7fff337b776c in PlatformThread::Create /builds/worker/checkouts/gecko/ipc/chromium/src/base/platform_thread_win.cc:57
    #2 0x7fff337f15bc in base::Thread::StartWithOptions /builds/worker/checkouts/gecko/ipc/chromium/src/base/thread.cc:93
    #3 0x7fff3253aa6a in NS_InitXPCOM /builds/worker/checkouts/gecko/xpcom/build/XPCOMInit.cpp:318
    #4 0x7fff3f650270 in ScopedXPCOMStartup::Initialize /builds/worker/checkouts/gecko/toolkit/xre/nsAppRunner.cpp:1731
    #5 0x7fff3f67516f in XREMain::XRE_main /builds/worker/checkouts/gecko/toolkit/xre/nsAppRunner.cpp:5498
    #6 0x7fff3f67640a in XRE_main /builds/worker/checkouts/gecko/toolkit/xre/nsAppRunner.cpp:5561
    #7 0x7ff7523e2588 in NS_internal_main /builds/worker/checkouts/gecko/browser/app/nsBrowserApp.cpp:395
    #8 0x7ff7523e17ad in wmain /builds/worker/checkouts/gecko/toolkit/xre/nsWindowsWMain.cpp:147
    #9 0x7ff7524dca27 in __scrt_common_main_seh d:\agent\_work\1\s\src\vctools\crt\vcstartup\src\startup\exe_common.inl:288
    #10 0x7fff8bc37033 in BaseThreadInitThunk+0x13 (C:\WINDOWS\System32\KERNEL32.DLL+0x180017033)
    #11 0x7fff8d002650 in RtlUserThreadStart+0x20 (C:\WINDOWS\SYSTEM32\ntdll.dll+0x180052650)

SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/checkouts/gecko/gfx/vr/ipc/VRProcessParent.cpp:165 in mozilla::gfx::VRProcessParent::InitAfterConnect
Shadow bytes around the buggy address:
  0x04738311d3c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x04738311d3d0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x04738311d3e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x04738311d3f0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x04738311d400: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
=>0x04738311d410: fd fd fd fd fd fd[fd]fd fd fa fa fa fa fa fa fa
  0x04738311d420: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x04738311d430: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x04738311d440: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x04738311d450: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x04738311d460: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==21636==ABORTING

```

This vuln is discovered by bo13oy of Cyber Kunlun Lab.

Thanks.

Flags: sec-bounty?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a20971_159069)• 3 years ago |

Group: firefox-core-security → gfx-core-securityComponent: Security → WebVRProduct: Firefox → Core

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1750679#c1)• 3 years ago |
|  | |

From skimming the stacks, it looks like starting the VR process failed, causing us to destroy a VRProcessParent, but then later we touch the VR process parent anyways. I see some SocketProcessHost in the stack, too, so maybe the socket process is involved somehow? Jed, given that we don't have anybody actively working on VR and this seems to be mostly about a process launch issue, maybe you could take a look? Thanks.

Flags: needinfo?(jld)Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---)

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1750679#c2)• 3 years ago |
|  | |

I don't think that's actually the socket process — that frame looks like some kind of runnable wrapper trampoline, so probably simple enough to be identical-code-folded. Some preliminary observations:

The [location of the bad use](https://searchfox.org/mozilla-release/rev/d2f7af809f5f9e9724de682537870511c8e7fa98/gfx/vr/ipc/VRProcessParent.cpp#165) is interesting: to reach that point `aSucceeded` must be true (meaning the launch worked), and it's also not the first access to `*this`, but note that the object is used on the main thread and freed on the IPC I/O thread (i.e., this is probably a race). Specifically, from the lack of other things on the stack above `InitAfterConnect`, it looks like the use was via `VRProcessParent::OnChannelConnectedTask`.

It's harder to see what's going on with the free, but `MozPromise<void *,mozilla::ipc::LaunchError,0>` is `ProcessHandlePromise`, and the demangled symbol name has the source location for the lambda (which is nice and I don't think we have that on Unix?): [the `delete this` in `GeckoChildProcessHost::Destroy`](https://searchfox.org/mozilla-release/rev/d2f7af809f5f9e9724de682537870511c8e7fa98/ipc/glue/GeckoChildProcessHost.cpp#487). That's from `VRProcessParent::DestroyProcess`, which has several call chains that can reach it.

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a65801_462836)• 3 years ago |

Flags: needinfo?(jld)Keywords: [csectype-race](/buglist.cgi?keywords=csectype-race&resolution=---)

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1750679#c3)• 3 years ago |
|  | |

Part of the problem here seems to be `TaskFactory`, which dates back to the original Chromium IPC import in 2009. If I'm reading it right, it uses `RevocableStore` to check that the `TaskFactory` (in this case, owned by the `VRProcessParent`) hasn't been destroyed before executing the runnable. But there's nothing to prevent the destruction happening after the `Run` method has already been entered (i.e., `RevokeAll` just sets a flag; it has no facility for observing that runnables are running, let alone blocking until they complete).

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a150077_1689)• 3 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1750679#c4)• 3 years ago |
|  | |

There's a similar pattern in the GPU process, but we [revoke any tasks](https://searchfox.org/mozilla-release/rev/7054d7b3b98eadb62d3e4ffe399ccfb93ac4fe4c/gfx/ipc/GPUProcessHost.cpp#243) on the main thread and return to the event loop before calling `Destroy`, and the task factory is used only to send runnables to the main thread. So that should be safe (assuming the runnables in question don't spin a nested event loop, but I don't think they do). The problem for the VR process is that the `RevokeAll` is too late and on the wrong thread, but if we change `VRProcessParent::DestroyProcess` to look more like `GPUProcessHost::DestroyProcess` then that should fix this.

As far as a test case / STR: I think if the child process crashes immediately after connecting the IPC channel, that will set up the situation where this can happen, but it's still going to be timing-sensitive.

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1750679#c5)• 3 years ago |
|  | |

(In reply to Jed Davis [:jld] ⟨⏰|UTC-7⟩ ⟦he/him⟧ from [comment #4](/show_bug.cgi?id=1750679#c4 "RESOLVED FIXED - heap-use-after-free of VRProcessParent"))

> As far as a test case / STR: I think if the child process crashes immediately after connecting the IPC channel, that will set up the situation where this can happen, but it's still going to be timing-sensitive.

On further inspection, no: I think it has to be a deliberate shutdown from the parent side, either via [this branch in `OnChannelClosed`](https://searchfox.org/mozilla-central/rev/aecfc48870599adb0ffc077dd11e6e2d99820d38/gfx/vr/ipc/VRProcessParent.cpp#228-230) or [the `!mVRChild` case in the `Shutdown` method](https://searchfox.org/mozilla-central/rev/aecfc48870599adb0ffc077dd11e6e2d99820d38/gfx/vr/ipc/VRProcessParent.cpp#107,131). So, maybe something like starting to use WebVR and then immediately closing the window / destroying the frame.

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1750679#c6)• 3 years ago |
|  | |

Attached file
[Bug 1750679.](attachment.cgi?id=9261368)
— [Details](attachment.cgi?id=9261368&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a936742_600971)• 3 years ago |

Assignee: nobody → jldStatus: NEW → ASSIGNED

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1750679#c7)• 3 years ago |
|  | |

Have you been able to find a test case for this? Alternately, if this is something that reproduces randomly during testing, is it possible to see if the attached patch (D137359) fixes it?

Flags: needinfo?(bo13oy)

|  | [bo13oy](/user_profile?user_id=652881)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1750679#c8)• 3 years ago |
|  | |

The condition of trigger is too picky, i am not capable to provide test case, so far as i see the fixed patch is available, but i am not familiar with this part. Just for your information.

Flags: needinfo?(bo13oy)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1750679#c9)• 3 years ago |
|  | |

The severity field is not set for this bug.

:jimm, could you have a look please?

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#workflow.2Fno_severity.py).

Flags: needinfo?(jmathies)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1750679#c10)• 3 years ago |
|  | |

WebVR has been disabled by default in [bug 1750902](/show_bug.cgi?id=1750902 "RESOLVED FIXED - Disable WebVR by default") (filed after this issue), which should also effectively address this issue.

Blocks: [1750902](/show_bug.cgi?id=1750902 "RESOLVED FIXED - Disable WebVR by default")
[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix)
[status-firefox97](/buglist.cgi?f1=cf_status_firefox97&o1=isnotempty):
--- → [disabled](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=disabled)
[status-firefox98](/buglist.cgi?f1=cf_status_firefox98&o1=isnotempty):
--- → [disabled](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=disabled)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [disabled](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=disabled)Summary: heap-use-after-free of VRProcessParent → heap-use-after-free of VRProcessParent

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1750679#c11)• 3 years ago |
|  | |

r=nika

<https://hg.mozilla.org/integration/autoland/rev/5333329a0f2abf6249576071ca78651e4b6a5b8f>

<https://hg.mozilla.org/mozilla-central/rev/5333329a0f2a>

Group: gfx-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years agoResolution: --- → FIXEDTarget Milestone: --- → 98 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a1804550_75935)• 3 years ago |

[status-firefox98](/buglist.cgi?f1=cf_status_firefox98&o1=isnotempty):
[disabled](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=disabled) → [fixed](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=fixed)Flags: needinfo?(jmathies)

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a1848837_551058)• 3 years ago |

Flags: qe-verify-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a1867761_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1750679#c12)• 3 years ago |
|  | |

Comment on [attachment 9261368](/attachment.cgi?id=9261368 "Bug 1750679.") [[details]](/attachment.cgi?id=9261368&action=edit "Bug 1750679.")

[Bug 1750679](/show_bug.cgi?id=1750679 "RESOLVED FIXED - heap-use-after-free of VRProcessParent").

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: sec-moderate and very low risk (see below)
* **User impact if declined**: Possible exposure to a use-after-free bug — WebVR was preffed off on ESR91 in [bug 1750902](/show_bug.cgi?id=1750902 "RESOLVED FIXED - Disable WebVR by default"), but I'm not as sure as I'd like to be that a compromised content process couldn't cause the VR process to be spawned anyway (i.e., I'm concerned that there might not be checks of the pref in a trusted process on all paths).
* **Fix Landed on Version**: 98
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: There should be essentially no risk: the pref exposing this feature is turned off, so this code shouldn't be reachable in normal operation (unless it's changed in about:config, but we warn people not to do that).
[Attachment #9261368](/attachment.cgi?id=9261368&action=edit "Bug 1750679.") -
Flags: approval-mozilla-esr91?

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a4392969_462836)• 3 years ago |

See Also: → [1758812](/show_bug.cgi?id=1758812 "RESOLVED DUPLICATE - Ensure that WebVR attack surface isn't exposed over IPC when dom.vr.enabled is false")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1750679#c13)• 3 years ago |
|  | |

Seems like a good fix to take in the upcoming 91.7.1esr build along with the WebGPU follow-up. Thanks for raising this.

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[disabled](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=disabled) → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [98+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=98%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1750679#c14)• 3 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #13](/show_bug.cgi?id=1750679#c13 "RESOLVED FIXED - heap-use-after-free of VRProcessParent"))

> Seems like a good fix to take in the upcoming 91.7.1esr build along with the WebGPU follow-up. Thanks for raising this.

This missed the 91.7.1esr release unfortunately. Retargeting 91.8esr instead.

[tracking-firefox98](/buglist.cgi?f1=cf_tracking_firefox98&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox98&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
[98+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=98%2B) → [99+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=99%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1750679#c15)• 3 years ago |
|  | |

Comment on [attachment 9261368](/attachment.cgi?id=9261368 "Bug 1750679.") [[details]](/attachment.cgi?id=9261368&action=edit "Bug 1750679.")

[Bug 1750679](/show_bug.cgi?id=1750679 "RESOLVED FIXED - heap-use-after-free of VRProcessParent").

Approved for 91.8esr.

[Attachment #9261368](/attachment.cgi?id=9261368&action=edit "Bug 1750679.") -
Flags: approval-mozilla-esr91? → approval-mozilla-esr91+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1750679#c16)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr91/rev/deee1b71ae35>

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1750679#c17)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9270247)
— [Details](attachment.cgi?id=9270247&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a6259815_578488)• 3 years ago |

Alias: CVE-2022-1196

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a6259920_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][adv-esr91.8+][adv-main98+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a8775454_1689)• 3 years ago |

See Also: → [1758549](/show_bug.cgi?id=1758549 "RESOLVED FIXED - Prevent the creation of WebVR IPDL actors when WebVR is disabled")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a19183460_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1750679#a74610878_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1750679&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


