=== Content from gitlab.com_9f596f23_20250114_224737.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-1124.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-1124.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-1124.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-1124.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  May 09, 2022

  [338f5fd0](/gitlab-org/cves/-/commit/338f5fd0b88d61ab6e44934e17f8d2895c44788d)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/338f5fd0b88d61ab6e44934e17f8d2895c44788d)
  ·
  338f5fd0

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 09, 2022

  338f5fd0

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/338f5fd0b88d61ab6e44934e17f8d2895c44788d)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 09, 2022

Loading



=== Content from gitlab.com_cc1f4611_20250114_224738.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Guest project member can access log of jobs with enabled debug logging

**[HackerOne report #1113405](https://hackerone.com/reports/1113405)** by `jimeno` on 2021-02-28, assigned to [@ngeorge1](/ngeorge1 "Nikhil George"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Guest project member can access log of jobs with enabled debugging after some, presumably, caching period. Official [documentation](https://docs.gitlab.com/ee/user/permissions.html) says they can't.

[![permissions_doc.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/3c9b28afc7807646f97699e54da0997f3b361d1e/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61333034303431322d386539352d346665342d383634312d3565636361313336313234372f7065726d697373696f6e735f646f632e706e67)

GitLab official [docs](https://docs.gitlab.com/ee/ci/variables/README.html#restricted-access-to-debug-logging) say:

> With restricted access to debug logging, only users with developer or higher permissions can view job logs when debug logging is enabled with a variable in:
>
> * The .gitlab-ci.yml file.
> * The CI/CD variables set within the GitLab UI.

They provide an [example](https://docs.gitlab.com/ee/ci/variables/README.html#enable-debug-logging) of enabling the debug mode too.

> To enable debug logs (traces), set the CI\_DEBUG\_TRACE variable to true:

```
job_name:
  variables:
    CI_DEBUG_TRACE: "true"
```

I decided to test caching mechanisms in GitLab after reading [#289944 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/289944 "Remote hacker can download all the files of master branch in public projects where everything is members only."), which is another caching bug at GitLab that was rewarded and fixed.

##### Steps to reproduce

1. As userA (victim) create a project and enable GitLab CI for it by adding the following YAML file to it.

   ```
   image: alpine:latest

   variables:
     FOO: bar

   stages:
     - test

   dummy:
     variables:
       CI_DEBUG_TRACE: "true"
     stage: test
     script:
       - echo "${FOO}"
   ```
2. Invite userB (attacker) to your project with Guest role.

   [![project_members.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/1b9e76a88cc2e454bf39a07c9d64c9b205ce0d33/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f33326638313266342d306332302d343232332d396230652d3832386634373739396330312f70726f6a6563745f6d656d626572732e706e67)
3. As your victim user, browse to the [GraphQL explorer](https://gitlab.com/-/graphql-explorer) and run the following query in order to find the Job ID. Please note we are only doing this step to find job's ID. In a real world scenario, attacker could omit this step by bruteforcing it (incremental, decimal number). Please, remember to replace `fullPath` with yours (`project_author/project_name`).

   ```
   query infogathering {
     project(fullPath:"naaytesting2/proje") {
       pipelines {
         edges {
           node {
             id
             stages {
               edges {
                 node {
                   name
                   groups {
                     edges {
                       node {
                         name
                         jobs {
                           edges {
                             node {
                               name
                               detailedStatus {
                                 detailsPath
                               }
                             }
                           }
                         }
                       }
                     }
                   }
                 }
               }
             }
           }
         }
       }
     }
   }
   ```
4. Grab the Job ID from the `detailsPath` value in the response. In my case it looks like `/naaytesting2/proje/-/jobs/1061991036` --> `1061991036`.
5. Wait for at least 2 minutes. As your attacker user, build the final attack URL by replacing the placeholders in this URL: `https://gitlab.com/AUTHOR/PROJECTNAME/-/jobs/JOBID/artifacts/download?file_type=trace`. In my case, the final URL looked like `https://gitlab.com/naaytesting2/proja/-/jobs/1061991036/artifacts/download?file_type=trace`.
6. Download and open the `job.log` file.
7. If victim tries to browse to the job directly, for example at `https://gitlab.com/naaytesting2/proje/-/jobs/1062011620` they get an insufficient permissions error.

   [redacted]

##### Impact

Roles aren't respected when accessing jobs with debug logging enabled.

##### Examples

Attached you will find a test repository. However, I don't think this is helpful.

##### What is the current *bug* behavior?

Roles aren't respected and Guest members can access jobs they aren't supposed to access.

##### What is the expected *correct* behavior?

Guest and Reporter members get a 403/404 response when trying to access jobs they aren't supposed to access.

##### Relevant logs and/or screenshots

Please, find a detailed step by step reproduction attached to this report.

[redacted]

##### Output of checks

This bug happens on GitLab.com

###### Results of GitLab environment info

N/A. Tests performed 2020/02/28 19:00-20:30 Madrid time.

#### Impact

Roles aren't respected when accessing jobs with debug logging enabled.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [redacted]
* [project\_members.png](https://h1.sec.gitlab.net/a/32f812f4-0c20-4223-9b0e-828f47799c01/project_members.png)
* [permissions\_doc.png](https://h1.sec.gitlab.net/a/a3040412-8e95-4fe4-8641-5ecca1361247/permissions_doc.png)
* [redacted]

# Technical proposal

`Projects::ArtifactsController#download` only checks the `read_build` policy to determine whether a user has access. When `file_type` is `trace` and `build.debug_mode?`, `#download` should additionally apply the `read_build_trace` policy

Edited Jan 03, 2023 by [Nikhil George](/ngeorge1)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


