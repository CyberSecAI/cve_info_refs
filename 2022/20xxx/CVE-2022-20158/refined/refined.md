```
{
  "vulnerability": {
    "root_cause": "A use-after-free vulnerability occurs in the `bdi_unregister()` function due to a race condition where the `blk_cleanup_queue()` function puts the final reference to the bdi, and `release_bdi()` frees it, while `del_gendisk()` calls `bdi_unregister()` after the free.",
    "weaknesses": [
      "Use-after-free",
      "Race condition",
      "Lack of locking"
    ],
    "impact": "Kernel panic leading to denial of service.",
    "attack_vectors": "The vulnerability is triggered within the kernel's block device handling code when a block device is unregistered.",
    "required_capabilities": "The attacker needs to trigger the unregistration of a block device to cause the race condition to occur."
  },
  "fixes": [
    {
      "commit": "https://android.googlesource.com/kernel/common/+/69e8f03c5ced3e4e6fb4181f4dac185104e3420b",
      "description": "Backing-dev: Take a reference to the bdi in use to prevent UAF",
      "details": "This patch takes a reference to the bdi in use to prevent use-after-free. It fixes a KASAN report due to a dereference of a previously freed pointer to `struct backing_dev_info` in `bdi_unregister()`."
    },
    {
        "commit": "https://android.googlesource.com/kernel/common/+/e495ba7982d9bfc2dfb65f9bd87b2ce7fd64944d",
        "description": "fs: explicitly unregister per-superblock BDIs",
        "details": "This commit adds a new SB_I_ flag to mark superblocks that have an ephemeral bdi associated with them and unregister it when the superblock is shut down."
    }
  ],
    "add_info": "The provided content includes commit messages and a KASAN report which give details on the nature of the vulnerability and the fix implemented. The commits address the use-after-free by properly handling references to the block device and also explicitly unregistering per-superblock BDIs."
}
```