=== Content from gitlab.com_abd511c9_20250114_190741.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-3572.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-3572.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-3572.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-3572.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Jan 20, 2023

  [8e57563a](/gitlab-org/cves/-/commit/8e57563a7c8f2f0ec2d7c2a031e6a348ecaa05d4)
  [Publishing 0 updated advisories and 2 new advisories](/gitlab-org/cves/-/commit/8e57563a7c8f2f0ec2d7c2a031e6a348ecaa05d4)
  繚
  8e57563a

  [ GitLab Bot ](/gitlab-bot) authored Jan 20, 2023

  8e57563a

  [Publishing 0 updated advisories and 2 new advisories](/gitlab-org/cves/-/commit/8e57563a7c8f2f0ec2d7c2a031e6a348ecaa05d4)
  [ GitLab Bot ](/gitlab-bot) authored Jan 20, 2023

Loading



=== Content from gitlab.com_51c8b08a_20250114_190742.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Cross-site scripting in Jira Integration affecting self-hosted instances without strict CSP

**[HackerOne report #1727985](https://hackerone.com/reports/1727985)** by `ryotak` on 2022-10-10, assigned to `GitLab Team`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Due to the incomplete fix for [CVE-2022-0283](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0283), an attacker can execute arbitrary JavaScript on the self-hosted instances without strict CSP.

##### Description

The following code was added to fix [CVE-2022-0283](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0283).

[`app/controllers/jira_connect/users_controller.rb` line 8-20](https://gitlab.com/gitlab-org/gitlab/-/blob/6bd4e44b8743239a83fa90a494e05242757f9324/app/controllers/jira_connect/users_controller.rb#L8-20)

```
  before_action :verify_return_to_url, only: [:show]
  [...]
  def verify_return_to_url
    return unless params[:return_to].present?

    params.delete(:return_to) unless Integrations::Jira.valid_jira_cloud_url?(params[:return_to])
  end
```

[`app/models/integrations/jira.rb` line 98-102](https://gitlab.com/gitlab-org/gitlab/-/blob/6bd4e44b8743239a83fa90a494e05242757f9324/app/models/integrations/jira.rb#L98-102)

```
    def self.valid_jira_cloud_url?(url)
      return false unless url.present?

      !!URI(url).hostname&.end_with?(JIRA_CLOUD_HOST)
    end
```

However, as this fix aims to prevent the open redirect rather than an XSS, it's not validating the URL's scheme, allowing the `javascript:` scheme to be specified.

##### Steps to reproduce

###### Self-hosted instance (with an alert)

1. Set up your own GitLab instance.
2. Log in to the GitLab instance.
3. Open [https://YOUR\_OWN\_INSTANCE/-/jira\_connect/users?return\_to=javascript://test.atlassian.net/%250dalert(document.domain)](https://YOUR_OWN_INSTANCE/-/jira_connect/users?return_to=javascript://test.atlassian.net/%25250dalert(document.domain))
4. Click `Return to GitLab for Jira`.
5. Confirm that `alert(document.domain)` has been executed.

###### GitLab.com (with a CSP error message)

1. Log in to GitLab.
2. Open <https://gitlab.com/-/jira_connect/users?return_to=javascript://test.atlassian.net/%250dalert(document.domain)>
3. Open DevTools.
4. Click `Return to GitLab for Jira`.
5. Confirm that CSP prevented the execution of JavaScript.

##### Examples

<https://gitlab.com/-/jira_connect/users?return_to=javascript://test.atlassian.net/%250dalert(document.domain)>

##### What is the current *bug* behavior?

`javascript:` scheme is allowed as a return URL.

##### What is the expected *correct* behavior?

Only `http` and `https` should be allowed as a scheme.

##### Relevant logs and/or screenshots

[2022-10-10\_13-02-36.mp4](https://user-content.gitlab-static.net/a8ca7203d2bf1532f83800b1a25bc4fcbd9b8772/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f31653838643033312d393131392d343836372d383937332d3835333566616332376332662f323032322d31302d31305f31332d30322d33362e6d7034 "Download '2022-10-10_13-02-36.mp4'")

###### Results of GitLab environment info

```
System information
System:         Ubuntu 20.04
Proxy:          no
Current User:   git
Using RVM:      no
Ruby Version:   2.7.5p203
Gem Version:    3.1.6
Bundler Version:2.3.15
Rake Version:   13.0.6
Redis Version:  6.2.7
Sidekiq Version:6.4.2
Go Version:     unknown

GitLab information
Version:        15.4.1-ee
Revision:       7b2ed8f038f
Directory:      /opt/gitlab/embedded/service/gitlab-rails
DB Adapter:     PostgreSQL
DB Version:     13.6
URL:            https://gl.ryotak.me
HTTP Clone URL: https://gl.ryotak.me/some-group/some-project.git
SSH Clone URL:  git@gl.ryotak.me:some-group/some-project.git
Elasticsearch:  no
Geo:            no
Using LDAP:     no
Using Omniauth: yes
Omniauth Providers:

GitLab Shell
Version:        14.10.0
Repository storage paths:
- default:      /var/opt/gitlab/git-data/repositories
GitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell
```

#### Impact

An attacker can execute arbitrary JavaScript on the victim's browser and do any actions on behalf of the user.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [2022-10-10\_13-02-36.mp4](https://h1.sec.gitlab.net/a/1e88d031-9119-4867-8973-8535fac27c2f/2022-10-10_13-02-36.mp4)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


