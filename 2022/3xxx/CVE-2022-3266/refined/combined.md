=== Content from www.mozilla.org_3921f6bb_20250114_220022.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-40

## Security Vulnerabilities fixed in Firefox 105

Announced
September 20, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 105

This advisory was updated December 13, 2022 to add CVE-2022-46880. This fix was included in the original release of Firefox 105, but did not appear in the advisory published at that time.

#### [#CVE-2022-3266: Out of bounds read when decoding H264](#CVE-2022-3266)

Reporter
Willy R. Vasquez at UT Austin
Impact
high
##### Description

An out-of-bounds read can occur when decoding H264 video. This results in a potentially exploitable crash.

##### References

* [Bug 1767360](https://bugzilla.mozilla.org/show_bug.cgi?id=1767360)

#### [#CVE-2022-40959: Bypassing FeaturePolicy restrictions on transient pages](#CVE-2022-40959)

Reporter
Armin Ebert
Impact
high
##### Description

During iframe navigation, certain pages did not have their FeaturePolicy fully initialized leading to a bypass that leaked device permissions into untrusted subdocuments.

##### References

* [Bug 1782211](https://bugzilla.mozilla.org/show_bug.cgi?id=1782211)

#### [#CVE-2022-40960: Data-race when parsing non-UTF-8 URLs in threads](#CVE-2022-40960)

Reporter
Armin Ebert
Impact
high
##### Description

Concurrent use of the URL parser with non-UTF-8 data was not thread-safe. This could lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1787633](https://bugzilla.mozilla.org/show_bug.cgi?id=1787633)

#### [#CVE-2022-46880: Use-after-free in WebGL](#CVE-2022-46880)

Reporter
Atte Kettunen
Impact
high
##### Description

A missing check related to tex units could have led to a use-after-free and potentially exploitable crash.
*Note*: This advisory was added on December 13th, 2022 after we better understood the impact of the issue. The fix was included in the original release of Firefox 105.

##### References

* [Bug 1749292](https://bugzilla.mozilla.org/show_bug.cgi?id=1749292)

#### [#CVE-2022-40958: Bypassing Secure Context restriction for cookies with \_\_Host and \_\_Secure prefix](#CVE-2022-40958)

Reporter
Axel Chong (@Haxatron)
Impact
moderate
##### Description

By injecting a cookie with certain special characters, an attacker on a shared subdomain which is not a secure context could set and thus overwrite cookies from a secure context, leading to session fixation and other attacks.

##### References

* [Bug 1779993](https://bugzilla.mozilla.org/show_bug.cgi?id=1779993)

#### [#CVE-2022-40961: Stack-buffer overflow when initializing Graphics](#CVE-2022-40961)

Reporter
Mozilla Fuzzing Team
Impact
moderate
##### Description

During startup, a graphics driver with an unexpected name could lead to a stack-buffer overflow causing a potentially exploitable crash.
*This issue only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1784588](https://bugzilla.mozilla.org/show_bug.cgi?id=1784588)

#### [#CVE-2022-40956: Content-Security-Policy base-uri bypass](#CVE-2022-40956)

Reporter
Satoki Tsuji
Impact
low
##### Description

When injecting an HTML base element, some requests would ignore the CSP's base-uri settings and accept the injected element's base instead.

##### References

* [Bug 1770094](https://bugzilla.mozilla.org/show_bug.cgi?id=1770094)

#### [#CVE-2022-40957: Incoherent instruction cache when building WASM on ARM64](#CVE-2022-40957)

Reporter
Gary Kwong
Impact
low
##### Description

Inconsistent data in instruction and data cache when creating wasm code could lead to a potentially exploitable crash.
*This bug only affects Firefox on ARM64 platforms.*

##### References

* [Bug 1777604](https://bugzilla.mozilla.org/show_bug.cgi?id=1777604)

#### [#CVE-2022-40962: Memory safety bugs fixed in Firefox 105 and Firefox ESR 102.3](#CVE-2022-40962)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Nika Layzell, Timothy Nikkel, Sebastian Hengst, Andreas Pehrson, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 104 and Firefox ESR 102.2. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 105 and Firefox ESR 102.3](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1776655%2C1777574%2C1784835%2C1785109%2C1786502%2C1789440)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_65e15361_20250114_220025.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-41

## Security Vulnerabilities fixed in Firefox ESR 102.3

Announced
September 20, 2022
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 102.3

#### [#CVE-2022-3266: Out of bounds read when decoding H264](#CVE-2022-3266)

Reporter
Willy R. Vasquez at UT Austin
Impact
high
##### Description

An out-of-bounds read can occur when decoding H264 video. This results in a potentially exploitable crash.

##### References

* [Bug 1767360](https://bugzilla.mozilla.org/show_bug.cgi?id=1767360)

#### [#CVE-2022-40959: Bypassing FeaturePolicy restrictions on transient pages](#CVE-2022-40959)

Reporter
Armin Ebert
Impact
high
##### Description

During iframe navigation, certain pages did not have their FeaturePolicy fully initialized leading to a bypass that leaked device permissions into untrusted subdocuments.

##### References

* [Bug 1782211](https://bugzilla.mozilla.org/show_bug.cgi?id=1782211)

#### [#CVE-2022-40960: Data-race when parsing non-UTF-8 URLs in threads](#CVE-2022-40960)

Reporter
Armin Ebert
Impact
high
##### Description

Concurrent use of the URL parser with non-UTF-8 data was not thread-safe. This could lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1787633](https://bugzilla.mozilla.org/show_bug.cgi?id=1787633)

#### [#CVE-2022-40958: Bypassing Secure Context restriction for cookies with \_\_Host and \_\_Secure prefix](#CVE-2022-40958)

Reporter
Axel Chong (@Haxatron)
Impact
moderate
##### Description

By injecting a cookie with certain special characters, an attacker on a shared subdomain which is not a secure context could set and thus overwrite cookies from a secure context, leading to session fixation and other attacks.

##### References

* [Bug 1779993](https://bugzilla.mozilla.org/show_bug.cgi?id=1779993)

#### [#CVE-2022-40956: Content-Security-Policy base-uri bypass](#CVE-2022-40956)

Reporter
Satoki Tsuji
Impact
low
##### Description

When injecting an HTML base element, some requests would ignore the CSP's base-uri settings and accept the injected element's base instead.

##### References

* [Bug 1770094](https://bugzilla.mozilla.org/show_bug.cgi?id=1770094)

#### [#CVE-2022-40957: Incoherent instruction cache when building WASM on ARM64](#CVE-2022-40957)

Reporter
Gary Kwong
Impact
low
##### Description

Inconsistent data in instruction and data cache when creating wasm code could lead to a potentially exploitable crash.
*This bug only affects Firefox on ARM64 platforms.*

##### References

* [Bug 1777604](https://bugzilla.mozilla.org/show_bug.cgi?id=1777604)

#### [#CVE-2022-40962: Memory safety bugs fixed in Firefox 105 and Firefox ESR 102.3](#CVE-2022-40962)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Nika Layzell, Timothy Nikkel, Sebastian Hengst, Andreas Pehrson, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 104 and Firefox ESR 102.2. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 105 and Firefox ESR 102.3](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1776655%2C1777574%2C1784835%2C1785109%2C1786502%2C1789440)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_6157fa28_20250114_220021.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1767360)
* [XML](/show_bug.cgi?ctype=xml&id=1767360)

Closed
[Bug 1767360](/show_bug.cgi?id=1767360)
(CVE-2022-3266)

Opened 3 years ago
Closed 2 years ago

# Crash in UpdateSubresource when playing H264

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in UpdateSubresource when playing H264

## Categories

### (Core :: Audio/Video: Playback, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Audio%2FVideo%3A%20Playback#Audio%2FVideo%3A%20Playback)

Audio/Video: Playback
▾

Core :: Audio/Video: Playback
For problems related to the HTML 5 media elements (<video> and <audio>) -- including WebM, MP4, MSE and EME issues. This would also typically include decoding problems in the codecs themselves (e.g. VP8, VP9, H.264, AAC) experienced during playback.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo%3A%20Playback&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo%3A%20Playback&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Audio%2FVideo%3A%20Playback)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Desktop

Windows

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S1

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

106 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=unaffected) |
| firefox-esr102 | [105+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=105%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=verified) |
| firefox100 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix) |
| firefox101 | [-](/buglist.cgi?f1=cf_tracking_firefox101&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=wontfix) |
| firefox102 | [+](/buglist.cgi?f1=cf_tracking_firefox102&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=wontfix) |
| firefox103 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox103&o1=equals&v1=wontfix) |
| firefox104 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox104&o1=equals&v1=wontfix) |
| firefox105 | [+](/buglist.cgi?f1=cf_tracking_firefox105&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=verified) |
| firefox106 | [+](/buglist.cgi?f1=cf_tracking_firefox106&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr91 |  | unaffected |
| firefox-esr102 | 105+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox100 |  | wontfix |
| firefox101 | - | wontfix |
| firefox102 | + | wontfix |
| firefox103 |  | wontfix |
| firefox104 |  | wontfix |
| firefox105 | + | verified |
| firefox106 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jrmuizel, Assigned: alwu)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/9f64a3c43c01820fd6be6b1ee3f326e1?d=mm&size=40)  [alwu](/user_profile?user_id=517691)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ad916833cb7747e6939d576f34df1daa?d=mm&size=40)  [jrmuizel](/user_profile?user_id=309398)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-bounds, reporter-external, sec-high, Whiteboard: [adv-main105+][adv-esr102.3+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-3266

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main105+][adv-esr102.3+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a13621786_1689 "2 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ <unknown in nvwgf2umx\_cfg.dll> | CContext::TID3D11DeviceContext\_UpdateSubresource\_<T> ]](https://crash-stats.mozilla.org/signature/?signature=%3Cunknown%20in%20nvwgf2umx_cfg.dll%3E%20%7C%20CContext%3A%3ATID3D11DeviceContext_UpdateSubresource_%3CT%3E)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (7 files)

| [vid.mp4](/attachment.cgi?id=9274739)  [3 years ago](#c1)  [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)   1.32 KB, video/mp4 |  | [Details](/attachment.cgi?id=9274739&action=edit) |
| --- | --- | --- |
| [Smaller crashing example with H264 Syntax Elements](/attachment.cgi?id=9275055)  [3 years ago](#c5)  [Willy R. Vasquez](/user_profile?user_id=705892)   5.98 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9275055&action=edit) |
| [og\_vid.zip](/attachment.cgi?id=9275060)  [3 years ago](#c6)  [Willy R. Vasquez](/user_profile?user_id=705892)   34.00 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9275060&action=edit) |
| [fuzz\_results.zip](/attachment.cgi?id=9279329)  [3 years ago](#c11)  [Willy R. Vasquez](/user_profile?user_id=705892)   110.51 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9279329&action=edit) |
| [libyuv\_crash.zip](/attachment.cgi?id=9279332)  [3 years ago](#c12)  [Willy R. Vasquez](/user_profile?user_id=705892)   2.77 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9279332&action=edit) |
| [Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.](/attachment.cgi?id=9289353)  [2 years ago](#c18)  [Alastor Wu [:alwu]](/user_profile?user_id=517691)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#c29 "2 years ago")  RyanVM : [approval-mozilla-esr102+](#c29 "2 years ago")  tjr : [sec-approval+](#c22 "2 years ago") | [Details](/attachment.cgi?id=9289353&action=edit) | [Review](/attachment.cgi?id=9289353) |
| [advisory.txt](/attachment.cgi?id=9295741)  [2 years ago](#c37)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   178 bytes, text/plain |  | [Details](/attachment.cgi?id=9295741&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1767360#c0)• 3 years ago |
|  | |

<https://crash-stats.mozilla.org/report/index/7dd89fc9-df31-4fc0-ab38-2c1f80220502>

We're trying to upload 496x1040 from a buffer that's not that big.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1767360#c1)• 3 years ago |
|  | |

Attached video
[vid.mp4](attachment.cgi?id=9274739)
— [Details](attachment.cgi?id=9274739&action=edit)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1767360#c2)• 3 years ago |
|  | |

From the reporter: "The first SPS sets a frame size of 496x1040 while the second SPS sets it to 496x32. The final output frame is the size of the first, but only drawn up to the second size. The rest of the output seems to be leaked memory."

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1767360#c3)• 3 years ago |
|  | |

I need to try playing the video a couple of times to reproduce the crash.

When I was looking at this it seemed like the IMFMediaBuffer was not large enough to fit the full 496x1040 frame.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a58442_1689)• 3 years ago |

Group: core-security → media-core-security

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a83139_309398)• 3 years ago |

Assignee: nobody → jolin

|  | [John Lin [:jhlin][:jolin]](/user_profile?user_id=463180) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1767360#c4)• 3 years ago |
|  | |

`MP4Box -info` shows different frame size:

```
...
Visual Sample Entry Info: width=144 height=82 (depth=24 bits)
Visual Track layout: x=0 y=0 width=144 height=82
MPEG-4 Config: Visual Stream - ObjectTypeIndication 0x21
AVC/H264 Video - Visual Size 144 x 82
	AVC Info: 2 SPS - 2 PPS - Profile Extended @ Level 2
...

```

For further investigation, I'll add some more logs to the demuxer and H.264 media change monitor.

|  | [Willy R. Vasquez](/user_profile?user_id=705892) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1767360#c5)• 3 years ago |
|  | |

Attached file
[Smaller crashing example with H264 Syntax Elements](attachment.cgi?id=9275055)
— [Details](attachment.cgi?id=9275055&action=edit)

I've added as an attachment a zip file containing (1) an MP4 that should lead to a crash with less refreshes; (2) the H.264 file in Annex B format contained within the MP4; (3) the list of syntax element values of the H.264 file.

|  | [Willy R. Vasquez](/user_profile?user_id=705892) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1767360#c6)• 3 years ago |
|  | |

Attached file
[og\_vid.zip](attachment.cgi?id=9275060)
— [Details](attachment.cgi?id=9275060&action=edit)

For completeness, I've also attached the original MP4 that produced the crash, along with .264 and syntax element log files.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1767360#c7)• 3 years ago |
|  | |

[comment 0](/show_bug.cgi?id=1767360#c0 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264") sounds like a read access violation, but [comment 3](/show_bug.cgi?id=1767360#c3 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264") sounds like a write violation which is potentially more exploitable.

Have you tried running this in an ASAN Nightly build?

Keywords: [csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1767360#c8)• 3 years ago |
|  | |

In [comment 3](/show_bug.cgi?id=1767360#c3 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264") I was referring to a read violation. i.e. the source buffer is smaller than the destination buffer.

|  | [Hovav Shacham](/user_profile?user_id=28795) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1767360#c9)• 3 years ago |
|  | |

Y'all, please do also see the e-mail thread that preceded this bug for context. It is plausible that the codepaths triggered by example video can be used only for DoS and memory disclosure, but I don't know that out-of-bounds writes are out of the question.

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1767360#c10)• 3 years ago |
|  | |

The severity field is not set for this bug.

:jimm, could you have a look please?

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#workflow.2Fno_severity.py).

Flags: needinfo?(jmathies)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a1352105_279663)• 3 years ago |

Severity: -- → S1
[tracking-firefox101](/buglist.cgi?f1=cf_tracking_firefox101&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox101&o1=equals&v1=%3F)
[tracking-firefox102](/buglist.cgi?f1=cf_tracking_firefox102&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox102&o1=equals&v1=%3F)Flags: needinfo?(jmathies)Priority: -- → P1

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a1441503_75935)• 3 years ago |

Crash Signature: [@ <unknown in nvwgf2umx\_cfg.dll> | CContext::TID3D11DeviceContext\_UpdateSubresource\_<T> ]
[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix)
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=wontfix)
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=%3F)
[tracking-firefox101](/buglist.cgi?f1=cf_tracking_firefox101&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox101&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox101&o1=equals&v1=-)
[tracking-firefox102](/buglist.cgi?f1=cf_tracking_firefox102&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox102&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox102&o1=equals&v1=%2B)

|  | [Willy R. Vasquez](/user_profile?user_id=705892) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1767360#c11)• 3 years ago |
|  | |

Attached file
[fuzz\_results.zip](attachment.cgi?id=9279329)
— [Details](attachment.cgi?id=9279329&action=edit)

I've attached some Grizzly fuzzing results that cause ASAN read errors.

|  | [Willy R. Vasquez](/user_profile?user_id=705892) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1767360#c12)• 3 years ago |
|  | |

Attached file
[libyuv\_crash.zip](attachment.cgi?id=9279332)
— [Details](attachment.cgi?id=9279332&action=edit)

When outputting the video output to a canvas we get the following crash in libyuv: <https://crash-stats.mozilla.org/report/index/6ee36e4d-2b70-4237-bc6f-a5f830220601>

The attached HTML file causes this crash.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1767360#c13)• 2 years ago |
|  | |

Hi John, any updates on this bug?

[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=wontfix)
[status-firefox103](/buglist.cgi?f1=cf_status_firefox103&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox103&o1=equals&v1=wontfix)
[status-firefox104](/buglist.cgi?f1=cf_status_firefox104&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox104&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)Flags: needinfo?(jolin)

|  | [John Lin [:jhlin][:jolin]](/user_profile?user_id=463180) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1767360#c14)• 2 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #13](/show_bug.cgi?id=1767360#c13 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264"))

> Hi John, any updates on this bug?

Sorry for the delay. I'm fixing an error in my patches and should be able to upload them for review later this week.

Flags: needinfo?(jolin)

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1767360#c15)• 2 years ago |
|  | |

:Jolin we only have 2 betas left in the 104 cycle, do you think this would get fixed in time or is going to ride the 105 train?

Flags: needinfo?(jolin)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1767360#c16)• 2 years ago |
|  | |

John is still working on this, currently 105 or 106 for a target.

[status-firefox105](/buglist.cgi?f1=cf_status_firefox105&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=affected)Flags: needinfo?(jolin)

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a8520317_690067)• 2 years ago |

[status-firefox104](/buglist.cgi?f1=cf_status_firefox104&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox104&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox104&o1=equals&v1=wontfix)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1767360#c17)• 2 years ago |
|  | |

NI myself for checking this bug later.

Flags: needinfo?(alwu)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1767360#c18)• 2 years ago |
|  | |

Attached file
[Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.](attachment.cgi?id=9289353)
— [Details](attachment.cgi?id=9289353&action=edit)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a8633757_517691)• 2 years ago |

Assignee: jolin → alwuFlags: needinfo?(alwu)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1767360#c19)• 2 years ago |
|  | |

Here I take the video in the [comment 5](https://bugzilla.mozilla.org/show_bug.cgi?id=1767360#c5) as an example to explain what happens.

From the SPS in the [comment 5](/show_bug.cgi?id=1767360#c5 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264"), the initial SPS indicates that the video has size [112, 416]. In the same bytestream, there is another SPS indicating the size would change to [326, 56] later. (check `pic_width_in_mbs_minus1` and `pic_height_in_map_units_minus1` and see how to calculate the width and height [here](https://searchfox.org/mozilla-central/rev/c77834ec635c523f2ba0092fcd1728c9b1c3005b/dom/media/platforms/agnostic/bytestreams/H264.h#57-70))

However, the first sample media foundation returns to us is already not fitting the initial SPS. All decoded video frames are in in the sizing of [326, 56]. But we still [construct the buffer](https://searchfox.org/mozilla-central/rev/c77834ec635c523f2ba0092fcd1728c9b1c3005b/dom/media/platforms/wmf/WMFVideoMFTManager.cpp#660-713) by using the wrong size [112, 415]. That is the reason of causing out of bound access.

---

Here are an explanation for the solution.

By using `MF_MT_FRAME_SIZE`, we can know the size of decoded frame, but that value might include the padding. Therefore, we use `GetPictureRegion()` to get the region that should be displayed without padding. Then we can use the correct size to setup the buffer to avoid the crash.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1767360#c20)• 2 years ago |
|  | |

Summary from John -

The bug is triggered by carefully crafted MP4 files. In those files, the metadata (frame width & height, to be specific) is manipulated to disagree with the actual encoded data. In our current implementation, the initial configuration of the video decoder relies on the metadata and the width and height info are saved for creating the video images used for rendering. If it doesn't match the actual decoded data, there could be buffer overrun in the GPU or RDD utility processes.

To avoid the overrun, some checks must be performed when the decoder returns output buffers. Instead of using the saved width and height values, the output images should use the width and height of the decoder output buffers. That's what my first patch does.

While I was investigating the issue, I also found that the current implementation doesn't support files that have more than one parameter sets in one metadata segment. (It took me a while to find the spec and understand the parts that are involved) To fix this, 'H264ChangeMoniter' must check for multiple SPS/PPS. Although the parser is already capable of parsing a series of parameter sets in the bitstream, we never actually check that after the metadata is converted into 'avcC' blob (called extra data in our code). My second patch (p2) adds some checking in the monitor code and extends the parser to support that.

Strictly speaking, the second patch is not mandatory to fix the crash, but it helps in making sure that we use the correct metadata for each video frame and should reduce the chances that the video is rendered incorrectly.

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1767360#c21)• 2 years ago |
|  | |

Comment on [attachment 9289353](/attachment.cgi?id=9289353 "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") [[details]](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.")

[Bug 1767360](/show_bug.cgi?id=1767360 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264") - use correct image size retrieved from the output type to create video frames buffer.

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Not easy, because this would only affect a small size (width or height <= 132) of H264 videos which have multiple different SPS and change its format during playback. Also, this is Windows only issue.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: Not sure what is the oldest version, but at least from 100
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: Current patch should be able to backport to old branches as well
* **How likely is this patch to cause regressions; how much testing does it need?**: This patch introduces a new check to detect the display size for decoded video frame. The possible risk of causing regression is for all software decoded H264 videos on Windows.

The estimated risk would be low.

In term of the check we added, that is performed by Windows Media Foundation API, which should be trustworthy because it performs the decoding task as well, which should be able to return correct size.

In term of possible files being affected, as it would only affect those software decoded H264 videos which has changed the format during the playback, that seems less common. Otherwise, we should get more crash volumes.

* **Is Android affected?**: No
[Attachment #9289353](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1767360#c22)• 2 years ago |
|  | |

Comment on [attachment 9289353](/attachment.cgi?id=9289353 "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") [[details]](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.")

[Bug 1767360](/show_bug.cgi?id=1767360 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264") - use correct image size retrieved from the output type to create video frames buffer.

Approved to land and uplift

[Attachment #9289353](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") -
Flags: sec-approval? → sec-approval+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a10015337_75935)• 2 years ago |

[status-firefox106](/buglist.cgi?f1=cf_status_firefox106&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=unaffected)
[tracking-firefox105](/buglist.cgi?f1=cf_tracking_firefox105&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox105&o1=equals&v1=%2B)
[tracking-firefox106](/buglist.cgi?f1=cf_tracking_firefox106&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox106&o1=equals&v1=%2B)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
--- → [105+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=105%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1767360#c23)• 2 years ago |
|  | |

Is this ready to land?

Flags: needinfo?(alwu)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1767360#c24)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1767360&comment_id=16047779 "1 revision") |
|  | |

Yes, it's ready.

Flags: needinfo?(alwu)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1767360#c25)• 2 years ago |
|  | |

Comment on [attachment 9289353](/attachment.cgi?id=9289353 "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") [[details]](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.")

[Bug 1767360](/show_bug.cgi?id=1767360 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264") - use correct image size retrieved from the output type to create video frames buffer.

### Beta/Release Uplift Approval Request

* **User impact if declined**: crash
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This patch introduces a new check to detect the display size for decoded video frame, and the estimated risk would be low.

In term of the check we added, that is performed by Windows Media Foundation API, which should be trustworthy because it performs the decoding task as well, which should be able to return correct size.

In term of possible files being affected, as it would only affect those software decoded H264 videos which has changed the format during the playback, that seems less common. Otherwise, we should get more crash volumes.

* **String changes made/needed**:
* **Is Android affected?**: Yes
[Attachment #9289353](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") -
Flags: approval-mozilla-beta?

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1767360#c26)• 2 years ago |
|  | |

This landed: <https://hg.mozilla.org/integration/autoland/rev/b1648cab08f03ae6a0d7e0d3a92c909b9b1d6124>

Backed out for causing bc failures in browser\_resizeVideo.js:

<https://hg.mozilla.org/integration/autoland/rev/050a7125f954b037329f27705c8e19489bd15e7d>

[Push with failures](https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception%2Crunnable&revision=b1648cab08f03ae6a0d7e0d3a92c909b9b1d6124&selectedTaskRun=PlRKAPoPSbenzJ5Fzf9oRA.0)

[Failure log](https://treeherder.mozilla.org/logviewer?job_id=388637144&repo=autoland)

[mda failures](https://treeherder.mozilla.org/logviewer?job_id=388646767&repo=autoland&lineNumber=2464)

[wpt failure 1](https://treeherder.mozilla.org/logviewer?job_id=388646279&repo=autoland&lineNumber=6456), [wpt failure 2](https://treeherder.mozilla.org/logviewer?job_id=388640614&repo=autoland&lineNumber=30226)

Flags: needinfo?(alwu)

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1767360#c27)• 2 years ago |
|  | |

Working on investigating those failures, will update my patches again later. Keep NI.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a10345633_600971)• 2 years ago |

[Attachment #9289353](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") -
Attachment description: Bug 1767360 - use display information retrieved from the output type to create video frames. → Bug 1767360 - use coded frame size retrieved from the output type to create video frame buffer. r=jolin!.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a10366655_600971)• 2 years ago |

[Attachment #9289353](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") -
Attachment description: Bug 1767360 - use coded frame size retrieved from the output type to create video frame buffer. r=jolin!. → Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.

|  | [Alastor Wu [:alwu]](/user_profile?user_id=517691)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a10373071_517691)• 2 years ago |

Flags: needinfo?(alwu)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1767360#c28)• 2 years ago |
|  | |

use correct image size retrieved from the output type to create video frames buffer. r=media-playback-reviewers,jolin

<https://hg.mozilla.org/integration/autoland/rev/1ce65df85abc69150fcecdbd9e6315a1f4359881>

<https://hg.mozilla.org/mozilla-central/rev/1ce65df85abc>

Group: media-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 2 years ago
[status-firefox106](/buglist.cgi?f1=cf_status_firefox106&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 106 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1767360#c29)• 2 years ago |
|  | |

Comment on [attachment 9289353](/attachment.cgi?id=9289353 "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") [[details]](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.")

[Bug 1767360](/show_bug.cgi?id=1767360 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264") - use correct image size retrieved from the output type to create video frames buffer.

Approved for 105.0b6 and 102.3esr.

[Attachment #9289353](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") -
Flags: approval-mozilla-esr102+
[Attachment #9289353](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") -
Flags: approval-mozilla-beta?
[Attachment #9289353](/attachment.cgi?id=9289353&action=edit "Bug 1767360 - use correct image size retrieved from the output type to create video frames buffer.") -
Flags: approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1767360#c30)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/cdc3d95f5125>

[status-firefox105](/buglist.cgi?f1=cf_status_firefox105&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1767360#c31)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr102/rev/e9d94bf2aced>

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed)

|  | [Camelia Badau [:cbadau], Desktop Test Engineering](/user_profile?user_id=500622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a10573820_500622)• 2 years ago |

Flags: qe-verify+

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a10575655_553429)• 2 years ago |

QA Whiteboard: [qa-triaged]

|  | [Alexandru Trif, Desktop Test Engineering [:atrif]](/user_profile?user_id=631815) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1767360#c32)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1767360&comment_id=16062285 "1 revision") |
|  | |

Hello! I managed to reproduce the silent crash stated in [comment 0](/show_bug.cgi?id=1767360#c0 "VERIFIED FIXED - Crash in UpdateSubresource when playing H264") (<https://crash-stats.mozilla.org/report/index/a185024c-980b-4e43-afd8-526a20220905>) with Firefox 102.0a1 (20220502213947) and Firefox 104.0 (<https://crash-stats.mozilla.org/report/index/ff1b63a4-afb5-4e7a-b83e-cf2d70220905>) on Windows 10x64 after loading the attached test case and videos or after refreshing the pages multiple times. Also, loading the test case and videos will display a glitched video preview.

However, I could also see <https://crash-stats.mozilla.org/report/index/cdb8ab10-53de-452b-8ab2-26d470220905> crashes in the about:crashes page after refreshing the pages or changing the seekbar.

I can no longer see any of the above crashes in about:crashes on Windows 10x64 or Windows 7x64 after loading the attached videos and test case and refreshing the pages multiple times or changing the seekbar with Firefox 106.0a1 (20220904213226), 105.0b7 (20220904185841) and 102.3.0esr (20220901164226). The glitches are no longer displayed as well on the fixed versions.

Status: RESOLVED → VERIFIED
[status-firefox105](/buglist.cgi?f1=cf_status_firefox105&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=verified)
[status-firefox106](/buglist.cgi?f1=cf_status_firefox106&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=verified)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=verified)Flags: qe-verify+OS: Unspecified → WindowsHardware: Unspecified → Desktop

|  | [Alexandru Trif, Desktop Test Engineering [:atrif]](/user_profile?user_id=631815) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a10917875_631815)• 2 years ago |

QA Whiteboard: [qa-triaged]

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1767360#c33)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1767360&comment_id=16063649 "1 revision") |
|  | |

Of note, this might be the cause of a nighty crasher - [Bug 1788174](/show_bug.cgi?id=1788174 "RESOLVED FIXED - Crash in [@ BaseThreadInitThunk]") - Crash in [@ BaseThreadInitThunk]

Update - looks like that top crasher started on 8-30, this landed 8-31.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1767360#c34)• 2 years ago |
|  | |

That crash spike started before this patch landed and we haven't seen any crash spikes on Beta where this was also uplifted to.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a11617926_428608)• 2 years ago |

Whiteboard: [adv-main105+r]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a11619559_428608)• 2 years ago |

Whiteboard: [adv-main105+r] → [adv-main105+r][adv-esr102.3+r]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1767360#c35)• 2 years ago |
|  | |

This was from an external reporter originally, Jeff was just the bug-filer here. Should be eligible for a bug bounty.

Flags: sec-bounty?

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1767360#c36)• 2 years ago |
|  | |

Apologies for omitting the real author credit. Instead of rolling this up in our work to find and fix memory hazards, we usually announce the bugs individually when reported externally. Let's use [CVE-2022-3266](https://www.cve.org/CVERecord?id=CVE-2022-3266). Advisory fixes will follow later in the day.

Alias: CVE-2022-3266Whiteboard: [adv-main105+r][adv-esr102.3+r] → [adv-main105+][adv-esr102.3+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1767360#c37)• 2 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9295741)
— [Details](attachment.cgi?id=9295741&action=edit)

Attaching draft advisory text.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a13621786_1689)• 2 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a22394467_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767360#a65555182_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1767360&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_f0a3d189_20250114_220027.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-42

## Security Vulnerabilities fixed in Thunderbird 102.3

Announced
September 20, 2022
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 102.3

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2022-3266: Out of bounds read when decoding H264](#CVE-2022-3266)

Reporter
Willy R. Vasquez at UT Austin
Impact
high
##### Description

An out-of-bounds read can occur when decoding H264 video. This results in a potentially exploitable crash.

##### References

* [Bug 1767360](https://bugzilla.mozilla.org/show_bug.cgi?id=1767360)

#### [#CVE-2022-40959: Bypassing FeaturePolicy restrictions on transient pages](#CVE-2022-40959)

Reporter
Armin Ebert
Impact
high
##### Description

During iframe navigation, certain pages did not have their FeaturePolicy fully initialized leading to a bypass that leaked device permissions into untrusted subdocuments.

##### References

* [Bug 1782211](https://bugzilla.mozilla.org/show_bug.cgi?id=1782211)

#### [#CVE-2022-40960: Data-race when parsing non-UTF-8 URLs in threads](#CVE-2022-40960)

Reporter
Armin Ebert
Impact
high
##### Description

Concurrent use of the URL parser with non-UTF-8 data was not thread-safe. This could lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1787633](https://bugzilla.mozilla.org/show_bug.cgi?id=1787633)

#### [#CVE-2022-40958: Bypassing Secure Context restriction for cookies with \_\_Host and \_\_Secure prefix](#CVE-2022-40958)

Reporter
Axel Chong (@Haxatron)
Impact
moderate
##### Description

By injecting a cookie with certain special characters, an attacker on a shared subdomain which is not a secure context could set and thus overwrite cookies from a secure context, leading to session fixation and other attacks.

##### References

* [Bug 1779993](https://bugzilla.mozilla.org/show_bug.cgi?id=1779993)

#### [#CVE-2022-40956: Content-Security-Policy base-uri bypass](#CVE-2022-40956)

Reporter
Satoki Tsuji
Impact
low
##### Description

When injecting an HTML base element, some requests would ignore the CSP's base-uri settings and accept the injected element's base instead.

##### References

* [Bug 1770094](https://bugzilla.mozilla.org/show_bug.cgi?id=1770094)

#### [#CVE-2022-40957: Incoherent instruction cache when building WASM on ARM64](#CVE-2022-40957)

Reporter
Gary Kwong
Impact
low
##### Description

Inconsistent data in instruction and data cache when creating wasm code could lead to a potentially exploitable crash.
*This bug only affects Thunderbird on ARM64 platforms.*

##### References

* [Bug 1777604](https://bugzilla.mozilla.org/show_bug.cgi?id=1777604)

#### [#CVE-2022-3155: Attachment files saved to disk on macOS could be executed without warning](#CVE-2022-3155)

Reporter
Koh M. Nakagawa
Impact
low
##### Description

When saving or opening an email attachment on macOS, Thunderbird did not set attribute com.apple.quarantine on the received file. If the received file was an application and the user attempted to open it, then the application was started immediately without asking the user to confirm.

##### References

* [Bug 1789061](https://bugzilla.mozilla.org/show_bug.cgi?id=1789061)

#### [#CVE-2022-40962: Memory safety bugs fixed in Thunderbird 102.3](#CVE-2022-40962)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Nika Layzell, Timothy Nikkel, Sebastian Hengst, Andreas Pehrson, and the Mozilla Fuzzing Team reported memory safety bugs present in Thunderbird 102.2. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 102.3](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1776655%2C1777574%2C1784835%2C1785109%2C1786502%2C1789440)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


