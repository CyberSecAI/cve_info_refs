=== Content from gitlab.com_50fd7269_20250114_195913.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-3793.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-3793.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-3793.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-3793.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Nov 09, 2022

  [ae036b7e](/gitlab-org/cves/-/commit/ae036b7ed9ac9218ede730739c2cf5834e748bf2)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/ae036b7ed9ac9218ede730739c2cf5834e748bf2)
  ·
  ae036b7e

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Nov 09, 2022

  ae036b7e

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/ae036b7ed9ac9218ede730739c2cf5834e748bf2)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Nov 09, 2022

Loading



=== Content from gitlab.com_4bff7a4d_20250114_195914.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Prefill variables do not check permission of the project in external CI config

### Summary

An attacker can access other projects' top-level YAML variables which use `description` via using [external CI config](https://docs.gitlab.com/ee/ci/pipelines/settings.html#specify-a-custom-cicd-configuration-file) and [prefill variables](https://docs.gitlab.com/ee/ci/pipelines/#prefill-variables-in-manual-pipelines).

I found this vulnerability when working on [#353456 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/353456 "Backend: Pre-filled variables do not work correctly for branches for external custom CI config file paths").

The vulnerability was introduced by [#336184 (closed)](https://gitlab.com/gitlab-org/gitlab/-/issues/336184 "Pre-filled variables do not work for external custom CI config file paths") in v14.4.

p.s. this does not affect the [new GraphQL endpoint](https://docs.gitlab.com/ee/api/graphql/reference/#projectciconfigvariables) because we missed the implementation of this external project feature ([!93387 (merged)](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/93387 "Adds CiConfigVariableType")).

### Steps to reproduce

1. Project 1: Private, has a `.gitlab-ci.yml` file with some top-level YAML variables.

```
variables:
  VAR1:
    value: my secret 1
    description: this is my var 1
  VAR2: my secret 2

test:
  script: exit 0
```

2. Project 2: Public/Private, has an external "CI/CD configuration file".

[![Screenshot_2022-08-30_at_14.39.42](data:image/gif;base64...)](/-/project/278964/uploads/96c6349314215d042332508d6e302b8d/Screenshot_2022-08-30_at_14.39.42.png)

3. In Project 2, open the Pipeline Run page and see;

[![Screenshot_2022-08-30_at_14.40.47](data:image/gif;base64...)](/-/project/278964/uploads/af8b5d58c09dfe3e4e7c14ead488870d/Screenshot_2022-08-30_at_14.40.47.png)

### Possible fixes

1. Move the external project logic from `app/controllers/projects/pipelines_controller.rb` to `app/services/ci/list_config_variables_service.rb`.
2. Use the same logic in `lib/gitlab/ci/pipeline/chain/config/content/external_project.rb`.

Edited Sep 01, 2022 by [Furkan Ayhan](/furkanayhan)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


