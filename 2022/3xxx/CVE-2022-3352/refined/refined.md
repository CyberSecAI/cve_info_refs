```
{
  "vulnerability": {
    "root_cause": "The `SpellFileMissing` autocmd in Vim could delete the current buffer when loading a spell file, leading to a use-after-free vulnerability.",
    "weaknesses": [
      "Use After Free"
    ],
    "impact": "Using freed memory, potentially leading to a crash or arbitrary code execution.",
    "attack_vectors": "The vulnerability can be triggered by an autocmd that is run when a spell file is missing during spell checking operations.",
    "required_capabilities": "A user must trigger the `SpellFileMissing` autocmd, for example, by loading a file with a language set where the corresponding spell file does not exist."
  },
  "affected_versions": [
    "< 9.0.1157"
  ],
  "fixes": [
    "Disallowing deletion of the current buffer within the SpellFileMissing autocmd context.",
     "Introduced a lock on the current buffer to prevent its deletion while handling spell loading."
  ],
  "references": [
    "https://github.com/vim/vim/commit/ef976323e770315b5fca544efb6b2faa25674d15",
    "https://security-tracker.debian.org/tracker/CVE-2022-3352",
    "https://bugzilla.redhat.com/show_bug.cgi?id=2131087",
    "https://nvd.nist.gov/vuln/detail/CVE-2022-3352",
    "https://security.gentoo.org/glsa/202305-16"
  ],
  "patch_details": {
    "src/buffer.c": "Modified `can_unload_buffer` function to prevent unloading when the buffer is in use.",
    "src/spell.c": "Added a lock around buffer operations in `spell_load_lang` function to prevent deletion during spell file loading.",
     "src/testdir/test_autocmd.vim": "Added a test case `Test_SpellFileMissing_bwipe` to ensure that the vulnerability is resolved by preventing buffer wiping during SpellFileMissing autocmd execution."
  }
}
```