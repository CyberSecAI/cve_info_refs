=== Content from github.com_5d3ef16f_20250114_190438.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen5gs%2Fopen5gs%2Fcommit%2F724fa568435dae45ef0c3a48b2aabde052afae88)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen5gs%2Fopen5gs%2Fcommit%2F724fa568435dae45ef0c3a48b2aabde052afae88)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=open5gs%2Fopen5gs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open5gs](/open5gs)
/
**[open5gs](/open5gs/open5gs)**
Public

* [Notifications](/login?return_to=%2Fopen5gs%2Fopen5gs) You must be signed in to change notification settings
* [Fork
  783](/login?return_to=%2Fopen5gs%2Fopen5gs)
* [Star
   1.9k](/login?return_to=%2Fopen5gs%2Fopen5gs)

* [Code](/open5gs/open5gs)
* [Issues
  148](/open5gs/open5gs/issues)
* [Pull requests
  55](/open5gs/open5gs/pulls)
* [Discussions](/open5gs/open5gs/discussions)
* [Actions](/open5gs/open5gs/actions)
* [Projects
  0](/open5gs/open5gs/projects)
* [Wiki](/open5gs/open5gs/wiki)
* [Security](/open5gs/open5gs/security)
* [Insights](/open5gs/open5gs/pulse)

Additional navigation options

* [Code](/open5gs/open5gs)
* [Issues](/open5gs/open5gs/issues)
* [Pull requests](/open5gs/open5gs/pulls)
* [Discussions](/open5gs/open5gs/discussions)
* [Actions](/open5gs/open5gs/actions)
* [Projects](/open5gs/open5gs/projects)
* [Wiki](/open5gs/open5gs/wiki)
* [Security](/open5gs/open5gs/security)
* [Insights](/open5gs/open5gs/pulse)

## Commit

[Permalink](/open5gs/open5gs/commit/724fa568435dae45ef0c3a48b2aabde052afae88)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fixed HTTP2 crashes for random JSON data ([#1769](https://github.com/open5gs/open5gs/issues/1769))

[Browse files](/open5gs/open5gs/tree/724fa568435dae45ef0c3a48b2aabde052afae88)
Browse the repository at this point in the history

* Loading branch information

[![@acetcom](https://avatars.githubusercontent.com/u/4222492?s=40&v=4)](/acetcom)

[acetcom](/open5gs/open5gs/commits?author=acetcom "View all commits by acetcom")
committed
Sep 25, 2022

1 parent
[c2f6a02](/open5gs/open5gs/commit/c2f6a020a7b505e0d55748464406fb9aca062026)

commit 724fa56

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**65 additions**
and
**28 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib/sbi

  + lib/sbi/client.c
    [client.c](#diff-4be7a2a121321ec739e231da0939a66d974eb7cc60c5b048583e4e24f1e2f714)
  + lib/sbi/nghttp2-server.c
    [nghttp2-server.c](#diff-a4f74cdd6b406e2a4aa82ce1ee752d36a901ad197fccbb2374525892f717976d)

## There are no files selected for viewing

40 changes: 29 additions & 11 deletions

40
[lib/sbi/client.c](#diff-4be7a2a121321ec739e231da0939a66d974eb7cc60c5b048583e4e24f1e2f714 "lib/sbi/client.c")

Show comments

[View file](/open5gs/open5gs/blob/724fa568435dae45ef0c3a48b2aabde052afae88/lib/sbi/client.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,6 +44,7 @@ typedef struct connection\_s { |
|  |  |  |
|  |  | char \*memory; |
|  |  | size\_t size; |
|  |  | bool memory\_overflow; |
|  |  |  |
|  |  | char \*location; |
|  |  |  |
| Expand Down  Expand Up | | @@ -533,6 +534,8 @@ static void check\_multi\_info(ogs\_sbi\_client\_t \*client) |
|  |  |  |
|  |  | res = resource->data.result; |
|  |  | if (res == CURLE\_OK) { |
|  |  | ogs\_log\_level\_e level = OGS\_LOG\_DEBUG; |
|  |  |  |
|  |  | response = ogs\_sbi\_response\_new(); |
|  |  | ogs\_assert(response); |
|  |  |  |
| Expand All | | @@ -546,7 +549,17 @@ static void check\_multi\_info(ogs\_sbi\_client\_t \*client) |
|  |  | response->h.uri = ogs\_strdup(url); |
|  |  | ogs\_assert(response->h.uri); |
|  |  |  |
|  |  | ogs\_debug("[%d:%s] %s", |
|  |  | if (content\_type) |
|  |  | ogs\_sbi\_header\_set(response->http.headers, |
|  |  | OGS\_SBI\_CONTENT\_TYPE, content\_type); |
|  |  | if (conn->location) |
|  |  | ogs\_sbi\_header\_set(response->http.headers, |
|  |  | OGS\_SBI\_LOCATION, conn->location); |
|  |  |  |
|  |  | if (conn->memory\_overflow == true) |
|  |  | level = OGS\_LOG\_ERROR; |
|  |  |  |
|  |  | ogs\_log\_message(level, 0, "[%d:%s] %s", |
|  |  | response->status, response->h.method, response->h.uri); |
|  |  |  |
|  |  | if (conn->memory) { |
| Expand All | | @@ -557,16 +570,17 @@ static void check\_multi\_info(ogs\_sbi\_client\_t \*client) |
|  |  | ogs\_assert(response->http.content\_length); |
|  |  | } |
|  |  |  |
|  |  | ogs\_debug("RECEIVED[%d]", (int)response->http.content\_length); |
|  |  | ogs\_log\_message(level, 0, "RECEIVED[%d]", |
|  |  | (int)response->http.content\_length); |
|  |  | if (response->http.content\_length && response->http.content) |
|  |  | ogs\_debug("%s", response->http.content); |
|  |  | ogs\_log\_message(level, 0, "%s", response->http.content); |
|  |  |  |
|  |  | if (conn->memory\_overflow == true) { |
|  |  | ogs\_sbi\_response\_free(response); |
|  |  | connection\_remove(conn); |
|  |  | break; |
|  |  | } |
|  |  |  |
|  |  | if (content\_type) |
|  |  | ogs\_sbi\_header\_set(response->http.headers, |
|  |  | OGS\_SBI\_CONTENT\_TYPE, content\_type); |
|  |  | if (conn->location) |
|  |  | ogs\_sbi\_header\_set(response->http.headers, |
|  |  | OGS\_SBI\_LOCATION, conn->location); |
|  |  | } else |
|  |  | ogs\_warn("[%d] %s", res, conn->error); |
|  |  |  |
| Expand Down  Expand Up | | @@ -727,8 +741,12 @@ static size\_t write\_cb(void \*contents, size\_t size, size\_t nmemb, void \*data) |
|  |  | realsize = size \* nmemb; |
|  |  | ptr = ogs\_realloc(conn->memory, conn->size + realsize + 1); |
|  |  | if(!ptr) { |
|  |  | ogs\_fatal("not enough memory (realloc returned NULL)"); |
|  |  | ogs\_assert\_if\_reached(); |
|  |  | conn->memory\_overflow = true; |
|  |  |  |
|  |  | ogs\_error("Overflow : conn->size[%d], realsize[%d]", |
|  |  | (int)conn->size, (int)realsize); |
|  |  | ogs\_log\_hexdump(OGS\_LOG\_ERROR, contents, realsize); |
|  |  |  |
|  |  | return 0; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

53 changes: 36 additions & 17 deletions

53
[lib/sbi/nghttp2-server.c](#diff-a4f74cdd6b406e2a4aa82ce1ee752d36a901ad197fccbb2374525892f717976d "lib/sbi/nghttp2-server.c")

Show comments

[View file](/open5gs/open5gs/blob/724fa568435dae45ef0c3a48b2aabde052afae88/lib/sbi/nghttp2-server.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -82,6 +82,7 @@ typedef struct ogs\_sbi\_stream\_s { |
|  |  |  |
|  |  | int32\_t stream\_id; |
|  |  | ogs\_sbi\_request\_t \*request; |
|  |  | bool memory\_overflow; |
|  |  |  |
|  |  | ogs\_sbi\_session\_t \*session; |
|  |  | } ogs\_sbi\_stream\_t; |
| Expand Down  Expand Up | | @@ -791,12 +792,23 @@ static int on\_frame\_recv(nghttp2\_session \*session, |
|  |  | case NGHTTP2\_DATA: |
|  |  | /\* HEADERS or DATA frame with +END\_STREAM flag \*/ |
|  |  | if (frame->hd.flags & NGHTTP2\_FLAG\_END\_STREAM) { |
|  |  | ogs\_log\_level\_e level = OGS\_LOG\_DEBUG; |
|  |  |  |
|  |  | ogs\_debug("[%s] %s", request->h.method, request->h.uri); |
|  |  | if (stream->memory\_overflow == true) |
|  |  | level = OGS\_LOG\_ERROR; |
|  |  |  |
|  |  | ogs\_log\_message(level, 0, |
|  |  | "[%s] %s", request->h.method, request->h.uri); |
|  |  |  |
|  |  | if (request->http.content\_length && request->http.content) { |
|  |  | ogs\_debug("RECEIVED: %d", (int)request->http.content\_length); |
|  |  | ogs\_debug("%s", request->http.content); |
|  |  | ogs\_log\_message(level, 0, |
|  |  | "RECEIVED: %d", (int)request->http.content\_length); |
|  |  | ogs\_log\_message(level, 0, "%s", request->http.content); |
|  |  | } |
|  |  |  |
|  |  | if (stream->memory\_overflow == true) { |
|  |  | ogs\_error("[DROP] Overflow"); |
|  |  | break; |
|  |  | } |
|  |  |  |
|  |  | if (server->cb(request, stream) != OGS\_OK) { |
| Expand Down  Expand Up | | @@ -967,23 +979,30 @@ static int on\_data\_chunk\_recv(nghttp2\_session \*session, uint8\_t flags, |
|  |  | ogs\_assert(len); |
|  |  |  |
|  |  | if (request->http.content == NULL) { |
|  |  | request->http.content\_length = len; |
|  |  | request->http.content = |
|  |  | (char\*)ogs\_malloc(request->http.content\_length + 1); |
|  |  | ogs\_assert(request->http.content); |
|  |  | ogs\_assert(request->http.content\_length == 0); |
|  |  | ogs\_assert(offset == 0); |
|  |  |  |
|  |  | request->http.content = (char\*)ogs\_malloc(len + 1); |
|  |  | } else { |
|  |  | offset = request->http.content\_length; |
|  |  | if ((request->http.content\_length + len) > OGS\_HUGE\_LEN) { |
|  |  | ogs\_error("Overflow : Content-Length[%d], len[%d]", |
|  |  | (int)request->http.content\_length, (int)len); |
|  |  | ogs\_assert\_if\_reached(); |
|  |  | } |
|  |  | request->http.content\_length += len; |
|  |  | request->http.content = (char \*)ogs\_realloc( |
|  |  | request->http.content, request->http.content\_length + 1); |
|  |  | ogs\_assert(request->http.content); |
|  |  | ogs\_assert(request->http.content\_length != 0); |
|  |  |  |
|  |  | request->http.content = (char\*)ogs\_realloc( |
|  |  | request->http.content, request->http.content\_length + len + 1); |
|  |  | } |
|  |  |  |
|  |  | if (!request->http.content) { |
|  |  | stream->memory\_overflow = true; |
|  |  |  |
|  |  | ogs\_error("Overflow : Content-Length[%d], len[%d]", |
|  |  | (int)request->http.content\_length, (int)len); |
|  |  | ogs\_log\_hexdump(OGS\_LOG\_ERROR, data, len); |
|  |  |  |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | offset = request->http.content\_length; |
|  |  | request->http.content\_length += len; |
|  |  |  |
|  |  | memcpy(request->http.content + offset, data, len); |
|  |  | request->http.content[request->http.content\_length] = '\0'; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `724fa56`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen5gs%2Fopen5gs%2Fcommit%2F724fa568435dae45ef0c3a48b2aabde052afae88) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f4f609f3_20250114_190439.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen5gs%2Fopen5gs%2Fissues%2F1769)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen5gs%2Fopen5gs%2Fissues%2F1769)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=open5gs%2Fopen5gs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open5gs](/open5gs)
/
**[open5gs](/open5gs/open5gs)**
Public

* [Notifications](/login?return_to=%2Fopen5gs%2Fopen5gs) You must be signed in to change notification settings
* [Fork
  783](/login?return_to=%2Fopen5gs%2Fopen5gs)
* [Star
   1.9k](/login?return_to=%2Fopen5gs%2Fopen5gs)

* [Code](/open5gs/open5gs)
* [Issues
  148](/open5gs/open5gs/issues)
* [Pull requests
  55](/open5gs/open5gs/pulls)
* [Discussions](/open5gs/open5gs/discussions)
* [Actions](/open5gs/open5gs/actions)
* [Projects
  0](/open5gs/open5gs/projects)
* [Wiki](/open5gs/open5gs/wiki)
* [Security](/open5gs/open5gs/security)
* [Insights](/open5gs/open5gs/pulse)

Additional navigation options

* [Code](/open5gs/open5gs)
* [Issues](/open5gs/open5gs/issues)
* [Pull requests](/open5gs/open5gs/pulls)
* [Discussions](/open5gs/open5gs/discussions)
* [Actions](/open5gs/open5gs/actions)
* [Projects](/open5gs/open5gs/projects)
* [Wiki](/open5gs/open5gs/wiki)
* [Security](/open5gs/open5gs/security)
* [Insights](/open5gs/open5gs/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fopen5gs%2Fopen5gs%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fopen5gs%2Fopen5gs%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# API crashes #1769

Closed

[Popvlvs](/Popvlvs) opened this issue
Sep 19, 2022
· 2 comments

Closed

# [API crashes](#top) #1769

[Popvlvs](/Popvlvs) opened this issue
Sep 19, 2022
· 2 comments

Labels
[type:bug](/open5gs/open5gs/labels/type%3Abug)
Open5GS bug

## Comments

[![@Popvlvs](https://avatars.githubusercontent.com/u/56645347?s=80&u=bfa02d72c7a5b815484649071f19fdb4b9f53dc0&v=4)](/Popvlvs)

Copy link

### **[Popvlvs](/Popvlvs)** commented [Sep 19, 2022](#issue-1377871064) • edited Loading

| Hi,  I was fuzzing an AMF's API endpoint <http://x.x.x.x:7777/namf-comm/v1/ue-contexts>) with some random JSON payloads and it eventually crashed:  [image](https://user-images.githubusercontent.com/56645347/191015337-03965c78-cb46-40d9-94bd-8261b52ac8dd.png)  It happens with NULL BYTE as a payload, as shown in the following pictures:  [image](https://user-images.githubusercontent.com/56645347/191015492-d40ddbb9-44f4-4a16-8dcc-718c0c8b5839.png)  [image](https://user-images.githubusercontent.com/56645347/191015719-5c711e92-bdaa-400f-b6bf-6fb8a275f62f.png)  Regards |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[acetcom](/acetcom)
added a commit
that referenced
this issue
[Sep 25, 2022](#ref-commit-724fa56)
[![@acetcom](https://avatars.githubusercontent.com/u/4222492?s=40&u=71a6e5e0382ff3d0e1191594f5fb838bfc2268bf&v=4)](/acetcom)

`[Fixed HTTP2 crashes for random JSON data (](/open5gs/open5gs/commit/724fa568435dae45ef0c3a48b2aabde052afae88 "Fixed HTTP2 crashes for random JSON data (#1769)")[#1769](https://github.com/open5gs/open5gs/issues/1769)[)](/open5gs/open5gs/commit/724fa568435dae45ef0c3a48b2aabde052afae88 "Fixed HTTP2 crashes for random JSON data (#1769)")`

`[724fa56](/open5gs/open5gs/commit/724fa568435dae45ef0c3a48b2aabde052afae88)`

[![@acetcom](https://avatars.githubusercontent.com/u/4222492?s=80&u=71a6e5e0382ff3d0e1191594f5fb838bfc2268bf&v=4)](/acetcom)

Copy link

Member

### **[acetcom](/acetcom)** commented [Sep 25, 2022](#issuecomment-1257129219)

| [@Popvlvs](https://github.com/Popvlvs)  I've fixed it.  Thank you so much. Sukchan |
| --- |

All reactions

Sorry, something went wrong.

[![@acetcom](https://avatars.githubusercontent.com/u/4222492?s=40&u=71a6e5e0382ff3d0e1191594f5fb838bfc2268bf&v=4)](/acetcom)
[acetcom](/acetcom)
added
the
[type:bug](/open5gs/open5gs/labels/type%3Abug)
Open5GS bug
label
[Sep 25, 2022](#event-7453068065)

[![@Popvlvs](https://avatars.githubusercontent.com/u/56645347?s=40&u=bfa02d72c7a5b815484649071f19fdb4b9f53dc0&v=4)](/Popvlvs)
[Popvlvs](/Popvlvs)
closed this as [completed](/open5gs/open5gs/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Sep 27, 2022](#event-7468836611)

[NLag](/NLag)
added a commit
to securitylab-repository/open5gs\_ciot
that referenced
this issue
[Oct 19, 2022](#ref-commit-fdfe2c9)
[![@NLag](https://avatars.githubusercontent.com/u/23296450?s=40&u=e3580870f84ea63e0be0f838c827a29c8dbe5eb2&v=4)](/NLag) [![@acetcom](https://avatars.githubusercontent.com/u/4222492?s=40&u=71a6e5e0382ff3d0e1191594f5fb838bfc2268bf&v=4)](/acetcom)
[![@pespin](https://avatars.githubusercontent.com/u/1515985?s=40&v=4)](/pespin) [![@bmeglic](https://avatars.githubusercontent.com/u/103102696?s=40&v=4)](/bmeglic) [![@Networkmama](https://avatars.githubusercontent.com/u/107408378?s=40&v=4)](/Networkmama) [![@osmith42](https://avatars.githubusercontent.com/u/44496293?s=40&u=7af9ef64bffa3b52be62c159d5d0936f161fbde0&v=4)](/osmith42) [![@jmasterfunk84](https://avatars.githubusercontent.com/u/48972964?s=40&v=4)](/jmasterfunk84) [![@herlesupreeth](https://avatars.githubusercontent.com/u/4115839?s=40&u=0df0d633efb5eab3da1aea56c63526525ce90ef4&v=4)](/herlesupreeth) [![@lynxis](https://avatars.githubusercontent.com/u/272583?s=40&v=4)](/lynxis) [![@mitmitmitm](https://avatars.githubusercontent.com/u/106949222?s=40&v=4)](/mitmitmitm) [![@EugeneBogush](https://avatars.githubusercontent.com/u/1798186?s=40&u=0b2c70944ac63dd38b439ab12b6087c539cb854d&v=4)](/EugeneBogush) [![@neggles](https://avatars.githubusercontent.com/u/4232981?s=40&u=93a2cb4de3496042ddf49595cc47e22321b2478a&v=4)](/neggles) [![@gstaa](https://avatars.githubusercontent.com/u/93838663?s=40&v=4)](/gstaa) [![@spencersevilla](https://avatars.githubusercontent.com/u/1691412?s=40&v=4)](/spencersevilla) [![@dibasdas02](https://avatars.githubusercontent.com/u/84923695?s=40&v=4)](/dibasdas02) [![@ssafaorhan](https://avatars.githubusercontent.com/u/95750427?s=40&u=c95e9e49bcb03d0642a1861fee04b43d0c926a69&v=4)](/ssafaorhan)

`[Update repo to open5gs/open5gs main (](/securitylab-repository/open5gs_ciot/commit/fdfe2c951870458716094018f75ebc5d298f3bd7 "Update repo to open5gs/open5gs main (#1)

* Initialize pgw_s5u_teid (#1559)

* [SMF] Gy: Send Multiple-Services-Indicator AVP only during Initial CCR (#1616)

Gy (3GPP TS 32.299 ) refers to AVP in DCCA (RFC4006).

RFC4006 5.1.2:
\"[...] by including the Multiple-Services-Indicator AVP in the first
interrogation.\"

Nokia's infocenter documentation also states it's sent during Initial CCR
only: \"(CCR-I only)\".

* [SBI] Fix memory leak for nghttp2 session (#1618)

Delete nghttp2 session to prevent memory leaks.
The issue was detected using valgrind.

* [CORE] fsm: Add asserts to validate ogs_fsm_t is not null (#1619)

* Change Default MCC/MNC 901/70 -> 999/70 (#1331)

* [SMF] track and fix scenario where gtp node mempool becomes full (#1622)

* [SMF] Avoid abort() if gtp_node mempool becomes full

Related: https://github.com/open5gs/open5gs/issues/1621

* [SMF] metrics: Add new ctr tracking gtp_node allocation failures

This metrics is useful to track whether at some point the mempool went
full, so that config needs to be updated to increase the mempool size.

* [SGWC,SMF] Add specific config opt max.gtp_peer to set gtp_node mempool size (#1623)

This is needed specially for SMFs handling a pool of SGWs.

* [UPF] Avoid crash if no default subnet configured (#1624)

In that case, ogs_pfcp_ue_ip_alloc() will fail with  the error message
\"CHECK CONFIGURATION: Cannot find subnet [...]\" and the assert will make
upf crash.
That's not desirable, let's keep it running and simply reject the
request. The error log is big enoguh to find out.

* [SMF] pfcp-sm: Fix ogs_fsm_dispatch() on NULL sess (#1628)

It was spotted that if DeleteSessionReq sent by SMF is answered by UPF
with cause=\"Session context not found\", then it contains SEID=0 (this is
correct as per specs). Hence, since SEID=0 session is not looked up, so
sess=NULL.

A follow up commit improves the situation by looking up the SEID in the
originating request message in that case.

* [SMF] Set v4/6 flag in F-TEID IE request type (#1625)

Signed-off-by: Networkmama <networkmama12@gmail.com>

* Set v4/v6 flags in local F-TEID (#1625)

* [PFCP] Added DNN/APN in FAR (#1629, #1630)

* [PFCP] Added Network Instance to CP-UP FAR (#1630)

* [SMF] Gn: QoS Profile and PCO IE improvements (#1631)

* [SMF] pfcp: Retrieve sess when response with SEID=0 is received (#1620)

3GPP TS 29.244 7.2.2.4.2 documents that the peer will set SEID=0 in the
response when we request something for a session not existing at the peer.
If that's the case, we still want to locate the local session which
originated the request, so let's store the local SEID in the xact when
submitting the message, so that we can retrieve the related SEID and
find the session if we receive SEID=0.

* [SGWC] pfcp: Retrieve sess when SEID=0 (#1620)

* [GTP] context when TEID=0 (#1620, #1606, #1594)

* [SCTP] Add protection code jumbo frame (#1632)

* [GTP] Avoid abort if ogs_gtp_node_new() returns NULL (#1633)

* [GTP] Avoid abort if ogs_gtp_node_new() returns NULL

* [SGWC] Avoid abort if ogs_gtp_node_add_by_addr() returns NULL

* [GTP] avoid abort for ogs_gtp_node_new() (#1633)

* [UPF] N4: Remove unnecessary assert (#1634)

* Changes MAX TLV MORE to 16

OGS_MAX_NUM_OF_PDR is 16, but OGS_TLV_MAX_MORE is 8.
To match the size of two macros, increased OGS_TLV_MAX_MORE to 16.

* Revert \"[GTP] context when TEID=0 (#1620, #1606, #1594)\"

This reverts commit 0d61f7a7f905a865bcd8be9382ffabeb817f8464.

* Revert \"[SGWC] pfcp: Retrieve sess when SEID=0 (#1620)\"

This reverts commit 970056302390471e7089a7a2ed08bcf979fd057d.

* [PFCP] Refine error code path without assertion

Refer to #1635, #1620

* [GTP] Refine error code path without assertion

Refer to #1635, #1620, #1606, #1594

* Fixed a crash when slice/session overflow (#1637)

* [MISC] Add support for static code analysis

Static code analysis can be executed with following commands:
  meson build
  ninja -C build analyze-cppcheck
  ninja -C build analyze-clang-tidy

These commands are available only if additional tools are installed:
  - cppcheck
  - clang-tidy
  - clang-tools is optional if you want to paralelize the clang-tidy

In case of cppcheck analysis, a file called build/cppchecklog.log is
created with the analysis results.

In case of clang-tidy analysis, some checks are disabled. See file
.clang-tidy, and reenable them if you see fit.
Also it does not scan all the files in the project, since some of them
are imported from other sources. It does not scan any sources under:
  - subprojects/
  - lib/asn1c/
  - lib/ipfw/

* [ALL] Fix differences in function parameter names between definition and declaration

* [CORE] Fix detection of a failed memory allocation

* [CORE] Added memory check (#1638)

* [PFCP] Fixed a endianness Apply Action (#1640)

* [SMF] copy UE ip address to uplink PDR rules.

This helps UPF to add ACL based on src ip

Signed-off-by: Networkmama <networkmama12@gmail.com>

* [PFCP] Added UE IP address in the EPC (#1642)

* d/open5gs-upf.postinst: don't restart service in chroot

Don't attempt to restart systemd-networkd if systemd is not running
(e.g. installing open5gs inside a chroot).

Fix for:
  System has not been booted with systemd as init system (PID 1). Can't operate.
  Failed to connect to bus: Host is down
  dpkg: error processing package open5gs-upf:amd64 (--configure):
   installed open5gs-upf:amd64 package post-installation script subprocess returned error exit status 1

* [SBI] fixed wrong request-nf-type (#1650)

* [AMF] Do not send Deregistration Event to UDM when UE deregisters

According to TS 23.502, 4.2.2.2.2, AMF sends Registration event to UDM
in the following cases:
- If the AMF has changed since the last Registration procedure, or
- if the UE provides a SUPI which doesn't refer to a valid context in
the AMF,
- or if the UE registers to the same AMF it has already registered
to a non- 3GPP access (i.e. the UE is registered over a non-3GPP access
and initiates this Registration procedure to add a 3GPP access).

In case that UE re-registers to the network with a GUTI, it bypasses
authentication check to the AUSF. In this case, AMF does not send
Registration event to UDM.
Consequently, when UE deregisters again, AMF would send a Deregistration
Event to a UDM, which does not have a context for it.

3GPP standard does not say when AMF sends Deregistration Event to UDM,
only that it is optional.

These (De-)Registration events are for (de-)registering AMF to the UDM
for serving the UE. And not for (de-)registering UE itself for purpose
of tracking when UE is registered on the network.

This partially reverts commit 7be7029ac40b2eecbf70564d5306f85dafa2b848

* [NAS] modify library to include both directions of deregistration requests

Definitions in NAS library now include both directions of deregistration
requests/accepts - from UE and from network.

* [SBI] Add support for DeregistrationData in SBI messages

* [AMF] Handle namf-callback DeregNotify message from UDM

UDM may send a Deregistration Notification to AMF, to deregister
specific UE from the network - Network-Initiated Deregistration.
Deregistration procedure includes sending Deregistration Request to UE,
starting a timer T3522, releasing PDU sessions from SMF, releasing PCF
policies from PCF, and waiting for Deregistration Accept from UE.

Not yet implemented is:
- to prevent deregistration of UE in case it has any emergency sessions,
- page UE when UE is in IDLE mode.

* [SBI] incrased session pool of server (#1652)

* [CORE] Increased memory pool for poll (#1652)

* [SCP] Support of Indirect Communication

* [asn1c] rework aper from mouse07410/asn1c#94

Merge @pespin the following work
- mouse07410/asn1c#93
- mouse07410/asn1c#100

* [AMF] Fixed 5GMM cause in Reject message (#1660)

When a UE that requests slices tries to connect and there are no slices configured, the reject message is:

5GMM cause = 0x7 (5GS Services not allowed)

however it should be:

5GMM cause = 0x3e (No network slices available)

All 5GMM cause value in reject message is reviewed in this commit

* Fixed ASSERT when context has already been removed

* fixed the memory leak in test program

* Fixed the crash in UERANSIM 500 test (#1652)

* Oops! Redundant code is removed (#1652)

* Add missing pkbuf_free() (#1652)

* Refactor for the UERANSIM 500 test (#1652)

* Add more protection code for (#1652)

* [tests] Fix running unit tests inside docker environment

The issue was introduced with the commit, which builds Open5GS from
local sources instead of downloading them each time from Github.

Fixes: d2cbcf711 (\"[build] Use local sources to build applications (#1583)\")

* [SBI] Add function to request NF Instance from NRF by providing it's Instance Id

* [SMF] Send PDU Session Establish Accept to serving AMF

In case there are multiple AMF registered to NRF, SMF would pick only
the first AMF from the list.
In the case of sending PDU Session Establishment Accept from SMF to
AMF, this would mean a high chance of failure since the AMF might
be different than the original requester, and would not know about a
particular UE.

Modify SMF to use ServingNfId field from original request
SmContextCreateData from AMF to determine to which AMF should it send
PDU Session Establishment Accept message.

* Set default Network-Access-Mode to 0

For HSS's which do not include the NAM, the MME should not treat this as a fatal error.  MME should just assume PACKET_AND_CIRCUIT (0), as was decided in a previous PR.

* [MME] Handle Charging Characteristics

Found no support for HSS provided charging characteristics.  Following TS32.251 A.4:
- Use PDN level CC, if one wasn't provided then use subscription level CC
- Don't send CC in S11 if it wasn't included

* Moving handling of assigning sub level cc into the pdn to s11.

* Support Discovery Optional Parameter (#1671)

To support target-nf-instance-id in the discovery,
Discovery optional parameter is implemeted

* Oops! Warning removed!

* Refine code of discovery option param (#1671)

* Release v2.4.9

* [MME] Introduce support for S6a Cancel Location Request

- Added diameter dictionary definitions for Cancel Location
- Cancel Location will completely remove UE from MME, allow for a fresh IMSI attach to occur on next attempt.
- T3422 is used for detach request.
- Added new handling for s6a events in mme-sm, as not all s6a messages are at attach now.  Maybe there's something in a state machine I should've been using here instead of a new flag?

- Testing was completed with UE in idle and connected.  With CLR flags indicating re-attach required and without.  Also sending CLR after UE detach.  And then sending again when mme_ue is empty.

* Refact paging module (#1676)

* [MME] Changed S1AP_Cause in S1AP Release (#1676)

S1AP_CauseNas_detach -> S1AP_CauseNas_normal_release

* [SBI] Fixed nf_instance memory leak

- Rollback commit ed3444eef5e9e57705645b500dbd6c5af453703f
- Do not modify reference count when REGISTER/DEREGISTER notified from NRF

* [PFCP] Revert Changes 5e18b2b

* [MME+HSS] AVP Occurring Too Many Times

Do not Set Origin-Hosts with fd_msg_rescode_set before potential use of ogs_diam_message_experimental_rescode_set.  This results in multiple Origin-Host/Realm AVPs.

* [Diameter] Fixed Coding convention (#1680)

* [NRF] Fixed the nfInstanceUri (#1683)

* [PFCP] Revert Changes 5e18b2b and d21e9aa

To protect malicious or buggy, we need to check that session context is NULL.

* Changed configuration name from gnb to peer

And restored gtp_peer configuration

* [GTP] gtp_peer override the pool size of GTP node

* [MME] Changed CauseNas_detach in DETACH (#1676)

* [SBI] Increased the max stream number

* [SBI] CLIENT max concurrent streams to 16384

* Move src/../nf-sm.[ch] to lib/sbi/nf-sm.[ch]

* [PFCP] Fixed security protection

Check the length to prevent buffer overflow attacks.

* Lower Linux version cannot change HTTP2 max stream

CURLMOPT_MAX_CONCURRENT_STREAMS can be supported as of curl 7.67.0

* [SMF]: Update stored PCO IE requested in GTPv2 over S5c in SMF context

As per 3GPP TS 29.274 version 10.5.0, section 7.2.9 and 7.2.10,
Only if PCO IE is included in Delete Session Request then it
must be present in Delete Session Response.

In order to reflect on whether the request contained PCO IE or not
the SMF context containing the GTP request needs to be updated
i.e. update if present else clear the contents

* [SMF]: Update stored PCO IE requested over Gn in SMF context

As per 3GPP TS 29.060 version 15.3.0, section 7.3.3, 7.3.4, 7.3.5 and 7.3.6

Only if PCO IE is included in Update/Delete PDP Context Request then it
must be present in Update/Delete PDP Context Response.

In order to reflect on whether the request contained PCO IE or not
the SMF context containing the GTP request needs to be updated
i.e. update if present else clear the contents

* Update docs @nickvsnetworking and @@s5uishida

* Update docs @s5uishida

* Removed duplicated document link

* Fixed Defects reported by Coverity Scan

* [DOCS] Updated if subscribers changed [#1694]

* [PFCP] security vulnerability continued in d99491a

* [MME] Cancel Location Handling (#1698)

* CLR while idle is broken after https://github.com/open5gs/open5gs/commit/7031856cd779af0129ca444e18bbe2ed5db9ff32

Cancel Location Request arriving while UE is idle will not proceed to paging due to this check for S1 connection.  Using new flag \"isAnswer\" to bypass this check to allow paging to occur when we are not doing a AIA/ULA related procedure.

* No Context Setup is required when sending the detach request.  If the paging was due to wanting to send a Detach Request to the UE, then we fast track to sending the detach request.

* emm-sm.c:
In the case of MME initiated detach while UE is idle, there is no initial conext setup.  We go right from the service request after paging into sending the detach request.  TS23.401

mme-path.c:
Using nas_eps.type in the case of MME Initiated Detach while UE is idle does not work.  nas_eps.type would represent the service request.

mme-s11-handler.c:
After S11 action, no action should be taken.  We want to wait for the detach accept from the UE before proceeding with the S1 release (detach).

* InitialContextSetup should occur for detach.

* [MME] Follow-up Cancel Location Handling (#1698)

* [MME] Fixed GTP transaction crash (#1696)

* [SGsAP] Changed message if Paging failed (#1701)

The problem occurred in the following scenario:

1. VLR sent PAGING-REQUEST to the MME
2. MME sent S1-Paging to the UE
3. Paging failed
4. MME responded SERVICE-REQUEST to the VLR
5. VLR sent DOWNLINK-UNITDATA to the MME
6. Even though there is no S1 Context,
   MME try to sent DownlinkNASTransport message to the UE.
7. So, the problem occurred.

I've changed the number 4 PAGING-REJECT instead of SERVICE-REQUEST.

* [MME] Detach removed MME-UE context (#1698)

* [MME] UE-initiated detach removes S1 only (#1698)

* [SMF] Fix abort on app exit when no Diameter configuration

In case that SMF was configured to run without Diameter, it would crash
on application exit due to uninitialized variables/pointers.

ERROR  pid:unnamed in fd_sess_handler_destroy@sessions.c:324: ERROR: Invalid parameter '(handler && ( ((*handler) != ((void *)0)) && ( ((struct session_handler *)(*handler))->eyec == 0x53554AD1) ))', 22
[smf] FATAL: smf_gx_final: Assertion `ret == 0' failed. (../src/smf/gx-path.c:1353)

* [MME] Dictionary Updates and IDR Support (#1714)

* Add Diameter Dictionary Elements

* Initial IDR Framework

* Resolve Compile Issues

* Moving Closer

* Compile error

* Somewhat Working stuffing Code

* Add Timestamp Changes

* Cleanup some of this code.  mme_s6a_handle_idr in s6a-handler.c removed for now, since it will only come in handy when IDR flag is set to request current location, which would involve breaking out into paging.  I think there's a few other things we can do just within fd-path first.

* further removal of mme_s6a_handle_idr

* Follow up on #1714

* Changed sprintf to ogs_snprintf

* Limited to 80 column

* [NRF] Fixed library load error

* [metrics] Fix double-free on application exit (#1717)

* [SBI] Support service-names in discovery option

* [SBI] Added config for service-names discovery

* diameter: Gx: add AVP 3GPP-Charging-Characteristics

The 3GPP-Charging-Characteristics is an operator specific AVP
(optional). The 3GPP-Charging-Characteristics can be filled by the HSS
and pass through to the Gx interface.

See ETSI 29.212 5.4.0.1 for further details.

* [SMF] send 3GPP-Charging-Characteristics on Gx if received on S5/8c

The 3GPP-Charging-Characteristics is an operator specific AVP
(optional). The 3GPP-Charging-Characteristics can be filled by the HSS
and forwarded by the MME towards the SMF.

* Follow up on #1715

* Changed <TAB> to <SPACE>*4

* Changed snprintf to ogs_snprintf

* [Conf] Changed MTU size from 1500 to 1400

* [SMF] fixup send 3GPP-Charging-Characteristics on Gx if received on S5/8c

- Gy instead of Gx AVP was used.
- Use correct avp position and avp variables.

Fixes: 657eef9169af (\"[SMF] send 3GPP-Charging-Characteristics on Gx if received on S5/8c\")

* Added Service-based NF discovery

== Known limitation ==
Placing npcf-smpolicycontrol and pcf-policyauthorization
in different NFs is not supported. Both npcf-smpolicycontrol
and pcf-policyauthorization should be placed in the same NF.

* [ALL] Removing trailing whitespace and tab

* [MME] Fixed buffer overflow (#1728)

* Added simple test program

./tests/registration/registration simple-test
./tests/vonr/vonr simple-test
./tests/attach/attach simple-test
./tests/volte/volte simple-test

* [SMF] Handle upCnxState=ACTIVATING by replying with 200 instead of 204

According to TS 29.502 5.2.2.3.2.2., we should reply with a 200 response
including the upCnxState attribute.

* Follow-up on #1729

* [SBI] Send NF discovery query with service-names delimited with comma

OpenAPI specification for sending NF discovery query with
\"service-names\" parameter is defined as folowing:

- name: service-names
  ...
  style: form
  explode: false

According to OpenAPI specification, this means array items
should be delimited with a comma character (example: /users?id=3,4,5).

* [PCF] Check NF service configuration

* npcf-smpolicycontrol - enabled or disabled
* npcf-policyauthorization - enabled or disabled

Only one of npcf-smpolicycontrol and npcf-policyauthorization cannot be enabled. (../src/pcf/sbi-path.c:151)

They can be enabled or disabled together.

* [CORE] Check if timer is double free in SBI module

* removing extra lines

I did not find the purpose of their use

* [AMF] Accept Deregistration Notification from UDM only for registered UE (#1737)

Add additional check when receiving Deregistration Notification from
UDM. UE should already be in registered state before accepting the
request and deregistering the UE.

Also add additional check that PCF association policy exists before
sending a delete request to PCF.

* When using longer APN name, it is obscured due to short field.

* Also format for pcc_rule.  UE and SMF look okay as medium_data as first section.

* Minor typo fix

* Support service-based NF subscription

* [AMF] Handle APN/DNN names as case-insensitive

In case that APN name sent from UE does not case-match with the one
configured in the database, AMF would reject the registration with the
message:

[gmm] WARNING: [imsi-xxx] DNN Not Supported OR Not Subscribed in the
Slice (../src/amf/gmm-handler.c:1051)

* Follow-up on #1747

* Release v2.4.10

* Added Release Notes for v2.4.10

* Introduce Cancel Location and Insert Subscriber Data features to HSS. (#1744)

* Introduce Cancel Location and Insert Subscriber Data features to HSS.
* HSS database will keep track of last known MME and Update Time
* Purged UE flag is established in HSS for future PUR handling
* HSS Thread will connect to database and watch change stream
  mongoDB must be configured with a Replica Set to use this
* HSS will send IDR if subscription data changes
* HSS will send CLR to old MME if MME host or realm changes
* Function created to allow ULA and IDR to generate Subscription-Data AVP
* MME Hostname and Realm shown in WebUI

* Resolve freeDiameter errors

During a ULR, if database does not contain a last known MME, a CLR is being sent to a Null destination.  This will ensure that a destination is available in the database before sending the CLR.

* Removed change streams.  Added PUR handling.

* newline needed at end of file.

* Removed temp variable.

* * Change WebUI to 2x2 display
* Including UE Purged indicator
* Using pointers in ogs_subscription_data_t
* better memory mangement with pointers
* Tweak to Destination used by hss_s6a_send_idr to use last known MME

* Check for null mme_host and mme_realms

Do this before trying to compare the strings.

* Follow-up on #1744

* [SMF] Wait for both N1&N2 release signals before releasing session

When UE would send a request to release PDU session, AMF would
eventually send \"PDU Session Resource Release Command\" downlink to both
UE (N1) and gNB (N2). Each UE and gNB would then reply with \"PDU Session
Resource Release Response\" indicating they released their own resources.

Usually the first one to respond would be gNB. SMF made an assumption
that this would always be the case. And it would wait for signal that UE
resources were freed, before releasing session resources. But
occasionally the situation is that UE responds first, and SMF releases
resources prematurely.

This situation does not normally occur. But under high stress (100's of
UE PDU releases at the same time) this happens occasionally.
According to the standard, this situation is perfectly normal.

3GPP TS 23.502 Rel. 16
4.3.4.2 UE or network requested PDU Session Release for Non-Roaming and
Roaming with Local Breakout
...
Steps 8-10 may happen before steps 6-7.
...

* Added commercial 5G

* Add tested Ericsson gNodeBs and eNodeBs

* [DOC] Fixed alphabet order

* Sponsors logo updated to be dark-mode friendly

* Updated favicon.ico in Document

* [GTP/PFCP] TLV length more acceptable (#1780)

Acceptable even if the TLV length is smaller than expected

* [AMF] Add amfInfoList to NFProfile

The actual configured GUAMIs and TAIs are used to form NF profile.
Comparing to SMF the \"info\" section is not introduced into amf.yaml!
Each amf_id (region, set) produces a separate Info in the InfoList.
Guami list consists of all GUAMIs of particular Info.
taiList consists of all TAIs for all PLMNs of particular Info.

Examle:

amf.yaml:
    guami:
      - plmn_id:
          mcc: 999
          mnc: 70
        amf_id:
          region: 2
          set: 2
          pointer: 4
      - plmn_id:
          mcc: 001
          mnc: 01
        amf_id:
          region: 2
          set: 1
      - plmn_id:
          mcc: 001
          mnc: 02
        amf_id:
          region: 2
          set: 2
    tai:
      - plmn_id:
          mcc: 001
          mnc: 01
        tac: [1, 2, 3]
    tai:
      - plmn_id:
          mcc: 002
          mnc: 02
        tac: 4
      - plmn_id:
          mcc: 001
          mnc: 02
        tac: 10
    tai:
      - plmn_id:
          mcc: 004
          mnc: 04
        tac: [6, 7]
      - plmn_id:
          mcc: 005
          mnc: 05
        tac: 8
      - plmn_id:
          mcc: 999
          mnc: 70
        tac: [9, 10]

\"amfInfoList\":  {
        \"1\":    {
                \"amfSetId\":     \"002\",
                \"amfRegionId\":  \"02\",
                \"guamiList\":    [{
                                \"plmnId\":       {
                                        \"mcc\":  \"999\",
                                        \"mnc\":  \"70\"
                                },
                                \"amfId\":        \"020084\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"02\"
                                },
                                \"amfId\":        \"020080\"
                        }],
                \"taiList\":      [{
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"02\"
                                },
                                \"tac\":  \"00000a\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"999\",
                                        \"mnc\":  \"70\"
                                },
                                \"tac\":  \"000009\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"999\",
                                        \"mnc\":  \"70\"
                                },
                                \"tac\":  \"00000a\"
                        }]
        },
        \"2\":    {
                \"amfSetId\":     \"001\",
                \"amfRegionId\":  \"02\",
                \"guamiList\":    [{
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"01\"
                                },
                                \"amfId\":        \"020040\"
                        }],
                \"taiList\":      [{
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"01\"
                                },
                                \"tac\":  \"000001\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"01\"
                                },
                                \"tac\":  \"000002\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"01\"
                                },
                                \"tac\":  \"000003\"
                        }]
        }
}

* Follow-up on #1757

* [HSS] Enable Change Streams (#1758)

* [HSS] Enable Change Streams
* Enable Events and Timers in HSS
* Integrate change streams in dbi
* mongodb should be configured with replica sets enabled to use feature
* Change streams are optional in HSS
* Timer will poll change stream for changes in the database
* As changes are detected, event is created to perform the correct
  action

* Changes made as suggested

* Follow-up on #1758

* Update document

* [TLV] Added more debug information (#1767)

* Fixed HTTP2 crashes for random JSON data (#1769)

* [core] fix timer overflow on 32bit systems (#16)

must cast ts.tv_sec to 64bits before we multiply it to prevent 32bit math and overflow

* Follow-up on #1770

* [SGWC] Fixed a crash (#1765)

Session context could be deleted before a response message is not
received from SMF

* add addr/port to pfcp assoc/de-assoc logs (#40)

pfcp association log adds addr/port

* [GTP] Changes the print message (#1772)

* [config,metrics] Move metrics configuration section under respective NF section

Without this change, using metrics with core setup configurations
(configs/vonr.yaml for example) would not be possible. Having one
metrics section for whole config file causes every NF to start metrics
server on same port causing an abort.

* Follow-on up #1754

* [DOC] iptable setting for security (#1768)

* [MME] Added protection code if no PDN-Type (#1756)

* Changes new GA4 in Google Analytics

* Commercial Term by NeoPlane - https://neoplane.io/

* Fix UL and DL URR Usage Report

* Follow-on up #1793

* [AMF] Fix for switching state when sending Deregistration Request fails

Provide pointer to state machine, instead of pointer to timer structure.
Bug was noticed when switching compiler optimization to -O2.

* [5GC] Fixed session deletion in a BSF (#1725)

* [UPF] test code for unspecified address (#1776)

* [Security] Fixed a crash for port scanning (#1767)

* Release v2.4.11

* Added Release Notes for v2.4.11

* [MME] Support for Insert Subscriber Data (#1794)

* [MME] Support for Insert Subscriber Data

* Supported AVPs in IDR will overwrite existing subscription information
* Provide error on partial APN updates
* IDR and ULA use same function to process AVPs
* Move subdatamask values into s6a, so both HSS and MME can use them
* Updates are not actioned at this time.  A Re-attach is required for
  most changes to take effect

* Memory issue on IDR exceptions

* Remove of handling MSIDSN change until DSR is used

* Follow-on up #1794

* [SBI] Client Request timeout

TS29.500
Ch 6.11 Detection and handling of late arriving requests

In Open5GS, this part was hard-corded.

HTTP2 Client sends a request and waits for 10 seconds.
If no response is received from the HTTP2 Server,
HTTP2 Client performs the exception handling.

In this commit, HTTP2 client sends Header with setting Max-Rsp-Time to 10 seconds.
However, HTTP2 server has not yet been implemented to process this value.
The server is still processing using hard-corded values (10 seconds).

* [MME] Cancel Location while Idle (#1797)

* Cancel Location while Idle Fix

* Forgot about SGSAP on MME Change.

Added \"action\" to sgsap_send_detach..

* Make handle_clr uniform with other handlers

* Added Robustness for Any Detach Type

* Memory wasn't freed upon CLR for unknown IMSIs

* Moving MME Detach to new PR

* Follow-up on #1797

* ogs_info swaps CP and UP SEIDs

* Follow-up on #1797

* fix dropped_dl_traffic_threshold ie.

* [AMF,UDM] Add support to subscribe to SDM changes

AMF subscribes to UDM for each registered UE.

At the moment, UDM does not send callback to AMF when any of the UE's
properties in the database changes.
At the moment, AMF does properly parse the ModificationNotification, but
does not do anything useful.

* [SMF] Update PFCP report error situation (#1819)

* Revert the previous commit on #1797

* Updated SBI module

- Introduced NF_INSTANCE_ID/NF_INSTANCE_TYPE
- Skip SCP in configuration validation

* [AMF] Increase size of TMSI pool

Each UE context has 'current' and 'next' TMSI values. AMF first
allocates the 'next' value, before confirming it and releasing the
'previous'. This means that we potentially need pool size of 2x the
amount of maximum configured UE.

Without this change, AMF would crash in case that there are 'x'
configured maximum amount of UE, and there are already 'x' registered
UE.

[gmm] INFO: Registration request (../src/amf/gmm-sm.c:135)
[gmm] INFO: [suci-0-001-01-1234-0-1-1000000000]    SUCI (../src/amf/gmm-handler.c:149)
[gmm] DEBUG:     OLD TSC[UE:0,AMF:0] KSI[UE:7,AMF:0] (../src/amf/gmm-handler.c:179)
[gmm] DEBUG:     NEW TSC[UE:0,AMF:0] KSI[UE:7,AMF:0] (../src/amf/gmm-handler.c:186)
[amf] FATAL: amf_m_tmsi_alloc: Assertion `m_tmsi' failed. (../src/amf/context.c:2160)
[core] FATAL: backtrace() returned 13 addresses (../lib/core/ogs-abort.c:37)

* [AMF] Reject registration requests when pool for UE contexts is empty

AMF does not crash anymore when a new UE registration request arrives,
and there is no available space left in UE context pool. Now it just
rejects the request with an error.

* Follow-up on #1828

* Follow-up on #1827

* [DBI] Disable Change Streams with mongo Version

Support for change stream is only available in mongoc >=1.9.0
- Disabled related functions in dbi.
Support for bson to json used in debug statement only in libbson >=1.7.0
- Simple debug message in lower versions

* Follow-up on #1827

* Update README.md

Signed-off-by: Networkmama <networkmama12@gmail.com>
Co-authored-by: Sukchan Lee <acetcom@gmail.com>
Co-authored-by: Pau Espin Pedrol <pespin@sysmocom.de>
Co-authored-by: Bostjan Meglic <103102696+bmeglicit@users.noreply.github.com>
Co-authored-by: Networkmama <networkmama12@gmail.com>
Co-authored-by: Bostjan Meglic <b.meglic@iskratel.si>
Co-authored-by: Oliver Smith <osmith@sysmocom.de>
Co-authored-by: jmasterfunk84 <48972964+jmasterfunk84@users.noreply.github.com>
Co-authored-by: herlesupreeth <herlesupreeth@gmail.com>
Co-authored-by: Alexander Couzens <lynxis@fe80.eu>
Co-authored-by: mitmitmitm <m.rihtarsic@iskratel.si>
Co-authored-by: EugeneBogush <eugeneb2008@gmail.com>
Co-authored-by: neg2led <4232981+neg2led@users.noreply.github.com>
Co-authored-by: Gaber Stare <g.stare@iskratel.si>
Co-authored-by: Spencer Sevilla <spencer.builds.networks@gmail.com>
Co-authored-by: Dibas Das <dibasdas02@gmail.com>
Co-authored-by: safaorhann <safa.orhan@b-ulltech.com>")[#1](https://github.com/securitylab-repository/open5gs_ciot/pull/1)[)](/securitylab-repository/open5gs_ciot/commit/fdfe2c951870458716094018f75ebc5d298f3bd7 "Update repo to open5gs/open5gs main (#1)

* Initialize pgw_s5u_teid (#1559)

* [SMF] Gy: Send Multiple-Services-Indicator AVP only during Initial CCR (#1616)

Gy (3GPP TS 32.299 ) refers to AVP in DCCA (RFC4006).

RFC4006 5.1.2:
\"[...] by including the Multiple-Services-Indicator AVP in the first
interrogation.\"

Nokia's infocenter documentation also states it's sent during Initial CCR
only: \"(CCR-I only)\".

* [SBI] Fix memory leak for nghttp2 session (#1618)

Delete nghttp2 session to prevent memory leaks.
The issue was detected using valgrind.

* [CORE] fsm: Add asserts to validate ogs_fsm_t is not null (#1619)

* Change Default MCC/MNC 901/70 -> 999/70 (#1331)

* [SMF] track and fix scenario where gtp node mempool becomes full (#1622)

* [SMF] Avoid abort() if gtp_node mempool becomes full

Related: https://github.com/open5gs/open5gs/issues/1621

* [SMF] metrics: Add new ctr tracking gtp_node allocation failures

This metrics is useful to track whether at some point the mempool went
full, so that config needs to be updated to increase the mempool size.

* [SGWC,SMF] Add specific config opt max.gtp_peer to set gtp_node mempool size (#1623)

This is needed specially for SMFs handling a pool of SGWs.

* [UPF] Avoid crash if no default subnet configured (#1624)

In that case, ogs_pfcp_ue_ip_alloc() will fail with  the error message
\"CHECK CONFIGURATION: Cannot find subnet [...]\" and the assert will make
upf crash.
That's not desirable, let's keep it running and simply reject the
request. The error log is big enoguh to find out.

* [SMF] pfcp-sm: Fix ogs_fsm_dispatch() on NULL sess (#1628)

It was spotted that if DeleteSessionReq sent by SMF is answered by UPF
with cause=\"Session context not found\", then it contains SEID=0 (this is
correct as per specs). Hence, since SEID=0 session is not looked up, so
sess=NULL.

A follow up commit improves the situation by looking up the SEID in the
originating request message in that case.

* [SMF] Set v4/6 flag in F-TEID IE request type (#1625)

Signed-off-by: Networkmama <networkmama12@gmail.com>

* Set v4/v6 flags in local F-TEID (#1625)

* [PFCP] Added DNN/APN in FAR (#1629, #1630)

* [PFCP] Added Network Instance to CP-UP FAR (#1630)

* [SMF] Gn: QoS Profile and PCO IE improvements (#1631)

* [SMF] pfcp: Retrieve sess when response with SEID=0 is received (#1620)

3GPP TS 29.244 7.2.2.4.2 documents that the peer will set SEID=0 in the
response when we request something for a session not existing at the peer.
If that's the case, we still want to locate the local session which
originated the request, so let's store the local SEID in the xact when
submitting the message, so that we can retrieve the related SEID and
find the session if we receive SEID=0.

* [SGWC] pfcp: Retrieve sess when SEID=0 (#1620)

* [GTP] context when TEID=0 (#1620, #1606, #1594)

* [SCTP] Add protection code jumbo frame (#1632)

* [GTP] Avoid abort if ogs_gtp_node_new() returns NULL (#1633)

* [GTP] Avoid abort if ogs_gtp_node_new() returns NULL

* [SGWC] Avoid abort if ogs_gtp_node_add_by_addr() returns NULL

* [GTP] avoid abort for ogs_gtp_node_new() (#1633)

* [UPF] N4: Remove unnecessary assert (#1634)

* Changes MAX TLV MORE to 16

OGS_MAX_NUM_OF_PDR is 16, but OGS_TLV_MAX_MORE is 8.
To match the size of two macros, increased OGS_TLV_MAX_MORE to 16.

* Revert \"[GTP] context when TEID=0 (#1620, #1606, #1594)\"

This reverts commit 0d61f7a7f905a865bcd8be9382ffabeb817f8464.

* Revert \"[SGWC] pfcp: Retrieve sess when SEID=0 (#1620)\"

This reverts commit 970056302390471e7089a7a2ed08bcf979fd057d.

* [PFCP] Refine error code path without assertion

Refer to #1635, #1620

* [GTP] Refine error code path without assertion

Refer to #1635, #1620, #1606, #1594

* Fixed a crash when slice/session overflow (#1637)

* [MISC] Add support for static code analysis

Static code analysis can be executed with following commands:
  meson build
  ninja -C build analyze-cppcheck
  ninja -C build analyze-clang-tidy

These commands are available only if additional tools are installed:
  - cppcheck
  - clang-tidy
  - clang-tools is optional if you want to paralelize the clang-tidy

In case of cppcheck analysis, a file called build/cppchecklog.log is
created with the analysis results.

In case of clang-tidy analysis, some checks are disabled. See file
.clang-tidy, and reenable them if you see fit.
Also it does not scan all the files in the project, since some of them
are imported from other sources. It does not scan any sources under:
  - subprojects/
  - lib/asn1c/
  - lib/ipfw/

* [ALL] Fix differences in function parameter names between definition and declaration

* [CORE] Fix detection of a failed memory allocation

* [CORE] Added memory check (#1638)

* [PFCP] Fixed a endianness Apply Action (#1640)

* [SMF] copy UE ip address to uplink PDR rules.

This helps UPF to add ACL based on src ip

Signed-off-by: Networkmama <networkmama12@gmail.com>

* [PFCP] Added UE IP address in the EPC (#1642)

* d/open5gs-upf.postinst: don't restart service in chroot

Don't attempt to restart systemd-networkd if systemd is not running
(e.g. installing open5gs inside a chroot).

Fix for:
  System has not been booted with systemd as init system (PID 1). Can't operate.
  Failed to connect to bus: Host is down
  dpkg: error processing package open5gs-upf:amd64 (--configure):
   installed open5gs-upf:amd64 package post-installation script subprocess returned error exit status 1

* [SBI] fixed wrong request-nf-type (#1650)

* [AMF] Do not send Deregistration Event to UDM when UE deregisters

According to TS 23.502, 4.2.2.2.2, AMF sends Registration event to UDM
in the following cases:
- If the AMF has changed since the last Registration procedure, or
- if the UE provides a SUPI which doesn't refer to a valid context in
the AMF,
- or if the UE registers to the same AMF it has already registered
to a non- 3GPP access (i.e. the UE is registered over a non-3GPP access
and initiates this Registration procedure to add a 3GPP access).

In case that UE re-registers to the network with a GUTI, it bypasses
authentication check to the AUSF. In this case, AMF does not send
Registration event to UDM.
Consequently, when UE deregisters again, AMF would send a Deregistration
Event to a UDM, which does not have a context for it.

3GPP standard does not say when AMF sends Deregistration Event to UDM,
only that it is optional.

These (De-)Registration events are for (de-)registering AMF to the UDM
for serving the UE. And not for (de-)registering UE itself for purpose
of tracking when UE is registered on the network.

This partially reverts commit 7be7029ac40b2eecbf70564d5306f85dafa2b848

* [NAS] modify library to include both directions of deregistration requests

Definitions in NAS library now include both directions of deregistration
requests/accepts - from UE and from network.

* [SBI] Add support for DeregistrationData in SBI messages

* [AMF] Handle namf-callback DeregNotify message from UDM

UDM may send a Deregistration Notification to AMF, to deregister
specific UE from the network - Network-Initiated Deregistration.
Deregistration procedure includes sending Deregistration Request to UE,
starting a timer T3522, releasing PDU sessions from SMF, releasing PCF
policies from PCF, and waiting for Deregistration Accept from UE.

Not yet implemented is:
- to prevent deregistration of UE in case it has any emergency sessions,
- page UE when UE is in IDLE mode.

* [SBI] incrased session pool of server (#1652)

* [CORE] Increased memory pool for poll (#1652)

* [SCP] Support of Indirect Communication

* [asn1c] rework aper from mouse07410/asn1c#94

Merge @pespin the following work
- mouse07410/asn1c#93
- mouse07410/asn1c#100

* [AMF] Fixed 5GMM cause in Reject message (#1660)

When a UE that requests slices tries to connect and there are no slices configured, the reject message is:

5GMM cause = 0x7 (5GS Services not allowed)

however it should be:

5GMM cause = 0x3e (No network slices available)

All 5GMM cause value in reject message is reviewed in this commit

* Fixed ASSERT when context has already been removed

* fixed the memory leak in test program

* Fixed the crash in UERANSIM 500 test (#1652)

* Oops! Redundant code is removed (#1652)

* Add missing pkbuf_free() (#1652)

* Refactor for the UERANSIM 500 test (#1652)

* Add more protection code for (#1652)

* [tests] Fix running unit tests inside docker environment

The issue was introduced with the commit, which builds Open5GS from
local sources instead of downloading them each time from Github.

Fixes: d2cbcf711 (\"[build] Use local sources to build applications (#1583)\")

* [SBI] Add function to request NF Instance from NRF by providing it's Instance Id

* [SMF] Send PDU Session Establish Accept to serving AMF

In case there are multiple AMF registered to NRF, SMF would pick only
the first AMF from the list.
In the case of sending PDU Session Establishment Accept from SMF to
AMF, this would mean a high chance of failure since the AMF might
be different than the original requester, and would not know about a
particular UE.

Modify SMF to use ServingNfId field from original request
SmContextCreateData from AMF to determine to which AMF should it send
PDU Session Establishment Accept message.

* Set default Network-Access-Mode to 0

For HSS's which do not include the NAM, the MME should not treat this as a fatal error.  MME should just assume PACKET_AND_CIRCUIT (0), as was decided in a previous PR.

* [MME] Handle Charging Characteristics

Found no support for HSS provided charging characteristics.  Following TS32.251 A.4:
- Use PDN level CC, if one wasn't provided then use subscription level CC
- Don't send CC in S11 if it wasn't included

* Moving handling of assigning sub level cc into the pdn to s11.

* Support Discovery Optional Parameter (#1671)

To support target-nf-instance-id in the discovery,
Discovery optional parameter is implemeted

* Oops! Warning removed!

* Refine code of discovery option param (#1671)

* Release v2.4.9

* [MME] Introduce support for S6a Cancel Location Request

- Added diameter dictionary definitions for Cancel Location
- Cancel Location will completely remove UE from MME, allow for a fresh IMSI attach to occur on next attempt.
- T3422 is used for detach request.
- Added new handling for s6a events in mme-sm, as not all s6a messages are at attach now.  Maybe there's something in a state machine I should've been using here instead of a new flag?

- Testing was completed with UE in idle and connected.  With CLR flags indicating re-attach required and without.  Also sending CLR after UE detach.  And then sending again when mme_ue is empty.

* Refact paging module (#1676)

* [MME] Changed S1AP_Cause in S1AP Release (#1676)

S1AP_CauseNas_detach -> S1AP_CauseNas_normal_release

* [SBI] Fixed nf_instance memory leak

- Rollback commit ed3444eef5e9e57705645b500dbd6c5af453703f
- Do not modify reference count when REGISTER/DEREGISTER notified from NRF

* [PFCP] Revert Changes 5e18b2b

* [MME+HSS] AVP Occurring Too Many Times

Do not Set Origin-Hosts with fd_msg_rescode_set before potential use of ogs_diam_message_experimental_rescode_set.  This results in multiple Origin-Host/Realm AVPs.

* [Diameter] Fixed Coding convention (#1680)

* [NRF] Fixed the nfInstanceUri (#1683)

* [PFCP] Revert Changes 5e18b2b and d21e9aa

To protect malicious or buggy, we need to check that session context is NULL.

* Changed configuration name from gnb to peer

And restored gtp_peer configuration

* [GTP] gtp_peer override the pool size of GTP node

* [MME] Changed CauseNas_detach in DETACH (#1676)

* [SBI] Increased the max stream number

* [SBI] CLIENT max concurrent streams to 16384

* Move src/../nf-sm.[ch] to lib/sbi/nf-sm.[ch]

* [PFCP] Fixed security protection

Check the length to prevent buffer overflow attacks.

* Lower Linux version cannot change HTTP2 max stream

CURLMOPT_MAX_CONCURRENT_STREAMS can be supported as of curl 7.67.0

* [SMF]: Update stored PCO IE requested in GTPv2 over S5c in SMF context

As per 3GPP TS 29.274 version 10.5.0, section 7.2.9 and 7.2.10,
Only if PCO IE is included in Delete Session Request then it
must be present in Delete Session Response.

In order to reflect on whether the request contained PCO IE or not
the SMF context containing the GTP request needs to be updated
i.e. update if present else clear the contents

* [SMF]: Update stored PCO IE requested over Gn in SMF context

As per 3GPP TS 29.060 version 15.3.0, section 7.3.3, 7.3.4, 7.3.5 and 7.3.6

Only if PCO IE is included in Update/Delete PDP Context Request then it
must be present in Update/Delete PDP Context Response.

In order to reflect on whether the request contained PCO IE or not
the SMF context containing the GTP request needs to be updated
i.e. update if present else clear the contents

* Update docs @nickvsnetworking and @@s5uishida

* Update docs @s5uishida

* Removed duplicated document link

* Fixed Defects reported by Coverity Scan

* [DOCS] Updated if subscribers changed [#1694]

* [PFCP] security vulnerability continued in d99491a

* [MME] Cancel Location Handling (#1698)

* CLR while idle is broken after https://github.com/open5gs/open5gs/commit/7031856cd779af0129ca444e18bbe2ed5db9ff32

Cancel Location Request arriving while UE is idle will not proceed to paging due to this check for S1 connection.  Using new flag \"isAnswer\" to bypass this check to allow paging to occur when we are not doing a AIA/ULA related procedure.

* No Context Setup is required when sending the detach request.  If the paging was due to wanting to send a Detach Request to the UE, then we fast track to sending the detach request.

* emm-sm.c:
In the case of MME initiated detach while UE is idle, there is no initial conext setup.  We go right from the service request after paging into sending the detach request.  TS23.401

mme-path.c:
Using nas_eps.type in the case of MME Initiated Detach while UE is idle does not work.  nas_eps.type would represent the service request.

mme-s11-handler.c:
After S11 action, no action should be taken.  We want to wait for the detach accept from the UE before proceeding with the S1 release (detach).

* InitialContextSetup should occur for detach.

* [MME] Follow-up Cancel Location Handling (#1698)

* [MME] Fixed GTP transaction crash (#1696)

* [SGsAP] Changed message if Paging failed (#1701)

The problem occurred in the following scenario:

1. VLR sent PAGING-REQUEST to the MME
2. MME sent S1-Paging to the UE
3. Paging failed
4. MME responded SERVICE-REQUEST to the VLR
5. VLR sent DOWNLINK-UNITDATA to the MME
6. Even though there is no S1 Context,
   MME try to sent DownlinkNASTransport message to the UE.
7. So, the problem occurred.

I've changed the number 4 PAGING-REJECT instead of SERVICE-REQUEST.

* [MME] Detach removed MME-UE context (#1698)

* [MME] UE-initiated detach removes S1 only (#1698)

* [SMF] Fix abort on app exit when no Diameter configuration

In case that SMF was configured to run without Diameter, it would crash
on application exit due to uninitialized variables/pointers.

ERROR  pid:unnamed in fd_sess_handler_destroy@sessions.c:324: ERROR: Invalid parameter '(handler && ( ((*handler) != ((void *)0)) && ( ((struct session_handler *)(*handler))->eyec == 0x53554AD1) ))', 22
[smf] FATAL: smf_gx_final: Assertion `ret == 0' failed. (../src/smf/gx-path.c:1353)

* [MME] Dictionary Updates and IDR Support (#1714)

* Add Diameter Dictionary Elements

* Initial IDR Framework

* Resolve Compile Issues

* Moving Closer

* Compile error

* Somewhat Working stuffing Code

* Add Timestamp Changes

* Cleanup some of this code.  mme_s6a_handle_idr in s6a-handler.c removed for now, since it will only come in handy when IDR flag is set to request current location, which would involve breaking out into paging.  I think there's a few other things we can do just within fd-path first.

* further removal of mme_s6a_handle_idr

* Follow up on #1714

* Changed sprintf to ogs_snprintf

* Limited to 80 column

* [NRF] Fixed library load error

* [metrics] Fix double-free on application exit (#1717)

* [SBI] Support service-names in discovery option

* [SBI] Added config for service-names discovery

* diameter: Gx: add AVP 3GPP-Charging-Characteristics

The 3GPP-Charging-Characteristics is an operator specific AVP
(optional). The 3GPP-Charging-Characteristics can be filled by the HSS
and pass through to the Gx interface.

See ETSI 29.212 5.4.0.1 for further details.

* [SMF] send 3GPP-Charging-Characteristics on Gx if received on S5/8c

The 3GPP-Charging-Characteristics is an operator specific AVP
(optional). The 3GPP-Charging-Characteristics can be filled by the HSS
and forwarded by the MME towards the SMF.

* Follow up on #1715

* Changed <TAB> to <SPACE>*4

* Changed snprintf to ogs_snprintf

* [Conf] Changed MTU size from 1500 to 1400

* [SMF] fixup send 3GPP-Charging-Characteristics on Gx if received on S5/8c

- Gy instead of Gx AVP was used.
- Use correct avp position and avp variables.

Fixes: 657eef9169af (\"[SMF] send 3GPP-Charging-Characteristics on Gx if received on S5/8c\")

* Added Service-based NF discovery

== Known limitation ==
Placing npcf-smpolicycontrol and pcf-policyauthorization
in different NFs is not supported. Both npcf-smpolicycontrol
and pcf-policyauthorization should be placed in the same NF.

* [ALL] Removing trailing whitespace and tab

* [MME] Fixed buffer overflow (#1728)

* Added simple test program

./tests/registration/registration simple-test
./tests/vonr/vonr simple-test
./tests/attach/attach simple-test
./tests/volte/volte simple-test

* [SMF] Handle upCnxState=ACTIVATING by replying with 200 instead of 204

According to TS 29.502 5.2.2.3.2.2., we should reply with a 200 response
including the upCnxState attribute.

* Follow-up on #1729

* [SBI] Send NF discovery query with service-names delimited with comma

OpenAPI specification for sending NF discovery query with
\"service-names\" parameter is defined as folowing:

- name: service-names
  ...
  style: form
  explode: false

According to OpenAPI specification, this means array items
should be delimited with a comma character (example: /users?id=3,4,5).

* [PCF] Check NF service configuration

* npcf-smpolicycontrol - enabled or disabled
* npcf-policyauthorization - enabled or disabled

Only one of npcf-smpolicycontrol and npcf-policyauthorization cannot be enabled. (../src/pcf/sbi-path.c:151)

They can be enabled or disabled together.

* [CORE] Check if timer is double free in SBI module

* removing extra lines

I did not find the purpose of their use

* [AMF] Accept Deregistration Notification from UDM only for registered UE (#1737)

Add additional check when receiving Deregistration Notification from
UDM. UE should already be in registered state before accepting the
request and deregistering the UE.

Also add additional check that PCF association policy exists before
sending a delete request to PCF.

* When using longer APN name, it is obscured due to short field.

* Also format for pcc_rule.  UE and SMF look okay as medium_data as first section.

* Minor typo fix

* Support service-based NF subscription

* [AMF] Handle APN/DNN names as case-insensitive

In case that APN name sent from UE does not case-match with the one
configured in the database, AMF would reject the registration with the
message:

[gmm] WARNING: [imsi-xxx] DNN Not Supported OR Not Subscribed in the
Slice (../src/amf/gmm-handler.c:1051)

* Follow-up on #1747

* Release v2.4.10

* Added Release Notes for v2.4.10

* Introduce Cancel Location and Insert Subscriber Data features to HSS. (#1744)

* Introduce Cancel Location and Insert Subscriber Data features to HSS.
* HSS database will keep track of last known MME and Update Time
* Purged UE flag is established in HSS for future PUR handling
* HSS Thread will connect to database and watch change stream
  mongoDB must be configured with a Replica Set to use this
* HSS will send IDR if subscription data changes
* HSS will send CLR to old MME if MME host or realm changes
* Function created to allow ULA and IDR to generate Subscription-Data AVP
* MME Hostname and Realm shown in WebUI

* Resolve freeDiameter errors

During a ULR, if database does not contain a last known MME, a CLR is being sent to a Null destination.  This will ensure that a destination is available in the database before sending the CLR.

* Removed change streams.  Added PUR handling.

* newline needed at end of file.

* Removed temp variable.

* * Change WebUI to 2x2 display
* Including UE Purged indicator
* Using pointers in ogs_subscription_data_t
* better memory mangement with pointers
* Tweak to Destination used by hss_s6a_send_idr to use last known MME

* Check for null mme_host and mme_realms

Do this before trying to compare the strings.

* Follow-up on #1744

* [SMF] Wait for both N1&N2 release signals before releasing session

When UE would send a request to release PDU session, AMF would
eventually send \"PDU Session Resource Release Command\" downlink to both
UE (N1) and gNB (N2). Each UE and gNB would then reply with \"PDU Session
Resource Release Response\" indicating they released their own resources.

Usually the first one to respond would be gNB. SMF made an assumption
that this would always be the case. And it would wait for signal that UE
resources were freed, before releasing session resources. But
occasionally the situation is that UE responds first, and SMF releases
resources prematurely.

This situation does not normally occur. But under high stress (100's of
UE PDU releases at the same time) this happens occasionally.
According to the standard, this situation is perfectly normal.

3GPP TS 23.502 Rel. 16
4.3.4.2 UE or network requested PDU Session Release for Non-Roaming and
Roaming with Local Breakout
...
Steps 8-10 may happen before steps 6-7.
...

* Added commercial 5G

* Add tested Ericsson gNodeBs and eNodeBs

* [DOC] Fixed alphabet order

* Sponsors logo updated to be dark-mode friendly

* Updated favicon.ico in Document

* [GTP/PFCP] TLV length more acceptable (#1780)

Acceptable even if the TLV length is smaller than expected

* [AMF] Add amfInfoList to NFProfile

The actual configured GUAMIs and TAIs are used to form NF profile.
Comparing to SMF the \"info\" section is not introduced into amf.yaml!
Each amf_id (region, set) produces a separate Info in the InfoList.
Guami list consists of all GUAMIs of particular Info.
taiList consists of all TAIs for all PLMNs of particular Info.

Examle:

amf.yaml:
    guami:
      - plmn_id:
          mcc: 999
          mnc: 70
        amf_id:
          region: 2
          set: 2
          pointer: 4
      - plmn_id:
          mcc: 001
          mnc: 01
        amf_id:
          region: 2
          set: 1
      - plmn_id:
          mcc: 001
          mnc: 02
        amf_id:
          region: 2
          set: 2
    tai:
      - plmn_id:
          mcc: 001
          mnc: 01
        tac: [1, 2, 3]
    tai:
      - plmn_id:
          mcc: 002
          mnc: 02
        tac: 4
      - plmn_id:
          mcc: 001
          mnc: 02
        tac: 10
    tai:
      - plmn_id:
          mcc: 004
          mnc: 04
        tac: [6, 7]
      - plmn_id:
          mcc: 005
          mnc: 05
        tac: 8
      - plmn_id:
          mcc: 999
          mnc: 70
        tac: [9, 10]

\"amfInfoList\":  {
        \"1\":    {
                \"amfSetId\":     \"002\",
                \"amfRegionId\":  \"02\",
                \"guamiList\":    [{
                                \"plmnId\":       {
                                        \"mcc\":  \"999\",
                                        \"mnc\":  \"70\"
                                },
                                \"amfId\":        \"020084\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"02\"
                                },
                                \"amfId\":        \"020080\"
                        }],
                \"taiList\":      [{
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"02\"
                                },
                                \"tac\":  \"00000a\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"999\",
                                        \"mnc\":  \"70\"
                                },
                                \"tac\":  \"000009\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"999\",
                                        \"mnc\":  \"70\"
                                },
                                \"tac\":  \"00000a\"
                        }]
        },
        \"2\":    {
                \"amfSetId\":     \"001\",
                \"amfRegionId\":  \"02\",
                \"guamiList\":    [{
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"01\"
                                },
                                \"amfId\":        \"020040\"
                        }],
                \"taiList\":      [{
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"01\"
                                },
                                \"tac\":  \"000001\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"01\"
                                },
                                \"tac\":  \"000002\"
                        }, {
                                \"plmnId\":       {
                                        \"mcc\":  \"001\",
                                        \"mnc\":  \"01\"
                                },
                                \"tac\":  \"000003\"
                        }]
        }
}

* Follow-up on #1757

* [HSS] Enable Change Streams (#1758)

* [HSS] Enable Change Streams
* Enable Events and Timers in HSS
* Integrate change streams in dbi
* mongodb should be configured with replica sets enabled to use feature
* Change streams are optional in HSS
* Timer will poll change stream for changes in the database
* As changes are detected, event is created to perform the correct
  action

* Changes made as suggested

* Follow-up on #1758

* Update document

* [TLV] Added more debug information (#1767)

* Fixed HTTP2 crashes for random JSON data (#1769)

* [core] fix timer overflow on 32bit systems (#16)

must cast ts.tv_sec to 64bits before we multiply it to prevent 32bit math and overflow

* Follow-up on #1770

* [SGWC] Fixed a crash (#1765)

Session context could be deleted before a response message is not
received from SMF

* add addr/port to pfcp assoc/de-assoc logs (#40)

pfcp association log adds addr/port

* [GTP] Changes the print message (#1772)

* [config,metrics] Move metrics configuration section under respective NF section

Without this change, using metrics with core setup configurations
(configs/vonr.yaml for example) would not be possible. Having one
metrics section for whole config file causes every NF to start metrics
server on same port causing an abort.

* Follow-on up #1754

* [DOC] iptable setting for security (#1768)

* [MME] Added protection code if no PDN-Type (#1756)

* Changes new GA4 in Google Analytics

* Commercial Term by NeoPlane - https://neoplane.io/

* Fix UL and DL URR Usage Report

* Follow-on up #1793

* [AMF] Fix for switching state when sending Deregistration Request fails

Provide pointer to state machine, instead of pointer to timer structure.
Bug was noticed when switching compiler optimization to -O2.

* [5GC] Fixed session deletion in a BSF (#1725)

* [UPF] test code for unspecified address (#1776)

* [Security] Fixed a crash for port scanning (#1767)

* Release v2.4.11

* Added Release Notes for v2.4.11

* [MME] Support for Insert Subscriber Data (#1794)

* [MME] Support for Insert Subscriber Data

* Supported AVPs in IDR will overwrite existing subscription information
* Provide error on partial APN updates
* IDR and ULA use same function to process AVPs
* Move subdatamask values into s6a, so both HSS and MME can use them
* Updates are not actioned at this time.  A Re-attach is required for
  most changes to take effect

* Memory issue on IDR exceptions

* Remove of handling MSIDSN change until DSR is used

* Follow-on up #1794

* [SBI] Client Request timeout

TS29.500
Ch 6.11 Detection and handling of late arriving requests

In Open5GS, this part was hard-corded.

HTTP2 Client sends a request and waits for 10 seconds.
If no response is received from the HTTP2 Server,
HTTP2 Client performs the exception handling.

In this commit, HTTP2 client sends Header with setting Max-Rsp-Time to 10 seconds.
However, HTTP2 server has not yet been implemented to process this value.
The server is still processing using hard-corded values (10 seconds).

* [MME] Cancel Location while Idle (#1797)

* Cancel Location while Idle Fix

* Forgot about SGSAP on MME Change.

Added \"action\" to sgsap_send_detach..

* Make handle_clr uniform with other handlers

* Added Robustness for Any Detach Type

* Memory wasn't freed upon CLR for unknown IMSIs

* Moving MME Detach to new PR

* Follow-up on #1797

* ogs_info swaps CP and UP SEIDs

* Follow-up on #1797

* fix dropped_dl_traffic_threshold ie.

* [AMF,UDM] Add support to subscribe to SDM changes

AMF subscribes to UDM for each registered UE.

At the moment, UDM does not send callback to AMF when any of the UE's
properties in the database changes.
At the moment, AMF does properly parse the ModificationNotification, but
does not do anything useful.

* [SMF] Update PFCP report error situation (#1819)

* Revert the previous commit on #1797

* Updated SBI module

- Introduced NF_INSTANCE_ID/NF_INSTANCE_TYPE
- Skip SCP in configuration validation

* [AMF] Increase size of TMSI pool

Each UE context has 'current' and 'next' TMSI values. AMF first
allocates the 'next' value, before confirming it and releasing the
'previous'. This means that we potentially need pool size of 2x the
amount of maximum configured UE.

Without this change, AMF would crash in case that there are 'x'
configured maximum amount of UE, and there are already 'x' registered
UE.

[gmm] INFO: Registration request (../src/amf/gmm-sm.c:135)
[gmm] INFO: [suci-0-001-01-1234-0-1-1000000000]    SUCI (../src/amf/gmm-handler.c:149)
[gmm] DEBUG:     OLD TSC[UE:0,AMF:0] KSI[UE:7,AMF:0] (../src/amf/gmm-handler.c:179)
[gmm] DEBUG:     NEW TSC[UE:0,AMF:0] KSI[UE:7,AMF:0] (../src/amf/gmm-handler.c:186)
[amf] FATAL: amf_m_tmsi_alloc: Assertion `m_tmsi' failed. (../src/amf/context.c:2160)
[core] FATAL: backtrace() returned 13 addresses (../lib/core/ogs-abort.c:37)

* [AMF] Reject registration requests when pool for UE contexts is empty

AMF does not crash anymore when a new UE registration request arrives,
and there is no available space left in UE context pool. Now it just
rejects the request with an error.

* Follow-up on #1828

* Follow-up on #1827

* [DBI] Disable Change Streams with mongo Version

Support for change stream is only available in mongoc >=1.9.0
- Disabled related functions in dbi.
Support for bson to json used in debug statement only in libbson >=1.7.0
- Simple debug message in lower versions

* Follow-up on #1827

* Update README.md

Signed-off-by: Networkmama <networkmama12@gmail.com>
Co-authored-by: Sukchan Lee <acetcom@gmail.com>
Co-authored-by: Pau Espin Pedrol <pespin@sysmocom.de>
Co-authored-by: Bostjan Meglic <103102696+bmeglicit@users.noreply.github.com>
Co-authored-by: Networkmama <networkmama12@gmail.com>
Co-authored-by: Bostjan Meglic <b.meglic@iskratel.si>
Co-authored-by: Oliver Smith <osmith@sysmocom.de>
Co-authored-by: jmasterfunk84 <48972964+jmasterfunk84@users.noreply.github.com>
Co-authored-by: herlesupreeth <herlesupreeth@gmail.com>
Co-authored-by: Alexander Couzens <lynxis@fe80.eu>
Co-authored-by: mitmitmitm <m.rihtarsic@iskratel.si>
Co-authored-by: EugeneBogush <eugeneb2008@gmail.com>
Co-authored-by: neg2led <4232981+neg2led@users.noreply.github.com>
Co-authored-by: Gaber Stare <g.stare@iskratel.si>
Co-authored-by: Spencer Sevilla <spencer.builds.networks@gmail.com>
Co-authored-by: Dibas Das <dibasdas02@gmail.com>
Co-authored-by: safaorhann <safa.orhan@b-ulltech.com>")`
…

`[fdfe2c9](/securitylab-repository/open5gs_ciot/commit/fdfe2c951870458716094018f75ebc5d298f3bd7)`

```
* Initialize pgw_s5u_teid ([open5gs#1559](https://github.com/open5gs/open5gs/issues/1559))

* [SMF] Gy: Send Multiple-Services-Indicator AVP only during Initial CCR ([open5gs#1616](https://github.com/open5gs/open5gs/pull/1616))

Gy (3GPP TS 32.299 ) refers to AVP in DCCA (RFC4006).

RFC4006 5.1.2:
"[...] by including the Multiple-Services-Indicator AVP in the first
interrogation."

Nokia's infocenter documentation also states it's sent during Initial CCR
only: "(CCR-I only)".

* [SBI] Fix memory leak for nghttp2 session ([open5gs#1618](https://github.com/open5gs/open5gs/pull/1618))

Delete nghttp2 session to prevent memory leaks.
The issue was detected using valgrind.

* [CORE] fsm: Add asserts to validate ogs_fsm_t is not null ([open5gs#1619](https://github.com/open5gs/open5gs/pull/1619))

* Change Default MCC/MNC 901/70 -> 999/70 ([open5gs#1331](https://github.com/open5gs/open5gs/pull/1331))

* [SMF] track and fix scenario where gtp node mempool becomes full ([open5gs#1622](https://github.com/open5gs/open5gs/pull/1622))

* [SMF] Avoid abort() if gtp_node mempool becomes full

Related: [open5gs#1621](https://github.com/open5gs/open5gs/issues/1621)

* [SMF] metrics: Add new ctr tracking gtp_node allocation failures

This metrics is useful to track whether at some point the mempool went
full, so that config needs to be updated to increase the mempool size.

* [SGWC,SMF] Add specific config opt max.gtp_peer to set gtp_node mempool size ([open5gs#1623](https://github.com/open5gs/open5gs/pull/1623))

This is needed specially for SMFs handling a pool of SGWs.

* [UPF] Avoid crash if no default subnet configured ([open5gs#1624](https://github.com/open5gs/open5gs/pull/1624))

In that case, ogs_pfcp_ue_ip_alloc() will fail with  the error message
"CHECK CONFIGURATION: Cannot find subnet [...]" and the assert will make
upf crash.
That's not desirable, let's keep it running and simply reject the
request. The error log is big enoguh to find out.

* [SMF] pfcp-sm: Fix ogs_fsm_dispatch() on NULL sess ([open5gs#1628](https://github.com/open5gs/open5gs/pull/1628))

It was spotted that if DeleteSessionReq sent by SMF is answered by UPF
with cause="Session context not found", then it contains SEID=0 (this is
correct as per specs). Hence, since SEID=0 session is not looked up, so
sess=NULL.

A follow up commit improves the situation by looking up the SEID in the
originating request message in that case.

* [SMF] Set v4/6 flag in F-TEID IE request type ([open5gs#1625](https://github.com/open5gs/open5gs/pull/1625))

Signed-off-by: Networkmama <networkmama12@gmail.com>

* Set v4/v6 flags in local F-TEID ([open5gs#1625](https://github.com/open5gs/open5gs/pull/1625))

* [PFCP] Added DNN/APN in FAR ([open5gs#1629](https://github.com/open5gs/open5gs/pull/1629), [open5gs#1630](https://github.com/open5gs/open5gs/pull/1630))

* [PFCP] Added Network Instance to CP-UP FAR ([open5gs#1630](https://github.com/open5gs/open5gs/pull/1630))

* [SMF] Gn: QoS Profile and PCO IE improvements ([open5gs#1631](https://github.com/open5gs/open5gs/pull/1631))

* [SMF] pfcp: Retrieve sess when response with SEID=0 is received ([open5gs#1620](https://github.com/open5gs/open5gs/pull/1620))

3GPP TS 29.244 7.2.2.4.2 documents that the peer will set SEID=0 in the
response when we request something for a session not existing at the peer.
If that's the case, we still want to locate the local session which
originated the request, so let's store the local SEID in the xact when
submitting the message, so that we can retrieve the related SEID and
find the session if we receive SEID=0.

* [SGWC] pfcp: Retrieve sess when SEID=0 ([open5gs#1620](https://github.com/open5gs/open5gs/pull/1620))

* [GTP] context when TEID=0 ([open5gs#1620](https://github.com/open5gs/open5gs/pull/1620), [open5gs#1606](https://github.com/open5gs/open5gs/pull/1606), [open5gs#1594](https://github.com/open5gs/open5gs/pull/1594))

* [SCTP] Add protection code jumbo frame ([open5gs#1632](https://github.com/open5gs/open5gs/issues/1632))

* [GTP] Avoid abort if ogs_gtp_node_new() returns NULL ([open5gs#1633](https://github.com/open5gs/open5gs/pull/1633))

* [GTP] Avoid abort if ogs_gtp_node_new() returns NULL

* [SGWC] Avoid abort if ogs_gtp_node_add_by_addr() returns NULL

* [GTP] avoid abort for ogs_gtp_node_new() ([open5gs#1633](https://github.com/open5gs/open5gs/pull/1633))

* [UPF] N4: Remove unnecessary assert ([open5gs#1634](https://github.com/open5gs/open5gs/pull/1634))

* Changes MAX TLV MORE to 16

OGS_MAX_NUM_OF_PDR is 16, but OGS_TLV_MAX_MORE is 8.
To match the size of two macros, increased OGS_TLV_MAX_MORE to 16.

* Revert "[GTP] context when TEID=0 ([open5gs#1620](https://github.com/open5gs/open5gs/pull/1620), [open5gs#1606](https://github.com/open5gs/open5gs/pull/1606), [open5gs#1594](https://github.com/open5gs/open5gs/pull/1594))"

This reverts commit [0d61f7a](https://github.com/securitylab-repository/open5gs_ciot/commit/0d61f7a7f905a865bcd8be9382ffabeb817f8464).

* Revert "[SGWC] pfcp: Retrieve sess when SEID=0 ([open5gs#1620](https://github.com/open5gs/open5gs/pull/1620))"

This reverts commit [9700563](https://github.com/securitylab-repository/open5gs_ciot/commit/970056302390471e7089a7a2ed08bcf979fd057d).

* [PFCP] Refine error code path without assertion

Refer to [open5gs#1635](https://github.com/open5gs/open5gs/issues/1635), [open5gs#1620](https://github.com/open5gs/open5gs/pull/1620)

* [GTP] Refine error code path without assertion

Refer to [open5gs#1635](https://github.com/open5gs/open5gs/issues/1635), [open5gs#1620](https://github.com/open5gs/open5gs/pull/1620), [open5gs#1606](https://github.com/open5gs/open5gs/pull/1606), [open5gs#1594](https://github.com/open5gs/open5gs/pull/1594)

* Fixed a crash when slice/session overflow ([open5gs#1637](https://github.com/open5gs/open5gs/issues/1637))

* [MISC] Add support for static code analysis

Static code analysis can be executed with following commands:
  meson build
  ninja -C build analyze-cppcheck
  ninja -C build analyze-clang-tidy

These commands are available only if additional tools are installed:
  - cppcheck
  - clang-tidy
  - clang-tools is optional if you want to paralelize the clang-tidy

In case of cppcheck analysis, a file called build/cppchecklog.log is
created with the analysis results.

In case of clang-tidy analysis, some checks are disabled. See file
.clang-tidy, and reenable them if you see fit.
Also it does not scan all the files in the project, since some of them
are imported from other sources. It does not scan any sources under:
  - subprojects/
  - lib/asn1c/
  - lib/ipfw/

* [ALL] Fix differences in function parameter names between definition and declaration

* [CORE] Fix detection of a failed memory allocation

* [CORE] Added memory check ([open5gs#1638](https://github.com/open5gs/open5gs/pull/1638))

* [PFCP] Fixed a endianness Apply Action ([open5gs#1640](https://github.com/open5gs/open5gs/issues/1640))

* [SMF] copy UE ip address to uplink PDR rules.

This helps UPF to add ACL based on src ip

Signed-off-by: Networkmama <networkmama12@gmail.com>

* [PFCP] Added UE IP address in the EPC ([open5gs#1642](https://github.com/open5gs/open5gs/pull/1642))

* d/open5gs-upf.postinst: don't restart service in chroot

Don't attempt to restart systemd-networkd if systemd is not running
(e.g. installing open5gs inside a chroot).

Fix for:
  System has not been booted with systemd as init system (PID 1). Can't operate.
  Failed to connect to bus: Host is down
  dpkg: error processing package open5gs-upf:amd64 (--configure):
   installed open5gs-upf:amd64 package post-installation script subprocess returned error exit status 1

* [SBI] fixed wrong request-nf-type ([open5gs#1650](https://github.com/open5gs/open5gs/issues/1650))

* [AMF] Do not send Deregistration Event to UDM when UE deregisters

According to TS 23.502, 4.2.2.2.2, AMF sends Registration event to UDM
in the following cases:
- If the AMF has changed since the last Registration procedure, or
- if the UE provides a SUPI which doesn't refer to a valid context in
the AMF,
- or if the UE registers to the same AMF it has already registered
to a non- 3GPP access (i.e. the UE is registered over a non-3GPP access
and initiates this Registration procedure to add a 3GPP access).

In case that UE re-registers to the network with a GUTI, it bypasses
authentication check to the AUSF. In this case, AMF does not send
Registration event to UDM.
Consequently, when UE deregisters again, AMF would send a Deregistration
Event to a UDM, which does not have a context for it.

3GPP standard does not say when AMF sends Deregistration Event to UDM,
only that it is optional.

These (De-)Registration events are for (de-)registering AMF to the UDM
for serving the UE. And not for (de-)registering UE itself for purpose
of tracking when UE is registered on the network.

This partially reverts commit [7be7029](https://github.com/securitylab-repository/open5gs_ciot/commit/7be7029ac40b2eecbf70564d5306f85dafa2b848)

* [NAS] modify library to include both directions of deregistration requests

Definitions in NAS library now include both directions of deregistration
requests/accepts - from UE and from network.

* [SBI] Add support for DeregistrationData in SBI messages

* [AMF] Handle namf-callback DeregNotify message from UDM

UDM may send a Deregistration Notification to AMF, to deregister
specific UE from the network - Network-Initiated Deregistration.
Deregistration procedure includes sending Deregistration Request to UE,
starting a timer T3522, releasing PDU sessions from SMF, releasing PCF
policies from PCF, and waiting for Deregistration Accept from UE.

Not yet implemented is:
- to prevent deregistration of UE in case it has any emergency sessions,
- page UE when UE is in IDLE mode.

* [SBI] incrased session pool of server ([open5gs#1652](https://github.com/open5gs/open5gs/issues/1652))

* [CORE] Increased memory pool for poll ([open5gs#1652](https://github.com/open5gs/open5gs/issues/1652))

* [SCP] Support of Indirect Communication

* [asn1c] rework aper from [mouse07410/asn1c#94](https://github.com/mouse07410/asn1c/issues/94)

Merge [@pespin](https://github.com/pespin) the following work
- [mouse07410/asn1c#93](https://github.com/mouse07410/asn1c/pull/93)
- [mouse07410/asn1c#100](https://github.com/mouse07410/asn1c/pull/100)

* [AMF] Fixed 5GMM cause in Reject message ([open5gs#1660](https://github.com/open5gs/open5gs/issues/1660))

When a UE that requests slices tries to connect and there are no slices configured, the reject message is:

5GMM cause = 0x7 (5GS Services not allowed)

however it should be:

5GMM cause = 0x3e (No network slices available)

All 5GMM cause value in reject message is reviewed in this commit

* Fixed ASSERT when context has already been removed

* fixed the memory leak in test program

* Fixed the crash in UERANSIM 500 test ([open5gs#1652](https://github.com/open5gs/open5gs/issues/1652))

* Oops! Redundant code is removed ([open5gs#1652](https://github.com/open5gs/open5gs/issues/1652))

* Add missing pkbuf_free() ([open5gs#1652](https://github.com/open5gs/open5gs/issues/1652))

* Refactor for the UERANSIM 500 test ([open5gs#1652](https://github.com/open5gs/open5gs/issues/1652))

* Add more protection code for ([open5gs#1652](https://github.com/open5gs/open5gs/issues/1652))

* [tests] Fix running unit tests inside docker environment

The issue was introduced with the commit, which builds Open5GS from
local sources instead of downloading them each time from Github.

Fixes: [d2cbcf7](https://github.com/securitylab-repository/open5gs_ciot/commit/d2cbcf7118eea6be2a6da315fb5a5442f8bf719e) ("[build] Use local sources to build applications ([open5gs#1583](https://github.com/open5gs/open5gs/pull/1583))")

* [SBI] Add function to request NF Instance from NRF by providing it's Instance Id

* [SMF] Send PDU Session Establish Accept to serving AMF

In case there are multiple AMF registered to NRF, SMF would pick only
the first AMF from the list.
In the case of sending PDU Session Establishment Accept from SMF to
AMF, this would mean a high chance of failure since the AMF might
be different than the original requester, and would not know about a
particular UE.

Modify SMF to use ServingNfId field from original request
SmContextCreateData from AMF to determine to which AMF should it send
PDU Session Establishment Accept message.

* Set default Network-Access-Mode to 0

For HSS's which do not include the NAM, the MME should not treat this as a fatal error.  MME should just assume PACKET_AND_CIRCUIT (0), as was decided in a previous PR.

* [MME] Handle Charging Characteristics

Found no support for HSS provided charging characteristics.  Following TS32.251 A.4:
- Use PDN level CC, if one wasn't provided then use subscription level CC
- Don't send CC in S11 if it wasn't included

* Moving handling of assigning sub level cc into the pdn to s11.

* Support Discovery Optional Parameter ([open5gs#1671](https://github.com/open5gs/open5gs/pull/1671))

To support target-nf-instance-id in the discovery,
Discovery optional parameter is implemeted

* Oops! Warning removed!

* Refine code of discovery option param ([open5gs#1671](https://github.com/open5gs/open5gs/pull/1671))

* Release v2.4.9

* [MME] Introduce support for S6a Cancel Location Request

- Added diameter dictionary definitions for Cancel Location
- Cancel Location will completely remove UE from MME, allow for a fresh IMSI attach to occur on next attempt.
- T3422 is used for detach request.
- Added new handling for s6a events in mme-sm, as not all s6a messages are at attach now.  Maybe there's something in a state machine I should've been using here instead of a new flag?

- Testing was completed with UE in idle and connected.  With CLR flags indicating re-attach required and without.  Also sending CLR after UE detach.  And then sending again when mme_ue is empty.

* Refact paging module ([open5gs#1676](https://github.com/open5gs/open5gs/pull/1676))

* [MME] Changed S1AP_Cause in S1AP Release ([open5gs#1676](https://github.com/open5gs/open5gs/pull/1676))

S1AP_CauseNas_detach -> S1AP_CauseNas_normal_release

* [SBI] Fixed nf_instance memory leak

- Rollback commit [ed3444e](https://github.com/securitylab-repository/open5gs_ciot/commit/ed3444eef5e9e57705645b500dbd6c5af453703f)
- Do not modify reference count when REGISTER/DEREGISTER notified from NRF

* [PFCP] Revert Changes [5e18b2b](https://github.com/securitylab-repository/open5gs_ciot/commit/5e18b2bd13e16246b20838e84d92f6bf9ec15f5c)

* [MME+HSS] AVP Occurring Too Many Times

Do not Set Origin-Hosts with fd_msg_rescode_set before potential use of ogs_diam_message_experimental_rescode_set.  This results in multiple Origin-Host/Realm AVPs.

* [Diameter] Fixed Coding convention ([open5gs#1680](https://github.com/open5gs/open5gs/pull/1680))

* [NRF] Fixed the nfInstanceUri ([open5gs#1683](https://github.com/open5gs/open5gs/issues/1683))

* [PFCP] Revert Changes [5e18b2b](https://github.com/securitylab-repository/open5gs_ciot/commit/5e18b2bd13e16246b20838e84d92f6bf9ec15f5c) and [d21e9aa](https://github.com/securitylab-repository/open5gs_ciot/commit/d21e9aa5e0db5930bc2d47b6eb29bf9fe591a23a)

To protect malicious or buggy, we need to check that session context is NULL.

* Changed configuration name from gnb to peer

And restored gtp_peer configuration

* [GTP] gtp_peer override the pool size of GTP node

* [MME] Changed CauseNas_detach in DETACH ([open5gs#1676](https://github.com/open5gs/open5gs/pull/1676))

* [SBI] Increased the max stream number

* [SBI] CLIENT max concurrent streams to 16384

* Move src/../nf-sm.[ch] to lib/sbi/nf-sm.[ch]

* [PFCP] Fixed security protection

Check the length to prevent buffer overflow attacks.

* Lower Linux version cannot change HTTP2 max stream

CURLMOPT_MAX_CONCURRENT_STREAMS can be supported as of curl 7.67.0

* [SMF]: Update stored PCO IE requested in GTPv2 over S5c in SMF context

As per 3GPP TS 29.274 version 10.5.0, section 7.2.9 and 7.2.10,
Only if PCO IE is included in Delete Session Request then it
must be present in Delete Session Response.

In order to reflect on whether the request contained PCO IE or not
the SMF context containing the GTP request needs to be updated
i.e. update if present else clear the contents

* [SMF]: Update stored PCO IE requested over Gn in SMF context

As per 3GPP TS 29.060 version 15.3.0, section 7.3.3, 7.3.4, 7.3.5 and 7.3.6

Only if PCO IE is included in Update/Delete PDP Context Request then it
must be present in Update/Delete PDP Context Response.

In order to reflect on whether the request contained PCO IE or not
the SMF context containing the GTP request needs to be updated
i.e. update if present else clear the contents

* Update docs [@nickvsnetworking](https://github.com/nickvsnetworking) and @[@s5uishida](https://github.com/s5uishida)

* Update docs [@s5uishida](https://github.com/s5uishida)

* Removed duplicated document link

* Fixed Defects reported by Coverity Scan

* [DOCS] Updated if subscribers changed [[open5gs#1694](https://github.com/open5gs/open5gs/issues/1694)]

* [PFCP] security vulnerability continued in [d99491a](https://github.com/securitylab-repository/open5gs_ciot/commit/d99491aca5304460d3929b37bf26e064efd86686)

* [MME] Cancel Location Handling ([open5gs#1698](https://github.com/open5gs/open5gs/pull/1698))

* CLR while idle is broken after [open5gs@7031856](https://github.com/open5gs/open5gs/commit/7031856cd779af0129ca444e18bbe2ed5db9ff32)

Cancel Location Request arriving while UE is idle will not proceed to paging due to this check for S1 connection.  Using new flag "isAnswer" to bypass this check to allow paging to occur when we are not doing a AIA/ULA related procedure.

* No Context Setup is required when sending the detach request.  If the paging was due to wanting to send a Detach Request to the UE, then we fast track to sending the detach request.

* emm-sm.c:
In the case of MME initiated detach while UE is idle, there is no initial conext setup.  We go right from the service request after paging into sending the detach request.  TS23.401

mme-path.c:
Using nas_eps.type in the case of MME Initiated Detach while UE is idle does not work.  nas_eps.type would represent the service request.

mme-s11-handler.c:
After S11 action, no action should be taken.  We want to wait for the detach accept from the UE before proceeding with the S1 release (detach).

* InitialContextSetup should occur for detach.

* [MME] Follow-up Cancel Location Handling ([open5gs#1698](https://github.com/open5gs/open5gs/pull/1698))

* [MME] Fixed GTP transaction crash ([open5gs#1696](https://github.com/open5gs/open5gs/issues/1696))

* [SGsAP] Changed message if Paging failed ([open5gs#1701](https://github.com/open5gs/open5gs/issues/1701))

The problem occurred in the following scenario:

1. VLR sent PAGING-REQUEST to the MME
2. MME sent S1-Paging to the UE
3. Paging failed
4. MME responded SERVICE-REQUEST to the VLR
5. VLR sent DOWNLINK-UNITDATA to the MME
6. Even though there is no S1 Context,
   MME try to sent DownlinkNASTransport message to the UE.
7. So, the problem occurred.

I've changed the number 4 PAGING-REJECT instead of SERVICE-REQUEST.

* [MME] Detach removed MME-UE context ([open5gs#1698](https://github.com/open5gs/open5gs/pull/1698))

* [MME] UE-initiated detach removes S1 only ([open5gs#1698](https://github.com/open5gs/open5gs/pull/1698))

* [SMF] Fix abort on app exit when no Diameter configuration

In case that SMF was configured to run without Diameter, it would crash
on application exit due to uninitialized variables/pointers.

ERROR  pid:unnamed in fd_sess_handler_destroy@sessions.c:324: ERROR: Invalid parameter '(handler && ( ((*handler) != ((void *)0)) && ( ((struct session_handler *)(*handler))->eyec == 0x53554AD1) ))', 22
[smf] FATAL: smf_gx_final: Assertion `ret == 0' failed. (../src/smf/gx-path.c:1353)

* [MME] Dictionary Updates and IDR Support ([open5gs#1714](https://github.com/open5gs/open5gs/pull/1714))

* Add Diameter Dictionary Elements

* Initial IDR Framework

* Resolve Compile Issues

* Moving Closer

* Compile error

* Somewhat Working stuffing Code

* Add Timestamp Changes

* Cleanup some of this code.  mme_s6a_handle_idr in s6a-handler.c removed for now, since it will only come in handy when IDR flag is set to request current location, which would involve breaking out into paging.  I think there's a few other things we can do just within fd-path first.

* further removal of mme_s6a_handle_idr

* Follow up on [open5gs#1714](https://github.com/open5gs/open5gs/pull/1714)

* Changed sprintf to ogs_snprintf

* Limited to 80 column

* [NRF] Fixed library load error

* [metrics] Fix double-free on application exit ([open5gs#1717](https://github.com/open5gs/open5gs/pull/1717))

* [SBI] Support service-names in discovery option

* [SBI] Added config for service-names discovery

* diameter: Gx: add AVP 3GPP-Charging-Characteristics

The 3GPP-Charging-Characteristics is an operator specific AVP
(optional). The 3GPP-Charging-Characteristics can be filled by the HSS
and pass through to the Gx interface.

See ETSI 29.212 5.4.0.1 for further details.

* [SMF] send 3GPP-Charging-Characteristics on Gx if received on S5/8c

The 3GPP-Charging-Characteristics is an operator specific AVP
(optional). The 3GPP-Charging-Characteristics can be filled by the HSS
and forwarded by the MME towards the SMF.

* Follow up on [open5gs#1715](https://github.com/open5gs/open5gs/pull/1715)

* Changed <TAB> to <SPACE>*4

* Changed snprintf to ogs_snprintf

* [Conf] Changed MTU size from 1500 to 1400

* [SMF] fixup send 3GPP-Charging-Characteristics on Gx if received on S5/8c

- Gy instead of Gx AVP was used.
- Use correct avp position and avp variables.

Fixes: [657eef9](https://github.com/securitylab-repository/open5gs_ciot/commit/657eef9169af49268d8d92cecb3ed872e954b015) ("[SMF] send 3GPP-Charging-Characteristics on Gx if received on S5/8c")

* Added Service-based NF discovery

== Known limitation ==
Placing npcf-smpolicycontrol and pcf-policyauthorization
in different NFs is not supported. Both npcf-smpolicycontrol
and pcf-policyauthorization should be placed in the same NF.

* [ALL] Removing trailing whitespace and tab

* [MME] Fixed buffer overflow ([open5gs#1728](https://github.com/open5gs/open5gs/issues/1728))

* Added simple test program

./tests/registration/registration simple-test
./tests/vonr/vonr simple-test
./tests/attach/attach simple-test
./tests/volte/volte simple-test

* [SMF] Handle upCnxState=ACTIVATING by replying with 200 instead of 204

According to TS 29.502 5.2.2.3.2.2., we should reply with a 200 response
including the upCnxState attribute.

* Follow-up on [open5gs#1729](https://github.com/open5gs/open5gs/pull/1729)

* [SBI] Send NF discovery query with service-names delimited with comma

OpenAPI specification for sending NF discovery query with
"service-names" parameter is defined as folowing:

- name: service-names
  ...
  style: form
  explode: false

According to OpenAPI specification, this means array items
should be delimited with a comma character (example: /users?id=3,4,5).

* [PCF] Check NF service configuration

* npcf-smpolicycontrol - enabled or disabled
* npcf-policyauthorization - enabled or disabled

Only one of npcf-smpolicycontrol and npcf-policyauthorization cannot be enabled. (../src/pcf/sbi-path.c:151)

They can be enabled or disabled together.

* [CORE] Check if timer is double free in SBI module

* removing extra lines

I did not find the purpose of their use

* [AMF] Accept Deregistration Notification from UDM only for registered UE ([open5gs#1737](https://github.com/open5gs/open5gs/pull/1737))

Add additional check when receiving Deregistration Notification from
UDM. UE should already be in registered state before accepting the
request and deregistering the UE.

Also add additional check that PCF association policy exists before
sending a delete request to PCF.

* When using longer APN name, it is obscured due to short field.

* Also format for pcc_rule.  UE and SMF look okay as medium_data as first section.

* Minor typo fix

* Support service-based NF subscription

* [AMF] Handle APN/DNN names as case-insensitive

In case that APN name sent from UE does not case-match with the one
configured in the database, AMF would reject the registration with the
message:

[gmm] WARNING: [imsi-xxx] DNN Not Supported OR Not Subscribed in the
Slice (../src/amf/gmm-handler.c:1051)

* Follow-up on [open5gs#1747](https://github.com/open5gs/open5gs/pull/1747)

* Release v2.4.10

* Added Release Notes for v2.4.10

* Introduce Cancel Location and Insert Subscriber Data features to HSS. ([open5gs#1744](https://github.com/open5gs/open5gs/pull/1744))

* Introduce Cancel Location and Insert Subscriber Data features to HSS.
* HSS database will keep track of last known MME and Update Time
* Purged UE flag is established in HSS for future PUR handling
* HSS Thread will connect to database and watch change stream
  mongoDB must be configured with a Replica Set to use this
* HSS will send IDR if subscription data changes
* HSS will send CLR to old MME if MME host or realm changes
* Function created to allow ULA and IDR to generate Subscription-Data AVP
* MME Hostname and Realm shown in WebUI

* Resolve freeDiameter errors

During a ULR, if database does not contain a last known MME, a CLR is being sent to a Null destination.  This will ensure that a destination is available in the database before sending the CLR.

* Removed change streams.  Added PUR handling.

* newline needed at end of file.

* Removed temp variable.

* * Change WebUI to 2x2 display
* Including UE Purged indicator
* Using pointers in ogs_subscription_data_t
* better memory mangement with pointers
* Tweak to Destination used by hss_s6a_send_idr to use last known MME

* Check for null mme_host and mme_realms

Do this before trying to compare the strings.

* Follow-up on [open5gs#1744](https://github.com/open5gs/open5gs/pull/1744)

* [SMF] Wait for both N1&N2 release signals before releasing session

When UE would send a request to release PDU session, AMF would
eventually send "PDU Session Resource Release Command" downlink to both
UE (N1) and gNB (N2). Each UE and gNB would then reply with "PDU Session
Resource Release Response" indicating they released their own resources.

Usually the first one to respond would be gNB. SMF made an assumption
that this would always be the case. And it would wait for signal that UE
resources were freed, before releasing session resources. But
occasionally the situation is that UE responds first, and SMF releases
resources prematurely.

This situation does not normally occur. But under high stress (100's of
UE PDU releases at the same time) this happens occasionally.
According to the standard, this situation is perfectly normal.

3GPP TS 23.502 Rel. 16
4.3.4.2 UE or network requested PDU Session Release for Non-Roaming and
Roaming with Local Breakout
...
Steps 8-10 may happen before steps 6-7.
...

* Added commercial 5G

* Add tested Ericsson gNodeBs and eNodeBs

* [DOC] Fixed alphabet order

* Sponsors logo updated to be dark-mode friendly

* Updated favicon.ico in Document

* [GTP/PFCP] TLV length more acceptable ([open5gs#1780](https://github.com/open5gs/open5gs/discussions/1780))

Acceptable even if the TLV length is smaller than expected

* [AMF] Add amfInfoList to NFProfile

The actual configured GUAMIs and TAIs are used to form NF profile.
Comparing to SMF the "info" section is not introduced into amf.yaml!
Each amf_id (region, set) produces a separate Info in the InfoList.
Guami list consists of all GUAMIs of particular Info.
taiList consists of all TAIs for all PLMNs of particular Info.

Examle:

amf.yaml:
    guami:
      - plmn_id:
          mcc: 999
          mnc: 70
        amf_id:
          region: 2
          set: 2
          pointer: 4
      - plmn_id:
          mcc: 001
          mnc: 01
        amf_id:
          region: 2
          set: 1
      - plmn_id:
          mcc: 001
          mnc: 02
        amf_id:
          region: 2
          set: 2
    tai:
      - plmn_id:
          mcc: 001
          mnc: 01
        tac: [1, 2, 3]
    tai:
      - plmn_id:
          mcc: 002
          mnc: 02
        tac: 4
      - plmn_id:
          mcc: 001
          mnc: 02
        tac: 10
    tai:
      - plmn_id:
          mcc: 004
          mnc: 04
        tac: [6, 7]
      - plmn_id:
          mcc: 005
          mnc: 05
        tac: 8
      - plmn_id:
          mcc: 999
          mnc: 70
        tac: [9, 10]

"amfInfoList":  {
        "1":    {
                "amfSetId":     "002",
                "amfRegionId":  "02",
                "guamiList":    [{
                                "plmnId":       {
                                        "mcc":  "999",
                                        "mnc":  "70"
                                },
                                "amfId":        "020084"
                        }, {
                                "plmnId":       {
                                        "mcc":  "001",
                                        "mnc":  "02"
                                },
                                "amfId":        "020080"
                        }],
                "taiList":      [{
                                "plmnId":       {
                                        "mcc":  "001",
                                        "mnc":  "02"
                                },
                                "tac":  "00000a"
                        }, {
                                "plmnId":       {
                                        "mcc":  "999",
                                        "mnc":  "70"
                                },
                                "tac":  "000009"
                        }, {
                                "plmnId":       {
                                        "mcc":  "999",
                                        "mnc":  "70"
                                },
                                "tac":  "00000a"
                        }]
        },
        "2":    {
                "amfSetId":     "001",
                "amfRegionId":  "02",
                "guamiList":    [{
                                "plmnId":       {
                                        "mcc":  "001",
                                        "mnc":  "01"
                                },
                                "amfId":        "020040"
                        }],
                "taiList":      [{
                                "plmnId":       {
                                        "mcc":  "001",
                                        "mnc":  "01"
                                },
                                "tac":  "000001"
                        }, {
                                "plmnId":       {
                                        "mcc":  "001",
                                        "mnc":  "01"
                                },
                                "tac":  "000002"
                        }, {
                                "plmnId":       {
                                        "mcc":  "001",
                                        "mnc":  "01"
                                },
                                "tac":  "000003"
                        }]
        }
}

* Follow-up on [open5gs#1757](https://github.com/open5gs/open5gs/pull/1757)

* [HSS] Enable Change Streams ([open5gs#1758](https://github.com/open5gs/open5gs/pull/1758))

* [HSS] Enable Change Streams
* Enable Events and Timers in HSS
* Integrate change streams in dbi
* mongodb should be configured with replica sets enabled to use feature
* Change streams are optional in HSS
* Timer will poll change stream for changes in the database
* As changes are detected, event is created to perform the correct
  action

* Changes made as suggested

* Follow-up on [open5gs#1758](https://github.com/open5gs/open5gs/pull/1758)

* Update document

* [TLV] Added more debug information ([open5gs#1767](https://github.com/open5gs/open5gs/issues/1767))

* Fixed HTTP2 crashes for random JSON data ([open5gs#1769](https://github.com/open5gs/open5gs/issues/1769))

* [core] fix timer overflow on 32bit systems ([open5gs#16](https://github.com/open5gs/open5gs/issues/16))

must cast ts.tv_sec to 64bits before we multiply it to prevent 32bit math and overflow

* Follow-up on [open5gs#1770](https://github.com/open5gs/open5gs/pull/1770)

* [SGWC] Fixed a crash ([open5gs#1765](https://github.com/open5gs/open5gs/issues/1765))

Session context could be deleted before a response message is not
received from SMF

* add addr/port to pfcp assoc/de-assoc logs ([open5gs#40](https://github.com/open5gs/open5gs/issues/40))

pfcp association log adds addr/port

* [GTP] Changes the print message ([open5gs#1772](https://github.com/open5gs/open5gs/pull/1772))

* [config,metrics] Move metrics configuration section under respective NF section

Without this change, using metrics with core setup configurations
(configs/vonr.yaml for example) would not be possible. Having one
metrics section for whole config file causes every NF to start metrics
server on same port causing an abort.

* Follow-on up [open5gs#1754](https://github.com/open5gs/open5gs/pull/1754)

* [DOC] iptable setting for security ([open5gs#1768](https://github.com/open5gs/open5gs/issues/1768))

* [MME] Added protection code if no PDN-Type ([open5gs#1756](https://github.com/open5gs/open5gs/issues/1756))

* Changes new GA4 in Google Analytics

* Commercial Term by NeoPlane - <https://neoplane.io/>

* Fix UL and DL URR Usage Report

* Follow-on up [open5gs#1793](https://github.com/open5gs/open5gs/pull/1793)

* [AMF] Fix for switching state when sending Deregistration Request fails

Provide pointer to state machine, instead of pointer to timer structure.
Bug was noticed when switching compiler optimization to -O2.

* [5GC] Fixed session deletion in a BSF ([open5gs#1725](https://github.com/open5gs/open5gs/issues/1725))

* [UPF] test code for unspecified address ([open5gs#1776](https://github.com/open5gs/open5gs/discussions/1776))

* [Security] Fixed a crash for port scanning ([open5gs#1767](https://github.com/open5gs/open5gs/issues/1767))

* Release v2.4.11

* Added Release Notes for v2.4.11

* [MME] Support for Insert Subscriber Data ([open5gs#1794](https://github.com/open5gs/open5gs/pull/1794))

* [MME] Support for Insert Subscriber Data

* Supported AVPs in IDR will overwrite existing subscription information
* Provide error on partial APN updates
* IDR and ULA use same function to process AVPs
* Move subdatamask values into s6a, so both HSS and MME can use them
* Updates are not actioned at this time.  A Re-attach is required for
  most changes to take effect

* Memory issue on IDR exceptions

* Remove of handling MSIDSN change until DSR is used

* Follow-on up [open5gs#1794](https://github.com/open5gs/open5gs/pull/1794)

* [SBI] Client Request timeout

TS29.500
Ch 6.11 Detection and handling of late arriving requests

In Open5GS, this part was hard-corded.

HTTP2 Client sends a request and waits for 10 seconds.
If no response is received from the HTTP2 Server,
HTTP2 Client performs the exception handling.

In this commit, HTTP2 client sends Header with setting Max-Rsp-Time to 10 seconds.
However, HTTP2 server has not yet been implemented to process this value.
The server is still processing using hard-corded values (10 seconds).

* [MME] Cancel Location while Idle ([open5gs#1797](https://github.com/open5gs/open5gs/pull/1797))

* Cancel Location while Idle Fix

* Forgot about SGSAP on MME Change.

Added "action" to sgsap_send_detach..

* Make handle_clr uniform with other handlers

* Added Robustness for Any Detach Type

* Memory wasn't freed upon CLR for unknown IMSIs

* Moving MME Detach to new PR

* Follow-up on [open5gs#1797](https://github.com/open5gs/open5gs/pull/1797)

* ogs_info swaps CP and UP SEIDs

* Follow-up on [open5gs#1797](https://github.com/open5gs/open5gs/pull/1797)

* fix dropped_dl_traffic_threshold ie.

* [AMF,UDM] Add support to subscribe to SDM changes

AMF subscribes to UDM for each registered UE.

At the moment, UDM does not send callback to AMF when any of the UE's
properties in the database changes.
At the moment, AMF does properly parse the ModificationNotification, but
does not do anything useful.

* [SMF] Update PFCP report error situation ([open5gs#1819](https://github.com/open5gs/open5gs/pull/1819))

* Revert the previous commit on [open5gs#1797](https://github.com/open5gs/open5gs/pull/1797)

* Updated SBI module

- Introduced NF_INSTANCE_ID/NF_INSTANCE_TYPE
- Skip SCP in configuration validation

* [AMF] Increase size of TMSI pool

Each UE context has 'current' and 'next' TMSI values. AMF first
allocates the 'next' value, before confirming it and releasing the
'previous'. This means that we potentially need pool size of 2x the
amount of maximum configured UE.

Without this change, AMF would crash in case that there are 'x'
configured maximum amount of UE, and there are already 'x' registered
UE.

[gmm] INFO: Registration request (../src/amf/gmm-sm.c:135)
[gmm] INFO: [suci-0-001-01-1234-0-1-1000000000]    SUCI (../src/amf/gmm-handler.c:149)
[gmm] DEBUG:     OLD TSC[UE:0,AMF:0] KSI[UE:7,AMF:0] (../src/amf/gmm-handler.c:179)
[gmm] DEBUG:     NEW TSC[UE:0,AMF:0] KSI[UE:7,AMF:0] (../src/amf/gmm-handler.c:186)
[amf] FATAL: amf_m_tmsi_alloc: Assertion `m_tmsi' failed. (../src/amf/context.c:2160)
[core] FATAL: backtrace() returned 13 addresses (../lib/core/ogs-abort.c:37)

* [AMF] Reject registration requests when pool for UE contexts is empty

AMF does not crash anymore when a new UE registration request arrives,
and there is no available space left in UE context pool. Now it just
rejects the request with an error.

* Follow-up on [open5gs#1828](https://github.com/open5gs/open5gs/pull/1828)

* Follow-up on [open5gs#1827](https://github.com/open5gs/open5gs/pull/1827)

* [DBI] Disable Change Streams with mongo Version

Support for change stream is only available in mongoc >=1.9.0
- Disabled related functions in dbi.
Support for bson to json used in debug statement only in libbson >=1.7.0
- Simple debug message in lower versions

* Follow-up on [open5gs#1827](https://github.com/open5gs/open5gs/pull/1827)

* Update README.md

Signed-off-by: Networkmama <networkmama12@gmail.com>
Co-authored-by: Sukchan Lee <acetcom@gmail.com>
Co-authored-by: Pau Espin Pedrol <pespin@sysmocom.de>
Co-authored-by: Bostjan Meglic <103102696+bmeglicit@users.noreply.github.com>
Co-authored-by: Networkmama <networkmama12@gmail.com>
Co-authored-by: Bostjan Meglic <b.meglic@iskratel.si>
Co-authored-by: Oliver Smith <osmith@sysmocom.de>
Co-authored-by: jmasterfunk84 <48972964+jmasterfunk84@users.noreply.github.com>
Co-authored-by: herlesupreeth <herlesupreeth@gmail.com>
Co-authored-by: Alexander Couzens <lynxis@fe80.eu>
Co-authored-by: mitmitmitm <m.rihtarsic@iskratel.si>
Co-authored-by: EugeneBogush <eugeneb2008@gmail.com>
Co-authored-by: neg2led <4232981+neg2led@users.noreply.github.com>
Co-authored-by: Gaber Stare <g.stare@iskratel.si>
Co-authored-by: Spencer Sevilla <spencer.builds.networks@gmail.com>
Co-authored-by: Dibas Das <dibasdas02@gmail.com>
Co-authored-by: safaorhann <safa.orhan@b-ulltech.com>
```

[![@athiravinod5gtechie](https://avatars.githubusercontent.com/u/125435222?s=80&u=bed60f9ccc74016e49eb3b48d10e125fde106d59&v=4)](/athiravinod5gtechie)

Copy link

### **[athiravinod5gtechie](/athiravinod5gtechie)** commented [Feb 14, 2024](#issuecomment-1943217432)

| Hi [@Popvlvs](https://github.com/Popvlvs) [@acetcom](https://github.com/acetcom) ,  I am facing an issue with finding API end point for my docker pcf. Any idea how to find it? These are my docker pcf details sudo docker ps | grep pcf e7dda5374a37 docker\_open5gs "/bin/sh -c /open5gs…" 16 minutes ago Up 16 minutes 0.0.0.0:7001->7001/tcp, :::7001->7001/tcp, 0.0.0.0:7777->7777/tcp, :::7777->7777/tcp, 0.0.0.0:32777->9091/tcp, :::32777->9091/tcp pcf  Kindly request support Thanks, Athira Vinod |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen5gs%2Fopen5gs%2Fissues%2F1769)

Assignees

No one assigned

Labels

[type:bug](/open5gs/open5gs/labels/type%3Abug)
Open5GS bug

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

3 participants

[![@acetcom](https://avatars.githubusercontent.com/u/4222492?s=52&v=4)](/acetcom) [![@Popvlvs](https://avatars.githubusercontent.com/u/56645347?s=52&v=4)](/Popvlvs) [![@athiravinod5gtechie](https://avatars.githubusercontent.com/u/125435222?s=52&v=4)](/athiravinod5gtechie)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


