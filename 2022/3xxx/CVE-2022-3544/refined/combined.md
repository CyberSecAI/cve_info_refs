=== Content from git.kernel.org_48200803_20250115_100250.html ===


| [cgit logo](/) | [index](/) : [kernel/git/netfilter/nf-next.git](/pub/scm/linux/kernel/git/netfilter/nf-next.git/) | main nf-next |
| --- | --- | --- |
| Netfilter Group nf-next tree | Netfilter Group |

| [about](/pub/scm/linux/kernel/git/netfilter/nf-next.git/about/)[summary](/pub/scm/linux/kernel/git/netfilter/nf-next.git/)[refs](/pub/scm/linux/kernel/git/netfilter/nf-next.git/refs/?id=1c8e2349f2d033f634d046063b704b2ca6c46972)[log](/pub/scm/linux/kernel/git/netfilter/nf-next.git/log/)[tree](/pub/scm/linux/kernel/git/netfilter/nf-next.git/tree/?id=1c8e2349f2d033f634d046063b704b2ca6c46972)[commit](/pub/scm/linux/kernel/git/netfilter/nf-next.git/commit/?id=1c8e2349f2d033f634d046063b704b2ca6c46972)[diff](/pub/scm/linux/kernel/git/netfilter/nf-next.git/diff/?id=1c8e2349f2d033f634d046063b704b2ca6c46972)[stats](/pub/scm/linux/kernel/git/netfilter/nf-next.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Levi Yun <ppbuk5246@gmail.com> | 2022-09-26 16:06:11 +0000 |
| --- | --- | --- |
| committer | Andrew Morton <akpm@linux-foundation.org> | 2022-09-30 18:46:31 -0700 |
| commit | [1c8e2349f2d033f634d046063b704b2ca6c46972](/pub/scm/linux/kernel/git/netfilter/nf-next.git/commit/?id=1c8e2349f2d033f634d046063b704b2ca6c46972) ([patch](/pub/scm/linux/kernel/git/netfilter/nf-next.git/patch/?id=1c8e2349f2d033f634d046063b704b2ca6c46972)) | |
| tree | [4ff15dfb902bdb4bd054daa918396fcf0ba326a7](/pub/scm/linux/kernel/git/netfilter/nf-next.git/tree/?id=1c8e2349f2d033f634d046063b704b2ca6c46972) | |
| parent | [30c19366636f72515679aa10dad61a4d988d4c9a](/pub/scm/linux/kernel/git/netfilter/nf-next.git/commit/?id=30c19366636f72515679aa10dad61a4d988d4c9a) ([diff](/pub/scm/linux/kernel/git/netfilter/nf-next.git/diff/?id=1c8e2349f2d033f634d046063b704b2ca6c46972&id2=30c19366636f72515679aa10dad61a4d988d4c9a)) | |
| download | [nf-next-1c8e2349f2d033f634d046063b704b2ca6c46972.tar.gz](/pub/scm/linux/kernel/git/netfilter/nf-next.git/snapshot/nf-next-1c8e2349f2d033f634d046063b704b2ca6c46972.tar.gz) | |

damon/sysfs: fix possible memleak on damon\_sysfs\_add\_targetWhen damon\_sysfs\_add\_target couldn't find proper task, New allocated
damon\_target structure isn't registered yet, So, it's impossible to free
new allocated one by damon\_sysfs\_destroy\_targets.
By calling damon\_add\_target as soon as allocating new target, Fix this
possible memory leak.
Link: [https://lkml.kernel.org/r/20220926160611.48536-1-sj@kernel.org](https://lkml.kernel.org/r/20220926160611.48536-1-sj%40kernel.org)
Fixes: a61ea561c871 ("mm/damon/sysfs: link DAMON for virtual address spaces monitoring")
Signed-off-by: Levi Yun <ppbuk5246@gmail.com>
Signed-off-by: SeongJae Park <sj@kernel.org>
Reviewed-by: SeongJae Park <sj@kernel.org>
Cc: <stable@vger.kernel.org> [5.17.x]
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/netfilter/nf-next.git/diff/?id=1c8e2349f2d033f634d046063b704b2ca6c46972)

| -rw-r--r-- | [mm/damon/sysfs.c](/pub/scm/linux/kernel/git/netfilter/nf-next.git/diff/mm/damon/sysfs.c?id=1c8e2349f2d033f634d046063b704b2ca6c46972) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/mm/damon/sysfs.c b/mm/damon/sysfs.cindex 7488e27c87c377..bdef9682d0a008 100644--- a/[mm/damon/sysfs.c](/pub/scm/linux/kernel/git/netfilter/nf-next.git/tree/mm/damon/sysfs.c?id=30c19366636f72515679aa10dad61a4d988d4c9a)+++ b/[mm/damon/sysfs.c](/pub/scm/linux/kernel/git/netfilter/nf-next.git/tree/mm/damon/sysfs.c?id=1c8e2349f2d033f634d046063b704b2ca6c46972)@@ -2182,12 +2182,12 @@ static int damon\_sysfs\_add\_target(struct damon\_sysfs\_target \*sys\_target,  if (!t) return -ENOMEM;+ damon\_add\_target(ctx, t); if (damon\_target\_has\_pid(ctx)) { t->pid = find\_get\_pid(sys\_target->pid); if (!t->pid) goto destroy\_targets\_out; }- damon\_add\_target(ctx, t); err = damon\_sysfs\_set\_regions(t, sys\_target->regions); if (err) goto destroy\_targets\_out; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 10:01:27 +0000


