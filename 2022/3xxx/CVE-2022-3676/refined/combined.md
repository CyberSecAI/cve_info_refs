=== Content from github.com_7f4b8ce1_20250114_221945.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-omr%2Fomr%2Fpull%2F6773)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-omr%2Fomr%2Fpull%2F6773)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=eclipse-omr%2Fomr)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[eclipse-omr](/eclipse-omr)
/
**[omr](/eclipse-omr/omr)**
Public

* [Notifications](/login?return_to=%2Feclipse-omr%2Fomr) You must be signed in to change notification settings
* [Fork
  397](/login?return_to=%2Feclipse-omr%2Fomr)
* [Star
   949](/login?return_to=%2Feclipse-omr%2Fomr)

* [Code](/eclipse-omr/omr)
* [Issues
  772](/eclipse-omr/omr/issues)
* [Pull requests
  137](/eclipse-omr/omr/pulls)
* [Actions](/eclipse-omr/omr/actions)
* [Projects
  0](/eclipse-omr/omr/projects)
* [Security](/eclipse-omr/omr/security)
* [Insights](/eclipse-omr/omr/pulse)

Additional navigation options

* [Code](/eclipse-omr/omr)
* [Issues](/eclipse-omr/omr/issues)
* [Pull requests](/eclipse-omr/omr/pulls)
* [Actions](/eclipse-omr/omr/actions)
* [Projects](/eclipse-omr/omr/projects)
* [Security](/eclipse-omr/omr/security)
* [Insights](/eclipse-omr/omr/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Feclipse-omr%2Fomr%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Feclipse-omr%2Fomr%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Stop devirtualizing interface calls in preexistence #6773

 Merged

[vijaysun-omr](/vijaysun-omr)
merged 1 commit into
[eclipse-omr:master](/eclipse-omr/omr/tree/master "eclipse-omr/omr:master")
from
[jdmpapin:iface-prex](/jdmpapin/omr/tree/iface-prex "jdmpapin/omr:iface-prex")

Oct 18, 2022

 Merged

# [Stop devirtualizing interface calls in preexistence](#top) #6773

[vijaysun-omr](/vijaysun-omr)
merged 1 commit into
[eclipse-omr:master](/eclipse-omr/omr/tree/master "eclipse-omr/omr:master")
from
[jdmpapin:iface-prex](/jdmpapin/omr/tree/iface-prex "jdmpapin/omr:iface-prex")

Oct 18, 2022

[Conversation
3](/eclipse-omr/omr/pull/6773)
[Commits
1](/eclipse-omr/omr/pull/6773/commits)
[Checks
0](/eclipse-omr/omr/pull/6773/checks)
[Files changed](/eclipse-omr/omr/pull/6773/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=60&v=4)](/jdmpapin)

Copy link

Contributor

### @jdmpapin **[jdmpapin](/jdmpapin)** commented [Oct 18, 2022](#issue-1413840706)

Previously, it was possible for the JIT to devirtualize an interface call, and for execution to reach the call (whether inlined or not) with a receiver that is not an instance of the class expected by the implementing method. The callee could then access fields of the receiver as though it were of the expected type.

The conditionals added in this commit still allow (on their own) for an interface call to be devirtualized when preexistence has already proven that the receiver is an instance of some particular class that implements the expected interface. However, preexistence currently fails to devirtualize in that situation. It passes the class to `TR_PersistentCHTable::findSingleInterfaceImplementer()`, which needs the interface. This can be improved in the future by having preexistence treat the call in the same way as a non-interface call, but with the added requirement that the devirtualized callee must be public.

Sorry, something went wrong.

All reactions

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&v=4)](/jdmpapin)

`[Stop devirtualizing interface calls in preexistence](/eclipse-omr/omr/pull/6773/commits/f5ab765943c192e25ac8ea8d341f88e6ed9f90d2 "Stop devirtualizing interface calls in preexistence

Previously, it was possible for the JIT to devirtualize an interface
call, and for execution to reach the call (whether inlined or not) with
a receiver that is not an instance of the class expected by the
implementing method. The callee could then access fields of the receiver
as though it were of the expected type.

The conditionals added in this commit still allow (on their own) for an
interface call to be devirtualized when preexistence has already proven
that the receiver is an instance of some particular class that
implements the expected interface. However, preexistence currently fails
to devirtualize in that situation. It passes the class to
TR_PersistentCHTable::findSingleInterfaceImplementer(), which needs the
interface. This can be improved in the future by having preexistence
treat the call in the same way as a non-interface call, but with the
added requirement that the devirtualized callee must be public.")`
 …

`[f5ab765](/eclipse-omr/omr/pull/6773/commits/f5ab765943c192e25ac8ea8d341f88e6ed9f90d2)`

```
Previously, it was possible for the JIT to devirtualize an interface
call, and for execution to reach the call (whether inlined or not) with
a receiver that is not an instance of the class expected by the
implementing method. The callee could then access fields of the receiver
as though it were of the expected type.

The conditionals added in this commit still allow (on their own) for an
interface call to be devirtualized when preexistence has already proven
that the receiver is an instance of some particular class that
implements the expected interface. However, preexistence currently fails
to devirtualize in that situation. It passes the class to
TR_PersistentCHTable::findSingleInterfaceImplementer(), which needs the
interface. This can be improved in the future by having preexistence
treat the call in the same way as a non-interface call, but with the
added requirement that the devirtualized callee must be public.
```

 [![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&u=3a0011825251c1cb4bd23655390d09970bdc01d7&v=4)](/jdmpapin)
[jdmpapin](/jdmpapin)
requested a review
from [vijaysun-omr](/vijaysun-omr)
as a [code owner](/eclipse-omr/omr/blob/77204544d6c55ef4b44735874e4240359b9f39b5/CODEOWNERS#L41)
[October 18, 2022 21:01](#event-7615395606)

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&u=3a0011825251c1cb4bd23655390d09970bdc01d7&v=4)](/jdmpapin)
[jdmpapin](/jdmpapin)
added
the
[comp:compiler](/eclipse-omr/omr/labels/comp%3Acompiler)
label
[Oct 18, 2022](#event-7615432369)

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&u=3a0011825251c1cb4bd23655390d09970bdc01d7&v=4)](/jdmpapin)
[jdmpapin](/jdmpapin)
mentioned this pull request
[Oct 18, 2022](#ref-pullrequest-1413849807)

[(0.35) Stop devirtualizing interface calls in preexistence
eclipse-openj9/openj9-omr#155](/eclipse-openj9/openj9-omr/pull/155)
 Merged

[![@pshipton](https://avatars.githubusercontent.com/u/18122812?s=40&v=4)](/pshipton)
[pshipton](/pshipton)
mentioned this pull request
[Oct 18, 2022](#ref-pullrequest-1413847840)

[Disallow nop guards for interface call sites
eclipse-openj9/openj9#16122](/eclipse-openj9/openj9/pull/16122)
 Merged

[![vijaysun-omr](https://avatars.githubusercontent.com/u/22303775?s=60&v=4)](/vijaysun-omr)

**[vijaysun-omr](/vijaysun-omr)**
reviewed
[Oct 18, 2022](#pullrequestreview-1146552553)

 [View reviewed changes](/eclipse-omr/omr/pull/6773/files/f5ab765943c192e25ac8ea8d341f88e6ed9f90d2)

[compiler/optimizer/LocalOpts.cpp](/eclipse-omr/omr/pull/6773/files/f5ab765943c192e25ac8ea8d341f88e6ed9f90d2#diff-dfe9cad35588a16ab4f7269e7f3b7f318a60792ede1fa09912875f46d1b8d65e)

|  |  | @@ -7411,8 +7465,16 @@ void TR\_InvariantArgumentPreexistence::processIndirectCall(TR::Node \*node, TR::T | |
| --- | --- | --- | --- |
|  |  | { |
|  |  | if (comp()->getPersistentInfo()->getRuntimeAssumptionTable()->getAssumptionCount(RuntimeAssumptionOnClassExtend) < 100000) |
|  |  | method = chTable->findSingleInterfaceImplementer(receiverInfo->getClass(), node->getSymbolReference()->getCPIndex(), node->getSymbolReference()->getOwningMethod(comp()), comp()); |
|  |  | //if (method) |
|  |  | // fprintf(stderr, "%s assumptios=%d\n", comp()->signature(), comp()->getPersistentInfo()->getRuntimeAssumptionTable()->getAssumptionCount(RuntimeAssumptionOnClassExtend)); |
|  |  | if (method == NULL) |

Copy link

Contributor

### @vijaysun-omr **[vijaysun-omr](/vijaysun-omr)** [Oct 18, 2022](#discussion_r998735286)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This is just an early return I guess, in that nothing could be done with a null `method` anyway.

Sorry, something went wrong.

 👍
1
 jdmpapin reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[![vijaysun-omr](https://avatars.githubusercontent.com/u/22303775?s=60&v=4)](/vijaysun-omr)

**[vijaysun-omr](/vijaysun-omr)**
approved these changes
[Oct 18, 2022](#pullrequestreview-1146558631)

 [View reviewed changes](/eclipse-omr/omr/pull/6773/files/f5ab765943c192e25ac8ea8d341f88e6ed9f90d2)

[![@vijaysun-omr](https://avatars.githubusercontent.com/u/22303775?s=80&u=31ecc85cd82e24457cdb5a6871be71f8fd525458&v=4)](/vijaysun-omr)

Copy link

Contributor

### **[vijaysun-omr](/vijaysun-omr)** commented [Oct 18, 2022](#issuecomment-1283042943)

| Jenkins build all |
| --- |

All reactions

Sorry, something went wrong.

[![@vijaysun-omr](https://avatars.githubusercontent.com/u/22303775?s=40&u=31ecc85cd82e24457cdb5a6871be71f8fd525458&v=4)](/vijaysun-omr)
[vijaysun-omr](/vijaysun-omr)
self-assigned this
[Oct 18, 2022](#event-7615781533)

[![@vijaysun-omr](https://avatars.githubusercontent.com/u/22303775?s=80&u=31ecc85cd82e24457cdb5a6871be71f8fd525458&v=4)](/vijaysun-omr)

Copy link

Contributor

### **[vijaysun-omr](/vijaysun-omr)** commented [Oct 18, 2022](#issuecomment-1283101839)

| Checks have passed except for known infra issues. The changes are quite safe in that we simply avoid optimizing in some cases where we cannot rely on signatures. Merging. |
| --- |

All reactions

Sorry, something went wrong.

[![@vijaysun-omr](https://avatars.githubusercontent.com/u/22303775?s=40&u=31ecc85cd82e24457cdb5a6871be71f8fd525458&v=4)](/vijaysun-omr)
[vijaysun-omr](/vijaysun-omr)
merged commit [`1e2c4c0`](/eclipse-omr/omr/commit/1e2c4c07cea1d56c9a61ebe96d09fd86a351c995)
into
eclipse-omr:master

[Oct 18, 2022](https://github.com/eclipse-omr/omr/pull/6773#event-7615979915)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-omr%2Fomr%2Fpull%2F6773)

Reviewers

[![@vijaysun-omr](https://avatars.githubusercontent.com/u/22303775?s=40&v=4)](/vijaysun-omr) [vijaysun-omr](/vijaysun-omr)

vijaysun-omr approved these changes

Assignees

[![@vijaysun-omr](https://avatars.githubusercontent.com/u/22303775?s=40&v=4)](/vijaysun-omr) [vijaysun-omr](/vijaysun-omr)

Labels

[comp:compiler](/eclipse-omr/omr/labels/comp%3Acompiler)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=52&v=4)](/jdmpapin) [![@vijaysun-omr](https://avatars.githubusercontent.com/u/22303775?s=52&v=4)](/vijaysun-omr)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1a754e39_20250114_221943.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-openj9%2Fopenj9%2Fpull%2F16122)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-openj9%2Fopenj9%2Fpull%2F16122)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=eclipse-openj9%2Fopenj9)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[eclipse-openj9](/eclipse-openj9)
/
**[openj9](/eclipse-openj9/openj9)**
Public

* [Notifications](/login?return_to=%2Feclipse-openj9%2Fopenj9) You must be signed in to change notification settings
* [Fork
  729](/login?return_to=%2Feclipse-openj9%2Fopenj9)
* [Star
   3.3k](/login?return_to=%2Feclipse-openj9%2Fopenj9)

* [Code](/eclipse-openj9/openj9)
* [Issues
  2.4k](/eclipse-openj9/openj9/issues)
* [Pull requests
  265](/eclipse-openj9/openj9/pulls)
* [Actions](/eclipse-openj9/openj9/actions)
* [Projects
  4](/eclipse-openj9/openj9/projects)
* [Wiki](/eclipse-openj9/openj9/wiki)
* [Security](/eclipse-openj9/openj9/security)
* [Insights](/eclipse-openj9/openj9/pulse)

Additional navigation options

* [Code](/eclipse-openj9/openj9)
* [Issues](/eclipse-openj9/openj9/issues)
* [Pull requests](/eclipse-openj9/openj9/pulls)
* [Actions](/eclipse-openj9/openj9/actions)
* [Projects](/eclipse-openj9/openj9/projects)
* [Wiki](/eclipse-openj9/openj9/wiki)
* [Security](/eclipse-openj9/openj9/security)
* [Insights](/eclipse-openj9/openj9/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Feclipse-openj9%2Fopenj9%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Feclipse-openj9%2Fopenj9%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Disallow nop guards for interface call sites #16122

 Merged

[pshipton](/pshipton)
merged 5 commits into
[eclipse-openj9:master](/eclipse-openj9/openj9/tree/master "eclipse-openj9/openj9:master")
from
[jdmpapin:iface-inl](/jdmpapin/openj9/tree/iface-inl "jdmpapin/openj9:iface-inl")

Oct 19, 2022

 Merged

# [Disallow nop guards for interface call sites](#top) #16122

[pshipton](/pshipton)
merged 5 commits into
[eclipse-openj9:master](/eclipse-openj9/openj9/tree/master "eclipse-openj9/openj9:master")
from
[jdmpapin:iface-inl](/jdmpapin/openj9/tree/iface-inl "jdmpapin/openj9:iface-inl")

Oct 19, 2022

[Conversation
1](/eclipse-openj9/openj9/pull/16122)
[Commits
5](/eclipse-openj9/openj9/pull/16122/commits)
[Checks
0](/eclipse-openj9/openj9/pull/16122/checks)
[Files changed](/eclipse-openj9/openj9/pull/16122/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=60&v=4)](/jdmpapin)

Copy link

Contributor

### @jdmpapin **[jdmpapin](/jdmpapin)** commented [Oct 18, 2022](#issue-1413847840)

...unless inliner has already proved that the receiver is an instance of a particular class that implements the expected interface. (However, it appears that it is currently difficult or maybe impossible to get such a bound despite `tryToRefineReceiverClassBasedOnResolvedTypeArgInfo()`).

A passing `vgnop`-based interface guard can guarantee the receiver type is as expected by the inlined body, but only if we already know before the guard that the receiver implements the expected interface. Here, an interface type bound is insufficient to know that, because bytecode verification does not guarantee any particular receiver type at `invokeinterface`.

As such, in the absence of a class (i.e. non-interface) type bound on the receiver, all targets must use profiled guard. Additionally, the profiled guard must ensure on the hot side that the receiver is an instance of the interface expected at this call site.

There was one circumstance where it was possible to generate a profiled guard with method test for a method defined by a class that does not implement the interface. Inliner now uses a VFT test instead in this situation. Only hot compilations performed during startup are affected.

It was also possible to generate an interface (nop) guard for a single implementer method defined by a class that does not implement the interface. Since this must now be a profiled guard, inliner will only accept single implementers defined by classes that do implement the interface. Others will be rejected in the hope that it will be possible to generate a VFT test based on profiling.

Without these precautions, it would be possible for the JIT to inline a single implementing method with a nop guard, and for execution to flow into the inlined body with a receiver that is not an instance of the class expected by the inlined code. The inlined code could then access fields of the receiver as though it were of the expected type.

---

This series has a few additional changes mainly to reduce the performance impact of all of the additional profiled guards:

* Correct interface call site assertion
* Heuristically consider VFT test for interface call profiled guards
* Be more confident about single interface implementer profiled guards
* Base interface inlining determination directly on VM startup phase

Sorry, something went wrong.

All reactions

 [jdmpapin](/jdmpapin)
added 5 commits
[March 25, 2022 19:45](#commits-pushed-b212891)

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&v=4)](/jdmpapin)

`[Disallow nop guards for interface call sites](/eclipse-openj9/openj9/pull/16122/commits/b212891e3a58fc4f5c229fb32def147c4ba0bd32 "Disallow nop guards for interface call sites

...unless inliner has already proved that the receiver is an instance of
a particular class that implements the expected interface. (However, it
appears that it is currently difficult or maybe impossible to get such a
bound despite tryToRefineReceiverClassBasedOnResolvedTypeArgInfo()).

A passing vgnop-based interface guard can guarantee the receiver type is
as expected by the inlined body, but only if we already know before the
guard that the receiver implements the expected interface. Here, an
interface type bound is insufficient to know that, because bytecode
verification does not guarantee any particular receiver type at
invokeinterface.

As such, in the absence of a class (i.e. non-interface) type bound on
the receiver, all targets must use profiled guard. Additionally, the
profiled guard must ensure on the hot side that the receiver is an
instance of the interface expected at this call site.

There was one circumstance where it was possible to generate a profiled
guard with method test for a method defined by a class that does not
implement the interface. Inliner now uses a VFT test instead in this
situation. Only hot compilations performed during startup are affected.

It was also possible to generate an interface (nop) guard for a single
implementer method defined by a class that does not implement the
interface. Since this must now be a profiled guard, inliner will only
accept single implementers defined by classes that do implement the
interface. Others will be rejected in the hope that it will be possible
to generate a VFT test based on profiling.

Without these precautions, it would be possible for the JIT to inline a
single implementing method with a nop guard, and for execution to flow
into the inlined body with a receiver that is not an instance of the
class expected by the inlined code. The inlined code could then access
fields of the receiver as though it were of the expected type.")`
 …

`[b212891](/eclipse-openj9/openj9/pull/16122/commits/b212891e3a58fc4f5c229fb32def147c4ba0bd32)`

```
...unless inliner has already proved that the receiver is an instance of
a particular class that implements the expected interface. (However, it
appears that it is currently difficult or maybe impossible to get such a
bound despite tryToRefineReceiverClassBasedOnResolvedTypeArgInfo()).

A passing vgnop-based interface guard can guarantee the receiver type is
as expected by the inlined body, but only if we already know before the
guard that the receiver implements the expected interface. Here, an
interface type bound is insufficient to know that, because bytecode
verification does not guarantee any particular receiver type at
invokeinterface.

As such, in the absence of a class (i.e. non-interface) type bound on
the receiver, all targets must use profiled guard. Additionally, the
profiled guard must ensure on the hot side that the receiver is an
instance of the interface expected at this call site.

There was one circumstance where it was possible to generate a profiled
guard with method test for a method defined by a class that does not
implement the interface. Inliner now uses a VFT test instead in this
situation. Only hot compilations performed during startup are affected.

It was also possible to generate an interface (nop) guard for a single
implementer method defined by a class that does not implement the
interface. Since this must now be a profiled guard, inliner will only
accept single implementers defined by classes that do implement the
interface. Others will be rejected in the hope that it will be possible
to generate a VFT test based on profiling.

Without these precautions, it would be possible for the JIT to inline a
single implementing method with a nop guard, and for execution to flow
into the inlined body with a receiver that is not an instance of the
class expected by the inlined code. The inlined code could then access
fields of the receiver as though it were of the expected type.
```

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&v=4)](/jdmpapin)

`[Correct interface call site assertion](/eclipse-openj9/openj9/pull/16122/commits/16ebce00b02416a5239b62ba7ad66da59c192703 "Correct interface call site assertion

Apparently the class pointer in the profiled guard comes directly from
the call site object, not from its virtual guard selection.")`
 …

`[16ebce0](/eclipse-openj9/openj9/pull/16122/commits/16ebce00b02416a5239b62ba7ad66da59c192703)`

```
Apparently the class pointer in the profiled guard comes directly from
the call site object, not from its virtual guard selection.
```

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&v=4)](/jdmpapin)

`[Heuristically consider VFT test for interface call profiled guards](/eclipse-openj9/openj9/pull/16122/commits/b6475510409208ee6885f87ba41633119744577e "Heuristically consider VFT test for interface call profiled guards

In particular, for the profiled guards generated instead of nop guards
due to safety requirements in the case of a single implementer.

VFT test excludes some receivers that could run the inlined method body,
but it's a cheaper test at runtime. It's now preferred:

- when the inlined method is defined by a final class,

- when the inlined method is defined by a class that has not been
  extended (yet),

- when profiling indicates that only a single receiver type occurs.")`
 …

`[b647551](/eclipse-openj9/openj9/pull/16122/commits/b6475510409208ee6885f87ba41633119744577e)`

```
In particular, for the profiled guards generated instead of nop guards
due to safety requirements in the case of a single implementer.

VFT test excludes some receivers that could run the inlined method body,
but it's a cheaper test at runtime. It's now preferred:

- when the inlined method is defined by a final class,

- when the inlined method is defined by a class that has not been
  extended (yet),

- when profiling indicates that only a single receiver type occurs.
```

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&v=4)](/jdmpapin)

`[Be more confident about single interface implementer profiled guards](/eclipse-openj9/openj9/pull/16122/commits/a628c7796b8b9d9721ecdbd88c0ecfaa35690d87 "Be more confident about single interface implementer profiled guards

These guards used to be nop guards. They no longer are, but only because
certain kinds of bytecode are technically allowed to be loaded. Bytecode
that is problematic in this way should be exceedingly rare though, so
treat these guards more like the nop guards we used to have by marking
the taken side cold and by making sure to allow privatized argument
rematerialization.")`
 …

`[a628c77](/eclipse-openj9/openj9/pull/16122/commits/a628c7796b8b9d9721ecdbd88c0ecfaa35690d87)`

```
These guards used to be nop guards. They no longer are, but only because
certain kinds of bytecode are technically allowed to be loaded. Bytecode
that is problematic in this way should be exceedingly rare though, so
treat these guards more like the nop guards we used to have by marking
the taken side cold and by making sure to allow privatized argument
rematerialization.
```

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&v=4)](/jdmpapin)

`[Base interface inlining determination directly on VM startup phase](/eclipse-openj9/openj9/pull/16122/commits/6dbf777ff3e147208b76ce40cecb75c529a34c4c "Base interface inlining determination directly on VM startup phase

The JIT can re-enter STARTUP_STATE after leaving it, and it can remain
in that state for much longer than one might naively expect, inhibiting
these heuristics.")`
 …

`[6dbf777](/eclipse-openj9/openj9/pull/16122/commits/6dbf777ff3e147208b76ce40cecb75c529a34c4c)`

```
The JIT can re-enter STARTUP_STATE after leaving it, and it can remain
in that state for much longer than one might naively expect, inhibiting
these heuristics.
```

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&u=3a0011825251c1cb4bd23655390d09970bdc01d7&v=4)](/jdmpapin)
[jdmpapin](/jdmpapin)
added
the
[comp:jit](/eclipse-openj9/openj9/labels/comp%3Ajit)
label
[Oct 18, 2022](#event-7615439580)

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=40&u=3a0011825251c1cb4bd23655390d09970bdc01d7&v=4)](/jdmpapin)
[jdmpapin](/jdmpapin)
mentioned this pull request
[Oct 18, 2022](#ref-pullrequest-1413851923)

[(0.35) Disallow nop guards for interface call sites
#16123](/eclipse-openj9/openj9/pull/16123)
 Merged

[![@pshipton](https://avatars.githubusercontent.com/u/18122812?s=80&u=89c81cc44696bb9083d0915cf3f04047ebdea42f&v=4)](/pshipton)

Copy link

Member

### **[pshipton](/pshipton)** commented [Oct 18, 2022](#issuecomment-1283021132)

| jenkins test sanity alinux64,aix,xmac,amac,win,zlinux jdk11,jdk17 depends [eclipse-omr/omr#6773](https://github.com/eclipse-omr/omr/pull/6773) |
| --- |

All reactions

Sorry, something went wrong.

[![pshipton](https://avatars.githubusercontent.com/u/18122812?s=60&v=4)](/pshipton)

**[pshipton](/pshipton)**
approved these changes
[Oct 19, 2022](#pullrequestreview-1147803505)

 [View reviewed changes](/eclipse-openj9/openj9/pull/16122/files/6dbf777ff3e147208b76ce40cecb75c529a34c4c)

[![@pshipton](https://avatars.githubusercontent.com/u/18122812?s=40&u=89c81cc44696bb9083d0915cf3f04047ebdea42f&v=4)](/pshipton)
[pshipton](/pshipton)
merged commit [`0d7572f`](/eclipse-openj9/openj9/commit/0d7572f0273f04fe5d3df502e2f367b51537c7da)
into
eclipse-openj9:master

[Oct 19, 2022](https://github.com/eclipse-openj9/openj9/pull/16122#event-7622748892)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-openj9%2Fopenj9%2Fpull%2F16122)

Reviewers

[![@pshipton](https://avatars.githubusercontent.com/u/18122812?s=40&v=4)](/pshipton) [pshipton](/pshipton)

pshipton approved these changes

Assignees

No one assigned

Labels

[comp:jit](/eclipse-openj9/openj9/labels/comp%3Ajit)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@jdmpapin](https://avatars.githubusercontent.com/u/22403820?s=52&v=4)](/jdmpapin) [![@pshipton](https://avatars.githubusercontent.com/u/18122812?s=52&v=4)](/pshipton)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from gitlab.eclipse.org_9654937a_20250114_221946.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# CVE Request: technology.openj9 OpenJ9 may inline an interface call incorrectly, allowing type confusion

The Eclipse Foundation is a [Common Vulnerabilities and Exposures](https://cve.mitre.org/) (CVE) Numbering Authority. This issue it used to request and track the progress of the assignment of a CVE for a vulnerability in the project code for an Eclipse open source project.

## Basic information

**Project name:** OpenJ9

**Project id:** technology.openj9

**Versions affected:** [Initial - 0.35.0)

**Common Weakness Enumeration:**

* [CWE-20: Improper Input Validation](https://cwe.mitre.org/data/definitions/20.html)
* [CWE-843: Access of Resource Using Incompatible Type ('Type Confusion')](https://cwe.mitre.org/data/definitions/843.html)

**Common Vulnerability Scoring System:** {[cvss](https://nvd.nist.gov/vuln-metrics/cvss)}

**Summary:**

In Eclipse Openj9 before version 0.35.0, interface calls can be inlined without a runtime type check. Malicious bytecode could make use of this inlining to access or modify memory via an incompatible type.

**Links:**

* [Disallow nop guards for interface call sites](https://github.com/eclipse-openj9/openj9/pull/16122)
* [Stop devirtualizing interface calls in preexistence](https://github.com/eclipse/omr/pull/6773)

## Tracking

**This section will completed by the project team**.

* We're ready for this issue to be reported to the central authority (i.e., make this public now)
* (when applicable) The GitHub Security Advisory is ready to be published now

Note that for those projects that host their repositories on GitHub, the use of GitHub Security Advisories is recommended but is not required.

**This section will be completed by the EMO**.

**CVE:** {cve}

* All required information is provided
* CVE Assigned
* Pushed to Mitre
* Accepted by Mitre

Edited Oct 24, 2022 by [Mikaël Barbero](/mbarbero)

Assignee
Loading

Time tracking
Loading

Copyright © Eclipse Foundation, Inc. All Rights Reserved.     [Privacy Policy](https://www.eclipse.org/legal/privacy.php) | [Terms of Use](https://www.eclipse.org/legal/termsofuse.php) | [Copyright Agent](https://www.eclipse.org/legal/copyright.php)


