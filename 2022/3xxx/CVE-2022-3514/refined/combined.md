=== Content from gitlab.com_e265cfa5_20250115_092751.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-3514.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-3514.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-3514.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-3514.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Jan 10, 2023

  [dd17e68f](/gitlab-org/cves/-/commit/dd17e68f064c22e5be6ea9bb4612419bff3c6f31)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/dd17e68f064c22e5be6ea9bb4612419bff3c6f31)
  ·
  dd17e68f

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jan 10, 2023

  dd17e68f

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/dd17e68f064c22e5be6ea9bb4612419bff3c6f31)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jan 10, 2023

Loading



=== Content from gitlab.com_131b3f2e_20250115_092752.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Regex DOS in the Submodule Url Parser

**[HackerOne report #1727201](https://hackerone.com/reports/1727201)** by `mokusou` on 2022-10-08, assigned to [@cmaxim](/cmaxim "Costel Maxim"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

An attacker is able to DoS an instance of GitLab by exploiting a regex issue in the submodule URL parser.

The root cause:

<https://gitlab.com/gitlab-org/gitlab/-/blob/d78a491f7503537c48532f8e7c086464f64c7698/app/helpers/submodule_helper.rb#L20>

```
    if url =~ %r{([^/:]+)/([^/]+(?:\.git)?)\Z}
```

The regex in the above file, line20 causes re-DoS when receiving a value such as `aaaaaa....aaaaaaaaaaaaaaaaa/a/`

##### Steps to reproduce

1. Create your own instance and a normal-privileged (non-admin) user as an attacker.
2. As the normal user you just created, make two projects(Let's name them project A and B), and attach the project B project to the Project A as a submodule. One way to do this is to run the following command in a local branch of project A: `git submodule add https://gl.ryotak.me/Mokusou/submodule-for-redos-poc(Replace this URL with URL of project B) submodule-redos`( please use `submodule-redos` and not other names to use the PoC file in step3 without any modification)
3. Once you complete step2, now you should have a file named ".gitmodules" in your local branch of project A. Replace the file with the following file;

   [![.gitmodules](data:image/gif;base64...)](https://user-content.gitlab-static.net/3e766d68d98b80bd00b6b24af66996e951a9dac8/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63653364633661332d636161362d343530302d623862622d6334383566646536373632642f2e6769746d6f64756c6573)
4. Push the change you have made in steps 2 and 3 to your instance.
5. Visit the following URL, but with your own domain name instead of `gl.ryotak.me`; <https://gl.ryotak.me/-/graphql-explorer>.
6. SSH to your server and run `htop` to check the CPU usage, and then send the following query with your main project name in the full path parameter via the GraphQL UI in step6. Once you hit the `send` button multiple time, you should see that CPU usage goes to 100%

```
query {
  project(fullPath:"Mokusou/poc-for-redos") {
    repository{
      tree{
        submodules{
          nodes{
            id
            webUrl
            treeUrl
            flatPath
          }
        }
      }
    }
  }
}
```

7. Visit your instance (<https://gl.ryotak.me/> in my case) from a web browser, and see the bad gateway timeout

##### Impact

An attacker can make a server down and inaccessible (HTTP response 502) by sending multiple GraphQL requests with about 3-million-characters payload. Please also refer to the attached video PoC for the actual simulation.

##### What is the current *bug* behavior?

DoS the instance. Please see the attached video PoC for more details.

##### What is the expected *correct* behavior?

A timeout should be set for the above-mentioned Regex to avoid DoS.

##### Relevant logs and/or screenshots

[poc\_for\_redos\_gitlab.mp4](https://user-content.gitlab-static.net/66ccae1aec96d7037e220984dc58d15fd474e2e7/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f36386435393163382d356466622d343630332d386330322d3263396234393166633938662f706f635f666f725f7265646f735f6769746c61622e6d7034 "Download 'poc_for_redos_gitlab.mp4'")

###### Results of GitLab environment info

```
ubuntu@i-12100000422677:~$ sudo gitlab-rake gitlab:env:info

System information
System:         Ubuntu 20.04
Proxy:          no
Current User:   git
Using RVM:      no
Ruby Version:   2.7.5p203
Gem Version:    3.1.6
Bundler Version:2.3.15
Rake Version:   13.0.6
Redis Version:  6.2.7
Sidekiq Version:6.4.2
Go Version:     unknown

GitLab information
Version:        15.4.1-ee
Revision:       7b2ed8f038f
Directory:      /opt/gitlab/embedded/service/gitlab-rails
DB Adapter:     PostgreSQL
DB Version:     13.6
URL:            https://gl.ryotak.me
HTTP Clone URL: https://gl.ryotak.me/some-group/some-project.git
SSH Clone URL:  git@gl.ryotak.me:some-group/some-project.git
Elasticsearch:  no
Geo:            no
Using LDAP:     no
Using Omniauth: yes
Omniauth Providers:

GitLab Shell
Version:        14.10.0
Repository storage paths:
- default:      /var/opt/gitlab/git-data/repositories
GitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell
```

#### Impact

An attacker can make a server down and inaccessible (HTTP response 502) by sending multiple GraphQL requests with about 3-million-characters payload. Please also refer to the attached video PoC for the actual simulation.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [poc\_for\_redos\_gitlab.mp4](https://h1.sec.gitlab.net/a/68d591c8-5dfb-4603-8c02-2c9b491fc98f/poc_for_redos_gitlab.mp4)
* [.gitmodules](https://h1.sec.gitlab.net/a/ce3dc6a3-caa6-4500-b8bb-c485fde6762d/.gitmodules)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


