=== Content from git.kernel.org_ae1e9481_20250114_230621.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [summary](/pub/scm/linux/kernel/git/torvalds/linux.git/?h=v5.19-rc2)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/?h=v5.19-rc2)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/?h=v5.19-rc2) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jiasheng Jiang <jiasheng@iscas.ac.cn> | 2022-01-14 07:28:40 +0100 |
| --- | --- | --- |
| committer | Mauro Carvalho Chehab <mchehab@kernel.org> | 2022-03-07 11:06:19 +0100 |
| commit | [e6a21a14106d9718aa4f8e115b1e474888eeba44](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=e6a21a14106d9718aa4f8e115b1e474888eeba44)) | |
| tree | [c9d9fe68b0886e1a16cc5365e0ce690f458109d0](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44) | |
| parent | [479f4a6e602a46c110affeeb866d2d03422418ee](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?h=v5.19-rc2&id=479f4a6e602a46c110affeeb866d2d03422418ee) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44&id2=479f4a6e602a46c110affeeb866d2d03422418ee)) | |
| download | [linux-e6a21a14106d9718aa4f8e115b1e474888eeba44.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-e6a21a14106d9718aa4f8e115b1e474888eeba44.tar.gz) | |

media: vidtv: Check for null return of vzallocAs the possible failure of the vzalloc(), e->encoder\_buf might be NULL.
Therefore, it should be better to check it in order
to guarantee the success of the initialization.
If fails, we need to free not only 'e' but also 'e->name'.
Also, if the allocation for ctx fails, we need to free 'e->encoder\_buf'
else.
Fixes: f90cf6079bf6 ("media: vidtv: add a bridge driver")
Signed-off-by: Jiasheng Jiang <jiasheng@iscas.ac.cn>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44)

| -rw-r--r-- | [drivers/media/test-drivers/vidtv/vidtv\_s302m.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/media/test-drivers/vidtv/vidtv_s302m.c?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 4 deletions

| diff --git a/drivers/media/test-drivers/vidtv/vidtv\_s302m.c b/drivers/media/test-drivers/vidtv/vidtv\_s302m.cindex d79b65854627cc..4676083cee3b8a 100644--- a/[drivers/media/test-drivers/vidtv/vidtv\_s302m.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/media/test-drivers/vidtv/vidtv_s302m.c?h=v5.19-rc2&id=479f4a6e602a46c110affeeb866d2d03422418ee)+++ b/[drivers/media/test-drivers/vidtv/vidtv\_s302m.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/media/test-drivers/vidtv/vidtv_s302m.c?h=v5.19-rc2&id=e6a21a14106d9718aa4f8e115b1e474888eeba44)@@ -455,6 +455,9 @@ struct vidtv\_encoder e->name = kstrdup(args.name, GFP\_KERNEL);  e->encoder\_buf = vzalloc(VIDTV\_S302M\_BUF\_SZ);+ if (!e->encoder\_buf)+ goto out\_kfree\_e;+ e->encoder\_buf\_sz = VIDTV\_S302M\_BUF\_SZ; e->encoder\_buf\_offset = 0; @@ -467,10 +470,8 @@ struct vidtv\_encoder e->is\_video\_encoder = false;  ctx = kzalloc(priv\_sz, GFP\_KERNEL);- if (!ctx) {- kfree(e);- return NULL;- }+ if (!ctx)+ goto out\_kfree\_buf;  e->ctx = ctx; ctx->last\_duration = 0;@@ -498,6 +499,14 @@ struct vidtv\_encoder e->next = NULL;  return e;++out\_kfree\_buf:+ kfree(e->encoder\_buf);++out\_kfree\_e:+ kfree(e->name);+ kfree(e);+ return NULL; }  void vidtv\_s302m\_encoder\_destroy(struct vidtv\_encoder \*e) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 23:04:58 +0000


