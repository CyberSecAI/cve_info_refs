=== Content from git.kernel.org_b53b79f1_20250114_214320.html ===


| [cgit logo](/) | [index](/) : [kernel/git/klassert/ipsec-next.git](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/) | master testing |
| --- | --- | --- |
| Steffen Klassert's ipsec-next networking tree | Steffen Klassert |

| [about](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/about/)[summary](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/)[refs](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/refs/?id=8c21c54a53ab21842f5050fa090f26b03c0313d6)[log](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/log/)[tree](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/tree/?id=8c21c54a53ab21842f5050fa090f26b03c0313d6)[commit](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/commit/?id=8c21c54a53ab21842f5050fa090f26b03c0313d6)[diff](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/diff/?id=8c21c54a53ab21842f5050fa090f26b03c0313d6)[stats](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Fedor Pchelkin <pchelkin@ispras.ru> | 2022-08-05 18:02:16 +0300 |
| --- | --- | --- |
| committer | Marc Kleine-Budde <mkl@pengutronix.de> | 2022-08-09 09:05:06 +0200 |
| commit | [8c21c54a53ab21842f5050fa090f26b03c0313d6](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/commit/?id=8c21c54a53ab21842f5050fa090f26b03c0313d6) ([patch](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/patch/?id=8c21c54a53ab21842f5050fa090f26b03c0313d6)) | |
| tree | [2e7f11461b9d62a1e6798b71c4aa9f789569e532](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/tree/?id=8c21c54a53ab21842f5050fa090f26b03c0313d6) | |
| parent | [8ef49f7f8244424adcf4a546dba4cbbeb0b09c09](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/commit/?id=8ef49f7f8244424adcf4a546dba4cbbeb0b09c09) ([diff](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/diff/?id=8c21c54a53ab21842f5050fa090f26b03c0313d6&id2=8ef49f7f8244424adcf4a546dba4cbbeb0b09c09)) | |
| download | [ipsec-next-8c21c54a53ab21842f5050fa090f26b03c0313d6.tar.gz](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/snapshot/ipsec-next-8c21c54a53ab21842f5050fa090f26b03c0313d6.tar.gz) | |

can: j1939: j1939\_session\_destroy(): fix memory leak of skbsWe need to drop skb references taken in j1939\_session\_skb\_queue() when
destroying a session in j1939\_session\_destroy(). Otherwise those skbs
would be lost.
Link to Syzkaller info and repro: https://forge.ispras.ru/issues/11743.
Found by Linux Verification Center (linuxtesting.org) with Syzkaller.
V1: https://lore.kernel.org/all/20220708175949.539064-1-pchelkin@ispras.ru
Fixes: 9d71dd0c7009 ("can: add support of SAE J1939 protocol")
Suggested-by: Oleksij Rempel <o.rempel@pengutronix.de>
Signed-off-by: Fedor Pchelkin <pchelkin@ispras.ru>
Signed-off-by: Alexey Khoroshilov <khoroshilov@ispras.ru>
Acked-by: Oleksij Rempel <o.rempel@pengutronix.de>
Link: [https://lore.kernel.org/all/20220805150216.66313-1-pchelkin@ispras.ru](https://lore.kernel.org/all/20220805150216.66313-1-pchelkin%40ispras.ru)
Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>
[Diffstat](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/diff/?id=8c21c54a53ab21842f5050fa090f26b03c0313d6)

| -rw-r--r-- | [net/can/j1939/transport.c](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/diff/net/can/j1939/transport.c?id=8c21c54a53ab21842f5050fa090f26b03c0313d6) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 1 deletions

| diff --git a/net/can/j1939/transport.c b/net/can/j1939/transport.cindex 307ee1174a6e2e..d7d86c944d76d3 100644--- a/[net/can/j1939/transport.c](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/tree/net/can/j1939/transport.c?id=8ef49f7f8244424adcf4a546dba4cbbeb0b09c09)+++ b/[net/can/j1939/transport.c](/pub/scm/linux/kernel/git/klassert/ipsec-next.git/tree/net/can/j1939/transport.c?id=8c21c54a53ab21842f5050fa090f26b03c0313d6)@@ -260,6 +260,8 @@ static void \_\_j1939\_session\_drop(struct j1939\_session \*session)  static void j1939\_session\_destroy(struct j1939\_session \*session) {+ struct sk\_buff \*skb;+ if (session->transmission) { if (session->err) j1939\_sk\_errqueue(session, J1939\_ERRQUEUE\_TX\_ABORT);@@ -274,7 +276,11 @@ static void j1939\_session\_destroy(struct j1939\_session \*session) WARN\_ON\_ONCE(!list\_empty(&session->sk\_session\_queue\_entry)); WARN\_ON\_ONCE(!list\_empty(&session->active\_session\_list\_entry)); - skb\_queue\_purge(&session->skb\_queue);+ while ((skb = skb\_dequeue(&session->skb\_queue)) != NULL) {+ /\* drop ref taken in j1939\_session\_skb\_queue() \*/+ skb\_unref(skb);+ kfree\_skb(skb);+ } \_\_j1939\_session\_drop(session); j1939\_priv\_put(session->priv); kfree(session); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 21:41:57 +0000


