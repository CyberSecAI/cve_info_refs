=== Content from git.kernel.org_7acd8e09_20250115_082011.html ===


| [cgit logo](/) | [index](/) : [kernel/git/bpf/bpf-next.git](/pub/scm/linux/kernel/git/bpf/bpf-next.git/) | for-next master net |
| --- | --- | --- |
| BPF next kernel tree | BPF Group |

| [about](/pub/scm/linux/kernel/git/bpf/bpf-next.git/about/)[summary](/pub/scm/linux/kernel/git/bpf/bpf-next.git/)[refs](/pub/scm/linux/kernel/git/bpf/bpf-next.git/refs/?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2)[log](/pub/scm/linux/kernel/git/bpf/bpf-next.git/log/)[tree](/pub/scm/linux/kernel/git/bpf/bpf-next.git/tree/?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2)[commit](/pub/scm/linux/kernel/git/bpf/bpf-next.git/commit/?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2)[diff](/pub/scm/linux/kernel/git/bpf/bpf-next.git/diff/?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2)[stats](/pub/scm/linux/kernel/git/bpf/bpf-next.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shung-Hsi Yu <shung-hsi.yu@suse.com> | 2022-10-12 10:23:53 +0800 |
| --- | --- | --- |
| committer | Andrii Nakryiko <andrii@kernel.org> | 2022-10-13 10:53:34 -0700 |
| commit | [d0d382f95a9270dcf803539d6781d6bd67e3f5b2](/pub/scm/linux/kernel/git/bpf/bpf-next.git/commit/?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2) ([patch](/pub/scm/linux/kernel/git/bpf/bpf-next.git/patch/?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2)) | |
| tree | [f42662b1b505ba76f5f4e635ebd6d003295c8342](/pub/scm/linux/kernel/git/bpf/bpf-next.git/tree/?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2) | |
| parent | [35a855509e6ee3442477c8ebc6827b5b5d32a7b5](/pub/scm/linux/kernel/git/bpf/bpf-next.git/commit/?id=35a855509e6ee3442477c8ebc6827b5b5d32a7b5) ([diff](/pub/scm/linux/kernel/git/bpf/bpf-next.git/diff/?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2&id2=35a855509e6ee3442477c8ebc6827b5b5d32a7b5)) | |
| download | [bpf-next-d0d382f95a9270dcf803539d6781d6bd67e3f5b2.tar.gz](/pub/scm/linux/kernel/git/bpf/bpf-next.git/snapshot/bpf-next-d0d382f95a9270dcf803539d6781d6bd67e3f5b2.tar.gz) | |

libbpf: Fix null-pointer dereference in find\_prog\_by\_sec\_insn()When there are no program sections, obj->programs is left unallocated,
and find\_prog\_by\_sec\_insn()'s search lands on &obj->programs[0] == NULL,
and will cause null-pointer dereference in the following access to
prog->sec\_idx.
Guard the search with obj->nr\_programs similar to what's being done in
\_\_bpf\_program\_\_iter() to prevent null-pointer access from happening.
Fixes: db2b8b06423c ("libbpf: Support CO-RE relocations for multi-prog sections")
Signed-off-by: Shung-Hsi Yu <shung-hsi.yu@suse.com>
Signed-off-by: Andrii Nakryiko <andrii@kernel.org>
Link: [https://lore.kernel.org/bpf/20221012022353.7350-4-shung-hsi.yu@suse.com](https://lore.kernel.org/bpf/20221012022353.7350-4-shung-hsi.yu%40suse.com)
[Diffstat](/pub/scm/linux/kernel/git/bpf/bpf-next.git/diff/?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2)

| -rw-r--r-- | [tools/lib/bpf/libbpf.c](/pub/scm/linux/kernel/git/bpf/bpf-next.git/diff/tools/lib/bpf/libbpf.c?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/tools/lib/bpf/libbpf.c b/tools/lib/bpf/libbpf.cindex 29e9df0c232b41..8c3f236c86e403 100644--- a/[tools/lib/bpf/libbpf.c](/pub/scm/linux/kernel/git/bpf/bpf-next.git/tree/tools/lib/bpf/libbpf.c?id=35a855509e6ee3442477c8ebc6827b5b5d32a7b5)+++ b/[tools/lib/bpf/libbpf.c](/pub/scm/linux/kernel/git/bpf/bpf-next.git/tree/tools/lib/bpf/libbpf.c?id=d0d382f95a9270dcf803539d6781d6bd67e3f5b2)@@ -4115,6 +4115,9 @@ static struct bpf\_program \*find\_prog\_by\_sec\_insn(const struct bpf\_object \*obj, int l = 0, r = obj->nr\_programs - 1, m; struct bpf\_program \*prog; + if (!obj->nr\_programs)+ return NULL;+ while (l < r) { m = l + (r - l + 1) / 2; prog = &obj->programs[m]; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:18:49 +0000


