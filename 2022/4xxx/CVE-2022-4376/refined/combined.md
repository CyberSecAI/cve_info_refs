=== Content from gitlab.com_b2e3acd4_20250114_234041.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Authenticated users can find other users by their private email

**[HackerOne report #1794713](https://hackerone.com/reports/1794713)** by `shells3c` on 2022-12-06, assigned to [@rshambhuni](/rshambhuni "Rohit Shambhuni"):

[Report](#report) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Since [GitLab 14.7.1, 14.6.4, and 14.5.4](https://about.gitlab.com/releases/2022/02/03/security-release-gitlab-14-7-1-released/), you can no longer find users by their non-public email, it's the fix for [CVE-2022-0371](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0371). This is also [documented in the official documentation](https://docs.gitlab.com/ee/api/users.html#for-normal-users). However, I found that I could still do it just by using a commit trailer, this happens because [lib/banzai/filter/commit\_trailers\_filter.rb](https://gitlab.com/gitlab-org/gitlab-foss/-/blob/master/lib/banzai/filter/commit_trailers_filter.rb) uses `User.find_by_any_email` to find user handle from an email address, and `User.find_by_any_email` doesn't respect the email policy at all:

```
    def trailer_filter(text)
        text.lines.map! do |line|
          trailer, rest = line.split(':', 2)

          next line unless trailer.downcase.end_with?('-by') && rest.present?

          chunks = rest.split
          author_email = chunks.pop.delete_prefix('&lt;').delete_suffix('&gt;')
          next line unless Devise.email_regexp.match(author_email)

          author_name = chunks.join(' ').strip
          trailer = "#{trailer.strip}:"

          "#{trailer} #{link_to_user_or_email(author_name, author_email, trailer)}\n"
        end.join
      end
```

```
      def link_to_user_or_email(name, email, trailer)
        link_to_user User.find_by_any_email(email),
          name: name,
          email: email,
          trailer: trailer
      end
```

Something like below:

```
commit cd330155a136985ada2c350c854a835afed1fb11 (HEAD -> h1test, origin/h1test)
Author: me <me@myemail.com>
Date:   Tue Dec 6 14:36:00 2022 +0700

    Commit message

    Co-authored-by: foo <privateemail@gmail.com>
```

will be converted to:

```
<a href="https://gitlab.com/USERNAME" title="privateemail@gmail.com">
 <img alt="FULL_NAME's avatar" src="..." class="avatar s16 avatar-inline" title="FULL_NAME">
</a>
<a href="https://gitlab.com/USERNAME" title="privateemail@gmail.com">foo</a>
&lt;<a href="mailto:privateemail@gmail.com" title="privateemail@gmail.com">privateemail@gmail.com</a> &gt;
```

##### Steps to reproduce

I will use my own email address in this test: `hacker0x02@gmail.com`

1. Confirm that the email isn't public and can't be searched via the API by visiting `https://gitlab.com/api/v4/users?search=hacker0x02@gmail.com`

Response:

```
[]
```

2. Create a repository, clone it and do the following:

```
$ echo test > a.txt
$ git add -A
$ git commit -m '.
>
> Co-authored-by: a <hacker0x02@gmail.com>'
$ git checkout -b h1test
$ git push origin h1test
...
```

3. Visit the repository, view **Commits** and you will find the commit
4. Expand the commit and click on the avatar, you will be redirected to my Gitlab account

##### Output of checks

This bug happens on GitLab.com

#### Impact

Similar to CVE-2022-0371, users can look up accounts with private email addresses

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_cc468309_20250114_234039.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-4376.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-4376.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-4376.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-4376.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  May 03, 2023

  [48000e9f](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  [Publishing 0 updated advisories and 9 new advisories](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  ·
  48000e9f

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 03, 2023

  48000e9f

  [Publishing 0 updated advisories and 9 new advisories](/gitlab-org/cves/-/commit/48000e9f864b93d847912de7976e32de66a6c89a)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored May 03, 2023

Loading


