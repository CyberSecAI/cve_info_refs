=== Content from gitlab.com_1b93c226_20250114_223332.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Possible SSRF web terminal advertise\_address

# Problem and impact

Assuming a malicious runner specifies an internal host for it's `[session_server]`, GitLab will attempt to connect/make outbound request to internal address space if specified in `advertise_address`.

Impact here is likely limited since it's only a simple blind GET request. Due to time constraints, further impact was not determined. Below shows the client (GitLab) closing the TLS connection due to my runner session server having a bad certificate, perhaps further investigation or properly signed cert by a CA could lead to further impact.

# PoC

1. In runner `config.toml`:

   ```
   advertise_address = "127.0.0.1:7777"
   ```
2. Open a web terminal.
3. On GitLab host:

   ```
   root@gitlab:/# ncat -lvnp 7777 --ssl
   Ncat: Version 7.70 ( https://nmap.org/ncat )
   Ncat: Generating a temporary 1024-bit RSA key. Use --ssl-key and --ssl-cert to use a permanent one.
   Ncat: SHA-1 fingerprint: 4DFC C238 4B87 AD3D 5B6E 87FE 8D17 8CFE E761 03EC
   Ncat: Listening on :::7777
   Ncat: Listening on 0.0.0.0:7777
   Ncat: Connection from 127.0.0.1.
   Ncat: Connection from 127.0.0.1:34126.
   Ncat: Failed SSL connection from 127.0.0.1: error:14094412:SSL routines:ssl3_read_bytes:sslv3 alert bad certificate

   ```

# Proposed solution

Utilize current GitLab SSRF prevention library on user input hosts/URIs: <https://gitlab.com/gitlab-org/gitlab-ce/blob/master/lib/gitlab/url_blocker.rb>

Edited Oct 20, 2022 by [Pedro Pombeiro](/pedropombeiro)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_ddd80458_20250114_223331.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-4201.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-4201.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-4201.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-4201.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Jan 26, 2023

  [b41851c7](/gitlab-org/cves/-/commit/b41851c78cce726b40e1563b198d2d05475062ec)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/b41851c78cce726b40e1563b198d2d05475062ec)
  ·
  b41851c7

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jan 26, 2023

  b41851c7

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/b41851c78cce726b40e1563b198d2d05475062ec)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jan 26, 2023

Loading


