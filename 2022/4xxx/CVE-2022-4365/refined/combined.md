=== Content from gitlab.com_1fc03e1b_20250115_101141.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-4365.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-4365.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-4365.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-4365.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Jan 10, 2023

  [b65feb59](/gitlab-org/cves/-/commit/b65feb59fc839c3fec06fec4a422130be5eab343)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/b65feb59fc839c3fec06fec4a422130be5eab343)
  ·
  b65feb59

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jan 10, 2023

  b65feb59

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/b65feb59fc839c3fec06fec4a422130be5eab343)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Jan 10, 2023

Loading



=== Content from gitlab.com_c10be7f8_20250115_101142.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Maintainer can leak sentry token by changing the configured URL

**[HackerOne report #1792626](https://hackerone.com/reports/1792626)** by `joaxcar` on 2022-12-04, assigned to [@cmaxim](/cmaxim "Costel Maxim"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

#### Summary

At the same time as other fixes regarding integration tokens leakage by modifying the configured URL, there were also a fix for the same behaviour in the error tracking Sentry configuration. All fixes were part of the patch

<https://about.gitlab.com/releases/2022/07/28/security-release-gitlab-15-2-1-released/#maintainer-can-leak-packagist-and-other-integration-access-tokens-by-changing-integration-url>

**This made the following change to Sentry token configuration**: When a user tries to modify the current sentry URL, the token field will be reset and the user needs to enter a new token. This fix is in place and trying to modify the existing token and clicking save will throw an error telling us the token field can not be empty.

This is made to block other maintainers to leak the configured token.

But revisiting the settings page for Sentry error tracking made me realize that there is another way to leak the token. If the attacker modifies the configured URL and click the connect button (to retrieve the sentry projects) without first clicking `save`, a call will be issued to the new URL together with the old token.

[![click_this.jpg](data:image/gif;base64...)](https://user-content.gitlab-static.net/9f5b9b153f20c2bccde4ac9dd515d957d58a07ba/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39363638616137372d336533332d346563392d623161332d6337623462656165663137352f636c69636b5f746869732e6a7067)

[![colab.jpg](data:image/gif;base64...)](https://user-content.gitlab-static.net/14258827940772981575f063622fdbb0f97e3912/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61376532663231372d356662312d346430312d626335382d3665343266376361316533302f636f6c61622e6a7067)

##### CVSS

The documentation for adding Sentry tokens to GitLab states

> Make sure to give the token at least the following scopes: project:read, event:read, and event:write (for resolving events).

The last time I reported an issue regarding these tokens this was enough to give the impact of confidentiality `High` and Integrity `Low` as the token will have both read and write access. As well as scope changed. The fact that the user needs to be a maintainer makes access required `High` but is still a leak as previous patches show.

#### Steps to reproduce

1. Log in to Gitlab.com
2. Create a project
3. Go to <https://gitlab.com/GROUPNAME/PROJECTNAME/-/settings/operations>
4. Expand ´Error trackin` and click Sentry
5. Configure with the server `https://joaxcar.com` (this is a fake server that will let you add it with any token)
6. Add a random token, and click connect. My server will respond with a `project`you can pick in the dropdown. Do it and click save
7. Now the token should be hidden. The next step should be made by an attacker. But doing it with the same user still proves the point.
8. Now change the URL to a catch server. Burp collaborator for example.
9. Click "save" to get a message telling you you need to add a new token (DONT change the token) this step is to show that the patch is in place and a leak can not be made like this).
10. instead click "connect"
11. Check your server and you should see a request containing the token

#### Impact

Other users can leak the configured Sentry token, getting access to the sentry server. The token gives read and write access to the Sentry instance

#### What is the current *bug* behavior?

The old token is sent with a connect request even if the URL has changed

#### What is the expected *correct* behavior?

Changing the URL should require adding a new token even for connect requests

#### Output of checks

This bug happens on GitLab.com

#### Impact

Other users can leak the configured Sentry token, getting access to the sentry server. The token gives read and write access to the Sentry instance

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [click\_this.jpg](https://h1.sec.gitlab.net/a/9668aa77-3e33-4ec9-b1a3-c7b4beaef175/click_this.jpg)
* [colab.jpg](https://h1.sec.gitlab.net/a/a7e2f217-5fb1-4d01-bc58-6e42f7ca1e30/colab.jpg)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


