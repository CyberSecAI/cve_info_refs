=== Content from gitlab.com_163f3897_20250114_202928.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Clipboard based XSS in the title field of work items

**[HackerOne report #1767745](https://hackerone.com/reports/1767745)** by `ryotak` on 2022-11-09, assigned to `GitLab Team`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

Due to the improper handling of the clipboard contents in the title field of work items, an attacker is able to insert a malicious HTML element that triggers the execution of JavaScript.

Please refer to #1196958 for a similar report and discussions about this vulnerability type.

##### Description

In the `work/items/components/item_title.vue` component of GitLab, the `contenteditable` attribute is specified.

[`app/assets/javascripts/work_items/components/item_title.vue` line 42-59](https://gitlab.com/gitlab-org/gitlab/-/blob/9b233afe4455df0ebc938f0bce0c033b1afba4b7/app/assets/javascripts/work_items/components/item_title.vue#L42-59)

```
    <span
      id="item-title"
      ref="titleEl"
      role="textbox"
      :aria-label="__('Title')"
      :data-placeholder="placeholder"
      :contenteditable="!disabled"
      class="gl-px-4 gl-py-3 gl-ml-n4 gl-border gl-border-white gl-rounded-base gl-display-block"
      :class="{ 'gl-hover-border-gray-200 gl-pseudo-placeholder': !disabled }"
      [@]blur="handleBlur"
      [@]keyup="handleInput"
      [@]keydown.enter.exact="handleSubmit"
      [@]keydown.ctrl.u.prevent
      [@]keydown.meta.u.prevent
      [@]keydown.ctrl.b.prevent
      [@]keydown.meta.b.prevent
      >{{ title }}</span
    >
```

Since this attribute allows `data-` attributes while pasting the HTML contents, malicious clipboard contents can insert arbitrary `data-` attributes including `data-method` or `data-url`.

Since [ActionView](https://guides.rubyonrails.org/action_view_overview.html) uses `data-` attribute to control the behavior of HTML elements, and this feature has an XSS, malicious HTML contents with a `data-method` attribute can execute arbitrary JavaScript on GitLab.

[`actionview/app/javascript/rails-ujs/features/method.js` line 9-16](https://github.com/rails/rails/blob/3d1f38fa3066b1e93c7d11d0a2d61885252706b4/actionview/app/javascript/rails-ujs/features/method.js#L9-L16)

```
  const method = link.getAttribute("data-method")
  if (!method) { return }

  const href = rails.href(link)
  const csrfToken = csrf.csrfToken()
  const csrfParam = csrf.csrfParam()
  const form = document.createElement("form")
  let formContent = `<input name='_method' value='${method}' type='hidden' />`
```

```
e.clipboardData.setData('text/html', `<a href="#" data-method="'><img src onerror=alert(document.domain)>">Click me</a>`);
```

##### Steps to reproduce

1. Set up your own GitLab instance.
2. Log in to the GitLab instance.
3. Create a project.
4. Append `/-/work_items/new` to the end of the project path. (e.g. `https://{GITLAB_INSTANCE}/{USERNAME}/{PROJECT_NAME}/-/work_items/new`)
5. Download [![clipboard.html](data:image/gif;base64...)](https://user-content.gitlab-static.net/a290671d8a85b98743c7466981824ab06a2a066a/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39323138353465302d303430662d346335392d623962332d3634313264663165313839632f636c6970626f6172642e68746d6c)
6. Open [![clipboard.html](data:image/gif;base64...)](https://user-content.gitlab-static.net/a290671d8a85b98743c7466981824ab06a2a066a/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39323138353465302d303430662d346335392d623962332d3634313264663165313839632f636c6970626f6172642e68746d6c) in the browser
7. Click `Copy`
8. Paste it to the title field of the page that you opened in step 4.
9. Click `Click me`
10. Confirm that `alert(document.domain)` is executed.

[2022-11-09\_22-42-50.mp4](https://user-content.gitlab-static.net/77eb2e3351b998d1e1ead96aa65b420b4d5694ef/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f33386639313939352d366236382d343239392d393963382d3562363265636538653266662f323032322d31312d30395f32322d34322d35302e6d7034 "Download '2022-11-09_22-42-50.mp4'")

##### What is the current *bug* behavior?

A malicious clipboard content is able to inject an HTML element with an XSS payload.

##### What is the expected *correct* behavior?

GitLab shouldn't allow the injection of a malicious HTML element.

###### Results of GitLab environment info

```
System information
System:         Ubuntu 20.04
Proxy:          no
Current User:   git
Using RVM:      no
Ruby Version:   2.7.5p203
Gem Version:    3.1.6
Bundler Version:2.3.15
Rake Version:   13.0.6
Redis Version:  6.2.7
Sidekiq Version:6.4.2
Go Version:     unknown

GitLab information
Version:        15.5.3-ee
Revision:       48f51d8b0c3
Directory:      /opt/gitlab/embedded/service/gitlab-rails
DB Adapter:     PostgreSQL
DB Version:     13.6
URL:            https://gl.ryotak.me
HTTP Clone URL: https://gl.ryotak.me/some-group/some-project.git
SSH Clone URL:  git@gl.ryotak.me:some-group/some-project.git
Elasticsearch:  no
Geo:            no
Using LDAP:     no
Using Omniauth: yes
Omniauth Providers:

GitLab Shell
Version:        14.12.0
Repository storage paths:
- default:      /var/opt/gitlab/git-data/repositories
GitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell
```

#### Impact

An attacker can execute arbitrary JavaScript on the victim's browser and do any actions on behalf of the user.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [2022-11-09\_22-42-50.mp4](https://h1.sec.gitlab.net/a/38f91995-6b68-4299-99c8-5b62ece8e2ff/2022-11-09_22-42-50.mp4)
* [clipboard.html](https://h1.sec.gitlab.net/a/921854e0-040f-4c59-b9b3-6412df1e189c/clipboard.html)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_5bcf4fd1_20250114_202927.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-4007.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-4007.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-4007.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-4007.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Mar 04, 2023

  [74b7615b](/gitlab-org/cves/-/commit/74b7615bc2d5e5d3c064ec91dce1a29021071385)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/74b7615bc2d5e5d3c064ec91dce1a29021071385)
  繚
  74b7615b

  [ GitLab Bot ](/gitlab-bot) authored Mar 04, 2023

  74b7615b

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/74b7615bc2d5e5d3c064ec91dce1a29021071385)
  [ GitLab Bot ](/gitlab-bot) authored Mar 04, 2023

Loading


