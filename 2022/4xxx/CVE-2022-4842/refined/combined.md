=== Content from lore.kernel.org_6124b9e1_20250114_175748.html ===

```
[ntfs3.lists.linux.dev archive mirror](../../?t=20230122134627)
 [help](../../_/text/help/) / [color](../../_/text/color/) / [mirror](../../_/text/mirror/) / [Atom feed](../../new.atom)
```
```
[*](#e6083639b82f61879c2f022edb129cbc49e6a5805) [PATCH] ntfs3: Fix attr_punch_hole() null pointer derenference
@ 2022-08-15 11:07 Alon Zahavi
  2022-09-30 15:44 ` [Konstantin Komarov](#m315884ed8251f5692c13c3fe9aa4a8ba55db79b7)
                   ` [(2 more replies)](#r315884ed8251f5692c13c3fe9aa4a8ba55db79b7)
  [0 siblings, 3 replies; 5+ messages in thread](#r6083639b82f61879c2f022edb129cbc49e6a5805)
From: Alon Zahavi @ 2022-08-15 11:07 UTC ([permalink](../../20220815110712.36982-1-zahavi.alon%40gmail.com/) / [raw](../../20220815110712.36982-1-zahavi.alon%40gmail.com/raw))
  To: almaz.alexandrovich, [ntfs3](../../../ntfs3/?t=20220815110729), [linux-kernel](../../../lkml/?t=20220815110729); +Cc: Alon Zahavi, Tal Lossos

From: Alon Zahavi <zahavi.alon@gmail.com>

The bug occours due to a misuse of `attr` variable instead of `attr_b`.
`attr` is being initialized as NULL, then being derenfernced
as `attr->res.data_size`.

This bug causes a crash of the ntfs3 driver itself,
If compiled directly to the kernel, it crashes the whole system.

Signed-off-by: Alon Zahavi <zahavi.alon@gmail.com>
Co-developed-by: Tal Lossos <tallossos@gmail.com>
Signed-off-by: Tal Lossos <tallossos@gmail.com>
---
 [fs/ntfs3/attrib.c](#Z2e.:..:20220815110712.36982-1-zahavi.alon::40gmail.com:1fs:ntfs3:attrib.c) | 2 +-
 1 file [changed](#e6083639b82f61879c2f022edb129cbc49e6a5805), 1 insertion(+), 1 deletion(-)

[diff](#iZ2e.:..:20220815110712.36982-1-zahavi.alon::40gmail.com:1fs:ntfs3:attrib.c) --git a/fs/ntfs3/attrib.c b/fs/ntfs3/attrib.c
index e8c00dda42ad..4e74bc8f01ed 100644
--- a/fs/ntfs3/attrib.c
+++ b/fs/ntfs3/attrib.c
@@ -1949,7 +1949,7 @@ int attr_punch_hole(struct ntfs_inode *ni, u64 vbo, u64 bytes, u32 *frame_size)
 		return -ENOENT;

 	if (!attr_b->non_res) {
-		u32 data_size = le32_to_cpu(attr->res.data_size);
+		u32 data_size = le32_to_cpu(attr_b->res.data_size);
 		u32 from, to;

 		if (vbo > data_size)
--
2.25.1

[^](#m6083639b82f61879c2f022edb129cbc49e6a5805) [permalink](../../20220815110712.36982-1-zahavi.alon%40gmail.com/) [raw](../../20220815110712.36982-1-zahavi.alon%40gmail.com/raw) [reply](../../20220815110712.36982-1-zahavi.alon%40gmail.com/#R) [related](../../20220815110712.36982-1-zahavi.alon%40gmail.com/#related)	[[flat](../../20220815110712.36982-1-zahavi.alon%40gmail.com/T/#u)|[nested](../../20220815110712.36982-1-zahavi.alon%40gmail.com/t/#u)] [5+ messages in thread](#r6083639b82f61879c2f022edb129cbc49e6a5805)
```

---

```
[*](#e315884ed8251f5692c13c3fe9aa4a8ba55db79b7) Re: [PATCH] ntfs3: Fix attr_punch_hole() null pointer derenference
  2022-08-15 11:07 [[PATCH] ntfs3: Fix attr_punch_hole() null pointer derenference](#m6083639b82f61879c2f022edb129cbc49e6a5805) Alon Zahavi
@ 2022-09-30 15:44 ` Konstantin Komarov
  2023-01-17 20:21 ` [SeongJae Park](#me2324a967514564949f7ebcf3f9a5965f66921bf)
  2023-01-17 20:27 ` [SeongJae Park](#m50b2fa90aba8a8b661a6436c927c31f80c0f7c32)
  [2 siblings, 0 replies; 5+ messages in thread](#r315884ed8251f5692c13c3fe9aa4a8ba55db79b7)
From: Konstantin Komarov @ 2022-09-30 15:44 UTC ([permalink](../../784f82c4-de71-b8c3-afd6-468869a369af%40paragon-software.com/) / [raw](../../784f82c4-de71-b8c3-afd6-468869a369af%40paragon-software.com/raw))
  To: Alon Zahavi, [ntfs3](../../../ntfs3/?t=20220930154432), [linux-kernel](../../../lkml/?t=20220930154432); +Cc: Tal Lossos

On 8/15/22 14:07, Alon Zahavi wrote:
> From: Alon Zahavi <zahavi.alon@gmail.com>
>
> The bug occours due to a misuse of `attr` variable instead of `attr_b`.
> `attr` is being initialized as NULL, then being derenfernced
> as `attr->res.data_size`.
>
> This bug causes a crash of the ntfs3 driver itself,
> If compiled directly to the kernel, it crashes the whole system.
>
> Signed-off-by: Alon Zahavi <zahavi.alon@gmail.com>
> Co-developed-by: Tal Lossos <tallossos@gmail.com>
> Signed-off-by: Tal Lossos <tallossos@gmail.com>
> ---
>   fs/ntfs3/attrib.c | 2 +-
>   1 file changed, 1 insertion(+), 1 deletion(-)
>
> diff --git a/fs/ntfs3/attrib.c b/fs/ntfs3/attrib.c
> index e8c00dda42ad..4e74bc8f01ed 100644
> --- a/fs/ntfs3/attrib.c
> +++ b/fs/ntfs3/attrib.c
> @@ -1949,7 +1949,7 @@ int attr_punch_hole(struct ntfs_inode *ni, u64 vbo, u64 bytes, u32 *frame_size)
>   		return -ENOENT;
>
>   	if (!attr_b->non_res) {
> -		u32 data_size = le32_to_cpu(attr->res.data_size);
> +		u32 data_size = le32_to_cpu(attr_b->res.data_size);
>   		u32 from, to;
>
>   		if (vbo > data_size)

Applied, thanks!

[^](#m315884ed8251f5692c13c3fe9aa4a8ba55db79b7) [permalink](../../784f82c4-de71-b8c3-afd6-468869a369af%40paragon-software.com/) [raw](../../784f82c4-de71-b8c3-afd6-468869a369af%40paragon-software.com/raw) [reply](../../784f82c4-de71-b8c3-afd6-468869a369af%40paragon-software.com/#R)	[[flat](../../784f82c4-de71-b8c3-afd6-468869a369af%40paragon-software.com/T/#u)|[nested](../../784f82c4-de71-b8c3-afd6-468869a369af%40paragon-software.com/t/#u)] [5+ messages in thread](#r315884ed8251f5692c13c3fe9aa4a8ba55db79b7)
```

---

```
[*](#ee2324a967514564949f7ebcf3f9a5965f66921bf) Re: [PATCH] ntfs3: Fix attr_punch_hole() null pointer derenference
  2022-08-15 11:07 [[PATCH] ntfs3: Fix attr_punch_hole() null pointer derenference](#m6083639b82f61879c2f022edb129cbc49e6a5805) Alon Zahavi
  2022-09-30 15:44 ` [Konstantin Komarov](#m315884ed8251f5692c13c3fe9aa4a8ba55db79b7)
@ 2023-01-17 20:21 ` SeongJae Park
  2023-01-22 13:46   ` [Greg KH](#m34806e887d59c0a6005897334439c5eefa628f62)
  2023-01-17 20:27 ` [SeongJae Park](#m50b2fa90aba8a8b661a6436c927c31f80c0f7c32)
  [2 siblings, 1 reply; 5+ messages in thread](#re2324a967514564949f7ebcf3f9a5965f66921bf)
From: SeongJae Park @ 2023-01-17 20:21 UTC ([permalink](../../20230117202136.116810-1-sj%40kernel.org/) / [raw](../../20230117202136.116810-1-sj%40kernel.org/raw))
  Cc: Alon Zahavi, almaz.alexandrovich, [ntfs3](../../../ntfs3/?t=20230117202139), [linux-kernel](../../../lkml/?t=20230117202139), Tal Lossos,
	[stable](../../../stable/?t=20230117202139), gregkh

Hello,

On Mon, 15 Aug 2022 14:07:12 +0300 Alon Zahavi <zahavi.alon@gmail.com> wrote:

> From: Alon Zahavi <zahavi.alon@gmail.com>
>
> The bug occours due to a misuse of `attr` variable instead of `attr_b`.
> `attr` is being initialized as NULL, then being derenfernced
> as `attr->res.data_size`.
>
> This bug causes a crash of the ntfs3 driver itself,
> If compiled directly to the kernel, it crashes the whole system.
>
> Signed-off-by: Alon Zahavi <zahavi.alon@gmail.com>
> Co-developed-by: Tal Lossos <tallossos@gmail.com>
> Signed-off-by: Tal Lossos <tallossos@gmail.com>

This patch has now merged in mainline as
6d5c9e79b726cc473d40e9cb60976dbe8e669624.  stable@, could you please merge this
in stable kernels?

Fixes: be71b5cba2e64 ("fs/ntfs3: Add attrib operations") # 5.14

Thanks,
SJ

> ---
>  fs/ntfs3/attrib.c | 2 +-
>  1 file changed, 1 insertion(+), 1 deletion(-)
>
> diff --git a/fs/ntfs3/attrib.c b/fs/ntfs3/attrib.c
> index e8c00dda42ad..4e74bc8f01ed 100644
> --- a/fs/ntfs3/attrib.c
> +++ b/fs/ntfs3/attrib.c
> @@ -1949,7 +1949,7 @@ int attr_punch_hole(struct ntfs_inode *ni, u64 vbo, u64 bytes, u32 *frame_size)
>  		return -ENOENT;
>
>  	if (!attr_b->non_res) {
> -		u32 data_size = le32_to_cpu(attr->res.data_size);
> +		u32 data_size = le32_to_cpu(attr_b->res.data_size);
>  		u32 from, to;
>
>  		if (vbo > data_size)
> --
> 2.25.1
>
>

[^](#me2324a967514564949f7ebcf3f9a5965f66921bf) [permalink](../../20230117202136.116810-1-sj%40kernel.org/) [raw](../../20230117202136.116810-1-sj%40kernel.org/raw) [reply](../../20230117202136.116810-1-sj%40kernel.org/#R)	[[flat](../../20230117202136.116810-1-sj%40kernel.org/T/#u)|[nested](../../20230117202136.116810-1-sj%40kernel.org/t/#u)] [5+ messages in thread](#re2324a967514564949f7ebcf3f9a5965f66921bf)
```

---

```
[*](#e50b2fa90aba8a8b661a6436c927c31f80c0f7c32) Re: [PATCH] ntfs3: Fix attr_punch_hole() null pointer derenference
  2022-08-15 11:07 [[PATCH] ntfs3: Fix attr_punch_hole() null pointer derenference](#m6083639b82f61879c2f022edb129cbc49e6a5805) Alon Zahavi
  2022-09-30 15:44 ` [Konstantin Komarov](#m315884ed8251f5692c13c3fe9aa4a8ba55db79b7)
  2023-01-17 20:21 ` [SeongJae Park](#me2324a967514564949f7ebcf3f9a5965f66921bf)
@ 2023-01-17 20:27 ` SeongJae Park
  [2 siblings, 0 replies; 5+ messages in thread](#r50b2fa90aba8a8b661a6436c927c31f80c0f7c32)
From: SeongJae Park @ 2023-01-17 20:27 UTC ([permalink](../../20230117202703.116897-1-sj%40kernel.org/) / [raw](../../20230117202703.116897-1-sj%40kernel.org/raw))
  Cc: Alon Zahavi, almaz.alexandrovich, [ntfs3](../../../ntfs3/?t=20230117202707), [linux-kernel](../../../lkml/?t=20230117202707), Tal Lossos,
	[stable](../../../stable/?t=20230117202707), gregkh

Hello,

On Mon, 15 Aug 2022 14:07:12 +0300 Alon Zahavi <zahavi.alon@gmail.com> wrote:

> From: Alon Zahavi <zahavi.alon@gmail.com>
>
> The bug occours due to a misuse of `attr` variable instead of `attr_b`.
> `attr` is being initialized as NULL, then being derenfernced
> as `attr->res.data_size`.
>
> This bug causes a crash of the ntfs3 driver itself,
> If compiled directly to the kernel, it crashes the whole system.
>
> Signed-off-by: Alon Zahavi <zahavi.alon@gmail.com>
> Co-developed-by: Tal Lossos <tallossos@gmail.com>
> Signed-off-by: Tal Lossos <tallossos@gmail.com>

This patch has now merged in mainline as
6d5c9e79b726cc473d40e9cb60976dbe8e669624.  stable@, could you please merge this
in stable kernels?

Fixes: be71b5cba2e64 ("fs/ntfs3: Add attrib operations") # 5.14

Thanks,
SJ

> ---
>  fs/ntfs3/attrib.c | 2 +-
>  1 file changed, 1 insertion(+), 1 deletion(-)
>
> diff --git a/fs/ntfs3/attrib.c b/fs/ntfs3/attrib.c
> index e8c00dda42ad..4e74bc8f01ed 100644
> --- a/fs/ntfs3/attrib.c
> +++ b/fs/ntfs3/attrib.c
> @@ -1949,7 +1949,7 @@ int attr_punch_hole(struct ntfs_inode *ni, u64 vbo, u64 bytes, u32 *frame_size)
>               return -ENOENT;
>
>       if (!attr_b->non_res) {
> -             u32 data_size = le32_to_cpu(attr->res.data_size);
> +             u32 data_size = le32_to_cpu(attr_b->res.data_size);
>               u32 from, to;
>
>               if (vbo > data_size)
> --
> 2.25.1
>
>

[^](#m50b2fa90aba8a8b661a6436c927c31f80c0f7c32) [permalink](../../20230117202703.116897-1-sj%40kernel.org/) [raw](../../20230117202703.116897-1-sj%40kernel.org/raw) [reply](../../20230117202703.116897-1-sj%40kernel.org/#R)	[[flat](../../20230117202703.116897-1-sj%40kernel.org/T/#u)|[nested](../../20230117202703.116897-1-sj%40kernel.org/t/#u)] [5+ messages in thread](#r50b2fa90aba8a8b661a6436c927c31f80c0f7c32)
```

---

```
[*](#e34806e887d59c0a6005897334439c5eefa628f62) Re: [PATCH] ntfs3: Fix attr_punch_hole() null pointer derenference
  2023-01-17 20:21 ` [SeongJae Park](#me2324a967514564949f7ebcf3f9a5965f66921bf)
@ 2023-01-22 13:46   ` Greg KH
  [0 siblings, 0 replies; 5+ messages in thread](#r34806e887d59c0a6005897334439c5eefa628f62)
From: Greg KH @ 2023-01-22 13:46 UTC ([permalink](../../Y80%2BMZLA2sXyYf2J%40kroah.com/) / [raw](../../Y80%2BMZLA2sXyYf2J%40kroah.com/raw))
  To: SeongJae Park
  Cc: Alon Zahavi, almaz.alexandrovich, [ntfs3](../../../ntfs3/?t=20230122134627), [linux-kernel](../../../lkml/?t=20230122134627), Tal Lossos,
	[stable](../../../stable/?t=20230122134627)

On Tue, Jan 17, 2023 at 08:21:36PM +0000, SeongJae Park wrote:
> Hello,
>
> On Mon, 15 Aug 2022 14:07:12 +0300 Alon Zahavi <zahavi.alon@gmail.com> wrote:
>
> > From: Alon Zahavi <zahavi.alon@gmail.com>
> >
> > The bug occours due to a misuse of `attr` variable instead of `attr_b`.
> > `attr` is being initialized as NULL, then being derenfernced
> > as `attr->res.data_size`.
> >
> > This bug causes a crash of the ntfs3 driver itself,
> > If compiled directly to the kernel, it crashes the whole system.
> >
> > Signed-off-by: Alon Zahavi <zahavi.alon@gmail.com>
> > Co-developed-by: Tal Lossos <tallossos@gmail.com>
> > Signed-off-by: Tal Lossos <tallossos@gmail.com>
>
> This patch has now merged in mainline as
> 6d5c9e79b726cc473d40e9cb60976dbe8e669624.  stable@, could you please merge this
> in stable kernels?
>
> Fixes: be71b5cba2e64 ("fs/ntfs3: Add attrib operations") # 5.14
>

Now queued up, thanks.

greg k-h

[^](#m34806e887d59c0a6005897334439c5eefa628f62) [permalink](../../Y80%2BMZLA2sXyYf2J%40kroah.com/) [raw](../../Y80%2BMZLA2sXyYf2J%40kroah.com/raw) [reply](../../Y80%2BMZLA2sXyYf2J%40kroah.com/#R)	[[flat](../../Y80%2BMZLA2sXyYf2J%40kroah.com/T/#u)|[nested](../../Y80%2BMZLA2sXyYf2J%40kroah.com/t/#u)] [5+ messages in thread](#r34806e887d59c0a6005897334439c5eefa628f62)
```

---

```
end of thread, other threads:[[~2023-01-22 13:46 UTC](../../?t=20230122134627) | [newest](../../)]

Thread overview: 5+ messages (download: [mbox.gz](../t.mbox.gz) follow: [Atom feed](../t.atom)
-- links below jump to the message on this page --
2022-08-15 11:07 [[PATCH] ntfs3: Fix attr_punch_hole() null pointer derenference](#m6083639b82f61879c2f022edb129cbc49e6a5805) Alon Zahavi
2022-09-30 15:44 ` [Konstantin Komarov](#m315884ed8251f5692c13c3fe9aa4a8ba55db79b7)
2023-01-17 20:21 ` [SeongJae Park](#me2324a967514564949f7ebcf3f9a5965f66921bf)
2023-01-22 13:46   ` [Greg KH](#m34806e887d59c0a6005897334439c5eefa628f62)
2023-01-17 20:27 ` [SeongJae Park](#m50b2fa90aba8a8b661a6436c927c31f80c0f7c32)

```

---

```
This is a public inbox, see [mirroring instructions](../../_/text/mirror/)
for how to clone and mirror all data and code used for this inbox;
as well as URLs for NNTP newsgroup(s).
```

