=== Content from lore.kernel.org_80ce6969_20250114_183732.html ===

```
[All of lore.kernel.org](../../?t=20221205123808)
 [help](../../_/text/help/) / [color](../../_/text/color/) / [mirror](../../_/text/mirror/) / [Atom feed](../../new.atom)
```
```
[*](#e9be2a252f921a41a901d9b76e8e55fd06c28324d) [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
@ 2022-11-14 19:16 Jakub Sitnicki
  2022-11-15 11:12 ` [Tom Parkin](#m1fd8804b691a2a536317a00d3540360859078879)
                   ` [(2 more replies)](#r1fd8804b691a2a536317a00d3540360859078879)
  [0 siblings, 3 replies; 15+ messages in thread](#r9be2a252f921a41a901d9b76e8e55fd06c28324d)
From: Jakub Sitnicki @ 2022-11-14 19:16 UTC ([permalink](../../20221114191619.124659-1-jakub%40cloudflare.com/) / [raw](../../20221114191619.124659-1-jakub%40cloudflare.com/raw))
  To: [netdev](../../../netdev/?t=20221114191635)
  Cc: David S. Miller, Eric Dumazet, Jakub Kicinski, Paolo Abeni,
	Tom Parkin, Haowei Yan

sk->sk_user_data has multiple users, which are not compatible with each
other. Writers must synchronize by grabbing the sk->sk_callback_lock.

l2tp currently fails to grab the lock when modifying the underlying tunnel
socket fields. Fix it by adding appropriate locking.

We err on the side of safety and grab the sk_callback_lock also inside the
sk_destruct callback overridden by l2tp, even though there should be no
refs allowing access to the sock at the time when sk_destruct gets called.

v4:
- serialize write to sk_user_data in l2tp sk_destruct

v3:
- switch from sock lock to sk_callback_lock
- document write-protection for sk_user_data

v2:
- update Fixes to point to origin of the bug
- use real names in Reported/Tested-by tags

Cc: Tom Parkin <tparkin@katalix.com>
Fixes: 3557baabf280 ("[L2TP]: PPP over L2TP driver core")
Reported-by: Haowei Yan <g1042620637@gmail.com>
Signed-off-by: Jakub Sitnicki <jakub@cloudflare.com>
---

This took me forever. Sorry about that.

 [include/net/sock.h](#Z2e.:..:20221114191619.124659-1-jakub::40cloudflare.com:1include:net:sock.h)   |  2 +-
 [net/l2tp/l2tp_core.c](#Z2e.:..:20221114191619.124659-1-jakub::40cloudflare.com:1net:l2tp:l2tp_core.c) | 19 +++++++++++++------
 2 files [changed](#e9be2a252f921a41a901d9b76e8e55fd06c28324d), 14 insertions(+), 7 deletions(-)

[diff](#iZ2e.:..:20221114191619.124659-1-jakub::40cloudflare.com:1include:net:sock.h) --git a/include/net/sock.h b/include/net/sock.h
index 5db02546941c..e0517ecc6531 100644
--- a/include/net/sock.h
+++ b/include/net/sock.h
@@ -323,7 +323,7 @@ struct sk_filter;
   *	@sk_tskey: counter to disambiguate concurrent tstamp requests
   *	@sk_zckey: counter to order MSG_ZEROCOPY notifications
   *	@sk_socket: Identd and reporting IO signals
-  *	@sk_user_data: RPC layer private data
+  *	@sk_user_data: RPC layer private data. Write-protected by @sk_callback_lock.
   *	@sk_frag: cached page frag
   *	@sk_peek_off: current peek_offset value
   *	@sk_send_head: front of stuff to transmit
[diff](#iZ2e.:..:20221114191619.124659-1-jakub::40cloudflare.com:1net:l2tp:l2tp_core.c) --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
index 7499c51b1850..754fdda8a5f5 100644
--- a/net/l2tp/l2tp_core.c
+++ b/net/l2tp/l2tp_core.c
@@ -1150,8 +1150,10 @@ static void l2tp_tunnel_destruct(struct sock *sk)
 	}

 	/* Remove hooks into tunnel socket */
+	write_lock_bh(&sk->sk_callback_lock);
 	sk->sk_destruct = tunnel->old_sk_destruct;
 	sk->sk_user_data = NULL;
+	write_unlock_bh(&sk->sk_callback_lock);

 	/* Call the original destructor */
 	if (sk->sk_destruct)
@@ -1469,16 +1471,18 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
 		sock = sockfd_lookup(tunnel->fd, &ret);
 		if (!sock)
 			goto err;
-
-		ret = l2tp_validate_socket(sock->sk, net, tunnel->encap);
-		if (ret < 0)
-			goto err_sock;
 	}

+	sk = sock->sk;
+	write_lock(&sk->sk_callback_lock);
+
+	ret = l2tp_validate_socket(sk, net, tunnel->encap);
+	if (ret < 0)
+		goto err_sock;
+
 	tunnel->l2tp_net = net;
 	pn = l2tp_pernet(net);

-	sk = sock->sk;
 	sock_hold(sk);
 	tunnel->sock = sk;

@@ -1504,7 +1508,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,

 		setup_udp_tunnel_sock(net, sock, &udp_cfg);
 	} else {
-		sk->sk_user_data = tunnel;
+		rcu_assign_sk_user_data(sk, tunnel);
 	}

 	tunnel->old_sk_destruct = sk->sk_destruct;
@@ -1518,6 +1522,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
 	if (tunnel->fd >= 0)
 		sockfd_put(sock);

+	write_unlock(&sk->sk_callback_lock);
 	return 0;

 err_sock:
@@ -1525,6 +1530,8 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
 		sock_release(sock);
 	else
 		sockfd_put(sock);
+
+	write_unlock(&sk->sk_callback_lock);
 err:
 	return ret;
 }
--
2.38.1

[^](#m9be2a252f921a41a901d9b76e8e55fd06c28324d) [permalink](../../20221114191619.124659-1-jakub%40cloudflare.com/) [raw](../../20221114191619.124659-1-jakub%40cloudflare.com/raw) [reply](../../20221114191619.124659-1-jakub%40cloudflare.com/#R) [related](../../20221114191619.124659-1-jakub%40cloudflare.com/#related)	[[flat](../../20221114191619.124659-1-jakub%40cloudflare.com/T/#u)|[nested](../../20221114191619.124659-1-jakub%40cloudflare.com/t/#u)] [15+ messages in thread](#r9be2a252f921a41a901d9b76e8e55fd06c28324d)
```

* ```
  [*](#e1fd8804b691a2a536317a00d3540360859078879) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
    2022-11-14 19:16 [[PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock](#m9be2a252f921a41a901d9b76e8e55fd06c28324d) Jakub Sitnicki
  @ 2022-11-15 11:12 ` Tom Parkin
    2022-11-16 13:30 ` [patchwork-bot+netdevbpf](#m19e6c66abc9612a58d0cb07e95d70f62adef03a2)
    2022-12-02  9:50 ` [Hangbin Liu](#ma7c97cb9224a274d5e20a0c30ab5958fd1af04c3)
    [2 siblings, 0 replies; 15+ messages in thread](#r1fd8804b691a2a536317a00d3540360859078879)
  From: Tom Parkin @ 2022-11-15 11:12 UTC ([permalink](../../20221115111258.GA5373%40katalix.com/) / [raw](../../20221115111258.GA5373%40katalix.com/raw))
    To: Jakub Sitnicki
    Cc: [netdev](../../../netdev/?t=20221115112250), David S. Miller, Eric Dumazet, Jakub Kicinski,
  	Paolo Abeni, Haowei Yan

  [[-- Attachment #1: Type: text/plain, Size: 3971 bytes --]](../../20221115111258.GA5373%40katalix.com/1-a.txt)

  On  Mon, Nov 14, 2022 at 20:16:19 +0100, Jakub Sitnicki wrote:
  > sk->sk_user_data has multiple users, which are not compatible with each
  > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
  >
  > l2tp currently fails to grab the lock when modifying the underlying tunnel
  > socket fields. Fix it by adding appropriate locking.
  >
  > We err on the side of safety and grab the sk_callback_lock also inside the
  > sk_destruct callback overridden by l2tp, even though there should be no
  > refs allowing access to the sock at the time when sk_destruct gets called.
  >
  > v4:
  > - serialize write to sk_user_data in l2tp sk_destruct
  >
  > v3:
  > - switch from sock lock to sk_callback_lock
  > - document write-protection for sk_user_data
  >
  > v2:
  > - update Fixes to point to origin of the bug
  > - use real names in Reported/Tested-by tags

  LGTM, thanks Jakub.

  >
  > Cc: Tom Parkin <tparkin@katalix.com>
  > Fixes: 3557baabf280 ("[L2TP]: PPP over L2TP driver core")
  > Reported-by: Haowei Yan <g1042620637@gmail.com>
  > Signed-off-by: Jakub Sitnicki <jakub@cloudflare.com>
  > ---
  >
  > This took me forever. Sorry about that.
  >
  >  include/net/sock.h   |  2 +-
  >  net/l2tp/l2tp_core.c | 19 +++++++++++++------
  >  2 files changed, 14 insertions(+), 7 deletions(-)
  >
  > diff --git a/include/net/sock.h b/include/net/sock.h
  > index 5db02546941c..e0517ecc6531 100644
  > --- a/include/net/sock.h
  > +++ b/include/net/sock.h
  > @@ -323,7 +323,7 @@ struct sk_filter;
  >    *	@sk_tskey: counter to disambiguate concurrent tstamp requests
  >    *	@sk_zckey: counter to order MSG_ZEROCOPY notifications
  >    *	@sk_socket: Identd and reporting IO signals
  > -  *	@sk_user_data: RPC layer private data
  > +  *	@sk_user_data: RPC layer private data. Write-protected by @sk_callback_lock.
  >    *	@sk_frag: cached page frag
  >    *	@sk_peek_off: current peek_offset value
  >    *	@sk_send_head: front of stuff to transmit
  > diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
  > index 7499c51b1850..754fdda8a5f5 100644
  > --- a/net/l2tp/l2tp_core.c
  > +++ b/net/l2tp/l2tp_core.c
  > @@ -1150,8 +1150,10 @@ static void l2tp_tunnel_destruct(struct sock *sk)
  >  	}
  >
  >  	/* Remove hooks into tunnel socket */
  > +	write_lock_bh(&sk->sk_callback_lock);
  >  	sk->sk_destruct = tunnel->old_sk_destruct;
  >  	sk->sk_user_data = NULL;
  > +	write_unlock_bh(&sk->sk_callback_lock);
  >
  >  	/* Call the original destructor */
  >  	if (sk->sk_destruct)
  > @@ -1469,16 +1471,18 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
  >  		sock = sockfd_lookup(tunnel->fd, &ret);
  >  		if (!sock)
  >  			goto err;
  > -
  > -		ret = l2tp_validate_socket(sock->sk, net, tunnel->encap);
  > -		if (ret < 0)
  > -			goto err_sock;
  >  	}
  >
  > +	sk = sock->sk;
  > +	write_lock(&sk->sk_callback_lock);
  > +
  > +	ret = l2tp_validate_socket(sk, net, tunnel->encap);
  > +	if (ret < 0)
  > +		goto err_sock;
  > +
  >  	tunnel->l2tp_net = net;
  >  	pn = l2tp_pernet(net);
  >
  > -	sk = sock->sk;
  >  	sock_hold(sk);
  >  	tunnel->sock = sk;
  >
  > @@ -1504,7 +1508,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
  >
  >  		setup_udp_tunnel_sock(net, sock, &udp_cfg);
  >  	} else {
  > -		sk->sk_user_data = tunnel;
  > +		rcu_assign_sk_user_data(sk, tunnel);
  >  	}
  >
  >  	tunnel->old_sk_destruct = sk->sk_destruct;
  > @@ -1518,6 +1522,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
  >  	if (tunnel->fd >= 0)
  >  		sockfd_put(sock);
  >
  > +	write_unlock(&sk->sk_callback_lock);
  >  	return 0;
  >
  >  err_sock:
  > @@ -1525,6 +1530,8 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
  >  		sock_release(sock);
  >  	else
  >  		sockfd_put(sock);
  > +
  > +	write_unlock(&sk->sk_callback_lock);
  >  err:
  >  	return ret;
  >  }
  > --
  > 2.38.1
  >

  --
  Tom Parkin
  Katalix Systems Ltd
  <https://katalix.com>
  Catalysts for your Embedded Linux software development

  [[-- Attachment #2: signature.asc --]
  [-- Type: application/pgp-signature, Size: 488 bytes --]](../../20221115111258.GA5373%40katalix.com/2-signature.asc)

  [^](#m1fd8804b691a2a536317a00d3540360859078879) [permalink](../../20221115111258.GA5373%40katalix.com/) [raw](../../20221115111258.GA5373%40katalix.com/raw) [reply](../../20221115111258.GA5373%40katalix.com/#R)	[[flat](../../20221115111258.GA5373%40katalix.com/T/#u)|[nested](../../20221115111258.GA5373%40katalix.com/t/#u)] [15+ messages in thread](#r1fd8804b691a2a536317a00d3540360859078879)
  ```
* ```
  [*](#e19e6c66abc9612a58d0cb07e95d70f62adef03a2) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
    2022-11-14 19:16 [[PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock](#m9be2a252f921a41a901d9b76e8e55fd06c28324d) Jakub Sitnicki
    2022-11-15 11:12 ` [Tom Parkin](#m1fd8804b691a2a536317a00d3540360859078879)
  @ 2022-11-16 13:30 ` patchwork-bot+netdevbpf
    2022-11-17  9:07   ` [Eric Dumazet](#m636e1847827c4ae4cf9886afccc0bf19b444f116)
    2022-12-02  9:50 ` [Hangbin Liu](#ma7c97cb9224a274d5e20a0c30ab5958fd1af04c3)
    [2 siblings, 1 reply; 15+ messages in thread](#r19e6c66abc9612a58d0cb07e95d70f62adef03a2)
  From: patchwork-bot+netdevbpf @ 2022-11-16 13:30 UTC ([permalink](../../166860541774.25745.4396978792984957790.git-patchwork-notify%40kernel.org/) / [raw](../../166860541774.25745.4396978792984957790.git-patchwork-notify%40kernel.org/raw))
    To: Jakub Sitnicki
    Cc: [netdev](../../../netdev/?t=20221116133022), davem, edumazet, kuba, pabeni, tparkin, g1042620637

  Hello:

  This patch was applied to netdev/net.git (master)
  by David S. Miller <davem@davemloft.net>:

  On Mon, 14 Nov 2022 20:16:19 +0100 you wrote:
  > sk->sk_user_data has multiple users, which are not compatible with each
  > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
  >
  > l2tp currently fails to grab the lock when modifying the underlying tunnel
  > socket fields. Fix it by adding appropriate locking.
  >
  > We err on the side of safety and grab the sk_callback_lock also inside the
  > sk_destruct callback overridden by l2tp, even though there should be no
  > refs allowing access to the sock at the time when sk_destruct gets called.
  >
  > [...]

  Here is the summary with links:
    - [net,v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
      <https://git.kernel.org/netdev/net/c/b68777d54fac>

  You are awesome, thank you!
  --
  Deet-doot-dot, I am a bot.
  <https://korg.docs.kernel.org/patchwork/pwbot.html>

  [^](#m19e6c66abc9612a58d0cb07e95d70f62adef03a2) [permalink](../../166860541774.25745.4396978792984957790.git-patchwork-notify%40kernel.org/) [raw](../../166860541774.25745.4396978792984957790.git-patchwork-notify%40kernel.org/raw) [reply](../../166860541774.25745.4396978792984957790.git-patchwork-notify%40kernel.org/#R)	[[flat](../../166860541774.25745.4396978792984957790.git-patchwork-notify%40kernel.org/T/#u)|[nested](../../166860541774.25745.4396978792984957790.git-patchwork-notify%40kernel.org/t/#u)] [15+ messages in thread](#r19e6c66abc9612a58d0cb07e95d70f62adef03a2)
  ```
* + ```
    [*](#e636e1847827c4ae4cf9886afccc0bf19b444f116) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
      2022-11-16 13:30 ` [patchwork-bot+netdevbpf](#m19e6c66abc9612a58d0cb07e95d70f62adef03a2)
    @ 2022-11-17  9:07   ` Eric Dumazet
      2022-11-17  9:35     ` [Jakub Sitnicki](#madcb4ab0ee52c98cca178a8006dd8ec7a7ba93b4)
      2022-11-17  9:40     ` [Eric Dumazet](#mddc241e5777f4cb420edeea6d0b1ef080b947e64)
      [0 siblings, 2 replies; 15+ messages in thread](#r636e1847827c4ae4cf9886afccc0bf19b444f116)
    From: Eric Dumazet @ 2022-11-17  9:07 UTC ([permalink](../../CANn89iLQUZnyGNCn2GpW31FXpE_Lt7a5Urr21RqzfAE4sYxs%2Bw%40mail.gmail.com/) / [raw](../../CANn89iLQUZnyGNCn2GpW31FXpE_Lt7a5Urr21RqzfAE4sYxs%2Bw%40mail.gmail.com/raw))
      To: patchwork-bot+netdevbpf
      Cc: Jakub Sitnicki, [netdev](../../../netdev/?t=20221117090806), davem, kuba, pabeni, tparkin, g1042620637

    On Wed, Nov 16, 2022 at 5:30 AM <patchwork-bot+netdevbpf@kernel.org> wrote:
    >
    > Hello:
    >
    > This patch was applied to netdev/net.git (master)
    > by David S. Miller <davem@davemloft.net>:
    >
    > On Mon, 14 Nov 2022 20:16:19 +0100 you wrote:
    > > sk->sk_user_data has multiple users, which are not compatible with each
    > > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
    > >
    > > l2tp currently fails to grab the lock when modifying the underlying tunnel
    > > socket fields. Fix it by adding appropriate locking.
    > >
    > > We err on the side of safety and grab the sk_callback_lock also inside the
    > > sk_destruct callback overridden by l2tp, even though there should be no
    > > refs allowing access to the sock at the time when sk_destruct gets called.
    > >
    > > [...]
    >
    > Here is the summary with links:
    >   - [net,v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
    >     <https://git.kernel.org/netdev/net/c/b68777d54fac>
    >
    >

    I guess this patch has not been tested with LOCKDEP, right ?

    sk_callback_lock always needs _bh safety.

    I will send something like:

    diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
    index 754fdda8a5f52e4e8e2c0f47331c3b22765033d0..a3b06a3cf68248f5ec7ae8be2a9711d0f482ac36
    100644
    --- a/net/l2tp/l2tp_core.c
    +++ b/net/l2tp/l2tp_core.c
    @@ -1474,7 +1474,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
    *tunnel, struct net *net,
            }

            sk = sock->sk;
    -       write_lock(&sk->sk_callback_lock);
    +       write_lock_bh(&sk->sk_callback_lock);

            ret = l2tp_validate_socket(sk, net, tunnel->encap);
            if (ret < 0)
    @@ -1522,7 +1522,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
    *tunnel, struct net *net,
            if (tunnel->fd >= 0)
                    sockfd_put(sock);

    -       write_unlock(&sk->sk_callback_lock);
    +       write_unlock_bh(&sk->sk_callback_lock);
            return 0;

     err_sock:
    @@ -1531,7 +1531,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
    *tunnel, struct net *net,
            else
                    sockfd_put(sock);

    -       write_unlock(&sk->sk_callback_lock);
    +       write_unlock_bh(&sk->sk_callback_lock);
     err:
            return ret;
     }

    [^](#m636e1847827c4ae4cf9886afccc0bf19b444f116) [permalink](../../CANn89iLQUZnyGNCn2GpW31FXpE_Lt7a5Urr21RqzfAE4sYxs%2Bw%40mail.gmail.com/) [raw](../../CANn89iLQUZnyGNCn2GpW31FXpE_Lt7a5Urr21RqzfAE4sYxs%2Bw%40mail.gmail.com/raw) [reply](../../CANn89iLQUZnyGNCn2GpW31FXpE_Lt7a5Urr21RqzfAE4sYxs%2Bw%40mail.gmail.com/#R)	[[flat](../../CANn89iLQUZnyGNCn2GpW31FXpE_Lt7a5Urr21RqzfAE4sYxs%2Bw%40mail.gmail.com/T/#u)|[nested](../../CANn89iLQUZnyGNCn2GpW31FXpE_Lt7a5Urr21RqzfAE4sYxs%2Bw%40mail.gmail.com/t/#u)] [15+ messages in thread](#r636e1847827c4ae4cf9886afccc0bf19b444f116)
    ```
  + - ```
      [*](#eadcb4ab0ee52c98cca178a8006dd8ec7a7ba93b4) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
        2022-11-17  9:07   ` [Eric Dumazet](#m636e1847827c4ae4cf9886afccc0bf19b444f116)
      @ 2022-11-17  9:35     ` Jakub Sitnicki
        2022-11-17  9:54       ` [Eric Dumazet](#m329dca66fb90d633845951b4317af051ad430c6a)
        2022-11-17  9:40     ` [Eric Dumazet](#mddc241e5777f4cb420edeea6d0b1ef080b947e64)
        [1 sibling, 1 reply; 15+ messages in thread](#radcb4ab0ee52c98cca178a8006dd8ec7a7ba93b4)
      From: Jakub Sitnicki @ 2022-11-17  9:35 UTC ([permalink](../../871qq13oex.fsf%40cloudflare.com/) / [raw](../../871qq13oex.fsf%40cloudflare.com/raw))
        To: Eric Dumazet
        Cc: patchwork-bot+netdevbpf, [netdev](../../../netdev/?t=20221117094553), davem, kuba, pabeni, tparkin,
      	g1042620637

      On Thu, Nov 17, 2022 at 01:07 AM -08, Eric Dumazet wrote:
      > On Wed, Nov 16, 2022 at 5:30 AM <patchwork-bot+netdevbpf@kernel.org> wrote:
      >>
      >> Hello:
      >>
      >> This patch was applied to netdev/net.git (master)
      >> by David S. Miller <davem@davemloft.net>:
      >>
      >> On Mon, 14 Nov 2022 20:16:19 +0100 you wrote:
      >> > sk->sk_user_data has multiple users, which are not compatible with each
      >> > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
      >> >
      >> > l2tp currently fails to grab the lock when modifying the underlying tunnel
      >> > socket fields. Fix it by adding appropriate locking.
      >> >
      >> > We err on the side of safety and grab the sk_callback_lock also inside the
      >> > sk_destruct callback overridden by l2tp, even though there should be no
      >> > refs allowing access to the sock at the time when sk_destruct gets called.
      >> >
      >> > [...]
      >>
      >> Here is the summary with links:
      >>   - [net,v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
      >>     <https://git.kernel.org/netdev/net/c/b68777d54fac>
      >>
      >>
      >
      > I guess this patch has not been tested with LOCKDEP, right ?
      >
      > sk_callback_lock always needs _bh safety.
      >
      > I will send something like:
      >
      > diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
      > index 754fdda8a5f52e4e8e2c0f47331c3b22765033d0..a3b06a3cf68248f5ec7ae8be2a9711d0f482ac36
      > 100644
      > --- a/net/l2tp/l2tp_core.c
      > +++ b/net/l2tp/l2tp_core.c
      > @@ -1474,7 +1474,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
      > *tunnel, struct net *net,
      >         }
      >
      >         sk = sock->sk;
      > -       write_lock(&sk->sk_callback_lock);
      > +       write_lock_bh(&sk->sk_callback_lock);
      >
      >         ret = l2tp_validate_socket(sk, net, tunnel->encap);
      >         if (ret < 0)
      > @@ -1522,7 +1522,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
      > *tunnel, struct net *net,
      >         if (tunnel->fd >= 0)
      >                 sockfd_put(sock);
      >
      > -       write_unlock(&sk->sk_callback_lock);
      > +       write_unlock_bh(&sk->sk_callback_lock);
      >         return 0;
      >
      >  err_sock:
      > @@ -1531,7 +1531,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
      > *tunnel, struct net *net,
      >         else
      >                 sockfd_put(sock);
      >
      > -       write_unlock(&sk->sk_callback_lock);
      > +       write_unlock_bh(&sk->sk_callback_lock);
      >  err:
      >         return ret;
      >  }

      Hmm, weird. I double checked - I have PROVE_LOCKING enabled.
      Didn't see any lockdep reports when running selftests/net/l2tp.sh.

      I my defense - I thought _bh was not needed because
      l2tp_tunnel_register() gets called only in the process context. I mean,
      it's triggered by Netlink sendmsg, but that gets processed in-line
      AFAIU:

      netlink_sendmsg
        netlink_unicast
          ->netlink_rcv
            genl_rcv
              genl_rcv_msg
                genl_family_rcv_msg
                  genl_family_rcv_msg_doit
                    ->doit
                      l2tp_nl_cmd_tunnel_create
                        l2tp_tunnel_register

      [^](#madcb4ab0ee52c98cca178a8006dd8ec7a7ba93b4) [permalink](../../871qq13oex.fsf%40cloudflare.com/) [raw](../../871qq13oex.fsf%40cloudflare.com/raw) [reply](../../871qq13oex.fsf%40cloudflare.com/#R)	[[flat](../../871qq13oex.fsf%40cloudflare.com/T/#u)|[nested](../../871qq13oex.fsf%40cloudflare.com/t/#u)] [15+ messages in thread](#radcb4ab0ee52c98cca178a8006dd8ec7a7ba93b4)
      ```
    - * ```
        [*](#e329dca66fb90d633845951b4317af051ad430c6a) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
          2022-11-17  9:35     ` [Jakub Sitnicki](#madcb4ab0ee52c98cca178a8006dd8ec7a7ba93b4)
        @ 2022-11-17  9:54       ` Eric Dumazet
          [0 siblings, 0 replies; 15+ messages in thread](#r329dca66fb90d633845951b4317af051ad430c6a)
        From: Eric Dumazet @ 2022-11-17  9:54 UTC ([permalink](../../CANn89iLD25rKsK9YoNexwh%2BfX4KOZcEjP_JC5w3DSn8y-UvFSg%40mail.gmail.com/) / [raw](../../CANn89iLD25rKsK9YoNexwh%2BfX4KOZcEjP_JC5w3DSn8y-UvFSg%40mail.gmail.com/raw))
          To: Jakub Sitnicki
          Cc: patchwork-bot+netdevbpf, [netdev](../../../netdev/?t=20221117095557), davem, kuba, pabeni, tparkin,
        	g1042620637

        On Thu, Nov 17, 2022 at 1:45 AM Jakub Sitnicki <jakub@cloudflare.com> wrote:
        >
        > On Thu, Nov 17, 2022 at 01:07 AM -08, Eric Dumazet wrote:
        > > On Wed, Nov 16, 2022 at 5:30 AM <patchwork-bot+netdevbpf@kernel.org> wrote:
        > >>
        > >> Hello:
        > >>
        > >> This patch was applied to netdev/net.git (master)
        > >> by David S. Miller <davem@davemloft.net>:
        > >>
        > >> On Mon, 14 Nov 2022 20:16:19 +0100 you wrote:
        > >> > sk->sk_user_data has multiple users, which are not compatible with each
        > >> > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
        > >> >
        > >> > l2tp currently fails to grab the lock when modifying the underlying tunnel
        > >> > socket fields. Fix it by adding appropriate locking.
        > >> >
        > >> > We err on the side of safety and grab the sk_callback_lock also inside the
        > >> > sk_destruct callback overridden by l2tp, even though there should be no
        > >> > refs allowing access to the sock at the time when sk_destruct gets called.
        > >> >
        > >> > [...]
        > >>
        > >> Here is the summary with links:
        > >>   - [net,v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
        > >>     <https://git.kernel.org/netdev/net/c/b68777d54fac>
        > >>
        > >>
        > >
        > > I guess this patch has not been tested with LOCKDEP, right ?
        > >
        > > sk_callback_lock always needs _bh safety.
        > >
        > > I will send something like:
        > >
        > > diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
        > > index 754fdda8a5f52e4e8e2c0f47331c3b22765033d0..a3b06a3cf68248f5ec7ae8be2a9711d0f482ac36
        > > 100644
        > > --- a/net/l2tp/l2tp_core.c
        > > +++ b/net/l2tp/l2tp_core.c
        > > @@ -1474,7 +1474,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
        > > *tunnel, struct net *net,
        > >         }
        > >
        > >         sk = sock->sk;
        > > -       write_lock(&sk->sk_callback_lock);
        > > +       write_lock_bh(&sk->sk_callback_lock);
        > >
        > >         ret = l2tp_validate_socket(sk, net, tunnel->encap);
        > >         if (ret < 0)
        > > @@ -1522,7 +1522,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
        > > *tunnel, struct net *net,
        > >         if (tunnel->fd >= 0)
        > >                 sockfd_put(sock);
        > >
        > > -       write_unlock(&sk->sk_callback_lock);
        > > +       write_unlock_bh(&sk->sk_callback_lock);
        > >         return 0;
        > >
        > >  err_sock:
        > > @@ -1531,7 +1531,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
        > > *tunnel, struct net *net,
        > >         else
        > >                 sockfd_put(sock);
        > >
        > > -       write_unlock(&sk->sk_callback_lock);
        > > +       write_unlock_bh(&sk->sk_callback_lock);
        > >  err:
        > >         return ret;
        > >  }
        >
        > Hmm, weird. I double checked - I have PROVE_LOCKING enabled.
        > Didn't see any lockdep reports when running selftests/net/l2tp.sh.
        >
        > I my defense - I thought _bh was not needed because
        > l2tp_tunnel_register() gets called only in the process context. I mean,
        > it's triggered by Netlink sendmsg, but that gets processed in-line
        > AFAIU:
        >
        > netlink_sendmsg
        >   netlink_unicast
        >     ->netlink_rcv
        >       genl_rcv
        >         genl_rcv_msg
        >           genl_family_rcv_msg
        >             genl_family_rcv_msg_doit
        >               ->doit
        >                 l2tp_nl_cmd_tunnel_create
        >                   l2tp_tunnel_register

        Three different syzbot reports will help to better understand the
        issue, sorry it is 2am for me, I am not sure in which time zone you
        are in ...

        [^](#m329dca66fb90d633845951b4317af051ad430c6a) [permalink](../../CANn89iLD25rKsK9YoNexwh%2BfX4KOZcEjP_JC5w3DSn8y-UvFSg%40mail.gmail.com/) [raw](../../CANn89iLD25rKsK9YoNexwh%2BfX4KOZcEjP_JC5w3DSn8y-UvFSg%40mail.gmail.com/raw) [reply](../../CANn89iLD25rKsK9YoNexwh%2BfX4KOZcEjP_JC5w3DSn8y-UvFSg%40mail.gmail.com/#R)	[[flat](../../CANn89iLD25rKsK9YoNexwh%2BfX4KOZcEjP_JC5w3DSn8y-UvFSg%40mail.gmail.com/T/#u)|[nested](../../CANn89iLD25rKsK9YoNexwh%2BfX4KOZcEjP_JC5w3DSn8y-UvFSg%40mail.gmail.com/t/#u)] [15+ messages in thread](#r329dca66fb90d633845951b4317af051ad430c6a)
        ```
    - ```
      [*](#eddc241e5777f4cb420edeea6d0b1ef080b947e64) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
        2022-11-17  9:07   ` [Eric Dumazet](#m636e1847827c4ae4cf9886afccc0bf19b444f116)
        2022-11-17  9:35     ` [Jakub Sitnicki](#madcb4ab0ee52c98cca178a8006dd8ec7a7ba93b4)
      @ 2022-11-17  9:40     ` Eric Dumazet
        2022-11-17  9:55       ` [Jakub Sitnicki](#mb284faaab141eaa9e4fc04212d56fdd24470811b)
        [1 sibling, 1 reply; 15+ messages in thread](#rddc241e5777f4cb420edeea6d0b1ef080b947e64)
      From: Eric Dumazet @ 2022-11-17  9:40 UTC ([permalink](../../CANn89i%2B8r6rvBZeVG7u01vJ4rYO5cqe%2BjfSFvYDvdUHyzb5HaQ%40mail.gmail.com/) / [raw](../../CANn89i%2B8r6rvBZeVG7u01vJ4rYO5cqe%2BjfSFvYDvdUHyzb5HaQ%40mail.gmail.com/raw))
        To: patchwork-bot+netdevbpf
        Cc: Jakub Sitnicki, [netdev](../../../netdev/?t=20221117094025), davem, kuba, pabeni, tparkin, g1042620637

      On Thu, Nov 17, 2022 at 1:07 AM Eric Dumazet <edumazet@google.com> wrote:
      >
      > On Wed, Nov 16, 2022 at 5:30 AM <patchwork-bot+netdevbpf@kernel.org> wrote:
      > >
      > > Hello:
      > >
      > > This patch was applied to netdev/net.git (master)
      > > by David S. Miller <davem@davemloft.net>:
      > >
      > > On Mon, 14 Nov 2022 20:16:19 +0100 you wrote:
      > > > sk->sk_user_data has multiple users, which are not compatible with each
      > > > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
      > > >
      > > > l2tp currently fails to grab the lock when modifying the underlying tunnel
      > > > socket fields. Fix it by adding appropriate locking.
      > > >
      > > > We err on the side of safety and grab the sk_callback_lock also inside the
      > > > sk_destruct callback overridden by l2tp, even though there should be no
      > > > refs allowing access to the sock at the time when sk_destruct gets called.
      > > >
      > > > [...]
      > >
      > > Here is the summary with links:
      > >   - [net,v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
      > >     <https://git.kernel.org/netdev/net/c/b68777d54fac>
      > >
      > >
      >
      > I guess this patch has not been tested with LOCKDEP, right ?
      >
      > sk_callback_lock always needs _bh safety.
      >
      > I will send something like:
      >
      > diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
      > index 754fdda8a5f52e4e8e2c0f47331c3b22765033d0..a3b06a3cf68248f5ec7ae8be2a9711d0f482ac36
      > 100644
      > --- a/net/l2tp/l2tp_core.c
      > +++ b/net/l2tp/l2tp_core.c
      > @@ -1474,7 +1474,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
      > *tunnel, struct net *net,
      >         }
      >
      >         sk = sock->sk;
      > -       write_lock(&sk->sk_callback_lock);
      > +       write_lock_bh(&sk->sk_callback_lock);

      Unfortunately this might still not work, because
      setup_udp_tunnel_sock->udp_encap_enable() probably could sleep in
      static_branch_inc() ?

      I will release the syzbot report, and let you folks work on a fix, thanks.

      [^](#mddc241e5777f4cb420edeea6d0b1ef080b947e64) [permalink](../../CANn89i%2B8r6rvBZeVG7u01vJ4rYO5cqe%2BjfSFvYDvdUHyzb5HaQ%40mail.gmail.com/) [raw](../../CANn89i%2B8r6rvBZeVG7u01vJ4rYO5cqe%2BjfSFvYDvdUHyzb5HaQ%40mail.gmail.com/raw) [reply](../../CANn89i%2B8r6rvBZeVG7u01vJ4rYO5cqe%2BjfSFvYDvdUHyzb5HaQ%40mail.gmail.com/#R)	[[flat](../../CANn89i%2B8r6rvBZeVG7u01vJ4rYO5cqe%2BjfSFvYDvdUHyzb5HaQ%40mail.gmail.com/T/#u)|[nested](../../CANn89i%2B8r6rvBZeVG7u01vJ4rYO5cqe%2BjfSFvYDvdUHyzb5HaQ%40mail.gmail.com/t/#u)] [15+ messages in thread](#rddc241e5777f4cb420edeea6d0b1ef080b947e64)
      ```
    - * ```
        [*](#eb284faaab141eaa9e4fc04212d56fdd24470811b) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
          2022-11-17  9:40     ` [Eric Dumazet](#mddc241e5777f4cb420edeea6d0b1ef080b947e64)
        @ 2022-11-17  9:55       ` Jakub Sitnicki
          2022-11-18 10:28         ` [Eric Dumazet](#mfb698051cc0282a689e6c17c04c65ae861e187a7)
          [0 siblings, 1 reply; 15+ messages in thread](#rb284faaab141eaa9e4fc04212d56fdd24470811b)
        From: Jakub Sitnicki @ 2022-11-17  9:55 UTC ([permalink](../../87wn7t29ac.fsf%40cloudflare.com/) / [raw](../../87wn7t29ac.fsf%40cloudflare.com/raw))
          To: Eric Dumazet
          Cc: patchwork-bot+netdevbpf, [netdev](../../../netdev/?t=20221117095846), davem, kuba, pabeni, tparkin,
        	g1042620637

        On Thu, Nov 17, 2022 at 01:40 AM -08, Eric Dumazet wrote:
        > On Thu, Nov 17, 2022 at 1:07 AM Eric Dumazet <edumazet@google.com> wrote:
        >>
        >> On Wed, Nov 16, 2022 at 5:30 AM <patchwork-bot+netdevbpf@kernel.org> wrote:
        >> >
        >> > Hello:
        >> >
        >> > This patch was applied to netdev/net.git (master)
        >> > by David S. Miller <davem@davemloft.net>:
        >> >
        >> > On Mon, 14 Nov 2022 20:16:19 +0100 you wrote:
        >> > > sk->sk_user_data has multiple users, which are not compatible with each
        >> > > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
        >> > >
        >> > > l2tp currently fails to grab the lock when modifying the underlying tunnel
        >> > > socket fields. Fix it by adding appropriate locking.
        >> > >
        >> > > We err on the side of safety and grab the sk_callback_lock also inside the
        >> > > sk_destruct callback overridden by l2tp, even though there should be no
        >> > > refs allowing access to the sock at the time when sk_destruct gets called.
        >> > >
        >> > > [...]
        >> >
        >> > Here is the summary with links:
        >> >   - [net,v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
        >> >     <https://git.kernel.org/netdev/net/c/b68777d54fac>
        >> >
        >> >
        >>
        >> I guess this patch has not been tested with LOCKDEP, right ?
        >>
        >> sk_callback_lock always needs _bh safety.
        >>
        >> I will send something like:
        >>
        >> diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
        >> index 754fdda8a5f52e4e8e2c0f47331c3b22765033d0..a3b06a3cf68248f5ec7ae8be2a9711d0f482ac36
        >> 100644
        >> --- a/net/l2tp/l2tp_core.c
        >> +++ b/net/l2tp/l2tp_core.c
        >> @@ -1474,7 +1474,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
        >> *tunnel, struct net *net,
        >>         }
        >>
        >>         sk = sock->sk;
        >> -       write_lock(&sk->sk_callback_lock);
        >> +       write_lock_bh(&sk->sk_callback_lock);
        >
        > Unfortunately this might still not work, because
        > setup_udp_tunnel_sock->udp_encap_enable() probably could sleep in
        > static_branch_inc() ?
        >
        > I will release the syzbot report, and let you folks work on a fix, thanks.

        Ah, the problem is with pppol2tp_connect racing with itself. Thanks for
        the syzbot report. I will take a look. I live for debugging deadlocks
        :-)

        [^](#mb284faaab141eaa9e4fc04212d56fdd24470811b) [permalink](../../87wn7t29ac.fsf%40cloudflare.com/) [raw](../../87wn7t29ac.fsf%40cloudflare.com/raw) [reply](../../87wn7t29ac.fsf%40cloudflare.com/#R)	[[flat](../../87wn7t29ac.fsf%40cloudflare.com/T/#u)|[nested](../../87wn7t29ac.fsf%40cloudflare.com/t/#u)] [15+ messages in thread](#rb284faaab141eaa9e4fc04212d56fdd24470811b)
        ```
      * + ```
          [*](#efb698051cc0282a689e6c17c04c65ae861e187a7) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
            2022-11-17  9:55       ` [Jakub Sitnicki](#mb284faaab141eaa9e4fc04212d56fdd24470811b)
          @ 2022-11-18 10:28         ` Eric Dumazet
            2022-11-18 10:57           ` [Jakub Sitnicki](#m339dc8a54e2bef977c4c00b585357a925c796b95)
            [0 siblings, 1 reply; 15+ messages in thread](#rfb698051cc0282a689e6c17c04c65ae861e187a7)
          From: Eric Dumazet @ 2022-11-18 10:28 UTC ([permalink](../../CANn89i%2BiRoHnJ%3D%2BMFB5N3c36t5AeeDpd7aHqheBdgKjhNH17qA%40mail.gmail.com/) / [raw](../../CANn89i%2BiRoHnJ%3D%2BMFB5N3c36t5AeeDpd7aHqheBdgKjhNH17qA%40mail.gmail.com/raw))
            To: Jakub Sitnicki
            Cc: patchwork-bot+netdevbpf, [netdev](../../../netdev/?t=20221118102818), davem, kuba, pabeni, tparkin,
          	g1042620637

          On Thu, Nov 17, 2022 at 1:57 AM Jakub Sitnicki <jakub@cloudflare.com> wrote:
          >
          > On Thu, Nov 17, 2022 at 01:40 AM -08, Eric Dumazet wrote:
          > > On Thu, Nov 17, 2022 at 1:07 AM Eric Dumazet <edumazet@google.com> wrote:
          > >>
          > >> On Wed, Nov 16, 2022 at 5:30 AM <patchwork-bot+netdevbpf@kernel.org> wrote:
          > >> >
          > >> > Hello:
          > >> >
          > >> > This patch was applied to netdev/net.git (master)
          > >> > by David S. Miller <davem@davemloft.net>:
          > >> >
          > >> > On Mon, 14 Nov 2022 20:16:19 +0100 you wrote:
          > >> > > sk->sk_user_data has multiple users, which are not compatible with each
          > >> > > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
          > >> > >
          > >> > > l2tp currently fails to grab the lock when modifying the underlying tunnel
          > >> > > socket fields. Fix it by adding appropriate locking.
          > >> > >
          > >> > > We err on the side of safety and grab the sk_callback_lock also inside the
          > >> > > sk_destruct callback overridden by l2tp, even though there should be no
          > >> > > refs allowing access to the sock at the time when sk_destruct gets called.
          > >> > >
          > >> > > [...]
          > >> >
          > >> > Here is the summary with links:
          > >> >   - [net,v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
          > >> >     <https://git.kernel.org/netdev/net/c/b68777d54fac>
          > >> >
          > >> >
          > >>
          > >> I guess this patch has not been tested with LOCKDEP, right ?
          > >>
          > >> sk_callback_lock always needs _bh safety.
          > >>
          > >> I will send something like:
          > >>
          > >> diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
          > >> index 754fdda8a5f52e4e8e2c0f47331c3b22765033d0..a3b06a3cf68248f5ec7ae8be2a9711d0f482ac36
          > >> 100644
          > >> --- a/net/l2tp/l2tp_core.c
          > >> +++ b/net/l2tp/l2tp_core.c
          > >> @@ -1474,7 +1474,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
          > >> *tunnel, struct net *net,
          > >>         }
          > >>
          > >>         sk = sock->sk;
          > >> -       write_lock(&sk->sk_callback_lock);
          > >> +       write_lock_bh(&sk->sk_callback_lock);
          > >
          > > Unfortunately this might still not work, because
          > > setup_udp_tunnel_sock->udp_encap_enable() probably could sleep in
          > > static_branch_inc() ?
          > >
          > > I will release the syzbot report, and let you folks work on a fix, thanks.
          >
          > Ah, the problem is with pppol2tp_connect racing with itself. Thanks for
          > the syzbot report. I will take a look. I live for debugging deadlocks
          > :-)

          Hi Jakub, any updates on this issue ? (Other syzbot reports with the
          same root cause are piling up)

          Thanks

          [^](#mfb698051cc0282a689e6c17c04c65ae861e187a7) [permalink](../../CANn89i%2BiRoHnJ%3D%2BMFB5N3c36t5AeeDpd7aHqheBdgKjhNH17qA%40mail.gmail.com/) [raw](../../CANn89i%2BiRoHnJ%3D%2BMFB5N3c36t5AeeDpd7aHqheBdgKjhNH17qA%40mail.gmail.com/raw) [reply](../../CANn89i%2BiRoHnJ%3D%2BMFB5N3c36t5AeeDpd7aHqheBdgKjhNH17qA%40mail.gmail.com/#R)	[[flat](../../CANn89i%2BiRoHnJ%3D%2BMFB5N3c36t5AeeDpd7aHqheBdgKjhNH17qA%40mail.gmail.com/T/#u)|[nested](../../CANn89i%2BiRoHnJ%3D%2BMFB5N3c36t5AeeDpd7aHqheBdgKjhNH17qA%40mail.gmail.com/t/#u)] [15+ messages in thread](#rfb698051cc0282a689e6c17c04c65ae861e187a7)
          ```
        + - ```
            [*](#e339dc8a54e2bef977c4c00b585357a925c796b95) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
              2022-11-18 10:28         ` [Eric Dumazet](#mfb698051cc0282a689e6c17c04c65ae861e187a7)
            @ 2022-11-18 10:57           ` Jakub Sitnicki
              2022-11-18 11:09             ` [Eric Dumazet](#m24eff0c5e474801d75f26807e68995ce9f682705)
              [0 siblings, 1 reply; 15+ messages in thread](#r339dc8a54e2bef977c4c00b585357a925c796b95)
            From: Jakub Sitnicki @ 2022-11-18 10:57 UTC ([permalink](../../877czsplx3.fsf%40cloudflare.com/) / [raw](../../877czsplx3.fsf%40cloudflare.com/raw))
              To: Eric Dumazet
              Cc: patchwork-bot+netdevbpf, [netdev](../../../netdev/?t=20221118110036), davem, kuba, pabeni, tparkin,
            	g1042620637

            On Fri, Nov 18, 2022 at 02:28 AM -08, Eric Dumazet wrote:
            > On Thu, Nov 17, 2022 at 1:57 AM Jakub Sitnicki <jakub@cloudflare.com> wrote:
            >>
            >> On Thu, Nov 17, 2022 at 01:40 AM -08, Eric Dumazet wrote:
            >> > On Thu, Nov 17, 2022 at 1:07 AM Eric Dumazet <edumazet@google.com> wrote:
            >> >>
            >> >> On Wed, Nov 16, 2022 at 5:30 AM <patchwork-bot+netdevbpf@kernel.org> wrote:
            >> >> >
            >> >> > Hello:
            >> >> >
            >> >> > This patch was applied to netdev/net.git (master)
            >> >> > by David S. Miller <davem@davemloft.net>:
            >> >> >
            >> >> > On Mon, 14 Nov 2022 20:16:19 +0100 you wrote:
            >> >> > > sk->sk_user_data has multiple users, which are not compatible with each
            >> >> > > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
            >> >> > >
            >> >> > > l2tp currently fails to grab the lock when modifying the underlying tunnel
            >> >> > > socket fields. Fix it by adding appropriate locking.
            >> >> > >
            >> >> > > We err on the side of safety and grab the sk_callback_lock also inside the
            >> >> > > sk_destruct callback overridden by l2tp, even though there should be no
            >> >> > > refs allowing access to the sock at the time when sk_destruct gets called.
            >> >> > >
            >> >> > > [...]
            >> >> >
            >> >> > Here is the summary with links:
            >> >> >   - [net,v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
            >> >> >     <https://git.kernel.org/netdev/net/c/b68777d54fac>
            >> >> >
            >> >> >
            >> >>
            >> >> I guess this patch has not been tested with LOCKDEP, right ?
            >> >>
            >> >> sk_callback_lock always needs _bh safety.
            >> >>
            >> >> I will send something like:
            >> >>
            >> >> diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
            >> >> index 754fdda8a5f52e4e8e2c0f47331c3b22765033d0..a3b06a3cf68248f5ec7ae8be2a9711d0f482ac36
            >> >> 100644
            >> >> --- a/net/l2tp/l2tp_core.c
            >> >> +++ b/net/l2tp/l2tp_core.c
            >> >> @@ -1474,7 +1474,7 @@ int l2tp_tunnel_register(struct l2tp_tunnel
            >> >> *tunnel, struct net *net,
            >> >>         }
            >> >>
            >> >>         sk = sock->sk;
            >> >> -       write_lock(&sk->sk_callback_lock);
            >> >> +       write_lock_bh(&sk->sk_callback_lock);
            >> >
            >> > Unfortunately this might still not work, because
            >> > setup_udp_tunnel_sock->udp_encap_enable() probably could sleep in
            >> > static_branch_inc() ?
            >> >
            >> > I will release the syzbot report, and let you folks work on a fix, thanks.
            >>
            >> Ah, the problem is with pppol2tp_connect racing with itself. Thanks for
            >> the syzbot report. I will take a look. I live for debugging deadlocks
            >> :-)
            >
            > Hi Jakub, any updates on this issue ? (Other syzbot reports with the
            > same root cause are piling up)
            >
            > Thanks

            Sorry, I don't have anything yet. I have reserved time to work on it
            this afternoon (I'm in the CET timezone).

            Alternatively, I can send a revert right away and come back with fixed
            patch once I have that, if you prefer.

            [^](#m339dc8a54e2bef977c4c00b585357a925c796b95) [permalink](../../877czsplx3.fsf%40cloudflare.com/) [raw](../../877czsplx3.fsf%40cloudflare.com/raw) [reply](../../877czsplx3.fsf%40cloudflare.com/#R)	[[flat](../../877czsplx3.fsf%40cloudflare.com/T/#u)|[nested](../../877czsplx3.fsf%40cloudflare.com/t/#u)] [15+ messages in thread](#r339dc8a54e2bef977c4c00b585357a925c796b95)
            ```
          - * ```
              [*](#e24eff0c5e474801d75f26807e68995ce9f682705) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
                2022-11-18 10:57           ` [Jakub Sitnicki](#m339dc8a54e2bef977c4c00b585357a925c796b95)
              @ 2022-11-18 11:09             ` Eric Dumazet
                2022-11-19 13:04               ` [Jakub Sitnicki](#mdf12e22339397bf692e12cf131eb234fadf47aae)
                [0 siblings, 1 reply; 15+ messages in thread](#r24eff0c5e474801d75f26807e68995ce9f682705)
              From: Eric Dumazet @ 2022-11-18 11:09 UTC ([permalink](../../CANn89iKZcq1Y81OH%3DqsVWbgpkW%3DgKC-jwRo4PC05PBcPpo55fQ%40mail.gmail.com/) / [raw](../../CANn89iKZcq1Y81OH%3DqsVWbgpkW%3DgKC-jwRo4PC05PBcPpo55fQ%40mail.gmail.com/raw))
                To: Jakub Sitnicki
                Cc: patchwork-bot+netdevbpf, [netdev](../../../netdev/?t=20221118110935), davem, kuba, pabeni, tparkin,
              	g1042620637

              On Fri, Nov 18, 2022 at 3:00 AM Jakub Sitnicki <jakub@cloudflare.com> wrote:

              >
              > Sorry, I don't have anything yet. I have reserved time to work on it
              > this afternoon (I'm in the CET timezone).
              >
              > Alternatively, I can send a revert right away and come back with fixed
              > patch once I have that, if you prefer.

              No worries, this can wait for a fix, thanks.

              [^](#m24eff0c5e474801d75f26807e68995ce9f682705) [permalink](../../CANn89iKZcq1Y81OH%3DqsVWbgpkW%3DgKC-jwRo4PC05PBcPpo55fQ%40mail.gmail.com/) [raw](../../CANn89iKZcq1Y81OH%3DqsVWbgpkW%3DgKC-jwRo4PC05PBcPpo55fQ%40mail.gmail.com/raw) [reply](../../CANn89iKZcq1Y81OH%3DqsVWbgpkW%3DgKC-jwRo4PC05PBcPpo55fQ%40mail.gmail.com/#R)	[[flat](../../CANn89iKZcq1Y81OH%3DqsVWbgpkW%3DgKC-jwRo4PC05PBcPpo55fQ%40mail.gmail.com/T/#u)|[nested](../../CANn89iKZcq1Y81OH%3DqsVWbgpkW%3DgKC-jwRo4PC05PBcPpo55fQ%40mail.gmail.com/t/#u)] [15+ messages in thread](#r24eff0c5e474801d75f26807e68995ce9f682705)
              ```
            * + ```
                [*](#edf12e22339397bf692e12cf131eb234fadf47aae) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
                  2022-11-18 11:09             ` [Eric Dumazet](#m24eff0c5e474801d75f26807e68995ce9f682705)
                @ 2022-11-19 13:04               ` Jakub Sitnicki
                  [0 siblings, 0 replies; 15+ messages in thread](#rdf12e22339397bf692e12cf131eb234fadf47aae)
                From: Jakub Sitnicki @ 2022-11-19 13:04 UTC ([permalink](../../87h6yvumbh.fsf%40cloudflare.com/) / [raw](../../87h6yvumbh.fsf%40cloudflare.com/raw))
                  To: Eric Dumazet
                  Cc: patchwork-bot+netdevbpf, [netdev](../../../netdev/?t=20221119130512), davem, kuba, pabeni, tparkin,
                	g1042620637

                On Fri, Nov 18, 2022 at 03:09 AM -08, Eric Dumazet wrote:
                > On Fri, Nov 18, 2022 at 3:00 AM Jakub Sitnicki <jakub@cloudflare.com> wrote:
                >
                >>
                >> Sorry, I don't have anything yet. I have reserved time to work on it
                >> this afternoon (I'm in the CET timezone).
                >>
                >> Alternatively, I can send a revert right away and come back with fixed
                >> patch once I have that, if you prefer.
                >
                > No worries, this can wait for a fix, thanks.

                Proposed fix now posted:

                [https://lore.kernel.org/netdev/20221119130317.39158-1-jakub@cloudflare.com/](https://lore.kernel.org/netdev/20221119130317.39158-1-jakub%40cloudflare.com/)

                [^](#mdf12e22339397bf692e12cf131eb234fadf47aae) [permalink](../../87h6yvumbh.fsf%40cloudflare.com/) [raw](../../87h6yvumbh.fsf%40cloudflare.com/raw) [reply](../../87h6yvumbh.fsf%40cloudflare.com/#R)	[[flat](../../87h6yvumbh.fsf%40cloudflare.com/T/#u)|[nested](../../87h6yvumbh.fsf%40cloudflare.com/t/#u)] [15+ messages in thread](#rdf12e22339397bf692e12cf131eb234fadf47aae)
                ```
* ```
  [*](#ea7c97cb9224a274d5e20a0c30ab5958fd1af04c3) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
    2022-11-14 19:16 [[PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock](#m9be2a252f921a41a901d9b76e8e55fd06c28324d) Jakub Sitnicki
    2022-11-15 11:12 ` [Tom Parkin](#m1fd8804b691a2a536317a00d3540360859078879)
    2022-11-16 13:30 ` [patchwork-bot+netdevbpf](#m19e6c66abc9612a58d0cb07e95d70f62adef03a2)
  @ 2022-12-02  9:50 ` Hangbin Liu
    2022-12-05 10:24   ` [Jakub Sitnicki](#m161c6f4810a248b36faa7ea6ad4e17bccee8b19d)
    [2 siblings, 1 reply; 15+ messages in thread](#ra7c97cb9224a274d5e20a0c30ab5958fd1af04c3)
  From: Hangbin Liu @ 2022-12-02  9:50 UTC ([permalink](../../Y4nKX8IXjHLSVHnz%40Laptop-X1/) / [raw](../../Y4nKX8IXjHLSVHnz%40Laptop-X1/raw))
    To: Jakub Sitnicki
    Cc: [netdev](../../../netdev/?t=20221202095032), David S. Miller, Eric Dumazet, Jakub Kicinski,
  	Paolo Abeni, Tom Parkin, Haowei Yan, Roopa Prabhu,
  	Nikolay Aleksandrov

  On Mon, Nov 14, 2022 at 08:16:19PM +0100, Jakub Sitnicki wrote:
  > sk->sk_user_data has multiple users, which are not compatible with each
  > other. Writers must synchronize by grabbing the sk->sk_callback_lock.
  >
  > l2tp currently fails to grab the lock when modifying the underlying tunnel
  > socket fields. Fix it by adding appropriate locking.
  >
  > We err on the side of safety and grab the sk_callback_lock also inside the
  > sk_destruct callback overridden by l2tp, even though there should be no
  > refs allowing access to the sock at the time when sk_destruct gets called.
  >
  > v4:
  > - serialize write to sk_user_data in l2tp sk_destruct
  >
  > v3:
  > - switch from sock lock to sk_callback_lock
  > - document write-protection for sk_user_data
  >
  > v2:
  > - update Fixes to point to origin of the bug
  > - use real names in Reported/Tested-by tags
  >
  > Cc: Tom Parkin <tparkin@katalix.com>
  > Fixes: 3557baabf280 ("[L2TP]: PPP over L2TP driver core")
  > Reported-by: Haowei Yan <g1042620637@gmail.com>
  > Signed-off-by: Jakub Sitnicki <jakub@cloudflare.com>
  > ---
  >
  > This took me forever. Sorry about that.
  >
  >  include/net/sock.h   |  2 +-
  >  net/l2tp/l2tp_core.c | 19 +++++++++++++------
  >  2 files changed, 14 insertions(+), 7 deletions(-)
  >
  > diff --git a/include/net/sock.h b/include/net/sock.h
  > index 5db02546941c..e0517ecc6531 100644
  > --- a/include/net/sock.h
  > +++ b/include/net/sock.h
  > @@ -323,7 +323,7 @@ struct sk_filter;
  >    *	@sk_tskey: counter to disambiguate concurrent tstamp requests
  >    *	@sk_zckey: counter to order MSG_ZEROCOPY notifications
  >    *	@sk_socket: Identd and reporting IO signals
  > -  *	@sk_user_data: RPC layer private data
  > +  *	@sk_user_data: RPC layer private data. Write-protected by @sk_callback_lock.
  >    *	@sk_frag: cached page frag
  >    *	@sk_peek_off: current peek_offset value
  >    *	@sk_send_head: front of stuff to transmit
  > diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
  > index 7499c51b1850..754fdda8a5f5 100644
  > --- a/net/l2tp/l2tp_core.c
  > +++ b/net/l2tp/l2tp_core.c
  > @@ -1150,8 +1150,10 @@ static void l2tp_tunnel_destruct(struct sock *sk)
  >  	}
  >
  >  	/* Remove hooks into tunnel socket */
  > +	write_lock_bh(&sk->sk_callback_lock);
  >  	sk->sk_destruct = tunnel->old_sk_destruct;
  >  	sk->sk_user_data = NULL;
  > +	write_unlock_bh(&sk->sk_callback_lock);
  >
  >  	/* Call the original destructor */
  >  	if (sk->sk_destruct)

  Hi Jakub,

  I have a similar issue with vxlan driver. Similar with commit
  ad6c9986bcb6 ("vxlan: Fix GRO cells race condition between receive and link
  delete"). There is still a race condition on vxlan that when receive a packet
  while deleting a VXLAN device. In vxlan_ecn_decapsulate(), the
  vxlan_get_sk_family() call panic as sk is NULL.

   #0 [ffffa25ec6978a38] machine_kexec at ffffffff8c669757
   #1 [ffffa25ec6978a90] __crash_kexec at ffffffff8c7c0a4d
   #2 [ffffa25ec6978b58] crash_kexec at ffffffff8c7c1c48
   #3 [ffffa25ec6978b60] oops_end at ffffffff8c627f2b
   #4 [ffffa25ec6978b80] page_fault_oops at ffffffff8c678fcb
   #5 [ffffa25ec6978bd8] exc_page_fault at ffffffff8d109542
   #6 [ffffa25ec6978c00] asm_exc_page_fault at ffffffff8d200b62
      [exception RIP: vxlan_ecn_decapsulate+0x3b]
      RIP: ffffffffc1014e7b  RSP: ffffa25ec6978cb0  RFLAGS: 00010246
      RAX: 0000000000000008  RBX: ffff8aa000888000  RCX: 0000000000000000
      RDX: 000000000000000e  RSI: ffff8a9fc7ab803e  RDI: ffff8a9fd1168700
      RBP: ffff8a9fc7ab803e   R8: 0000000000700000   R9: 00000000000010ae
      R10: ffff8a9fcb748980  R11: 0000000000000000  R12: ffff8a9fd1168700
      R13: ffff8aa000888000  R14: 00000000002a0000  R15: 00000000000010ae
      ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018
   #7 [ffffa25ec6978ce8] vxlan_rcv at ffffffffc10189cd [vxlan]
   #8 [ffffa25ec6978d90] udp_queue_rcv_one_skb at ffffffff8cfb6507
   #9 [ffffa25ec6978dc0] udp_unicast_rcv_skb at ffffffff8cfb6e45
  #10 [ffffa25ec6978dc8] __udp4_lib_rcv at ffffffff8cfb8807
  #11 [ffffa25ec6978e20] ip_protocol_deliver_rcu at ffffffff8cf76951
  #12 [ffffa25ec6978e48] ip_local_deliver at ffffffff8cf76bde
  #13 [ffffa25ec6978ea0] __netif_receive_skb_one_core at ffffffff8cecde9b
  #14 [ffffa25ec6978ec8] process_backlog at ffffffff8cece139
  #15 [ffffa25ec6978f00] __napi_poll at ffffffff8ceced1a
  #16 [ffffa25ec6978f28] net_rx_action at ffffffff8cecf1f3
  #17 [ffffa25ec6978fa0] __softirqentry_text_start at ffffffff8d4000ca
  #18 [ffffa25ec6978ff0] do_softirq at ffffffff8c6fbdc3
  --- <IRQ stack> ---

  > struct socket ffff8a9fd1168700
  struct socket {
    state = SS_FREE,
    type = 0,
    flags = 0,
    file = 0xffff8a9fcb748000,
    sk = 0x0,
    ops = 0x0,

  So I'm wondering if we should also have locks in udp_tunnel_sock_release().
  Or should we add a checking in sk state before calling vxlan_get_sk_family()?

  Thanks
  Hangbin

  [^](#ma7c97cb9224a274d5e20a0c30ab5958fd1af04c3) [permalink](../../Y4nKX8IXjHLSVHnz%40Laptop-X1/) [raw](../../Y4nKX8IXjHLSVHnz%40Laptop-X1/raw) [reply](../../Y4nKX8IXjHLSVHnz%40Laptop-X1/#R)	[[flat](../../Y4nKX8IXjHLSVHnz%40Laptop-X1/T/#u)|[nested](../../Y4nKX8IXjHLSVHnz%40Laptop-X1/t/#u)] [15+ messages in thread](#ra7c97cb9224a274d5e20a0c30ab5958fd1af04c3)
  ```
* + ```
    [*](#e161c6f4810a248b36faa7ea6ad4e17bccee8b19d) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
      2022-12-02  9:50 ` [Hangbin Liu](#ma7c97cb9224a274d5e20a0c30ab5958fd1af04c3)
    @ 2022-12-05 10:24   ` Jakub Sitnicki
      2022-12-05 12:37     ` [Hangbin Liu](#m65ed612e807fa766bc48d4ca58846fee7b390916)
      [0 siblings, 1 reply; 15+ messages in thread](#r161c6f4810a248b36faa7ea6ad4e17bccee8b19d)
    From: Jakub Sitnicki @ 2022-12-05 10:24 UTC ([permalink](../../87y1rmhyc2.fsf%40cloudflare.com/) / [raw](../../87y1rmhyc2.fsf%40cloudflare.com/raw))
      To: Hangbin Liu
      Cc: [netdev](../../../netdev/?t=20221205114259), David S. Miller, Eric Dumazet, Jakub Kicinski,
    	Paolo Abeni, Tom Parkin, Haowei Yan, Roopa Prabhu,
    	Nikolay Aleksandrov

    On Fri, Dec 02, 2022 at 05:50 PM +08, Hangbin Liu wrote:
    > On Mon, Nov 14, 2022 at 08:16:19PM +0100, Jakub Sitnicki wrote:
    >> sk->sk_user_data has multiple users, which are not compatible with each
    >> other. Writers must synchronize by grabbing the sk->sk_callback_lock.
    >>
    >> l2tp currently fails to grab the lock when modifying the underlying tunnel
    >> socket fields. Fix it by adding appropriate locking.
    >>
    >> We err on the side of safety and grab the sk_callback_lock also inside the
    >> sk_destruct callback overridden by l2tp, even though there should be no
    >> refs allowing access to the sock at the time when sk_destruct gets called.
    >>
    >> v4:
    >> - serialize write to sk_user_data in l2tp sk_destruct
    >>
    >> v3:
    >> - switch from sock lock to sk_callback_lock
    >> - document write-protection for sk_user_data
    >>
    >> v2:
    >> - update Fixes to point to origin of the bug
    >> - use real names in Reported/Tested-by tags
    >>
    >> Cc: Tom Parkin <tparkin@katalix.com>
    >> Fixes: 3557baabf280 ("[L2TP]: PPP over L2TP driver core")
    >> Reported-by: Haowei Yan <g1042620637@gmail.com>
    >> Signed-off-by: Jakub Sitnicki <jakub@cloudflare.com>
    >> ---
    >>
    >> This took me forever. Sorry about that.
    >>
    >>  include/net/sock.h   |  2 +-
    >>  net/l2tp/l2tp_core.c | 19 +++++++++++++------
    >>  2 files changed, 14 insertions(+), 7 deletions(-)
    >>
    >> diff --git a/include/net/sock.h b/include/net/sock.h
    >> index 5db02546941c..e0517ecc6531 100644
    >> --- a/include/net/sock.h
    >> +++ b/include/net/sock.h
    >> @@ -323,7 +323,7 @@ struct sk_filter;
    >>    *	@sk_tskey: counter to disambiguate concurrent tstamp requests
    >>    *	@sk_zckey: counter to order MSG_ZEROCOPY notifications
    >>    *	@sk_socket: Identd and reporting IO signals
    >> -  *	@sk_user_data: RPC layer private data
    >> +  *	@sk_user_data: RPC layer private data. Write-protected by @sk_callback_lock.
    >>    *	@sk_frag: cached page frag
    >>    *	@sk_peek_off: current peek_offset value
    >>    *	@sk_send_head: front of stuff to transmit
    >> diff --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
    >> index 7499c51b1850..754fdda8a5f5 100644
    >> --- a/net/l2tp/l2tp_core.c
    >> +++ b/net/l2tp/l2tp_core.c
    >> @@ -1150,8 +1150,10 @@ static void l2tp_tunnel_destruct(struct sock *sk)
    >>  	}
    >>
    >>  	/* Remove hooks into tunnel socket */
    >> +	write_lock_bh(&sk->sk_callback_lock);
    >>  	sk->sk_destruct = tunnel->old_sk_destruct;
    >>  	sk->sk_user_data = NULL;
    >> +	write_unlock_bh(&sk->sk_callback_lock);
    >>
    >>  	/* Call the original destructor */
    >>  	if (sk->sk_destruct)
    >
    > Hi Jakub,
    >
    > I have a similar issue with vxlan driver. Similar with commit
    > ad6c9986bcb6 ("vxlan: Fix GRO cells race condition between receive and link
    > delete"). There is still a race condition on vxlan that when receive a packet
    > while deleting a VXLAN device. In vxlan_ecn_decapsulate(), the
    > vxlan_get_sk_family() call panic as sk is NULL.
    >
    >  #0 [ffffa25ec6978a38] machine_kexec at ffffffff8c669757
    >  #1 [ffffa25ec6978a90] __crash_kexec at ffffffff8c7c0a4d
    >  #2 [ffffa25ec6978b58] crash_kexec at ffffffff8c7c1c48
    >  #3 [ffffa25ec6978b60] oops_end at ffffffff8c627f2b
    >  #4 [ffffa25ec6978b80] page_fault_oops at ffffffff8c678fcb
    >  #5 [ffffa25ec6978bd8] exc_page_fault at ffffffff8d109542
    >  #6 [ffffa25ec6978c00] asm_exc_page_fault at ffffffff8d200b62
    >     [exception RIP: vxlan_ecn_decapsulate+0x3b]
    >     RIP: ffffffffc1014e7b  RSP: ffffa25ec6978cb0  RFLAGS: 00010246
    >     RAX: 0000000000000008  RBX: ffff8aa000888000  RCX: 0000000000000000
    >     RDX: 000000000000000e  RSI: ffff8a9fc7ab803e  RDI: ffff8a9fd1168700
    >     RBP: ffff8a9fc7ab803e   R8: 0000000000700000   R9: 00000000000010ae
    >     R10: ffff8a9fcb748980  R11: 0000000000000000  R12: ffff8a9fd1168700
    >     R13: ffff8aa000888000  R14: 00000000002a0000  R15: 00000000000010ae
    >     ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018
    >  #7 [ffffa25ec6978ce8] vxlan_rcv at ffffffffc10189cd [vxlan]
    >  #8 [ffffa25ec6978d90] udp_queue_rcv_one_skb at ffffffff8cfb6507
    >  #9 [ffffa25ec6978dc0] udp_unicast_rcv_skb at ffffffff8cfb6e45
    > #10 [ffffa25ec6978dc8] __udp4_lib_rcv at ffffffff8cfb8807
    > #11 [ffffa25ec6978e20] ip_protocol_deliver_rcu at ffffffff8cf76951
    > #12 [ffffa25ec6978e48] ip_local_deliver at ffffffff8cf76bde
    > #13 [ffffa25ec6978ea0] __netif_receive_skb_one_core at ffffffff8cecde9b
    > #14 [ffffa25ec6978ec8] process_backlog at ffffffff8cece139
    > #15 [ffffa25ec6978f00] __napi_poll at ffffffff8ceced1a
    > #16 [ffffa25ec6978f28] net_rx_action at ffffffff8cecf1f3
    > #17 [ffffa25ec6978fa0] __softirqentry_text_start at ffffffff8d4000ca
    > #18 [ffffa25ec6978ff0] do_softirq at ffffffff8c6fbdc3
    > --- <IRQ stack> ---
    >
    >> struct socket ffff8a9fd1168700
    > struct socket {
    >   state = SS_FREE,
    >   type = 0,
    >   flags = 0,
    >   file = 0xffff8a9fcb748000,
    >   sk = 0x0,
    >   ops = 0x0,
    >
    > So I'm wondering if we should also have locks in udp_tunnel_sock_release().
    > Or should we add a checking in sk state before calling vxlan_get_sk_family()?

    This is how like to think about it:

    To know when it is safe to load vs->sock->sk->sk_family, we have to ask:

    1. What ensures that the objects remain alive/valid in our scope?
    2. What protects the objects from being mutated?

    In case of vxlan_sock object in the context of vxlan_ecn_decapsulate():

    1. We are in an RCU read side section (ip_local_deliver_finish).
    2. RCU-protected objects are not to be mutated while readers exist.

    The classic "What is RCU, Fundamentally?" article explains it much
    better than I ever could:

    <https://lwn.net/Articles/262464/>

    As to where the problem lies. I belive udp_tunnel_sock_release() is not
    keeping the (2) promise.

    After unpublishing the sk_user_data, we should wait for any existing
    readers accessing the vxlan_sock to finish with synchronize_rcu(),
    before releaseing the socket.

    That is:

    --- a/net/ipv4/udp_tunnel_core.c
    +++ b/net/ipv4/udp_tunnel_core.c
    @@ -176,6 +176,7 @@ EXPORT_SYMBOL_GPL(udp_tunnel_xmit_skb);
     void udp_tunnel_sock_release(struct socket *sock)
     {
            rcu_assign_sk_user_data(sock->sk, NULL);
    +       synchronize_rcu();
            kernel_sock_shutdown(sock, SHUT_RDWR);
            sock_release(sock);
     }

    Otherwise accessing vxlan_sock state doesn't look safe to me.

    [^](#m161c6f4810a248b36faa7ea6ad4e17bccee8b19d) [permalink](../../87y1rmhyc2.fsf%40cloudflare.com/) [raw](../../87y1rmhyc2.fsf%40cloudflare.com/raw) [reply](../../87y1rmhyc2.fsf%40cloudflare.com/#R)	[[flat](../../87y1rmhyc2.fsf%40cloudflare.com/T/#u)|[nested](../../87y1rmhyc2.fsf%40cloudflare.com/t/#u)] [15+ messages in thread](#r161c6f4810a248b36faa7ea6ad4e17bccee8b19d)
    ```
  + - ```
      [*](#e65ed612e807fa766bc48d4ca58846fee7b390916) Re: [PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock
        2022-12-05 10:24   ` [Jakub Sitnicki](#m161c6f4810a248b36faa7ea6ad4e17bccee8b19d)
      @ 2022-12-05 12:37     ` Hangbin Liu
        [0 siblings, 0 replies; 15+ messages in thread](#r65ed612e807fa766bc48d4ca58846fee7b390916)
      From: Hangbin Liu @ 2022-12-05 12:37 UTC ([permalink](../../Y43mJUHWE5%2B9t2Ak%40Laptop-X1/) / [raw](../../Y43mJUHWE5%2B9t2Ak%40Laptop-X1/raw))
        To: Jakub Sitnicki
        Cc: [netdev](../../../netdev/?t=20221205123808), David S. Miller, Eric Dumazet, Jakub Kicinski,
      	Paolo Abeni, Tom Parkin, Haowei Yan, Roopa Prabhu,
      	Nikolay Aleksandrov

      On Mon, Dec 05, 2022 at 11:24:39AM +0100, Jakub Sitnicki wrote:
      > > Hi Jakub,
      > >
      > > I have a similar issue with vxlan driver. Similar with commit
      > > ad6c9986bcb6 ("vxlan: Fix GRO cells race condition between receive and link
      > > delete"). There is still a race condition on vxlan that when receive a packet
      > > while deleting a VXLAN device. In vxlan_ecn_decapsulate(), the
      > > vxlan_get_sk_family() call panic as sk is NULL.
      > >
      > > So I'm wondering if we should also have locks in udp_tunnel_sock_release().
      > > Or should we add a checking in sk state before calling vxlan_get_sk_family()?
      >
      > This is how like to think about it:
      >
      > To know when it is safe to load vs->sock->sk->sk_family, we have to ask:
      >
      > 1. What ensures that the objects remain alive/valid in our scope?
      > 2. What protects the objects from being mutated?
      >
      > In case of vxlan_sock object in the context of vxlan_ecn_decapsulate():
      >
      > 1. We are in an RCU read side section (ip_local_deliver_finish).
      > 2. RCU-protected objects are not to be mutated while readers exist.
      >
      > The classic "What is RCU, Fundamentally?" article explains it much
      > better than I ever could:
      >
      > <https://lwn.net/Articles/262464/>
      >
      > As to where the problem lies. I belive udp_tunnel_sock_release() is not
      > keeping the (2) promise.
      >
      > After unpublishing the sk_user_data, we should wait for any existing
      > readers accessing the vxlan_sock to finish with synchronize_rcu(),
      > before releaseing the socket.
      >
      > That is:
      >
      > --- a/net/ipv4/udp_tunnel_core.c
      > +++ b/net/ipv4/udp_tunnel_core.c
      > @@ -176,6 +176,7 @@ EXPORT_SYMBOL_GPL(udp_tunnel_xmit_skb);
      >  void udp_tunnel_sock_release(struct socket *sock)
      >  {
      >         rcu_assign_sk_user_data(sock->sk, NULL);
      > +       synchronize_rcu();
      >         kernel_sock_shutdown(sock, SHUT_RDWR);
      >         sock_release(sock);
      >  }
      >
      >
      > Otherwise accessing vxlan_sock state doesn't look safe to me.

      Hi Jakub,

      Thanks for your explain. As it's a little on my side, I will read your
      comments and try your suggestion tomorrow. Currently, I use the following
      draft patch to fix the vxlan issue.

      diff --git a/drivers/net/vxlan/vxlan_core.c b/drivers/net/vxlan/vxlan_core.c
      index 2122747a0224..53259b0b07f3 100644
      --- a/drivers/net/vxlan/vxlan_core.c
      +++ b/drivers/net/vxlan/vxlan_core.c
      @@ -4234,6 +4234,7 @@ static void vxlan_dellink(struct net_device *dev, struct list_head *head)
              struct vxlan_dev *vxlan = netdev_priv(dev);

              vxlan_flush(vxlan, true);
      +       vxlan_sock_release(vxlan);

              list_del(&vxlan->next);
              unregister_netdevice_queue(dev, head);

      Cheers
      Hangbin

      [^](#m65ed612e807fa766bc48d4ca58846fee7b390916) [permalink](../../Y43mJUHWE5%2B9t2Ak%40Laptop-X1/) [raw](../../Y43mJUHWE5%2B9t2Ak%40Laptop-X1/raw) [reply](../../Y43mJUHWE5%2B9t2Ak%40Laptop-X1/#R) [related](../../Y43mJUHWE5%2B9t2Ak%40Laptop-X1/#related)	[[flat](../../Y43mJUHWE5%2B9t2Ak%40Laptop-X1/T/#u)|[nested](../../Y43mJUHWE5%2B9t2Ak%40Laptop-X1/t/#u)] [15+ messages in thread](#r65ed612e807fa766bc48d4ca58846fee7b390916)
      ```

---

```
end of thread, other threads:[[~2022-12-05 12:38 UTC](../../?t=20221205123808) | [newest](../../)]

Thread overview: 15+ messages (download: [mbox.gz](../t.mbox.gz) follow: [Atom feed](../t.atom)
-- links below jump to the message on this page --
2022-11-14 19:16 [[PATCH net v4] l2tp: Serialize access to sk_user_data with sk_callback_lock](#m9be2a252f921a41a901d9b76e8e55fd06c28324d) Jakub Sitnicki
2022-11-15 11:12 ` [Tom Parkin](#m1fd8804b691a2a536317a00d3540360859078879)
2022-11-16 13:30 ` [patchwork-bot+netdevbpf](#m19e6c66abc9612a58d0cb07e95d70f62adef03a2)
2022-11-17  9:07   ` [Eric Dumazet](#m636e1847827c4ae4cf9886afccc0bf19b444f116)
2022-11-17  9:35     ` [Jakub Sitnicki](#madcb4ab0ee52c98cca178a8006dd8ec7a7ba93b4)
2022-11-17  9:54       ` [Eric Dumazet](#m329dca66fb90d633845951b4317af051ad430c6a)
2022-11-17  9:40     ` [Eric Dumazet](#mddc241e5777f4cb420edeea6d0b1ef080b947e64)
2022-11-17  9:55       ` [Jakub Sitnicki](#mb284faaab141eaa9e4fc04212d56fdd24470811b)
2022-11-18 10:28         ` [Eric Dumazet](#mfb698051cc0282a689e6c17c04c65ae861e187a7)
2022-11-18 10:57           ` [Jakub Sitnicki](#m339dc8a54e2bef977c4c00b585357a925c796b95)
2022-11-18 11:09             ` [Eric Dumazet](#m24eff0c5e474801d75f26807e68995ce9f682705)
2022-11-19 13:04               ` [Jakub Sitnicki](#mdf12e22339397bf692e12cf131eb234fadf47aae)
2022-12-02  9:50 ` [Hangbin Liu](#ma7c97cb9224a274d5e20a0c30ab5958fd1af04c3)
2022-12-05 10:24   ` [Jakub Sitnicki](#m161c6f4810a248b36faa7ea6ad4e17bccee8b19d)
2022-12-05 12:37     ` [Hangbin Liu](#m65ed612e807fa766bc48d4ca58846fee7b390916)

```

---

```
This is an external index of several public inboxes,
see [mirroring instructions](../../_/text/mirror/) on how to clone and mirror
all data and code used by this external index.
```


=== Content from lists.fedoraproject.org_4de5a4f6_20250114_183729.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/7X5SPXMXXFANDASPCKER2JIQO2F3UHCP/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/7X5SPXMXXFANDASPCKER2JIQO2F3UHCP/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/7X5SPXMXXFANDASPCKER2JIQO2F3UHCP/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/7X5SPXMXXFANDASPCKER2JIQO2F3UHCP/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)


#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-7X5SPXMXXFANDASPCKER2JIQO2F3UHCP.mbox.gz?message=7X5SPXMXXFANDASPCKER2JIQO2F3UHCP "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/7X5SPXMXXFANDASPCKER2JIQO2F3UHCP/#7X5SPXMXXFANDASPCKER2JIQO2F3UHCP)

# [SECURITY] Fedora 35 Update: kernel-6.0.11-100.fc35

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updatesfedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updatesfedoraproject.org")

4 Dec
2022

4 Dec
'22

8:33 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2022-b36cd53dca
2022-12-05 01:32:32.254801
--------------------------------------------------------------------------------

Name : kernel
Product : Fedora 35
Version : 6.0.11
Release : 100.fc35
URL : <https://www.kernel.org/>
Summary : The Linux kernel
Description :
The kernel meta package

--------------------------------------------------------------------------------
Update Information:

The 6.0.11 stable kernel update contains a number of important fixes across the
tree.
--------------------------------------------------------------------------------
ChangeLog:

\* Fri Dec 2 2022 Justin M. Forbes jforbes@fedoraproject.org [6.0.11-0]
- drm/i915: fix TLB invalidation for Gen12 video and compute engines (Andrzej Hajda)
- l2tp: Serialize access to sk\_user\_data with sk\_callback\_lock (Jakub Sitnicki)
- Adjust path to compressed vmlinux kernel image for s390x (Justin M. Forbes) [2149273]
- Linux v6.0.11
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #2134528 - CVE-2022-4129 kernel: l2tp: missing lock when clearing sk\_user\_data can lead to NULL pointer dereference
<https://bugzilla.redhat.com/show_bug.cgi?id=2134528>
[ 2 ] Bug #2147572 - CVE-2022-4139 kernel: i915: Incorrect GPU TLB flush can lead to random memory access
<https://bugzilla.redhat.com/show_bug.cgi?id=2147572>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2022-b36cd53dca' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/7X5SPXMXXFANDASPCKER2JIQO2F3UHCP/#7X5SPXMXXFANDASPCKER2JIQO2F3UHCP)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from lists.fedoraproject.org_4ca549d1_20250114_183730.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)


#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG.mbox.gz?message=JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG/#JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG)

# [SECURITY] Fedora 36 Update: kernel-6.0.11-200.fc36

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updatesfedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updatesfedoraproject.org")

4 Dec
2022

4 Dec
'22

8:58 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2022-24041b1667
2022-12-05 01:51:55.068157
--------------------------------------------------------------------------------

Name : kernel
Product : Fedora 36
Version : 6.0.11
Release : 200.fc36
URL : <https://www.kernel.org/>
Summary : The Linux kernel
Description :
The kernel meta package

--------------------------------------------------------------------------------
Update Information:

The 6.0.11 stable kernel update contains a number of important fixes across the
tree.
--------------------------------------------------------------------------------
ChangeLog:

\* Fri Dec 2 2022 Justin M. Forbes jforbes@fedoraproject.org [6.0.11-0]
- drm/i915: fix TLB invalidation for Gen12 video and compute engines (Andrzej Hajda)
- l2tp: Serialize access to sk\_user\_data with sk\_callback\_lock (Jakub Sitnicki)
- Adjust path to compressed vmlinux kernel image for s390x (Justin M. Forbes) [2149273]
- Linux v6.0.11
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #2134528 - CVE-2022-4129 kernel: l2tp: missing lock when clearing sk\_user\_data can lead to NULL pointer dereference
<https://bugzilla.redhat.com/show_bug.cgi?id=2134528>
[ 2 ] Bug #2147572 - CVE-2022-4139 kernel: i915: Incorrect GPU TLB flush can lead to random memory access
<https://bugzilla.redhat.com/show_bug.cgi?id=2147572>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2022-24041b1667' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG/#JOKXNIM2R4FQCDRQV67UMAY6EBC72QFG)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from lore.kernel.org_b566f6b4_20250114_183733.html ===

```
[netdev.vger.kernel.org archive mirror](../../?t=20221123130747)
 [help](../../_/text/help/) / [color](../../_/text/color/) / [mirror](../../_/text/mirror/) / [Atom feed](../../new.atom)
```
```
[*](#ea1b7cf735e7ab838b28d9539baab55f80d9cc4c3) [PATCH net v2] l2tp: Don't sleep and disable BH under writer-side sk_callback_lock
@ 2022-11-21  8:54 Jakub Sitnicki
  2022-11-23 12:50 ` [patchwork-bot+netdevbpf](#m90d923212c3584a20d5d78e74a6827288fe377b8)
  [0 siblings, 1 reply; 2+ messages in thread](#ra1b7cf735e7ab838b28d9539baab55f80d9cc4c3)
From: Jakub Sitnicki @ 2022-11-21  8:54 UTC ([permalink](../../20221121085426.21315-1-jakub%40cloudflare.com/) / [raw](../../20221121085426.21315-1-jakub%40cloudflare.com/raw))
  To: [netdev](../../../netdev/?t=20221121085613)
  Cc: David S. Miller, Eric Dumazet, Jakub Kicinski, Paolo Abeni,
	Tom Parkin, Tetsuo Handa, syzbot+703d9e154b3b58277261,
	syzbot+50680ced9e98a61f7698, syzbot+de987172bb74a381879b

When holding a reader-writer spin lock we cannot sleep. Calling
setup_udp_tunnel_sock() with write lock held violates this rule, because we
end up calling percpu_down_read(), which might sleep, as syzbot reports
[1]:

 __might_resched.cold+0x222/0x26b kernel/sched/core.c:9890
 percpu_down_read include/linux/percpu-rwsem.h:49 [inline]
 cpus_read_lock+0x1b/0x140 kernel/cpu.c:310
 static_key_slow_inc+0x12/0x20 kernel/jump_label.c:158
 udp_tunnel_encap_enable include/net/udp_tunnel.h:187 [inline]
 setup_udp_tunnel_sock+0x43d/0x550 net/ipv4/udp_tunnel_core.c:81
 l2tp_tunnel_register+0xc51/0x1210 net/l2tp/l2tp_core.c:1509
 pppol2tp_connect+0xcdc/0x1a10 net/l2tp/l2tp_ppp.c:723

Trim the writer-side critical section for sk_callback_lock down to the
minimum, so that it covers only operations on sk_user_data.

Also, when grabbing the sk_callback_lock, we always need to disable BH, as
Eric points out. Failing to do so leads to deadlocks because we acquire
sk_callback_lock in softirq context, which can get stuck waiting on us if:

1) it runs on the same CPU, or

       CPU0
       ----
  lock(clock-AF_INET6);
  <Interrupt>
    lock(clock-AF_INET6);

2) lock ordering leads to priority inversion

       CPU0                    CPU1
       ----                    ----
  lock(clock-AF_INET6);
                               local_irq_disable();
                               lock(&tcp_hashinfo.bhash[i].lock);
                               lock(clock-AF_INET6);
  <Interrupt>
    lock(&tcp_hashinfo.bhash[i].lock);

... as syzbot reports [2,3]. Use the _bh variants for write_(un)lock.

[1] [https://lore.kernel.org/netdev/0000000000004e78ec05eda79749@google.com/](https://lore.kernel.org/netdev/0000000000004e78ec05eda79749%40google.com/)
[2] [https://lore.kernel.org/netdev/000000000000e38b6605eda76f98@google.com/](https://lore.kernel.org/netdev/000000000000e38b6605eda76f98%40google.com/)
[3] [https://lore.kernel.org/netdev/000000000000dfa31e05eda76f75@google.com/](https://lore.kernel.org/netdev/000000000000dfa31e05eda76f75%40google.com/)

v2:
- Check and set sk_user_data while holding sk_callback_lock for both
  L2TP encapsulation types (IP and UDP) (Tetsuo)

Cc: Tom Parkin <tparkin@katalix.com>
Cc: Tetsuo Handa <penguin-kernel@i-love.sakura.ne.jp>
Fixes: b68777d54fac ("l2tp: Serialize access to sk_user_data with sk_callback_lock")
Reported-by: Eric Dumazet <edumazet@google.com>
Reported-by: syzbot+703d9e154b3b58277261@syzkaller.appspotmail.com
Reported-by: syzbot+50680ced9e98a61f7698@syzkaller.appspotmail.com
Reported-by: syzbot+de987172bb74a381879b@syzkaller.appspotmail.com
Signed-off-by: Jakub Sitnicki <jakub@cloudflare.com>
---
 [net/l2tp/l2tp_core.c](#Z2e.:..:20221121085426.21315-1-jakub::40cloudflare.com:1net:l2tp:l2tp_core.c) | 17 +++++++++--------
 1 file [changed](#ea1b7cf735e7ab838b28d9539baab55f80d9cc4c3), 9 insertions(+), 8 deletions(-)

[diff](#iZ2e.:..:20221121085426.21315-1-jakub::40cloudflare.com:1net:l2tp:l2tp_core.c) --git a/net/l2tp/l2tp_core.c b/net/l2tp/l2tp_core.c
index 754fdda8a5f5..9a1415fe3fa7 100644
--- a/net/l2tp/l2tp_core.c
+++ b/net/l2tp/l2tp_core.c
@@ -1474,11 +1474,12 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
 	}

 	sk = sock->sk;
-	write_lock(&sk->sk_callback_lock);
-
+	write_lock_bh(&sk->sk_callback_lock);
 	ret = l2tp_validate_socket(sk, net, tunnel->encap);
 	if (ret < 0)
-		goto err_sock;
+		goto err_inval_sock;
+	rcu_assign_sk_user_data(sk, tunnel);
+	write_unlock_bh(&sk->sk_callback_lock);

 	tunnel->l2tp_net = net;
 	pn = l2tp_pernet(net);
@@ -1507,8 +1508,6 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
 		};

 		setup_udp_tunnel_sock(net, sock, &udp_cfg);
-	} else {
-		rcu_assign_sk_user_data(sk, tunnel);
 	}

 	tunnel->old_sk_destruct = sk->sk_destruct;
@@ -1522,16 +1521,18 @@ int l2tp_tunnel_register(struct l2tp_tunnel *tunnel, struct net *net,
 	if (tunnel->fd >= 0)
 		sockfd_put(sock);

-	write_unlock(&sk->sk_callback_lock);
 	return 0;

 err_sock:
+	write_lock_bh(&sk->sk_callback_lock);
+	rcu_assign_sk_user_data(sk, NULL);
+err_inval_sock:
+	write_unlock_bh(&sk->sk_callback_lock);
+
 	if (tunnel->fd < 0)
 		sock_release(sock);
 	else
 		sockfd_put(sock);
-
-	write_unlock(&sk->sk_callback_lock);
 err:
 	return ret;
 }
--
2.38.1

[^](#ma1b7cf735e7ab838b28d9539baab55f80d9cc4c3) [permalink](../../20221121085426.21315-1-jakub%40cloudflare.com/) [raw](../../20221121085426.21315-1-jakub%40cloudflare.com/raw) [reply](../../20221121085426.21315-1-jakub%40cloudflare.com/#R) [related](../../20221121085426.21315-1-jakub%40cloudflare.com/#related)	[[flat](../../20221121085426.21315-1-jakub%40cloudflare.com/T/#u)|[nested](../../20221121085426.21315-1-jakub%40cloudflare.com/t/#u)] [2+ messages in thread](#ra1b7cf735e7ab838b28d9539baab55f80d9cc4c3)
```

* ```
  [*](#e90d923212c3584a20d5d78e74a6827288fe377b8) Re: [PATCH net v2] l2tp: Don't sleep and disable BH under writer-side sk_callback_lock
    2022-11-21  8:54 [[PATCH net v2] l2tp: Don't sleep and disable BH under writer-side sk_callback_lock](#ma1b7cf735e7ab838b28d9539baab55f80d9cc4c3) Jakub Sitnicki
  @ 2022-11-23 12:50 ` patchwork-bot+netdevbpf
    [0 siblings, 0 replies; 2+ messages in thread](#r90d923212c3584a20d5d78e74a6827288fe377b8)
  From: patchwork-bot+netdevbpf @ 2022-11-23 12:50 UTC ([permalink](../../166920781520.7047.5118959763745270461.git-patchwork-notify%40kernel.org/) / [raw](../../166920781520.7047.5118959763745270461.git-patchwork-notify%40kernel.org/raw))
    To: Jakub Sitnicki
    Cc: [netdev](../../../netdev/?t=20221123130747), davem, edumazet, kuba, pabeni, tparkin, penguin-kernel,
  	syzbot+703d9e154b3b58277261, syzbot+50680ced9e98a61f7698,
  	syzbot+de987172bb74a381879b

  Hello:

  This patch was applied to netdev/net.git (master)
  by David S. Miller <davem@davemloft.net>:

  On Mon, 21 Nov 2022 09:54:26 +0100 you wrote:
  > When holding a reader-writer spin lock we cannot sleep. Calling
  > setup_udp_tunnel_sock() with write lock held violates this rule, because we
  > end up calling percpu_down_read(), which might sleep, as syzbot reports
  > [1]:
  >
  >  __might_resched.cold+0x222/0x26b kernel/sched/core.c:9890
  >  percpu_down_read include/linux/percpu-rwsem.h:49 [inline]
  >  cpus_read_lock+0x1b/0x140 kernel/cpu.c:310
  >  static_key_slow_inc+0x12/0x20 kernel/jump_label.c:158
  >  udp_tunnel_encap_enable include/net/udp_tunnel.h:187 [inline]
  >  setup_udp_tunnel_sock+0x43d/0x550 net/ipv4/udp_tunnel_core.c:81
  >  l2tp_tunnel_register+0xc51/0x1210 net/l2tp/l2tp_core.c:1509
  >  pppol2tp_connect+0xcdc/0x1a10 net/l2tp/l2tp_ppp.c:723
  >
  > [...]

  Here is the summary with links:
    - [net,v2] l2tp: Don't sleep and disable BH under writer-side sk_callback_lock
      <https://git.kernel.org/netdev/net/c/af295e854a4e>

  You are awesome, thank you!
  --
  Deet-doot-dot, I am a bot.
  <https://korg.docs.kernel.org/patchwork/pwbot.html>

  [^](#m90d923212c3584a20d5d78e74a6827288fe377b8) [permalink](../../166920781520.7047.5118959763745270461.git-patchwork-notify%40kernel.org/) [raw](../../166920781520.7047.5118959763745270461.git-patchwork-notify%40kernel.org/raw) [reply](../../166920781520.7047.5118959763745270461.git-patchwork-notify%40kernel.org/#R)	[[flat](../../166920781520.7047.5118959763745270461.git-patchwork-notify%40kernel.org/T/#u)|[nested](../../166920781520.7047.5118959763745270461.git-patchwork-notify%40kernel.org/t/#u)] [2+ messages in thread](#r90d923212c3584a20d5d78e74a6827288fe377b8)
  ```

---

```
end of thread, other threads:[[~2022-11-23 13:07 UTC](../../?t=20221123130747) | [newest](../../)]

Thread overview: 2+ messages (download: [mbox.gz](../t.mbox.gz) follow: [Atom feed](../t.atom)
-- links below jump to the message on this page --
2022-11-21  8:54 [[PATCH net v2] l2tp: Don't sleep and disable BH under writer-side sk_callback_lock](#ma1b7cf735e7ab838b28d9539baab55f80d9cc4c3) Jakub Sitnicki
2022-11-23 12:50 ` [patchwork-bot+netdevbpf](#m90d923212c3584a20d5d78e74a6827288fe377b8)

```

---

```
This is a public inbox, see [mirroring instructions](../../_/text/mirror/)
for how to clone and mirror all data and code used for this inbox;
as well as URLs for NNTP newsgroup(s).
```


=== Content from lists.debian.org_7cf02436_20250114_183728.html ===


---

[[Date Prev](msg00004.html)][[Date Next](msg00006.html)]
[[Thread Prev](msg00004.html)][[Thread Next](msg00006.html)]
[[Date Index](maillist.html#00005)]
[[Thread Index](threads.html#00005)]

# [SECURITY] [DLA 3404-1] linux-5.10 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3404-1] linux-5.10 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Wed, 3 May 2023 00:45:59 +0200
* *Message-id*: <[[]](/msgid-search/ZFGSp0DAB4J0uLNL%40decadent.org.uk)[ZFGSp0DAB4J0uLNL@decadent.org.uk](msg00005.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3404-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
May 3, 2023                                   <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-5.10
Version        : 5.10.178-3~deb10u1
CVE ID         : CVE-2022-2196 CVE-2022-3424 CVE-2022-3707 CVE-2022-4129
                 CVE-2022-4379 CVE-2023-0045 CVE-2023-0458 CVE-2023-0459
                 CVE-2023-0461 CVE-2023-1073 CVE-2023-1074 CVE-2023-1076
                 CVE-2023-1077 CVE-2023-1078 CVE-2023-1079 CVE-2023-1118
                 CVE-2023-1281 CVE-2023-1513 CVE-2023-1611 CVE-2023-1670
                 CVE-2023-1829 CVE-2023-1855 CVE-2023-1859 CVE-2023-1872
                 CVE-2023-1989 CVE-2023-1990 CVE-2023-1998 CVE-2023-2162
                 CVE-2023-2194 CVE-2023-22998 CVE-2023-23004 CVE-2023-23559
                 CVE-2023-25012 CVE-2023-26545 CVE-2023-28328 CVE-2023-28466
                 CVE-2023-30456
Debian Bug     : 989705 993612 1022126 1031753

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service, or information
leak.

CVE-2022-2196

    A regression was discovered the KVM implementation for Intel CPUs,
    affecting Spectre v2 mitigation for nested virtualisation.  When
    KVM was used as the L0 hypervisor, an L2 guest could exploit this
    to leak sensitive information from its L1 hypervisor.

CVE-2022-3424

    Zheng Wang and Zhuorao Yang reported a flaw in the SGI GRU driver
    which could lead to a use-after-free.  On systems where this driver
    is used, a local user can explit this for denial of service (crash
    or memory corruption) or possibly for privilege escalation.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2022-3707

    Zheng Wang reported a flaw in the i915 graphics driver's
    virtualisation (GVT-g) support that could lead to a double-free.
    On systems where this feature is used, a guest can exploit this
    for denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2022-4129

    Haowei Yan reported a race condition in the L2TP protocol
    implementation which could lead to a null pointer dereference.  A
    local user could exploit this for denial of service (crash).

CVE-2022-4379

    Xingyuan Mo reported a flaw in the NFSv4.2 inter server to
    server copy implementation which could lead to a use-after-free.

    This feature is not enabled in Debian's official kernel
    configurations.

CVE-2023-0045

    Rodrigo Branco and Rafael Correa De Ysasi reported that when a
    user-space task told the kernel to enable Spectre v2 mitigation
    for it, the mitigation was not enabled until the task was next
    rescheduled.  This might be exploitable by a local or remote
    attacker to leak sensitive information from such an application.

CVE-2023-0458

    Jordy Zimmer and Alexandra Sandulescu found that getrlimit() and
    related system calls were vulnerable to speculative execution
    attacks such as Spectre v1.  A local user could explot this to
    leak sensitive information from the kernel.

CVE-2023-0459

    Jordy Zimmer and Alexandra Sandulescu found a regression in
    Spectre v1 mitigation in the user-copy functions for the amd64
    (64-bit PC) architecture.  Where the CPUs do not implement SMAP or
    it is disabled, a local user could exploit this to leak sensitive
    information from the kernel.  Other architectures may also be
    affected.

CVE-2023-0461

    "slipper" reported a flaw in the kernel's support for ULPs (Upper
    Layer Protocols) on top of TCP that can lead to a double-free when
    using kernel TLS sockets.  A local user can exploit this for
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

    Kernel TLS is not enabled in Debian's official kernel
    configurations.

CVE-2023-1073

    Pietro Borrello reported a type confusion flaw in the HID (Human
    Interface Device) subsystem.  An attacker able to insert and
    remove USB devices might be able to use this to cause a denial of
    service (crash or memory corruption) or possibly to run arbitrary
    code in the kernel.

CVE-2023-1074

    Pietro Borrello reported a type confusion flaw in the SCTP
    protocol implementation which can lead to a memory leak.  A local
    user could exploit this to cause a denial of service (resource
    exhaustion).

CVE-2023-1076

    Pietro Borrello reported a type confusion flaw in the TUN/TAP
    network driver, which results in all TUN/TAP sockets being marked
    as belonging to user ID 0 (root).  This may allow local users to
    evade local firewall rules based on user ID.

CVE-2023-1077

    Pietro Borrello reported a type confusion flaw in the task
    scheduler.  A local user might be able to exploit this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2023-1078

    Pietro Borrello reported a type confusion flaw in the RDS protocol
    implementation.  A local user could exploit this to cause a denial
    of service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2023-1079

    Pietro Borrello reported a race condition in the hid-asus HID
    driver which could lead to a use-after-free.  An attacker able to
    insert and remove USB devices can use this to cause a denial of
    service (crash or memory corruption) or possibly to run arbitrary
    code in the kernel.

CVE-2023-1118

    Duoming Zhou reported a race condition in the ene_ir remote
    control driver that can lead to a use-after-free if the driver
    is unbound.  It is not clear what the security impact of this is.

CVE-2023-1281, CVE-2023-1829

    "valis" reported two flaws in the cls_tcindex network traffic
    classifier which could lead to a use-after-free.  A local user can
    exploit these for privilege escalation.  This update removes
    cls_tcindex entirely.

CVE-2023-1513

    Xingyuan Mo reported an information leak in the KVM implementation
    for the i386 (32-bit PC) architecture.  A local user could exploit
    this to leak sensitive information from the kernel.

CVE-2023-1611

    "butt3rflyh4ck" reported a race condition in the btrfs filesystem
    driver which can lead to a use-after-free.  A local user could
    exploit this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2023-1670

    Zheng Wang reported a race condition in the xirc2ps_cs network
    driver which can lead to a use-after-free.  An attacker able to
    insert and remove PCMCIA devices can use this to cause a denial of
    service (crash or memory corruption) or possibly to run arbitrary
    code in the kernel.

CVE-2023-1855

    Zheng Wang reported a race condition in the xgene-hwmon hardware
    monitoring driver that may lead to a use-after-free.  It is not
    clear what the security impact of this is.

CVE-2023-1859

    Zheng Wang reported a race condition in the 9pnet_xen transport
    for the 9P filesystem on Xen, which can lead to a use-after-free.
    On systems where this feature is used, a backend driver in another
    domain can use this to cause a denial of service (crash or memory
    corruption) or possibly to run arbitrary code in the vulnerable
    domain.

CVE-2023-1872

    Bing-Jhong Billy Jheng reported a race condition in the io_uring
    subsystem that can lead to a use-after-free.  A local user could
    exploit this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2023-1989

    Zheng Wang reported a race condition in the btsdio Bluetooth
    adapter driver that can lead to a use-after-free.  An attacker
    able to insert and remove SDIO devices can use this to cause a
    denial of service (crash or memory corruption) or possibly to run
    arbitrary code in the kernel.

CVE-2023-1990

    Zheng Wang reported a race condition in the st-nci NFC adapter
    driver that can lead to a use-after-free.  It is not clear what
    the security impact of this is.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2023-1998

    Jos Oliveira and Rodrigo Branco reported a regression in Spectre
    v2 mitigation for user-space on x86 CPUs supporting IBRS but not
    eIBRS.  This might be exploitable by a local or remote attacker to
    leak sensitive information from a user-space application.

CVE-2023-2162

    Mike Christie reported a race condition in the iSCSI TCP transport
    that can lead to a use-after-free.  On systems where this feature
    is used, a local user might be able to use this to cause a denial
    of service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2023-2194

    Wei Chen reported a potential heap buffer overflow in the
    i2c-xgene-slimpro IC adapter driver.  A local user with
    permission to access such a device can use this to cause a denial
    of service (crash or memory corruption) and probably for privilege
    escalation.

CVE-2023-22998

    Miaoqian Lin reported an incorrect error check in the virtio-gpu
    GPU driver.  A local user with access to such a device might be
    able to use this to cause a denial of service (crash).

CVE-2023-23004

    Miaoqian Lin reported an incorrect error check in the mali-dp GPU
    driver.  A local user with access to such a device might be able
    to use this to cause a denial of service (crash).

CVE-2023-23559

    Szymon Heidrich reported incorrect bounds checks in the rndis_wlan
    Wi-Fi driver which may lead to a heap buffer overflow or overread.
    An attacker able to insert and remove USB devices can use this to
    cause a denial of service (crash or memory corruption) or
    information leak, or possibly to run arbitrary code in the kernel.

CVE-2023-25012

    Pietro Borrello reported a race condition in the hid-bigbenff HID
    driver which could lead to a use-after-free.  An attacker able to
    insert and remove USB devices can use this to cause a denial of
    service (crash or memory corruption) or possibly to run arbitrary
    code in the kernel.

CVE-2023-26545

    Lianhui Tang reported a flaw in the MPLS protocol implementation
    that could lead to a double-free.  A local user might be able to
    exploit this to cause a denial of service (crash or memory
    corruption) or possibl for privilege escalation.

CVE-2023-28328

    Wei Chen reported a flaw in the az6927 DVB driver that can lead to
    a null pointer dereference.  A local user permitted to access an
    IC adapter device that this driver creates can use this to cause
    a denial of service (crash).

CVE-2023-28466

    Hangyu Hua reported a race condition in the kernel TLS socket
    implementation which can lead to a use-after-free or null
    pointer dereference.  A local user can exploit this for
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

    This feature is not enabled in Debian's official kernel
    configurations.

CVE-2023-30456

    Reima ISHII reported a flaw in the KVM implementation for Intel
    CPUs affecting nested virtualisation.  When KVM was used as the L0
    hypervisor, and EPT and/or unrestricted guest mode was disabled,
    it did not prevent an L2 guest from being configured with an
    architecturally invalid protection/paging mode.  A malicious guest
    could exploit this to cause a denial of service (crash).

For Debian 10 buster, these problems have been fixed in version
5.10.178-3~deb10u1.  This update additionally fixes Debian bugs
#989705, #993612, #1022126, and #1031753; and includes many more bug
fixes from stable updates 5.10.163-5.10.178 inclusive.

We recommend that you upgrade your linux-5.10 packages.

For the detailed security status of linux-5.10 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-5.10>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgp5s08o5uONt.pgp)**

*Description:* PGP signature

---



=== Content from lists.fedoraproject.org_b91db185_20250114_183730.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)


#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67.mbox.gz?message=AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67 "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67/#AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67)

# [SECURITY] Fedora 37 Update: kernel-6.0.11-300.fc37

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updatesfedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updatesfedoraproject.org")

4 Dec
2022

4 Dec
'22

8:35 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2022-e4460c41bc
2022-12-05 01:34:38.451109
--------------------------------------------------------------------------------

Name : kernel
Product : Fedora 37
Version : 6.0.11
Release : 300.fc37
URL : <https://www.kernel.org/>
Summary : The Linux kernel
Description :
The kernel meta package

--------------------------------------------------------------------------------
Update Information:

The 6.0.11 stable kernel update contains a number of important fixes across the
tree.
--------------------------------------------------------------------------------
ChangeLog:

\* Fri Dec 2 2022 Justin M. Forbes jforbes@fedoraproject.org [6.0.11-0]
- drm/i915: fix TLB invalidation for Gen12 video and compute engines (Andrzej Hajda)
- l2tp: Serialize access to sk\_user\_data with sk\_callback\_lock (Jakub Sitnicki)
- Adjust path to compressed vmlinux kernel image for s390x (Justin M. Forbes) [2149273]
- Linux v6.0.11
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #2134528 - CVE-2022-4129 kernel: l2tp: missing lock when clearing sk\_user\_data can lead to NULL pointer dereference
<https://bugzilla.redhat.com/show_bug.cgi?id=2134528>
[ 2 ] Bug #2147572 - CVE-2022-4139 kernel: i915: Incorrect GPU TLB flush can lead to random memory access
<https://bugzilla.redhat.com/show_bug.cgi?id=2147572>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2022-e4460c41bc' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67/#AM5KFIE6JNZXHBA5A2KYDZAT3MEX2B67)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.


