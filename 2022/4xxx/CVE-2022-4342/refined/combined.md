=== Content from gitlab.com_388a6cfb_20250114_230105.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-4342.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-4342.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-4342.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-4342.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![ GitLab Bot 's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 " GitLab Bot ")](/gitlab-bot)

  Jan 10, 2023

  [78b4b2a8](/gitlab-org/cves/-/commit/78b4b2a8b7f6ab6f14cfa3f6c8e6e0c1f1fe265e)
  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/78b4b2a8b7f6ab6f14cfa3f6c8e6e0c1f1fe265e)
  繚
  78b4b2a8

  [ GitLab Bot ](/gitlab-bot) authored Jan 10, 2023

  78b4b2a8

  [Publishing 0 updated advisories and 1 new advisories](/gitlab-org/cves/-/commit/78b4b2a8b7f6ab6f14cfa3f6c8e6e0c1f1fe265e)
  [ GitLab Bot ](/gitlab-bot) authored Jan 10, 2023

Loading



=== Content from gitlab.com_73123e87_20250114_230106.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Maintainer can leak masked webhook secrets by changing target URL of the webhook

**[HackerOne report #1791331](https://hackerone.com/reports/1791331)** by `joaxcar` on 2022-12-03, assigned to [@greg](/greg "Greg Myers"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

#### Summary

This is related to the fix for my reports <https://hackerone.com/reports/1758126> and <https://hackerone.com/reports/1757999> fixed in patch [15.6.1](https://about.gitlab.com/releases/2022/11/30/security-release-gitlab-15-6-1-released/). After the 15.6 release there is an option to mask parts of a webhook URL to treat it as a secret value. See documentation [link](https://docs.gitlab.com/ee/user/project/integrations/webhooks.html#mask-sensitive-portions-of-webhook-urls).

When this feature is used any secret string in the configured URL will be masked in the UI and in any logs in the UI. The values work the same as other tokens in that they are not even accessible by the user configuring it after it is first configured. It should not be possible for the initial user or any other users to retrieve these values. (see <https://hackerone.com/reports/1758126>)

The problem with this new feature of masked values is that they have reintroduced the issue of leaking secrets by changing the URL. The masked secret fields are not cleared if a user changes the configured hook URL. Thus, any attacker controlled new URL will be able to retrieve the secret values.

Similar token fields on webhooks and`integrations` are reset if the URL is changed, forcing the user editing the integration to resend any token. This should probably also happen here.

The docs states this about the secret

> Sensitive portions do not get logged and are encrypted at rest in the database.

This change to the input field of the UI was made intentionally to hide the secret from other maintainers (as they do not necessarily have access to the receiving service). The leaked token (LOW confidentiality) gives an unauthorized other maintainer the ability to spoof requests to the receiving server (LOW integrity). And the impacted service is the receiving service (Scope changed). This was my rating of this, feel free to edit it as see fit!

#### Steps to reproduce

1. Log in to gitlab
2. Create a new project
3. Go to <https://gitlab.com/GROUP/PROJECT/-/hooks> and configure a webhook. Put the URL like this `https://example.com?token=secret-token`
4. Click to add a mask, add the value `secret-token` with the replacement `TOKEN`. Click save for the webhook
5. Scroll to the bottom of the page to the list of configured hooks.
6. Click edit on the new hook
7. You can now see that the token is hidden in the UI. both in the config URL and in the mask field, there is no way to retrieve it

[![hide_string.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/a4226c8226e817b828eef71394b1d6e6bd278e37/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f36626234613435302d323638362d346637652d393264392d3364613464613735313538352f686964655f737472696e672e706e67)

8. (this step can be done by another "attacker maintainer") Edit the URL to an "attacker controlled server" (i used <https://webhook.site> to catch the request). Keep the token={TOKEN} part. Like this `[https://WEBHOOK.SITE?token={TOKEN}](https://WEBHOOK.SITE?token=%7BTOKEN%7D)

[![change_url.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/ca1c26a132d202c0a366bc2bed7a362e1cb2cd70/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f65323432616538302d663732342d346136612d613632642d3635656235623364376264662f6368616e67655f75726c2e706e67)

9. Scroll down to the bottom of the page and click save (you can not send a test request before saving)
10. Scroll to the bottom of the page again and click edit again on the hook
11. Now click "test" to send a test request
12. Check your server to see that the request is sent to the new URL and containing the secret token

[![leak_token.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/bc2240a5d412c041a2954bd8edafd50f2ac59443/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f39386530656164352d623437312d343239632d626433332d3761613336646231643838622f6c65616b5f746f6b656e2e706e67)

(13. If you are an attacker now change back the URL to the original URL)

#### Impact

Maintainers can leak secret masked values that should not be accessible after configuration

#### What is the current *bug* behavior?

Masked values are kept after changing the domain in the hook URL

#### What is the expected *correct* behavior?

Changing the origin/domain of the webhook should invalidate secrets, as is done for all other secrets in GitLab at the moment.

#### Output of checks

This bug happens on GitLab.com

#### Impact

Maintainers can leak secret masked values that should not be accessible after configuration

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [leak\_token.png](https://h1.sec.gitlab.net/a/98e0ead5-b471-429c-bd33-7aa36db1d88b/leak_token.png)
* [change\_url.png](https://h1.sec.gitlab.net/a/e242ae80-f724-4a6a-a62d-65eb5b3d7bdf/change_url.png)
* [hide\_string.png](https://h1.sec.gitlab.net/a/6bb4a450-2686-4f7e-92d9-3da4da751585/hide_string.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


