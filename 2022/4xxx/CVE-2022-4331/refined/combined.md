=== Content from gitlab.com_b6736cb9_20250114_224334.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

* [cves](/gitlab-org/cves/-/tree/master)
* [2022](/gitlab-org/cves/-/tree/master/2022)
* [**CVE-2022-4331.json**](/gitlab-org/cves/-/blob/master/2022/CVE-2022-4331.json)

Find file

[Blame](/gitlab-org/cves/-/blame/master/2022/CVE-2022-4331.json)
[Permalink](/gitlab-org/cves/-/blob/5dbfc725a86e6d942deec9c36b7f06f5b8d912fc/2022/CVE-2022-4331.json "Go to permalink <kbd class='flat ml-1' aria-hidden=true>y</kbd>")

* [![🤖 GitLab Bot 🤖's avatar](/uploads/-/system/user/avatar/1786152/avatar.png?width=64 "🤖 GitLab Bot 🤖")](/gitlab-bot)

  Mar 04, 2023

  [99d4779c](/gitlab-org/cves/-/commit/99d4779c165753b3df1319bd4c1c88c89e5568d5)
  [Publishing 0 updated advisories and 4 new advisories](/gitlab-org/cves/-/commit/99d4779c165753b3df1319bd4c1c88c89e5568d5)
  ·
  99d4779c

  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Mar 04, 2023

  99d4779c

  [Publishing 0 updated advisories and 4 new advisories](/gitlab-org/cves/-/commit/99d4779c165753b3df1319bd4c1c88c89e5568d5)
  [🤖 GitLab Bot 🤖](/gitlab-bot) authored Mar 04, 2023

Loading



=== Content from gitlab.com_16bd0b78_20250114_224335.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Transferred group to new owner / namespace - Allowing unauthorized SSO and SCIM token misused

**[HackerOne report #1791518](https://hackerone.com/reports/1791518)** by `vaib25vicky` on 2022-12-03, assigned to [@cmaxim](/cmaxim "Costel Maxim"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Hi,

In the past I've submitted same issues(<https://hackerone.com/reports/1258092>) affecting Gitlab.com but those bugs become ineffective because of new unrelated changes are deployed. Gitlab.com is saved and instances don't allow Group saml sso at that time.

However, after 1 year, Gitlab self-hosted instances allow Group saml sso and same bugs resurfaced. Gitlab self-hosted instances are vulnerable now and not Gitlab.com

#### Summary:

Group with SAML SSO when transferred to new namespace as a child group then group SAML SSO setting options become invisible.

But all the previous config still works such as SSO and SCIM token

This bug can be exploited for three things

1. Previous owner transferred the group to private namespace, he got kicked out of the new group but he can again SSO into the group with owner permission.

   New owner can't stop him because SSO settings are invisible
2. Billing is associated with the parent group so when the group with SAML SSO transfer to the parent group on free plan, SSO still works and allows paid feature group SAML SSO and SCIM to use as free
3. Since, group SAML SSO becomes invisible SCIM token can longer be reset so in case when SCIM token is known to previous users or got leaked

   then token can be used to create new users in the group with higher permissions

#### Steps-to-reproduce:

You can also try my POC given below where most of the things are already configured and you just have to exploit. This is much simple poc and suggested to use for quick triage!

##### SCIM Token

1. set-up group sso and creates SCIM token
2. transfer the group to a new namespace/group as child group
3. child group saml sso setting becomes invisible
4. use the token to creates a new user (<https://docs.gitlab.com/ee/development/internal_api/index.html#create-a-scim-provisioned-user>) in the child group

```
curl --request POST "https://gdk.test:3443/api/scim/v2/groups/lakita-group%2Fmadie-group/Users" \
     --data '{"externalId":"test_uid","active":null,"userName":"username","emails":[{"primary":true,"type":"work","value":"name@example.com"}],"name":{"formatted":"Test User","familyName":"User","givenName":"Test"},"schemas":["urn:ietf:params:scim:schemas:core:2.0:User"],"meta":{"resourceType":"User"}}' \
     --header "Authorization: Bearer <SCIM_TOKEN>" --header "Content-Type: application/scim+json"
```

User will be successfully created

##### SSO into new private group

1. set up group sso and generate scim token
2. transfer the group as a child group in different namespace (private group)
3. remove previous owner, they can't access the private group
4. change your idP config of the saml and replace old group path to the new one
5. go the saml auth url directly and intercept the request
6. change the path parameter with the new namespace
7. continue the authorization process

   On success, previous owner will again gain owner permission in the new private group where he didn't have any access initially

### POC:

My Gitlab Instance [REDACTED]

Group named `test` was a top-level group with saml sso configured. It was later transferred to group named `group-two`. Previous user kicked out and since, `test` group is now a sub-group, new owner can't access saml sso settings in `test` sub-group and can't disable it.

Previous user log-in to their idP dashboard and initiate login to gain access to new private project `privv` inside group `test`

1. Okta user credentials:

   Okta dashboard url - [REDACTED]

username - [REDACTED]
password - [REDACTED]

2. After login, click **gitlab-group** app to initiate sso. You will be redirected to login to gitlab instance.

Gitlab instance user credentials

username - [REDACTED]
password - [REDACTED]

3. You will be redirected and gets an authorization screen, don't authorize yet
4. Open burp and keep intercept ON
5. Now, click on authorize and change the parameter `?group_path=test` to `?group_path=group-two%2ftest`

   and forward it.
6. Continue the saml flow without any more changes. After sso flow is completed you will gain access to the group `test` and also private project inside it named `test/privv`

#### Impact

Old SAML SSO still active so users part of the idP can still SSO into new private group which belongs to different owners

Previous kicked out owner can again become owner and new owner can't stop because saml settings are invisible

Billing is associated with the parent group so when the group with SAML SSO transfer to the parent group on free plan, SSO still works and allows paid feature group SAML SSO and SCIM to use as free

Since, group SAML SSO becomes invisible SCIM token can longer be reset so in case when SCIM token is known to previous users or got leaked

then token can be used to create new users in the group with higher permissions

Thanks!

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Apr 03, 2023 by [Rohit Shambhuni](/rshambhuni)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


