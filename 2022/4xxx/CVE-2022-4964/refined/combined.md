=== Content from bugs.launchpad.net_f481a105_20250114_231959.html ===

[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[pipewire package](https://launchpad.net/ubuntu/%2Bsource/pipewire)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/pipewire)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/pipewire)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/pipewire)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/pipewire)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/pipewire)

# pipewire-pulse grants microphone access to snaps without audio-record plugged

Bug #1995707 reported by
[James Henstridge](https://launchpad.net/~jamesh)
on 2022-11-04

[268](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [pipewire (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/pipewire "Latest release: 1.2.7-1ubuntu3, uploaded to main on 2024-12-18 10:49:09.586631+00:00 by Sebastien Bacher (seb128), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | Undecided | Unassigned |  |
|  | [wireplumber (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/wireplumber "Latest release: 0.5.7-1ubuntu1, uploaded to main on 2024-12-03 13:21:11.571195+00:00 by Jeremy Bícha (jbicha), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | Undecided | Unassigned |  |

### Bug Description

In Kinetic, pipewire-pulse is used in place of pulseaudio. We had patches in pulseaudio to detect when the client was a snap, and disable access to microphones if the snap didn't have audio-record plugged as described here:

<https://snapcraft.io/docs/audio-record-interface>

There doesn't seem to be any equivalent code in pipewire-pulse.

Steps to reproduce:

1. Build the record-exploit snap I put together for this previous bug: [https://bugs.launchpad.net/ubuntu/+source/pulseaudio/+bug/1877102/comments/1](https://bugs.launchpad.net/ubuntu/%2Bsource/pulseaudio/%2Bbug/1877102/comments/1)

2. Install snap with "snap install --dangerous record-exploit\_0.1\_amd64.snap".

3. Run "mkdir -p $XDG\_RUNTIME\_DIR/snap.record-exploit" (I forgot to include this in the PoC snap).

4. Run "record-exploit.parecord /tmp/foo.wav"

Expected behaviour: the parecord call results in an error.

Observed behaviour: the parecord call records sound from the mic (into /tmp/snap.record-exploit/tmp/foo.wav).

Tags:

[patch](/ubuntu/%2Bsource/pipewire/%2Bbugs?field.tag=patch)

## CVE References

* [2022-4964](/bugs/cve/2022-4964 "Ubuntu's pipewire-pulse in snap grant...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Seth Arnold (seth-arnold)](https://launchpad.net/~seth-arnold) wrote on 2022-11-04: |  |  | [#1](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/1) |
| --- | --- | --- | --- |

This seems like something that deserves a CVE, but I'm not sure what component exactly it would be against.

This seems like something that deserves a CVE, but I'm not sure what component exactly it would be against.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2022-11-21: |  |  | [#2](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/2) |
| --- | --- | --- | --- |

I wrote a quick patch for this. It is available in my PPA: [https://launchpad.net/~rastersoft-gmail/+archive/ubuntu/pipewire](https://launchpad.net/~rastersoft-gmail/%2Barchive/ubuntu/pipewire)

I wrote a quick patch for this. It is available in my PPA: https://launchpad.net/~rastersoft-gmail/+archive/ubuntu/pipewire

| Changed in pipewire (Ubuntu): | |
| --- | --- |
| **assignee**: | nobody → Sergio Costas (rastersoft-gmail) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Murray (alexmurray)](https://launchpad.net/~alexmurray) wrote on 2022-11-22: |  |  | [#4](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/4) |
| --- | --- | --- | --- |

* [current debdiff from PPA version](https://bugs.launchpad.net/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Battachment/5631958/%2Bfiles/pipewire.diff)
  [Edit](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Battachment/5631958)
  (14.0 KiB,
  text/plain)

Thanks Sergio - from a quick look at the debdiff (I have attached it for easier review by others) my initial feedback would be to use the aa\_gettaskcon() function from libapparmor to get the label of the client rather than manually parsing /proc/PID/attr/apparmor/current. But otherwise this looks pretty good I think.

Thanks Sergio - from a quick look at the debdiff (I have attached it for easier review by others) my initial feedback would be to use the aa\_gettaskcon() function from libapparmor to get the label of the client rather than manually parsing /proc/PID/attr/apparmor/current. But otherwise this looks pretty good I think.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Murray (alexmurray)](https://launchpad.net/~alexmurray) wrote on 2022-11-22: |  |  | [#5](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/5) |
| --- | --- | --- | --- |

Ah actually I think we also should mediate the "audio-playback" and "pulseaudio" plugs as well - and we need to handle the case of a snap with classic confinement - this should always be granted full access too.

Ah actually I think we also should mediate the "audio-playback" and "pulseaudio" plugs as well - and we need to handle the case of a snap with classic confinement - this should always be granted full access too.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2022-11-22: |  |  | [#6](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/6) |
| --- | --- | --- | --- |

Good points!

Good points!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2022-11-22: |  |  | [#7](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/7) |
| --- | --- | --- | --- |

About "audio-playback"... is the pipewire socket exported inside the sandbox if it isn't specified?

About "audio-playback"... is the pipewire socket exported inside the sandbox if it isn't specified?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2022-11-22: |  |  | [#8](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/8) |
| --- | --- | --- | --- |

Ok, changes done. Also, you can find the patch here: <https://salsa.debian.org/Sergio.Costas/pipewire/-/merge_requests/1>

Ok, changes done. Also, you can find the patch here: https://salsa.debian.org/Sergio.Costas/pipewire/-/merge\_requests/1

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2022-11-22 (last edit on 2022-11-22): |  |  | [#9](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/9) |
| --- | --- | --- | --- |

BTW: I'm returning ENOTSUP instead of EPERM to ensure that the functions return a "known" value, instead of a "new" one, to avoid compatibility problems. What do you think about that?

BTW: I'm returning ENOTSUP instead of EPERM to ensure that the functions return a "known" value, instead of a "new" one, to avoid compatibility problems. What do you think about that?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Murray (alexmurray)](https://launchpad.net/~alexmurray) wrote on 2022-11-23: |  |  | [#10](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/10) |
| --- | --- | --- | --- |

I get a 404 when accessing that MR on salsa.debian.org (I'm <https://salsa.debian.org/amurray-guest> if you can add access for me?)

I get a 404 when accessing that MR on salsa.debian.org (I'm https://salsa.debian.org/amurray-guest if you can add access for me?)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2022-11-23: |  |  | [#11](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/11) |
| --- | --- | --- | --- |

Done.

Done.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2022-11-24: |  |  | [#12](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/12) |
| --- | --- | --- | --- |

I uploaded a change that basically adds a little layer in-between to allow other sandbox technologies (i.e. Flatpak) to also add their own permissions scheme. This is the code that we would send to merge into upstream. Can you review it when you have some spare time?

I uploaded a change that basically adds a little layer in-between to allow other sandbox technologies (i.e. Flatpak) to also add their own permissions scheme. This is the code that we would send to merge into upstream. Can you review it when you have some spare time?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2022-11-24: |  |  | [#13](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/13) |
| --- | --- | --- | --- |

(it's at <https://salsa.debian.org/Sergio.Costas/pipewire/-/merge_requests/1> )

(it's at https://salsa.debian.org/Sergio.Costas/pipewire/-/merge\_requests/1 )

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2023-01-26: |  |  | [#14](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/14) |
| --- | --- | --- | --- |

The PPA has now packages for Jammy, Kinetik and Lunar.

The PPA has now packages for Jammy, Kinetik and Lunar.

[Jeremy Bícha (jbicha)](https://launchpad.net/~jbicha)
on 2024-01-17

| Changed in pipewire (Ubuntu): | |
| --- | --- |
| **status**: | New → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2024-01-18: |  |  | [#15](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/15) |
| --- | --- | --- | --- |

The final solution are two MR, one for pipewire and another for wireplumber. Both have been already merged in upstream. Also, they are safe when applied alone, so there is no problem in doing so.

<https://gitlab.freedesktop.org/pipewire/pipewire/-/merge_requests/1779>

<https://gitlab.freedesktop.org/pipewire/wireplumber/-/merge_requests/567>

The final solution are two MR, one for pipewire and another for wireplumber. Both have been already merged in upstream. Also, they are safe when applied alone, so there is no problem in doing so.
https://gitlab.freedesktop.org/pipewire/pipewire/-/merge\_requests/1779
https://gitlab.freedesktop.org/pipewire/wireplumber/-/merge\_requests/567

[Jeremy Bícha (jbicha)](https://launchpad.net/~jbicha)
on 2024-01-18

| Changed in wireplumber (Ubuntu): | |
| --- | --- |
| **status**: | New → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Murray (alexmurray)](https://launchpad.net/~alexmurray) wrote on 2024-01-19: |  |  | [#16](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/16) |
| --- | --- | --- | --- |

Thanks for following up on these with upstream Sergio - I think perhaps we should treat these as a security issue and do the updates via -security in Ubuntu.

Thanks for following up on these with upstream Sergio - I think perhaps we should treat these as a security issue and do the updates via -security in Ubuntu.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2024-01-22: |  |  | [#17](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/17) |
| --- | --- | --- | --- |

This bug was fixed in the package pipewire - 1.0.1-1ubuntu2

---------------

pipewire (1.0.1-1ubuntu2) noble; urgency=medium

\* Drop Build-Depends: libroc-dev

pipewire (1.0.1-1ubuntu1) noble; urgency=medium

\* Merge with Debian. Remaining change:

    - Disable roc support since roc-toolkit is in universe

  \* Cherry-pick patches from Sergio Costas for snap permissions support

    (LP: [#1995707](/bugs/1995707))

  \* Add apparmor and snapd-glib to Build-Depends for snap feature

  \* debian/control: Bump minimum libcamera to 0.2

  \* Cherry-pick patches to switch to libcamera 0.2

pipewire (1.0.1-1) unstable; urgency=medium

\* New upstream release

  \* Add lintian overrides for groff-message in manpages

  \* Update upstream branch in debian/gbp.conf

pipewire (1.0.0-3) unstable; urgency=medium

\* libpipewire-0.3-modules-x11: depend on libcanberra-pulse (Closes: #1059544)

      module-x11-bell requires the libcanberra PulseAudio backend.

pipewire (1.0.0-2) experimental; urgency=medium

\* Install udev rules in /usr/lib/udev/rules.d (Closes: #1057233)

    Thanks to Chris Hofstaedtler.

  \* Extend hurd-i386 restrictions to hurd-any

  \* Build-Depend on the fixed version of libroc-dev: remove the now

    useless build-deps on libuv1-dev and libspeexdsp-dev.

-- Jeremy Bícha <email address hidden> Wed, 17 Jan 2024 17:46:45 -0500

This bug was fixed in the package pipewire - 1.0.1-1ubuntu2
---------------
pipewire (1.0.1-1ubuntu2) noble; urgency=medium
\* Drop Build-Depends: libroc-dev
pipewire (1.0.1-1ubuntu1) noble; urgency=medium
\* Merge with Debian. Remaining change:
- Disable roc support since roc-toolkit is in universe
\* Cherry-pick patches from Sergio Costas for snap permissions support
(LP: #1995707)
\* Add apparmor and snapd-glib to Build-Depends for snap feature
\* debian/control: Bump minimum libcamera to 0.2
\* Cherry-pick patches to switch to libcamera 0.2
pipewire (1.0.1-1) unstable; urgency=medium
\* New upstream release
\* Add lintian overrides for groff-message in manpages
\* Update upstream branch in debian/gbp.conf
pipewire (1.0.0-3) unstable; urgency=medium
\* libpipewire-0.3-modules-x11: depend on libcanberra-pulse (Closes: #1059544)
module-x11-bell requires the libcanberra PulseAudio backend.
pipewire (1.0.0-2) experimental; urgency=medium
\* Install udev rules in /usr/lib/udev/rules.d (Closes: #1057233)
Thanks to Chris Hofstaedtler.
\* Extend hurd-i386 restrictions to hurd-any
\* Build-Depend on the fixed version of libroc-dev: remove the now
useless build-deps on libuv1-dev and libspeexdsp-dev.
-- Jeremy Bícha <jbicha@ubuntu.com> Wed, 17 Jan 2024 17:46:45 -0500

| Changed in pipewire (Ubuntu): | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mark Esler (eslerm)](https://launchpad.net/~eslerm) wrote on 2024-01-24: |  |  | [#18](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/18) |
| --- | --- | --- | --- |

Please refer to this issue, in Ubuntu snaps, as CVE-2022-4964.

Could the wireplumber fix be released?

Thank you for the report @jamesh \o/

Please refer to this issue, in Ubuntu snaps, as CVE-2022-4964.
Could the wireplumber fix be released?
Thank you for the report @jamesh \o/

| **information type**: | Private Security → Public Security |
| --- | --- |

[Ubuntu Foundations Team Bug Bot (crichton)](https://launchpad.net/~crichton)
on 2024-01-24

| **tags**: | added: patch |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Bícha (jbicha)](https://launchpad.net/~jbicha) wrote on 2024-01-24: |  |  | [#19](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/19) |
| --- | --- | --- | --- |

Mark, I've uploaded the wireplumber fix to Noble now. Please let us know if you need any other help here.

[https://launchpad.net/ubuntu/+source/wireplumber/0.4.17-1ubuntu1](https://launchpad.net/ubuntu/%2Bsource/wireplumber/0.4.17-1ubuntu1)

Mark, I've uploaded the wireplumber fix to Noble now. Please let us know if you need any other help here.
https://launchpad.net/ubuntu/+source/wireplumber/0.4.17-1ubuntu1

| Changed in wireplumber (Ubuntu): | |
| --- | --- |
| **status**: | In Progress → Fix Committed |
| Changed in pipewire (Ubuntu): | |
| **assignee**: | Sergio Costas (rastersoft-gmail) → nobody |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2024-01-25: |  |  | [#20](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/20) |
| --- | --- | --- | --- |

This bug was fixed in the package wireplumber - 0.4.17-1ubuntu1

---------------

wireplumber (0.4.17-1ubuntu1) noble; urgency=medium

\* Add patch to add support for snap permissions (LP: [#1995707](/bugs/1995707))

-- Sergio Costas <email address hidden> Wed, 24 Jan 2024 12:54:23 -0500

This bug was fixed in the package wireplumber - 0.4.17-1ubuntu1
---------------
wireplumber (0.4.17-1ubuntu1) noble; urgency=medium
\* Add patch to add support for snap permissions (LP: #1995707)
-- Sergio Costas <sergio.costas@canonical.com> Wed, 24 Jan 2024 12:54:23 -0500

| Changed in wireplumber (Ubuntu): | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Vidar Braut Haarr (vhaarr+launchpad)](https://launchpad.net/~vhaarr%2Blaunchpad) wrote on 2024-01-26: |  |  | [#21](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/21) |
| --- | --- | --- | --- |

0.4.17-1ubuntu1 removes all output and input sinks in the gnome settings sound panel for me, to the extent that the volume level indicator that usually shows in the top right corner is just removed.

Playing audio through celluloid (mpv) still works with the default sink, while Firefox Nightly refuses to play anything.

This is on X11, without snapd installed.

Reverting to 0.4.17-1 works fine, and gnome settings lists all 5 output sinks again like normal.

0.4.17-1ubuntu1 removes all output and input sinks in the gnome settings sound panel for me, to the extent that the volume level indicator that usually shows in the top right corner is just removed.
Playing audio through celluloid (mpv) still works with the default sink, while Firefox Nightly refuses to play anything.
This is on X11, without snapd installed.
Reverting to 0.4.17-1 works fine, and gnome settings lists all 5 output sinks again like normal.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Bícha (jbicha)](https://launchpad.net/~jbicha) wrote on 2024-01-26 (last edit on 2024-01-26): |  |  | [#22](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/22) |
| --- | --- | --- | --- |

Vidar, please report a new bug. You can run

ubuntu-bug

and then choose the Sound/Audio option. You can then report the bug number here.

Vidar, please report a new bug. You can run
ubuntu-bug
and then choose the Sound/Audio option. You can then report the bug number here.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Vidar Braut Haarr (vhaarr+launchpad)](https://launchpad.net/~vhaarr%2Blaunchpad) wrote on 2024-01-29: |  |  | [#23](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/23) |
| --- | --- | --- | --- |

Thank you Jeremy, I filed [https://bugs.launchpad.net/ubuntu/+source/wireplumber/+bug/2051504](https://bugs.launchpad.net/ubuntu/%2Bsource/wireplumber/%2Bbug/2051504) now.

Thank you Jeremy, I filed https://bugs.launchpad.net/ubuntu/+source/wireplumber/+bug/2051504 now.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Sergio Costas (rastersoft-gmail)](https://launchpad.net/~rastersoft-gmail) wrote on 2024-01-29 (last edit on 2024-01-29): |  |  | [#24](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/comments/24) |
| --- | --- | --- | --- |

I prepared a patch for [https://bugs.launchpad.net/ubuntu/+source/wireplumber/+bug/2051504](https://bugs.launchpad.net/ubuntu/%2Bsource/wireplumber/%2Bbug/2051504) , but the bug is in pipewire, not in wireplumber.

I prepared a patch for https://bugs.launchpad.net/ubuntu/+source/wireplumber/+bug/2051504 , but the bug is in pipewire, not in wireplumber.

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/pipewire/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [current debdiff from PPA version](https://bugs.launchpad.net/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Battachment/5631958/%2Bfiles/pipewire.diff)
  [Edit](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Battachment/5631958 "Change patch details")

* [Add patch](/ubuntu/%2Bsource/pipewire/%2Bbug/1995707/%2Baddcomment?field.patch=on)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from gitlab.freedesktop.org_152d4b5f_20250114_232000.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Register](/users/sign_up)

## Admin message

Due to an influx of spam, we have had to impose restrictions on new accounts. Please see [this wiki page](https://gitlab.freedesktop.org/freedesktop/freedesktop/-/wikis/home) for instructions on how to get full permissions. Sorry for the inconvenience.

# pipewire-pulse: add snap permissions support

Code

* Review changes
* Check out branch
* ---
* Download
* [Patches](/pipewire/pipewire/-/merge_requests/1779.patch)
* [Plain diff](/pipewire/pipewire/-/merge_requests/1779.diff)

[Sergio Costas](/sergio-costas) requested to merge  [sergio-costas/pipewire-fork:pipewire-pulse-add-snap-permissions-support](/sergio-costas/pipewire-fork/-/tree/pipewire-pulse-add-snap-permissions-support "sergio-costas/pipewire-fork:pipewire-pulse-add-snap-permissions-support")
 into [master](/pipewire/pipewire/-/tree/master "master") Nov 22, 2023

* [Overview
  50](/pipewire/pipewire/-/merge_requests/1779)
* [Commits
  18](/pipewire/pipewire/-/merge_requests/1779/commits)
* [Pipelines
  21](/pipewire/pipewire/-/merge_requests/1779/pipelines)
* [Changes
  7](/pipewire/pipewire/-/merge_requests/1779/diffs)

Expand

SNAP containers have two main "audio" security rules:

* audio-playback: the applications inside the container can
  send audio samples into a sink
* audio-record: the applications inside the container can
  get audio samples from a source

Also, old SNAP containers had the "pulseaudio" rule, which just
exposed the pulseaudio socket directly, without limits. This
is similar to the current Flatpak audio permissions.

In the pulseaudio days, a specific pulseaudio module was used
that checked the permissions given to the application and
allowed or forbade access to the pulseaudio operations.
With the change to pipewire, this functionality must be
implemented in pipewire-pulse to guarantee the sandbox
security.

This patch adds support for sandboxing permissions in the
pulseaudio module, and implements support for the SNAP audio
security model, thus forbiding a SNAP application to record
audio unless it has permissions to do so.

The current code for pipewire-pulseaudio checks the permissions
of the snap and adds three properties to each new client:

* pipewire.snap.id: contains the Snap ID of the client.
* pipewire.snap.audio.playback: its value is 'true' if the client
  has permission to play audio, or 'false' if not.
* pipewire.snap.audio.record: its value is 'true' if the client
  has permission to record audio, or 'false' if not.

These properties must be processed by wireplumber to add or
remove access permissions to the corresponding nodes. That
code is available in a separate patch: [wireplumber!567 (merged)](https://gitlab.freedesktop.org/pipewire/wireplumber/-/merge_requests/567 "wireplumber: add support for snap permissions")

Fix [#3277 (closed)](/pipewire/pipewire/-/issues/3277 "Snap permissions aren't honored (includes patch to fix it)")

Edited Nov 22, 2023 by [Sergio Costas](/sergio-costas)

## Merge request reports

Assignee
Loading

Reviewers
Loading

Request review fromRequest review fromLoading

Time tracking
Loading

Loading



=== Content from gitlab.freedesktop.org_aae799af_20250114_232001.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Register](/users/sign_up)

## Admin message

Due to an influx of spam, we have had to impose restrictions on new accounts. Please see [this wiki page](https://gitlab.freedesktop.org/freedesktop/freedesktop/-/wikis/home) for instructions on how to get full permissions. Sorry for the inconvenience.

# wireplumber: add support for snap permissions

Code

* Review changes
* Check out branch
* ---
* Download
* [Patches](/pipewire/wireplumber/-/merge_requests/567.patch)
* [Plain diff](/pipewire/wireplumber/-/merge_requests/567.diff)

[Sergio Costas](/sergio-costas) requested to merge  [sergio-costas/wireplumber:DT-795-update-pipewire-to-enforce-snaps-audio-record-permissions](/sergio-costas/wireplumber/-/tree/DT-795-update-pipewire-to-enforce-snaps-audio-record-permissions "sergio-costas/wireplumber:DT-795-update-pipewire-to-enforce-snaps-audio-record-permissions")
 into [master](/pipewire/wireplumber/-/tree/master "master") Nov 21, 2023

* [Overview
  24](/pipewire/wireplumber/-/merge_requests/567)
* [Commits
  4](/pipewire/wireplumber/-/merge_requests/567/commits)
* [Pipelines
  6](/pipewire/wireplumber/-/merge_requests/567/pipelines)
* [Changes
  2](/pipewire/wireplumber/-/merge_requests/567/diffs)

Expand

This patch adds to wireplumber code to manage the Snap audio
permissions.

SNAP containers have two main "audio" rules:

* audio-playback: the applications inside the container can
  send audio samples into a sink
* audio-record: the applications inside the container can
  get audio samples from a source

Also, old SNAP containers had the "pulseaudio" rule, which just
exposed the pulseaudio socket directly, without limits. This
is similar to the current Flatpak audio permissions.

In the pulseaudio days, an specific pulseaudio module was used
that checked the permissions given to the application and
allowed or forbide access to the pulseaudio operations.
With the change to pipewire, this functionality must be
implemented in pipewire-pulse and wireplumber to guarantee
the sandbox security.

The current code checks for the presence of the pipewire.snap.id
property in a client, in which case it will read the
pipewire.snap.audio.playback and pipewire.snap.audio.record
properties, and allow or deny access to that client to
the nodes with Audio/Sink or Audio/Source media.class
property.

Those pipewire.snap.\* properties must be added in the
pipewire-pulse module. That code is available in a
different patch: [pipewire!1779 (merged)](https://gitlab.freedesktop.org/pipewire/pipewire/-/merge_requests/1779 "pipewire-pulse: add snap permissions support")

Edited Nov 22, 2023 by [Sergio Costas](/sergio-costas)

## Merge request reports

Assignee
Loading

Reviewers
Loading

Request review fromRequest review fromLoading

Time tracking
Loading

Loading


