=== Content from github.com_89d0b99d_20250114_182855.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsviehb%2Fjefferson%2Fcommit%2F53b3f2fc34af0bb32afbcee29d18213e61471d87)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsviehb%2Fjefferson%2Fcommit%2F53b3f2fc34af0bb32afbcee29d18213e61471d87)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sviehb%2Fjefferson)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sviehb](/sviehb)
/
**[jefferson](/sviehb/jefferson)**
Public

* [Notifications](/login?return_to=%2Fsviehb%2Fjefferson) You must be signed in to change notification settings
* [Fork
  121](/login?return_to=%2Fsviehb%2Fjefferson)
* [Star
   328](/login?return_to=%2Fsviehb%2Fjefferson)

* [Code](/sviehb/jefferson)
* [Issues
  3](/sviehb/jefferson/issues)
* [Pull requests
  0](/sviehb/jefferson/pulls)
* [Actions](/sviehb/jefferson/actions)
* [Projects
  0](/sviehb/jefferson/projects)
* [Wiki](/sviehb/jefferson/wiki)
* [Security](/sviehb/jefferson/security)
* [Insights](/sviehb/jefferson/pulse)

Additional navigation options

* [Code](/sviehb/jefferson)
* [Issues](/sviehb/jefferson/issues)
* [Pull requests](/sviehb/jefferson/pulls)
* [Actions](/sviehb/jefferson/actions)
* [Projects](/sviehb/jefferson/projects)
* [Wiki](/sviehb/jefferson/wiki)
* [Security](/sviehb/jefferson/security)
* [Insights](/sviehb/jefferson/pulse)

## Commit

[Permalink](/sviehb/jefferson/commit/53b3f2fc34af0bb32afbcee29d18213e61471d87)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix path traversal security vulnerability by canonicalizing path name…

[Browse files](/sviehb/jefferson/tree/53b3f2fc34af0bb32afbcee29d18213e61471d87)
Browse the repository at this point in the history

```
…s of every inodes and discarding inodes with a path

pointing outside of the extraction directory.

Fix path traversal through symlinks by canonicalizing link target path using the extraction directory as root. If the link
still points outside the extraction root, it gets discarded. This way symlinks reflects the reality of a filesystem on device
by pointing to files within the extracted filesystem instead of files from the host executing jefferson.
```

* Loading branch information

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

[qkaiser](/sviehb/jefferson/commits?author=qkaiser "View all commits by qkaiser")
committed
Jan 24, 2022

1 parent
[216eee6](/sviehb/jefferson/commit/216eee6c56d338e5a14a0af5d07f1117cff92b3b)

commit 53b3f2f

Showing
**1 changed file**
with
**21 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

25 changes: 21 additions & 4 deletions

25
[src/scripts/jefferson](#diff-7b3e6910a844d7179985e43160ca15feebc8b94bd7cbb520e3909999d3aa79bf "src/scripts/jefferson")

Show comments

[View file](/sviehb/jefferson/blob/53b3f2fc34af0bb32afbcee29d18213e61471d87/src/scripts/jefferson)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,6 @@ import stat |
|  |  | import os |
|  |  | import zlib |
|  |  | import binascii |
|  |  |  |
|  |  | import cstruct |
|  |  |  |
|  |  | from jefferson import jffs2\_lzma, rtime |
| Expand Down  Expand Up | | @@ -52,6 +51,12 @@ JFFS2\_NODETYPE\_XREF = JFFS2\_FEATURE\_INCOMPAT | JFFS2\_NODE\_ACCURATE | 9 |
|  |  | def mtd\_crc(data): |
|  |  | return (binascii.crc32(data, -1) ^ -1) & 0xFFFFFFFF |
|  |  |  |
|  |  | def is\_safe\_path(basedir, path, follow\_symlinks=True): |
|  |  | if follow\_symlinks: |
|  |  | matchpath = os.path.realpath(path) |
|  |  | else: |
|  |  | matchpath = os.path.abspath(path) |
|  |  | return basedir == os.path.commonpath((basedir, matchpath)) |
|  |  |  |
|  |  | cstruct.typedef("uint8", "uint8\_t") |
|  |  | cstruct.typedef("uint16", "jint16\_t") |
| Expand Down  Expand Up | | @@ -474,20 +479,32 @@ def dump\_fs(fs, target): |
|  |  | node\_names.append(dirent.name.decode()) |
|  |  | path = "/".join(node\_names) |
|  |  |  |
|  |  | target\_path = os.path.join(os.getcwd(), target, path) |
|  |  | target\_path = os.path.realpath(os.path.join(os.getcwd(), target, path)) |
|  |  |  |
|  |  | if not is\_safe\_path(target, target\_path): |
|  |  | print(f"Path traversal attempt to {target\_path}, discarding.") |
|  |  | continue |
|  |  |  |
|  |  | for inode in dirent.inodes: |
|  |  | try: |
|  |  | if stat.S\_ISDIR(inode.mode): |
|  |  | print("writing S\_ISDIR", path) |
|  |  | if not os.path.isdir(target\_path): |
|  |  | os.makedirs(target\_path) |
|  |  | elif stat.S\_ISLNK(inode.mode): |
|  |  | link\_path = inode.data.decode('utf-8') |
|  |  | if link\_path: |
|  |  | link\_path = link\_path[1:] |
|  |  | link\_target = os.path.realpath(os.path.join(target, link\_path)) |
|  |  | if not is\_safe\_path(target, link\_target): |
|  |  | print(f"Path traversal attempt through symlink to {link\_target}, discarding.") |
|  |  | continue |
|  |  | print("writing S\_ISLNK", path) |
|  |  | if not os.path.islink(target\_path): |
|  |  | if os.path.exists(target\_path): |
|  |  | print("file already exists as", inode.data) |
|  |  | continue |
|  |  | os.symlink(inode.data, target\_path) |
|  |  | os.symlink(link\_target, target\_path) |
|  |  | elif stat.S\_ISREG(inode.mode): |
|  |  | print("writing S\_ISREG", path) |
|  |  | if not os.path.isfile(target\_path): |
| Expand Down  Expand Up | | @@ -561,7 +578,7 @@ def main(): |
|  |  | if not fs[JFFS2\_NODETYPE\_DIRENT]: |
|  |  | continue |
|  |  |  |
|  |  | dest\_path\_fs = os.path.join(dest\_path, "fs\_%i" % fs\_index) |
|  |  | dest\_path\_fs = os.path.realpath(os.path.join(dest\_path, "fs\_%i" % fs\_index)) |
|  |  | print("dumping fs #%i to %s" % (fs\_index, dest\_path\_fs)) |
|  |  | for key, value in fs.items(): |
|  |  | if key == "endianness": |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `53b3f2f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsviehb%2Fjefferson%2Fcommit%2F53b3f2fc34af0bb32afbcee29d18213e61471d87) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6181aa6d_20250114_182856.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsviehb%2Fjefferson%2Fpull%2F36)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsviehb%2Fjefferson%2Fpull%2F36)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=sviehb%2Fjefferson)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sviehb](/sviehb)
/
**[jefferson](/sviehb/jefferson)**
Public

* [Notifications](/login?return_to=%2Fsviehb%2Fjefferson) You must be signed in to change notification settings
* [Fork
  121](/login?return_to=%2Fsviehb%2Fjefferson)
* [Star
   328](/login?return_to=%2Fsviehb%2Fjefferson)

* [Code](/sviehb/jefferson)
* [Issues
  3](/sviehb/jefferson/issues)
* [Pull requests
  0](/sviehb/jefferson/pulls)
* [Actions](/sviehb/jefferson/actions)
* [Projects
  0](/sviehb/jefferson/projects)
* [Wiki](/sviehb/jefferson/wiki)
* [Security](/sviehb/jefferson/security)
* [Insights](/sviehb/jefferson/pulse)

Additional navigation options

* [Code](/sviehb/jefferson)
* [Issues](/sviehb/jefferson/issues)
* [Pull requests](/sviehb/jefferson/pulls)
* [Actions](/sviehb/jefferson/actions)
* [Projects](/sviehb/jefferson/projects)
* [Wiki](/sviehb/jefferson/wiki)
* [Security](/sviehb/jefferson/security)
* [Insights](/sviehb/jefferson/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsviehb%2Fjefferson%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsviehb%2Fjefferson%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Generic improvements #36

 Merged

[qkaiser](/qkaiser)
merged 15 commits into
[sviehb:master](/sviehb/jefferson/tree/master "sviehb/jefferson:master")
from
[onekey-sec:master](/onekey-sec/jefferson/tree/master "onekey-sec/jefferson:master")

Feb 28, 2022

 Merged

# [Generic improvements](#top) #36

[qkaiser](/qkaiser)
merged 15 commits into
[sviehb:master](/sviehb/jefferson/tree/master "sviehb/jefferson:master")
from
[onekey-sec:master](/onekey-sec/jefferson/tree/master "onekey-sec/jefferson:master")

Feb 28, 2022

[Conversation
1](/sviehb/jefferson/pull/36)
[Commits
15](/sviehb/jefferson/pull/36/commits)
[Checks
0](/sviehb/jefferson/pull/36/checks)
[Files changed](/sviehb/jefferson/pull/36/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![qkaiser](https://avatars.githubusercontent.com/u/569494?s=60&v=4)](/qkaiser)

Copy link

Collaborator

### @qkaiser **[qkaiser](/qkaiser)** commented [Feb 28, 2022](#issue-1153940469)

We worked on our own fork on a few issues and battle tested our version of jefferson against a long list of JFFS2 firmwares. This PR is the product of our improvements.

It includes:

* automatic detection of endianness
* handling of decompression error on corrupted filesystems (fix [TypeError: Error while decompressing: 1 #21](https://github.com/sviehb/jefferson/issues/21) and [zlib.error: Error -5 while decompressing data: incomplete or truncated stream #19](https://github.com/sviehb/jefferson/issues/19))
* execution speedup by using memory mapped files (fix [Why is jefferson so slow? #27](https://github.com/sviehb/jefferson/issues/27) , see [Significant speedup for large filesystems and minimizing physical memory usage #28](https://github.com/sviehb/jefferson/pull/28))
* added support for legacy signature of JFFS2 (`0x1984`)
* added support for LZO compression (see [LZO support #13](https://github.com/sviehb/jefferson/pull/13))
* move cstruct to cstruct 2.1 (fix [Updated cstruct does not successfully extract the firmware #33](https://github.com/sviehb/jefferson/issues/33) , see [update requirements.txt #34](https://github.com/sviehb/jefferson/pull/34) and [Fix cstruct v2.1 support #35](https://github.com/sviehb/jefferson/pull/35))
* a fix to protect against path traversals that would make jefferson write outside of the extraction directory

Sorry, something went wrong.

 ❤️
1
 AndrewFasano reacted with heart emoji

All reactions

* ❤️
  1 reaction

 [qkaiser](/qkaiser)
and others
added 15 commits
[January 5, 2022 12:08](#commits-pushed-fc9079f)

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Fix set_endianness to support cstruct version 2.1.](/sviehb/jefferson/pull/36/commits/fc9079f7470e94ad3d89b9c19790fe3b48afedd3 "Fix set_endianness to support cstruct version 2.1.

Modifications in cstruct API between v1.8 and v2.1 broke jefferson due to the removal of __fmt__ field in CStruct meta classes.

We fixed it by rebuilding classes dynamically using the expected endianness.")`
 …

`[fc9079f](/sviehb/jefferson/pull/36/commits/fc9079f7470e94ad3d89b9c19790fe3b48afedd3)`

```
Modifications in cstruct API between v1.8 and v2.1 broke jefferson due to the removal of __fmt__ field in CStruct meta classes.

We fixed it by rebuilding classes dynamically using the expected endianness.
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[pin cstruct version to 2.1 so we don't end up with breaking API chang…](/sviehb/jefferson/pull/36/commits/39c8f63e90ff8e9be8f9d149ea246e90ea5dd8c9 "pin cstruct version to 2.1 so we don't end up with breaking API changes in the future. Moving to more recent versions should be done manually once it's been tested that jefferson still works with the newly released version of cstruct.")`
 …

`[39c8f63](/sviehb/jefferson/pull/36/commits/39c8f63e90ff8e9be8f9d149ea246e90ea5dd8c9)`

```
…es in the future. Moving to more recent versions should be done manually once it's been tested that jefferson still works with the newly released version of cstruct.
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Merge pull request](/sviehb/jefferson/pull/36/commits/3732ecb1a934ca3a5446bf6f6ddebd94552ca791 "Merge pull request #1 from IoT-Inspector/fix-cstruct

cstruct v2.1 support") [#1](https://github.com/onekey-sec/jefferson/pull/1) [from IoT-Inspector/fix-cstruct](/sviehb/jefferson/pull/36/commits/3732ecb1a934ca3a5446bf6f6ddebd94552ca791 "Merge pull request #1 from IoT-Inspector/fix-cstruct

cstruct v2.1 support")`
 …

`[3732ecb](/sviehb/jefferson/pull/36/commits/3732ecb1a934ca3a5446bf6f6ddebd94552ca791)`

```
cstruct v2.1 support
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Add support for JFFS2 old magic signature (0x1984).](/sviehb/jefferson/pull/36/commits/5a54ddbf73e0efbd5621899402955ac15b278b7e "Add support for JFFS2 old magic signature (0x1984).")`

`[5a54ddb](/sviehb/jefferson/pull/36/commits/5a54ddbf73e0efbd5621899402955ac15b278b7e)`

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Merge pull request](/sviehb/jefferson/pull/36/commits/d797a3926ffcbcd27042ae74dbdf1b4eac72e845 "Merge pull request #2 from IoT-Inspector/add-legacy-magic

Add support for JFFS2 old magic signature (0x1984).") [#2](https://github.com/onekey-sec/jefferson/pull/2) [from IoT-Inspector/add-legacy-magic](/sviehb/jefferson/pull/36/commits/d797a3926ffcbcd27042ae74dbdf1b4eac72e845 "Merge pull request #2 from IoT-Inspector/add-legacy-magic

Add support for JFFS2 old magic signature (0x1984).")`
 …

`[d797a39](/sviehb/jefferson/pull/36/commits/d797a3926ffcbcd27042ae74dbdf1b4eac72e845)`

```
Add support for JFFS2 old magic signature (0x1984).
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Autodetect endianness rather than scan the filesystem twice, one for …](/sviehb/jefferson/pull/36/commits/d5225e01943e10860ac265d5794cab48cccec683 "Autodetect endianness rather than scan the filesystem twice, one for each possible endianness. We make the assumption that a JFFS2 has always a fixed endianness and that nodes won't switch between endianness in the middle of a filesystem.")`
 …

`[d5225e0](/sviehb/jefferson/pull/36/commits/d5225e01943e10860ac265d5794cab48cccec683)`

```
…each possible endianness. We make the assumption that a JFFS2 has always a fixed endianness and that nodes won't switch between endianness in the middle of a filesystem.
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Merge pull request](/sviehb/jefferson/pull/36/commits/216eee6c56d338e5a14a0af5d07f1117cff92b3b "Merge pull request #3 from IoT-Inspector/fix-autodetect-endianness

Autodetect endianness") [#3](https://github.com/onekey-sec/jefferson/pull/3) [from IoT-Inspector/fix-autodetect-endianness](/sviehb/jefferson/pull/36/commits/216eee6c56d338e5a14a0af5d07f1117cff92b3b "Merge pull request #3 from IoT-Inspector/fix-autodetect-endianness

Autodetect endianness")`
 …

`[216eee6](/sviehb/jefferson/pull/36/commits/216eee6c56d338e5a14a0af5d07f1117cff92b3b)`

```
Autodetect endianness
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Fix path traversal security vulnerability by canonicalizing path name…](/sviehb/jefferson/pull/36/commits/53b3f2fc34af0bb32afbcee29d18213e61471d87 "Fix path traversal security vulnerability by canonicalizing path names of every inodes and discarding inodes with a path
pointing outside of the extraction directory.

Fix path traversal through symlinks by canonicalizing link target path using the extraction directory as root. If the link
still points outside the extraction root, it gets discarded. This way symlinks reflects the reality of a filesystem on device
by pointing to files within the extracted filesystem instead of files from the host executing jefferson.")`
 …

`[53b3f2f](/sviehb/jefferson/pull/36/commits/53b3f2fc34af0bb32afbcee29d18213e61471d87)`

```
…s of every inodes and discarding inodes with a path

pointing outside of the extraction directory.

Fix path traversal through symlinks by canonicalizing link target path using the extraction directory as root. If the link
still points outside the extraction root, it gets discarded. This way symlinks reflects the reality of a filesystem on device
by pointing to files within the extracted filesystem instead of files from the host executing jefferson.
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Merge pull request](/sviehb/jefferson/pull/36/commits/41f654eac078cfec240428be457c054613a80851 "Merge pull request #4 from IoT-Inspector/fix-path-traversal

Fix path traversals") [#4](https://github.com/onekey-sec/jefferson/pull/4) [from IoT-Inspector/fix-path-traversal](/sviehb/jefferson/pull/36/commits/41f654eac078cfec240428be457c054613a80851 "Merge pull request #4 from IoT-Inspector/fix-path-traversal

Fix path traversals")`
 …

`[41f654e](/sviehb/jefferson/pull/36/commits/41f654eac078cfec240428be457c054613a80851)`

```
Fix path traversals
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Revert the symlink path traversal check as it does not present a dire…](/sviehb/jefferson/pull/36/commits/8aab4cdc3f27310df3f21bf5434678cc3b17817e "Revert the symlink path traversal check as it does not present a direct risk to normal end users. Those checks can be implemented by other tools where required.")`
 …

`[8aab4cd](/sviehb/jefferson/pull/36/commits/8aab4cdc3f27310df3f21bf5434678cc3b17817e)`

```
…ct risk to normal end users. Those checks can be implemented by other tools where required.
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Add support for LZO compression.](/sviehb/jefferson/pull/36/commits/c6c7b4c281942bfdad061dd698501fd243ce8f2d "Add support for LZO compression.")`

`[c6c7b4c](/sviehb/jefferson/pull/36/commits/c6c7b4c281942bfdad061dd698501fd243ce8f2d)`

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Memory-mapped file support](/sviehb/jefferson/pull/36/commits/27bdc0a9713bea2b478ebc84abc9f0121ad357af "Memory-mapped file support

Moved to mmap in order to reduce the overall memory usage and increase
processing speed for large filesystems.")`
 …

`[27bdc0a](/sviehb/jefferson/pull/36/commits/27bdc0a9713bea2b478ebc84abc9f0121ad357af)`

```
Moved to mmap in order to reduce the overall memory usage and increase
processing speed for large filesystems.
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Merge pull request](/sviehb/jefferson/pull/36/commits/b7a52545f607e371e57ff438fd6ff4394e1e378d "Merge pull request #7 from IoT-Inspector/feat-mmap-speedup

Memory-mapped file support") [#7](https://github.com/onekey-sec/jefferson/pull/7) [from IoT-Inspector/feat-mmap-speedup](/sviehb/jefferson/pull/36/commits/b7a52545f607e371e57ff438fd6ff4394e1e378d "Merge pull request #7 from IoT-Inspector/feat-mmap-speedup

Memory-mapped file support")`
 …

`[b7a5254](/sviehb/jefferson/pull/36/commits/b7a52545f607e371e57ff438fd6ff4394e1e378d)`

```
Memory-mapped file support
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Better handling of decompression error + simpler endianness logging.](/sviehb/jefferson/pull/36/commits/7e2a1657e0191531ef6c016bff8e1dad02f4926d "Better handling of decompression error + simpler endianness logging.")`

`[7e2a165](/sviehb/jefferson/pull/36/commits/7e2a1657e0191531ef6c016bff8e1dad02f4926d)`

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser)

`[Merge pull request](/sviehb/jefferson/pull/36/commits/867a2c76309be26b6c91fa9af121d27bdee8a281 "Merge pull request #8 from IoT-Inspector/fix-zlib-error

Better handling of decompression error + simpler endianness logging.") [#8](https://github.com/onekey-sec/jefferson/pull/8) [from IoT-Inspector/fix-zlib-error](/sviehb/jefferson/pull/36/commits/867a2c76309be26b6c91fa9af121d27bdee8a281 "Merge pull request #8 from IoT-Inspector/fix-zlib-error

Better handling of decompression error + simpler endianness logging.")`
 …

`[867a2c7](/sviehb/jefferson/pull/36/commits/867a2c76309be26b6c91fa9af121d27bdee8a281)`

```
Better handling of decompression error + simpler endianness logging.
```

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&u=e3e38a72510b4dfa037b8083ea44755cb8e5b7be&v=4)](/qkaiser)
[qkaiser](/qkaiser)
added
[bug](/sviehb/jefferson/labels/bug)
[enhancement](/sviehb/jefferson/labels/enhancement)
labels
[Feb 28, 2022](#event-6153794647)

 [![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&u=e3e38a72510b4dfa037b8083ea44755cb8e5b7be&v=4)](/qkaiser)
[qkaiser](/qkaiser)
requested a review
from [sviehb](/sviehb)
[February 28, 2022 10:54](#event-6153794664)

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&u=e3e38a72510b4dfa037b8083ea44755cb8e5b7be&v=4)](/qkaiser)
[qkaiser](/qkaiser)
self-assigned this
[Feb 28, 2022](#event-6153794699)

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&u=e3e38a72510b4dfa037b8083ea44755cb8e5b7be&v=4)](/qkaiser)
[qkaiser](/qkaiser)
merged commit [`c09ef78`](/sviehb/jefferson/commit/c09ef78bb85f7e2f1308328150e5bbfc2bc39e03)
into
sviehb:master

[Feb 28, 2022](https://github.com/sviehb/jefferson/pull/36#event-6153848771)

This was referenced Feb 28, 2022

[LZO support
#13](/sviehb/jefferson/pull/13)
 Closed

[update requirements.txt
#34](/sviehb/jefferson/pull/34)
 Closed

[Significant speedup for large filesystems and minimizing physical memory usage
#28](/sviehb/jefferson/pull/28)
 Closed

[zlib.error: Error -5 while decompressing data: incomplete or truncated stream
#19](/sviehb/jefferson/issues/19)

Closed

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=80&u=e3e38a72510b4dfa037b8083ea44755cb8e5b7be&v=4)](/qkaiser)

Copy link

Collaborator

Author

### **[qkaiser](/qkaiser)** commented [Jan 31, 2023](#issuecomment-1410064020)

| [@sviehb](https://github.com/sviehb) we have an upcoming publication about similar vulnerabilities affecting different extractors in ubi-reader, jefferson, yaffshiv, and binwalk. We requested CVEs for each of these vulnerability so that users are aware they should upgrade to the latest version (through dependabot for example).  The one that was fixed in jefferson is [CVE-2023-0592](https://github.com/advisories/GHSA-p5gc-65fr-7vfc "CVE-2023-0592"), you're credited as remediation reviewer :) |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsviehb%2Fjefferson%2Fpull%2F36)

Reviewers

[![@sviehb](https://avatars.githubusercontent.com/u/1294980?s=40&v=4)](/sviehb) [sviehb](/sviehb)

 Awaiting requested review from sviehb

Assignees

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)](/qkaiser) [qkaiser](/qkaiser)

Labels

[bug](/sviehb/jefferson/labels/bug)
[enhancement](/sviehb/jefferson/labels/enhancement)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [Updated cstruct does not successfully extract the firmware](https://github.com/sviehb/jefferson/issues/33)

 [Why is jefferson so slow?](https://github.com/sviehb/jefferson/issues/27)

 [TypeError: Error while decompressing: 1](https://github.com/sviehb/jefferson/issues/21)

1 participant

[![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=52&v=4)](/qkaiser)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4e32dadd_20250114_182857.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsviehb%2Fjefferson%2Freleases%2Ftag%2Fv0.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsviehb%2Fjefferson%2Freleases%2Ftag%2Fv0.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=sviehb%2Fjefferson)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sviehb](/sviehb)
/
**[jefferson](/sviehb/jefferson)**
Public

* [Notifications](/login?return_to=%2Fsviehb%2Fjefferson) You must be signed in to change notification settings
* [Fork
  121](/login?return_to=%2Fsviehb%2Fjefferson)
* [Star
   328](/login?return_to=%2Fsviehb%2Fjefferson)

* [Code](/sviehb/jefferson/tree/v0.4)
* [Issues
  3](/sviehb/jefferson/issues)
* [Pull requests
  0](/sviehb/jefferson/pulls)
* [Actions](/sviehb/jefferson/actions)
* [Projects
  0](/sviehb/jefferson/projects)
* [Wiki](/sviehb/jefferson/wiki)
* [Security](/sviehb/jefferson/security)
* [Insights](/sviehb/jefferson/pulse)

Additional navigation options

* [Code](/sviehb/jefferson/tree/v0.4)
* [Issues](/sviehb/jefferson/issues)
* [Pull requests](/sviehb/jefferson/pulls)
* [Actions](/sviehb/jefferson/actions)
* [Projects](/sviehb/jefferson/projects)
* [Wiki](/sviehb/jefferson/wiki)
* [Security](/sviehb/jefferson/security)
* [Insights](/sviehb/jefferson/pulse)

1. [Releases](/sviehb/jefferson/releases)
2. [v0.4](/sviehb/jefferson/releases/tag/v0.4)

# v0.4 release

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/sviehb/jefferson/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.4)

 Loading

[View all tags](/sviehb/jefferson/tags)

![@qkaiser](https://avatars.githubusercontent.com/u/569494?s=40&v=4)
[qkaiser](/qkaiser)
released this
23 Jun 06:46

·
[4 commits](/sviehb/jefferson/compare/v0.4...master)
to master
since this release

[v0.4](/sviehb/jefferson/tree/v0.4)

[`361c6e3`](/sviehb/jefferson/commit/361c6e38684bfb24e612e52726cf38c02bd2c9cc)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

Overdue release with a bunch of fixes since we started maintaining this repo.

The following improvements are part of version 0.4:

* automatic detection of endianness
* handling of decompression error on corrupted filesystems (fix [#21](https://github.com/sviehb/jefferson/issues/21) and [#19](https://github.com/sviehb/jefferson/issues/19))
* execution speedup by using memory mapped files (fix [#27](https://github.com/sviehb/jefferson/issues/27) , see [#28](https://github.com/sviehb/jefferson/pull/28))
* added support for legacy signature of JFFS2 (0x1984)
* added support for LZO compression (see [#13](https://github.com/sviehb/jefferson/pull/13))
* move cstruct to cstruct 2.1 (fix [#33](https://github.com/sviehb/jefferson/issues/33) , see [#34](https://github.com/sviehb/jefferson/pull/34) and [#35](https://github.com/sviehb/jefferson/pull/35))
* a fix to protect against path traversals that would make jefferson write outside of the extraction directory
* support for Python 3.10
* proper handling of inode versioning

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


