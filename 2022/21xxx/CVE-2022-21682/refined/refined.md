```
{
  "CVE-2022-21682": {
    "Description": "The `flatpak-builder` applies `finish-args` last in the build, which allows the build directory to have full access specified in the manifest. If the `--mirror-screenshots-url` option is specified, `flatpak-builder` launches `flatpak build --nofilesystem=host appstream-utils mirror-screenshots` after finalization. This can lead to issues even with the `--nofilesystem=host` protection. The `--nofilesystem=host` only overrides access to the full host, and the app can still request access to specific directories, like `--filesystem=~/some-dir`, which is not affected by this. Also, if a filesystem is specified like `--filesystem=~/foobar:create`, then that directory will be created before running the command.",
    "Root cause": "`flatpak-builder`'s use of `flatpak build` with insufficient isolation, specifically when using the `--mirror-screenshots-url` option, which bypasses expected filesystem restrictions.",
    "Weaknesses": [
      "Insufficient isolation of build environment during screenshot mirroring.",
      "Inadequate restrictions on filesystem access when using `--nofilesystem=host` in combination with `--mirror-screenshots-url`.",
       "Ability to create directories outside the intended scope via the `:create` flag combined with the mirroring operation."
    ],
    "Impact": "A malicious application could replace the `appstream-util` binary and potentially perform hostile actions, and create directories in locations where the user has write permissions.",
    "Attack vectors": "By exploiting the `--mirror-screenshots-url` option of `flatpak-builder` with a crafted manifest that specifies additional filesystem access.",
     "Required attacker capabilities/position": "Attacker needs to provide a malicious application with a crafted manifest to be built using `flatpak-builder`, targeting a vulnerable version of flatpak."
  }
}
```