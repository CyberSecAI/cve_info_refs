=== Content from github.com_e656c306_20250114_225411.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyter-server-proxy%2Fcommit%2Ffd31930bacd12188c448c886e0783529436b99eb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyter-server-proxy%2Fcommit%2Ffd31930bacd12188c448c886e0783529436b99eb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jupyterhub%2Fjupyter-server-proxy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jupyterhub](/jupyterhub)
/
**[jupyter-server-proxy](/jupyterhub/jupyter-server-proxy)**
Public

* [Notifications](/login?return_to=%2Fjupyterhub%2Fjupyter-server-proxy) You must be signed in to change notification settings
* [Fork
  147](/login?return_to=%2Fjupyterhub%2Fjupyter-server-proxy)
* [Star
   354](/login?return_to=%2Fjupyterhub%2Fjupyter-server-proxy)

* [Code](/jupyterhub/jupyter-server-proxy)
* [Issues
  73](/jupyterhub/jupyter-server-proxy/issues)
* [Pull requests
  11](/jupyterhub/jupyter-server-proxy/pulls)
* [Actions](/jupyterhub/jupyter-server-proxy/actions)
* [Projects
  0](/jupyterhub/jupyter-server-proxy/projects)
* [Security](/jupyterhub/jupyter-server-proxy/security)
* [Insights](/jupyterhub/jupyter-server-proxy/pulse)

Additional navigation options

* [Code](/jupyterhub/jupyter-server-proxy)
* [Issues](/jupyterhub/jupyter-server-proxy/issues)
* [Pull requests](/jupyterhub/jupyter-server-proxy/pulls)
* [Actions](/jupyterhub/jupyter-server-proxy/actions)
* [Projects](/jupyterhub/jupyter-server-proxy/projects)
* [Security](/jupyterhub/jupyter-server-proxy/security)
* [Insights](/jupyterhub/jupyter-server-proxy/pulse)

## Commit

[Permalink](/jupyterhub/jupyter-server-proxy/commit/fd31930bacd12188c448c886e0783529436b99eb)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-gcv9-6737-pjqw](https://github.com/advisories/GHSA-gcv9-6737-pjqw "GHSA-gcv9-6737-pjqw")

[Browse files](/jupyterhub/jupyter-server-proxy/tree/fd31930bacd12188c448c886e0783529436b99eb)
Browse the repository at this point in the history

```
validate proxied paths starting with /
```

* Loading branch information

[![@manics](https://avatars.githubusercontent.com/u/1644105?s=40&v=4)](/manics)

[manics](/jupyterhub/jupyter-server-proxy/commits?author=manics "View all commits by manics")
authored
Jan 24, 2022

2 parents
[8610a3b](/jupyterhub/jupyter-server-proxy/commit/8610a3bca22f913467e2dbfac8aee2ab6ba5648f)
+
[61bad15](/jupyterhub/jupyter-server-proxy/commit/61bad1500076f368d188fd1ef1a86a18aace4a1b)

commit fd31930

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**97 additions**
and
**48 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* jupyter\_server\_proxy

  + jupyter\_server\_proxy/handlers.py
    [handlers.py](#diff-4bfb13c317f317ead8af97306316323a86a9858508b71097c4bd7d15b2d94ea8)
* tests

  + tests/test\_proxies.py
    [test\_proxies.py](#diff-54445e12be52280fd148585909a47eae3cedcf581e315eda4b1f54e2c8ad24d7)

## There are no files selected for viewing

22 changes: 22 additions & 0 deletions

22
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/jupyterhub/jupyter-server-proxy/blob/fd31930bacd12188c448c886e0783529436b99eb/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,5 +1,27 @@ |
|  |  | ## 3.2 |
|  |  |  |
|  |  | ### 3.2.1 - 2022-01-24 |
|  |  |  |
|  |  | 3.2.1 is a security release, fixing a vulnerability [GHSA-gcv9-6737-pjqw](https://github.com/jupyterhub/jupyter-server-proxy/security/advisories/GHSA-gcv9-6737-pjqw) where `allowed\_hosts` were not validated correctly. |
|  |  |  |
|  |  | ## Maintenance and upkeep improvements |
|  |  |  |
|  |  | - Modernize docs without making changes to its content [#313](https://github.com/jupyterhub/jupyter-server-proxy/pull/313) ([@consideRatio](https://github.com/consideRatio)) |
|  |  | - Remove no longer needed logic involving six [#312](https://github.com/jupyterhub/jupyter-server-proxy/pull/312) ([@consideRatio](https://github.com/consideRatio)) |
|  |  | - Update language, from master to main [#311](https://github.com/jupyterhub/jupyter-server-proxy/pull/311) ([@consideRatio](https://github.com/consideRatio)) |
|  |  |  |
|  |  | ## Other merged PRs |
|  |  |  |
|  |  | - Remove empty JupyterLab style [#314](https://github.com/jupyterhub/jupyter-server-proxy/pull/314) ([@bollwyvl](https://github.com/bollwyvl)) |
|  |  | - ci: avoid triggering ci twice on pre-commit.ci/dependabot prs [#310](https://github.com/jupyterhub/jupyter-server-proxy/pull/310) ([@consideRatio](https://github.com/consideRatio)) |
|  |  |  |
|  |  | ## Contributors to this release |
|  |  |  |
|  |  | ([GitHub contributors page for this release](https://github.com/jupyterhub/jupyter-server-proxy/graphs/contributors?from=2021-11-29&to=2022-01-19&type=c)) |
|  |  |  |
|  |  | [@bollwyvl](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyter-server-proxy+involves%3Abollwyvl+updated%3A2021-11-29..2022-01-19&type=Issues) | [@consideRatio](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyter-server-proxy+involves%3AconsideRatio+updated%3A2021-11-29..2022-01-19&type=Issues) | [@welcome](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyter-server-proxy+involves%3Awelcome+updated%3A2021-11-29..2022-01-19&type=Issues) | [@yuvipanda](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyter-server-proxy+involves%3Ayuvipanda+updated%3A2021-11-29..2022-01-19&type=Issues) |
|  |  |  |
|  |  |  |
|  |  | ### 3.2.0 - 2021-11-29 |
|  |  |  |
|  |  | #### New features added |
| Expand Down | |  |

105 changes: 57 additions & 48 deletions

105
[jupyter\_server\_proxy/handlers.py](#diff-4bfb13c317f317ead8af97306316323a86a9858508b71097c4bd7d15b2d94ea8 "jupyter_server_proxy/handlers.py")

Show comments

[View file](/jupyterhub/jupyter-server-proxy/blob/fd31930bacd12188c448c886e0783529436b99eb/jupyter_server_proxy/handlers.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -209,12 +209,16 @@ def \_get\_context\_path(self, host, port): |
|  |  | return url\_path\_join(self.base\_url, 'proxy', host\_and\_port) |
|  |  |  |
|  |  | def get\_client\_uri(self, protocol, host, port, proxied\_path): |
|  |  | context\_path = self.\_get\_context\_path(host, port) |
|  |  | if self.absolute\_url: |
|  |  | context\_path = self.\_get\_context\_path(host, port) |
|  |  | client\_path = url\_path\_join(context\_path, proxied\_path) |
|  |  | else: |
|  |  | client\_path = proxied\_path |
|  |  |  |
|  |  | # ensure client\_path always starts with '/' |
|  |  | if not client\_path.startswith("/"): |
|  |  | client\_path = "/" + client\_path |
|  |  |  |
|  |  | # Quote spaces, åäö and such, but only enough to send a valid web |
|  |  | # request onwards. To do this, we mark the RFC 3986 specs' "reserved" |
|  |  | # and "un-reserved" characters as safe that won't need quoting. The |
| Expand All | | @@ -228,7 +232,7 @@ def get\_client\_uri(self, protocol, host, port, proxied\_path): |
|  |  | protocol=protocol, |
|  |  | host=host, |
|  |  | port=port, |
|  |  | path=client\_path |
|  |  | path=client\_path, |
|  |  | ) |
|  |  | if self.request.query: |
|  |  | client\_uri += '?' + self.request.query |
| Expand Down  Expand Up | | @@ -297,13 +301,14 @@ async def proxy(self, host, port, proxied\_path): |
|  |  | client = httpclient.AsyncHTTPClient() |
|  |  |  |
|  |  | req = self.\_build\_proxy\_request(host, port, proxied\_path, body) |
|  |  | self.log.debug(f"Proxying request to {req.url}") |
|  |  |  |
|  |  | try: |
|  |  | # Here, "response" is a tornado.httpclient.HTTPResponse object. |
|  |  | response = await client.fetch(req, raise\_error=False) |
|  |  | except httpclient.HTTPError as err: |
|  |  | # We need to capture the timeout error even with raise\_error=False, |
|  |  | # because it only affects the HTTPError raised when a non-200 response |
|  |  | # because it only affects the HTTPError raised when a non-200 response |
|  |  | # code is used, instead of suppressing all errors. |
|  |  | # Ref: https://www.tornadoweb.org/en/stable/httpclient.html#tornado.httpclient.AsyncHTTPClient.fetch |
|  |  | if err.code == 599: |
| Expand All | | @@ -324,7 +329,7 @@ async def proxy(self, host, port, proxied\_path): |
|  |  | else: |
|  |  | # Represent the original response as a RewritableResponse object. |
|  |  | original\_response = RewritableResponse(orig\_response=response) |
|  |  |  |
|  |  |  |
|  |  | # The function (or list of functions) which should be applied to modify the |
|  |  | # response. |
|  |  | rewrite\_response = self.rewrite\_response |
| Expand Down  Expand Up | | @@ -688,53 +693,57 @@ def options(self, path): |
|  |  | def setup\_handlers(web\_app, serverproxy\_config): |
|  |  | host\_allowlist = serverproxy\_config.host\_allowlist |
|  |  | rewrite\_response = serverproxy\_config.non\_service\_rewrite\_response |
|  |  | web\_app.add\_handlers('.\*', [ |
|  |  | ( |
|  |  | url\_path\_join( |
|  |  | web\_app.settings['base\_url'], |
|  |  | r'/proxy/([^/]\*):(\d+)(.\*)', |
|  |  | web\_app.add\_handlers( |
|  |  | ".\*", |
|  |  | [ |
|  |  | ( |
|  |  | url\_path\_join( |
|  |  | web\_app.settings["base\_url"], |
|  |  | r"/proxy/([^/:@]+):(\d+)(/.\*|)", |
|  |  | ), |
|  |  | RemoteProxyHandler, |
|  |  | { |
|  |  | "absolute\_url": False, |
|  |  | "host\_allowlist": host\_allowlist, |
|  |  | "rewrite\_response": rewrite\_response, |
|  |  | }, |
|  |  | ), |
|  |  | RemoteProxyHandler, |
|  |  | { |
|  |  | 'absolute\_url': False, |
|  |  | 'host\_allowlist': host\_allowlist, |
|  |  | 'rewrite\_response': rewrite\_response, |
|  |  | } |
|  |  | ), |
|  |  | ( |
|  |  | url\_path\_join( |
|  |  | web\_app.settings['base\_url'], |
|  |  | r'/proxy/absolute/([^/]\*):(\d+)(.\*)', |
|  |  | ( |
|  |  | url\_path\_join( |
|  |  | web\_app.settings["base\_url"], |
|  |  | r"/proxy/absolute/([^/:@]+):(\d+)(/.\*|)", |
|  |  | ), |
|  |  | RemoteProxyHandler, |
|  |  | { |
|  |  | "absolute\_url": True, |
|  |  | "host\_allowlist": host\_allowlist, |
|  |  | "rewrite\_response": rewrite\_response, |
|  |  | }, |
|  |  | ), |
|  |  | RemoteProxyHandler, |
|  |  | { |
|  |  | 'absolute\_url': True, |
|  |  | 'host\_allowlist': host\_allowlist, |
|  |  | 'rewrite\_response': rewrite\_response, |
|  |  | } |
|  |  | ), |
|  |  | ( |
|  |  | url\_path\_join( |
|  |  | web\_app.settings['base\_url'], |
|  |  | r'/proxy/(\d+)(.\*)', |
|  |  | ( |
|  |  | url\_path\_join( |
|  |  | web\_app.settings["base\_url"], |
|  |  | r"/proxy/(\d+)(/.\*|)", |
|  |  | ), |
|  |  | LocalProxyHandler, |
|  |  | { |
|  |  | "absolute\_url": False, |
|  |  | "rewrite\_response": rewrite\_response, |
|  |  | }, |
|  |  | ), |
|  |  | LocalProxyHandler, |
|  |  | { |
|  |  | 'absolute\_url': False, |
|  |  | 'rewrite\_response': rewrite\_response, |
|  |  | }, |
|  |  | ), |
|  |  | ( |
|  |  | url\_path\_join( |
|  |  | web\_app.settings['base\_url'], |
|  |  | r'/proxy/absolute/(\d+)(.\*)', |
|  |  | ( |
|  |  | url\_path\_join( |
|  |  | web\_app.settings["base\_url"], |
|  |  | r"/proxy/absolute/(\d+)(/.\*|)", |
|  |  | ), |
|  |  | LocalProxyHandler, |
|  |  | { |
|  |  | "absolute\_url": True, |
|  |  | "rewrite\_response": rewrite\_response, |
|  |  | }, |
|  |  | ), |
|  |  | LocalProxyHandler, |
|  |  | { |
|  |  | 'absolute\_url': True, |
|  |  | 'rewrite\_response': rewrite\_response, |
|  |  | }, |
|  |  | ), |
|  |  | ]) |
|  |  | ], |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | # vim: set et ts=4 sw=4: |

18 changes: 18 additions & 0 deletions

18
[tests/test\_proxies.py](#diff-54445e12be52280fd148585909a47eae3cedcf581e315eda4b1f54e2c8ad24d7 "tests/test_proxies.py")

Show comments

[View file](/jupyterhub/jupyter-server-proxy/blob/fd31930bacd12188c448c886e0783529436b99eb/tests/test_proxies.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -291,3 +291,21 @@ async def \_websocket\_subprotocols(): |
|  |  | def test\_server\_proxy\_websocket\_subprotocols(event\_loop): |
|  |  | event\_loop.run\_until\_complete(\_websocket\_subprotocols()) |
|  |  |  |
|  |  | @pytest.mark.parametrize( |
|  |  | "proxy\_path, status", |
|  |  | [ |
|  |  | ("127.0.0.1", 404), |
|  |  | ("127.0.0.1/path", 404), |
|  |  | ("127.0.0.1@192.168.1.1", 404), |
|  |  | ("127.0.0.1@192.168.1.1/path", 404), |
|  |  | ("user:pass@host:123/foo", 403), |
|  |  | ("user:pass@host/foo", 404), |
|  |  | ("absolute/127.0.0.1:123@192.168.1.1/path", 404), |
|  |  | ] |
|  |  | ) |
|  |  | def test\_bad\_server\_proxy\_url(proxy\_path, status): |
|  |  | r = request\_get(PORT, f"/proxy/{proxy\_path}", TOKEN) |
|  |  | assert r.code == status |
|  |  | if status >= 400: |
|  |  | # request should not have been proxied |
|  |  | assert 'X-ProxyContextPath' not in r.headers |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fd31930`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyter-server-proxy%2Fcommit%2Ffd31930bacd12188c448c886e0783529436b99eb) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2fe5e28c_20250114_225414.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyter-server-proxy%2Fsecurity%2Fadvisories%2FGHSA-gcv9-6737-pjqw)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyter-server-proxy%2Fsecurity%2Fadvisories%2FGHSA-gcv9-6737-pjqw)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=jupyterhub%2Fjupyter-server-proxy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jupyterhub](/jupyterhub)
/
**[jupyter-server-proxy](/jupyterhub/jupyter-server-proxy)**
Public

* [Notifications](/login?return_to=%2Fjupyterhub%2Fjupyter-server-proxy) You must be signed in to change notification settings
* [Fork
  147](/login?return_to=%2Fjupyterhub%2Fjupyter-server-proxy)
* [Star
   354](/login?return_to=%2Fjupyterhub%2Fjupyter-server-proxy)

* [Code](/jupyterhub/jupyter-server-proxy)
* [Issues
  73](/jupyterhub/jupyter-server-proxy/issues)
* [Pull requests
  11](/jupyterhub/jupyter-server-proxy/pulls)
* [Actions](/jupyterhub/jupyter-server-proxy/actions)
* [Projects
  0](/jupyterhub/jupyter-server-proxy/projects)
* [Security](/jupyterhub/jupyter-server-proxy/security)
* [Insights](/jupyterhub/jupyter-server-proxy/pulse)

Additional navigation options

* [Code](/jupyterhub/jupyter-server-proxy)
* [Issues](/jupyterhub/jupyter-server-proxy/issues)
* [Pull requests](/jupyterhub/jupyter-server-proxy/pulls)
* [Actions](/jupyterhub/jupyter-server-proxy/actions)
* [Projects](/jupyterhub/jupyter-server-proxy/projects)
* [Security](/jupyterhub/jupyter-server-proxy/security)
* [Insights](/jupyterhub/jupyter-server-proxy/pulse)

# SSRF vulnerability (requires authentication)

Moderate

[manics](/manics)
published
GHSA-gcv9-6737-pjqw
Jan 24, 2022

## Package

pip

jupyter-server-proxy
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<= 3.2.0

## Patched versions

3.2.1

## Description

### Impact

**What kind of vulnerability is it?** Server-Side Request Forgery ( SSRF )

**Who is impacted?** Any user deploying Jupyter Server or Notebook with jupyter-proxy-server extension enabled.

A lack of input validation allowed authenticated clients to proxy requests to other hosts, bypassing the `allowed_hosts` check. Because authentication is required, which already grants permissions to make the same requests via kernel or terminal execution, this is considered low to moderate severity.

### Patches

*Has the problem been patched? What versions should users upgrade to?*

Upgrade to 3.2.1, or apply the patch <https://github.com/jupyterhub/jupyter-server-proxy/compare/v3.2.0...v3.2.1.patch>

### For more information

If you have any questions or comments about this advisory:

* Open a topic [on our forum](https://discourse.jupyter.org)
* Email the Jupyter security team at security@ipython.org

### Severity

Moderate

6.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:L/A:N

### CVE ID

CVE-2022-21697

### Weaknesses

[CWE-918](/advisories?query=cwe%3A918)

### Credits

* [![@mr-r3bot](https://avatars.githubusercontent.com/u/37280106?s=40&v=4)](/mr-r3bot)
  [mr-r3bot](/mr-r3bot)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_cfc34a38_20250114_225412.html ===
From 510ea4d9f3858e64acf4170d9aa8f70ff875523c Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 00:09:33 +0100
Subject: [PATCH 01/17] ci: avoid triggering ci twice on
pre-commit.ci/dependabot prs
---
.github/workflows/publish.yaml | 24 ++++++++++++++++++++++-
.github/workflows/test.yaml | 35 +++++++++++++++++-----------------
2 files changed, 41 insertions(+), 18 deletions(-)
diff --git a/.github/workflows/publish.yaml b/.github/workflows/publish.yaml
index b12903f8..f7dc5bac 100644
--- a/.github/workflows/publish.yaml
+++ b/.github/workflows/publish.yaml
@@ -1,8 +1,30 @@
+# This is a GitHub workflow defining a set of jobs with a set of steps.
+# ref: https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions
+#
# Publish PyPI and NPM artifacts
+#
name: Publish
+
on:
- push:
pull\_request:
+ paths-ignore:
+ - "docs/\*\*"
+ - "contrib/\*\*"
+ - "\*\*.md"
+ - "\*\*.rst"
+ - ".github/workflows/\*"
+ - "!.github/workflows/publish.yaml"
+ push:
+ paths-ignore:
+ - "docs/\*\*"
+ - "contrib/\*\*"
+ - "\*\*.md"
+ - "\*\*.rst"
+ - ".github/workflows/\*"
+ - "!.github/workflows/publish.yaml"
+ branches-ignore:
+ - "dependabot/\*\*"
+ - "pre-commit-ci-update-config"
workflow\_dispatch:
jobs:
diff --git a/.github/workflows/test.yaml b/.github/workflows/test.yaml
index 2c2f4e3a..78770cf1 100644
--- a/.github/workflows/test.yaml
+++ b/.github/workflows/test.yaml
@@ -1,29 +1,30 @@
# This is a GitHub workflow defining a set of jobs with a set of steps.
-# ref: https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions
+# ref: https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions
#
name: Test
-# Trigger the workflow's on all PRs but only on pushed tags or commits to
-# main/master branch to avoid PRs developed in a GitHub fork's dedicated branch
-# to trigger.
on:
pull\_request:
+ paths-ignore:
+ - "docs/\*\*"
+ - "contrib/\*\*"
+ - "\*\*.md"
+ - "\*\*.rst"
+ - ".github/workflows/\*"
+ - "!.github/workflows/test.yaml"
push:
- branches:
- tags:
+ paths-ignore:
+ - "docs/\*\*"
+ - "contrib/\*\*"
+ - "\*\*.md"
+ - "\*\*.rst"
+ - ".github/workflows/\*"
+ - "!.github/workflows/test.yaml"
+ branches-ignore:
+ - "dependabot/\*\*"
+ - "pre-commit-ci-update-config"
workflow\_dispatch:
-defaults:
- run:
- # Declare bash be used by default in this workflow's "run" steps.
- #
- # NOTE: bash will by default run with:
- # --noprofile: Ignore ~/.profile etc.
- # --norc: Ignore ~/.bashrc etc.
- # -e: Exit directly on errors
- # -o pipefail: Don't mask errors from a command piped into another command
- shell: bash
-
jobs:
test:
runs-on: ubuntu-20.04
From b1dc09aa6645f4ca5cdde40fc78b7f161fce5f18 Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 00:13:53 +0100
Subject: [PATCH 02/17] Update language, from master to main
---
.../template/{{cookiecutter.project\_name}}/setup.py | 2 +-
contrib/theia/setup.py | 2 +-
docs/conf.py | 10 +++++-----
jupyter\_server\_proxy/utils.py | 3 ++-
4 files changed, 9 insertions(+), 8 deletions(-)
diff --git a/contrib/template/{{cookiecutter.project\_name}}/setup.py b/contrib/template/{{cookiecutter.project\_name}}/setup.py
index 0079c648..666a80f4 100644
--- a/contrib/template/{{cookiecutter.project\_name}}/setup.py
+++ b/contrib/template/{{cookiecutter.project\_name}}/setup.py
@@ -3,7 +3,7 @@
setuptools.setup(
name="jupyter-{{cookiecutter.project\_name}}-proxy",
version='1.0dev',
- url="https://github.com/jupyterhub/jupyter-server-proxy/tree/master/contrib/{{cookiecutter.project\_name}}",
+ url="https://github.com/jupyterhub/jupyter-server-proxy/tree/HEAD/contrib/{{cookiecutter.project\_name}}",
author="{{cookiecutter.author\_name}}",
description="{{cookiecutter.author\_email}}",
packages=setuptools.find\_packages(),
diff --git a/contrib/theia/setup.py b/contrib/theia/setup.py
index 333ffcb3..0014f81b 100644
--- a/contrib/theia/setup.py
+++ b/contrib/theia/setup.py
@@ -3,7 +3,7 @@
setuptools.setup(
name="jupyter-theia-proxy",
version='1.0dev',
- url="https://github.com/jupyterhub/jupyter-server-proxy/tree/master/contrib/theia",
+ url="https://github.com/jupyterhub/jupyter-server-proxy/tree/HEAD/contrib/theia",
author="Project Jupyter Contributors",
description="projectjupyter@gmail.com",
packages=setuptools.find\_packages(),
diff --git a/docs/conf.py b/docs/conf.py
index 16cdfd1f..e1a9e84d 100644
--- a/docs/conf.py
+++ b/docs/conf.py
@@ -52,8 +52,8 @@
# source\_suffix = ['.rst', '.md']
source\_suffix = '.rst'
-# The master toctree document.
-master\_doc = 'index'
+# The root toctree document.
+root\_doc = master\_doc = 'index'
# The language for content autogenerated by Sphinx. Refer to documentation
# for a list of supported languages.
@@ -130,7 +130,7 @@
# (source start file, target name, title,
# author, documentclass [howto, manual, or own class]).
latex\_documents = [
- (master\_doc, 'JupyterServerProxy.tex', u'Jupyter ServerProxy Documentation',
+ (root\_doc, 'JupyterServerProxy.tex', u'Jupyter ServerProxy Documentation',
u'Yuvi Panda', 'manual'),
]
@@ -140,7 +140,7 @@
# One entry per manual page. List of tuples
# (source start file, name, description, authors, manual section).
man\_pages = [
- (master\_doc, 'jupyterserverproxy', u'Jupyter ServerProxy Documentation',
+ (root\_doc, 'jupyterserverproxy', u'Jupyter ServerProxy Documentation',
[author], 1)
]
@@ -151,7 +151,7 @@
# (source start file, target name, title, author,
# dir menu entry, description, category)
texinfo\_documents = [
- (master\_doc, 'JupyterServerProxy', u'Jupyter ServerProxy Documentation',
+ (root\_doc, 'JupyterServerProxy', u'Jupyter ServerProxy Documentation',
author, 'JupyterServerProxy', 'One line description of project.',
'Miscellaneous'),
]
diff --git a/jupyter\_server\_proxy/utils.py b/jupyter\_server\_proxy/utils.py
index 725602c4..23724472 100644
--- a/jupyter\_server\_proxy/utils.py
+++ b/jupyter\_server\_proxy/utils.py
@@ -33,7 +33,8 @@ def call\_with\_asked\_args(callback, args):
)
return callback(\*asked\_arg\_values)
-# copy-pasted from the master of Traitlets source
+# copy-pasted from the ipython/traitlets source code, see
+# https://github.com/ipython/traitlets/blob/a1425327460c4a3ae970aeaef17e0c22da4c53c6/traitlets/traitlets.py#L3232-L3246
class Callable(TraitType):
"""A trait which is callable.
Notes
From ccaa292a8d974efc86ddc2996fe9cc7320ec5ae5 Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 00:15:36 +0100
Subject: [PATCH 03/17] Remove no longer needed logic involving six
---
jupyter\_server\_proxy/utils.py | 3 +--
1 file changed, 1 insertion(+), 2 deletions(-)
diff --git a/jupyter\_server\_proxy/utils.py b/jupyter\_server\_proxy/utils.py
index 725602c4..309ee543 100644
--- a/jupyter\_server\_proxy/utils.py
+++ b/jupyter\_server\_proxy/utils.py
@@ -1,5 +1,4 @@
from traitlets import TraitType
-import six
def call\_with\_asked\_args(callback, args):
"""
@@ -44,7 +43,7 @@ class Callable(TraitType):
info\_text = 'a callable'
def validate(self, obj, value):
- if six.callable(value):
+ if callable(value):
return value
else:
self.error(obj, value)
From 4b974715701a7310f913a64a6a4ecfae5086ccc9 Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 13:22:42 +0100
Subject: [PATCH 04/17] docs: update Makefile with devenv and linkcheck
---
docs/Makefile | 23 ++++++++++++++++++++---
docs/make.bat | 38 +++++++++++++++++++++++++++++---------
2 files changed, 49 insertions(+), 12 deletions(-)
diff --git a/docs/Makefile b/docs/Makefile
index 298ea9e2..5fd9d877 100644
--- a/docs/Makefile
+++ b/docs/Makefile
@@ -2,8 +2,8 @@
#
# You can set these variables from the command line.
-SPHINXOPTS =
-SPHINXBUILD = sphinx-build
+SPHINXOPTS ?=
+SPHINXBUILD ?= sphinx-build
SOURCEDIR = .
BUILDDIR = \_build
@@ -16,4 +16,21 @@ help:
# Catch-all target: route all unknown targets to Sphinx using the new
# "make mode" option. $(O) is meant as a shortcut for $(SPHINXOPTS).
%: Makefile
- @$(SPHINXBUILD) -M $@ "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O)
\ No newline at end of file
+ @$(SPHINXBUILD) -M $@ "$(SOURCEDIR)" "$(BUILDDIR)" $(SPHINXOPTS) $(O)
+
+# Manually added commands
+# ----------------------------------------------------------------------------
+
+# For local development:
+# - builds and rebuilds html on changes to source
+# - starts a livereload enabled webserver and opens up a browser
+devenv:
+ sphinx-autobuild -b html --open-browser "$(SOURCEDIR)" "$(BUILDDIR)/html" $(SPHINXOPTS)
+
+# For local development and CI:
+# - verifies that links are valid
+linkcheck:
+ $(SPHINXBUILD) -b linkcheck "$(SOURCEDIR)" "$(BUILDDIR)/linkcheck" $(SPHINXOPTS)
+ @echo
+ @echo "Link check complete; look for any errors in the above output " \
+ "or in $(BUILDDIR)/linkcheck/output.txt."
diff --git a/docs/make.bat b/docs/make.bat
index 27f573b8..ba30c170 100644
--- a/docs/make.bat
+++ b/docs/make.bat
@@ -11,25 +11,45 @@ set SOURCEDIR=.
set BUILDDIR=\_build
if "%1" == "" goto help
+if "%1" == "devenv" goto devenv
+if "%1" == "linkcheck" goto linkcheck
+goto default
+
+:default
%SPHINXBUILD% >NUL 2>NUL
if errorlevel 9009 (
echo.
- echo.The 'sphinx-build' command was not found. Make sure you have Sphinx
- echo.installed, then set the SPHINXBUILD environment variable to point
- echo.to the full path of the 'sphinx-build' executable. Alternatively you
- echo.may add the Sphinx directory to PATH.
+ echo.The 'sphinx-build' command was not found. Open and read README.md!
+ exit /b 1
+)
+%SPHINXBUILD% -M %1 "%SOURCEDIR%" "%BUILDDIR%" %SPHINXOPTS%
+goto end
+
+
+:help
+%SPHINXBUILD% -M help "%SOURCEDIR%" "%BUILDDIR%" %SPHINXOPTS%
+goto end
+
+
+:devenv
+sphinx-autobuild >NUL 2>NUL
+if errorlevel 9009 (
echo.
- echo.If you don't have Sphinx installed, grab it from
- echo.http://sphinx-doc.org/
+ echo.The 'sphinx-autobuild' command was not found. Open and read README.md!
exit /b 1
)
+sphinx-autobuild -b html --open-browser "../jupyterhub/schema.yaml" "%SOURCEDIR%" "%BUILDDIR%/html" %SPHINXOPTS%
+goto end
+
-%SPHINXBUILD% -M %1 %SOURCEDIR% %BUILDDIR% %SPHINXOPTS%
+:linkcheck
+%SPHINXBUILD% -b linkcheck "%SOURCEDIR%" "%BUILDDIR%/linkcheck" %SPHINXOPTS%
+echo.
+echo.Link check complete; look for any errors in the above output
+echo.or in "%BUILDDIR%/linkcheck/output.txt".
goto end
-:help
-%SPHINXBUILD% -M help %SOURCEDIR% %BUILDDIR% %SPHINXOPTS%
:end
popd
From f76842e57b939ca08ec02297e2bbf2b87f8f3db1 Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 13:23:16 +0100
Subject: [PATCH 05/17] docs: update conf.py to not clutter as much
---
docs/conf.py | 114 ++++++---------------------------------------------
1 file changed, 12 insertions(+), 102 deletions(-)
diff --git a/docs/conf.py b/docs/conf.py
index e1a9e84d..8ed79007 100644
--- a/docs/conf.py
+++ b/docs/conf.py
@@ -1,32 +1,19 @@
-# -\*- coding: utf-8 -\*-
+# Configuration file for Sphinx to build our documentation to HTML.
#
-# Configuration file for the Sphinx documentation builder.
+# Configuration reference: https://www.sphinx-doc.org/en/master/usage/configuration.html
#
-# This file does only contain a selection of the most common options. For a
-# full list see the documentation:
-# http://www.sphinx-doc.org/en/master/config
-# -- Path setup --------------------------------------------------------------
-# If extensions (or modules to document with autodoc) are in another directory,
-# add these directories to sys.path here. If the directory is relative to the
-# documentation root, use os.path.abspath to make it absolute, like shown here.
-#
-# import os
-# import sys
-# sys.path.insert(0, os.path.abspath('.'))
+# -- Project specific imports ------------------------------------------------
+import datetime
-# -- Project information -----------------------------------------------------
-project = u'Jupyter ServerProxy'
-copyright = u'2019, Yuvi Panda'
-author = u'Yuvi Panda'
+# -- Project information -----------------------------------------------------
-# The short X.Y version
-version = u''
-# The full version, including alpha/beta/rc tags
-release = u'1.0'
+project = "Jupyter Server Proxy"
+copyright = f"{datetime.date.today().year}, Project Jupyter Contributors"
+author = "Project Jupyter Contributors"
# -- General configuration ---------------------------------------------------
@@ -41,16 +28,15 @@
extensions = [
'sphinx.ext.intersphinx',
'sphinx.ext.todo',
+ "sphinx\_copybutton",
+ "myst\_parser",
]
# Add any paths that contain templates here, relative to this directory.
templates\_path = ['\_templates']
# The suffix(es) of source filenames.
-# You can specify multiple suffix as a list of string:
-#
-# source\_suffix = ['.rst', '.md']
-source\_suffix = '.rst'
+source\_suffix = [".md", ".rst"]
# The root toctree document.
root\_doc = master\_doc = 'index'
@@ -100,88 +86,12 @@
# html\_sidebars = {}
-# -- Options for HTMLHelp output ---------------------------------------------
-
-# Output file base name for HTML help builder.
-htmlhelp\_basename = 'JupyterServerProxydoc'
-
-
-# -- Options for LaTeX output ------------------------------------------------
-
-latex\_elements = {
- # The paper size ('letterpaper' or 'a4paper').
- #
- # 'papersize': 'letterpaper',
-
- # The font size ('10pt', '11pt' or '12pt').
- #
- # 'pointsize': '10pt',
-
- # Additional stuff for the LaTeX preamble.
- #
- # 'preamble': '',
-
- # Latex figure (float) alignment
- #
- # 'figure\_align': 'htbp',
-}
-
-# Grouping the document tree into LaTeX files. List of tuples
-# (source start file, target name, title,
-# author, documentclass [howto, manual, or own class]).
-latex\_documents = [
- (root\_doc, 'JupyterServerProxy.tex', u'Jupyter ServerProxy Documentation',
- u'Yuvi Panda', 'manual'),
-]
-
-
-# -- Options for manual page output ------------------------------------------
-
-# One entry per manual page. List of tuples
-# (source start file, name, description, authors, manual section).
-man\_pages = [
- (root\_doc, 'jupyterserverproxy', u'Jupyter ServerProxy Documentation',
- [author], 1)
-]
-
-
-# -- Options for Texinfo output ----------------------------------------------
-
-# Grouping the document tree into Texinfo files. List of tuples
-# (source start file, target name, title, author,
-# dir menu entry, description, category)
-texinfo\_documents = [
- (root\_doc, 'JupyterServerProxy', u'Jupyter ServerProxy Documentation',
- author, 'JupyterServerProxy', 'One line description of project.',
- 'Miscellaneous'),
-]
-
-
-# -- Options for Epub output -------------------------------------------------
-
-# Bibliographic Dublin Core info.
-epub\_title = project
-
-# The unique identifier of the text. This can be a ISBN number
-# or the project homepage.
-#
-# epub\_identifier = ''
-
-# A unique identification for the text.
-#
-# epub\_uid = ''
-
-# A list of files that should not be packed into the epub file.
-epub\_exclude\_files = ['search.html']
-
-
-# -- Extension configuration -------------------------------------------------
-
# -- Options for intersphinx extension ---------------------------------------
# Example configuration for intersphinx: refer to the Python standard library.
intersphinx\_mapping = {'https://docs.python.org/': None}
+
# -- Options for todo extension ----------------------------------------------
# If true, `todo` and `todoList` produce output, else they produce nothing.
From 45eeb0bea73127e62f191bf1277db2e75e89fc9e Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 13:32:24 +0100
Subject: [PATCH 06/17] docs: prepare for but don't switch to pydata theme yet
---
.readthedocs.yaml | 19 +++++++++++++++++++
docs/conf.py | 40 ++++++++++++++++++----------------------
docs/requirements.txt | 4 ++++
3 files changed, 41 insertions(+), 22 deletions(-)
create mode 100644 .readthedocs.yaml
create mode 100644 docs/requirements.txt
diff --git a/.readthedocs.yaml b/.readthedocs.yaml
new file mode 100644
index 00000000..afa6a4ed
--- /dev/null
+++ b/.readthedocs.yaml
@@ -0,0 +1,19 @@
+# Configuration on how ReadTheDocs (RTD) builds our documentation
+# ref: https://readthedocs.org/projects/jupyter-server-proxy/
+# ref: https://docs.readthedocs.io/en/stable/config-file/v2.html
+#
+version: 2
+
+build:
+ os: ubuntu-20.04
+ tools:
+ python: "3.9"
+
+python:
+ install:
+ - requirements: docs/requirements.txt
+
+sphinx:
+ configuration: docs/conf.py
+
+formats: []
diff --git a/docs/conf.py b/docs/conf.py
index 8ed79007..b449586d 100644
--- a/docs/conf.py
+++ b/docs/conf.py
@@ -58,32 +58,28 @@
# -- Options for HTML output -------------------------------------------------
-
-# The theme to use for HTML and HTML Help pages. See the documentation for
-# a list of builtin themes.
-#
-html\_theme = 'alabaster'
-
-# Theme options are theme-specific and customize the look and feel of a theme
-# further. For a list of options available for each theme, see the
-# documentation.
-#
-# html\_theme\_options = {}
+# ref: http://www.sphinx-doc.org/en/master/usage/configuration.html#options-for-html-output
+
+# FIXME: change to pydata\_sphinx\_theme
+html\_theme = "alabaster"
+html\_theme\_options = {
+ "github\_url": "https://github.com/jupyterhub/jupyter-server-proxy/",
+ "use\_edit\_page\_button": True,
+}
+html\_context = {
+ "github\_user": "jupyterhub",
+ "github\_repo": "jupyter-server-proxy",
+ "github\_version": "main",
+ "doc\_path": "docs",
+}
+
+html\_favicon = "\_static/images/logo/favicon.ico"
+html\_logo = "\_static/images/logo/logo.png"
# Add any paths that contain custom static files (such as style sheets) here,
# relative to this directory. They are copied after the builtin static files,
# so a file named "default.css" will overwrite the builtin "default.css".
-html\_static\_path = ['\_static']
-
-# Custom sidebar templates, must be a dictionary that maps document names
-# to template names.
-#
-# The default sidebars (for documents that don't match any pattern) are
-# defined by theme itself. Builtin themes are using these templates by
-# default: ``['localtoc.html', 'relations.html', 'sourcelink.html',
-# 'searchbox.html']``.
-#
-# html\_sidebars = {}
+html\_static\_path = ["\_static"]
# -- Options for intersphinx extension ---------------------------------------
diff --git a/docs/requirements.txt b/docs/requirements.txt
new file mode 100644
index 00000000..ec2e63ed
--- /dev/null
+++ b/docs/requirements.txt
@@ -0,0 +1,4 @@
+myst-parser
+pydata-sphinx-theme
+sphinx-autobuild
+sphinx-copybutton
From dd63f2a04cef659828948458e86c5fdcf4cb0ca8 Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 13:39:09 +0100
Subject: [PATCH 07/17] docs: add linkcheck test
---
.github/workflows/linkcheck.yaml | 35 ++++++++++++++++++++++++++++++++
1 file changed, 35 insertions(+)
create mode 100644 .github/workflows/linkcheck.yaml
diff --git a/.github/workflows/linkcheck.yaml b/.github/workflows/linkcheck.yaml
new file mode 100644
index 00000000..e4a32e62
--- /dev/null
+++ b/.github/workflows/linkcheck.yaml
@@ -0,0 +1,35 @@
+# This is a GitHub workflow defining a set of jobs with a set of steps. ref:
+# https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions
+#
+name: Linkcheck
+
+on:
+ pull\_request:
+ paths:
+ - "docs/\*\*"
+ - "\*\*/linkcheck.yaml"
+ push:
+ paths:
+ - "docs/\*\*"
+ - "\*\*/linkcheck.yaml"
+ branches-ignore:
+ - "dependabot/\*\*"
+ - "pre-commit-ci-update-config"
+ workflow\_dispatch:
+
+jobs:
+ linkcheck:
+ runs-on: ubuntu-20.04
+ steps:
+ - uses: actions/checkout@v2
+ - uses: actions/setup-python@v2
+ with:
+ python-version: "3.8"
+
+ - name: Install deps
+ run: pip install -r docs/requirements.txt
+
+ - name: make linkcheck
+ run: |
+ cd docs
+ make linkcheck SPHINXOPTS='--color -W --keep-going'
From 5396b6ad6276ec28974107ca29f0264e70c38a5f Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 13:43:51 +0100
Subject: [PATCH 08/17] docs: update links for the new linkcheck test
---
contrib/theia/README.rst | 6 +++---
docs/convenience/new.rst | 2 +-
docs/server-process.rst | 2 +-
3 files changed, 5 insertions(+), 5 deletions(-)
diff --git a/contrib/theia/README.rst b/contrib/theia/README.rst
index c7497466..b407515e 100644
--- a/contrib/theia/README.rst
+++ b/contrib/theia/README.rst
@@ -2,7 +2,7 @@
Theia IDE
=========
-`Theia `\_ is a configurable web based IDE
+`Theia `\_ is a configurable web based IDE
built with components from `Visual Studio Code `\_.
This package is a plugin for `jupyter-server-proxy `\_
@@ -12,12 +12,12 @@ in a JupyterHub / Binder environment.
Installing Theia
================
-#. `Install the ``yarn`` package manager `\_
+#. `Install the ``yarn`` package manager `\_
with one of the available methods.
#. Theia is highly configurable, so you need to decide which features you want
in your theia install. Make a ``package.json`` with the list of extensions you want,
- following `the instructions here `\_.
+ following `the instructions here `\_.
Here is an example:
diff --git a/docs/convenience/new.rst b/docs/convenience/new.rst
index b59abbb5..21633155 100644
--- a/docs/convenience/new.rst
+++ b/docs/convenience/new.rst
@@ -4,7 +4,7 @@
Making a new convenience package
================================
-There is a `cookiecutter `\_
+There is a `cookiecutter `\_
template provided in this repo that can be used to make new packages.
.. code:: bash
diff --git a/docs/server-process.rst b/docs/server-process.rst
index f579daee..a9badb24 100644
--- a/docs/server-process.rst
+++ b/docs/server-process.rst
@@ -234,7 +234,7 @@ if we want tighter control over what process is spawned.
}
}
- This will start `OpenRefine `\_ with the
+ This will start `OpenRefine `\_ with the
``refine`` command (which must be in $PATH) on a randomly
generated port, and make it available under ``/openrefine``
in your notebook url. The URL path is specified by the key,
From cdc835851f0c507984225d0979c7ce79252b4920 Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 13:47:21 +0100
Subject: [PATCH 09/17] Update .gitignore
---
.gitignore | 155 +++++++++++++++++++++++++++++++++++++++++++++++++----
1 file changed, 146 insertions(+), 9 deletions(-)
diff --git a/.gitignore b/.gitignore
index 8b53b5de..d2bfb0b9 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,12 +1,149 @@
-.coverage\*
-.ipynb\_checkpoints/
-.vscode
-\*.egg-info/
-\*.pyc
-build/
-dist
-docs/\_build
+# Manually added entries
+#
+jsdist
jupyter\_server\_proxy/labextension
-MANIFEST
node\_modules
package-lock.json
+
+
+
+# Copy pasted entries from:
+# https://raw.githubusercontent.com/github/gitignore/master/Python.gitignore
+#
+
+# Byte-compiled / optimized / DLL files
+\_\_pycache\_\_/
+\*.py[cod]
+\*$py.class
+
+# C extensions
+\*.so
+
+# Distribution / packaging
+.Python
+build/
+develop-eggs/
+dist/
+downloads/
+eggs/
+.eggs/
+lib/
+lib64/
+parts/
+sdist/
+var/
+wheels/
+share/python-wheels/
+\*.egg-info/
+.installed.cfg
+\*.egg
+ PyInstaller
+# Usually these files are written by a python script from a template
+# before PyInstaller builds the exe, so as to inject date/other infos into it.
+\*.manifest
+\*.spec
+
+# Installer logs
+pip-log.txt
+pip-delete-this-directory.txt
+
+# Unit test / coverage reports
+htmlcov/
+.tox/
+.nox/
+.coverage
+.coverage.\*
+.cache
+nosetests.xml
+coverage.xml
+\*.cover
+\*.py,cover
+.hypothesis/
+.pytest\_cache/
+cover/
+
+# Translations
+\*.mo
+\*.pot
+
+# Django stuff:
+\*.log
+local\_settings.py
+db.sqlite3
+db.sqlite3-journal
+
+# Flask stuff:
+instance/
+.webassets-cache
+
+# Scrapy stuff:
+.scrapy
+
+# Sphinx documentation
+docs/\_build/
+
+# PyBuilder
+.pybuilder/
+target/
+
+# Jupyter Notebook
+.ipynb\_checkpoints
+
+# IPython
+profile\_default/
+ipython\_config.py
+
+# pyenv
+# For a library or package, you might want to ignore these files since the code is
+# intended to run in multiple environments; otherwise, check them in:
+# .python-version
+
+# pipenv
+# According to pypa/pipenv#598, it is recommended to include Pipfile.lock in version control.
+# However, in case of collaboration, if having platform-specific dependencies or dependencies
+# having no cross-platform support, pipenv may install dependencies that don't work, or not
+# install all needed dependencies.
+#Pipfile.lock
+
+# PEP 582; used by e.g. github.com/David-OConnor/pyflow
+\_\_pypackages\_\_/
+
+# Celery stuff
+celerybeat-schedule
+celerybeat.pid
+
+# SageMath parsed files
+\*.sage.py
+
+# Environments
+.env
+.venv
+env/
+venv/
+ENV/
+env.bak/
+venv.bak/
+
+# Spyder project settings
+.spyderproject
+.spyproject
+
+# Rope project settings
+.ropeproject
+
+# mkdocs documentation
+/site
+
+# mypy
+.mypy\_cache/
+.dmypy.json
+dmypy.json
+
+# Pyre type checker
+.pyre/
+
+# pytype static type analyzer
+.pytype/
+
+# Cython debug symbols
+cython\_debug/
From 2af9e707801d162b7b6f4014a4d62ce3dd9443b3 Mon Sep 17 00:00:00 2001
From: Erik Sundell
Date: Tue, 30 Nov 2021 14:12:12 +0100
Subject: [PATCH 10/17] docs: fix warnings for linkcheck
---
docs/\_static/images/logo/favicon.ico | Bin 0 -> 4555 bytes
docs/conf.py | 3 ++-
docs/server-process.rst | 10 +++++-----
3 files changed, 7 insertions(+), 6 deletions(-)
create mode 100644 docs/\_static/images/logo/favicon.ico
diff --git a/docs/\_static/images/logo/favicon.ico b/docs/\_static/images/logo/favicon.ico
new file mode 100644
index 0000000000000000000000000000000000000000..ffdf84e2314ca24a8b508642368dbba3bc61c7cc
GIT binary patch
literal 4555
zcmbtYXIRt8yZuq5S3z2&gGddbNiTwQLJ=V#Jru!E6A%QcN>PfTOD\_t76e%LTMS\_T-
z2t)yCOBEsnFsu~ekGp&K-uw05d7hbh=gfJ}nRn\*fBw0WW80mQE003Y#GSss=pDliO
z8mjX#m36Q7e4\_NyG1CEnhBW#U\*9+%s0l1-+835eB0szqu0pREyirxT#U|9gzbO8X>
zTmawmMff3ALp6l{VyK?SzhSVDz+V\*9T@4|anT3F^e~^cOqKtx!tdJ(1
zfPjE{kh`aE|mAp\*tv4fGQY#@7\_I`d-5{=L0({pii!$YRt\_vDCw+0qojM5Mi`fc=Y`}>?IZ\_odB@9m2khjOV^KX4ki27g5|AqbIqYnOU{yz@$ccp)!=cQ`Wse}K$
zHcdLyela@$VE$^Pr(+#T\_T8R7z}lAk^Z<=8RASzX)s`yl><3+Xn!rv!U\_5SP;M)Kl
z93KzF;-8J6P$D0hXj\*{^BT7zf&Rzvp
z!>0D(|5KoaJKD+LROM{(!Z`V\_k#Fgel|=7{s;^n4&FnnenEMz!#S#YZ+x-50V0U?t
zmF^M4)9e)8NyPQ<)Oj(q#QXP&COwzDJdXGLp#sgg-A8y;SX~C?~>&$plbDcwyOR=
zicEsWH^Ml7I<6\*3I;|7Y!l7&5Dwjq-^hY^G@y^ai$d~%QT\*&pvjLC-3?t~(po@p-^
z4^Ax9^L&=crmQo{{I\*GWIJ%A@E@8&!@$nYn;V0<9jmrKfRYo1^aKOIg=;-LR@0QJ-
ziURq2b%9^iGbHn9epXI?9\*^%vdOdq9%t4D;9\*qUp1KnkA8R4\*n#=8U(+)^Vv\*eAWA\_Dji)S5Ys+<}lHJ9`\*Bsm+;\*`)EV--ftZFV;?EdYffzdK7f^h3Z0+-Dl#biA>%8B`U
z{%J}}f-UgaoqR>QF1Ft1!by2$ud^!Me5\_k~AlIM@e~vsu<+k6CH`mJRtH{t)@%!WJ
ztiE;f%fd8>zB#Z!)RNbc4oHY);5rCPB9U~NOL(k#X!swje\_FO+%!^VeLC)Yef8=wt~Wg~&elPt^$=Vl#lRJb
z<-6}jAiy3rS@T%WTsA1;u~xevk{d2
zuFoF1CYi%aUswX;jYC$NDqqGvllL;6U3KvHvD+^K2-oJhvngBOT|RofRPPpWb5cD7kfPkQ~mVxrPg>ApfIC8VF%wB<`}
zJL2;%%Se<>7I&bUgp(Yf@oKRgs6MHNaHIUf;F!CWRq`T&lyn3IbcC6?o($z#@yi
z9pIi2LS@`I=+zPukE9h\_\_8A?vb|w|@!ecU^)8ZlabJd7hl!P(eqKgi%O|=1KG|y!v
z1lQi)UUE!O$XYUY1!3y56Q=Qn2|9zVckRqi$J?8>TFk7!0(Yk9i=X1f7;W3\_ID}Du
z\_+Y$CKyK|;4Lq^XtC+%1m6k41Vr\_1@?q}EPzs2UYAwA1mTA1p4cKIK+4Z~!k\_$r8t
z+Iu9@U|8Zzw7HB!^mw\_!Gs7{b+Y}E110faW#eRso+S-AiyUUDM6PWq2hJMGBtmK5n
zzPLL+K60nYplc(UuY{$%3tU7cL5WY4`=Lb2++>yT>`EcRB^7&YoH65bt1J55jjqBo
zZ?2Rh!QDS3R$CoiX4+n1l`D\_e@jbor?QdU49O7~vG-#R6c3Ii5$4r;CaoZXfA)`|^
zHwFw%FKeY1%He<)(i2+6516h=JI0RIwq7tlTXw$EtRVAX=k%6?u{Fz6R%~\_%AH1qb
ztYPBd`>a)~%%7RSq
zE@26J1=7p=W=2buBGaEP@`1(KL$%5}Co{K%xjqWB1q%V0O{b4pvvY0Z
z2$`d`u++Ig00c5$hVvJCplobXv7xG>ya`PFf\_Fizn>6D^$d\_t1Y4L1gi(W4yT?Z7clvG$
zr=+CB2XE4f+X$0e%C\*>TL#6p2xf0c&e|YsVpws1%y~a=Hu4Rm6c{hixQp49R1aXu`5}\_
z{L@u-Q?VXuv-r1rIm2Dm0-||!BrE;L!CyrdYglctN}gFWdspu<$dxRu7%k@(o%w(E
zlZ^M2I|K%KUg\*mmzaO{Hd^#QkgU{uS4{&`Yctf(71
z`LO`P+vD8C^f`?;-@?&MHi|S$jT?j9U1Lbi=-53@IE@Ze56fQWp\*o4gb^cPSF6+J6
zRMQpGV&i0Im&6EC%5|VbC!b6-<>m3fUtwo%JmKI5NkKm53`c~v@;#>Q-Ky)5=~JF+
zh!=SUhOZ`mqUiZ4+I@eWH{OUxEm\*?A8m33Z$rCUoco$!XISE7J=rljLy2UQP3mxn@
z!{k$vW\*3e;%fwY)=VU~~q+Jx73F{9h@E@RS4+Zhnn2z>#975){h;YSfLsNuiy=!)a
z#j%?Q1!jRScE%O^I=3e4Oen3WlDr6#OW~FL7zXAjXLaxieB7$nI4XL)Cs~iR(Ri(j
zpPN9A^Dw;nQe9l1%BvheBfE9H1UO#BmW|0r|@
zM?Bo)>~Z-54g=YL@\*sJKy#2G6z7wQoa)Y>;A${hPWU3EgCK9i+l^8@;9wg=h-9l)z
zExvGK=A5Y=t+{dV<=gw>@N(8$j@uJ26PA4>MjD-xNwA?#YILI?-((0PlH-Q+k&JWk
zikL4LJ8~{nM6q3O;X+|hHlxOybQ?qK6pQ!4$1&JSzuVeOlKl5kmlLMi+#osBw1
zVKig4I^Q^\*Dc`;\*Ts;Iq<(ATO2(5WAY|=oSo;a{H4triJ$}!U\*j&D9V{nGF#QL\*-z
zc584pusJ9F6Z^waxWLvlli9<&Ws7uv1\*FS8gH
z-gxI18?)6RrYux#q$S~xQ\*|IiQI;#SFIwakvQ2Kw0qjioMm>l>?a#9h&b%zb-Bft`
zVE-ZVP?JhxA=o\*1ZSMlxLOJorrSUozv66`h{s>@PzW!hsIX8N5o0$FJGG-\_8qROp|
z#NY\_^t^z^Zr9%(0PC8$Ql71B3w9J)\*qH2TT;;2|d9GudZCuVbPYgl\*et}z)rUJb;R
z2XFr4kC-Ge+4xLJy=D)wi1O^R4G^=C\*H`urgO8{oXXL\_lR(\*Twp4kRe05)=#oW1TZpIfYv=aR#Q^c;bV()8=k=w0Ys
gMA?G>A4zA\_\_QJ#}F$QOu-(Mz1H=ufT\*Ii=&0|?)D^#A|>
literal 0
HcmV?d00001
diff --git a/docs/conf.py b/docs/conf.py
index b449586d..07ee2dfe 100644
--- a/docs/conf.py
+++ b/docs/conf.py
@@ -74,7 +74,8 @@
}
html\_favicon = "\_static/images/logo/favicon.ico"
-html\_logo = "\_static/images/logo/logo.png"
+# FIXME: Add project logo
+# html\_logo = "\_static/images/logo/logo.png"
# Add any paths that contain custom static files (such as style sheets) here,
# relative to this directory. They are copied after the builtin static files,
diff --git a/docs/server-process.rst b/docs/server-process.rst
index a9badb24..dc6502c6 100644
--- a/docs/server-process.rst
+++ b/docs/server-process.rst
@@ -33,7 +33,7 @@ pairs.
For example, if the application needs to know its full path it can
be constructed from ``{base\_url}/proxy/{port}``
- \* A callable that takes any :ref:`callable arguments `,
+ \* A callable that takes any :ref:`callable arguments `,
and returns a list of strings that are used & treated same as above.
This key is required.
@@ -56,7 +56,7 @@ pairs.
process itself. The strings ``{port}`` and ``{base\_url}`` will be
replaced as for \*\*command\*\*.
- \* A callable that takes any :ref:`callable arguments `,
+ \* A callable that takes any :ref:`callable arguments `,
and returns a dictionary of strings that are used & treated same as above.
``absolute\_url``
@@ -139,7 +139,7 @@ pairs.
``request\_headers\_override``
-^^^^^^^^^^^^^^^
+^^^^^^^^^^^^^^^^^^^^^^^^^^^^
One of:
@@ -147,11 +147,11 @@ pairs.
request. The strings ``{port}`` and ``{base\_url}`` will be replaced as
for \*\*command\*\*.
- \* A callable that takes any :ref:`callable arguments `,
+ \* A callable that takes any :ref:`callable arguments `,
and returns a dictionary of strings that are used & treated same as above.
-.. \_server-processes/callable-arguments:
+.. \_server-process/callable-arguments:
Callable arguments
------------------
From c69d73f590d990808d3eef5f1eb5c575084a00e0 Mon Sep 17 00:00:00 2001
From: Nicholas Bollweg
Date: Tue, 30 Nov 2021 16:32:05 -0600
Subject: [PATCH 11/17] remove lab style
---
jupyterlab-server-proxy/src/index.ts | 2 --
jupyterlab-server-proxy/style/index.css | 0
2 files changed, 2 deletions(-)
delete mode 100644 jupyterlab-server-proxy/style/index.css
diff --git a/jupyterlab-server-proxy/src/index.ts b/jupyterlab-server-proxy/src/index.ts
index c3aaf193..795eed41 100644
--- a/jupyterlab-server-proxy/src/index.ts
+++ b/jupyterlab-server-proxy/src/index.ts
@@ -3,8 +3,6 @@ import { ILauncher } from '@jupyterlab/launcher';
import { PageConfig } from '@jupyterlab/coreutils';
import { IFrame, MainAreaWidget, WidgetTracker } from '@jupyterlab/apputils';
-import '../style/index.css';
-
function newServerProxyWidget(id: string, url: string, text: string): MainAreaWidget {
const content = new IFrame({
sandbox: ['allow-same-origin', 'allow-scripts', 'allow-popups', 'allow-forms'],
diff --git a/jupyterlab-server-proxy/style/index.css b/jupyterlab-server-proxy/style/index.css
deleted file mode 100644
index e69de29b..00000000
From ae9ec09d02e0bae205ec09895d06f2b4d8036b32 Mon Sep 17 00:00:00 2001
From: Min RK
Date: Tue, 11 Jan 2022 10:51:59 +0100
Subject: [PATCH 12/17] validate proxied paths starting with /
- restrict regex to `(/.\*|)` to require starting with `/` or being empty string
- double-safe ensure proxied path starts with / in get\_client\_uri
---
jupyter\_server\_proxy/handlers.py | 105 +++++++++++++++++--------------
tests/test\_proxies.py | 18 ++++++
2 files changed, 75 insertions(+), 48 deletions(-)
diff --git a/jupyter\_server\_proxy/handlers.py b/jupyter\_server\_proxy/handlers.py
index 68d075a8..7e97c858 100644
--- a/jupyter\_server\_proxy/handlers.py
+++ b/jupyter\_server\_proxy/handlers.py
@@ -209,12 +209,16 @@ def \_get\_context\_path(self, host, port):
return url\_path\_join(self.base\_url, 'proxy', host\_and\_port)
def get\_client\_uri(self, protocol, host, port, proxied\_path):
- context\_path = self.\_get\_context\_path(host, port)
if self.absolute\_url:
+ context\_path = self.\_get\_context\_path(host, port)
client\_path = url\_path\_join(context\_path, proxied\_path)
else:
client\_path = proxied\_path
+ # ensure client\_path always starts with '/'
+ if not client\_path.startswith("/"):
+ client\_path = "/" + client\_path
+
# Quote spaces, åäö and such, but only enough to send a valid web
# request onwards. To do this, we mark the RFC 3986 specs' "reserved"
# and "un-reserved" characters as safe that won't need quoting. The
@@ -228,7 +232,7 @@ def get\_client\_uri(self, protocol, host, port, proxied\_path):
protocol=protocol,
host=host,
port=port,
- path=client\_path
+ path=client\_path,
)
if self.request.query:
client\_uri += '?' + self.request.query
@@ -297,13 +301,14 @@ async def proxy(self, host, port, proxied\_path):
client = httpclient.AsyncHTTPClient()
req = self.\_build\_proxy\_request(host, port, proxied\_path, body)
+ self.log.debug(f"Proxying request to {req.url}")
try:
# Here, "response" is a tornado.httpclient.HTTPResponse object.
response = await client.fetch(req, raise\_error=False)
except httpclient.HTTPError as err:
# We need to capture the timeout error even with raise\_error=False,
- # because it only affects the HTTPError raised when a non-200 response
+ # because it only affects the HTTPError raised when a non-200 response
# code is used, instead of suppressing all errors.
# Ref: https://www.tornadoweb.org/en/stable/httpclient.html#tornado.httpclient.AsyncHTTPClient.fetch
if err.code == 599:
@@ -324,7 +329,7 @@ async def proxy(self, host, port, proxied\_path):
else:
# Represent the original response as a RewritableResponse object.
original\_response = RewritableResponse(orig\_response=response)
-
+
# The function (or list of functions) which should be applied to modify the
# response.
rewrite\_response = self.rewrite\_response
@@ -688,53 +693,57 @@ def options(self, path):
def setup\_handlers(web\_app, serverproxy\_config):
host\_allowlist = serverproxy\_config.host\_allowlist
rewrite\_response = serverproxy\_config.non\_service\_rewrite\_response
- web\_app.add\_handlers('.\*', [
- (
- url\_path\_join(
- web\_app.settings['base\_url'],
- r'/proxy/([^/]\*):(\d+)(.\*)',
+ web\_app.add\_handlers(
+ ".\*",
+ [
+ (
+ url\_path\_join(
+ web\_app.settings["base\_url"],
+ r"/proxy/([^/:@]+):(\d+)(/.\*|)",
+ ),
+ RemoteProxyHandler,
+ {
+ "absolute\_url": False,
+ "host\_allowlist": host\_allowlist,
+ "rewrite\_response": rewrite\_response,
+ },
),
- RemoteProxyHandler,
- {
- 'absolute\_url': False,
- 'host\_allowlist': host\_allowlist,
- 'rewrite\_response': rewrite\_response,
- }
- ),
- (
- url\_path\_join(
- web\_app.settings['base\_url'],
- r'/proxy/absolute/([^/]\*):(\d+)(.\*)',
+ (
+ url\_path\_join(
+ web\_app.settings["base\_url"],
+ r"/proxy/absolute/([^/:@]+):(\d+)(/.\*|)",
+ ),
+ RemoteProxyHandler,
+ {
+ "absolute\_url": True,
+ "host\_allowlist": host\_allowlist,
+ "rewrite\_response": rewrite\_response,
+ },
),
- RemoteProxyHandler,
- {
- 'absolute\_url': True,
- 'host\_allowlist': host\_allowlist,
- 'rewrite\_response': rewrite\_response,
- }
- ),
- (
- url\_path\_join(
- web\_app.settings['base\_url'],
- r'/proxy/(\d+)(.\*)',
+ (
+ url\_path\_join(
+ web\_app.settings["base\_url"],
+ r"/proxy/(\d+)(/.\*|)",
+ ),
+ LocalProxyHandler,
+ {
+ "absolute\_url": False,
+ "rewrite\_response": rewrite\_response,
+ },
),
- LocalProxyHandler,
- {
- 'absolute\_url': False,
- 'rewrite\_response': rewrite\_response,
- },
- ),
- (
- url\_path\_join(
- web\_app.settings['base\_url'],
- r'/proxy/absolute/(\d+)(.\*)',
+ (
+ url\_path\_join(
+ web\_app.settings["base\_url"],
+ r"/proxy/absolute/(\d+)(/.\*|)",
+ ),
+ LocalProxyHandler,
+ {
+ "absolute\_url": True,
+ "rewrite\_response": rewrite\_response,
+ },
),
- LocalProxyHandler,
- {
- 'absolute\_url': True,
- 'rewrite\_response': rewrite\_response,
- },
- ),
- ])
+ ],
+ )
+
# vim: set et ts=4 sw=4:
diff --git a/tests/test\_proxies.py b/tests/test\_proxies.py
index 7128409f..c44295a2 100644
--- a/tests/test\_proxies.py
+++ b/tests/test\_proxies.py
@@ -291,3 +291,21 @@ async def \_websocket\_subprotocols():
def test\_server\_proxy\_websocket\_subprotocols(event\_loop):
event\_loop.run\_until\_complete(\_websocket\_subprotocols())
+@pytest.mark.parametrize(
+ "proxy\_path, status",
+ [
+ ("127.0.0.1", 404),
+ ("127.0.0.1/path", 404),
+ ("127.0.0.1@192.168.1.1", 404),
+ ("127.0.0.1@192.168.1.1/path", 404),
+ ("user:pass@host:123/foo", 403),
+ ("user:pass@host/foo", 404),
+ ("absolute/127.0.0.1:123@192.168.1.1/path", 404),
+ ]
+)
+def test\_bad\_server\_proxy\_url(proxy\_path, status):
+ r = request\_get(PORT, f"/proxy/{proxy\_path}", TOKEN)
+ assert r.code == status
+ if status >= 400:
+ # request should not have been proxied
+ assert 'X-ProxyContextPath' not in r.headers
From 61bad1500076f368d188fd1ef1a86a18aace4a1b Mon Sep 17 00:00:00 2001
From: Simon Li
Date: Wed, 19 Jan 2022 21:06:01 +0000
Subject: [PATCH 13/17] Changelog for 3.2.1
---
CHANGELOG.md | 22 ++++++++++++++++++++++
1 file changed, 22 insertions(+)
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 3af44ff0..974b21ca 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -1,5 +1,27 @@
## 3.2
+### 3.2.1 - 2022-01-24
+
+3.2.1 is a security release, fixing a vulnerability [GHSA-gcv9-6737-pjqw](https://github.com/jupyterhub/jupyter-server-proxy/security/advisories/GHSA-gcv9-6737-pjqw) where `allowed\_hosts` were not validated correctly.
+
+## Maintenance and upkeep improvements
+
+- Modernize docs without making changes to its content [#313](https://github.com/jupyterhub/jupyter-server-proxy/pull/313) ([@consideRatio](https://github.com/consideRatio))
+- Remove no longer needed logic involving six [#312](https://github.com/jupyterhub/jupyter-server-proxy/pull/312) ([@consideRatio](https://github.com/consideRatio))
+- Update language, from master to main [#311](https://github.com/jupyterhub/jupyter-server-proxy/pull/311) ([@consideRatio](https://github.com/consideRatio))
+
+## Other merged PRs
+
+- Remove empty JupyterLab style [#314](https://github.com/jupyterhub/jupyter-server-proxy/pull/314) ([@bollwyvl](https://github.com/bollwyvl))
+- ci: avoid triggering ci twice on pre-commit.ci/dependabot prs [#310](https://github.com/jupyterhub/jupyter-server-proxy/pull/310) ([@consideRatio](https://github.com/consideRatio))
+
+## Contributors to this release
+
+([GitHub contributors page for this release](https://github.com/jupyterhub/jupyter-server-proxy/graphs/contributors?from=2021-11-29&to=2022-01-19&type=c))
+
+[@bollwyvl](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyter-server-proxy+involves%3Abollwyvl+updated%3A2021-11-29..2022-01-19&type=Issues) | [@consideRatio](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyter-server-proxy+involves%3AconsideRatio+updated%3A2021-11-29..2022-01-19&type=Issues) | [@welcome](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyter-server-proxy+involves%3Awelcome+updated%3A2021-11-29..2022-01-19&type=Issues) | [@yuvipanda](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyter-server-proxy+involves%3Ayuvipanda+updated%3A2021-11-29..2022-01-19&type=Issues)
+
+
### 3.2.0 - 2021-11-29
#### New features added
From c35dbea147733d689e1611ff6dbee5452ddf37b3 Mon Sep 17 00:00:00 2001
From: "dependabot[bot]" <49699333+dependabot[bot]@users.noreply.github.com>
Date: Sat, 22 Jan 2022 03:37:42 +0000
Subject: [PATCH 14/17] Bump nanoid from 3.1.30 to 3.2.0 in
/jupyterlab-server-proxy
Bumps [nanoid](https://github.com/ai/nanoid) from 3.1.30 to 3.2.0.
- [Release notes](https://github.com/ai/nanoid/releases)
- [Changelog](https://github.com/ai/nanoid/blob/main/CHANGELOG.md)
- [Commits](https://github.com/ai/nanoid/compare/3.1.30...3.2.0)
---
updated-dependencies:
- dependency-name: nanoid
dependency-type: indirect
...
Signed-off-by: dependabot[bot]
---
jupyterlab-server-proxy/yarn.lock | 6 +++---
1 file changed, 3 insertions(+), 3 deletions(-)
diff --git a/jupyterlab-server-proxy/yarn.lock b/jupyterlab-server-proxy/yarn.lock
index 06f95684..35a2155c 100644
--- a/jupyterlab-server-proxy/yarn.lock
+++ b/jupyterlab-server-proxy/yarn.lock
@@ -3352,9 +3352,9 @@ mv@2.1.1:
rimraf "~2.4.0"
nanoid@^3.1.30:
- version "3.1.30"
- resolved "https://registry.yarnpkg.com/nanoid/-/nanoid-3.1.30.tgz#63f93cc548d2a113dc5dfbc63bfa09e2b9b64362"
- integrity sha512-zJpuPDwOv8D2zq2WRoMe1HsfZthVewpel9CAvTfc/2mBD1uUT/agc5f7GHGWXlYkFvi1mVxe4IjvP2HNrop7nQ==
+ version "3.2.0"
+ resolved "https://registry.yarnpkg.com/nanoid/-/nanoid-3.2.0.tgz#62667522da6673971cca916a6d3eff3f415ff80c"
+ integrity sha512-fmsZYa9lpn69Ad5eDn7FMcnnSR+8R34W9qJEijxYhTbfOWzr22n1QxCMzXLK+ODyW2973V3Fux959iQoUxzUIA==
napi-macros@~2.0.0:
version "2.0.0"
From ad7ecf2348cbf6d033586a42ac48ec6435c0f01f Mon Sep 17 00:00:00 2001
From: Simon Li
Date: Mon, 24 Jan 2022 22:31:38 +0000
Subject: [PATCH 15/17] release v3.2.1
---
jupyterlab-server-proxy/package.json | 2 +-
1 file changed, 1 insertion(+), 1 deletion(-)
diff --git a/jupyterlab-server-proxy/package.json b/jupyterlab-server-proxy/package.json
index b5a20fa0..dedbb655 100644
--- a/jupyterlab-server-proxy/package.json
+++ b/jupyterlab-server-proxy/package.json
@@ -1,6 +1,6 @@
{
"name": "@jupyterlab/server-proxy",
- "version": "3.2.0",
+ "version": "3.2.1",
"description": "Jupyter server extension to supervise and proxy web services",
"keywords": [
"jupyter",
From d85233cad4b1a556bcedaad393d157600b6d51bb Mon Sep 17 00:00:00 2001
From: Simon Li
Date: Mon, 24 Jan 2022 22:40:53 +0000
Subject: [PATCH 16/17] Fix test\_proxies status code
---
tests/test\_proxies.py | 2 +-
1 file changed, 1 insertion(+), 1 deletion(-)
diff --git a/tests/test\_proxies.py b/tests/test\_proxies.py
index c44295a2..7d780551 100644
--- a/tests/test\_proxies.py
+++ b/tests/test\_proxies.py
@@ -298,7 +298,7 @@ def test\_server\_proxy\_websocket\_subprotocols(event\_loop):
("127.0.0.1/path", 404),
("127.0.0.1@192.168.1.1", 404),
("127.0.0.1@192.168.1.1/path", 404),
- ("user:pass@host:123/foo", 403),
+ ("user:pass@host:123/foo", 404),
("user:pass@host/foo", 404),
("absolute/127.0.0.1:123@192.168.1.1/path", 404),
]
From 4e2d0c894aa3d4f4b9f510a26ca73db81f7d8fc0 Mon Sep 17 00:00:00 2001
From: Simon Li
Date: Mon, 24 Jan 2022 23:06:11 +0000
Subject: [PATCH 17/17] Run publish workflow for tags
Specifying branches means tags must also be specified: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#onpushbranchestagsbranches-ignoretags-ignore
---
.github/workflows/publish.yaml | 2 ++
1 file changed, 2 insertions(+)
diff --git a/.github/workflows/publish.yaml b/.github/workflows/publish.yaml
index f7dc5bac..b7da3360 100644
--- a/.github/workflows/publish.yaml
+++ b/.github/workflows/publish.yaml
@@ -25,6 +25,8 @@ on:
branches-ignore:
- "dependabot/\*\*"
- "pre-commit-ci-update-config"
+ tags:
+ - "\*"
workflow\_dispatch:
jobs:

