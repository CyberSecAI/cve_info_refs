=== Content from jvn.jp_7b3a7229_20250114_201524.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2022/02/22  Last Updated:2022/02/22
# JVN#67108459 EC-CUBE plugin "Mail Magazine Management Plugin" vulnerable to cross-site request forgery

## Overview

EC-CUBE plugin "Mail Magazine Management Plugin" contains a cross-site request forgery vulnerability.

## Products Affected

* Mail Magazine Management Plugin
  + ver4.0.0 to 4.1.1 (for EC-CUBE 4 series)
  + ver1.0.0 to 1.0.4 (for EC-CUBE 3 series)

## Description

EC-CUBE plugin "Mail Magazine Management Plugin" provided by EC-CUBE CO.,LTD. contains a cross-site request forgery vulnerability ([CWE-352](//cwe.mitre.org/data/definitions/352.html)).

## Impact

If a user with an administrative privilege views a malicious page while logged in to EC-CUBE which the plugin is installed, Mail Magazine Templates and/or transmitted history information may be deleted unintendedly.

## Solution

**Update the plugin**

Update the plugin to the latest version according to the information provided by the developer.

The developer has released the following versions.

* ver4.1.2 (for EC-CUBE 4 series)
* ver1.0.5 (for EC-CUBE 3 series)

## Vendor Status

| Vendor | Status | Last Update | Vendor Notes |
| --- | --- | --- | --- |
| EC-CUBE CO.,LTD. | [Vulnerable](491122/index.html) | 2022/02/22 | [EC-CUBE CO.,LTD. website](https://www.ec-cube.net/info/weakness/20220221/mail_magazine_plugin.php) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

CVSS v3
CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:U/C:N/I:L/A:N
Base Score:
3.1

| Attack Vector(AV) | Physical (P) | Local (L) | Adjacent (A) | Network (N) |
| --- | --- | --- | --- | --- |
| Attack Complexity(AC) | High (H) | Low (L) |
| Privileges Required(PR) | High (H) | Low (L) | None (N) |
| User Interaction(UI) | Required (R) | None (N) |
| Scope(S) | Unchanged (U) | Changed (C) |
| Confidentiality Impact(C) | None (N) | Low (L) | High (H) |
| Integrity Impact(I) | None (N) | Low (L) | High (H) |
| Availability Impact(A) | None (N) | Low (L) | High (H) |

CVSS v2
AV:N/AC:H/Au:N/C:N/I:P/A:N
Base Score:
2.6

| Access Vector(AV) | Local (L) | Adjacent Network (A) | Network (N) |
| --- | --- | --- | --- |
| Access Complexity(AC) | High (H) | Medium (M) | Low (L) |
| Authentication(Au) | Multiple (M) | Single (S) | None (N) |
| Confidentiality Impact(C) | None (N) | Partial (P) | Complete (C) |
| Integrity Impact(I) | None (N) | Partial (P) | Complete (C) |
| Availability Impact(A) | None (N) | Partial (P) | Complete (C) |

## Credit

Kenta Yamamoto of Mitsui Bussan Secure Directions, Inc. reported this vulnerability to IPA.

JPCERT/CC coordinated with the developer under Information Security Early Warning Partnership.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2022-21179](https://www.cve.org/CVERecord?id=CVE-2022-21179) |
| JVN iPedia | [JVNDB-2022-000013](https://jvndb.jvn.jp/jvndb/JVNDB-2022-000013) |

* JVN
* [HOME](/en/index.html)
* [What is JVN ?](/en/nav/jvn.html)
* [Instructions](/en/nav/jvnhelp.html)
* [List of Vulnerability Report](/en/report/index.html)
* [VN\_JP](/en/jp/index.html)
* [VN\_JP(Unreachable)](/en/adj/index.html)
* [VN\_VU](/en/vu/index.html)
* [TA](/en/ta/index.html)
* [TRnotes](/en/tr/index.html)
* [JVN iPedia](http://jvndb.jvn.jp/en/)
* [MyJVN](http://jvndb.jvn.jp/en/apis/myjvn/index.html)
* [JVNJS/RSS](/en/rss/index.html)
* [Vendor List](/en/nav/index.html)
* [List of unreachable developers](/en/reply/index.html)
* [Contact](/en/contact/index.html)

Copyright (c) 2000-2022 JPCERT/CC and IPA. All rights reserved.



=== Content from www.ec-cube.net_0d3032ac_20250114_201526.html ===

# EC-CUBE メルマガ管理プラグインにおける CSRFの脆弱性 (JVN#67108459)

##### 更新履歴

2022/02/22 16:00
「脆弱性の概要」に、JVNからの公表内容情報へのリンクを追加
2022/02/21 12:00
プラグイン最新版のリリースに伴い、修正方法1 を更新
謝辞の追加
2022/02/09 13:00
パートナー向けの事前告知としてページ公開

## EC-CUBE メルマガ管理プラグインにおける CSRFの脆弱性のお知らせ

EC-CUBE メルマガ管理プラグインに脆弱性(緊急度: 低)があることが判明いたしました。

脆弱性そのものは、修正ファイルの反映によりすぐに解決するものです。以下のいずれかの方法により、ご対応をお願いいたします。

* 修正方法1: プラグインのバージョンアップを行う場合
* 修正方法2: 修正差分を確認して適宜反映する場合

皆様にはお手数おかけし誠に申し訳ございません。

本脆弱性における被害報告は現時点でございませんが、できるだけ速やかにご対応をお願いいたします。

## 脆弱性の概要

### メルマガ管理プラグインにおける CSRF

#### 危険度:

低

#### 不具合が存在するメルマガ管理プラグインのバージョン:

* 4.0.0〜4.1.1 (EC-CUBE 4系対応)
* 1.0.0〜1.0.4 (EC-CUBE 3系対応)

#### 詳細:

管理画面にログインした状態の管理者権限を持つユーザが、細工されたページに誘導され特定のURLにアクセスした場合、意図せず送信履歴やメルマガテンプレートを削除される CSRF脆弱性。

---

### JVNからの公表内容 (2022/02/22公開)

[JVN#67108459: EC-CUBE 用プラグイン「メルマガ管理プラグイン」におけるクロスサイトリクエストフォージェリの脆弱性](https://jvn.jp/jp/JVN67108459/)

## 修正方法1: プラグインのバージョンアップを行う場合

メルマガ管理プラグインを最新版にバージョンアップしていただくことで、本件の脆弱性は修正されます。

ご利用の方は、速やかにプラグインのバージョンアップをお願いいたします。

#### 修正済みプラグインのバージョン

* **バージョン 4.1.2 (EC-CUBE 4系対応)**
* **バージョン 1.0.5 (EC-CUBE 3系対応)**

## 修正方法2: 修正差分を確認して適宜反映する場合

下記のコード差分情報を参照して頂き、必要な箇所に修正を反映してください。

### 対象バージョン

* **バージョン 4.1.1 (EC-CUBE 4系対応)**
* **バージョン 1.0.4 (EC-CUBE 3系対応)**

### 修正差分

#### ■ バージョン 4.1.1 (EC-CUBE 4系対応)

##### 対象ファイル

* /app/Plugin/MailMagazine4/Controller/MailMagazineHistoryController.php
* /app/Plugin/MailMagazine4/Controller/MailMagazineTemplateController.php
* /app/Plugin/MailMagazine4/Resource/template/admin/history\_list.twig
* /app/Plugin/MailMagazine4/Resource/template/admin/template\_list.twig

 Controller/MailMagazineHistoryController.php
CHANGED

Viewed

|  | @@ -213,6 +213,7 @@ class MailMagazineHistoryController extends AbstractController |
| --- | --- |
| 213 213 | public function delete(MailMagazineSendHistory $mailMagazineSendHistory) |
| 214 214 | { |
| 215 215 | try { |
| 216 | +  $this->isTokenValid(); |
| 216 217 | $id = $mailMagazineSendHistory->getId(); |
| 217 218 | $this->mailMagazineSendHistoryRepository->delete($mailMagazineSendHistory); |
| 218 219 | $this->entityManager->flush(); |

 Controller/MailMagazineTemplateController.php
CHANGED

Viewed

|  | @@ -95,6 +95,7 @@ class MailMagazineTemplateController extends AbstractController |
| --- | --- |
| 95 95 | // パラメータ$idにマッチするデータが存在するか判定 |
| 96 96 | // POSTかつ$idに対応するdtb\_mailmagazine\_templateのレコードがあれば、del\_flg = 1に設定して更新 |
| 97 97 | try { |
| 98 | +  $this->isTokenValid(); |
| 98 99 | $this->mailMagazineTemplateRepository->delete($mailMagazineTemplate); |
| 99 100 | $this->entityManager->flush(); |
| 100 101 | $this->addSuccess('admin.delete.complete', 'admin'); |

 Resource/template/admin/history\_list.twig
CHANGED

Viewed

|  | @@ -76,6 +76,7 @@ $(function () { |
| --- | --- |
| 76 76 |  |
| 77 77 | {% block main %} |
| 78 78 | <form name="form1" id="form1" method="post" action=""> |
| 79 | +  <input type="hidden" name="\_token" value="{{ csrf\_token(constant('Eccube\\Common\\Constant::TOKEN\_NAME')) }}"> |
| 79 80 | <div class="c-outsideBlock\_\_contents mb-5"> |
| 80 81 | {% if pagination %} |
| 81 82 | <span class="font-weight-bold ml-2">{{ 'admin.mailmagazine.history.search\_count'|trans({'%count%':pagination.totalItemCount}) }}</span> |

 Resource/template/admin/template\_list.twig
CHANGED

Viewed

|  | @@ -69,6 +69,7 @@ |
| --- | --- |
| 69 69 | {{ 'common.cancel'|trans }} |
| 70 70 | </button> |
| 71 71 | <form action="{{ url('plugin\_mail\_magazine\_template\_delete', { id: Template.id }) }}" method="post" enctype="application/x-www-form-urlencoded"> |
| 72 | +  <input type="hidden" name="\_token" value="{{ csrf\_token(constant('Eccube\\Common\\Constant::TOKEN\_NAME')) }}"> |
| 72 73 | <button type="submit" class="btn btn-ec-delete"> |
| 73 74 | {{ 'common.delete'|trans }} |
| 74 75 | </button> |

---

#### ■ バージョン 1.0.4 (EC-CUBE 3系対応)

##### 対象ファイル

* /app/Plugin/MailMagazine/Controller/MailMagazineHistoryController.php
* /app/Plugin/MailMagazine/Controller/MailMagazineTemplateController.php
* /app/Plugin/MailMagazine/Resource/template/admin/history\_list.twig
* /app/Plugin/MailMagazine/Resource/template/admin/template\_list.twig

 Controller/MailMagazineHistoryController.php
CHANGED

Viewed

|  | @@ -13,6 +13,7 @@ namespace Plugin\MailMagazine\Controller; |
| --- | --- |
| 13 13 |  |
| 14 14 | use Eccube\Application; |
| 15 15 | use Eccube\Common\Constant; |
| 16 | + use Eccube\Controller\AbstractController; |
| 16 17 | use Eccube\Entity\Master\Pref; |
| 17 18 | use Knp\Component\Pager\Paginator; |
| 18 19 | use Plugin\MailMagazine\Entity\MailMagazineSendHistory; |
|  | @@ -23,7 +24,7 @@ use Symfony\Component\HttpFoundation\Request; |
| 23 24 | use Symfony\Component\HttpKernel\Exception\BadRequestHttpException; |
| 24 25 | use Doctrine\Common\Collections\ArrayCollection; |
| 25 26 |  |
| 26 | - class MailMagazineHistoryController |
| 27 | + class MailMagazineHistoryController extends AbstractController |
| 27 28 | { |
| 28 29 | public function \_\_construct() |
| 29 30 | { |
|  | @@ -234,6 +235,7 @@ class MailMagazineHistoryController |
| 234 235 | \*/ |
| 235 236 | public function delete(Application $app, Request $request, $id) |
| 236 237 | { |
| 238 | +  $this->isTokenValid($app); |
| 237 239 | // POSTかどうか判定 |
| 238 240 | if ('POST' !== $request->getMethod()) { |
| 239 241 | throw new BadRequestHttpException(); |

 Controller/MailMagazineTemplateController.php
CHANGED

Viewed

|  | @@ -12,12 +12,13 @@ |
| --- | --- |
| 12 12 | namespace Plugin\MailMagazine\Controller; |
| 13 13 |  |
| 14 14 | use Eccube\Application; |
| 15 | + use Eccube\Controller\AbstractController; |
| 15 16 | use Plugin\MailMagazine\Entity\MailMagazineTemplate; |
| 16 17 | use Plugin\MailMagazine\Repository\MailMagazineTemplateRepository; |
| 17 18 | use Symfony\Component\HttpFoundation\Request; |
| 18 19 | use Symfony\Component\HttpKernel\Exception\BadRequestHttpException; |
| 19 20 |  |
| 20 | - class MailMagazineTemplateController |
| 21 | + class MailMagazineTemplateController extends AbstractController |
| 21 22 | { |
| 22 23 | public function \_\_construct() |
| 23 24 | { |
|  | @@ -85,6 +86,7 @@ class MailMagazineTemplateController |
| 85 86 | // POSTかどうか判定 |
| 86 87 | // パラメータ$idにマッチするデータが存在するか判定 |
| 87 88 | // POSTかつ$idに対応するdtb\_mailmagazine\_templateのレコードがあれば、del\_flg = 1に設定して更新 |
| 89 | +  $this->isTokenValid($app); |
| 88 90 | if ('POST' === $request->getMethod()) { |
| 89 91 | // idがからの場合はメルマガテンプレート一覧へリダイレクト |
| 90 92 | if (is\_null($id) || strlen($id) == 0) { |

 Resource/template/admin/history\_list.twig
CHANGED

Viewed

|  | @@ -84,6 +84,7 @@ $(function () { |
| --- | --- |
| 84 84 | {% block main %} |
| 85 85 | <form name="form1" id="form1" method="post" action=""> |
| 86 86 |  |
| 87 | + <input type="hidden" name="{{ constant('Eccube\\Common\\Constant::TOKEN\_NAME') }}" value="{{ csrf\_token(constant('Eccube\\Common\\Constant::TOKEN\_NAME')) }}"> |
| 87 88 | {% if pagination %} |
| 88 89 | <div class="row"> |
| 89 90 | <div class="col-md-12"> |

 Resource/template/admin/template\_list.twig
CHANGED

Viewed

|  | @@ -46,6 +46,7 @@ function changeAction(action) { |
| --- | --- |
| 46 46 | </div><!-- /.box-header --> |
| 47 47 | <div class="box-body"> |
| 48 48 | <form name="form1" id="form1" method="post" action=""> |
| 49 | +  <input type="hidden" name="{{ constant('Eccube\\Common\\Constant::TOKEN\_NAME') }}" value="{{ csrf\_token(constant('Eccube\\Common\\Constant::TOKEN\_NAME')) }}"> |
| 49 50 | <div class="table\_list"> |
| 50 51 | <div class="table-responsive with-border"> |
| 51 52 | <table class="table table-striped"> |

### 問い合わせ先

本脆弱性に関するお問合せ：

EC-CUBE 運営チーム

MAIL: [[email protected]](/cdn-cgi/l/email-protection)

### 謝辞

本脆弱性は、三井物産セキュアディレクション株式会社 山本健太様よりご報告いただきました。

この場をお借りして、厚く御礼申し上げます。


