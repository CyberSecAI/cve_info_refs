The provided content relates to CVE-2022-21677.

**Root cause of vulnerability:**
The group advanced search option in Discourse does not respect the group's visibility and members visibility level settings.

**Weaknesses/vulnerabilities present:**
- Information disclosure vulnerability. The advanced group search functionality fails to enforce access control based on group visibility settings.

**Impact of exploitation:**
- Unauthorized users can discover the existence of groups and their members, even when the group and member visibility is restricted to logged-in users, group members, or staff. This could reveal sensitive information about group structures and membership.

**Attack vectors:**
- Network-based attack through the use of the advanced search functionality.

**Required attacker capabilities/position:**
- An attacker only needs network access to the Discourse instance. No specific user privileges are needed to exploit the vulnerability. However, a user interaction is required as they need to perform a search using the vulnerable advanced group search option,  `group:<group_name_or_id>`

**Additional details:**
- The vulnerability was present in Discourse versions `stable <= 2.7.12; beta <= 2.8.0.beta10; tests-passed <= 2.8.0.beta10`.
- The vulnerability was patched in later versions (`stable > 2.7.12; beta > 2.8.0.beta10; tests-passed > 2.8.0.beta10`).
- The vulnerability is assigned a CVSS v3 base score of 4.3, with the following metrics: AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:N/A:N.
- The provided commit diff shows the fix was implemented in the `lib/search.rb` file by modifying the `advanced_filter(/^group:(.+)$/i)` block to use `visible_groups(@guardian.user).members_visible_groups(@guardian.user)` to properly scope the search by the user's permissions
- A test case was added to `spec/components/search_spec.rb` to verify that this logic is properly enforced.