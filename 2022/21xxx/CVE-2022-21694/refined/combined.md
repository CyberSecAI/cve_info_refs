=== Content from github.com_014fcbe7_20250114_223205.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fonionshare%2Fonionshare%2Freleases%2Ftag%2Fv2.5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fonionshare%2Fonionshare%2Freleases%2Ftag%2Fv2.5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=onionshare%2Fonionshare)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[onionshare](/onionshare)
/
**[onionshare](/onionshare/onionshare)**
Public

* [Notifications](/login?return_to=%2Fonionshare%2Fonionshare) You must be signed in to change notification settings
* [Fork
  658](/login?return_to=%2Fonionshare%2Fonionshare)
* [Star
   6.4k](/login?return_to=%2Fonionshare%2Fonionshare)

* [Code](/onionshare/onionshare/tree/v2.5)
* [Issues
  127](/onionshare/onionshare/issues)
* [Pull requests
  17](/onionshare/onionshare/pulls)
* [Actions](/onionshare/onionshare/actions)
* [Wiki](/onionshare/onionshare/wiki)
* [Security](/onionshare/onionshare/security)
* [Insights](/onionshare/onionshare/pulse)

Additional navigation options

* [Code](/onionshare/onionshare/tree/v2.5)
* [Issues](/onionshare/onionshare/issues)
* [Pull requests](/onionshare/onionshare/pulls)
* [Actions](/onionshare/onionshare/actions)
* [Wiki](/onionshare/onionshare/wiki)
* [Security](/onionshare/onionshare/security)
* [Insights](/onionshare/onionshare/pulse)

1. [Releases](/onionshare/onionshare/releases)
2. [v2.5](/onionshare/onionshare/releases/tag/v2.5)

# OnionShare 2.5

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/onionshare/onionshare/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.5)

 Loading

[View all tags](/onionshare/onionshare/tags)

![@micahflee](https://avatars.githubusercontent.com/u/156128?s=40&v=4)
[micahflee](/micahflee)
released this
17 Jan 22:46

[v2.5](/onionshare/onionshare/tree/v2.5)

This tag was signed with the committer‚Äôs **verified signature**.

[![](https://avatars.githubusercontent.com/u/156128?s=64&v=4)](/micahflee)
[micahflee](/micahflee)
Micah Lee

GPG key ID: 403C2657CD994F73

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

[`1385aa0`](/onionshare/onionshare/commit/1385aa068f1ef41f67a0cee4eff61bc126346d4e)

This commit was signed with the committer‚Äôs **verified signature**.

[![](https://avatars.githubusercontent.com/u/156128?s=64&v=4)](/micahflee)
[micahflee](/micahflee)
Micah Lee

GPG key ID: 403C2657CD994F73

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

What's new:

* Security fix: Sanitize the path parameter in History item widget to be plain text
* Security fix: Use microseconds in Receive mode directory creation to avoid potential DoS
* Security fix: Several hardening improvements for session and username management in Chat mode, to prevent impersonation and other issues
* Major feature: Obtain bridges from Moat / BridgeDB (over a domain-fronted Meek client)
* Major feature: Snowflake bridge support
* New feature: Tor connection settings, as well as general settings, are now Tabs rather than dialogs
* New feature: User can customize the Content-Security-Policy header in Website mode
* New feature: Built-in bridges are automatically updated from Tor's API when the user has chosen to use them
* Switch to using our `stem` fork called `cepa`, which is now published on PyPi so we can build it in releases
* Various bug fixes

 Assets
12

 Loading

 üëç
7
 boldrake60, RomelSan, Baccount, NuggaN85, ZeroDot1, SilmorSenedlen, and ivan-bryliant reacted with thumbs up emoji
 üéâ
4
 danrobi11, RooneyMcNibNug, Baccount, and ZeroDot1 reacted with hooray emoji

All reactions

* üëç
  7 reactions
* üéâ
  4 reactions

 9 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_a567ba03_20250114_223206.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fonionshare%2Fonionshare%2Fsecurity%2Fadvisories%2FGHSA-h29c-wcm8-883h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fonionshare%2Fonionshare%2Fsecurity%2Fadvisories%2FGHSA-h29c-wcm8-883h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=onionshare%2Fonionshare)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[onionshare](/onionshare)
/
**[onionshare](/onionshare/onionshare)**
Public

* [Notifications](/login?return_to=%2Fonionshare%2Fonionshare) You must be signed in to change notification settings
* [Fork
  658](/login?return_to=%2Fonionshare%2Fonionshare)
* [Star
   6.4k](/login?return_to=%2Fonionshare%2Fonionshare)

* [Code](/onionshare/onionshare)
* [Issues
  127](/onionshare/onionshare/issues)
* [Pull requests
  17](/onionshare/onionshare/pulls)
* [Actions](/onionshare/onionshare/actions)
* [Wiki](/onionshare/onionshare/wiki)
* [Security](/onionshare/onionshare/security)
* [Insights](/onionshare/onionshare/pulse)

Additional navigation options

* [Code](/onionshare/onionshare)
* [Issues](/onionshare/onionshare/issues)
* [Pull requests](/onionshare/onionshare/pulls)
* [Actions](/onionshare/onionshare/actions)
* [Wiki](/onionshare/onionshare/wiki)
* [Security](/onionshare/onionshare/security)
* [Insights](/onionshare/onionshare/pulse)

# OTF-006: Broken Website Hardening Control: The CSP can be turned on or off but not configured for the specific needs of the website

Low

[micahflee](/micahflee)
published
GHSA-h29c-wcm8-883h
Jan 18, 2022

## Package

OnionShare
(OnionShare)

## Affected versions

>= 2.2

## Patched versions

2.5

## Description

Between September 26, 2021 and October 8, 2021, [Radically Open Security](https://www.radicallyopensecurity.com/) conducted a penetration test of OnionShare 2.4, funded by the Open Technology Fund's [Red Team lab](https://www.opentech.fund/labs/red-team-lab/). This is an issue from that penetration test.

* Vulnerability ID: OTF-006
* Vulnerability type: Broken Website Hardening Control
* Threat level: Low

## Description:

The CSP can be turned on or off but not configured for the specific needs of the website.

## Technical description:

The website mode of the application allows to use a hardened CSP, which will block any scripts and external resources. It is not possible to configure this CSP for individual pages and therefore the security enhancement cannot be used for websites using javascript or external resources like fonts or images.

If CSP were configurable, the website creator could harden it accordingly to the needs of the application.

As this issue correlates with the Github issue for exposing the flask application directly (<https://github.com/onionshare/> [/issues/1389](https://github.com/onionshare/onionshare/issues/1389)), it can be assumed that this can be solved by either changing to a well-known webserver, which supports this kind of configuration, or enhancing the status quo by making the CSP a configurable part of each website.

We believe that bundling the nginx or apache webserver would add complexity and dependencies to the application that could result in a larger attack surface - as these packages receive regular security updates. On the other hand it is not recommended to directly expose the flask webserver, due to lack of hardening. This is a trade-off which needs to be evaluated by the Onionshare developers, as multiple features are involved. Ideally the application user could choose between the built-in flask webserver or a system webserver of choice.

## Impact:

As this is a general weakness and not a direct vulnerability in the Onionshare application, the direct impact of this issue is rather low.

## Recommendation:

* Consider offering a configurable webserver choice
* Consider configurable CSP

### Severity

Low

### CVE ID

CVE-2022-21694

### Weaknesses

No CWEs

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_3f3fcba7_20250114_223204.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fonionshare%2Fonionshare%2Fissues%2F1389)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fonionshare%2Fonionshare%2Fissues%2F1389)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=onionshare%2Fonionshare)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[onionshare](/onionshare)
/
**[onionshare](/onionshare/onionshare)**
Public

* [Notifications](/login?return_to=%2Fonionshare%2Fonionshare) You must be signed in to change notification settings
* [Fork
  658](/login?return_to=%2Fonionshare%2Fonionshare)
* [Star
   6.4k](/login?return_to=%2Fonionshare%2Fonionshare)

* [Code](/onionshare/onionshare)
* [Issues
  127](/onionshare/onionshare/issues)
* [Pull requests
  17](/onionshare/onionshare/pulls)
* [Actions](/onionshare/onionshare/actions)
* [Wiki](/onionshare/onionshare/wiki)
* [Security](/onionshare/onionshare/security)
* [Insights](/onionshare/onionshare/pulse)

Additional navigation options

* [Code](/onionshare/onionshare)
* [Issues](/onionshare/onionshare/issues)
* [Pull requests](/onionshare/onionshare/pulls)
* [Actions](/onionshare/onionshare/actions)
* [Wiki](/onionshare/onionshare/wiki)
* [Security](/onionshare/onionshare/security)
* [Insights](/onionshare/onionshare/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fonionshare%2Fonionshare%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fonionshare%2Fonionshare%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Use nginx as the web service, instead of flask's app.run #1389

Closed

[micahflee](/micahflee) opened this issue
Aug 15, 2021
¬∑ 2 comments
 ¬∑ Fixed by [#1677](https://github.com/onionshare/onionshare/pull/1677)

Closed

# [Use nginx as the web service, instead of flask's app.run](#top) #1389

[micahflee](/micahflee) opened this issue
Aug 15, 2021
¬∑ 2 comments
 ¬∑ Fixed by [#1677](https://github.com/onionshare/onionshare/pull/1677)

Labels
[enhancement](/onionshare/onionshare/labels/enhancement)

## Comments

[![@micahflee](https://avatars.githubusercontent.com/u/156128?s=80&u=f9b65157aeaabb9ae9d3ab72f16ee0439eed256b&v=4)](/micahflee)

Copy link

Collaborator

### **[micahflee](/micahflee)** commented [Aug 15, 2021](#issue-971179095)

| Right now when OnionShare starts a web service, it uses `app.run` to start it directly in flask. I think instead we should launch an `nginx` subprocess and use that along with gunicorn to host the flask app.   * We already have an issue to use gunicorn ([Look into using Gunicorn in front of Flask¬†#1022](https://github.com/onionshare/onionshare/issues/1022)) instead of flask directly, and this will be much simpler if we use nginx * If we use nginx, we can get gzip for free and don't need to gzip everything and fill up `/tmp` ([Allow ability to serve website files directly rather than gzipped copies¬†#1328](https://github.com/onionshare/onionshare/issues/1328)), and I suspect we could simplify a lot of the web server code in other ways too * If we use nginx, we get simple working range requests ([Range requests don't support Tor Browser¬†#1333](https://github.com/onionshare/onionshare/issues/1333)) * If we use nginx and implement the download accelerator ([speed up downloads¬†#1295](https://github.com/onionshare/onionshare/issues/1295)) we get much better performance, e.g. quicker download speeds   Before implementing this, I'm not sure how a few things will work:   * Progress bars. If someone downloads a file from nginx, how can we hook into the real-time file transfer to make progress bars work? * "Stop sharing after files have been sent". How do we know that the files are finished sending? |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
3
 SaptakS, Scripter17, and nyxnor reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

[![@micahflee](https://avatars.githubusercontent.com/u/156128?s=40&u=f9b65157aeaabb9ae9d3ab72f16ee0439eed256b&v=4)](/micahflee)
[micahflee](/micahflee)
added
the
[enhancement](/onionshare/onionshare/labels/enhancement)
label
[Aug 15, 2021](#event-5159936003)

[![@micahflee](https://avatars.githubusercontent.com/u/156128?s=80&u=f9b65157aeaabb9ae9d3ab72f16ee0439eed256b&v=4)](/micahflee)

Copy link

Collaborator

Author

### **[micahflee](/micahflee)** commented [Aug 15, 2021](#issuecomment-899083454)

| We should run a single nginx process on launch, and update the nginx config and reload while using the app, each time a service is started or stopped. We can reload the nginx config using an OS signal: <https://nginx.org/en/docs/control.html>  For monitoring progress of downloads and uploads from nginx, we might need a custom nginx module. Like, maybe this, except with download support too: <https://github.com/masterzen/nginx-upload-progress-module> |
| --- |

All reactions

Sorry, something went wrong.

[![@micahflee](https://avatars.githubusercontent.com/u/156128?s=80&u=f9b65157aeaabb9ae9d3ab72f16ee0439eed256b&v=4)](/micahflee)

Copy link

Collaborator

Author

### **[micahflee](/micahflee)** commented [Aug 16, 2021](#issuecomment-899157264)

| This is going to be trickier than I first realized. I'm working in the nginx branch (<https://github.com/onionshare/onionshare/tree/nginx>) and I've successfully made the CLI version run an nginx process in the background, with the ability to add and remove vhosts.  Next I'm trying to refactor `onionshare_cli/web/web.py`'s `start` and `stop` functions to run the web apps in gunicorn, instead of just running `self.app.run()`.  But it turns out, this means running `gunicorn` subprocesses, and each of those need to run their own subprocesses for each flask app, as opposed to running all of the flask apps in the main onionshare process like it works now.  To run gunicorn you need a subprocess like this:  ``` gunicorn --bind=127.0.0.1 --workers=2 wsgi:application ```  The `wsgi:application` part looks for a module called `wsgi.py` with `application` inside of being the flask app.  A typical `wsgi.py` application might looks like this, in this case importing the flask app `app` from `app.py`:  ``` from app import app as application ```  Right now OnionShare defines a web object, which includes the flask app, and then calls a bunch of functions to modify the flask app (define routes depending on the mode, etc.), and then runs `app.run()` to start the server. This needs to be refactored a bunch of make it possible to run an individual onionshare mode server as a subprocess.  Like, maybe instead of creating a `Web` object in the `onionshare-cli` process, we need a `wsgi.py` and *that* creates the Web object and defines the flask server based on information in environment variables (what mode, port, password, etc.). And then instead of calling `web.start()`, we launch a new `gunicorn` subprocess with the correct environment, which runs `wsgi.py`, which creates the actual web service we want. And to stop it, we send a signal to the gunicorn process to halt.  But if these are all running in different processes now, how can we communicate between the flask apps and the onionshare GUI? Now we have to deal with inter-process communication... |
| --- |

All reactions

Sorry, something went wrong.

[![@mig5](https://avatars.githubusercontent.com/u/99173?s=40&v=4)](/mig5)
[mig5](/mig5)
mentioned this issue
[Mar 8, 2022](#ref-pullrequest-1162214315)

[PoC - Use Waitress instead of Werkzeug for web server
#1545](/onionshare/onionshare/pull/1545)
 Closed

[![@mig5](https://avatars.githubusercontent.com/u/99173?s=40&v=4)](/mig5)
[mig5](/mig5)
mentioned this issue
[Oct 7, 2022](#ref-pullrequest-1400577347)

[Downgrade werkzeug back to 2.0.3 to temporarily deal with the shutdown issue that affects QThread.wait()
#1623](/onionshare/onionshare/pull/1623)
 Merged

[![@SaptakS](https://avatars.githubusercontent.com/u/9530293?s=40&u=abf1860578782aae608eff2ce6ae49390b80a923&v=4)](/SaptakS)
[SaptakS](/SaptakS)
mentioned this issue
[May 24, 2023](#ref-pullrequest-1721083573)

[Update deps & switch to waitress for running flask servers
#1677](/onionshare/onionshare/pull/1677)
 Merged

[![@SaptakS](https://avatars.githubusercontent.com/u/9530293?s=40&u=abf1860578782aae608eff2ce6ae49390b80a923&v=4)](/SaptakS)
[SaptakS](/SaptakS)
closed this as [completed](/onionshare/onionshare/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#1677](/onionshare/onionshare/pull/1677)
[Jun 6, 2023](#event-9442589731)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fonionshare%2Fonionshare%2Fissues%2F1389)

Assignees

No one assigned

Labels

[enhancement](/onionshare/onionshare/labels/enhancement)

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Update deps & switch to waitress for running flask servers](/onionshare/onionshare/pull/1677)
 [onionshare/onionshare](/onionshare/onionshare)

1 participant

[![@micahflee](https://avatars.githubusercontent.com/u/156128?s=52&v=4)](/micahflee)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


