=== Content from github.com_e30559b7_20250115_090846.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPrivateBin%2FPrivateBin%2Fcommit%2F2a4d572c1e9eb9b608d32b0cc0cb3b6c3b684eab)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPrivateBin%2FPrivateBin%2Fcommit%2F2a4d572c1e9eb9b608d32b0cc0cb3b6c3b684eab)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=PrivateBin%2FPrivateBin)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[PrivateBin](/PrivateBin)
/
**[PrivateBin](/PrivateBin/PrivateBin)**
Public

* [Notifications](/login?return_to=%2FPrivateBin%2FPrivateBin) You must be signed in to change notification settings
* [Fork
  839](/login?return_to=%2FPrivateBin%2FPrivateBin)
* [Star
   6.8k](/login?return_to=%2FPrivateBin%2FPrivateBin)

* [Code](/PrivateBin/PrivateBin)
* [Issues
  106](/PrivateBin/PrivateBin/issues)
* [Pull requests
  3](/PrivateBin/PrivateBin/pulls)
* [Discussions](/PrivateBin/PrivateBin/discussions)
* [Actions](/PrivateBin/PrivateBin/actions)
* [Projects
  3](/PrivateBin/PrivateBin/projects)
* [Wiki](/PrivateBin/PrivateBin/wiki)
* [Security](/PrivateBin/PrivateBin/security)
* [Insights](/PrivateBin/PrivateBin/pulse)

Additional navigation options

* [Code](/PrivateBin/PrivateBin)
* [Issues](/PrivateBin/PrivateBin/issues)
* [Pull requests](/PrivateBin/PrivateBin/pulls)
* [Discussions](/PrivateBin/PrivateBin/discussions)
* [Actions](/PrivateBin/PrivateBin/actions)
* [Projects](/PrivateBin/PrivateBin/projects)
* [Wiki](/PrivateBin/PrivateBin/wiki)
* [Security](/PrivateBin/PrivateBin/security)
* [Insights](/PrivateBin/PrivateBin/pulse)

## Commit

[Permalink](/PrivateBin/PrivateBin/commit/2a4d572c1e9eb9b608d32b0cc0cb3b6c3b684eab)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Sanitize SVG preview, preventing script execution in instance context…

[Browse files](/PrivateBin/PrivateBin/tree/2a4d572c1e9eb9b608d32b0cc0cb3b6c3b684eab)
Browse the repository at this point in the history

```
…, while dropping support for attachment download in IE
```

* Loading branch information

[![@elrido](https://avatars.githubusercontent.com/u/1017622?s=40&v=4)](/elrido)

[elrido](/PrivateBin/PrivateBin/commits?author=elrido "View all commits by elrido")
committed
Mar 13, 2022

1 parent
[6c1f0dd](/PrivateBin/PrivateBin/commit/6c1f0dde0c4cccd8e132d27842a3cba556648d02)

commit 2a4d572

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**89 additions**
and
**35 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* js

  + js/privatebin.js
    [privatebin.js](#diff-4c30f267da1a33c8d947890833316f48f2c58b89bc0ae567a469056ce98b96e5)
* tpl

  + tpl/bootstrap.php
    [bootstrap.php](#diff-479e86ec1b65f6f25d4f350eddae96037520f8367e5a3c8403103c29c71c584f)
  + tpl/page.php
    [page.php](#diff-341c534ba580d57c2075ba44cfed578523d2549c8ebd470cd3dd0f676561c4ac)

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/PrivateBin/PrivateBin/blob/2a4d572c1e9eb9b608d32b0cc0cb3b6c3b684eab/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -10,11 +10,13 @@ |
|  |  | \* ADDED: Oracle database support (#868) |
|  |  | \* ADDED: Configuration option to limit paste creation and commenting to certain IPs (#883) |
|  |  | \* ADDED: Set CSP also as meta tag, to deal with misconfigured webservers mangling the HTTP header |
|  |  | \* ADDED: Sanitize SVG preview, preventing script execution in instance context |
|  |  | \* CHANGED: Language selection cookie only transmitted over HTTPS (#472) |
|  |  | \* CHANGED: Upgrading libraries to: base-x 4.0.0, bootstrap 3.4.1 (JS), DOMpurify 2.3.6, ip-lib 1.18.0, jQuery 3.6.0, random\_compat 2.0.21 & Showdown 2.0.0 |
|  |  | \* CHANGED: Removed automatic `.ini` configuration file migration (#808) |
|  |  | \* CHANGED: Removed configurable `dir` for `traffic` & `purge` limiters (#419) |
|  |  | \* CHANGED: Server salt, traffic and purge limiter now stored in the storage backend (#419) |
|  |  | \* CHANGED: Drop support for attachment download in IE |
|  |  | \* \*\*1.3.5 (2021-04-05)\*\* |
|  |  | \* ADDED: Translations for Hebrew, Lithuanian, Indonesian and Catalan |
|  |  | \* ADDED: Make the project info configurable (#681) |
| Expand Down | |  |

118 changes: 85 additions & 33 deletions

118
[js/privatebin.js](#diff-4c30f267da1a33c8d947890833316f48f2c58b89bc0ae567a469056ce98b96e5 "js/privatebin.js")

Show comments

[View file](/PrivateBin/PrivateBin/blob/2a4d572c1e9eb9b608d32b0cc0cb3b6c3b684eab/js/privatebin.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -52,6 +52,31 @@ jQuery.PrivateBin = (function($, RawDeflate) { |
|  |  | \*/ |
|  |  | let z; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* DOMpurify settings for HTML content |
|  |  | \* |
|  |  | \* @private |
|  |  | \*/ |
|  |  | const purifyHtmlConfig = { |
|  |  | ALLOWED\_URI\_REGEXP: /^(?:(?:(?:f|ht)tps?|mailto|magnet):)/i, |
|  |  | SAFE\_FOR\_JQUERY: true, |
|  |  | USE\_PROFILES: { |
|  |  | html: true |
|  |  | } |
|  |  | }; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* DOMpurify settings for SVG content |
|  |  | \* |
|  |  | \* @private |
|  |  | \*/ |
|  |  | const purifySvgConfig = { |
|  |  | USE\_PROFILES: { |
|  |  | svg: true, |
|  |  | svgFilters: true |
|  |  | } |
|  |  | }; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* CryptoData class |
|  |  | \* |
| Expand Down  Expand Up | | @@ -409,7 +434,8 @@ jQuery.PrivateBin = (function($, RawDeflate) { |
|  |  | element.html().replace( |
|  |  | /(((https?|ftp):\/\/[\w?!=&.\/-;#@~%+\*-]+(?![\w\s?!&.\/;#~%"=-]>))|((magnet):[\w?=&.\/-;#@~%+\*-]+))/ig, |
|  |  | '<a href="$1" rel="nofollow noopener noreferrer">$1</a>' |
|  |  | ) |
|  |  | ), |
|  |  | purifyHtmlConfig |
|  |  | ) |
|  |  | ); |
|  |  | }; |
| Expand Down  Expand Up | | @@ -2536,7 +2562,8 @@ jQuery.PrivateBin = (function($, RawDeflate) { |
|  |  | // let showdown convert the HTML and sanitize HTML \*afterwards\*! |
|  |  | $plainText.html( |
|  |  | DOMPurify.sanitize( |
|  |  | converter.makeHtml(text) |
|  |  | converter.makeHtml(text), |
|  |  | purifyHtmlConfig |
|  |  | ) |
|  |  | ); |
|  |  | // add table classes from bootstrap css |
| Expand Down  Expand Up | | @@ -2752,6 +2779,34 @@ jQuery.PrivateBin = (function($, RawDeflate) { |
|  |  | $dropzone; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* get blob URL from string data and mime type |
|  |  | \* |
|  |  | \* @name AttachmentViewer.getBlobUrl |
|  |  | \* @private |
|  |  | \* @function |
|  |  | \* @param {string} data - raw data of attachment |
|  |  | \* @param {string} data - mime type of attachment |
|  |  | \* @return {string} objectURL |
|  |  | \*/ |
|  |  | function getBlobUrl(data, mimeType) |
|  |  | { |
|  |  | // Transform into a Blob |
|  |  | const buf = new Uint8Array(data.length); |
|  |  | for (let i = 0; i < data.length; ++i) { |
|  |  | buf[i] = data.charCodeAt(i); |
|  |  | } |
|  |  | const blob = new window.Blob( |
|  |  | [buf], |
|  |  | { |
|  |  | type: mimeType |
|  |  | } |
|  |  | ); |
|  |  |  |
|  |  | // Get Blob URL |
|  |  | return window.URL.createObjectURL(blob); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* sets the attachment but does not yet show it |
|  |  | \* |
|  |  | \* @name AttachmentViewer.setAttachment |
| Expand All | | @@ -2761,44 +2816,39 @@ jQuery.PrivateBin = (function($, RawDeflate) { |
|  |  | \*/ |
|  |  | me.setAttachment = function(attachmentData, fileName) |
|  |  | { |
|  |  | // data URI format: data:[<mediaType>][;base64],<data> |
|  |  | // data URI format: data:[<mimeType>][;base64],<data> |
|  |  |  |
|  |  | // position in data URI string of where data begins |
|  |  | const base64Start = attachmentData.indexOf(',') + 1; |
|  |  | // position in data URI string of where mediaType ends |
|  |  | const mediaTypeEnd = attachmentData.indexOf(';'); |
|  |  | // position in data URI string of where mimeType ends |
|  |  | const mimeTypeEnd = attachmentData.indexOf(';'); |
|  |  |  |
|  |  | // extract mediaType |
|  |  | const mediaType = attachmentData.substring(5, mediaTypeEnd); |
|  |  | // extract mimeType |
|  |  | const mimeType = attachmentData.substring(5, mimeTypeEnd); |
|  |  | // extract data and convert to binary |
|  |  | const rawData = attachmentData.substring(base64Start); |
|  |  | const decodedData = rawData.length > 0 ? atob(rawData) : ''; |
|  |  |  |
|  |  | // Transform into a Blob |
|  |  | const buf = new Uint8Array(decodedData.length); |
|  |  | for (let i = 0; i < decodedData.length; ++i) { |
|  |  | buf[i] = decodedData.charCodeAt(i); |
|  |  | } |
|  |  | const blob = new window.Blob([ buf ], { type: mediaType }); |
|  |  |  |
|  |  | // Get Blob URL |
|  |  | const blobUrl = window.URL.createObjectURL(blob); |
|  |  |  |
|  |  | // IE does not support setting a data URI on an a element |
|  |  | // Using msSaveBlob to download |
|  |  | if (window.Blob && navigator.msSaveBlob) { |
|  |  | $attachmentLink.off('click').on('click', function () { |
|  |  | navigator.msSaveBlob(blob, fileName); |
|  |  | }); |
|  |  | } else { |
|  |  | $attachmentLink.attr('href', blobUrl); |
|  |  | } |
|  |  | let blobUrl = getBlobUrl(decodedData, mimeType); |
|  |  | $attachmentLink.attr('href', blobUrl); |
|  |  |  |
|  |  | if (typeof fileName !== 'undefined') { |
|  |  | $attachmentLink.attr('download', fileName); |
|  |  | } |
|  |  |  |
|  |  | me.handleBlobAttachmentPreview($attachmentPreview, blobUrl, mediaType); |
|  |  | // sanitize SVG preview |
|  |  | // prevents executing embedded scripts when CSP is not set and user |
|  |  | // right-clicks/long-taps and opens the SVG in a new tab - prevented |
|  |  | // in the preview by use of an img tag, which disables scripts, too |
|  |  | if (mimeType.match(/image\/svg/i)) { |
|  |  | const sanitizedData = DOMPurify.sanitize( |
|  |  | decodedData, |
|  |  | purifySvgConfig |
|  |  | ); |
|  |  | blobUrl = getBlobUrl(sanitizedData, mimeType); |
|  |  | } |
|  |  |  |
|  |  | me.handleBlobAttachmentPreview($attachmentPreview, blobUrl, mimeType); |
|  |  | }; |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -3665,7 +3715,14 @@ jQuery.PrivateBin = (function($, RawDeflate) { |
|  |  | for (let i = 0; i < $head.length; ++i) { |
|  |  | newDoc.write($head[i].outerHTML); |
|  |  | } |
|  |  | newDoc.write('</head><body><pre>' + DOMPurify.sanitize(Helper.htmlEntities(paste)) + '</pre></body></html>'); |
|  |  | newDoc.write( |
|  |  | '</head><body><pre>' + |
|  |  | DOMPurify.sanitize( |
|  |  | Helper.htmlEntities(paste), |
|  |  | purifyHtmlConfig |
|  |  | ) + |
|  |  | '</pre></body></html>' |
|  |  | ); |
|  |  | newDoc.close(); |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -5394,11 +5451,6 @@ jQuery.PrivateBin = (function($, RawDeflate) { |
|  |  | // first load translations |
|  |  | I18n.loadTranslations(); |
|  |  |  |
|  |  | DOMPurify.setConfig({ |
|  |  | ALLOWED\_URI\_REGEXP: /^(?:(?:(?:f|ht)tps?|mailto|magnet):)/i, |
|  |  | SAFE\_FOR\_JQUERY: true |
|  |  | }); |
|  |  |  |
|  |  | // Add a hook to make all links open a new window |
|  |  | DOMPurify.addHook('afterSanitizeAttributes', function(node) { |
|  |  | // set all elements owning target to target=\_blank |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[tpl/bootstrap.php](#diff-479e86ec1b65f6f25d4f350eddae96037520f8367e5a3c8403103c29c71c584f "tpl/bootstrap.php")

Show comments

[View file](/PrivateBin/PrivateBin/blob/2a4d572c1e9eb9b608d32b0cc0cb3b6c3b684eab/tpl/bootstrap.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -73,7 +73,7 @@ |
|  |  | ?> |
|  |  | <script type="text/javascript" data-cfasync="false" src="js/purify-2.3.6.js" integrity="sha512-N1GGPjbqLbwK821ZN7C925WuTwU4aDxz2CEEOXQ6/s6m6MBwVj8fh5fugiE2hzsm0xud3q7jpjZQ4ILnpMREYQ==" crossorigin="anonymous"></script> |
|  |  | <script type="text/javascript" data-cfasync="false" src="js/legacy.js?<?php echo rawurlencode($VERSION); ?>" integrity="sha512-LYos+qXHIRqFf5ZPNphvtTB0cgzHUizu2wwcOwcwz/VIpRv9lpcBgPYz4uq6jx0INwCAj6Fbnl5HoKiLufS2jg==" crossorigin="anonymous"></script> |
|  |  | <script type="text/javascript" data-cfasync="false" src="js/privatebin.js?<?php echo rawurlencode($VERSION); ?>" integrity="sha512-EdUms2nI12Cmtv014stIEBlyPjeKMHlkg7NiBJup1b7jJF5amKhev2RwTaldINXK4UaWbZtQ6hGuMPNvvNQZFA==" crossorigin="anonymous"></script> |
|  |  | <script type="text/javascript" data-cfasync="false" src="js/privatebin.js?<?php echo rawurlencode($VERSION); ?>" integrity="sha512-5fNML95dptjIMzFG4KAGE2nNbORbyrCWq4ql9tkvoUF2HSnemlxzngQ5PlWhpi0J2ttKIEqfGMBjU5MywzzdWQ==" crossorigin="anonymous"></script> |
|  |  | <!-- icon --> |
|  |  | <link rel="apple-touch-icon" href="<?php echo I18n::encode($BASEPATH); ?>img/apple-touch-icon.png" sizes="180x180" /> |
|  |  | <link rel="icon" type="image/png" href="img/favicon-32x32.png" sizes="32x32" /> |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[tpl/page.php](#diff-341c534ba580d57c2075ba44cfed578523d2549c8ebd470cd3dd0f676561c4ac "tpl/page.php")

Show comments

[View file](/PrivateBin/PrivateBin/blob/2a4d572c1e9eb9b608d32b0cc0cb3b6c3b684eab/tpl/page.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,7 +51,7 @@ |
|  |  | ?> |
|  |  | <script type="text/javascript" data-cfasync="false" src="js/purify-2.3.6.js" integrity="sha512-N1GGPjbqLbwK821ZN7C925WuTwU4aDxz2CEEOXQ6/s6m6MBwVj8fh5fugiE2hzsm0xud3q7jpjZQ4ILnpMREYQ==" crossorigin="anonymous"></script> |
|  |  | <script type="text/javascript" data-cfasync="false" src="js/legacy.js?<?php echo rawurlencode($VERSION); ?>" integrity="sha512-LYos+qXHIRqFf5ZPNphvtTB0cgzHUizu2wwcOwcwz/VIpRv9lpcBgPYz4uq6jx0INwCAj6Fbnl5HoKiLufS2jg==" crossorigin="anonymous"></script> |
|  |  | <script type="text/javascript" data-cfasync="false" src="js/privatebin.js?<?php echo rawurlencode($VERSION); ?>" integrity="sha512-EdUms2nI12Cmtv014stIEBlyPjeKMHlkg7NiBJup1b7jJF5amKhev2RwTaldINXK4UaWbZtQ6hGuMPNvvNQZFA==" crossorigin="anonymous"></script> |
|  |  | <script type="text/javascript" data-cfasync="false" src="js/privatebin.js?<?php echo rawurlencode($VERSION); ?>" integrity="sha512-5fNML95dptjIMzFG4KAGE2nNbORbyrCWq4ql9tkvoUF2HSnemlxzngQ5PlWhpi0J2ttKIEqfGMBjU5MywzzdWQ==" crossorigin="anonymous"></script> |
|  |  | <!-- icon --> |
|  |  | <link rel="apple-touch-icon" href="img/apple-touch-icon.png?<?php echo rawurlencode($VERSION); ?>" sizes="180x180" /> |
|  |  | <link rel="icon" type="image/png" href="img/favicon-32x32.png?<?php echo rawurlencode($VERSION); ?>" sizes="32x32" /> |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2a4d572`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPrivateBin%2FPrivateBin%2Fcommit%2F2a4d572c1e9eb9b608d32b0cc0cb3b6c3b684eab) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_baf74ef8_20250115_090847.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPrivateBin%2FPrivateBin%2Fsecurity%2Fadvisories%2FGHSA-cqcc-mm6x-vmvw)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPrivateBin%2FPrivateBin%2Fsecurity%2Fadvisories%2FGHSA-cqcc-mm6x-vmvw)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=PrivateBin%2FPrivateBin)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[PrivateBin](/PrivateBin)
/
**[PrivateBin](/PrivateBin/PrivateBin)**
Public

* [Notifications](/login?return_to=%2FPrivateBin%2FPrivateBin) You must be signed in to change notification settings
* [Fork
  839](/login?return_to=%2FPrivateBin%2FPrivateBin)
* [Star
   6.8k](/login?return_to=%2FPrivateBin%2FPrivateBin)

* [Code](/PrivateBin/PrivateBin)
* [Issues
  106](/PrivateBin/PrivateBin/issues)
* [Pull requests
  3](/PrivateBin/PrivateBin/pulls)
* [Discussions](/PrivateBin/PrivateBin/discussions)
* [Actions](/PrivateBin/PrivateBin/actions)
* [Projects
  3](/PrivateBin/PrivateBin/projects)
* [Wiki](/PrivateBin/PrivateBin/wiki)
* [Security](/PrivateBin/PrivateBin/security)
* [Insights](/PrivateBin/PrivateBin/pulse)

Additional navigation options

* [Code](/PrivateBin/PrivateBin)
* [Issues](/PrivateBin/PrivateBin/issues)
* [Pull requests](/PrivateBin/PrivateBin/pulls)
* [Discussions](/PrivateBin/PrivateBin/discussions)
* [Actions](/PrivateBin/PrivateBin/actions)
* [Projects](/PrivateBin/PrivateBin/projects)
* [Wiki](/PrivateBin/PrivateBin/wiki)
* [Security](/PrivateBin/PrivateBin/security)
* [Insights](/PrivateBin/PrivateBin/pulse)

# Persistent Cross-site Scripting (XSS) vulnerability in SVG attachments in PrivateBin < v1.4.0

Moderate

[elrido](/elrido)
published
GHSA-cqcc-mm6x-vmvw
Apr 9, 2022

## Package

composer

privatebin
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

>= v0.21, < v1.4.0

## Patched versions

v1.4.0

docker

privatebin/gcs
([Docker](/advisories?query=ecosystem%3Adocker))

>= v0.21,< v1.4.0

v1.4.0

docker

privatebin/nginx-fpm-alpine
([Docker](/advisories?query=ecosystem%3Adocker))

>= v0.21, < v1.4.0

v1.4.0

docker

privatebin/pdo
([Docker](/advisories?query=ecosystem%3Adocker))

>= v0.21, < v1.4.0

v1.4.0

## Description

In PrivateBin < v1.4.0 a cross-site scripting (XSS) vulnerability was found. The vulnerability is present since attachments with image preview got introduced in v0.21 of the project, which was at the time still called ZeroBin. The issue is caused by the fact that SVGs can contain JavaScript. This can allow an attacker to execute code, if the user opens a paste with a specifically crafted SVG attachment, and interacts with the preview image and the instance isn't protected by an appropriate content security policy.

As a consequence, we have mitigated the vulnerability in the preview and urge server administrators to either **upgrade** to a version with the fix or to ensure the content security policy of their instance is set correctly, ideally both. Additionally, we expanded our [directory listing tool with a checking mechanism](https://privatebin.info/directory/check) and **highly suggest server administrators to check their instance there** and, should there be a warning regarding the content security policy **adjust the CSP to our suggested one**, as it is shown in the configuration preset.

## Proof of concept

The vulnerability can be triggered as following:

1. Create the following SVG as a file:

```
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg">
 <polygon id="triangle" points="0,0 0,50 50,0" fill="#009900" stroke="#004400"/>
 <script type="text/javascript">
   alert(document.domain);
 </script>
</svg>
```

2. Upload it as an attachment to a PrivateBin instance that has attachments enabled and hasn't set the recommended content security policy (in particular, one that has either no content security policy set or that allows `*` or `blob:` as a `script-src`).
3. Open the paste. (In a real attack scenario this would be done by the victim.)
4. The SVG is rendered safely as a preview, and script isn't yet executed.
5. Now (depending on your device) right-click or long tap on the image and open it in a new tab.
6. Now a `blob:` URI opens in a new tab with the image and the modal is shown, therefore the script got executed.

## Impact

We tried to reproduce the vulnerability and in our assessment, we found out the following:

1. Any users who use our recommended *Content Security Policy* (CSP), even older, less strict ones, are **not affected** by this vulnerability, if a [CSP compatible browser](https://caniuse.com/contentsecuritypolicy) is used. All the browsers we tested with did pass on the CSP to the new tab that is opened when viewing the SVG by itself.

   As PrivateBin ships with a [built-in CSP](https://github.com/PrivateBin/PrivateBin/wiki/Configuration#cspheader), we consider this a strong defence in depth against these and related issues. That said, we think the CSP should only be the last layer of defence and as such, we decided to still apply further mitigations for this security issue.
2. Instances that do not have attachments enabled, are not affected. Even when attachments are uploaded using a third-party client, they can't be rendered when the administrator disables them (the HTML element that they would render in isn't present and before 1.4 this caused an error, we now catch the error and only display the paste text) and thus potential exploits in the attachment file do not apply.
3. The inline preview (step 4 above) does *not* execute the script, because [browsers explicitly restrict SVGs if the they are is embedded in an `img` tag](https://developer.mozilla.org/en-US/docs/Web/SVG/SVG_as_an_Image#restrictions) to prevent such security issues in images. Thus, [SVGs in `img` tags itself can be considered safe](https://www.w3.org/TR/CSP2/#which-policy-applies).

   However, when the user opens the SVG in a new tab, this browser security feature is circumvented. That's why the exploit steps above explain to open the SVG in a new tab. That being said, the impact of the vulnerability is reduced by two factors:
   1. The attack explicitly requires **user-interaction**, i.e. the user has to be tricked into opening the preview in a new tab for some reason. This could realistically be achieved with some social engineering: The markdown formatted text part of the paste could include such an instruction as a big, bold title, or the SVG could be very large and have very small text, which the user might want to zoom into, in order to read.
   2. Potential exploit code can only run in a new tab. It still has the same origin (as can be seen in the PoC above, because the domain/origin the script is running on, is shown). However, though, sensitive information like the paste content, potential comments or encryption key (in the URL) is not accessible to the attacker as the context is now a blob-URL – and would anyway consist mostly of things the attacker initially created itself.

      That said, [the same origin policy applies](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy) and thus, what an attacker could do is read e.g. cookies and local storage data saved in the same origin. As PrivateBin itself does not use any of that, the impact of this vulnerability is limited. However, as PrivateBin is a software for self-hosting, it cannot be excluded that other services run in the same origin (e.g. on the same domain). That's why server administrators may need to evaluate the impact of running arbitrary JavaScript code on their domain/origin where PrivateBin is hosted by themselves.

To summarize, this shows a fairly limited impact, given even if the CSP had not caught the issue, the user still needs to interact with the page and the exploit code cannot access or exfiltrate any data of the PrivateBin instance.

**Note:** However, take our assessment only as a basis for your own assessment. As explained, depending on your environment, the actual risk may vary if you are hosting other services on the same domain as PrivateBin.

As for the metrics, the impact assessment we have done with [CVSS v3.1](https://nvd.nist.gov/vuln-metrics/cvss) results in this:

[AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:N/A:N/E:F/RL:U/RC:C/CR:X/IR:X/AR:X/MAV:N/MAC:L/MPR:N/MUI:R/MS:U/MC:X/MI:X/MA:X](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:N/A:N/E:F/RL:U/RC:C/CR:X/IR:X/AR:X/MAV:N/MAC:L/MPR:N/MUI:R/MS:U/MC:X/MI:X/MA:X&version=3.1)

### Real-life impact

We found two affected instances in our instance lists (wiki, directory) that did not serve a correct Content Security Policy header, had attachments enabled and thus are vulnerable to this attack. We didn't manage to get into contact with the administrators of these sites, though.

In addition to that, we found that multiple instances do seem to either strip our CSP or have it changed to an unsafe setting and have thus expanded our directory service to verify whether our recommend CSP is used or not. (see below)

We have no reports that indicate this vulnerability was or is being actively exploited at the time of this report.

## Patches

To fix the problem, we took the following measures (in no particular order):

* We apply [DOMpurify](https://github.com/cure53/DOMPurify/) (a library we already use to sanitize user-submitted HTML via the Markdown format) to the SVG preview, too. It strips script tags and other uncommon security-relevant and potentially malicious tags/properties from the SVG file.

  So whether you open the SVG in a new tab or not and whether CSP is present and enabled or not does not matter any more, as the displayed SVG is sanitized.
* As a further defence in depth mechanism we now send the CSP both as an HTTP header, as well as a meta tag. This protects instance with mis-configured web servers, CDNs, proxy or similar, from stripping or breaking the CSP headers, as they still get the CSP inside of the HTML content itself. Please note though, that the [meta tag approach is not as strong as the HTTP header approach](https://content-security-policy.com/examples/meta/) and should thus only be considered as a fallback.
* The [PrivateBin Directory](https://privatebin.info/) now also scans whether the recommend Content-Security-Policy header is used on a given instance. If you do not want to have your website appear in the list, but check it manually [you can use a separate check page](https://privatebin.info/directory/check) there.

The code-changes in PrivateBin can be found in [#906](https://github.com/PrivateBin/PrivateBin/pull/906).

**Note:** Please note that we explicitly chose to *not* apply *DOMPurify* if you download the (SVG) attachment with the download button. Subsequently, if a user would manually opens the downloaded SVG in the browser, it will be opened from the `file://` protocol and thus from a [different origin](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy), so all reference to the download location is lost and no more security risk is associated with that, than opening any website or local HTML file. Thus, the SVG file with stay intact in it's original form, if you download the attachment.

We consider the execution of code from attachments outside of the PrivateBin instance's context to be out of scope to mitigate (i.e. malware in executables, office documents macros, PDF scripts), as all of these require client side mitigations to be applied to all such downloaded file types, independent on where they get downloaded from.

## Workarounds

We strongly recommend you to upgrade to our latest release, especially as we also upgraded outdated and potential vulnerable libraries (see below). However, here are two workarounds that may help you to mitigate this vulnerability:

* Update the [CSP in your configuration file](https://github.com/PrivateBin/PrivateBin/wiki/Configuration#cspheader) to the latest recommended settings and check that it isn't getting reverted or overwritten by your web server, reverse proxy or CDN, i.e. using [our offered check service](https://privatebin.info/directory/check).
* Deploying PrivateBin on a separate domain may limit the scope of the vulnerability to PrivateBin itself and thus, as described in the “Impact” section, effectively prevent any damage by the vulnerability to other resources you are hosting.
* As explained in the impact assessment, disabling attachments also prevents this issue.

## References

We highly encourage server administrators and others involved with the PrivateBin project to read-up on how Content-Security-Policies work, especially should you consider to manually adjust it:

* <https://content-security-policy.com/>
* <https://developer.mozilla.org/docs/Web/HTTP/CSP>
* <https://developers.google.com/web/fundamentals/security/csp/>

Also please note that if multiple headers are set (as e.g. done via our now introduced meta tag) [browsers should apply the most restrictive set of the policies](https://stackoverflow.com/a/51153816/5008962), [as per the CSP specification](https://www.w3.org/TR/CSP2/#enforcing-multiple-policies).

## For more information

Please notice we also upgraded [jQuery](https://github.com/PrivateBin/PrivateBin/pull/880) that was reported to us as being vulnerable both by [our automated container security scanning](https://github.com/PrivateBin/docker-nginx-fpm-alpine/issues/69#issue-1006943396) as well as [by users](https://github.com/PrivateBin/PrivateBin/issues/864).

By doing so, we also updated all [other dependencies we use](https://github.com/PrivateBin/PrivateBin/pull/888). Our tooling identified the following vulnerabilities in jQuery:

* [CVE-2020-11023](https://github.com/advisories/GHSA-jpcq-cgw6-v4j6 "CVE-2020-11023")
* [CVE-2020-11022](https://github.com/advisories/GHSA-gxr4-xjj5-5px2 "CVE-2020-11022")

In [a limited assessment about these when we were made aware of them](https://github.com/PrivateBin/docker-nginx-fpm-alpine/issues/69#issuecomment-928261418) we could not find any immediate risk, but nevertheless, we encourage users to upgrade to be on the safe side.

Finally, we also [upgraded zlib](https://github.com/PrivateBin/PrivateBin/pull/909) to address [CVE-2018-25032](https://github.com/advisories/GHSA-jc36-42cf-vqwj "CVE-2018-25032").

## Timeline

* 2022-02-22 – Initial contact by reporter.
* 2022-02-25 – Reporter sends in a detailed report.
* 2022-02-26 – Report gets reviewed, initial findings around the content security get shared and reporter withdraws report.
* 2022-04-09 – Vulnerability details published.

## Credits

This vulnerability was reported by Ian Budd, [Nethemba s.r.o](https://www.nethemba.com/), which we'd like to thank for that.

In general, we'd like to thank everyone reporting issues and potential vulnerabilities to us.

If you think you have found a vulnerability or potential security risk, [we'd kindly ask you to follow our security policy](https://github.com/PrivateBin/PrivateBin/blob/master/SECURITY.md) and report it to us. We then assess the report and will take the actions we deem necessary to address it.

### Severity

Moderate

4.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:N/A:N

### CVE ID

CVE-2022-24833

### Weaknesses

[CWE-79](/advisories?query=cwe%3A79) [CWE-80](/advisories?query=cwe%3A80)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


