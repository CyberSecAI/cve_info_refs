=== Content from github.com_359aa8ef_20250115_094441.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnode-formidable%2Fformidable%2Fissues%2F808)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnode-formidable%2Fformidable%2Fissues%2F808)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=node-formidable%2Fformidable)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[node-formidable](/node-formidable)
/
**[formidable](/node-formidable/formidable)**
Public

* [Notifications](/login?return_to=%2Fnode-formidable%2Fformidable) You must be signed in to change notification settings
* [Fork
  681](/login?return_to=%2Fnode-formidable%2Fformidable)
* [Star
   7.1k](/login?return_to=%2Fnode-formidable%2Fformidable)

* [Code](/node-formidable/formidable)
* [Issues
  34](/node-formidable/formidable/issues)
* [Pull requests
  15](/node-formidable/formidable/pulls)
* [Discussions](/node-formidable/formidable/discussions)
* [Actions](/node-formidable/formidable/actions)
* [Security](/node-formidable/formidable/security)
* [Insights](/node-formidable/formidable/pulse)

Additional navigation options

* [Code](/node-formidable/formidable)
* [Issues](/node-formidable/formidable/issues)
* [Pull requests](/node-formidable/formidable/pulls)
* [Discussions](/node-formidable/formidable/discussions)
* [Actions](/node-formidable/formidable/actions)
* [Security](/node-formidable/formidable/security)
* [Insights](/node-formidable/formidable/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnode-formidable%2Fformidable%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnode-formidable%2Fformidable%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# uniq filenames #808

Closed

[jimmywarting](/jimmywarting) opened this issue
Jan 2, 2022
¬∑ 3 comments

Closed

# [uniq filenames](#top) #808

[jimmywarting](/jimmywarting) opened this issue
Jan 2, 2022
¬∑ 3 comments

Labels
[wontfix](/node-formidable/formidable/labels/wontfix)
This will not be worked on

## Comments

[![@jimmywarting](https://avatars.githubusercontent.com/u/1148376?s=80&u=97348b862d4820275f7e7567ad64a72edfec1443&v=4)](/jimmywarting)

Copy link

Collaborator

### **[jimmywarting](/jimmywarting)** commented [Jan 2, 2022](#issue-1092106352)

| Whenever i encounter a "need to generate a uniq filename" and including dependencies and so forth like hexoid to generate them   [formidable/package.json](https://github.com/node-formidable/formidable/blob/1618ea060326d8c510cf19f06600b79186c84f98/package.json#L34)  Line 34 in [1618ea0](/node-formidable/formidable/commit/1618ea060326d8c510cf19f06600b79186c84f98)   |  | "hexoid": "1.0.0", | | --- | --- |     and seeing stuff like:  [formidable/src/Formidable.js](https://github.com/node-formidable/formidable/blob/1618ea060326d8c510cf19f06600b79186c84f98/src/Formidable.js#L517)  Line 517 in [1618ea0](/node-formidable/formidable/commit/1618ea060326d8c510cf19f06600b79186c84f98)   |  | // prevent directory traversal attacks | | --- | --- |      Then i might sometimes link to this article: <https://advancedweb.hu/secure-tempfiles-in-nodejs-without-dependencies/>   ---   [fsPromise.mkdtemp](https://nodejs.org/dist/latest-v17.x/docs/api/fs.html#fspromisesmkdtempprefix-options) is suppose to help you with this...  how about instead generate one uniq dir with `mkdtemp` and simple use the filename n+1 instead (without extension)?  ``` const uploadDir = await fs.mkdtemp(await fs.realpath(os.tmpdir()) + path.sep); ```  my proposal: remove hexoid |
| --- | --- | --- | --- | --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@GrosSacASac](https://avatars.githubusercontent.com/u/5721194?s=80&u=92d772a85f0f3ecd75b4f933fe3bd0b12a80a68b&v=4)](/GrosSacASac)

Copy link

Contributor

### **[GrosSacASac](/GrosSacASac)** commented [Jan 3, 2022](#issuecomment-1003811941)

| Replace hexoid with crypto module ?  As for directory traversal attacks tentative, they can only occur if options.filename is used, in which case the dev already opted out of formidable name generation.  The uploadDir should not be temp because files are made for multiple reuse, the default however is os.tmpdir() which contradicts , but I think only for tests reason (I think most people don't use the default)  If the dev wants to not store the file he can use options.fileWriteStreamHandler. |
| --- |

 üëç
1
 tunnckoCore reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@GrosSacASac](https://avatars.githubusercontent.com/u/5721194?s=40&u=92d772a85f0f3ecd75b4f933fe3bd0b12a80a68b&v=4)](/GrosSacASac)
[GrosSacASac](/GrosSacASac)
added
[area: file naming](/node-formidable/formidable/labels/area%3A%20file%20naming)
labels
[Jan 4, 2022](#event-5837769813)

[![@tunnckoCore](https://avatars.githubusercontent.com/u/5038030?s=80&u=e42c0a921f9da47a2ce9703899d8cc913d12b84b&v=4)](/tunnckoCore)

Copy link

Member

### **[tunnckoCore](/tunnckoCore)** commented [Jan 7, 2022](#issuecomment-1007090762) ‚Ä¢ edited Loading

| Hexoid is used only for filenames I think, and the reason is better naming and safer defaults. Avoiding the bad names and characters, Windows defaults, and what not.  I think using something small and efficient like `cuid` or `hexoid` is a lot better than the `crypto` module. They are optimized, they are small, they does great job exactly for such cases. And it's better for bundling cases.  The defaults are safe and secure. Changing comes with responsibility to handle additional things, and reading more docs, as always. We can't, should not, and won't do everything on user's behalf. If you don't want the files or want to "clean up after", just don't write them to the disk in the first place, that's the `options.fileWriteStreamHandler` option for.  But thanks for the suggestions üòâ |
| --- |

All reactions

Sorry, something went wrong.

[![@tunnckoCore](https://avatars.githubusercontent.com/u/5038030?s=40&u=e42c0a921f9da47a2ce9703899d8cc913d12b84b&v=4)](/tunnckoCore)
[tunnckoCore](/tunnckoCore)
removed
[question](/node-formidable/formidable/labels/question)
labels
[Apr 2, 2022](#event-6357509864)

[![@tunnckoCore](https://avatars.githubusercontent.com/u/5038030?s=80&u=e42c0a921f9da47a2ce9703899d8cc913d12b84b&v=4)](/tunnckoCore)

Copy link

Member

### **[tunnckoCore](/tunnckoCore)** commented [Apr 2, 2022](#issuecomment-1086743509)

| User responsibility. We provide sane defaults. And yes, it helps for such attacks, at least to some extent. There's far more stupid shit out there that does NOTHING about such things.  Things will change soon anyway.  Closing. |
| --- |

All reactions

Sorry, something went wrong.

[![@tunnckoCore](https://avatars.githubusercontent.com/u/5038030?s=40&u=e42c0a921f9da47a2ce9703899d8cc913d12b84b&v=4)](/tunnckoCore)
[tunnckoCore](/tunnckoCore)
closed this as [completed](/node-formidable/formidable/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Apr 2, 2022](#event-6357533194)

[![@tunnckoCore](https://avatars.githubusercontent.com/u/5038030?s=40&u=e42c0a921f9da47a2ce9703899d8cc913d12b84b&v=4)](/tunnckoCore)
[tunnckoCore](/tunnckoCore)
added
the
[wontfix](/node-formidable/formidable/labels/wontfix)
This will not be worked on
label
[Apr 2, 2022](#event-6357533307)

[davidmehren](/davidmehren)
pushed a commit
to hedgedoc/hedgedoc
that referenced
this issue
[Apr 10, 2022](#ref-commit-9e2f9e2)
[![@SISheogorath](https://avatars.githubusercontent.com/u/8719867?s=40&u=0b93728e3a79ccd01963e3ddb5569efda6ce5778&v=4)](/SISheogorath) [![@davidmehren](https://avatars.githubusercontent.com/u/5023650?s=40&v=4)](/davidmehren)

`[fix(imageRouter): Fix enumerable image upload issue](/hedgedoc/hedgedoc/commit/9e2f9e21e904c4a319e84265da7ef03b0a8e343a "fix(imageRouter): Fix enumerable image upload issue

This patch adds an own filename function for `formidable`, which will
make sure to generate a random file name, using UUIDv4. This should
resolve GHSA-q6vv-2q26-j7rx.

This change is required due to a change in behaviour from version 1 to
version 2 of formidable. Formidable version 2 will generate predictable
filenames by default, which results in potential access to images, that
were uploaded while formidable v2 was used in Hedgedoc. This affects the
versions `1.9.1` and `1.9.2`.

Files generated previous to this commit will look like this:

```
<random string generated on app start><counter>.<file-extension>
38e56506ec2dcab52e9282c00.jpg
38e56506ec2dcab52e9282c01.jpg
38e56506ec2dcab52e9282c02.jpg
```

After this patch it'll look like this:

```
<uuid v4>.<file-extension>
a67f36b8-9afb-43c2-9ef2-a567a77d8628.jpg
56b3d5d0-c586-4679-9ae6-d2044843c2cd.jpg
2af727ac-a2d4-4aad-acb5-73596c2a7eb6.jpg
```

This patch was implemented using `uuid` since we already utilise this
package elsewhere in the project as well as using a secure function to
generate random strings. UUIDv4 is ideal for that. In order to be
consumable by formidable, it was wrapped in a function that makes sure
to keep the file extension.

This vulnerability was reported by Matias from [NCSC-FI](https://www.kyberturvallisuuskeskus.fi/).

References:
https://github.com/node-formidable/formidable/blob/v2-latest/src/Formidable.js#L574
https://github.com/node-formidable/formidable/issues/808#issuecomment-1007090762
https://www.npmjs.com/package/uuid")`
‚Ä¶

`[9e2f9e2](/hedgedoc/hedgedoc/commit/9e2f9e21e904c4a319e84265da7ef03b0a8e343a)`

```
This patch adds an own filename function for `formidable`, which will
make sure to generate a random file name, using UUIDv4. This should
resolve [GHSA-q6vv-2q26-j7rx](https://github.com/hedgedoc/hedgedoc/security/advisories/GHSA-q6vv-2q26-j7rx "GHSA-q6vv-2q26-j7rx").

This change is required due to a change in behaviour from version 1 to
version 2 of formidable. Formidable version 2 will generate predictable
filenames by default, which results in potential access to images, that
were uploaded while formidable v2 was used in Hedgedoc. This affects the
versions `1.9.1` and `1.9.2`.

Files generated previous to this commit will look like this:

```
<random string generated on app start><counter>.<file-extension>
38e56506ec2dcab52e9282c00.jpg
38e56506ec2dcab52e9282c01.jpg
38e56506ec2dcab52e9282c02.jpg
```

After this patch it'll look like this:

```
<uuid v4>.<file-extension>
a67f36b8-9afb-43c2-9ef2-a567a77d8628.jpg
56b3d5d0-c586-4679-9ae6-d2044843c2cd.jpg
2af727ac-a2d4-4aad-acb5-73596c2a7eb6.jpg
```

This patch was implemented using `uuid` since we already utilise this
package elsewhere in the project as well as using a secure function to
generate random strings. UUIDv4 is ideal for that. In order to be
consumable by formidable, it was wrapped in a function that makes sure
to keep the file extension.

This vulnerability was reported by Matias from [NCSC-FI](<https://www.kyberturvallisuuskeskus.fi/>).

References:
<https://github.com/node-formidable/formidable/blob/v2-latest/src/Formidable.js#L574>
[node-formidable/formidable#808 (comment)](https://github.com/node-formidable/formidable/issues/808#issuecomment-1007090762)
<https://www.npmjs.com/package/uuid>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnode-formidable%2Fformidable%2Fissues%2F808)

Assignees

No one assigned

Labels

[wontfix](/node-formidable/formidable/labels/wontfix)
This will not be worked on

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

3 participants

[![@jimmywarting](https://avatars.githubusercontent.com/u/1148376?s=52&v=4)](/jimmywarting) [![@tunnckoCore](https://avatars.githubusercontent.com/u/5038030?s=52&v=4)](/tunnckoCore) [![@GrosSacASac](https://avatars.githubusercontent.com/u/5721194?s=52&v=4)](/GrosSacASac)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_585c8535_20250115_094438.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhedgedoc%2Fhedgedoc%2Fcommit%2F9e2f9e21e904c4a319e84265da7ef03b0a8e343a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhedgedoc%2Fhedgedoc%2Fcommit%2F9e2f9e21e904c4a319e84265da7ef03b0a8e343a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=hedgedoc%2Fhedgedoc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hedgedoc](/hedgedoc)
/
**[hedgedoc](/hedgedoc/hedgedoc)**
Public

* [Notifications](/login?return_to=%2Fhedgedoc%2Fhedgedoc) You must be signed in to change notification settings
* [Fork
  412](/login?return_to=%2Fhedgedoc%2Fhedgedoc)
* [Star
   5.4k](/login?return_to=%2Fhedgedoc%2Fhedgedoc)

* [Code](/hedgedoc/hedgedoc)
* [Issues
  233](/hedgedoc/hedgedoc/issues)
* [Pull requests
  18](/hedgedoc/hedgedoc/pulls)
* [Actions](/hedgedoc/hedgedoc/actions)
* [Projects
  1](/hedgedoc/hedgedoc/projects)
* [Security](/hedgedoc/hedgedoc/security)
* [Insights](/hedgedoc/hedgedoc/pulse)

Additional navigation options

* [Code](/hedgedoc/hedgedoc)
* [Issues](/hedgedoc/hedgedoc/issues)
* [Pull requests](/hedgedoc/hedgedoc/pulls)
* [Actions](/hedgedoc/hedgedoc/actions)
* [Projects](/hedgedoc/hedgedoc/projects)
* [Security](/hedgedoc/hedgedoc/security)
* [Insights](/hedgedoc/hedgedoc/pulse)

## Commit

[Permalink](/hedgedoc/hedgedoc/commit/9e2f9e21e904c4a319e84265da7ef03b0a8e343a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix(imageRouter): Fix enumerable image upload issue

[Browse files](/hedgedoc/hedgedoc/tree/9e2f9e21e904c4a319e84265da7ef03b0a8e343a)
Browse the repository at this point in the history

```
This patch adds an own filename function for `formidable`, which will
make sure to generate a random file name, using UUIDv4. This should
resolve [GHSA-q6vv-2q26-j7rx](https://github.com/hedgedoc/hedgedoc/security/advisories/GHSA-q6vv-2q26-j7rx "GHSA-q6vv-2q26-j7rx").

This change is required due to a change in behaviour from version 1 to
version 2 of formidable. Formidable version 2 will generate predictable
filenames by default, which results in potential access to images, that
were uploaded while formidable v2 was used in Hedgedoc. This affects the
versions `1.9.1` and `1.9.2`.

Files generated previous to this commit will look like this:

```
<random string generated on app start><counter>.<file-extension>
38e56506ec2dcab52e9282c00.jpg
38e56506ec2dcab52e9282c01.jpg
38e56506ec2dcab52e9282c02.jpg
```

After this patch it'll look like this:

```
<uuid v4>.<file-extension>
a67f36b8-9afb-43c2-9ef2-a567a77d8628.jpg
56b3d5d0-c586-4679-9ae6-d2044843c2cd.jpg
2af727ac-a2d4-4aad-acb5-73596c2a7eb6.jpg
```

This patch was implemented using `uuid` since we already utilise this
package elsewhere in the project as well as using a secure function to
generate random strings. UUIDv4 is ideal for that. In order to be
consumable by formidable, it was wrapped in a function that makes sure
to keep the file extension.

This vulnerability was reported by Matias from [NCSC-FI](<https://www.kyberturvallisuuskeskus.fi/>).

References:
<https://github.com/node-formidable/formidable/blob/v2-latest/src/Formidable.js#L574>
[node-formidable/formidable#808 (comment)](https://github.com/node-formidable/formidable/issues/808#issuecomment-1007090762)
<https://www.npmjs.com/package/uuid>
```

* Loading branch information

[![@SISheogorath](https://avatars.githubusercontent.com/u/8719867?s=40&v=4)](/SISheogorath) [![@davidmehren](https://avatars.githubusercontent.com/u/5023650?s=40&v=4)](/davidmehren)

[SISheogorath](/hedgedoc/hedgedoc/commits?author=SISheogorath "View all commits by SISheogorath")
authored and
[davidmehren](/hedgedoc/hedgedoc/commits?author=davidmehren "View all commits by davidmehren")
committed
Apr 10, 2022

1 parent
[8dbb92d](/hedgedoc/hedgedoc/commit/8dbb92d063b37973fc4914266c5f4abc2127c508)

commit 9e2f9e2

Showing
**1 changed file**
with
**8 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

9 changes: 8 additions & 1 deletion

9
[lib/web/imageRouter/index.js](#diff-b38b7cc4c1215e7f538fc163e0f7878e66eae2efe0ef995a9d36453ae15aff61 "lib/web/imageRouter/index.js")

Show comments

[View file](/hedgedoc/hedgedoc/blob/9e2f9e21e904c4a319e84265da7ef03b0a8e343a/lib/web/imageRouter/index.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,6 +4,7 @@ const Router = require('express').Router |
|  |  | const formidable = require('formidable') |
|  |  | const path = require('path') |
|  |  | const fs = require('fs') |
|  |  | const { v4: uuidv4 } = require('uuid'); |
|  |  | const os = require('os') |
|  |  | const rimraf = require('rimraf') |
|  |  | const isSvg = require('is-svg') |
| Expand Down  Expand Up | | @@ -70,7 +71,13 @@ imageRouter.post('/uploadimage', function (req, res) { |
|  |  | const tmpDir = fs.mkdtempSync(path.join(os.tmpdir(), 'hedgedoc-')) |
|  |  | const form = formidable({ |
|  |  | keepExtensions: true, |
|  |  | uploadDir: tmpDir |
|  |  | uploadDir: tmpDir, |
|  |  | filename: function(filename, ext) { |
|  |  | if (typeof ext !== "string") { |
|  |  | ext = ".invalid" |
|  |  | } |
|  |  | return uuidv4() + ext |
|  |  | } |
|  |  | }) |
|  |  |  |
|  |  | form.parse(req, async function (err, fields, files) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9e2f9e2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhedgedoc%2Fhedgedoc%2Fcommit%2F9e2f9e21e904c4a319e84265da7ef03b0a8e343a) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_83d13966_20250115_094439.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhedgedoc%2Fhedgedoc%2Fsecurity%2Fadvisories%2FGHSA-q6vv-2q26-j7rx)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhedgedoc%2Fhedgedoc%2Fsecurity%2Fadvisories%2FGHSA-q6vv-2q26-j7rx)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=hedgedoc%2Fhedgedoc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hedgedoc](/hedgedoc)
/
**[hedgedoc](/hedgedoc/hedgedoc)**
Public

* [Notifications](/login?return_to=%2Fhedgedoc%2Fhedgedoc) You must be signed in to change notification settings
* [Fork
  412](/login?return_to=%2Fhedgedoc%2Fhedgedoc)
* [Star
   5.4k](/login?return_to=%2Fhedgedoc%2Fhedgedoc)

* [Code](/hedgedoc/hedgedoc)
* [Issues
  233](/hedgedoc/hedgedoc/issues)
* [Pull requests
  18](/hedgedoc/hedgedoc/pulls)
* [Actions](/hedgedoc/hedgedoc/actions)
* [Projects
  1](/hedgedoc/hedgedoc/projects)
* [Security](/hedgedoc/hedgedoc/security)
* [Insights](/hedgedoc/hedgedoc/pulse)

Additional navigation options

* [Code](/hedgedoc/hedgedoc)
* [Issues](/hedgedoc/hedgedoc/issues)
* [Pull requests](/hedgedoc/hedgedoc/pulls)
* [Actions](/hedgedoc/hedgedoc/actions)
* [Projects](/hedgedoc/hedgedoc/projects)
* [Security](/hedgedoc/hedgedoc/security)
* [Insights](/hedgedoc/hedgedoc/pulse)

# Enumerable upload file names

Moderate

[davidmehren](/davidmehren)
published
GHSA-q6vv-2q26-j7rx
Apr 10, 2022

## Package

hedgedoc

## Affected versions

>=1.9.1,<1.9.3

## Patched versions

1.9.3

## Description

### Impact

Images uploaded with HedgeDoc version 1.9.1 and later have an enumerable filename after the upload, resulting in potential information leakage of uploaded documents. This is especially relevant for private notes and affects all upload backends, except Lutim and imgur.

### Patches

This issue is patched in version 1.9.3 by replacing the filename generation with UUIDv4.

```
--- a/lib/web/imageRouter/index.js
+++ b/lib/web/imageRouter/index.js
@@ -4,6 +4,7 @@ const Router = require('express').Router
 const formidable = require('formidable')
 const path = require('path')
 const fs = require('fs')
+const { v4: uuidv4 } = require('uuid');
 const os = require('os')
 const rimraf = require('rimraf')
 const isSvg = require('is-svg')
@@ -70,7 +71,13 @@ imageRouter.post('/uploadimage', function (req, res) {
   const tmpDir = fs.mkdtempSync(path.join(os.tmpdir(), 'hedgedoc-'))
   const form = formidable({
     keepExtensions: true,
-    uploadDir: tmpDir
+    uploadDir: tmpDir,
+    filename: function(filename, ext) {
+        if (typeof ext !== "string") {
+            ext = ".invalid"
+        }
+        return uuidv4() + ext
+    }
   })

   form.parse(req, async function (err, fields, files) {

```
### Workarounds

If you cannot upgrade to HedgeDoc 1.9.3, it is possible to block POST requests to `/uploadimage`, which will disable future uploads.

### References

[node-formidable/formidable#808 (comment)](https://github.com/node-formidable/formidable/issues/808#issuecomment-1007090762)

### More information

HedgeDoc 1.9.2 upgraded to [`formidable`](https://github.com/node-formidable/formidable) 2, which switched to using [hexoid](https://github.com/lukeed/hexoid) to generate upload filenames. While hexoid-generated strings look random, [they are generated](https://github.com/lukeed/hexoid/blob/master/src/index.js) using a random prefix concatenated with a counter, making them enumerable. The prefix is regenerated on startup and after 256 uploads.

### Attribution

This issue was reported by the [NCSC-FI](https://www.kyberturvallisuuskeskus.fi/).

If you have any questions or comments about this advisory:

* Open a topic on [our community forum](https://community.hedgedoc.org)
* Join our [matrix room](https://chat.hedgedoc.org)

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N

### CVE ID

CVE-2022-24837

### Weaknesses

[CWE-200](/advisories?query=cwe%3A200)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


