=== Content from github.com_270af693_20250115_090150.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdigitalbazaar%2Fforge%2Fsecurity%2Fadvisories%2FGHSA-cfm4-qjh2-4765)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdigitalbazaar%2Fforge%2Fsecurity%2Fadvisories%2FGHSA-cfm4-qjh2-4765)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=digitalbazaar%2Fforge)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[digitalbazaar](/digitalbazaar)
/
**[forge](/digitalbazaar/forge)**
Public

* [Notifications](/login?return_to=%2Fdigitalbazaar%2Fforge) You must be signed in to change notification settings
* [Fork
  794](/login?return_to=%2Fdigitalbazaar%2Fforge)
* [Star
   5.1k](/login?return_to=%2Fdigitalbazaar%2Fforge)

* [Code](/digitalbazaar/forge)
* [Issues
  386](/digitalbazaar/forge/issues)
* [Pull requests
  58](/digitalbazaar/forge/pulls)
* [Actions](/digitalbazaar/forge/actions)
* [Projects
  0](/digitalbazaar/forge/projects)
* [Wiki](/digitalbazaar/forge/wiki)
* [Security](/digitalbazaar/forge/security)
* [Insights](/digitalbazaar/forge/pulse)

Additional navigation options

* [Code](/digitalbazaar/forge)
* [Issues](/digitalbazaar/forge/issues)
* [Pull requests](/digitalbazaar/forge/pulls)
* [Actions](/digitalbazaar/forge/actions)
* [Projects](/digitalbazaar/forge/projects)
* [Wiki](/digitalbazaar/forge/wiki)
* [Security](/digitalbazaar/forge/security)
* [Insights](/digitalbazaar/forge/pulse)

# RSA PKCS#1 v1.5 signature verification leniency in checking `digestAlgorithm` structure can lead to signature forgery.

High

[davidlehn](/davidlehn)
published
GHSA-cfm4-qjh2-4765
Mar 17, 2022

## Package

npm

node-forge
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

< 1.3.0

## Patched versions

1.3.0

## Description

### Impact

RSA PKCS#1 v1.5 signature verification code is lenient in checking the digest algorithm structure. This can allow a crafted structure that steals padding bytes and uses unchecked portion of the PKCS#1 encoded message to forge a signature when a low public exponent is being used.

### Patches

The issue has been addressed in `node-forge` `1.3.0`.

### References

For more information, please see

["Bleichenbacher's RSA signature forgery based on implementation error"](https://mailarchive.ietf.org/arch/msg/openpgp/5rnE9ZRN1AokBVj3VqblGlP63QE/)

by Hal Finney.

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [forge](https://github.com/digitalbazaar/forge)
* Email us at example email address

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
High

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N

### CVE ID

CVE-2022-24771

### Weaknesses

[CWE-347](/advisories?query=cwe%3A347)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5b4ba485_20250115_090149.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdigitalbazaar%2Fforge%2Fcommit%2F3f0b49a0573ef1bb7af7f5673c0cfebf00424df1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdigitalbazaar%2Fforge%2Fcommit%2F3f0b49a0573ef1bb7af7f5673c0cfebf00424df1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=digitalbazaar%2Fforge)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[digitalbazaar](/digitalbazaar)
/
**[forge](/digitalbazaar/forge)**
Public

* [Notifications](/login?return_to=%2Fdigitalbazaar%2Fforge) You must be signed in to change notification settings
* [Fork
  794](/login?return_to=%2Fdigitalbazaar%2Fforge)
* [Star
   5.1k](/login?return_to=%2Fdigitalbazaar%2Fforge)

* [Code](/digitalbazaar/forge)
* [Issues
  386](/digitalbazaar/forge/issues)
* [Pull requests
  58](/digitalbazaar/forge/pulls)
* [Actions](/digitalbazaar/forge/actions)
* [Projects
  0](/digitalbazaar/forge/projects)
* [Wiki](/digitalbazaar/forge/wiki)
* [Security](/digitalbazaar/forge/security)
* [Insights](/digitalbazaar/forge/pulse)

Additional navigation options

* [Code](/digitalbazaar/forge)
* [Issues](/digitalbazaar/forge/issues)
* [Pull requests](/digitalbazaar/forge/pulls)
* [Actions](/digitalbazaar/forge/actions)
* [Projects](/digitalbazaar/forge/projects)
* [Wiki](/digitalbazaar/forge/wiki)
* [Security](/digitalbazaar/forge/security)
* [Insights](/digitalbazaar/forge/pulse)

## Commit

[Permalink](/digitalbazaar/forge/commit/3f0b49a0573ef1bb7af7f5673c0cfebf00424df1)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix signature verification issues.

[Browse files](/digitalbazaar/forge/tree/3f0b49a0573ef1bb7af7f5673c0cfebf00424df1)
Browse the repository at this point in the history

```
**SECURITY**: Three RSA PKCS#1 v1.5 signature verification issues were
reported by Moosa Yahyazadeh (moosa-yahyazadeh@uiowa.edu):

- Leniency in checking `digestAlgorithm` structure can lead to signature
  forgery.
  - The code is lenient in checking the digest algorithm structure. This can
    allow a crafted structure that steals padding bytes and uses unchecked
    portion of the PKCS#1 encoded message to forge a signature when a low
    public exponent is being used.
- Failing to check tailing garbage bytes can lead to signature forgery.
  - The code does not check for tailing garbage bytes after decoding a
    `DigestInfo` ASN.1 structure. This can allow padding bytes to be removed
    and garbage data added to forge a signature when a low public exponent is
    being used.
- Leniency in checking type octet.
  - `DigestInfo` is not properly checked for proper ASN.1 structure. This can
    lead to successful verification with signatures that contain invalid
    structures but a valid digest.

For more information, please see "Bleichenbacher's RSA signature forgery based
on implementation error" by Hal Finney:
<https://mailarchive.ietf.org/arch/msg/openpgp/5rnE9ZRN1AokBVj3VqblGlP63QE/>

Fixed with the following:

- [asn1] `fromDer` is now more strict and will default to ensuring all
  input bytes are parsed or throw an error. A new option `parseAllBytes`
  can disable this behavior.
  - **NOTE**: The previous behavior is being changed since it can lead
    to security issues with crafted inputs. It is possible that code
    doing custom DER parsing may need to adapt to this new behavior and
    optional flag.
- [rsa] Add and use a validator to check for proper structure of parsed
  ASN.1 `RSASSA-PKCS-v1_5` `DigestInfo` data. Additionally check that
  the hash algorithm identifier is a known value. An invalid
  `DigestInfo` or algorithm identifier will now cause an error to be
  thrown.
- [oid] Added `1.2.840.113549.2.2` / `md2` for hash algorithm checking.
- [tests] Tests were added for all of the reported issues. A private
  verify option was added to assist in checking multiple possible
  failures in the test data.
```

* Loading branch information

[![@davidlehn](https://avatars.githubusercontent.com/u/109587?s=40&v=4)](/davidlehn)

[davidlehn](/digitalbazaar/forge/commits?author=davidlehn "View all commits by davidlehn")
committed
Mar 17, 2022

1 parent
[c20f309](/digitalbazaar/forge/commit/c20f309311d83445e11abe7c313cc4b467c18914)

commit 3f0b49a

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**284 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* lib

  + lib/asn1.js
    [asn1.js](#diff-136ed7f11184414a6ad935a5cc631d47b57ece1be14a5cdee5ba93f2997b14a7)
  + lib/oids.js
    [oids.js](#diff-ceae9b744847f17f6ce90ca90a9e58ad29101b9f233193ce937110fb395808e9)
  + lib/rsa.js
    [rsa.js](#diff-572806cb0eac1a6b5eb635b8afc4a98e5857e63b5f56f02f56c14dcb73a9d39c)
* tests/unit

  + tests/unit/rsa.js
    [rsa.js](#diff-adb506ec2fbb5d231b7c58265908466c45927009c209c581abbb44dad3586b9c)

## There are no files selected for viewing

38 changes: 38 additions & 0 deletions

38
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/digitalbazaar/forge/blob/3f0b49a0573ef1bb7af7f5673c0cfebf00424df1/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -3,8 +3,46 @@ Forge ChangeLog |
|  |  |  |
|  |  | ## 1.3.0 - 2022-XXX |
|  |  |  |
|  |  | ### Security |
|  |  | - \*\*SECURITY\*\*: Three RSA PKCS#1 v1.5 signature verification issues were |
|  |  | reported by Moosa Yahyazadeh (moosa-yahyazadeh@uiowa.edu). |
|  |  | - Leniency in checking `digestAlgorithm` structure can lead to signature |
|  |  | forgery. |
|  |  | - The code is lenient in checking the digest algorithm structure. This can |
|  |  | allow a crafted structure that steals padding bytes and uses unchecked |
|  |  | portion of the PKCS#1 encoded message to forge a signature when a low |
|  |  | public exponent is being used. For more information, please see |
|  |  | ["Bleichenbacher's RSA signature forgery based on implementation |
|  |  | error"](https://mailarchive.ietf.org/arch/msg/openpgp/5rnE9ZRN1AokBVj3VqblGlP63QE/) |
|  |  | by Hal Finney. |
|  |  | - Failing to check tailing garbage bytes can lead to signature forgery. |
|  |  | - The code does not check for tailing garbage bytes after decoding a |
|  |  | `DigestInfo` ASN.1 structure. This can allow padding bytes to be removed |
|  |  | and garbage data added to forge a signature when a low public exponent is |
|  |  | being used. For more information, please see ["Bleichenbacher's RSA |
|  |  | signature forgery based on implementation |
|  |  | error"](https://mailarchive.ietf.org/arch/msg/openpgp/5rnE9ZRN1AokBVj3VqblGlP63QE/) |
|  |  | by Hal Finney. |
|  |  | - Leniency in checking type octet. |
|  |  | - `DigestInfo` is not properly checked for proper ASN.1 structure. This can |
|  |  | lead to successful verification with signatures that contain invalid |
|  |  | structures but a valid digest. |
|  |  |  |
|  |  | ### Fixed |
|  |  | - [asn1] Add fallback to pretty print invalid UTF8 data. |
|  |  | - [asn1] `fromDer` is now more strict and will default to ensuring all input |
|  |  | bytes are parsed or throw an error. A new option `parseAllBytes` can disable |
|  |  | this behavior. |
|  |  | - \*\*NOTE\*\*: The previous behavior is being changed since it can lead to |
|  |  | security issues with crafted inputs. It is possible that code doing custom |
|  |  | DER parsing may need to adapt to this new behavior and optional flag. |
|  |  | - [rsa] Add and use a validator to check for proper structure of parsed ASN.1 |
|  |  | `RSASSA-PKCS-v1\_5` `DigestInfo` data. Additionally check that the hash |
|  |  | algorithm identifier is a known value. An invalid `DigestInfo` or algorithm |
|  |  | identifier will now cause an error to be thrown. |
|  |  |  |
|  |  | ### Added |
|  |  | - [oid] Added `1.2.840.113549.2.2` / `md2` for hash algorithm checking. |
|  |  |  |
|  |  | ## 1.2.1 - 2022-01-11 |
|  |  |  |
| Expand Down | |  |

19 changes: 18 additions & 1 deletion

19
[lib/asn1.js](#diff-136ed7f11184414a6ad935a5cc631d47b57ece1be14a5cdee5ba93f2997b14a7 "lib/asn1.js")

Show comments

[View file](/digitalbazaar/forge/blob/3f0b49a0573ef1bb7af7f5673c0cfebf00424df1/lib/asn1.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -411,31 +411,40 @@ var \_getValueLength = function(bytes, remaining) { |
|  |  | \* @param [options] object with options or boolean strict flag |
|  |  | \* [strict] true to be strict when checking value lengths, false to |
|  |  | \* allow truncated values (default: true). |
|  |  | \* [parseAllBytes] true to ensure all bytes are parsed |
|  |  | \* (default: true) |
|  |  | \* [decodeBitStrings] true to attempt to decode the content of |
|  |  | \* BIT STRINGs (not OCTET STRINGs) using strict mode. Note that |
|  |  | \* without schema support to understand the data context this can |
|  |  | \* erroneously decode values that happen to be valid ASN.1. This |
|  |  | \* flag will be deprecated or removed as soon as schema support is |
|  |  | \* available. (default: true) |
|  |  | \* |
|  |  | \* @throws Will throw an error for various malformed input conditions. |
|  |  | \* |
|  |  | \* @return the parsed asn1 object. |
|  |  | \*/ |
|  |  | asn1.fromDer = function(bytes, options) { |
|  |  | if(options === undefined) { |
|  |  | options = { |
|  |  | strict: true, |
|  |  | parseAllBytes: true, |
|  |  | decodeBitStrings: true |
|  |  | }; |
|  |  | } |
|  |  | if(typeof options === 'boolean') { |
|  |  | options = { |
|  |  | strict: options, |
|  |  | parseAllBytes: true, |
|  |  | decodeBitStrings: true |
|  |  | }; |
|  |  | } |
|  |  | if(!('strict' in options)) { |
|  |  | options.strict = true; |
|  |  | } |
|  |  | if(!('parseAllBytes' in options)) { |
|  |  | options.parseAllBytes = true; |
|  |  | } |
|  |  | if(!('decodeBitStrings' in options)) { |
|  |  | options.decodeBitStrings = true; |
|  |  | } |
| Expand All | | @@ -445,7 +454,15 @@ asn1.fromDer = function(bytes, options) { |
|  |  | bytes = forge.util.createBuffer(bytes); |
|  |  | } |
|  |  |  |
|  |  | return \_fromDer(bytes, bytes.length(), 0, options); |
|  |  | var byteCount = bytes.length(); |
|  |  | var value = \_fromDer(bytes, bytes.length(), 0, options); |
|  |  | if(options.parseAllBytes && bytes.length() !== 0) { |
|  |  | var error = new Error('Unparsed DER bytes remain after ASN.1 parsing.'); |
|  |  | error.byteCount = byteCount; |
|  |  | error.remaining = bytes.length(); |
|  |  | throw error; |
|  |  | } |
|  |  | return value; |
|  |  | }; |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[lib/oids.js](#diff-ceae9b744847f17f6ce90ca90a9e58ad29101b9f233193ce937110fb395808e9 "lib/oids.js")

Show comments

[View file](/digitalbazaar/forge/blob/3f0b49a0573ef1bb7af7f5673c0cfebf00424df1/lib/oids.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -47,6 +47,7 @@ \_IN('1.3.14.3.2.29', 'sha1WithRSASignature'); |
|  |  | \_IN('2.16.840.1.101.3.4.2.1', 'sha256'); |
|  |  | \_IN('2.16.840.1.101.3.4.2.2', 'sha384'); |
|  |  | \_IN('2.16.840.1.101.3.4.2.3', 'sha512'); |
|  |  | \_IN('1.2.840.113549.2.2', 'md2'); |
|  |  | \_IN('1.2.840.113549.2.5', 'md5'); |
|  |  |  |
|  |  | // pkcs#7 content types |
| Expand Down | |  |

80 changes: 77 additions & 3 deletions

80
[lib/rsa.js](#diff-572806cb0eac1a6b5eb635b8afc4a98e5857e63b5f56f02f56c14dcb73a9d39c "lib/rsa.js")

Show comments

[View file](/digitalbazaar/forge/blob/3f0b49a0573ef1bb7af7f5673c0cfebf00424df1/lib/rsa.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -264,6 +264,40 @@ var publicKeyValidator = forge.pki.rsa.publicKeyValidator = { |
|  |  | }] |
|  |  | }; |
|  |  |  |
|  |  | // validator for a DigestInfo structure |
|  |  | var digestInfoValidator = { |
|  |  | name: 'DigestInfo', |
|  |  | tagClass: asn1.Class.UNIVERSAL, |
|  |  | type: asn1.Type.SEQUENCE, |
|  |  | constructed: true, |
|  |  | value: [{ |
|  |  | name: 'DigestInfo.DigestAlgorithm', |
|  |  | tagClass: asn1.Class.UNIVERSAL, |
|  |  | type: asn1.Type.SEQUENCE, |
|  |  | constructed: true, |
|  |  | value: [{ |
|  |  | name: 'DigestInfo.DigestAlgorithm.algorithmIdentifier', |
|  |  | tagClass: asn1.Class.UNIVERSAL, |
|  |  | type: asn1.Type.OID, |
|  |  | constructed: false, |
|  |  | capture: 'algorithmIdentifier' |
|  |  | }, { |
|  |  | // NULL paramters |
|  |  | name: 'DigestInfo.DigestAlgorithm.parameters', |
|  |  | tagClass: asn1.Class.UNIVERSAL, |
|  |  | type: asn1.Type.NULL, |
|  |  | constructed: false |
|  |  | }] |
|  |  | }, { |
|  |  | // digest |
|  |  | name: 'DigestInfo.digest', |
|  |  | tagClass: asn1.Class.UNIVERSAL, |
|  |  | type: asn1.Type.OCTETSTRING, |
|  |  | constructed: false, |
|  |  | capture: 'digest' |
|  |  | }] |
|  |  | }; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Wrap digest in DigestInfo object. |
|  |  | \* |
| Expand Down  Expand Up | | @@ -1092,25 +1126,65 @@ pki.setRsaPublicKey = pki.rsa.setPublicKey = function(n, e) { |
|  |  | \* a Forge PSS object for RSASSA-PSS, |
|  |  | \* 'NONE' or null for none, DigestInfo will not be expected, but |
|  |  | \* PKCS#1 v1.5 padding will still be used. |
|  |  | \* @param options optional verify options |
|  |  | \* \_parseAllDigestBytes testing flag to control parsing of all |
|  |  | \* digest bytes. Unsupported and not for general usage. |
|  |  | \* (default: true) |
|  |  | \* |
|  |  | \* @return true if the signature was verified, false if not. |
|  |  | \*/ |
|  |  | key.verify = function(digest, signature, scheme) { |
|  |  | key.verify = function(digest, signature, scheme, options) { |
|  |  | if(typeof scheme === 'string') { |
|  |  | scheme = scheme.toUpperCase(); |
|  |  | } else if(scheme === undefined) { |
|  |  | scheme = 'RSASSA-PKCS1-V1\_5'; |
|  |  | } |
|  |  | if(options === undefined) { |
|  |  | options = { |
|  |  | \_parseAllDigestBytes: true |
|  |  | }; |
|  |  | } |
|  |  | if(!('\_parseAllDigestBytes' in options)) { |
|  |  | options.\_parseAllDigestBytes = true; |
|  |  | } |
|  |  |  |
|  |  | if(scheme === 'RSASSA-PKCS1-V1\_5') { |
|  |  | scheme = { |
|  |  | verify: function(digest, d) { |
|  |  | // remove padding |
|  |  | d = \_decodePkcs1\_v1\_5(d, key, true); |
|  |  | // d is ASN.1 BER-encoded DigestInfo |
|  |  | var obj = asn1.fromDer(d); |
|  |  | var obj = asn1.fromDer(d, { |
|  |  | parseAllBytes: options.\_parseAllDigestBytes |
|  |  | }); |
|  |  |  |
|  |  | // validate DigestInfo |
|  |  | var capture = {}; |
|  |  | var errors = []; |
|  |  | if(!asn1.validate(obj, digestInfoValidator, capture, errors)) { |
|  |  | var error = new Error( |
|  |  | 'ASN.1 object does not contain a valid RSASSA-PKCS1-v1\_5 ' + |
|  |  | 'DigestInfo value.'); |
|  |  | error.errors = errors; |
|  |  | throw error; |
|  |  | } |
|  |  | // check hash algorithm identifier |
|  |  | // FIXME: add support to vaidator for strict value choices |
|  |  | var oid = asn1.derToOid(capture.algorithmIdentifier); |
|  |  | if(!(oid === forge.oids.md2 || |
|  |  | oid === forge.oids.md5 || |
|  |  | oid === forge.oids.sha1 || |
|  |  | oid === forge.oids.sha256 || |
|  |  | oid === forge.oids.sha384 || |
|  |  | oid === forge.oids.sha512)) { |
|  |  | var error = new Error( |
|  |  | 'Unknown RSASSA-PKCS1-v1\_5 DigestAlgorithm identifier.'); |
|  |  | error.oid = oid; |
|  |  | throw error; |
|  |  | } |
|  |  |  |
|  |  | // compare the given digest to the decrypted one |
|  |  | return digest === obj.value[1].value; |
|  |  | return digest === capture.digest; |
|  |  | } |
|  |  | }; |
|  |  | } else if(scheme === 'NONE' || scheme === 'NULL' || scheme === null) { |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3f0b49a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdigitalbazaar%2Fforge%2Fcommit%2F3f0b49a0573ef1bb7af7f5673c0cfebf00424df1) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


