=== Content from lists.debian.org_142776c0_20250115_102912.html ===


---

[[Date Prev](msg00010.html)][[Date Next](msg00012.html)]
[[Thread Prev](msg00010.html)][[Thread Next](msg00012.html)]
[[Date Index](maillist.html#00011)]
[[Thread Index](threads.html#00011)]

# [SECURITY] [DLA 3000-1] waitress security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3000-1] waitress security update
* *From*: Stefano Rivera <stefanor@debian.org>
* *Date*: Thu, 12 May 2022 17:44:22 -0400
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/20220512214422.7c4r35o5ubr5edhb%40haydn.kardiogramm.net)Â [20220512214422.7c4r35o5ubr5edhb@haydn.kardiogramm.net](msg00011.html)>
* *Mail-followup-to*: Stefano Rivera <stefanor@debian.org>, debian-lts-announce@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3000-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                       Stefano Rivera
May 12, 2022                                  <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : waitress
Version        : 1.0.1-1+deb9u1
CVE ID         : CVE-2019-16785 CVE-2019-16786 CVE-2019-16789 CVE-2019-16792
                 CVE-2022-24761
Debian Bug     : 1008013

Waitress is a Python WSGI server, an application server for Python web apps.

Security updates to fix request smuggling bugs, when combined with another http
proxy that interprets requests differently. This can lead to a potential for
HTTP request smuggling/splitting whereby Waitress may see two requests while
the front-end server only sees a single HTTP message.  This can result in cache
poisoning or unexpected information disclosure.

CVE-2019-16785

    Only recognise CRLF as a line-terminator, not a plain LF. Before this
    change waitress could see two requests where the front-end proxy only saw
    one.

CVE-2019-16786

    Waitress would parse the Transfer-Encoding header and only look for a
    single string value, if that value was not "chunked" it would fall through
    and use the Content-Length header instead.  This could allow for Waitress
    to treat a single request as multiple requests in the case of HTTP
    pipelining.

CVE-2019-16789

    Specially crafted requests containing special whitespace characters in the
    Transfer-Encoding header would get parsed by Waitress as being a chunked
    request, but a front-end server would use the Content-Length instead as the
    Transfer-Encoding header is considered invalid due to containing invalid
    characters.  If a front-end server does HTTP pipelining to a backend
    Waitress server this could lead to HTTP request splitting which may lead to
    potential cache poisoning or unexpected information disclosure.

CVE-2019-16792

    If two Content-Length headers are sent in a single request, Waitress would
    treat the request as having no body, thereby treating the body of the
    request as a new request in HTTP pipelining.

CVE-2022-24761

    There are two classes of vulnerability that may lead to request smuggling
    that are addressed by this advisory:
    1. The use of Python's int() to parse strings into integers, leading to +10
       to be parsed as 10, or 0x01 to be parsed as 1, where as the standard
       specifies that the string should contain only digits or hex digits.
    2. Waitress does not support chunk extensions, however it was discarding
       them without validating that they did not contain illegal characters.

For Debian 9 stretch, these problems have been fixed in version
1.0.1-1+deb9u1.

We recommend that you upgrade your waitress packages.

For the detailed security status of waitress please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/waitress>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgp6FMZHpMNRe.pgp)**

*Description:* PGP signature

---



=== Content from github.com_52d0f021_20250115_102912.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Fsecurity%2Fadvisories%2FGHSA-4f7p-27jc-3c36)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Fsecurity%2Fadvisories%2FGHSA-4f7p-27jc-3c36)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=Pylons%2Fwaitress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Pylons](/Pylons)
/
**[waitress](/Pylons/waitress)**
Public

* [Notifications](/login?return_to=%2FPylons%2Fwaitress) You must be signed in to change notification settings
* [Fork
  178](/login?return_to=%2FPylons%2Fwaitress)
* [Star
   1.5k](/login?return_to=%2FPylons%2Fwaitress)

* [Code](/Pylons/waitress)
* [Issues
  13](/Pylons/waitress/issues)
* [Pull requests
  3](/Pylons/waitress/pulls)
* [Actions](/Pylons/waitress/actions)
* [Projects
  0](/Pylons/waitress/projects)
* [Security](/Pylons/waitress/security)
* [Insights](/Pylons/waitress/pulse)

Additional navigation options

* [Code](/Pylons/waitress)
* [Issues](/Pylons/waitress/issues)
* [Pull requests](/Pylons/waitress/pulls)
* [Actions](/Pylons/waitress/actions)
* [Projects](/Pylons/waitress/projects)
* [Security](/Pylons/waitress/security)
* [Insights](/Pylons/waitress/pulse)

# Inconsistent Interpretation of HTTP Requests ('HTTP Request Smuggling') in waitress

High

[digitalresistor](/digitalresistor)
published
GHSA-4f7p-27jc-3c36
Mar 16, 2022

## Package

pip

waitress
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<=2.1.0

## Patched versions

2.1.1

## Description

### Impact

When using Waitress behind a proxy that does not properly validate the incoming HTTP request matches the RFC7230 standard, Waitress and the frontend proxy may disagree on where one request starts and where it ends.

This would allow requests to be smuggled via the front-end proxy to waitress and later behavior.

There are two classes of vulnerability that may lead to request smuggling that are addressed by this advisory:

* The use of Python's `int()` to parse strings into integers, leading to `+10` to be parsed as `10`, or `0x01` to be parsed as `1`, where as the standard specifies that the string should contain only digits or hex digits.
* Waitress does not support chunk extensions, however it was discarding them without validating that they did not contain illegal characters

### Patches

This has been fixed in Waitress 2.1.1

### Workarounds

When deploying a proxy in front of waitress, turning on any and all functionality to make sure that the request matches the RFC7230 standard. Certain proxy servers may not have this functionality though and users are encouraged to upgrade to the latest version of waitress instead.

### References

* <https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn>

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [the Github issue tracker](https://github.com/Pylons/waitress/issues) (if not security related/sensitive)
* Email us at pylons-project-security@googlegroups.com (If security related or sensitive)

### Severity

High

### CVE ID

CVE-2022-24761

### Weaknesses

[CWE-444](/advisories?query=cwe%3A444)

### Credits

* [![@zeyu2001](https://avatars.githubusercontent.com/u/39144422?s=40&v=4)](/zeyu2001)
  [zeyu2001](/zeyu2001)
  Analyst

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_2cd730f8_20250115_102911.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Freleases%2Ftag%2Fv2.1.1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Freleases%2Ftag%2Fv2.1.1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=Pylons%2Fwaitress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Pylons](/Pylons)
/
**[waitress](/Pylons/waitress)**
Public

* [Notifications](/login?return_to=%2FPylons%2Fwaitress) You must be signed in to change notification settings
* [Fork
  178](/login?return_to=%2FPylons%2Fwaitress)
* [Star
   1.5k](/login?return_to=%2FPylons%2Fwaitress)

* [Code](/Pylons/waitress/tree/v2.1.1)
* [Issues
  13](/Pylons/waitress/issues)
* [Pull requests
  3](/Pylons/waitress/pulls)
* [Actions](/Pylons/waitress/actions)
* [Projects
  0](/Pylons/waitress/projects)
* [Security](/Pylons/waitress/security)
* [Insights](/Pylons/waitress/pulse)

Additional navigation options

* [Code](/Pylons/waitress/tree/v2.1.1)
* [Issues](/Pylons/waitress/issues)
* [Pull requests](/Pylons/waitress/pulls)
* [Actions](/Pylons/waitress/actions)
* [Projects](/Pylons/waitress/projects)
* [Security](/Pylons/waitress/security)
* [Insights](/Pylons/waitress/pulse)

1. [Releases](/Pylons/waitress/releases)
2. [v2.1.1](/Pylons/waitress/releases/tag/v2.1.1)

# v2.1.1

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/Pylons/waitress/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.1.1)

 Loading

[View all tags](/Pylons/waitress/tags)

![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&v=4)
[digitalresistor](/digitalresistor)
released this
16 Mar 21:36

[v2.1.1](/Pylons/waitress/tree/v2.1.1)

[`9e0b8c8`](/Pylons/waitress/commit/9e0b8c801e4d505c2ffc91b891af4ba48af715e0)

This commit was created on GitHub.com and signed with GitHubâ€™s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

```
Merge pull request from GHSA-4f7p-27jc-3c36

Fix for HTTP request smuggling due to incorrect validation
```

 Assets
2

 Loading

All reactions

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_f47f08a1_20250115_102910.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Fcommit%2F9e0b8c801e4d505c2ffc91b891af4ba48af715e0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Fcommit%2F9e0b8c801e4d505c2ffc91b891af4ba48af715e0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=Pylons%2Fwaitress)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Pylons](/Pylons)
/
**[waitress](/Pylons/waitress)**
Public

* [Notifications](/login?return_to=%2FPylons%2Fwaitress) You must be signed in to change notification settings
* [Fork
  178](/login?return_to=%2FPylons%2Fwaitress)
* [Star
   1.5k](/login?return_to=%2FPylons%2Fwaitress)

* [Code](/Pylons/waitress)
* [Issues
  13](/Pylons/waitress/issues)
* [Pull requests
  3](/Pylons/waitress/pulls)
* [Actions](/Pylons/waitress/actions)
* [Projects
  0](/Pylons/waitress/projects)
* [Security](/Pylons/waitress/security)
* [Insights](/Pylons/waitress/pulse)

Additional navigation options

* [Code](/Pylons/waitress)
* [Issues](/Pylons/waitress/issues)
* [Pull requests](/Pylons/waitress/pulls)
* [Actions](/Pylons/waitress/actions)
* [Projects](/Pylons/waitress/projects)
* [Security](/Pylons/waitress/security)
* [Insights](/Pylons/waitress/pulse)

## Commit

[Permalink](/Pylons/waitress/commit/9e0b8c801e4d505c2ffc91b891af4ba48af715e0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-4f7p-27jc-3c36](https://github.com/advisories/GHSA-4f7p-27jc-3c36 "GHSA-4f7p-27jc-3c36")

[Browse files](/Pylons/waitress/tree/9e0b8c801e4d505c2ffc91b891af4ba48af715e0)
Browse the repository at this point in the history

```
Fix for HTTP request smuggling due to incorrect validation
```

* Loading branch information

[![@digitalresistor](https://avatars.githubusercontent.com/u/649426?s=40&v=4)](/digitalresistor)

[digitalresistor](/Pylons/waitress/commits?author=digitalresistor "View all commits by digitalresistor")
authored
Mar 16, 2022

2 parents
[22c0394](/Pylons/waitress/commit/22c03947e3bcd7631120aae40d3d844d4f35e49f)
+
[b28c9e8](/Pylons/waitress/commit/b28c9e8bda326ff2f87bf8eb7ea6b110ee0ae6fe)

commit 9e0b8c8

 Show file tree

 Hide file tree

Showing
**9 changed files**
with
**202 additions**
and
**44 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGES.txt
  [CHANGES.txt](#diff-59130575b4fb2932c957db2922977d7d89afb0b2085357db1a14615a2fcad776)
* setup.cfg
  [setup.cfg](#diff-fa602a8a75dc9dcc92261bac5f533c2a85e34fcceaff63b3a3a81d9acde2fc52)
* src/waitress

  + src/waitress/parser.py
    [parser.py](#diff-1431428753d0ea03fa4cb225dfca1c4c15e8fbf56d992ba8f976617661ea8c45)
  + src/waitress/receiver.py
    [receiver.py](#diff-2d8891721adabb971ae36d54456f7b4a518dea2c18fe918bf5670efb24be2a3d)
  + src/waitress/rfc7230.py
    [rfc7230.py](#diff-d13399be2e8fb821f337a503a03bfa156a4d0b8e7f92dc9cf301b84ddec84140)
  + src/waitress/utilities.py
    [utilities.py](#diff-a4cc9f7b5178ad7a15f8f38bdca60e19403ce408b2ffdcd92433c118b172decd)
* tests

  + tests/test\_functional.py
    [test\_functional.py](#diff-659bad232c71219167252c1a5ccbc427b6f54925b78741df18613c3c49aaa4c1)
  + tests/test\_parser.py
    [test\_parser.py](#diff-237d6caeea59e3cf8f303958b4b29e752861048496a047a6af38a12915a02e32)
  + tests/test\_receiver.py
    [test\_receiver.py](#diff-df7080846aeb776b882d6a080e50f7478c09fa1ed2f23e398f2fc5db97ace638)

## There are no files selected for viewing

26 changes: 26 additions & 0 deletions

26
[CHANGES.txt](#diff-59130575b4fb2932c957db2922977d7d89afb0b2085357db1a14615a2fcad776 "CHANGES.txt")

Show comments

[View file](/Pylons/waitress/blob/9e0b8c801e4d505c2ffc91b891af4ba48af715e0/CHANGES.txt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,3 +1,29 @@ |
|  |  | 2.1.1 |
|  |  | ----- |
|  |  |  |
|  |  | Security Bugfix |
|  |  | ~~~~~~~~~~~~~~~ |
|  |  |  |
|  |  | - Waitress now validates that chunked encoding extensions are valid, and don't |
|  |  | contain invalid characters that are not allowed. They are still skipped/not |
|  |  | processed, but if they contain invalid data we no longer continue in and |
|  |  | return a 400 Bad Request. This stops potential HTTP desync/HTTP request |
|  |  | smuggling. Thanks to Zhang Zeyu for reporting this issue. See |
|  |  | https://github.com/Pylons/waitress/security/advisories/GHSA-4f7p-27jc-3c36 |
|  |  |  |
|  |  | - Waitress now validates that the chunk length is only valid hex digits when |
|  |  | parsing chunked encoding, and values such as ``0x01`` and ``+01`` are no |
|  |  | longer supported. This stops potential HTTP desync/HTTP request smuggling. |
|  |  | Thanks to Zhang Zeyu for reporting this issue. See |
|  |  | https://github.com/Pylons/waitress/security/advisories/GHSA-4f7p-27jc-3c36 |
|  |  |  |
|  |  | - Waitress now validates that the Content-Length sent by a remote contains only |
|  |  | digits in accordance with RFC7230 and will return a 400 Bad Request when the |
|  |  | Content-Length header contains invalid data, such as ``+10`` which would |
|  |  | previously get parsed as ``10`` and accepted. This stops potential HTTP |
|  |  | desync/HTTP request smuggling Thanks to Zhang Zeyu for reporting this issue. See |
|  |  | https://github.com/Pylons/waitress/security/advisories/GHSA-4f7p-27jc-3c36 |
|  |  |  |
|  |  | 2.1.0 |
|  |  | ----- |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[setup.cfg](#diff-fa602a8a75dc9dcc92261bac5f533c2a85e34fcceaff63b3a3a81d9acde2fc52 "setup.cfg")

Show comments

[View file](/Pylons/waitress/blob/9e0b8c801e4d505c2ffc91b891af4ba48af715e0/setup.cfg)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | [metadata] |
|  |  | name = waitress |
|  |  | version = 2.1.0 |
|  |  | version = 2.1.1 |
|  |  | description = Waitress WSGI server |
|  |  | long\_description = file: README.rst, CHANGES.txt |
|  |  | long\_description\_content\_type = text/x-rst |
| Expand Down | |  |

12 changes: 6 additions & 6 deletions

12
[src/waitress/parser.py](#diff-1431428753d0ea03fa4cb225dfca1c4c15e8fbf56d992ba8f976617661ea8c45 "src/waitress/parser.py")

Show comments

[View file](/Pylons/waitress/blob/9e0b8c801e4d505c2ffc91b891af4ba48af715e0/src/waitress/parser.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,6 +23,7 @@ |
|  |  |  |
|  |  | from waitress.buffers import OverflowableBuffer |
|  |  | from waitress.receiver import ChunkedReceiver, FixedStreamReceiver |
|  |  | from waitress.rfc7230 import HEADER\_FIELD\_RE, ONLY\_DIGIT\_RE |
|  |  | from waitress.utilities import ( |
|  |  | BadRequest, |
|  |  | RequestEntityTooLarge, |
| Expand All | | @@ -31,8 +32,6 @@ |
|  |  | find\_double\_newline, |
|  |  | ) |
|  |  |  |
|  |  | from .rfc7230 import HEADER\_FIELD |
|  |  |  |
|  |  |  |
|  |  | def unquote\_bytes\_to\_wsgi(bytestring): |
|  |  | return unquote\_to\_bytes(bytestring).decode("latin-1") |
| Expand Down  Expand Up | | @@ -221,7 +220,7 @@ def parse\_header(self, header\_plus): |
|  |  | headers = self.headers |
|  |  |  |
|  |  | for line in lines: |
|  |  | header = HEADER\_FIELD.match(line) |
|  |  | header = HEADER\_FIELD\_RE.match(line) |
|  |  |  |
|  |  | if not header: |
|  |  | raise ParsingError("Invalid header") |
| Expand Down  Expand Up | | @@ -317,11 +316,12 @@ def parse\_header(self, header\_plus): |
|  |  | self.connection\_close = True |
|  |  |  |
|  |  | if not self.chunked: |
|  |  | try: |
|  |  | cl = int(headers.get("CONTENT\_LENGTH", 0)) |
|  |  | except ValueError: |
|  |  | cl = headers.get("CONTENT\_LENGTH", "0") |
|  |  |  |
|  |  | if not ONLY\_DIGIT\_RE.match(cl.encode("latin-1")): |
|  |  | raise ParsingError("Content-Length is invalid") |
|  |  |  |
|  |  | cl = int(cl) |
|  |  | self.content\_length = cl |
|  |  |  |
|  |  | if cl > 0: |
| Expand Down | |  |

28 changes: 21 additions & 7 deletions

28
[src/waitress/receiver.py](#diff-2d8891721adabb971ae36d54456f7b4a518dea2c18fe918bf5670efb24be2a3d "src/waitress/receiver.py")

Show comments

[View file](/Pylons/waitress/blob/9e0b8c801e4d505c2ffc91b891af4ba48af715e0/src/waitress/receiver.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,6 +14,7 @@ |
|  |  | """Data Chunk Receiver |
|  |  | """ |
|  |  |  |
|  |  | from waitress.rfc7230 import CHUNK\_EXT\_RE, ONLY\_HEXDIG\_RE |
|  |  | from waitress.utilities import BadRequest, find\_double\_newline |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -110,6 +111,7 @@ def received(self, s): |
|  |  | s = b"" |
|  |  | else: |
|  |  | self.chunk\_end = b"" |
|  |  |  |
|  |  | if pos == 0: |
|  |  | # Chop off the terminating CR LF from the chunk |
|  |  | s = s[2:] |
| Expand All | | @@ -133,20 +135,32 @@ def received(self, s): |
|  |  | line = s[:pos] |
|  |  | s = s[pos + 2 :] |
|  |  | self.control\_line = b"" |
|  |  | line = line.strip() |
|  |  |  |
|  |  | if line: |
|  |  | # Begin a new chunk. |
|  |  | semi = line.find(b";") |
|  |  |  |
|  |  | if semi >= 0: |
|  |  | # discard extension info. |
|  |  | extinfo = line[semi:] |
|  |  | valid\_ext\_info = CHUNK\_EXT\_RE.match(extinfo) |
|  |  |  |
|  |  | if not valid\_ext\_info: |
|  |  | self.error = BadRequest("Invalid chunk extension") |
|  |  | self.all\_chunks\_received = True |
|  |  |  |
|  |  | break |
|  |  |  |
|  |  | line = line[:semi] |
|  |  | try: |
|  |  | sz = int(line.strip(), 16) # hexadecimal |
|  |  | except ValueError: # garbage in input |
|  |  | self.error = BadRequest("garbage in chunked encoding input") |
|  |  | sz = 0 |
|  |  |  |
|  |  | if not ONLY\_HEXDIG\_RE.match(line): |
|  |  | self.error = BadRequest("Invalid chunk size") |
|  |  | self.all\_chunks\_received = True |
|  |  |  |
|  |  | break |
|  |  |  |
|  |  | # Can not fail due to matching against the regular |
|  |  | # expression above |
|  |  | sz = int(line, 16) # hexadecimal |
|  |  |  |
|  |  | if sz > 0: |
|  |  | # Start a new chunk. |
| Expand Down | |  |

27 changes: 26 additions & 1 deletion

27
[src/waitress/rfc7230.py](#diff-d13399be2e8fb821f337a503a03bfa156a4d0b8e7f92dc9cf301b84ddec84140 "src/waitress/rfc7230.py")

Show comments

[View file](/Pylons/waitress/blob/9e0b8c801e4d505c2ffc91b891af4ba48af715e0/src/waitress/rfc7230.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,6 +5,9 @@ |
|  |  |  |
|  |  | import re |
|  |  |  |
|  |  | HEXDIG = "[0-9a-fA-F]" |
|  |  | DIGIT = "[0-9]" |
|  |  |  |
|  |  | WS = "[ \t]" |
|  |  | OWS = WS + "{0,}?" |
|  |  | RWS = WS + "{1,}?" |
| Expand All | | @@ -25,6 +28,12 @@ |
|  |  | # ; visible (printing) characters |
|  |  | VCHAR = r"\x21-\x7e" |
|  |  |  |
|  |  | # The '\\' between \x5b and \x5d is needed to escape \x5d (']') |
|  |  | QDTEXT = "[\t \x21\x23-\x5b\\\x5d-\x7e" + OBS\_TEXT + "]" |
|  |  |  |
|  |  | QUOTED\_PAIR = r"\\" + "([\t " + VCHAR + OBS\_TEXT + "])" |
|  |  | QUOTED\_STRING = '"(?:(?:' + QDTEXT + ")|(?:" + QUOTED\_PAIR + '))\*"' |
|  |  |  |
|  |  | # header-field = field-name ":" OWS field-value OWS |
|  |  | # field-name = token |
|  |  | # field-value = \*( field-content / obs-fold ) |
| Expand All | | @@ -43,8 +52,24 @@ |
|  |  | # Which allows the field value here to just see if there is even a value in the first place |
|  |  | FIELD\_VALUE = "(?:" + FIELD\_CONTENT + ")?" |
|  |  |  |
|  |  | HEADER\_FIELD = re.compile( |
|  |  | # chunk-ext = \*( ";" chunk-ext-name [ "=" chunk-ext-val ] ) |
|  |  | # chunk-ext-name = token |
|  |  | # chunk-ext-val = token / quoted-string |
|  |  |  |
|  |  | CHUNK\_EXT\_NAME = TOKEN |
|  |  | CHUNK\_EXT\_VAL = "(?:" + TOKEN + ")|(?:" + QUOTED\_STRING + ")" |
|  |  | CHUNK\_EXT = ( |
|  |  | "(?:;(?P<extension>" + CHUNK\_EXT\_NAME + ")(?:=(?P<value>" + CHUNK\_EXT\_VAL + "))?)\*" |
|  |  | ) |
|  |  |  |
|  |  | # Pre-compiled regular expressions for use elsewhere |
|  |  | ONLY\_HEXDIG\_RE = re.compile(("^" + HEXDIG + "+$").encode("latin-1")) |
|  |  | ONLY\_DIGIT\_RE = re.compile(("^" + DIGIT + "+$").encode("latin-1")) |
|  |  | HEADER\_FIELD\_RE = re.compile( |
|  |  | ( |
|  |  | "^(?P<name>" + TOKEN + "):" + OWS + "(?P<value>" + FIELD\_VALUE + ")" + OWS + "$" |
|  |  | ).encode("latin-1") |
|  |  | ) |
|  |  | QUOTED\_PAIR\_RE = re.compile(QUOTED\_PAIR) |
|  |  | QUOTED\_STRING\_RE = re.compile(QUOTED\_STRING) |
|  |  | CHUNK\_EXT\_RE = re.compile(("^" + CHUNK\_EXT + "$").encode("latin-1")) |

28 changes: 3 additions & 25 deletions

28
[src/waitress/utilities.py](#diff-a4cc9f7b5178ad7a15f8f38bdca60e19403ce408b2ffdcd92433c118b172decd "src/waitress/utilities.py")

Show comments

[View file](/Pylons/waitress/blob/9e0b8c801e4d505c2ffc91b891af4ba48af715e0/src/waitress/utilities.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -22,7 +22,7 @@ |
|  |  | import stat |
|  |  | import time |
|  |  |  |
|  |  | from .rfc7230 import OBS\_TEXT, VCHAR |
|  |  | from .rfc7230 import QUOTED\_PAIR\_RE, QUOTED\_STRING\_RE |
|  |  |  |
|  |  | logger = logging.getLogger("waitress") |
|  |  | queue\_logger = logging.getLogger("waitress.queue") |
| Expand Down  Expand Up | | @@ -216,40 +216,18 @@ def parse\_http\_date(d): |
|  |  | return retval |
|  |  |  |
|  |  |  |
|  |  | # RFC 5234 Appendix B.1 "Core Rules": |
|  |  | # VCHAR = %x21-7E |
|  |  | # ; visible (printing) characters |
|  |  | vchar\_re = VCHAR |
|  |  |  |
|  |  | # RFC 7230 Section 3.2.6 "Field Value Components": |
|  |  | # quoted-string = DQUOTE \*( qdtext / quoted-pair ) DQUOTE |
|  |  | # qdtext = HTAB / SP /%x21 / %x23-5B / %x5D-7E / obs-text |
|  |  | # obs-text = %x80-FF |
|  |  | # quoted-pair = "\" ( HTAB / SP / VCHAR / obs-text ) |
|  |  | obs\_text\_re = OBS\_TEXT |
|  |  |  |
|  |  | # The '\\' between \x5b and \x5d is needed to escape \x5d (']') |
|  |  | qdtext\_re = "[\t \x21\x23-\x5b\\\x5d-\x7e" + obs\_text\_re + "]" |
|  |  |  |
|  |  | quoted\_pair\_re = r"\\" + "([\t " + vchar\_re + obs\_text\_re + "])" |
|  |  | quoted\_string\_re = '"(?:(?:' + qdtext\_re + ")|(?:" + quoted\_pair\_re + '))\*"' |
|  |  |  |
|  |  | quoted\_string = re.compile(quoted\_string\_re) |
|  |  | quoted\_pair = re.compile(quoted\_pair\_re) |
|  |  |  |
|  |  |  |
|  |  | def undquote(value): |
|  |  | if value.startswith('"') and value.endswith('"'): |
|  |  | # So it claims to be DQUOTE'ed, let's validate that |
|  |  | matches = quoted\_string.match(value) |
|  |  | matches = QUOTED\_STRING\_RE.match(value) |
|  |  |  |
|  |  | if matches and matches.end() == len(value): |
|  |  | # Remove the DQUOTE's from the value |
|  |  | value = value[1:-1] |
|  |  |  |
|  |  | # Remove all backslashes that are followed by a valid vchar or |
|  |  | # obs-text |
|  |  | value = quoted\_pair.sub(r"\1", value) |
|  |  | value = QUOTED\_PAIR\_RE.sub(r"\1", value) |
|  |  |  |
|  |  | return value |
|  |  | elif not value.startswith('"') and not value.endswith('"'): |
| Expand Down | |  |

50 changes: 47 additions & 3 deletions

50
[tests/test\_functional.py](#diff-659bad232c71219167252c1a5ccbc427b6f54925b78741df18613c3c49aaa4c1 "tests/test_functional.py")

Show comments

[View file](/Pylons/waitress/blob/9e0b8c801e4d505c2ffc91b891af4ba48af715e0/tests/test_functional.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -322,7 +322,7 @@ def test\_chunking\_request\_without\_content(self): |
|  |  | self.assertFalse("transfer-encoding" in headers) |
|  |  |  |
|  |  | def test\_chunking\_request\_with\_content(self): |
|  |  | control\_line = b"20;\r\n" # 20 hex = 32 dec |
|  |  | control\_line = b"20\r\n" # 20 hex = 32 dec |
|  |  | s = b"This string has 32 characters.\r\n" |
|  |  | expected = s \* 12 |
|  |  | header = b"GET / HTTP/1.1\r\nTransfer-Encoding: chunked\r\n\r\n" |
| Expand All | | @@ -341,7 +341,7 @@ def test\_chunking\_request\_with\_content(self): |
|  |  | self.assertFalse("transfer-encoding" in headers) |
|  |  |  |
|  |  | def test\_broken\_chunked\_encoding(self): |
|  |  | control\_line = b"20;\r\n" # 20 hex = 32 dec |
|  |  | control\_line = b"20\r\n" # 20 hex = 32 dec |
|  |  | s = b"This string has 32 characters.\r\n" |
|  |  | to\_send = b"GET / HTTP/1.1\r\nTransfer-Encoding: chunked\r\n\r\n" |
|  |  | to\_send += control\_line + s + b"\r\n" |
| Expand All | | @@ -364,8 +364,52 @@ def test\_broken\_chunked\_encoding(self): |
|  |  | self.send\_check\_error(to\_send) |
|  |  | self.assertRaises(ConnectionClosed, read\_http, fp) |
|  |  |  |
|  |  | def test\_broken\_chunked\_encoding\_invalid\_hex(self): |
|  |  | control\_line = b"0x20\r\n" # 20 hex = 32 dec |
|  |  | s = b"This string has 32 characters.\r\n" |
|  |  | to\_send = b"GET / HTTP/1.1\r\nTransfer-Encoding: chunked\r\n\r\n" |
|  |  | to\_send += control\_line + s + b"\r\n" |
|  |  | self.connect() |
|  |  | self.sock.send(to\_send) |
|  |  | with self.sock.makefile("rb", 0) as fp: |
|  |  | line, headers, response\_body = read\_http(fp) |
|  |  | self.assertline(line, "400", "Bad Request", "HTTP/1.1") |
|  |  | cl = int(headers["content-length"]) |
|  |  | self.assertEqual(cl, len(response\_body)) |
|  |  | self.assertIn(b"Invalid chunk size", response\_body) |
|  |  | self.assertEqual( |
|  |  | sorted(headers.keys()), |
|  |  | ["connection", "content-length", "content-type", "date", "server"], |
|  |  | ) |
|  |  | self.assertEqual(headers["content-type"], "text/plain") |
|  |  | # connection has been closed |
|  |  | self.send\_check\_error(to\_send) |
|  |  | self.assertRaises(ConnectionClosed, read\_http, fp) |
|  |  |  |
|  |  | def test\_broken\_chunked\_encoding\_invalid\_extension(self): |
|  |  | control\_line = b"20;invalid=\r\n" # 20 hex = 32 dec |
|  |  | s = b"This string has 32 characters.\r\n" |
|  |  | to\_send = b"GET / HTTP/1.1\r\nTransfer-Encoding: chunked\r\n\r\n" |
|  |  | to\_send += control\_line + s + b"\r\n" |
|  |  | self.connect() |
|  |  | self.sock.send(to\_send) |
|  |  | with self.sock.makefile("rb", 0) as fp: |
|  |  | line, headers, response\_body = read\_http(fp) |
|  |  | self.assertline(line, "400", "Bad Request", "HTTP/1.1") |
|  |  | cl = int(headers["content-length"]) |
|  |  | self.assertEqual(cl, len(response\_body)) |
|  |  | self.assertIn(b"Invalid chunk extension", response\_body) |
|  |  | self.assertEqual( |
|  |  | sorted(headers.keys()), |
|  |  | ["connection", "content-length", "content-type", "date", "server"], |
|  |  | ) |
|  |  | self.assertEqual(headers["content-type"], "text/plain") |
|  |  | # connection has been closed |
|  |  | self.send\_check\_error(to\_send) |
|  |  | self.assertRaises(ConnectionClosed, read\_http, fp) |
|  |  |  |
|  |  | def test\_broken\_chunked\_encoding\_missing\_chunk\_end(self): |
|  |  | control\_line = b"20;\r\n" # 20 hex = 32 dec |
|  |  | control\_line = b"20\r\n" # 20 hex = 32 dec |
|  |  | s = b"This string has 32 characters.\r\n" |
|  |  | to\_send = b"GET / HTTP/1.1\r\nTransfer-Encoding: chunked\r\n\r\n" |
|  |  | to\_send += control\_line + s |
| Expand Down | |  |

22 changes: 21 additions & 1 deletion

22
[tests/test\_parser.py](#diff-237d6caeea59e3cf8f303958b4b29e752861048496a047a6af38a12915a02e32 "tests/test_parser.py")

Show comments

[View file](/Pylons/waitress/blob/9e0b8c801e4d505c2ffc91b891af4ba48af715e0/tests/test_parser.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -155,7 +155,7 @@ def test\_received\_chunked\_completed\_sets\_content\_length(self): |
|  |  | b"Transfer-Encoding: chunked\r\n" |
|  |  | b"X-Foo: 1\r\n" |
|  |  | b"\r\n" |
|  |  | b"1d;\r\n" |
|  |  | b"1d\r\n" |
|  |  | b"This string has 29 characters\r\n" |
|  |  | b"0\r\n\r\n" |
|  |  | ) |
| Expand Down  Expand Up | | @@ -193,6 +193,26 @@ def test\_parse\_header\_bad\_content\_length(self): |
|  |  | else: # pragma: nocover |
|  |  | self.assertTrue(False) |
|  |  |  |
|  |  | def test\_parse\_header\_bad\_content\_length\_plus(self): |
|  |  | data = b"GET /foobar HTTP/8.4\r\ncontent-length: +10\r\n" |
|  |  |  |
|  |  | try: |
|  |  | self.parser.parse\_header(data) |
|  |  | except ParsingError as e: |
|  |  | self.assertIn("Content-Length is invalid", e.args[0]) |
|  |  | else: # pragma: nocover |
|  |  | self.assertTrue(False) |
|  |  |  |
|  |  | def test\_parse\_header\_bad\_content\_length\_minus(self): |
|  |  | data = b"GET /foobar HTTP/8.4\r\ncontent-length: -10\r\n" |
|  |  |  |
|  |  | try: |
|  |  | self.parser.parse\_header(data) |
|  |  | except ParsingError as e: |
|  |  | self.assertIn("Content-Length is invalid", e.args[0]) |
|  |  | else: # pragma: nocover |
|  |  | self.assertTrue(False) |
|  |  |  |
|  |  | def test\_parse\_header\_multiple\_content\_length(self): |
|  |  | data = b"GET /foobar HTTP/8.4\r\ncontent-length: 10\r\ncontent-length: 20\r\n" |
|  |  |  |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9e0b8c8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPylons%2Fwaitress%2Fcommit%2F9e0b8c801e4d505c2ffc91b891af4ba48af715e0) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from www.debian.org_618a9640_20250115_102912.html ===


---

[[Date Prev](msg00105.html)][[Date Next](msg00107.html)]
[[Thread Prev](msg00105.html)][[Thread Next](msg00107.html)]
[[Date Index](maillist.html#00106)]
[[Thread Index](threads.html#00106)]

# [SECURITY] [DSA 5138-1] waitress security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 5138-1] waitress security update
* *From*: Moritz Muehlenhoff <jmm@debian.org>
* *Date*: Tue, 17 May 2022 19:07:36 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/20220517190735.GA25883%40seger.debian.org)Â [20220517190735.GA25883@seger.debian.org](msg00106.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-5138-1                   security@debian.org
<https://www.debian.org/security/>                       Moritz Muehlenhoff
May 17, 2022                          <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : waitress
CVE ID         : CVE-2022-24761
Debian Bug     : 1008013

It was discovered that the Waitress WSGI server was susceptible to
HTTP request smuggling in some scenarios when used behind a proxy.

For the oldstable distribution (buster), this problem has been fixed
in version 1.2.0~b2-2+deb10u1.

For the stable distribution (bullseye), this problem has been fixed in
version 1.4.4-1.1+deb11u1.

We recommend that you upgrade your waitress packages.

For the detailed security status of waitress please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/waitress>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEtuYvPRKsOElcDakFEMKTtsN8TjYFAmKD8WsACgkQEMKTtsN8
Tjb1Bw//WO0r4iACwUTMxAPD5EowBLhLcywGHly+MDEN1/2HHBq/wRhJK5J7HNt+
wdeYcbeJe8Jjm0iKnN8uetu+vr4wWRF33pDXj8GrT06chctnCwv4hEKpMTZLOZuw
2CaW5c80eKMGM7MVVjSYzCXGZ2Xp8pJml3J4T3u8V9KgW6QzPX6vKVzeQkWEpXFP
4uN35ZcPTgDWmBdtKaH76DwxB8roaN98ZgPQGsvhs6OLHqifDIik5q03zZPylJD2
Ji81zKIjBhQbsyOnE8lrtE4h7RvgjTldl5dkzK9QQYnRFq8B8lLJHZdnZGlfGvD8
/dccVQT+UJWdV14fe5amlMBsbbs2gn0QwQmHLYYACVdQXo6dY7VQgy9uIUO8CaR+
QHEJYZFz4ddaPOkjfq7MyjPPXzM4RnbG2Vbr73hrfhnSFPmZfzc0hqjHKJVqBAOK
ZU3mYEr0whU2CqG5ERRspQCdgSckV1rmtw8odWdkP8nmj4ZgCMtbScJCkfPEpwP2
83FPPh8+P9Rudom8RQvduHjr/3HweVvYGfmcws2QV+ffGiz7rwaiKZPG+fjFyXrq
UUBrFeseVsgaCEmq0x5S3r9XgL0YI7zXqNyTDZKDF5SrbRC7FVuPOzR1/kzZo2l2
DE5bBtA+ViL7Oqqo0AkAy1rLh6gTMnmwLBKz6okgCkgRQYefrrg=
=zbZ1
-----END PGP SIGNATURE-----

```

---


