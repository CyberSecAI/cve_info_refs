=== Content from www.mozilla.org_d30ae487_20250114_221636.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-03

## Security Vulnerabilities fixed in Thunderbird 91.5

Announced
January 11, 2022
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 91.5

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2022-22746: Calling into reportValidity could have lead to fullscreen window spoof](#CVE-2022-22746)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A race condition could have allowed bypassing the fullscreen notification which could have lead to a fullscreen window spoof being unnoticed.
*This bug only affects Firefox for Windows. Other operating systems are unaffected.*

##### References

* [Bug 1735071](https://bugzilla.mozilla.org/show_bug.cgi?id=1735071)

#### [#CVE-2022-22743: Browser window spoof using fullscreen mode](#CVE-2022-22743)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When navigating from inside an iframe while requesting fullscreen access, an attacker-controlled tab could have made the browser unable to leave fullscreen mode.

##### References

* [Bug 1739220](https://bugzilla.mozilla.org/show_bug.cgi?id=1739220)

#### [#CVE-2022-22742: Out-of-bounds memory access when inserting text in edit mode](#CVE-2022-22742)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When inserting text while in edit mode, some characters might have lead to out-of-bounds memory access causing a potentially exploitable crash.

##### References

* [Bug 1739923](https://bugzilla.mozilla.org/show_bug.cgi?id=1739923)

#### [#CVE-2022-22741: Browser window spoof using fullscreen mode](#CVE-2022-22741)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When resizing a popup while requesting fullscreen access, the popup would have become unable to leave fullscreen mode.

##### References

* [Bug 1740389](https://bugzilla.mozilla.org/show_bug.cgi?id=1740389)

#### [#CVE-2022-22740: Use-after-free of ChannelEventQueue::mOwner](#CVE-2022-22740)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
high
##### Description

Certain network request objects were freed too early when releasing a network request handle. This could have lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1742334](https://bugzilla.mozilla.org/show_bug.cgi?id=1742334)

#### [#CVE-2022-22738: Heap-buffer-overflow in blendGaussianBlur](#CVE-2022-22738)

Reporter
Atte Kettunen
Impact
high
##### Description

Applying a CSS filter effect could have accessed out of bounds memory. This could have lead to a heap-buffer-overflow causing a potentially exploitable crash.

##### References

* [Bug 1742382](https://bugzilla.mozilla.org/show_bug.cgi?id=1742382)

#### [#CVE-2022-22737: Race condition when playing audio files](#CVE-2022-22737)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
high
##### Description

Constructing audio sinks could have lead to a race condition when playing audio files and closing windows. This could have lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1745874](https://bugzilla.mozilla.org/show_bug.cgi?id=1745874)

#### [#CVE-2021-4140: Iframe sandbox bypass with XSLT](#CVE-2021-4140)

Reporter
Peter Van der Beken
Impact
high
##### Description

It was possible to construct specific XSLT markup that would be able to bypass an iframe sandbox.

##### References

* [Bug 1746720](https://bugzilla.mozilla.org/show_bug.cgi?id=1746720)

#### [#CVE-2022-22748: Spoofed origin on external protocol launch dialog](#CVE-2022-22748)

Reporter
Alesandro Ortiz
Impact
moderate
##### Description

Malicious websites could have confused Firefox into showing the wrong origin when asking to launch a program and handling an external URL protocol.

##### References

* [Bug 1705211](https://bugzilla.mozilla.org/show_bug.cgi?id=1705211)

#### [#CVE-2022-22745: Leaking cross-origin URLs through securitypolicyviolation event](#CVE-2022-22745)

Reporter
Jannis Rautenstrauch
Impact
moderate
##### Description

Securitypolicyviolation events could have leaked cross-origin information for frame-ancestors violations

##### References

* [Bug 1735856](https://bugzilla.mozilla.org/show_bug.cgi?id=1735856)

#### [#CVE-2022-22744: The 'Copy as curl' feature in DevTools did not fully escape website-controlled data, potentially leading to command injection](#CVE-2022-22744)

Reporter
Mattias Jacobsson
Impact
moderate
##### Description

The constructed curl command from the "Copy as curl" feature in DevTools was not properly escaped for PowerShell. This could have lead to command injection if pasted into a Powershell prompt.
*This bug only affects Thunderbird for Windows. Other operating systems are unaffected.*

##### References

* [Bug 1737252](https://bugzilla.mozilla.org/show_bug.cgi?id=1737252)

#### [#CVE-2022-22747: Crash when handling empty pkcs7 sequence](#CVE-2022-22747)

Reporter
Tavis Ormandy
Impact
low
##### Description

After accepting an untrusted certificate, handling an empty pkcs7 sequence as part of the certificate data could have lead to a crash. This crash is believed to be unexploitable.

##### References

* [Bug 1735028](https://bugzilla.mozilla.org/show_bug.cgi?id=1735028)

#### [#CVE-2022-22739: Missing throttling on external protocol launch dialog](#CVE-2022-22739)

Reporter
Alesandro Ortiz
Impact
low
##### Description

Malicious websites could have tricked users into accepting launching a program to handle an external URL protocol.

##### References

* [Bug 1744158](https://bugzilla.mozilla.org/show_bug.cgi?id=1744158)

#### [#CVE-2022-22751: Memory safety bugs fixed in Thunderbird 91.5](#CVE-2022-22751)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Calixte Denizet, Kershaw Chang, Christian Holler, Jason Kratzer, Gabriele Svelto, Tyson Smith, Simon Giesecke, and Steve Fink reported memory safety bugs present in Firefox 95 and Firefox ESR 91.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1664149%2C1737816%2C1739366%2C1740274%2C1740797%2C1741201%2C1741869%2C1743221%2C1743515%2C1745373%2C1746011)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_458331a4_20250114_221635.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-01

## Security Vulnerabilities fixed in Firefox 96

Announced
January 11, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 96

#### [#CVE-2022-22746: Calling into reportValidity could have lead to fullscreen window spoof](#CVE-2022-22746)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A race condition could have allowed bypassing the fullscreen notification which could have lead to a fullscreen window spoof being unnoticed.
*This bug only affects Firefox for Windows. Other operating systems are unaffected.*

##### References

* [Bug 1735071](https://bugzilla.mozilla.org/show_bug.cgi?id=1735071)

#### [#CVE-2022-22743: Browser window spoof using fullscreen mode](#CVE-2022-22743)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When navigating from inside an iframe while requesting fullscreen access, an attacker-controlled tab could have made the browser unable to leave fullscreen mode.

##### References

* [Bug 1739220](https://bugzilla.mozilla.org/show_bug.cgi?id=1739220)

#### [#CVE-2022-22742: Out-of-bounds memory access when inserting text in edit mode](#CVE-2022-22742)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When inserting text while in edit mode, some characters might have lead to out-of-bounds memory access causing a potentially exploitable crash.

##### References

* [Bug 1739923](https://bugzilla.mozilla.org/show_bug.cgi?id=1739923)

#### [#CVE-2022-22741: Browser window spoof using fullscreen mode](#CVE-2022-22741)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When resizing a popup while requesting fullscreen access, the popup would have become unable to leave fullscreen mode.

##### References

* [Bug 1740389](https://bugzilla.mozilla.org/show_bug.cgi?id=1740389)

#### [#CVE-2022-22740: Use-after-free of ChannelEventQueue::mOwner](#CVE-2022-22740)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
high
##### Description

Certain network request objects were freed too early when releasing a network request handle. This could have lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1742334](https://bugzilla.mozilla.org/show_bug.cgi?id=1742334)

#### [#CVE-2022-22738: Heap-buffer-overflow in blendGaussianBlur](#CVE-2022-22738)

Reporter
Atte Kettunen
Impact
high
##### Description

Applying a CSS filter effect could have accessed out of bounds memory. This could have lead to a heap-buffer-overflow causing a potentially exploitable crash.

##### References

* [Bug 1742382](https://bugzilla.mozilla.org/show_bug.cgi?id=1742382)

#### [#CVE-2022-22737: Race condition when playing audio files](#CVE-2022-22737)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
high
##### Description

Constructing audio sinks could have lead to a race condition when playing audio files and closing windows. This could have lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1745874](https://bugzilla.mozilla.org/show_bug.cgi?id=1745874)

#### [#CVE-2021-4140: Iframe sandbox bypass with XSLT](#CVE-2021-4140)

Reporter
Peter Van der Beken
Impact
high
##### Description

It was possible to construct specific XSLT markup that would be able to bypass an iframe sandbox.

##### References

* [Bug 1746720](https://bugzilla.mozilla.org/show_bug.cgi?id=1746720)

#### [#CVE-2022-22750: IPC passing of resource handles could have lead to sandbox bypass](#CVE-2022-22750)

Reporter
Jed Davis
Impact
moderate
##### Description

By generally accepting and passing resource handles across processes, a compromised content process might have confused higher privileged processes to interact with handles that the unprivileged process should not have access to.
*This bug only affects Firefox for Windows and MacOS. Other operating systems are unaffected.*

##### References

* [Bug 1566608](https://bugzilla.mozilla.org/show_bug.cgi?id=1566608)

#### [#CVE-2022-22749: Lack of URL restrictions when scanning QR codes](#CVE-2022-22749)

Reporter
Wladimir Palant working with Include Security
Impact
moderate
##### Description

When scanning QR codes, Firefox for Android would have allowed navigation to some URLs that do not point to web content.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1705094](https://bugzilla.mozilla.org/show_bug.cgi?id=1705094)

#### [#CVE-2022-22748: Spoofed origin on external protocol launch dialog](#CVE-2022-22748)

Reporter
Alesandro Ortiz
Impact
moderate
##### Description

Malicious websites could have confused Firefox into showing the wrong origin when asking to launch a program and handling an external URL protocol.

##### References

* [Bug 1705211](https://bugzilla.mozilla.org/show_bug.cgi?id=1705211)

#### [#CVE-2022-22745: Leaking cross-origin URLs through securitypolicyviolation event](#CVE-2022-22745)

Reporter
Jannis Rautenstrauch
Impact
moderate
##### Description

Securitypolicyviolation events could have leaked cross-origin information for frame-ancestors violations

##### References

* [Bug 1735856](https://bugzilla.mozilla.org/show_bug.cgi?id=1735856)

#### [#CVE-2022-22744: The 'Copy as curl' feature in DevTools did not fully escape website-controlled data, potentially leading to command injection](#CVE-2022-22744)

Reporter
Mattias Jacobsson
Impact
moderate
##### Description

The constructed curl command from the "Copy as curl" feature in DevTools was not properly escaped for PowerShell. This could have lead to command injection if pasted into a Powershell prompt.
*This bug only affects Firefox for Windows. Other operating systems are unaffected.*

##### References

* [Bug 1737252](https://bugzilla.mozilla.org/show_bug.cgi?id=1737252)

#### [#CVE-2022-22763: Script Execution during invalid object state](#CVE-2022-22763)

Reporter
Mozilla Fuzzing Team
Impact
moderate
##### Description

When a worker is shutdown, it was possible to cause script to run late in the lifecycle, at a point after where it should not be possible.

##### References

* [Bug 1740534](https://bugzilla.mozilla.org/show_bug.cgi?id=1740534)

#### [#CVE-2022-22747: Crash when handling empty pkcs7 sequence](#CVE-2022-22747)

Reporter
Tavis Ormandy
Impact
low
##### Description

After accepting an untrusted certificate, handling an empty pkcs7 sequence as part of the certificate data could have lead to a crash. This crash is believed to be unexploitable.

##### References

* [Bug 1735028](https://bugzilla.mozilla.org/show_bug.cgi?id=1735028)

#### [#CVE-2022-22736: Potential local privilege escalation when loading modules from the install directory.](#CVE-2022-22736)

Reporter
Kirtikumar Anandrao Ramchandani, Toshihito Kikuchi
Impact
low
##### Description

If Firefox was installed to a world-writable directory, a local privilege escalation could occur when Firefox searched the current directory for system libraries. However the install directory is not world-writable by default.
*This bug only affects Firefox for Windows in a non-default installation. Other operating systems are unaffected.*

##### References

* [Bug 1742692](https://bugzilla.mozilla.org/show_bug.cgi?id=1742692)

#### [#CVE-2022-22739: Missing throttling on external protocol launch dialog](#CVE-2022-22739)

Reporter
Alesandro Ortiz
Impact
low
##### Description

Malicious websites could have tricked users into accepting launching a program to handle an external URL protocol.

##### References

* [Bug 1744158](https://bugzilla.mozilla.org/show_bug.cgi?id=1744158)

#### [#CVE-2022-22751: Memory safety bugs fixed in Firefox 96 and Firefox ESR 91.5](#CVE-2022-22751)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Calixte Denizet, Kershaw Chang, Christian Holler, Jason Kratzer, Gabriele Svelto, Tyson Smith, Simon Giesecke, and Steve Fink reported memory safety bugs present in Firefox 95 and Firefox ESR 91.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 96 and Firefox ESR 91.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1664149%2C1737816%2C1739366%2C1740274%2C1740797%2C1741201%2C1741869%2C1743221%2C1743515%2C1745373%2C1746011)

#### [#CVE-2022-22752: Memory safety bugs fixed in Firefox 96](#CVE-2022-22752)

Reporter
Mozilla developers and community
Impact
moderate
##### Description

Mozilla developers Christian Holler and Jason Kratzer reported memory safety bugs present in Firefox 95. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 96](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1741210%2C1742770)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_1de05178_20250114_221636.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-02

## Security Vulnerabilities fixed in Firefox ESR 91.5

Announced
January 11, 2022
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 91.5

#### [#CVE-2022-22746: Calling into reportValidity could have lead to fullscreen window spoof](#CVE-2022-22746)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A race condition could have allowed bypassing the fullscreen notification which could have lead to a fullscreen window spoof being unnoticed.
*This bug only affects Thunderbird for Windows. Other operating systems are unaffected.*

##### References

* [Bug 1735071](https://bugzilla.mozilla.org/show_bug.cgi?id=1735071)

#### [#CVE-2022-22743: Browser window spoof using fullscreen mode](#CVE-2022-22743)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When navigating from inside an iframe while requesting fullscreen access, an attacker-controlled tab could have made the browser unable to leave fullscreen mode.

##### References

* [Bug 1739220](https://bugzilla.mozilla.org/show_bug.cgi?id=1739220)

#### [#CVE-2022-22742: Out-of-bounds memory access when inserting text in edit mode](#CVE-2022-22742)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When inserting text while in edit mode, some characters might have lead to out-of-bounds memory access causing a potentially exploitable crash.

##### References

* [Bug 1739923](https://bugzilla.mozilla.org/show_bug.cgi?id=1739923)

#### [#CVE-2022-22741: Browser window spoof using fullscreen mode](#CVE-2022-22741)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When resizing a popup while requesting fullscreen access, the popup would have become unable to leave fullscreen mode.

##### References

* [Bug 1740389](https://bugzilla.mozilla.org/show_bug.cgi?id=1740389)

#### [#CVE-2022-22740: Use-after-free of ChannelEventQueue::mOwner](#CVE-2022-22740)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
high
##### Description

Certain network request objects were freed too early when releasing a network request handle. This could have lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1742334](https://bugzilla.mozilla.org/show_bug.cgi?id=1742334)

#### [#CVE-2022-22738: Heap-buffer-overflow in blendGaussianBlur](#CVE-2022-22738)

Reporter
Atte Kettunen
Impact
high
##### Description

Applying a CSS filter effect could have accessed out of bounds memory. This could have lead to a heap-buffer-overflow causing a potentially exploitable crash.

##### References

* [Bug 1742382](https://bugzilla.mozilla.org/show_bug.cgi?id=1742382)

#### [#CVE-2022-22737: Race condition when playing audio files](#CVE-2022-22737)

Reporter
bo13oy of Cyber Kunlun Lab
Impact
high
##### Description

Constructing audio sinks could have lead to a race condition when playing audio files and closing windows. This could have lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1745874](https://bugzilla.mozilla.org/show_bug.cgi?id=1745874)

#### [#CVE-2021-4140: Iframe sandbox bypass with XSLT](#CVE-2021-4140)

Reporter
Peter Van der Beken
Impact
high
##### Description

It was possible to construct specific XSLT markup that would be able to bypass an iframe sandbox.

##### References

* [Bug 1746720](https://bugzilla.mozilla.org/show_bug.cgi?id=1746720)

#### [#CVE-2022-22748: Spoofed origin on external protocol launch dialog](#CVE-2022-22748)

Reporter
Alesandro Ortiz
Impact
moderate
##### Description

Malicious websites could have confused Thunderbird into showing the wrong origin when asking to launch a program and handling an external URL protocol.

##### References

* [Bug 1705211](https://bugzilla.mozilla.org/show_bug.cgi?id=1705211)

#### [#CVE-2022-22745: Leaking cross-origin URLs through securitypolicyviolation event](#CVE-2022-22745)

Reporter
Jannis Rautenstrauch
Impact
moderate
##### Description

Securitypolicyviolation events could have leaked cross-origin information for frame-ancestors violations

##### References

* [Bug 1735856](https://bugzilla.mozilla.org/show_bug.cgi?id=1735856)

#### [#CVE-2022-22744: The 'Copy as curl' feature in DevTools did not fully escape website-controlled data, potentially leading to command injection](#CVE-2022-22744)

Reporter
Mattias Jacobsson
Impact
moderate
##### Description

The constructed curl command from the "Copy as curl" feature in DevTools was not properly escaped for PowerShell. This could have lead to command injection if pasted into a Powershell prompt.
*This bug only affects Firefox for Windows. Other operating systems are unaffected.*

##### References

* [Bug 1737252](https://bugzilla.mozilla.org/show_bug.cgi?id=1737252)

#### [#CVE-2022-22747: Crash when handling empty pkcs7 sequence](#CVE-2022-22747)

Reporter
Tavis Ormandy
Impact
low
##### Description

After accepting an untrusted certificate, handling an empty pkcs7 sequence as part of the certificate data could have lead to a crash. This crash is believed to be unexploitable.

##### References

* [Bug 1735028](https://bugzilla.mozilla.org/show_bug.cgi?id=1735028)

#### [#CVE-2022-22739: Missing throttling on external protocol launch dialog](#CVE-2022-22739)

Reporter
Alesandro Ortiz
Impact
low
##### Description

Malicious websites could have tricked users into accepting launching a program to handle an external URL protocol.

##### References

* [Bug 1744158](https://bugzilla.mozilla.org/show_bug.cgi?id=1744158)

#### [#CVE-2022-22751: Memory safety bugs fixed in Firefox 96 and Firefox ESR 91.5](#CVE-2022-22751)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Calixte Denizet, Kershaw Chang, Christian Holler, Jason Kratzer, Gabriele Svelto, Tyson Smith, Simon Giesecke, and Steve Fink reported memory safety bugs present in Firefox 95 and Firefox ESR 91.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 96 and Firefox ESR 91.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1664149%2C1737816%2C1739366%2C1740274%2C1740797%2C1741201%2C1741869%2C1743221%2C1743515%2C1745373%2C1746011)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_81156062_20250114_221635.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1705211)
* [XML](/show_bug.cgi?ctype=xml&id=1705211)

Closed
[Bug 1705211](/show_bug.cgi?id=1705211)
(CVE-2022-22748)

Opened 4 years ago
Closed 3 years ago

# Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol

## Categories

### (Core :: DOM: Security, defect, P3)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Security#DOM%3A%20Security)

DOM: Security
▾

Core :: DOM: Security
Native content-based security features including: Content Security Policy (CSP), Mixed Content Blocker (MCB), and Safe Browsing.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Security&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Security&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Security)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

96 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | [96+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=96%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=verified) |
| firefox95 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=wontfix) |
| firefox96 | [+](/buglist.cgi?f1=cf_tracking_firefox96&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr91 | 96+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox95 |  | wontfix |
| firefox96 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bugzilla-mozilla, Assigned: Gijs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ce4fbcbde27a718815b1d5fe138a791e?d=mm&size=40)  [bugzilla-mozilla](/user_profile?user_id=239403)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/1f41f3ef916e1c1fc9401cf3212a6708?d=mm&size=40)  [freddy](/user_profile?user_id=428608)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1743868](/show_bug.cgi?id=1743868 "RESOLVED FIXED - Port bug 1705211 to Thunderbird")

[1743653](/show_bug.cgi?id=1743653 "RESOLVED FIXED - Add automated tests for external protocol origin spoof")

Dependency [tree](/showdependencytree.cgi?id=1705211&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1705211)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[CVE-2022-22739](/show_bug.cgi?id=1744158 "VERIFIED FIXED - Security: Background page using iframe can show external protocol dialog in other tabs and without throttling")

[bugs.chromium.org/p/chromium/issues/d...](https://bugs.chromium.org/p/chromium/issues/detail?id=1197889 "https://bugs.chromium.org/p/chromium/issues/detail?id=1197889")

## Details

### (Keywords: csectype-spoof, reporter-external, sec-moderate, Whiteboard: [reporter-external] [client-bounty-form][domsecurity-active][adv-main96+][adv-ESR91.5+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-22748

[Keywords:](/describekeywords.cgi)

[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form][domsecurity-active][adv-main96+][adv-ESR91.5+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a20471238_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (12 files, 1 obsolete file)

| [spoofs-calc.mp4](/attachment.cgi?id=9215887)  [4 years ago](#c0)  [Alesandro Ortiz](/user_profile?user_id=239403)   2.46 MB, video/mp4 |  | [Details](/attachment.cgi?id=9215887&action=edit) |
| --- | --- | --- |
| [spoofs-google.mp4](/attachment.cgi?id=9215889)  [4 years ago](#c1)  [Alesandro Ortiz](/user_profile?user_id=239403)   573.22 KB, video/mp4 |  | [Details](/attachment.cgi?id=9215889&action=edit) |
| [spoof-google-search.mp4](/attachment.cgi?id=9215890)  [4 years ago](#c2)  [Alesandro Ortiz](/user_profile?user_id=239403)   1.59 MB, video/mp4 |  | [Details](/attachment.cgi?id=9215890&action=edit) |
| [spoof-links.html](/attachment.cgi?id=9215891)  [4 years ago](#c3)  [Alesandro Ortiz](/user_profile?user_id=239403)   397 bytes, text/html |  | [Details](/attachment.cgi?id=9215891&action=edit) |
| [spoof-iframe-sandbox-calc.html](/attachment.cgi?id=9215893)  [4 years ago](#c4)  [Alesandro Ortiz](/user_profile?user_id=239403)   344 bytes, text/html |  | [Details](/attachment.cgi?id=9215893&action=edit) |
| [spoof-iframe-src-calc.html](/attachment.cgi?id=9215895)  [4 years ago](#c5)  [Alesandro Ortiz](/user_profile?user_id=239403)   619 bytes, text/html |  | [Details](/attachment.cgi?id=9215895&action=edit) |
| [spoof-iframe-srcdoc-calc.html](/attachment.cgi?id=9215896)  [4 years ago](#c6)  [Alesandro Ortiz](/user_profile?user_id=239403)   791 bytes, text/html |  | [Details](/attachment.cgi?id=9215896&action=edit) |
| [spoof-calc-diff-tab.html](/attachment.cgi?id=9215897)  [4 years ago](#c7)  [Alesandro Ortiz](/user_profile?user_id=239403)   1.79 KB, text/html |  | [Details](/attachment.cgi?id=9215897&action=edit) |
| [spoof-new-tab.html](/attachment.cgi?id=9215898)  [4 years ago](#c8)  [Alesandro Ortiz](/user_profile?user_id=239403)   1.12 KB, text/html |  | [Details](/attachment.cgi?id=9215898&action=edit) |
| [Bug 1705211, r?nika!,ckerschb!](/attachment.cgi?id=9252016)  [3 years ago](#c20)  [:Gijs (he/him)](/user_profile?user_id=159069)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9252016&action=edit) | [Review](/attachment.cgi?id=9252016) |
| [ESR backport patch](/attachment.cgi?id=9255077)  [3 years ago](#c34)  [:Gijs (he/him)](/user_profile?user_id=159069)   11.08 KB, patch | RyanVM : [approval-mozilla-esr91+](#c36 "3 years ago") | [Details](/attachment.cgi?id=9255077&action=edit) | [Diff](/attachment.cgi?id=9255077&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1705211&attachment=9255077) |
| [advisory.txt](/attachment.cgi?id=9257645)  [3 years ago](#c43)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   212 bytes, text/plain |  | [Details](/attachment.cgi?id=9257645&action=edit) |
| [advisory.txt](/attachment.cgi?id=9257646)  [3 years ago](#c44)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   211 bytes, text/plain |  | [Details](/attachment.cgi?id=9257646&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1705211#c0)• 4 years ago |
|  | |

Attached video
[spoofs-calc.mp4](attachment.cgi?id=9215887)
— [Details](attachment.cgi?id=9215887&action=edit)

VULNERABILITY DETAILS

A URL responding with a server-side redirect to an external protocol can trigger an external protocol dialog with a spoofed origin. The origin is never the redirecting URL's origin. Instead, the initiating page's origin (or precursor origin if opaque) is shown in dialogs.

For example, if a page on [https://www.google[.]com](https://www.google%5B.%5Dcom) contains a link (<a href="...">) to [https://attacker[.]tld/redirect](https://attacker%5B.%5Dtld/redirect), and a user clicks the link, the dialog will show [https://www.google[.]com](https://www.google%5B.%5Dcom) as the origin instead of [https://attacker[.]tld](https://attacker%5B.%5Dtld) .

Similarly, if a page on [https://www.google[.]com](https://www.google%5B.%5Dcom) navigates the current window or new window via JavaScript (window.location or window.open()) to [https://attacker[.]tld/redirect](https://attacker%5B.%5Dtld/redirect), the dialog will show [https://www.google[.]com](https://www.google%5B.%5Dcom) as the origin.

In effect, the behavior is the same as if the page had directly used the external protocol URL (ms-calculator:) instead of the HTTPS URL ([https://attacker[.]tld/redirect](https://attacker%5B.%5Dtld/redirect)).

As far as I can tell, common protections such as CSP and iframe sandboxing are bypassed in most scenarios.

No user interaction is needed if a user previously checked "Always allow {origin} to open {protocol} links" and "Always use this application to open {protocol} links" for the target origin and protocol, or if allowed via enterprise policy: <https://github.com/mozilla/policy-templates/blob/master/README.md#handlers>

ADDITIONAL INFO

A malicious URL could be placed in search result pages, "external link" interstitial pages, user-provided URLs in content, among many other scenarios. Most websites filter input to only allow http(s) URLs (generally to avoid javascript: URLs which are blocked by browser in server-side redirects), therefore this works as an effective bypass to spoof the origin across most websites and navigation methods.

See attached video spoof-google-search.mp4 for Google Search demo with both calc and tel PoCs. Note that I only enabled this PoC to work from my IP address for a few minutes to record the video.

External protocols in server-side redirects probably should be treated similarly to javascript: URLs in server-side redirects, which are blocked by the browser as unsafe. Otherwise, the browser could render a blank page with origin set to the server-side redirect initiator, to ensure the dialog and address bar show the correct origin and the tab doesn't have another origin's content rendered.

VERSION

Firefox Version: 87.0 Stable (Build ID 20210318103112), also repros in 89.0a1 Nightly (Build ID 20210413093459 and 20210414093129)

Operating System: Windows\_NT 10.0 19042

REPRODUCTION CASE

Scenario 1: Link click

1. Navigate to <https://alesandroortiz.com/security/firefox/external-protocol/spoof-links.html>
2. Click either of the links

Observed: External protocol dialog shown with current page origin ([https://alesandroortiz[.]com](https://alesandroortiz%5B.%5Dcom))

Expected: External protocol dialog is not shown or is shown with redirecting origin ([https://aogarantiza[.]com](https://aogarantiza%5B.%5Dcom))

Scenario 2: JavaScript redirect (window.location)

1. Navigate to <https://www.google.com/url?q=https%3A%2F%2Faogarantiza.com%2Ffirefox%2Fexternal-protocol%2Fcalc.php&sa=D&sntz=1&usg=AFQjCNEoF7jt2NHEpoTRgtZbbx8F6Na1Gg>

Observed: Dialog shown with spoofed origin.

Expected: Dialog shown with correct origin.

Scenario 3: Page has iframe with user-controlled src to URL responding with server-side redirect

1. Navigate to <https://alesandroortiz.com/security/firefox/external-protocol/spoof-iframe-sandbox-calc.html>

Observed: Dialog shown with embedding page origin ([https://alesandroortiz[.]com](https://alesandroortiz%5B.%5Dcom))

Expected: Dialog shown with iframe src origin ([https://aogarantiza[.]com](https://aogarantiza%5B.%5Dcom))

Scenario 4: Attacker page with refreshing iframe with client-side redirect leading to server-side redirect

1. Navigate to <https://alesandroortiz.com/security/firefox/external-protocol/spoof-iframe-src-calc.html>

Observed: Dialog repeatedly shown with embedding page origin ([https://alesandroortiz[.]com](https://alesandroortiz%5B.%5Dcom))

Expected: Dialog repeatedly shown with iframe src origin ([https://aogarantiza[.]com](https://aogarantiza%5B.%5Dcom))

Scenario 5: Background tab is able to show dialog on different tab, combined with refreshing iframe for repeated dialogs (the latter also demonstrated in Scenario 4 PoC)

1. Navigate to <https://alesandroortiz.com/security/firefox/external-protocol/spoof-calc-diff-tab.html>
2. Click "Continue to Google.com" button

Observed: Dialog is shown in the currently active tab, even if the tab is on a different origin

Expected: Dialog is only shown in tab which opened the dialog and was opened by the same origin as the current page

Scenario 6: Non-security UI bug -- Page with iframe srcdoc (sandboxed)

1. Navigate to <https://alesandroortiz.com/security/firefox/external-protocol/spoof-iframe-srcdoc-calc.html>
2. Observe onload PoC of second iframe, then click link in first iframe

Observed: Dialog shown with checkbox, but checkbox label is blank. Checking the box doesn't do anything, but in this case the checkbox should be hidden. For reference, the origin shown is moz-nullprincipal: which is expected behvior.

Expected: Dialog shown without checkbox.

Other scenarios in PoCs below.

You can re-test any of the app protocol PoCs after checking "Always allow..." and "Always use..." to verify the app will be launched without interaction if previously allowed.

ALL PROOF OF CONCEPTS

App protocols:

<https://alesandroortiz.com/security/firefox/external-protocol/spoof-links.html>

<https://alesandroortiz.com/security/firefox/external-protocol/spoof-iframe-sandbox-calc.html>

<https://alesandroortiz.com/security/firefox/external-protocol/spoof-iframe-src-calc.html>

<https://alesandroortiz.com/security/firefox/external-protocol/spoof-calc-diff-tab.html>

App protocols, misc:

<https://alesandroortiz.com/security/firefox/external-protocol/spoof-new-tab.html>

Non-security UI bug with sandbox + srcdoc behavior:

<https://alesandroortiz.com/security/firefox/external-protocol/spoof-iframe-srcdoc-calc.html>

Google external link demo, user click (equivalent to spoof-links.html PoC):

<https://www.google.com/url?q=https://aogarantiza.com/firefox/external-protocol/calc.php>

Google ~open client-side redirect demo, window.location (used in iframe PoCs to spoof Google origin):

<https://www.google.com/url?q=https%3A%2F%2Faogarantiza.com%2Ffirefox%2Fexternal-protocol%2Fcalc.php&sa=D&sntz=1&usg=AFQjCNEoF7jt2NHEpoTRgtZbbx8F6Na1Gg>

The automatic Google redirect links were created by creating links in Google Sites: <https://sites.google.com/view/aortest1/external-protocol-poc-1-firefox>

Source for HTML files attached. Source for server-side redirect URLs below:

calc.php: <?php header('Location: ms-calculator:'); ?>

CREDIT INFORMATION

Reporter credit: Alesandro Ortiz <https://AlesandroOrtiz.com>

Flags: sec-bounty?

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1705211#c1)• 4 years ago |
|  | |

Attached video
[spoofs-google.mp4](attachment.cgi?id=9215889)
— [Details](attachment.cgi?id=9215889&action=edit)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1705211#c2)• 4 years ago |
|  | |

Attached video
[spoof-google-search.mp4](attachment.cgi?id=9215890)
— [Details](attachment.cgi?id=9215890&action=edit)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1705211#c3)• 4 years ago |
|  | |

Attached file
[spoof-links.html](attachment.cgi?id=9215891)
— [Details](attachment.cgi?id=9215891&action=edit)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1705211#c4)• 4 years ago |
|  | |

Attached file
[spoof-iframe-sandbox-calc.html](attachment.cgi?id=9215893)
— [Details](attachment.cgi?id=9215893&action=edit)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1705211#c5)• 4 years ago |
|  | |

Attached file
[spoof-iframe-src-calc.html](attachment.cgi?id=9215895)
— [Details](attachment.cgi?id=9215895&action=edit)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1705211#c6)• 4 years ago |
|  | |

Attached file
[spoof-iframe-srcdoc-calc.html](attachment.cgi?id=9215896)
— [Details](attachment.cgi?id=9215896&action=edit)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1705211#c7)• 4 years ago |
|  | |

Attached file
[spoof-calc-diff-tab.html](attachment.cgi?id=9215897)
— [Details](attachment.cgi?id=9215897&action=edit)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1705211#c8)• 4 years ago |
|  | |

Attached file
[spoof-new-tab.html](attachment.cgi?id=9215898)
— [Details](attachment.cgi?id=9215898&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1705211#c9)• 4 years ago |
|  | |

There's probably no way to win -- did the 3rd party resource maliciously redirect to the protocol (and it should be blamed) or did the framing site pick that link because they knew it redirected (especially with an "open redirect" on some site)?

Probably should just ban external protocol links from redirects, http/https redirects should only go to other http/https links.

Keywords: [csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1705211#c10)• 4 years ago |
|  | |

Be advised this behavior also repros in other browsers, and I've filed reports with them. Coordination may be needed if disclosure dates are misaligned.

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1705211#c11)• 4 years ago |
|  | |

Re: #c9, the latter should not be a supported scenario. The site can directly link to the protocol, or the site can link/embed a cross-origin page which performs a client-side redirect to protocol (e.g. navigate/embed [https://other-site[.]tld/open](https://other-site%5B.%5Dtld/open) which loads a page with window.location = 'protocol:').

Agree restricting server-side redirects is a good option. Another option is to update address bar and dialog to reflect origin initiating the dialog, similar to HTTP Auth dialogs (ideally while rendering a blank page in background; Firefox currently keeps the prior page rendered under the cross-origin HTTP Auth dialog.)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1705211#c12)• 4 years ago |
|  | |

> External protocols in server-side redirects probably should be treated similarly to javascript: URLs in server-side redirects

Who wants to bet how many real websites are broken by introducing a restriction like this (e.g. "click this link to email X" -> mailto.cgi?userid=5 -> mailto:janedoe@company.com) ? Websites do "odd" things to load their external protocols all the time, unfortunately - cf. [bug 1650162](/show_bug.cgi?id=1650162 "VERIFIED FIXED - Teams, goedit, Roblox, GoToMeeting and Steam \"hidden iframe\" links in Firefox 78.0.1 don’t work") for sites loading external URIs from hidden iframes that have no documents in them at all.

> should not be a supported scenario

Maybe, but if we end up finding lots of places do it, thinking it a bad idea on its own won't help. :-(

Christoph, can you elaborate a bit on how principals are supposed to deal with redirects, in your understanding? I believe we use the triggering principal to pick the origin to display. I imagine we don't want to update that through redirected loads in general... but then I don't know how else we'd break this type of attack short of the suggestion above, ie banning server-side redirects to external protocols entirely.

(In reply to Alesandro Ortiz from [comment #10](/show_bug.cgi?id=1705211#c10 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))

> Be advised this behavior also repros in other browsers, and I've filed reports with them. Coordination may be needed if disclosure dates are misaligned.

Thanks for letting us know. Can you link to the relevant tickets? (They'll be restricted, that's fine, but it helps us to keep track of things rather than playing a game of telephone "hey have you had a report of an issue around external protocols" and hoping we find the right one :-) )

Flags: needinfo?(ckerschb)Flags: needinfo?(bugzilla-mozilla)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1705211#c13)• 4 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #12](/show_bug.cgi?id=1705211#c12 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))

> Who wants to bet how many real websites are broken by introducing a restriction like this (e.g. "click this link to email X" -> mailto.cgi?userid=5 -> mailto:janedoe@company.com) ? Websites do "odd" things to load their external protocols all the time, unfortunately - cf. [bug 1650162](/show_bug.cgi?id=1650162 "VERIFIED FIXED - Teams, goedit, Roblox, GoToMeeting and Steam \"hidden iframe\" links in Firefox 78.0.1 don’t work") for sites loading external URIs from hidden iframes that have no documents in them at all.

If block redirect approach is used, the restriction can be made only for cross-origin redirects.

e.g. Allowed: [https://example[.]com](https://example%5B.%5Dcom) links to [https://example[.]com/mailto.cgi?userid=5](https://example%5B.%5Dcom/mailto.cgi?userid=5) which responds with mailto: redirect

e.g. Blocked: [https://example[.]com](https://example%5B.%5Dcom) links to [https://attacker[.]tld/free-app-upgrade](https://attacker%5B.%5Dtld/free-app-upgrade) which responds with vulnerable-app://payload redirect

Piping the dialog-initiating origin ([https://attacker[.]tld](https://attacker%5B.%5Dtld) in second example above) into the dialog and related logic probably avoids most compat issues. This would match the safe behavior that currently occurs with HTTP Auth dialogs at the end of a redirect chain: they show the origin of the dialog initiator, not the navigation initiator.

> Thanks for letting us know. Can you link to the relevant tickets? (They'll be restricted, that's fine, but it helps us to keep track of things rather than playing a game of telephone "hey have you had a report of an issue around external protocols" and hoping we find the right one :-) )

Chromium: <https://crbug.com/1197889> (restricted, of course)

Chromium team indicated their fix will likely fix in Chromium-based Edge, but if that turns out to not be the case, I'll need to file a separate bug with Microsoft.

Flags: needinfo?(bugzilla-mozilla)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1705211#c14)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1705211&comment_id=15364766 "1 revision") |
|  | |

Thanks for the detailed report Alesandro and taking the time to investigate this!

I agree with Gijs that navigation redirects to custom schemes are very likely so the conservative fix would be to ensure the dialog shows the correct origin. I suppose we could add telemetry to see how often it happens that a cross-origin navigation does such a redirect, but I'd still expect that to be common enough that we cannot break it. (If Chrome pursues this that would change our options. Mike West kindly added me to their issue and they don't have a plan yet. I'll relay if that changes and brief them on our thinking once we settle on something.)

I don't think that's ideal as dialogs showing different origins from the address bar is bad and from that perspective showing a blank page (or mostly opaque) overlay would be attractive, but I'm not sure how feasible that is. Probably not feasible for a short term fix.

(Another dialog not mentioned above that is relevant here is downloads, but we use the final URL there as well.)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a131191_102998)• 4 years ago |

See Also: → <https://bugs.chromium.org/p/chromium/issues/detail?id=1197889>

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1705211#c15)• 3 years ago |
|  | |

(In reply to Anne (:annevk) from [comment #14](/show_bug.cgi?id=1705211#c14 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))

> Thanks for the detailed report Alesandro and taking the time to investigate this!
>
> I agree with Gijs that navigation redirects to custom schemes are very likely so the conservative fix would be to ensure the dialog shows the correct origin. I suppose we could add telemetry to see how often it happens that a cross-origin navigation does such a redirect, but I'd still expect that to be common enough that we cannot break it. (If Chrome pursues this that would change our options. Mike West kindly added me to their issue and they don't have a plan yet. I'll relay if that changes and brief them on our thinking once we settle on something.)
>
> I don't think that's ideal as dialogs showing different origins from the address bar is bad and from that perspective showing a blank page (or mostly opaque) overlay would be attractive, but I'm not sure how feasible that is. Probably not feasible for a short term fix.
>
> (Another dialog not mentioned above that is relevant here is downloads, but we use the final URL there as well.)

This bug should now be actionable by the Firefox team:

Chromium has a patch under review that will make the browser "use the origin of the last redirecting server (falling back to the request\_initiator if there were no redirects / if the request goes straight to an external protocol)." (source: <https://bugs.chromium.org/p/chromium/issues/detail?id=1197889#c25> )

Patch: [https://chromium-review.googlesource.com/c/chromium/src/+/3113931](https://chromium-review.googlesource.com/c/chromium/src/%2B/3113931)

The pending comments are around the tests, not the fix itself, so now seems like a good time to implement a fix in Firefox and/or discuss the fix with the Chromium team if the Firefox team has any concerns.

Let me know if you need more info from me as reporter.

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1705211#c16)• 3 years ago |
|  | |

Showing the origin of the last server serving a redirect or the initiating document when there is no redirect is the conservative fix referred to in [comment 14](/show_bug.cgi?id=1705211#c14 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"). It's not ideal, but better than the status quo.

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1705211#c17)• 3 years ago |
|  | |

Hello,

Friendly ping: Is there an update on this issue?

I've asked Chromium to embargo their crbug to prevent disclosure of the same issue in Firefox. I don't want to keep the Chromium report private for longer than necessary (nor keep Firefox users at risk of this vulnerability), so any update is appreciated.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1705211#c18)• 3 years ago |
|  | |

(In reply to Alesandro Ortiz from [comment #15](/show_bug.cgi?id=1705211#c15 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))

> Chromium has a patch under review that will make the browser "use the origin of the last redirecting server (falling back to the request\_initiator if there were no redirects / if the request goes straight to an external protocol)." (source: <https://bugs.chromium.org/p/chromium/issues/detail?id=1197889#c25> )

To do this this we need a better way of passing this information which is going to require DOM: Security work. Right now we rely on the origin of the triggering principal for the request, which is always the originating site for the initial request. That principal is also not modifiable (I think?) so I don't really know how we would fix this, from a practical/gecko perspective, unless we actually detach the loads rather than treating them as one load, which will probably break other security constructs (same site cookies, referrer info, etc.).

Christoph, can you take a look and/or ensure we prioritize this on the DOM side of things per [comment 17](/show_bug.cgi?id=1705211#c17 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol")?

Group: firefox-core-security → core-securityType: task → defectComponent: Security → DOM: SecurityProduct: Firefox → Core

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a18734413_159069)• 3 years ago |

Group: core-security → dom-core-security

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1705211#c19)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1705211&comment_id=15661089 "1 revision") |
|  | |

Actually something like this:

```
diff --git a/uriloader/exthandler/nsExternalProtocolHandler.cpp b/uriloader/exthandler/nsExternalProtocolHandler.cpp
--- a/uriloader/exthandler/nsExternalProtocolHandler.cpp
+++ b/uriloader/exthandler/nsExternalProtocolHandler.cpp
@@ -159,17 +159,22 @@ nsresult nsExtProtocolChannel::OpenURL()
 #endif

     RefPtr<mozilla::dom::BrowsingContext> ctx;
     rv = mLoadInfo->GetTargetBrowsingContext(getter_AddRefs(ctx));
     if (NS_FAILED(rv)) {
       goto finish;
     }

-    RefPtr<nsIPrincipal> principal = mLoadInfo->TriggeringPrincipal();
+    RefPtr<nsIPrincipal> principal;
+    if (mLoadInfo->RedirectChainIncludingInternalRedirects().IsEmpty()) {
+      principal = mLoadInfo->TriggeringPrincipal();
+    } else {
+      mLoadInfo->RedirectChainIncludingInternalRedirects().LastElement()->GetPrincipal(getter_AddRefs(principal));
+    }
     rv = extProtService->LoadURI(mUrl, principal, ctx,
                                  mLoadInfo->GetLoadTriggeredFromExternal());

     if (NS_SUCCEEDED(rv) && mListener) {
       mStatus = NS_ERROR_NO_CONTENT;

       RefPtr<nsExtProtocolChannel> self = this;
       nsCOMPtr<nsIStreamListener> listener = mListener;

```

looks like it "works" - except that then, hardly any of these exploits open a dialog at all -- because the x-domain spoofing mitigation we (okay, I) implemented in [bug 1606797](/show_bug.cgi?id=1606797 "RESOLVED FIXED - Do not allow more than one simultaneous \"open external protocol\" dialog to appear per originating tab") notice that principal A is trying to load an external protocol handler in a browsing context that is currently under the control of principal B, and we block that... I could move the check but that feels like a footgun if we end up adding consumers, or I could pass 2 principals which feels like a recipe for confusion. Passing the loadinfo around would help but would be a bit heavyweight, per Nika's feedback in <https://phabricator.services.mozilla.com/D120879> .

Nika or Christoph, do you have thoughts on how to proceed? I think removing the x-frame checks is likely to regress [bug 1636654](/show_bug.cgi?id=1636654 "VERIFIED FIXED - External Protocol / scheme handler dialog can be spawned from background tabs leading to spoofing of the origin of the link that's opening")...

Flags: needinfo?(nika)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a18742995_1689)• 3 years ago |

Flags: needinfo?(dveditz)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1705211#c20)• 3 years ago |
|  | |

Attached file
[Bug 1705211, r?nika!,ckerschb!](attachment.cgi?id=9252016)
— [Details](attachment.cgi?id=9252016&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a19185795_600971)• 3 years ago |

Assignee: nobody → gijskruitbosch+bugs

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1705211#c21)• 3 years ago |
|  | |

I've just put up a patch to just pass 2 principals, that seems the least terrible here. We can iterate on the patch if need be.

Flags: needinfo?(nika)Flags: needinfo?(dveditz)Flags: needinfo?(ckerschb)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1705211#c22)• 3 years ago |
|  | |

:Gijs, thanks for the updates and writing the patch. After it's reviewed and lands on Firefox Nightly (or any other channel), please let me know so I can verify the fix.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a19259918_1689)• 3 years ago |

Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a19347425_1689)• 3 years ago |

Severity: -- → S3Priority: -- → P3Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][domsecurity-active]

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a19858359_159069)• 3 years ago |

Blocks: [1743653](/show_bug.cgi?id=1743653 "RESOLVED FIXED - Add automated tests for external protocol origin spoof")

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1705211#c23)• 3 years ago |
|  | |

Is there a version of the window.location testcase, ie:

(In reply to Alesandro Ortiz from [comment #0](/show_bug.cgi?id=1705211#c0 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))

> Scenario 2: JavaScript redirect (window.location)
>
> 1. Navigate to <https://www.google.com/url?q=https%3A%2F%2Faogarantiza.com%2Ffirefox%2Fexternal-protocol%2Fcalc.php&sa=D&sntz=1&usg=AFQjCNEoF7jt2NHEpoTRgtZbbx8F6Na1Gg>

that doesn't also have a meta refresh tag? I'd like to make sure both cases are covered.

Flags: needinfo?(bugzilla-mozilla)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1705211#c24)• 3 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #23](/show_bug.cgi?id=1705211#c23 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))

> Is there a version of the window.location testcase, ie:
>
> (In reply to Alesandro Ortiz from [comment #0](/show_bug.cgi?id=1705211#c0 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))
>
> > Scenario 2: JavaScript redirect (window.location)
> >
> > 1. Navigate to <https://www.google.com/url?q=https%3A%2F%2Faogarantiza.com%2Ffirefox%2Fexternal-protocol%2Fcalc.php&sa=D&sntz=1&usg=AFQjCNEoF7jt2NHEpoTRgtZbbx8F6Na1Gg>
>
> that doesn't also have a meta refresh tag? I'd like to make sure both cases are covered.

There wasn't, but there is now! This page will perform a client-side JavaScript redirect to the "malicious" URL after one second: <https://alesandroortiz.com/security/firefox/external-protocol/spoof-js-redirect.html>

```
<script>
  setTimeout(() => {
    window.location = 'https://aogarantiza.com/firefox/external-protocol/calc.php';
  }, 1000);
</script>

```
Flags: needinfo?(bugzilla-mozilla)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1705211#c25)• 3 years ago |
|  | |

Landed: <https://hg.mozilla.org/integration/autoland/rev/9c044551012e1de039b60aa12431fffcd603db74>

Backed out for causing bc test failures on browser\_protocol\_ask\_dialog\_external.js:

<https://hg.mozilla.org/integration/autoland/rev/6d772f67fc4277dce1675f4b7b2713ecaf9c708b>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&fromchange=74d8d50450823d7aaf5e5262095e414ef1e82868&searchStr=linux%2C18.04%2Cx64%2Cwebrender%2Copt%2Cmochitests%2Cwith%2Csoftware%2Cwebrender%2Cand%2Cfission%2Cenabled%2Ctest-linux1804-64-qr%2Fopt-mochitest-browser-chrome-swr-fis-e10s%2Cbc3&tochange=6d772f67fc4277dce1675f4b7b2713ecaf9c708b&selectedTaskRun=P9PohFbvSCiJVJ0Ie5P-2w.1>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=359764871&repo=autoland>

```
TEST-UNEXPECTED-FAIL | uriloader/exthandler/tests/mochitest/browser_protocol_ask_dialog_external.js | Shouldn't have opened a dialog! -
TEST-UNEXPECTED-FAIL | uriloader/exthandler/tests/mochitest/browser_protocol_ask_dialog_external.js | Test timed out -
TEST-UNEXPECTED-FAIL | uriloader/exthandler/tests/mochitest/browser_protocol_ask_dialog_external.js | Uncaught exception received from previously timed out test - mocked-protocol-handler observer not removed before the end of test
TEST-UNEXPECTED-FAIL | uriloader/exthandler/tests/mochitest/browser_protocol_ask_dialog_external.js | Found a tab after previous test timed out: about:blank

```
Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1705211#c26)• 3 years ago |
|  | |

Bah. Fixed the test and re-queued for landing.

(In reply to Alesandro Ortiz from [comment #24](/show_bug.cgi?id=1705211#c24 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))

> There wasn't, but there is now!

Thanks! Doublechecked and that too now works with the patch. I'll ping again once this is in Nightly...

Flags: needinfo?(gijskruitbosch+bugs)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1705211#c27)• 3 years ago |
|  | |

r=nika,ckerschb

<https://hg.mozilla.org/integration/autoland/rev/fcb2c4f7439e7857628e5194ceef5026665b1f72>

<https://hg.mozilla.org/mozilla-central/rev/fcb2c4f7439e>

Group: dom-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 3 years ago
[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 96 Branch

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a20000575_101158)• 3 years ago |

Blocks: [1743868](/show_bug.cgi?id=1743868 "RESOLVED FIXED - Port bug 1705211 to Thunderbird")

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1705211#c28)• 3 years ago |
|  | |

OK, this should be in today's nightly, and I believe all the testcases linked to this bug should be fixed. It'd be great if you could confirm that.

Flags: needinfo?(bugzilla-mozilla)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1705211#c29)• 3 years ago |
|  | |

Verified as fixed in Nightly 2021-12-02 on Windows 10, using all PoCs. Thanks for fixing, Gijs!

I thought the fix would also resolve another concerning behavior, but I see it's still reproducible, so I'll file a separate security bug for that in a few hours. It's reproducible with a couple of the PoCs in this report, but fix would be separate and might affect other areas too. Will provide bug ID once filed.

Flags: needinfo?(bugzilla-mozilla)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1705211#c30)• 3 years ago |
|  | |

Actually, the issue was explicitly part of this report (Scenario 5's PoC) and could also be reproduced with Scenario 4's PoC. I've still filed a separate issue since it apparently requires a distinct fix.

See [bug 1744158](/show_bug.cgi?id=1744158 "VERIFIED FIXED - Security: Background page using iframe can show external protocol dialog in other tabs and without throttling").

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a20471238_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---) → [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1705211#c31)• 3 years ago |
|  | |

Looks like this needs a tiny bit of rebasing for ESR91. Please attach a rebased patch and request approval when you get a chance.

[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=wontfix)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)
[tracking-firefox96](/buglist.cgi?f1=cf_tracking_firefox96&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox96&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [96+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=96%2B)Flags: needinfo?(gijskruitbosch+bugs)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1705211#c32)• 3 years ago |
|  | |

Thanks for the reward!

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a20570233_1689)• 3 years ago |

See Also: → [CVE-2022-22739](/show_bug.cgi?id=1744158 "VERIFIED FIXED - Security: Background page using iframe can show external protocol dialog in other tabs and without throttling")

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a20627113_488993)• 3 years ago |

Flags: qe-verify+

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1705211#c33)• 3 years ago |
|  | |

The related [bug 1744158](/show_bug.cgi?id=1744158 "VERIFIED FIXED - Security: Background page using iframe can show external protocol dialog in other tabs and without throttling") was fixed a couple of days ago. Verified on Nightly 2021-12-11.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1705211#c34)• 3 years ago |
|  | |

Attached patch

[ESR backport patch](attachment.cgi?id=9255077&action=diff)
— [Details](attachment.cgi?id=9255077&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1705211&attachment=9255077)

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1705211#c35)• 3 years ago |
|  | |

Comment on [attachment 9255077](/attachment.cgi?id=9255077 "ESR backport patch") [[details]](/attachment.cgi?id=9255077&action=edit "ESR backport patch") [[diff]](/attachment.cgi?id=9255077&action=diff "ESR backport patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1705211&attachment=9255077)

ESR backport patch

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: sec-moderate
* **User impact if declined**: confusing origins in external protocol dialogs
* **Fix Landed on Version**: 96
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Relatively straightforward patch
* **String or UUID changes made by this patch**: No string changes; one interface change, but we don't do UUID changes anymore, right? (Should we fix this form?)
[Attachment #9255077](/attachment.cgi?id=9255077&action=edit "ESR backport patch") -
Flags: approval-mozilla-esr91?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1705211#c36)• 3 years ago |
|  | |

Comment on [attachment 9255077](/attachment.cgi?id=9255077 "ESR backport patch") [[details]](/attachment.cgi?id=9255077&action=edit "ESR backport patch") [[diff]](/attachment.cgi?id=9255077&action=diff "ESR backport patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1705211&attachment=9255077)

ESR backport patch

Approved for 91.5esr.

[Attachment #9255077](/attachment.cgi?id=9255077&action=edit "ESR backport patch") -
Flags: approval-mozilla-esr91? → approval-mozilla-esr91+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1705211#c37)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr91/rev/c8fa4ab303fa>

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a21035113_551058)• 3 years ago |

QA Whiteboard: [qa-triaged]

|  | [Anca Soncutean, Desktop QA](/user_profile?user_id=606068) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1705211#c38)• 3 years ago |
|  | |

Reproduced with Fx 89.0a1 (2021-04-14) on Windows 10.

Verified fixed with Fx 96.0b4 and 91.5esr (treeherder build) on Windows 10.

Status: RESOLVED → VERIFIED
[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=verified)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=verified)Flags: qe-verify+

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1705211#c39)• 3 years ago |
|  | |

Does Mozilla have an automatic disclosure timeline for this type of bug? I'd like to set a date of March 21st, 2022 for public disclosure of this bug and [bug 1744158](/show_bug.cgi?id=1744158 "VERIFIED FIXED - Security: Background page using iframe can show external protocol dialog in other tabs and without throttling").

Please let me know if the disclosure timeline is acceptable for both bugs.

This allows over 14 weeks for both bug fixes to reach users. Per [comment #17](/show_bug.cgi?id=1705211#c17 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"), Chromium has embargoed their bug report until the date I request, which will be the same date that Mozilla agrees to here.

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1705211#c40)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1705211&comment_id=15697895 "1 revision") |
|  | |

(In reply to Alesandro Ortiz from [comment #39](/show_bug.cgi?id=1705211#c39 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))

> Does Mozilla have an automatic disclosure timeline for this type of bug? I'd like to set a date of March 21st, 2022 for public disclosure of this bug and [bug 1744158](/show_bug.cgi?id=1744158 "VERIFIED FIXED - Security: Background page using iframe can show external protocol dialog in other tabs and without throttling").
>
> Please let me know if the disclosure timeline is acceptable for both bugs.
>
> This allows over 14 weeks for both bug fixes to reach users.

Just to be clear, I think you're counting from now, right? Release dates for 96 and 91.5esr are Jan 11, and Jan 11 - March 21st is just under 10 weeks, if I'm not mistaken?

(not a comment on whether that's enough or otherwise, just trying to make sure we're all on the same page!)

I'm afraid I don't know the answer to this, but Dan or Tom should be able to help.

Flags: needinfo?(tom)Flags: needinfo?(gijskruitbosch+bugs)Flags: needinfo?(dveditz)

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1705211#c41)• 3 years ago |
|  | |

The response from :dveditz in [bug 1744158](/show_bug.cgi?id=1744158 "VERIFIED FIXED - Security: Background page using iframe can show external protocol dialog in other tabs and without throttling") included this:

> any time after we ship 97 (early February?) is fine

I was counting from when [bug 1744158](/show_bug.cgi?id=1744158 "VERIFIED FIXED - Security: Background page using iframe can show external protocol dialog in other tabs and without throttling") was marked as fixed, which was December 10th. Google Search and [this website](https://calculat.io/en/date/count/14--weeks--from--10-december-2021) calculated that Friday, March 18th would be 14 weeks, so I suggested the following Monday which is March 21st.

If patches for both bugs will be on 96 Stable by mid-January, 2 months is more than reasonable to allow users to update. Based on :dveditz's comment, using March 21st as disclosure date for now.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1705211#c42)• 3 years ago |
|  | |

(In reply to Alesandro Ortiz from [comment #41](/show_bug.cgi?id=1705211#c41 "VERIFIED FIXED - Security: Origin spoof in external protocol dialogs via server-side redirect to external protocol"))

> The response from :dveditz in [bug 1744158](/show_bug.cgi?id=1744158 "VERIFIED FIXED - Security: Background page using iframe can show external protocol dialog in other tabs and without throttling") included this:
>
> > any time after we ship 97 (early February?) is fine

Ah, sorry, I didn't see this (this is what I get for reading my needinfos before chasing the rest of my sec-sensitive bugmail...). Then I think the needinfos here are probably superfluous.

Flags: needinfo?(tom)Flags: needinfo?(dveditz)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a22943472_428608)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][domsecurity-active] → [reporter-external] [client-bounty-form][domsecurity-active][adv-main96+][adv-ESR91.5+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1705211#c43)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9257645) (obsolete)
— [Details](attachment.cgi?id=9257645&action=edit)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1705211#c44)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9257646)
— [Details](attachment.cgi?id=9257646&action=edit)

[Attachment #9257645](/attachment.cgi?id=9257645&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a23119057_428608)• 3 years ago |

Alias: CVE-2022-22748

|  | [Alesandro Ortiz](/user_profile?user_id=239403)  Reporter |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1705211#c45)• 3 years ago |
|  | |

Coordinated disclosure date has arrived. Can someone please make this bug public? I've requested the same from Chromium for their related bug.

Flags: needinfo?(ckerschb)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a29527282_578488)• 3 years ago |

Flags: needinfo?(ckerschb) → needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a29655042_1689)• 3 years ago |

Group: core-security-releaseFlags: needinfo?(dveditz)

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1705211#a98656638_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1705211&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Alesandro Ortiz](/user_profile?user_id=239403)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


