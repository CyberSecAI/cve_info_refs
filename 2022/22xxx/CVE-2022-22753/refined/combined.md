=== Content from bugzilla.mozilla.org_480c6b29_20250115_092101.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1732435)
* [XML](/show_bug.cgi?ctype=xml&id=1732435)

Closed
[Bug 1732435](/show_bug.cgi?id=1732435)
(CVE-2022-22753)

Opened 3 years ago
Closed 3 years ago

# Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service

## Categories

### (Toolkit :: Application Update, defect, P1)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Application%20Update#Application%20Update)

Application Update
▾

Toolkit :: Application Update
Application update for Firefox and Thunderbird.
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Application%20Update&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Application%20Update&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Application%20Update)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Desktop

Windows

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

97 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Install Update Workflow | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox-esr91 | [97+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=97%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) |
| firefox92 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix) |
| firefox93 | [-](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix) |
| firefox94 | [-](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=wontfix) |
| firefox95 | [+](/buglist.cgi?f1=cf_tracking_firefox95&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=wontfix) |
| firefox96 | [+](/buglist.cgi?f1=cf_tracking_firefox96&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix) |
| firefox97 | [+](/buglist.cgi?f1=cf_tracking_firefox97&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 |  | wontfix |
| firefox-esr91 | 97+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox92 |  | wontfix |
| firefox93 | - | wontfix |
| firefox94 | - | wontfix |
| firefox95 | + | wontfix |
| firefox96 | + | wontfix |
| firefox97 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sebbity, Assigned: bytesized)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/96e4252ea3aebe64d73acae0a509f240?d=mm&size=40)  [bytesized](/user_profile?user_id=563604)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d6607825cb6a68be435e0fde66f25db5?d=mm&size=40)  [sebbity](/user_profile?user_id=465312)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/50e82ef70720dfcf1385f583e34f9ba9?d=mm&size=40)  [erchen](/user_profile?user_id=753852)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[mozilla-hub.atlassian.net/browse/FIDE...](https://mozilla-hub.atlassian.net/browse/FIDEDI-312 "https://mozilla-hub.atlassian.net/browse/FIDEDI-312")

## Details

### (Keywords: csectype-priv-escalation, reporter-external, sec-high, Whiteboard: [reporter-external] [client-bounty-form] [verif?][fidedi-security][sec-survey][post-critsmash-triage][adv-main97+][adv-esr91.6+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-22753

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][fidedi-security][sec-survey][post-critsmash-triage][adv-main97+][adv-esr91.6+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a7036614_1689 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | [qe-verify](#a7282615_553429 "3 years ago") | - |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (8 files)

| [poc.zip](/attachment.cgi?id=9242817)  [3 years ago](#c0)  [Seb Patane (he/him)](/user_profile?user_id=465312)   16.05 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9242817&action=edit) |
| --- | --- | --- |
| [Bug 1732435 - r=nalexander!](/attachment.cgi?id=9244877)  [3 years ago](#c7)  [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#a6431341_578488 "3 years ago") | [Details](/attachment.cgi?id=9244877&action=edit) | [Review](/attachment.cgi?id=9244877) |
| [Bug 1732435 - r=nalexander!](/attachment.cgi?id=9244878)  [3 years ago](#c8)  [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#a6431342_578488 "3 years ago") | [Details](/attachment.cgi?id=9244878&action=edit) | [Review](/attachment.cgi?id=9244878) |
| [Bug 1732435 - r=nalexander!](/attachment.cgi?id=9244880)  [3 years ago](#c9)  [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#a6431342_578488 "3 years ago") | [Details](/attachment.cgi?id=9244880&action=edit) | [Review](/attachment.cgi?id=9244880) |
| [Bug 1732435 - r=nalexander!](/attachment.cgi?id=9244881)  [3 years ago](#c10)  [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#a6431343_578488 "3 years ago") | [Details](/attachment.cgi?id=9244881&action=edit) | [Review](/attachment.cgi?id=9244881) |
| [Bug 1732435 - r=nalexander!](/attachment.cgi?id=9244882)  [3 years ago](#c11)  [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#c23 "3 years ago") | [Details](/attachment.cgi?id=9244882&action=edit) | [Review](/attachment.cgi?id=9244882) |
| [Bug 1732435 - ESR patch r=nalexander!](/attachment.cgi?id=9253526)  [3 years ago](#c20)  [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-esr91+](#c33 "3 years ago") | [Details](/attachment.cgi?id=9253526&action=edit) | [Review](/attachment.cgi?id=9253526) |
| [advisory.txt](/attachment.cgi?id=9261956)  [3 years ago](#c35)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   376 bytes, text/plain |  | [Details](/attachment.cgi?id=9261956&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Seb Patane (he/him)](/user_profile?user_id=465312)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1732435#c0)• 3 years ago |
|  | |

Attached file
[poc.zip](attachment.cgi?id=9242817)
— [Details](attachment.cgi?id=9242817&action=edit)

There is a time of check to time of use bug in the way the fix-update-directory-perms functionality of the maintenance service locks folders that allows an attacker to swap out a subfolder with a junction. The files in the junction target will then have 'All Permissions' for the 'Users' group added to them. This effectively allows privilege escalation to SYSTEM, eg. by targeting the Mozilla Maintenance Service installation directory and replacing the maintenanceservice.exe binary with a malicious one.

The TOCTOU is in the commonupdatedir.cpp:Lock() function [0]. There is a brief window between the initial call to GetFileAttributesW() on line 413 to when the directory is locked with the mozlock file on line 435 and then again to when the attributes are updated on line 448.

During this time, the directory referenced in path can be replaced with a directory junction to a temporary directory. When this happens, the mozlock file is created in the temporary directory target, which doesn't lock access to original path. The junction can then be removed and replaced with a normal folder before the second call to GetFileAttributesW() so the class records attributes for a standard folder.

It needs to be left as a normal folder throughout the filesystem link checks in the Reset() function (line 508) and up until after the call to file.PermsOK() in EnsureCorrectPermissions() (line 1486) to avoid the directory being moved out of the way. After this point, it can be replaced with a junction to the actual target directory which the maintenance service will recurse into (line 1528) and update the permissions of all files contained.

The fact the mAttributes property is only updated/checked at lock time means once it's poisoned we don't have to worry about it.

The timing is very tight, but I've confirmed it's possible with a proof of concept (attached). I did have to run Prime95 to generate some load at the same time and I manually changed it's priority to Above Normal - the idea being that the maintenance service runs at Normal priority and the POC runs at High priority so the load should only slow down the maintenance service.

I had success with 0ms delay for stage 1, 181ms delay for stage 2 and 11ms delay for stage 3. The only mandatory parameter the POC takes is the target directory to overwrite the permissions on, but will also take lower/upper bounds for the delays on the three race "stages". The following command line worked on my system after around 20 minutes:

.\FirefoxPoc.exe 'C:\Program Files (x86)\Mozilla Maintenance Service\' 0 100 150 250 0 50

Where 0 100 means stage 1 will start at a delay of 0ms and keep trying up until 100ms, 150 250 is stage 2 starting at 150ms up to 250ms and stage 3 starting at 0ms up to 50ms. If that yields no results after running a few times, you can just run the command line without the timing hints and it will try to work it out itself - that took me a good five or so hours though. Eg.

.\FirefoxPoc.exe 'C:\Program Files (x86)\Mozilla Maintenance Service\'

Please let me know if you need more information

[0] - <https://hg.mozilla.org/mozilla-central/file/00858d05a9e2685dac987d90866f201989def64d/toolkit/mozapps/update/common/commonupdatedir.cpp#l412>

Flags: sec-bounty?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a2335_159069)• 3 years ago |

Type: task → defectComponent: Security → Application UpdateOS: Unspecified → WindowsProduct: Firefox → ToolkitHardware: Unspecified → Desktop

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1732435#c1)• 3 years ago |
|  | |

Although it sounds pretty difficult to exploit this, this does seem to be a valid privilege escalation bug, so I'm marking it S1. I'm not planning to run the POC code, but the description of the exploit sounds valid to me. I'll see about getting this fixed right after what I'm currently working on.

Assignee: nobody → ksteuberSeverity: -- → S1
[tracking-firefox93](/buglist.cgi?f1=cf_tracking_firefox93&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=%3F)
[tracking-firefox94](/buglist.cgi?f1=cf_tracking_firefox94&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%3F)Priority: -- → P1

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a428467_24572)• 3 years ago |

[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=affected)
[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected)
[tracking-firefox93](/buglist.cgi?f1=cf_tracking_firefox93&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=%2B)
[tracking-firefox94](/buglist.cgi?f1=cf_tracking_firefox94&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a463594_75935)• 3 years ago |

[status-firefox92](/buglist.cgi?f1=cf_status_firefox92&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox92&o1=equals&v1=wontfix)
[status-firefox93](/buglist.cgi?f1=cf_status_firefox93&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox93&o1=equals&v1=wontfix)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=%3F)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1732435#c2)• 3 years ago |
|  | |

Well, I've spent some time thinking about this, and I can't really figure out a way to fix the existing code. So instead I want to remove the Maintenance Service's `fix-update-directory-perms` functionality altogether.

However, it does exist to solve an important problem. The default permissions on the `ProgramData` directory grant edit permissions to a file's creator, but not to other users. We make sure to always to create `ProgramData/Mozilla` such that all containing files will inherit permissions that allow any user to edit them, so that any user can update. But, the directory might already exist since we used it in an old version of Firefox and didn't set the permissions then the way that we do now. This is essentially why the `fix-update-directory-perms` functionality exists: to fix the permissions on an existing update directory to allow all users to successfully write to that directory.

Thus, I don't really want to remove `fix-update-directory-perms` without replacing it with something that can address the above problem. So here is what I want to replace this with:

1. At installation time, check the permissions on `ProgramData/Mozilla`. If members of the `Users` group cannot write to it, move it out of the way (somewhere like `ProgramData/Mozilla-backup-<UUID>`) and forget about it.
2. Right now, we explicitly set the permissions when creating `ProgramData/Mozilla`, but I don't believe that we set them for any of the files/directories within. We just allow them to inherit from the permissions on `ProgramData/Mozilla`. I want to additionally explicitly set the permissions when creating `ProgramData/Mozilla/<install_hash>`.

Advantages:

* If step 1 succeeds, the problem should be permanently solved for that machine.
* No need to check for links. If `ProgramData/Mozilla` is a link in step 1, we just rename the link. No harm done.
* No ability for malicious code to repeatedly invoke the elevated parts of this.
* No recursing and making changes to paths with arbitrary filenames.

Disadvantages:

* If step 1 is invoked, any existing installations will lose their update history and, if they have an update in progress it will be lost.
* If there is a permission problem, the updater will no longer have the ability to fix it. Update will fail and the user will be forced to run the installer to fix things.

I consider these disadvantages to be acceptable, particularly because this problem should be quite rare.

I'm additionally changing the severity of this from S1 to S2 at the request of Release Management.

Severity: S1 → S2
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=%3F) → ---Priority: P1 → --

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a463788_563604)• 3 years ago |

[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=%3F)Priority: -- → P1

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a477217_1689)• 3 years ago |

Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1732435#c3)• 3 years ago |
|  | |

Hmm, I just realized a less acceptable drawback of the approach I outlined in [Comment 2](/show_bug.cgi?id=1732435#c2 "RESOLVED FIXED - Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service"). It would also cause Firefox installations to lose some update settings. That wouldn't be great. I think that I'm going to have to rethink this. I'll report back when I have a better idea.

|  | [Seb Patane (he/him)](/user_profile?user_id=465312)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1732435#c4)• 3 years ago |
|  | |

It really is a tricky problem to solve. I've been mulling it over as well and after playing around with some folder permissions it looks like if you remove all write/modify permissions from the folder it would achieve the original behaviour that Lock() is trying to achieve.

Without those permissions, files/subfolders within can't be created or moved so the state of the folder is effectively "locked" from outside influence. Subfolders can be deleted if the user still holds write/modify permissions for the subfolder, but I don't think this can be used maliciously if it can't be replaced with a link to somewhere else?

Could the flow go like this:

1. Remove all permissions except for SYSTEM from C:\ProgramData\Mozilla
2. For each file in the folder, check if they're links and set permissions appropriately

* The files shouldn't be able to be replaced with a link of any kind since the parent folder restricts new file creation, so link checking would be accurate

3. For each subfolder in the folder, remove all permissions except for SYSTEM, do the link checking and recurse into them

* Similar to the files, once the permissions are removed on the folder/subfolder they shouldn't be able to be replaced

4. Once all files/subfolders in the folder are processed, set the final permissive permissions on the folders themselves

* Since there's no more work to be done within the folder it doesn't matter what users can do in it

I think without any permissions to perform a bait and switch it should prevent the problem without losing any data? Though I'm not sure how permissions inheritance would effect things, including if some subfolders were set to not inherit permissions (which normal Users are able to do).

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1732435#c5)• 3 years ago |
|  | |

I've actually considered that solution, but I am not keen on it. The problem I have is that, in certain cases, I don't think that there is any good way to recover from errors. For example, let's say that we lock down a directory by removing most permissions from it. Then we go to sanitize the directory and discover a hard link inside. We attempt to remove the hard link but, for whatever reason, we fail to remove it. What do we do now? If we stop altogether, we may break update for every user of every installation. If we try to correct the permissions before we bail out, they could be inherited by the hard link, potentially changing the permissions of an arbitrary file in an unacceptable way.

Here is what I think that I want to do instead. This problem basically exists because the update directory may already exist with the wrong permissions. So we are simply going to migrate the update directory to a new location. We'll pick an unusually named location, probably by putting a UUID in it to make it very unlikely that the directory already exists (potentially with the wrong permissions). And we will make very, very sure that we create the directory with the correct permissions in the first place. I believe that this should adequately solve the problem and allow us to remove the permission fixing code altogether.

|  | [Seb Patane (he/him)](/user_profile?user_id=465312)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1732435#c6)• 3 years ago |
|  | |

I think the current failure mode is to just ignore any kind of link if they exist, since they shouldn’t under normal operation.

Your plan to get rid of the permissions fixing functionality sounds much better though.

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1732435#c7)• 3 years ago |
|  | |

Attached file
[Bug 1732435 - r=nalexander!](attachment.cgi?id=9244877)
— [Details](attachment.cgi?id=9244877&action=edit)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1732435#c8)• 3 years ago |
|  | |

Attached file
[Bug 1732435 - r=nalexander!](attachment.cgi?id=9244878)
— [Details](attachment.cgi?id=9244878&action=edit)

Depends on D127894

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1732435#c9)• 3 years ago |
|  | |

Attached file
[Bug 1732435 - r=nalexander!](attachment.cgi?id=9244880)
— [Details](attachment.cgi?id=9244880&action=edit)

Depends on D127895

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1732435#c10)• 3 years ago |
|  | |

Attached file
[Bug 1732435 - r=nalexander!](attachment.cgi?id=9244881)
— [Details](attachment.cgi?id=9244881&action=edit)

Depends on D127896

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1732435#c11)• 3 years ago |
|  | |

Attached file
[Bug 1732435 - r=nalexander!](attachment.cgi?id=9244882)
— [Details](attachment.cgi?id=9244882&action=edit)

Depends on D127897

|  | [Seb Patane (he/him)](/user_profile?user_id=465312)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1732435#c12)• 3 years ago |
|  | |

I had a quick look at the patch - I think there's an issue in that creating a symbolic link at C:\ProgramData\Mozilla-1de4eec8-1241-4177-a864-e594e8d1fb38\updates\<hash> to an arbitrary directory will result in the arbitrary directory being created with full access for users. The same outcome can also be achieved, but without control over the directory name, by making C:\ProgramData\Mozilla-1de4eec8-1241-4177-a864-e594e8d1fb38\updates a junction to a target directory.

Eg. Using this to create a C:\Program Files\Mozilla Firefox\updated directory and running the maintenance service with the /replace option will end up with C:\Program Files\Mozilla Firefox full of attacker controlled files (as well as full permissions to the Mozilla Firefox directory). I'm fairly certain this could still be used for elevated code execution.

I haven't verified by making a custom build though, so I could be wrong.

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1732435#c13)• 3 years ago |
|  | |

(In reply to Seb Patane (he/him) from [comment #12](/show_bug.cgi?id=1732435#c12 "RESOLVED FIXED - Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service"))

> I had a quick look at the patch - I think there's an issue in that creating a symbolic link at C:\ProgramData\Mozilla-1de4eec8-1241-4177-a864-e594e8d1fb38\updates\<hash> to an arbitrary directory will result in the arbitrary directory being created with full access for users. The same outcome can also be achieved, but without control over the directory name, by making C:\ProgramData\Mozilla-1de4eec8-1241-4177-a864-e594e8d1fb38\updates a junction to a target directory.
>
> Eg. Using this to create a C:\Program Files\Mozilla Firefox\updated directory and running the maintenance service with the /replace option will end up with C:\Program Files\Mozilla Firefox full of attacker controlled files (as well as full permissions to the Mozilla Firefox directory). I'm fairly certain this could still be used for elevated code execution.

I believe that I have removed every place where this code can be called in an elevated context. Therefore, the code will not be able to create a directory at `C:\Program Files\Mozilla Firefox\updated` because it will not have the necessary permissions to do so. However, even if it cannot elevate privileges, it seems like it might be possible for malware to jump from one user to another with this mechanism. So I'll take out the permission setting for the `\hash` directory.

If you see a place where this can happen in an elevated context though, please let me know. I would like to avoid doing that.

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1732435#c14)• 3 years ago |
|  | |

Wait, I just realized that my earlier assertion that this cannot be called from elevated code logically must be incorrect. The elevated updater needs to know where the update directory is, so presumably it calls that function at some point. In any event, I've removed the permission setting of the `\<hash>` directory. And I think that I'll remove the setting of the `\updates` directory as well now.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1732435#c15)• 3 years ago |
|  | |

This isn't something we're going to want to backport once it lands. Dropping it from the Fx94 radar.

[status-firefox94](/buglist.cgi?f1=cf_status_firefox94&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox94&o1=equals&v1=wontfix)
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=affected)
[tracking-firefox93](/buglist.cgi?f1=cf_tracking_firefox93&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox93&o1=equals&v1=-)
[tracking-firefox94](/buglist.cgi?f1=cf_tracking_firefox94&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox94&o1=equals&v1=-)
[tracking-firefox95](/buglist.cgi?f1=cf_tracking_firefox95&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox95&o1=equals&v1=%2B)

|  | [AmirH [:Amir]](/user_profile?user_id=692168) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a1672682_692168)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][fidedi-security]

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1732435#c16)• 3 years ago |
|  | |

We are right up against the soft code freeze and this patch isn't quite ready yet. Additionally, since this is such a large change, I would be happier with it landing earlier in the cycle so it gets a bit more time on Nightly. So I'm going to plan on this landing in version 96 rather than 95.

I don't usually adjust tracking flags myself. Hopefully I got them right.

[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=wontfix)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a3369905_24572)• 3 years ago |

[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=affected)
[tracking-firefox96](/buglist.cgi?f1=cf_tracking_firefox96&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox96&o1=equals&v1=%2B)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1732435#c17)• 3 years ago |
|  | |

Comment on [attachment 9244877](/attachment.cgi?id=9244877 "Bug 1732435 - r=nalexander!") [[details]](/attachment.cgi?id=9244877&action=edit "Bug 1732435 - r=nalexander!")

[Bug 1732435](/show_bug.cgi?id=1732435 "RESOLVED FIXED - Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service") - r=nalexander!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: I think it would be pretty difficult. The patch is pretty big, and doesn't directly fix the bug. I think it would be more accurate to say that it removes the attach surface that the POC exploits. Even if someone could discern what the bug was from this patch, it is quite difficult to exploit.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: all supported releases
* **If not all supported branches, which bug introduced the flaw?**: [Bug 1551913](/show_bug.cgi?id=1551913 "VERIFIED FIXED - SYSTEM Privilege escalation via file permission overwrite by Maintenance Service")
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: This is quite a large patch. Backporting it would be difficult and risky. Given how hard this bug is to exploit, I would prefer not to backport this.
* **How likely is this patch to cause regressions; how much testing does it need?**: The patch is complex, but it should be well exercised by automated testing.
[Attachment #9244877](/attachment.cgi?id=9244877&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval?

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a4527864_563604)• 3 years ago |

[Attachment #9244878](/attachment.cgi?id=9244878&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval?
[Attachment #9244880](/attachment.cgi?id=9244880&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval?
[Attachment #9244881](/attachment.cgi?id=9244881&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval?
[Attachment #9244882](/attachment.cgi?id=9244882&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval?

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1732435#c18)• 3 years ago |
|  | |

There are some r+ patches which didn't land and no activity in this bug for 2 weeks.

:bytesized, could you have a look please?

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#not_landed.py).

Flags: needinfo?(nalexander)Flags: needinfo?(ksteuber)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1732435#c19)• 3 years ago |
|  | |

I've been discussing with the security team how to land this. We've decided that a separate, stripped-down patch for ESR will be necessary. I'll have it up as soon as possible.

Flags: needinfo?(nalexander)Flags: needinfo?(ksteuber)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1732435#c20)• 3 years ago |
|  | |

Attached file
[Bug 1732435 - ESR patch r=nalexander!](attachment.cgi?id=9253526)
— [Details](attachment.cgi?id=9253526&action=edit)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1732435#c21)• 3 years ago |
|  | |

Comment on [attachment 9253526](/attachment.cgi?id=9253526 "Bug 1732435 - ESR patch r=nalexander!") [[details]](/attachment.cgi?id=9253526&action=edit "Bug 1732435 - ESR patch r=nalexander!")

[Bug 1732435](/show_bug.cgi?id=1732435 "RESOLVED FIXED - Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service") - ESR patch r=nalexander!

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: This is sec-high.
* **User impact if declined**: The ESR maintenance service will continue to be vulnerable to the vulnerability described in this bug.
* **Fix Landed on Version**:
* **Risk to taking this patch**: Medium
* **Why is the change risky/not risky? (and alternatives if risky)**: This patch is sort of a compromise. I think that it is too risky to uplift the whole patch stack to ESR, but the security team thinks that it is too risky to leave the bug unpatched. So this patch strips the problematic functionality out of the maintenance service, but does not migrate the update directory to a new location. This means that it is possible for the update directory to have the wrong permissions, breaking update. However, the likelihood of this is quite low, and if it breaks, it will break loudly (the user will be informed that update is not working an prompted to update manually). I think that this will get rid of the security risk of this bug existing while introducing the minimum amount of risk of breaking things.
* **String or UUID changes made by this patch**: None
[Attachment #9253526](/attachment.cgi?id=9253526&action=edit "Bug 1732435 - ESR patch r=nalexander!") -
Flags: approval-mozilla-esr91?

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1732435#c22)• 3 years ago |
|  | |

Comment on [attachment 9253526](/attachment.cgi?id=9253526 "Bug 1732435 - ESR patch r=nalexander!") [[details]](/attachment.cgi?id=9253526&action=edit "Bug 1732435 - ESR patch r=nalexander!")

[Bug 1732435](/show_bug.cgi?id=1732435 "RESOLVED FIXED - Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service") - ESR patch r=nalexander!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: I think it would be pretty difficult. The patch doesn't directly fix the bug. I think it would be more accurate to say that it removes the attach surface that the POC exploits. Even if someone could discern what the bug was from this patch, it is quite difficult to exploit.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: all supported releases
* **If not all supported branches, which bug introduced the flaw?**: [Bug 1551913](/show_bug.cgi?id=1551913 "VERIFIED FIXED - SYSTEM Privilege escalation via file permission overwrite by Maintenance Service")
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: N/A - This is a backport for the ESR branch.
* **How likely is this patch to cause regressions; how much testing does it need?**: The patch is complex, but it should be well exercised by automated testing.
[Attachment #9253526](/attachment.cgi?id=9253526&action=edit "Bug 1732435 - ESR patch r=nalexander!") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a6431341_578488)• 3 years ago |

[Attachment #9244877](/attachment.cgi?id=9244877&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a6431342_578488)• 3 years ago |

[Attachment #9244878](/attachment.cgi?id=9244878&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval? → sec-approval+
[Attachment #9244880](/attachment.cgi?id=9244880&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a6431343_578488)• 3 years ago |

[Attachment #9244881](/attachment.cgi?id=9244881&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1732435#c23)• 3 years ago |
|  | |

Comment on [attachment 9244882](/attachment.cgi?id=9244882 "Bug 1732435 - r=nalexander!") [[details]](/attachment.cgi?id=9244882&action=edit "Bug 1732435 - r=nalexander!")

[Bug 1732435](/show_bug.cgi?id=1732435 "RESOLVED FIXED - Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service") - r=nalexander!

Approved to land in -central

[Attachment #9244882](/attachment.cgi?id=9244882&action=edit "Bug 1732435 - r=nalexander!") -
Flags: sec-approval? → sec-approval+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1732435#c24)• 3 years ago |
|  | |

Backed out for causing build bustages in toolkit/xre/nsXREDirProvider.cpp:

<https://hg.mozilla.org/integration/autoland/rev/5a84459b540a02cfe7c4baba89659b4cfed9f788>

After it had landed:

<https://hg.mozilla.org/integration/autoland/rev/aaa7386b1c23c011bbb18e999b8497f2b8769e7e>

<https://hg.mozilla.org/integration/autoland/rev/0c48fcbb4a1a1b58c938daebcb2a737713eb5ad9>

<https://hg.mozilla.org/integration/autoland/rev/6af39bb5d079bbec7259b5c37dc7d437b483bfa7>

<https://hg.mozilla.org/integration/autoland/rev/99d43bb37d9e44e87422892d0633ed6da8413dc0>

<https://hg.mozilla.org/integration/autoland/rev/14947028770eefac1942c4a0e6204b63fa816db7>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=pending%2Crunning%2Ctestfailed%2Cbusted%2Cexception%2Cusercancel&revision=14947028770eefac1942c4a0e6204b63fa816db7>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=360462933&repo=autoland>

```
toolkit/xre/MultiInstanceLock.cpp:17:12: fatal error: 'shlwapi.h' file not found

```
Flags: needinfo?(ksteuber)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1732435#c25)• 3 years ago |
|  | |

Gah, whoops. I included that file incorrectly. I'll get a fix up right away.

Flags: needinfo?(ksteuber)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1732435#c26)• 3 years ago |
|  | |

Backed out for causing bustages in nsXREDirProvider.cpp

<https://hg.mozilla.org/integration/autoland/rev/740fad344989d083fad880469a0555ac68010d34>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=360543532&repo=autoland>

```
toolkit/xre/nsXREDirProvider.cpp:126:20: error: unused function 'GetAppVendor' [-Werror,-Wunused-function]

```
Flags: needinfo?(ksteuber)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1732435#c27)• 3 years ago |
|  | |

On it.

Flags: needinfo?(ksteuber)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a6517052_75935)• 3 years ago |

[status-firefox97](/buglist.cgi?f1=cf_status_firefox97&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=affected)
[tracking-firefox97](/buglist.cgi?f1=cf_tracking_firefox97&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox97&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=%3F) → [96+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=96%2B)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1732435#c28)• 3 years ago |
|  | |

r=nalexander,application-update-reviewers

<https://hg.mozilla.org/integration/autoland/rev/8da34eb6cbfafbea2f99e6fa09c9b4a65af13532>

<https://hg.mozilla.org/mozilla-central/rev/8da34eb6cbfa>

r=nalexander,application-update-reviewers

<https://hg.mozilla.org/integration/autoland/rev/e033669757329332fdb736eb924026434a460d73>

<https://hg.mozilla.org/mozilla-central/rev/e03366975732>

r=nalexander

<https://hg.mozilla.org/integration/autoland/rev/e1442bbd4a7efa48c5caca6a788ea88afd2a2eef>

<https://hg.mozilla.org/mozilla-central/rev/e1442bbd4a7e>

r=nalexander

<https://hg.mozilla.org/integration/autoland/rev/8f6cccd15bdd345b948a5f2ba28becdae159c56a>

<https://hg.mozilla.org/mozilla-central/rev/8f6cccd15bdd>

r=nalexander,application-update-reviewers

<https://hg.mozilla.org/integration/autoland/rev/91496a50d143bd4fded519e9e1b11752c35c350c>

<https://hg.mozilla.org/mozilla-central/rev/91496a50d143>

Group: firefox-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 3 years ago
[status-firefox97](/buglist.cgi?f1=cf_status_firefox97&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 97 Branch

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1732435#c29)• 3 years ago |
|  | |

The patch landed in nightly and beta is affected.

:bytesized, is this bug important enough to require an uplift?

If not please set `status_beta` to `wontfix`.

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#uplift_beta.py).

Flags: needinfo?(ksteuber)

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1732435#c30)• 3 years ago |
|  | |

I'm setting beta to `wontfix`. This bug was introduced many versions back, it's quite hard to exploit, and the patch is fairly complex. It doesn't seem like a good candidate for uplift.

[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix)Flags: needinfo?(ksteuber)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a6943820_75935)• 3 years ago |

[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
[96+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=96%2B) → [97+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=97%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a7036614_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1732435#c31)• 3 years ago |
|  | |

As part of a security bug pattern analysis, we are requesting your help with a high level analysis of this bug. It is our hope to develop static analysis (or potentially runtime/dynamic analysis) in the future to identify classes of bugs.

Please visit [this google form](https://docs.google.com/forms/d/e/1FAIpQLSe9uRXuoMK6tRglbNL5fpXbun_oEb6_xC2zpuE_CKA_GUjrvA/viewform?usp=pp_url&entry.2124261401=https%3A%2F%2Fbugzilla.mozilla.org%2Fshow_bug.cgi%3Fid%3D1732435) to reply.

Flags: needinfo?(ksteuber)Whiteboard: [reporter-external] [client-bounty-form] [verif?][fidedi-security] → [reporter-external] [client-bounty-form] [verif?][fidedi-security][sec-survey]

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a7114910_563604)• 3 years ago |

Flags: needinfo?(ksteuber)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1732435#c32)• 3 years ago |
|  | |

Comment on [attachment 9253526](/attachment.cgi?id=9253526 "Bug 1732435 - ESR patch r=nalexander!") [[details]](/attachment.cgi?id=9253526&action=edit "Bug 1732435 - ESR patch r=nalexander!")

[Bug 1732435](/show_bug.cgi?id=1732435 "RESOLVED FIXED - Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service") - ESR patch r=nalexander!

I'm going to clear sec-approval on this until we're ready to land it to stop bugzilla emails

[Attachment #9253526](/attachment.cgi?id=9253526&action=edit "Bug 1732435 - ESR patch r=nalexander!") -
Flags: sec-approval?

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a7282615_553429)• 3 years ago |

Flags: qe-verify-Whiteboard: [reporter-external] [client-bounty-form] [verif?][fidedi-security][sec-survey] → [reporter-external] [client-bounty-form] [verif?][fidedi-security][sec-survey][post-critsmash-triage]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1732435#c33)• 3 years ago |
|  | |

Comment on [attachment 9253526](/attachment.cgi?id=9253526 "Bug 1732435 - ESR patch r=nalexander!") [[details]](/attachment.cgi?id=9253526&action=edit "Bug 1732435 - ESR patch r=nalexander!")

[Bug 1732435](/show_bug.cgi?id=1732435 "RESOLVED FIXED - Arbitrary permissions overwrite due to folder locking TOCTOU in Maintenance Service") - ESR patch r=nalexander!

We're halfway through the Beta97 cycle with no known issues with the full patch stack, so I'm feeling confident that it's going to ship. Approving the ESR-specific patch for 91.6esr.

[Attachment #9253526](/attachment.cgi?id=9253526&action=edit "Bug 1732435 - ESR patch r=nalexander!") -
Flags: approval-mozilla-esr91? → approval-mozilla-esr91+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1732435#c34)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr91/rev/e33e4da7a596>

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a11341582_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][fidedi-security][sec-survey][post-critsmash-triage] → [reporter-external] [client-bounty-form] [verif?][fidedi-security][sec-survey][post-critsmash-triage][adv-main97+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1732435#c35)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9261956)
— [Details](attachment.cgi?id=9261956&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a11498707_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][fidedi-security][sec-survey][post-critsmash-triage][adv-main97+] → [reporter-external] [client-bounty-form] [verif?][fidedi-security][sec-survey][post-critsmash-triage][adv-main97+][adv-esr91.6+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a11772484_578488)• 3 years ago |

Alias: CVE-2022-22753

|  | [Nick Alexander :nalexander [he/him]](/user_profile?user_id=432887) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a15402342_432887)• 3 years ago |

Regressions: [1760502](/show_bug.cgi?id=1760502 "RESOLVED INCOMPLETE - Inappropriate implementation in Mozilla updates directory allows cross users boundary to be compromised")

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a15422345_563604)• 3 years ago |

No longer regressions: [1760502](/show_bug.cgi?id=1760502 "RESOLVED INCOMPLETE - Inappropriate implementation in Mozilla updates directory allows cross users boundary to be compromised")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a29110751_1689)• 2 years ago |

Group: core-security-release

|  | [Jira Integration Bot](/user_profile?user_id=672219) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a29110811_672219)• 2 years ago |

See Also: → <https://mozilla-hub.atlassian.net/browse/FIDEDI-312>

|  | [Alice0775 White](/user_profile?user_id=293623) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a44697681_293623)• 2 years ago |

Regressions: [1818484](/show_bug.cgi?id=1818484 "NEW - mozregression should clean up the files that Firefox puts in the update directory")

|  | [Robin Steuber (she/her) [:bytesized]](/user_profile?user_id=563604)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a44699269_563604)• 2 years ago |

No longer regressions: [1818484](/show_bug.cgi?id=1818484 "NEW - mozregression should clean up the files that Firefox puts in the update directory")

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1732435#a84616499_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1732435&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Seb Patane (he/him)](/user_profile?user_id=465312)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_000817b2_20250115_092102.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-06

## Security Vulnerabilities fixed in Thunderbird 91.6

Announced
February 8, 2022
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 91.6

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2022-22753: Privilege Escalation to SYSTEM on Windows via Maintenance Service](#CVE-2022-22753)

Reporter
Seb Patane
Impact
high
##### Description

A Time-of-Check Time-of-Use bug existed in the Maintenance (Updater) Service that could be abused to grant Users write access to an arbitrary directory. This could have been used to escalate to SYSTEM access.
*This bug only affects Thunderbird on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1732435](https://bugzilla.mozilla.org/show_bug.cgi?id=1732435)

#### [#CVE-2022-22754: Extensions could have bypassed permission confirmation during update](#CVE-2022-22754)

Reporter
Rob Wu
Impact
high
##### Description

If a user installed an extension of a particular type, the extension could have auto-updated itself and while doing so, bypass the prompt which grants the new version the new requested permissions.

##### References

* [Bug 1750565](https://bugzilla.mozilla.org/show_bug.cgi?id=1750565)

#### [#CVE-2022-22756: Drag and dropping an image could have resulted in the dropped object being an executable](#CVE-2022-22756)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

If a user was convinced to drag and drop an image to their desktop or other folder, the resulting object could have been changed into an executable script which would have run arbitrary code after the user clicked on it.

##### References

* [Bug 1317873](https://bugzilla.mozilla.org/show_bug.cgi?id=1317873)

#### [#CVE-2022-22759: Sandboxed iframes could have executed script if the parent appended elements](#CVE-2022-22759)

Reporter
Johan Carlsson
Impact
moderate
##### Description

If a document created a sandboxed iframe without `allow-scripts`, and subsequently appended an element to the iframe's document that e.g. had a JavaScript event handler - the event handler would have run despite the iframe's sandbox.

##### References

* [Bug 1739957](https://bugzilla.mozilla.org/show_bug.cgi?id=1739957)

#### [#CVE-2022-22760: Cross-Origin responses could be distinguished between script and non-script content-types](#CVE-2022-22760)

Reporter
Luan Herrera
Impact
moderate
##### Description

When importing resources using Web Workers, error messages would distinguish the difference between `application/javascript` responses and non-script responses. This could have been abused to learn information cross-origin.

##### References

* [Bug 1740985](https://bugzilla.mozilla.org/show_bug.cgi?id=1740985)
* [Bug 1748503](https://bugzilla.mozilla.org/show_bug.cgi?id=1748503)

#### [#CVE-2022-22761: frame-ancestors Content Security Policy directive was not enforced for framed extension pages](#CVE-2022-22761)

Reporter
Mart Gil Robles (Mart at FlowCrypt)
Impact
moderate
##### Description

Web-accessible extension pages (pages with a moz-extension:// scheme) were not correctly enforcing the frame-ancestors directive when it was used in the Web Extension's Content Security Policy.

##### References

* [Bug 1745566](https://bugzilla.mozilla.org/show_bug.cgi?id=1745566)

#### [#CVE-2022-22763: Script Execution during invalid object state](#CVE-2022-22763)

Reporter
Mozilla Fuzzing Team
Impact
moderate
##### Description

When a worker is shutdown, it was possible to cause script to run late in the lifecycle, at a point after where it should not be possible.

##### References

* [Bug 1740534](https://bugzilla.mozilla.org/show_bug.cgi?id=1740534)

#### [#CVE-2022-22764: Memory safety bugs fixed in Thunderbird 91.6](#CVE-2022-22764)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Paul Adenot and the Mozilla Fuzzing Team reported memory safety bugs present in Thunderbird 91.5. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91.6](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1742682%2C1744165%2C1746545%2C1748210%2C1748279)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_84c69bca_20250115_092101.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-04

## Security Vulnerabilities fixed in Firefox 97

Announced
February 8, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 97

#### [#CVE-2022-22753: Privilege Escalation to SYSTEM on Windows via Maintenance Service](#CVE-2022-22753)

Reporter
Seb Patane
Impact
high
##### Description

A Time-of-Check Time-of-Use bug existed in the Maintenance (Updater) Service that could be abused to grant Users write access to an arbitrary directory. This could have been used to escalate to SYSTEM access.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1732435](https://bugzilla.mozilla.org/show_bug.cgi?id=1732435)

#### [#CVE-2022-22754: Extensions could have bypassed permission confirmation during update](#CVE-2022-22754)

Reporter
Rob Wu
Impact
high
##### Description

If a user installed an extension of a particular type, the extension could have auto-updated itself and while doing so, bypass the prompt which grants the new version the new requested permissions.

##### References

* [Bug 1750565](https://bugzilla.mozilla.org/show_bug.cgi?id=1750565)

#### [#CVE-2022-22755: XSL could have allowed JavaScript execution after a tab was closed](#CVE-2022-22755)

Reporter
Jack Wrenn
Impact
moderate
##### Description

By using XSL Transforms, a malicious webserver could have served a user an XSL document that would continue to execute JavaScript (within the bounds of the same-origin policy) even after the tab was closed.

##### References

* [Bug 1309630](https://bugzilla.mozilla.org/show_bug.cgi?id=1309630)

#### [#CVE-2022-22756: Drag and dropping an image could have resulted in the dropped object being an executable](#CVE-2022-22756)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

If a user was convinced to drag and drop an image to their desktop or other folder, the resulting object could have been changed into an executable script which would have run arbitrary code after the user clicked on it.

##### References

* [Bug 1317873](https://bugzilla.mozilla.org/show_bug.cgi?id=1317873)

#### [#CVE-2022-22757: Remote Agent did not prevent local websites from connecting](#CVE-2022-22757)

Reporter
James Graham
Impact
moderate
##### Description

Remote Agent, used in WebDriver, did not validate the Host or Origin headers. This could have allowed websites to connect back locally to the user's browser to control it.
*This bug only affected Firefox when WebDriver was enabled, which is not the default configuration.*

##### References

* [Bug 1720098](https://bugzilla.mozilla.org/show_bug.cgi?id=1720098)

#### [#CVE-2022-22758: tel: links could have sent USSD codes to the dialer on Firefox for Android](#CVE-2022-22758)

Reporter
Kirtikumar Anandrao Ramchandani, Patrick Walker & Eric Lawrence
Impact
moderate
##### Description

When clicking on a tel: link, USSD codes, specified after a `*` character, would be included in the phone number. On certain phones, or on certain carriers, if the number was dialed this could perform actions on a user's account, similar to a cross-site request forgery attack.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1728742](https://bugzilla.mozilla.org/show_bug.cgi?id=1728742)

#### [#CVE-2022-22759: Sandboxed iframes could have executed script if the parent appended elements](#CVE-2022-22759)

Reporter
Johan Carlsson
Impact
moderate
##### Description

If a document created a sandboxed iframe without `allow-scripts`, and subsequently appended an element to the iframe's document that e.g. had a JavaScript event handler - the event handler would have run despite the iframe's sandbox.

##### References

* [Bug 1739957](https://bugzilla.mozilla.org/show_bug.cgi?id=1739957)

#### [#CVE-2022-22760: Cross-Origin responses could be distinguished between script and non-script content-types](#CVE-2022-22760)

Reporter
Luan Herrera
Impact
moderate
##### Description

When importing resources using Web Workers, error messages would distinguish the difference between `application/javascript` responses and non-script responses. This could have been abused to learn information cross-origin.

##### References

* [Bug 1740985](https://bugzilla.mozilla.org/show_bug.cgi?id=1740985)
* [Bug 1748503](https://bugzilla.mozilla.org/show_bug.cgi?id=1748503)

#### [#CVE-2022-22761: frame-ancestors Content Security Policy directive was not enforced for framed extension pages](#CVE-2022-22761)

Reporter
Mart Gil Robles (Mart at FlowCrypt)
Impact
moderate
##### Description

Web-accessible extension pages (pages with a moz-extension:// scheme) were not correctly enforcing the frame-ancestors directive when it was used in the Web Extension's Content Security Policy.

##### References

* [Bug 1745566](https://bugzilla.mozilla.org/show_bug.cgi?id=1745566)

#### [#CVE-2022-22762: JavaScript Dialogs could have been displayed over other domains on Firefox for Android](#CVE-2022-22762)

Reporter
James Lee
Impact
low
##### Description

Under certain circumstances, a JavaScript alert (or prompt) could have been shown while another website was displayed underneath it. This could have been abused to trick the user.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1743931](https://bugzilla.mozilla.org/show_bug.cgi?id=1743931)

#### [#CVE-2022-22764: Memory safety bugs fixed in Firefox 97 and Firefox ESR 91.6](#CVE-2022-22764)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Paul Adenot and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 96 and Firefox ESR 91.5. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 97 and Firefox ESR 91.6](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1742682%2C1744165%2C1746545%2C1748210%2C1748279)

#### [#CVE-2022-0511: Memory safety bugs fixed in Firefox 97](#CVE-2022-0511)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Gabriele Svelto, Sebastian Hengst, Randell Jesup, Luan Herrera, Lars T Hansen, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 96. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 97](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1713579%2C1735448%2C1743821%2C1746313%2C1746314%2C1746316%2C1746321%2C1746322%2C1746323%2C1746412%2C1746430%2C1746451%2C1746488%2C1746875%2C1746898%2C1746905%2C1746907%2C1746917%2C1747128%2C1747137%2C1747331%2C1747346%2C1747439%2C1747457%2C1747870%2C1749051%2C1749274%2C1749831)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_0e94bf8d_20250115_092102.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-05

## Security Vulnerabilities fixed in Firefox ESR 91.6

Announced
February 8, 2022
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 91.6

#### [#CVE-2022-22753: Privilege Escalation to SYSTEM on Windows via Maintenance Service](#CVE-2022-22753)

Reporter
Seb Patane
Impact
high
##### Description

A Time-of-Check Time-of-Use bug existed in the Maintenance (Updater) Service that could be abused to grant Users write access to an arbitrary directory. This could have been used to escalate to SYSTEM access.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1732435](https://bugzilla.mozilla.org/show_bug.cgi?id=1732435)

#### [#CVE-2022-22754: Extensions could have bypassed permission confirmation during update](#CVE-2022-22754)

Reporter
Rob Wu
Impact
high
##### Description

If a user installed an extension of a particular type, the extension could have auto-updated itself and while doing so, bypass the prompt which grants the new version the new requested permissions.

##### References

* [Bug 1750565](https://bugzilla.mozilla.org/show_bug.cgi?id=1750565)

#### [#CVE-2022-22756: Drag and dropping an image could have resulted in the dropped object being an executable](#CVE-2022-22756)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

If a user was convinced to drag and drop an image to their desktop or other folder, the resulting object could have been changed into an executable script which would have run arbitrary code after the user clicked on it.

##### References

* [Bug 1317873](https://bugzilla.mozilla.org/show_bug.cgi?id=1317873)

#### [#CVE-2022-22759: Sandboxed iframes could have executed script if the parent appended elements](#CVE-2022-22759)

Reporter
Johan Carlsson
Impact
moderate
##### Description

If a document created a sandboxed iframe without `allow-scripts`, and subsequently appended an element to the iframe's document that e.g. had a JavaScript event handler - the event handler would have run despite the iframe's sandbox.

##### References

* [Bug 1739957](https://bugzilla.mozilla.org/show_bug.cgi?id=1739957)

#### [#CVE-2022-22760: Cross-Origin responses could be distinguished between script and non-script content-types](#CVE-2022-22760)

Reporter
Luan Herrera
Impact
moderate
##### Description

When importing resources using Web Workers, error messages would distinguish the difference between `application/javascript` responses and non-script responses. This could have been abused to learn information cross-origin.

##### References

* [Bug 1740985](https://bugzilla.mozilla.org/show_bug.cgi?id=1740985)
* [Bug 1748503](https://bugzilla.mozilla.org/show_bug.cgi?id=1748503)

#### [#CVE-2022-22761: frame-ancestors Content Security Policy directive was not enforced for framed extension pages](#CVE-2022-22761)

Reporter
Mart Gil Robles (Mart at FlowCrypt)
Impact
moderate
##### Description

Web-accessible extension pages (pages with a moz-extension:// scheme) were not correctly enforcing the frame-ancestors directive when it was used in the Web Extension's Content Security Policy.

##### References

* [Bug 1745566](https://bugzilla.mozilla.org/show_bug.cgi?id=1745566)

#### [#CVE-2022-22763: Script Execution during invalid object state](#CVE-2022-22763)

Reporter
Mozilla Fuzzing Team
Impact
moderate
##### Description

When a worker is shutdown, it was possible to cause script to run late in the lifecycle, at a point after where it should not be possible.

##### References

* [Bug 1740534](https://bugzilla.mozilla.org/show_bug.cgi?id=1740534)

#### [#CVE-2022-22764: Memory safety bugs fixed in Firefox 97 and Firefox ESR 91.6](#CVE-2022-22764)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Paul Adenot and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 96 and Firefox ESR 91.5. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 97 and Firefox ESR 91.6](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1742682%2C1744165%2C1746545%2C1748210%2C1748279)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


