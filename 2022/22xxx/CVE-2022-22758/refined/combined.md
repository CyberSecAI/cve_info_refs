=== Content from bugzilla.mozilla.org_81cb5328_20250114_203349.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1728742)
* [XML](/show_bug.cgi?ctype=xml&id=1728742)

Closed
[Bug 1728742](/show_bug.cgi?id=1728742)
(CVE-2022-22758)

Opened 3 years ago
Closed 3 years ago

# Using `tel:` URI to perform USSD attack

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Using `tel:` URI to perform USSD attack

## Categories

### (GeckoView :: General, defect)

[Product:](/describecomponents.cgi?product=GeckoView)

GeckoView
▾

GeckoView
The GeckoView components for Android
[See Open Bugs in This Product](/buglist.cgi?product=GeckoView&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=GeckoView)
Watch This Product

[Component:](/describecomponents.cgi?product=GeckoView&component=General#General)

General
▾

GeckoView :: General
The GeckoView embedding widget for Android
[See Open Bugs in This Component](/buglist.cgi?product=GeckoView&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=GeckoView&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=GeckoView&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

Android

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### (firefox-esr91 wontfix, firefox96 wontfix, firefox97+ fixed, firefox98+ fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox96 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix) |
| firefox97 | [+](/buglist.cgi?f1=cf_tracking_firefox97&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=fixed) |
| firefox98 | [+](/buglist.cgi?f1=cf_tracking_firefox98&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr91 |  | wontfix |
| firefox96 |  | wontfix |
| firefox97 | + | fixed |
| firefox98 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: kirtikumar.a.r, Assigned: agi)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/2f23a572bdd06777026ab2c155cfe0c0?d=mm&size=40)  [agi](/user_profile?user_id=421286)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/7eac4895ed5de90d4f29163682ae2182?d=mm&size=40)  [kirtikumar.a.r](/user_profile?user_id=671976)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/418efed494240195b86667307fe63d5c?d=mm&size=40)  [owlish](/user_profile?user_id=579431)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

### (Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1619798](/show_bug.cgi?id=1619798 "RESOLVED FIXED - Move `onLoadRequest()` into `DocumentLoadListener::Open()`")

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1813110](/show_bug.cgi?id=1813110 "RESOLVED DUPLICATE - Bypass for the \"tel:\" URI Vulnerability")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[794034](/show_bug.cgi?id=794034 "VERIFIED FIXED - Make sure tel: URLs that contain * or # are not dereferenced")

[bugs.chromium.org/p/chromium/issues/d...](https://bugs.chromium.org/p/chromium/issues/detail?id=1180510 "https://bugs.chromium.org/p/chromium/issues/detail?id=1180510")

## Details

### (5 keywords, Whiteboard: [post-critsmash-triage][adv-main97+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-22758

[Keywords:](/describekeywords.cgi)

[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main97+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a12564583_1689 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [tel\_sms\_intent\_check.patch](/attachment.cgi?id=9257521)  [3 years ago](#c34)  [Roger Yang [:royang]](/user_profile?user_id=644746)   2.28 KB, patch |  | [Details](/attachment.cgi?id=9257521&action=edit) | [Diff](/attachment.cgi?id=9257521&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1728742&attachment=9257521) |
| --- | --- | --- |
| [tel\_sms\_intent\_check\_2.patch](/attachment.cgi?id=9257702)  [3 years ago](#c37)  [Roger Yang [:royang]](/user_profile?user_id=644746)   2.62 KB, patch | csadilek : [review+](#c38 "3 years ago")  tjr : [sec-approval+](#c44 "3 years ago") | [Details](/attachment.cgi?id=9257702&action=edit) | [Diff](/attachment.cgi?id=9257702&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1728742&attachment=9257702) |
| [Bug 1728742 - Reject invalid schemes in onLoadRequest.](/attachment.cgi?id=9258529)  [3 years ago](#c40)  [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#c51 "3 years ago")  tjr : [sec-approval+](#c45 "3 years ago") | [Details](/attachment.cgi?id=9258529&action=edit) | [Review](/attachment.cgi?id=9258529) |
| [Bug 1728742 - Add test for invalid schemes in onLoadRequest.](/attachment.cgi?id=9258530)  [3 years ago](#c41)  [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9258530&action=edit) | [Review](/attachment.cgi?id=9258530) |
| [advisory.txt](/attachment.cgi?id=9261933)  [3 years ago](#c60)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   563 bytes, text/plain |  | [Details](/attachment.cgi?id=9261933&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1728742#c0)• 3 years ago |
|  | |

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36

Steps to reproduce:

1. Visit <https://kirtikumarar.com/mozilla/ussd.html>
2. Click on Hyperlink

Actual results:

It sends the complete USSD code to the dialer and shows the IMEI Number.

Expected results:

It should strip out everything after " \* "

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1728742#c1)• 3 years ago |
|  | |

Issue is tested on: Firefox browser 37.4.0 (Build #2015831131) and Firefox Nightly 93.0a1 (Build #2015831595)

Video PoC: This will be shared through mail as it will disclose device IMEI Number

Exploit Scenario: One can use different USSD codes to erase users' devices, turn on particular settings, turn off settings, etc.

How we're actually trying to make it work?

--> Browsers have the ability to strip out the complete USSD code after `*` for example if you will visit <https://kirtikumarar.com/mozilla/fail.html> and click the hyperlink and you can see the Firefox stripped out `#06#` after the asterisk. To bypass that functionality of stripping out, we are encoding the `# --> %23`. So, when you navigate to <https://kirtikumarar.com/mozilla/ussd.html> and click on the hyperlink, you will see that the complete USSD code was sent to the dialer and your device IMEI number was popped.

Previously, a similar case was found by me, Patrick Walker, and Eric Lawrence in Chrome but it was a case where we were sending the USSD code from desktop to device. Here, the Chrome security team applied a clever patch: [https://chromium.googlesource.com/chromium/src/+/e041be8dc8b5b9e3012e752c2636fcf1cd8b0b1d](https://chromium.googlesource.com/chromium/src/%2B/e041be8dc8b5b9e3012e752c2636fcf1cd8b0b1d)

The issue in Chrome had priority of Low because were sending it from desktop to device and asking the user to click on send to device a function to perform the attack. Here, the issue is possible on the device itself. So, the severity has drastically increased due to fewer user interactions. A suggested patch here will be like the Chromium team applied in the `Click-to-call` i.e. we should strip out everything added after the asterisk for example `%`, `#` and `*` which will be the best solution to fix this case.

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a5023_671976)• 3 years ago |

OS: Unspecified → AndroidHardware: Unspecified → Other

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1728742#c2)• 3 years ago |
|  | |

Looks like Fenix regressed [bug 794034](/show_bug.cgi?id=794034 "VERIFIED FIXED - Make sure tel: URLs that contain * or # are not dereferenced"). GVE and Fennec 68 has <https://searchfox.org/mozilla-central/source/mobile/android/geckoview/src/main/java/org/mozilla/gecko/util/IntentUtils.java#70> which prevents this from working. Fenix either needs to port it or have [bug 1685152](/show_bug.cgi?id=1685152 "NEW - Expose URI class") fixed.

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1728742#c3)• 3 years ago |
|  | |

> Looks like Fenix regressed [bug 794034](/show_bug.cgi?id=794034 "VERIFIED FIXED - Make sure tel: URLs that contain * or # are not dereferenced").

Might be. But that's really a good patch where Chrome and Firefox are having the intended behavior of blocking `tel:` URIs in the iframe. The [bug 794034](/show_bug.cgi?id=794034 "VERIFIED FIXED - Make sure tel: URLs that contain * or # are not dereferenced") is like (<https://bugs.chromium.org/p/chromium/issues/detail?id=746427>). If you don't mind, can we add Eric Lawrence into this bug if I share his mail as he has collaborated with me on multiple URI-related bugs, and this first `tel:` URI vulnerability was found after his bug (<https://bugs.chromium.org/p/chromium/issues/detail?id=746427#c15>).

> <https://searchfox.org/mozilla-central/source/mobile/android/geckoview/src/main/java/org/mozilla/gecko/util/IntentUtils.java#70>

The bug ID attached in it is a case of frame-src? If yes, Chrome and Firefox (Android) both are blocking `tel:` URIs in the frame with a message in console when we do USB Debugging.

> [bug 1685152](/show_bug.cgi?id=1685152 "NEW - Expose URI class")

Seems to be clean. May I know if this case will be taken into consideration?

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1728742#c4)• 3 years ago |
|  | |

Adding Eric Lawrence with whom I collaborated on `tel:` URI bugs, Microsoft folk as he has better idea than me.

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1728742#c5)• 3 years ago |
|  | |

As part of my previous comment I updated the testcase from 794034 to use <a href=""> at <https://www.kevinbrosnan.net/testcases/794034-s3-own-factory-reset-v5.html>. The code I pointed at still works for [Geckoview Example](https://firefox-ci-tc.services.mozilla.com/tasks/index/gecko.v2.mozilla-central.latest.mobile/android-aarch64-gcp-opt). The Fenix rewrite definitely regressed this.

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1728742#c6)• 3 years ago |
|  | |

It would be better if you don't use the Factory reset USSD code in the testcase, replace it with IMEI number or any. If any mere mortal like me clicks that link or any analyst, their device might get erased especially Android 7.0 and lower will surely get erased directly. I'll share PoC what happens when just clicking through Mail as I mentioned earlier. I'll make poc for IMEI and not factory data reset.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1728742#c7)• 3 years ago |
|  | |

Unfortunately, Android Studio is failing me and I can't reproduce locally.

I'm currently rating this sec-moderate but might as well be sec-high, if it doesn't require any user interaction

Kevin, can you please weigh in on the security rating based on these questions?

* Does this require any user interaction?
* i.e., Does it open the dialer app or does it directly trigger the USSD code to be "executed"?
* if the `iframe` does not directly trigger it, would a JavaScript `click()` call on the link trigger it?
Flags: sec-bounty?Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1728742#c8)• 3 years ago |
|  | |

Forgot the needinfo flag. Question in [comment 7](/show_bug.cgi?id=1728742#c7 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack").

Flags: needinfo?(kbrosnan)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1728742#c9)• 3 years ago |
|  | |

A few observations for ([comment 7](/show_bug.cgi?id=1728742#c7 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack")):

> Does this require any user interaction?

Yes, one will need to click on a hyperlink or use another function that can make it User interaction-free.

> i.e., Does it open the dialer app or does it directly trigger the USSD code to be "executed"?

This is actually different behavior in different devices. On many of the Samsung devices (latest ones), it is requiring user click whereas, on Lenovo devices and few other ones, it is directly getting executed especially when the devices are Android 7.0, it will directly trigger the USSD code and get executed on the dialer. Currently, I am finding the device which are having this behavior. I will share a PoC for the same through mail as it will disclose the IMEI Number.

> if the iframe does not directly trigger it, would a JavaScript click() call on the link trigger it?

`iframe` in Firefox and Chrome both block the `tel:` URIs. So, it won't work here for us to decrease the user interaction.

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1728742#c10)• 3 years ago |
|  | |

I've sent a video PoC of IMEI Device on security@mozilla.org where the USSD code directly gets rendered on the Dialer App. Can somebody please check?

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1728742#c11)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1728742&comment_id=15554851 "1 revision") |
|  | |

For almost all tel: uris it will place the number in the dialer and the user would need to press call button to initiate the call or action. The USSD code in some cases will auto run. Using the two main phones I have the Samsung dialer on a Note 9 will not accept USSD codes from other applications. On my Pixel 2 XL the code auto runs using the Google dialer.

My rating would be more in the [sec-low](https://wiki.mozilla.org/Security_Severity_Ratings/Client) range, as Google rated it in [1180510](https://bugs.chromium.org/p/chromium/issues/detail?id=1180510) It could be used in an annoying DoS. The data can't be exfiltrated without coercing the user to manually screenshot or painstakingly manually copy the numbers. You might be able to use it to lend credibility to a support scam.

Flags: needinfo?(kbrosnan)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1728742#c12)• 3 years ago |
|  | |

> The USSD code in some cases will auto run.

In almost all cases, it will auto run especially when the is using any 3rd party dialer like Truecaller, the chances will increase. This isn't tested but an observation when tested on a device which had a 3rd party dialer which took any USSD code from other application and rendered it for the user--auto run.

> Using the two main phones I have the Samsung dialer on a Note 9 will not accept USSD codes from other applications.

Correct. In Samsung devices, when a USSD code is sent to dialer from any 3rd party, it will clear it and won't render it for you, as far as I know. But remaining all the devices are affected also iOS but in iOS, you might have same feature as Chrome i.e. asking user showing a prompt with any message like: "Hey, do you want to calll this no.? " which stops the attach there.

> My rating would be more in the sec-low range, as Google rated it in 1180510 It could be used in an annoying DoS. The data can't be exfiltrated without coercing the user to manually screenshot or painstakingly manually copy the numbers. You might be able to use it to lend credibility to a support scam.

**sec-low** isn't digestible here, imho. If you've gone through Chromium bug- [1180510](https://crbug.com/1180510), that issue has low severity due to the reason that:

**The issue is a click-to-call where user open the link on desktop ans then clicks on it later clicks on "send to device" this has increased user interactions and that's why the severity is low in that case of Chrome**. I don't know how the **sec-low** was counted by you, it was expected high because here, the vulnerability isn't like chrome that it is sent from desktop->device. Instead it is directly a 1-click from the Browser. But anyways, as the severity is counted low from your side and no, wouldn't prefer to keep this case private and we should make it issue public directly because the severity isn't counted in the manner it should be. The Chrome bug is completely different from this case.

1. Can you apply their click-to-call patch on this case?
2. Is this vulnerability like [1180510](https://crbug.com/1180510) that we are sending USSD code from desktop to device?

Making issue public would be more helpful because **sec-low** for this case is arguably not acceptable neither for me nor for any other researcher.

Flags: needinfo?(kbrosnan)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1728742#c13)• 3 years ago |
|  | |

@Kirtikumar: Let's remember not to turn this conversation into a price & reward haggle and keep this focused on a correct understanding of the issue at hand.

Kevin, you said the code automatically ran on your Google Pixel 2 XL, which makes it look like an attacker can trigger it on some default configurations. In this case, an easy-to-trigger factory reset without user interaction could be rated as ["sec-moderate"](https://wiki.mozilla.org/Security_Severity_Ratings/Client#Severity_Ratings), as it is a very annoying DoS.

Let's keep this rated at moderate.

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1728742#c14)• 3 years ago |
|  | |

> Let's remember not to turn this conversation into a price & reward haggle and keep this focused on a correct understanding of the issue at hand.

Sure. No issues. :)

> Kevin, you said the code automatically ran on your Google Pixel 2 XL, which makes it look like an attacker can trigger it on some default configurations. In this case, an easy-to-trigger factory reset without user interaction could be rated as "sec-moderate", as it is a very annoying DoS.

Correct. And also, the issue doesn't uses extra user interactions like it does in Google Chrome bug as it was a `Desktop->Device`. "sec-moderate" is acceptable.

Thanks for clarification!

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1728742#c15)• 3 years ago |
|  | |

As far as I know there is no factory reset case with Fenix. The Samsung dialer reset codes only work on devices that run Android 4.0.4 or lower (Samsung Galaxy S3 era and earlier). The Galaxy S3 running Android 4.4 can no longer be reset using USSD codes. I have personally verified this and <https://gizmodo.com/security-bug-can-wipe-out-your-android-phone-by-visitin-5946334> is another source. Fenix requires Android 5+ so the S3 and earlier devices are unsupported (and protected in Fennec v16-68 due to the code I mentioned in [comment 2](/show_bug.cgi?id=1728742#c2 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack")). What has been demonstrated is a forced "popup" with the device's serial numbers.

Flags: needinfo?(kbrosnan)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1728742#c16)• 3 years ago |
|  | |

I've tested on Factory data reset on Android 7.0

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1728742#c17)• 3 years ago |
|  | |

I am adding Annevk into this bug as he has worked on [`tel: URI bug`](https://github.com/whatwg/html/issues/2875). When looking at his comment:

```
When writing tests we should also test %23, %2A, and maybe even %2523 (in case there's some incorrect decoding happening along the way to the target).

```

His comment seems to be very useful as my bug uses `%23` which is actually encoded. Mozilla was blocking `*` after this [patch](https://bugzilla.mozilla.org/show_bug.cgi?id=794034#c7). We should block `%23` as well as double encoded chars i.e. `%2523`,

Here, there is an interesting case at [exploit](https://kirtikumarar.com/mozilla/ussd2.html), you can see that it sends `*2523062523` which seems to be wrong when it sends decoded part from the encoding, it should have sent `*#06#` but somewhere it seems to be broken. When you will try `*%2306%23`, you can see it is successfully sending a complete USSD code: `*#06#`.

Might be we need patch when there is a double encoding too, yes?

We used a similar exploit in this [bug](https://bugs.chromium.org/p/chromium/issues/detail?id=1180510#c20). Refer to it. It is also a double encoding but that case was from desktop to device this is in the device itself. :)

Flags: needinfo?(annevk)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1728742#c18)• 3 years ago |
|  | |

I don't really have detailed knowledge of `tel:` URLs unfortunately.

It seems this is a duplicate of [bug 797034](/show_bug.cgi?id=797034 "NEW - Improve handling of bad tel: URIs")?

Flags: needinfo?(annevk)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1728742#c19)• 3 years ago |
|  | |

It doesn't seem to be duplicate to me. May I know how you're telling it duplicate, please? The [bug 797034](/show_bug.cgi?id=797034 "NEW - Improve handling of bad tel: URIs") doesn't talk about particularly blocking of `%23`. I've tried to explain two bugs in [comment#17](/show_bug.cgi?id=1728742#c17 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack"):

1. We should actually be stripping out chars after `*`.
2. When there's `%2523`, it seems like it strips out percentage but not the numbers. So, we should actually be stripping out everything after `*` which will be the robust solution here.

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1728742#c20)• 3 years ago |
|  | |

It is not a duplicate. This is a Fenix only bug as I stated in [comment 2](/show_bug.cgi?id=1728742#c2 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack"). Gecko/Geckoview example browser do not send the URIs from [comment 0](/show_bug.cgi?id=1728742#c0 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") and 1 to the dialer. When we resolve this this we should evaluate if we should treat SMS/MMS in a similar manner.

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1728742#c21)• 3 years ago |
|  | |

Friendly ping. :-)

We're working on the blog where we'll cover browsers that were found to be vulnerable from similar USSD cases with this URI.

1. Any patch introduced so far which we can use currently for analysis?
2. Any approximate date when we will be allowed to make the issue public?

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1728742#c22)• 3 years ago |
|  | |

(In reply to Kevin Brosnan [:kbrosnan] from [comment #5](/show_bug.cgi?id=1728742#c5 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack"))

> As part of my previous comment I updated the testcase from 794034 to use <a href=""> at <https://www.kevinbrosnan.net/testcases/794034-s3-own-factory-reset-v5.html>. The code I pointed at still works for [Geckoview Example](https://firefox-ci-tc.services.mozilla.com/tasks/index/gecko.v2.mozilla-central.latest.mobile/android-aarch64-gcp-opt). The Fenix rewrite definitely regressed this.

In your test cases, it failing, not able to pass the USSD code to erase the device. Your test case is below one on the website:

```
<!DOCTYPE html>
<head>
    <title>S3 factory reset testcase</title>
</head>
</body>
    <frame src="tel:*2767*3855%23">
    <a href="tel:*2767*3855%23">Totally safe link</a>
</body>

```

I assume that the problem is from the USSD code after 2767. But you will be able to successfully encode the testcase which I was using:

<https://kirtikumarar.com/mozilla/ussd.html>

If you want a video POC, let me know. And we shouldn't be having Hyperlink as well as an iframe in the same test case like we didn't use them both in our chromium bug at the same time it was either hyperlink or iframe else it might be confusing and we won't be able to find which is actually failing or breaking on the midway.

If in case it keeps missing, we can double encode it and use it as I mentioned in [comment 17](/show_bug.cgi?id=1728742#c17 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack"):

```
Here, there is an interesting case at exploit, you can see that it sends *2523062523 which seems to be wrong when it sends decoded part from the encoding, it should have sent *#06# but somewhere it seems to be broken. When you will try *%2306%23, you can see it is successfully sending a complete USSD code: *#06#.

```

The exploit over there is <https://kirtikumarar.com/mozilla/ussd2.html> which uses double encoding. The better one will be the double encoding because it was vulnerable in 2 more browsers and both of them have patched- Chrome and Yandex ( Yandex separately as it was their lite browser).

Any possibility @Kevin sir, you got any idea why the chars aren't being decoded from the test case in [comment 15](/show_bug.cgi?id=1728742#c15 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack")? I don't see any problem in the complete test case of yours, it is created correctly from start till end.

Flags: needinfo?(kbrosnan)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1728742#c23)• 3 years ago |
|  | |

Note: When the iframe and hyperlink are bisected from @kevin's test case, it worked correctly on Android 9.0 (Tested OK). But when it was with frame, it got a problem. Btw, Mozilla is working as intended for the below test case in Android but we need a similar case on the desktop too:

```
<iframe src="tel:*2767*3855%23"></iframe>

```

You will see that the Mobile is blocking tel: URI in the iframe but the desktop doesn't. The Chrome is working on this case at here: <https://bugs.chromium.org/p/chromium/issues/detail?id=1180510#c10>

Relevant bug shared by Chromium team member for that iframe case: <https://bugs.chromium.org/p/chromium/issues/detail?id=1011429>

So far, the chrome team has disabled their click-to-call functionality from the desktop to stop this problem.

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1728742#c24)• 3 years ago |
|  | |

A friendly ping if there's any update please share because if it is >=30days, I need to forward the vulnerability to [GPSRP (Google Play Security Reward Program)](https://bughunters.google.com/about/rules/5604090422493184) as the case is affecting more than [100 Million](https://play.google.com/store/apps/details?id=org.mozilla.firefox&hl=en_IN&gl=US) users.

Flags: needinfo?(annevk)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1728742#c25)• 3 years ago |
|  | |

(In reply to Frederik Braun [:freddy] (out of office) from [comment #13](/show_bug.cgi?id=1728742#c13 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack"))

> @Kirtikumar: Let's remember not to turn this conversation into a price & reward haggle and keep this focused on a correct understanding of the issue at hand.
>
> Kevin, you said the code automatically ran on your Google Pixel 2 XL, which makes it look like an attacker can trigger it on some default configurations. In this case, an easy-to-trigger factory reset without user interaction could be rated as ["sec-moderate"](https://wiki.mozilla.org/Security_Severity_Ratings/Client#Severity_Ratings), as it is a very annoying DoS.
>
> Let's keep this rated at moderate.

The reason why I was arguing about severity is due to the reason this is not just a remote DoS, here, Mozilla is allowing attackers to abuse government functions too. A small example is here: <http://cashlessindia.gov.in/ussd_services.html>

Previously, in India, the government has introduced cashless functionality where users can use UI, USSD, etc. ways to perform transactions. Here, an attacker can execute USSD code and perform transactions on behalf of the user. Obviously, a government won't handle such nefarious work of attackers, for example, the Indian government didn't handle the case of Whatsapp data privacy case. Here, Mozilla is freely allowing attackers to abuse the cashless function of the Indian government. If you still believe this is limited to a remote DoS, we can have an Indian government folk in this report and ask his permission to perform the "Banking USSD attack" on their users.

Note: I have successfully verified this case of USSD banking. The other case next which has to be verified is of transferring balance through USSD code of telecom companies. For example, if you execute one code in India, you can transfer Talktime to the receiver. If the SIM Card is postpaid the user is going to face a lot of problems. :(

CC'ing Daniel sir as he helped well in a few past analyses of Mozilla cases.

Flags: needinfo?(fbraun)Flags: needinfo?(dveditz)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1728742#c26)• 3 years ago |
|  | |

Forgot to share here is a list of 38 Government as well as Private banks of India who can be abused by this USSD attack: <http://cashlessindia.gov.in/ussd_services.html>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a7569799_1689)• 3 years ago |

Flags: needinfo?(kbrosnan)Flags: needinfo?(fbraun)Flags: needinfo?(dveditz)Flags: needinfo?(annevk)Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---) → [sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---)See Also: → [794034](/show_bug.cgi?id=794034 "VERIFIED FIXED - Make sure tel: URLs that contain * or # are not dereferenced")Whiteboard: [exploit published after Dec 23 2021]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a7569815_1689)• 3 years ago |

Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1728742#c27)• 3 years ago |
|  | |

May I know what does: `Whiteboard: [exploit published after Dec 23 2021]` mean?

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1728742#c28)• 3 years ago |
|  | |

In [comment 24](/show_bug.cgi?id=1728742#c24 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") you said "if it is >=30days, I need to forward the vulnerability to GPSRP". Just making sure people know there's a deadline here.

Flags: needinfo?(dveditz)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1728742#c29)• 3 years ago |
|  | |

Oh, ok waiting for somebody to patch it.

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1728742#c30)• 3 years ago |
|  | |

Hi Daniel sir,

3hrs are left for 23rd Dec (as per Indian Standard Time). May I know if any security folk has looked into this case or not? We haven't received the update from the team for 3months even though the issue can be used to abuse the government and users in the worst possible way. :-)

I hope you're looking into the bug.

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a9626334_1689)• 3 years ago |

Flags: needinfo?(dveditz) → needinfo?(sarentz)

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1728742#c31)• 3 years ago |
|  | |

Amedyne and Christian are better options than Stefan due to PTO.

Flags: needinfo?(sarentz)Flags: needinfo?(csadilek)Flags: needinfo?(amoya)

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1728742#c32)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1728742&comment_id=15708426 "3 revisions") |
|  | |

Christian and I talked. We are looking at porting the Fennec patch to Fenix in the new year. Just about all the Fenix team are on PTO through Jan 3 (Europe/NA). Our understanding of the problem is as follows

* The Samsung device factory reset usecase is not applicable to Fenix. This was a problem on Galaxy S3 and earlier era phones running Android 4.x which we don't support. The unsupported Fennec v68 will run on affected devices has the patch I pointed to above.
* Modern Samsung devices using the Samsung dialer do not accept dialer codes from external apps.
* USSD code generally is a DoS, see [comment 0](/show_bug.cgi?id=1728742#c0 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") for an example. People in specific countries where USSD codes are used for additional features may be more severely affected if their dialer does not protect them ([comment 25](/show_bug.cgi?id=1728742#c25 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack"))
* Evaluate if SMS/MMS is in scope
Flags: needinfo?(csadilek)Flags: needinfo?(amoya)

|  | [Roger Yang [:royang]](/user_profile?user_id=644746) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a10734909_644746)• 3 years ago |

Assignee: nobody → royangStatus: NEW → ASSIGNED

|  | [Christian Sadilek [:csadilek]](/user_profile?user_id=590895) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1728742#c33)• 3 years ago |
|  | |

We have a "backport" of the Fennec patch ready for A-C that also handles the double encoding case mentioned in <https://bugzilla.mozilla.org/show_bug.cgi?id=1728742#c22>.

We would like feedback from the GeckoView team though, because GV already has most of the required logic in place as part of the `IntentUtils.isUriSafeForScheme` call, invoked for load requests [1]. However, this code path is not executed for load requests forwarded to the embedder [2].

Agi, what do you think? The advantage of handling this in GV is that the call to `onLoadError` would automatically display a meaningful error message to the user without any special handling in A-C/Fenix. We're happy to land the change in A-C/Fenix as well as a fallback.

[1] <https://searchfox.org/mozilla-central/rev/996a2cafe472e9934b8cb91db63050f96d8a59cb/mobile/android/geckoview/src/main/java/org/mozilla/geckoview/GeckoSession.java#499>

[2] <https://searchfox.org/mozilla-central/rev/996a2cafe472e9934b8cb91db63050f96d8a59cb/mobile/android/geckoview/src/main/java/org/mozilla/geckoview/GeckoSession.java#1113>

Flags: needinfo?(agi)

|  | [Roger Yang [:royang]](/user_profile?user_id=644746) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1728742#c34)• 3 years ago |
|  | |

Attached patch

[tel\_sms\_intent\_check.patch](attachment.cgi?id=9257521&action=diff) (obsolete)
— [Details](attachment.cgi?id=9257521&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1728742&attachment=9257521)

[Attachment #9257521](/attachment.cgi?id=9257521&action=edit "tel_sms_intent_check.patch") -
Flags: review?(csadilek)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1728742#c35)• 3 years ago |
|  | |

(In reply to Christian Sadilek [:csadilek] from [comment #33](/show_bug.cgi?id=1728742#c33 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack"))

The team is patching [Bug 1728742](/show_bug.cgi?id=1728742 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") as well as [Bug 1741817](/show_bug.cgi?id=1741817 "NEW") together, yes? Because [Bug 1728742](/show_bug.cgi?id=1728742 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") can be used with no user interaction by taking [Bug 1741817](/show_bug.cgi?id=1741817 "NEW") the chain. So, both of the issues are going to be stripped out together? From what I see in the patch attached in [Comment 34](/show_bug.cgi?id=1728742#c34 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") by Roger Yang is to restrict the use of USSD codes `*`, `#`, and `%`.

Flags: needinfo?(csadilek)

|  | [Christian Sadilek [:csadilek]](/user_profile?user_id=590895) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1728742#c36)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1728742&comment_id=15720047 "1 revision") |
|  | |

> The team is patching [Bug 1728742](/show_bug.cgi?id=1728742 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") as well as [Bug 1741817](/show_bug.cgi?id=1741817 "NEW") together, yes?

Thanks for the pointer to the other ticket. The two tickets need separate patches. The patch attached and discussed here covers USSD codes and has higher priority given its security rating (see also <https://bugzilla.mozilla.org/show_bug.cgi?id=1741817#c4>). [Bug 1741817](/show_bug.cgi?id=1741817 "NEW") has different implementation aspects that still need to be discussed independently of this patch here.

Flags: needinfo?(csadilek)

|  | [Roger Yang [:royang]](/user_profile?user_id=644746) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1728742#c37)• 3 years ago |
|  | |

Attached patch

[tel\_sms\_intent\_check\_2.patch](attachment.cgi?id=9257702&action=diff)
— [Details](attachment.cgi?id=9257702&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1728742&attachment=9257702)

[Attachment #9257521](/attachment.cgi?id=9257521&action=edit "tel_sms_intent_check.patch") -
Attachment is obsolete: true
[Attachment #9257521](/attachment.cgi?id=9257521&action=edit "tel_sms_intent_check.patch") -
Flags: review?(csadilek)
[Attachment #9257702](/attachment.cgi?id=9257702&action=edit "tel_sms_intent_check_2.patch") -
Flags: review?(csadilek)

|  | [Christian Sadilek [:csadilek]](/user_profile?user_id=590895) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1728742#c38)• 3 years ago |
|  | |

Comment on [attachment 9257702](/attachment.cgi?id=9257702 "tel_sms_intent_check_2.patch") [[details]](/attachment.cgi?id=9257702&action=edit "tel_sms_intent_check_2.patch") [[diff]](/attachment.cgi?id=9257702&action=diff "tel_sms_intent_check_2.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1728742&attachment=9257702)
tel\_sms\_intent\_check\_2.patch
Review of [attachment 9257702](/attachment.cgi?id=9257702 "tel_sms_intent_check_2.patch") [[details]](/attachment.cgi?id=9257702&action=edit "tel_sms_intent_check_2.patch") [[diff]](/attachment.cgi?id=9257702&action=diff "tel_sms_intent_check_2.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1728742&attachment=9257702):
-----------------------------------------------------------------
r+ good to have as a fallback either way, but let's clarify [https://bugzilla.mozilla.org/show\_bug.cgi?id=1728742#c33](/show_bug.cgi?id=1728742#c33 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack").
[Attachment #9257702](/attachment.cgi?id=9257702&action=edit "tel_sms_intent_check_2.patch") -
Flags: review?(csadilek) → review+

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1728742#c39)• 3 years ago |
|  | |

(In reply to Christian Sadilek [:csadilek] from [comment #33](/show_bug.cgi?id=1728742#c33 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack"))

> We have a "backport" of the Fennec patch ready for A-C that also handles the double encoding case mentioned in <https://bugzilla.mozilla.org/show_bug.cgi?id=1728742#c22>.
>
> We would like feedback from the GeckoView team though, because GV already has most of the required logic in place as part of the `IntentUtils.isUriSafeForScheme` call, invoked for load requests [1]. However, this code path is not executed for load requests forwarded to the embedder [2].
>
> Agi, what do you think? The advantage of handling this in GV is that the call to `onLoadError` would automatically display a meaningful error message to the user without any special handling in A-C/Fenix. We're happy to land the change in A-C/Fenix as well as a fallback.
>
> [1] <https://searchfox.org/mozilla-central/rev/996a2cafe472e9934b8cb91db63050f96d8a59cb/mobile/android/geckoview/src/main/java/org/mozilla/geckoview/GeckoSession.java#499>
>
> [2] <https://searchfox.org/mozilla-central/rev/996a2cafe472e9934b8cb91db63050f96d8a59cb/mobile/android/geckoview/src/main/java/org/mozilla/geckoview/GeckoSession.java#1113>

Yeah I agree this should be fixed in GV. It looks like we missed checking for uriSafeForScheme in code path [2].

Flags: needinfo?(agi)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a11352461_421286)• 3 years ago |

Regressed by: [1619798](/show_bug.cgi?id=1619798 "RESOLVED FIXED - Move `onLoadRequest()` into `DocumentLoadListener::Open()`")

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a11352461_546015)• 3 years ago |

Has Regression Range: --- → yesKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1728742#c40)• 3 years ago |
|  | |

Attached file
[Bug 1728742 - Reject invalid schemes in onLoadRequest.](attachment.cgi?id=9258529)
— [Details](attachment.cgi?id=9258529&action=edit)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1728742#c41)• 3 years ago |
|  | |

Attached file
[Bug 1728742 - Add test for invalid schemes in onLoadRequest.](attachment.cgi?id=9258530)
— [Details](attachment.cgi?id=9258530&action=edit)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1728742#c42)• 3 years ago |
|  | |

Comment on [attachment 9258529](/attachment.cgi?id=9258529 "Bug 1728742 - Reject invalid schemes in onLoadRequest.") [[details]](/attachment.cgi?id=9258529&action=edit "Bug 1728742 - Reject invalid schemes in onLoadRequest.")

[Bug 1728742](/show_bug.cgi?id=1728742 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") - Reject invalid schemes in onLoadRequest.

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Not that easy, the patch adds a generic security check not related to tel: URLs specifically. Tests will land separately at a later date.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: all
* **If not all supported branches, which bug introduced the flaw?**: [Bug 1619798](/show_bug.cgi?id=1619798 "RESOLVED FIXED - Move `onLoadRequest()` into `DocumentLoadListener::Open()`")
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: The patches are all identical
* **How likely is this patch to cause regressions; how much testing does it need?**: The patch could potentially break loading URLs of various types however:

1. we have a lot of automated regression tests around this area
2. this code was accidentally removed in 77 but has been there for a long time
[Attachment #9258529](/attachment.cgi?id=9258529&action=edit "Bug 1728742 - Reject invalid schemes in onLoadRequest.") -
Flags: sec-approval?

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a11358424_421286)• 3 years ago |

[Attachment #9257702](/attachment.cgi?id=9257702&action=edit "tel_sms_intent_check_2.patch") -
Flags: sec-approval?
[Attachment #9258530](/attachment.cgi?id=9258530&action=edit "Bug 1728742 - Add test for invalid schemes in onLoadRequest.") -
Flags: sec-approval?

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1728742#c43)• 3 years ago |
|  | |

Set release status flags based on info from the regressing [bug 1619798](/show_bug.cgi?id=1619798 "RESOLVED FIXED - Move `onLoadRequest()` into `DocumentLoadListener::Open()`")

[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=affected)
[status-firefox97](/buglist.cgi?f1=cf_status_firefox97&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=affected)
[status-firefox98](/buglist.cgi?f1=cf_status_firefox98&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a11952854_406670)• 3 years ago |

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1728742#c44)• 3 years ago |
|  | |

Comment on [attachment 9257702](/attachment.cgi?id=9257702 "tel_sms_intent_check_2.patch") [[details]](/attachment.cgi?id=9257702&action=edit "tel_sms_intent_check_2.patch") [[diff]](/attachment.cgi?id=9257702&action=diff "tel_sms_intent_check_2.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1728742&attachment=9257702)

tel\_sms\_intent\_check\_2.patch

Approved to land and request uplift

[Attachment #9257702](/attachment.cgi?id=9257702&action=edit "tel_sms_intent_check_2.patch") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1728742#c45)• 3 years ago |
|  | |

Comment on [attachment 9258529](/attachment.cgi?id=9258529 "Bug 1728742 - Reject invalid schemes in onLoadRequest.") [[details]](/attachment.cgi?id=9258529&action=edit "Bug 1728742 - Reject invalid schemes in onLoadRequest.")

[Bug 1728742](/show_bug.cgi?id=1728742 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") - Reject invalid schemes in onLoadRequest.

Approved to land and request uplift

[Attachment #9258529](/attachment.cgi?id=9258529&action=edit "Bug 1728742 - Reject invalid schemes in onLoadRequest.") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1728742#c46)• 3 years ago |
|  | |

Comment on [attachment 9258530](/attachment.cgi?id=9258530 "Bug 1728742 - Add test for invalid schemes in onLoadRequest.") [[details]](/attachment.cgi?id=9258530&action=edit "Bug 1728742 - Add test for invalid schemes in onLoadRequest.")

[Bug 1728742](/show_bug.cgi?id=1728742 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") - Add test for invalid schemes in onLoadRequest.

Clearning sec-approval for the test. This can land after March 8th (assuming we uplift this to 97.

[Attachment #9258530](/attachment.cgi?id=9258530&action=edit "Bug 1728742 - Add test for invalid schemes in onLoadRequest.") -
Flags: sec-approval?

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1728742#c47)• 3 years ago |
|  | |

Reject invalid schemes in onLoadRequest. r=jonalmeida

<https://hg.mozilla.org/integration/autoland/rev/f67e35bd834013929d2579a6117656e18b14dd6d>

<https://hg.mozilla.org/mozilla-central/rev/f67e35bd8340>

Group: mobile-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox98](/buglist.cgi?f1=cf_status_firefox98&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1728742#c48)• 3 years ago |
|  | |

Please nominate this for Beta approval when you get a chance.

[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix)Flags: needinfo?(royang)

|  | [Roger Yang [:royang]](/user_profile?user_id=644746) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1728742#c49)• 3 years ago |
|  | |

I'm assuming this is for Agi. Thanks

Flags: needinfo?(royang) → needinfo?(agi)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a12045379_75935)• 3 years ago |

Assignee: royang → agi
[tracking-firefox97](/buglist.cgi?f1=cf_tracking_firefox97&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox97&o1=equals&v1=%2B)
[tracking-firefox98](/buglist.cgi?f1=cf_tracking_firefox98&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox98&o1=equals&v1=%2B)

|  | [Kevin Brosnan [Ex-Mozilla]](/user_profile?user_id=406670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a12046580_406670)• 3 years ago |

Component: Security: Android → GeneralProduct: Fenix → GeckoViewHardware: Other → AllVersion: unspecified → Trunk

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1728742#c50)• 3 years ago |
|  | |

Comment on [attachment 9258529](/attachment.cgi?id=9258529 "Bug 1728742 - Reject invalid schemes in onLoadRequest.") [[details]](/attachment.cgi?id=9258529&action=edit "Bug 1728742 - Reject invalid schemes in onLoadRequest.")

[Bug 1728742](/show_bug.cgi?id=1728742 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") - Reject invalid schemes in onLoadRequest.

### Beta/Release Uplift Approval Request

* **User impact if declined**: Some potentially insecure URLs might be allowed to load causing data leaks
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Medium
* **Why is the change risky/not risky? (and alternatives if risky)**: Code is in the critical page load path but has been in production until 77 when the bug landed
* **String changes made/needed**:
Flags: needinfo?(agi)
[Attachment #9258529](/attachment.cgi?id=9258529&action=edit "Bug 1728742 - Reject invalid schemes in onLoadRequest.") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1728742#c51)• 3 years ago |
|  | |

Comment on [attachment 9258529](/attachment.cgi?id=9258529 "Bug 1728742 - Reject invalid schemes in onLoadRequest.") [[details]](/attachment.cgi?id=9258529&action=edit "Bug 1728742 - Reject invalid schemes in onLoadRequest.")

[Bug 1728742](/show_bug.cgi?id=1728742 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack") - Reject invalid schemes in onLoadRequest.

Approved for Fenix/Focus 97.0.0-beta.3.

[Attachment #9258529](/attachment.cgi?id=9258529&action=edit "Bug 1728742 - Reject invalid schemes in onLoadRequest.") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1728742#c52)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/4495f8356947>

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a12054413_75935)• 3 years ago |

[status-firefox97](/buglist.cgi?f1=cf_status_firefox97&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=fixed)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1728742#c53)• 3 years ago |
|  | |

I think Freddy was right the first time on the rating. On our side it's a fairly minor regression, assuming phones are doing what they should have done all along, and should have learned from the Samsung disaster a decade ago. Sending "#" codes to phones that don't auto-dial is still a spoofing risk for users so we did want to treat this as a problem on the Fenix side.

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=unaffected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---) → [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)See Also: → <https://bugs.chromium.org/p/chromium/issues/detail?id=1180510>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a12564583_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+Keywords: [csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1728742#c54)• 3 years ago |
|  | |

It's irritating behavior when reporter needs to explain the issue/severity again and again. Did you really visit crbug.com/1180510?

If yes, you should have noticed that the bug is actually click-to-call first the user open exploit in computer then sends to device and then opens it. Due to this reason the issue in the Chrome was counted low. Here, we aren't have computer neither we're asking user to do a click we're just asking user to follow a link and in browser exploitation we can "at least" have user to follow an HTML Page, yes? When are we making this issue public? Cheers!

Flags: needinfo?(fbraun)Flags: needinfo?(dveditz)

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1728742#c55)• 3 years ago |
|  | |

It's irritating behavior when reporter needs to explain the issue/severity again and again. Did you really visit crbug.com/1180510?

If yes, you should have noticed that the bug is actually click-to-call first the user open exploit in computer then sends to device and then opens it. Due to this reason the issue in the Chrome was counted low. Here, we aren't having computer neither we're asking user to do a click we're just asking user to follow a link and in browser exploitation we can "at least" have user to follow an HTML Page, yes? When are we making this issue public? Cheers!

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1728742#c56)• 3 years ago |
|  | |

I understand this is frustrating. We have indeed visited and read through the chrome bug extensively when we made the decision and we also need to factor two things in (Dan mentioned it already in [comment 53](/show_bug.cgi?id=1728742#c53 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack")):

1. The attack is almost 10 years old (<https://twitter.com/pof/status/250540790491787264>) and the issue was widely fixed in many Dialer apps, by making `tel:` URLs not auto-dial, but open with a pre-filled number
2. Given this prior history, we believe the attack relies on a secondary vulnerability in the phone's dialer app.

Even with us fixing this vulnerability, some other browser, some other app might end up triggering the same dialer bug. The situation is simply not resolved by patching and fixing all sorts of applications on the phone. The dialer needs fixing.

Flags: needinfo?(fbraun)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a12608127_428608)• 3 years ago |

Flags: needinfo?(dveditz)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a12773594_488993)• 3 years ago |

Whiteboard: [exploit published after Dec 23 2021] → [exploit published after Dec 23 2021][post-critsmash-triage]

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1728742#c57)• 3 years ago |
|  | |

[Comment#56](/show_bug.cgi?id=1728742#c56 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack"): Acknowledged! :)

> Even with us fixing this vulnerability, some other browser, some other app might end up triggering the same dialer bug. The situation is simply not resolved by patching and fixing all sorts of applications on the phone. The dialer needs fixing.

Might be but famous browsers like Chrome, Firefox, etc aren't supporting this at the moment. Is the patch available in the Firefox Nightly channel now?

May I know what do they mean by the stuff which is updated in the WhiteBoard? Exploit isn't published yet. We'll publish it after the patch reaches Firefox and it passes 3weeks or so by that time, hoping that all the users might have received an update and we aren't going to get any users into a problem.

Thank you. It was great working with you all! :)

Cheers!

Flags: needinfo?(fbraun)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1728742#c58)• 3 years ago |
|  | |

Looking from the commit linked in 52, it should be possible to verify this in Firefox for Android (Nightly and Beta).

Regarding the whiteboard tag: We thought you intended to publish the exploit but maybe we misunderstood [comment 24](/show_bug.cgi?id=1728742#c24 "RESOLVED FIXED - Using `tel:` URI to perform USSD attack").

Flags: needinfo?(fbraun)Whiteboard: [exploit published after Dec 23 2021][post-critsmash-triage] → [post-critsmash-triage]

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1728742#c59)• 3 years ago |
|  | |

Issue is patched in the Firefox Nightly build. Nice patch by the way. :)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a13241260_578488)• 3 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main97+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1728742#c60)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9261933)
— [Details](attachment.cgi?id=9261933&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a13672559_578488)• 3 years ago |

Alias: CVE-2022-22758

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a31010352_1689)• 2 years ago |

Group: core-security-release

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a44400697_671976)• 2 years ago |

Duplicate of this bug: [1813110](/show_bug.cgi?id=1813110 "RESOLVED DUPLICATE - Bypass for the \"tel:\" URI Vulnerability")

|  | [Kirtikumar Anandrao Ramchandani](/user_profile?user_id=671976)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a46339516_671976)• 2 years ago |

Group: mobile-core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a47910735_1689)• 2 years ago |

Group: mobile-core-security → core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a86516073_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1728742#a95894862_1689)• 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1728742&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Roger Yang [:royang]](/user_profile?user_id=644746)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_84c69bca_20250114_203350.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-04

## Security Vulnerabilities fixed in Firefox 97

Announced
February 8, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 97

#### [#CVE-2022-22753: Privilege Escalation to SYSTEM on Windows via Maintenance Service](#CVE-2022-22753)

Reporter
Seb Patane
Impact
high
##### Description

A Time-of-Check Time-of-Use bug existed in the Maintenance (Updater) Service that could be abused to grant Users write access to an arbitrary directory. This could have been used to escalate to SYSTEM access.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1732435](https://bugzilla.mozilla.org/show_bug.cgi?id=1732435)

#### [#CVE-2022-22754: Extensions could have bypassed permission confirmation during update](#CVE-2022-22754)

Reporter
Rob Wu
Impact
high
##### Description

If a user installed an extension of a particular type, the extension could have auto-updated itself and while doing so, bypass the prompt which grants the new version the new requested permissions.

##### References

* [Bug 1750565](https://bugzilla.mozilla.org/show_bug.cgi?id=1750565)

#### [#CVE-2022-22755: XSL could have allowed JavaScript execution after a tab was closed](#CVE-2022-22755)

Reporter
Jack Wrenn
Impact
moderate
##### Description

By using XSL Transforms, a malicious webserver could have served a user an XSL document that would continue to execute JavaScript (within the bounds of the same-origin policy) even after the tab was closed.

##### References

* [Bug 1309630](https://bugzilla.mozilla.org/show_bug.cgi?id=1309630)

#### [#CVE-2022-22756: Drag and dropping an image could have resulted in the dropped object being an executable](#CVE-2022-22756)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

If a user was convinced to drag and drop an image to their desktop or other folder, the resulting object could have been changed into an executable script which would have run arbitrary code after the user clicked on it.

##### References

* [Bug 1317873](https://bugzilla.mozilla.org/show_bug.cgi?id=1317873)

#### [#CVE-2022-22757: Remote Agent did not prevent local websites from connecting](#CVE-2022-22757)

Reporter
James Graham
Impact
moderate
##### Description

Remote Agent, used in WebDriver, did not validate the Host or Origin headers. This could have allowed websites to connect back locally to the user's browser to control it.
*This bug only affected Firefox when WebDriver was enabled, which is not the default configuration.*

##### References

* [Bug 1720098](https://bugzilla.mozilla.org/show_bug.cgi?id=1720098)

#### [#CVE-2022-22758: tel: links could have sent USSD codes to the dialer on Firefox for Android](#CVE-2022-22758)

Reporter
Kirtikumar Anandrao Ramchandani, Patrick Walker & Eric Lawrence
Impact
moderate
##### Description

When clicking on a tel: link, USSD codes, specified after a `*` character, would be included in the phone number. On certain phones, or on certain carriers, if the number was dialed this could perform actions on a user's account, similar to a cross-site request forgery attack.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1728742](https://bugzilla.mozilla.org/show_bug.cgi?id=1728742)

#### [#CVE-2022-22759: Sandboxed iframes could have executed script if the parent appended elements](#CVE-2022-22759)

Reporter
Johan Carlsson
Impact
moderate
##### Description

If a document created a sandboxed iframe without `allow-scripts`, and subsequently appended an element to the iframe's document that e.g. had a JavaScript event handler - the event handler would have run despite the iframe's sandbox.

##### References

* [Bug 1739957](https://bugzilla.mozilla.org/show_bug.cgi?id=1739957)

#### [#CVE-2022-22760: Cross-Origin responses could be distinguished between script and non-script content-types](#CVE-2022-22760)

Reporter
Luan Herrera
Impact
moderate
##### Description

When importing resources using Web Workers, error messages would distinguish the difference between `application/javascript` responses and non-script responses. This could have been abused to learn information cross-origin.

##### References

* [Bug 1740985](https://bugzilla.mozilla.org/show_bug.cgi?id=1740985)
* [Bug 1748503](https://bugzilla.mozilla.org/show_bug.cgi?id=1748503)

#### [#CVE-2022-22761: frame-ancestors Content Security Policy directive was not enforced for framed extension pages](#CVE-2022-22761)

Reporter
Mart Gil Robles (Mart at FlowCrypt)
Impact
moderate
##### Description

Web-accessible extension pages (pages with a moz-extension:// scheme) were not correctly enforcing the frame-ancestors directive when it was used in the Web Extension's Content Security Policy.

##### References

* [Bug 1745566](https://bugzilla.mozilla.org/show_bug.cgi?id=1745566)

#### [#CVE-2022-22762: JavaScript Dialogs could have been displayed over other domains on Firefox for Android](#CVE-2022-22762)

Reporter
James Lee
Impact
low
##### Description

Under certain circumstances, a JavaScript alert (or prompt) could have been shown while another website was displayed underneath it. This could have been abused to trick the user.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1743931](https://bugzilla.mozilla.org/show_bug.cgi?id=1743931)

#### [#CVE-2022-22764: Memory safety bugs fixed in Firefox 97 and Firefox ESR 91.6](#CVE-2022-22764)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Paul Adenot and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 96 and Firefox ESR 91.5. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 97 and Firefox ESR 91.6](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1742682%2C1744165%2C1746545%2C1748210%2C1748279)

#### [#CVE-2022-0511: Memory safety bugs fixed in Firefox 97](#CVE-2022-0511)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Gabriele Svelto, Sebastian Hengst, Randell Jesup, Luan Herrera, Lars T Hansen, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 96. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 97](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1713579%2C1735448%2C1743821%2C1746313%2C1746314%2C1746316%2C1746321%2C1746322%2C1746323%2C1746412%2C1746430%2C1746451%2C1746488%2C1746875%2C1746898%2C1746905%2C1746907%2C1746917%2C1747128%2C1747137%2C1747331%2C1747346%2C1747439%2C1747457%2C1747870%2C1749051%2C1749274%2C1749831)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


