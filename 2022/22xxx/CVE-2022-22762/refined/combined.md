=== Content from bugzilla.mozilla.org_15dc0dfd_20250115_080707.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1743931)
* [XML](/show_bug.cgi?ctype=xml&id=1743931)

Closed
[Bug 1743931](/show_bug.cgi?id=1743931)
(CVE-2022-22762)

Opened 3 years ago
Closed 3 years ago

# We can spoof js alert box on an arbitrary domain for Firefox for Android Nightly

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

We can spoof js alert box on an arbitrary domain for Firefox for Android Nightly

## Categories

### (Fenix :: General, task)

[Product:](/describecomponents.cgi?product=Fenix)

Fenix
▾

Fenix
**Firefox for Android**: Fenix is an Android browser built using Android Components that re-imagines how a mobile browser would look if it was built from scratch to demonstrate better design for typical mobile use cases ([more info](https://www.mozilla.org/en-us/firefox/mobile/)).
[See Open Bugs in This Product](/buglist.cgi?product=Fenix&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Fenix)
Watch This Product

[Component:](/describecomponents.cgi?product=Fenix&component=General#General)

General
▾

Fenix :: General
For bugs in Firefox Android which do not fit into other more specific components
[See Open Bugs in This Component](/buglist.cgi?product=Fenix&component=General&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Fenix&component=General&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Fenix&component=General)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Android

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

task

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### (firefox95 wontfix, firefox96 wontfix, firefox97 fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox95 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=wontfix) |
| firefox96 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix) |
| firefox97 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox95 |  | wontfix |
| firefox96 |  | wontfix |
| firefox97 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: proof131072, Assigned: sebastian)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/823f986b798048330aca1a50acc92240?d=mm&size=40)  [sebastian](/user_profile?user_id=472516)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/302893eb3990c528336f2ee08964bfa5?d=mm&size=40)  [proof131072](/user_profile?user_id=619332)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e49a28e5fed7340a3e51d46100902d93?d=mm&size=40)  [boek](/user_profile?user_id=599885)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1749398](/show_bug.cgi?id=1749398 "ASSIGNED - onPromptDismiss is not always invoked on page navigation")

## Details

### (Keywords: csectype-spoof, reporter-external, sec-low, Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main97+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-22762

[Keywords:](/describekeywords.cgi)

[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main97+]

Change Request:

---

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a3523663_1689 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | sec-bounty-hof |  |
| --- | --- | --- |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [Screen\_Recording\_20211202-134442\_Firefox Nightly.mp4](/attachment.cgi?id=9253361)  [3 years ago](#c4)  [James Lee](/user_profile?user_id=619332)   8.80 MB, video/mp4 |  | [Details](/attachment.cgi?id=9253361&action=edit) |
| --- | --- | --- |
| [Case\_1](/attachment.cgi?id=9255264)  [3 years ago](#c11)  [James Lee](/user_profile?user_id=619332)   3.05 MB, video/mp4 |  | [Details](/attachment.cgi?id=9255264&action=edit) |
| [Case\_2](/attachment.cgi?id=9255265)  [3 years ago](#c12)  [James Lee](/user_profile?user_id=619332)   5.98 MB, video/mp4 |  | [Details](/attachment.cgi?id=9255265&action=edit) |
| [prompt.patch](/attachment.cgi?id=9255679)  [3 years ago](#c14)  [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516)   2.40 KB, patch | csadilek : [review+](#a1260583_590895 "3 years ago")  amejia : [review+](#a1259696_623634 "3 years ago") | [Details](/attachment.cgi?id=9255679&action=edit) | [Diff](/attachment.cgi?id=9255679&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1743931&attachment=9255679) |
| [20220110\_165026.mp4](/attachment.cgi?id=9258340)  [3 years ago](#c24)  [Laurentiu Apahidean](/user_profile?user_id=631237)   1.88 MB, video/mp4 |  | [Details](/attachment.cgi?id=9258340&action=edit) |
| [advisory.txt](/attachment.cgi?id=9261925)  [3 years ago](#c25)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   369 bytes, text/plain |  | [Details](/attachment.cgi?id=9261925&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1743931#c0)• 3 years ago |
|  | |

Test on: <https://pwning.click/data302r.php>

After you allow to reload the page, you are able to run alert box on arbitrary domain for Firefox Nightly. This works through data: URI 302 redirection.

<?php header("Location: data:text/html;base64,PHNjcmlwdD5mdW5jdGlvbiB5KCl7eD1vcGVuKCdodHRwczovL3d3dy5nb29nbGUuY29tJywnX3RvcCcpLHguZG9jdW1lbnQudGl0bGU9JycseC5kb2N1bWVudC5ib2R5LmlubmVySFRNTD0nPGltZy9zcmM9IiJvbmVycm9yPSJhbGVydCgmcXVvdDt0aGlzIGlzIGZyb20gZ29vZ2xlJnF1b3Q7KSI+PGltZy9zcmM9IiJvbmVycm9yPSJhbGVydCgmcXVvdDt0aGlzIGlzIGZyb20gZ29vZ2xlJnF1b3Q7KSI+PGltZy9zcmM9IiJvbmVycm9yPSJhbGVydCgmcXVvdDt0aGlzIGlzIGZyb20gZ29vZ2xlJnF1b3Q7KSI+J307c2V0VGltZW91dCh5LCAxMCk7Cjwvc2NyaXB0Pg==

", true, 302); ?>

Flags: sec-bounty?

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1743931#c1)• 3 years ago |
|  | |

\*Android Firefox Nightly

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1743931#c2)• 3 years ago |
|  | |

If you just close the browser and reopen or crash the browser from other page, this will work without clicking "Try Again".

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1743931#c3)• 3 years ago |
|  | |

The base64 decoded and prettified:

```
<script>
  function y() {
    x = open('https://www.google.com', '_top'),
    x.document.title = '',
    x.document.body.innerHTML =
      '<img/src=\"\"onerror=\"alert(&quot;this is from google&quot;)\">' +
      '<img/src=\"\"onerror=\"alert(&quot;this is from google&quot;)\">' +
      '<img/src=\"\"onerror=\"alert(&quot;this is from google&quot;)\">'
   };
   setTimeout(y, 10);
</script>

```

If you load the data: url directly in desktop Firefox you can see the effect James is going for, but I can't reproduce this using his pwning.click url on Firefox Desktop or Fenix Nightly

Firefox Desktop results:

* URL bar is replaced with "about:blank", empty page
* The tab's **title** and **favicon** remain those of the previous page (not great, not terrible)

Firefox for Android (Fenix):

1. load <https://pwning.click/data302r.php>

   ==> Browser error page "**Cannot Complete Request**", data: URL in the addressbar, and a big "**Try Again**" button
2. Press the big purple button

   ==>

   a. most of the time: blank page with the data URL in the addressbar. reloading does nothing

   b. ***once*** I got a flash of an alert box too fast to read, and then Google loaded.

I also tried reloading using the menu instead of the big purple button but only reproduced the blank page result. On Android I've tried both Nightly and Release. The one time it sort of worked was on Release, but it was so rare I don't think I'd claim it was "fixed" on Nightly even though I can't reproduce.

Note that if you directly type a data: URL into the address bar you get a different error page: "**Invalid Address**", and the Try Again button just keeps giving you the same error page.

For me the test URL didn't at all work as a spoof even the one time it sort of worked, since the dialog went by so quickly. Might work better with a domain that loads very slowly? Seems dubious you could use this to say much that's convincing when it gets replaced so quickly.

Apart from the spoofing, we've decided that we won't load top-level content from `data:` urls, not even if you type it in (unlike desktop where it's easier to type and we've left it as a dev tool for now). But there was at least once where we rendered it. What kind of timing hole could lead to that?

oh, speaking of "timing hole", I should mention that my phone is only a couple months old and is pretty fast. Maybe this is more reproducible on older/slower devices

Group: firefox-core-security → mobile-core-securityComponent: Security → Security: AndroidProduct: Firefox → FenixSummary: We can spoof js alert box on an arbitrary domain for Firefox Nightly → We can spoof js alert box on an arbitrary domain for Firefox for Android Nightly

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1743931#c4)• 3 years ago |
|  | |

Attached video
[Screen\_Recording\_20211202-134442\_Firefox Nightly.mp4](attachment.cgi?id=9253361)
— [Details](attachment.cgi?id=9253361&action=edit)

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1743931#c5)• 3 years ago |
|  | |

I tested on latest S21 which loads fast and this is how it looks when I tested.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1743931#c6)• 3 years ago |
|  | |

Agi: are you able to reproduce the results shown in the attached movie with the testcase <https://pwning.click/data302r.php> ?

Flags: needinfo?(agi)

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1743931#c7)• 3 years ago |
|  | |

My experience is the same as [Comment 3](/show_bug.cgi?id=1743931#c3 "RESOLVED FIXED - We can spoof js alert box on an arbitrary domain for Firefox for Android Nightly") on my S10. I think we did a change at some point to dismiss any prompt upon navigation so that might be why we can't reproduce, James what version of Fenix are you on?

cc csadilek because I think he was involved in the prompt fix.

Flags: needinfo?(agi)

|  | [Christian Sadilek [:csadilek]](/user_profile?user_id=590895) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1743931#c8)• 3 years ago |
|  | |

On my Pixel 2, I can reproduce intermittently and sometimes see the alert after hitting try again. Agree with Daniel, that there's a timing problem involved that still needs investigation.

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1743931#c9)• 3 years ago |
|  | |

I can reproduce it too and will investigate the cause.

Assignee: nobody → s.kaspariStatus: NEW → ASSIGNED

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1743931#c10)• 3 years ago |
|  | |

Okay, there's a lot happening here.

1. I can only reproduce this when hitting "Try again" on the error page, or when this tab gets restored (after a cold start). Sometimes it does not reproduce.
2. We get multiple alerts and they happen before the location change. (Just to be clear: The JS does not seem to have access to the page loaded after) and they stick around.
3. We only keep one reference, for the active prompt. But here multiple alerts are shown quickly. So when we remove the prompt on location change, then there may still be others around that we do not have a reference to anymore. And this is also why this is racing and not always reproducible: If the location change is happening quick enough there may be only one prompt then it gets dismissed. But if there are multiple then only the last one gets dismissed.

To mitigate this we would need to either keep all instances of prompts we create around, so that we can dismiss all of them, or prevent multiple prompts concurrently in the first place, and process them sequentially maybe.

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1743931#c11)• 3 years ago |
|  | |

Attached video
[Case\_1](attachment.cgi?id=9255264)
— [Details](attachment.cgi?id=9255264&action=edit)

I tested on latest Nightly/Fenix

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1743931#c12)• 3 years ago |
|  | |

Attached video
[Case\_2](attachment.cgi?id=9255265)
— [Details](attachment.cgi?id=9255265&action=edit)

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1743931#c13)• 3 years ago |
|  | |

I could've uploaded better demos for the attack side, so these are 2 cases and the second case could be useful for attackers since we know there are plenty of users who just swipe close the tab and re-open it for most of the time when they see any sort of "error" on their browser. When they do that, it's easy enough for them to confuse that google.com or any other arbitrary generally trusted site is asking for their personal info and/or any type of social engineering attack together from the site as the message of dialog box tells you "This page says~" on <https://www.google.com> when you load with data: URI instead of "[Origin of the Website] says~" (test e.g. <https://pwning.click> says) like when you repro this from other site. When the tab gets restored- which is the second case, it works all the time from my testing. While this works on latest devices, we can spoof as many as infinite dialog boxes on arbitrary trusted site for slower (due to many installed apps, etc) and/or old devices.

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1743931#c14)• 3 years ago |
|  | |

Attached patch

[prompt.patch](attachment.cgi?id=9255679&action=diff)
— [Details](attachment.cgi?id=9255679&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1743931&attachment=9255679)

This patch makes sure we dismiss all dialogs on navigation and not only the last one.

Christian, Arturo and I met yesterday to look at the code. The feature that handles prompts has grown quite a bit over time and is quite complex - and not only handling simple web prompts, but also autofill prompts for logins and credit cards. We have some ideas how this can/should be split up and simplified. But for now we wanted to create a quick fix for this security issue. The result is this patch. We will keep track of all dialog prompts we create and dismiss all of them on navigation.

[Attachment #9255679](/attachment.cgi?id=9255679&action=edit "prompt.patch") -
Flags: review?(csadilek)
[Attachment #9255679](/attachment.cgi?id=9255679&action=edit "prompt.patch") -
Flags: review?(amejiamarmol)

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1743931#c15)• 3 years ago |
|  | |

@Daniel: Can you give us a security severity rating here, so that we can land the patch after review?

Flags: needinfo?(dveditz)

|  | [Arturo Mejia [:amejia]](/user_profile?user_id=623634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a1259696_623634)• 3 years ago |

[Attachment #9255679](/attachment.cgi?id=9255679&action=edit "prompt.patch") -
Flags: review?(amejiamarmol) → review+

|  | [Christian Sadilek [:csadilek]](/user_profile?user_id=590895) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a1260583_590895)• 3 years ago |

[Attachment #9255679](/attachment.cgi?id=9255679&action=edit "prompt.patch") -
Flags: review?(csadilek) → review+

|  | [[ex-Mozilla] Agi Sferro | :agi](/user_profile?user_id=421286) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1743931#c16)• 3 years ago |
|  | |

I think long term GeckoView should handle dismissing the prompts in these cases, similar to [Bug 1715572](/show_bug.cgi?id=1715572 "RESOLVED FIXED - Select prompts should be dismissed when user clicks other fields")

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1743931#c17)• 3 years ago |
|  | |

(In reply to Agi Sferro | :agi | ni? for questions | ⏰ PST | he/him from [comment #16](/show_bug.cgi?id=1743931#c16 "RESOLVED FIXED - We can spoof js alert box on an arbitrary domain for Firefox for Android Nightly"))

> I think long term GeckoView should handle dismissing the prompts in these cases, similar to [Bug 1715572](/show_bug.cgi?id=1715572 "RESOLVED FIXED - Select prompts should be dismissed when user clicks other fields")

Yeah, that's what we were thinking too and Arturo added it to the agenda for the engineering meeting on Monday. There are multiple things that we "clear/reset" on navigation - trying to emulate what happens internally in Gecko(View). We may want to review all of those cases. Ideally we'd never make such decisions in A-C.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1743931#c18)• 3 years ago |
|  | |

It's hard to imagine you could say much in a prompt over some other site that would be dangerously convincing. Given your description of the problem in [comment 10](/show_bug.cgi?id=1743931#c10 "RESOLVED FIXED - We can spoof js alert box on an arbitrary domain for Firefox for Android Nightly") I'm assuming that even if the PoC were changed to `prompt("Please enter your password to continue")` there is not longer an attacker's page to return the answer to?

Flags: needinfo?(dveditz)Keywords: [csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1743931#c19)• 3 years ago |
|  | |

<https://github.com/mozilla-mobile/android-components/pull/11436>

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1743931#c20)• 3 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #18](/show_bug.cgi?id=1743931#c18 "RESOLVED FIXED - We can spoof js alert box on an arbitrary domain for Firefox for Android Nightly"))

> It's hard to imagine you could say much in a prompt over some other site that would be dangerously convincing. Given your description of the problem in [comment 10](/show_bug.cgi?id=1743931#c10 "RESOLVED FIXED - We can spoof js alert box on an arbitrary domain for Firefox for Android Nightly") I'm assuming that even if the PoC were changed to `prompt("Please enter your password to continue")` there is not longer an attacker's page to return the answer to?

U can do that by running script from the attacker's site instead of data: URI.

|  | [Sebastian Kaspari (:sebastian; :pocmo)](/user_profile?user_id=472516)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1743931#c21)• 3 years ago |
|  | |

Patch landed 2 weeks ago in 97.0 Nightly.

Status: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox97](/buglist.cgi?f1=cf_status_firefox97&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox97&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a3098284_75935)• 3 years ago |

Group: mobile-core-security → core-security-release
[status-firefox95](/buglist.cgi?f1=cf_status_firefox95&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox95&o1=equals&v1=wontfix)
[status-firefox96](/buglist.cgi?f1=cf_status_firefox96&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox96&o1=equals&v1=wontfix)

|  | [James Lee](/user_profile?user_id=619332)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1743931#c22)• 3 years ago |
|  | |

since we can receive typed info via prompt from users in some case this looks more like moderate imo

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a3409685_553429)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]

|  | [Laurentiu Apahidean](/user_profile?user_id=631237) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1743931#c23)• 3 years ago |
|  | |

I tested the issue on a OnePlus 6T(Android 9) and Google Pixel 6(Android 12) using the latest Firefox Preview Nightly 97.0a1 2022-01-10.

After accessing the site <https://pwning.click/data302r.php> and tapping on the Try Again button or reloading the page the <https://www.google.com/> webpage is loaded.

|  | [Laurentiu Apahidean](/user_profile?user_id=631237) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1743931#c24)• 3 years ago |
|  | |

Attached video
[20220110\_165026.mp4](attachment.cgi?id=9258340)
— [Details](attachment.cgi?id=9258340&action=edit)

|  | [Jonathan Almeida [:jonalmeida]](/user_profile?user_id=541581) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a3458158_541581)• 3 years ago |

See Also: → [1749398](/show_bug.cgi?id=1749398 "ASSIGNED - onPromptDismiss is not always invoked on page navigation")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a3523663_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a5409894_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main97+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1743931#c25)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9261925)
— [Details](attachment.cgi?id=9261925&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a5841223_578488)• 3 years ago |

Alias: CVE-2022-22762

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a23178964_1689)• 2 years ago |

Group: core-security-release

|  | [Chris Peterson [:cpeterson]](/user_profile?user_id=430528) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a29137283_430528)• 2 years ago |

Component: Security: Android → GeneralOS: Unspecified → Android

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1743931#a78685627_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1743931&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [James Lee](/user_profile?user_id=619332)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_84c69bca_20250115_080709.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-04

## Security Vulnerabilities fixed in Firefox 97

Announced
February 8, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 97

#### [#CVE-2022-22753: Privilege Escalation to SYSTEM on Windows via Maintenance Service](#CVE-2022-22753)

Reporter
Seb Patane
Impact
high
##### Description

A Time-of-Check Time-of-Use bug existed in the Maintenance (Updater) Service that could be abused to grant Users write access to an arbitrary directory. This could have been used to escalate to SYSTEM access.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1732435](https://bugzilla.mozilla.org/show_bug.cgi?id=1732435)

#### [#CVE-2022-22754: Extensions could have bypassed permission confirmation during update](#CVE-2022-22754)

Reporter
Rob Wu
Impact
high
##### Description

If a user installed an extension of a particular type, the extension could have auto-updated itself and while doing so, bypass the prompt which grants the new version the new requested permissions.

##### References

* [Bug 1750565](https://bugzilla.mozilla.org/show_bug.cgi?id=1750565)

#### [#CVE-2022-22755: XSL could have allowed JavaScript execution after a tab was closed](#CVE-2022-22755)

Reporter
Jack Wrenn
Impact
moderate
##### Description

By using XSL Transforms, a malicious webserver could have served a user an XSL document that would continue to execute JavaScript (within the bounds of the same-origin policy) even after the tab was closed.

##### References

* [Bug 1309630](https://bugzilla.mozilla.org/show_bug.cgi?id=1309630)

#### [#CVE-2022-22756: Drag and dropping an image could have resulted in the dropped object being an executable](#CVE-2022-22756)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

If a user was convinced to drag and drop an image to their desktop or other folder, the resulting object could have been changed into an executable script which would have run arbitrary code after the user clicked on it.

##### References

* [Bug 1317873](https://bugzilla.mozilla.org/show_bug.cgi?id=1317873)

#### [#CVE-2022-22757: Remote Agent did not prevent local websites from connecting](#CVE-2022-22757)

Reporter
James Graham
Impact
moderate
##### Description

Remote Agent, used in WebDriver, did not validate the Host or Origin headers. This could have allowed websites to connect back locally to the user's browser to control it.
*This bug only affected Firefox when WebDriver was enabled, which is not the default configuration.*

##### References

* [Bug 1720098](https://bugzilla.mozilla.org/show_bug.cgi?id=1720098)

#### [#CVE-2022-22758: tel: links could have sent USSD codes to the dialer on Firefox for Android](#CVE-2022-22758)

Reporter
Kirtikumar Anandrao Ramchandani, Patrick Walker & Eric Lawrence
Impact
moderate
##### Description

When clicking on a tel: link, USSD codes, specified after a `*` character, would be included in the phone number. On certain phones, or on certain carriers, if the number was dialed this could perform actions on a user's account, similar to a cross-site request forgery attack.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1728742](https://bugzilla.mozilla.org/show_bug.cgi?id=1728742)

#### [#CVE-2022-22759: Sandboxed iframes could have executed script if the parent appended elements](#CVE-2022-22759)

Reporter
Johan Carlsson
Impact
moderate
##### Description

If a document created a sandboxed iframe without `allow-scripts`, and subsequently appended an element to the iframe's document that e.g. had a JavaScript event handler - the event handler would have run despite the iframe's sandbox.

##### References

* [Bug 1739957](https://bugzilla.mozilla.org/show_bug.cgi?id=1739957)

#### [#CVE-2022-22760: Cross-Origin responses could be distinguished between script and non-script content-types](#CVE-2022-22760)

Reporter
Luan Herrera
Impact
moderate
##### Description

When importing resources using Web Workers, error messages would distinguish the difference between `application/javascript` responses and non-script responses. This could have been abused to learn information cross-origin.

##### References

* [Bug 1740985](https://bugzilla.mozilla.org/show_bug.cgi?id=1740985)
* [Bug 1748503](https://bugzilla.mozilla.org/show_bug.cgi?id=1748503)

#### [#CVE-2022-22761: frame-ancestors Content Security Policy directive was not enforced for framed extension pages](#CVE-2022-22761)

Reporter
Mart Gil Robles (Mart at FlowCrypt)
Impact
moderate
##### Description

Web-accessible extension pages (pages with a moz-extension:// scheme) were not correctly enforcing the frame-ancestors directive when it was used in the Web Extension's Content Security Policy.

##### References

* [Bug 1745566](https://bugzilla.mozilla.org/show_bug.cgi?id=1745566)

#### [#CVE-2022-22762: JavaScript Dialogs could have been displayed over other domains on Firefox for Android](#CVE-2022-22762)

Reporter
James Lee
Impact
low
##### Description

Under certain circumstances, a JavaScript alert (or prompt) could have been shown while another website was displayed underneath it. This could have been abused to trick the user.
*This bug only affects Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1743931](https://bugzilla.mozilla.org/show_bug.cgi?id=1743931)

#### [#CVE-2022-22764: Memory safety bugs fixed in Firefox 97 and Firefox ESR 91.6](#CVE-2022-22764)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Paul Adenot and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 96 and Firefox ESR 91.5. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 97 and Firefox ESR 91.6](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1742682%2C1744165%2C1746545%2C1748210%2C1748279)

#### [#CVE-2022-0511: Memory safety bugs fixed in Firefox 97](#CVE-2022-0511)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Gabriele Svelto, Sebastian Hengst, Randell Jesup, Luan Herrera, Lars T Hansen, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 96. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 97](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1713579%2C1735448%2C1743821%2C1746313%2C1746314%2C1746316%2C1746321%2C1746322%2C1746323%2C1746412%2C1746430%2C1746451%2C1746488%2C1746875%2C1746898%2C1746905%2C1746907%2C1746917%2C1747128%2C1747137%2C1747331%2C1747346%2C1747439%2C1747457%2C1747870%2C1749051%2C1749274%2C1749831)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


