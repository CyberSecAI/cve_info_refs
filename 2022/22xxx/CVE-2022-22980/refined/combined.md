=== Content from tanzu.vmware.com_7d9c095d_20250114_205142.html ===
[Skip to main content](#main)Why Spring

* [Overview](/why-spring)
* [Microservices](/microservices)
* [Reactive](/reactive)
* [Event Driven](/event-driven)
* [Cloud](/cloud)
* [Web Applications](/web-applications)
* [Serverless](/serverless)
* [Batch](/batch)
Learn

* [Overview](/learn)
* [Quickstart](/quickstart)
* [Guides](/guides)
* [Blog](/blog)
Projects

* [Overview](/projects)
* [Spring Boot](/projects/spring-boot)
* [Spring Framework](/projects/spring-framework)
* [Spring Cloud](/projects/spring-cloud)
* [Spring Cloud Data Flow](/projects/spring-cloud-dataflow)
* [Spring Data](/projects/spring-data)
* [Spring Integration](/projects/spring-integration)
* [Spring Batch](/projects/spring-batch)
* [Spring Security](/projects/spring-security)
* [Spring AI](/projects/spring-ai)
* [View all projects](/projects)
* [Release Calendar](/projects#release-calendar)
* DEVELOPMENT TOOLS
* [Spring Tools 4](/tools)
* [Spring Initializr](https://start.spring.io/)
Academy

* [Courses](https://spring.academy/courses)
* [Get Certified](https://spring.academy/learning-path)
Solutions

* [Overview](/solutions)
* [Tanzu Spring](/support)
* [Spring Consulting](/consulting)
* [Spring Academy](https://spring.academy/)
* [Security Advisories](/security)
Community

* [Overview](/community)
* [Events](/events)
* [Authors](/authors)
# [Spring Security Advisories](/security)

[RSS feed](/security.atom)
# CVE-2022-22980: Spring Data MongoDB SpEL Expression injection vulnerability through annotated repository query methods

HIGH | JUNE 20, 2022 | CVE-2022-22980
# Description

A Spring Data MongoDB application is vulnerable to SpEL Injection when using @Query or @Aggregation-annotated query methods with SpEL expressions that contain query parameter placeholders for value binding if the input is not sanitized.

Specifically, an application is vulnerable when all of the following are true:

* A repository query method is annotated with @Query or @Aggregation
* The annotated query or aggregation value/pipeline contains SpEL parts using the parameter placeholder syntax within the expression
* The user supplied input is not sanitized by the application

An application is not vulnerable if any of the following is true:

* The annotated repository query or aggregation method does not contain expressions
* The annotated repository query or aggregation method does not use the parameter placeholder syntax within the expression
* The user supplied input is sanitized by the application
* The repository is configured to use a QueryMethodEvaluationContextProvider that limits SpEL usage

# Affected Spring Products and Versions

* Spring Data MongoDB
  + 3.4.0
  + 3.3.0 to 3.3.4
  + Older, unsupported versions are also affected

# Mitigation

Users of affected versions should apply the following mitigation: 3.4.x users should upgrade to 3.4.1+. 3.3.x users should upgrade to 3.3.5+. No other steps are necessary. There are other mitigation steps for applications that cannot upgrade to the above versions.

Other mitigation steps:

* Rewrite query or aggregation declarations to use parameter references (“[0]” instead of “?0“) within the expression
* Sanitize parameters before calling the query method
* Reconfigure the repository factory bean through a BeanPostProcessor with a limited QueryMethodEvaluationContextProvider

Releases that have fixed this issue include:

* Spring Data MongoDB
  + 3.4.1+
  + 3.3.5+

# Credit

This issue was identified and responsibly reported by Zewei Zhang from NSFOCUS TIANJI Lab.

# References

* <https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H/E:P/RL:O/RC:C/CR:H/IR:H/AR:H/MAV:N/MAC:H/MPR:N/MUI:N/MS:C/MC:H/MI:H/MA:H&version=3.1>

# History

* 2022-06-20: Initial vulnerability report published.
## Reporting a vulnerability

To report a security vulnerability for a project within the Spring portfolio, see the [Security Policy](/security-policy)

![](/img/extra/footer.svg)
## Get ahead

VMware offers training and certification to turbo-charge your progress.

[Learn more](https://spring.academy/)
## Get support

Tanzu Spring offers support and binaries for OpenJDK™, Spring, and Apache Tomcat® in one simple subscription.

[Learn more](/support)
## Upcoming events

Check out all the upcoming events in the Spring community.

[View all](/events)[Why Spring](/why-spring)[Microservices](/microservices)[Reactive](/reactive)[Event Driven](/event-driven)[Cloud](/cloud)[Web Applications](/web-applications)[Serverless](/serverless)[Batch](/batch)[Learn](/learn)[Quickstart](/quickstart)[Guides](/guides)[Blog](/blog)[Community](/community)[Events](/events)[Authors](/authors)[Solutions](/overview)[Tanzu Spring](/support)[Spring Consulting](/consulting)[Spring Academy](https://spring.academy/)[Spring Advisories](/security)[Projects](/projects)[Thank You](/thank-you)
## Get the Spring newsletter

Stay connected with the Spring newsletter

[Subscribe](https://go-vmware.broadcom.com/tnz-spring-newsletter-subscribe)

Copyright © 2005 - 2025 Broadcom. All Rights Reserved. The term "Broadcom" refers to Broadcom Inc. and/or its subsidiaries.
[Terms of Use](https://www.vmware.com/help/legal.html) • [Privacy](https://www.vmware.com/help/privacy.html) • [Trademark Guidelines](/trademarks) • [Your California Privacy Rights](https://www.vmware.com/help/privacy/california-privacy-rights.html)

Apache®, Apache Tomcat®, Apache Kafka®, Apache Cassandra™, and Apache Geode™ are trademarks or registered trademarks of the Apache Software Foundation in the United States and/or other countries. Java™, Java™ SE, Java™ EE, and OpenJDK™ are trademarks of Oracle and/or its affiliates. Kubernetes® is a registered trademark of the Linux Foundation in the United States and other countries. Linux® is the registered trademark of Linus Torvalds in the United States and other countries. Windows® and Microsoft® Azure are registered trademarks of Microsoft Corporation. “AWS” and “Amazon Web Services” are trademarks or registered trademarks of Amazon.com Inc. or its affiliates. All other trademarks and copyrights are property of their respective owners and are only mentioned for informative purposes. Other names may be trademarks of their respective owners.


