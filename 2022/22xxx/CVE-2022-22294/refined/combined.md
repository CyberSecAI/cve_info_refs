=== Content from www.cnblogs.com_2bfe3dc9_20250115_095355.html ===


* [![博客园Logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [终身会员](https://cnblogs.vip/buy?modalOpen=true&buyingProduct=vip-lifetime)
* [周边](https://cnblogs.vip/store)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/18341478)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)
  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)
  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  简洁模式 ![](/images/lite-mode-check.svg)...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[![返回主页](/skins/custom/images/logo.gif)](https://www.cnblogs.com/J0o1ey/)
# [J0o1ey的博客](https://www.cnblogs.com/J0o1ey)

## 记录所思所想，做专业的网络安全，渗透测试，代码审计，红蓝对抗技术BLOG

* [博客园](https://www.cnblogs.com/)
* [首页](https://www.cnblogs.com/J0o1ey/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/J0o1ey)
* 订阅
* [管理](https://i.cnblogs.com/)

# [Zfaka Foreground SQL injection](https://www.cnblogs.com/J0o1ey/p/15757096.html "发布于 2022-01-02 10:31")

In zfaka version 1.4.3,

application / modules / product / admin / Controllers / product / imgurlajax php involed a SQL injection Vuln

Found the following paragraph

![image-20210526025356848](https://i.loli.net/2021/05/26/sgoDva5h4QYZIGw.png)

PDO is the default configuration, and stack injection is immediately thought of

After testing, the OrderID user is controllable. The global search for OrderID shows that OrderID is processed into a pure string by the function method, and there is no room for injection, so we choose another way

It is found that the IP parameters are also controllable by the user, and no processing is done before calling the select method.

The IP parameter calls the getclientip method. Let's follow the getclientip method

![image-20210526030817917](https://i.loli.net/2021/05/26/hng6kUiuVRmO4aQ.png)

It is easy to understand that it is to obtain the client IP from the common HTTP header

However, I am very glad that the IP parameters are not processed. We can implement Stack Injection by constructing XFF header

Because of CSRF\_ For the verification of token, we must arbitrarily enter an order number on the order query page, and then enter the correct verification code, and then the query is valid

Then, the XFF header is manually constructed for Stack Injection for PDO

Because the PDO is closed with double quotation marks and belongs to stack injection without echo

Therefore, the payload structure is

```

X-FORWARDED-For:1'; select sleep(5)#

```

![image-20210526202008945](https://i.loli.net/2021/05/26/h6Tv1eJEpzQZcKg.png)

The injection was successful after a delay of 5S.

For this stack injection without echo, blind injection is too slow, and it is too slow to use dnslog OOB, so we choose to construct an insert statement to add a background administrator

Using prepare statement

```

X-FORWARDED-For:1"; set@a =0x696E7365727420696E746F20745F61646D696E5F757365722076616C7565732839392C227465737440746573742E74657374222C223736623138303766633163393134663135353838353230623038333366626333222C22373865303535222C30293B; PREPARE a FROM @a; execute a; select sleep(3);#

//Sleep is used to judge whether the injection is successful

```

Successfully added a background account with user name test@test.test , password 123456

You can directly log in to the target background / Admin

![image-20210526202209072](https://i.loli.net/2021/05/26/e2Q5VTXWOKxEYpM.png)

posted @
2022-01-02 10:31
[J0o1ey](https://www.cnblogs.com/J0o1ey)
阅读(626)
评论(1)
[编辑](https://i.cnblogs.com/EditPosts.aspx?postid=15757096)
收藏
举报

刷新页面[返回顶部](#top)

[![](https://img2024.cnblogs.com/blog/35695/202412/35695-20241210184144496-425627414.jpg)](https://www.marscode.cn/?utm_source=advertising&utm_medium=cnblogs.com_ug_cpa&utm_term=hw_marscode_cnblogs&utm_content=home)

### 公告

Copyright © 2025 J0o1ey


