=== Content from github.com_6245e231_20250114_214020.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmario-goulart%2Fawful-salmonella-tar%2Fcommit%2Ff705c881769b7610745cd4b4d8ae8b41b3f4f845)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmario-goulart%2Fawful-salmonella-tar%2Fcommit%2Ff705c881769b7610745cd4b4d8ae8b41b3f4f845)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mario-goulart%2Fawful-salmonella-tar)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mario-goulart](/mario-goulart)
/
**[awful-salmonella-tar](/mario-goulart/awful-salmonella-tar)**
Public

* [Notifications](/login?return_to=%2Fmario-goulart%2Fawful-salmonella-tar) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fmario-goulart%2Fawful-salmonella-tar)
* [Star
   0](/login?return_to=%2Fmario-goulart%2Fawful-salmonella-tar)

* [Code](/mario-goulart/awful-salmonella-tar)
* [Issues
  0](/mario-goulart/awful-salmonella-tar/issues)
* [Pull requests
  0](/mario-goulart/awful-salmonella-tar/pulls)
* [Actions](/mario-goulart/awful-salmonella-tar/actions)
* [Projects
  0](/mario-goulart/awful-salmonella-tar/projects)
* [Wiki](/mario-goulart/awful-salmonella-tar/wiki)
* [Security](/mario-goulart/awful-salmonella-tar/security)
* [Insights](/mario-goulart/awful-salmonella-tar/pulse)

Additional navigation options

* [Code](/mario-goulart/awful-salmonella-tar)
* [Issues](/mario-goulart/awful-salmonella-tar/issues)
* [Pull requests](/mario-goulart/awful-salmonella-tar/pulls)
* [Actions](/mario-goulart/awful-salmonella-tar/actions)
* [Projects](/mario-goulart/awful-salmonella-tar/projects)
* [Wiki](/mario-goulart/awful-salmonella-tar/wiki)
* [Security](/mario-goulart/awful-salmonella-tar/security)
* [Insights](/mario-goulart/awful-salmonella-tar/pulse)

## Commit

[Permalink](/mario-goulart/awful-salmonella-tar/commit/f705c881769b7610745cd4b4d8ae8b41b3f4f845)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix path traversal vulnerability

[Browse files](/mario-goulart/awful-salmonella-tar/tree/f705c881769b7610745cd4b4d8ae8b41b3f4f845)
Browse the repository at this point in the history

```
This change fixes a path traversal vulnerability that would allow
attackers to navigate through the filesystem of the server (provided
execute access to directories for the user running the web server).
Attackers could only list the contents of directories -- not download
files.

The vulnerability was caused by the lack of a check for the validity
requested paths when handling directories, notably when `..%2F' (`../`
URL-encoded) was present in requested paths.

Background:

awful-samonella-tar is implemented using awful [0].  Awful is
implemented on top of spiffy [1], and overrides the
`(handle-not-found)` parameter to map URL paths to procedures.  Spiffy
takes some precautions regarding dealing with malicious paths when it
handles static files.  Code that uses spiffy to implement generation
of dynamic content (like awful does), must take their own precautions.

awful-salmonella-tar uses a procedure (`safe-path?') with a relatively
strict policy to allow access to files, but it was not being used to
validate access to directories, and that was causing the
vulnerability.

This change applies `safe-path?` to all requested paths.

Thanks to Chris Brannon for responsibly reporting this issue.

[0] <https://wiki.call-cc.org/eggref/5/awful>
[1] <https://wiki.call-cc.org/eggref/5/spiffy>
```

* Loading branch information

[![@mario-goulart](https://avatars.githubusercontent.com/u/727221?s=40&v=4)](/mario-goulart)

[mario-goulart](/mario-goulart/awful-salmonella-tar/commits?author=mario-goulart "View all commits by mario-goulart")
committed
Feb 16, 2022

1 parent
[6fb8e3c](/mario-goulart/awful-salmonella-tar/commit/6fb8e3ce8575b33b07a11f686d0315bf24859909)

commit f705c88

Showing
**1 changed file**
with
**28 additions**
and
**24 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

52 changes: 28 additions & 24 deletions

52
[awful-salmonella-tar.scm](#diff-df37e6dbbfc15906530958af263c2a438a8b72ce274085d5d425a683bff93d88 "awful-salmonella-tar.scm")

Show comments

[View file](/mario-goulart/awful-salmonella-tar/blob/f705c881769b7610745cd4b4d8ae8b41b3f4f845/awful-salmonella-tar.scm)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -231,30 +231,34 @@ |
|  |  | (lambda (req-path) |
|  |  | (let ((fs-path (make-pathname (list (root-path) |
|  |  | (salmonella-reports-dir)) |
|  |  | req-path))) |
|  |  | (if (directory? fs-path) |
|  |  | (render-dir req-path fs-path) |
|  |  | (lambda () |
|  |  | (let ((not-found (lambda () |
|  |  | (send-status 'not-found)))) |
|  |  | (handle-exceptions exn |
|  |  | (not-found) |
|  |  | (cond ((equal? (pathname-strip-directory req-path) |
|  |  | (salmonella-report-dir)) |
|  |  | (redirect-to (string-append req-path "/"))) |
|  |  | ((equal? (pathname-strip-directory (string-chomp req-path "/")) |
|  |  | (salmonella-report-dir)) |
|  |  | (cond ((tar-get (make-pathname req-path (index-file))) |
|  |  | => send-file-from-cache) |
|  |  | (else (not-found)))) |
|  |  | ((tar-get req-path) => send-file-from-cache) |
|  |  | (else |
|  |  | (if (file-exists? (make-pathname (list (root-path) |
|  |  | (salmonella-reports-dir)) |
|  |  | req-path)) |
|  |  | (parameterize ((root-path (salmonella-reports-dir))) |
|  |  | (send-file req-path)) |
|  |  | (not-found))))))))))) |
|  |  | req-path)) |
|  |  | (not-found (lambda () |
|  |  | (send-status 'not-found)))) |
|  |  | (cond ((not (safe-path? req-path)) |
|  |  | (lambda () |
|  |  | (not-found))) |
|  |  | ((directory? fs-path) |
|  |  | (render-dir req-path fs-path)) |
|  |  | (else |
|  |  | (lambda () |
|  |  | (handle-exceptions exn |
|  |  | (not-found) |
|  |  | (cond ((equal? (pathname-strip-directory req-path) |
|  |  | (salmonella-report-dir)) |
|  |  | (redirect-to (string-append req-path "/"))) |
|  |  | ((equal? (pathname-strip-directory (string-chomp req-path "/")) |
|  |  | (salmonella-report-dir)) |
|  |  | (cond ((tar-get (make-pathname req-path (index-file))) |
|  |  | => send-file-from-cache) |
|  |  | (else (not-found)))) |
|  |  | ((tar-get req-path) => send-file-from-cache) |
|  |  | (else |
|  |  | (if (file-exists? (make-pathname (list (root-path) |
|  |  | (salmonella-reports-dir)) |
|  |  | req-path)) |
|  |  | (parameterize ((root-path (salmonella-reports-dir))) |
|  |  | (send-file req-path)) |
|  |  | (not-found))))))))))) |
|  |  | ) ;; end define-app |
|  |  | ) ;; end awful-salmonella-tar |
|  |  | ) ;; end module |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f705c88`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmario-goulart%2Fawful-salmonella-tar%2Fcommit%2Ff705c881769b7610745cd4b4d8ae8b41b3f4f845) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from wiki.call-cc.org_e708ab9d_20250114_214021.html ===


* [Wiki](/)
* [Download](//code.call-cc.org/)
* [Manual](/manual/index)
* [Eggs](//eggs.call-cc.org)
* [API](//api.call-cc.org/5/doc/)
* [Tests](//tests.call-cc.org/)
* [Bugs](//bugs.call-cc.org/)

* [show](?action=show)
* [edit](?action=edit)
* [history](?action=history)

* egg

[## awful-salmonella-tar](#awful-salmonella-tar-)

1. [awful-salmonella-tar](#awful-salmonella-tar-)
   1. [Introduction](#introduction)
   2. [Author](#author)
   3. [Repository](#repository)
   4. [License](#license)
   5. [Version history](#version-history)
      1. [Version 0.0.4 (2022-02-17)](#version-004-2022-02-17)
      2. [Version 0.0.3](#version-003)
[### Introduction](#introduction)

This is an [awful](/egg/awful) application to extract [salmonella](/egg/salmonella) report files from tar archives.

It requires tar (tested it with GNU tar, specifically). For compressed report tar files, gzip or bzip2 are required (by default, gzip is used)

To see it working, install awful-salmonella-tar with:

```
 $ chicken-install awful-salmonella-tar
```

Then add some test data:

```
 $ mkdir -p reports/master/gcc/linux/x86-64/2018/09/02/
 $ cd reports/master/gcc/linux/x86-64/2018/09/02/
 $ wget https://salmonella-linux-x86-64.call-cc.org/master/gcc/linux/x86-64/2018/09/02/salmonella.log.bz2
 $ bzip2 -d salmonella.log.bz2
```

You'll need [salmonella-html-report](/egg/salmonella-html-report) to generate report data out of the salmonella log file. If you don't have it installed, chicken-install [salmonella-html-report](/egg/salmonella-html-report)

```
 $ salmonella-html-report salmonella.log salmonella-report
 $ tar czf salmonella-report.tar.gz salmonella-report
 $ rm -rf salmonella-report
 $ cd -
 $ cat <<EOF > awful-salmonella-tar-app.scm
 (cond-expand
 (chicken-4
  (use awful-salmonella-tar))
 (chicken-5
  (import awful-salmonella-tar))
 (else
  (error "Unsupported CHICKEN version.")))

 (awful-salmonella-tar "/")
 EOF
 $ awful awful-salmonella-tar-app.scm
```

Then request, for example http://localhost:8080/reports/master/gcc/linux/x86-64/2018/09/02/salmonella-report/

[### Author](#author)

[Mario Domenech Goulart](/users/mario-domenech-goulart)

[### Repository](#repository)

awful-salmonella-tar is maintained in a [Github repository](https://github.com/mario-goulart/awful-salmonella-tar).

[### License](#license)
```
 Copyright (c) 2011-2020, Mario Domenech Goulart
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions
 are met:
 1. Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.
 2. Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the
    documentation and/or other materials provided with the distribution.
 3. The name of the authors may not be used to endorse or promote products
    derived from this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE AUTHORS ``AS IS'' AND ANY EXPRESS
 OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY
 DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER
 IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
 OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
 IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
```
[### Version history](#version-history)[#### Version 0.0.4 (2022-02-17)](#version-004-2022-02-17)

Fix path traversal vulnerability

This change fixes a path traversal vulnerability that would allow attackers to navigate through the filesystem of the server (provided execute access to directories for the user running the web server). Attackers could only list the contents of directories -- not download files.

The vulnerability was caused by the lack of a check for the validity requested paths when handling directories, notably when ..%2F (../ URL-encoded) was present in requested paths.

Background:

awful-samonella-tar is implemented using [awful](/egg/awful). Awful is implemented on top of [spiffy](/egg/spiffy), and overrides the (handle-not-found) parameter to map URL paths to procedures. Spiffy takes some precautions regarding dealing with malicious paths when it handles static files. Code that uses spiffy to implement generation of dynamic content (like awful does), must take their own precautions.

awful-salmonella-tar uses a procedure (safe-path?) with a relatively strict policy to allow access to files, but it was not being used to validate access to directories, and that was causing the vulnerability.

This change applies safe-path? to all requested paths.

Thanks to Chris Brannon for responsibly reporting this issue.

[#### Version 0.0.3](#version-003)

* Initial release as a CHICKEN egg (2020-11-07)

