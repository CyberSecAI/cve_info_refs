=== Content from www.andreabruschi.net_7f1a3d9c_20250114_192226.html ===

[Skip to content](#content)

[AndyCyberSec](https://www.andreabruschi.net/)

Appunti e writeup di HTB

Ricerca per:

 Menu

* [Homepage](http://www.andreabruschi.net/)
* [Worker](https://www.andreabruschi.net/worker/)
* [Omni](https://www.andreabruschi.net/omni/)
* [Blackfield](https://www.andreabruschi.net/blackfield/)
* [Buff](https://www.andreabruschi.net/buff/)
* [Passage](https://www.andreabruschi.net/?page_id=1266)

[CVE](https://www.andreabruschi.net/category/cve/), [Innovery](https://www.andreabruschi.net/category/innovery/), [Research](https://www.andreabruschi.net/category/research/)
# Bettini S.r.l. â€“ SGSetup Hard-coded SSH private key

 By [Offensive Security Team @ Innovery Group S.p.A.](https://www.andreabruschi.net/author/frapp/)| [Febbraio 17, 2022Maggio 11, 2022](https://www.andreabruschi.net/2022/02/17/bettini-s-r-l-sgsetup-hard-coded-ssh-private-key/)

![](https://www.andreabruschi.net/wp-content/uploads/2022/02/6ouboeur1r3csgmdxlsu.jpg)
### The Issue

The SGSetup software from Bettini S.r.l. is a software which allows to manage and configure the video surveillance system remotely.

It performs the same function as the web interface with the additional possibility of stopping the video stream of the cameras and modifying their configurations.
Upon connecting with the DVR/NVR device, the client initiates an SSH connection in order to download configuration files from the remote device without asking for SSH username and password. Further investigations highlighted the presence of hard-coded private key inside the client itself.

Bettini promptly solved the problem with a new firmware release.

### Who is impacted

GAMS product line devices which use SGSetup

### Affected version

SGSetup prior to v.4.4.0

### Mitigation

Update the firmware.

Do not expose the DVR/NVR SSH and web interface in the internet.

### Exploitation

The devices web interface allows the download of SGSetup tool:

![](https://www.andreabruschi.net/wp-content/uploads/2022/02/setup1-1024x177.jpg)

SGSetup Download #1

![](https://www.andreabruschi.net/wp-content/uploads/2022/02/setup2-1024x369.jpg)

SGSetup Download #2

After a thorough reverse engineering process of the SGSetup software, the Innovery team was able to extract the RSA private key hard-coded inside the software.
The following image from the disassembler is showing all the low-level instructions executed by the software. It can be noted how the software tries to make an SSH connection.

![](https://www.andreabruschi.net/wp-content/uploads/2022/02/ida1-1024x590.jpg)

Disassembler

At this point the software was run with the help of a debugger in order to analyze each single instruction in real time. From the following image it is possible to see how the memory registers were first allocated with the public key and then with the private key, object of interest, used to make the SSH connection:

![](https://www.andreabruschi.net/wp-content/uploads/2022/02/debugger1-1024x610.jpg)

Public Key

![](https://www.andreabruschi.net/wp-content/uploads/2022/02/debugger2-1024x616.jpg)

Private Key

The extracted key has been recomposed and formatted to be used to connect to the DVR as root user:

![](https://www.andreabruschi.net/wp-content/uploads/2022/02/ssh_cen-1024x112.jpg)

SSH Connection

### The Team

* Antonio Fiorito
* Andrea Bruschi
* Francesco Petri
* Salvatore Volpes
* Jull Mendoza
* Fabio Villa
* Federico Zambito
* Gabriele Turcan

 [binary](https://www.andreabruschi.net/tag/binary/), [CVE](https://www.andreabruschi.net/tag/cve/), [debugger](https://www.andreabruschi.net/tag/debugger/), [hardcoded](https://www.andreabruschi.net/tag/hardcoded/), [ida](https://www.andreabruschi.net/tag/ida/), [key](https://www.andreabruschi.net/tag/key/), [research](https://www.andreabruschi.net/tag/research/), [rsa](https://www.andreabruschi.net/tag/rsa/), [ssh](https://www.andreabruschi.net/tag/ssh/)

## Navigazione articoli

[Kerberos Constrained Delegation](https://www.andreabruschi.net/2021/01/04/kerberos-constrained-delegation/)[How to run notepad.exe with Powershell](https://www.andreabruschi.net/2022/02/28/how-to-run-notepad-exe-with-powershell/)

[Proudly powered by WordPress](https://wordpress.org/)
 |
Theme: Kota


