=== Content from github.com_b9b5a305_20250114_195118.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstealjs%2Fsteal%2Fblob%2Fc9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9%2Fext%2Fnpm-convert.js)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstealjs%2Fsteal%2Fblob%2Fc9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9%2Fext%2Fnpm-convert.js)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=stealjs%2Fsteal)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[stealjs](/stealjs)
/
**[steal](/stealjs/steal)**
Public

* [Notifications](/login?return_to=%2Fstealjs%2Fsteal) You must be signed in to change notification settings
* [Fork
  522](/login?return_to=%2Fstealjs%2Fsteal)
* [Star
   1.4k](/login?return_to=%2Fstealjs%2Fsteal)

* [Code](/stealjs/steal)
* [Issues
  95](/stealjs/steal/issues)
* [Pull requests
  2](/stealjs/steal/pulls)
* [Actions](/stealjs/steal/actions)
* [Projects
  0](/stealjs/steal/projects)
* [Wiki](/stealjs/steal/wiki)
* [Security](/stealjs/steal/security)
* [Insights](/stealjs/steal/pulse)

Additional navigation options

* [Code](/stealjs/steal)
* [Issues](/stealjs/steal/issues)
* [Pull requests](/stealjs/steal/pulls)
* [Actions](/stealjs/steal/actions)
* [Projects](/stealjs/steal/projects)
* [Wiki](/stealjs/steal/wiki)
* [Security](/stealjs/steal/security)
* [Insights](/stealjs/steal/pulse)

## Files

 c9dd1eb
## Breadcrumbs

1. [steal](/stealjs/steal/tree/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9)
2. /[ext](/stealjs/steal/tree/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9/ext)
/
# npm-convert.js

Copy path Blame  Blame
## Latest commit

## History

[History](/stealjs/steal/commits/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9/ext/npm-convert.js)406 lines (369 loc) · 10.9 KB c9dd1eb
## Breadcrumbs

1. [steal](/stealjs/steal/tree/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9)
2. /[ext](/stealjs/steal/tree/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9/ext)
/
# npm-convert.js

Top
## File metadata and controls

* Code
* Blame

406 lines (369 loc) · 10.9 KB[Raw](https://github.com/stealjs/steal/raw/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9/ext/npm-convert.js)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406"format cjs";
var crawl = require('./npm-crawl');var utils = require("./npm-utils");
exports.steal = convertSteal;exports.propertyNames = convertPropertyNames;exports.propertyNamesAndValues = convertPropertyNamesAndValues;exports.name = convertName;exports.browser = convertBrowser;exports.browserProperty = convertBrowserProperty;exports.jspm = convertJspm;exports.toPackage = convertToPackage;exports.forPackage = convertForPackage;
function StealConversion(context, pkg, steal, config, isRoot, waiting) { this.context = context; this.pkg = pkg; this.steal = steal; this.config = utils.extend({}, steal, true); this.isRoot = isRoot; this.waiting = [];}
// Translate helpers ===============// Given all the package.json data, these helpers help convert it to a source.function convertSteal(context, pkg, steal, root, ignoreWaiting, resavePackageInfo) { if(!steal) { return new StealConversion(context, pkg, steal, root); }
 var conv = new StealConversion(context, pkg, steal, root); var waiting = conv.waiting;
 if(steal.meta) { steal.meta = convertPropertyNames(context, pkg, steal.meta, root, waiting); } if(steal.map) { steal.map = convertPropertyNamesAndValues(context, pkg, steal.map, root, waiting); } if(steal.paths) { steal.paths = convertPropertyNames(context, pkg, steal.paths, root, waiting); } // needed for builds if(steal.buildConfig) { var buildConv = convertSteal(context, pkg, steal.buildConfig, root); conv.buildConversion = buildConv;
 steal.buildConfig = conv.config; }
 return conv;}
var lazyConfig = { // Queue package reconfiguration whenever a package is first loaded. // This is for progressively loaded package.jsons updateConfigOnPackageLoad: function(conv, isPackageInfoSaved, isConfigApplied, isBuildConfigApplied) { var fns = [function(){return lazyConfig.cloneConversion.call(this, conv)}]; if(isPackageInfoSaved) { fns.push(lazyConfig.resavePackageInfo); } if(isConfigApplied) { fns.push(lazyConfig.applyConfig); } var fn = utils.flow(fns);
 convertLater(conv.context, conv.waiting, fn);
 if(isBuildConfigApplied && conv.buildConversion) { var c = conv.buildConversion; fn = utils.flow([ function(){return lazyConfig.cloneConversion.call(this, c)}, lazyConfig.resavePackageInfo, lazyConfig.applyConfig ]); convertLater(c.context, c.waiting, fn); } }, resavePackageInfo: function(conv) { var info = utils.pkg.findPackageInfo(conv.context, conv.pkg); info.steal = info.system = conv.steal; return conv; }, applyConfig: function(conv) { var config = conv.steal; var context = this;
 // Temporarily remove steal.main so that it doesn't set System.main var stealMain = config.main; delete config.main; delete config.transpiler; context.loader.config(config); config.main = stealMain; return conv; }, cloneConversion: function(conv) { var context = this; var local = utils.extend({}, conv.config, true); var lConv = convertSteal(context, conv.pkg, local, conv.isRoot); return lConv; }};
exports.updateConfigOnPackageLoad = lazyConfig.updateConfigOnPackageLoad;
// converts only the property namefunction convertPropertyNames (context, pkg, map , root, waiting) { if(!map) { return map; } var clone = {}, value; for(var property in map ) { value = convertName(context, pkg, map, root, property, waiting); if(typeof value === 'string') { clone[value] = map[property]; }
 // do root paths b/c we don't know if they are going to be included with the package name or not. if(root) { value = convertName(context, pkg, map, false, property, waiting); if(typeof value === 'string') { clone[value] = map[property]; } } } return clone;}
// converts both property name and valuefunction convertPropertyNamesAndValues (context, pkg, map, root, waiting) { if(!map) { return map; } var clone = {}, val, name; for(var property in map ) { val = map[property]; name = convertName(context, pkg, map, root, property, waiting); val = typeof val === "object" ? convertPropertyNamesAndValues(context, pkg, val, root, waiting) : convertName(context, pkg, map, root, val, waiting); if(typeof name !== 'undefined' && typeof val !== 'undefined') { clone[name] = val; } // keep map entry if the key isn't a package but value might if (name && typeof val === "undefined") { clone[name] = map[property]; } } return clone;}
function convertName (context, pkg, map, root, name, waiting) { var parsed = utils.moduleName.parse(name, pkg.name, null, context), depPkg, requestedVersion; if( name.indexOf("#") >= 0 ) { // If this is a fully converted name just return the name. if(utils.moduleName.isFullyConvertedNpm(parsed)) { return name; }
 if(parsed.packageName === pkg.name) { parsed.version = pkg.version; } else { // Get the requested version's actual version. requestedVersion = crawl.getDependencyMap(context.loader, pkg, root)[parsed.packageName].version; depPkg = crawl.matchedVersion(context, parsed.packageName, requestedVersion); // This hasn't been crawled yet, so convert later if(!depPkg) { waiting.push({ packageName: parsed.packageName, requestedVersion: requestedVersion }); return; } parsed.version = depPkg.version; } return utils.moduleName.create(parsed);
 } else { if(root && name.substr(0,2) === "./" ) { return name.substr(2); } else { // this is for a module within the package if (name.substr(0,2) === "./" ) { return utils.moduleName.create({ packageName: pkg.name, modulePath: name, version: pkg.version, plugin: parsed.plugin }); } else { // SYSTEM.NAME if( pkg.name === parsed.packageName || ( (pkg.system && pkg.system.name) === parsed.packageName) ) { depPkg = pkg; } else { var requestedProject = crawl.getDependencyMap(context.loader, pkg, root)[parsed.packageName]; if(!requestedProject) { return name; } requestedVersion = requestedProject.version; depPkg = crawl.matchedVersion(context, parsed.packageName, requestedVersion); // If we still didn't find one just use the first available version. if(!depPkg) { var versions = context.versions[parsed.packageName]; depPkg = versions && versions[requestedVersion];
 if(!depPkg) { waiting.push({ packageName: parsed.packageName, requestedVersion: requestedVersion }); return; } } } // SYSTEM.NAME if(depPkg.system && depPkg.system.name) { parsed.packageName = depPkg.system.name; }
 parsed.version = depPkg.version; if(!parsed.modulePath) { parsed.modulePath = utils.pkg.main(depPkg); } return utils.moduleName.create(parsed); }
 }
 }}
/\*\* \* Converts browser names into actual module names. \* \* Example: \* \* ``` \* { \* "foo": "browser-foo" \* "traceur#src/node/traceur": "./browser/traceur" \* "./foo" : "./foo-browser" \* } \* ``` \* \* converted to: \* \* ``` \* { \* // any foo ... regardless of where \* "foo": "browser-foo" \* // this module ... ideally minus version \* "traceur#src/node/traceur": "transpile#./browser/traceur" \* "transpile#./foo" : "transpile#./foo-browser" \* } \* ``` \*/function convertBrowser(pkg, browser) { var type = typeof browser; if(type === "string" || type === "undefined") { return browser; } var map = {}; for(var fromName in browser) { convertBrowserProperty(map, pkg, fromName, browser[fromName]); } return map;}
function convertBrowserProperty(map, pkg, fromName, toName) { var packageName = pkg.name;
 var fromParsed = utils.moduleName.parse(fromName, packageName); var toResult = toName;
 if(!toName || typeof toName === "string") { var toParsed = toName ? utils.moduleName.parse(toName, packageName) : "@empty"; toResult = utils.moduleName.create(toParsed); } else if(utils.isArray(toName)) { toResult = toName; }
 map[utils.moduleName.create(fromParsed)] = toResult;}
function convertJspm(pkg, jspm){ var type = typeof jspm; if(type === "undefined" || type === "string") { return jspm; } return { main: jspm.main };}
function convertToPackage(context, npmPkg, index) { var pkg = npmPkg; var packages = context.pkgInfo; var nameAndVersion = pkg.name+"@"+pkg.version; var localPkg; if(!packages[nameAndVersion]) { crawl.setVersionsConfig(context, pkg, pkg.version); if(pkg.browser){ delete pkg.browser.transform; } // fake load obj, because we don't have one here pkg = utils.json.transform(context.loader, { address: pkg.fileUrl, name: pkg.fileUrl.split('/').pop(), metadata: {} }, pkg); var steal = utils.pkg.config(pkg); var stealConversion = convertSteal(context, pkg, steal, index === 0); lazyConfig.updateConfigOnPackageLoad(stealConversion, context.resavePackageInfo, true, context.applyBuildConfig);
 localPkg = { name: pkg.name, version: pkg.version, fileUrl: utils.path.isRelative(pkg.fileUrl) ? pkg.fileUrl : utils.relativeURI(context.loader.baseURL, pkg.fileUrl), main: pkg.main, steal: stealConversion.steal, globalBrowser: convertBrowser(pkg, pkg.globalBrowser), browser: convertBrowser(pkg, pkg.browser || pkg.browserify), jspm: convertJspm(pkg, pkg.jspm), jam: convertJspm(pkg, pkg.jam), resolutions: {} }; packages.push(localPkg); packages[nameAndVersion] = true; } else { localPkg = utils.filter(packages, function(lpkg){ if(pkg.name === lpkg.name && pkg.version === lpkg.version) { return lpkg; } })[0]; } return localPkg;}
/\*\* \* waiting looks like: \* \* [ \* { packageName: 'can', requestedVersion: '^2.3.0' }, \* { packageName: 'lodash': 'requestedVersion': '~3.0.0' } \* ] \* \* Pushes these objects into a side table. Whenver a package.json is loaded \* it will convert and apply config. \*/function convertLater(context, waiting, fn) { utils.forEach(waiting, function(p){ var packageName = p.packageName; var requestedVersion = p.requestedVersion;
 var conv = context.deferredConversions; var pkg = conv[packageName]; if(!pkg) pkg = conv[packageName] = {}; var vers = pkg[requestedVersion]; if(!vers) vers = pkg[requestedVersion] = []; vers.push(fn); });}
/\*\* \* When progressively loading package.jsons we need to convert any config \* that is waiting on a package.json to load. This function is called after \* a package is loaded and will call all of the callbacks that cause the \* config to be applied. \*/function convertForPackage(context, pkg) { var name = pkg.name; var version = pkg.version;
 var conv = context.deferredConversions; var pkgConv = conv[name]; var depPkg, fns, keys = 0; if(pkgConv) { for(var range in pkgConv) { depPkg = crawl.matchedVersion(context, name, range); if(depPkg) { fns = pkgConv[range]; for(var i = 0, len = fns.length; i < len; i++) { fns[i].call(context); } delete pkgConv[range]; } else { keys++; } } if(keys === 0) { delete conv[name]; } }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_733e3c66_20250114_195121.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstealjs%2Fsteal%2Fissues%2F1527)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstealjs%2Fsteal%2Fissues%2F1527)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=stealjs%2Fsteal)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[stealjs](/stealjs)
/
**[steal](/stealjs/steal)**
Public

* [Notifications](/login?return_to=%2Fstealjs%2Fsteal) You must be signed in to change notification settings
* [Fork
  522](/login?return_to=%2Fstealjs%2Fsteal)
* [Star
   1.4k](/login?return_to=%2Fstealjs%2Fsteal)

* [Code](/stealjs/steal)
* [Issues
  95](/stealjs/steal/issues)
* [Pull requests
  2](/stealjs/steal/pulls)
* [Actions](/stealjs/steal/actions)
* [Projects
  0](/stealjs/steal/projects)
* [Wiki](/stealjs/steal/wiki)
* [Security](/stealjs/steal/security)
* [Insights](/stealjs/steal/pulse)

Additional navigation options

* [Code](/stealjs/steal)
* [Issues](/stealjs/steal/issues)
* [Pull requests](/stealjs/steal/pulls)
* [Actions](/stealjs/steal/actions)
* [Projects](/stealjs/steal/projects)
* [Wiki](/stealjs/steal/wiki)
* [Security](/stealjs/steal/security)
* [Insights](/stealjs/steal/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fstealjs%2Fsteal%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fstealjs%2Fsteal%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [CVE-2022-37258]/Prototype pollution found in npm-convert.js #1527

Open

[secdevlpr26](/secdevlpr26) opened this issue
Sep 14, 2022
· 0 comments

Open

# [[CVE-2022-37258]/Prototype pollution found in npm-convert.js](#top) #1527

[secdevlpr26](/secdevlpr26) opened this issue
Sep 14, 2022
· 0 comments

## Comments

[![@secdevlpr26](https://avatars.githubusercontent.com/u/31366114?s=80&v=4)](/secdevlpr26)

Copy link

### **[secdevlpr26](/secdevlpr26)** commented [Sep 14, 2022](#issue-1372641337)

| Prototype pollution vulnerability in function convertLater in npm-convert.js in stealjs steal 2.2.4 via the packageName variable in npm-convert.js.  The prototype pollution vulnerability can be mitigated with several best practices described here: <https://learn.snyk.io/lessons/prototype-pollution/javascript/> |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fstealjs%2Fsteal%2Fissues%2F1527)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

1 participant

[![@secdevlpr26](https://avatars.githubusercontent.com/u/31366114?s=52&v=4)](/secdevlpr26)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9033878b_20250114_195120.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstealjs%2Fsteal%2Fblob%2Fc9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9%2Fext%2Fnpm-convert.js)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fstealjs%2Fsteal%2Fblob%2Fc9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9%2Fext%2Fnpm-convert.js)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=stealjs%2Fsteal)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[stealjs](/stealjs)
/
**[steal](/stealjs/steal)**
Public

* [Notifications](/login?return_to=%2Fstealjs%2Fsteal) You must be signed in to change notification settings
* [Fork
  522](/login?return_to=%2Fstealjs%2Fsteal)
* [Star
   1.4k](/login?return_to=%2Fstealjs%2Fsteal)

* [Code](/stealjs/steal)
* [Issues
  95](/stealjs/steal/issues)
* [Pull requests
  2](/stealjs/steal/pulls)
* [Actions](/stealjs/steal/actions)
* [Projects
  0](/stealjs/steal/projects)
* [Wiki](/stealjs/steal/wiki)
* [Security](/stealjs/steal/security)
* [Insights](/stealjs/steal/pulse)

Additional navigation options

* [Code](/stealjs/steal)
* [Issues](/stealjs/steal/issues)
* [Pull requests](/stealjs/steal/pulls)
* [Actions](/stealjs/steal/actions)
* [Projects](/stealjs/steal/projects)
* [Wiki](/stealjs/steal/wiki)
* [Security](/stealjs/steal/security)
* [Insights](/stealjs/steal/pulse)

## Files

 c9dd1eb
## Breadcrumbs

1. [steal](/stealjs/steal/tree/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9)
2. /[ext](/stealjs/steal/tree/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9/ext)
/
# npm-convert.js

Copy path Blame  Blame
## Latest commit

## History

[History](/stealjs/steal/commits/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9/ext/npm-convert.js)406 lines (369 loc) · 10.9 KB c9dd1eb
## Breadcrumbs

1. [steal](/stealjs/steal/tree/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9)
2. /[ext](/stealjs/steal/tree/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9/ext)
/
# npm-convert.js

Top
## File metadata and controls

* Code
* Blame

406 lines (369 loc) · 10.9 KB[Raw](https://github.com/stealjs/steal/raw/c9dd1eb19ed3f97aeb93cf9dcea5d68ad5d0ced9/ext/npm-convert.js)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406"format cjs";
var crawl = require('./npm-crawl');var utils = require("./npm-utils");
exports.steal = convertSteal;exports.propertyNames = convertPropertyNames;exports.propertyNamesAndValues = convertPropertyNamesAndValues;exports.name = convertName;exports.browser = convertBrowser;exports.browserProperty = convertBrowserProperty;exports.jspm = convertJspm;exports.toPackage = convertToPackage;exports.forPackage = convertForPackage;
function StealConversion(context, pkg, steal, config, isRoot, waiting) { this.context = context; this.pkg = pkg; this.steal = steal; this.config = utils.extend({}, steal, true); this.isRoot = isRoot; this.waiting = [];}
// Translate helpers ===============// Given all the package.json data, these helpers help convert it to a source.function convertSteal(context, pkg, steal, root, ignoreWaiting, resavePackageInfo) { if(!steal) { return new StealConversion(context, pkg, steal, root); }
 var conv = new StealConversion(context, pkg, steal, root); var waiting = conv.waiting;
 if(steal.meta) { steal.meta = convertPropertyNames(context, pkg, steal.meta, root, waiting); } if(steal.map) { steal.map = convertPropertyNamesAndValues(context, pkg, steal.map, root, waiting); } if(steal.paths) { steal.paths = convertPropertyNames(context, pkg, steal.paths, root, waiting); } // needed for builds if(steal.buildConfig) { var buildConv = convertSteal(context, pkg, steal.buildConfig, root); conv.buildConversion = buildConv;
 steal.buildConfig = conv.config; }
 return conv;}
var lazyConfig = { // Queue package reconfiguration whenever a package is first loaded. // This is for progressively loaded package.jsons updateConfigOnPackageLoad: function(conv, isPackageInfoSaved, isConfigApplied, isBuildConfigApplied) { var fns = [function(){return lazyConfig.cloneConversion.call(this, conv)}]; if(isPackageInfoSaved) { fns.push(lazyConfig.resavePackageInfo); } if(isConfigApplied) { fns.push(lazyConfig.applyConfig); } var fn = utils.flow(fns);
 convertLater(conv.context, conv.waiting, fn);
 if(isBuildConfigApplied && conv.buildConversion) { var c = conv.buildConversion; fn = utils.flow([ function(){return lazyConfig.cloneConversion.call(this, c)}, lazyConfig.resavePackageInfo, lazyConfig.applyConfig ]); convertLater(c.context, c.waiting, fn); } }, resavePackageInfo: function(conv) { var info = utils.pkg.findPackageInfo(conv.context, conv.pkg); info.steal = info.system = conv.steal; return conv; }, applyConfig: function(conv) { var config = conv.steal; var context = this;
 // Temporarily remove steal.main so that it doesn't set System.main var stealMain = config.main; delete config.main; delete config.transpiler; context.loader.config(config); config.main = stealMain; return conv; }, cloneConversion: function(conv) { var context = this; var local = utils.extend({}, conv.config, true); var lConv = convertSteal(context, conv.pkg, local, conv.isRoot); return lConv; }};
exports.updateConfigOnPackageLoad = lazyConfig.updateConfigOnPackageLoad;
// converts only the property namefunction convertPropertyNames (context, pkg, map , root, waiting) { if(!map) { return map; } var clone = {}, value; for(var property in map ) { value = convertName(context, pkg, map, root, property, waiting); if(typeof value === 'string') { clone[value] = map[property]; }
 // do root paths b/c we don't know if they are going to be included with the package name or not. if(root) { value = convertName(context, pkg, map, false, property, waiting); if(typeof value === 'string') { clone[value] = map[property]; } } } return clone;}
// converts both property name and valuefunction convertPropertyNamesAndValues (context, pkg, map, root, waiting) { if(!map) { return map; } var clone = {}, val, name; for(var property in map ) { val = map[property]; name = convertName(context, pkg, map, root, property, waiting); val = typeof val === "object" ? convertPropertyNamesAndValues(context, pkg, val, root, waiting) : convertName(context, pkg, map, root, val, waiting); if(typeof name !== 'undefined' && typeof val !== 'undefined') { clone[name] = val; } // keep map entry if the key isn't a package but value might if (name && typeof val === "undefined") { clone[name] = map[property]; } } return clone;}
function convertName (context, pkg, map, root, name, waiting) { var parsed = utils.moduleName.parse(name, pkg.name, null, context), depPkg, requestedVersion; if( name.indexOf("#") >= 0 ) { // If this is a fully converted name just return the name. if(utils.moduleName.isFullyConvertedNpm(parsed)) { return name; }
 if(parsed.packageName === pkg.name) { parsed.version = pkg.version; } else { // Get the requested version's actual version. requestedVersion = crawl.getDependencyMap(context.loader, pkg, root)[parsed.packageName].version; depPkg = crawl.matchedVersion(context, parsed.packageName, requestedVersion); // This hasn't been crawled yet, so convert later if(!depPkg) { waiting.push({ packageName: parsed.packageName, requestedVersion: requestedVersion }); return; } parsed.version = depPkg.version; } return utils.moduleName.create(parsed);
 } else { if(root && name.substr(0,2) === "./" ) { return name.substr(2); } else { // this is for a module within the package if (name.substr(0,2) === "./" ) { return utils.moduleName.create({ packageName: pkg.name, modulePath: name, version: pkg.version, plugin: parsed.plugin }); } else { // SYSTEM.NAME if( pkg.name === parsed.packageName || ( (pkg.system && pkg.system.name) === parsed.packageName) ) { depPkg = pkg; } else { var requestedProject = crawl.getDependencyMap(context.loader, pkg, root)[parsed.packageName]; if(!requestedProject) { return name; } requestedVersion = requestedProject.version; depPkg = crawl.matchedVersion(context, parsed.packageName, requestedVersion); // If we still didn't find one just use the first available version. if(!depPkg) { var versions = context.versions[parsed.packageName]; depPkg = versions && versions[requestedVersion];
 if(!depPkg) { waiting.push({ packageName: parsed.packageName, requestedVersion: requestedVersion }); return; } } } // SYSTEM.NAME if(depPkg.system && depPkg.system.name) { parsed.packageName = depPkg.system.name; }
 parsed.version = depPkg.version; if(!parsed.modulePath) { parsed.modulePath = utils.pkg.main(depPkg); } return utils.moduleName.create(parsed); }
 }
 }}
/\*\* \* Converts browser names into actual module names. \* \* Example: \* \* ``` \* { \* "foo": "browser-foo" \* "traceur#src/node/traceur": "./browser/traceur" \* "./foo" : "./foo-browser" \* } \* ``` \* \* converted to: \* \* ``` \* { \* // any foo ... regardless of where \* "foo": "browser-foo" \* // this module ... ideally minus version \* "traceur#src/node/traceur": "transpile#./browser/traceur" \* "transpile#./foo" : "transpile#./foo-browser" \* } \* ``` \*/function convertBrowser(pkg, browser) { var type = typeof browser; if(type === "string" || type === "undefined") { return browser; } var map = {}; for(var fromName in browser) { convertBrowserProperty(map, pkg, fromName, browser[fromName]); } return map;}
function convertBrowserProperty(map, pkg, fromName, toName) { var packageName = pkg.name;
 var fromParsed = utils.moduleName.parse(fromName, packageName); var toResult = toName;
 if(!toName || typeof toName === "string") { var toParsed = toName ? utils.moduleName.parse(toName, packageName) : "@empty"; toResult = utils.moduleName.create(toParsed); } else if(utils.isArray(toName)) { toResult = toName; }
 map[utils.moduleName.create(fromParsed)] = toResult;}
function convertJspm(pkg, jspm){ var type = typeof jspm; if(type === "undefined" || type === "string") { return jspm; } return { main: jspm.main };}
function convertToPackage(context, npmPkg, index) { var pkg = npmPkg; var packages = context.pkgInfo; var nameAndVersion = pkg.name+"@"+pkg.version; var localPkg; if(!packages[nameAndVersion]) { crawl.setVersionsConfig(context, pkg, pkg.version); if(pkg.browser){ delete pkg.browser.transform; } // fake load obj, because we don't have one here pkg = utils.json.transform(context.loader, { address: pkg.fileUrl, name: pkg.fileUrl.split('/').pop(), metadata: {} }, pkg); var steal = utils.pkg.config(pkg); var stealConversion = convertSteal(context, pkg, steal, index === 0); lazyConfig.updateConfigOnPackageLoad(stealConversion, context.resavePackageInfo, true, context.applyBuildConfig);
 localPkg = { name: pkg.name, version: pkg.version, fileUrl: utils.path.isRelative(pkg.fileUrl) ? pkg.fileUrl : utils.relativeURI(context.loader.baseURL, pkg.fileUrl), main: pkg.main, steal: stealConversion.steal, globalBrowser: convertBrowser(pkg, pkg.globalBrowser), browser: convertBrowser(pkg, pkg.browser || pkg.browserify), jspm: convertJspm(pkg, pkg.jspm), jam: convertJspm(pkg, pkg.jam), resolutions: {} }; packages.push(localPkg); packages[nameAndVersion] = true; } else { localPkg = utils.filter(packages, function(lpkg){ if(pkg.name === lpkg.name && pkg.version === lpkg.version) { return lpkg; } })[0]; } return localPkg;}
/\*\* \* waiting looks like: \* \* [ \* { packageName: 'can', requestedVersion: '^2.3.0' }, \* { packageName: 'lodash': 'requestedVersion': '~3.0.0' } \* ] \* \* Pushes these objects into a side table. Whenver a package.json is loaded \* it will convert and apply config. \*/function convertLater(context, waiting, fn) { utils.forEach(waiting, function(p){ var packageName = p.packageName; var requestedVersion = p.requestedVersion;
 var conv = context.deferredConversions; var pkg = conv[packageName]; if(!pkg) pkg = conv[packageName] = {}; var vers = pkg[requestedVersion]; if(!vers) vers = pkg[requestedVersion] = []; vers.push(fn); });}
/\*\* \* When progressively loading package.jsons we need to convert any config \* that is waiting on a package.json to load. This function is called after \* a package is loaded and will call all of the callbacks that cause the \* config to be applied. \*/function convertForPackage(context, pkg) { var name = pkg.name; var version = pkg.version;
 var conv = context.deferredConversions; var pkgConv = conv[name]; var depPkg, fns, keys = 0; if(pkgConv) { for(var range in pkgConv) { depPkg = crawl.matchedVersion(context, name, range); if(depPkg) { fns = pkgConv[range]; for(var i = 0, len = fns.length; i < len; i++) { fns[i].call(context); } delete pkgConv[range]; } else { keys++; } } if(keys === 0) { delete conv[name]; } }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


