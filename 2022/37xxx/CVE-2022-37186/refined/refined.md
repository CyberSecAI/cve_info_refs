Based on the provided information, here's an analysis of CVE-2022-37186:

**Root Cause of Vulnerability:**

The vulnerability stems from a failure to properly propagate session destruction from the portal to the handlers in LemonLDAP::NG. When the "One session per user" option is enabled, logging in a second time with the same account correctly destroys the first session on the portal. However, handlers continue to recognize the old session as valid, even after the session cache expiration time, until the session's inactivity timeout is reached. This is because the handlers do not immediately recognize when a session has been invalidated at the portal level.

**Weaknesses/Vulnerabilities Present:**

*   **Session Invalidation Propagation Failure:** The core weakness is the lack of immediate propagation of session invalidation from the portal to the handlers. This allows stale sessions to remain active on handlers, even when the user has logged out or started a new session from the portal.
*  **Incorrect Session Handling:** The handler's session timeout mechanism relies on inactivity rather than the session's overall validity as defined by the portal.

**Impact of Exploitation:**

*   **Impersonation:** An attacker who has access to a valid session on a handler (after the session has been destroyed on portal) can continue to use the invalidated session, potentially gaining unauthorized access to resources. This constitutes an impersonation vulnerability.
* **Information disclosure**: This can lead to unauthorized access to sensitive information because the handler is still acting as if the destroyed session is still valid.

**Attack Vectors:**

*   **Multiple Login:** An attacker can log in multiple times with the same account to trigger the session invalidation on the portal, and then try to reuse a still-valid session on the handler.
* **Time-based Attack:** Since the handler session expires only after its inactivity timer, a user who logs out on the portal could have their old session misused on a handler if accessed before the inactivity timer expires.

**Required Attacker Capabilities/Position:**

*   **Valid User Credentials:** The attacker needs valid credentials for a user in the system.
*   **Access to LemonLDAP::NG Environment:** The attacker needs to be able to interact with the LemonLDAP::NG setup, particularly the portal and handlers, either directly or indirectly.
*   **Timing:** The attacker needs to exploit the time window between the session destruction on the portal and the eventual expiration of the session in the handler.

**Additional Details:**

*   The issue is related to the "One session per user" option in LemonLDAP::NG.
*   The default session expiry on handlers appears to be based on inactivity, while the session invalidation is controlled by the portal on new login.
*   The issue is present at least in version 2.0.13 of LemonLDAP::NG.
*   A commit `59c781b3` aims to improve session destroy propagation, indicating a fix has been developed.

In summary, CVE-2022-37186 arises from inconsistent session handling between the portal and handlers, leading to a vulnerability where destroyed sessions remain valid on handlers, resulting in potential impersonation and unauthorized access.