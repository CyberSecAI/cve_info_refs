=== Content from matrix.org_b745038c_20250114_191103.html ===

[![Matrix logo](/images/matrix-logo-white.svg)](/)



[Spec](https://spec.matrix.org)

Foundation

[About Matrix](/foundation/about/)
[Governing Board Elections 2024](/foundation/governing-board-elections/)

[Blog](/blog/)
[Docs](/docs/)

Ecosystem

[Clients](/ecosystem/clients/)
[Bridges](/ecosystem/bridges/)
[Servers](/ecosystem/servers/)
[Integrations](/ecosystem/integrations/)
[SDKs](/ecosystem/sdks/)
[Hosting](/ecosystem/hosting/)

[Donate](/support)
[Try Matrix](/try-matrix/)

# Upgrade now to address E2EE vulnerabilities in matrix-js-sdk, matrix-ios-sdk and matrix-android-sdk2

28.09.2022 17:41
—
[Security](/category/security)
—
[Matthew Hodgson](/author/matthew-hodgson),
[Denis Kasak](/author/denis-kasak),
[Matrix Cryptography Team](/author/matrix-cryptography-team),
[Matrix Security Team](/author/matrix-security-team)

**TL;DR:**

* Two critical severity vulnerabilities in end-to-end encryption were found in
  the SDKs which power Element, Beeper, Cinny, SchildiChat, Circuli, Synod.im
  and any other clients based on matrix-js-sdk, matrix-ios-sdk or
  matrix-android-sdk2.
* These have now been fixed, and we have not seen evidence of them being
  exploited in the wild. All of the critical vulnerabilities require
  cooperation from a malicious homeserver to be exploited.
* **Please upgrade immediately in order to be protected against these
  vulnerabilities.**
* Clients with other encryption implementations (including Hydrogen, ElementX,
  Nheko, FluffyChat, Syphon, Timmy, Gomuks and Pantalaimon) are not affected;
  **this is not a protocol bug**.
* We take the security of our end-to-end encryption extremely seriously, and we
  have an ongoing series of public independent audits booked to help guard
  against future vulnerabilities. We will also be making some protocol changes
  in the future to provide additional layers of protection.
* This resolves the [pre-disclosure](https://matrix.org/blog/2022/09/23/pre-disclosure-upcoming-critical-security-release-of-matrix-sd-ks-and-clients) issued on September 23rd.

Hi all,

Recently we have been hard at work investigating some subtle security
vulnerabilities in certain implementations of Matrix's end-to-end encryption
which were responsibly disclosed to us by researchers at Royal Holloway
University London, University of Sheffield and Brave Software. Two of these
vulnerabilities are critical severity, in that they could allow malicious
server admins to attack their users, and are implementation bugs in clients
using matrix-js-sdk (e.g. Element Web) or implementations derived from
matrix-js-sdk, rather than protocol flaws. matrix-rust-sdk (and other 2nd/3rd
generation SDKs) are not affected by these. These vulnerabilities are fixed in
today's release, and we are not aware of them having been exploited in the
wild.

**If you're using Element or an application that shares the same SDKs (Beeper,
Cinny, SchildiChat, Circuli, Synod.im) then please upgrade now. Do not perform
verification with new devices until you have upgraded.**

We'd like to thank the security researchers for investing significant time and
effort into doing a deep dive to find these issues, and thus contributing
materially to making Matrix more secure for the whole ecosystem. Despite our
best efforts, there is always a risk of security issues in software, and we're
very glad to have identified and fixed these issues while also taking the
opportunity to improve our vulnerability disclosure and coordinated upgrade
process.

Please note that the critical severity issues are implementation issues in
matrix-js-sdk and derivatives, and are **not** protocol issues in Matrix. The
latest version of the researchers' paper that we've seen incorrectly presents
Element as 'the reference Matrix client', and confuses the higher severity
implementation bugs with lower severity protocol critique. This is very
unfortunate, given Hydrogen, ElementX, Nheko, FluffyChat, Syphon, Timmy, Gomuks
and Pantalaimon and other independent implementations are not affected. In
fact, every client independently implemented using the Matrix spec seems to
have got it right, which speaks well of the protocol. It's only the first
generation SDK (predating the spec) and its derivatives which had these bugs.

The two critical severity issues lead to three attack scenarios, all of which
are prevented by today's releases:

* "*Key/Device Identifier Confusion in SAS Verification*" – A bug existed in
  matrix-js-sdk where it confused together device IDs and cross-signing keys
  (given under the hood, cross-signing keys are represented as devices). This
  could be exploited by a malicious server admin to break emoji-based
  verification when cross-signing is in use, authenticating themselves rather
  than the target user being verified. This bug is only present in
  matrix-js-sdk (not iOS or Android SDKs), tracked as a critical severity CVE:
  CVE-2022-39250.
* "*Trusted Impersonation*" – matrix-js-sdk (and derived SDKs) suffered from
  a protocol-confusion bug where it would incorrectly accept to-device messages
  encrypted by Megolm rather than Olm, attributing them to the Megolm sender
  rather than the actual sender. As a result, an attacker could fake the
  trusted sender of to-device messages, allowing them to send fake to-device
  messages to devices - e.g. fake keys to spoof historical messages from other
  users. This bug is tracked as a critical severity CVE: CVE-2022-39251
  (matrix-js-sdk), CVE-2022-39255 (matrix-ios-sdk) and CVE-2022-39248
  (matrix-android-sdk2).
* "*Malicious key backup*" – the above 'trusted impersonation' bug in
  matrix-js-sdk (and derived SDKs) could be used by a malicious homeserver
  admin to add a malicious key backup to the user's account under certain
  unusual conditions in order to exfiltrate message keys. While we are not
  aware of this being exploited in the wild, out of an abundance of caution we
  recommend checking your key backup settings. If you are particularly paranoid
  you may wish to reset your online key backup. This doesn't have a separate
  CVE, as the root cause is the same as "Trusted Impersonation".

Three lower priority issues were also identified by the researchers:

* "*Semi-trusted Impersonation*" – matrix-js-sdk (and derived SDKs) accepted keys
  forwarded by other users, even if your client didn't request them. As
  a result, a malicious server admin could fake an encrypted message to look as
  if it was sent from a given user on that server. However, impersonated
  messages like this are clearly marked by clients like Element with a clear
  "The authenticity of this encrypted message can't be guaranteed" warning
  – which is why we consider this low severity. That said, it's an avoidable
  attack, and we've fixed this by ensuring that clients don't accept 'unsafe'
  keys (with the exception of keys forwarded when you invite a user to an
  existing conversation). In future, in Olm/Megolm v2 we're also linking
  key-sending events to the underlying recipient Olm identity to ensure that
  keys cannot be misappropriated. This issue is tracked as a moderate severity
  CVE: CVE-2022-39249 (matrix-js-sdk), CVE-2022-39257 (matrix-ios-sdk) and
  CVE-2022-39246 (matrix-android-sdk2).
* "*Homeserver Control of Room Membership*" – A malicious homeserver can fake
  invites on behalf of its users to invite malicious users into their
  conversations, or add malicious devices into its users accounts. However,
  when this happens, we clearly warn the user: if you have verified the users
  you are talking to, the room and user will be shown with a big red cross to
  mark if malicious devices have been added. Similarly, if an unexpected user
  is invited to a conversation, all users can clearly see and take evasive
  action. Therefore we consider this a low severity issue. That said, this
  behaviour can be improved, and we've started work on switching our trust
  model to trust-on-first-use (so that new untrusted devices are proactively
  excluded from conversations, even if you haven't explicitly verified their
  owner) - and we're also looking to add cryptographic signatures to membership
  events in E2EE rooms to stop impersonated invites. These fixes will land
  over the coming months.
* "*IND-CCA break*" – Matrix's usage of AES-CTR to encrypt attachments, secrets
  and symmetric key backups is not "IND-CCA2 secure", because it does not
  include the AES initialisation vector within the hash used to secure the
  payload from tampering. As a result, if an attacker could observe the result
  of both a given encryption and a given decryption operation, it would be
  possible to extract the encryption private key. However, this is a purely
  theoretical attack as Matrix does not provide a way to mount the attack. In
  the future, we will fix our use of AES-CTR to include the IV within the hash.

We'd like to again thank Martin R. Albrecht and Dan Jones from the Information
Security Group at Royal Holloway University London, Benjamin Dowling from
Security of Advanced Systems Group, University of Sheffield and Sofía Celi from
Brave Software for discovering these issues and responsibly disclosing them to
us, and then working with us to agree on an extended disclosure window given
the amount of work needed to verify and ship fixes throughout Matrix over the
course of the summer period. We welcome any further formal security analysis
work, and hope that it will distinguish clearly between Matrix-the-protocol and
Matrix implementations like matrix-js-sdk, rather than conflating them. You can
read their full paper [here](https://nebuchadnezzar-megolm.github.io/).

We'd also like to thank all the downstream Element package maintainers,
downstream forks and other affected clients for working together under time
constraints for this coordinated release - your patience and understanding is
very much appreciated indeed.

Meanwhile, we are taking extreme measures to avoid future E2EE vulnerabilities.
You will notice that matrix-rust-sdk, hydrogen-sdk and other 2nd and 3rd
generation SDKs were not affected by the bugs at the root cause of the critical
issues here. This is **precisely** why we have been working on replacing the
first generation SDKs with a clean, carefully written Rust implementation in
the form of matrix-rust-sdk, complete with an ongoing independent public audit.

We started the process of auditing matrix-rust-sdk with the [Least Authority
vodozemac audit in May](https://matrix.org/blog/2022/05/16/independent-public-audit-of-vodozemac-a-native-rust-reference-implementation-of-matrix-end-to-end-encryption), and we have three more audits agreed
– covering matrix-rust-sdk-crypto, matrix-rust-sdk, and a whole reference
Matrix stack. Ironically, the mitigation work for these vulnerabilities in the
legacy SDKs has severely impacted our timelines for finishing
matrix-rust-sdk-crypto work (in fact, we had to push back the Least Authority
audit of matrix-rust-sdk-crypto given the
[burndown](https://github.com/matrix-org/matrix-rust-sdk/milestone/1) has not
progressed), but we will be shifting to the new audited codebase as rapidly as
we possibly can.

Over the coming months we will also introduce our first ever major version
update of Olm and Megolm, in order to fix the MAC truncation issue highlighted
in the [vodozemac audit](https://matrix.org/media/Least%20Authority%20-%20Matrix%20vodozemac%20Final%20Audit%20Report.pdf) (Issue J), and reduce the risk of further
key-forwarding issues (as per the "Semi-trusted Impersonation" vulnerability
above). New conversations will default to using v2 of Olm/Megolm for security,
and existing conversations can be optionally upgraded (similar to a 'room
version' upgrade in Matrix today). We are also adding extensive end-to-end
testing using [Polyjuice](https://gitlab.com/polyjuice) and [Traffic
Light](https://github.com/matrix-org/trafficlight) to stress-test encryption
and improve reliability.

Finally, we will continue our research into layering Matrix over Messaging
Layer Security (MLS) - the IETF proposed standard for interoperable end-to-end
encrypted group messaging. This work has been delayed by the mitigation
activity above, but otherwise it's making good progress and we're excited to
see how Decentralised MLS performs in reality against Olm+Megolm v2.

We'd like to apologise to the wider Matrix community for the inconvenience and
disruption of these issues, and thank you for your patience while we've
resolved them.

Matthew, Denis and the Matrix cryptography & security teams.

## The Foundation needs you

The Matrix.org Foundation is a non-profit and only relies
on donations to operate. Its core mission is to maintain
the Matrix Specification, but it does much more than that.

It maintains the matrix.org homeserver and hosts several
bridges for free. It fights for our collective rights to
digital privacy and dignity.

[Support us](/support)

[Donate](/support)
[Shop](https://shop.matrix.org)
[Security Disclosure Policy](/security-disclosure-policy)
[Security Hall of Fame](/security-hall-of-fame)
[Code of Conduct](/legal/code-of-conduct)
[Legal](/legal)
[Contact](/contact)
[Site Source](https://github.com/matrix-org/matrix.org/)

[![GitHub](/assets/github.svg)](https://github.com/matrix-org)
[![GitLab](/assets/gitlab.svg)](https://gitlab.matrix.org/)
[![Mastodon](/assets/mastodon.svg)](https://mastodon.matrix.org/%40matrix)
[![Twitter](/assets/twitter.svg)](https://twitter.com/matrixdotorg)
[![YouTube](/assets/youtube.svg)](https://www.youtube.com/channel/UCVFkW-chclhuyYRbmmfwt6w)
[![RSS](/assets/rss.svg)](/atom.xml)

[Copyright Notice](/legal/copyright-notice)



=== Content from github.com_05461c27_20250115_113956.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-6263-x97c-c4gg)

**CVE-2022-39249**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-6263-x97c-c4gg)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2022-39249](/advisories/GHSA-6263-x97c-c4gg)

## matrix-js-sdk subject to impersonated messages due to permissive key forwarding

High severity

GitHub Reviewed

Published
Sep 28, 2022
in
[matrix-org/matrix-js-sdk](/matrix-org/matrix-js-sdk)
•
Updated Jan 30, 2023

[Vulnerability details](/advisories/GHSA-6263-x97c-c4gg)
[Dependabot alerts
0](/advisories/GHSA-6263-x97c-c4gg/dependabot)

## Package

npm

matrix-js-sdk
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

< 19.7.0

## Patched versions

19.7.0

## Description

## Impact

An attacker cooperating with a malicious homeserver can construct messages appearing to have come from another person. Such messages will be marked with a grey shield on some platforms, but this may be missing in others.

This attack is possible due to the matrix-js-sdk implementing a too permissive [key forwarding](https://spec.matrix.org/v1.3/client-server-api/#key-requests) strategy on the receiving end.

Key forwarding is a mechanism allowing clients to recover from “unable to decrypt” messages when they missed the initial key distribution, at the time the message was originally sent. Examples include accessing message history before they joined the room but also when some network/federation errors have occurred.

## Patches

The default policy for accepting key forwards has been made more strict in the matrix-js-sdk. matrix-js-sdk will now only accept forwarded keys in response to previously issued requests and only from own, verified devices.

A unique exception to this rule is with the experimental [MSC3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061), that is forwarding room keys for past messages when invited in a room configured with the proper history visibility setting. Such key forwards are parked upon receipt and are only accepted if the SDK receives an invitation for that room from the inviter in a limited time window.

The SDK now sets a `trusted` flag on the decrypted message upon decryption, based on whether the key used to decrypt the message was received from a trusted source. Clients need to ensure that messages decrypted with a key with `trusted = false` are decorated appropriately (for example, by showing a warning for such messages).

### Workarounds

As this attack requires coordination between a malicious homeserver and an attacker, if you trust your homeserver, no particular workaround is needed.

## References

Blog post: <https://matrix.org/blog/2022/09/28/upgrade-now-to-address-encryption-vulns-in-matrix-sdks-and-clients>

## For more information

If you have any questions or comments about this advisory, e-mail us at security@matrix.org.

### References

* [GHSA-6263-x97c-c4gg](https://github.com/matrix-org/matrix-js-sdk/security/advisories/GHSA-6263-x97c-c4gg "GHSA-6263-x97c-c4gg")
* <https://nvd.nist.gov/vuln/detail/CVE-2022-39249>
* [matrix-org/matrix-spec-proposals#3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061)
* [matrix-org/matrix-js-sdk@a587d7c](https://github.com/matrix-org/matrix-js-sdk/commit/a587d7c36026fe1fcf93dfff63588abee359be76)
* <https://github.com/matrix-org/matrix-js-sdk/releases/tag/v19.7.0>
* <https://matrix.org/blog/2022/09/28/upgrade-now-to-address-encryption-vulns-in-matrix-sdks-and-clients>
* <https://security.gentoo.org/glsa/202210-35>

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)
[dkasak](/dkasak)
published to
[matrix-org/matrix-js-sdk](/matrix-org/matrix-js-sdk/security/advisories/GHSA-6263-x97c-c4gg)
Sep 28, 2022

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2022-39249)
Sep 28, 2022

Published to the GitHub Advisory Database
Sep 30, 2022

Reviewed
Sep 30, 2022

Last updated
Jan 30, 2023

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
High

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N

### [EPSS score](https://www.first.org/epss/user-guide)

0.133%
 (49th percentile)

### Weaknesses

[CWE-287](/advisories?query=cwe%3A287)

### CVE ID

CVE-2022-39249

### GHSA ID

GHSA-6263-x97c-c4gg

### Source code

[matrix-org/matrix-js-sdk](https://github.com/matrix-org/matrix-js-sdk)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-6263-x97c-c4gg/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9a69fc1d_20250114_191058.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fsecurity%2Fadvisories%2FGHSA-6263-x97c-c4gg)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fsecurity%2Fadvisories%2FGHSA-6263-x97c-c4gg)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fmatrix-js-sdk)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[matrix-js-sdk](/matrix-org/matrix-js-sdk)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk) You must be signed in to change notification settings
* [Fork
  606](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)
* [Star
   1.7k](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)

* [Code](/matrix-org/matrix-js-sdk)
* [Issues
  228](/matrix-org/matrix-js-sdk/issues)
* [Pull requests
  28](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects
  0](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

Additional navigation options

* [Code](/matrix-org/matrix-js-sdk)
* [Issues](/matrix-org/matrix-js-sdk/issues)
* [Pull requests](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

# Impersonation via forwarded Megolm sessions

Moderate

[dkasak](/dkasak)
published
GHSA-6263-x97c-c4gg
Sep 28, 2022

## Package

npm

matrix-js-sdk
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

< 19.7.0

## Patched versions

19.7.0

## Description

## Impact

An attacker cooperating with a malicious homeserver can construct messages appearing to have come from another person. Such messages will be marked with a grey shield on some platforms, but this may be missing in others.

This attack is possible due to the matrix-js-sdk implementing a too permissive [key forwarding](https://spec.matrix.org/v1.3/client-server-api/#key-requests) strategy on the receiving end.

Key forwarding is a mechanism allowing clients to recover from “unable to decrypt” messages when they missed the initial key distribution, at the time the message was originally sent. Examples include accessing message history before they joined the room but also when some network/federation errors have occurred.

## Patches

The default policy for accepting key forwards has been made more strict in the matrix-js-sdk. matrix-js-sdk will now only accept forwarded keys in response to previously issued requests and only from own, verified devices.

A unique exception to this rule is with the experimental [MSC3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061), that is forwarding room keys for past messages when invited in a room configured with the proper history visibility setting. Such key forwards are parked upon receipt and are only accepted if the SDK receives an invitation for that room from the inviter in a limited time window.

The SDK now sets a `trusted` flag on the decrypted message upon decryption, based on whether the key used to decrypt the message was received from a trusted source. Clients need to ensure that messages decrypted with a key with `trusted = false` are decorated appropriately (for example, by showing a warning for such messages).

### Workarounds

As this attack requires coordination between a malicious homeserver and an attacker, if you trust your homeserver, no particular workaround is needed.

## References

Blog post: <https://matrix.org/blog/2022/09/28/upgrade-now-to-address-encryption-vulns-in-matrix-sdks-and-clients>

## For more information

If you have any questions or comments about this advisory, e-mail us at security@matrix.org.

### Severity

Moderate

### CVE ID

CVE-2022-39249

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.gentoo.org_5b2ca18a_20250114_191103.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Thunderbird: Multiple Vulnerabilities — GLSA **202210-35**

Multiple vulnerabilities have been found in Mozilla Thunderbird, the worst of which could result in arbitrary code execution.

### Affected packages

| Package | **mail-client/thunderbird** on all architectures |
| --- | --- |
| Affected versions | < **102.4.0** |
| Unaffected versions | >= **102.4.0** |

| Package | **mail-client/thunderbird-bin** on all architectures |
| --- | --- |
| Affected versions | < **102.4.0** |
| Unaffected versions | >= **102.4.0** |

### Background

Mozilla Thunderbird is a popular open-source email client from the Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Thunderbird. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Thunderbird users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=mail-client/thunderbird-102.4.0"

```

All Mozilla Thunderbird binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=mail-client/thunderbird-bin-102.4.0"

```
### References

* [CVE-2022-39236](https://nvd.nist.gov/vuln/detail/CVE-2022-39236)
* [CVE-2022-39249](https://nvd.nist.gov/vuln/detail/CVE-2022-39249)
* [CVE-2022-39250](https://nvd.nist.gov/vuln/detail/CVE-2022-39250)
* [CVE-2022-39251](https://nvd.nist.gov/vuln/detail/CVE-2022-39251)
* [CVE-2022-42927](https://nvd.nist.gov/vuln/detail/CVE-2022-42927)
* [CVE-2022-42928](https://nvd.nist.gov/vuln/detail/CVE-2022-42928)
* [CVE-2022-42929](https://nvd.nist.gov/vuln/detail/CVE-2022-42929)
* [CVE-2022-42932](https://nvd.nist.gov/vuln/detail/CVE-2022-42932)

**Release date**

October 31, 2022

**Latest revision**

October 31, 2022: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [873667](https://bugs.gentoo.org/show_bug.cgi?id=873667)
* [878315](https://bugs.gentoo.org/show_bug.cgi?id=878315)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from github.com_12a1bef0_20250114_191103.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-spec-proposals%2Fpull%2F3061)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-spec-proposals%2Fpull%2F3061)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fmatrix-spec-proposals)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[matrix-spec-proposals](/matrix-org/matrix-spec-proposals)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals) You must be signed in to change notification settings
* [Fork
  385](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals)
* [Star
   1k](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals)

* [Code](/matrix-org/matrix-spec-proposals)
* [Issues
  15](/matrix-org/matrix-spec-proposals/issues)
* [Pull requests
  501](/matrix-org/matrix-spec-proposals/pulls)
* [Actions](/matrix-org/matrix-spec-proposals/actions)
* [Projects
  1](/matrix-org/matrix-spec-proposals/projects)
* [Security](/matrix-org/matrix-spec-proposals/security)
* [Insights](/matrix-org/matrix-spec-proposals/pulse)

Additional navigation options

* [Code](/matrix-org/matrix-spec-proposals)
* [Issues](/matrix-org/matrix-spec-proposals/issues)
* [Pull requests](/matrix-org/matrix-spec-proposals/pulls)
* [Actions](/matrix-org/matrix-spec-proposals/actions)
* [Projects](/matrix-org/matrix-spec-proposals/projects)
* [Security](/matrix-org/matrix-spec-proposals/security)
* [Insights](/matrix-org/matrix-spec-proposals/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# MSC3061: Sharing room keys for past messages #3061

 Merged

[turt2live](/turt2live)
merged 5 commits into
[matrix-org:old\_master](/matrix-org/matrix-spec-proposals/tree/old_master "matrix-org/matrix-spec-proposals:old_master")
from
[uhoreg:shareable\_keys\_msc](/uhoreg/matrix-doc/tree/shareable_keys_msc "uhoreg/matrix-doc:shareable_keys_msc")

Aug 14, 2023

 Merged

# [MSC3061: Sharing room keys for past messages](#top) #3061

[turt2live](/turt2live)
merged 5 commits into
[matrix-org:old\_master](/matrix-org/matrix-spec-proposals/tree/old_master "matrix-org/matrix-spec-proposals:old_master")
from
[uhoreg:shareable\_keys\_msc](/uhoreg/matrix-doc/tree/shareable_keys_msc "uhoreg/matrix-doc:shareable_keys_msc")

Aug 14, 2023

[Conversation
37](/matrix-org/matrix-spec-proposals/pull/3061)
[Commits
5](/matrix-org/matrix-spec-proposals/pull/3061/commits)
[Checks
0](/matrix-org/matrix-spec-proposals/pull/3061/checks)
[Files changed](/matrix-org/matrix-spec-proposals/pull/3061/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![uhoreg](https://avatars.githubusercontent.com/u/1012976?s=60&v=4)](/uhoreg)

Copy link

Member

### @uhoreg **[uhoreg](/uhoreg)** commented [Mar 12, 2021](#issue-830646012) • edited by turt2live Loading

[Rendered](https://github.com/uhoreg/matrix-doc/blob/shareable_keys_msc/proposals/3061-shareable-room-keys.md)

Implementations:

* [JS SDK](https://github.com/matrix-org/matrix-js-sdk/pull/1640)
* [Polyjuice Client Test](https://gitlab.com/polyjuice/polyjuice_client_test/-/blob/develop/lib/polyjuice/client_test/test/historical_key_sharing.ex)
* [Element iOS](https://github.com/vector-im/element-ios/issues/4947)
* [Element Android](https://github.com/vector-im/element-android/issues/4153)

[FCP tickyboxes](https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-1594770839)

Sorry, something went wrong.

 👍
12
 ShadowJonathan, SimonBrandner, ara4n, aWeinzierl, bb010g, MazeChaZer, BBaoVanC, cvwright, TheJJ, N1N74, and 2 more reacted with thumbs up emoji
 🎉
5
 SimonBrandner, aWeinzierl, BBaoVanC, N1N74, and gregblake reacted with hooray emoji
 ❤️
5
 SimonBrandner, aWeinzierl, BBaoVanC, N1N74, and gregblake reacted with heart emoji
 🚀
6
 SimonBrandner, aWeinzierl, 0-st, BBaoVanC, N1N74, and gregblake reacted with rocket emoji
 👀
3
 ShadowJonathan, aWeinzierl, and N1N74 reacted with eyes emoji

All reactions

* 👍
  12 reactions
* 🎉
  5 reactions
* ❤️
  5 reactions
* 🚀
  6 reactions
* 👀
  3 reactions

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)

`[initial version](/matrix-org/matrix-spec-proposals/pull/3061/commits/a24dbf0f156ad98bd9030855fb2595097fcb3e21 "initial version")`

`[a24dbf0](/matrix-org/matrix-spec-proposals/pull/3061/commits/a24dbf0f156ad98bd9030855fb2595097fcb3e21)`

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
changed the title
~~MSCxxxx: Sharing room keys for past messages~~
MSC3061: Sharing room keys for past messages
[Mar 12, 2021](#event-4453032751)

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)

`[use MSC number](/matrix-org/matrix-spec-proposals/pull/3061/commits/38f35c23e8cb013a59bbc9216eba7354de72ed2d "use MSC number")`

`[38f35c2](/matrix-org/matrix-spec-proposals/pull/3061/commits/38f35c23e8cb013a59bbc9216eba7354de72ed2d)`

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
added
[e2e](/matrix-org/matrix-spec-proposals/labels/e2e)
[proposal](/matrix-org/matrix-spec-proposals/labels/proposal)
A matrix spec change proposal
[proposal-in-review](/matrix-org/matrix-spec-proposals/labels/proposal-in-review)
labels
[Mar 12, 2021](#event-4453038775)

[![ara4n](https://avatars.githubusercontent.com/u/1294269?s=60&v=4)](/ara4n)

**[ara4n](/ara4n)**
reviewed
[Mar 13, 2021](#pullrequestreview-611582104)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)
Outdated

Show resolved

Hide resolved

[![poljar](https://avatars.githubusercontent.com/u/552026?s=60&v=4)](/poljar)

**[poljar](/poljar)**
reviewed
[Mar 13, 2021](#pullrequestreview-611589465)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)

Show resolved

Hide resolved

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
mentioned this pull request
[Mar 16, 2021](#ref-pullrequest-828543435)

[Add function to share megolm keys for historical messages, take 2
matrix-org/matrix-js-sdk#1640](/matrix-org/matrix-js-sdk/pull/1640)
 Merged

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=80&v=4)](/uhoreg)

Copy link

Member

Author

### **[uhoreg](/uhoreg)** commented [Mar 16, 2021](#issuecomment-799910767)

| Implemented by [matrix-org/matrix-js-sdk#1640](https://github.com/matrix-org/matrix-js-sdk/pull/1640) |
| --- |

 ❤️
2
 aWeinzierl and SimonBrandner reacted with heart emoji

All reactions

* ❤️
  2 reactions

Sorry, something went wrong.

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
added
the
[kind:core](/matrix-org/matrix-spec-proposals/labels/kind%3Acore)
MSC which is critical to the protocol's success
label
[Apr 8, 2021](#event-4571669257)

[jryans](/jryans)
added a commit
to matrix-org/matrix-react-sdk
that referenced
this pull request
[Apr 9, 2021](#ref-commit-7b0ab4a)
[![@jryans](https://avatars.githubusercontent.com/u/279572?s=40&u=753c3e4e4bdbf3f2a8e5649dc314ed7d1b3a43f6&v=4)](/jryans)

`[Enable sharing historical keys on invite](/matrix-org/matrix-react-sdk/commit/7b0ab4a0591029a28d011c0d66e021d5694cbe05 "Enable sharing historical keys on invite

After discussion with Product, we're ready to enable this key sharing work from
https://github.com/matrix-org/matrix-react-sdk/pull/5763 (based on
https://github.com/matrix-org/matrix-doc/pull/3061).")`
…

`[7b0ab4a](/matrix-org/matrix-react-sdk/commit/7b0ab4a0591029a28d011c0d66e021d5694cbe05)`

```
After discussion with Product, we're ready to enable this key sharing work from
[#5763](https://github.com/matrix-org/matrix-react-sdk/pull/5763) (based on
[matrix-org/matrix-spec-proposals#3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061)).
```

[![@jryans](https://avatars.githubusercontent.com/u/279572?s=40&u=753c3e4e4bdbf3f2a8e5649dc314ed7d1b3a43f6&v=4)](/jryans)
[jryans](/jryans)
mentioned this pull request
[Apr 9, 2021](#ref-pullrequest-854453423)

[Enable sharing historical keys on invite
matrix-org/matrix-react-sdk#5839](/matrix-org/matrix-react-sdk/pull/5839)
 Merged

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
added
the
[needs-implementation](/matrix-org/matrix-spec-proposals/labels/needs-implementation)
This MSC does not have a qualifying implementation for the SCT to review. The MSC cannot enter FCP.
label
[Jun 8, 2021](#event-4859239192)

[![@cvwright](https://avatars.githubusercontent.com/u/3451776?s=80&u=5d12cf7b063568cc1ece6ac092e1094dd49dcc20&v=4)](/cvwright)

Copy link

### **[cvwright](/cvwright)** commented [Aug 4, 2021](#issuecomment-893015870)

| Implemented by [matrix-org/matrix-js-sdk#1640](https://github.com/matrix-org/matrix-js-sdk/pull/1640)  Is anyone working on this for matrix-ios-sdk? |
| --- |

 👍
1
 korntom reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
[force-pushed](/matrix-org/matrix-spec-proposals/compare/e895827731bd5cd17fdc23f135602937e4f0d009..dca99ee2735773b3055b2ad697650217db65fc8a)
the
old\_master

branch
from
[`e895827`](/matrix-org/matrix-spec-proposals/commit/e895827731bd5cd17fdc23f135602937e4f0d009) to
[`dca99ee`](/matrix-org/matrix-spec-proposals/commit/dca99ee2735773b3055b2ad697650217db65fc8a)  [Compare](/matrix-org/matrix-spec-proposals/compare/e895827731bd5cd17fdc23f135602937e4f0d009..dca99ee2735773b3055b2ad697650217db65fc8a)
[August 30, 2021 22:34](#event-5229006621)

[![ara4n](https://avatars.githubusercontent.com/u/1294269?s=60&v=4)](/ara4n)

**[ara4n](/ara4n)**
reviewed
[Sep 23, 2021](#pullrequestreview-762242555)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)

Show resolved

Hide resolved

[![deepbluev7](https://avatars.githubusercontent.com/u/16312324?s=60&v=4)](/deepbluev7)

**[deepbluev7](/deepbluev7)**
reviewed
[Oct 1, 2021](#pullrequestreview-768493564)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)
Outdated

|  |  | ## Security considerations |
| --- | --- | --- |
|  |  |  |
|  |  | Clients should still ensure that keys are only shared with authorized users and |
|  |  | devices. |

Copy link

Contributor

### @deepbluev7 **[deepbluev7](/deepbluev7)** [Oct 1, 2021](#discussion_r719877913)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

How does this work? How does the client know, that a user should be in the room and wasn't maliciously added by the homeserver? Even if you set a room to shared history, you probably only want members to read the history, that you accepted as having been allowed into the room. Considering the end aspect in e2ee, we want the client to approve of a member having joined the room, before sharing history. We don't want to automatically share keys with anyone, who joins the room, because the server could for a short time "fake" a user in the room and as such get access to all the history and then make the user disappear again. Then encrypting the room would be useless. Should we require prompting the user once before sharing past history with a new user in the room?

Sorry, something went wrong.

 👍
1
 kevincox reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Copy link

Member

Author

### @uhoreg **[uhoreg](/uhoreg)** [Oct 5, 2021](#discussion_r721845227)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This is sort of a generic "make sure that you don't accidentally over-share when you implement this". In this case, clients only share the keys with users that the client invites, so it's decided that the user should be authorized. For determining which devices are authorized, in general, the client should probably just do what it normally does for determining which devices to send keys to.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @deepbluev7 **[deepbluev7](/deepbluev7)** [Oct 5, 2021](#discussion_r722095247)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think this is a really scary trap, because a client dev might forget, that the servers device list and member list isn't really that trustworthy. We somewhat get around that by warning for unverified devices, when sending a message, but that will never work for sharing past message keys.

Sorry, something went wrong.

All reactions

Copy link

Member

### @dkasak **[dkasak](/dkasak)** [Oct 25, 2021](#discussion_r735535240)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The proper solution here is to base the decision whether to share on the trust state of the user we're inviting.

If the invited user is untrusted (in cross-signing terms), the client should at least display a warning along with a list of devices that would get the keys. This would allow the inviter to at least review the list and consciously proceed with the action if they want to do so.

If the invited user is trusted, but some of their devices are not verified yet, the client should again display a warning with a list of those devices, again asking whether to proceed.

If the user is trusted *and* all of their devices are verified, then no warning is necessary.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @deepbluev7 **[deepbluev7](/deepbluev7)** [Oct 25, 2021](#discussion_r735585772)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

So only the inviter will ever share keys?

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @uhoreg **[uhoreg](/uhoreg)** [Oct 25, 2021](#discussion_r735647538)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It doesn't have to be just the inviter who shares keys; others can share keys as well, but it's up to them to ensure that they do so securely. Spec-wise, we try to avoid telling clients exactly how to handle keys, as different clients may wish to make different tradeoffs. But I will [add a comment](https://github.com/matrix-org/matrix-doc/pull/3061#discussion_r735638426) about checking device trust before sharing.

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @uhoreg **[uhoreg](/uhoreg)** [Dec 21, 2022](#discussion_r1054942291)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I've added some more words here. Hopefully it's clearer now.

Sorry, something went wrong.

All reactions

This was referenced Oct 4, 2021

[Sharing room keys for past messages
element-hq/element-ios#4947](/element-hq/element-ios/issues/4947)

Closed

[Sharing room keys for past messages
element-hq/element-android#4153](/element-hq/element-android/issues/4153)

Closed

[![uhoreg](https://avatars.githubusercontent.com/u/1012976?s=60&v=4)](/uhoreg)

**[uhoreg](/uhoreg)**
commented
[Oct 25, 2021](#pullrequestreview-788174929)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)
Outdated

Show resolved

Hide resolved

[![@manuroe](https://avatars.githubusercontent.com/u/8418515?s=40&v=4)](/manuroe)
[manuroe](/manuroe)
mentioned this pull request
[Nov 18, 2021](#ref-issue-1057200853)

[Android clients hides room history from newly invited users in a room
element-hq/element-android#4503](/element-hq/element-android/issues/4503)

Open

1 task

[![@BillCarsonFr](https://avatars.githubusercontent.com/u/9841565?s=40&v=4)](/BillCarsonFr)
[BillCarsonFr](/BillCarsonFr)
mentioned this pull request
[Dec 16, 2021](#ref-issue-1082478820)

[Improve history UISI Display
element-hq/element-meta#74](/element-hq/element-meta/issues/74)

Closed

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
mentioned this pull request
[Jan 25, 2022](#ref-pullrequest-1113977388)

[MSC3673: Encrypted ephemeral data units
#3673](/matrix-org/matrix-spec-proposals/pull/3673)
 Open

[![@BillCarsonFr](https://avatars.githubusercontent.com/u/9841565?s=40&v=4)](/BillCarsonFr)
[BillCarsonFr](/BillCarsonFr)
mentioned this pull request
[Apr 11, 2022](#ref-issue-1200023451)

[Implement MSC3061: Sharing room keys for past messages
matrix-org/matrix-rust-sdk#580](/matrix-org/matrix-rust-sdk/issues/580)

Closed

This was referenced Apr 21, 2022

[Store `sharedHistory` flag for inbound Megolm sessions
matrix-org/matrix-ios-sdk#1444](/matrix-org/matrix-ios-sdk/pull/1444)
 Merged

[Share Megolm session keys when inviting a new user
matrix-org/matrix-ios-sdk#1447](/matrix-org/matrix-ios-sdk/pull/1447)
 Merged

[![@ariskotsomitopoulos](https://avatars.githubusercontent.com/u/60798129?s=40&v=4)](/ariskotsomitopoulos)
[ariskotsomitopoulos](/ariskotsomitopoulos)
mentioned this pull request
[Apr 27, 2022](#ref-pullrequest-1217114565)

[Share Megolm session keys when inviting a new user
element-hq/element-android#5853](/element-hq/element-android/pull/5853)
 Merged

[![@Anderas](https://avatars.githubusercontent.com/u/3922159?s=40&v=4)](/Anderas)
[Anderas](/Anderas)
mentioned this pull request
[Apr 28, 2022](#ref-pullrequest-1218530049)

[Change `sharedHistory` flag to unstable variant
matrix-org/matrix-ios-sdk#1449](/matrix-org/matrix-ios-sdk/pull/1449)
 Merged

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
removed
the
[proposal-in-review](/matrix-org/matrix-spec-proposals/labels/proposal-in-review)
label
[May 5, 2022](#event-6559706589)

27 hidden items

Load more…

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=80&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)

Copy link

Member

### **[turt2live](/turt2live)** commented [Aug 14, 2023](#issuecomment-1677617594)

| This MSC has completed FCP per the [above comment](https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-1671589660). |
| --- |

All reactions

Sorry, something went wrong.

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
added
[finished-final-comment-period](/matrix-org/matrix-spec-proposals/labels/finished-final-comment-period)
and removed
[final-comment-period](/matrix-org/matrix-spec-proposals/labels/final-comment-period)
This MSC has entered a final comment period in interest to approval, postpone, or delete in 5 days.
labels
[Aug 14, 2023](#event-10088620699)

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
merged commit [`5c19d4f`](/matrix-org/matrix-spec-proposals/commit/5c19d4fdea9058533242e99b72b1776fd4a523cb)
into
matrix-org:old\_master

[Aug 14, 2023](https://github.com/matrix-org/matrix-spec-proposals/pull/3061#event-10088622217)

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
added
[spec-pr-missing](/matrix-org/matrix-spec-proposals/labels/spec-pr-missing)
Proposal has been implemented and is being used in the wild but hasn't yet been added to the spec
and removed
[finished-final-comment-period](/matrix-org/matrix-spec-proposals/labels/finished-final-comment-period)
labels
[Aug 14, 2023](#event-10088624270)

[turt2live](/turt2live)
pushed a commit
that referenced
this pull request
[Aug 16, 2023](#ref-commit-6a3ab1d)
[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg) [![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh) [![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&v=4)](/turt2live)

`[MSC3061](https://github.com/matrix-org/matrix-doc/pull/3061)[: Sharing room keys for past messages (](/matrix-org/matrix-spec-proposals/commit/6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280 "MSC3061: Sharing room keys for past messages (#3061)

* initial version

* use MSC number

* address comments from review

* fix list

* fix markdown

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>

---------

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>")[#3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061)[)](/matrix-org/matrix-spec-proposals/commit/6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280 "MSC3061: Sharing room keys for past messages (#3061)

* initial version

* use MSC number

* address comments from review

* fix list

* fix markdown

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>

---------

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>")`
…

`[6a3ab1d](/matrix-org/matrix-spec-proposals/commit/6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280)`

```
* initial version

* use MSC number

* address comments from review

* fix list

* fix markdown

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>

---------

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>
```

This was referenced Oct 2, 2023

[crypto: Implemented sharing room keys for past messages (MSC3061)
matrix-org/matrix-rust-sdk#2650](/matrix-org/matrix-rust-sdk/pull/2650)
 Closed

[Added shared\_history flag to room key events
ruma/ruma#1669](/ruma/ruma/pull/1669)
 Merged

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
mentioned this pull request
[Oct 4, 2023](#ref-pullrequest-1925181634)

[Add spec for shared-history room keys (MSC3061)
matrix-org/matrix-spec#1655](/matrix-org/matrix-spec/pull/1655)
 Closed

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=80&v=4)](/uhoreg)

Copy link

Member

Author

### **[uhoreg](/uhoreg)** commented [Oct 4, 2023](#issuecomment-1745970453)

| Spec PR: [matrix-org/matrix-spec#1655](https://github.com/matrix-org/matrix-spec/pull/1655) |
| --- |

All reactions

Sorry, something went wrong.

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
added
[spec-pr-in-review](/matrix-org/matrix-spec-proposals/labels/spec-pr-in-review)
A proposal which has been PR'd against the spec and is in review
and removed
[spec-pr-missing](/matrix-org/matrix-spec-proposals/labels/spec-pr-missing)
Proposal has been implemented and is being used in the wild but hasn't yet been added to the spec
labels
[Oct 4, 2023](#event-10544895522)

This was referenced Feb 28, 2024

[Epic: Users should not see UTDs for messages they are not supposed to be able to read
element-hq/element-meta#2312](/element-hq/element-meta/issues/2312)

Closed

[Expected UTDs: Hide UTDs for messages sent while you were not in the room ("Pre-join UTDs")
element-hq/element-meta#2317](/element-hq/element-meta/issues/2317)

Closed

[![@Johennes](https://avatars.githubusercontent.com/u/1137962?s=40&v=4)](/Johennes)
[Johennes](/Johennes)
mentioned this pull request
[Mar 10, 2024](#ref-pullrequest-2152477871)

[MSC4114: Matrix as a password manager
#4114](/matrix-org/matrix-spec-proposals/pull/4114)
 Open

This was referenced Jul 2, 2024

[Inviting a user to an E2EE room does not share keys for history with them, causing UISIs everywhere.
element-hq/element-x-ios#1496](/element-hq/element-x-ios/issues/1496)

Open

[Let devices request keys to decrypt past history for a room.
element-hq/element-meta#647](/element-hq/element-meta/issues/647)

Closed

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=80&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)

Copy link

Member

### **[dkasak](/dkasak)** commented [Oct 15, 2024](#issuecomment-2414282902) • edited Loading

| The [spec text PR](https://github.com/matrix-org/matrix-spec/pull/1655) for this MSC was (in)famously blocked on a security concern. This concern is now disclosed at <https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/>. |
| --- |

All reactions

Sorry, something went wrong.

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=80&v=4)](/richvdh)

Copy link

Member

### **[richvdh](/richvdh)** commented [Oct 29, 2024](#issuecomment-2444845098)

| Following the above disclosure, the Spec Core team have decided to revert the merging of this proposal. A future proposal is welcome to use this one as a basis. |
| --- |

All reactions

Sorry, something went wrong.

[richvdh](/richvdh)
added a commit
that referenced
this pull request
[Oct 29, 2024](#ref-commit-22c774d)
[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh)

`[Revert "](/matrix-org/matrix-spec-proposals/commit/22c774de581a4fc3ee64fd90f78a999e0d3dd952 "Revert \"MSC3061: Sharing room keys for past messages (#3061)\"

This reverts commit 6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280.

Per https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/
and https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-2444845098,
we are removing the merged status of this PR.")[MSC3061](https://github.com/matrix-org/matrix-doc/pull/3061)[: Sharing room keys for past messages (](/matrix-org/matrix-spec-proposals/commit/22c774de581a4fc3ee64fd90f78a999e0d3dd952 "Revert \"MSC3061: Sharing room keys for past messages (#3061)\"

This reverts commit 6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280.

Per https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/
and https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-2444845098,
we are removing the merged status of this PR.")[#3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061)[)"](/matrix-org/matrix-spec-proposals/commit/22c774de581a4fc3ee64fd90f78a999e0d3dd952 "Revert \"MSC3061: Sharing room keys for past messages (#3061)\"

This reverts commit 6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280.

Per https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/
and https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-2444845098,
we are removing the merged status of this PR.")`
…

`[22c774d](/matrix-org/matrix-spec-proposals/commit/22c774de581a4fc3ee64fd90f78a999e0d3dd952)`

```
This reverts commit [6a3ab1d](https://github.com/matrix-org/matrix-spec-proposals/commit/6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280).

Per <https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/>
and [#3061 (comment)](https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-2444845098),
we are removing the merged status of this PR.
```

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh)
[richvdh](/richvdh)
added
[abandoned](/matrix-org/matrix-spec-proposals/labels/abandoned)
A proposal where the author/shepherd is not responsive
[rejected](/matrix-org/matrix-spec-proposals/labels/rejected)
A proposal which has been rejected for inclusion in the spec
and removed
[spec-pr-in-review](/matrix-org/matrix-spec-proposals/labels/spec-pr-in-review)
A proposal which has been PR'd against the spec and is in review
[abandoned](/matrix-org/matrix-spec-proposals/labels/abandoned)
A proposal where the author/shepherd is not responsive
labels
[Oct 29, 2024](#event-14988275212)

[![@HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=80&u=ffe9ae6208c93f6240dcf2b92a31065ee5e26aad&v=4)](/HarHarLinks)

Copy link

Contributor

### **[HarHarLinks](/HarHarLinks)** commented [Dec 7, 2024](#issuecomment-2525304477)

| Removed from matrix-js-sdk in <https://github.com/matrix-org/matrix-js-sdk/releases/tag/v34.8.0> |
| --- |

All reactions

Sorry, something went wrong.

[![@HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=40&u=ffe9ae6208c93f6240dcf2b92a31065ee5e26aad&v=4)](/HarHarLinks)
[HarHarLinks](/HarHarLinks)
mentioned this pull request
[Jan 4, 2025](#ref-issue-860172978)

[Room history sometimes not visible even when historical room keys are shared.
element-hq/element-web#16983](/element-hq/element-web/issues/16983)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-spec-proposals%2Fpull%2F3061)

Reviewers

[![@deepbluev7](https://avatars.githubusercontent.com/u/16312324?s=40&v=4)](/deepbluev7) [deepbluev7](/deepbluev7)

deepbluev7 left review comments

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh) [richvdh](/richvdh)

richvdh left review comments

[![@ara4n](https://avatars.githubusercontent.com/u/1294269?s=40&v=4)](/ara4n) [ara4n](/ara4n)

ara4n left review comments

[![@poljar](https://avatars.githubusercontent.com/u/552026?s=40&v=4)](/poljar) [poljar](/poljar)

poljar left review comments

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep) [clokep](/clokep)

clokep left review comments

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak) [dkasak](/dkasak)

dkasak left review comments

Assignees

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg) [uhoreg](/uhoreg)

Labels

[disposition-merge](/matrix-org/matrix-spec-proposals/labels/disposition-merge)
[e2e](/matrix-org/matrix-spec-proposals/labels/e2e)
[kind:core](/matrix-org/matrix-spec-proposals/labels/kind%3Acore)
MSC which is critical to the protocol's success
[proposal](/matrix-org/matrix-spec-proposals/labels/proposal)
A matrix spec change proposal
[rejected](/matrix-org/matrix-spec-proposals/labels/rejected)
A proposal which has been rejected for inclusion in the spec

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

13 participants

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=52&v=4)](/uhoreg) [![@cvwright](https://avatars.githubusercontent.com/u/3451776?s=52&v=4)](/cvwright) [![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=52&v=4)](/richvdh) [![@kristovatlas](https://avatars.githubusercontent.com/u/7227529?s=52&v=4)](/kristovatlas) [![@bradtgmurray](https://avatars.githubusercontent.com/u/33967?s=52&v=4)](/bradtgmurray) [![@mscbot](https://avatars.githubusercontent.com/u/40832866?s=52&v=4)](/mscbot) [![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=52&v=4)](/turt2live) [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=52&v=4)](/dkasak) [![@HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=52&v=4)](/HarHarLinks) [![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@poljar](https://avatars.githubusercontent.com/u/552026?s=52&v=4)](/poljar) [![@ara4n](https://avatars.githubusercontent.com/u/1294269?s=52&v=4)](/ara4n) [![@deepbluev7](https://avatars.githubusercontent.com/u/16312324?s=52&v=4)](/deepbluev7)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_26676751_20250114_191057.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Freleases%2Ftag%2Fv19.7.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Freleases%2Ftag%2Fv19.7.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=matrix-org%2Fmatrix-js-sdk)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[matrix-js-sdk](/matrix-org/matrix-js-sdk)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk) You must be signed in to change notification settings
* [Fork
  606](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)
* [Star
   1.7k](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)

* [Code](/matrix-org/matrix-js-sdk/tree/v19.7.0)
* [Issues
  228](/matrix-org/matrix-js-sdk/issues)
* [Pull requests
  28](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects
  0](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

Additional navigation options

* [Code](/matrix-org/matrix-js-sdk/tree/v19.7.0)
* [Issues](/matrix-org/matrix-js-sdk/issues)
* [Pull requests](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

1. [Releases](/matrix-org/matrix-js-sdk/releases)
2. [v19.7.0](/matrix-org/matrix-js-sdk/releases/tag/v19.7.0)

# v19.7.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/matrix-org/matrix-js-sdk/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v19.7.0)

 Loading

[View all tags](/matrix-org/matrix-js-sdk/tags)

![@RiotRobot](https://avatars.githubusercontent.com/u/24480685?s=40&v=4)
[RiotRobot](/RiotRobot)
released this
28 Sep 13:05

·
[2477 commits](/matrix-org/matrix-js-sdk/compare/v19.7.0...develop)
to develop
since this release

[v19.7.0](/matrix-org/matrix-js-sdk/tree/v19.7.0)

[`2d067ad`](/matrix-org/matrix-js-sdk/commit/2d067ad95778b26aed24b801be0951e215c3ac8c)

## 🔒 Security

* Fix for [CVE-2022-39249](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=CVE%2D2022%2D39249)
* Fix for [CVE-2022-39250](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=CVE%2D2022%2D39250)
* Fix for [CVE-2022-39251](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=CVE%2D2022%2D39251)
* Fix for [CVE-2022-39236](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=CVE%2D2022%2D39236)

 Assets
6

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e5169e2a_20250114_191056.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fcommit%2Fa587d7c36026fe1fcf93dfff63588abee359be76)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fcommit%2Fa587d7c36026fe1fcf93dfff63588abee359be76)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fmatrix-js-sdk)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[matrix-js-sdk](/matrix-org/matrix-js-sdk)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk) You must be signed in to change notification settings
* [Fork
  606](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)
* [Star
   1.7k](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)

* [Code](/matrix-org/matrix-js-sdk)
* [Issues
  228](/matrix-org/matrix-js-sdk/issues)
* [Pull requests
  28](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects
  0](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

Additional navigation options

* [Code](/matrix-org/matrix-js-sdk)
* [Issues](/matrix-org/matrix-js-sdk/issues)
* [Pull requests](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

## Commit

[Permalink](/matrix-org/matrix-js-sdk/commit/a587d7c36026fe1fcf93dfff63588abee359be76)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Resolve multiple CVEs

[Browse files](/matrix-org/matrix-js-sdk/tree/a587d7c36026fe1fcf93dfff63588abee359be76)
Browse the repository at this point in the history

```
[CVE-2022-39249](https://github.com/advisories/GHSA-6263-x97c-c4gg "CVE-2022-39249")
[CVE-2022-39250](https://github.com/advisories/GHSA-5w8r-8pgj-5jmf "CVE-2022-39250")
[CVE-2022-39251](https://github.com/advisories/GHSA-r48r-j8fx-mq2c "CVE-2022-39251")
[CVE-2022-39236](https://github.com/advisories/GHSA-hvv8-5v86-r45x "CVE-2022-39236")
```

* Loading branch information

[![@RiotRobot](https://avatars.githubusercontent.com/u/24480685?s=40&v=4)](/RiotRobot)

[RiotRobot](/matrix-org/matrix-js-sdk/commits?author=RiotRobot "View all commits by RiotRobot")
committed
Sep 28, 2022

1 parent
[b64a30f](/matrix-org/matrix-js-sdk/commit/b64a30f0ad35022b342ef8142e526fe12f43673a)

commit a587d7c

 Show file tree

 Hide file tree

Showing
**30 changed files**
with
**1,375 additions**
and
**79 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* spec

  + integ

    - spec/integ/matrix-client-crypto.spec.ts
      [matrix-client-crypto.spec.ts](#diff-a11214d99abb867611e5309e04f60cb2dd8dff6f01a4e32999019e4740d5b5b6)
    - spec/integ/matrix-client-syncing.spec.ts
      [matrix-client-syncing.spec.ts](#diff-563bd9cac559eedaed83746761f1c4d339c1eae20158766e7cea48a72ad37247)
    - spec/integ/megolm-integ.spec.ts
      [megolm-integ.spec.ts](#diff-824cf37a0f767075f7811b8f122b51fa2fdac9541c458970b8144982bae61f5b)
  + unit

    - spec/unit/content-helpers.spec.ts
      [content-helpers.spec.ts](#diff-57563a189d2f7c130b724d99baa8e5719e03daf6e4e8a9f0f79867e0c0446774)
    - spec/unit/crypto.spec.ts
      [crypto.spec.ts](#diff-c2428c3a9f1217cc15bfd96862643aced4f96f024802b2002320526ed80e49c6)
    - crypto

      * algorithms

        + spec/unit/crypto/algorithms/megolm.spec.ts
          [megolm.spec.ts](#diff-1608026fe4a0c1ddcaaf5e93abb7e4f463908581c1bc19bcd4f27e431e17c6b9)
      * spec/unit/crypto/backup.spec.ts
        [backup.spec.ts](#diff-1f30f109cff3bd88e92edf5fe041668b65c3a186f727b16818faec2652990a40)
      * spec/unit/crypto/secrets.spec.ts
        [secrets.spec.ts](#diff-55b0e7275b7510d86f5e201e7b377396032f2fe5f040c9681fb75d40213d2c01)
      * verification

        + spec/unit/crypto/verification/sas.spec.ts
          [sas.spec.ts](#diff-5858f5d49ed141b28e162c87cd7fc9235026a6b24c2d0d5958a16c6160bd1f5e)
    - models

      * spec/unit/models/beacon.spec.ts
        [beacon.spec.ts](#diff-e9800ab52919a46350a43658ccdee61ad59ab4667ebdf81110a294e68714f121)
* src

  + @types

    - src/@types/crypto.ts
      [crypto.ts](#diff-b48a7ff38f732502759971963b2f884e285501191dae5fe8724a0e759c1a739b)
  + src/NamespacedValue.ts
    [NamespacedValue.ts](#diff-b7968cc1172367d8b154e7c8941de1e40f615c59bc0c5d979a960150670503ff)
  + src/client.ts
    [client.ts](#diff-25d66d74617fe2e23d7946bd6e3ba95640ab1b9bc8947445d604fc271c7c1f12)
  + src/content-helpers.ts
    [content-helpers.ts](#diff-3d27c18cbe67978ab2bd101b007062096b9301ee967b0f026fffe681c513aed3)
  + crypto

    - src/crypto/OlmDevice.ts
      [OlmDevice.ts](#diff-f2a105ec132cea88c35977e70ea1b1ba51db2b738cde714c5ac1cd524ddff8c8)
    - src/crypto/SecretStorage.ts
      [SecretStorage.ts](#diff-cef792a7fe5292ff218b44701c423e282ae1b8df338a537d576851781430da7f)
    - algorithms

      * src/crypto/algorithms/megolm.ts
        [megolm.ts](#diff-f472935a595840f56a39e1255c3d38f2e95d9507e9b200b627cb01c19bb3801c)
      * src/crypto/algorithms/olm.ts
        [olm.ts](#diff-8a33013a1907f9a490c5a80200efb006fae4c75b581270fc5c2ce78bcc1f2af0)
    - src/crypto/backup.ts
      [backup.ts](#diff-2ac247e97434d93bb5fdab13ae3215b6465b7e4a0c1ac10f844a2bea4207ee57)
    - src/crypto/index.ts
      [index.ts](#diff-890ab04f8e5e8b612d0069bf0c681ef35d1ef3810abba98205ee464f3c366577)
    - src/crypto/olmlib.ts
      [olmlib.ts](#diff-e6e457114ac1e3095e7551d86f4cfce894c9e1788fe03e5121946e406b1b1c92)
    - store

      * src/crypto/store/base.ts
        [base.ts](#diff-587b652b307630acd415e0210d2badea32f2e11be4caf16db1122eb1ed498320)
      * src/crypto/store/indexeddb-crypto-store-backend.ts
        [indexeddb-crypto-store-backend.ts](#diff-5fd6124295b880cb79efaab622dec20aee29f4cbcca0354b0f6c098661a0e530)
      * src/crypto/store/indexeddb-crypto-store.ts
        [indexeddb-crypto-store.ts](#diff-7e58a7b33edee864354ff2e7f638bc14f5118ebee95b1daa6160c7cddb9941ea)
      * src/crypto/store/memory-crypto-store.ts
        [memory-crypto-store.ts](#diff-85324a5a5b04d29bb19e361e35d4770071d7dea0ebad2a2eb2a823c1cd6ec090)
    - verification

      * src/crypto/verification/Base.ts
        [Base.ts](#diff-a53c594ab3ded5b451c0ba58dcc1deec10893130c8dd975d6440f817f16ba4f4)
  + src/event-mapper.ts
    [event-mapper.ts](#diff-48935348fb6740bc9d410752ce630c31f91f2d3b48d012908cda6501113cad26)
  + models

    - src/models/beacon.ts
      [beacon.ts](#diff-c9fd490704ecf1176038f64e016d797a18003f0692fe81afe6c0e87eb9e5ae93)
    - src/models/event.ts
      [event.ts](#diff-abae49c10d0eab16ff7e75b4c4b02c67c22d2e97cd23610589086395b7800242)
  + src/sync.ts
    [sync.ts](#diff-1b0cb46cd1fcdaacf73c771bf7eed6e00a12ee030da1dbcca4ae12842e1ecd81)

## There are no files selected for viewing

6 changes: 6 additions & 0 deletions

6
[spec/integ/matrix-client-crypto.spec.ts](#diff-a11214d99abb867611e5309e04f60cb2dd8dff6f01a4e32999019e4740d5b5b6 "spec/integ/matrix-client-crypto.spec.ts")

Show comments

[View file](/matrix-org/matrix-js-sdk/blob/a587d7c36026fe1fcf93dfff63588abee359be76/spec/integ/matrix-client-crypto.spec.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -494,6 +494,7 @@ describe("MatrixClient crypto", () => { |
|  |  | aliTestClient.expectKeyQuery({ device\_keys: { [aliUserId]: {} }, failures: {} }); |
|  |  | await aliTestClient.start(); |
|  |  | await bobTestClient.start(); |
|  |  | bobTestClient.client.crypto.deviceList.downloadKeys = () => Promise.resolve({}); |
|  |  | await firstSync(aliTestClient); |
|  |  | await aliEnablesEncryption(); |
|  |  | await aliSendsFirstMessage(); |
| Expand All | | @@ -504,6 +505,7 @@ describe("MatrixClient crypto", () => { |
|  |  | aliTestClient.expectKeyQuery({ device\_keys: { [aliUserId]: {} }, failures: {} }); |
|  |  | await aliTestClient.start(); |
|  |  | await bobTestClient.start(); |
|  |  | bobTestClient.client.crypto.deviceList.downloadKeys = () => Promise.resolve({}); |
|  |  | await firstSync(aliTestClient); |
|  |  | await aliEnablesEncryption(); |
|  |  | await aliSendsFirstMessage(); |
| Expand Down  Expand Up | | @@ -567,6 +569,7 @@ describe("MatrixClient crypto", () => { |
|  |  | aliTestClient.expectKeyQuery({ device\_keys: { [aliUserId]: {} }, failures: {} }); |
|  |  | await aliTestClient.start(); |
|  |  | await bobTestClient.start(); |
|  |  | bobTestClient.client.crypto.deviceList.downloadKeys = () => Promise.resolve({}); |
|  |  | await firstSync(aliTestClient); |
|  |  | await aliEnablesEncryption(); |
|  |  | await aliSendsFirstMessage(); |
| Expand All | | @@ -584,6 +587,9 @@ describe("MatrixClient crypto", () => { |
|  |  | await firstSync(bobTestClient); |
|  |  | await aliEnablesEncryption(); |
|  |  | await aliSendsFirstMessage(); |
|  |  | bobTestClient.httpBackend.when('POST', '/keys/query').respond( |
|  |  | 200, {}, |
|  |  | ); |
|  |  | await bobRecvMessage(); |
|  |  | await bobEnablesEncryption(); |
|  |  | const ciphertext = await bobSendsReplyMessage(); |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[spec/integ/matrix-client-syncing.spec.ts](#diff-563bd9cac559eedaed83746761f1c4d339c1eae20158766e7cea48a72ad37247 "spec/integ/matrix-client-syncing.spec.ts")

Show comments

[View file](/matrix-org/matrix-js-sdk/blob/a587d7c36026fe1fcf93dfff63588abee359be76/spec/integ/matrix-client-syncing.spec.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -87,6 +87,8 @@ describe("MatrixClient syncing", () => { |
|  |  | }); |
|  |  |  |
|  |  | it("should emit RoomEvent.MyMembership for invite->leave->invite cycles", async () => { |
|  |  | await client.initCrypto(); |
|  |  |  |
|  |  | const roomId = "!cycles:example.org"; |
|  |  |  |
|  |  | // First sync: an invite |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a587d7c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fcommit%2Fa587d7c36026fe1fcf93dfff63588abee359be76) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


