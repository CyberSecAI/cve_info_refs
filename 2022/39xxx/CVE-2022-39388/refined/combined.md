=== Content from github.com_e5cdb465_20250114_230432.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fcommit%2F9a643e270421560afb2630e00f76d46a55499df9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fcommit%2F9a643e270421560afb2630e00f76d46a55499df9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=istio%2Fistio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[istio](/istio)
/
**[istio](/istio/istio)**
Public

* [Notifications](/login?return_to=%2Fistio%2Fistio) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fistio%2Fistio)
* [Star
   36.3k](/login?return_to=%2Fistio%2Fistio)

* [Code](/istio/istio)
* [Issues
  461](/istio/istio/issues)
* [Pull requests
  39](/istio/istio/pulls)
* [Discussions](/istio/istio/discussions)
* [Actions](/istio/istio/actions)
* [Wiki](/istio/istio/wiki)
* [Security](/istio/istio/security)
* [Insights](/istio/istio/pulse)

Additional navigation options

* [Code](/istio/istio)
* [Issues](/istio/istio/issues)
* [Pull requests](/istio/istio/pulls)
* [Discussions](/istio/istio/discussions)
* [Actions](/istio/istio/actions)
* [Wiki](/istio/istio/wiki)
* [Security](/istio/istio/security)
* [Insights](/istio/istio/pulse)

## Commit

[Permalink](/istio/istio/commit/9a643e270421560afb2630e00f76d46a55499df9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[release-1.15] fix localhost address check in xfcc authenticator ([#41210](https://github.com/istio/istio/pull/41210)

[Browse files](/istio/istio/tree/9a643e270421560afb2630e00f76d46a55499df9)
Browse the repository at this point in the history

```
)

* fix localhost address check in xfcc authenticator

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* fix log

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* fix ut

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* move up

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>
Co-authored-by: Rama Chavali <rama.rao@salesforce.com>
```

* Loading branch information

[![@istio-testing](https://avatars.githubusercontent.com/u/25311884?s=40&v=4)](/istio-testing) [![@ramaraochavali](https://avatars.githubusercontent.com/u/17204904?s=40&v=4)](/ramaraochavali)

[istio-testing](/istio/istio/commits?author=istio-testing "View all commits by istio-testing")
and
[ramaraochavali](/istio/istio/commits?author=ramaraochavali "View all commits by ramaraochavali")
authored
Sep 29, 2022

1 parent
[87e9851](/istio/istio/commit/87e9851f804285036cac55d86342d7b9058bf215)

commit 9a643e2

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**22 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* security/pkg/server/ca/authenticate

  + security/pkg/server/ca/authenticate/xfcc\_authenticator.go
    [xfcc\_authenticator.go](#diff-18385ba6babe7c8859bd23373633b8e3bc62be33b66dbc73dd940f20e8092e84)
  + security/pkg/server/ca/authenticate/xfcc\_authenticator\_test.go
    [xfcc\_authenticator\_test.go](#diff-a26aca15a3e41b678a0bbfdb68dd8010a8dc347729e0047d1903a5a1400cbd2e)

## There are no files selected for viewing

10 changes: 8 additions & 2 deletions

10
[security/pkg/server/ca/authenticate/xfcc\_authenticator.go](#diff-18385ba6babe7c8859bd23373633b8e3bc62be33b66dbc73dd940f20e8092e84 "security/pkg/server/ca/authenticate/xfcc_authenticator.go")

Show comments

[View file](/istio/istio/blob/9a643e270421560afb2630e00f76d46a55499df9/security/pkg/server/ca/authenticate/xfcc_authenticator.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -26,6 +26,7 @@ import ( |
|  |  |  |
|  |  | "istio.io/istio/pilot/pkg/features" |
|  |  | "istio.io/istio/pkg/security" |
|  |  | "istio.io/pkg/log" |
|  |  | ) |
|  |  |  |
|  |  | const ( |
| Expand Down  Expand Up | | @@ -92,13 +93,18 @@ func buildSecurityCaller(xfccHeader string) (\*security.Caller, error) { |
|  |  | } |
|  |  |  |
|  |  | func isTrustedAddress(addr string, trustedCidrs []string) bool { |
|  |  | ip, \_, err := net.SplitHostPort(addr) |
|  |  | if err != nil { |
|  |  | log.Warnf("peer address %s can not be split in to proper host and port", addr) |
|  |  | return false |
|  |  | } |
|  |  | for \_, cidr := range trustedCidrs { |
|  |  | if isInRange(addr, cidr) { |
|  |  | if isInRange(ip, cidr) { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | // Always trust local host addresses. |
|  |  | return net.ParseIP(addr).IsLoopback() |
|  |  | return net.ParseIP(ip).IsLoopback() |
|  |  | } |
|  |  |  |
|  |  | func isInRange(addr, cidr string) bool { |
| Expand Down | |  |

19 changes: 14 additions & 5 deletions

19
[security/pkg/server/ca/authenticate/xfcc\_authenticator\_test.go](#diff-a26aca15a3e41b678a0bbfdb68dd8010a8dc347729e0047d1903a5a1400cbd2e "security/pkg/server/ca/authenticate/xfcc_authenticator_test.go")

Show comments

[View file](/istio/istio/blob/9a643e270421560afb2630e00f76d46a55499df9/security/pkg/server/ca/authenticate/xfcc_authenticator_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,6 +16,7 @@ package authenticate |
|  |  |  |
|  |  | import ( |
|  |  | "net" |
|  |  | "net/netip" |
|  |  | "reflect" |
|  |  | "strings" |
|  |  | "testing" |
| Expand All | | @@ -36,11 +37,18 @@ func TestIsTrustedAddress(t \*testing.T) { |
|  |  | trusted bool |
|  |  | }{ |
|  |  | { |
|  |  | name: "localhost client", |
|  |  | name: "localhost client with port", |
|  |  | cidr: "", |
|  |  | peer: "127.0.0.1", |
|  |  | peer: "127.0.0.1:9901", |
|  |  | trusted: true, |
|  |  | }, |
|  |  | { |
|  |  | // Should never happen, added test case for testing it. |
|  |  | name: "localhost client without port", |
|  |  | cidr: "", |
|  |  | peer: "127.0.0.1", |
|  |  | trusted: false, |
|  |  | }, |
|  |  | { |
|  |  | name: "external client without trusted cidr", |
|  |  | cidr: "", |
| Expand All | | @@ -50,13 +58,13 @@ func TestIsTrustedAddress(t \*testing.T) { |
|  |  | { |
|  |  | name: "cidr in range", |
|  |  | cidr: "172.17.0.0/16,192.17.0.0/16", |
|  |  | peer: "172.17.0.2", |
|  |  | peer: "172.17.0.2:9901", |
|  |  | trusted: true, |
|  |  | }, |
|  |  | { |
|  |  | name: "cidr in range with both ipv6 and ipv4", |
|  |  | cidr: "172.17.0.0/16,2001:db8:1234:1a00::/56", |
|  |  | peer: "2001:0db8:1234:1aff:ffff:ffff:ffff:ffff", |
|  |  | peer: "[2001:0db8:1234:1a00:0000:0000:0000:0000]:80", |
|  |  | trusted: true, |
|  |  | }, |
|  |  | { |
| Expand Down  Expand Up | | @@ -130,7 +138,8 @@ func TestXfccAuthenticator(t \*testing.T) { |
|  |  | if len(tt.xfccHeader) > 0 { |
|  |  | md.Append(xfccparser.ForwardedClientCertHeader, tt.xfccHeader) |
|  |  | } |
|  |  | ctx := peer.NewContext(context.Background(), &peer.Peer{Addr: &net.IPAddr{IP: net.ParseIP("127.0.0.1").To4()}}) |
|  |  | addr := net.TCPAddrFromAddrPort(netip.MustParseAddrPort("127.0.0.1:2301")) |
|  |  | ctx := peer.NewContext(context.Background(), &peer.Peer{Addr: addr}) |
|  |  | ctx = metadata.NewIncomingContext(ctx, md) |
|  |  | result, err := auth.Authenticate(security.AuthContext{GrpcContext: ctx}) |
|  |  | if len(tt.authenticateErrMsg) > 0 { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9a643e2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fcommit%2F9a643e270421560afb2630e00f76d46a55499df9) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from istio.io_cc05065e_20250114_230434.html ===


* About
  + [Service mesh](/latest/about/service-mesh)
  + [Solutions](/latest/about/solutions)
  + [Case studies](/latest/about/case-studies)
  + [Ecosystem](/latest/about/ecosystem)
  + [Deployment](/latest/about/deployment)
  + [Training](/latest/about/training)
  + [FAQ](/latest/about/faq)
* [Blog](/latest/blog/)
* [News](/latest/news/)
* [Get involved](/latest/get-involved/)
* [Documentation](/latest/docs/)

[Try Istio](/latest/docs/setup/getting-started)

# Announcing Istio 1.15.3

Istio 1.15.3 patch release.

Oct 27, 2022

This release contains bug fixes to improve robustness. This release note describes what’s different between Istio 1.15.2 and Istio 1.15.3.

[##### BEFORE YOU UPGRADE

Things to know and prepare before upgrading.](/latest/news/releases/1.15.x/announcing-1.15/upgrade-notes/)##### DOWNLOAD

Download and install this release.[##### DOCS

Visit the documentation for this release.](https://archive.istio.io/v1.15/docs)[##### SOURCE CHANGES

Inspect the full set of source code changes.](https://github.com/istio/istio/compare/1.15.2...1.15.3)
## Changes

* **Updated** the default value for `TRUSTED_GATEWAY_CIDR`. Previously this was empty, which caused the XFCC authenticator to reject non-loopback requests.
* **Added** validation warnings when a `DestinationRule` specifies failover policies but does not provide an outlier detection policy. Previously, istiod was silently ignoring the failover settings.
* **Fixed** an issue causing `kube-inject` to crash when the pod annotation `proxy.istio.io/config` is set.
* **Fixed** an issue with a missing `service_name` in the Telemetry API when configuring a Datadog tracing provider. ([Issue #38573](https://github.com/istio/istio/issues/38573))
* **Fixed** an issue where an incorrect schema configuration caused the Istio Operator to go into an error loop. ([Issue #40876](https://github.com/istio/istio/issues/40876))
* **Fixed** network port forward issue to support IPv4 and IPv6. ([Issue #40605](https://github.com/istio/istio/issues/40605))
[1.15.4](/latest/news/releases/1.15.x/announcing-1.15.4/ "Istio 1.15.4 patch release.")[1.15.2](/latest/news/releases/1.15.x/announcing-1.15.2/ "Istio 1.15.2 patch release.")

---

English中文Українська

* [Terms and Conditions](https://www.linuxfoundation.org/legal/terms)|
  [Privacy policy](https://www.linuxfoundation.org/legal/privacy-policy)|
  [Trademarks](https://www.linuxfoundation.org/legal/trademark-usage)|
  [Edit this Page on GitHub](https://github.com/istio/istio.io/edit/release-1.24/content/en/news/releases/1.15.x/announcing-1.15.3/index.md)

© 2024 the Istio Authors.
Version
Istio
1.24.2

* next release
* [older releases](https://istio.io/archive)


=== Content from github.com_6b84ca61_20250114_230433.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fsecurity%2Fadvisories%2FGHSA-6c6p-h79f-g6p4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fsecurity%2Fadvisories%2FGHSA-6c6p-h79f-g6p4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=istio%2Fistio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[istio](/istio)
/
**[istio](/istio/istio)**
Public

* [Notifications](/login?return_to=%2Fistio%2Fistio) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fistio%2Fistio)
* [Star
   36.3k](/login?return_to=%2Fistio%2Fistio)

* [Code](/istio/istio)
* [Issues
  461](/istio/istio/issues)
* [Pull requests
  39](/istio/istio/pulls)
* [Discussions](/istio/istio/discussions)
* [Actions](/istio/istio/actions)
* [Wiki](/istio/istio/wiki)
* [Security](/istio/istio/security)
* [Insights](/istio/istio/pulse)

Additional navigation options

* [Code](/istio/istio)
* [Issues](/istio/istio/issues)
* [Pull requests](/istio/istio/pulls)
* [Discussions](/istio/istio/discussions)
* [Actions](/istio/istio/actions)
* [Wiki](/istio/istio/wiki)
* [Security](/istio/istio/security)
* [Insights](/istio/istio/pulse)

# Identity impersonation if user has localhost access

High

[howardjohn](/howardjohn)
published
GHSA-6c6p-h79f-g6p4
Nov 9, 2022

## Package

Istio

## Affected versions

1.15.2

## Patched versions

1.15.3

## Description

### Impact

User can impersonate any workload identity within the service mesh if they have localhost access to the Istiod control plane.

### Patches

1.15.3

### Workarounds

No. If using 1.15.2 please upgrade to 1.15.3 or later.

### References

None at this time.

### For more information

If you have any questions or comments about this advisory, please email us at istio-security-vulnerability-reports@googlegroups.com

### Severity

High

7.6

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Adjacent

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:C/C:H/I:L/A:N

### CVE ID

CVE-2022-39388

### Weaknesses

No CWEs

### Credits

* [![@howardjohn](https://avatars.githubusercontent.com/u/623453?s=40&v=4)](/howardjohn)
  [howardjohn](/howardjohn)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_553250b5_20250114_230430.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fcommit%2F346260e5115e9fbc65ba8a559bc686e6ca046a32)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fcommit%2F346260e5115e9fbc65ba8a559bc686e6ca046a32)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=istio%2Fistio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[istio](/istio)
/
**[istio](/istio/istio)**
Public

* [Notifications](/login?return_to=%2Fistio%2Fistio) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fistio%2Fistio)
* [Star
   36.3k](/login?return_to=%2Fistio%2Fistio)

* [Code](/istio/istio)
* [Issues
  461](/istio/istio/issues)
* [Pull requests
  39](/istio/istio/pulls)
* [Discussions](/istio/istio/discussions)
* [Actions](/istio/istio/actions)
* [Wiki](/istio/istio/wiki)
* [Security](/istio/istio/security)
* [Insights](/istio/istio/pulse)

Additional navigation options

* [Code](/istio/istio)
* [Issues](/istio/istio/issues)
* [Pull requests](/istio/istio/pulls)
* [Discussions](/istio/istio/discussions)
* [Actions](/istio/istio/actions)
* [Wiki](/istio/istio/wiki)
* [Security](/istio/istio/security)
* [Insights](/istio/istio/pulse)

## Commit

[Permalink](/istio/istio/commit/346260e5115e9fbc65ba8a559bc686e6ca046a32)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

add xfcc authenticator ([#39405](https://github.com/istio/istio/pull/39405))

[Browse files](/istio/istio/tree/346260e5115e9fbc65ba8a559bc686e6ca046a32)
Browse the repository at this point in the history

```
* add xfcc authenticator

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* go mod

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* lint

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* add license

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* fix

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* fix folder

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* add copying file

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* remove COPYING

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* address review comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* address comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* add cidr authenticator

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* lint

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* minor changes

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* add more comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* update based on review comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* fix test

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* address comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* address comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* review comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* add authentication manager

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* add test

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* fix test

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* fix test

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* address comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>

* address comments

Signed-off-by: Rama Chavali <rama.rao@salesforce.com>
```

* Loading branch information

[![@ramaraochavali](https://avatars.githubusercontent.com/u/17204904?s=40&v=4)](/ramaraochavali)

[ramaraochavali](/istio/istio/commits?author=ramaraochavali "View all commits by ramaraochavali")
authored
Jul 14, 2022

1 parent
[dc020d6](/istio/istio/commit/dc020d6d3fdf4a82e3b3084d487938acde83692b)

commit 346260e

 Show file tree

 Hide file tree

Showing
**15 changed files**
with
**393 additions**
and
**53 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* go.mod
  [go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6)
* go.sum
  [go.sum](#diff-3295df7234525439d778f1b282d146a4f1ff6b415248aaac074e8042d9f42d63)
* licenses/github.com

  + alecholmes/xfccparser

    - licenses/github.com/alecholmes/xfccparser/LICENSE
      [LICENSE](#diff-75514b0e99899f679ceda91ccd69fe975f96047cdc3606b0d1d23f1b79444094)
  + alecthomas/participle

    - licenses/github.com/alecthomas/participle/COPYING
      [COPYING](#diff-520c3f791e77fe4d8379a434daac7884af326ac1a5412f6962073ed273b6f46f)
* pilot/pkg

  + bootstrap

    - pilot/pkg/bootstrap/server.go
      [server.go](#diff-91e0a18a58ea36d2c656d7b2706c52917a74103820c07fc843f48a110c847678)
  + features

    - pilot/pkg/features/pilot.go
      [pilot.go](#diff-9143a1687e478c724e08d62006d80b0065c4771961ee34924ff60a8843ab09e3)
  + xds

    - pilot/pkg/xds/auth.go
      [auth.go](#diff-d505ceee0b29eaba489f89b32ca024c2103ef43a07b06d1566e4927d1f248001)
* pkg/security

  + pkg/security/security.go
    [security.go](#diff-545c8e3aa8a9d4fd92409061fee8e80019a1386a4b5e48371b9ef428d97fd225)
* security/pkg

  + nodeagent

    - caclient/providers/citadel

      * security/pkg/nodeagent/caclient/providers/citadel/client\_test.go
        [client\_test.go](#diff-35f16bfde5a06a2d0ae4945f115cf95865649d7b1c96f0d65acb91f04477076b)
    - test/mock

      * security/pkg/nodeagent/test/mock/caserver.go
        [caserver.go](#diff-7e3a929c30edc678dc8a631f6dbc7f874195326df0ed51be65db01fd6cf59800)
  + server/ca

    - authenticate

      * security/pkg/server/ca/authenticate/cert\_authenticator.go
        [cert\_authenticator.go](#diff-33f131fd9300aa998ba110f2d47974ef87885c149fb51d1cc58ed98cda0206aa)
      * security/pkg/server/ca/authenticate/xfcc\_authenticator.go
        [xfcc\_authenticator.go](#diff-18385ba6babe7c8859bd23373633b8e3bc62be33b66dbc73dd940f20e8092e84)
      * security/pkg/server/ca/authenticate/xfcc\_authenticator\_test.go
        [xfcc\_authenticator\_test.go](#diff-a26aca15a3e41b678a0bbfdb68dd8010a8dc347729e0047d1903a5a1400cbd2e)
    - security/pkg/server/ca/server.go
      [server.go](#diff-ee349bb45cd373c58a8294e86d1254dda216805c78b9c6143e435dd8b0a044b9)
    - security/pkg/server/ca/server\_test.go
      [server\_test.go](#diff-2569cf8b5d6962606775e36f5149f04465c11168f0e863d4ca3f95108b02e339)

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6 "go.mod")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/go.mod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -120,6 +120,8 @@ require ( |
|  |  | github.com/PuerkitoBio/purell v1.1.1 // indirect |
|  |  | github.com/PuerkitoBio/urlesc v0.0.0-20170810143723-de5bf2ad4578 // indirect |
|  |  | github.com/VividCortex/ewma v1.1.1 // indirect |
|  |  | github.com/alecholmes/xfccparser v0.1.0 |
|  |  | github.com/alecthomas/participle v0.4.1 // indirect |
|  |  | github.com/antlr/antlr4/runtime/Go/antlr v0.0.0-20220418222510-f25a4f6275ed // indirect |
|  |  | github.com/asaskevich/govalidator v0.0.0-20210307081110-f21760c49a8d // indirect |
|  |  | github.com/beorn7/perks v1.0.1 // indirect |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[go.sum](#diff-3295df7234525439d778f1b282d146a4f1ff6b415248aaac074e8042d9f42d63 "go.sum")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/go.sum)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -257,7 +257,14 @@ github.com/afex/hystrix-go v0.0.0-20180502004556-fa1af6a1f4f5/go.mod h1:SkGFH1ia |
|  |  | github.com/agext/levenshtein v1.2.3/go.mod h1:JEDfjyjHDjOF/1e4FlBE/PkbqA9OfWu2ki2W0IB5558= |
|  |  | github.com/agnivade/levenshtein v1.0.1/go.mod h1:CURSv5d9Uaml+FovSIICkLbAUZ9S4RqaHDIsdSBg7lM= |
|  |  | github.com/ahmetb/gen-crd-api-reference-docs v0.3.0/go.mod h1:TdjdkYhlOifCQWPs1UdTma97kQQMozf5h26hTuG70u8= |
|  |  | github.com/alecholmes/xfccparser v0.1.0 h1:/PBnzDBxfHJ66AinLNglzZH4oWLrc1/QTKlSoNNnei8= |
|  |  | github.com/alecholmes/xfccparser v0.1.0/go.mod h1:c1S35dudNR5aZ4Vf9zKCrEwC8iqwF4TcDAbU+RXQ5yY= |
|  |  | github.com/alecthomas/go-thrift v0.0.0-20170109061633-7914173639b2/go.mod h1:CxCgO+NdpMdi9SsTlGbc0W+/UNxO3I0AabOEJZ3w61w= |
|  |  | github.com/alecthomas/kingpin v2.2.6+incompatible/go.mod h1:59OFYbFVLKQKq+mqrL6Rw5bR0c3ACQaawgXx0QYndlE= |
|  |  | github.com/alecthomas/kong v0.2.1/go.mod h1:+inYUSluD+p4L8KdviBSgzcqEjUQOfC5fQDRFuc36lI= |
|  |  | github.com/alecthomas/participle v0.4.1 h1:P2PJWzwrSpuCWXKnzqvw0b0phSfH1kJo4p2HvLynVsI= |
|  |  | github.com/alecthomas/participle v0.4.1/go.mod h1:T8u4bQOSMwrkTWOSyt8/jSFPEnRtd0FKFMjVfYBlqPs= |
|  |  | github.com/alecthomas/repr v0.0.0-20181024024818-d37bc2a10ba1/go.mod h1:xTS7Pm1pD1mvyM075QCDSRqH6qRLXylzS24ZTpRiSzQ= |
|  |  | github.com/alecthomas/template v0.0.0-20160405071501-a0175ee3bccc/go.mod h1:LOuyumcjzFXgccqObfd/Ljyb9UuFJ6TxHnclSeseNhc= |
|  |  | github.com/alecthomas/template v0.0.0-20190718012654-fb15b899a751/go.mod h1:LOuyumcjzFXgccqObfd/Ljyb9UuFJ6TxHnclSeseNhc= |
|  |  | github.com/alecthomas/units v0.0.0-20151022065526-2efee857e7cf/go.mod h1:ybxpYRFXyAe+OPACYpWeL0wqObRcbAqCMya13uyzqw0= |
| Expand Down | |  |

21 changes: 21 additions & 0 deletions

21
[licenses/github.com/alecholmes/xfccparser/LICENSE](#diff-75514b0e99899f679ceda91ccd69fe975f96047cdc3606b0d1d23f1b79444094 "licenses/github.com/alecholmes/xfccparser/LICENSE")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/licenses/github.com/alecholmes/xfccparser/LICENSE)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,21 @@ |
|  |  | MIT License |
|  |  |  |
|  |  | Copyright (c) 2020 Alec Holmes |
|  |  |  |
|  |  | Permission is hereby granted, free of charge, to any person obtaining a copy |
|  |  | of this software and associated documentation files (the "Software"), to deal |
|  |  | in the Software without restriction, including without limitation the rights |
|  |  | to use, copy, modify, merge, publish, distribute, sublicense, and/or sell |
|  |  | copies of the Software, and to permit persons to whom the Software is |
|  |  | furnished to do so, subject to the following conditions: |
|  |  |  |
|  |  | The above copyright notice and this permission notice shall be included in all |
|  |  | copies or substantial portions of the Software. |
|  |  |  |
|  |  | THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR |
|  |  | IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, |
|  |  | FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE |
|  |  | AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER |
|  |  | LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, |
|  |  | OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE |
|  |  | SOFTWARE. |

19 changes: 19 additions & 0 deletions

19
[licenses/github.com/alecthomas/participle/COPYING](#diff-520c3f791e77fe4d8379a434daac7884af326ac1a5412f6962073ed273b6f46f "licenses/github.com/alecthomas/participle/COPYING")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/licenses/github.com/alecthomas/participle/COPYING)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,19 @@ |
|  |  | Copyright (C) 2017 Alec Thomas |
|  |  |  |
|  |  | Permission is hereby granted, free of charge, to any person obtaining a copy of |
|  |  | this software and associated documentation files (the "Software"), to deal in |
|  |  | the Software without restriction, including without limitation the rights to |
|  |  | use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies |
|  |  | of the Software, and to permit persons to whom the Software is furnished to do |
|  |  | so, subject to the following conditions: |
|  |  |  |
|  |  | The above copyright notice and this permission notice shall be included in all |
|  |  | copies or substantial portions of the Software. |
|  |  |  |
|  |  | THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR |
|  |  | IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, |
|  |  | FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE |
|  |  | AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER |
|  |  | LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, |
|  |  | OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE |
|  |  | SOFTWARE. |

3 changes: 3 additions & 0 deletions

3
[pilot/pkg/bootstrap/server.go](#diff-91e0a18a58ea36d2c656d7b2706c52917a74103820c07fc843f48a110c847678 "pilot/pkg/bootstrap/server.go")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/pilot/pkg/bootstrap/server.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -322,6 +322,9 @@ func NewServer(args \*PilotArgs, initFuncs ...func(\*Server)) (\*Server, error) { |
|  |  | // so we build it later. |
|  |  | authenticators = append(authenticators, |
|  |  | kubeauth.NewKubeJWTAuthenticator(s.environment.Watcher, s.kubeClient.Kube(), s.clusterID, s.multiclusterController.GetRemoteKubeClient, features.JwtPolicy)) |
|  |  | if len(features.TrustedGatewayCIDR) > 0 { |
|  |  | authenticators = append(authenticators, &authenticate.XfccAuthenticator{}) |
|  |  | } |
|  |  | if features.XDSAuth { |
|  |  | s.XDSServer.Authenticators = authenticators |
|  |  | } |
| Expand Down | |  |

12 changes: 12 additions & 0 deletions

12
[pilot/pkg/features/pilot.go](#diff-9143a1687e478c724e08d62006d80b0065c4771961ee34924ff60a8843ab09e3 "pilot/pkg/features/pilot.go")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/pilot/pkg/features/pilot.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -405,6 +405,18 @@ var ( |
|  |  | "If enabled, pilot will authorize XDS clients, to ensure they are acting only as namespaces they have permissions for.", |
|  |  | ).Get() |
|  |  |  |
|  |  | // TODO: Move this to proper API. |
|  |  | trustedGatewayCIDR = env.RegisterStringVar( |
|  |  | "TRUSTED\_GATEWAY\_CIDR", |
|  |  | "", |
|  |  | "If set, any connections from gateway to Istiod with this CIDR range are treated as trusted for using authenication mechanisms like XFCC."+ |
|  |  | " This can only be used when the network where Istiod and the authenticating gateways are running in a trusted/secure network", |
|  |  | ) |
|  |  |  |
|  |  | TrustedGatewayCIDR = func() []string { |
|  |  | return strings.Split(trustedGatewayCIDR.Get(), ",") |
|  |  | }() |
|  |  |  |
|  |  | EnableServiceEntrySelectPods = env.RegisterBoolVar("PILOT\_ENABLE\_SERVICEENTRY\_SELECT\_PODS", true, |
|  |  | "If enabled, service entries with selectors will select pods from the cluster. "+ |
|  |  | "It is safe to disable it if you are quite sure you don't need this feature").Get() |
| Expand Down | |  |

21 changes: 9 additions & 12 deletions

21
[pilot/pkg/xds/auth.go](#diff-d505ceee0b29eaba489f89b32ca024c2103ef43a07b06d1566e4927d1f248001 "pilot/pkg/xds/auth.go")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/pilot/pkg/xds/auth.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,7 +18,6 @@ import ( |
|  |  | "context" |
|  |  | "errors" |
|  |  | "fmt" |
|  |  | "strings" |
|  |  |  |
|  |  | "google.golang.org/grpc/codes" |
|  |  | "google.golang.org/grpc/credentials" |
| Expand All | | @@ -27,12 +26,13 @@ import ( |
|  |  |  |
|  |  | "istio.io/istio/pilot/pkg/features" |
|  |  | "istio.io/istio/pilot/pkg/model" |
|  |  | "istio.io/istio/pkg/security" |
|  |  | "istio.io/istio/pkg/spiffe" |
|  |  | "istio.io/pkg/env" |
|  |  | ) |
|  |  |  |
|  |  | var AuthPlaintext = env.RegisterBoolVar("XDS\_AUTH\_PLAINTEXT", false, |
|  |  | "Authenticate plain text requests - used if Istiod is behind a gateway handling TLS").Get() |
|  |  | "Authenticate plain text requests - used if Istiod is running on a secure/trusted network").Get() |
|  |  |  |
|  |  | // authenticate authenticates the ADS request using the configured authenticators. |
|  |  | // Returns the validated principals or an error. |
| Expand All | | @@ -56,17 +56,14 @@ func (s \*DiscoveryServer) authenticate(ctx context.Context) ([]string, error) { |
|  |  | if \_, ok := peerInfo.AuthInfo.(credentials.TLSInfo); !ok && !AuthPlaintext { |
|  |  | return nil, nil |
|  |  | } |
|  |  | authFailMsgs := []string{} |
|  |  | for \_, authn := range s.Authenticators { |
|  |  | u, err := authn.Authenticate(ctx) |
|  |  | // If one authenticator passes, return |
|  |  | if u != nil && u.Identities != nil && err == nil { |
|  |  | return u.Identities, nil |
|  |  | } |
|  |  | authFailMsgs = append(authFailMsgs, fmt.Sprintf("Authenticator %s: %v", authn.AuthenticatorType(), err)) |
|  |  | } |
|  |  |  |
|  |  | log.Errorf("Failed to authenticate client from %s: %s", peerInfo.Addr.String(), strings.Join(authFailMsgs, "; ")) |
|  |  | am := security.AuthenticationManager{ |
|  |  | Authenticators: s.Authenticators, |
|  |  | } |
|  |  | if u := am.Authenticate(ctx); u != nil { |
|  |  | return u.Identities, nil |
|  |  | } |
|  |  | log.Errorf("Failed to authenticate client from %s: %s", peerInfo.Addr.String(), am.FailedMessages()) |
|  |  | return nil, errors.New("authentication failure") |
|  |  | } |
|  |  |  |
| Expand Down | |  |

37 changes: 37 additions & 0 deletions

37
[pkg/security/security.go](#diff-545c8e3aa8a9d4fd92409061fee8e80019a1386a4b5e48371b9ef428d97fd225 "pkg/security/security.go")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/pkg/security/security.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,11 +23,14 @@ import ( |
|  |  | "time" |
|  |  |  |
|  |  | "google.golang.org/grpc/metadata" |
|  |  | "google.golang.org/grpc/peer" |
|  |  |  |
|  |  | "istio.io/pkg/env" |
|  |  | istiolog "istio.io/pkg/log" |
|  |  | ) |
|  |  |  |
|  |  | var securityLog = istiolog.RegisterScope("security", "security debugging", 0) |
|  |  |  |
|  |  | const ( |
|  |  | // etc/certs files are used with external CA managing the certs, |
|  |  | // i.e. mounted Secret or external plugin. |
| Expand Down  Expand Up | | @@ -351,12 +354,46 @@ type Caller struct { |
|  |  | Identities []string |
|  |  | } |
|  |  |  |
|  |  | // Authenticator determines the caller identity based on request context. |
|  |  | type Authenticator interface { |
|  |  | Authenticate(ctx context.Context) (\*Caller, error) |
|  |  | AuthenticatorType() string |
|  |  | AuthenticateRequest(req \*http.Request) (\*Caller, error) |
|  |  | } |
|  |  |  |
|  |  | // AuthenticationManager orchestrates all authenticators to perform authentication. |
|  |  | type AuthenticationManager struct { |
|  |  | Authenticators []Authenticator |
|  |  | // authFailMsgs contains list of messages that authenticator wants to record - mainly used for logging. |
|  |  | authFailMsgs []string |
|  |  | } |
|  |  |  |
|  |  | // Authenticate loops through all the configured Authenticators and returns if one of the authenticator succeeds. |
|  |  | func (am \*AuthenticationManager) Authenticate(ctx context.Context) \*Caller { |
|  |  | for \_, authn := range am.Authenticators { |
|  |  | u, err := authn.Authenticate(ctx) |
|  |  | if u != nil && len(u.Identities) > 0 && err == nil { |
|  |  | securityLog.Debugf("Authentication successful through auth source %v", u.AuthSource) |
|  |  | return u |
|  |  | } |
|  |  | am.authFailMsgs = append(am.authFailMsgs, fmt.Sprintf("Authenticator %s: %v", authn.AuthenticatorType(), err)) |
|  |  | } |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | func GetConnectionAddress(ctx context.Context) string { |
|  |  | peerInfo, ok := peer.FromContext(ctx) |
|  |  | peerAddr := "unknown" |
|  |  | if ok { |
|  |  | peerAddr = peerInfo.Addr.String() |
|  |  | } |
|  |  | return peerAddr |
|  |  | } |
|  |  |  |
|  |  | func (am \*AuthenticationManager) FailedMessages() string { |
|  |  | return strings.Join(am.authFailMsgs, "; ") |
|  |  | } |
|  |  |  |
|  |  | func ExtractBearerToken(ctx context.Context) (string, error) { |
|  |  | md, ok := metadata.FromIncomingContext(ctx) |
|  |  | if !ok { |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[security/pkg/nodeagent/caclient/providers/citadel/client\_test.go](#diff-35f16bfde5a06a2d0ae4945f115cf95865649d7b1c96f0d65acb91f04477076b "security/pkg/nodeagent/caclient/providers/citadel/client_test.go")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/security/pkg/nodeagent/caclient/providers/citadel/client_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,7 +44,6 @@ import ( |
|  |  | "istio.io/istio/security/pkg/credentialfetcher/plugin" |
|  |  | "istio.io/istio/security/pkg/monitoring" |
|  |  | "istio.io/istio/security/pkg/nodeagent/util" |
|  |  | ca2 "istio.io/istio/security/pkg/server/ca" |
|  |  | ) |
|  |  |  |
|  |  | const ( |
| Expand All | | @@ -67,7 +66,8 @@ type mockCAServer struct { |
|  |  |  |
|  |  | func (ca \*mockCAServer) CreateCertificate(ctx context.Context, in \*pb.IstioCertificateRequest) (\*pb.IstioCertificateResponse, error) { |
|  |  | if ca.Authenticator != nil { |
|  |  | caller := ca2.Authenticate(ctx, []security.Authenticator{ca.Authenticator}) |
|  |  | am := security.AuthenticationManager{Authenticators: []security.Authenticator{ca.Authenticator}} |
|  |  | caller := am.Authenticate(ctx) |
|  |  | if caller == nil { |
|  |  | return nil, status.Error(codes.Unauthenticated, "request authenticate failure") |
|  |  | } |
| Expand Down | |  |

5 changes: 3 additions & 2 deletions

5
[security/pkg/nodeagent/test/mock/caserver.go](#diff-7e3a929c30edc678dc8a631f6dbc7f874195326df0ed51be65db01fd6cf59800 "security/pkg/nodeagent/test/mock/caserver.go")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/security/pkg/nodeagent/test/mock/caserver.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,7 +32,6 @@ import ( |
|  |  | "istio.io/istio/pkg/spiffe" |
|  |  | caerror "istio.io/istio/security/pkg/pki/error" |
|  |  | "istio.io/istio/security/pkg/pki/util" |
|  |  | "istio.io/istio/security/pkg/server/ca" |
|  |  | "istio.io/pkg/log" |
|  |  | ) |
|  |  |  |
| Expand Down  Expand Up | | @@ -166,8 +165,10 @@ func (s \*CAServer) CreateCertificate(ctx context.Context, request \*pb.IstioCerti |
|  |  | } |
|  |  | id := []string{"client-identity"} |
|  |  | if len(s.Authenticators) > 0 { |
|  |  | caller := ca.Authenticate(ctx, s.Authenticators) |
|  |  | am := security.AuthenticationManager{Authenticators: s.Authenticators} |
|  |  | caller := am.Authenticate(ctx) |
|  |  | if caller == nil { |
|  |  | caServerLog.Errorf("Failed to authenticate client from %s: %s", security.GetConnectionAddress(ctx), am.FailedMessages()) |
|  |  | return nil, status.Error(codes.Unauthenticated, "request authenticate failure") |
|  |  | } |
|  |  | id = caller.Identities |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[security/pkg/server/ca/authenticate/cert\_authenticator.go](#diff-33f131fd9300aa998ba110f2d47974ef87885c149fb51d1cc58ed98cda0206aa "security/pkg/server/ca/authenticate/cert_authenticator.go")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/security/pkg/server/ca/authenticate/cert_authenticator.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,10 +15,10 @@ |
|  |  | package authenticate |
|  |  |  |
|  |  | import ( |
|  |  | "context" |
|  |  | "fmt" |
|  |  | "net/http" |
|  |  |  |
|  |  | "golang.org/x/net/context" |
|  |  | "google.golang.org/grpc/credentials" |
|  |  | "google.golang.org/grpc/peer" |
|  |  |  |
| Expand Down | |  |

117 changes: 117 additions & 0 deletions

117
[security/pkg/server/ca/authenticate/xfcc\_authenticator.go](#diff-18385ba6babe7c8859bd23373633b8e3bc62be33b66dbc73dd940f20e8092e84 "security/pkg/server/ca/authenticate/xfcc_authenticator.go")

Show comments

[View file](/istio/istio/blob/346260e5115e9fbc65ba8a559bc686e6ca046a32/security/pkg/server/ca/authenticate/xfcc_authenticator.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,117 @@ |
|  |  | // Copyright Istio Authors |
|  |  | // |
|  |  | // Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | // you may not use this file except in compliance with the License. |
|  |  | // You may obtain a copy of the License at |
|  |  | // |
|  |  | // http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | // |
|  |  | // Unless required by applicable law or agreed to in writing, software |
|  |  | // distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | // See the License for the specific language governing permissions and |
|  |  | // limitations under the License. |
|  |  |  |
|  |  | package authenticate |
|  |  |  |
|  |  | import ( |
|  |  | "context" |
|  |  | "fmt" |
|  |  | "net" |
|  |  | "net/http" |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/alecholmes/xfccparser" |
|  |  | "google.golang.org/grpc/metadata" |
|  |  | "google.golang.org/grpc/peer" |
|  |  |  |
|  |  | "istio.io/istio/pilot/pkg/features" |
|  |  | "istio.io/istio/pkg/security" |
|  |  | ) |
|  |  |  |
|  |  | const ( |
|  |  | XfccAuthenticatorType = "XfccAuthenticator" |
|  |  | ) |
|  |  |  |
|  |  | // XfccAuthenticator extracts identities from Xfcc header. |
|  |  | type XfccAuthenticator struct{} |
|  |  |  |
|  |  | var \_ security.Authenticator = &XfccAuthenticator{} |
|  |  |  |
|  |  | func (xff XfccAuthenticator) AuthenticatorType() string { |
|  |  | return XfccAuthenticatorType |
|  |  | } |
|  |  |  |
|  |  | // Authenticate extracts identities from Xfcc Header. |
|  |  | func (xff XfccAuthenticator) Authenticate(ctx context.Context) (\*security.Caller, error) { |
|  |  | peerInfo, \_ := peer.FromContext(ctx) |
|  |  | // First check if client is trusted client so that we can "trust" the Xfcc Header. |
|  |  | if !isTrustedAddress(peerInfo.Addr.String(), features.TrustedGatewayCIDR) { |
|  |  | return nil, fmt.Errorf("caller from %s is not in the trusted network. XfccAuthenticator can not be used", peerInfo.Addr.String()) |
|  |  | } |
|  |  | meta, ok := metadata.FromIncomingContext(ctx) |
|  |  |  |
|  |  | if !ok || len(meta.Get(xfccparser.ForwardedClientCertHeader)) == 0 { |
|  |  | return nil, nil |
|  |  | } |
|  |  | xfccHeader := meta.Get(xfccparser.ForwardedClientCertHeader)[0] |
|  |  | return buildSecurityCaller(xfccHeader) |
|  |  | } |
|  |  |  |
|  |  | // AuthenticateRequest validates Xfcc Header. |
|  |  | func (xff XfccAuthenticator) AuthenticateRequest(req \*http.Request) (\*security.Caller, error) { |
|  |  | xfccHeader := req.Header.Get(xfccparser.ForwardedClientCertHeader) |
|  |  | if len(xfccHeader) == 0 { |
|  |  | return nil, nil |
|  |  | } |
|  |  | return buildSecurityCaller(xfccHeader) |
|  |  | } |
|  |  |  |
|  |  | func buildSecurityCaller(xfccHeader string) (\*security.Caller, error) { |
|  |  | clientCerts, err := xfccparser.ParseXFCCHeader(xfccHeader) |
|  |  | if err != nil { |
|  |  | message := fmt.Sprintf("error in parsing xfcc header: %v", err) |
|  |  | return nil, fmt.Errorf(message) |
|  |  | } |
|  |  | if len(clientCerts) == 0 { |
|  |  | message := "xfcc header does not have atleast one client certs" |
|  |  | return nil, fmt.Errorf(message) |
|  |  | } |
|  |  | ids := []string{} |
|  |  | for \_, cc := range clientCerts { |
|  |  | ids = append(ids, cc.URI) |
|  |  | ids = append(ids, cc.DNS...) |
|  |  | if cc.Subject != nil { |
|  |  | ids = append(ids, cc.Subject.CommonName) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return &security.Caller{ |
|  |  | AuthSource: security.AuthSourceClientCertificate, |
|  |  | Identities: ids, |
|  |  | }, nil |
|  |  | } |
|  |  |  |
|  |  | func isTrustedAddress(addr string, trustedCidrs []string) bool { |
|  |  | for \_, cidr := range trustedCidrs { |
|  |  | if isInRange(addr, cidr) { |
|  |  | return true |
|  |  | } |
|  |  | } |
|  |  | // Always trust local host addresses. |
|  |  | return net.ParseIP(addr).IsLoopback() |
|  |  | } |
|  |  |  |
|  |  | func isInRange(addr, cidr string) bool { |
|  |  | if strings.Contains(cidr, "/") { |
|  |  | ip, ipnet, err := net.ParseCIDR(cidr) |
|  |  | if err != nil { |
|  |  | return false |
|  |  | } |
|  |  | if ip.To4() == nil && ip.To16() == nil { |
|  |  | return false |
|  |  | } |
|  |  | return ipnet.Contains(net.ParseIP(addr)) |
|  |  | } |
|  |  | return false |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `346260e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fistio%2Fistio%2Fcommit%2F346260e5115e9fbc65ba8a559bc686e6ca046a32) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


