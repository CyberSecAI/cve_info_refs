=== Content from github.com_942d7034_20250114_222527.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSamsung%2FmTower%2Fissues%2F76)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSamsung%2FmTower%2Fissues%2F76)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=Samsung%2FmTower)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Samsung](/Samsung)
/
**[mTower](/Samsung/mTower)**
Public

* [Notifications](/login?return_to=%2FSamsung%2FmTower) You must be signed in to change notification settings
* [Fork
  17](/login?return_to=%2FSamsung%2FmTower)
* [Star
   53](/login?return_to=%2FSamsung%2FmTower)

* [Code](/Samsung/mTower)
* [Issues
  13](/Samsung/mTower/issues)
* [Pull requests
  0](/Samsung/mTower/pulls)
* [Actions](/Samsung/mTower/actions)
* [Projects
  0](/Samsung/mTower/projects)
* [Security](/Samsung/mTower/security)
* [Insights](/Samsung/mTower/pulse)

Additional navigation options

* [Code](/Samsung/mTower)
* [Issues](/Samsung/mTower/issues)
* [Pull requests](/Samsung/mTower/pulls)
* [Actions](/Samsung/mTower/actions)
* [Projects](/Samsung/mTower/projects)
* [Security](/Samsung/mTower/security)
* [Insights](/Samsung/mTower/pulse)

# Security: Lacking a check for the return value of EC\_KEY\_set\_private\_key() #76

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Security: Lacking a check for the return value of EC\_KEY\_set\_private\_key()](#top)#76Copy linkAssignees [![tdrozdovsky](https://avatars.githubusercontent.com/u/45031429?s=64&v=4)](/tdrozdovsky)![@UVScan](https://avatars.githubusercontent.com/u/112676446?v=4&size=80)
## Description

![@UVScan](https://avatars.githubusercontent.com/u/112676446?v=4&size=48)[UVScan](https://github.com/UVScan)opened [on Sep 2, 2022](https://github.com/Samsung/mTower/issues/76#issue-1359668903)
# Affected components

affected source code file: tools/fwinfogen.c

# Attack vector(s)

Lacking a check for the return value of EC\_KEY\_set\_private\_key.

EC\_KEY\_set\_private\_key() returns 1 on success or 0 on error except when the priv\_key argument is NULL, in that case it returns 0, for legacy compatibility, and should not be treated as an error.

# Suggested description of the vulnerability for use in the CVE

DoS vulnerability in sign\_pFwInfo() function in Samsung Electronics mTower v0.3.0 (and earlier) due to a missing check on the return value of EC\_KEY\_set\_private\_key.

# Discoverer(s)/Credits

UVScan

# Reference(s)

<https://www.openssl.org/docs/manmaster/man3/EC_KEY_set_private_key.html>

[mTower/tools/fwinfogen.c](https://github.com/Samsung/mTower/blob/18f4b592a8a973ce5972f4e2658ea0f6e3686284/tools/fwinfogen.c#L193)

Line 193
in
[18f4b59](/Samsung/mTower/commit/18f4b592a8a973ce5972f4e2658ea0f6e3686284)

|  | EC\_KEY\_set\_private\_key(eckey, d); |
| --- | --- |

## Metadata

### Assignees

* [![@tdrozdovsky](https://avatars.githubusercontent.com/u/45031429?s=64&v=4)tdrozdovsky](/tdrozdovsky)
### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9fbce8f3_20250114_222526.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSamsung%2FmTower%2Fblob%2F18f4b592a8a973ce5972f4e2658ea0f6e3686284%2Ftools%2Ffwinfogen.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSamsung%2FmTower%2Fblob%2F18f4b592a8a973ce5972f4e2658ea0f6e3686284%2Ftools%2Ffwinfogen.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=Samsung%2FmTower)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Samsung](/Samsung)
/
**[mTower](/Samsung/mTower)**
Public

* [Notifications](/login?return_to=%2FSamsung%2FmTower) You must be signed in to change notification settings
* [Fork
  17](/login?return_to=%2FSamsung%2FmTower)
* [Star
   53](/login?return_to=%2FSamsung%2FmTower)

* [Code](/Samsung/mTower)
* [Issues
  13](/Samsung/mTower/issues)
* [Pull requests
  0](/Samsung/mTower/pulls)
* [Actions](/Samsung/mTower/actions)
* [Projects
  0](/Samsung/mTower/projects)
* [Security](/Samsung/mTower/security)
* [Insights](/Samsung/mTower/pulse)

Additional navigation options

* [Code](/Samsung/mTower)
* [Issues](/Samsung/mTower/issues)
* [Pull requests](/Samsung/mTower/pulls)
* [Actions](/Samsung/mTower/actions)
* [Projects](/Samsung/mTower/projects)
* [Security](/Samsung/mTower/security)
* [Insights](/Samsung/mTower/pulse)

## Files

 18f4b59
## Breadcrumbs

1. [mTower](/Samsung/mTower/tree/18f4b592a8a973ce5972f4e2658ea0f6e3686284)
2. /[tools](/Samsung/mTower/tree/18f4b592a8a973ce5972f4e2658ea0f6e3686284/tools)
/
# fwinfogen.c

Copy path Blame  Blame
## Latest commit

## History

[History](/Samsung/mTower/commits/18f4b592a8a973ce5972f4e2658ea0f6e3686284/tools/fwinfogen.c)499 lines (426 loc) · 14.6 KB 18f4b59
## Breadcrumbs

1. [mTower](/Samsung/mTower/tree/18f4b592a8a973ce5972f4e2658ea0f6e3686284)
2. /[tools](/Samsung/mTower/tree/18f4b592a8a973ce5972f4e2658ea0f6e3686284/tools)
/
# fwinfogen.c

Top
## File metadata and controls

* Code
* Blame

499 lines (426 loc) · 14.6 KB[Raw](https://github.com/Samsung/mTower/raw/18f4b592a8a973ce5972f4e2658ea0f6e3686284/tools/fwinfogen.c)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498/\*\* \* @file tools/fwinfogen.c \* @brief . \* \* @copyright Copyright (c) 2019 Samsung Electronics Co., Ltd. All Rights Reserved. \* @author Taras Drozdovskyi t.drozdovsky@samsung.com \* \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* \* http://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*/
/\* Included Files. \*/#include <stdio.h>#include <stdint.h>#include <stdlib.h>#include <string.h>
#include <openssl/sha.h>#include <openssl/ec.h> // for EC\_GROUP\_new\_by\_curve\_name, EC\_GROUP\_free, EC\_KEY\_new, EC\_KEY\_set\_group, EC\_KEY\_generate\_key, EC\_KEY\_free#include <openssl/ecdsa.h> // for ECDSA\_do\_sign, ECDSA\_do\_verify#include <openssl/obj\_mac.h> // for NID\_secp192k1
#include "config.h"//#include "version.h"
/\* Pre-processor Definitions. \*/#define BUILD\_MONTH\_IS\_JAN (\_\_DATE\_\_[0] == 'J' && \_\_DATE\_\_[1] == 'a' && \_\_DATE\_\_[2] == 'n')#define BUILD\_MONTH\_IS\_FEB (\_\_DATE\_\_[0] == 'F')#define BUILD\_MONTH\_IS\_MAR (\_\_DATE\_\_[0] == 'M' && \_\_DATE\_\_[1] == 'a' && \_\_DATE\_\_[2] == 'r')#define BUILD\_MONTH\_IS\_APR (\_\_DATE\_\_[0] == 'A' && \_\_DATE\_\_[1] == 'p')#define BUILD\_MONTH\_IS\_MAY (\_\_DATE\_\_[0] == 'M' && \_\_DATE\_\_[1] == 'a' && \_\_DATE\_\_[2] == 'y')#define BUILD\_MONTH\_IS\_JUN (\_\_DATE\_\_[0] == 'J' && \_\_DATE\_\_[1] == 'u' && \_\_DATE\_\_[2] == 'n')#define BUILD\_MONTH\_IS\_JUL (\_\_DATE\_\_[0] == 'J' && \_\_DATE\_\_[1] == 'u' && \_\_DATE\_\_[2] == 'l')#define BUILD\_MONTH\_IS\_AUG (\_\_DATE\_\_[0] == 'A' && \_\_DATE\_\_[1] == 'u')#define BUILD\_MONTH\_IS\_SEP (\_\_DATE\_\_[0] == 'S')#define BUILD\_MONTH\_IS\_OCT (\_\_DATE\_\_[0] == 'O')#define BUILD\_MONTH\_IS\_NOV (\_\_DATE\_\_[0] == 'N')#define BUILD\_MONTH\_IS\_DEC (\_\_DATE\_\_[0] == 'D')
#define BUILD\_MONTH \ ( \ (BUILD\_MONTH\_IS\_JAN) ? 1 : \ (BUILD\_MONTH\_IS\_FEB) ? 2 : \ (BUILD\_MONTH\_IS\_MAR) ? 3 : \ (BUILD\_MONTH\_IS\_APR) ? 4 : \ (BUILD\_MONTH\_IS\_MAY) ? 5 : \ (BUILD\_MONTH\_IS\_JUN) ? 6 : \ (BUILD\_MONTH\_IS\_JUL) ? 7 : \ (BUILD\_MONTH\_IS\_AUG) ? 8 : \ (BUILD\_MONTH\_IS\_SEP) ? 9 : \ (BUILD\_MONTH\_IS\_OCT) ? 16 : \ (BUILD\_MONTH\_IS\_NOV) ? 17 : \ (BUILD\_MONTH\_IS\_DEC) ? 18 : \ /\* error default \*/ 0 \ )
#define BUILD\_DAY\_CH0 ((\_\_DATE\_\_[4] >= '0') ? (\_\_DATE\_\_[4]) : '0')#define BUILD\_DAY\_CH1 (\_\_DATE\_\_[ 5])
#define DATE\_COMPILE (((\_\_DATE\_\_[7] - '0') << 28) \ | (((unsigned int)(\_\_DATE\_\_[8] - '0')) << 24) \ | (((unsigned int)(\_\_DATE\_\_[9] - '0')) << 20) \ | (((unsigned int)(\_\_DATE\_\_[10] - '0')) << 16) \ | (((unsigned int)(BUILD\_MONTH)) << 8) \ | (((unsigned int)(((\_\_DATE\_\_[4] >= '0') ? (\_\_DATE\_\_[4]) : '0') - '0')) << 4) \ | (((unsigned int)\_\_DATE\_\_[5] - '0')))
#define BL33\_METADATA\_ADDRESS (0x10080000 - CONFIG\_START\_ADDRESS\_BL33 - 0x8000)
/\*\* Instruction Code of "B ." \*/
/\* Private Types. \*//\* Any types, enums, structures or unions used by the file are defined here. \*//\* typedef for NonSecure callback functions \*/
/\*\* \* @details ECC public key structure \*/typedef struct { uint32\_t au32Key0[8]; /\* 256-bits \*/ uint32\_t au32Key1[8]; /\* 256-bits \*/}\_\_attribute\_\_((packed)) ECC\_PUBKEY\_T;
/\*\* \* @details ECC ECDSA signature structure \*/typedef struct { uint32\_t au32R[8]; /\* 256-bits \*/ uint32\_t au32S[8]; /\* 256-bits \*/}\_\_attribute\_\_((packed)) ECDSA\_SIGN\_T;
typedef struct { uint32\_t u32Start; /\* 32-bits \*/ uint32\_t u32Size; /\* 32-bits \*/}\_\_attribute\_\_((packed)) FW\_REGION\_T;
typedef struct { uint32\_t u32AuthCFGs; /\* 32-bits \*/ /\* bit[1:0]: Reserved bit[2]: 1: Info Hash includes PDID / 0: Not include PDID bit[3]: 1: Info Hash includes UID / 0: Not include UID bit[4]: 1: Info Hash inculdes UICD / 0: Not include UICD bit[31:5]: Reserved \*/ uint32\_t u32FwRegionLen; /\* 32-bits \*/ FW\_REGION\_T au32FwRegion[1]; /\* (8\*1) bytes \*/ uint32\_t u32ExtInfoLen; /\* 32-bits \*/ uint32\_t au32ExtInfo[3]; /\* 12-bytes \*/}\_\_attribute\_\_((packed)) METADATA\_T;
typedef struct { ECC\_PUBKEY\_T pubkey; /\* 64-bytes (256-bits + 256-bits) \*/
 METADATA\_T mData; /\* includes authenticate configuration, F/W regions and extend info \*/
 uint32\_t au32FwHash[8]; /\* 32-bytes (256-bits) \*/
 ECDSA\_SIGN\_T sign; /\* 64-bytes (256-bits R + 256-bits S) \*/}\_\_attribute\_\_((packed)) FW\_INFO\_T;
/\*\* \* @details ECC ECDSA key structure \*/typedef struct { uint8\_t Qx[32]; /\* 256-bits \*/ uint8\_t Qy[32]; /\* 256-bits \*/ uint8\_t d[32]; /\* 256-bits \*/}\_\_attribute\_\_((packed)) ECC\_KEY\_T;
/\* Private Function Prototypes. \*//\* Prototypes of all static functions in the file are provided here. \*/
/\* Private Data. \*//\* All static data definitions appear here. \*/
/\* Public Data. \*//\* All data definitions with global scope appear here. \*/const char header[] = "\n" "const uint32\_t g\_InitialFWinfo[] =\n" "{\n" " /\* public key - 64-bytes (256-bits + 256-bits) \*/\n";
/\* Public Function Prototypes \*/
/\* Private Functions. \*/
void sha256(unsigned char \*data, unsigned int data\_len, unsigned char \*hash){ SHA256\_CTX sha256; SHA256\_Init(&sha256); SHA256\_Update(&sha256, data, data\_len); SHA256\_Final(hash, &sha256);}
static int sign\_pFwInfo(FW\_INFO\_T \*pFwInfo, ECC\_KEY\_T \*ecdsa\_key){ int ret = -1; EC\_KEY \*eckey = EC\_KEY\_new(); if (NULL == eckey) { printf("Failed to create new EC Key\n"); return -1; }
 EC\_GROUP \*ecgroup = EC\_GROUP\_new\_by\_curve\_name(NID\_X9\_62\_prime256v1); if (NULL == ecgroup) { printf("Failed to create new EC Group\n"); goto exit; }
 if (EC\_KEY\_set\_group(eckey, ecgroup) != 1) { printf("Failed to set group for EC Key\n"); goto exit; }
 memcpy((void \*) pFwInfo->pubkey.au32Key0, (void \*) ecdsa\_key->Qx, 32); memcpy((void \*) pFwInfo->pubkey.au32Key1, (void \*) ecdsa\_key->Qy, 32);
 BIGNUM\* x = BN\_bin2bn((void \*) ecdsa\_key->Qx, 32, NULL); BIGNUM\* y = BN\_bin2bn((void \*) ecdsa\_key->Qy, 32, NULL); BIGNUM\* d = BN\_bin2bn((void \*) ecdsa\_key->d, 32, NULL);
 EC\_KEY\_set\_private\_key(eckey, d); EC\_KEY\_set\_public\_key\_affine\_coordinates(eckey, x, y);
 uint32\_t au32HeadHash[8]; unsigned int u32Size = sizeof(FW\_INFO\_T) - sizeof(ECDSA\_SIGN\_T); sha256((unsigned char \*) pFwInfo, u32Size, (unsigned char \*) au32HeadHash);
 ECDSA\_SIG \*signature = ECDSA\_do\_sign((unsigned char \*) au32HeadHash, u32Size, eckey); if (NULL == signature) { printf("Failed to generate EC Signature\n"); } else { if (ECDSA\_do\_verify((unsigned char \*) au32HeadHash, u32Size, signature, eckey) != 1) { printf("Failed to verify EC Signature\n"); } else { BIGNUM \*r, \*s;#if OPENSSL\_VERSION\_NUMBER >= 0x10100000L ECDSA\_SIG\_get0(signature, &r, &s);#else r = signature->r; s = signature->s;#endif
// printf("d: %s\n", BN\_bn2hex(d));// printf("X: %s\n", BN\_bn2hex(x));// printf("Y: %s\n", BN\_bn2hex(y));// printf("R: %s\n", BN\_bn2hex(r));// printf("S: %s\n", BN\_bn2hex(s));
 BN\_bn2bin(r, (unsigned char \*) pFwInfo->sign.au32R); BN\_bn2bin(s, (unsigned char \*) pFwInfo->sign.au32S); BN\_free(x); BN\_free(y); BN\_free(d); BN\_free(r); BN\_free(s); } } ret = 0; exit: EC\_GROUP\_free(ecgroup); EC\_KEY\_free(eckey);
 return ret;}
int getFileSize(const char \*filename){ int size = -1;
 FILE\* fd = fopen(filename, "rb"); if (!fd) { printf("Failed to open file: %s\n",filename); return -1; }
 /\* Get file size \*/ if (fseek(fd, 0, SEEK\_END) != 0) { printf("Unable to get '%s' file size\n", filename); goto exit; }
 size = ftell(fd); if (size < 0) { printf("Stream doesn't support '%s' file positioning\n", filename); goto exit; }// rewind(fd);exit: fclose(fd); return size;}#ifdef CONFIG\_BOOTLOADER2/\*\* \* @brief printFwInfo - . \* \* @param pFwInfo [in/out] A pointer to jar file name string. \* \* @returns 0 on success or error code on failure. \*/void printFwInfo(FW\_INFO\_T \*pFwInfo){ printf("%s", header); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->pubkey.au32Key0[0], pFwInfo->pubkey.au32Key0[1], pFwInfo->pubkey.au32Key0[2], pFwInfo->pubkey.au32Key0[3]); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->pubkey.au32Key0[4], pFwInfo->pubkey.au32Key0[5], pFwInfo->pubkey.au32Key0[6], pFwInfo->pubkey.au32Key0[7]); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->pubkey.au32Key1[0], pFwInfo->pubkey.au32Key1[1], pFwInfo->pubkey.au32Key1[2], pFwInfo->pubkey.au32Key1[3]); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->pubkey.au32Key1[4], pFwInfo->pubkey.au32Key1[5], pFwInfo->pubkey.au32Key1[6], pFwInfo->pubkey.au32Key1[7]); printf("\n"); printf( " /\* metadata data - includes Mode selection, F/W region and Extend info \*/\n"); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x, // 0x00020000: NuBL32 F/W base\n", pFwInfo->mData.u32AuthCFGs, pFwInfo->mData.u32FwRegionLen, pFwInfo->mData.au32FwRegion[0].u32Start, pFwInfo->mData.au32FwRegion[0].u32Size); printf( " 0x%08x, 0x%08x, 0x%08x, 0x%08x, // 0x20180824/0x00001111/0x22223333: Extend info\n", pFwInfo->mData.u32ExtInfoLen, pFwInfo->mData.au32ExtInfo[0], pFwInfo->mData.au32ExtInfo[1], pFwInfo->mData.au32ExtInfo[2]); printf("\n"); printf(" /\* FW hash - 32-bytes (256-bits) \*/\n"); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->au32FwHash[0], pFwInfo->au32FwHash[1], pFwInfo->au32FwHash[2], pFwInfo->au32FwHash[3]); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->au32FwHash[4], pFwInfo->au32FwHash[5], pFwInfo->au32FwHash[6], pFwInfo->au32FwHash[7]); printf("\n"); printf(" /\* FwInfo signature - 64-bytes (256-bits R + 256-bits S) \*/\n"); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->sign.au32R[0], pFwInfo->sign.au32R[1], pFwInfo->sign.au32R[2], pFwInfo->sign.au32R[3]); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->sign.au32R[4], pFwInfo->sign.au32R[5], pFwInfo->sign.au32R[6], pFwInfo->sign.au32R[7]); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->sign.au32S[0], pFwInfo->sign.au32S[1], pFwInfo->sign.au32S[2], pFwInfo->sign.au32S[3]); printf(" 0x%08x, 0x%08x, 0x%08x, 0x%08x,\n", pFwInfo->sign.au32S[4], pFwInfo->sign.au32S[5], pFwInfo->sign.au32S[6], pFwInfo->sign.au32S[7]); printf("};\n");}#endif/\*\* \* @brief main - entry point of mTower: secure world. \* \* @param None \* \* @returns None (function is not supposed to return) \*/int main(int argc, char\*\* argv){ unsigned char \*buf = NULL; int ret = -1; FILE\* fd; int img\_size = 0;
#ifdef CONFIG\_BOOTLOADER2
 ECC\_KEY\_T ecdsa\_key; FW\_INFO\_T pFwInfo;
 pFwInfo.mData.u32AuthCFGs = 0x00000001; pFwInfo.mData.u32FwRegionLen = 0x00000008; pFwInfo.mData.au32FwRegion[0].u32Start = CONFIG\_START\_ADDRESS\_BL32; pFwInfo.mData.au32FwRegion[0].u32Size = 0x00000000; pFwInfo.mData.u32ExtInfoLen = 0x0000000c; pFwInfo.mData.au32ExtInfo[0] = DATE\_COMPILE; pFwInfo.mData.au32ExtInfo[1] = 0x00001111; pFwInfo.mData.au32ExtInfo[2] = 0x22223333;#endif
 if (argc != 7) { printf("Not enough input parameters for %s\n", argv[0]); return -1; }
 buf = malloc(1024 \* 256); if (buf == NULL) { printf("Allocation memory error\n"); goto exit; } memset((void \*) buf, 0, 1024 \* 256);
 //////////////////////////////////////////////////////////////// // mtower\_s.bin ////////////////////////////////////////////////////////////////
#ifdef CONFIG\_BOOTLOADER2 int32\_t size\_bl2; if((size\_bl2 = getFileSize(argv[1])) < 0) { return -1; }
 fd = fopen(argv[1], "rb"); if (!fd) { printf("Failed to open file: %s\n",argv[1]); return -1; }
 if (fread(buf, 1, (size\_t) size\_bl2, fd) != (size\_t) size\_bl2) { free(buf); goto exit; } fclose(fd);
#endif
#ifdef CONFIG\_BOOTLOADER32 int32\_t size\_bl32; if((size\_bl32 = getFileSize(argv[2])) < 0) { return -1; }
 fd = fopen(argv[2], "rb"); if (!fd) { printf("Failed to open file: %s\n",argv[2]); goto exit; } if (fread(buf + CONFIG\_START\_ADDRESS\_BL32, 1, (size\_t) size\_bl32, fd) != (size\_t) size\_bl32) { free(buf); goto exit; } fclose(fd); img\_size = size\_bl32;#endif
#ifdef CONFIG\_BOOTLOADER2 sha256(buf + CONFIG\_START\_ADDRESS\_BL32, size\_bl32, (unsigned char \*) &pFwInfo.au32FwHash); pFwInfo.mData.au32FwRegion[0].u32Size = size\_bl32;
 fd = fopen(argv[4], "rb"); if (!fd) { printf("Failed to open file: %s\n",argv[4]); goto exit; }
 if (fread((unsigned char \*) &ecdsa\_key, sizeof(char), sizeof(ECC\_KEY\_T), fd) != sizeof(ECC\_KEY\_T)) { return -1; } fclose(fd);
 sign\_pFwInfo(&pFwInfo, &ecdsa\_key);
 memcpy(buf + 0x00038000, (unsigned char \*) &pFwInfo, sizeof(FW\_INFO\_T)); img\_size = 0x00038000 + sizeof(FW\_INFO\_T);#endif
 fd = fopen(argv[3], "wb"); if (!fd) { printf("Failed to open file: %s\n",argv[3]); goto exit; }
 if (fwrite(buf, sizeof(char), (size\_t) img\_size, fd) != (size\_t) img\_size) { free(buf); goto exit; }
#ifdef CONFIG\_BOOTLOADER2 printf("\n\tSecure firmware info\n"); printFwInfo(&pFwInfo);#endif
////////////////////////////////////////////////////////////////// mtower\_ns.bin////////////////////////////////////////////////////////////////
#ifdef CONFIG\_BOOTLOADER33 memset((void \*) buf, 0, 1024 \* 256);
 int32\_t size\_bl33; if((size\_bl33 = getFileSize(argv[5])) < 0) { return -1; }
 fd = fopen(argv[5], "rb"); if (!fd) { printf("Failed to open file: %s\n",argv[5]); goto exit; } if (fread(buf, 1, (size\_t) size\_bl33, fd) != (size\_t) size\_bl33) { goto exit; } fclose(fd);
 img\_size = size\_bl33;
#ifdef CONFIG\_BOOTLOADER2 sha256(buf, size\_bl33, (unsigned char \*) &pFwInfo.au32FwHash); pFwInfo.mData.au32FwRegion[0].u32Start = CONFIG\_START\_ADDRESS\_BL33; pFwInfo.mData.au32FwRegion[0].u32Size = size\_bl33;
 sign\_pFwInfo(&pFwInfo, &ecdsa\_key); memcpy(buf + BL33\_METADATA\_ADDRESS, (unsigned char \*) &pFwInfo, sizeof(FW\_INFO\_T)); img\_size = BL33\_METADATA\_ADDRESS + sizeof(FW\_INFO\_T);#endif
 fd = fopen(argv[6], "wb"); if (!fd) { printf("Failed to open file: %s\n",argv[6]); goto exit; }
 if (fwrite(buf, sizeof(char), (size\_t) img\_size, fd) != (size\_t) img\_size) { goto exit; }#endif ret = 0;exit: free(buf); fclose(fd);
#ifdef CONFIG\_BOOTLOADER2 printf("\n\tNon-secure firmware info\n"); printFwInfo(&pFwInfo);#endif
 return ret;}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


