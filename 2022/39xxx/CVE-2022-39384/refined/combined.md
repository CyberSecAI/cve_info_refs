=== Content from github.com_b23d361e_20250114_191409.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fpull%2F3006)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fpull%2F3006)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=OpenZeppelin%2Fopenzeppelin-contracts)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenZeppelin](/OpenZeppelin)
/
**[openzeppelin-contracts](/OpenZeppelin/openzeppelin-contracts)**
Public

* [Notifications](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts) You must be signed in to change notification settings
* [Fork
  11.9k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)
* [Star
   25.2k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues
  216](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests
  74](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

Additional navigation options

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Update initializer modifier to prevent reentrancy during initialization #3006

 Merged

[frangio](/frangio)
merged 10 commits into
[OpenZeppelin:master](/OpenZeppelin/openzeppelin-contracts/tree/master "OpenZeppelin/openzeppelin-contracts:master")
from
[Amxx:refactor/initialize](/Amxx/openzeppelin-contracts/tree/refactor/initialize "Amxx/openzeppelin-contracts:refactor/initialize")

Dec 10, 2021

 Merged

# [Update initializer modifier to prevent reentrancy during initialization](#top) #3006

[frangio](/frangio)
merged 10 commits into
[OpenZeppelin:master](/OpenZeppelin/openzeppelin-contracts/tree/master "OpenZeppelin/openzeppelin-contracts:master")
from
[Amxx:refactor/initialize](/Amxx/openzeppelin-contracts/tree/refactor/initialize "Amxx/openzeppelin-contracts:refactor/initialize")

Dec 10, 2021

[Conversation
15](/OpenZeppelin/openzeppelin-contracts/pull/3006)
[Commits
10](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits)
[Checks
0](/OpenZeppelin/openzeppelin-contracts/pull/3006/checks)
[Files changed](/OpenZeppelin/openzeppelin-contracts/pull/3006/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![Amxx](https://avatars.githubusercontent.com/u/2432299?s=60&v=4)](/Amxx)

Copy link

Collaborator

### @Amxx **[Amxx](/Amxx)** commented [Dec 7, 2021](#issue-1073515079) • edited by frangio Loading

This issue was identified and reported by [@chaitinblockchain](https://github.com/chaitinblockchain) through [our bug bounty on Immunefi](https://immunefi.com/bounty/openzeppelin/).

---

It is currently possible for `initializer()`-protected functions to be executed twice, if this happens in the same transaction. For this to happen, either one call has to be a subcall the other, or both call have to be subcalls of a common `initializer()`-protected function.

This can particularly be dangerous is the initialization is **not** part of the proxy construction, and reentrancy is possible by executing an external call to an untrusted address.

This PR is a move toward fixing this potential issue, by forbidding `initializer()`-protected function to be nested when the contract is already constructed and re-entrance is possible.

**⚠ This change is breaking in some cases. ⚠**

This change require changes to the upgradeable contracts:

* During the transpilation process, the `__XXX_init` function must use the new `onlyInitializing()` modifier instead of `initializer()`

#### PR Checklist

* Tests
* Documentation
* Changelog entry

Sorry, something went wrong.

All reactions

 [Amxx](/Amxx)
added 5 commits
[December 7, 2021 16:46](#commits-pushed-79b2621)

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=40&v=4)](/Amxx)

`[update initializer contract to prevent reentry during initialization](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/79b26212bc7de4b274d4b02e82bef3973534132f "update initializer contract to prevent reentry during initialization")`

`[79b2621](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/79b26212bc7de4b274d4b02e82bef3973534132f)`

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=40&v=4)](/Amxx)

`[add changelog entry](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/970325c059771c319906ea4808939e297ccb2a6c "add changelog entry")`

`[970325c](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/970325c059771c319906ea4808939e297ccb2a6c)`

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=40&v=4)](/Amxx)

`[fix linting](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/382b11f7be58ec0d1e66cd39e2742c603aa81508 "fix linting")`

`[382b11f](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/382b11f7be58ec0d1e66cd39e2742c603aa81508)`

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=40&v=4)](/Amxx)

`[update tests](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/1f95f56e39b5127d55139d83542ceaa9d06a18fc "update tests")`

`[1f95f56](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/1f95f56e39b5127d55139d83542ceaa9d06a18fc)`

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=40&v=4)](/Amxx)

`[fix lint](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/9eb1a842bb04b25564e96ccb8822084f2eec83f9 "fix lint")`

`[9eb1a84](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/9eb1a842bb04b25564e96ccb8822084f2eec83f9)`

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=80&v=4)](/Amxx)

Copy link

Collaborator

Author

### **[Amxx](/Amxx)** commented [Dec 7, 2021](#issuecomment-988171610)

| looking at the old mocks, and what they have become, I really think it was better before ... despite re-entrancy potential :/ |
| --- |

All reactions

Sorry, something went wrong.

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)
[frangio](/frangio)
changed the title
~~update initializer contract to prevent reentry during initialization~~
Update initializer modifier to prevent reentrancy during initialization
[Dec 7, 2021](#event-5729430970)

[![frangio](https://avatars.githubusercontent.com/u/481465?s=60&v=4)](/frangio)

**[frangio](/frangio)**
reviewed
[Dec 7, 2021](#pullrequestreview-825664000)

 [View reviewed changes](/OpenZeppelin/openzeppelin-contracts/pull/3006/files/9eb1a842bb04b25564e96ccb8822084f2eec83f9)

[contracts/proxy/utils/Initializable.sol](/OpenZeppelin/openzeppelin-contracts/pull/3006/files/9eb1a842bb04b25564e96ccb8822084f2eec83f9#diff-68a1c31fc85cb82c7387ab7dc8c5ae5c1885baeb271cf6e68f67c753d909e0c3)
Outdated

Show resolved

Hide resolved

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)

`[add breaking changes section in changelog](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/4417ca2d09ece7548593f5c8fce6bbfc42b74b8e "add breaking changes section in changelog")`

`[4417ca2](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/4417ca2d09ece7548593f5c8fce6bbfc42b74b8e)`

[![frangio](https://avatars.githubusercontent.com/u/481465?s=60&v=4)](/frangio)

**[frangio](/frangio)**
reviewed
[Dec 7, 2021](#pullrequestreview-825689221)

 [View reviewed changes](/OpenZeppelin/openzeppelin-contracts/pull/3006/files/4417ca2d09ece7548593f5c8fce6bbfc42b74b8e)

[CHANGELOG.md](/OpenZeppelin/openzeppelin-contracts/pull/3006/files/4417ca2d09ece7548593f5c8fce6bbfc42b74b8e#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)

Show resolved

Hide resolved

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)

`[docs](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/48eebbc45a2f3f3e9b914d52a01c6ecdd4be1f09 "docs")`

`[48eebbc](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/48eebbc45a2f3f3e9b914d52a01c6ecdd4be1f09)`

[![frangio](https://avatars.githubusercontent.com/u/481465?s=60&v=4)](/frangio)

**[frangio](/frangio)**
reviewed
[Dec 8, 2021](#pullrequestreview-825953394)

 [View reviewed changes](/OpenZeppelin/openzeppelin-contracts/pull/3006/files/48eebbc45a2f3f3e9b914d52a01c6ecdd4be1f09)

[test/proxy/utils/Initializable.test.js](/OpenZeppelin/openzeppelin-contracts/pull/3006/files/48eebbc45a2f3f3e9b914d52a01c6ecdd4be1f09#diff-efeff6987e24054895a5ecc43a6389636e24f19a7af59faacfa5405f5e000319)
Outdated

Show resolved

Hide resolved

 [frangio](/frangio)
added 3 commits
[December 10, 2021 12:18](#commits-pushed-4ae014f)

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)

`[simplify test structure](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/4ae014f6b4eb66f6ea96617ee4f399a2ef0f9f13 "simplify test structure")`

`[4ae014f](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/4ae014f6b4eb66f6ea96617ee4f399a2ef0f9f13)`

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)

`[rename test functions](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/089f3d5b28b96e6593908ef727274631452f31f0 "rename test functions")`

`[089f3d5](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/089f3d5b28b96e6593908ef727274631452f31f0)`

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)

`[Merge branch 'master' into refactor/initialize](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/95e0f57c0710597341dca0fe3378b1c0eab5fe4c "Merge branch 'master' into refactor/initialize")`

`[95e0f57](/OpenZeppelin/openzeppelin-contracts/pull/3006/commits/95e0f57c0710597341dca0fe3378b1c0eab5fe4c)`

[![frangio](https://avatars.githubusercontent.com/u/481465?s=60&v=4)](/frangio)

**[frangio](/frangio)**
approved these changes
[Dec 10, 2021](#pullrequestreview-829063651)

 [View reviewed changes](/OpenZeppelin/openzeppelin-contracts/pull/3006/files/95e0f57c0710597341dca0fe3378b1c0eab5fe4c)

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)
[frangio](/frangio)
merged commit [`08840b9`](/OpenZeppelin/openzeppelin-contracts/commit/08840b9f8c21b235466b6d0c5a00a4d3a2de2682)
into
OpenZeppelin:master

[Dec 10, 2021](https://github.com/OpenZeppelin/openzeppelin-contracts/pull/3006#event-5748686889)

[frangio](/frangio)
added a commit
that referenced
this pull request
[Dec 10, 2021](#ref-commit-553c8fd)
[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)

`[Update initializer modifier to prevent reentrancy during initializati…](/OpenZeppelin/openzeppelin-contracts/commit/553c8fdec708ea10dd5f4a2977364af7a562566f "Update initializer modifier to prevent reentrancy during initialization (#3006)

Co-authored-by: Francisco Giordano <frangio.1@gmail.com>
(cherry picked from commit 08840b9f8c21b235466b6d0c5a00a4d3a2de2682)")`
…

`[553c8fd](/OpenZeppelin/openzeppelin-contracts/commit/553c8fdec708ea10dd5f4a2977364af7a562566f)`

```
…on ([#3006](https://github.com/OpenZeppelin/openzeppelin-contracts/pull/3006))

Co-authored-by: Francisco Giordano <frangio.1@gmail.com>
(cherry picked from commit [08840b9](https://github.com/OpenZeppelin/openzeppelin-contracts/commit/08840b9f8c21b235466b6d0c5a00a4d3a2de2682))
```

 [![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=40&v=4)](/Amxx)
[Amxx](/Amxx)
deleted the
refactor/initialize

branch
[December 10, 2021 23:30](#event-5750578367)

[![@slendermaan](https://avatars.githubusercontent.com/u/21294029?s=80&u=6f1ca958c6f89462fca93a8ab548c5e3422be927&v=4)](/slendermaan)

Copy link

### **[slendermaan](/slendermaan)** commented [Dec 13, 2021](#issuecomment-992584378) • edited Loading

| Hello everyone,i'm Lucas\_LMC. I'm sorry to bother you. I'm a little care about whether this issue will be included in the Security advisories section of the openzepplin library. |
| --- |

 👀
1
 slendermaan reacted with eyes emoji

All reactions

* 👀
  1 reaction

Sorry, something went wrong.

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=80&v=4)](/frangio)

Copy link

Contributor

### **[frangio](/frangio)** commented [Dec 13, 2021](#issuecomment-992980867)

| Hi [@slendermaan](https://github.com/slendermaan) yes once we release. We had to postpone the release until tomorrow. |
| --- |

All reactions

Sorry, something went wrong.

This was referenced Dec 14, 2021

[Update dependency @openzeppelin/contracts to v4.4.1 [SECURITY]
OpenZeppelin/openzeppelin-upgrades#470](/OpenZeppelin/openzeppelin-upgrades/pull/470)
 Closed

[Update dependency @openzeppelin/contracts-upgradeable to v4.4.1 [SECURITY]
OpenZeppelin/openzeppelin-upgrades#471](/OpenZeppelin/openzeppelin-upgrades/pull/471)
 Closed

[Update dependency @openzeppelin/contracts to v4 [SECURITY]
OriginProtocol/dshop#1023](/OriginProtocol/dshop/pull/1023)
 Open

[Update dependency @openzeppelin/contracts to v4.4.1 [SECURITY] - autoclosed
OpenZeppelin/solidity-docgen#345](/OpenZeppelin/solidity-docgen/pull/345)
 Closed

[Update dependency @openzeppelin/contracts to v4.4.1 [SECURITY]
jellydn/dapp-token-ico#203](/jellydn/dapp-token-ico/pull/203)
 Merged

[Update dependency @openzeppelin/contracts-upgradeable to v4.4.1 [SECURITY]
jellydn/dapp-token-ico#204](/jellydn/dapp-token-ico/pull/204)
 Merged

[fix(deps): update dependency @openzeppelin/contracts to v4 [security]
smartcontractkit/external-adapters-js#1307](/smartcontractkit/external-adapters-js/pull/1307)
 Closed

[Update dependency @openzeppelin/contracts to v4 [SECURITY]
HardlyDifficult/hardlydifficult-eth#554](/HardlyDifficult/hardlydifficult-eth/pull/554)
 Open

[Update dependency @openzeppelin/contracts to v4.4.1 [SECURITY]
jellydn/nft-app#236](/jellydn/nft-app/pull/236)
 Merged

17 hidden items

Load more…

[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/apps/renovate)
[renovate](/apps/renovate)
bot
mentioned this pull request
[Jan 14, 2022](#ref-pullrequest-1102965227)

[fix(deps): update dependency @openzeppelin/contracts to v4.4.2 [security]
paypr/gnossis-chain-contracts#14](/paypr/gnossis-chain-contracts/pull/14)
 Merged

1 task

This was referenced Jan 21, 2022

[build(deps): update dependency @openzeppelin/contracts to 4.4.2 [security] - autoclosed
energywebfoundation/passport-did-auth#263](/energywebfoundation/passport-did-auth/pull/263)
 Closed

[build(deps): update dependency @openzeppelin/contracts-upgradeable to 4.4.2 [security]
energywebfoundation/passport-did-auth#264](/energywebfoundation/passport-did-auth/pull/264)
 Merged

[build(deps): update dependency @openzeppelin/contracts to 4.4.2 [security]
energywebfoundation/switchboard-dapp#560](/energywebfoundation/switchboard-dapp/pull/560)
 Closed

[build(deps): update dependency @openzeppelin/contracts-upgradeable to 4.4.2 [security]
energywebfoundation/switchboard-dapp#561](/energywebfoundation/switchboard-dapp/pull/561)
 Closed

[build(deps): update dependency @openzeppelin/contracts to 4.4.2 [security]
energywebfoundation/ssi-hub#301](/energywebfoundation/ssi-hub/pull/301)
 Closed

[build(deps): update dependency @openzeppelin/contracts-upgradeable to 4.4.2 [security]
energywebfoundation/ssi-hub#302](/energywebfoundation/ssi-hub/pull/302)
 Closed

[davidbrai](/davidbrai)
added a commit
to withtally/dao.new
that referenced
this pull request
[Jan 26, 2022](#ref-commit-14ef9ff)
[![@davidbrai](https://avatars.githubusercontent.com/u/351026?s=40&u=24f452ed6d0258e45f9e749dc966c66bf8994be1&v=4)](/davidbrai)

`[contracts: upgrade to openzeppelin 4.5](/withtally/dao.new/commit/14ef9ffbc5d99b317c6ed4e9b2e8a43673a74a95 "contracts: upgrade to openzeppelin 4.5

update initializer modifiers as described in: https://github.com/OpenZeppelin/openzeppelin-contracts/pull/3006")`
…

`[14ef9ff](/withtally/dao.new/commit/14ef9ffbc5d99b317c6ed4e9b2e8a43673a74a95)`

```
update initializer modifiers as described in: [OpenZeppelin/openzeppelin-contracts#3006](https://github.com/OpenZeppelin/openzeppelin-contracts/pull/3006)
```

This was referenced Jan 28, 2022

[chore(deps): update dependency @openzeppelin/contracts to v4.4.2 [security]
ashutoshvarma/sway#25](/ashutoshvarma/sway/pull/25)
 Merged

[chore(deps): update dependency @openzeppelin/contracts-upgradeable to v4.4.2 [security]
ashutoshvarma/sway#26](/ashutoshvarma/sway/pull/26)
 Merged

This was referenced Feb 9, 2022

[build(deps): update dependency @openzeppelin/contracts to 4.4.2 [security]
energywebfoundation/iam-contracts#100](/energywebfoundation/iam-contracts/pull/100)
 Merged

[build(deps): update dependency @openzeppelin/contracts-upgradeable to 4.4.2 [security]
energywebfoundation/iam-contracts#101](/energywebfoundation/iam-contracts/pull/101)
 Closed

[chore(deps): update dependency @openzeppelin/contracts [security]
hyperledger-labs/blockchain-carbon-accounting#407](/hyperledger-labs/blockchain-carbon-accounting/pull/407)
 Merged

[build(deps): update dependency @openzeppelin/contracts to 4.4.2 [security] - autoclosed
energywebfoundation/passport-did-auth#278](/energywebfoundation/passport-did-auth/pull/278)
 Closed

[![@code423n4](https://avatars.githubusercontent.com/u/81770958?s=40&v=4)](/code423n4)
[code423n4](/code423n4)
mentioned this pull request
[Feb 16, 2022](#ref-issue-1140082705)

[Update initializer modifier to prevent reentrancy during initialization
code-423n4/2022-02-aave-lens-findings#57](/code-423n4/2022-02-aave-lens-findings/issues/57)

Closed

[![@PaulRBerg](https://avatars.githubusercontent.com/u/8782666?s=80&u=c4845dac7782a38ab29abd9d777d64478bc3af9b&v=4)](/PaulRBerg)

Copy link

Contributor

### **[PaulRBerg](/PaulRBerg)** commented [Mar 2, 2022](#issuecomment-1057517772) • edited Loading

| Hey guys, I stumbled upon this PR after reading the [comments](https://github.com/OpenZeppelin/openzeppelin-contracts-upgradeable/blob/20380ee699406211ae88c4edd11b0af87c8abdd6/contracts/proxy/utils/Initializable.sol#L50-L52) added in the latest implementation of `Initializable`. I recently upgraded to the most recent version of the `@openzeppelin/contracts-upgradeable` package and that has made some of our tests to fail - it looks like we were indeed executing two initializers, one of which was a subcall of the other.  I'm trying to wrap my head around this, though:  This can particularly be dangerous is the initialization is **not** part of the proxy construction, and reentrancy is possible by executing an external call to an untrusted address.  [@Amxx](https://github.com/Amxx), could you share an example for when the previous behavior would have been problematic? |
| --- |

All reactions

Sorry, something went wrong.

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=80&v=4)](/Amxx)

Copy link

Collaborator

Author

### **[Amxx](/Amxx)** commented [Mar 3, 2022](#issuecomment-1057778916)

| Let's say you have:   * A proxy (P) * A logic contract (L) that includes an `initialize` function. This function is protected by the `initializer` modifier * An external contract (E)   Now the flow:   * Step 1: P is constructed, and set to point to L, but not initialized. * Step 2: We call the initializer in P   + 2.A: this is expected to do the initialization, and set the and register that it has been done, so it cannot be initialized   + 2.B: (the issue is here) the initialization might call (E). We are still in the initialization phase.   + 2.C: E can call `initialize` on P, with different settings. We are still in the initialization phase.   + 2.D: `initializer` accepts that call, because we are in the initialization phase.   + 2.E: P possibly gets reinitialized, with E controlled parameters.   By spliting the `initializer` modifier (for external functions) and the `onlyInitializating` (for internal functions) we make sure that the external initializer call can still trigger the internal ones, but 2.D will throw.  If the initializer is done during construction, then we don't have this threat because E would not be able to call P (because P is not yet constructed) |
| --- |

All reactions

Sorry, something went wrong.

[![@PaulRBerg](https://avatars.githubusercontent.com/u/8782666?s=80&u=c4845dac7782a38ab29abd9d777d64478bc3af9b&v=4)](/PaulRBerg)

Copy link

Contributor

### **[PaulRBerg](/PaulRBerg)** commented [Mar 3, 2022](#issuecomment-1058088281)

| Very interesting. But I think this was low-risk, wasn't it?  Firstly, most upgradeable proxy deployers take care of initialization atomically - I think this is what [hardhat-upgrades](https://docs.openzeppelin.com/upgrades-plugins/1.x/hardhat-upgrades) does.  Secondly, I haven't seen many contracts making calls to external contracts during construction. The vast majority of contracts just call some internal function inherited from other contracts. |
| --- |

All reactions

Sorry, something went wrong.

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=80&v=4)](/frangio)

Copy link

Contributor

### **[frangio](/frangio)** commented [Mar 3, 2022](#issuecomment-1058138793)

| Yes, this was low severity.  Have you been able to fix your issue? You should probably use `onlyInitializing` instead of `initializer`. |
| --- |

All reactions

Sorry, something went wrong.

[![@PaulRBerg](https://avatars.githubusercontent.com/u/8782666?s=80&u=c4845dac7782a38ab29abd9d777d64478bc3af9b&v=4)](/PaulRBerg)

Copy link

Contributor

### **[PaulRBerg](/PaulRBerg)** commented [Mar 3, 2022](#issuecomment-1058290058)

| Have you been able to fix your issue? You should probably use `onlyInitializing` instead of `initializer`.  Yeah that's exactly what I did. Thanks for confirming! |
| --- |

All reactions

Sorry, something went wrong.

[PaulRBerg](/PaulRBerg)
added a commit
to hifi-finance/hifi
that referenced
this pull request
[Mar 3, 2022](#ref-commit-ce70409)
[![@PaulRBerg](https://avatars.githubusercontent.com/u/8782666?s=40&u=c4845dac7782a38ab29abd9d777d64478bc3af9b&v=4)](/PaulRBerg)

`[fix(protocol): use "onlyInitializable" modifier instead of "initializer"](/hifi-finance/hifi/commit/ce70409eb31428dee7c52a6c8f55dc0c6ad443d9 "fix(protocol): use \"onlyInitializable\" modifier instead of \"initializer\"

refactor(protocol): mark init function as \"internal\" in OwnableUpgradeable
refactor(protocol): rename \"__OwnableUpgradeable_init\" to \"__Ownable_init\"
test(protocol): new GodModeOwnableUpgradeable to expose init function

See releated discussion in https://github.com/OpenZeppelin/openzeppelin-contracts/pull/3006")`
…

`[ce70409](/hifi-finance/hifi/commit/ce70409eb31428dee7c52a6c8f55dc0c6ad443d9)`

```
refactor(protocol): mark init function as "internal" in OwnableUpgradeable
refactor(protocol): rename "__OwnableUpgradeable_init" to "__Ownable_init"
test(protocol): new GodModeOwnableUpgradeable to expose init function

See releated discussion in [OpenZeppelin/openzeppelin-contracts#3006](https://github.com/OpenZeppelin/openzeppelin-contracts/pull/3006)
```

This was referenced Mar 7, 2022

[Update dependency @openzeppelin/contracts to v4 [SECURITY] - abandoned
OrbitalTreasure/treasure#96](/OrbitalTreasure/treasure/pull/96)
 Open

[Update dependency @openzeppelin/contracts to v4.9.3 [SECURITY] - autoclosed
xinbenlv/eip-2135#46](/xinbenlv/eip-2135/pull/46)
 Closed

[![@renovate](https://avatars.githubusercontent.com/in/2740?s=40&v=4)](/apps/renovate)
[renovate](/apps/renovate)
bot
mentioned this pull request
[Mar 23, 2022](#ref-pullrequest-1178417399)

[build(deps): update dependency @openzeppelin/contracts to 4.7.3 [security]
energywebfoundation/passport-did-auth#295](/energywebfoundation/passport-did-auth/pull/295)
 Closed

1 task

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio)
[frangio](/frangio)
mentioned this pull request
[Apr 21, 2022](#ref-pullrequest-1206036045)

[Restore previous behavior of initializer during construction
#3344](/OpenZeppelin/openzeppelin-contracts/pull/3344)
 Merged

3 tasks

[![@aodhgan](https://avatars.githubusercontent.com/u/36907214?s=40&v=4)](/aodhgan)
[aodhgan](/aodhgan)
mentioned this pull request
[Jul 5, 2022](#ref-pullrequest-1292504516)

[feat: add staking pool deploy script
windranger-io/windranger-treasury#352](/windranger-io/windranger-treasury/pull/352)
 Merged

This was referenced Oct 17, 2022

[Separate initialization call from the constructor
CMTA/CMTAT#62](/CMTA/CMTAT/pull/62)
 Closed

[Separate initialization call from the constructor
CMTA/CMTAT#63](/CMTA/CMTAT/pull/63)
 Merged

[![@Rassska](https://avatars.githubusercontent.com/u/73281386?s=80&u=b57f1bed2983376919c5f5a004915668ae26aea2&v=4)](/Rassska)

Copy link

### **[Rassska](/Rassska)** commented [Oct 30, 2022](#issuecomment-1296333589)

| But how does initialization invokes E? Why it should make a call into some external contract which is not under our control? |
| --- |

All reactions

Sorry, something went wrong.

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=80&v=4)](/frangio)

Copy link

Contributor

### **[frangio](/frangio)** commented [Nov 4, 2022](#issuecomment-1303923741)

| Why it should make a call into some external contract which is not under our control?  This may be part of the logic of the initializer body for some reason. To be clear: the `initializer` modifier would never initiate this external call on its own. |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fpull%2F3006)

Reviewers

[![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio) [frangio](/frangio)

frangio approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

5 participants

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=52&v=4)](/Amxx) [![@slendermaan](https://avatars.githubusercontent.com/u/21294029?s=52&v=4)](/slendermaan) [![@frangio](https://avatars.githubusercontent.com/u/481465?s=52&v=4)](/frangio) [![@PaulRBerg](https://avatars.githubusercontent.com/u/8782666?s=52&v=4)](/PaulRBerg) [![@Rassska](https://avatars.githubusercontent.com/u/73281386?s=52&v=4)](/Rassska)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_79e87c00_20250114_191410.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fsecurity%2Fadvisories%2FGHSA-9c22-pwxw-p6hx)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fsecurity%2Fadvisories%2FGHSA-9c22-pwxw-p6hx)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=OpenZeppelin%2Fopenzeppelin-contracts)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenZeppelin](/OpenZeppelin)
/
**[openzeppelin-contracts](/OpenZeppelin/openzeppelin-contracts)**
Public

* [Notifications](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts) You must be signed in to change notification settings
* [Fork
  11.9k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)
* [Star
   25.2k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues
  216](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests
  74](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

Additional navigation options

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

# Initializer reentrancy may lead to double initialization

Low

[frangio](/frangio)
published
GHSA-9c22-pwxw-p6hx
Dec 14, 2021

## Package

npm

@openzeppelin/contracts
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

>=3.2.0 <4.4.1

## Patched versions

4.4.1

npm

@openzeppelin/contracts-upgradeable
([npm](/advisories?query=ecosystem%3Anpm))

>=3.2.0 <4.4.1

4.4.1

## Description

### Impact

Initializer functions that are invoked separate from contract creation (the most prominent example being minimal proxies) may be reentered if they make an untrusted non-view external call.

Once an initializer has finished running it can never be re-executed. However, an exception put in place to support multiple inheritance made reentrancy possible in the scenario described above, breaking the expectation that there is a single execution.

Note that upgradeable proxies are commonly initialized together with contract creation, where reentrancy is not feasible, so the impact of this issue is believed to be minor.

### Patches

A fix is included in the version v4.4.1 of `@openzeppelin/contracts` and `@openzeppelin/contracts-upgradeable`.

### Workarounds

Avoid untrusted external calls during initialization.

### References

[#3006](https://github.com/OpenZeppelin/openzeppelin-contracts/pull/3006)

### Credits

This issue was identified and reported by [@chaitinblockchain](https://github.com/chaitinblockchain) through [our bug bounty on Immunefi](https://immunefi.com/bounty/openzeppelin/).

### For more information

If you have any questions or comments about this advisory, or need assistance executing the mitigation, email us at security@openzeppelin.com.

### Severity

Low

### CVE ID

CVE-2021-46320

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


