=== Content from lists.fedoraproject.org_1f0187fc_20250115_102203.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

Ã—
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD.mbox.gz?message=UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD/#UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD)

# [SECURITY] Fedora 37 Update: python-matrix-common-1.3.0-7.fc37

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updatesï¼ fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updatesï¼ fedoraproject.org")

18 Sep
2023

18 Sep
'23

3:37 a.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2023-c0696d7b53
2023-09-18 01:37:07.642300
--------------------------------------------------------------------------------

Name : python-matrix-common
Product : Fedora 37
Version : 1.3.0
Release : 7.fc37
URL : <https://github.com/matrix-org/matrix-python-common>
Summary : Common utilities for Synapse, Sydent and Sygnal
Description :
Common utilities for Synapse, Sydent and Sygnal.

--------------------------------------------------------------------------------
Update Information:

Update matrix-synapse to v1.80.0 to fix CVE-2022-39374, CVE-2023-32323
--------------------------------------------------------------------------------
ChangeLog:

\* Sun Aug 20 2023 Kai A. Hiller V02460@gmail.com - 1.3.0-7
- SPDX migration
\* Sun Aug 20 2023 Kai A. Hiller V02460@gmail.com - 1.3.0-6
- Inline %{srcname}
\* Fri Jul 21 2023 Fedora Release Engineering releng@fedoraproject.org - 1.3.0-4
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_39_Mass_Rebuild>
\* Wed Jun 28 2023 Python Maint python-maint@redhat.com - 1.3.0-3
- Rebuilt for Python 3.12
\* Fri Jan 20 2023 Fedora Release Engineering releng@fedoraproject.org - 1.3.0-2
- Rebuilt for <https://fedoraproject.org/wiki/Fedora_38_Mass_Rebuild>
\* Mon Oct 10 2022 Kai A. Hiller V02460@gmail.com - 1.3.0-1
- Update to v1.3.0
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #2209956 - CVE-2022-39374 matrix-synapse: Synapse Denial of service due to incorrect application of event authorization rules during state resolution
<https://bugzilla.redhat.com/show_bug.cgi?id=2209956>
[ 2 ] Bug #2209958 - CVE-2023-32323 matrix-synapse: Synapse Outgoing federation to specific hosts can be disabled by sending malicious invites
<https://bugzilla.redhat.com/show_bug.cgi?id=2209958>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2023-c0696d7b53' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD/#UJIJRP5ZH6B3KGFLHCAKR2IX2Y4Z25QD)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from github.com_7bfdf04b_20250115_102202.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-p9qp-c452-f9r7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-p9qp-c452-f9r7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Denial of service due to incorrect application of event authorization rules during state resolution

Moderate

[dkasak](/dkasak)
published
GHSA-p9qp-c452-f9r7
May 24, 2023

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

>=1.62.0; <1.68.0

## Patched versions

1.68.0

## Description

### Impact

If Synapse and a malicious homeserver are both joined to the same room, the malicious homeserver can trick Synapse into accepting previously rejected events into its view of the current state of that room. This can be exploited in a way that causes all further messages and state changes sent in that room from the vulnerable homeserver to be rejected.

Synapse homeservers are affected by this issue if and only if they are joined to rooms which members of untrusted homeservers are joined or invited to.

* Synapse homeservers in rooms available over public federation **are** affected.
* Synapse homeservers with federation disabled are not affected.
* Synapse homeservers in a closed federation containing only trusted servers are not affected.
* Synapse homeservers which are only joined to rooms with federation disabled[1](#user-content-fn-1-f6ff443191ffb98fa6b67c5cf6b5c6b8) are not affected.

### Patches

Administrators of homeservers with federation enabled are advised to upgrade to 1.68.0 or higher.

### Workarounds

* Federation can be disabled by setting [`federation_domain_whitelist`](https://matrix-org.github.io/synapse/latest/usage/configuration/config_documentation.html#federation_domain_whitelist) to an empty list (`[]`).

### References

* [#13723](https://github.com/matrix-org/synapse/pull/13723)

### For more information

If you have any questions or comments about this advisory, e-mail us at security@matrix.org.

## Footnotes

1. See `m.federate` in the [`m.room.create` definition](https://spec.matrix.org/v1.4/client-server-api/#mroomcreate). [â†©](#user-content-fnref-1-f6ff443191ffb98fa6b67c5cf6b5c6b8)

### Severity

Moderate

6.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2022-39374

### Weaknesses

No CWEs

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_dcfc3532_20250115_102201.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F13723)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F13723)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Avoid putting rejected events in room state #13723

 Merged

[squahtx](/squahtx)
merged 5 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[squah/fix\_rejected\_events\_in\_state](/matrix-org/synapse/tree/squah/fix_rejected_events_in_state "matrix-org/synapse:squah/fix_rejected_events_in_state")

Sep 16, 2022

 Merged

# [Avoid putting rejected events in room state](#top) #13723

[squahtx](/squahtx)
merged 5 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[squah/fix\_rejected\_events\_in\_state](/matrix-org/synapse/tree/squah/fix_rejected_events_in_state "matrix-org/synapse:squah/fix_rejected_events_in_state")

Sep 16, 2022

[Conversation
2](/matrix-org/synapse/pull/13723)
[Commits
5](/matrix-org/synapse/pull/13723/commits)
[Checks
0](/matrix-org/synapse/pull/13723/checks)
[Files changed](/matrix-org/synapse/pull/13723/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![squahtx](https://avatars.githubusercontent.com/u/8349537?s=60&v=4)](/squahtx)

Copy link

Contributor

### @squahtx **[squahtx](/squahtx)** commented [Sep 6, 2022](#issue-1363100372) â€¢ edited Loading

When receiving an event over federation which has prev events not known

locally, Synapse will request the state before the unknown prev events

from a remote server. It is possible for the remote server to disagree

on the rejected-ness of events and return a state that includes locally

rejected events.

During state resolution, we replay state events and re-evaluate the part

of their auth that checks against room state. Thus it is possible for

events that have been rejected due to citing rejected auth events to be

accepted into the current room state at the forward extremities.

While the spec implies that this may be intended behaviour depending on

the reason the auth event was rejected, this creates problems for

Synapse, since we assume that previously rejected events cannot make it

into room state and do not populate tables such as `room_memberships`

for them.

For now, we amend state resolution to not admit previously rejected

events in the calculated state.

---

Previous notes

It's unclear to me whether the proposed change to state resolution is valid.

The spec says

> Events that have been rejected due to failing auth based on the state at the event (rather than based on their auth chain) are handled as usual by the algorithm, unless otherwise specified.

which seems to imply that there are a class of rejected events that *should* make their way into the current room state.

The spec also says

> Note that no events rejected due to failure to auth against their auth chain should appear in the process, as they should not appear in state (the algorithm only uses events that appear in either the state sets or in the auth chain of the events in the state sets).
>
> RATIONALE
>
> This helps ensure that different serversâ€™ view of state is more likely to converge, since rejection state of an event may be different. This can happen if a third server gives an incorrect version of the state when a server joins a room via it (either due to being faulty or malicious). Convergence of state is a desirable property as it ensures that all users in the room have a (mostly) consistent view of the state of the room. If the view of the state on different servers diverges it can lead to bifurcation of the room due to e.g. servers disagreeing on who is in the room.

which seems to imply that events rejected because their auth events have been rejected should not appear in the calculated state (regardless of the reason their auth events have been rejected?). But then the rationale doesn't really work out, since chains of auth events rejected due to citing rejected auth events will remain rejected, regardless of the rejection reason at the start of the chain.

---

> When receiving an event over federation which has prev events not known
>
> locally, Synapse will request the state before the unknown prev events
>
> from a remote server. It is possible for the remote server to disagree
>
> on the rejected-ness of events and return a state that includes locally
>
> rejected events.

I think it's possible for parts of the DAG to have state that includes rejected events and modifying state resolution doesn't change this. I'm unsure about the implications of this.

Sorry, something went wrong.

All reactions

 [![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=40&v=4)](/squahtx)
[squahtx](/squahtx)
requested a review
from a team
as a [code owner](/matrix-org/synapse/blob/32fc3b7ba4702a0068a82bdd0595e2f426967d4d/.github/CODEOWNERS#L2)
[September 6, 2022 10:56](#event-7329325612)

 [![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=40&v=4)](/squahtx)
[squahtx](/squahtx)
marked this pull request as draft
[September 6, 2022 10:57](#event-7329326850)

[![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=80&v=4)](/squahtx)

Copy link

Contributor

Author

### **[squahtx](/squahtx)** commented [Sep 6, 2022](#issuecomment-1237994032)

| Some help making sense of what the spec says with respect to state res would be appreciated! |
| --- |

All reactions

Sorry, something went wrong.

 [![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=40&v=4)](/squahtx)
[squahtx](/squahtx)
[force-pushed](/matrix-org/synapse/compare/8c68d80244001425ef786b96a8aca08c004315cf..f60308be4b20388a0b96f93c88e0be9671dcce73)
the
squah/fix\_rejected\_events\_in\_state

branch
2 times, most recently
from
[`8c68d80`](/matrix-org/synapse/commit/8c68d80244001425ef786b96a8aca08c004315cf) to
[`f60308b`](/matrix-org/synapse/commit/f60308be4b20388a0b96f93c88e0be9671dcce73)  [Compare](/matrix-org/synapse/compare/8c68d80244001425ef786b96a8aca08c004315cf..f60308be4b20388a0b96f93c88e0be9671dcce73)
[September 6, 2022 15:34](#event-7331635412)

[![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=80&v=4)](/squahtx)

Copy link

Contributor

Author

### **[squahtx](/squahtx)** commented [Sep 13, 2022](#issuecomment-1245591134) â€¢ edited Loading

| [@erikjohnston](https://github.com/erikjohnston) believes that Synapse does not handle rejected events in accordance with the spec. For now, we'll ensure that previously rejected events do not get admitted into state, otherwise lots of Synapse will break. |
| --- |

All reactions

Sorry, something went wrong.

 Sean Quah
added 3 commits
[September 13, 2022 16:38](#commits-pushed-c18193f)

`[Add test for missing prev events with rejected state](/matrix-org/synapse/pull/13723/commits/c18193fef6de7f5b08e41526648b1da82424ee86 "Add test for missing prev events with rejected state

Signed-off-by: Sean Quah <seanq@matrix.org>")`
 â€¦

`[c18193f](/matrix-org/synapse/pull/13723/commits/c18193fef6de7f5b08e41526648b1da82424ee86)`

```
Signed-off-by: Sean Quah <seanq@matrix.org>
```

`[Don't add previously rejected events to state during state res](/matrix-org/synapse/pull/13723/commits/bbb6c3b8d9f9b4d39b9cfae40676100781124196 "Don't add previously rejected events to state during state res

Signed-off-by: Sean Quah <seanq@matrix.org>")`
 â€¦

`[bbb6c3b](/matrix-org/synapse/pull/13723/commits/bbb6c3b8d9f9b4d39b9cfae40676100781124196)`

```
Signed-off-by: Sean Quah <seanq@matrix.org>
```

`[Add newsfile](/matrix-org/synapse/pull/13723/commits/973c8e5ccddaa3bbcc53700e0ea4a3887c12bdfa "Add newsfile")`

`[973c8e5](/matrix-org/synapse/pull/13723/commits/973c8e5ccddaa3bbcc53700e0ea4a3887c12bdfa)`

 [![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=40&v=4)](/squahtx)
[squahtx](/squahtx)
[force-pushed](/matrix-org/synapse/compare/f60308be4b20388a0b96f93c88e0be9671dcce73..973c8e5ccddaa3bbcc53700e0ea4a3887c12bdfa)
the
squah/fix\_rejected\_events\_in\_state

branch
from
[`f60308b`](/matrix-org/synapse/commit/f60308be4b20388a0b96f93c88e0be9671dcce73) to
[`973c8e5`](/matrix-org/synapse/commit/973c8e5ccddaa3bbcc53700e0ea4a3887c12bdfa)  [Compare](/matrix-org/synapse/compare/f60308be4b20388a0b96f93c88e0be9671dcce73..973c8e5ccddaa3bbcc53700e0ea4a3887c12bdfa)
[September 13, 2022 15:38](#event-7377906413)

 [![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=40&v=4)](/squahtx)
[squahtx](/squahtx)
marked this pull request as ready for review
[September 13, 2022 15:40](#event-7377919422)

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston)

`[Merge branch 'develop' into squah/fix_rejected_events_in_state](/matrix-org/synapse/pull/13723/commits/2431f0ea88949eacedc47b353d4d4bbf2ea05347 "Merge branch 'develop' into squah/fix_rejected_events_in_state")`

`[2431f0e](/matrix-org/synapse/pull/13723/commits/2431f0ea88949eacedc47b353d4d4bbf2ea05347)`

[![erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=60&v=4)](/erikjohnston)

**[erikjohnston](/erikjohnston)**
approved these changes
[Sep 14, 2022](#pullrequestreview-1107442485)

 [View reviewed changes](/matrix-org/synapse/pull/13723/files/2431f0ea88949eacedc47b353d4d4bbf2ea05347)

`[Merge remote-tracking branch 'origin/develop' into squah/fix_rejectedâ€¦](/matrix-org/synapse/pull/13723/commits/be4c8ebc2f3dc2747b21647378e11569cc642f1e "Merge remote-tracking branch 'origin/develop' into squah/fix_rejected_events_in_state")`
 â€¦

`[be4c8eb](/matrix-org/synapse/pull/13723/commits/be4c8ebc2f3dc2747b21647378e11569cc642f1e)`

```
â€¦_events_in_state
```

[![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=40&v=4)](/squahtx)
[squahtx](/squahtx)
merged commit [`b73cbb8`](/matrix-org/synapse/commit/b73cbb82157d9666e8d667733afebc0d09ed858c)
into
develop

[Sep 16, 2022](https://github.com/matrix-org/synapse/pull/13723#event-7402543268)

 [![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=40&v=4)](/squahtx)
[squahtx](/squahtx)
deleted the
squah/fix\_rejected\_events\_in\_state

branch
[September 16, 2022 11:45](#event-7402543355)

[Fizzadar](/Fizzadar)
added a commit
to beeper/synapse-legacy-fork
that referenced
this pull request
[Sep 30, 2022](#ref-commit-c5bdd1e)
[![@Fizzadar](https://avatars.githubusercontent.com/u/1026154?s=40&u=cf88c4d140704f56347ca70c0812610b99a3365b&v=4)](/Fizzadar)

`[Merge tag 'v1.68.0' into beeper](/beeper/synapse-legacy-fork/commit/c5bdd1e76d5e79dfca318f7d542b8d8e4b6f3e30 "Merge tag 'v1.68.0' into beeper

Synapse 1.68.0 (2022-09-27)
===========================

Please note that Synapse will now refuse to start if configured to use a version of SQLite older than 3.27.

In addition, please note that installing Synapse from a source checkout now requires a recent Rust compiler.
Those using packages will not be affected. On most platforms, installing with `pip install matrix-synapse` will not be affected.
See the [upgrade notes](https://matrix-org.github.io/synapse/v1.68/upgrade.html#upgrading-to-v1680).

Bugfixes
--------

- Fix packaging to include `Cargo.lock` in `sdist`. ([\#13909](https://github.com/matrix-org/synapse/issues/13909))

Synapse 1.68.0rc2 (2022-09-23)
==============================

Bugfixes
--------

- Fix building from packaged sdist. Broken in v1.68.0rc1. ([\#13866](https://github.com/matrix-org/synapse/issues/13866))

Internal Changes
----------------

- Fix the release script not publishing binary wheels. ([\#13850](https://github.com/matrix-org/synapse/issues/13850))
- Lower minimum supported rustc version to 1.58.1. ([\#13857](https://github.com/matrix-org/synapse/issues/13857))
- Lock Rust dependencies' versions. ([\#13858](https://github.com/matrix-org/synapse/issues/13858))

Synapse 1.68.0rc1 (2022-09-20)
==============================

Features
--------

- Keep track of when we fail to process a pulled event over federation so we can intelligently back off in the future. ([\#13589](https://github.com/matrix-org/synapse/issues/13589), [\#13814](https://github.com/matrix-org/synapse/issues/13814))
- Add an [admin API endpoint to fetch messages within a particular window of time](https://matrix-org.github.io/synapse/v1.68/admin_api/rooms.html#room-messages-api). ([\#13672](https://github.com/matrix-org/synapse/issues/13672))
- Add an [admin API endpoint to find a user based on their external ID in an auth provider](https://matrix-org.github.io/synapse/v1.68/admin_api/user_admin_api.html#find-a-user-based-on-their-id-in-an-auth-provider). ([\#13810](https://github.com/matrix-org/synapse/issues/13810))
- Cancel the processing of key query requests when they time out. ([\#13680](https://github.com/matrix-org/synapse/issues/13680))
- Improve validation of request bodies for the following client-server API endpoints: [`/account/3pid/msisdn/requestToken`](https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3pidmsisdnrequesttoken), [`/org.matrix.msc3720/account_status`](https://github.com/matrix-org/matrix-spec-proposals/blob/babolivier/user_status/proposals/3720-account-status.md#post-_matrixclientv1account_status), [`/account/3pid/add`](https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3pidadd), [`/account/3pid/bind`](https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3pidbind), [`/account/3pid/delete`](https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3piddelete) and [`/account/3pid/unbind`](https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3pidunbind). ([\#13687](https://github.com/matrix-org/synapse/issues/13687), [\#13736](https://github.com/matrix-org/synapse/issues/13736))
- Document the timestamp when a user accepts the consent, if [consent tracking](https://matrix-org.github.io/synapse/latest/consent_tracking.html) is used. ([\#13741](https://github.com/matrix-org/synapse/issues/13741))
- Add a `listeners[x].request_id_header` configuration option to specify which request header to extract and use as the request ID in order to correlate requests from a reverse proxy. ([\#13801](https://github.com/matrix-org/synapse/issues/13801))

Bugfixes
--------

- Fix a bug introduced in Synapse 1.41.0 where the `/hierarchy` API returned non-standard information (a `room_id` field under each entry in `children_state`). ([\#13506](https://github.com/matrix-org/synapse/issues/13506))
- Fix a long-standing bug where previously rejected events could end up in room state because they pass auth checks given the current state of the room. ([\#13723](https://github.com/matrix-org/synapse/issues/13723))
- Fix a long-standing bug where Synapse fails to start if a signing key file contains an empty line. ([\#13738](https://github.com/matrix-org/synapse/issues/13738))
- Fix a long-standing bug where Synapse would fail to handle malformed user IDs or room aliases gracefully in certain cases. ([\#13746](https://github.com/matrix-org/synapse/issues/13746))
- Fix a long-standing bug where device lists would remain cached when remote users left and rejoined the last room shared with the local homeserver. ([\#13749](https://github.com/matrix-org/synapse/issues/13749), [\#13826](https://github.com/matrix-org/synapse/issues/13826))
- Fix a long-standing bug that could cause stale caches in some rare cases on the first startup of Synapse with replication. ([\#13766](https://github.com/matrix-org/synapse/issues/13766))
- Fix a long-standing spec compliance bug where Synapse would accept a trailing slash on the end of `/get_missing_events` federation requests. ([\#13789](https://github.com/matrix-org/synapse/issues/13789))
- Delete associated data from `event_failed_pull_attempts`, `insertion_events`, `insertion_event_extremities`, `insertion_event_extremities`, `insertion_event_extremities` when purging the room. ([\#13825](https://github.com/matrix-org/synapse/issues/13825))

Improved Documentation
----------------------

- Note that `libpq` is required on ARM-based Macs. ([\#13480](https://github.com/matrix-org/synapse/issues/13480))
- Fix a mistake in the config manual introduced in Synapse 1.22.0: the `event_cache_size` _is_ scaled by `caches.global_factor`. ([\#13726](https://github.com/matrix-org/synapse/issues/13726))
- Fix a typo in the documentation for the login ratelimiting configuration. ([\#13727](https://github.com/matrix-org/synapse/issues/13727))
- Define Synapse's compatability policy for SQLite versions. ([\#13728](https://github.com/matrix-org/synapse/issues/13728))
- Add docs for the common fix of deleting the `matrix_synapse.egg-info/` directory for fixing Python dependency problems. ([\#13785](https://github.com/matrix-org/synapse/issues/13785))
- Update request log format documentation to mention the format used when the authenticated user is controlling another user. ([\#13794](https://github.com/matrix-org/synapse/issues/13794))

Deprecations and Removals
-------------------------

- Synapse will now refuse to start if configured to use SQLite < 3.27. ([\#13760](https://github.com/matrix-org/synapse/issues/13760))
- Don't include redundant `prev_state` in new events. Contributed by Denis Kariakin (@dakariakin). ([\#13791](https://github.com/matrix-org/synapse/issues/13791))

Internal Changes
----------------

- Add a stub Rust crate. ([\#12595](https://github.com/matrix-org/synapse/issues/12595), [\#13734](https://github.com/matrix-org/synapse/issues/13734), [\#13735](https://github.com/matrix-org/synapse/issues/13735), [\#13743](https://github.com/matrix-org/synapse/issues/13743), [\#13763](https://github.com/matrix-org/synapse/issues/13763), [\#13769](https://github.com/matrix-org/synapse/issues/13769), [\#13778](https://github.com/matrix-org/synapse/issues/13778))
- Bump the minimum dependency of `matrix_common` to 1.3.0 to make use of the `MXCUri` class. Use `MXCUri` to simplify media retention test code. ([\#13162](https://github.com/matrix-org/synapse/issues/13162))
- Add and populate the `event_stream_ordering` column on the `receipts` table for future optimisation of push action processing. Contributed by Nick @ Beeper (@fizzadar). ([\#13703](https://github.com/matrix-org/synapse/issues/13703))
- Rename the `EventFormatVersions` enum values so that they line up with room version numbers. ([\#13706](https://github.com/matrix-org/synapse/issues/13706))
- Update trial old deps CI to use Poetry 1.2.0. ([\#13707](https://github.com/matrix-org/synapse/issues/13707), [\#13725](https://github.com/matrix-org/synapse/issues/13725))
- Add experimental configuration option to allow disabling legacy Prometheus metric names. ([\#13714](https://github.com/matrix-org/synapse/issues/13714), [\#13717](https://github.com/matrix-org/synapse/issues/13717), [\#13718](https://github.com/matrix-org/synapse/issues/13718))
- Fix typechecking with latest types-jsonschema. ([\#13724](https://github.com/matrix-org/synapse/issues/13724))
- Strip number suffix from instance name to consolidate services that traces are spread over. ([\#13729](https://github.com/matrix-org/synapse/issues/13729))
- Instrument `get_metadata_for_events` for understandable traces in Jaeger. ([\#13730](https://github.com/matrix-org/synapse/issues/13730))
- Remove old queries to join room memberships to current state events. Contributed by Nick @ Beeper (@fizzadar). ([\#13745](https://github.com/matrix-org/synapse/issues/13745))
- Avoid raising an error due to malformed user IDs in `get_current_hosts_in_room`. Malformed user IDs cannot currently join a room, so this error would not be hit. ([\#13748](https://github.com/matrix-org/synapse/issues/13748))
- Update the docstrings for `get_users_in_room` and `get_current_hosts_in_room` to explain the impact of partial state. ([\#13750](https://github.com/matrix-org/synapse/issues/13750))
- Use an additional database query when persisting receipts. ([\#13752](https://github.com/matrix-org/synapse/issues/13752))
- Preparatory work for storing thread IDs for notifications and receipts. ([\#13753](https://github.com/matrix-org/synapse/issues/13753))
- Re-type hint some collections as read-only. ([\#13754](https://github.com/matrix-org/synapse/issues/13754))
- Remove unused Prometheus recording rules from `synapse-v2.rules` and add comments describing where the rest are used. ([\#13756](https://github.com/matrix-org/synapse/issues/13756))
- Add a check for editable installs if the Rust library needs rebuilding. ([\#13759](https://github.com/matrix-org/synapse/issues/13759))
- Tag traces with the instance name to be able to easily jump into the right logs and filter traces by instance. ([\#13761](https://github.com/matrix-org/synapse/issues/13761))
- Concurrently fetch room push actions when calculating badge counts. Contributed by Nick @ Beeper (@fizzadar). ([\#13765](https://github.com/matrix-org/synapse/issues/13765))
- Update the script which makes full schema dumps. ([\#13770](https://github.com/matrix-org/synapse/issues/13770))
- Deduplicate `is_server_notices_room`. ([\#13780](https://github.com/matrix-org/synapse/issues/13780))
- Simplify the dependency DAG in the tests workflow. ([\#13784](https://github.com/matrix-org/synapse/issues/13784))
- Remove an old, incorrect migration file. ([\#13788](https://github.com/matrix-org/synapse/issues/13788))
- Remove unused method in `synapse.api.auth.Auth`. ([\#13795](https://github.com/matrix-org/synapse/issues/13795))
- Fix a memory leak when running the unit tests. ([\#13798](https://github.com/matrix-org/synapse/issues/13798))
- Use partial indices on SQLite. ([\#13802](https://github.com/matrix-org/synapse/issues/13802))
- Check that portdb generates the same postgres schema as that in the source tree. ([\#13808](https://github.com/matrix-org/synapse/issues/13808))
- Fix Docker build when Rust .so has been built locally first. ([\#13811](https://github.com/matrix-org/synapse/issues/13811))
- Complement: Initialise the Postgres database directly inside the target image instead of the base Postgres image to fix building using Buildah. ([\#13819](https://github.com/matrix-org/synapse/issues/13819))
- Support providing an index predicate clause when doing upserts. ([\#13822](https://github.com/matrix-org/synapse/issues/13822))
- Minor speedups to linting in CI. ([\#13827](https://github.com/matrix-org/synapse/issues/13827))

# -----BEGIN PGP SIGNATURE-----
#
# iQIzBAABCAAdFiEE1508oLYUKainYFJakD7OEIo53t0FAmMy4FoACgkQkD7OEIo5
# 3t009g/6A4S26H6NG4GM44JD9+OB25fO59m9UAWWLrePmOKsBaGXVp86scPq9epI
# vQbr4Czi8WEqCJlMRxIWLXv7BL3TLXnLF1vC0wSE6YiJqrPU9vMZ0UYxWNErl8Sr
# eFBpuHXDlfppQUXs903iNmXVbdTpXCVjdTEwaZmgU1/FKydgU0o90PQseb/hnegX
# hcJrepL6xhcs37fP2zdlixissLQ85WE10x6h7FX+SkCEHGvkiKrqSvXsS4ZN0Scn
# vGCy3GD69j/ZpRu7RczdDwwzCRerg6r7spokRK/b6pzz9sXmCyY8SrrUyEEdzveN
# uEEe4A8vmR3v0sR4Ao2cGZ7zy/jq6WyrWjmfOd+hfYD9tXx/g8190RFkRQrrkYVU
# jTNdD6Zom0rtENEgHuFQ8joD96MNsaq4dvDefYYpcXDOh3YZnA/fiwfmG9XZRq6u
# B42RZEtUZ3sjZ3VdRb3AvhPTTrY4kiwEqVBFSUTBKEAKXQtdrsiqv2QPvQTSC5BJ
# YFXMwj32E7Zi3mTYjl60yggtBAxYt49KsHL8qAq75t6A38HpnYEyEW1R3S6VDmtp
# rIR5ktxyzoGvxpJ4YPUdC4A2hbaOztwPvGE3iEDiPgUdkfb6m8x3MhaWhShid4Df
# v2BQu+SFIl1wXPLxjlX2rmkQMhUGD2RGYmkUgYfoWnjdTtQV10w=
# =4eYj
# -----END PGP SIGNATURE-----
# gpg: Signature made Tue Sep 27 12:36:58 2022 BST
# gpg:                using RSA key D79D3CA0B61429A8A760525A903ECE108A39DEDD
# gpg: Can't check signature: No public key

# Conflicts:
#	docker/Dockerfile
#	poetry.lock
#	synapse/push/bulk_push_rule_evaluator.py
#	synapse/push/push_tools.py
#	synapse/storage/databases/main/event_push_actions.py
#	synapse/storage/databases/main/events_worker.py
#	tests/replication/slave/storage/test_events.py")`
â€¦

`[c5bdd1e](/beeper/synapse-legacy-fork/commit/c5bdd1e76d5e79dfca318f7d542b8d8e4b6f3e30)`

```
Synapse 1.68.0 (2022-09-27)
===========================

Please note that Synapse will now refuse to start if configured to use a version of SQLite older than 3.27.

In addition, please note that installing Synapse from a source checkout now requires a recent Rust compiler.
Those using packages will not be affected. On most platforms, installing with `pip install matrix-synapse` will not be affected.
See the [upgrade notes](<https://matrix-org.github.io/synapse/v1.68/upgrade.html#upgrading-to-v1680>).

Bugfixes
--------

- Fix packaging to include `Cargo.lock` in `sdist`. ([\[matrix-org#13909](https://github.com/matrix-org/synapse/pull/13909)]([matrix-org#13909](https://github.com/matrix-org/synapse/pull/13909)))

Synapse 1.68.0rc2 (2022-09-23)
==============================

Bugfixes
--------

- Fix building from packaged sdist. Broken in v1.68.0rc1. ([\[matrix-org#13866](https://github.com/matrix-org/synapse/pull/13866)]([matrix-org#13866](https://github.com/matrix-org/synapse/pull/13866)))

Internal Changes
----------------

- Fix the release script not publishing binary wheels. ([\[matrix-org#13850](https://github.com/matrix-org/synapse/pull/13850)]([matrix-org#13850](https://github.com/matrix-org/synapse/pull/13850)))
- Lower minimum supported rustc version to 1.58.1. ([\[matrix-org#13857](https://github.com/matrix-org/synapse/pull/13857)]([matrix-org#13857](https://github.com/matrix-org/synapse/pull/13857)))
- Lock Rust dependencies' versions. ([\[matrix-org#13858](https://github.com/matrix-org/synapse/pull/13858)]([matrix-org#13858](https://github.com/matrix-org/synapse/pull/13858)))

Synapse 1.68.0rc1 (2022-09-20)
==============================

Features
--------

- Keep track of when we fail to process a pulled event over federation so we can intelligently back off in the future. ([\[matrix-org#13589](https://github.com/matrix-org/synapse/pull/13589)]([matrix-org#13589](https://github.com/matrix-org/synapse/pull/13589)), [\[matrix-org#13814](https://github.com/matrix-org/synapse/pull/13814)]([matrix-org#13814](https://github.com/matrix-org/synapse/pull/13814)))
- Add an [admin API endpoint to fetch messages within a particular window of time](<https://matrix-org.github.io/synapse/v1.68/admin_api/rooms.html#room-messages-api>). ([\[matrix-org#13672](https://github.com/matrix-org/synapse/pull/13672)]([matrix-org#13672](https://github.com/matrix-org/synapse/pull/13672)))
- Add an [admin API endpoint to find a user based on their external ID in an auth provider](<https://matrix-org.github.io/synapse/v1.68/admin_api/user_admin_api.html#find-a-user-based-on-their-id-in-an-auth-provider>). ([\[matrix-org#13810](https://github.com/matrix-org/synapse/pull/13810)]([matrix-org#13810](https://github.com/matrix-org/synapse/pull/13810)))
- Cancel the processing of key query requests when they time out. ([\[matrix-org#13680](https://github.com/matrix-org/synapse/pull/13680)]([matrix-org#13680](https://github.com/matrix-org/synapse/pull/13680)))
- Improve validation of request bodies for the following client-server API endpoints: [`/account/3pid/msisdn/requestToken`](<https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3pidmsisdnrequesttoken>), [`/org.matrix.msc3720/account_status`](<https://github.com/matrix-org/matrix-spec-proposals/blob/babolivier/user_status/proposals/3720-account-status.md#post-_matrixclientv1account_status>), [`/account/3pid/add`](<https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3pidadd>), [`/account/3pid/bind`](<https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3pidbind>), [`/account/3pid/delete`](<https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3piddelete>) and [`/account/3pid/unbind`](<https://spec.matrix.org/v1.3/client-server-api/#post_matrixclientv3account3pidunbind>). ([\[matrix-org#13687](https://github.com/matrix-org/synapse/pull/13687)]([matrix-org#13687](https://github.com/matrix-org/synapse/pull/13687)), [\[matrix-org#13736](https://github.com/matrix-org/synapse/pull/13736)]([matrix-org#13736](https://github.com/matrix-org/synapse/pull/13736)))
- Document the timestamp when a user accepts the consent, if [consent tracking](<https://matrix-org.github.io/synapse/latest/consent_tracking.html>) is used. ([\[matrix-org#13741](https://github.com/matrix-org/synapse/pull/13741)]([matrix-org#13741](https://github.com/matrix-org/synapse/pull/13741)))
- Add a `listeners[x].request_id_header` configuration option to specify which request header to extract and use as the request ID in order to correlate requests from a reverse proxy. ([\[matrix-org#13801](https://github.com/matrix-org/synapse/pull/13801)]([matrix-org#13801](https://github.com/matrix-org/synapse/pull/13801)))

Bugfixes
--------

- Fix a bug introduced in Synapse 1.41.0 where the `/hierarchy` API returned non-standard information (a `room_id` field under each entry in `children_state`). ([\[matrix-org#13506](https://github.com/matrix-org/synapse/pull/13506)]([matrix-org#13506](https://github.com/matrix-org/synapse/pull/13506)))
- Fix a long-standing bug where previously rejected events could end up in room state because they pass auth checks given the current state of the room. ([\[matrix-org#13723](https://github.com/matrix-org/synapse/pull/13723)]([matrix-org#13723](https://github.com/matrix-org/synapse/pull/13723)))
- Fix a long-standing bug where Synapse fails to start if a signing key file contains an empty line. ([\[matrix-org#13738](https://github.com/matrix-org/synapse/pull/13738)]([matrix-org#13738](https://github.com/matrix-org/synapse/pull/13738)))
- Fix a long-standing bug where Synapse would fail to handle malformed user IDs or room aliases gracefully in certain cases. ([\[matrix-org#13746](https://github.com/matrix-org/synapse/pull/13746)]([matrix-org#13746](https://github.com/matrix-org/synapse/pull/13746)))
- Fix a long-standing bug where device lists would remain cached when remote users left and rejoined the last room shared with the local homeserver. ([\[matrix-org#13749](https://github.com/matrix-org/synapse/pull/13749)]([matrix-org#13749](https://github.com/matrix-org/synapse/pull/13749)), [\[matrix-org#13826](https://github.com/matrix-org/synapse/pull/13826)]([matrix-org#13826](https://github.com/matrix-org/synapse/pull/13826)))
- Fix a long-standing bug that could cause stale caches in some rare cases on the first startup of Synapse with replication. ([\[matrix-org#13766](https://github.com/matrix-org/synapse/pull/13766)]([matrix-org#13766](https://github.com/matrix-org/synapse/pull/13766)))
- Fix a long-standing spec compliance bug where Synapse would accept a trailing slash on the end of `/get_missing_events` federation requests. ([\[matrix-org#13789](https://github.com/matrix-org/synapse/pull/13789)]([matrix-org#13789](https://github.com/matrix-org/synapse/pull/13789)))
- Delete associated data from `event_failed_pull_attempts`, `insertion_events`, `insertion_event_extremities`, `insertion_event_extremities`, `insertion_event_extremities` when purging the room. ([\[matrix-org#13825](https://github.com/matrix-org/synapse/pull/13825)]([matrix-org#13825](https://github.com/matrix-org/synapse/pull/13825)))

Improved Documentation
----------------------

- Note that `libpq` is required on ARM-based Macs. ([\[matrix-org#13480](https://github.com/matrix-org/synapse/pull/13480)]([matrix-org#13480](https://github.com/matrix-org/synapse/pull/13480)))
- Fix a mistake in the config manual introduced in Synapse 1.22.0: the `event_cache_size` _is_ scaled by `caches.global_factor`. ([\[matrix-org#13726](https://github.com/matrix-org/synapse/pull/13726)]([matrix-org#13726](https://github.com/matrix-org/synapse/pull/13726)))
- Fix a typo in the documentation for the login ratelimiting configuration. ([\[matrix-org#13727](https://github.com/matrix-org/synapse/pull/13727)]([matrix-org#13727](https://github.com/matrix-org/synapse/pull/13727)))
- Define Synapse's compatability policy for SQLite versions. ([\[matrix-org#13728](https://github.com/matrix-org/synapse/pull/13728)]([matrix-org#13728](https://github.com/matrix-org/synapse/pull/13728)))
- Add docs for the common fix of deleting the `matrix_synapse.egg-info/` directory for fixing Python dependency problems. ([\[matrix-org#13785](https://github.com/matrix-org/synapse/pull/13785)]([matrix-org#13785](https://github.com/matrix-org/synapse/pull/13785)))
- Update request log format documentation to mention the format used when the authenticated user is controlling another user. ([\[matrix-org#13794](https://github.com/matrix-org/synapse/pull/13794)]([matrix-org#13794](https://github.com/matrix-org/synapse/pull/13794)))

Deprecations and Removals
-------------------------

- Synapse will now refuse to start if configured to use SQLite < 3.27. ([\[matrix-org#13760](https://github.com/matrix-org/synapse/pull/13760)]([matrix-org#13760](https://github.com/matrix-org/synapse/pull/13760)))
- Don't include redundant `prev_state` in new events. Contributed by Denis Kariakin ([@dakariakin](https://github.com/dakariakin)). ([\[matrix-org#13791](https://github.com/matrix-org/synapse/pull/13791)]([matrix-org#13791](https://github.com/matrix-org/synapse/pull/13791)))

Internal Changes
----------------

- Add a stub Rust crate. ([\[matrix-org#12595](https://github.com/matrix-org/synapse/pull/12595)]([matrix-org#12595](https://github.com/matrix-org/synapse/pull/12595)), [\[matrix-org#13734](https://github.com/matrix-org/synapse/pull/13734)]([matrix-org#13734](https://github.com/matrix-org/synapse/pull/13734)), [\[matrix-org#13735](https://github.com/matrix-org/synapse/pull/13735)]([matrix-org#13735](https://github.com/matrix-org/synapse/pull/13735)), [\[matrix-org#13743](https://github.com/matrix-org/synapse/pull/13743)]([matrix-org#13743](https://github.com/matrix-org/synapse/pull/13743)), [\[matrix-org#13763](https://github.com/matrix-org/synapse/pull/13763)]([matrix-org#13763](https://github.com/matrix-org/synapse/pull/13763)), [\[matrix-org#13769](https://github.com/matrix-org/synapse/pull/13769)]([matrix-org#13769](https://github.com/matrix-org/synapse/pull/13769)), [\[matrix-org#13778](https://github.com/matrix-org/synapse/pull/13778)]([matrix-org#13778](https://github.com/matrix-org/synapse/pull/13778)))
- Bump the minimum dependency of `matrix_common` to 1.3.0 to make use of the `MXCUri` class. Use `MXCUri` to simplify media retention test code. ([\[matrix-org#13162](https://github.com/matrix-org/synapse/pull/13162)]([matrix-org#13162](https://github.com/matrix-org/synapse/pull/13162)))
- Add and populate the `event_stream_ordering` column on the `receipts` table for future optimisation of push action processing. Contributed by Nick @ Beeper ([@Fizzadar](https://github.com/Fizzadar)). ([\[matrix-org#13703](https://github.com/matrix-org/synapse/pull/13703)]([matrix-org#13703](https://github.com/matrix-org/synapse/pull/13703)))
- Rename the `EventFormatVersions` enum values so that they line up with room version numbers. ([\[matrix-org#13706](https://github.com/matrix-org/synapse/pull/13706)]([matrix-org#13706](https://github.com/matrix-org/synapse/pull/13706)))
- Update trial old deps CI to use Poetry 1.2.0. ([\[matrix-org#13707](https://github.com/matrix-org/synapse/pull/13707)]([matrix-org#13707](https://github.com/matrix-org/synapse/pull/13707)), [\[matrix-org#13725](https://github.com/matrix-org/synapse/pull/13725)]([matrix-org#13725](https://github.com/matrix-org/synapse/pull/13725)))
- Add experimental configuration option to allow disabling legacy Prometheus metric names. ([\[matrix-org#13714](https://github.com/matrix-org/synapse/pull/13714)]([matrix-org#13714](https://github.com/matrix-org/synapse/pull/13714)), [\[matrix-org#13717](https://github.com/matrix-org/synapse/pull/13717)]([matrix-org#13717](https://github.com/matrix-org/synapse/pull/13717)), [\[matrix-org#13718](https://github.com/matrix-org/synapse/pull/13718)]([matrix-org#13718](https://github.com/matrix-org/synapse/pull/13718)))
- Fix typechecking with latest types-jsonschema. ([\[matrix-org#13724](https://github.com/matrix-org/synapse/pull/13724)]([matrix-org#13724](https://github.com/matrix-org/synapse/pull/13724)))
- Strip number suffix from instance name to consolidate services that traces are spread over. ([\[matrix-org#13729](https://github.com/matrix-org/synapse/pull/13729)]([matrix-org#13729](https://github.com/matrix-org/synapse/pull/13729)))
- Instrument `get_metadata_for_events` for understandable traces in Jaeger. ([\[matrix-org#13730](https://github.com/matrix-org/synapse/pull/13730)]([matrix-org#13730](https://github.com/matrix-org/synapse/pull/13730)))
- Remove old queries to join room memberships to current state events. Contributed by Nick @ Beeper ([@Fizzadar](https://github.com/Fizzadar)). ([\[matrix-org#13745](https://github.com/matrix-org/synapse/pull/13745)]([matrix-org#13745](https://github.com/matrix-org/synapse/pull/13745)))
- Avoid raising an error due to malformed user IDs in `get_current_hosts_in_room`. Malformed user IDs cannot currently join a room, so this error would not be hit. ([\[matrix-org#13748](https://github.com/matrix-org/synapse/pull/13748)]([matrix-org#13748](https://github.com/matrix-org/synapse/pull/13748)))
- Update the docstrings for `get_users_in_room` and `get_current_hosts_in_room` to explain the impact of partial state. ([\[matrix-org#13750](https://github.com/matrix-org/synapse/pull/13750)]([matrix-org#13750](https://github.com/matrix-org/synapse/pull/13750)))
- Use an additional database query when persisting receipts. ([\[matrix-org#13752](https://github.com/matrix-org/synapse/pull/13752)]([matrix-org#13752](https://github.com/matrix-org/synapse/pull/13752)))
- Preparatory work for storing thread IDs for notifications and receipts. ([\[matrix-org#13753](https://github.com/matrix-org/synapse/pull/13753)]([matrix-org#13753](https://github.com/matrix-org/synapse/pull/13753)))
- Re-type hint some collections as read-only. ([\[matrix-org#13754](https://github.com/matrix-org/synapse/pull/13754)]([matrix-org#13754](https://github.com/matrix-org/synapse/pull/13754)))
- Remove unused Prometheus recording rules from `synapse-v2.rules` and add comments describing where the rest are used. ([\[matrix-org#13756](https://github.com/matrix-org/synapse/pull/13756)]([matrix-org#13756](https://github.com/matrix-org/synapse/pull/13756)))
- Add a check for editable installs if the Rust library needs rebuilding. ([\[matrix-org#13759](https://github.com/matrix-org/synapse/pull/13759)]([matrix-org#13759](https://github.com/matrix-org/synapse/pull/13759)))
- Tag traces with the instance name to be able to easily jump into the right logs and filter traces by instance. ([\[matrix-org#13761](https://github.com/matrix-org/synapse/pull/13761)]([matrix-org#13761](https://github.com/matrix-org/synapse/pull/13761)))
- Concurrently fetch room push actions when calculating badge counts. Contributed by Nick @ Beeper ([@Fizzadar](https://github.com/Fizzadar)). ([\[matrix-org#13765](https://github.com/matrix-org/synapse/pull/13765)]([matrix-org#13765](https://github.com/matrix-org/synapse/pull/13765)))
- Update the script which makes full schema dumps. ([\[matrix-org#13770](https://github.com/matrix-org/synapse/pull/13770)]([matrix-org#13770](https://github.com/matrix-org/synapse/pull/13770)))
- Deduplicate `is_server_notices_room`. ([\[matrix-org#13780](https://github.com/matrix-org/synapse/pull/13780)]([matrix-org#13780](https://github.com/matrix-org/synapse/pull/13780)))
- Simplify the dependency DAG in the tests workflow. ([\[matrix-org#13784](https://github.com/matrix-org/synapse/pull/13784)]([matrix-org#13784](https://github.com/matrix-org/synapse/pull/13784)))
- Remove an old, incorrect migration file. ([\[matrix-org#13788](https://github.com/matrix-org/synapse/pull/13788)]([matrix-org#13788](https://github.com/matrix-org/synapse/pull/13788)))
- Remove unused method in `synapse.api.auth.Auth`. ([\[matrix-org#13795](https://github.com/matrix-org/synapse/pull/13795)]([matrix-org#13795](https://github.com/matrix-org/synapse/pull/13795)))
- Fix a memory leak when running the unit tests. ([\[matrix-org#13798](https://github.com/matrix-org/synapse/pull/13798)]([matrix-org#13798](https://github.com/matrix-org/synapse/pull/13798)))
- Use partial indices on SQLite. ([\[matrix-org#13802](https://github.com/matrix-org/synapse/pull/13802)]([matrix-org#13802](https://github.com/matrix-org/synapse/pull/13802)))
- Check that portdb generates the same postgres schema as that in the source tree. ([\[matrix-org#13808](https://github.com/matrix-org/synapse/pull/13808)]([matrix-org#13808](https://github.com/matrix-org/synapse/pull/13808)))
- Fix Docker build when Rust .so has been built locally first. ([\[matrix-org#13811](https://github.com/matrix-org/synapse/pull/13811)]([matrix-org#13811](https://github.com/matrix-org/synapse/pull/13811)))
- Complement: Initialise the Postgres database directly inside the target image instead of the base Postgres image to fix building using Buildah. ([\[matrix-org#13819](https://github.com/matrix-org/synapse/pull/13819)]([matrix-org#13819](https://github.com/matrix-org/synapse/pull/13819)))
- Support providing an index predicate clause when doing upserts. ([\[matrix-org#13822](https://github.com/matrix-org/synapse/pull/13822)]([matrix-org#13822](https://github.com/matrix-org/synapse/pull/13822)))
- Minor speedups to linting in CI. ([\[matrix-org#13827](https://github.com/matrix-org/synapse/pull/13827)]([matrix-org#13827](https://github.com/matrix-org/synapse/pull/13827)))

# -----BEGIN PGP SIGNATURE-----
#
# iQIzBAABCAAdFiEE1508oLYUKainYFJakD7OEIo53t0FAmMy4FoACgkQkD7OEIo5
# 3t009g/6A4S26H6NG4GM44JD9+OB25fO59m9UAWWLrePmOKsBaGXVp86scPq9epI
# vQbr4Czi8WEqCJlMRxIWLXv7BL3TLXnLF1vC0wSE6YiJqrPU9vMZ0UYxWNErl8Sr
# eFBpuHXDlfppQUXs903iNmXVbdTpXCVjdTEwaZmgU1/FKydgU0o90PQseb/hnegX
# hcJrepL6xhcs37fP2zdlixissLQ85WE10x6h7FX+SkCEHGvkiKrqSvXsS4ZN0Scn
# vGCy3GD69j/ZpRu7RczdDwwzCRerg6r7spokRK/b6pzz9sXmCyY8SrrUyEEdzveN
# uEEe4A8vmR3v0sR4Ao2cGZ7zy/jq6WyrWjmfOd+hfYD9tXx/g8190RFkRQrrkYVU
# jTNdD6Zom0rtENEgHuFQ8joD96MNsaq4dvDefYYpcXDOh3YZnA/fiwfmG9XZRq6u
# B42RZEtUZ3sjZ3VdRb3AvhPTTrY4kiwEqVBFSUTBKEAKXQtdrsiqv2QPvQTSC5BJ
# YFXMwj32E7Zi3mTYjl60yggtBAxYt49KsHL8qAq75t6A38HpnYEyEW1R3S6VDmtp
# rIR5ktxyzoGvxpJ4YPUdC4A2hbaOztwPvGE3iEDiPgUdkfb6m8x3MhaWhShid4Df
# v2BQu+SFIl1wXPLxjlX2rmkQMhUGD2RGYmkUgYfoWnjdTtQV10w=
# =4eYj
# -----END PGP SIGNATURE-----
# gpg: Signature made Tue Sep 27 12:36:58 2022 BST
# gpg:                using RSA key D79D3CA0B61429A8A760525A903ECE108A39DEDD
# gpg: Can't check signature: No public key

# Conflicts:
#	docker/Dockerfile
#	poetry.lock
#	synapse/push/bulk_push_rule_evaluator.py
#	synapse/push/push_tools.py
#	synapse/storage/databases/main/event_push_actions.py
#	synapse/storage/databases/main/events_worker.py
#	tests/replication/slave/storage/test_events.py
```

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F13723).

Reviewers

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston) [erikjohnston](/erikjohnston)

erikjohnston approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@squahtx](https://avatars.githubusercontent.com/u/8349537?s=52&v=4)](/squahtx) [![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=52&v=4)](/erikjohnston)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


