=== Content from github.com_f2d4f68a_20250114_234644.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fcommit%2Ff1e97688e4e19d6de1dfa1d00e04655209d39f8e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fcommit%2Ff1e97688e4e19d6de1dfa1d00e04655209d39f8e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=theonedev%2Fonedev)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theonedev](/theonedev)
/
**[onedev](/theonedev/onedev)**
Public

* [Notifications](/login?return_to=%2Ftheonedev%2Fonedev) You must be signed in to change notification settings
* [Fork
  873](/login?return_to=%2Ftheonedev%2Fonedev)
* [Star
   13.6k](/login?return_to=%2Ftheonedev%2Fonedev)

* [Code](/theonedev/onedev)
* [Pull requests
  0](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

Additional navigation options

* [Code](/theonedev/onedev)
* [Pull requests](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

## Commit

[Permalink](/theonedev/onedev/commit/f1e97688e4e19d6de1dfa1d00e04655209d39f8e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix security vulnerability related to Git pre/post receive callback

[Browse files](/theonedev/onedev/tree/f1e97688e4e19d6de1dfa1d00e04655209d39f8e)
Browse the repository at this point in the history

* Loading branch information

[![@robinshine](https://avatars.githubusercontent.com/u/3423576?s=40&v=4)](/robinshine)

[robinshine](/theonedev/onedev/commits?author=robinshine "View all commits by robinshine")
committed
May 30, 2022

1 parent
[910bb99](/theonedev/onedev/commit/910bb999b0c75292dd7b346accaaf854301fc675)

commit f1e9768

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**17 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* server-core/src/main

  + java/io/onedev/server

    - entitymanager/impl

      * server-core/src/main/java/io/onedev/server/entitymanager/impl/DefaultProjectManager.java
        [DefaultProjectManager.java](#diff-6baa4026bf397da270a210b0419edbb660265c49811b6e0b0f0967b403b99422)
    - git

      * server-core/src/main/java/io/onedev/server/git/GitFilter.java
        [GitFilter.java](#diff-fab931a96c5becd463829f0678939bcc228e31e8a08ede4f4aa31cba9c710825)
      * server-core/src/main/java/io/onedev/server/git/GitSshCommand.java
        [GitSshCommand.java](#diff-cae0f3db6dd8a3f601f904843a7040c1dfd9eb23f2ad9375f408c0bdee63a8cb)
      * server-core/src/main/java/io/onedev/server/git/GitUtils.java
        [GitUtils.java](#diff-079bcdf6a5430a795bc1399427eab34cd231fad76ced03e6064c2ae9fe7e1e7b)
      * hookcallback

        + server-core/src/main/java/io/onedev/server/git/hookcallback/GitPostReceiveCallback.java
          [GitPostReceiveCallback.java](#diff-e1fd1e5b85c95515bf5be6f91174888dd00dd4b5771f4bf4c509d7b35b3dcc10)
        + server-core/src/main/java/io/onedev/server/git/hookcallback/GitPreReceiveCallback.java
          [GitPreReceiveCallback.java](#diff-86898059f89ec5e474248ae154eb7f650d4d74464241e3d946301f77ca6c7d3d)
  + resources

    - server-core/src/main/resources/git-receive-hook
      [git-receive-hook](#diff-7d4a32bbb3de9974665eeb418523a0afba601fc858aeb46af1ac6ce0186e1a5f)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[server-core/src/main/java/io/onedev/server/entitymanager/impl/DefaultProjectManager.java](#diff-6baa4026bf397da270a210b0419edbb660265c49811b6e0b0f0967b403b99422 "server-core/src/main/java/io/onedev/server/entitymanager/impl/DefaultProjectManager.java")

Show comments

[View file](/theonedev/onedev/blob/f1e97688e4e19d6de1dfa1d00e04655209d39f8e/server-core/src/main/java/io/onedev/server/entitymanager/impl/DefaultProjectManager.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -537,7 +537,7 @@ private boolean isGitHookValid(File gitDir, String hookName) { |
|  |  |  |
|  |  | try { |
|  |  | String content = FileUtils.readFileToString(hookFile, Charset.defaultCharset()); |
|  |  | if (!content.contains("ENV\_GIT\_ALTERNATE\_OBJECT\_DIRECTORIES")) |
|  |  | if (!content.contains("ONEDEV\_HOOK\_TOKEN")) |
|  |  | return false; |
|  |  | } catch (IOException e) { |
|  |  | throw new RuntimeException(e); |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[server-core/src/main/java/io/onedev/server/git/GitFilter.java](#diff-fab931a96c5becd463829f0678939bcc228e31e8a08ede4f4aa31cba9c710825 "server-core/src/main/java/io/onedev/server/git/GitFilter.java")

Show comments

[View file](/theonedev/onedev/blob/f1e97688e4e19d6de1dfa1d00e04655209d39f8e/server-core/src/main/java/io/onedev/server/git/GitFilter.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -143,6 +143,7 @@ protected void processPacks(final HttpServletRequest request, final HttpServletR |
|  |  | environments.put("ONEDEV\_CURL", settingManager.getSystemSetting().getCurlConfig().getExecutable()); |
|  |  | environments.put("ONEDEV\_URL", serverUrl); |
|  |  | environments.put("ONEDEV\_USER\_ID", SecurityUtils.getUserId().toString()); |
|  |  | environments.put("ONEDEV\_HOOK\_TOKEN", GitUtils.HOOK\_TOKEN); |
|  |  | environments.put("ONEDEV\_REPOSITORY\_ID", project.getId().toString()); |
|  |  |  |
|  |  | // to be compatible with old repository |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[server-core/src/main/java/io/onedev/server/git/GitSshCommand.java](#diff-cae0f3db6dd8a3f601f904843a7040c1dfd9eb23f2ad9375f408c0bdee63a8cb "server-core/src/main/java/io/onedev/server/git/GitSshCommand.java")

Show comments

[View file](/theonedev/onedev/blob/f1e97688e4e19d6de1dfa1d00e04655209d39f8e/server-core/src/main/java/io/onedev/server/git/GitSshCommand.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -75,6 +75,7 @@ private Map<String, String> buildGitEnvs(Project project) { |
|  |  | SettingManager settingManager = OneDev.getInstance(SettingManager.class); |
|  |  | environments.put("ONEDEV\_CURL", settingManager.getSystemSetting().getCurlConfig().getExecutable()); |
|  |  | environments.put("ONEDEV\_URL", serverUrl); |
|  |  | environments.put("ONEDEV\_HOOK\_TOKEN", GitUtils.HOOK\_TOKEN); |
|  |  | environments.put("ONEDEV\_USER\_ID", SecurityUtils.getUserId().toString()); |
|  |  | environments.put("ONEDEV\_REPOSITORY\_ID", project.getId().toString()); |
|  |  | return environments; |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[server-core/src/main/java/io/onedev/server/git/GitUtils.java](#diff-079bcdf6a5430a795bc1399427eab34cd231fad76ced03e6064c2ae9fe7e1e7b "server-core/src/main/java/io/onedev/server/git/GitUtils.java")

Show comments

[View file](/theonedev/onedev/blob/f1e97688e4e19d6de1dfa1d00e04655209d39f8e/server-core/src/main/java/io/onedev/server/git/GitUtils.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,6 +16,7 @@ |
|  |  |  |
|  |  | import javax.annotation.Nullable; |
|  |  |  |
|  |  | import org.apache.commons.lang3.RandomStringUtils; |
|  |  | import org.bouncycastle.bcpg.ArmoredOutputStream; |
|  |  | import org.bouncycastle.bcpg.BCPGOutputStream; |
|  |  | import org.bouncycastle.bcpg.HashAlgorithmTags; |
| Expand Down  Expand Up | | @@ -97,6 +98,8 @@ public class GitUtils { |
|  |  |  |
|  |  | private static final Logger logger = LoggerFactory.getLogger(GitUtils.class); |
|  |  |  |
|  |  | public static final String HOOK\_TOKEN = RandomStringUtils.randomAlphanumeric(20); |
|  |  |  |
|  |  | public static boolean isEmptyPath(String path) { |
|  |  | return Strings.isNullOrEmpty(path) || Objects.equal(path, DiffEntry.DEV\_NULL); |
|  |  | } |
| Expand Down | |  |

14 changes: 5 additions & 9 deletions

14
[server-core/src/main/java/io/onedev/server/git/hookcallback/GitPostReceiveCallback.java](#diff-e1fd1e5b85c95515bf5be6f91174888dd00dd4b5771f4bf4c509d7b35b3dcc10 "server-core/src/main/java/io/onedev/server/git/hookcallback/GitPostReceiveCallback.java")

Show comments

[View file](/theonedev/onedev/blob/f1e97688e4e19d6de1dfa1d00e04655209d39f8e/server-core/src/main/java/io/onedev/server/git/hookcallback/GitPostReceiveCallback.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,6 @@ |
|  |  | package io.onedev.server.git.hookcallback; |
|  |  |  |
|  |  | import java.io.IOException; |
|  |  | import java.net.InetAddress; |
|  |  | import java.util.ArrayList; |
|  |  | import java.util.Enumeration; |
|  |  | import java.util.List; |
| Expand Down  Expand Up | | @@ -56,17 +55,14 @@ public GitPostReceiveCallback(ProjectManager projectManager, SessionManager sess |
|  |  | @Sessional |
|  |  | @Override |
|  |  | protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { |
|  |  | String clientIp = request.getHeader("X-Forwarded-For"); |
|  |  | if (clientIp == null) clientIp = request.getRemoteAddr(); |
|  |  |  |
|  |  | if (!InetAddress.getByName(clientIp).isLoopbackAddress()) { |
|  |  | List<String> fields = StringUtils.splitAndTrim(request.getPathInfo(), "/"); |
|  |  | Preconditions.checkState(fields.size() == 3); |
|  |  |  |
|  |  | if (!fields.get(2).equals(GitUtils.HOOK\_TOKEN)) { |
|  |  | response.sendError(HttpServletResponse.SC\_FORBIDDEN, |
|  |  | "Git hook callbacks can only be accessed from localhost."); |
|  |  | "Git hook callbacks can only be accessed by OneDev itself"); |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | List<String> fields = StringUtils.splitAndTrim(request.getPathInfo(), "/"); |
|  |  | Preconditions.checkState(fields.size() == 2); |
|  |  |  |
|  |  | Project project = projectManager.load(Long.valueOf(fields.get(0))); |
|  |  | Long userId = Long.valueOf(fields.get(1)); |
| Expand Down | |  |

14 changes: 5 additions & 9 deletions

14
[server-core/src/main/java/io/onedev/server/git/hookcallback/GitPreReceiveCallback.java](#diff-86898059f89ec5e474248ae154eb7f650d4d74464241e3d946301f77ca6c7d3d "server-core/src/main/java/io/onedev/server/git/hookcallback/GitPreReceiveCallback.java")

Show comments

[View file](/theonedev/onedev/blob/f1e97688e4e19d6de1dfa1d00e04655209d39f8e/server-core/src/main/java/io/onedev/server/git/hookcallback/GitPreReceiveCallback.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,7 +1,6 @@ |
|  |  | package io.onedev.server.git.hookcallback; |
|  |  |  |
|  |  | import java.io.IOException; |
|  |  | import java.net.InetAddress; |
|  |  | import java.util.ArrayList; |
|  |  | import java.util.Enumeration; |
|  |  | import java.util.HashMap; |
| Expand Down  Expand Up | | @@ -71,18 +70,15 @@ private void error(Output output, @Nullable String refName, List<String> message |
|  |  | @Sessional |
|  |  | @Override |
|  |  | protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { |
|  |  | String clientIp = request.getHeader("X-Forwarded-For"); |
|  |  | if (clientIp == null) clientIp = request.getRemoteAddr(); |
|  |  |  |
|  |  | if (!InetAddress.getByName(clientIp).isLoopbackAddress()) { |
|  |  | List<String> fields = StringUtils.splitAndTrim(request.getPathInfo(), "/"); |
|  |  | Preconditions.checkState(fields.size() == 3); |
|  |  |  |
|  |  | if (!fields.get(2).equals(GitUtils.HOOK\_TOKEN)) { |
|  |  | response.sendError(HttpServletResponse.SC\_FORBIDDEN, |
|  |  | "Git hook callbacks can only be accessed from localhost."); |
|  |  | "Git hook callbacks can only be accessed by OneDev itself"); |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | List<String> fields = StringUtils.splitAndTrim(request.getPathInfo(), "/"); |
|  |  | Preconditions.checkState(fields.size() == 2); |
|  |  |  |
|  |  | SecurityUtils.getSubject().runAs(SecurityUtils.asPrincipal(Long.valueOf(fields.get(1)))); |
|  |  | try { |
|  |  | Project project = projectManager.load(Long.valueOf(fields.get(0))); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[server-core/src/main/resources/git-receive-hook](#diff-7d4a32bbb3de9974665eeb418523a0afba601fc858aeb46af1ac6ce0186e1a5f "server-core/src/main/resources/git-receive-hook")

Show comments

[View file](/theonedev/onedev/blob/f1e97688e4e19d6de1dfa1d00e04655209d39f8e/server-core/src/main/resources/git-receive-hook)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,7 +2,7 @@ |
|  |  | unset http\_proxy |
|  |  | unset https\_proxy |
|  |  | IFS=$'\r\n'; |
|  |  | lines=($(${ONEDEV\_CURL} -k -s -S -f -X POST --data-urlencode "ENV\_GIT\_ALTERNATE\_OBJECT\_DIRECTORIES=${GIT\_ALTERNATE\_OBJECT\_DIRECTORIES}" --data-urlencode "ENV\_GIT\_OBJECT\_DIRECTORY=${GIT\_OBJECT\_DIRECTORY}" --data-urlencode "ENV\_GIT\_QUARANTINE\_PATH=${GIT\_QUARANTINE\_PATH}" -d @- ${ONEDEV\_URL}/%s/${ONEDEV\_REPOSITORY\_ID}/${ONEDEV\_USER\_ID} 2>&1)) |
|  |  | lines=($(${ONEDEV\_CURL} -k -s -S -f -X POST --data-urlencode "ENV\_GIT\_ALTERNATE\_OBJECT\_DIRECTORIES=${GIT\_ALTERNATE\_OBJECT\_DIRECTORIES}" --data-urlencode "ENV\_GIT\_OBJECT\_DIRECTORY=${GIT\_OBJECT\_DIRECTORY}" --data-urlencode "ENV\_GIT\_QUARANTINE\_PATH=${GIT\_QUARANTINE\_PATH}" -d @- ${ONEDEV\_URL}/%s/${ONEDEV\_REPOSITORY\_ID}/${ONEDEV\_USER\_ID}/${ONEDEV\_HOOK\_TOKEN} 2>&1)) |
|  |  |  |
|  |  | returnCode=0; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f1e9768`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fcommit%2Ff1e97688e4e19d6de1dfa1d00e04655209d39f8e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_81bfa14e_20250114_234648.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fsecurity%2Fadvisories%2FGHSA-4f9h-h82c-4xm2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Fsecurity%2Fadvisories%2FGHSA-4f9h-h82c-4xm2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=theonedev%2Fonedev)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theonedev](/theonedev)
/
**[onedev](/theonedev/onedev)**
Public

* [Notifications](/login?return_to=%2Ftheonedev%2Fonedev) You must be signed in to change notification settings
* [Fork
  873](/login?return_to=%2Ftheonedev%2Fonedev)
* [Star
   13.6k](/login?return_to=%2Ftheonedev%2Fonedev)

* [Code](/theonedev/onedev)
* [Pull requests
  0](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

Additional navigation options

* [Code](/theonedev/onedev)
* [Pull requests](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

# Access Control Bypass can lead to Remote Code Execution

High

[robinshine](/robinshine)
published
GHSA-4f9h-h82c-4xm2
Sep 13, 2022

## Package

OneDev
(standalone application)

## Affected versions

< 7.3.0

## Patched versions

7.3.0

## Description

### Observation

The /git-prereceive-callback endpoint is used by the pre-receive git hook on the server to check for branch protections during a push event. It is only intended to be accessed from localhost, but the check relies on the X-Forwarded-For header. Invoking this endpoint leads to the execution of one of various git commands. The environment variables of this command execution can be controlled via query parameters. This allows attackers to write to arbitrary files, which can in turn lead to the execution of arbitrary code.

### Impact

Unauthenticated users can take over a OneDev instance if there is no properly configured reverse proxy. This impacts the confidentiality, integrity, and availability of the data on the server. Attackers could steal intellectual property or inject malicious code in very stealthy ways.

Note that the OneDev dogfooding instance is affected by this. Attackers could have used this to backdoor OneDev itself, which would then be installed by users. This could have been done by manipulating binaries or Docker images, as that instance seems to be in charge of building and publishing these artifacts. Such an attack would be very hard to detect, which increases the potential impact even more.

### Patches

7.3.0 or higher. OneDev dogfooding instance is built from scratch with clean code.

### Credits

This issue was reported by SonarSource team

### Severity

High

### CVE ID

CVE-2022-39205

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_36f21493_20250114_234646.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Freleases%2Ftag%2Fv7.3.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheonedev%2Fonedev%2Freleases%2Ftag%2Fv7.3.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=theonedev%2Fonedev)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theonedev](/theonedev)
/
**[onedev](/theonedev/onedev)**
Public

* [Notifications](/login?return_to=%2Ftheonedev%2Fonedev) You must be signed in to change notification settings
* [Fork
  873](/login?return_to=%2Ftheonedev%2Fonedev)
* [Star
   13.6k](/login?return_to=%2Ftheonedev%2Fonedev)

* [Code](/theonedev/onedev/tree/v7.3.0)
* [Pull requests
  0](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

Additional navigation options

* [Code](/theonedev/onedev/tree/v7.3.0)
* [Pull requests](/theonedev/onedev/pulls)
* [Actions](/theonedev/onedev/actions)
* [Wiki](/theonedev/onedev/wiki)
* [Security](/theonedev/onedev/security)
* [Insights](/theonedev/onedev/pulse)

1. [Releases](/theonedev/onedev/releases)
2. [v7.3.0](/theonedev/onedev/releases/tag/v7.3.0)

# 7.3.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/theonedev/onedev/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v7.3.0)

 Loading

[View all tags](/theonedev/onedev/tags)

![@robinshine](https://avatars.githubusercontent.com/u/3423576?s=40&v=4)
[robinshine](/robinshine)
released this
31 May 06:40

·
[1507 commits](/theonedev/onedev/compare/v7.3.0...main)
to main
since this release

[v7.3.0](/theonedev/onedev/tree/v7.3.0)

[`83b09b1`](/theonedev/onedev/commit/83b09b15f7f4c1fdde22d0f7d0e13d2f561c731f)

## Installation Guide

<https://code.onedev.io/projects/162/blob/main/pages/installation-guide.md>

## Change Log

<https://code.onedev.io/projects/160/builds/2727/fixed-issues?query=%22State%22+is+%22Released%22+order+by+%22Type%22+asc+and+%22Priority%22+desc>

## Incompatibilities

<https://code.onedev.io/projects/160/builds/2727/markdown/Incompatibilities/server-product/system/incompatibilities/incompatibilities.md>

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from blog.sonarsource.com_6accafb7_20250114_234639.html ===
NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonar’s industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# Securing Developer Tools: OneDev Remote Code Execution

![](data:image/svg+xml;charset=utf-8...)![Paul Gerste photo]()![Paul Gerste photo](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/e712603b-cf90-4c56-a666-cd2691b3def2/404b3fe2-4818-41dc-bbe0-9cae851eb542_Paul_Gerste.jpg?w=800&h=800&auto=format&fit=crop)

Paul Gerste

Vulnerability Researcher

September 20, 2022

Date

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![We recently discovered several vulnerabilities in OneDev 7.2.9 that allowed attackers to fully compromise a server and even break out of a Docker environment.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/7079e9bd-2571-4fa5-8a98-7fd565d67932/cover-a4f60b69-48d5-4a4d-9282-d245c280324d_Vulnerability_Blog%2BHeader.png?w=2400&h=1256&auto=format&fit=crop)![We recently discovered several vulnerabilities in OneDev 7.2.9 that allowed attackers to fully compromise a server and even break out of a Docker environment.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/7079e9bd-2571-4fa5-8a98-7fd565d67932/cover-a4f60b69-48d5-4a4d-9282-d245c280324d_Vulnerability_Blog%2BHeader.png?w=2400&h=1256&auto=format&fit=crop)

OneDev is a self-hosted Git server that comes with a lot of development-oriented features such as CI/CD, code search, and static analysis integration. With almost 10,000 stars on GitHub, it is gaining popularity and becoming an open-source and low-maintenance alternative to GitHub, GitLab, and Bitbucket.

Source code becomes an increasingly important asset of most companies, making it crucial to protect it from being stolen or, even worse, altered by malicious actors. This is why we decided to look at the very services that are the most interesting targets of these threat actors: source code hosting platforms.

In this article, we describe the vulnerabilities we found in OneDev that could be used by attackers to take over vulnerable instances. We will first look at their impact, then dive into the technical details, and finally, we'll discuss how the maintainers fixed the issues and how you can prevent them in your own code.

## Impact

We discovered the following vulnerabilities in OneDev 7.2.9:

* Web Hook Server-Side Request Forgery
* Access Control Bypass leading to Remote Code Execution (CVE-2022-39205)
* Docker Escape (CVE-2022-39206)
* Persistent Cross-Site Scripting (CVE-2022-39207)
* Git Repository Disclosure (CVE-2022-39208)

Some of them can be combined by attackers to execute arbitrary commands on vulnerable OneDev instances. This would allow them to steal or manipulate source code, build artifacts, and launch further attacks against internal infrastructure. Most of the vulnerabilities require authentication as a regular user, except for CVE-2022-39208 which can be exploited without any authentication at all. The following is an overview of how the vulnerabilities can be exploited:

![](data:image/svg+xml;charset=utf-8...)![Vulnerability overview]()![Vulnerability overview](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/249298b7-458f-4688-ac65-6334e13b245c/body-e7018079-7e77-4a6e-b0ba-6602af1c7425_OneDev-attack-diagram.png?w=922&h=442&auto=format&fit=crop)

We strongly recommend updating to at least version 7.3.0 to benefit from the maintainer's fixes.

Since the OneDev maintainers are using the OneDev instance at [code.onedev.io](https://code.onedev.io "code.onedev.io") to develop the project,  attackers could have hijacked the project's infrastructure to plant malicious code into OneDev itself. This would have allowed them to compromise users of OneDev without having to directly attack them. Such a software supply chain attack is very stealthy and has happened before, for example in the [Codecov](https://www.bleepingcomputer.com/news/security/hundreds-of-networks-reportedly-hacked-in-codecov-supply-chain-attack/ "Codecov") and [SolarWinds](https://www.businessinsider.com/solarwinds-hack-explained-government-agencies-cyber-security-2020-12 "SolarWinds") incidents, and could have also happened in the [open-source](https://blog.sonarsource.com/php-supply-chain-attack-on-composer/ "open-source") [world](https://blog.sonarsource.com/php-supply-chain-attack-on-pear/ "world").

## Technical Details

In this section, we will look at the technical details of three vulnerabilities that can be combined into a chain. First, we will look at a Server-Side Request Forgery issue, then we will see how it can be used to achieve Remote Code Execution, and finally, we will show how attackers could have used a Docker misconfiguration to escape from a container to the host system.

### Server-Side Request Forgery

A common feature among source code hosting platforms is the ability to add webhooks that will be triggered by certain events. An example use case for this is to trigger a deployment on every push to a repository's main branch. This functionality requires the user to set a URL and an event type, telling the server to send an HTTP request to that URL when events of that type occur. The request usually contains the event data in its body. This is what the feature looks like for OneDev:

![](data:image/svg+xml;charset=utf-8...)![Screenshot of OneDev's web hook page]()![Screenshot of OneDev's web hook page](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/987dc9b8-e499-4958-bc6d-aca670bedf6c/body-8b34b072-be3d-462d-84b6-5d5560434728_Screenshot%2B2022-09-19%2Bat%2B15.46.13.png?w=1234&h=621&auto=format&fit=crop)

In the case of OneDev, the target URL of a webhook is not restricted at all (besides having to be a syntactically valid URL). This allows users to force the server to make HTTP requests to internal targets, including the server itself, by setting the webhook URL to an internal IP address and triggering the defined event.

This is known as Server-Side Request Forgery (SSRF), which can be used to talk to internal systems and trigger further vulnerabilities in them. In this case, it is a limited SSRF: the user does not control the HTTP method or any HTTP headers, they only control some parts of the body, and they can't see the HTTP response. This limits the user-controlled inputs that can be passed to an internal server to the URL, i.e. its path and query parameters.

The OneDev maintainers did not request a CVE for this vulnerability because they see it as intended behavior. They expect OneDev setups to be so diverse that blocking certain IP ranges could lead to issues for some users. The next section will cover how it was possible to use this SSRF to reach an internal endpoint, bypass its protection, and execute arbitrary code on the server.

### Access Control Bypass leading to Remote Code Execution (CVE-2022-39205)

To validate push events, OneDev uses Git commands under the hood. This is implemented with a callback endpoint that will be called whenever a push event happens. This endpoint is only supposed to be called from localhost, so the following check was introduced:

```
protected void doPost(HttpServletRequest request, HttpServletResponse response) {
    String clientIp = request.getHeader("X-Forwarded-For");
    if (clientIp == null) clientIp = request.getRemoteAddr();

    if (!InetAddress.getByName(clientIp).isLoopbackAddress()) {
        response.sendError(HttpServletResponse.SC_FORBIDDEN,
                "Git hook callbacks can only be accessed from localhost.");
        return;
    }
    // ...
}
```

The endpoint checks if the client's IP address is the loopback address, e.g. `127.0.0.1`, but it blindly trusts the `X-Forwarded-For` header if present. This is unsafe, as it requires a proper reverse proxy to be deployed in front of the OneDev instance. Otherwise, attackers can spoof their IP address by simply setting that header.

In case there is a properly configured reverse proxy, this check can still be bypassed using the SSRF vulnerability described above. Since the server sends the webhook request to itself, the sender's IP address will always be the loopback address.

After that initial check, the callback endpoint will read some parameters from the request. This includes a project ID, a user ID, and commit hashes. These values are then used to check certain conditions based on the project's settings and the user's permissions. Finally, a Git command will be executed based on the previous checks. OneDev invokes this command in a safe way that prevents [Command Injection](https://rules.sonarsource.com/java/type/Vulnerability/RSPEC-2076 "Command Injection") and [Argument Injection](https://rules.sonarsource.com/java/type/Vulnerability/RSPEC-5883 "Argument Injection") vulnerabilities.

However, the callback also takes environment variables from the request's query parameters. They are then passed to the Git command invocation, which is very unsafe because the behavior of programs can be influenced by specifying certain environment variables.

**Making Git write files**

Modern versions of Git support [setting any config value via environment variables](https://git-scm.com/docs/git-config#Documentation/git-config.txt-GITCONFIGCOUNT "setting any config value via environment variables"), which would be enough to execute arbitrary commands. This can be achieved by setting the `GIT_CONFIG_COUNT`, `GIT_CONFIG_KEY_*`, and `GIT_CONFIG_VALUE_*` variables. However, the Git version that was shipped in the default Docker container of OneDev was older, so this option was not feasible.

Another technique to control program behavior via environment variables is to use `LD_PRELOAD` which allows specifying a shared library that can override certain functions used by a binary. This would require first uploading such a shared library to the filesystem, making it also not feasible in this scenario without an additional vulnerability.

We noticed that OneDev uses Git hooks to validate some Git events and that the hooks were simple shell scripts. These files were also writable by the user that the OneDev server runs as, so it would be possible to overwrite them with malicious commands. We then checked the Git documentation for any environment variable that would enable writing to an arbitrary file. We found `GIT_TRACE_SETUP`, which is used to activate the output of verbose debugging information, either to `STDERR` or to a file that can be specified in the variable's value. Its output looks like this:

```
$ env GIT_TRACE_SETUP=/tmp/trace.txt git status
On branch main
No commits yet
nothing to commit (create/copy files and use "git add" to track)
$ cat /tmp/trace.txt
15:40:18.109099 trace.c:311             setup: git_dir: .git
15:40:18.109933 trace.c:312             setup: git_common_dir: .git
15:40:18.109940 trace.c:313             setup: worktree: /tmp/git-trace
15:40:18.109947 trace.c:314             setup: cwd: /tmp/git-trace
15:40:18.109953 trace.c:315             setup: prefix: (null)
```

This approach looked promising, but it had some drawbacks:

* First, only some parts of the output can be controlled via other environment variables;
* Second, Git would only append to existing files, not overwrite them. This is especially problematic here, because the Git hook scripts all ended with a call to `exit` on their last line, ending the execution of the script regardless of what comes in the next lines;
* The last straw that remained here was that the scripts had no linebreak at the very end, which meant that we could execute commands in a subshell if we could inject them in the first line of the trace output.

**Controlling the output**

This first line contains the value of `git_dir` and it can be controlled via the `GIT_DIR` environment variable. It has to point to a valid Git directory, otherwise, the whole command will fail and no trace output will be written. It is also not possible to insert non-existing segments into the path because Linux will complain in that case. This means the attacker needs to create a folder with a subshell command in its name on the filesystem first, and then they can use a `GIT_DIR` path that includes this directory and then traverses back to a valid Git directory.

Since the attacker in our scenario already has access to a project on the OneDev server, they can do this by creating and pushing a new branch. Branches are stored in a Git repository as `.git/refs/heads/<branchname>`. Branch names can include slashes, so this can result in multiple nested directories, but the last "segment" of a Git branch name will always be a file that holds the branch's most recent commit hash. So to create a branch that suits the needs of the exploit, the attacker has to include at least one slash after the subshell command to make sure the command will be in a directory name, not in a file name.

Putting it all together, the attacker would create and push such a branch and then use `GIT_DIR` and `GIT_TRACE_SETUP` to append to a Git hook. This is what such a hook script will look like afterward:

```
[...]
exit $returnCode15:50:06.391600 trace.c:311             setup: git_dir: .git/refs/heads/$(id>/tmp/pwned)/../../../../../
15:50:06.393284 trace.c:312             setup: git_common_dir: .git/refs/heads/$(id>/tmp/pwned)/../../../../../
15:50:06.393318 trace.c:313             setup: worktree: /private/tmp/git-trace
15:50:06.393336 trace.c:314             setup: cwd: /private/tmp/git-trace
15:50:06.393352 trace.c:315             setup: prefix: (null)
```
### Container Escape (CVE-2022-39206)

OneDev recommends starting the server with access to a Docker socket to enable its Docker-based CI/CD pipelines. If the OneDev server is hosted in a Docker container itself, this is recommended to be done by mounting the host's Docker socket into the OneDev container.

This is dangerous because it allows breaking out of the container and executing commands as root on the host system unless Docker runs in rootless mode. OneDev also mounts the host's Docker socket into certain CI/CD pipeline containers, making it even possible for users with the appropriate permissions to perform a Docker escape by simply defining a malicious CI configuration.

The following summarizes the whole exploit chain:

![](data:image/svg+xml;charset=utf-8...)![Exploit overview]()![Exploit overview](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/955908a1-e6eb-452f-a387-09a5a87552c8/body-f773fe17-0020-4f67-8f2f-cb673437b944_OneDev-exploit-diagram.png?w=1000&h=479&auto=format&fit=crop)
### Patch

The SSRF vulnerability has not been fixed because the OneDev team expects the environment that OneDev can be deployed in to have a big variety with no common denominator. According to them, it is impossible to have a one-fits-all blocklist for webhook URLs, so they did not implement one.

We think it would be a good middle ground to have an admin setting that can control such a blocklist and give it a default value that blocks requests to all local and private IP ranges. If you have code in your own code base that makes requests based on user-controlled values, make sure to properly validate each request. The most important thing here is to validate the protocol, hostname, and port. Modifying them can allow attackers to talk to internal services that are otherwise not exposed. Such services are usually less secured and attackers could make requests to them in order to hijack them. Keep in mind that the validation has to be done at the right moment to be effective, as explained in [our recent blog post about a similar issue in WordPress](https://blog.sonarsource.com/wordpress-core-unauthenticated-blind-ssrf/ "our recent blog post about a similar issue in WordPress").

**Access Control Bypass**

For the Access Control Bypass vulnerability, the maintainers introduced a new system of authentication tokens that have to be sent with each request and are validated before any actions are performed. This is a very solid solution because even SSRF vulnerabilities can't be used to trigger the endpoint as the attacker would have to know a valid token first.

As a rule of thumb, never blindly trust HTTP headers like `X-Forwarded-For`, unless you made really sure that they cannot be set by an attacker. A good recommendation is to make trusting these headers opt-in instead of opt-out, reducing the likelihood of accidentally trusting them.

**Container Escape**

The Container Escape vulnerability was only possible because the host's Docker socket was exposed in environments where users with low privileges could use it. This is an unsafe pattern and should be avoided. Make sure that only trusted users (e.g. admins) can access the socket and that all parameters that are included in requests to it are properly validated. There are also third-party proxies, such as [docker-socket-proxy](https://github.com/Tecnativa/docker-socket-proxy "docker-socket-proxy"), that can restrict the Docker interface to a safer subset of possible requests.

## Timeline

| **Date** | **Action** |
| --- | --- |
| 2022-05-30 | We report all issues to the OneDev maintainers |
| 2022-05-30 | The OneDev maintainers confirm the issues |
| 2022-05-31 | The OneDev maintainers fix the issues (except the SSRF), release a new version (7.3.0) and rebuild the code.onedev.io instance from scratch to ensure that it is not backdoored |
| 2022-09-13 | The CVE IDs are assigned |

## Summary

In this article, we presented several high-impact vulnerabilities we found in OneDev, an open-source Git server. The issues have a critical impact but require a low-privileged user account to be exploited. While this reduces the impact for many instances, it was possible for attackers to take over the infrastructure of the OneDev itself, which could have resulted in a widespread impact for many users of the project.

We discussed the technical details of the vulnerabilities and also explained how the maintainers chose to tackle them, as well as how you can prevent such issues in your code.

Finally, we want to give big kudos to the OneDev maintainers handling the disclosure of these vulnerabilities. They responded exceptionally fast and fixed the issues within a day, also rebuilding the project's infrastructure from scratch to get rid of potential backdoors that could have resulted from malicious actors abusing the issues described in this blog post.

## Related Blog Posts

* [Agent 008: Chaining Vulnerabilities to Compromise GoCD](https://blog.sonarsource.com/gocd-vulnerability-chain/ "Agent 008: Chaining Vulnerabilities to Compromise GoCD")
* [WordPress Core - Unauthenticated Blind SSRF](https://blog.sonarsource.com/wordpress-core-unauthenticated-blind-ssrf/ "WordPress Core - Unauthenticated Blind SSRF")
* [Securing Developer Tools: Argument Injection in Visual Studio Code](https://blog.sonarsource.com/securing-developer-tools-argument-injection-in-vscode/ "Securing Developer Tools: Argument Injection in Visual Studio Code")
* [PHP Supply Chain Attack on Composer](https://blog.sonarsource.com/php-supply-chain-attack-on-composer/ "PHP Supply Chain Attack on Composer")
#### SHARE

[twitter](https://twitter.com/share?text=undefined)[facebook](https://www.facebook.com/sharer/sharer.php?u=undefined)[linkedin](https://www.linkedin.com/sharing/share-offsite/?url=undefined)mail[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.


