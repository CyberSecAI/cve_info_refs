=== Content from github.com_ad022ce1_20250114_205153.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftop-think%2Fframework%2Fissues%2F2772)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftop-think%2Fframework%2Fissues%2F2772)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=top-think%2Fframework)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[top-think](/top-think)
/
**[framework](/top-think/framework)**
Public

* [Notifications](/login?return_to=%2Ftop-think%2Fframework) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Ftop-think%2Fframework)
* [Star
   2.7k](/login?return_to=%2Ftop-think%2Fframework)

* [Code](/top-think/framework)
* [Issues
  88](/top-think/framework/issues)
* [Pull requests
  23](/top-think/framework/pulls)
* [Discussions](/top-think/framework/discussions)
* [Actions](/top-think/framework/actions)
* [Security](/top-think/framework/security)
* [Insights](/top-think/framework/pulse)

Additional navigation options

* [Code](/top-think/framework)
* [Issues](/top-think/framework/issues)
* [Pull requests](/top-think/framework/pulls)
* [Discussions](/top-think/framework/discussions)
* [Actions](/top-think/framework/actions)
* [Security](/top-think/framework/security)
* [Insights](/top-think/framework/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ftop-think%2Fframework%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ftop-think%2Fframework%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Code logic error causes file upload getshell #2772

Open

[uuusrc](/uuusrc) opened this issue
Oct 23, 2022
· 5 comments

Open

# [Code logic error causes file upload getshell](#top) #2772

[uuusrc](/uuusrc) opened this issue
Oct 23, 2022
· 5 comments

## Comments

[![@uuusrc](https://avatars.githubusercontent.com/u/103976565?s=80&v=4)](/uuusrc)

Copy link

### **[uuusrc](/uuusrc)** commented [Oct 23, 2022](#issue-1419671628) • edited Loading

| **Code logic error causes file upload getshell** Verify version:Thinkphp5.1.41/Thinkphp5.0.24 Install:composer create-project topthink/think tp 5.xxx  test version:Thinkphp5.1.41 If the user directly uses the move method of thinkphp like this：Add an upload controller like the official documentation:[https://www.kancloud.cn/manual/thinkphp5\_1/354121](url)  ``` <?php namespace app\index\controller;  class Upload  {     public function index(){         // 获取表单上传文件 例如上传了001.jpg         $file = request()->file('image');         // 移动到框架网站目录/uploads/ 目录下         $info = $file->move( './uploads');         if($info){             // 成功上传后 获取上传信息             // 输出 jpg             echo $info->getExtension();             // 输出 20160820/42a79759f284b767dfcb2a0197904287.jpg             echo $info->getSaveName();             // 输出 42a79759f284b767dfcb2a0197904287.jpg             echo $info->getFilename();          }else{             // 上传失败获取错误信息             echo $file->getError();         }     }  } ```  Will cause the file with the suffix php to be uploaded directly Because in `thinkphp\library\think\File.php` line 272 it is allowed  ``` public function checkImg()     {         $extension = strtolower(pathinfo($this->getInfo('name'), PATHINFO_EXTENSION));          /* 对图像文件进行严格检测 */         if (in_array($extension, ['gif', 'jpg', 'jpeg', 'bmp', 'png', 'swf']) && !in_array($this->getImageType($this->filename), [1, 2, 3, 4, 6, 13])) {             $this->error = 'illegal image files';             return false;         }          return true;     } ```  [11231231](https://user-images.githubusercontent.com/103976565/197378023-9aee1850-e07c-4ba8-ab99-dd201ab7b4d3.png)  [20221023143515](https://user-images.githubusercontent.com/103976565/197377811-ddf041a6-b9d9-41f8-b314-b66a5c50e953.jpg)  I think the problem is that true and false are written in reverse. And !in\_array getImageType  The logic should be?  ``` public function checkImg()     {         $extension = strtolower(pathinfo($this->getInfo('name'), PATHINFO_EXTENSION));          /* 对图像文件进行严格检测 */         if (in_array($extension, ['gif', 'jpg', 'jpeg', 'bmp', 'png', 'swf']) && in_array($this->getImageType($this->filename), [1, 2, 3, 4, 6, 13])) {             return true;         }          return false;     } ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@0yingteam](https://avatars.githubusercontent.com/u/61936554?s=80&u=5fd5f8432944d58091b69c9cde64cf162591db8a&v=4)](/0yingteam)

Copy link

### **[0yingteam](/0yingteam)** commented [Oct 1, 2023](#issuecomment-1742077036)

| 离了个大谱 |
| --- |

All reactions

Sorry, something went wrong.

[![@Leeyangee](https://avatars.githubusercontent.com/u/101627018?s=80&u=c0127daaeb808b1e6e98b71242c99342165afbbc&v=4)](/Leeyangee)

Copy link

### **[Leeyangee](/Leeyangee)** commented [Sep 21, 2024](#issuecomment-2365035132)

| 幽默漏洞，既搞笑又幽默 |
| --- |

All reactions

Sorry, something went wrong.

[![@F4NNIU](https://avatars.githubusercontent.com/u/3390878?s=80&u=09baa054480f45e961d4d7700edf415cc28ec878&v=4)](/F4NNIU)

Copy link

Member

### **[F4NNIU](/F4NNIU)** commented [Oct 7, 2024](#issuecomment-2395828778)

| 如果这里强硬限制后缀，那么 `checkExt` 就无效了。 |
| --- |

All reactions

Sorry, something went wrong.

[![@F4NNIU](https://avatars.githubusercontent.com/u/3390878?s=80&u=09baa054480f45e961d4d7700edf415cc28ec878&v=4)](/F4NNIU)

Copy link

Member

### **[F4NNIU](/F4NNIU)** commented [Oct 8, 2024](#issuecomment-2398354198)

| 请留意 check 方法。 |
| --- |

All reactions

Sorry, something went wrong.

[![@F4NNIU](https://avatars.githubusercontent.com/u/3390878?s=80&u=09baa054480f45e961d4d7700edf415cc28ec878&v=4)](/F4NNIU)

Copy link

Member

### **[F4NNIU](/F4NNIU)** commented [Oct 8, 2024](#issuecomment-2398465872)

| 以下关于更多信息，请查看。  [#398 (comment)](https://github.com/top-think/framework/pull/398#issuecomment-267527833)  本来不是图片文件也不会检测的啊 这个方法是当上传图片文件后检测图片的合法性 |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ftop-think%2Fframework%2Fissues%2F2772)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@F4NNIU](https://avatars.githubusercontent.com/u/3390878?s=52&v=4)](/F4NNIU) [![@0yingteam](https://avatars.githubusercontent.com/u/61936554?s=52&v=4)](/0yingteam) [![@Leeyangee](https://avatars.githubusercontent.com/u/101627018?s=52&v=4)](/Leeyangee) [![@uuusrc](https://avatars.githubusercontent.com/u/103976565?s=52&v=4)](/uuusrc)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


