=== Content from github.com_c0e1b7c1_20250115_083918.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhalo-dev%2Fhalo%2Fissues%2F1702)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhalo-dev%2Fhalo%2Fissues%2F1702)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=halo-dev%2Fhalo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[halo-dev](/halo-dev)
/
**[halo](/halo-dev/halo)**
Public

* [Notifications](/login?return_to=%2Fhalo-dev%2Fhalo) You must be signed in to change notification settings
* [Fork
  9.8k](/login?return_to=%2Fhalo-dev%2Fhalo)
* [Star
   34.5k](/login?return_to=%2Fhalo-dev%2Fhalo)

* [Code](/halo-dev/halo)
* [Issues
  338](/halo-dev/halo/issues)
* [Pull requests
  2](/halo-dev/halo/pulls)
* [Discussions](/halo-dev/halo/discussions)
* [Actions](/halo-dev/halo/actions)
* [Projects
  0](/halo-dev/halo/projects)
* [Security](/halo-dev/halo/security)
* [Insights](/halo-dev/halo/pulse)

Additional navigation options

* [Code](/halo-dev/halo)
* [Issues](/halo-dev/halo/issues)
* [Pull requests](/halo-dev/halo/pulls)
* [Discussions](/halo-dev/halo/discussions)
* [Actions](/halo-dev/halo/actions)
* [Projects](/halo-dev/halo/projects)
* [Security](/halo-dev/halo/security)
* [Insights](/halo-dev/halo/pulse)

# Halo Blog CMS1.4.17 Fileupload without file type authentication #1702

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Halo Blog CMS1.4.17 Fileupload without file type authentication](#top)#1702Copy linkLabels[kind/bugCategorizes issue or PR as related to a bug.](https://github.com/halo-dev/halo/issues?q=state%3Aopen%20label%3A%22kind%2Fbug%22)Categorizes issue or PR as related to a bug.[kind/featureCategorizes issue or PR as related to a new feature.](https://github.com/halo-dev/halo/issues?q=state%3Aopen%20label%3A%22kind%2Ffeature%22)Categorizes issue or PR as related to a new feature.![@ziping21](https://avatars.githubusercontent.com/u/63443757?v=4&size=80)
## Description

![@ziping21](https://avatars.githubusercontent.com/u/63443757?v=4&size=48)[ziping21](https://github.com/ziping21)opened [on Mar 4, 2022](https://github.com/halo-dev/halo/issues/1702#issue-1159491122)
### 是什么版本出现了此问题？

1.4.17

### 使用的什么数据库？

MySQL 5.7

### 使用的哪种方式部署？

Fat Jar

### 在线站点地址

<https://demo.halo.run/admin/index.html#/comments>

### 发生了什么？

The vulnerability can lead to the upload of arbitrary malicious script files.

### 相关日志输出

```
no
```
### 附加信息

Black-box penetration：

1. Use (demo:P@ssw0rd123...) to login in <https://demo.halo.run/admin> ,and then find the

   attachment upload feature ,try to upload a random image.

[![图片](https://user-images.githubusercontent.com/63443757/156746391-9308664e-4a0f-481d-a123-c7441cf32769.png)](https://user-images.githubusercontent.com/63443757/156746391-9308664e-4a0f-481d-a123-c7441cf32769.png)

2. While uploading a random image, use burp suite to catch the request packet and forward it to the Repeater module.

[![图片](https://user-images.githubusercontent.com/63443757/156746407-bb1dd699-9ca8-4553-958c-164af36173d9.png)](https://user-images.githubusercontent.com/63443757/156746407-bb1dd699-9ca8-4553-958c-164af36173d9.png)

3. You can tell we successfully uploaded the image from the screenshot below . And we can also get the path of the image accordding to the response.

[![图片](https://user-images.githubusercontent.com/63443757/156746420-ebe7c2e6-0d00-491c-85e2-a1885c9c198c.png)](https://user-images.githubusercontent.com/63443757/156746420-ebe7c2e6-0d00-491c-85e2-a1885c9c198c.png)

4. Now we want to use the feature again. This time ,try to change the file suffix and modify the file content at the same time. After doing that , send the request again. And the upload is still successful , the file path is also returned.

[![图片](https://user-images.githubusercontent.com/63443757/156746430-b8d6548e-65bd-4c9d-b27e-e6c6838004ca.png)](https://user-images.githubusercontent.com/63443757/156746430-b8d6548e-65bd-4c9d-b27e-e6c6838004ca.png)

5. Now try to access the file path within the url below,and our xss payload successfully executed

[![图片](https://user-images.githubusercontent.com/63443757/156746443-6d9ee71d-a7a5-43e2-9d45-715e13104276.png)](https://user-images.githubusercontent.com/63443757/156746443-6d9ee71d-a7a5-43e2-9d45-715e13104276.png)

6. Screenshots of other file types uploaded are as follows：

[![图片](https://user-images.githubusercontent.com/63443757/156746458-b35a4df8-6bf8-4330-9a4c-eb22aa994da5.png)](https://user-images.githubusercontent.com/63443757/156746458-b35a4df8-6bf8-4330-9a4c-eb22aa994da5.png)

[![图片](https://user-images.githubusercontent.com/63443757/156746467-86e3b944-538c-49f4-8edb-e899057ae513.png)](https://user-images.githubusercontent.com/63443757/156746467-86e3b944-538c-49f4-8edb-e899057ae513.png)

Source code review：

Try to download the source code for source code security analysis

[https://github.com/halo-dev/halo/releases/tag/v1.4.17（Latest](https://github.com/halo-dev/halo/releases/tag/v1.4.17%EF%BC%88Latest) version 1.4.17）

[![图片](https://user-images.githubusercontent.com/63443757/156746509-1706562c-f7bf-4afb-9622-796aec75c324.png)](https://user-images.githubusercontent.com/63443757/156746509-1706562c-f7bf-4afb-9622-796aec75c324.png)

7. Check the source code and locate the class src\main\java\run\halo\app\controller\admin\api\AttachmentController.java

   According to the annotations of this class, you can find that all requests to the path /api/admin/attachments will access this class.

[![图片](https://user-images.githubusercontent.com/63443757/156746523-473c4010-9ff8-4509-bd7f-f80988be40f4.png)](https://user-images.githubusercontent.com/63443757/156746523-473c4010-9ff8-4509-bd7f-f80988be40f4.png)

8. The /upload path accessed by the upload interface will access the uploadAttachment method of this class.

[![图片](https://user-images.githubusercontent.com/63443757/156746532-a57e34cd-1627-4bb5-bd34-5b65e0e90a71.png)](https://user-images.githubusercontent.com/63443757/156746532-a57e34cd-1627-4bb5-bd34-5b65e0e90a71.png)

9. As you can see, this method receives the file from the client side, then passes the file object as an argument to the upload() method of the AttachmentServiceImpl class and executes it, and then executes the result as an argument to the convertToDto() method of the AttachmentServiceImpl class.
10. So let's follow up on the upload() method first after locating the src\main\java\run\halo\app\service\impl\AttachmentServiceImpl.java class and dive into the upload() method

[![图片](https://user-images.githubusercontent.com/63443757/156746551-998eb7d5-af12-4d6d-9768-09b8b1c0f82d.png)](https://user-images.githubusercontent.com/63443757/156746551-998eb7d5-af12-4d6d-9768-09b8b1c0f82d.png)

11. You can see that the code does not have any file suffix checksum, and finally the upload() method will return a create(attachment) object, continue to follow up to the create() method, you can see that an Attachment class object is returned, and there is no file checksum.

[![图片](https://user-images.githubusercontent.com/63443757/156746569-4053afc0-e4fa-436e-9bf3-2b394389e249.png)](https://user-images.githubusercontent.com/63443757/156746569-4053afc0-e4fa-436e-9bf3-2b394389e249.png)

12. The returned object is entered as an argument to the convertToDto() method of the src\main\java\run\halo\app\service\impl\AttachmentServiceImpl.java class, in which you can see that the code writes the path of the uploaded file to the AttachmentDTO instance object, and it can be found that there is no logic of permission checking, and finally the method returns an AttachmentDTO instance object.

[![图片](https://user-images.githubusercontent.com/63443757/156746581-00a7ff3b-9d56-4a2a-ad3a-c1edec819a9d.png)](https://user-images.githubusercontent.com/63443757/156746581-00a7ff3b-9d56-4a2a-ad3a-c1edec819a9d.png)

13. When the file path is set, this information will be brought into the response packet and eventually fed back to the client, so we can successfully access the uploaded file in the response packet based on this path information。
14. According to the analysis of the above code, we can see that there is no logic in the code to check the file suffix, file content and file format, so it can lead to arbitrary file upload。
## Metadata

### Assignees

No one assigned

### Labels

[kind/bugCategorizes issue or PR as related to a bug.](https://github.com/halo-dev/halo/issues?q=state%3Aopen%20label%3A%22kind%2Fbug%22)Categorizes issue or PR as related to a bug.[kind/featureCategorizes issue or PR as related to a new feature.](https://github.com/halo-dev/halo/issues?q=state%3Aopen%20label%3A%22kind%2Ffeature%22)Categorizes issue or PR as related to a new feature.
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


