=== Content from github.com_6d4c132a_20250114_203203.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fcommit%2F387e320dc22c89f4f47c68cb37eb9eec2137f34b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fcommit%2F387e320dc22c89f4f47c68cb37eb9eec2137f34b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=keylime%2Fkeylime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[keylime](/keylime)
/
**[keylime](/keylime/keylime)**
Public

* [Notifications](/login?return_to=%2Fkeylime%2Fkeylime) You must be signed in to change notification settings
* [Fork
  153](/login?return_to=%2Fkeylime%2Fkeylime)
* [Star
   438](/login?return_to=%2Fkeylime%2Fkeylime)

* [Code](/keylime/keylime)
* [Issues
  27](/keylime/keylime/issues)
* [Pull requests
  7](/keylime/keylime/pulls)
* [Discussions](/keylime/keylime/discussions)
* [Actions](/keylime/keylime/actions)
* [Projects
  0](/keylime/keylime/projects)
* [Wiki](/keylime/keylime/wiki)
* [Security](/keylime/keylime/security)
* [Insights](/keylime/keylime/pulse)

Additional navigation options

* [Code](/keylime/keylime)
* [Issues](/keylime/keylime/issues)
* [Pull requests](/keylime/keylime/pulls)
* [Discussions](/keylime/keylime/discussions)
* [Actions](/keylime/keylime/actions)
* [Projects](/keylime/keylime/projects)
* [Wiki](/keylime/keylime/wiki)
* [Security](/keylime/keylime/security)
* [Insights](/keylime/keylime/pulse)

## Commit

[Permalink](/keylime/keylime/commit/387e320dc22c89f4f47c68cb37eb9eec2137f34b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Validate user ID in all public interfaces

[Browse files](/keylime/keylime/tree/387e320dc22c89f4f47c68cb37eb9eec2137f34b)
Browse the repository at this point in the history

```
The user ID is read from the config file, or from some public REST API.
We should validate that is composed with valid set of chars.

Signed-off-by: Alberto Planas <aplanas@suse.com>
```

* Loading branch information

[![@aplanas](https://avatars.githubusercontent.com/u/645701?s=40&v=4)](/aplanas) [![@mpeters](https://avatars.githubusercontent.com/u/23815?s=40&v=4)](/mpeters)

[aplanas](/keylime/keylime/commits?author=aplanas "View all commits by aplanas")
authored and
[mpeters](/keylime/keylime/commits?author=mpeters "View all commits by mpeters")
committed
Jan 27, 2022

1 parent
[e429e95](/keylime/keylime/commit/e429e95329fc60608713ddfb82f4a92ee3b3d2d9)

commit 387e320

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**93 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* keylime

  + keylime/cloud\_verifier\_tornado.py
    [cloud\_verifier\_tornado.py](#diff-67033196f7dec303b3ea55793c6c13fb4b03a72a5515239475a871c3d638dfe4)
  + keylime/keylime\_agent.py
    [keylime\_agent.py](#diff-d32fead59105bb306a5dd9f541932a905dfebb1819c599c47e4e731d52357e72)
  + keylime/registrar\_common.py
    [registrar\_common.py](#diff-11b134600cd014d95acbb405652c7fb4b52f87f185327721397566e7d7761c56)
  + keylime/tenant.py
    [tenant.py](#diff-a0b80ea72e85d540fe4157ac95ee194b92d6e21d4f561fef147d2e0a70e3b963)
  + keylime/tenant\_webapp.py
    [tenant\_webapp.py](#diff-75e8a83b9830e9579e137616d2d71e65786f2ccbe59a861572720c405c36c5c3)

## There are no files selected for viewing

31 changes: 30 additions & 1 deletion

31
[keylime/cloud\_verifier\_tornado.py](#diff-67033196f7dec303b3ea55793c6c13fb4b03a72a5515239475a871c3d638dfe4 "keylime/cloud_verifier_tornado.py")

Show comments

[View file](/keylime/keylime/blob/387e320dc22c89f4f47c68cb37eb9eec2137f34b/keylime/cloud_verifier_tornado.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -18,7 +18,7 @@ |
|  |  | from keylime import json |
|  |  | from keylime import registrar\_client |
|  |  | from keylime.agentstates import AgentAttestStates |
|  |  | from keylime.common import states |
|  |  | from keylime.common import states, validators |
|  |  | from keylime.db.verifier\_db import VerfierMain |
|  |  | from keylime.db.verifier\_db import VerifierAllowlist |
|  |  | from keylime.db.keylime\_db import DBEngineManager, SessionManager |
| Expand Down  Expand Up | | @@ -264,6 +264,13 @@ def get(self): |
|  |  | agent\_id = rest\_params["agents"] |
|  |  |  |
|  |  | if (agent\_id is not None) and (agent\_id != ''): |
|  |  | # If the agent ID is not valid (wrong set of characters), |
|  |  | # just do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("GET received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | try: |
|  |  | agent = session.query(VerfierMain).filter\_by( |
|  |  | agent\_id=agent\_id).one\_or\_none() |
| Expand Down  Expand Up | | @@ -330,6 +337,13 @@ def delete(self): |
|  |  | logger.warning('DELETE returning 400 response. uri not supported: %s', self.request.path) |
|  |  | return |
|  |  |  |
|  |  | # If the agent ID is not valid (wrong set of characters), just |
|  |  | # do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("DELETE received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | try: |
|  |  | agent = session.query(VerfierMain).filter\_by( |
|  |  | agent\_id=agent\_id).first() |
| Expand Down  Expand Up | | @@ -396,6 +410,13 @@ def post(self): |
|  |  | agent\_id = rest\_params["agents"] |
|  |  |  |
|  |  | if agent\_id is not None: |
|  |  | # If the agent ID is not valid (wrong set of |
|  |  | # characters), just do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("POST received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | content\_length = len(self.request.body) |
|  |  | if content\_length == 0: |
|  |  | web\_util.echo\_json\_response( |
| Expand Down  Expand Up | | @@ -534,6 +555,14 @@ def put(self): |
|  |  | if agent\_id is None: |
|  |  | web\_util.echo\_json\_response(self, 400, "uri not supported") |
|  |  | logger.warning("PUT returning 400 response. uri not supported") |
|  |  |  |
|  |  | # If the agent ID is not valid (wrong set of characters), |
|  |  | # just do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("PUT received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | try: |
|  |  | verifier\_id = config.get('cloud\_verifier', 'cloudverifier\_id', fallback=cloud\_verifier\_common.DEFAULT\_VERIFIER\_ID) |
|  |  | agent = session.query(VerfierMain).filter\_by( |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[keylime/keylime\_agent.py](#diff-d32fead59105bb306a5dd9f541932a905dfebb1819c599c47e4e731d52357e72 "keylime/keylime_agent.py")

Show comments

[View file](/keylime/keylime/blob/387e320dc22c89f4f47c68cb37eb9eec2137f34b/keylime/keylime_agent.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -676,6 +676,11 @@ def main(): |
|  |  | agent\_uuid = os.getenv("KEYLIME\_AGENT\_UUID", None) |
|  |  | if agent\_uuid is None: |
|  |  | raise RuntimeError("Env variable KEYLIME\_AGENT\_UUID is empty, but agent\_uuid is set to 'environment'") |
|  |  | elif not validators.valid\_uuid(agent\_uuid): |
|  |  | raise RuntimeError("The UUID is not valid") |
|  |  |  |
|  |  | if not validators.valid\_agent\_id(agent\_uuid): |
|  |  | raise RuntimeError("The agent ID set via agent uuid parameter use invalid characters") |
|  |  |  |
|  |  | if config.STUB\_VTPM and config.TPM\_CANNED\_VALUES is not None: |
|  |  | # Use canned values for stubbing |
| Expand Down | |  |

29 changes: 29 additions & 0 deletions

29
[keylime/registrar\_common.py](#diff-11b134600cd014d95acbb405652c7fb4b52f87f185327721397566e7d7761c56 "keylime/registrar_common.py")

Show comments

[View file](/keylime/keylime/blob/387e320dc22c89f4f47c68cb37eb9eec2137f34b/keylime/registrar_common.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,6 +17,7 @@ |
|  |  | from cryptography.hazmat.backends import default\_backend |
|  |  | from cryptography.x509 import load\_der\_x509\_certificate |
|  |  |  |
|  |  | from keylime.common import validators |
|  |  | from keylime.db.registrar\_db import RegistrarMain |
|  |  | from keylime.db.keylime\_db import DBEngineManager, SessionManager |
|  |  | from keylime import config |
| Expand Down  Expand Up | | @@ -74,6 +75,13 @@ def do\_GET(self): |
|  |  | agent\_id = rest\_params["agents"] |
|  |  |  |
|  |  | if agent\_id is not None: |
|  |  | # If the agent ID is not valid (wrong set of characters), |
|  |  | # just do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("GET received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | try: |
|  |  | agent = session.query(RegistrarMain).filter\_by( |
|  |  | agent\_id=agent\_id).first() |
| Expand Down  Expand Up | | @@ -150,6 +158,13 @@ def do\_DELETE(self): |
|  |  | agent\_id = rest\_params["agents"] |
|  |  |  |
|  |  | if agent\_id is not None: |
|  |  | # If the agent ID is not valid (wrong set of characters), |
|  |  | # just do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("DELETE received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | if session.query(RegistrarMain).filter\_by(agent\_id=agent\_id).delete(): |
|  |  | # send response |
|  |  | try: |
| Expand Down  Expand Up | | @@ -233,6 +248,13 @@ def do\_POST(self): |
|  |  | logger.warning('POST agent returning 400 response. agent id not found in uri %s', self.path) |
|  |  | return |
|  |  |  |
|  |  | # If the agent ID is not valid (wrong set of characters), just |
|  |  | # do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent id not valid") |
|  |  | logger.error("POST received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | try: |
|  |  | content\_length = int(self.headers.get('Content-Length', 0)) |
|  |  | if content\_length == 0: |
| Expand Down  Expand Up | | @@ -410,6 +432,13 @@ def do\_PUT(self): |
|  |  | logger.warning('PUT agent returning 400 response. agent id not found in uri %s', self.path) |
|  |  | return |
|  |  |  |
|  |  | # If the agent ID is not valid (wrong set of characters), just |
|  |  | # do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("PUT received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | try: |
|  |  | content\_length = int(self.headers.get('Content-Length', 0)) |
|  |  | if content\_length == 0: |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[keylime/tenant.py](#diff-a0b80ea72e85d540fe4157ac95ee194b92d6e21d4f561fef147d2e0a70e3b963 "keylime/tenant.py")

Show comments

[View file](/keylime/keylime/blob/387e320dc22c89f4f47c68cb37eb9eec2137f34b/keylime/tenant.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,7 +34,7 @@ |
|  |  | from keylime import crypto |
|  |  | from keylime.cmd import user\_data\_encrypt |
|  |  | from keylime import ca\_util |
|  |  | from keylime.common import algorithms |
|  |  | from keylime.common import algorithms, validators |
|  |  | from keylime import ima\_file\_signatures |
|  |  | from keylime import measured\_boot |
|  |  | from keylime import gpg |
| Expand Down  Expand Up | | @@ -1313,6 +1313,8 @@ def main(argv=sys.argv): |
|  |  | if mytenant.agent\_uuid.startswith('-----BEGIN PUBLIC KEY-----'): |
|  |  | mytenant.agent\_uuid = hashlib.sha256( |
|  |  | mytenant.agent\_uuid).hexdigest() |
|  |  | if not validators.valid\_agent\_id(mytenant.agent\_uuid): |
|  |  | raise UserError("The agent ID set via agent uuid parameter use invalid characters") |
|  |  | else: |
|  |  | logger.warning("Using default UUID d432fbb3-d2f1-4a97-9ef7-75bd81c00000") |
|  |  | mytenant.agent\_uuid = "d432fbb3-d2f1-4a97-9ef7-75bd81c00000" |
| Expand Down | |  |

27 changes: 26 additions & 1 deletion

27
[keylime/tenant\_webapp.py](#diff-75e8a83b9830e9579e137616d2d71e65786f2ccbe59a861572720c405c36c5c3 "keylime/tenant_webapp.py")

Show comments

[View file](/keylime/keylime/blob/387e320dc22c89f4f47c68cb37eb9eec2137f34b/keylime/tenant_webapp.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,7 +16,7 @@ |
|  |  | import tornado.web |
|  |  |  |
|  |  | from keylime.requests\_client import RequestsClient |
|  |  | from keylime.common import states |
|  |  | from keylime.common import validators, states |
|  |  | from keylime import config |
|  |  | from keylime import json |
|  |  | from keylime import keylime\_logging |
| Expand Down  Expand Up | | @@ -395,6 +395,13 @@ async def get(self): |
|  |  |  |
|  |  | agent\_id = rest\_params["agents"] |
|  |  | if agent\_id is not None: |
|  |  | # If the agent ID is not valid (wrong set of characters), |
|  |  | # just do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("GET received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | # Handle request for specific agent data separately |
|  |  | agents = await self.get\_agent\_state(agent\_id) |
|  |  | agents["id"] = agent\_id |
| Expand Down  Expand Up | | @@ -455,6 +462,12 @@ def delete(self): |
|  |  | return |
|  |  |  |
|  |  | agent\_id = rest\_params["agents"] |
|  |  | # If the agent ID is not valid (wrong set of characters), just |
|  |  | # do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("DELETE received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | # let Tenant do dirty work of deleting agent |
|  |  | mytenant = tenant.Tenant() |
| Expand Down  Expand Up | | @@ -482,6 +495,12 @@ def post(self): |
|  |  | return |
|  |  |  |
|  |  | agent\_id = rest\_params["agents"] |
|  |  | # If the agent ID is not valid (wrong set of characters), just |
|  |  | # do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("POST received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | # Parse payload files (base64 data-uri) |
|  |  | if self.get\_argument("ptype", Agent\_Init\_Types.FILE, True) == Agent\_Init\_Types.FILE: |
| Expand Down  Expand Up | | @@ -593,6 +612,12 @@ def put(self): |
|  |  | return |
|  |  |  |
|  |  | agent\_id = rest\_params["agents"] |
|  |  | # If the agent ID is not valid (wrong set of characters), just |
|  |  | # do nothing. |
|  |  | if not validators.valid\_agent\_id(agent\_id): |
|  |  | web\_util.echo\_json\_response(self, 400, "agent\_id not not valid") |
|  |  | logger.error("PUT received an invalid agent ID: %s", agent\_id) |
|  |  | return |
|  |  |  |
|  |  | # let Tenant do dirty work of reactivating agent |
|  |  | mytenant = tenant.Tenant() |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `387e320`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fcommit%2F387e320dc22c89f4f47c68cb37eb9eec2137f34b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from seclists.org_ca4b7ec3_20250114_203208.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![oss-sec logo](/images/oss-sec-logo.png)](/oss-sec/)
## [oss-sec](/oss-sec/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](100)
[By Date](date.html#101)
[![Next](/images/right-icon-16x16.png)](102)

[![Previous](/images/left-icon-16x16.png)](99)
[By Thread](index.html#101)
[![Next](/images/right-icon-16x16.png)](102)

![](/shared/images/nst-icons.svg#search)

# keylime: Multiple Security Issues (including remote code execution in the Agent component)

---

*From*: Matthias Gerstner <mgerstner () suse de>

*Date*: Fri, 28 Jan 2022 13:57:23 +0100

---

```
Hello list,

I have been reviewing the Keylime TPM remote attestation solution [1]
which resulted in a number of security related findings, including an
arbitrary remote code execution in the Keylime Agent component. The
upstream project published security advisories, fixes and an update
strategy to Keylime version 6.3.X today. Please find the details in the
following full report:

1) Scope of Review
==================

I've been looking into the four main components of Keylime: the Agent,
Registrar, Verifier and Tenant applications. I have been looking into
version 6.2.0. Any source code locations mentioned in this report relate
to this version.

2) Findings in the Agent Component
==================================

a) `check_mounted()` Function Logic can be Fooled by Unprivileged Mounts (CVE-2022-23948)
-----------------------------------------------------------------------------------------

The `check_mounted()` function in `secure_mount.py` attempts to make
sure that a "secure" tmpfs is mounted at `/var/lib/keylime/secure` to
store sensitive data on that never gets written to disk. To do so the
function parses the output of the `mount` utility to determine whether
this file system is already mounted at the desired location.

There can exist the possibility of unprivileged users performing certain
mount operations, one of the most prominent examples being the
`fusermount` setuid-root binary for mounting FUSE file systems. In view
of this, parsing mount table output needs prudence. I described the
basic issue previously already in another report [2].

The following is a reproducer using `fusermount` that shows the basic local
attack vector:

    user$ export _FUSE_COMMFD=0
    user$ fusermount some/path/ -ononempty,fsname="tmpfs on /var/lib/keylime/secure"

This will fool the parsing logic in `check_mounted()` and thus the
function assumes that the "secure" tmpfs is already mounted, while it
actually isn't.  Thus this will allow a local attacker on the system to
prevent this security feature to be effective, *if* the local attacker
manages to create such a mount entry before the `keylime_agent` is
starting up.

The attack vector can also be used to perform a local DoS against
`keylime_agent` by claiming a different `fsname` than tmpfs.
`check_mounted()` will throw an Exception in this case and the Agent
won't start.

On a side note there are calls to `secure_mount.mount()` spread
throughout the Keylime codebase (for example three times in
`keylime_agent.py`, two times in `tpm_main.py` and two times in
`ca_impl_cfssl.py`. There is no code to *clean up* this mount again,
however. So it potentially leaves behind a stale mount after services
are shutdown. Furthermore, if multiple Keylime processes should operate
in parallel this could result in a race condition where the "secure"
tmpfs is mounted twice, in the worst case mounting a fresh tmpfs over
previously stored content there.

My recommendation is to parse the `/proc/self/mountinfo` pseudo file for
mount table information instead. Whitespace is specially encoded in this
file. Furthermore the responsibility of mounting and unmounting this
file system should be more clearly defined during startup/shutdown of
processes and maybe a reference counting / locking scheme to prevent
race conditions should be used.

### Upstream Security Advisory

<https://github.com/keylime/keylime/security/advisories/GHSA-wj36-qcfg-5j52>

### Upstream Fixes

<https://github.com/keylime/keylime/commit/1a4f31a6368d651222683c9debe7d6832db6f607>
<https://github.com/keylime/keylime/commit/d37c406e69cb6689baa2fb7964bad75209703724>

b) Possible Information Leaks via Unauthenticated Agent Quote Interface
-----------------------------------------------------------------------

A TPM quote can be requested without authentication from the Agent service via
the network:

    $ curl "keyagent-host:9002/?api_version=500&quotes=myquote&nonce=mynonce"
    {
        "code": 200,
        "status": "Success",
        "results": {
            "quote": <base64-data>, "hash_alg": "sha256", "enc_alg": "rsa", "sign_alg": "rsassa",
            "pubkey": <PEM key>", "boottime": 1639999864
        }
    }

This exposes for example the *boottime* of the host where the Agent is
running, information that is not otherwise easily publicly available.
Furthermore: Could the contents of the TPM quote data also be
interesting data? Could it for example allow deductions about which kind
of operating system kernel is running on the host?

I recommend to somehow authenticate and cryptographically secure this
Agent interface to prevent information leaks of this kind.

### Upstream Fixes

This issue did not receive a dedicated CVE and fix. It is covered
together with the following issue 2.c).

c) Arbitrary Remote Code Execution in the Agent via Unauthenticated Bootstrap Interface (CVE-2021-43310)
--------------------------------------------------------------------------------------------------------

Note that this issue has been discovered in parallel also by Thore
Sommer, a Keylime upstream developer.

It looks like it is possible to simply post arbitrary new values for the
U and V key parts and provide a new configuration payload to the Agent,
only knowing the Agent's UUID. The Agent's UUID can be public or
semi-public information like when `agent_uuid=hostname` is configured.
From the Keylime paper [3] (section 3.2.2) it sounds like the UUID HMAC
check is not considered a security feature but only a sanity check:

```
> ```
> This provides the node with a quick check to determine if Kb is correct.
>
> ```

```

When `extract_payload_script=true` (default) and
`payload_script=autorun.sh` (default) are configured in `keylime.conf`
then the provided payload will be unzipped and a potentially contained
`autorun.sh` script is executed with full root privileges. Attached you
can find a reproducer script `post_key.py` that demonstrates the issue
by creating a file `/tmp/evil` on the Agent host by only providing the
Agent hostname and UUID as input parameters.

Even if `payload_script` is disabled then the extraction of a ZIP file
as _root_ might result in a remote root exploit by extracting files
outside of the intended target directory. I did not test this variant of
the attack vector, though. Furthermore by providing a ZIP bomb as
payload the Agent process can be subjected to a remote DoS through
memory exhaustion.

Retrieving the full symmetric key previously stored in
`/var/lib/keylime/secure/derived_tci_key` should not be possible this
way, because when performing the bootstrap protocol, the previous data
is removed in `keylime_agent.py:242`. A skillful attacker might attempt
to first compromise the Agent node and then wait for the Tenant to
re-deploy the Agent using authentic keys and payload. Should this
succeed then the attacker can obtain the secret symmetric key from the
compromised Agent node after all.

Similar to issue b) I recommend to somehow authenticate and
cryptographically secure this Agent interface to prevent these attacks.
As a hotfix disabling the relevant configuration features should at
least prevent the remote code execution and memory exhaustion attack
vectors. Setting non-predictable UUID values can also help (but one
should also consider item 3.a in this context).  Even then this
interface still allows to disrupt the operational state of the Agent
host by simply overwriting its current configuration.

### Upstream Security Advisory

<https://github.com/keylime/keylime/security/advisories/GHSA-2m39-75g9-ff5r>

### Upstream Fixes

The fix consists of a larger number of upstream commits regarding
introduction of "mTLS" for the Agent interface. This means the
connection towards the Agent will in the future be cryptographically
secured and thus only trusted actors can use the Agent interface.

The upgrade path is a bit complicated because of this (see upstream
advisory).  Upstream version 6.3.X will introduce the new mTLS support
but not enforce it, to allow upgrading of all Keylime components on all
nodes. Only upstream version 6.4.x will enforce the new protocol.

d) Key Exchange and Bootstrap Protocol Susceptible to Replay Attacks
--------------------------------------------------------------------

Authentic payloads being passed from the Tenant to the Agent should be
reasonably safe from attackers (when not considering issue c)), since
the two halves of the symmetric key are encrypted using the per-agent
node RSA public key. The bootstrap protocol seems to be susceptible to
certain replay attacks, however. Since the interface does not employ
transport security, the bootstrap protocol can simply be recorded and
replayed to activate an authentic configuration payload. This could e.g.
be used by an attacker to activate an outdated or even insecure older
configuration of the Agent node.

### Upstream Fixes

This issue did not receive a dedicated CVE and fix. It is covered
together with the previous issue 2.c).

3) Findings in the Registrar Component
======================================

a) UUID of Agents is Received on Unprotected HTTP Interface
-----------------------------------------------------------

The Registrar provides two separate HTTP interfaces, a TLS protected one
and an unprotected one. Part of the unprotected interface is the Agent
registration.  As part of the Agent registration the Agent UUID is
passed unencrypted (processed in `registrar_common.py:229`).

This is not a security issue in its own but relates to issue 2.c where
the knowledge of the UUID facilitates remote code execution on the Agent
nodes.  This means if an attacker can listen in on the Registrar's Agent
registration communication then even unpredictable Agent UUIDs no longer
hinder the attack described in issue 2.c).

As outlined in 2.c) the UUID does not seem to have been thought of as a
security property in the first place so I see no urge to change anything
here. Although when the bootstrap protocol should get TLS protection
then for completeness it could also make sense to protect this Registrar
interface as well the same way.

### Upstream Fixes

This specific aspect is covered by the following commit:

<https://github.com/keylime/keylime/commit/e5f033c66403a899685b81a3af03cd59f76e455f>

There is no dedicated CVE but it is covered together with the
overarching introduction of mTLS as outlined in issue 2.c).

b) Unsanitized UUID passed on Unprotected HTTP Interface Facilitates Log Spoofing (CVE-2022-23949)
--------------------------------------------------------------------------------------------------

Since the Registrar's unprotected HTTP interface requires no
authentication, anybody can post arbitrary Agent registrations with
arbitrary parameters. The Agent ID (UUID) parameter is not sanitized in
any way and is used unfiltered in log messages (e.g.
`registrar_common.py:107`).

As a result the Agent ID parameter can be used to inject seemingly valid
additional log lines that appear e.g. in `journalctl -u
keylime_registrar.service`. The attached reproducer script
`post_agent.py` can be used to demonstrate this:

    $ ./post_agent.py --host registrar-host --log-line "Please run rm -rf /* to protect your system"

In the journal we will then see:

    Dec 21 11:44:22 registrar-host keylime_registrar[1426]: 2021-12-21 11:44:22.281 - keylime.registrar - WARNING -
POST for trusted-agent
    Dec 21 11:44:22 registrar-host keylime_registrar[1426]: 2021-12-21 11:44:22.931 - keylime.registrar - WARNING -
Please run rm -rf /* to protect your system
    Dec 21 11:44:22 registrar-host keylime_registrar[1426]: 2021-12-21 11:44:22.940 - keylime.registrar - DEBUG -
returning 400 response. [...]

Such log spoofing could be used to entice Administrators to perform
actions that can be harmful or otherwise in the interest of an attacker.

My recommendation is on the one hand to diligently sanitize untrusted
input parameters. On the other hand it might make sense to authenticate
this currently untrusted interface.

### Upstream Advisory

<https://github.com/keylime/keylime/security/advisories/GHSA-87gh-qc28-j9mm>

### Upstream Fixes

The UUID sanitazion is introduced via these commits:

<https://github.com/keylime/keylime/commit/387e320dc22c89f4f47c68cb37eb9eec2137f34b>
<https://github.com/keylime/keylime/commit/e429e95329fc60608713ddfb82f4a92ee3b3d2d9>
<https://github.com/keylime/keylime/commit/65c2b737129b5837f4a03660aeb1191ced275a57>

Otherwise the introduction of mTLS as outlined in issues 3.a) and 2.c)
further protect this.

4) Findings in the Verifier Component
=====================================

a) Revocation Notifier Uses Fixed /tmp Path for UNIX Domain Socket (CVE-2022-23950)
-----------------------------------------------------------------------------------

In *revocation_notifier.py* a fixed path in the world writable location
*/tmp/keylime.verifier.ipc* is used. The code (in this case the third
party `zeromq` Python module) forcefully removes any file object found
there earlier.  Should the program be running as non-root, or if another
local user simply places a *directory* at this location, then this
serves as a local DoS attack against the revocation notifier process,
because the socket cannot be created.

This situation doesn't even seem to be noticed by the Verifier main
process, because the child process `broker_proc` is never waited on.
This means that the local attacker could even replace the "blocking"
directory by his own UNIX domain socket later on and will then receive
revocation events from invocations of the `notify()` function in the
main Verifier process.  The full impact of this would have to be
researched further. It looks like failed quote notifications would
longer be sent out.

I recommend to place UNIX domains sockets in a dedicated safe directory
in /run that cannot be staged with attacks by other local users in the
system.

### Upstream Advisory

<https://github.com/keylime/keylime/security/advisories/GHSA-9r9r-f8xc-m875>

### Upstream Fixes

This fix places the socket into a private /run/keylime directory:

<https://github.com/keylime/keylime/commit/ea5d0373fa2c050d5d95404eb779be7e8327b911>

b) Get Quote Response Contains Possibly Untrusted ZIP Data (CVE-2022-23951)
---------------------------------------------------------------------------

The Verifier process periodically performs quote operations on
registered Agents. As part of this `process_quote_response()` is called
and furthermore `check_quote()` and finally `_tpm2_checkquote()`. In
`tpm_main.py:1018` a couple of ZIP data streams are uncompressed via
`zlib.decompress()`.

Since this is processing possibly untrusted data - the Verifier is
attempting to verify the current trust status of the node after all - it
needs to be assumed that malicous data can also be supplied here.

Therefore the question arises whether `zlib.decompress()` is robust
against processing invalid ZIP data streams. One thing I already found
out is that it is not robust against delivering ZIP bombs that will
cause a memory exhaustion in the Verifier process.

This finding also is valid similarly for all other Keylime interface
that process ZIP data, like in the Agent.

### Upstream Advisory

<https://github.com/keylime/keylime/security/advisories/GHSA-6xx7-m45w-76m2>

### Upstream Fixes

This fix simply removes the ZIP compression from the Verifier interface:

<https://github.com/keylime/keylime/commit/6e44758b64b0ee13564fc46e807f4ba98091c355>

5) General Findings
===================

This section contains findings that apply to all keylime components
alike.

a) World-Readable keylime.conf Contains Potentially Sensitive Data (CVE-2022-23952)
-----------------------------------------------------------------------------------

The configuration `/etc/keylime.conf` is installed world-readable:

    $ ls -l /etc/keylime.conf
    -rw-r--r-- 1 root root 26770 Dec 16 14:54 /etc/keylime.conf

This is the case for installations performed manually via the provided
`installer.sh` script as well as for the RPM packaging found in both
openSUSE Tumbleweed and Fedora 35 Linux distributions. Further
distributions might be affected.

`keylime.conf` contains a lot of information, some of it sensitive like
the TPM ownership password (`tpm_ownerpassword`), TLS certificate
private key passwords (`private_key_pw`, `registrar_private_key_pw`) or
the database password for the Registrar (`database_password`). Thus this
is a local information leak, because arbitrary local users can obtain
these passwords from the configuration file.

My recommendation is to make this file only accessible to _root_ and
adjust all installation routines and possibly documentation. The Keylime
code could perform a sanity check of the permissions of the
configuration file before reading it in.

### Upstream Advisory

<https://github.com/keylime/keylime/security/advisories/GHSA-fchm-5w2v-qfm8>

### Upstream Fixes

The following fix explicitly sets the permissions for the configuration
file in the installer:

<https://github.com/keylime/keylime/commit/883085d6a4bcea3012729014d5b8e15ecd65fc7c>

b) Lack of Privilege Separation
-------------------------------

All keylime services are currently designed to run as root all the time
(except for testing purposes, see `REQUIRE_ROOT` in `config.py`). Only
few bits of the keylime components actually should need root privileges.
Most notably the bootstrapping scripts in the Agent component or the
ability to bind privileged ports.

Implementing a privilege separation approach would increase the defense
in depth for keylime considerably, avoiding smaller security issues to
become severe fast.

### Upstream Statement

Keylime upstream states that it is already possible to run Keylime as
non-root. The `REQUIRE_ROOT` bits are not strictly necessary any more
and can be removed from the code. The Debian packaging already makes use
of the privilege separation.

6) Timeline
===========

2021-12-09: I started the review on the code
2021-12-23: I contacted the upstream security contact and upstream
            developer Thore Sommer privately by email and provided them
            the report results, offering coordinates disclosure.
2022-01-04: Upstream confirmed most of my findings and work on the fixes
            began. Alberto Planas, a SUSE colleague and maintainer of
            the SUSE Keylime packaging also contributed some fixes.
2022-01-28: Publication of the security advisories and fixes by upstream
            took place. Upstream also discovered some further security
            issues themselves in the meanwhile.

[1]: <https://github.com/keylime/keylime>
[2]: <https://www.openwall.com/lists/oss-security/2020/06/04/5>
[3]: <https://www.ll.mit.edu/sites/default/files/publication/doc/2018-04/2016_12_07_SchearN_ACSAC_FP.pdf>

Cheers

Matthias

--
Matthias Gerstner <matthias.gerstner () suse de>
Security Engineer
<https://www.suse.com/security>
GPG Key ID: 0x14C405C971923553

SUSE Software Solutions Germany GmbH
HRB 36809, AG Nürnberg
Geschäftsführer: Ivo Totev

```

**Attachment:
[post\_agent.py](att-101/post_agent_py.bin)**

*Description:*

**Attachment:
[post\_key.py](att-101/post_key_py.bin)**

*Description:*

**Attachment:
[signature.asc](att-101/signature_asc.bin)**

*Description:*

---

[![Previous](/images/left-icon-16x16.png)](100)
[By Date](date.html#101)
[![Next](/images/right-icon-16x16.png)](102)

[![Previous](/images/left-icon-16x16.png)](99)
[By Thread](index.html#101)
[![Next](/images/right-icon-16x16.png)](102)

### Current thread:

* **keylime: Multiple Security Issues (including remote code execution in the Agent component)** *Matthias Gerstner (Jan 28)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from github.com_8b00c3aa_20250114_203207.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fsecurity%2Fadvisories%2FGHSA-87gh-qc28-j9mm)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fsecurity%2Fadvisories%2FGHSA-87gh-qc28-j9mm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=keylime%2Fkeylime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[keylime](/keylime)
/
**[keylime](/keylime/keylime)**
Public

* [Notifications](/login?return_to=%2Fkeylime%2Fkeylime) You must be signed in to change notification settings
* [Fork
  153](/login?return_to=%2Fkeylime%2Fkeylime)
* [Star
   438](/login?return_to=%2Fkeylime%2Fkeylime)

* [Code](/keylime/keylime)
* [Issues
  27](/keylime/keylime/issues)
* [Pull requests
  7](/keylime/keylime/pulls)
* [Discussions](/keylime/keylime/discussions)
* [Actions](/keylime/keylime/actions)
* [Projects
  0](/keylime/keylime/projects)
* [Wiki](/keylime/keylime/wiki)
* [Security](/keylime/keylime/security)
* [Insights](/keylime/keylime/pulse)

Additional navigation options

* [Code](/keylime/keylime)
* [Issues](/keylime/keylime/issues)
* [Pull requests](/keylime/keylime/pulls)
* [Discussions](/keylime/keylime/discussions)
* [Actions](/keylime/keylime/actions)
* [Projects](/keylime/keylime/projects)
* [Wiki](/keylime/keylime/wiki)
* [Security](/keylime/keylime/security)
* [Insights](/keylime/keylime/pulse)

# Keylime: Unsanitized UUIDs can lead to log spoofing

High

[mpeters](/mpeters)
published
GHSA-87gh-qc28-j9mm
Jan 27, 2022

## Package

keylime
(Keylime)

## Affected versions

<6.2.0

## Patched versions

6.3.0

## Description

### Impact

Unsanitized UUIDs can be passed by a rogue agent and can lead to log spoofing on the verifier and registrar.

### Patches

Users should upgrade to at least 6.3.x.

### Workarounds

None.

### Credit

Many thanks to Matthias Gerstner for finding this issue and for Alberto Planas for the fix.

### For more information

If you have any questions or comments about this advisory:

* Email us at security@keylime.groups.io
* Ask on #keylime channel on the CNCF Slack

### Severity

High

### CVE ID

CVE-2022-23949

### Weaknesses

No CWEs

### Credits

* [![@mgerstner](https://avatars.githubusercontent.com/u/24227799?s=40&v=4)](/mgerstner)
  [mgerstner](/mgerstner)
  Analyst
* [![@aplanas](https://avatars.githubusercontent.com/u/645701?s=40&v=4)](/aplanas)
  [aplanas](/aplanas)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b2831624_20250114_203206.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fcommit%2Fe429e95329fc60608713ddfb82f4a92ee3b3d2d9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fcommit%2Fe429e95329fc60608713ddfb82f4a92ee3b3d2d9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=keylime%2Fkeylime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[keylime](/keylime)
/
**[keylime](/keylime/keylime)**
Public

* [Notifications](/login?return_to=%2Fkeylime%2Fkeylime) You must be signed in to change notification settings
* [Fork
  153](/login?return_to=%2Fkeylime%2Fkeylime)
* [Star
   438](/login?return_to=%2Fkeylime%2Fkeylime)

* [Code](/keylime/keylime)
* [Issues
  27](/keylime/keylime/issues)
* [Pull requests
  7](/keylime/keylime/pulls)
* [Discussions](/keylime/keylime/discussions)
* [Actions](/keylime/keylime/actions)
* [Projects
  0](/keylime/keylime/projects)
* [Wiki](/keylime/keylime/wiki)
* [Security](/keylime/keylime/security)
* [Insights](/keylime/keylime/pulse)

Additional navigation options

* [Code](/keylime/keylime)
* [Issues](/keylime/keylime/issues)
* [Pull requests](/keylime/keylime/pulls)
* [Discussions](/keylime/keylime/discussions)
* [Actions](/keylime/keylime/actions)
* [Projects](/keylime/keylime/projects)
* [Wiki](/keylime/keylime/wiki)
* [Security](/keylime/keylime/security)
* [Insights](/keylime/keylime/pulse)

## Commit

[Permalink](/keylime/keylime/commit/e429e95329fc60608713ddfb82f4a92ee3b3d2d9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

validators: add uuid and agent\_id validators

[Browse files](/keylime/keylime/tree/e429e95329fc60608713ddfb82f4a92ee3b3d2d9)
Browse the repository at this point in the history

```
Add valid_uuid and valid_agent_id validators, and tests for both.

Signed-off-by: Alberto Planas <aplanas@suse.com>
```

* Loading branch information

[![@aplanas](https://avatars.githubusercontent.com/u/645701?s=40&v=4)](/aplanas) [![@mpeters](https://avatars.githubusercontent.com/u/23815?s=40&v=4)](/mpeters)

[aplanas](/keylime/keylime/commits?author=aplanas "View all commits by aplanas")
authored and
[mpeters](/keylime/keylime/commits?author=mpeters "View all commits by mpeters")
committed
Jan 27, 2022

1 parent
[65c2b73](/keylime/keylime/commit/65c2b737129b5837f4a03660aeb1191ced275a57)

commit e429e95

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**70 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* keylime/common

  + keylime/common/validators.py
    [validators.py](#diff-e36eb583a031914aa2d2b47886c52ba3e20ea37b5adc4252be9cb4baa86c8fd7)
* test

  + test/test\_validators.py
    [test\_validators.py](#diff-ff7adaac6bf8308f3124bfeebe966b2c7d60819bd6d5f7a4e687481686e898cc)

## There are no files selected for viewing

26 changes: 26 additions & 0 deletions

26
[keylime/common/validators.py](#diff-e36eb583a031914aa2d2b47886c52ba3e20ea37b5adc4252be9cb4baa86c8fd7 "keylime/common/validators.py")

Show comments

[View file](/keylime/keylime/blob/e429e95329fc60608713ddfb82f4a92ee3b3d2d9/keylime/common/validators.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,3 +32,29 @@ def valid\_hex(value): |
|  |  | except Exception: |
|  |  | return False |
|  |  | return True |
|  |  |  |
|  |  |  |
|  |  | def valid\_uuid(uuid: str) -> bool: |
|  |  | """Check if the string is a valid UUID.""" |
|  |  | valid = False |
|  |  | try: |
|  |  | valid = bool( |
|  |  | re.fullmatch( |
|  |  | r"[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}", |
|  |  | uuid, |
|  |  | re.I, |
|  |  | ) |
|  |  | ) |
|  |  | except Exception: |
|  |  | pass |
|  |  | return valid |
|  |  |  |
|  |  |  |
|  |  | def valid\_agent\_id(agent\_id: str) -> bool: |
|  |  | """Check if agent\_id is valid.""" |
|  |  | valid = False |
|  |  | try: |
|  |  | valid = bool(re.fullmatch(r"[\w.-]+", agent\_id)) |
|  |  | except Exception: |
|  |  | pass |
|  |  | return valid |

44 changes: 44 additions & 0 deletions

44
[test/test\_validators.py](#diff-ff7adaac6bf8308f3124bfeebe966b2c7d60819bd6d5f7a4e687481686e898cc "test/test_validators.py")

Show comments

[View file](/keylime/keylime/blob/e429e95329fc60608713ddfb82f4a92ee3b3d2d9/test/test_validators.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -78,5 +78,49 @@ def test\_invalid(self): |
|  |  | self.assertFalse(validators.valid\_hex("123xyz")) |
|  |  |  |
|  |  |  |
|  |  | class TestValidUUID(unittest.TestCase): |
|  |  | """Tests for valid\_uuid.""" |
|  |  |  |
|  |  | def test\_none(self): |
|  |  | """Check that None is not valid.""" |
|  |  | self.assertFalse(validators.valid\_uuid(None)) |
|  |  |  |
|  |  | def test\_empty(self): |
|  |  | """Check that the empty string is not valid.""" |
|  |  | self.assertFalse(validators.valid\_uuid("")) |
|  |  |  |
|  |  | def test\_valid(self): |
|  |  | """Check a valid UUID that mix upper and lower case.""" |
|  |  | self.assertTrue(validators.valid\_uuid("74a93e15-da24-4ff1-ABC0-55beed02a16a")) |
|  |  |  |
|  |  | def test\_invalid(self): |
|  |  | """Check an invalid UUID that mix upper and lower case.""" |
|  |  | self.assertFalse(validators.valid\_uuid("some text")) |
|  |  |  |
|  |  |  |
|  |  | class TestValidAgentID(unittest.TestCase): |
|  |  | """Tests for valid\_agent\_id.""" |
|  |  |  |
|  |  | def test\_none(self): |
|  |  | """Check that None is not valid.""" |
|  |  | self.assertFalse(validators.valid\_agent\_id(None)) |
|  |  |  |
|  |  | def test\_empty(self): |
|  |  | """Check that the empty string is not valid.""" |
|  |  | self.assertFalse(validators.valid\_agent\_id("")) |
|  |  |  |
|  |  | def test\_valid\_uuid(self): |
|  |  | """Check a valid UUID that mix upper and lower case.""" |
|  |  | self.assertTrue(validators.valid\_agent\_id("74a93e15-da24-4ff1-ABC0-55beed02a16a")) |
|  |  |  |
|  |  | def test\_valid\_hostname(self): |
|  |  | """Check a valid hostname that mix upper and lower case.""" |
|  |  | self.assertTrue(validators.valid\_agent\_id("my-Hostname.example.com")) |
|  |  |  |
|  |  | def test\_invalid(self): |
|  |  | """Check an invalid user ID with non valid characters.""" |
|  |  | self.assertFalse(validators.valid\_agent\_id("rm -fr \*")) |
|  |  |  |
|  |  |  |
|  |  | if \_\_name\_\_ == "\_\_main\_\_": |
|  |  | unittest.main() |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e429e95`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fcommit%2Fe429e95329fc60608713ddfb82f4a92ee3b3d2d9) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e4979458_20250114_203205.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fcommit%2F65c2b737129b5837f4a03660aeb1191ced275a57)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fcommit%2F65c2b737129b5837f4a03660aeb1191ced275a57)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=keylime%2Fkeylime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[keylime](/keylime)
/
**[keylime](/keylime/keylime)**
Public

* [Notifications](/login?return_to=%2Fkeylime%2Fkeylime) You must be signed in to change notification settings
* [Fork
  153](/login?return_to=%2Fkeylime%2Fkeylime)
* [Star
   438](/login?return_to=%2Fkeylime%2Fkeylime)

* [Code](/keylime/keylime)
* [Issues
  27](/keylime/keylime/issues)
* [Pull requests
  7](/keylime/keylime/pulls)
* [Discussions](/keylime/keylime/discussions)
* [Actions](/keylime/keylime/actions)
* [Projects
  0](/keylime/keylime/projects)
* [Wiki](/keylime/keylime/wiki)
* [Security](/keylime/keylime/security)
* [Insights](/keylime/keylime/pulse)

Additional navigation options

* [Code](/keylime/keylime)
* [Issues](/keylime/keylime/issues)
* [Pull requests](/keylime/keylime/pulls)
* [Discussions](/keylime/keylime/discussions)
* [Actions](/keylime/keylime/actions)
* [Projects](/keylime/keylime/projects)
* [Wiki](/keylime/keylime/wiki)
* [Security](/keylime/keylime/security)
* [Insights](/keylime/keylime/pulse)

## Commit

[Permalink](/keylime/keylime/commit/65c2b737129b5837f4a03660aeb1191ced275a57)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

validators: create validators module

[Browse files](/keylime/keylime/tree/65c2b737129b5837f4a03660aeb1191ced275a57)
Browse the repository at this point in the history

```
Move from the config module some validators, and create the validators
module.  Add tests for them.

Signed-off-by: Alberto Planas <aplanas@suse.com>
```

* Loading branch information

[![@aplanas](https://avatars.githubusercontent.com/u/645701?s=40&v=4)](/aplanas) [![@mpeters](https://avatars.githubusercontent.com/u/23815?s=40&v=4)](/mpeters)

[aplanas](/keylime/keylime/commits?author=aplanas "View all commits by aplanas")
authored and
[mpeters](/keylime/keylime/commits?author=mpeters "View all commits by mpeters")
committed
Jan 27, 2022

1 parent
[ea5d037](/keylime/keylime/commit/ea5d0373fa2c050d5d95404eb779be7e8327b911)

commit 65c2b73

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**127 additions**
and
**44 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* keylime

  + keylime/cloud\_verifier\_common.py
    [cloud\_verifier\_common.py](#diff-218fcb709327aa245b4b3fd588b9dd714e3fe3cd5e6049956df8cefb45c7c63c)
  + common

    - keylime/common/validators.py
      [validators.py](#diff-e36eb583a031914aa2d2b47886c52ba3e20ea37b5adc4252be9cb4baa86c8fd7)
  + keylime/config.py
    [config.py](#diff-f24c8689ff09f5c9e844129e329d4e9c4ce072702accc37138ec58de3f4d9ada)
  + keylime/ima.py
    [ima.py](#diff-8ac65b9963350191e39f53208d7ea30fffb8648f8979af4bedb47603e61f8dd9)
  + keylime/keylime\_agent.py
    [keylime\_agent.py](#diff-d32fead59105bb306a5dd9f541932a905dfebb1819c599c47e4e731d52357e72)
* test

  + test/test\_validators.py
    [test\_validators.py](#diff-ff7adaac6bf8308f3124bfeebe966b2c7d60819bd6d5f7a4e687481686e898cc)

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[keylime/cloud\_verifier\_common.py](#diff-218fcb709327aa245b4b3fd588b9dd714e3fe3cd5e6049956df8cefb45c7c63c "keylime/cloud_verifier_common.py")

Show comments

[View file](/keylime/keylime/blob/65c2b737129b5837f4a03660aeb1191ced275a57/keylime/cloud_verifier_common.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,7 +16,7 @@ |
|  |  | from keylime.failure import Failure, Component |
|  |  | from keylime.tpm.tpm\_main import tpm |
|  |  | from keylime.tpm.tpm\_abstract import TPM\_Utilities |
|  |  | from keylime.common import algorithms |
|  |  | from keylime.common import algorithms, validators |
|  |  | from keylime import ima\_file\_signatures |
|  |  |  |
|  |  | # setup logging |
| Expand Down  Expand Up | | @@ -300,7 +300,7 @@ def validate\_agent\_data(agent\_data): |
|  |  | lists = json.loads(agent\_data['allowlist']) |
|  |  |  |
|  |  | # Validate exlude list contains valid regular expressions |
|  |  | is\_valid, \_, err\_msg = config.valid\_exclude\_list(lists.get('exclude')) |
|  |  | is\_valid, \_, err\_msg = validators.valid\_exclude\_list(lists.get('exclude')) |
|  |  | if not is\_valid: |
|  |  | err\_msg += " Exclude list regex is misformatted. Please correct the issue and try again." |
|  |  |  |
| Expand Down | |  |

34 changes: 34 additions & 0 deletions

34
[keylime/common/validators.py](#diff-e36eb583a031914aa2d2b47886c52ba3e20ea37b5adc4252be9cb4baa86c8fd7 "keylime/common/validators.py")

Show comments

[View file](/keylime/keylime/blob/65c2b737129b5837f4a03660aeb1191ced275a57/keylime/common/validators.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,34 @@ |
|  |  | """Validators module.""" |
|  |  | import re |
|  |  |  |
|  |  |  |
|  |  | def valid\_regex(regex): |
|  |  | """Check if string is a valid regular expression.""" |
|  |  | if regex is None: |
|  |  | return True, None, None |
|  |  |  |
|  |  | try: |
|  |  | compiled\_regex = re.compile(regex) |
|  |  | except re.error as regex\_err: |
|  |  | err = "Invalid regex: " + regex\_err.msg + "." |
|  |  | return False, None, err |
|  |  |  |
|  |  | return True, compiled\_regex, None |
|  |  |  |
|  |  |  |
|  |  | def valid\_exclude\_list(exclude\_list): |
|  |  | """Check if the list is composed of valid regex.""" |
|  |  | if not exclude\_list: |
|  |  | return True, None, None |
|  |  |  |
|  |  | combined\_regex = "(" + ")|(".join(exclude\_list) + ")" |
|  |  | return valid\_regex(combined\_regex) |
|  |  |  |
|  |  |  |
|  |  | def valid\_hex(value): |
|  |  | """Check if the string is a valid hex number representation.""" |
|  |  | try: |
|  |  | int(value, 16) |
|  |  | except Exception: |
|  |  | return False |
|  |  | return True |

32 changes: 0 additions & 32 deletions

32
[keylime/config.py](#diff-f24c8689ff09f5c9e844129e329d4e9c4ce072702accc37138ec58de3f4d9ada "keylime/config.py")

Show comments

[View file](/keylime/keylime/blob/65c2b737129b5837f4a03660aeb1191ced275a57/keylime/config.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,6 @@ |
|  |  | import os |
|  |  | import os.path |
|  |  | import configparser |
|  |  | import re |
|  |  | from typing import Optional |
|  |  |  |
|  |  | import yaml |
| Expand Down  Expand Up | | @@ -179,37 +178,6 @@ def yaml\_to\_dict(arry, add\_newlines=True, logger=None) -> Optional[dict]: |
|  |  | return None |
|  |  |  |
|  |  |  |
|  |  | def valid\_exclude\_list(exclude\_list): |
|  |  | if not exclude\_list: |
|  |  | return True, None, None |
|  |  |  |
|  |  | combined\_regex = "(" + ")|(".join(exclude\_list) + ")" |
|  |  | return valid\_regex(combined\_regex) |
|  |  |  |
|  |  |  |
|  |  | def valid\_regex(regex): |
|  |  | if regex is None: |
|  |  | return True, None, None |
|  |  |  |
|  |  | try: |
|  |  | compiled\_regex = re.compile(regex) |
|  |  | except re.error as regex\_err: |
|  |  | err = "Invalid regex: " + regex\_err.msg + "." |
|  |  | return False, None, err |
|  |  |  |
|  |  | return True, compiled\_regex, None |
|  |  |  |
|  |  |  |
|  |  | def valid\_hex(value: str): |
|  |  | if not value.isalnum(): |
|  |  | return False |
|  |  | try: |
|  |  | int(value, 16) |
|  |  | return True |
|  |  | except ValueError: |
|  |  | return False |
|  |  |  |
|  |  |  |
|  |  | if STUB\_IMA: |
|  |  | IMA\_ML = '../scripts/ima/ascii\_runtime\_measurements' |
|  |  | else: |
| Expand Down | |  |

15 changes: 7 additions & 8 deletions

15
[keylime/ima.py](#diff-8ac65b9963350191e39f53208d7ea30fffb8648f8979af4bedb47603e61f8dd9 "keylime/ima.py")

Show comments

[View file](/keylime/keylime/blob/65c2b737129b5837f4a03660aeb1191ced275a57/keylime/ima.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,11 +15,11 @@ |
|  |  |  |
|  |  | from keylime import config |
|  |  | from keylime import gpg |
|  |  | from keylime import keylime\_logging |
|  |  | from keylime import ima\_ast |
|  |  | from keylime.agentstates import AgentAttestState |
|  |  | from keylime import ima\_file\_signatures |
|  |  | from keylime.common.algorithms import Hash |
|  |  | from keylime import keylime\_logging |
|  |  | from keylime.agentstates import AgentAttestState |
|  |  | from keylime.common import algorithms, validators |
|  |  | from keylime.failure import Failure, Component |
|  |  |  |
|  |  |  |
| Expand Down  Expand Up | | @@ -223,15 +223,14 @@ def \_process\_measurement\_list(agentAttestState, lines, hash\_alg, lists=None, m2w |
|  |  | allow\_list = None |
|  |  | exclude\_list = None |
|  |  |  |
|  |  | ima\_log\_hash\_alg = Hash.SHA1 |
|  |  | ima\_log\_hash\_alg = algorithms.Hash.SHA1 |
|  |  | if allow\_list is not None: |
|  |  | try: |
|  |  | ima\_log\_hash\_alg = Hash(allow\_list["ima"]["log\_hash\_alg"]) |
|  |  | ima\_log\_hash\_alg = algorithms.Hash(allow\_list["ima"]["log\_hash\_alg"]) |
|  |  | except ValueError: |
|  |  | logger.warning("Specified IMA log hash algorithm %s is not a valid algorithm! Defaulting to SHA1.", |
|  |  | allow\_list["ima"]["log\_hash\_alg"]) |
|  |  |  |
|  |  |  |
|  |  | if boot\_aggregates and allow\_list: |
|  |  | if 'boot\_aggregate' not in allow\_list['hashes'] : |
|  |  | allow\_list['hashes']['boot\_aggregate'] = [] |
| Expand All | | @@ -240,7 +239,7 @@ def \_process\_measurement\_list(agentAttestState, lines, hash\_alg, lists=None, m2w |
|  |  | if val not in allow\_list['hashes']['boot\_aggregate'] : |
|  |  | allow\_list['hashes']['boot\_aggregate'].append(val) |
|  |  |  |
|  |  | is\_valid, compiled\_regex, err\_msg = config.valid\_exclude\_list(exclude\_list) |
|  |  | is\_valid, compiled\_regex, err\_msg = validators.valid\_exclude\_list(exclude\_list) |
|  |  | if not is\_valid: |
|  |  | # This should not happen as the exclude list has already been validated |
|  |  | # by the verifier before acceping it. This is a safety net just in case. |
| Expand Down  Expand Up | | @@ -312,7 +311,7 @@ def \_process\_measurement\_list(agentAttestState, lines, hash\_alg, lists=None, m2w |
|  |  |  |
|  |  |  |
|  |  | def process\_measurement\_list(agentAttestState, lines, lists=None, m2w=None, pcrval=None, ima\_keyrings=None, |
|  |  | boot\_aggregates=None, hash\_alg=Hash.SHA1): |
|  |  | boot\_aggregates=None, hash\_alg=algorithms.Hash.SHA1): |
|  |  | failure = Failure(Component.IMA) |
|  |  | try: |
|  |  | running\_hash, failure = \_process\_measurement\_list(agentAttestState, lines, hash\_alg, lists=lists, m2w=m2w, |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[keylime/keylime\_agent.py](#diff-d32fead59105bb306a5dd9f541932a905dfebb1819c599c47e4e731d52357e72 "keylime/keylime_agent.py")

Show comments

[View file](/keylime/keylime/blob/65c2b737129b5837f4a03660aeb1191ced275a57/keylime/keylime_agent.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -43,7 +43,7 @@ |
|  |  | from keylime import secure\_mount |
|  |  | from keylime import web\_util |
|  |  | from keylime import api\_version as keylime\_api\_version |
|  |  | from keylime.common import algorithms |
|  |  | from keylime.common import algorithms, validators |
|  |  | from keylime.tpm.tpm\_main import tpm |
|  |  | from keylime.tpm.tpm\_abstract import TPM\_Utilities |
|  |  | from keylime.tpm.tpm2\_objects import pubkey\_from\_tpm2b\_public |
| Expand Down  Expand Up | | @@ -131,7 +131,7 @@ def do\_GET(self): |
|  |  |  |
|  |  | # Sanitization assurance (for tpm.run() tasks below) |
|  |  | if not (nonce.isalnum() and |
|  |  | (pcrmask is None or config.valid\_hex(pcrmask)) and |
|  |  | (pcrmask is None or validators.valid\_hex(pcrmask)) and |
|  |  | ima\_ml\_entry.isalnum()): |
|  |  | logger.warning('GET quote returning 400 response. parameters should be strictly alphanumeric') |
|  |  | web\_util.echo\_json\_response( |
| Expand Down | |  |

82 changes: 82 additions & 0 deletions

82
[test/test\_validators.py](#diff-ff7adaac6bf8308f3124bfeebe966b2c7d60819bd6d5f7a4e687481686e898cc "test/test_validators.py")

Show comments

[View file](/keylime/keylime/blob/65c2b737129b5837f4a03660aeb1191ced275a57/test/test_validators.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,82 @@ |
|  |  | import unittest |
|  |  |  |
|  |  | from keylime.common import validators |
|  |  |  |
|  |  |  |
|  |  | class TestValidRegex(unittest.TestCase): |
|  |  | """Tests for valid\_regex.""" |
|  |  |  |
|  |  | def test\_none(self): |
|  |  | """Check that None is a valid regex.""" |
|  |  | self.assertEqual(validators.valid\_regex(None), (True, None, None)) |
|  |  |  |
|  |  | def test\_valid(self): |
|  |  | """Check a well formed regex.""" |
|  |  | value = validators.valid\_regex(r"a.\*") |
|  |  | self.assertTrue(value[0]) |
|  |  | self.assertEqual(value[1].pattern, r"a.\*") |
|  |  | self.assertEqual(value[2], None) |
|  |  |  |
|  |  | def test\_invalid(self): |
|  |  | """Check a not valid regex.""" |
|  |  | value = validators.valid\_regex(r"a[") |
|  |  | self.assertEqual( |
|  |  | value, (False, None, "Invalid regex: unterminated character set.") |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | class TestValidExcludeList(unittest.TestCase): |
|  |  | """Tests for valid\_exclude\_list.""" |
|  |  |  |
|  |  | def test\_none(self): |
|  |  | """Check that the empty list is valid.""" |
|  |  | self.assertEqual(validators.valid\_exclude\_list(None), (True, None, None)) |
|  |  |  |
|  |  | def test\_single(self): |
|  |  | """Check a single exclude list element.""" |
|  |  | value = validators.valid\_exclude\_list([r"a.\*"]) |
|  |  | self.assertTrue(value[0]) |
|  |  | self.assertEqual(value[1].pattern, r"(a.\*)") |
|  |  | self.assertEqual(value[2], None) |
|  |  |  |
|  |  | def test\_multi(self): |
|  |  | """Check a multiple elements exclude list.""" |
|  |  | value = validators.valid\_exclude\_list([r"a.\*", r"b.\*"]) |
|  |  | self.assertTrue(value[0]) |
|  |  | self.assertEqual(value[1].pattern, r"(a.\*)|(b.\*)") |
|  |  | self.assertEqual(value[2], None) |
|  |  |  |
|  |  | def test\_invalid(self): |
|  |  | """Check an invalid exclude list.""" |
|  |  | value = validators.valid\_exclude\_list([r"a["]) |
|  |  | self.assertEqual( |
|  |  | value, (False, None, "Invalid regex: unterminated character set.") |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | class TestValidHex(unittest.TestCase): |
|  |  | """Tests for valid\_hex.""" |
|  |  |  |
|  |  | def test\_none(self): |
|  |  | """Check that None is not valid.""" |
|  |  | self.assertFalse(validators.valid\_hex(None)) |
|  |  |  |
|  |  | def test\_empty(self): |
|  |  | """Check that the empty string is not valid.""" |
|  |  | self.assertFalse(validators.valid\_hex("")) |
|  |  |  |
|  |  | def test\_valid\_lower(self): |
|  |  | """Check a valid lower case hexadecimal number.""" |
|  |  | self.assertTrue(validators.valid\_hex("123abc")) |
|  |  |  |
|  |  | def test\_valid\_upper(self): |
|  |  | """Check a valid upper case hexadecimal number.""" |
|  |  | self.assertTrue(validators.valid\_hex("123ABC")) |
|  |  |  |
|  |  | def test\_invalid(self): |
|  |  | """Check and invalid hexadecimal number.""" |
|  |  | self.assertFalse(validators.valid\_hex("123xyz")) |
|  |  |  |
|  |  |  |
|  |  | if \_\_name\_\_ == "\_\_main\_\_": |
|  |  | unittest.main() |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `65c2b73`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkeylime%2Fkeylime%2Fcommit%2F65c2b737129b5837f4a03660aeb1191ced275a57) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


