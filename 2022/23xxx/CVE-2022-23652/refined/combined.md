=== Content from github.com_ed57edce_20250114_215428.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule-proxy%2Fcommit%2Fefe91f68ebf8a9e3d21491dc57da7b8a746415d8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule-proxy%2Fcommit%2Fefe91f68ebf8a9e3d21491dc57da7b8a746415d8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=projectcapsule%2Fcapsule-proxy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcapsule](/projectcapsule)
/
**[capsule-proxy](/projectcapsule/capsule-proxy)**
Public

* [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy) You must be signed in to change notification settings
* [Fork
  41](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy)
* [Star
   45](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy)

* [Code](/projectcapsule/capsule-proxy)
* [Issues
  4](/projectcapsule/capsule-proxy/issues)
* [Pull requests
  10](/projectcapsule/capsule-proxy/pulls)
* [Discussions](/projectcapsule/capsule-proxy/discussions)
* [Actions](/projectcapsule/capsule-proxy/actions)
* [Projects
  0](/projectcapsule/capsule-proxy/projects)
* [Security](/projectcapsule/capsule-proxy/security)
* [Insights](/projectcapsule/capsule-proxy/pulse)

Additional navigation options

* [Code](/projectcapsule/capsule-proxy)
* [Issues](/projectcapsule/capsule-proxy/issues)
* [Pull requests](/projectcapsule/capsule-proxy/pulls)
* [Discussions](/projectcapsule/capsule-proxy/discussions)
* [Actions](/projectcapsule/capsule-proxy/actions)
* [Projects](/projectcapsule/capsule-proxy/projects)
* [Security](/projectcapsule/capsule-proxy/security)
* [Insights](/projectcapsule/capsule-proxy/pulse)

## Commit

[Permalink](/projectcapsule/capsule-proxy/commit/efe91f68ebf8a9e3d21491dc57da7b8a746415d8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

bug: cve exploiting malicious connection header

[Browse files](/projectcapsule/capsule-proxy/tree/efe91f68ebf8a9e3d21491dc57da7b8a746415d8)
Browse the repository at this point in the history

* Loading branch information

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&v=4)](/prometherion)

[prometherion](/projectcapsule/capsule-proxy/commits?author=prometherion "View all commits by prometherion")
committed
Feb 20, 2022

1 parent
[e9fbcf4](/projectcapsule/capsule-proxy/commit/e9fbcf4472fbc9432386f5137616069ab2f676be)

commit efe91f6

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**31 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* go.mod
  [go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6)
* internal/webserver

  + internal/webserver/webserver.go
    [webserver.go](#diff-abd7ed06d2e103da6501fbaf553c64d33d62628dd46621aa8fbaab8452dac7f7)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6 "go.mod")

Show comments

[View file](/projectcapsule/capsule-proxy/blob/efe91f68ebf8a9e3d21491dc57da7b8a746415d8/go.mod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ require ( |
|  |  | github.com/pkg/errors v0.9.1 |
|  |  | github.com/spf13/pflag v1.0.5 |
|  |  | go.uber.org/zap v1.18.1 |
|  |  | golang.org/x/net v0.0.0-20210520170846-37e1c6afe023 |
|  |  | k8s.io/api v0.22.0 |
|  |  | k8s.io/apimachinery v0.22.1 |
|  |  | k8s.io/apiserver v0.22.0 |
| Expand Down | |  |

30 changes: 30 additions & 0 deletions

30
[internal/webserver/webserver.go](#diff-abd7ed06d2e103da6501fbaf553c64d33d62628dd46621aa8fbaab8452dac7f7 "internal/webserver/webserver.go")

Show comments

[View file](/projectcapsule/capsule-proxy/blob/efe91f68ebf8a9e3d21491dc57da7b8a746415d8/internal/webserver/webserver.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,6 +10,7 @@ import ( |
|  |  | "fmt" |
|  |  | "net/http" |
|  |  | "net/http/httputil" |
|  |  | "net/textproto" |
|  |  | "strings" |
|  |  | "time" |
|  |  |  |
| Expand All | | @@ -18,6 +19,7 @@ import ( |
|  |  | "github.com/gorilla/handlers" |
|  |  | "github.com/gorilla/mux" |
|  |  | "github.com/pkg/errors" |
|  |  | "golang.org/x/net/http/httpguts" |
|  |  | "k8s.io/apimachinery/pkg/labels" |
|  |  | "k8s.io/apimachinery/pkg/util/sets" |
|  |  | "k8s.io/apiserver/pkg/authentication/serviceaccount" |
| Expand Down  Expand Up | | @@ -178,6 +180,9 @@ func (n kubeFilter) impersonateHandler(writer http.ResponseWriter, request \*http |
|  |  | if len(n.bearerToken) > 0 { |
|  |  | request.Header.Set("Authorization", fmt.Sprintf("Bearer %s", n.bearerToken)) |
|  |  | } |
|  |  | // Dropping malicious header connection |
|  |  | // https://github.com/clastix/capsule-proxy/issues/188 |
|  |  | n.removingHopByHopHeaders(request) |
|  |  |  |
|  |  | request.Header.Add("Impersonate-User", username) |
|  |  |  |
| Expand Down  Expand Up | | @@ -355,3 +360,28 @@ func (n kubeFilter) getProxyTenantsForOwnerKind(ownerKind capsulev1beta1.OwnerKi |
|  |  |  |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | func (n \*kubeFilter) removingHopByHopHeaders(request \*http.Request) { |
|  |  | connectionHeaderName, upgradeHeaderName, requestUpgradeType := "connection", "upgrade", "" |
|  |  |  |
|  |  | if httpguts.HeaderValuesContainsToken(request.Header[connectionHeaderName], upgradeHeaderName) { |
|  |  | requestUpgradeType = request.Header.Get(upgradeHeaderName) |
|  |  | } |
|  |  | // Removing connection headers |
|  |  | for \_, f := range request.Header.Values(connectionHeaderName) { |
|  |  | for \_, sf := range strings.Split(f, ",") { |
|  |  | if sf = textproto.TrimString(sf); sf != "" { |
|  |  | request.Header.Del(sf) |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if requestUpgradeType != "" { |
|  |  | request.Header.Set(connectionHeaderName, upgradeHeaderName) |
|  |  | request.Header.Set(upgradeHeaderName, requestUpgradeType) |
|  |  |  |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | request.Header.Del(connectionHeaderName) |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `efe91f6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule-proxy%2Fcommit%2Fefe91f68ebf8a9e3d21491dc57da7b8a746415d8) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_d645d283_20250114_215430.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule-proxy%2Fissues%2F188)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule-proxy%2Fissues%2F188)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=projectcapsule%2Fcapsule-proxy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcapsule](/projectcapsule)
/
**[capsule-proxy](/projectcapsule/capsule-proxy)**
Public

* [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy) You must be signed in to change notification settings
* [Fork
  41](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy)
* [Star
   45](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy)

* [Code](/projectcapsule/capsule-proxy)
* [Issues
  4](/projectcapsule/capsule-proxy/issues)
* [Pull requests
  10](/projectcapsule/capsule-proxy/pulls)
* [Discussions](/projectcapsule/capsule-proxy/discussions)
* [Actions](/projectcapsule/capsule-proxy/actions)
* [Projects
  0](/projectcapsule/capsule-proxy/projects)
* [Security](/projectcapsule/capsule-proxy/security)
* [Insights](/projectcapsule/capsule-proxy/pulse)

Additional navigation options

* [Code](/projectcapsule/capsule-proxy)
* [Issues](/projectcapsule/capsule-proxy/issues)
* [Pull requests](/projectcapsule/capsule-proxy/pulls)
* [Discussions](/projectcapsule/capsule-proxy/discussions)
* [Actions](/projectcapsule/capsule-proxy/actions)
* [Projects](/projectcapsule/capsule-proxy/projects)
* [Security](/projectcapsule/capsule-proxy/security)
* [Insights](/projectcapsule/capsule-proxy/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fprojectcapsule%2Fcapsule-proxy%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Privilege escalation vulnerability via malicious "Connection" header #188

Closed

[prometherion](/prometherion) opened this issue
Feb 18, 2022
¬∑ 1 comment
 ¬∑ Fixed by [#189](https://github.com/projectcapsule/capsule-proxy/pull/189)

Closed

# [Privilege escalation vulnerability via malicious "Connection" header](#top) #188

[prometherion](/prometherion) opened this issue
Feb 18, 2022
¬∑ 1 comment
 ¬∑ Fixed by [#189](https://github.com/projectcapsule/capsule-proxy/pull/189)

Assignees
[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&v=4)](/prometherion)

Labels
[bug](/projectcapsule/capsule-proxy/labels/bug)
Something isn't working

Milestone
[v0.2.1](/projectcapsule/capsule-proxy/milestone/5 "v0.2.1")

## Comments

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=80&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)

Copy link

Member

### **[prometherion](/prometherion)** commented [Feb 18, 2022](#issue-1143674082)

| A user crafting an API request directed at `capsule-proxy` can get a privilege escalation using the Service Account of the proxy itself.  This is done by passing the `Impersonate-User` or `Impersonate-Group` header in the `Connection` header, using the same exploit described here: [GHSA-pvxj-25m6-7vqr](https://github.com/rancher/rancher/security/advisories/GHSA-pvxj-25m6-7vqr "GHSA-pvxj-25m6-7vqr")  At this point, instead of impersonating the user and their permissions, the request will act as if it was from the ~~Rancher management server~~ Capsule Proxy and incorrectly return the information. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)
[prometherion](/prometherion)
added
the
[bug](/projectcapsule/capsule-proxy/labels/bug)
Something isn't working
label
[Feb 18, 2022](#event-6102085373)

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)
[prometherion](/prometherion)
self-assigned this
[Feb 18, 2022](#event-6102085415)

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)
[prometherion](/prometherion)
mentioned this issue
[Feb 18, 2022](#ref-pullrequest-1143678110)

[bug: cve exploiting malicious connection header
#189](/projectcapsule/capsule-proxy/pull/189)
 Merged

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=80&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)

Copy link

Member

Author

### **[prometherion](/prometherion)** commented [Feb 18, 2022](#issuecomment-1045102097) ‚Ä¢ edited Loading

| Steps on how to reproduce ``` kind create cluster --name capsule --wait 60s helm upgrade --install capsule clastix/capsule -n capsule-system --create-namespace mkcert 127.0.0.1 && kubectl --namespace capsule-system create secret tls capsule-proxy --key=./127.0.0.1-key.pem --cert ./127.0.0.1.pem helm upgrade --install capsule-proxy clastix/capsule-proxy -n capsule-system --create-namespace kubectl -n capsule-system port-forward svc/capsule-proxy 9001  ```  ``` export TOKEN=$(any valid token)  curl --cacert /home/prometherion/.local/share/mkcert/rootCA.pem "https://localhost:9001/api/v1/secrets" -H "Authorization: Bearer $TOKEN" -H "Connection: Imperso nate-User,Impersonate-Group" -0  ```  Many kudos to [@carpenterm](https://github.com/carpenterm) and [@enj](https://github.com/enj) for pointing this out! üôèüèª  A review for the proposed PR would be great, along with the direct maintainers, such as [@bsctl](https://github.com/bsctl) and [@MaxFedotov](https://github.com/MaxFedotov)! |
| --- |

All reactions

Sorry, something went wrong.

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)
[prometherion](/prometherion)
added this to the [v0.2.1](/projectcapsule/capsule-proxy/milestone/5) milestone
[Feb 18, 2022](#event-6102131783)

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&u=e3391213771b6f93608b632125f8a58223d82e70&v=4)](/prometherion)
[prometherion](/prometherion)
closed this as [completed](/projectcapsule/capsule-proxy/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#189](/projectcapsule/capsule-proxy/pull/189)
[Feb 20, 2022](#event-6107832489)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule-proxy%2Fissues%2F188)

Assignees

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=40&v=4)](/prometherion) [prometherion](/prometherion)

Labels

[bug](/projectcapsule/capsule-proxy/labels/bug)
Something isn't working

Projects

None yet

Milestone

 [**v0.2.1**](/projectcapsule/capsule-proxy/milestone/5 "v0.2.1")

Development

Successfully merging a pull request may close this issue.

 [bug: cve exploiting malicious connection header](/projectcapsule/capsule-proxy/pull/189)
 [projectcapsule/capsule-proxy](/projectcapsule/capsule-proxy)

1 participant

[![@prometherion](https://avatars.githubusercontent.com/u/9697646?s=52&v=4)](/prometherion)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_a92fcdec_20250114_215432.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule-proxy%2Fsecurity%2Fadvisories%2FGHSA-9cwv-cppx-mqjm)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fprojectcapsule%2Fcapsule-proxy%2Fsecurity%2Fadvisories%2FGHSA-9cwv-cppx-mqjm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=projectcapsule%2Fcapsule-proxy)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[projectcapsule](/projectcapsule)
/
**[capsule-proxy](/projectcapsule/capsule-proxy)**
Public

* [Notifications](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy) You must be signed in to change notification settings
* [Fork
  41](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy)
* [Star
   45](/login?return_to=%2Fprojectcapsule%2Fcapsule-proxy)

* [Code](/projectcapsule/capsule-proxy)
* [Issues
  4](/projectcapsule/capsule-proxy/issues)
* [Pull requests
  10](/projectcapsule/capsule-proxy/pulls)
* [Discussions](/projectcapsule/capsule-proxy/discussions)
* [Actions](/projectcapsule/capsule-proxy/actions)
* [Projects
  0](/projectcapsule/capsule-proxy/projects)
* [Security](/projectcapsule/capsule-proxy/security)
* [Insights](/projectcapsule/capsule-proxy/pulse)

Additional navigation options

* [Code](/projectcapsule/capsule-proxy)
* [Issues](/projectcapsule/capsule-proxy/issues)
* [Pull requests](/projectcapsule/capsule-proxy/pulls)
* [Discussions](/projectcapsule/capsule-proxy/discussions)
* [Actions](/projectcapsule/capsule-proxy/actions)
* [Projects](/projectcapsule/capsule-proxy/projects)
* [Security](/projectcapsule/capsule-proxy/security)
* [Insights](/projectcapsule/capsule-proxy/pulse)

# Privilege escalation using hop-by-hop Connection header

High

[prometherion](/prometherion)
published
GHSA-9cwv-cppx-mqjm
Feb 20, 2022

## Package

No package listed

## Affected versions

<= v0.2.0

## Patched versions

None

## Description

### Impact

Using a malicious `Connection` header, an attacker with a proper authentication mechanism could start a privilege escalation towards the Kubernetes API Server, being able to exploit the `cluster-admin` Role bound to `capsule-proxy`.

### Patches

Patch has been merged in the v0.2.1 release.

### Workarounds

Upgrading is mandatory.

### Severity

High

### CVE ID

CVE-2022-23652

### Weaknesses

No CWEs

### Credits

* [![@enj](https://avatars.githubusercontent.com/u/7001223?s=40&v=4)](/enj)
  [enj](/enj)
  Analyst

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


