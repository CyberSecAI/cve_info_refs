=== Content from github.com_eb91d8d7_20250115_091734.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbytecodealliance%2Fwasmtime%2Fcommit%2F886ecc562040bef61faf19438c22285c2d62403a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbytecodealliance%2Fwasmtime%2Fcommit%2F886ecc562040bef61faf19438c22285c2d62403a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=bytecodealliance%2Fwasmtime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[bytecodealliance](/bytecodealliance)
/
**[wasmtime](/bytecodealliance/wasmtime)**
Public

* [Notifications](/login?return_to=%2Fbytecodealliance%2Fwasmtime) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fbytecodealliance%2Fwasmtime)
* [Star
   15.7k](/login?return_to=%2Fbytecodealliance%2Fwasmtime)

* [Code](/bytecodealliance/wasmtime)
* [Issues
  707](/bytecodealliance/wasmtime/issues)
* [Pull requests
  79](/bytecodealliance/wasmtime/pulls)
* [Actions](/bytecodealliance/wasmtime/actions)
* [Security](/bytecodealliance/wasmtime/security)
* [Insights](/bytecodealliance/wasmtime/pulse)

Additional navigation options

* [Code](/bytecodealliance/wasmtime)
* [Issues](/bytecodealliance/wasmtime/issues)
* [Pull requests](/bytecodealliance/wasmtime/pulls)
* [Actions](/bytecodealliance/wasmtime/actions)
* [Security](/bytecodealliance/wasmtime/security)
* [Insights](/bytecodealliance/wasmtime/pulse)

## Commit

[Permalink](/bytecodealliance/wasmtime/commit/886ecc562040bef61faf19438c22285c2d62403a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-88xq-w8cq-xfg7](https://github.com/advisories/GHSA-88xq-w8cq-xfg7 "GHSA-88xq-w8cq-xfg7")

[Browse files](/bytecodealliance/wasmtime/tree/886ecc562040bef61faf19438c22285c2d62403a)
Browse the repository at this point in the history

```
This commit fixes the drop of an uninitialized `VMExternRef` for an `externref`
global in an instance that failed to be allocated by the pooling instance
allocator.

The following engine configuration (via `Config`) is required to be impacted by
this bug:

* support for the reference types proposal must be enabled (this is the
  default for `Config`).
* a pooling allocation strategy must be configured via
  `Config::allocation_strategy`, which is not the default allocation strategy.

A module must be instantiated with the following characteristics:

* The module defines at least one table or memory.
* The module defines at least one `externref` global.

During instantiation, one of the following must occur to cause the
instantiation to fail:

* a call to `mprotect` or `VirtualAlloc` fails (e.g. out-of-memory conditions).
* a resource limiter was configured in the associated Store (via `Store::limiter`
  or `Store::limiter_async`) and the limiter returns false from the initial call
  to grow_memory or grow_table.

This results in a partially-initialized instance being dropped and that attempts
to drop the uninitialized `VMExternRef` representing the defined `externref` global.

The fix is to track whether or not the `VMContext` of the instance has been fully
initialized and skip the dropping of globals if not.
```

* Loading branch information

[![@peterhuene](https://avatars.githubusercontent.com/u/509666?s=40&v=4)](/peterhuene)

[peterhuene](/bytecodealliance/wasmtime/commits?author=peterhuene "View all commits by peterhuene")
authored
Feb 16, 2022

1 parent
[39b88e4](/bytecodealliance/wasmtime/commit/39b88e4e9e8115e4a9da2c1e3423459edf0a648e)

commit 886ecc5

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**74 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* crates/runtime/src

  + crates/runtime/src/instance.rs
    [instance.rs](#diff-e95cf87da8a8dcc08101777a3375ca3e634f0ed6b9f7c5daeec7e73cc4610eaf)
  + instance

    - crates/runtime/src/instance/allocator.rs
      [allocator.rs](#diff-aeff6fbd8ba216e92a8c8166d0a044b0eff2095a23e5bf831f699813fa284dcb)
* tests/all

  + tests/all/pooling\_allocator.rs
    [pooling\_allocator.rs](#diff-81c05da92bd2f848c6fa40aa6a4f88c78f6c209255cec2283ac617ccbd162848)

## There are no files selected for viewing

12 changes: 11 additions & 1 deletion

12
[crates/runtime/src/instance.rs](#diff-e95cf87da8a8dcc08101777a3375ca3e634f0ed6b9f7c5daeec7e73cc4610eaf "crates/runtime/src/instance.rs")

Show comments

[View file](/bytecodealliance/wasmtime/blob/886ecc562040bef61faf19438c22285c2d62403a/crates/runtime/src/instance.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -92,6 +92,10 @@ pub(crate) struct Instance { |
|  |  | /// allocation, but some host-defined objects will store their state here. |
|  |  | host\_state: Box<dyn Any + Send + Sync>, |
|  |  |  |
|  |  | /// Flag to track when the vmctx has been initialized. |
|  |  | /// The pooling allocator may drop an instance before `vmctx` is initialized. |
|  |  | vmctx\_initialized: bool, |
|  |  |  |
|  |  | /// Additional context used by compiled wasm code. This field is last, and |
|  |  | /// represents a dynamically-sized array that extends beyond the nominal |
|  |  | /// end of the struct (similar to a flexible array member). |
| Expand Down  Expand Up | | @@ -119,6 +123,7 @@ impl Instance { |
|  |  | dropped\_data: EntitySet::with\_capacity(module.passive\_data\_map.len()), |
|  |  | host\_state, |
|  |  | wasm\_data, |
|  |  | vmctx\_initialized: false, |
|  |  | vmctx: VMContext { |
|  |  | \_marker: std::marker::PhantomPinned, |
|  |  | }, |
| Expand Down  Expand Up | | @@ -733,13 +738,18 @@ impl Instance { |
|  |  | } |
|  |  |  |
|  |  | fn drop\_globals(&mut self) { |
|  |  | // Dropping globals requires that the vmctx be fully initialized |
|  |  | if !self.vmctx\_initialized { |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | for (idx, global) in self.module.globals.iter() { |
|  |  | let idx = match self.module.defined\_global\_index(idx) { |
|  |  | Some(idx) => idx, |
|  |  | None => continue, |
|  |  | }; |
|  |  | match global.wasm\_ty { |
|  |  | // For now only externref gloabls need to get destroyed |
|  |  | // For now only externref globals need to get destroyed |
|  |  | WasmType::ExternRef => {} |
|  |  | \_ => continue, |
|  |  | } |
| Expand Down | |  |

5 changes: 5 additions & 0 deletions

5
[crates/runtime/src/instance/allocator.rs](#diff-aeff6fbd8ba216e92a8c8166d0a044b0eff2095a23e5bf831f699813fa284dcb "crates/runtime/src/instance/allocator.rs")

Show comments

[View file](/bytecodealliance/wasmtime/blob/886ecc562040bef61faf19438c22285c2d62403a/crates/runtime/src/instance/allocator.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -475,6 +475,8 @@ fn initialize\_instance( |
|  |  | } |
|  |  |  |
|  |  | unsafe fn initialize\_vmcontext(instance: &mut Instance, req: InstanceAllocationRequest) { |
|  |  | assert!(!instance.vmctx\_initialized); |
|  |  |  |
|  |  | if let Some(store) = req.store.as\_raw() { |
|  |  | \*instance.interrupts() = (\*store).vminterrupts(); |
|  |  | \*instance.epoch\_ptr() = (\*store).epoch\_ptr(); |
| Expand Down  Expand Up | | @@ -570,6 +572,9 @@ unsafe fn initialize\_vmcontext(instance: &mut Instance, req: InstanceAllocationR |
|  |  |  |
|  |  | // Initialize the defined globals |
|  |  | initialize\_vmcontext\_globals(instance); |
|  |  |  |
|  |  | // Mark the vmctx as initialized |
|  |  | instance.vmctx\_initialized = true; |
|  |  | } |
|  |  |  |
|  |  | unsafe fn initialize\_vmcontext\_globals(instance: &Instance) { |
| Expand Down | |  |

58 changes: 58 additions & 0 deletions

58
[tests/all/pooling\_allocator.rs](#diff-81c05da92bd2f848c6fa40aa6a4f88c78f6c209255cec2283ac617ccbd162848 "tests/all/pooling_allocator.rs")

Show comments

[View file](/bytecodealliance/wasmtime/blob/886ecc562040bef61faf19438c22285c2d62403a/tests/all/pooling_allocator.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -511,3 +511,61 @@ fn preserve\_data\_segments() -> Result<()> { |
|  |  |  |
|  |  | Ok(()) |
|  |  | } |
|  |  |  |
|  |  | #[test] |
|  |  | fn drop\_externref\_global\_during\_module\_init() -> Result<()> { |
|  |  | struct Limiter; |
|  |  |  |
|  |  | impl ResourceLimiter for Limiter { |
|  |  | fn memory\_growing(&mut self, \_: usize, \_: usize, \_: Option<usize>) -> bool { |
|  |  | false |
|  |  | } |
|  |  |  |
|  |  | fn table\_growing(&mut self, \_: u32, \_: u32, \_: Option<u32>) -> bool { |
|  |  | false |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | let mut config = Config::new(); |
|  |  | config.wasm\_reference\_types(true); |
|  |  | config.allocation\_strategy(InstanceAllocationStrategy::Pooling { |
|  |  | strategy: PoolingAllocationStrategy::NextAvailable, |
|  |  | module\_limits: Default::default(), |
|  |  | instance\_limits: InstanceLimits { count: 1 }, |
|  |  | }); |
|  |  |  |
|  |  | let engine = Engine::new(&config)?; |
|  |  |  |
|  |  | let module = Module::new( |
|  |  | &engine, |
|  |  | r#" |
|  |  | (module |
|  |  | (global i32 (i32.const 1)) |
|  |  | (global i32 (i32.const 2)) |
|  |  | (global i32 (i32.const 3)) |
|  |  | (global i32 (i32.const 4)) |
|  |  | (global i32 (i32.const 5)) |
|  |  | ) |
|  |  | "#, |
|  |  | )?; |
|  |  |  |
|  |  | let mut store = Store::new(&engine, Limiter); |
|  |  | drop(Instance::new(&mut store, &module, &[])?); |
|  |  | drop(store); |
|  |  |  |
|  |  | let module = Module::new( |
|  |  | &engine, |
|  |  | r#" |
|  |  | (module |
|  |  | (memory 1) |
|  |  | (global (mut externref) (ref.null extern)) |
|  |  | ) |
|  |  | "#, |
|  |  | )?; |
|  |  |  |
|  |  | let mut store = Store::new(&engine, Limiter); |
|  |  | store.limiter(|s| s); |
|  |  | assert!(Instance::new(&mut store, &module, &[]).is\_err()); |
|  |  |  |
|  |  | Ok(()) |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `886ecc5`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbytecodealliance%2Fwasmtime%2Fcommit%2F886ecc562040bef61faf19438c22285c2d62403a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a1ac5141_20250115_091735.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbytecodealliance%2Fwasmtime%2Fsecurity%2Fadvisories%2FGHSA-88xq-w8cq-xfg7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbytecodealliance%2Fwasmtime%2Fsecurity%2Fadvisories%2FGHSA-88xq-w8cq-xfg7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=bytecodealliance%2Fwasmtime)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[bytecodealliance](/bytecodealliance)
/
**[wasmtime](/bytecodealliance/wasmtime)**
Public

* [Notifications](/login?return_to=%2Fbytecodealliance%2Fwasmtime) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fbytecodealliance%2Fwasmtime)
* [Star
   15.7k](/login?return_to=%2Fbytecodealliance%2Fwasmtime)

* [Code](/bytecodealliance/wasmtime)
* [Issues
  707](/bytecodealliance/wasmtime/issues)
* [Pull requests
  79](/bytecodealliance/wasmtime/pulls)
* [Actions](/bytecodealliance/wasmtime/actions)
* [Security](/bytecodealliance/wasmtime/security)
* [Insights](/bytecodealliance/wasmtime/pulse)

Additional navigation options

* [Code](/bytecodealliance/wasmtime)
* [Issues](/bytecodealliance/wasmtime/issues)
* [Pull requests](/bytecodealliance/wasmtime/pulls)
* [Actions](/bytecodealliance/wasmtime/actions)
* [Security](/bytecodealliance/wasmtime/security)
* [Insights](/bytecodealliance/wasmtime/pulse)

# Invalid drop of VMExternRef from partially-initialized instances in the pooling instance allocator

High

[peterhuene](/peterhuene)
published
GHSA-88xq-w8cq-xfg7
Feb 16, 2022

## Package

cargo

wasmtime
([Rust](/advisories?query=ecosystem%3Arust))

## Affected versions

<= 0.34.0 (excluding 0.33.1)

## Patched versions

0.34.1, 0.33.1

## Description

### Impact

There exists a bug in the pooling instance allocator in Wasmtime's runtime where a failure to instantiate an instance for a module that defines an `externref` global will result in an invalid drop of a `VMExternRef` via an uninitialized pointer.

As instance slots may be reused between consecutive instantiations, the value of the uninitialized pointer may be from a previous instantiation and therefore under the control of an attacker via a module's initial values for its globals. If the attacker can somehow determine an address under their control inside the mapped memory representing the instance pool, it is possible to trick the runtime to call `drop_in_place` on a trait object under the attacker's control and therefore cause remote code execution.

Exploiting the bug to cause remote code execution would be very difficult as attackers cannot determine the addresses of globals from code executing within the WebAssembly VM and the memory space for the instance pool cannot be statically determined. Operating system mitigations, such as [address space layout randomization](https://en.wikipedia.org/wiki/Address_space_layout_randomization), would additionally increase the difficulty for attackers to determine useful executable code to target with an exploit. It is also very unlikely that attackers will be able to directly influence the conditions that trigger the bug as described below.

When the conditions to trigger the bug are met, however, it is much easier to exploit this bug to cause a denial of service by crashing the host with an invalid memory read.

The following engine configuration (via [Config](https://docs.rs/wasmtime/0.34.0/wasmtime/struct.Config.html)) is required to be impacted by this bug:

* support for the reference types proposal must be enabled (this is the default for `Config`).
* a pooling allocation strategy must be configured via [Config::allocation\_strategy](https://docs.rs/wasmtime/0.34.0/wasmtime/struct.Config.html#method.allocation_strategy), which is **not the default allocation strategy**.

A module must be instantiated with **all the following characteristics**:

* The module defines at least one table or memory.
* The module defines at least one `externref` global.

During instantiation, **one of the following** must occur to cause the instantiation to fail:

* a call to `mprotect` or `VirtualAlloc` fails (e.g. out-of-memory conditions).
* a resource limiter was configured in the associated `Store` (via [Store::limiter](https://docs.rs/wasmtime/0.34.0/wasmtime/struct.Store.html#method.limiter) or [Store::limiter\_async](https://docs.rs/wasmtime/0.34.0/wasmtime/struct.Store.html#method.limiter_async)) and the limiter returns `false` from the initial call to `memory_growing` or `table_growing`. **Stores do not have a resource limiter set by default**.

This results in a partially-initialized instance being dropped and that attempts to drop the uninitialized `VMExternRef` representing the defined `externref` global.

We have reason to believe that the effective impact of this bug is relatively small because the usage of `externref` is still uncommon and without a resource limiter configured on the `Store`, which is not the default configuration, it is only possible to trigger the bug from an error returned by `mprotect` or `VirtualAlloc`.

Note that on Linux with the `uffd` feature enabled, it is only possible to trigger the bug from a resource limiter as the call to `mprotect` is skipped; if no resource limiter is used, then this configuration is not vulnerable.

### Patches

The bug has been fixed in 0.34.1 and 0.33.1; users are encouraged to upgrade as soon as possible.

### Workarounds

If it is not possible to upgrade to 0.34.1 or 0.33.1 of the `wasmtime` crate, it is recommend that support for the reference types proposal be disabled by passing `false` to [Config::wasm\_reference\_types](https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.wasm_reference_types).

Doing so will prevent modules that use `externref` from being loaded entirely.

### For more information

If you have any questions or comments about this advisory:

* Reach out to us on [the Bytecode Alliance Zulip chat](https://bytecodealliance.zulipchat.com/#narrow/stream/217126-wasmtime)
* Open an issue in [the bytecodealliance/wasmtime repository](https://github.com/bytecodealliance/wasmtime/)

### Severity

High

### CVE ID

CVE-2022-23636

### Weaknesses

No CWEs

### Credits

* [![@peterhuene](https://avatars.githubusercontent.com/u/509666?s=40&v=4)](/peterhuene)
  [peterhuene](/peterhuene)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


