=== Content from youtu.be_4ddbe820_20250114_212849.html ===
[00:00] all right so today we're going to be
[00:02] going over the wavelink quantum d4g
[00:05] small home office uh whatever you'd like
[00:07] to call it wireless router
[00:09] we're going to be going over some
[00:10] reverse engineering and zero-day
[00:12] findings as well as some other
[00:14] information which we'll cover here
[00:15] shortly
[00:18] all right so for today's presentation we
[00:20] have our overview here we're going to
[00:22] make going over to some basic
[00:23] information about the device
[00:26] the methodologies utilized in our
[00:28] analysis of the device
[00:30] the tools utilized for our analysis
[00:33] zero day findings
[00:35] other vulnerabilities general reverse
[00:37] engineering information on this device
[00:40] and then finally we will
[00:41] go over a summary
[00:46] all right so a little about the device
[00:48] so this device is
[00:51] i would estimate probably a year
[00:53] two years old at most um it supports
[00:55] 802.11 ac
[00:57] both 2.4 gigahertz and 5 gigahertz
[01:01] uh it's a pretty cheap device i only
[01:03] spent about 35 bucks off of amazon for
[01:05] it brand new
[01:06] uh from what i can find it looks like
[01:09] walmart amazon alibaba and a couple
[01:12] other uh large well-known um
[01:16] businesses sell this device this is
[01:18] something you wouldn't find in an
[01:19] enterprise environment or at least i
[01:21] would hope not
[01:22] it's not meant to support that level of
[01:25] load it is um
[01:27] not too much power going on so it's
[01:29] probably something you're just going to
[01:30] find that you know small family home
[01:31] something like that or maybe a little
[01:32] business office
[01:36] as far as the countries this device is
[01:38] in um it's in the u.s obviously i was
[01:40] able to find online too doing some
[01:42] showdown uh lookups that it is in
[01:44] australia
[01:46] uh china russia
[01:48] canada
[01:49] brazil i believe it's on the list some
[01:51] other areas too however that's only
[01:53] going to be publicly facing devices that
[01:55] i found so i'm sure in homes throughout
[01:58] other parts of the world too that didn't
[01:59] come up as
[02:01] uh are having any results for this
[02:04] manufacturer probably have them too
[02:10] so now let's talk about some
[02:11] methodologies utilized in our analysis
[02:14] of this device
[02:17] so the methodologies utilized in
[02:19] analyzing this device were static
[02:21] analysis and dynamic analysis
[02:25] the general approach i took for this was
[02:27] since i had the device physically
[02:31] plugged it in got it all set up and then
[02:35] turned on owasp zap spidered the
[02:38] e-device's web pages
[02:40] uh then ran some fuzzing on them
[02:43] and it's automated uh
[02:46] vulnerability analysis and some other
[02:48] attack
[02:48] capabilities it has just look for some
[02:50] low-hanging fruit
[02:52] while that was going on
[02:54] i would also manually go through some of
[02:56] its findings and
[02:58] go through some of the pages
[03:01] http request it would have um inbound
[03:05] and outbound and
[03:06] would look for just any sort of
[03:08] weirdness that i might be able to
[03:09] interact with
[03:10] to uh
[03:12] you know maybe find a vulnerability do
[03:13] something weird with it whatever it you
[03:15] know maybe
[03:17] uh also while that was going i would
[03:19] crack open uh the firmware using bin
[03:22] walk and just kind of start peeking
[03:24] through there
[03:25] uh look for things such as text files
[03:28] that are configs that might have
[03:29] hard-coded passwords usernames uh just
[03:32] any sort of indicator that might tell me
[03:34] what's you know maybe uh
[03:35] running by the fault on the device even
[03:37] though
[03:38] i also ran nmap against it just to see
[03:41] if it found any open ports that i didn't
[03:43] anticipate
[03:44] uh
[03:46] then uh
[03:48] we'll just go through and just kind of
[03:49] look for things like that just whatever
[03:51] i can find you know maybe there's uh
[03:54] vpn keys that are hard coded in there or
[03:57] something like that or just you know
[03:59] simple things like that
[04:00] then i also would uh take some of the
[04:03] cgi bins and the
[04:06] other
[04:07] binaries related to
[04:09] the web server and would put those in
[04:11] ghidra and then i have a tool called
[04:13] insecure function finder i wrote that
[04:15] just goes through and that's exactly
[04:17] what it sounds like looks for known
[04:18] insecure lepsy functions but i have that
[04:20] going through
[04:21] um
[04:22] and i would just start kind of poking
[04:23] out and see what i could find in there
[04:24] see if anything interesting came up and
[04:26] then uh
[04:28] by the time i went through all that you
[04:30] know you'd have olas being done with its
[04:32] analysis i can go through that take a
[04:34] peek and see what came up
[04:36] maybe do some uh replays of requests
[04:38] with modifications to see if anything
[04:40] weird happens and then um
[04:42] be able to use that to kind of help
[04:44] guide me through some of the
[04:46] uh binaries that i'm analyzing too if i
[04:48] did find something weird in one you know
[04:49] i can
[04:50] compare it to some of the requests i saw
[04:52] saying see if you know hey can i figure
[04:54] out a path to get to this piece of code
[04:56] i want to interact with or whatever it
[04:57] may be
[04:58] um
[04:59] basically i did that
[05:01] entire approach i just described
[05:03] in an iterative
[05:05] uh kind of methodology
[05:07] just keep kind of poking out one thing
[05:09] go to another
[05:10] um
[05:11] use automated tools like i said just
[05:13] keep going and going until i kind of
[05:15] felt like i covered everything
[05:19] all right so now let's get into some of
[05:21] our tools
[05:24] so for our dynamic and static analysis
[05:27] of the wavelink router
[05:30] we used bin walk now specifically just
[05:32] to unpack the firmware
[05:34] giger was utilized for pretty much all
[05:37] of the static analysis being able to
[05:39] just dig through the code look at both
[05:40] the assembly
[05:41] or disassembly and the
[05:44] decompiled c functions
[05:46] and all of that do some string searches
[05:48] and just
[05:49] everything you'd anticipate
[05:51] uh insecure function finder is a plug-in
[05:53] i created for geeja does exactly what it
[05:55] sounds like it just goes around digs
[05:58] through a
[06:00] binary and looks for any known and
[06:02] secure functions and flags them for you
[06:04] so you can take a peek at those
[06:06] i use zap
[06:08] otherwise known as a wasp zap i use that
[06:11] for dynamic analysis
[06:13] that way i can spider the pages and fuzz
[06:16] them with ease and make some
[06:18] modifications to request and things like
[06:20] that
[06:21] uh and then also some of its automated
[06:23] attacks too just for any low hanging
[06:25] fruit potentially
[06:26] and lastly
[06:28] quick emulator was attempted i put it on
[06:31] here just because it was attempted but
[06:33] didn't really get anywhere with it um
[06:36] i've had a hit and miss
[06:39] success with quick emulator in the past
[06:41] and this time it was a miss
[06:42] mostly because there was missing i o
[06:45] from the uh
[06:49] through emulation that was required for
[06:51] those binaries to run so
[06:54] no luck with it but that's okay i had
[06:56] the device and allowed me to
[06:58] beat on it quite a bit anyway so worked
[07:00] out
[07:03] uh so for zero days um there were quite
[07:06] a few found in this device so what i'm
[07:08] going to do is go over a brief overview
[07:10] of the finding
[07:12] and then we'll get into some of the code
[07:15] as well as execution of
[07:18] these zero days and any other additional
[07:21] information that may be of use
[07:25] all right so for our first zero day we
[07:27] have credential replay uh this is pretty
[07:29] self-explanatory so we're just going to
[07:31] get right into some code analysis here
[07:34] all right for credential replay i should
[07:37] mention first
[07:38] none of the
[07:40] web application is encrypted for its
[07:41] traffic it doesn't use https tls or
[07:44] whatever you want to call it
[07:46] it's all plain text
[07:48] what they do
[07:50] is when you go to the user
[07:53] login or the administrator login on the
[07:55] web application
[07:57] it randomly generates a key
[08:00] on the client side
[08:02] and it uses that key to be concatenated
[08:05] with your user input password
[08:07] and the username is just always admin
[08:10] it'll concatenate the key in the
[08:11] password and it will run a md5 uh
[08:16] hashing algorithm against it and then it
[08:19] will use that password to log in that
[08:21] way you have a form of if you want to
[08:24] say obviously shouldn't
[08:26] so you can't just see the plain text
[08:27] credentials
[08:29] the problem comes in the fact that the
[08:31] key
[08:32] is not device generated it is randomly
[08:34] generated client-side and the client
[08:36] supplies what the key is
[08:40] so what happens here is we can see
[08:42] in our
[08:43] post requests captured in zap
[08:46] our key
[08:50] there we go
[08:51] so our key is right here
[08:54] and like i said that is client side
[08:56] generated and then the password right
[08:58] here is our md5 hash which is the
[09:01] concatenation of our user password or
[09:04] administrator password and our key run
[09:06] through an md5 hashing algorithm
[09:10] when that is sent
[09:14] let me open up guitra here
[09:17] so once the device gets the http post
[09:20] request
[09:22] it'll go and do your typical parsing of
[09:23] that request where it's just looking for
[09:25] those parameters pulling out the values
[09:26] and setting them in
[09:29] variables
[09:30] so what happens is it first gets the
[09:33] user supplied key
[09:35] that is sent and sticks it in this
[09:38] stack base variable and then it
[09:40] concatenates the password that the
[09:42] device has stored
[09:44] into that variable so now we have the
[09:46] key plus the password as a string from
[09:50] there
[09:51] it calls right here you can see md5 sum
[09:54] on that value
[09:56] and stores it on the stack in this
[09:58] variable ac stack 760.
[10:01] once it is in there if we scroll down a
[10:03] little bit more
[10:04] we can see it then does a compare of
[10:08] the user supplied password which is the
[10:11] key and the password
[10:15] run through the md5 function and that
[10:17] value on the stack if those match then
[10:20] we would get a value 0 and if 0 we get
[10:23] access to the admin console
[10:26] so basically the big issue is the device
[10:29] is not supplying that key
[10:32] which allows a replay attack to occur
[10:35] because all it cares is that that hash
[10:37] matches it doesn't care if it's a reused
[10:40] key or anything like that
[10:43] or dynamic salt if you want to call it
[10:45] that i guess that's technically what it
[10:46] is
[10:47] but it doesn't check for that and that's
[10:49] what's leading to this
[10:50] vulnerability
[10:56] all right so for our next one we have
[10:58] authentication bypass so this one i'm
[11:00] just going to give a quick little demo
[11:02] of what's going on and we'll talk about
[11:04] it
[11:06] all right so this one's
[11:07] pretty interesting
[11:09] so what they're doing essentially is
[11:10] instead of using session cookies to
[11:12] authenticate the user
[11:15] they are using
[11:16] the ip address of the user
[11:19] uh so what can happen is if you are on
[11:22] nat or
[11:24] if you're behind something that's going
[11:26] to just give you the same public ip
[11:28] address
[11:29] or if you just want to be sneaky and you
[11:32] know change your ipa address to meet the
[11:35] admins right when you know they're going
[11:37] to be uh
[11:38] in here you know whatever you want to do
[11:41] you can just get right into the admin
[11:43] page you can see here i'm on the part
[11:45] when you first go to it it wants me to
[11:46] log in well what i did was i logged into
[11:49] it on a system using that
[11:52] so
[11:53] it has the same ip address but if you
[11:55] see if i go to um
[11:57] the you know the main
[11:59] site it'll just ask me to log in so what
[12:01] i can do is just because i'm logged in
[12:03] on the other one
[12:05] i just go to forward slash main.shtml
[12:10] logs me right in it just it says oh hey
[12:12] you have the same ip address cool come
[12:14] on in
[12:16] so
[12:17] i dug around in the code a little bit
[12:18] and essentially it's exactly what you
[12:19] think it is it's just saying hey um once
[12:22] you log in uh successfully take the ip
[12:25] address store it and then anytime
[12:27] somebody tries to get to the site just
[12:29] check their ip and see if they are
[12:32] currently logged in to a quote unquote
[12:34] session and
[12:35] if they are let them in
[12:37] so you can see right here we just
[12:39] minimal effort got right into it uh
[12:42] this is something too i'm sure you can
[12:43] automate if you use something like uh
[12:46] i forget the name of it those um
[12:48] selenium stuff like that you could just
[12:50] make a script that constantly keeping in
[12:52] this website and once your admin logs in
[12:54] if you have the same ip address as them
[12:56] you're just going to get right in now it
[12:58] does hold sessions
[13:00] or quote unquote sessions by checking to
[13:02] see if you're on the page
[13:04] if an admin exits out of the page um
[13:07] once the javascript no longer in the
[13:09] background talking asynchronously to the
[13:11] device
[13:12] um is able to communicate it'll like 10
[13:14] seconds or something and it kicks them
[13:16] out and says okay hey they're no longer
[13:17] on the site log them out
[13:19] but you know as i just mentioned if you
[13:20] were able to automate this process have
[13:22] like five second interval refreshing or
[13:24] something you would be able to just take
[13:26] over this session
[13:27] and it doesn't seem to time out at least
[13:29] from what i've tested so
[13:30] uh
[13:31] you can just keep this running as long
[13:33] as you want and then one day pop in and
[13:34] go oh look i got admin you know
[13:37] pretty funny um
[13:38] fun little uh vulnerability here
[13:43] so for our next zero day we have
[13:45] improper access control although this
[13:47] vulnerability
[13:48] kind of really falls under
[13:50] quite a few areas
[13:52] of uh
[13:54] concern i guess if you want to call it
[13:55] that
[13:56] um
[13:57] i'm just going to get right into a quick
[13:59] demonstration of it to show you what's
[14:01] going on here
[14:03] all right so for our improper access
[14:05] control we're going to show you uh
[14:08] just a little bit of fun here
[14:10] so uh you can see
[14:12] i'm not logged in
[14:14] if i try to go to
[14:16] you know the main dot
[14:20] the main page
[14:22] it wants me to log in
[14:24] but
[14:26] if i go to forward slash cgi bin
[14:30] forward slash
[14:32] export logs.sh because there is a script
[14:36] in the cgi bin called export logs.sh
[14:40] with no authentication on it required to
[14:42] get to it
[14:44] you can see we install downloaded a
[14:46] system logs text file
[14:49] so let's open up this file and see
[14:51] what's in there
[14:56] just a little bit bigger
[14:57] all right so nothing too interesting so
[14:59] far keep going down just a whole bunch
[15:01] of information on here some mid
[15:03] variables and all that
[15:05] uh uh-oh
[15:07] um that's probably not good we got our
[15:10] login and our password or admin
[15:13] not sure why it dumps it here but it
[15:14] does
[15:16] so i thought that was pretty funny nice
[15:17] little
[15:19] issue there
[15:22] so here we have a command injection
[15:24] issue let's get right into it
[15:28] so the next one we want to get into here
[15:31] is our command injection this requires
[15:33] authentication however cross-site
[15:35] request forgery can be utilized in this
[15:37] as there is no anti-csrf
[15:42] tokens being checked
[15:44] so when you go to enable
[15:47] nas or network attached storage
[15:51] it will require you to put in a user and
[15:54] a password
[15:56] so we can see right here in our let me
[15:58] open that up
[16:03] see right here we have our user one
[16:05] equal share and our password is share
[16:07] just the default values it puts in there
[16:09] um and you can see this is just a
[16:11] typical post request with our values for
[16:13] our nas setup
[16:15] so let's take a peek over at ghidra and
[16:17] see
[16:18] specifically what's going on with user
[16:21] one right here
[16:24] so here we are in geyra on the set nas
[16:27] function
[16:28] that that post request is sent to
[16:31] and processed through
[16:33] so what happens is we can see right here
[16:35] we get our user value and i just marked
[16:38] the variable as user one
[16:41] and you can see as we go down here what
[16:44] happens is user one is placed on
[16:47] uh the stack in this string right here
[16:49] ac stack
[16:51] 296.
[16:52] and then uh oh we call system on that
[16:56] so
[16:57] what you can do is very obvious
[16:59] put in your command throw in your
[17:02] semicolons or whatever you'd like to
[17:04] make it look like separate commands and
[17:05] you can do whatever you'd like
[17:08] so for our next zero day we have cross
[17:11] site request forgery uh this one's
[17:13] pretty self-explanatory um just there's
[17:16] no anti-cross site request for jury
[17:18] tokens or any form of mitigation that i
[17:20] could find being utilized in this
[17:22] device
[17:23] um so for a little perfect concept here
[17:25] what we're going to do is show you
[17:28] the prior command injection
[17:30] uh over just a simple link click
[17:33] all right so for this next one what
[17:35] we're going to do is run a little script
[17:37] i have here called test.pi we're going
[17:38] to open up just take a quick peek at it
[17:41] um so what's this doing is it is doing
[17:43] command injection over nas that we just
[17:45] discussed prior to this vulnerability
[17:50] so you can see we just have all of our
[17:53] headers and parameters all that getting
[17:54] set up and what we are going to do
[17:56] is
[17:57] execute
[17:59] this command to dump credentials and
[18:02] other system information to a file for
[18:05] us then we're going to download it and
[18:06] put it in a credentialsdump txt file on
[18:09] the desktop
[18:11] i'm already logged in
[18:13] but as you can imagine if this was a
[18:15] link or something like that you clicked
[18:16] or a script or something that a admin
[18:19] ran or whatever you want to you know
[18:21] be be creative um it will do something
[18:24] fun so
[18:25] we'll do here is run it now this is
[18:28] going to take a couple seconds because
[18:29] um
[18:30] since we're not interacting with the
[18:32] devices at once it
[18:34] errors out but once that error and
[18:37] timeout everything occurs it still does
[18:39] execute that command
[18:42] so that ran and if we open up
[18:44] credentials dump
[18:45] oops there's the password
[18:48] and login
[18:52] so for this one we have insufficient
[18:54] verification of data authenticity
[18:57] essentially what this comes down to is
[18:59] the device does not appear
[19:01] to do any form of checks against the
[19:05] uploaded firmware to it so if you try to
[19:07] upgrade firmware it just looks to see if
[19:08] it has the correct magic number
[19:10] essentially
[19:11] and goes from there um now this was only
[19:14] done through static analysis i did not
[19:17] want to accidentally break my device
[19:19] from modifying the firmware and then
[19:21] something going wrong
[19:24] so i don't want to say this one's 100
[19:25] for sure but it appears to be an issue
[19:31] so now we have hard-coded cryptographic
[19:33] password
[19:34] this one's pretty self-explanatory
[19:36] what it comes down to essentially is
[19:38] when you export all the settings in this
[19:40] device as backup it encrypts them uh
[19:43] then it allows you to re-upload those
[19:45] and it'll decrypt it and
[19:47] you know change the configuration of
[19:49] whatever it used to be or whatever you'd
[19:51] like um
[19:53] the problem is this device and what
[19:56] appears to be many other devices from
[19:58] this vendor all use the same hard-coded
[20:01] password for the settings to be backed
[20:03] up which initially isn't really that big
[20:06] of a deal
[20:07] um
[20:08] but it makes it a problem when you find
[20:11] out after decrypting the file it
[20:14] contains the administrator credentials
[20:16] as well as network
[20:18] passwords and some other sensitive
[20:20] information like that that you generally
[20:23] wouldn't want other people to
[20:25] take a peek at
[20:28] so for hardcoded cryptographic password
[20:30] uh what happens is when you do backup
[20:33] for the device
[20:34] it will
[20:36] just use a password that's hard-coded
[20:37] right here
[20:39] unfortunately
[20:41] and it appears from a couple of the
[20:43] models i looked at this is across
[20:44] multiple devices using this 803 f5d
[20:47] password
[20:48] and you can just see right here it's
[20:50] just use an open ssl aes 256 chain block
[20:54] cipher and it's
[20:56] just using that password um so just an
[20:58] example right here
[20:59] i go up here and put in 803 f5d
[21:07] open up
[21:09] this file
[21:11] you can see there's our credentials
[21:13] right there
[21:19] so let's get to some other
[21:20] vulnerabilities out there now as well
[21:22] for this device
[21:25] so the only other vulnerability that's
[21:27] out there i found with this that's
[21:29] maybe
[21:31] applicable to this device is
[21:34] a vulnerable light ttp d version um
[21:40] 1.4.35 and it has a known integer
[21:43] overflow directory traversal and
[21:46] that seems to be all there is out there
[21:48] that i could find on this vulnerability
[21:50] there's as i mentioned here there's no
[21:51] impact detected on this device um
[21:54] doesn't mean there isn't anything i just
[21:55] wasn't able to find it at least
[21:57] so that's just all i had for other
[21:59] vulnerabilities
[22:01] so now let's just go over some general
[22:03] reverse engineering findings and
[22:05] information and such i've pulled out
[22:06] from this device
[22:09] so just general findings there was a lot
[22:12] of leftover debugging code and
[22:13] configurations including test
[22:16] credentials and some other things like
[22:17] that um
[22:18] in the firmware i know this is not
[22:21] uncommon but it just seemed to be
[22:23] a lot more prevalent in this device than
[22:26] i've seen in other devices
[22:29] not a huge deal currently
[22:31] but you never know what they might
[22:33] accidentally leave in there or
[22:35] accidentally set as a service that's
[22:37] enabled or something and now that you
[22:39] know
[22:41] those credentials
[22:42] cause a security incident
[22:44] um
[22:46] many similar devices by wavelink utilize
[22:49] the same code or close variations with
[22:51] the same vulnerabilities i went through
[22:53] and did some just quick static analysis
[22:56] and uh
[22:58] you know this manual review of some
[23:00] other firmware out there
[23:01] uh by wavelength um that are similar
[23:04] devices and i saw the same stuff the
[23:07] same issue with authentication the same
[23:10] issue with some um
[23:13] command injection i did see some things
[23:15] in other devices that looked like buffer
[23:17] buffer overflows
[23:19] but
[23:20] i guess we'll see what happens with that
[23:21] i don't want to say for sure it is
[23:23] because you never know
[23:24] um
[23:25] device does use open wrt as a platform
[23:28] to build upon
[23:30] so that's good in my opinion but it's
[23:32] just they kind of drop the ball i guess
[23:33] a little bit with some other development
[23:34] practices
[23:35] it doesn't really appear that there is
[23:37] any sort of security analysis of this
[23:40] device's firmware before it's pushed to
[23:42] production because some of these
[23:43] findings are so
[23:45] uh simple that you think you know the
[23:47] low hanging fruit like they are would
[23:49] have been caught i would assume by
[23:50] security teams
[23:51] um there is an open source community
[23:54] behind open open wrt that appears to be
[23:57] putting together firmware for this
[23:58] device and some other wavelength devices
[24:01] so if somebody does have this device i
[24:03] would recommend they probably go out and
[24:06] uh
[24:07] get that if they're tech savvy and put
[24:09] it on their device it's probably gonna
[24:10] be better than what the vendor currently
[24:13] is supplying i would not recommend this
[24:16] device to anybody currently not because
[24:19] it's uh hardware is bad it seems fine
[24:22] it's just
[24:23] it doesn't seem like the vendor is doing
[24:25] anything to really fix
[24:26] uh
[24:28] these issues there's some other
[24:29] vulnerabilities out there with it when i
[24:31] reported these findings they just kind
[24:33] of ghosted me on it
[24:35] um
[24:37] i don't know what to think about it i
[24:38] just i i just wouldn't recommend it and
[24:40] then lastly there was in the uh
[24:44] user manual which is really odd they put
[24:46] don't update the firmware unless you
[24:49] have a bug that's causing your device to
[24:51] not act properly which is just really
[24:54] bad advice
[24:55] so i'm not sure why that's in there but
[24:57] that's just not
[24:58] something you'd ever hear somebody
[25:00] that's security conscious say you should
[25:02] always update your firmware because of
[25:04] you know vulnerabilities like these so
[25:06] that's that's about it
[25:10] so in summary we went over a little bit
[25:12] about the device the methodology such as
[25:15] static and dynamic analysis that was
[25:17] utilized for analyzing this device
[25:20] uh one over some tools that were used
[25:22] for both static and dynamic analysis of
[25:24] this device went over our zero day
[25:26] findings went over some other
[25:28] vulnerabilities
[25:29] i went over some general reverse
[25:32] engineering information on this device
[25:34] and recommendations about it and then
[25:37] here we are wrapping it up so if you
[25:39] have any questions let me know hope you
[25:40] enjoyed the presentation
