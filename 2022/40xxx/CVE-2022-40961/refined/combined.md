=== Content from bugzilla.mozilla.org_82ff1cb9_20250114_205810.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1784588)
* [XML](/show_bug.cgi?ctype=xml&id=1784588)

Closed
[Bug 1784588](/show_bug.cgi?id=1784588)
(CVE-2022-40961)

Opened 2 years ago
Closed 2 years ago

# stack-buffer-overflow in [@ mozilla::widget::GfxInfo::EnsureInitialized] on startup

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

stack-buffer-overflow in [@ mozilla::widget::GfxInfo::EnsureInitialized] on startup

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Android

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

105 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox-esr102 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) |
| firefox103 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox103&o1=equals&v1=wontfix) |
| firefox104 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox104&o1=equals&v1=wontfix) |
| firefox105 | [+](/buglist.cgi?f1=cf_tracking_firefox105&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr91 |  | wontfix |
| firefox-esr102 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox103 |  | wontfix |
| firefox104 |  | wontfix |
| firefox105 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: tsmith, Assigned: jnicol)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8dd660b6c636b9880700591432e5eb21?d=mm&size=40)  [jnicol](/user_profile?user_id=541747)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a2837b951fa7dc639a2568203478ff0a?d=mm&size=40)  [tsmith](/user_profile?user_id=486634)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

### (Blocks 2 open bugs)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1658818](/show_bug.cgi?id=1658818 "NEW - Startup crash on ASan builds")

[fuzzing-gv](/show_bug.cgi?id=1667131 "NEW - [meta] Fuzzing GeckoView")

Dependency [tree](/showdependencytree.cgi?id=1784588&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1784588)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-bounds, sec-moderate, Whiteboard: [adv-main105+r])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-40961

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main105+r]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Bug 1784588 - Fix SplitDriverVersion when the string has less than 4 numbers. r?aosmond](/attachment.cgi?id=9290301)  [2 years ago](#c4)  [Jamie Nicol [:jnicol]](/user_profile?user_id=541747)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9290301&action=edit) | [Review](/attachment.cgi?id=9290301) |
| --- | --- | --- |
| [advisory.txt](/attachment.cgi?id=9294828)  [2 years ago](#c12)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   302 bytes, text/plain |  | [Details](/attachment.cgi?id=9294828&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1784588#c0)• 2 years ago |
|  | |

This is detected at launch with an ASan build. It seems to be blocking startup.

`ASAN_OPTIONS=strict_string_checks=1` is used to get a good stack.

```
==30983==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7b979fd406f5 at pc 0x7b987f1c169c bp 0x7b979fd40190 sp 0x7b979fd3f950
READ of size 7 at 0x7b979fd406f5 thread T21 (Gecko)
    #0 0x7b987f1c169b in atoi /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_interceptors.cpp:506:3
    #1 0x7b9790c3c14a in mozilla::widget::GfxInfo::EnsureInitialized() /builds/worker/checkouts/gecko/widget/android/GfxInfo.cpp:218:16
    #2 0x7b9790c3df29 in mozilla::widget::GfxInfo::GetFeatureStatusImpl(int, int*, nsTSubstring<char16_t>&, nsTArray<mozilla::widget::GfxDriverInfo> const&, nsTSubstring<char>&, mozilla::widget::OperatingSystem*) /builds/worker/checkouts/gecko/widget/android/GfxInfo.cpp:403:3
    #3 0x7b9790a9a4fb in mozilla::widget::GfxInfoBase::GetFeatureStatus(int, nsTSubstring<char>&, int*) /builds/worker/checkouts/gecko/widget/GfxInfoBase.cpp:829:7
    #4 0x7b9789fc0229 in IsFeatureSupported /builds/worker/checkouts/gecko/gfx/thebes/gfxPlatform.cpp:1122:8
    #5 0x7b9789fc0229 in IsDXInterop2Blocked /builds/worker/checkouts/gecko/gfx/thebes/gfxPlatform.cpp:1130:11
    #6 0x7b9789fc0229 in gfxPlatform::Init() /builds/worker/checkouts/gecko/gfx/thebes/gfxPlatform.cpp:899:35
    #7 0x7b9789fbeb4b in gfxPlatform::GetPlatform() /builds/worker/checkouts/gecko/gfx/thebes/gfxPlatform.cpp:460:5
    #8 0x7b9790c79681 in mozilla::widget::GeckoViewSupport::Open(mozilla::jni::LocalRef<mozilla::jni::TypedObject<_jclass*> > const&, mozilla::jni::Ref<mozilla::java::GeckoSession::Window, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::StringParam const&, mozilla::jni::StringParam const&, bool) /builds/worker/checkouts/gecko/widget/android/nsWindow.cpp:1618:3
    #9 0x7b9790cb45af in Call<true, true, 0UL, 1UL, 2UL, 3UL, 4UL, 5UL, 6UL, 7UL, 8UL> /builds/worker/workspace/obj-build/dist/include/mozilla/jni/Natives.h:1194:5
    #10 0x7b9790cb45af in mozilla::jni::detail::ProxyNativeCall<mozilla::widget::GeckoViewSupport, mozilla::java::GeckoSession::Window, true, true, mozilla::jni::Ref<mozilla::java::GeckoSession::Window, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::StringParam const&, mozilla::jni::StringParam const&, bool>::operator()() /builds/worker/workspace/obj-build/dist/include/mozilla/jni/Natives.h:1281:5
    #11 0x7b9790cb40fc in mozilla::widget::WindowEvent<mozilla::jni::detail::ProxyNativeCall<mozilla::widget::GeckoViewSupport, mozilla::java::GeckoSession::Window, true, true, mozilla::jni::Ref<mozilla::java::GeckoSession::Window, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::Ref<mozilla::jni::Object, _jobject*> const&, mozilla::jni::StringParam const&, mozilla::jni::StringParam const&, bool>, true, mozilla::jni::Ref<mozilla::jni::TypedObject<_jclass*>, _jclass*> const&, mozilla::widget::GeckoViewSupport>::Run() /builds/worker/workspace/obj-build/dist/include/mozilla/widget/WindowEvent.h:48:7
    #12 0x7b9787998e30 in mozilla::RunnableTask::Run() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:538:16
    #13 0x7b978794d89d in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:851:26
    #14 0x7b978794a698 in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:683:15
    #15 0x7b978794aecb in mozilla::TaskController::ProcessPendingMTTask(bool) /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:461:36
    #16 0x7b97879a3961 in operator() /builds/worker/checkouts/gecko/xpcom/threads/TaskController.cpp:187:37
    #17 0x7b97879a3961 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_0>::Run() /builds/worker/workspace/obj-build/dist/include/nsThreadUtils.h:531:5
    #18 0x7b978797362d in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/checkouts/gecko/xpcom/threads/nsThread.cpp:1205:16
    #19 0x7b9787980361 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/checkouts/gecko/xpcom/threads/nsThreadUtils.cpp:465:10
    #20 0x7b9788f21b13 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/checkouts/gecko/ipc/glue/MessagePump.cpp:85:21
    #21 0x7b9788e0c3d2 in RunInternal /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:381:10
    #22 0x7b9788e0c3d2 in RunHandler /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:374:3
    #23 0x7b9788e0c3d2 in MessageLoop::Run() /builds/worker/checkouts/gecko/ipc/chromium/src/base/message_loop.cc:356:3
    #24 0x7b9790b4569a in nsBaseAppShell::Run() /builds/worker/checkouts/gecko/widget/nsBaseAppShell.cpp:150:27
    #25 0x7b9795289952 in nsAppStartup::Run() /builds/worker/checkouts/gecko/toolkit/components/startup/nsAppStartup.cpp:295:30
    #26 0x7b97954ce94c in XREMain::XRE_mainRun() /builds/worker/checkouts/gecko/toolkit/xre/nsAppRunner.cpp:5718:22
    #27 0x7b97954d0056 in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/checkouts/gecko/toolkit/xre/nsAppRunner.cpp:5912:8
    #28 0x7b97954d14a6 in XRE_main(int, char**, mozilla::BootstrapConfig const&) /builds/worker/checkouts/gecko/toolkit/xre/nsAppRunner.cpp:5968:21
    #29 0x7b97954d83c8 in GeckoStart /builds/worker/checkouts/gecko/toolkit/xre/nsAndroidStartup.cpp:54:18
    #30 0x7b979ef7948a in Java_org_mozilla_gecko_mozglue_GeckoLoader_nativeRun /builds/worker/checkouts/gecko/mozglue/android/APKOpen.cpp:386:17
    #31 0x7b97f86b60c7 in art_quick_generic_jni_trampoline adler32.c
    #32 0x7b97f86a7aa8 in NterpCheckCast crtbegin_so.c

Address 0x7b979fd406f5 is located in stack of thread T21 (Gecko) at offset 1365 in frame
    #0 0x7b9790c3a95f in mozilla::widget::GfxInfo::EnsureInitialized() /builds/worker/checkouts/gecko/widget/android/GfxInfo.cpp:178

  This frame has 21 object(s):
    [32, 64) 'dest.i'
    [96, 392) 'ref.tmp' (line 182)
    [464, 480) 'model' (line 186)
    [496, 512) 'ref.tmp6' (line 187)
    [528, 616) 'ref.tmp12' (line 188)
    [656, 672) 'product' (line 191)
    [688, 704) 'ref.tmp15' (line 192)
    [720, 808) 'ref.tmp23' (line 193)
    [848, 864) 'manufacturer' (line 196)
    [880, 896) 'ref.tmp26' (line 198)
    [912, 1000) 'ref.tmp34' (line 199)
    [1040, 1056) 'hardware' (line 206)
    [1072, 1088) 'ref.tmp38' (line 207)
    [1104, 1192) 'ref.tmp46' (line 208)
    [1232, 1248) 'release' (line 211)
    [1264, 1280) 'ref.tmp49' (line 212)
    [1296, 1304) 'ref.tmp50' (line 212)
    [1328, 1333) 'a' (line 215)
    [1360, 1365) 'b' (line 215) <== Memory access at offset 1365 overflows this variable
    [1392, 1397) 'c' (line 215)
    [1424, 1429) 'd' (line 215)
HINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork
      (longjmp and C++ exceptions *are* supported)
Thread T21 (Gecko) created by T0 (AndroidUI) here:
    #0 0x7b987f1bfb6c in pthread_create /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_interceptors.cpp:208:3
    #1 0x7b97f8bc0c42 in art::Thread::CreateNativeThread(_JNIEnv*, _jobject*, unsigned long, bool) (/apex/com.android.art/lib64/libart.so+0x68ec42) (BuildId: 1dfb27162fe62a7ac7a10ea361233369)
    #2 0x921e0a2c9f35647f  (<unknown module>)

SUMMARY: AddressSanitizer: stack-buffer-overflow /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_interceptors.cpp:506:3 in atoi
Shadow bytes around the buggy address:
  0x0f7373fa0080: f8 f2 f2 f2 f2 f2 00 00 f2 f2 f8 f8 f2 f2 f8 f8
  0x0f7373fa0090: f8 f8 f8 f8 f8 f8 f8 f8 f8 f2 f2 f2 f2 f2 00 00
  0x0f7373fa00a0: f2 f2 f8 f8 f2 f2 f8 f8 f8 f8 f8 f8 f8 f8 f8 f8
  0x0f7373fa00b0: f8 f2 f2 f2 f2 f2 00 00 f2 f2 f8 f8 f2 f2 f8 f8
  0x0f7373fa00c0: f8 f8 f8 f8 f8 f8 f8 f8 f8 f2 f2 f2 f2 f2 00 00
=>0x0f7373fa00d0: f2 f2 f8 f8 f2 f2 f8 f2 f2 f2 05 f2 f2 f2[05]f2
  0x0f7373fa00e0: f2 f2 05 f2 f2 f2 05 f3 f3 f3 f3 f3 00 00 00 00
  0x0f7373fa00f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0f7373fa0100: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0f7373fa0110: 00 00 00 00 00 00 00 00 f1 f1 f1 f1 01 f2 f8 f8
  0x0f7373fa0120: f2 f2 f8 f8 f2 f2 f8 f8 f2 f2 f8 f8 f2 f2 f8 f8
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==30983==ABORTING

```

|  | [Bob Hood [:bhood]](/user_profile?user_id=697075) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1784588#c1)• 2 years ago |
|  | |

Jamie, could you please have a quick look? Appears to involve GeckoView/Android.

Severity: -- → S2Flags: needinfo?(jnicol)

|  | [Jamie Nicol [:jnicol]](/user_profile?user_id=541747)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1784588#c2)• 2 years ago |
|  | |

Tyson, do we have any documentation anywhere for how to reproduce this, either locally or on try? Does this occur reliably or intermittently?

Flags: needinfo?(jnicol) → needinfo?(twsmith)

|  | [Jamie Nicol [:jnicol]](/user_profile?user_id=541747)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1784588#c3)• 2 years ago |
|  | |

Okay, this is trivial to reproduce. If `mOsVersion` is for example "7.0", then `SplitDriverVersion` sets `a` and `b` to "7" and "0". But `c` and `d` are left uninitialized, then `atoi` overflows because there is no null-terminator. Whoops.

`SplitDriverVersion` is supposed to be given an input string with 4 "."-separated numbers, which isn't always (usually? ever?) the case here. On a couple devices I can see we get either 1 or 2 numbers. The [docs](https://developer.android.com/reference/android/os/Build.VERSION#RELEASE) say we should make no assumptions about the structure of this value.

We really shouldn't be using this value in this way. It was added in [bug 802827](/show_bug.cgi?id=802827 "RESOLVED WORKSFORME - Crash in nsMediaPluginHost::DestroyDecoder @ libstagefrighthw.so@0xca3 on devices with NVIDIA Tegra/Tegra 3 GPUs") to use for blocklisting. This is so old we might be able to simply remove it. We'd need to check whether anything else uses the OS version to blocklist on, and perhaps switch to SDK level instead. This could introduce regressions though.

For now probably best if we just make `SplitDriverVersion` null terminate the unused output strings.

Flags: needinfo?(twsmith)

|  | [Jamie Nicol [:jnicol]](/user_profile?user_id=541747)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1784588#c4)• 2 years ago |
|  | |

Attached file
[Bug 1784588 - Fix SplitDriverVersion when the string has less than 4 numbers. r?aosmond](attachment.cgi?id=9290301)
— [Details](attachment.cgi?id=9290301&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1784588#a397588_600971)• 2 years ago |

Assignee: nobody → jnicolStatus: NEW → ASSIGNED

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1784588#c5)• 2 years ago |
|  | |

I'll conservatively mark this sec-moderate because it sounds like this happens on startup without any real ability for an attacker to control the data.

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1784588#a399541_406194)• 2 years ago |

[status-firefox103](/buglist.cgi?f1=cf_status_firefox103&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox103&o1=equals&v1=wontfix)
[status-firefox104](/buglist.cgi?f1=cf_status_firefox104&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox104&o1=equals&v1=wontfix)
[status-firefox105](/buglist.cgi?f1=cf_status_firefox105&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)

|  | [Jamie Nicol [:jnicol]](/user_profile?user_id=541747)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1784588#c6)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1784588&comment_id=16036082 "1 revision") |
|  | |

Andrew, does this being sec-moderate mean I can just go ahead and land without sec-approval? That's how I'm reading the docs, but just want to be extra certain.

Flags: needinfo?(continuation)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1784588#c7)• 2 years ago |
|  | |

(In reply to Jamie Nicol [:jnicol] from [comment #6](/show_bug.cgi?id=1784588#c6 "RESOLVED FIXED - stack-buffer-overflow in [@ mozilla::widget::GfxInfo::EnsureInitialized] on startup"))

> Andrew, does this being sec-moderate mean I can just go ahead and land without sec-approval? That's how I'm reading the docs, but just want to be extra certain.

That is correct.

Flags: needinfo?(continuation)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1784588#c8)• 2 years ago |
|  | |

Fix SplitDriverVersion when the string has less than 4 numbers. r=aosmond

<https://hg.mozilla.org/integration/autoland/rev/c51668daa5cad335222a996ae141c974a4aa3f5d>

<https://hg.mozilla.org/mozilla-central/rev/c51668daa5ca>

Group: gfx-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 2 years ago
[status-firefox105](/buglist.cgi?f1=cf_status_firefox105&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 105 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1784588#a591297_75935)• 2 years ago |

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)
[tracking-firefox105](/buglist.cgi?f1=cf_tracking_firefox105&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox105&o1=equals&v1=%2B)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
--- → [105+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=105%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1784588#c9)• 2 years ago |
|  | |

Please nominate this for ESR102 approval when you get a chance.

Flags: needinfo?(jnicol)

|  | [Jamie Nicol [:jnicol]](/user_profile?user_id=541747)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1784588#c10)• 2 years ago |
|  | |

This only affects android, as the other callers of `SplitDriverVersion` pass a string with 4 parts as it expected. Do we do ESR releases for Android?

Flags: needinfo?(jnicol) → needinfo?(ryanvm)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1784588#c11)• 2 years ago |
|  | |

We do not. Thanks for clarifying.

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
[105+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=105%2B) → ---Flags: needinfo?(ryanvm)

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1784588#a1779555_551058)• 2 years ago |

QA Whiteboard: [post-critsmash-triage]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1784588#a2805626_428608)• 2 years ago |

Whiteboard: [adv-main105+r]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1784588#c12)• 2 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9294828)
— [Details](attachment.cgi?id=9294828&action=edit)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1784588#a3250216_428608)• 2 years ago |

Alias: CVE-2022-40961

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1784588#a13581574_1689)• 2 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1784588&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jamie Nicol [:jnicol]](/user_profile?user_id=541747)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_3921f6bb_20250114_205812.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-40

## Security Vulnerabilities fixed in Firefox 105

Announced
September 20, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 105

This advisory was updated December 13, 2022 to add CVE-2022-46880. This fix was included in the original release of Firefox 105, but did not appear in the advisory published at that time.

#### [#CVE-2022-3266: Out of bounds read when decoding H264](#CVE-2022-3266)

Reporter
Willy R. Vasquez at UT Austin
Impact
high
##### Description

An out-of-bounds read can occur when decoding H264 video. This results in a potentially exploitable crash.

##### References

* [Bug 1767360](https://bugzilla.mozilla.org/show_bug.cgi?id=1767360)

#### [#CVE-2022-40959: Bypassing FeaturePolicy restrictions on transient pages](#CVE-2022-40959)

Reporter
Armin Ebert
Impact
high
##### Description

During iframe navigation, certain pages did not have their FeaturePolicy fully initialized leading to a bypass that leaked device permissions into untrusted subdocuments.

##### References

* [Bug 1782211](https://bugzilla.mozilla.org/show_bug.cgi?id=1782211)

#### [#CVE-2022-40960: Data-race when parsing non-UTF-8 URLs in threads](#CVE-2022-40960)

Reporter
Armin Ebert
Impact
high
##### Description

Concurrent use of the URL parser with non-UTF-8 data was not thread-safe. This could lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1787633](https://bugzilla.mozilla.org/show_bug.cgi?id=1787633)

#### [#CVE-2022-46880: Use-after-free in WebGL](#CVE-2022-46880)

Reporter
Atte Kettunen
Impact
high
##### Description

A missing check related to tex units could have led to a use-after-free and potentially exploitable crash.
*Note*: This advisory was added on December 13th, 2022 after we better understood the impact of the issue. The fix was included in the original release of Firefox 105.

##### References

* [Bug 1749292](https://bugzilla.mozilla.org/show_bug.cgi?id=1749292)

#### [#CVE-2022-40958: Bypassing Secure Context restriction for cookies with \_\_Host and \_\_Secure prefix](#CVE-2022-40958)

Reporter
Axel Chong (@Haxatron)
Impact
moderate
##### Description

By injecting a cookie with certain special characters, an attacker on a shared subdomain which is not a secure context could set and thus overwrite cookies from a secure context, leading to session fixation and other attacks.

##### References

* [Bug 1779993](https://bugzilla.mozilla.org/show_bug.cgi?id=1779993)

#### [#CVE-2022-40961: Stack-buffer overflow when initializing Graphics](#CVE-2022-40961)

Reporter
Mozilla Fuzzing Team
Impact
moderate
##### Description

During startup, a graphics driver with an unexpected name could lead to a stack-buffer overflow causing a potentially exploitable crash.
*This issue only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1784588](https://bugzilla.mozilla.org/show_bug.cgi?id=1784588)

#### [#CVE-2022-40956: Content-Security-Policy base-uri bypass](#CVE-2022-40956)

Reporter
Satoki Tsuji
Impact
low
##### Description

When injecting an HTML base element, some requests would ignore the CSP's base-uri settings and accept the injected element's base instead.

##### References

* [Bug 1770094](https://bugzilla.mozilla.org/show_bug.cgi?id=1770094)

#### [#CVE-2022-40957: Incoherent instruction cache when building WASM on ARM64](#CVE-2022-40957)

Reporter
Gary Kwong
Impact
low
##### Description

Inconsistent data in instruction and data cache when creating wasm code could lead to a potentially exploitable crash.
*This bug only affects Firefox on ARM64 platforms.*

##### References

* [Bug 1777604](https://bugzilla.mozilla.org/show_bug.cgi?id=1777604)

#### [#CVE-2022-40962: Memory safety bugs fixed in Firefox 105 and Firefox ESR 102.3](#CVE-2022-40962)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Nika Layzell, Timothy Nikkel, Sebastian Hengst, Andreas Pehrson, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 104 and Firefox ESR 102.2. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 105 and Firefox ESR 102.3](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1776655%2C1777574%2C1784835%2C1785109%2C1786502%2C1789440)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


