=== Content from github.com_e8337edb_20250114_224719.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flief-project%2FLIEF%2Fissues%2F784)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flief-project%2FLIEF%2Fissues%2F784)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=lief-project%2FLIEF)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lief-project](/lief-project)
/
**[LIEF](/lief-project/LIEF)**
Public

* [Notifications](/login?return_to=%2Flief-project%2FLIEF) You must be signed in to change notification settings
* [Fork
  637](/login?return_to=%2Flief-project%2FLIEF)
* [Star
   4.6k](/login?return_to=%2Flief-project%2FLIEF)

* [Code](/lief-project/LIEF)
* [Issues
  78](/lief-project/LIEF/issues)
* [Pull requests
  7](/lief-project/LIEF/pulls)
* [Discussions](/lief-project/LIEF/discussions)
* [Actions](/lief-project/LIEF/actions)
* [Security](/lief-project/LIEF/security)
* [Insights](/lief-project/LIEF/pulse)

Additional navigation options

* [Code](/lief-project/LIEF)
* [Issues](/lief-project/LIEF/issues)
* [Pull requests](/lief-project/LIEF/pulls)
* [Discussions](/lief-project/LIEF/discussions)
* [Actions](/lief-project/LIEF/actions)
* [Security](/lief-project/LIEF/security)
* [Insights](/lief-project/LIEF/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flief-project%2FLIEF%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flief-project%2FLIEF%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# SEGV in LIEF::MachO::SegmentCommand::virtual\_address at MachO/SegmentCommand.cpp:137 #784

Closed

[bladchan](/bladchan) opened this issue
Sep 11, 2022
· 4 comments

Closed

# [SEGV in LIEF::MachO::SegmentCommand::virtual\_address at MachO/SegmentCommand.cpp:137](#top) #784

[bladchan](/bladchan) opened this issue
Sep 11, 2022
· 4 comments

Assignees
[![@romainthomas](https://avatars.githubusercontent.com/u/7450402?s=40&v=4)](/romainthomas)

Labels
[bug](/lief-project/LIEF/labels/bug)
[MachO](/lief-project/LIEF/labels/MachO)
[Parser](/lief-project/LIEF/labels/Parser)

## Comments

[![@bladchan](https://avatars.githubusercontent.com/u/65125420?s=80&u=cecbd93827443279d84b2fd3a20e9c8c022686e7&v=4)](/bladchan)

Copy link

### **[bladchan](/bladchan)** commented [Sep 11, 2022](#issue-1368890771)

| **Describe the bug** A bad macho file which can lead LIEF::MachO::Parser::parse() to segmentation fault. Poc is here : [poc2.zip](https://github.com/lief-project/LIEF/files/9542186/poc2.zip)  **To Reproduce**   1. Build the whole project with **ASAN** 2. Drive program (compile it with **ASAN** too):  ``` // read_mecho.c #include <LIEF/LIEF.hpp>  int main(int argc, char** argv){ 	 	if(argc != 2) return 0;  	try { 	    std::unique_ptr<LIEF::MachO::FatBinary> macho = LIEF::MachO::Parser::parse(argv[1]); 	} catch (const LIEF::exception& err) { 	    std::cerr << err.what() << std::endl; 	}  	return 0; } ```  3. Run Poc:  ``` $ ./read_macho ./poc2.bin ```  **Expected behavior** Parse the Mach-O file without segmentation fault because segmentation fault can cause a Denial of Service (Dos).  **Environment (please complete the following information):**   * System and Version : Ubuntu 20.04 + gcc 9.4.0 * Target format : **Mach-O** * LIEF commit version: [ad81191](https://github.com/lief-project/LIEF/commit/ad811916670e83947560b6f3c45df6e71d3885af)   **Additional context** **ASAN** says:  ``` ubuntu@ubuntu:~/test/LIEF/fuzz$ ./read_macho ./poc2.bin  nlist[0].str_idx seems corrupted (0x00700000) nlist[1].str_idx seems corrupted (0x00015381) ....... Indirect symbol index is out of range (1392508928 vs max sym: 356) Wrong index: 7 Wrong index: 7 Wrong index: 7 Wrong index: 7 Wrong index: 7 Wrong index: 7 Wrong index: 7 Wrong index: 7 Wrong index: 7 AddressSanitizer:DEADLYSIGNAL ================================================================= ==837035==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000058 (pc 0x5653a24eacfd bp 0x7ffdbf694b60 sp 0x7ffdbf6943d0 T0) ==837035==The signal is caused by a READ memory access. ==837035==Hint: address points to the zero page.     #0 0x5653a24eacfc in LIEF::MachO::SegmentCommand::virtual_address() const /home/ubuntu/test/LIEF/src/MachO/SegmentCommand.cpp:137     #1 0x5653a22244b8 in boost::leaf::result<LIEF::ok_t> LIEF::MachO::BinaryParser::parse_dyldinfo_generic_bind<LIEF::MachO::details::MachO32>() /home/ubuntu/test/LIEF/src/MachO/BinaryParser.tcc:1631     #2 0x5653a21f1a79 in boost::leaf::result<LIEF::ok_t> LIEF::MachO::BinaryParser::parse_dyldinfo_binds<LIEF::MachO::details::MachO32>() /home/ubuntu/test/LIEF/src/MachO/BinaryParser.tcc:1357     #3 0x5653a21c1735 in boost::leaf::result<LIEF::ok_t> LIEF::MachO::BinaryParser::parse<LIEF::MachO::details::MachO32>() /home/ubuntu/test/LIEF/src/MachO/BinaryParser.tcc:113     #4 0x5653a21b2348 in LIEF::MachO::BinaryParser::init_and_parse() /home/ubuntu/test/LIEF/src/MachO/BinaryParser.cpp:145     #5 0x5653a21b1ab0 in LIEF::MachO::BinaryParser::parse(std::unique_ptr<LIEF::BinaryStream, std::default_delete<LIEF::BinaryStream> >, unsigned long, LIEF::MachO::ParserConfig const&) /home/ubuntu/test/LIEF/src/MachO/BinaryParser.cpp:125     #6 0x5653a1a3bc01 in LIEF::MachO::Parser::build() /home/ubuntu/test/LIEF/src/MachO/Parser.cpp:174     #7 0x5653a1a38995 in LIEF::MachO::Parser::parse(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, LIEF::MachO::ParserConfig const&) /home/ubuntu/test/LIEF/src/MachO/Parser.cpp:64     #8 0x5653a18a3923 in main /home/ubuntu/test/LIEF/fuzz/read_macho.c:8     #9 0x7f5206270082 in __libc_start_main ../csu/libc-start.c:308     #10 0x5653a18a355d in _start (/home/ubuntu/test/LIEF/fuzz/read_macho+0x33055d)  AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV /home/ubuntu/test/LIEF/src/MachO/SegmentCommand.cpp:137 in LIEF::MachO::SegmentCommand::virtual_address() const ==837035==ABORTING  ```  Hope that helps! |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@bladchan](https://avatars.githubusercontent.com/u/65125420?s=40&u=cecbd93827443279d84b2fd3a20e9c8c022686e7&v=4)](/bladchan)
[bladchan](/bladchan)
assigned [romainthomas](/romainthomas)
[Sep 11, 2022](#event-7362152762)

[![@romainthomas](https://avatars.githubusercontent.com/u/7450402?s=40&u=61858821a02e266ae3a59efa25579565c3e2f63b&v=4)](/romainthomas)
[romainthomas](/romainthomas)
added
[MachO](/lief-project/LIEF/labels/MachO)
[bug](/lief-project/LIEF/labels/bug)
[Parser](/lief-project/LIEF/labels/Parser)
labels
[Sep 11, 2022](#event-7362503070)

[![@bladchan](https://avatars.githubusercontent.com/u/65125420?s=80&u=cecbd93827443279d84b2fd3a20e9c8c022686e7&v=4)](/bladchan)

Copy link

Author

### **[bladchan](/bladchan)** commented [Sep 11, 2022](#issuecomment-1242985493)

| There is another bad macho file which can lead LIEF::MachO::Parser::parse() to segmentation fault. Maybe it is the same reason which caused segmentation fault in MachO/SegmentCommand.cpp, so I report it under this issue.  Poc here : [poc3.zip](https://github.com/lief-project/LIEF/files/9542845/poc3.zip)  ASAN says:  ``` ubuntu@ubuntu:~/test/LIEF/fuzz$ ./read_macho poc3.bin Segment __TEXT: content corrupted! Unknown architecture Command 'Out of range' not parsed! Can't read the raw data of the load command AddressSanitizer:DEADLYSIGNAL ================================================================= ==428943==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000068 (pc 0x557a1c3e0e70 bp 0x0fffa48dad9a sp 0x7ffd246d6c80 T0) ==428943==The signal is caused by a READ memory access. ==428943==Hint: address points to the zero page.     #0 0x557a1c3e0e6f in LIEF::MachO::SegmentCommand::file_offset() const /home/ubuntu/test/LIEF/src/MachO/SegmentCommand.cpp:149     #1 0x557a1bfa05d9 in LIEF::MachO::Binary::segment_from_offset(unsigned long) const /home/ubuntu/test/LIEF/src/MachO/Binary.cpp:545     #2 0x557a1bfa0c28 in LIEF::MachO::Binary::segment_from_offset(unsigned long) /home/ubuntu/test/LIEF/src/MachO/Binary.cpp:573     #3 0x557a1c0ee530 in boost::leaf::result<LIEF::ok_t> LIEF::MachO::BinaryParser::post_process<LIEF::MachO::details::MachO32>(LIEF::MachO::CodeSignature&) /home/ubuntu/test/LIEF/src/MachO/BinaryParser.tcc:3397     #4 0x557a1c0b8646 in boost::leaf::result<LIEF::ok_t> LIEF::MachO::BinaryParser::parse<LIEF::MachO::details::MachO32>() /home/ubuntu/test/LIEF/src/MachO/BinaryParser.tcc:168     #5 0x557a1c0a8348 in LIEF::MachO::BinaryParser::init_and_parse() /home/ubuntu/test/LIEF/src/MachO/BinaryParser.cpp:145     #6 0x557a1c0a7ab0 in LIEF::MachO::BinaryParser::parse(std::unique_ptr<LIEF::BinaryStream, std::default_delete<LIEF::BinaryStream> >, unsigned long, LIEF::MachO::ParserConfig const&) /home/ubuntu/test/LIEF/src/MachO/BinaryParser.cpp:125     #7 0x557a1b931c01 in LIEF::MachO::Parser::build() /home/ubuntu/test/LIEF/src/MachO/Parser.cpp:174     #8 0x557a1b92e995 in LIEF::MachO::Parser::parse(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, LIEF::MachO::ParserConfig const&) /home/ubuntu/test/LIEF/src/MachO/Parser.cpp:64     #9 0x557a1b799923 in main /home/ubuntu/test/LIEF/fuzz/read_macho.c:8     #10 0x7fac58975082 in __libc_start_main ../csu/libc-start.c:308     #11 0x557a1b79955d in _start (/home/ubuntu/test/LIEF/fuzz/read_macho+0x33055d)  AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV /home/ubuntu/test/LIEF/src/MachO/SegmentCommand.cpp:149 in LIEF::MachO::SegmentCommand::file_offset() const ==428943==ABORTING  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@romainthomas](https://avatars.githubusercontent.com/u/7450402?s=80&u=61858821a02e266ae3a59efa25579565c3e2f63b&v=4)](/romainthomas)

Copy link

Member

### **[romainthomas](/romainthomas)** commented [Sep 11, 2022](#issuecomment-1243006919)

| Thank you very much [@bladchan](https://github.com/bladchan) for these issues. I'm looking at them |
| --- |

All reactions

Sorry, something went wrong.

[![@romainthomas](https://avatars.githubusercontent.com/u/7450402?s=40&u=61858821a02e266ae3a59efa25579565c3e2f63b&v=4)](/romainthomas)
[romainthomas](/romainthomas)
closed this as [completed](/lief-project/LIEF/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[24935f6](/lief-project/LIEF/commit/24935f654f6df700a9a062298258b9485f584502)`
[Sep 12, 2022](#event-7365337693)

[![@rusNaN12](https://avatars.githubusercontent.com/u/7488691?s=80&u=39bf3ea34979ba6044796aa1872c006cf75df3b7&v=4)](/rusNaN12)

Copy link

### **[rusNaN12](/rusNaN12)** commented [Oct 20, 2022](#issuecomment-1285357529)

| Do we have a release version for this fix? |
| --- |

All reactions

Sorry, something went wrong.

[![@romainthomas](https://avatars.githubusercontent.com/u/7450402?s=80&u=61858821a02e266ae3a59efa25579565c3e2f63b&v=4)](/romainthomas)

Copy link

Member

### **[romainthomas](/romainthomas)** commented [Oct 21, 2022](#issuecomment-1286542419)

| I plan to release a patch version for LIEF (`0.12.3`) along with the release of Python 3.11 |
| --- |

All reactions

Sorry, something went wrong.

[romainthomas](/romainthomas)
added a commit
that referenced
this issue
[Nov 1, 2022](#ref-commit-ddc77e2)
[![@romainthomas](https://avatars.githubusercontent.com/u/7450402?s=40&u=61858821a02e266ae3a59efa25579565c3e2f63b&v=4)](/romainthomas)

`[Fix](/lief-project/LIEF/commit/ddc77e25e9ff0efd514017203e7ece52c8b60256 "Fix #784") [#784](https://github.com/lief-project/LIEF/issues/784)`

`[ddc77e2](/lief-project/LIEF/commit/ddc77e25e9ff0efd514017203e7ece52c8b60256)`

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flief-project%2FLIEF%2Fissues%2F784)

Assignees

[![@romainthomas](https://avatars.githubusercontent.com/u/7450402?s=40&v=4)](/romainthomas) [romainthomas](/romainthomas)

Labels

[bug](/lief-project/LIEF/labels/bug)
[MachO](/lief-project/LIEF/labels/MachO)
[Parser](/lief-project/LIEF/labels/Parser)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

3 participants

[![@romainthomas](https://avatars.githubusercontent.com/u/7450402?s=52&v=4)](/romainthomas) [![@rusNaN12](https://avatars.githubusercontent.com/u/7488691?s=52&v=4)](/rusNaN12) [![@bladchan](https://avatars.githubusercontent.com/u/65125420?s=52&v=4)](/bladchan)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


