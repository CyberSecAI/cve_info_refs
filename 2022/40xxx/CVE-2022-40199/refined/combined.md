=== Content from jvn.jp_3a776299_20250115_095507.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2022/09/15  Last Updated:2022/09/20
# JVN#21213852 Multiple vulnerabilities in EC-CUBE

## Overview

EC-CUBE provided by EC-CUBE CO.,LTD. contains multiple vulnerabilities.

## Products Affected

**CVE-2022-40199**

* EC-CUBE 3.0.0 to 3.0.18-p4 (EC-CUBE 3 series)
* EC-CUBE 4.0.0 to 4.1.2 (EC-CUBE 4 series)

**CVE-2022-38975**

* EC-CUBE 4.0.0 to 4.1.2 (EC-CUBE 4 series)

## Description

EC-CUBE provided by EC-CUBE CO.,LTD. contains multiple vulnerabilities listed below.

* **Directory traversal vulnerability ([CWE-22](http://cwe.mitre.org/data/definitions/22.html))** - CVE-2022-40199

  | CVSS v3 | CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:U/C:L/I:N/A:N | **Base Score: 2.7** |
  | --- | --- | --- |
  | CVSS v2 | AV:N/AC:L/Au:S/C:P/I:N/A:N | **Base Score: 4.0** |
* **DOM-based cross-site scripting vulnerability ([CWE-79](https://cwe.mitre.org/data/definitions/79.html))** - CVE-2022-38975

  | CVSS v3 | CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N | **Base Score: 6.1** |
  | --- | --- | --- |
  | CVSS v2 | AV:N/AC:H/Au:N/C:N/I:P/A:N | **Base Score: 2.6** |

## Impact

* A remote attacker who can log in to the product may obtain the product's directory structure information - CVE-2022-40199
* If a remote attacker leads an administrator of the product to a specially crafted page and to perform a specific operation, an arbitrary script may be executed on the administrator's web browser - CVE-2022-38975

## Solution

**Update the software**

An update is available for EC-CUBE 4 series.

Update to the latest version according to the information provided by the developer.

For EC-CUBE 3 series, there is no update but a patch is available.

**Apply the patch**

Patches are available for both EC-CUBE 3 and EC-CUBE 4 series.

For more information, refer to the information provided by the developer.

## Vendor Status

| Vendor | Status | Last Update | Vendor Notes |
| --- | --- | --- | --- |
| EC-CUBE CO.,LTD. | [Vulnerable](491122/index.html) | 2022/09/20 | [EC-CUBE CO.,LTD. website](https://www.ec-cube.net/info/weakness/20220909/) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

## Credit

Noriaki Iwasaki of Cyber Defense Institute, Inc. reported these vulnerabilities to EC-CUBE CO.,LTD. and EC-CUBE CO.,LTD. reported them to JPCERT/CC to notify users of the solutions through JVN.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2022-38975](https://www.cve.org/CVERecord?id=CVE-2022-38975) |
|  | [CVE-2022-40199](https://www.cve.org/CVERecord?id=CVE-2022-40199) |
| JVN iPedia | [JVNDB-2022-000073](https://jvndb.jvn.jp/jvndb/JVNDB-2022-000073) |

## Update History

2022/09/20
Information under the section [Credit] was updated.
2022/09/20
EC-CUBE CO.,LTD. update status

* JVN
* [HOME](/en/index.html)
* [What is JVN ?](/en/nav/jvn.html)
* [Instructions](/en/nav/jvnhelp.html)
* [List of Vulnerability Report](/en/report/index.html)
* [VN\_JP](/en/jp/index.html)
* [VN\_JP(Unreachable)](/en/adj/index.html)
* [VN\_VU](/en/vu/index.html)
* [TA](/en/ta/index.html)
* [TRnotes](/en/tr/index.html)
* [JVN iPedia](http://jvndb.jvn.jp/en/)
* [MyJVN](http://jvndb.jvn.jp/en/apis/myjvn/index.html)
* [JVNJS/RSS](/en/rss/index.html)
* [Vendor List](/en/nav/index.html)
* [List of unreachable developers](/en/reply/index.html)
* [Contact](/en/contact/index.html)

Copyright (c) 2000-2022 JPCERT/CC and IPA. All rights reserved.



=== Content from www.ec-cube.net_4547ba65_20250115_095508.html ===

# EC-CUBEにおけるディレクトリトラバーサルの脆弱性(JVN#21213852)

##### 更新履歴

2022/09/15 16:50
JVNからの公表内容情報へのリンクを追加

2022/09/09 10:00
初版公開

## EC-CUBEにおけるディレクトリトラバーサルの脆弱性

EC-CUBE 3系、4.0系、4.1系にEC-CUBEにおけるディレクトリトラバーサルの脆弱性(危険度: 低)があることが判明いたしました。

脆弱性そのものは、修正の反映によりすぐに解決するものです。

以下のいずれかの方法により、ご対応をお願いいたします。

* 修正ファイルを適用する
* 修正差分を確認して適用する

皆様にはお手数おかけし誠に申し訳ございません。

本脆弱性における被害報告は現時点でございませんが、できるだけ速やかにご対応をお願いいたします。

## 脆弱性の概要

### EC-CUBEにおけるディレクトリトラバーサルの脆弱性

#### 危険度:

低

#### 不具合が存在するEC-CUBEのバージョン:

* **4.0.0〜4.1.2**
* **3.0.0〜3.0.18-p4**

#### 詳細:

EC-CUBEにはディレクトリトラバーサル脆弱性が存在します。攻撃者は当該脆弱性を悪用して、レスポンスの差異からディレクトリの存在有無を確認することが可能です。

---

### JVNからの公表内容 (2022/09/15公開)

[JVN#21213852: EC-CUBE における複数の脆弱性](https://jvn.jp/jp/JVN21213852/)

## 修正方法1: 修正ファイルを利用する場合

開発環境がある場合は、まず開発環境でお試しください。

以下の手順に従って、修正ファイルの反映をお願いいたします。

1. 修正ファイルのダウンロード

   ご利用中のEC-CUBEのバージョンに該当する修正ファイルをダウンロードしてください。

   ※EC-CUBEのバージョンは[こちらの手順](https://www.ec-cube.net/info/security/#securit_flow01)でご確認ください。

   ※修正ファイルは各バージョンの最新版に対して作成しています。旧バージョンをご利用の場合は、「修正方法2」のご対応をお願いします。

   * **[修正ファイル(4.0.6-p1用)](./traversal_v40.zip)**
     (SHA256:6f765843b4fe4903c0ede49bec1cc26966e414b02f50e76c645a3fa48cfcc531)
   * **[修正ファイル(4.1.2用)](./traversal_v41.zip)**
     (SHA256:19c207f40a025e3b483b84a32d32a498b50c12fd89fc4dea6b6d8d2bd2b38603)
   * **[修正ファイル(3.0.18-p4用)](./traversal_v30.zip)**
     (SHA256:8244f7d7481701c80fc3f82f3d57f9201559725a6686d8073eeeacf0fd32043d)

   ダウンロードし、解凍していただきますと、以下の修正ファイルがあります。必ず該当するバージョンのファイルをご利用ください。

   * src/Eccube/Controller/Admin/Content/FileController.php
   * src/Eccube/Controller/Admin/Setting/Shop/PaymentController.php
   * src/Eccube/Form/Type/Admin/ProductType.php
2. EC-CUBEファイルのバックアップ

   あらかじめEC-CUBEファイル全体のバックアップを行ってください。

   ※作業中はメンテナンスモードに切り替えることをおすすめします。
3. 修正ファイルの反映

   以下のファイルを上書き更新してください。

   上書きするファイル

   * src/Eccube/Controller/Admin/Content/FileController.php
   * src/Eccube/Controller/Admin/Setting/Shop/PaymentController.php
   * src/Eccube/Form/Type/Admin/ProductType.php
   ※EC-CUBE本体のカスタマイズをしている場合、修正箇所の差分をご確認のうえ反映をお願いします。

   ※開発環境がある場合は、開発環境での反映・動作確認を行った後に、本番環境への反映をおすすめします。
4. 動作確認

   管理画面にログインし、基本操作が正常に行えることをご確認ください。

   ※メンテナンスモードにされていた場合は解除をお願いします。

## 修正方法2-1: 修正差分を確認して適宜反映する場合(4.0系)

以下のコード差分情報を参照して頂き、必要な箇所に修正を反映してください。

本修正方法はEC-CUBE 4.0.6-p1のバージョンを例として提示しております。

過去バージョンをご利用の場合は、下記修正対象ファイルの修正差分を参考にご対応お願いいたします。
### 修正差分

Files changed (3)
hide
show

1. [src/Eccube/Controller/Admin/Content/FileController.php](#d2h-649562)
   +3
   -0
2. [src/Eccube/Controller/Admin/Setting/Shop/PaymentController.php](#d2h-429428)
   +1
   -1
3. [src/Eccube/Form/Type/Admin/ProductType.php](#d2h-145320)
   +4
   -0

 src/Eccube/Controller/Admin/Content/FileController.php
CHANGED

Viewed

|  | @@ -448,6 +448,9 @@ class FileController extends AbstractController |
| --- | --- |
| 448 448 | \*/ |
| 449 449 | protected function checkDir($targetDir, $topDir) |
| 450 450 | { |
| 451 | +  if (strpos($targetDir, '..') !== false) { |
| 452 | +  return false; |
| 453 | +  } |
| 451 454 | $targetDir = realpath($targetDir); |
| 452 455 | $topDir = realpath($topDir); |
| 453 456 |  |

 src/Eccube/Controller/Admin/Setting/Shop/PaymentController.php
CHANGED

Viewed

|  | @@ -122,7 +122,7 @@ class PaymentController extends AbstractController |
| --- | --- |
| 122 122 | // ファイルアップロード |
| 123 123 | $file = $form['payment\_image']->getData(); |
| 124 124 | $fs = new Filesystem(); |
| 125 | -  if ($file && $fs->exists($this->getParameter('eccube\_temp\_image\_dir').'/'.$file)) { |
| 125 | +  if ($file && strpos($file, '..') === false && $fs->exists($this->getParameter('eccube\_temp\_image\_dir').'/'.$file)) { |
| 126 126 | $fs->rename( |
| 127 127 | $this->getParameter('eccube\_temp\_image\_dir').'/'.$file, |
| 128 128 | $this->getParameter('eccube\_save\_image\_dir').'/'.$file |

 src/Eccube/Form/Type/Admin/ProductType.php
CHANGED

Viewed

|  | @@ -200,6 +200,10 @@ class ProductType extends AbstractType |
| --- | --- |
| 200 200 | private function validateFilePath($form, $dirs) |
| 201 201 | { |
| 202 202 | foreach ($form->getData() as $fileName) { |
| 203 | +  if (strpos($fileName, '..') !== false) { |
| 204 | +  $form->getRoot()['product\_image']->addError(new FormError(trans('admin.product.image\_\_invalid\_path'))); |
| 205 | +  break; |
| 206 | +  } |
| 203 207 | $fileInDir = array\_filter($dirs, function ($dir) use ($fileName) { |
| 204 208 | $filePath = realpath($dir.'/'.$fileName); |
| 205 209 | $topDirPath = realpath($dir); |


