=== Content from www.bookstackapp.com_a96eb0b5_20250114_224413.html ===

[BookStack](https://www.bookstackapp.com/)

Platform
[Features

An overview of the core features of BookStack](/#features)
[Demo

Give BookStack a test drive on our demo instance](/#demo)
[Documentation

Guidance for managing and using BookStack](/docs)
[Our Blog

Get the latest project news from our blog](/blog)
[Hacks

Unsupported hacks that can be applied](/hacks)

[Support](/support)
[Documentation

Get support from our user and admin documentation](/docs)
[Support Plans

See our range of support plans for BookStack](/support)
[Donate

Provide financial support to the project](/donate)
[Videos on PeerTube

Find our video guides on the fediverse.](https://foss.video/c/bookstack/)
[Guides on YouTube

Watch our video guides on YouTube](https://www.youtube.com/c/BookStackApp)
[GitHub Issues

Find or report issues on the GitHub project](https://github.com/BookStackApp/BookStack/issues)

Community
[GitHub

Star the project on GitHub and follow us](https://github.com/BookStackApp/BookStack)
[Codeberg

Watch development and get involved](https://codeberg.org/bookstack/)
[Discord

Chat with the development team and other users](https://discord.gg/ztkBqR2)
[Mastodon

Follow the project on Mastodon](https://fosstodon.org/%40bookstack)
[YouTube

Watch and comment on our YouTube videos](https://www.youtube.com/c/BookStackApp)
[Reddit

Join our community on the BookStack subreddit](https://www.reddit.com/r/bookstack)
[Our Blog

Keep up with the latest developments via our blog](/blog)

Admin Documentation

* [All Documentation](/docs)

#### Setup

* [Installation](/docs/admin/installation)
* [Security](/docs/admin/security)
* [Subdirectory Setup](/docs/admin/subdirectory-setup)
* [Multiple Instances](/docs/admin/multi-instance)
* [Content Storage Format](/docs/admin/content-storage)

#### Maintenance

* [Updates](/docs/admin/updates)
* [Commands](/docs/admin/commands)
* [Backup & Restore](/docs/admin/backup-restore)
* [Debugging](/docs/admin/debugging)
* [System CLI](/docs/admin/system-cli)
* [Filesystem Permissions](/docs/admin/filesystem-permissions)

#### Authentication

* [OpenID Connect](/docs/admin/oidc-auth)
* [SAML 2.0](/docs/admin/saml2-auth)
* [LDAP](/docs/admin/ldap-auth)
* [Third Party & Social](/docs/admin/social-auth)

#### Configuration

* [Email & Webhooks](/docs/admin/email-webhooks)
* [Visual Customisation](/docs/admin/visual-customisation)
* [Language & Locale](/docs/admin/language-config)
* [File Uploads](/docs/admin/upload-config)
* [Caching & Sessions](/docs/admin/cache-session-config)

* [PDF Rendering](/docs/admin/pdf-rendering)
* [UTF8mb4/Emoji Support](/docs/admin/ut8mb4-support)
* [Hacking BookStack](/docs/admin/hacking-bookstack)
* [Other Configuration](/docs/admin/other-config)

* [« All Documentation](/docs)

# Security

Since BookStack can hold important information for users you should be aware of any potential security concerns.
Read through the below to ensure you have secured your BookStack instance. Note, The below only
relates to BookStack itself. The security of the server BookStack is hosted on is not instructed below but should be taken into account.

If you’d like to be notified of new potential security concerns you can sign-up to the [BookStack security mailing list](https://updates.bookstackapp.com/signup/bookstack-security-updates). For reporting security vulnerabilities, please see the [“Security” section](https://github.com/BookStackApp/BookStack/blob/development/readme.md#-security) of the project readme on GitHub.

* [Initial Security Setup](#initial-security-setup)
* [Multi-Factor Authentication](#multi-factor-authentication)
* [Securing Images](#securing-images)
* [Attachments](#attachments)
* [Filesystem Permissions](#filesystem-permissions)
* [User Passwords](#user-passwords)
* [JavaScript in Page Content](#javascript-in-page-content)
* [Web Crawler Control](#web-crawler-control)
* [Secure Cookies](#secure-cookies)
* [Host Iframe Control](#host-iframe-control)
* [Iframe Source Control](#iframe-source-control)
* [Failed Access Logging](#failed-access-logging)
* [Untrusted Server Side Requests](#untrusted-server-side-requests)
* [Server Side Request Allow List](#server-side-request-allow-list)
* [Content Security Policy (CSP)](#content-security-policy-csp)
* [MySQL SSL Connection](#mysql-ssl-connection)
* [Using BookStack Content Externally](#using-bookstack-content-externally)

---

### Initial Security Setup

1. Ensure you change the password and email address for the initial `admin@admin.com` user.
2. Ensure only the `public` folder is being served by your webserver. Serving files above this folder
   opens up a lot of code that does not need to be public. Triple check this if you have installed
   BookStack within the commonly used `/var/www` folder.
3. Ensure the database user you’ve used for BookStack has limited permissions for only accessing
   the database used for BookStack data.
4. Check that you’ve set the `APP_URL` option in your `.env` file so that system generated URLs cannot be manipulated.
5. Within BookStack, go through the settings to ensure registration and public access settings are as you expect.
6. Review the user roles in the settings area.
7. Read the below to further understand the security for specific functionality and features.

---

### Multi-Factor Authentication

Any user can enable multi-factor authentication (MFA) on their account. Upon login they would then need to use an extra proof of identity
to gain access. BookStack currently supports the following mechanisms:

* TOTP (Time-based One-Time Passwords)
  + Labelled as “Mobile App” (Google/Microsoft Authenticator etc…).
  + Uses a SHA1 algorithm internally (Greater algorithms have poor cross-app compatibility).
* Backup Codes
  + These are a list of 16 one-time-use codes.
  + Users will be warned once they have less than 5 codes remaining.

Secrets and values for these options are stored encrypted within the database.

Where required, MFA can be forced upon users via their roles. This can be found via
a “Requires Multi-Factor Authentication” checkbox seen when editing a role.
If a user does not already have an MFA method configured, they will be forced to set one up
upon next login.

---

### Securing Images

By default, Images are stored in a way which is publicly accessible which ensures performance while using BookStack.
Listed below are a few options for increasing image security.

#### Alternative Storage Options

Review our [file upload storage options](/docs/admin/upload-config/#storage-options) documentation for image storage options that add addition access or permission control
to image requests.

#### Complex Urls

In the settings area of BookStack you can find the option ‘Enable higher security image uploads?’. Enabling this will add a 16 character
random string to the name of image files to prevent easy guessing of URLs. This increases security without potential performance concerns.

#### Prevent Directory Indexes

It’s important to ensure you disable ‘directory indexes’ to prevent unknown users from being able to navigate their way through your images. Here’s the configuration for NGINX & Apache if your server allows directory indexes:

**NGINX**

| ``` [1](#hl-0-1) [2](#hl-0-2) [3](#hl-0-3) [4](#hl-0-4) [5](#hl-0-5)  ``` | ``` # By default indexes are disabled on Nginx but if you have them enabled # add this to your BookStack server block location /uploads {        autoindex off; }  ``` |
| --- | --- |

**Apache**

| ``` [1](#hl-1-1) [2](#hl-1-2) [3](#hl-1-3) [4](#hl-1-4) [5](#hl-1-5)  ``` | ``` # Add this to your Apache BookStack virtual host if Indexes are enabled. # If .htaccess file are enabled then the below should already be active. <Location "/uploads">     Options -Indexes </Location>  ``` |
| --- | --- |

You can test that indexes are disabled by attempting to navigate to
`<your_bookstack_url>/uploads/images` in the browser after having uploaded at least one image.
You should not see a list of files but instead a BookStack “Not Found” page.

---

### Attachments

Attachments, if not using Amazon S3, are stored in the `storage/uploads` directory.
By default, unlike images, these are stored behind the application authentication layer so access
depends on permissions you have set up at a role level and page level.

If you are using Amazon S3 for file storage then access will depend on your S3 permission
settings. Unlike images, BookStack will not automatically attempt to make uploaded attachments
publicly accessible.

---

### Filesystem Permissions

It’s usually a good idea to limit the file and folder access privileges for the user/group used to run the application PHP, which is typically the user/group for PHP or the running web-server processes. Limiting permissions can help avoid a range of potential vulnerability exploits.

Details on required [filesystem permissions can be found here](/docs/admin/filesystem-permissions/).

---

### User Passwords

User passwords, if not using an alternative authentication method, are stored in the database.
These are hashed using the standard Laravel hashing methods which use the Bcrypt hashing algorithm.

---

### JavaScript in Page Content

By default, JavaScript tags within page content is escaped when rendered. This can be turned off by setting `ALLOW_CONTENT_SCRIPTS=true` in your `.env` file. Note that even if you disable this escaping the WYSIWYG editor may still perform its own JavaScript escaping. This option will also alter the [CSP rules](#content-security-policy-csp) set by BookStack.

***This option disables some fundamental cross-site-scripting protections. Only use this option on secure instances, where only very trusted users can edit content***

---

### Web Crawler Control

The rules found in the `/robots.txt` file are automatically controlled via the “Allow public viewing?” setting. This can be overridden by setting `ALLOW_ROBOTS=false` or `ALLOW_ROBOTS=true` in your `.env` file. If you’d like to customise the rules this can be done via theme overrides.

---

### Secure Cookies

BookStack uses cookies to track sessions, remember logins and for XSRF protection. When using HTTPS you may want to ensure that cookies are only sent back to the browser if the connection is over HTTPS. If you have set a https `APP_URL` option in your `.env` this will enabled automatically but it can also be forced on by setting `SESSION_SECURE_COOKIE=true` in your `.env` file.

---

### Host Iframe Control

By default BookStack will only allow itself to be embedded within iframes on the same domain as you’re hosting on. This is done through a [CSP: frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors) header. You can add additional trusted hosts by setting a `ALLOWED_IFRAME_HOSTS` option in your `.env` file like the example below:

| ``` [1](#hl-2-1) [2](#hl-2-2) [3](#hl-2-3) [4](#hl-2-4) [5](#hl-2-5)  ``` | ``` # Adding a single host ALLOWED_IFRAME_HOSTS="https://example.com" # Multiple hosts can be separated with a space ALLOWED_IFRAME_HOSTS="https://a.example.com https://b.example.com"  ``` |
| --- | --- |

Note: when this option is used, all cookies will served with `SameSite=None` [(info)](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite#None) set so that
a user session can persist within the iframe.

---

### Iframe Source Control

By default BookStack will only allow certain other hosts to be used as `src` values for embedded iframe/frame content within the application. This is done through a [CSP: frame-src](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-src) header. You can configure the list of trusted sources by setting a `ALLOWED_IFRAME_SOURCES` option in your `.env` file like the examples below:

| ``` [1](#hl-3-1) [2](#hl-3-2) [3](#hl-3-3) [4](#hl-3-4) [5](#hl-3-5) [6](#hl-3-6) [7](#hl-3-7) [8](#hl-3-8) [9](#hl-3-9)  ``` | ``` # Adding a single host ALLOWED_IFRAME_SOURCES="https://example.com" # Multiple hosts can be separated with a space ALLOWED_IFRAME_SOURCES="https://a.example.com https://b.example.com" # Allow all sources # This opens vulnerability risk and should only be done in secure & trusted environments. ALLOWED_IFRAME_SOURCES="*"  ``` |
| --- | --- |

By default this option is configured as follows:

| ``` [1](#hl-4-1)  ``` | ``` ALLOWED_IFRAME_SOURCES="https://*.draw.io https://*.youtube.com https://*.youtube-nocookie.com https://*.vimeo.com"  ``` |
| --- | --- |

Note: The source of ‘self’ will always be automatically added to this CSP rule. In addition, the host used for the diagrams.net integration (If enabled) will be automatically appended to the lists of hosts.

---

### Failed Access Logging

An option is available to log failed login events to a log file which is useful to identify users having trouble logging in, track malicious login attempts or to use with tools such as Fail2Ban. This works with login attempts using the default email & password login mechanism or attempts via LDAP login. Failed attempts are **not logged** for “one-click” social or SAML2 options.

To enable this you simply need to define the `LOG_FAILED_LOGIN_MESSAGE` option in your `.env` file like so:

| ``` [1](#hl-5-1)  ``` | ``` LOG_FAILED_LOGIN_MESSAGE="Failed login for %u"  ``` |
| --- | --- |

The optional “%u” element of the message will be replaced with the username or email provided in the login attempt
when the message is logged. By default messages will be logged via the php `error_log` function which, in most
cases, will log to your webserver error log files.

---

### Untrusted Server Side Requests

Some features, such as the PDF exporting, have the option to make http calls to external user-defined locations to do things
such as load images or styles. This is disabled by default but can be enabled if desired. This is required for using
WKHTMLtoPDF as your PDF export renderer.
This should only be enabled in BookStack environments where BookStack users and viewers are fully trusted.

To enable untrusted server side requests, you need to define the `ALLOW_UNTRUSTED_SERVER_FETCHING` option in your `.env` file like so:

| ``` [1](#hl-6-1)  ``` | ``` ALLOW_UNTRUSTED_SERVER_FETCHING=true  ``` |
| --- | --- |

Note that this is not connected to the `ALLOWED_SSR_HOSTS` setting at all.
`ALLOW_UNTRUSTED_SERVER_FETCHING` is used for typically “untrusted” scenarios/functionality
whereas `ALLOWED_SSR_HOSTS` is used for typically “trusted” user scenarios/functionality
(where admin-level permissions are required).

---

### Server Side Request Allow List

There is some functionality in BookStack, like webhooks for example, that is typically only
accessible by trusted (admin-level) users.
In some cases, those admin users may not be trusted to the level where they can freely make server
side requests. In such scenarios, you can define a `ALLOWED_SSR_HOSTS` option in your `.env` file
to limit the hosts that can be called for such typically trusted functionality:

| ```  [1](#hl-7-1)  [2](#hl-7-2)  [3](#hl-7-3)  [4](#hl-7-4)  [5](#hl-7-5)  [6](#hl-7-6)  [7](#hl-7-7)  [8](#hl-7-8)  [9](#hl-7-9) [10](#hl-7-10) [11](#hl-7-11)  ``` | ``` # Allow all hosts (Default) ALLOWED_SSR_HOSTS="*" # Allow a single host ALLOWED_SSR_HOSTS="https://example.com" # Allow multiple hosts via space-separated entries ALLOWED_SSR_HOSTS="https://example.com https://example.org" # Use '*' as wildcards and/or define required paths ALLOWED_SSR_HOSTS="https://*.example.com https://example.org/bookstack/"  ``` |
| --- | --- |

Values will be compared prefix-matched, case-insensitive, against called SSR urls.

Note that this is not connected to the `ALLOW_UNTRUSTED_SERVER_FETCHING` setting at all.
`ALLOW_UNTRUSTED_SERVER_FETCHING` is used for typically “untrusted” scenarios/functionality
whereas `ALLOWED_SSR_HOSTS` is used for typically “trusted” user scenarios/functionality
(where admin-level permissions are required).

---

### Content Security Policy (CSP)

BookStack serves responses with a CSP header to increase protection again malicious content.
This is especially important in a system such as BookStack where users can create a variety of HTML content,
especially so if you allow untrusted users to create content in your instance.
The CSP rules set by BookStack are as follows:

* `frame-ancestors 'self'`
  + Restricts what websites can embed BookStack pages via iframes.
  + See the “[Host Iframe Control](#iframe-control)” section above for details on expanding this rule to other hosts.
* `frame-source 'self' https://*.diagrams.net https://*.draw.io https://*.youtube.com https://*.youtube-nocookie.com https://*.vimeo.com https://embed.diagrams.net`
  + Restricts what sources are allowed to load for frames/iframes.
  + Can be configured via a `ALLOWED_IFRAME_SOURCES` .env option.
  + May be different depending on other configuration set.
* `script-src http: https: 'nonce-abc123' 'strict-dynamic'`
  + Restricts what scripts can be ran on a BookStack-served page.
  + Will not be set if the `ALLOW_CONTENT_SCRIPTS` .env option is active.
  + The nonce value used is randomly generated upon each request. It is automatically applied to any “Custom HTML Head Content” scripts.
* `object-src 'self'`
  + Restricts which embeddable content can be loaded onto a BookStack-served page.
  + Will not be set if the `ALLOW_CONTENT_SCRIPTS` .env option is active.
* `base-uri 'self'`
  + Restricts what `<base>` tags can be added to a BookStack-served page.

If needed you should be able to set additional CSP headers via your webserver.
If there’s a clash with an existing BookStack CSP header then browsers will generally favour the most restrictive policy.

---

### MySQL SSL Connection

If your BookStack database is not on the same host as your web server, you may want to ensure the connection is encrypted using SSL between these systems.
Assuming SSL is configured correctly on your MySQL server, you can enable this by defining the `MYSQL_ATTR_SSL_CA` option in your `.env` file like so:

| ``` [1](#hl-8-1) [2](#hl-8-2) [3](#hl-8-3) [4](#hl-8-4) [5](#hl-8-5)  ``` | ``` # Path to Certificate Authority (CA) certificate file for your MySQL instance. # When this option is used host name identity verification will be performed # which checks the hostname, used by the client, against names within the # certificate itself (Common Name or Subject Alternative Name). MYSQL_ATTR_SSL_CA="/path/to/ca.pem"  ``` |
| --- | --- |

---

### Using BookStack Content Externally

In some scenarios you may use BookStack user-provided content externally (Accessed via the database or API). Such content is not guaranteed to be safe so keep security in mind when dealing with such content. In some cases, the system will apply some filtering to content in an attempt to prevent certain vulnerabilities, but this is not assured to be a bullet-proof defence.

Within its own interfaces, unless disabled, BookStack makes use of Content Security Policy (CSP) rules to heavily negate cross-site scripting vulnerabilities from user content. If displaying user content externally, it’s advised you also use defences such as CSP or other techniques such as disabling of JavaScript entirely.

[Edit this Page](https://codeberg.org/bookstack/website/src/branch/main/content/docs/admin/security.md)

BookStack - Created By [Dan Brown](https://danb.me "danb.me") and developed with the [community](https://github.com/BookStackApp/BookStack/graphs/contributors).
Page generated with [hugo](https://gohugo.io), Site source can be found [here on Codeberg](https://codeberg.org/bookstack/website).

This website uses a self-hosted instance of [Plausible](https://plausible.io/) for analytics.
Our site stats can [be viewed here](https://analytics.bookstackapp.com/bookstackapp.com).
We also use a customized version of [webidx](https://github.com/gbxyz/webidx/) for search capabilities.

BookStack® is a registered trade mark of Daniel Brown.

Copyright 2015-2025 Dan Brown.

##### On the site

* [Documentation](https://www.bookstackapp.com/docs)
* [Our Features](https://www.bookstackapp.com/#features)
* [View the Demo](https://www.bookstackapp.com/#demo)
* [Read our Blog](https://www.bookstackapp.com/blog)
* [Donate](https://www.bookstackapp.com/donate)
* [Hacks](https://www.bookstackapp.com/hacks)

##### Follow us

* [Codeberg](https://codeberg.org/bookstack/)
* [Github](https://github.com/BookStackApp/BookStack)
* [Discord](https://discord.gg/ztkBqR2)
* [Mastodon](https://fosstodon.org/%40bookstack)
* [PeerTube](https://foss.video/c/bookstack/)
* [YouTube](https://www.youtube.com/c/BookStackApp)
* [Reddit](https://www.reddit.com/r/bookstack)

##### Information

* [Project FAQ](/about/project-faq/)
* [Our Support Services](/support/)
* [BookStack in the Media](/about/in-the-media/)
* [Alternative Open Source Options](/about/bookstack-alternatives/)
* [A Confluence Alternative](/about/confluence-alternative/)
* [Microsoft Teams Wiki Alternative](/about/teams-wiki-alternative/)
* [Open Source Documentation Software](/about/open-source-documentation-software/)



=== Content from www.bookstackapp.com_ad5bf3cf_20250114_224412.html ===

[BookStack](https://www.bookstackapp.com/)

Platform
[Features

An overview of the core features of BookStack](/#features)
[Demo

Give BookStack a test drive on our demo instance](/#demo)
[Documentation

Guidance for managing and using BookStack](/docs)
[Our Blog

Get the latest project news from our blog](/blog)
[Hacks

Unsupported hacks that can be applied](/hacks)

[Support](/support)
[Documentation

Get support from our user and admin documentation](/docs)
[Support Plans

See our range of support plans for BookStack](/support)
[Donate

Provide financial support to the project](/donate)
[Videos on PeerTube

Find our video guides on the fediverse.](https://foss.video/c/bookstack/)
[Guides on YouTube

Watch our video guides on YouTube](https://www.youtube.com/c/BookStackApp)
[GitHub Issues

Find or report issues on the GitHub project](https://github.com/BookStackApp/BookStack/issues)

Community
[GitHub

Star the project on GitHub and follow us](https://github.com/BookStackApp/BookStack)
[Codeberg

Watch development and get involved](https://codeberg.org/bookstack/)
[Discord

Chat with the development team and other users](https://discord.gg/ztkBqR2)
[Mastodon

Follow the project on Mastodon](https://fosstodon.org/%40bookstack)
[YouTube

Watch and comment on our YouTube videos](https://www.youtube.com/c/BookStackApp)
[Reddit

Join our community on the BookStack subreddit](https://www.reddit.com/r/bookstack)
[Our Blog

Keep up with the latest developments via our blog](/blog)

# BookStack Release v22.09

![Dan Brown](/images/dan.jpg) Dan Brown posted on the 8th of September 2022

The BookStack September release is here with a variety of desired features that build upon,
and enhance, existing BookStack systems. As usual, it also includes language updates
and a bunch of tweaks & fixes.

* [Release video overview](https://youtu.be/nK2FqQCP-Ms)
* [Update instructions](https://www.bookstackapp.com/docs/admin/updates)
* [GitHub release page](https://github.com/BookStackApp/BookStack/releases/tag/v22.09)

**Upgrade Notices**

* **Security** - This release cycle contained a security release that added detail that’s important to consider when BookStack content is used externally. See the [v22.07.3 post](/blog/bookstack-release-v22-07-3/) for more detail.
* **Revision Visibility** - This update fixes a permission disparity with revisions. Revision content has always been accessible to those with page-view permissions, but the links to the revisions list previously required page-edit permission to show. This has been aligned, which may mean page revision links may now show to those that did not previously see them.
* **Revision Limit Change** - The default, per-page, revision limit has been doubled from 50 to 100, to account for new system-content updates that may occur. If desired, you can [configure this to a custom value](/docs/admin/other-config/#revision-limit).
* **Reference Index** - New features have been added to track links between content in BookStack, which uses an internal reference index. Upon upgrade from an older BookStack version, this index will need to be rebuilt. This can be done with the [“Regenerate References” command](/docs/admin/commands/#regenerate-reference-index) or via the “Regenerate References” maintenance action within BookStack.

### Page Content References

When you edit and save pages within the system, BookStack will now attempt to identify links
to other pages, chapters, books and shelves in the system.
A new element will show when viewing one of those items, reflecting a count of pages that link
to the currently viewed item:

![Text within a &ldquo;Details&rdquo; section showing &ldquo;Referenced on 3 pages&rdquo;](/images/2022/09/references_link.png)

When clicked, this will take you to a new “References” view which lists the all pages
leading to the this current item:

![Screenshot of a &ldquo;References&rdquo; view with a list of page items](/images/2022/09/references_view.png)

This new feature should help provide some insight to how content is interlinked within the system,
while also providing an index that we can use within BookStack’s systems to make some operations more efficient.

When upgrading an existing BookStack instance, no references will be indexed until you start saving content.
To index and detect existing cross-content links, you can use the new “Regenerate References”
admin maintenance action:

![A card within the interface showing a &ldquo;Regenerate References&rdquo; section and action button](/images/2022/09/regen_references_action.png)

Alternatively, this action has also been added as a terminal command which
you can [find in our documentation here](/docs/admin/commands/#regenerate-reference-index).

### Auto Link Updating

Making use of our new reference indexing system, as detailed above, BookStack will now
auto-update internal page links to shelves, books, chapters and other pages when those
items experience a change in URL.

BookStack already had a system to handle some changes, it would attempt to find pages using
their old URLs by looking up against page revisions, but this would not work for books, chapters & shelves
or for pages if revisions were deleted.
Now, upon changes to an item’s URL, BookStack will lookup pages referencing that item and auto-update
such links to be current. This will be done in a fully transparent manner, with a revision
being logged for the change with a “System auto-update of internal links” changelog message.
To support this addition, the default per-page revision limit has increased from 50 to 100 entries.

There may still be some logical gaps that will produce old links, such as restoring an old page revision,
but this should handle most cases to ensure internal links stay current.

### OIDC Group Sync Support

OIDC authentication was added to BookStack almost a year ago, as part of v21.10.
Since then I’ve been [taking feedback](https://github.com/BookStackApp/BookStack/issues/3004)
to understand how group syncing would operate. Within v22.09 we’re putting that feedback
into action with the addition of OIDC group sync support.

To work with BookStack, your OIDC system will need to provide groups within the OIDC ID token
it provides back to BookStack. To support this in BookStack, we’ve added options to
define custom authentication request scopes (Needed for groups in some scenarios)
while also supporting accessing nested properties in the ID token JSON data.

Read the new [“Group Sync” section](/docs/admin/oidc-auth/#group-sync) of our OIDC documentation for more details.

### New “Local (Secure - Restricted)” Image Storage Option

A long while ago we added a `local_secure` storage option for images which required user login
before serving an image, as a layer of access control.
This release takes this further with a `local_secure_restricted` storage option which
will check the user’s permissions to access the item that an image was uploaded to.
This means that image file access for page images can be controlled by the page they’re uploaded to, providing
a whole new layer of control for environments that need it.

This new option does have some caveats, mainly that it can introduce various logical scenarios
that cause image visibility anomalies, in cases where images are re-used across different permissions contexts.

[Find full details of this option in our docs](/docs/admin/upload-config/#local-secure---restricted).

### “Page Include Parse” Logical Theme Event

Our [logical theme system](https://github.com/BookStackApp/BookStack/blob/development/dev/docs/logical-theme-system.md)
has received a new event to customise handling of the [page include system](/docs/user/reusing-page-content).
The page include system allows dynamic import of page content into the body of a page.
Using this event, you can now extensively customize the handling of page includes.

As an example, the below `functions.php` code would replace “dog” with “cat” in included content:

| ``` [1](#hl-0-1) [2](#hl-0-2) [3](#hl-0-3) [4](#hl-0-4) [5](#hl-0-5) [6](#hl-0-6) [7](#hl-0-7) [8](#hl-0-8) [9](#hl-0-9)  ``` | ``` <?php use BookStack\Entities\Models\Page; use BookStack\Facades\Theme; use BookStack\Theming\ThemeEvents; Theme::listen(ThemeEvents::PAGE_INCLUDE_PARSE, function(string $tagReference, string $replacementHTML, Page $currentPage, ?Page $referencedPage) {     return str_replace('dog', 'cat', $replacementHTML); });  ``` |
| --- | --- |

Of course there are much more practical examples for this, such as defining fallback content or adding extra permission control.

Find the details of the event [in the source code here](https://github.com/BookStackApp/BookStack/blob/98aed794cc7272687720c4f4c42a4f540390c0af/app/Theming/ThemeEvents.php#L73-L86).

### Visual Theme System - Export Template Partials

As part of v22.07.2 we added a couple of export-specific template files
that could be used with the [visual theme system](https://github.com/BookStackApp/BookStack/blob/development/dev/docs/visual-theme-system.md), found at:

* `layouts/parts/export-body-start.blade.php`
* `layouts/parts/export-body-end.blade.php`

These can be used to add custom HTML code to the start & end of the HTML content used for
HTML and PDF exports within BookStack.

As a usage example I published a video on the BookStack YouTube channel showing
how to leverage these new templates to add a custom header and footer
to PDF exports:

[![YouTube Video Thumbnail](/images/yt/5bZ7zlNEphc.webp)](https://www.youtube.com/watch?v=5bZ7zlNEphc "View Video")
### Translations

This release of BookStack adds Romanian as an available language.
A massive thanks to Mihai Ochian (soulstorm19) on Crowdin for their amazing effort
of translating over 6k words in this release cycle to add this language.

As usual, a range of our existing languages have received updates from our terrific translators
since v22.07, so a big thanks to all listed below:

* Mihai Ochian (soulstorm19) - *Romanian*
* 10935336 - *Chinese Simplified*
* HeartCore - *German Informal; German*
* Ji-Hyeon Gim (PotatoGim) - *Korean*
* SmokingCrop - *Dutch*
* m0uch0 - *Spanish*
* scureza - *Italian*
* pedromcsousa - *Portuguese*
* Statium - *Russian*
* Maciej Lebiest (Szwendacz) - *Polish*
* Alex Navarro (alex.n.navarro) - *Portuguese, Brazilian*
* Douradinho - *Portuguese*
* na3shkw - *Japanese*
* Éric Gaspar (erga) - *French*
* mcgong (GongMingCai) - *Chinese Simplified; Chinese Traditional*
* okaeiz - *Persian*

### Next Steps

For the next release cycle I’ll probably re-focus back on the permission system, to start
development of the features intended on the related road-map item, such as an overhaul of
item-level permission management to be more intuitive.

We’re approaching a milestone of 10k GitHub stars so there may be a minor detour to
celebrate that little achievement.

### Full List of Changes

**Released in v22.09**

* Added cross-item link reference tracking & updating. ([#3656](https://github.com/BookStackApp/BookStack/pull/3656), [#3683](https://github.com/BookStackApp/BookStack/issues/3683), [#1969](https://github.com/BookStackApp/BookStack/issues/1969))
* Added OIDC group sync functionality. ([#3616](https://github.com/BookStackApp/BookStack/pull/3616), [#3004](https://github.com/BookStackApp/BookStack/issues/3004))
* Added reference view to shelves, chapters, books & pages. ([#2864](https://github.com/BookStackApp/BookStack/issues/2864))
* Added new `local_secure_restricted` image storage option. ([#3693](https://github.com/BookStackApp/BookStack/pull/3693))
* Added “page\_include\_parse” theme event. ([#3698](https://github.com/BookStackApp/BookStack/pull/3698))
* Updated API docs to add detail for the request format. ([#3652](https://github.com/BookStackApp/BookStack/issues/3652))
* Updated revision link visibility to show to users. ([#2946](https://github.com/BookStackApp/BookStack/issues/2946))
* Updated shelf naming to be consistent across system. ([#3553](https://github.com/BookStackApp/BookStack/issues/3553))
* Updated translations with latest Crowdin changes. ([#3643](https://github.com/BookStackApp/BookStack/pull/3643), [#3701](https://github.com/BookStackApp/BookStack/pull/3701))
* Updated role edit/create form with clarification upon image access permissions. ([#3688](https://github.com/BookStackApp/BookStack/issues/3688))
* Fixed dates not using the correct encoding on some systems. ([#3590](https://github.com/BookStackApp/BookStack/issues/3590))
* Fixed image delete button showing to those without permission to delete. ([#3697](https://github.com/BookStackApp/BookStack/issues/3697))
* Fixed incorrect comment counts on Chinese language options. ([#3554](https://github.com/BookStackApp/BookStack/issues/3554))
* Fixed list indentation when next to floated images. ([#3672](https://github.com/BookStackApp/BookStack/issues/3672))
* Fixed various RTL text interface issues. ([#3702](https://github.com/BookStackApp/BookStack/issues/3702))
* Fixed WYSIWYG drawing update not triggering draft save. ([#3682](https://github.com/BookStackApp/BookStack/issues/3682))
* Fixed some additional SVG-based script cases not being filtered. ([#3705](https://github.com/BookStackApp/BookStack/issues/3705))

**Released in v22.07.3**

* Added API documentation section to advise of content security. ([#3636](https://github.com/BookStackApp/BookStack/issues/3636))
* Updated Persian translations. Thanks to [@samadha56](https://github.com/BookStackApp/BookStack/pull/3639). ([#3639](https://github.com/BookStackApp/BookStack/pull/3639))
* Updated code block rendering to help prevent blank blocks on fresh cache. ([#3637](https://github.com/BookStackApp/BookStack/issues/3637))
* Updated HTML filtering to prevent SVG animate case. ([#3636](https://github.com/BookStackApp/BookStack/issues/3636))
* Updated translations with latest changes from Crowdin. ([#3635](https://github.com/BookStackApp/BookStack/pull/3635))
* Updated revision list view to help prevent system memory exhaustion. ([#3633](https://github.com/BookStackApp/BookStack/issues/3633))
* Fixed issue with permission checking prevent certain actions where permission should have allowed. ([#3632](https://github.com/BookStackApp/BookStack/pull/3632))

**Released in v22.07.2**

* Added body-start/end partials to export template, for easier export customization via the visual theme system. ([#3630](https://github.com/BookStackApp/BookStack/pull/3630))
* Added activity recording for revision delete/restore. ([#3628](https://github.com/BookStackApp/BookStack/issues/3628))
* Updated translations with latest changes from Crowdin. ([#3625](https://github.com/BookStackApp/BookStack/pull/3625))
* Updated user validation with sensible limit to name input. ([#3614](https://github.com/BookStackApp/BookStack/issues/3614))
* Fixed issue where activity type could not be selected in the audit log. ([#3623](https://github.com/BookStackApp/BookStack/issues/3623))
* Fixed possibility of breaking page load due to bad user language input. ([#3615](https://github.com/BookStackApp/BookStack/issues/3615))

**Released in v22.07.1**

* Fixed issue where old WYSIWYG editor code would be cached, preventing the editor from showing. ([#3611](https://github.com/BookStackApp/BookStack/issues/3611))
* Updated translations with latest Crowdin changes. ([#3605](https://github.com/BookStackApp/BookStack/pull/3605))

---

Header Image Credits: Photo by [Luke Ellis-Craven](https://unsplash.com/%40lukeelliscraven?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/sheep?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

Want to let me know what you think of BookStack or this post?

You can find me on Mastodon [@danb@fosstodon.org](https://fosstodon.org/%40danb) or on the [BookStack Discord server](https://discord.gg/ztkBqR2).

#### Subscribe to Updates

There are two lists you can sign-up to for updates, A general news & updates list, sent on a weekly basis, and a security alerts list
that's sent when new security updates are available.

[News and Updates](https://updates.bookstackapp.com/signup/bookstack-news-and-updates)
|
[Security Alerts](https://updates.bookstackapp.com/signup/bookstack-security-updates)

#### Latest Posts

[##### BookStack in 2024

6 Jan 2025](https://www.bookstackapp.com/blog/bookstack-in-2024/)
[##### BookStack Release v24.12

23 Dec 2024](https://www.bookstackapp.com/blog/bookstack-release-v24-12/)
[##### BookStack Security Release v24.10.2

13 Nov 2024](https://www.bookstackapp.com/blog/bookstack-release-v24-10-2/)
[##### BookStack Release v24.10

9 Oct 2024](https://www.bookstackapp.com/blog/bookstack-release-v24-10/)
[##### BookStack Project Update for September 2024

12 Sep 2024](https://www.bookstackapp.com/blog/project-update-september-24/)
[##### BookStack Security Release v24.05.4

29 Aug 2024](https://www.bookstackapp.com/blog/bookstack-release-v24-05-4/)
[##### Nine Years of BookStack

12 Jul 2024](https://www.bookstackapp.com/blog/9-years-of-bookstack/)
[##### BookStack Security Release v24.05.1

21 May 2024](https://www.bookstackapp.com/blog/bookstack-release-v24-05-1/)

BookStack - Created By [Dan Brown](https://danb.me "danb.me") and developed with the [community](https://github.com/BookStackApp/BookStack/graphs/contributors).
Page generated with [hugo](https://gohugo.io), Site source can be found [here on Codeberg](https://codeberg.org/bookstack/website).

This website uses a self-hosted instance of [Plausible](https://plausible.io/) for analytics.
Our site stats can [be viewed here](https://analytics.bookstackapp.com/bookstackapp.com).
We also use a customized version of [webidx](https://github.com/gbxyz/webidx/) for search capabilities.

BookStack® is a registered trade mark of Daniel Brown.

Copyright 2015-2025 Dan Brown.

##### On the site

* [Documentation](https://www.bookstackapp.com/docs)
* [Our Features](https://www.bookstackapp.com/#features)
* [View the Demo](https://www.bookstackapp.com/#demo)
* [Read our Blog](https://www.bookstackapp.com/blog)
* [Donate](https://www.bookstackapp.com/donate)
* [Hacks](https://www.bookstackapp.com/hacks)

##### Follow us

* [Codeberg](https://codeberg.org/bookstack/)
* [Github](https://github.com/BookStackApp/BookStack)
* [Discord](https://discord.gg/ztkBqR2)
* [Mastodon](https://fosstodon.org/%40bookstack)
* [PeerTube](https://foss.video/c/bookstack/)
* [YouTube](https://www.youtube.com/c/BookStackApp)
* [Reddit](https://www.reddit.com/r/bookstack)

##### Information

* [Project FAQ](/about/project-faq/)
* [Our Support Services](/support/)
* [BookStack in the Media](/about/in-the-media/)
* [Alternative Open Source Options](/about/bookstack-alternatives/)
* [A Confluence Alternative](/about/confluence-alternative/)
* [Microsoft Teams Wiki Alternative](/about/teams-wiki-alternative/)
* [Open Source Documentation Software](/about/open-source-documentation-software/)



=== Content from jvn.jp_45dd7870_20250114_224411.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2022/09/30  Last Updated:2022/09/30
# JVN#78862034 BookStack vulnerable to cross-site scripting

## Overview

BookStack contains a cross-site scripting vulnerability.

## Products Affected

* BookStack versions prior to v22.09

## Description

BookStack contains a cross-site scripting vulnerability ([CWE-79](//cwe.mitre.org/data/definitions/79.html)).

## Impact

An arbitrary script may be executed on the web browser of the user who is accessing the site using the API of the product.

## Solution

**Update the Software**

Update the software to the latest version according to the information provided by the developer.

According to the developer, when using BookStack content via its API, it is necessary to check the following documentation and add the recommended protections as necessary.

<https://www.bookstackapp.com/docs/admin/security/#using-bookstack-content-externally>

## Vendor Status

| Vendor | Link |
| --- | --- |
| BookStack | [BookStack Release v22.09](https://www.bookstackapp.com/blog/bookstack-release-v22-09/) |
|  | [Admin Documentation | Security | Using BookStack Content Externally](https://www.bookstackapp.com/docs/admin/security/#using-bookstack-content-externally) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

CVSS v3
CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N
Base Score:
5.4

| Attack Vector(AV) | Physical (P) | Local (L) | Adjacent (A) | Network (N) |
| --- | --- | --- | --- | --- |
| Attack Complexity(AC) | High (H) | Low (L) |
| Privileges Required(PR) | High (H) | Low (L) | None (N) |
| User Interaction(UI) | Required (R) | None (N) |
| Scope(S) | Unchanged (U) | Changed (C) |
| Confidentiality Impact(C) | None (N) | Low (L) | High (H) |
| Integrity Impact(I) | None (N) | Low (L) | High (H) |
| Availability Impact(A) | None (N) | Low (L) | High (H) |

CVSS v2
AV:N/AC:M/Au:S/C:N/I:P/A:N
Base Score:
3.5

| Access Vector(AV) | Local (L) | Adjacent Network (A) | Network (N) |
| --- | --- | --- | --- |
| Access Complexity(AC) | High (H) | Medium (M) | Low (L) |
| Authentication(Au) | Multiple (M) | Single (S) | None (N) |
| Confidentiality Impact(C) | None (N) | Partial (P) | Complete (C) |
| Integrity Impact(I) | None (N) | Partial (P) | Complete (C) |
| Availability Impact(A) | None (N) | Partial (P) | Complete (C) |

## Credit

Kenichi Okuno of Mitsui Bussan Secure Directions, Inc reported this vulnerability to IPA.

JPCERT/CC coordinated with the developer under Information Security Early Warning Partnership.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2022-40690](https://www.cve.org/CVERecord?id=CVE-2022-40690) |
| JVN iPedia | [JVNDB-2022-000074](https://jvndb.jvn.jp/jvndb/JVNDB-2022-000074) |

* JVN
* [HOME](/en/index.html)
* [What is JVN ?](/en/nav/jvn.html)
* [Instructions](/en/nav/jvnhelp.html)
* [List of Vulnerability Report](/en/report/index.html)
* [VN\_JP](/en/jp/index.html)
* [VN\_JP(Unreachable)](/en/adj/index.html)
* [VN\_VU](/en/vu/index.html)
* [TA](/en/ta/index.html)
* [TRnotes](/en/tr/index.html)
* [JVN iPedia](http://jvndb.jvn.jp/en/)
* [MyJVN](http://jvndb.jvn.jp/en/apis/myjvn/index.html)
* [JVNJS/RSS](/en/rss/index.html)
* [Vendor List](/en/nav/index.html)
* [List of unreachable developers](/en/reply/index.html)
* [Contact](/en/contact/index.html)

Copyright (c) 2000-2022 JPCERT/CC and IPA. All rights reserved.


