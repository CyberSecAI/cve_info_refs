=== Content from github.com_98fe1b64_20250115_080350.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcloudwego%2Fhertz%2Fpull%2F229)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcloudwego%2Fhertz%2Fpull%2F229)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=cloudwego%2Fhertz)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cloudwego](/cloudwego)
/
**[hertz](/cloudwego/hertz)**
Public

* [Notifications](/login?return_to=%2Fcloudwego%2Fhertz) You must be signed in to change notification settings
* [Fork
  547](/login?return_to=%2Fcloudwego%2Fhertz)
* [Star
   5.8k](/login?return_to=%2Fcloudwego%2Fhertz)

* [Code](/cloudwego/hertz)
* [Issues
  28](/cloudwego/hertz/issues)
* [Pull requests
  41](/cloudwego/hertz/pulls)
* [Discussions](/cloudwego/hertz/discussions)
* [Actions](/cloudwego/hertz/actions)
* [Security](/cloudwego/hertz/security)
* [Insights](/cloudwego/hertz/pulse)

Additional navigation options

* [Code](/cloudwego/hertz)
* [Issues](/cloudwego/hertz/issues)
* [Pull requests](/cloudwego/hertz/pulls)
* [Discussions](/cloudwego/hertz/discussions)
* [Actions](/cloudwego/hertz/actions)
* [Security](/cloudwego/hertz/security)
* [Insights](/cloudwego/hertz/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fcloudwego%2Fhertz%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fcloudwego%2Fhertz%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# fix: fix path-traversal bug #229

 Merged

[welkeyever](/welkeyever)
merged 5 commits into
[cloudwego:develop](/cloudwego/hertz/tree/develop "cloudwego/hertz:develop")
from
[ruokeqx:develop](/ruokeqx/hertz/tree/develop "ruokeqx/hertz:develop")

Sep 8, 2022

 Merged

# [fix: fix path-traversal bug](#top) #229

[welkeyever](/welkeyever)
merged 5 commits into
[cloudwego:develop](/cloudwego/hertz/tree/develop "cloudwego/hertz:develop")
from
[ruokeqx:develop](/ruokeqx/hertz/tree/develop "ruokeqx/hertz:develop")

Sep 8, 2022

[Conversation
14](/cloudwego/hertz/pull/229)
[Commits
5](/cloudwego/hertz/pull/229/commits)
[Checks
0](/cloudwego/hertz/pull/229/checks)
[Files changed](/cloudwego/hertz/pull/229/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=60&v=4)](/ruokeqx)

Copy link

Contributor

### @ruokeqx **[ruokeqx](/ruokeqx)** commented [Sep 4, 2022](#issue-1361109946) ‚Ä¢ edited Loading

#### What type of PR is this?

fix: A bug fix

#### Check the PR title.

* This PR title match the format: (optional scope):
* The description of this PR title is user-oriented and clear enough for others to understand.

#### (Optional) Translate the PR title into Chinese.

‰øÆÂ§çÁõÆÂΩïÁ©øË∂äÊºèÊ¥û

#### (Optional) More detail description for this PR(en: English/zh: Chinese).

en: fix by simply replace all backslashes with forward slashes

zh(optional): Â∞ÜÂèçÊñúÊù†ÂÖ®ÈÉ®ÊîπÊàêÊ≠£ÊñúÊù†

#### Which issue(s) this PR fixes:

Fixes [#228](https://github.com/cloudwego/hertz/issues/228)

Currently hertz has no restriction on backslash in `normalizePath` function.

```
func normalizePath(dst, src []byte) []byte {
	dst = dst[:0]
	dst = addLeadingSlash(dst, src)
	dst = decodeArgAppendNoPlus(dst, src)

	// remove duplicate slashes
	b := dst
	bSize := len(b)
	for {
		n := bytes.Index(b, bytestr.StrSlashSlash)
		if n < 0 {
			break
		}
		b = b[n:]
		copy(b, b[1:])
		b = b[:len(b)-1]
		bSize--
	}
	dst = dst[:bSize]

	// remove /./ parts
	b = dst
	for {
		n := bytes.Index(b, bytestr.StrSlashDotSlash)
		if n < 0 {
			break
		}
		nn := n + len(bytestr.StrSlashDotSlash) - 1
		copy(b[n:], b[nn:])
		b = b[:len(b)-nn+n]
	}

	// remove /foo/../ parts
	for {
		n := bytes.Index(b, bytestr.StrSlashDotDotSlash)
		if n < 0 {
			break
		}
		nn := bytes.LastIndexByte(b[:n], '/')
		if nn < 0 {
			nn = 0
		}
		n += len(bytestr.StrSlashDotDotSlash) - 1
		copy(b[nn:], b[n:])
		b = b[:len(b)-n+nn]
	}

	// remove trailing /foo/..
	n := bytes.LastIndex(b, bytestr.StrSlashDotDot)
	if n >= 0 && n+len(bytestr.StrSlashDotDot) == len(b) {
		nn := bytes.LastIndexByte(b[:n], '/')
		if nn < 0 {
			return bytestr.StrSlash
		}
		b = b[:nn+1]
	}

	return b
}
```

After:

```
func normalizePath(dst, src []byte) []byte {
	// replace all backslashes with forward slashes
	for {
		n := bytes.Index(src, bytestr.StrBackSlash)
		if n < 0 {
			break
		}
		src[n] = '/'
	}
	...
}
```

Sorry, something went wrong.

 üëç
2
 welkeyever and li-jin-gou reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=40&v=4)](/ruokeqx)

`[fix path-traversal bug](/cloudwego/hertz/pull/229/commits/ed2456fcaacad37d846a937f86b9a2562ac3d3b9 "fix path-traversal bug")`

`[ed2456f](/cloudwego/hertz/pull/229/commits/ed2456fcaacad37d846a937f86b9a2562ac3d3b9)`

[![@li-jin-gou](https://avatars.githubusercontent.com/u/97824201?s=80&u=d0f8ca89c4155a934cbc68da8de5b91bc4fc5c51&v=4)](/li-jin-gou)

Copy link

Member

### **[li-jin-gou](/li-jin-gou)** commented [Sep 4, 2022](#issuecomment-1236342679) ‚Ä¢ edited Loading

| [@ruokeqx](https://github.com/ruokeqx) ÊåâÁÖß pr Ê®°ÁâàÊù•Â°´ÂÜôÂìà ÂèÇËÄÉ [#223](https://github.com/cloudwego/hertz/pull/223) |
| --- |

All reactions

Sorry, something went wrong.

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=40&v=4)](/ruokeqx)

`[fix path-traversal bug add UT](/cloudwego/hertz/pull/229/commits/d1a80e61acd14c9878ac2a917b1fd7956719a19c "fix path-traversal bug add UT")`

`[d1a80e6](/cloudwego/hertz/pull/229/commits/d1a80e61acd14c9878ac2a917b1fd7956719a19c)`

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [Sep 4, 2022](#issuecomment-1236369057) ‚Ä¢ edited Loading

|  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/cloudwego/hertz/pull/229?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=cloudwego) Report Merging [#229](https://codecov.io/gh/cloudwego/hertz/pull/229?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=cloudwego) ([4ecd30e](https://github.com/cloudwego/hertz/commit/4ecd30e4916615c41617020e7bd22c3a95b74b84)) into [develop](https://codecov.io/gh/cloudwego/hertz/commit/87516089fd86dcf997779fc8c05b233710ec3dc0?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=cloudwego) ([8751608](https://github.com/cloudwego/hertz/commit/87516089fd86dcf997779fc8c05b233710ec3dc0)) will **decrease** coverage by `0.02%`. The diff coverage is `0.00%`.  ``` @@             Coverage Diff             @@ ##           develop     #229      +/-   ## =========================================== - Coverage    59.19%   59.17%   -0.03%      ===========================================   Files           79       79                 Lines         8105     8110       +5      =========================================== + Hits          4798     4799       +1      - Misses        2953     2957       +4        Partials       354      354               ```  | [Impacted Files](https://codecov.io/gh/cloudwego/hertz/pull/229?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=cloudwego) | Coverage Œî |  | | --- | --- | --- | | [pkg/protocol/uri.go](https://codecov.io/gh/cloudwego/hertz/pull/229/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=cloudwego#diff-cGtnL3Byb3RvY29sL3VyaS5nbw==) | `70.34% <0.00%> (-0.72%)` | ‚¨áÔ∏è | | [pkg/network/standard/buffer.go](https://codecov.io/gh/cloudwego/hertz/pull/229/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=cloudwego#diff-cGtnL25ldHdvcmsvc3RhbmRhcmQvYnVmZmVyLmdv) | `81.08% <0.00%> (-0.50%)` | ‚¨áÔ∏è |   Help us with your feedback. Take ten seconds to tell us [how you rate us](https://about.codecov.io/nps?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=cloudwego). Have a feature suggestion? [Share it here.](https://app.codecov.io/gh/feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=cloudwego) |

All reactions

Sorry, something went wrong.

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=80&u=dff91dd01b5c981a9126864474fad0f701825c8d&v=4)](/ruokeqx)

Copy link

Contributor

Author

### **[ruokeqx](/ruokeqx)** commented [Sep 4, 2022](#issuecomment-1236378253)

| When checking other http framework source code, I find that fasthttp community fix the same bug six months ago. Maybe we can borrow some code.  [valyala/fasthttp#1226](https://github.com/valyala/fasthttp/issues/1226) [valyala/fasthttp@6b5bc7b](https://github.com/valyala/fasthttp/commit/6b5bc7bb304975147b4af68df54ac214ed2554c1) |
| --- |

All reactions

Sorry, something went wrong.

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=80&u=dff91dd01b5c981a9126864474fad0f701825c8d&v=4)](/ruokeqx)

Copy link

Contributor

Author

### **[ruokeqx](/ruokeqx)** commented [Sep 4, 2022](#issuecomment-1236385614)

| When checking other http framework source code, I find that fasthttp community fix the same bug six months ago. Maybe we can borrow some code.  [valyala/fasthttp#1226](https://github.com/valyala/fasthttp/issues/1226) [valyala/fasthttp@6b5bc7b](https://github.com/valyala/fasthttp/commit/6b5bc7bb304975147b4af68df54ac214ed2554c1)  They just repeat the logic, there is no need to write duplicate code. The point is that backslash `also` work in windows. So, essentially, we just need to replace the backslash with forward slash, by which we, to some extent, limit the separator. In my limited point of view, my fix is better. |
| --- |

All reactions

Sorry, something went wrong.

[![a631807682](https://avatars.githubusercontent.com/u/11827916?s=60&v=4)](/a631807682)

**[a631807682](/a631807682)**
reviewed
[Sep 5, 2022](#pullrequestreview-1095915850)

 [View reviewed changes](/cloudwego/hertz/pull/229/files/d1a80e61acd14c9878ac2a917b1fd7956719a19c)

[pkg/protocol/uri.go](/cloudwego/hertz/pull/229/files/d1a80e61acd14c9878ac2a917b1fd7956719a19c#diff-0d551c9e851899919f9af2d7b5271e06f38a91181837a0f187f8c9741df3a71b)
Outdated

|  |  | @@ -480,6 +480,15 @@ func splitHostURI(host, uri []byte) ([]byte, []byte, []byte) { | |
| --- | --- | --- | --- |
|  |  | } |
|  |  |  |
|  |  | func normalizePath(dst, src []byte) []byte { |
|  |  | // replace all backslashes with forward slashes |
|  |  | for { |
|  |  | n := bytes.Index(src, bytestr.StrBackSlash) |

Copy link

Member

### @a631807682 **[a631807682](/a631807682)** [Sep 5, 2022](#discussion_r962525989) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

1. Seems it will double check for bytes that have been replaced, is this an performance issue on long paths?
2. I'm not sure it's a good idea to replace `src` in place, maybe it's hard to understand that if `normalizePath` has a return value and also modifies the input parameters.

Sorry, something went wrong.

 üëç
2
 li-jin-gou and ruokeqx reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

Copy link

Contributor

Author

### @ruokeqx **[ruokeqx](/ruokeqx)** [Sep 5, 2022](#discussion_r962600228) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

> 1. Seems it will double check for bytes that have been replaced, is this an performance issue on long paths?
> 2. I'm not sure it's a good idea to replace `src` in place, maybe it's hard to understand that if `normalizePath` has a return value and also modifies the input parameters.

maybe this one would be better

```
func normalizePath(dst, src []byte) []byte {
	dst = dst[:0]
	dst = addLeadingSlash(dst, src)
	dst = decodeArgAppendNoPlus(dst, src)

	// replace all backslashes with forward slashes
	if filepath.Separator == '\\' {
		for i := range dst {
			if dst[i] == '\\' {
				dst[i] = '/'
			}
		}
	}
	...
}
```

BTW: echo use function `filepath.ToSlash`

<https://github.com/labstack/echo/blob/master/context_fs.go#L33>

```
func ToSlash(path string) string {
	if Separator == '/' {
		return path
	}
	return strings.ReplaceAll(path, string(Separator), "/")
}
```

Sorry, something went wrong.

All reactions

Copy link

Member

### @welkeyever **[welkeyever](/welkeyever)** [Sep 5, 2022](#discussion_r962608980)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`bytes.IndexByte` will do a SIMD accelerate in some platforms. Not sure which one is better.

And since the bug only happens in Windows? Maybe add a `if filepath.Separator == '\\' {` to filter the platform?

Sorry, something went wrong.

All reactions

[![@welkeyever](https://avatars.githubusercontent.com/u/9826697?s=80&u=ebeaec241ba6c087ad31313a44585b1fdc343eed&v=4)](/welkeyever)

Copy link

Member

### **[welkeyever](/welkeyever)** commented [Sep 5, 2022](#issuecomment-1236708932) ‚Ä¢ edited Loading

| The `example/standard` demo seems still have the problem in Windows if the url is : `127.0.0.1:8888/..%5c..%5cgo.sum` |
| --- |

All reactions

Sorry, something went wrong.

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=80&u=dff91dd01b5c981a9126864474fad0f701825c8d&v=4)](/ruokeqx)

Copy link

Contributor

Author

### **[ruokeqx](/ruokeqx)** commented [Sep 5, 2022](#issuecomment-1236746674) ‚Ä¢ edited by welkeyever Loading

| The `example/standard` demo seems still have the problem in Windows if the url is : `127.0.0.1:8888/..%5c..%5cgo.sum`  this version solve the problem  ``` func normalizePath(dst, src []byte) []byte { 	dst = dst[:0] 	dst = addLeadingSlash(dst, src) 	dst = decodeArgAppendNoPlus(dst, src)  	// replace all backslashes with forward slashes 	if filepath.Separator == '\\' { 		for i := range dst { 			if dst[i] == '\\' { 				dst[i] = '/' 			} 		} 	} 	... } ```  before the if judgment src = "/..%5c..%5cgo.sum" dst = "//..\..\go.sum"  ``` curl -v 127.0.0.1:8888/..%5c..%5cgo.sum *   Trying 127.0.0.1:8888... * Connected to 127.0.0.1 (127.0.0.1) port 8888 (#0) > GET /..%5c..%5cgo.sum HTTP/1.1 > Host: 127.0.0.1:8888 > User-Agent: curl/7.83.1 > Accept: */* > * Mark bundle as not supporting multiuse < HTTP/1.1 404 404 Page not found < Date: Mon, 05 Sep 2022 09:10:07 GMT < Content-Type: text/plain; charset=utf-8 < Content-Length: 26 < Cannot open requested path* Connection #0 to host 127.0.0.1 left intact ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@welkeyever](https://avatars.githubusercontent.com/u/9826697?s=80&u=ebeaec241ba6c087ad31313a44585b1fdc343eed&v=4)](/welkeyever)

Copy link

Member

### **[welkeyever](/welkeyever)** commented [Sep 5, 2022](#issuecomment-1236773529)

| The `example/standard` demo seems still have the problem in Windows if the url is : `127.0.0.1:8888/..%5c..%5cgo.sum`  this version solve the problem  ``` func normalizePath(dst, src []byte) []byte { 	dst = dst[:0] 	dst = addLeadingSlash(dst, src) 	dst = decodeArgAppendNoPlus(dst, src)  	// replace all backslashes with forward slashes 	if filepath.Separator == '\\' { 		for i := range dst { 			if dst[i] == '\\' { 				dst[i] = '/' 			} 		} 	} 	... } ```  before the if judgment src = "/..%5c..%5cgo.sum" dst = "//....\go.sum"  ``` curl -v 127.0.0.1:8888/..%5c..%5cgo.sum *   Trying 127.0.0.1:8888... * Connected to 127.0.0.1 (127.0.0.1) port 8888 (#0) > GET /..%5c..%5cgo.sum HTTP/1.1 > Host: 127.0.0.1:8888 > User-Agent: curl/7.83.1 > Accept: */* > * Mark bundle as not supporting multiuse < HTTP/1.1 404 404 Page not found < Date: Mon, 05 Sep 2022 09:10:07 GMT < Content-Type: text/plain; charset=utf-8 < Content-Length: 26 < Cannot open requested path* Connection #0 to host 127.0.0.1 left intact ```  Good job! As for the performance part, maybe do a bench test to see the answer. |
| --- |

All reactions

Sorry, something went wrong.

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=80&u=dff91dd01b5c981a9126864474fad0f701825c8d&v=4)](/ruokeqx)

Copy link

Contributor

Author

### **[ruokeqx](/ruokeqx)** commented [Sep 5, 2022](#issuecomment-1236874152)

| The `example/standard` demo seems still have the problem in Windows if the url is : `127.0.0.1:8888/..%5c..%5cgo.sum`  this version solve the problem  ``` func normalizePath(dst, src []byte) []byte { 	dst = dst[:0] 	dst = addLeadingSlash(dst, src) 	dst = decodeArgAppendNoPlus(dst, src)  	// replace all backslashes with forward slashes 	if filepath.Separator == '\\' { 		for i := range dst { 			if dst[i] == '\\' { 				dst[i] = '/' 			} 		} 	} 	... } ```  before the if judgment src = "/..%5c..%5cgo.sum" dst = "//....\go.sum"  ``` curl -v 127.0.0.1:8888/..%5c..%5cgo.sum *   Trying 127.0.0.1:8888... * Connected to 127.0.0.1 (127.0.0.1) port 8888 (#0) > GET /..%5c..%5cgo.sum HTTP/1.1 > Host: 127.0.0.1:8888 > User-Agent: curl/7.83.1 > Accept: */* > * Mark bundle as not supporting multiuse < HTTP/1.1 404 404 Page not found < Date: Mon, 05 Sep 2022 09:10:07 GMT < Content-Type: text/plain; charset=utf-8 < Content-Length: 26 < Cannot open requested path* Connection #0 to host 127.0.0.1 left intact ```  Good job! As for the performance part, maybe do a bench test to see the answer.  I did some simple benchmarks, when there are backslashes in path, for-range option is faster, when there is no backslash in path, IndexByte option is faster.  Choose IndexByte maybe more reasonable since most normal URLs don't have backslashes in them.  ``` var benchDstBackslashShort = []byte("/..\\foo") var benchDstBackslashLong = []byte("/..\\..\\..\\..\\..\\..\\..\\..\\..\\..\\foo") var benchDstNoBackslashShort = []byte("/../foo") var benchDstNoBackslashLong = []byte("/../../../../../../../../../../foo")  func BenchmarkForrange(b *testing.B) { 	for i := 0; i < b.N; i++ { 		for i := range benchDstNoBackslashShort { 			if benchDstNoBackslashShort[i] == '\\' { 				benchDstNoBackslashShort[i] = '/' 			} 		} 		benchDstNoBackslashShort = []byte("/../foo") 	} }  func BenchmarkIndexByte(b *testing.B) { 	for i := 0; i < b.N; i++ { 		for { 			n := bytes.IndexByte(benchDstNoBackslashShort, '\\') 			if n < 0 { 				break 			} 			benchDstNoBackslashShort[n] = '/' 		} 		benchDstNoBackslashShort = []byte("/../foo") 	} } ```  environment  ``` goos: windows goarch: amd64 pkg: github.com/cloudwego/hertz/pkg/protocol cpu: Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz ```  benchDstBackslashShort  ``` BenchmarkForrange-12     	57650732	        19.92 ns/op	       8 B/op	       1 allocs/op BenchmarkIndexByte-12    	43823608	        27.97 ns/op	       8 B/op	       1 allocs/op PASS ok  	github.com/cloudwego/hertz/pkg/protocol	2.521s ```  benchDstBackslashLong  ``` BenchmarkForrange-12     	21818498	        52.70 ns/op	      48 B/op	       1 allocs/op BenchmarkIndexByte-12    	 9185786	       130.1 ns/op	      48 B/op	       1 allocs/op PASS ok  	github.com/cloudwego/hertz/pkg/protocol	2.941s ```  benchDstNoBackslashShort  ``` BenchmarkForrange-12     	53754288	        19.66 ns/op	       8 B/op	       1 allocs/op BenchmarkIndexByte-12    	61503766	        19.34 ns/op	       8 B/op	       1 allocs/op PASS ok  	github.com/cloudwego/hertz/pkg/protocol	2.379s ```  benchDstNoBackslashLong  ``` BenchmarkForrange-12     	21096711	        49.30 ns/op	      48 B/op	       1 allocs/op BenchmarkIndexByte-12    	32403181	        37.07 ns/op	      48 B/op	       1 allocs/op PASS ok  	github.com/cloudwego/hertz/pkg/protocol	2.724s ``` |
| --- |

 üëç
2
 welkeyever and a631807682 reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

Sorry, something went wrong.

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=40&v=4)](/ruokeqx)

`[optimize](/cloudwego/hertz/pull/229/commits/f2b47d96c1355ce6a3aa196906589490a64d4b97 "optimize")`

`[f2b47d9](/cloudwego/hertz/pull/229/commits/f2b47d96c1355ce6a3aa196906589490a64d4b97)`

[![@welkeyever](https://avatars.githubusercontent.com/u/9826697?s=80&u=ebeaec241ba6c087ad31313a44585b1fdc343eed&v=4)](/welkeyever)

Copy link

Member

### **[welkeyever](/welkeyever)** commented [Sep 6, 2022](#issuecomment-1237601198)

| PTAL. There may have a side effect which lead to a failure of existing UT |
| --- |

All reactions

Sorry, something went wrong.

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=80&u=dff91dd01b5c981a9126864474fad0f701825c8d&v=4)](/ruokeqx)

Copy link

Contributor

Author

### **[ruokeqx](/ruokeqx)** commented [Sep 6, 2022](#issuecomment-1237618372) ‚Ä¢ edited Loading

| My fault. Since we add `if filepath.Separator == '\\' {`, backslashes were replaced when running UT in my windows laptop. However, linux would not replace them. We can pass the the UT by modifying the code like below.  ``` if filepath.Separator == '\\' && string(parsedPath) != expectedPath {     t.Fatalf("Unexpected Path: %q. Expected %q", parsedPath, expectedPath) } ```  Also, github action can not check windows path. |
| --- |

All reactions

Sorry, something went wrong.

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=40&v=4)](/ruokeqx)

`[fix UT](/cloudwego/hertz/pull/229/commits/98b3fcad23d739aa55ba062970fa0937e2e717d8 "fix UT")`

`[98b3fca](/cloudwego/hertz/pull/229/commits/98b3fcad23d739aa55ba062970fa0937e2e717d8)`

[![welkeyever](https://avatars.githubusercontent.com/u/9826697?s=60&v=4)](/welkeyever)

**[welkeyever](/welkeyever)**
approved these changes
[Sep 6, 2022](#pullrequestreview-1097015690)

 [View reviewed changes](/cloudwego/hertz/pull/229/files/98b3fcad23d739aa55ba062970fa0937e2e717d8)

Copy link

Member

### @welkeyever **[welkeyever](/welkeyever)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

lgtm

Sorry, something went wrong.

All reactions

[![li-jin-gou](https://avatars.githubusercontent.com/u/97824201?s=60&v=4)](/li-jin-gou)

**[li-jin-gou](/li-jin-gou)**
approved these changes
[Sep 8, 2022](#pullrequestreview-1100095294)

 [View reviewed changes](/cloudwego/hertz/pull/229/files/98b3fcad23d739aa55ba062970fa0937e2e717d8)

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=40&v=4)](/ruokeqx)

`[Merge branch 'develop' into develop](/cloudwego/hertz/pull/229/commits/4ecd30e4916615c41617020e7bd22c3a95b74b84 "Merge branch 'develop' into develop")`

`[4ecd30e](/cloudwego/hertz/pull/229/commits/4ecd30e4916615c41617020e7bd22c3a95b74b84)`

[![a631807682](https://avatars.githubusercontent.com/u/11827916?s=60&v=4)](/a631807682)

**[a631807682](/a631807682)**
approved these changes
[Sep 8, 2022](#pullrequestreview-1100329505)

 [View reviewed changes](/cloudwego/hertz/pull/229/files/4ecd30e4916615c41617020e7bd22c3a95b74b84)

[![@welkeyever](https://avatars.githubusercontent.com/u/9826697?s=40&u=ebeaec241ba6c087ad31313a44585b1fdc343eed&v=4)](/welkeyever)
[welkeyever](/welkeyever)
merged commit [`dcb0b5a`](/cloudwego/hertz/commit/dcb0b5a1861a1e2e4629a8607a3ca9c89009ac55)
into
cloudwego:develop

[Sep 8, 2022](https://github.com/cloudwego/hertz/pull/229#event-7345534275)

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this pull request
[Sep 28, 2022](#ref-issue-1389520240)

[x/vulndb: potential Go vuln in github.com/cloudwego/hertz: CVE-2022-40082
golang/vulndb#1027](/golang/vulndb/issues/1027)

Closed

[![@welkeyever](https://avatars.githubusercontent.com/u/9826697?s=40&u=ebeaec241ba6c087ad31313a44585b1fdc343eed&v=4)](/welkeyever)
[welkeyever](/welkeyever)
mentioned this pull request
[Jan 31, 2023](#ref-pullrequest-1563585452)

[fix: uri normalize in windows
#568](/cloudwego/hertz/pull/568)
 Merged

2 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fcloudwego%2Fhertz%2Fpull%2F229)

Reviewers

[![@li-jin-gou](https://avatars.githubusercontent.com/u/97824201?s=40&v=4)](/li-jin-gou) [li-jin-gou](/li-jin-gou)

li-jin-gou approved these changes

[![@a631807682](https://avatars.githubusercontent.com/u/11827916?s=40&v=4)](/a631807682) [a631807682](/a631807682)

a631807682 approved these changes

[![@welkeyever](https://avatars.githubusercontent.com/u/9826697?s=40&v=4)](/welkeyever) [welkeyever](/welkeyever)

welkeyever approved these changes

Assignees

No one assigned

Labels

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [hertz path-traversal bug in windows server](https://github.com/cloudwego/hertz/issues/228)

4 participants

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=52&v=4)](/ruokeqx) [![@li-jin-gou](https://avatars.githubusercontent.com/u/97824201?s=52&v=4)](/li-jin-gou) [![@welkeyever](https://avatars.githubusercontent.com/u/9826697?s=52&v=4)](/welkeyever) [![@a631807682](https://avatars.githubusercontent.com/u/11827916?s=52&v=4)](/a631807682)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_6bbbce40_20250115_080348.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcloudwego%2Fhertz%2Fissues%2F228)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcloudwego%2Fhertz%2Fissues%2F228)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=cloudwego%2Fhertz)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cloudwego](/cloudwego)
/
**[hertz](/cloudwego/hertz)**
Public

* [Notifications](/login?return_to=%2Fcloudwego%2Fhertz) You must be signed in to change notification settings
* [Fork
  547](/login?return_to=%2Fcloudwego%2Fhertz)
* [Star
   5.8k](/login?return_to=%2Fcloudwego%2Fhertz)

* [Code](/cloudwego/hertz)
* [Issues
  28](/cloudwego/hertz/issues)
* [Pull requests
  41](/cloudwego/hertz/pulls)
* [Discussions](/cloudwego/hertz/discussions)
* [Actions](/cloudwego/hertz/actions)
* [Security](/cloudwego/hertz/security)
* [Insights](/cloudwego/hertz/pulse)

Additional navigation options

* [Code](/cloudwego/hertz)
* [Issues](/cloudwego/hertz/issues)
* [Pull requests](/cloudwego/hertz/pulls)
* [Discussions](/cloudwego/hertz/discussions)
* [Actions](/cloudwego/hertz/actions)
* [Security](/cloudwego/hertz/security)
* [Insights](/cloudwego/hertz/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fcloudwego%2Fhertz%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fcloudwego%2Fhertz%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# hertz path-traversal bug in windows server #228

Closed

[ruokeqx](/ruokeqx) opened this issue
Sep 4, 2022
¬∑ 0 comments
 ¬∑ Fixed by [#229](https://github.com/cloudwego/hertz/pull/229)

Closed

# [hertz path-traversal bug in windows server](#top) #228

[ruokeqx](/ruokeqx) opened this issue
Sep 4, 2022
¬∑ 0 comments
 ¬∑ Fixed by [#229](https://github.com/cloudwego/hertz/pull/229)

Assignees
[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=40&v=4)](/ruokeqx)

Labels
[enhancement](/cloudwego/hertz/labels/enhancement)
New feature or request

## Comments

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=80&u=dff91dd01b5c981a9126864474fad0f701825c8d&v=4)](/ruokeqx)

Copy link

Contributor

### **[ruokeqx](/ruokeqx)** commented [Sep 4, 2022](#issue-1361086407)

| **Describe the bug**  hertz path-traversal bug in windows server.  Hackers can read any file in windows server since there are no backslash restrictions.  Since backslash doesn't work in linux filesystem, the bug works in a very limited production environment.  **Screenshots**  [image](https://user-images.githubusercontent.com/55469170/188304272-4f25c5d3-d732-4f70-8b90-00da8121f947.png)  **Hertz version:**  [v0.3.0](https://github.com/cloudwego/hertz/releases/tag/v0.3.0)  **Environment:**  any windows server any go version and any hertz version  **fix suggestion**  Replace all backslashes with forwardslashes at the beginning of the normalizePath function. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=40&u=dff91dd01b5c981a9126864474fad0f701825c8d&v=4)](/ruokeqx)
[ruokeqx](/ruokeqx)
mentioned this issue
[Sep 4, 2022](#ref-pullrequest-1361109946)

[fix: fix path-traversal bug
#229](/cloudwego/hertz/pull/229)
 Merged

2 tasks

[![@li-jin-gou](https://avatars.githubusercontent.com/u/97824201?s=40&u=d0f8ca89c4155a934cbc68da8de5b91bc4fc5c51&v=4)](/li-jin-gou)
[li-jin-gou](/li-jin-gou)
assigned [ruokeqx](/ruokeqx)
[Sep 4, 2022](#event-7318572387)

[![@li-jin-gou](https://avatars.githubusercontent.com/u/97824201?s=40&u=d0f8ca89c4155a934cbc68da8de5b91bc4fc5c51&v=4)](/li-jin-gou)
[li-jin-gou](/li-jin-gou)
added
the
[enhancement](/cloudwego/hertz/labels/enhancement)
New feature or request
label
[Sep 4, 2022](#event-7318572460)

[![@welkeyever](https://avatars.githubusercontent.com/u/9826697?s=40&u=ebeaec241ba6c087ad31313a44585b1fdc343eed&v=4)](/welkeyever)
[welkeyever](/welkeyever)
closed this as [completed](/cloudwego/hertz/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#229](/cloudwego/hertz/pull/229)
[Sep 8, 2022](#event-7345534416)

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this issue
[Sep 28, 2022](#ref-issue-1389520240)

[x/vulndb: potential Go vuln in github.com/cloudwego/hertz: CVE-2022-40082
golang/vulndb#1027](/golang/vulndb/issues/1027)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fcloudwego%2Fhertz%2Fissues%2F228)

Assignees

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=40&v=4)](/ruokeqx) [ruokeqx](/ruokeqx)

Labels

[enhancement](/cloudwego/hertz/labels/enhancement)
New feature or request

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [fix: fix path-traversal bug](/cloudwego/hertz/pull/229)
 [ruokeqx/hertz](/ruokeqx/hertz)

2 participants

[![@ruokeqx](https://avatars.githubusercontent.com/u/55469170?s=52&v=4)](/ruokeqx) [![@li-jin-gou](https://avatars.githubusercontent.com/u/97824201?s=52&v=4)](/li-jin-gou)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


