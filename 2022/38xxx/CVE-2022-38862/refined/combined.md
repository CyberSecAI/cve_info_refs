=== Content from trac.mplayerhq.hu_fb59109e_20250114_191315.html ===


[![MPlayer - The Movie Player](https://mplayerhq.hu/mplayer-logo.png)](https://mplayerhq.hu/)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/query)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ← [Previous Ticket](/ticket/2403 "Ticket #2403")
* [Next Ticket](/ticket/2405 "Ticket #2405") →

---

Opened [2 years ago](/timeline?from=2022-08-24T05%3A44%3A15Z&precision=second "See timeline at Aug 24, 2022, 5:44:15 AM")

Last modified [2 years ago](/timeline?from=2022-09-02T13%3A49%3A59Z&precision=second "See timeline at Sep 2, 2022, 1:49:59 PM")

## [#2404](/ticket/2404) [new](/query?status=new) [defect](/query?status=!closed&type=defect)

# A heap-buffer-overflow occurred in function play() of libaf/af\_pan.c

| Reported by: | [ylzs](/query?reporter=ylzs&status=!closed) | Owned by: | [beastd](/query?owner=beastd&status=!closed) |
| --- | --- | --- | --- |
| Priority: | [normal](/query?priority=normal&status=!closed) | Component: | [undetermined](/query?component=undetermined&status=!closed) |
| Version: | [HEAD](/query?status=!closed&version=HEAD) | Severity: | [major](/query?severity=major&status=!closed) |
| Keywords: |  | Cc: |  |
| Blocked By: |  | Blocking: |  |
| Reproduced by developer: | [no](/query?reproduced=0&status=!closed) | Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |

## Description [(last modified by ylzs)](/ticket/2404?action=diff&version=3 "2022-08-31 02:34:49.039591+00:00")

Version: SVN-r38374-13.0.1

Build command: ../configure --disable-ffmpeg\_a && make (compiling with asan)

Summary of the bug: An heap-buffer-overflow is found in fucnction play() which affects mencoder. and mplayer The attached file can reproduce this issue (ASAN-recompilation is needed).

How to reproduce:

1.Command: ./mencoder -ovc lavc -oac lavc -o /dev/null ./testcase

./mplayer ./testcase

2.Result:

```
=================================================================
==27905==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6140000003c8 at pc 0x5555557f69f5 bp 0x7fffffffd2a0 sp 0x7fffffffd298
READ of size 4 at 0x6140000003c8 thread T0
    #0 0x5555557f69f4 in play /home/jlx/good_mplayer/mplayer/libaf/af_pan.c:176:7

0x6140000003cb is located 0 bytes to the right of 395-byte region [0x614000000240,0x6140000003cb)
allocated by thread T0 here:
    #0 0x5555556fa43d in malloc (/home/jlx/good_mplayer/asan_mplayer/mencoder+0x1a643d)
    #1 0x5555557c795b in af_resize_local_buffer /home/jlx/good_mplayer/mplayer/libaf/af.c:639:21

SUMMARY: AddressSanitizer: heap-buffer-overflow /home/jlx/good_mplayer/mplayer/libaf/af_pan.c:176:7 in play
Shadow bytes around the buggy address:
  0x0c287fff8020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c287fff8030: 00 00 00 00 00 00 00 00 00 06 fa fa fa fa fa fa
  0x0c287fff8040: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00
  0x0c287fff8050: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c287fff8060: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x0c287fff8070: 00 00 00 00 00 00 00 00 00[03]fa fa fa fa fa fa
  0x0c287fff8080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c287fff8090: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c287fff80a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c287fff80b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c287fff80c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==27905==ABORTING

```

### Attachments (2)

[testcase](/attachment/ticket/2404/testcase "View attachment")[​](/raw-attachment/ticket/2404/testcase "Download")
(3.7 KB
) - added by ylzs [2 years ago](/timeline?from=2022-08-24T05%3A45%3A54Z&precision=second "See timeline at Aug 24, 2022, 5:45:54 AM").
[valgrind](/attachment/ticket/2404/valgrind "View attachment")[​](/raw-attachment/ticket/2404/valgrind "Download")
(17.9 KB
) - added by ylzs [2 years ago](/timeline?from=2022-08-31T02%3A35%3A18Z&precision=second "See timeline at Aug 31, 2022, 2:35:18 AM").

Download all attachments as:
[.zip](/zip-attachment/ticket/2404/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (7)

### by ylzs, [2 years ago](/timeline?from=2022-08-24T05%3A45%3A54Z&precision=second "See timeline at Aug 24, 2022, 5:45:54 AM")

| Attachment: | [*testcase*](/attachment/ticket/2404/testcase)[​](/raw-attachment/ticket/2404/testcase "Download") added |
| --- | --- |

### [comment:1](#comment:1) by reimar, [2 years ago](/timeline?from=2022-08-26T21%3A19%3A08Z&precision=second "See timeline at Aug 26, 2022, 9:19:08 PM")

Title seems incorrect as this seems to be in af\_pan.c, too.

I also expect this to be a duplicate of [#2400](/ticket/2400 "#2400: defect: A heap-buffer-overflow  occurred  in function  play()  of  libaf/af_pan.c (new)"), though I currently cannot reproduce either.

### [comment:2](#comment:2) by ylzs, [2 years ago](/timeline?from=2022-08-29T02%3A48%3A20Z&precision=second "See timeline at Aug 29, 2022, 2:48:20 AM")

yes, It seems as same as the 2400.

### [comment:3](#comment:3) by ylzs, [2 years ago](/timeline?from=2022-08-31T02%3A34%3A49Z&precision=second "See timeline at Aug 31, 2022, 2:34:49 AM")

| Description: | modified ([diff](/ticket/2404?action=diff&version=3)) |
| --- | --- |
| Summary: | A heap-buffer-overflow occurred in function play() of libaf/af.c:639 → A heap-buffer-overflow occurred in function play() of libaf/af\_pan.c |

I 've ran this testcase with valgrind and put the valgrind output into the attached file. It is strange that valgrind doesn't report this bug but asan does show that the bug exists.

### by ylzs, [2 years ago](/timeline?from=2022-08-31T02%3A35%3A18Z&precision=second "See timeline at Aug 31, 2022, 2:35:18 AM")

| Attachment: | [*valgrind*](/attachment/ticket/2404/valgrind)[​](/raw-attachment/ticket/2404/valgrind "Download") added |
| --- | --- |

### [comment:4](#comment:4) by reimar, [2 years ago](/timeline?from=2022-09-01T18%3A29%3A33Z&precision=second "See timeline at Sep 1, 2022, 6:29:33 PM")

I can imagine something goes wrong in af\_pan with high channel counts, so don't take this as me denying there is a bug.

But I cannot reproduce it with valgrind or asan, and you can't reproduce it with valgrind, and by the information in another ticket you seem to be running a pre-release version of clang, so maybe it's actually your ASAN/compiler that is buggy?

Anyway at the moment I don't see much I can do about this issue.

### [comment:5](#comment:5) by ylzs, [2 years ago](/timeline?from=2022-09-02T13%3A49%3A59Z&precision=second "See timeline at Sep 2, 2022, 1:49:59 PM")

I absolutely agree with you and I think the [#2400](/ticket/2400 "#2400: defect: A heap-buffer-overflow  occurred  in function  play()  of  libaf/af_pan.c (new)") and [#2404](/ticket/2404 "#2404: defect: A heap-buffer-overflow  occurred  in function  play()  of  libaf/af_pan.c (new)") maybe the same cases.

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/2404?format=rss)
* [Comma-delimited Text](/ticket/2404?format=csv)
* [Tab-delimited Text](/ticket/2404?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


