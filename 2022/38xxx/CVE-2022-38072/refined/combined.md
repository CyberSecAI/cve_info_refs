=== Content from github.com_d00a738d_20250114_210930.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadmesh%2Fadmesh%2Fcommit%2F5fab257268a0ee6f832c18d72af89810a29fbd5f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadmesh%2Fadmesh%2Fcommit%2F5fab257268a0ee6f832c18d72af89810a29fbd5f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=admesh%2Fadmesh)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[admesh](/admesh)
/
**[admesh](/admesh/admesh)**
Public

* [Notifications](/login?return_to=%2Fadmesh%2Fadmesh) You must be signed in to change notification settings
* [Fork
  78](/login?return_to=%2Fadmesh%2Fadmesh)
* [Star
   221](/login?return_to=%2Fadmesh%2Fadmesh)

* [Code](/admesh/admesh)
* [Issues
  16](/admesh/admesh/issues)
* [Pull requests
  6](/admesh/admesh/pulls)
* [Actions](/admesh/admesh/actions)
* [Projects
  0](/admesh/admesh/projects)
* [Wiki](/admesh/admesh/wiki)
* [Security](/admesh/admesh/security)
* [Insights](/admesh/admesh/pulse)

Additional navigation options

* [Code](/admesh/admesh)
* [Issues](/admesh/admesh/issues)
* [Pull requests](/admesh/admesh/pulls)
* [Actions](/admesh/admesh/actions)
* [Projects](/admesh/admesh/projects)
* [Wiki](/admesh/admesh/wiki)
* [Security](/admesh/admesh/security)
* [Insights](/admesh/admesh/pulse)

## Commit

[Permalink](/admesh/admesh/commit/5fab257268a0ee6f832c18d72af89810a29fbd5f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Check the neighbor\_index in stl\_check\_normal\_vector

[Browse files](/admesh/admesh/tree/5fab257268a0ee6f832c18d72af89810a29fbd5f)
Browse the repository at this point in the history

```

Fixes [#60](https://github.com/admesh/admesh/issues/60)
```

* Loading branch information

[![@gladk](https://avatars.githubusercontent.com/u/1476497?s=40&v=4)](/gladk)

[gladk](/admesh/admesh/commits?author=gladk "View all commits by gladk")
authored
Nov 18, 2022

1 parent
[767a105](/admesh/admesh/commit/767a105f1f361abe082662435ab90d8bea984a0f)

commit 5fab257

Showing
**1 changed file**
with
**2 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[src/normals.c](#diff-1f88d020fdcaaf7c73ffcb766779d5a6495b17db79b399c8f1fae611e8fceea8 "src/normals.c")

Show comments

[View file](/admesh/admesh/blob/5fab257268a0ee6f832c18d72af89810a29fbd5f/src/normals.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -142,7 +142,8 @@ stl\_fix\_normal\_directions(stl\_file \*stl) { |
|  |  | } |
|  |  | } |
|  |  | /\* If this edge of the facet is connected: \*/ |
|  |  | if(stl->neighbors\_start[facet\_num].neighbor[j] != -1) { |
|  |  | if(stl->neighbors\_start[facet\_num].neighbor[j] != -1 && |
|  |  | stl->neighbors\_start[facet\_num].neighbor[j] < stl->stats.number\_of\_facets\*sizeof(char)) { |
|  |  | /\* If we haven't fixed this facet yet, add it to the list: \*/ |
|  |  | if(norm\_sw[stl->neighbors\_start[facet\_num].neighbor[j]] != 1) { |
|  |  | /\* Add node to beginning of list. \*/ |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5fab257`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadmesh%2Fadmesh%2Fcommit%2F5fab257268a0ee6f832c18d72af89810a29fbd5f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.talosintelligence.com_a99a4e95_20250114_210933.html ===


* [Cisco Login](/users/auth/saml)

* [Intelligence Center](/reputation)

  + [# Intelligence Center](/reputation)
  + BACK
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* [Vulnerability Research](/vulnerability_info)

  + [# Vulnerability Research](/vulnerability_info)
  + BACK
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* [Incident Response](/incident_response)

  + [# Incident Response](/incident_response)
  + BACK
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* [Blog](https://blog.talosintelligence.com)
* [Support](https://support.talosintelligence.com)

More

* Security Resources

  # Security Resources

  + BACK
  Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* Media

  # Media

  + BACK
  Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* Company

  # Company

  + BACK
  Company
  + [About Talos](/about)
  + [Careers](/careers)

* Under Attack?
* [Cisco Login](/users/auth/saml)

## Contact Cisco Talos Incident Response

×

Close

This form is for Incident Response service inquiries only, including emergency network security needs.

For reputation or categorization inquiries, visit the [Talos Support site](/support).
For emergency DDoS mitigation assistance, please contact the [Cisco Secure DDoS Protection Team](https://www.cisco.com/c/en/us/products/collateral/security/ddos-emergency-attack-mitigation-aag.pdf).

Name

Company (optional)

Email address

Phone number

Preferred communication:

Email

Phone

What Incident Response Service are you interested in?
General Talos IR services and retainer information
Emergency Response
IR Plan
IR Playbooks
IR Readiness Assessment
Tabletop Exercises
Compromise Assessment
Threat Hunting
Cyber Range Training
Intelligence on Demand

Please provide as much detail as possible so we can best address your needs

I acknowledge that this is an inquiry for Incident Response services and that any other use of this form will not receive a response.

Send Email
Cancel

# Talos Vulnerability Report

### TALOS-2022-1594

## ADMesh stl\_fix\_normal\_directions improper array index validation vulnerability

##### April 3, 2023

##### CVE Number

CVE-2022-38072

##### SUMMARY

An improper array index validation vulnerability exists in the stl\_fix\_normal\_directions functionality of ADMesh Master Commit 767a105 and v0.98.4. A specially-crafted stl file can lead to a heap buffer overflow. An attacker can provide a malicious file to trigger this vulnerability.

##### CONFIRMED VULNERABLE VERSIONS

The versions below were either tested or verified to be vulnerable by Talos or confirmed to be vulnerable by the vendor.

ADMesh Master Commit 767a105

Slic3r libslic3r Master Commit b1a5500

ADMesh v0.98.4

##### PRODUCT URLS

ADMesh - <https://github.com/admesh/admesh>
libslic3r - <http://slic3r.org>

##### CVSSv3 SCORE

6.5 - CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L

##### CWE

CWE-118 - Incorrect Access of Indexable Resource (‘Range Error’)

##### DETAILS

ADMesh is a C library used to process 3D triangular meshes.

The ADMesh library can be used to repair an STL in different aspects, one of which is the normal direction facet.
Following the ADMesh’s function `stl_fix_normal_directions` can be used to repair the STL to have the facets in normal directions:

```
void stl_fix_normal_directions(stl_file *stl) {
  char *norm_sw;
  [...]

  /* Initialize list that keeps track of already fixed facets. */
  norm_sw = (char*)calloc(stl->stats.number_of_facets, sizeof(char));                                   [1]
  if(norm_sw == NULL) perror("stl_fix_normal_directions");

  [...]

  /* Say that we've fixed this facet: */
  norm_sw[facet_num] = 1;
  checked++;

  for(;;) {
    [...]
      /* If this edge of the facet is connected: */
      if(stl->neighbors_start[facet_num].neighbor[j] != -1) {
        /* If we haven't fixed this facet yet, add it to the list: */
        if(norm_sw[stl->neighbors_start[facet_num].neighbor[j]] != 1) {                                 [2]
          /* Add node to beginning of list. */
          newn = (struct stl_normal*)malloc(sizeof(struct stl_normal));
          if(newn == NULL) perror("stl_fix_normal_directions");
          newn->facet_num = stl->neighbors_start[facet_num].neighbor[j];
          newn->next = head->next;
          head->next = newn;
        }
      }
    }
    [...]
}

```

At `[1]` the array of fixed facets, named `norm_sw`, is allocated using `stl->stats.number_of_facets`. At `[2]` `norm_sw` is accessed using the neighbor value of the facets that the loop is currently fixing. Based on the provided STL, this value can exceed the actual capacity of the `norm_sw` array.

Indeed, we can analyze, at `[2]`, the relevant values to realize that `norm_sw` is accessed out of bounds:

```
(gdb) heap chunk norm_sw
Chunk(addr=0x560a136a6890, size=0xe10, flags=PREV_INUSE)
Chunk size: 3600 (0xe10)
Usable size: 3592 (0xe08)
Previous chunk size: 139680311529408 (0x7f09db59cfc0)
PREV_INUSE flag: On
IS_MMAPPED flag: Off
NON_MAIN_ARENA flag: Off

```

Because `norm_sw` is an array of characters, we have exactly 0xe08 usable positions. However, at a certain point we will have the following:

```
(gdb) p stl->neighbors_start[facet_num].neighbor[j]
$1 = 0xe7d

```

So `norm_sw[stl->neighbors_start[facet_num].neighbor[j]]` is going to access out of the bounds of `norm_sw`:

```
(gdb) p &norm_sw[stl->neighbors_start[facet_num].neighbor[j]]
$23 = 0x55555555d70d "U"

(gdb) p *(struct stl_normal *) 0x0055555555d700
$21 = {
  facet_num = 0x824d,
  next = 0x55555555d6e0
}

```

Because no check about the value used as index is performed, with the STL tested, the instruction at `[2]` will access the memory region of one of the nodes created inside the code block executed if `[2]` is true. Later on, a 1 is going to be written at `norm_sw[stl->neighbors_start[facet_num].neighbor[j]]` position.

### Crash Information

```
=================================================================
==8==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x620000000efd at pc 0x7ffff78fcdee bp 0x7fffffffe240 sp 0x7fffffffe238
READ of size 1 at 0x620000000efd thread T0
    #0 0x7ffff78fcded in stl_fix_normal_directions /app/admesh/src/normals.c:147
    #1 0x7ffff79132a5 in stl_repair /app/admesh/src/util.c:603
    #2 0x55555555a955 in main /app/admesh/src/admesh.c:383
    #3 0x7ffff75f381c in __libc_start_main ../csu/libc-start.c:332
    #4 0x555555558349 in _start (/app/admesh/build/admesh+0x4349)

0x620000000efd is located 119 bytes to the right of 3590-byte region [0x620000000080,0x620000000e86)
allocated by thread T0 here:
    #0 0x7ffff79d53b7 in __interceptor_calloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:77
    #1 0x7ffff78fcace in stl_fix_normal_directions /app/admesh/src/normals.c:117
    #2 0x7ffff79132a5 in stl_repair /app/admesh/src/util.c:603
    #3 0x55555555a955 in main /app/admesh/src/admesh.c:383
    #4 0x7ffff75f381c in __libc_start_main ../csu/libc-start.c:332

SUMMARY: AddressSanitizer: heap-buffer-overflow /app/admesh/src/normals.c:147 in stl_fix_normal_directions
Shadow bytes around the buggy address:
  0x0c407fff8180: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c407fff8190: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c407fff81a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c407fff81b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c407fff81c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x0c407fff81d0: 06 fa fa fa fa fa fa fa fa fa fa fa fa fa fa[fa]
  0x0c407fff81e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c407fff81f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c407fff8200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c407fff8210: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c407fff8220: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==8==ABORTING

```
##### TIMELINE

2022-09-01 - Initial Vendor Contact

2022-09-13 - Vendor Disclosure

2022-11-21 - Vendor Patch Release

2023-04-03 - Public Release

##### Credit

Discovered by Francesco Benvenuto of Cisco Talos.

---

[Vulnerability Reports](/vulnerability_reports) [Next Report

TALOS-2022-1673](/vulnerability_reports/TALOS-2022-1673) [Previous Report

TALOS-2022-1597](/vulnerability_reports/TALOS-2022-1597)

* + ###### [Intelligence Center](/reputation)
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* + ###### [Vulnerability Research](/vulnerability_info)
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* + ###### [Incident Response](/incident_response)
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* + ###### Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* + ###### Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* + ###### Support
  + [Support Documentation](https://support.talosintelligence.com)
* + ###### Company
  + [About Talos](/about)
  + [Careers](/careers)
  + [Cisco Security](https://www.cisco.com/c/en/us/products/security/product-listing.html)

###### Follow us

[![Cisco](/assets/logo_cisco_white-d87b7f7d3152ad412e48aad924a972cc5b802b7a53cb56b0792a4456c9b7b3a5.svg)](http://tools.cisco.com/security/center/home.x)

©
2025
Cisco Systems, Inc. and/or its affiliates. All rights
reserved. View our
[Privacy Policy.](http://www.cisco.com/web/siteassets/legal/privacy_full.html)



=== Content from talosintelligence.com_8edd83b1_20250114_210932.html ===


* [Cisco Login](/users/auth/saml)

* [Intelligence Center](/reputation)

  + [# Intelligence Center](/reputation)
  + BACK
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* [Vulnerability Research](/vulnerability_info)

  + [# Vulnerability Research](/vulnerability_info)
  + BACK
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* [Incident Response](/incident_response)

  + [# Incident Response](/incident_response)
  + BACK
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* [Blog](https://blog.talosintelligence.com)
* [Support](https://support.talosintelligence.com)

More

* Security Resources

  # Security Resources

  + BACK
  Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* Media

  # Media

  + BACK
  Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* Company

  # Company

  + BACK
  Company
  + [About Talos](/about)
  + [Careers](/careers)

* Under Attack?
* [Cisco Login](/users/auth/saml)

## Contact Cisco Talos Incident Response

×

Close

This form is for Incident Response service inquiries only, including emergency network security needs.

For reputation or categorization inquiries, visit the [Talos Support site](/support).
For emergency DDoS mitigation assistance, please contact the [Cisco Secure DDoS Protection Team](https://www.cisco.com/c/en/us/products/collateral/security/ddos-emergency-attack-mitigation-aag.pdf).

Name

Company (optional)

Email address

Phone number

Preferred communication:

Email

Phone

What Incident Response Service are you interested in?
General Talos IR services and retainer information
Emergency Response
IR Plan
IR Playbooks
IR Readiness Assessment
Tabletop Exercises
Compromise Assessment
Threat Hunting
Cyber Range Training
Intelligence on Demand

Please provide as much detail as possible so we can best address your needs

I acknowledge that this is an inquiry for Incident Response services and that any other use of this form will not receive a response.

Send Email
Cancel

# Talos Vulnerability Report

### TALOS-2022-1594

## ADMesh stl\_fix\_normal\_directions improper array index validation vulnerability

##### April 3, 2023

##### CVE Number

CVE-2022-38072

##### SUMMARY

An improper array index validation vulnerability exists in the stl\_fix\_normal\_directions functionality of ADMesh Master Commit 767a105 and v0.98.4. A specially-crafted stl file can lead to a heap buffer overflow. An attacker can provide a malicious file to trigger this vulnerability.

##### CONFIRMED VULNERABLE VERSIONS

The versions below were either tested or verified to be vulnerable by Talos or confirmed to be vulnerable by the vendor.

ADMesh Master Commit 767a105

Slic3r libslic3r Master Commit b1a5500

ADMesh v0.98.4

##### PRODUCT URLS

ADMesh - <https://github.com/admesh/admesh>
libslic3r - <http://slic3r.org>

##### CVSSv3 SCORE

6.5 - CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L

##### CWE

CWE-118 - Incorrect Access of Indexable Resource (‘Range Error’)

##### DETAILS

ADMesh is a C library used to process 3D triangular meshes.

The ADMesh library can be used to repair an STL in different aspects, one of which is the normal direction facet.
Following the ADMesh’s function `stl_fix_normal_directions` can be used to repair the STL to have the facets in normal directions:

```
void stl_fix_normal_directions(stl_file *stl) {
  char *norm_sw;
  [...]

  /* Initialize list that keeps track of already fixed facets. */
  norm_sw = (char*)calloc(stl->stats.number_of_facets, sizeof(char));                                   [1]
  if(norm_sw == NULL) perror("stl_fix_normal_directions");

  [...]

  /* Say that we've fixed this facet: */
  norm_sw[facet_num] = 1;
  checked++;

  for(;;) {
    [...]
      /* If this edge of the facet is connected: */
      if(stl->neighbors_start[facet_num].neighbor[j] != -1) {
        /* If we haven't fixed this facet yet, add it to the list: */
        if(norm_sw[stl->neighbors_start[facet_num].neighbor[j]] != 1) {                                 [2]
          /* Add node to beginning of list. */
          newn = (struct stl_normal*)malloc(sizeof(struct stl_normal));
          if(newn == NULL) perror("stl_fix_normal_directions");
          newn->facet_num = stl->neighbors_start[facet_num].neighbor[j];
          newn->next = head->next;
          head->next = newn;
        }
      }
    }
    [...]
}

```

At `[1]` the array of fixed facets, named `norm_sw`, is allocated using `stl->stats.number_of_facets`. At `[2]` `norm_sw` is accessed using the neighbor value of the facets that the loop is currently fixing. Based on the provided STL, this value can exceed the actual capacity of the `norm_sw` array.

Indeed, we can analyze, at `[2]`, the relevant values to realize that `norm_sw` is accessed out of bounds:

```
(gdb) heap chunk norm_sw
Chunk(addr=0x560a136a6890, size=0xe10, flags=PREV_INUSE)
Chunk size: 3600 (0xe10)
Usable size: 3592 (0xe08)
Previous chunk size: 139680311529408 (0x7f09db59cfc0)
PREV_INUSE flag: On
IS_MMAPPED flag: Off
NON_MAIN_ARENA flag: Off

```

Because `norm_sw` is an array of characters, we have exactly 0xe08 usable positions. However, at a certain point we will have the following:

```
(gdb) p stl->neighbors_start[facet_num].neighbor[j]
$1 = 0xe7d

```

So `norm_sw[stl->neighbors_start[facet_num].neighbor[j]]` is going to access out of the bounds of `norm_sw`:

```
(gdb) p &norm_sw[stl->neighbors_start[facet_num].neighbor[j]]
$23 = 0x55555555d70d "U"

(gdb) p *(struct stl_normal *) 0x0055555555d700
$21 = {
  facet_num = 0x824d,
  next = 0x55555555d6e0
}

```

Because no check about the value used as index is performed, with the STL tested, the instruction at `[2]` will access the memory region of one of the nodes created inside the code block executed if `[2]` is true. Later on, a 1 is going to be written at `norm_sw[stl->neighbors_start[facet_num].neighbor[j]]` position.

### Crash Information

```
=================================================================
==8==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x620000000efd at pc 0x7ffff78fcdee bp 0x7fffffffe240 sp 0x7fffffffe238
READ of size 1 at 0x620000000efd thread T0
    #0 0x7ffff78fcded in stl_fix_normal_directions /app/admesh/src/normals.c:147
    #1 0x7ffff79132a5 in stl_repair /app/admesh/src/util.c:603
    #2 0x55555555a955 in main /app/admesh/src/admesh.c:383
    #3 0x7ffff75f381c in __libc_start_main ../csu/libc-start.c:332
    #4 0x555555558349 in _start (/app/admesh/build/admesh+0x4349)

0x620000000efd is located 119 bytes to the right of 3590-byte region [0x620000000080,0x620000000e86)
allocated by thread T0 here:
    #0 0x7ffff79d53b7 in __interceptor_calloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:77
    #1 0x7ffff78fcace in stl_fix_normal_directions /app/admesh/src/normals.c:117
    #2 0x7ffff79132a5 in stl_repair /app/admesh/src/util.c:603
    #3 0x55555555a955 in main /app/admesh/src/admesh.c:383
    #4 0x7ffff75f381c in __libc_start_main ../csu/libc-start.c:332

SUMMARY: AddressSanitizer: heap-buffer-overflow /app/admesh/src/normals.c:147 in stl_fix_normal_directions
Shadow bytes around the buggy address:
  0x0c407fff8180: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c407fff8190: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c407fff81a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c407fff81b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c407fff81c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x0c407fff81d0: 06 fa fa fa fa fa fa fa fa fa fa fa fa fa fa[fa]
  0x0c407fff81e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c407fff81f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c407fff8200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c407fff8210: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c407fff8220: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==8==ABORTING

```
##### TIMELINE

2022-09-01 - Initial Vendor Contact

2022-09-13 - Vendor Disclosure

2022-11-21 - Vendor Patch Release

2023-04-03 - Public Release

##### Credit

Discovered by Francesco Benvenuto of Cisco Talos.

---

[Vulnerability Reports](/vulnerability_reports) [Next Report

TALOS-2022-1673](/vulnerability_reports/TALOS-2022-1673) [Previous Report

TALOS-2022-1597](/vulnerability_reports/TALOS-2022-1597)

* + ###### [Intelligence Center](/reputation)
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* + ###### [Vulnerability Research](/vulnerability_info)
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* + ###### [Incident Response](/incident_response)
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* + ###### Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* + ###### Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* + ###### Support
  + [Support Documentation](https://support.talosintelligence.com)
* + ###### Company
  + [About Talos](/about)
  + [Careers](/careers)
  + [Cisco Security](https://www.cisco.com/c/en/us/products/security/product-listing.html)

###### Follow us

[![Cisco](/assets/logo_cisco_white-d87b7f7d3152ad412e48aad924a972cc5b802b7a53cb56b0792a4456c9b7b3a5.svg)](http://tools.cisco.com/security/center/home.x)

©
2025
Cisco Systems, Inc. and/or its affiliates. All rights
reserved. View our
[Privacy Policy.](http://www.cisco.com/web/siteassets/legal/privacy_full.html)


