=== Content from trac.mplayerhq.hu_77cc5e87_20250114_213803.html ===


[![MPlayer - The Movie Player](https://mplayerhq.hu/mplayer-logo.png)](https://mplayerhq.hu/)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/query)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ← [Previous Ticket](/ticket/2406 "Ticket #2406")
* [Next Ticket](/ticket/2408 "Ticket #2408") →

---

Opened [2 years ago](/timeline?from=2022-08-24T07%3A16%3A34Z&precision=second "See timeline at Aug 24, 2022, 7:16:34 AM")

Closed [2 years ago](/timeline?from=2022-09-01T18%3A26%3A03Z&precision=second "See timeline at Sep 1, 2022, 6:26:03 PM")

## [#2407](/ticket/2407) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# A heap memory corruption occurred in function free\_mp\_image() of libmpcodecs/mp\_image.c

| Reported by: | [ylzs](/query?reporter=ylzs&status=!closed) | Owned by: | [beastd](/query?owner=beastd&status=!closed) |
| --- | --- | --- | --- |
| Priority: | [normal](/query?priority=normal&status=!closed) | Component: | [undetermined](/query?component=undetermined&status=!closed) |
| Version: | [HEAD](/query?status=!closed&version=HEAD) | Severity: | [major](/query?severity=major&status=!closed) |
| Keywords: |  | Cc: |  |
| Blocked By: |  | Blocking: |  |
| Reproduced by developer: | [no](/query?reproduced=0&status=!closed) | Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |

## Description

Version: SVN-r38374-13.0.1

Build command: ../configure --disable-ffmpeg\_a && make (compiling with asan)

Summary of the bug: I found a heap memory corruption crash when I tried to fuzz the mencoder.

```
[ … ]
1 duplicate frame(s)!                                                                                                                                                                                                                     Pos:   0.0s      3f (100%)  0.00fps Trem:   0min   0mb  A-V:0.000 [0:0]
Movie-Aspect is undefined - no prescaling applied.
Writing header...                                                                                                                                                                                                                         ODML: Aspect information not (yet?) available or unspecified, not writing vprp header.                                                                                                                                                    Writing header...
ODML: Aspect information not (yet?) available or unspecified, not writing vprp header.                                                                                                                                                    Writing header...
ODML: Aspect information not (yet?) available or unspecified, not writing vprp header.                                                                                                                                                    Writing header...                                                                                                                                                                                                                         ODML: Aspect information not (yet?) available or unspecified, not writing vprp header.                                                                                                                                                    Pos:   0.0s      4f (100%)  0.00fps Trem:   0min   0mb  A-V:0.000 [0:0]

Skipping frame!                                                                                                                                                                                                                           Pos:   0.0s      5f (100%)  0.00fps Trem:   0min   0mb  A-V:0.000 [0:0]
                                                                                                                                                                                                                                          Flushing video frames.
Writing index...                                                                                                                                                                                                                          Writing header...                                                                                                                                                                                                                         ODML: Aspect information not (yet?) available or unspecified, not writing vprp header.

Video stream: 743743.500 kbit/s  (92967937 B/s)  size: 16892 bytes  0.000 secs  5 frames                                                                                                                                                  double free or corruption (out)
Aborted

```

But when I try to debug this crash to figure out the reason I find the free function’s argument is not a heap address. The pointer points to a block of memory which is full of 0x80.

```
Breakpoint 1, free_mp_image (mpi=0x60e000000120) at libmpcodecs/mp_image.c:271
271             av_free(mpi->planes[0]);
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
───────────────────────────────────────────────────────────────────────────────────────[ REGISTERS ]───────────────────────────────────────────────────────────────────────────────────────
 RAX  0x2b00
 RBX  0xc1c00000024 ◂— 0x0
 RCX  0x7fffed1ff800 ◂— 0xbfbebfbebebebebe
 RDX  0x1
 RDI  0x60e000000120 —▸ 0x40000c30f ◂— 0x0
 RSI  0x7fffee7f90e0 ◂— 0x0
 R8   0xd8
 R9   0x7fffee489708 —▸ 0x555555857598 (uninit_video+216) ◂— mov    qword ptr [rip + 0xf57d5d], 0
 R10  0x7fffffffcd20 —▸ 0x555555857598 (uninit_video+216) ◂— mov    qword ptr [rip + 0xf57d5d], 0
 R11  0x20
 R12  0x0
 R13  0xffffffffad5 ◂— 0x0
 R14  0x555555ec7fa0 (__afl_area_ptr) —▸ 0x7fffed1ff800 ◂— 0xbfbebfbebebebebe
 R15  0x60e000000120 —▸ 0x40000c30f ◂— 0x0
 RBP  0x7fffffffdda0 ◂— 0x0
 RSP  0x7fffffffd5e0 —▸ 0x616000000380 —▸ 0x555555e1c380 (vf_info_expand) —▸ 0x555555d82360 (str) ◂— 'expanding & osd'                                                                                                                                                                                                                                                                 RIP  0x55555585ec3b (free_mp_image+107) ◂— lea    rdi, [r15 + 0x30]
────────────────────────────────────────────────────────────────────────────────────────────────────────────────[ DISASM ]────────────────────────────────────────────────────────────────────────────────────────────────────────────────                                                                                                                                             ► 0x55555585ec3b <free_mp_image+107>    lea    rdi, [r15 + 0x30]
   0x55555585ec3f <free_mp_image+111>    mov    rax, rdi
   0x55555585ec42 <free_mp_image+114>    shr    rax, 3
   0x55555585ec46 <free_mp_image+118>    cmp    byte ptr [rax + 0x7fff8000], 0
   0x55555585ec4d <free_mp_image+125>    jne    free_mp_image+294 <free_mp_image+294>

   0x55555585ec53 <free_mp_image+131>    mov    rdi, qword ptr [r15 + 0x30]
   0x55555585ec57 <free_mp_image+135>    call   av_free@plt <av_free@plt>

   0x55555585ec5c <free_mp_image+140>    mov    al, byte ptr [rbx + 0x7fff8000]
   0x55555585ec62 <free_mp_image+146>    test   al, al
   0x55555585ec64 <free_mp_image+148>    jne    free_mp_image+269 <free_mp_image+269>
                                                                                                                                                                                                                                                                                                                                                                                         0x55555585ec66 <free_mp_image+150>    test   byte ptr [r15 + 1], 8                                                                                                                                                                                                                                                                                                                 ────────────────────────────────────────────────────────────────────────────────────────────────────────────[ SOURCE (CODE) ]─────────────────────────────────────────────────────────────────────────────────────────────────────────────                                                                                                                                            In file: /home/jlx/good_mplayer/asan_mplayer/libmpcodecs/mp_image.c                                                                                                                                                                                                                                                                                                                      266
   267 void free_mp_image(mp_image_t* mpi){
   268     if(!mpi) return;
   269     if(mpi->flags&MP_IMGFLAG_ALLOCATED){
   270         /* because we allocate the whole image at once */
 ► 271         av_free(mpi->planes[0]);
   272         if (mpi->flags & MP_IMGFLAG_RGB_PALETTE)
   273             av_free(mpi->planes[1]);
   274     }
   275     free(mpi);
   276 }
────────────────────────────────────────────────────────────────────────────────────────────────────────────────[ STACK ]─────────────────────────────────────────────────────────────────────────────────────────────────────────────────                                                                                                                                            00:0000│ rsp  0x7fffffffd5e0 —▸ 0x616000000380 —▸ 0x555555e1c380 (vf_info_expand) —▸ 0x555555d82360 (str) ◂— 'expanding & osd'                                                                                                                                                                                                                                                        01:0008│      0x7fffffffd5e8 —▸ 0x555555ec7fa0 (__afl_area_ptr) —▸ 0x7fffed1ff800 ◂— 0xbfbebfbebebebebe
02:0010│      0x7fffffffd5f0 —▸ 0x616000000080 —▸ 0x555555e0b5c0 (ve_info_lavc) —▸ 0x555555c7b640 (str) ◂— 'libavcodec encoder'                                                                                                                                                                                                                                                       03:0018│      0x7fffffffd5f8 —▸ 0x55555587b998 (vf_uninit_filter_chain+200) ◂— lea    rdi, [rbx + 0x68]
04:0020│      0x7fffffffd600 —▸ 0x61a000001130 —▸ 0x616000000380 —▸ 0x555555e1c380 (vf_info_expand) —▸ 0x555555d82360 (str) ◂— ...                                                                                                                                                                                                                                                    05:0028│      0x7fffffffd608 —▸ 0x61a000000c94 ◂— 0x1
06:0030│      0x7fffffffd610 —▸ 0xc3400000192 ◂— 0x0
07:0038│      0x7fffffffd618 —▸ 0x5555558575c6 (uninit_video+262) ◂— call   0x555555af5820
──────────────────────────────────────────────────────────────────────────────────────────────────────────────[ BACKTRACE ]───────────────────────────────────────────────────────────────────────────────────────────────────────────────                                                                                                                                             ► f 0     55555585ec3b free_mp_image+107
   f 1     55555587b998 vf_uninit_filter_chain+200
   f 2     55555587b998 vf_uninit_filter_chain+200
   f 3     5555558575c6 uninit_video+262
   f 4     555555737d1b main+47819
   f 5     7ffff55070b3 __libc_start_main+243
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────                                                                                                                                            pwndbg> p mpi->planes[0]
$4 = (unsigned char *) 0x7fffeb6cb040 '\200' <repeats 200 times>...
pwndbg> vmmap 0x7fffeb6cb040
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
    0x7fffeb490000     0x7fffebf19000 rw-p   a89000 0       +0x23b040

```

How to reproduce:

1.Command: ./mencoder -ovc lavc -oac lavc -o /dev/null ./testcase

### Attachments (2)

[testcase](/attachment/ticket/2407/testcase "View attachment")[​](/raw-attachment/ticket/2407/testcase "Download")
(642 bytes
) - added by ylzs [2 years ago](/timeline?from=2022-08-24T07%3A16%3A42Z&precision=second "See timeline at Aug 24, 2022, 7:16:42 AM").
[valgrind\_output](/attachment/ticket/2407/valgrind_output "View attachment")[​](/raw-attachment/ticket/2407/valgrind_output "Download")
(20.1 KB
) - added by ylzs [2 years ago](/timeline?from=2022-08-31T01%3A51%3A26Z&precision=second "See timeline at Aug 31, 2022, 1:51:26 AM").

Download all attachments as:
[.zip](/zip-attachment/ticket/2407/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (7)

### by ylzs, [2 years ago](/timeline?from=2022-08-24T07%3A16%3A42Z&precision=second "See timeline at Aug 24, 2022, 7:16:42 AM")

| Attachment: | [*testcase*](/attachment/ticket/2407/testcase)[​](/raw-attachment/ticket/2407/testcase "Download") added |
| --- | --- |

### [comment:1](#comment:1) by reimar, [2 years ago](/timeline?from=2022-08-26T21%3A25%3A07Z&precision=second "See timeline at Aug 26, 2022, 9:25:07 PM")

Cannot reproduce unfortunately

### [comment:2](#comment:2) by ylzs, [2 years ago](/timeline?from=2022-08-29T02%3A45%3A37Z&precision=second "See timeline at Aug 29, 2022, 2:45:37 AM")

I get all these testcase on an amd64 vitural machine with ubuntu 20.04 as OS.And I compile the mencoder and mplayer with clang version 13.0.1-++20220120110924+75e33f71c2da-1~exp1~20220120231001.58.

I'm not familiar with the internal of the mpalyer and mencoder so I don't kown why t some testcase can't reproduce the bug. I 'm sorry about this.

### [comment:3](#comment:3) by reimar, [2 years ago](/timeline?from=2022-08-30T20%3A50%3A08Z&precision=second "See timeline at Aug 30, 2022, 8:50:08 PM")

It's suspicious that it's all the mencoder ones I cannot reproduce, not sure what the difference might be.

Can you run the problematic testcase with valgrind instead of ASAN? It might provide more useful information, which might be enough to fix even though I cannot reproduce it.

### [comment:4](#comment:4) by ylzs, [2 years ago](/timeline?from=2022-08-31T01%3A51%3A10Z&precision=second "See timeline at Aug 31, 2022, 1:51:10 AM")

I've run this testcase with the valgrind and put the result into another attached file.I hope this can help you.

### by ylzs, [2 years ago](/timeline?from=2022-08-31T01%3A51%3A26Z&precision=second "See timeline at Aug 31, 2022, 1:51:26 AM")

| Attachment: | [*valgrind\_output*](/attachment/ticket/2407/valgrind_output)[​](/raw-attachment/ticket/2407/valgrind_output "Download") added |
| --- | --- |

### [comment:5](#comment:5) by reimar, [2 years ago](/timeline?from=2022-09-01T18%3A26%3A03Z&precision=second "See timeline at Sep 1, 2022, 6:26:03 PM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

If the valgrind output is accurate this should be fixed by r38402

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/2407?format=rss)
* [Comma-delimited Text](/ticket/2407?format=csv)
* [Tab-delimited Text](/ticket/2407?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>



=== Content from lists.debian.org_6d9e1485_20250114_213801.html ===


---

[[Date Prev](msg00041.html)][[Date Next](msg00043.html)]
[[Thread Prev](msg00041.html)][[Thread Next](msg00043.html)]
[[Date Index](maillist.html#00042)]
[[Thread Index](threads.html#00042)]

# [SECURITY] [DLA 3255-1] mplayer security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3255-1] mplayer security update
* *From*: Thorsten Alteholz <debian@alteholz.de>
* *Date*: Sat, 31 Dec 2022 12:41:46 +0000 (UTC)
* *Message-id*: <[[🔎]](/msgid-search/alpine.DEB.2.21.2212311236020.8533%40postfach.intern.alteholz.me) [alpine.DEB.2.21.2212311236020.8533@postfach.intern.alteholz.me](msg00042.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3255-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                    Thorsten Alteholz
December 31, 2022                             <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : mplayer
Version        : 2:1.3.0-8+deb10u1
CVE ID         : CVE-2022-38850 CVE-2022-38851 CVE-2022-38855
                 CVE-2022-38858 CVE-2022-38860 CVE-2022-38861
                 CVE-2022-38863 CVE-2022-38864 CVE-2022-38865
                 CVE-2022-38866

```
Several issues have been found in mplayer, a movie player for Unix-like
systems.
They are basically related to buffer overflows, divide by zero or out of
bounds read in different parts of the code.
```

For Debian 10 buster, these problems have been fixed in version
2:1.3.0-8+deb10u1.

We recommend that you upgrade your mplayer packages.

For the detailed security status of mplayer please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/mplayer>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEEYgH7/9u94Hgi6ruWlvysDTh7WEcFAmOwLgpfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDYy
MDFGQkZGREJCREUwNzgyMkVBQkI5Njk2RkNBQzBEMzg3QjU4NDcACgkQlvysDTh7
WEcSSw//YnUhGZQ3yL66mxKWiDvH3UmetHiRucR93NvU7aEXBeexDIg5QwSTiOgk
AaLIHg/Y5eLJ0XhAk7ID//JIb6xBSpyCUYxesvPpJAagmHwTzndxzcoPFtMXlPxT
MTUUPfJ3H7577J6hTI6XOS83m9TOjkRlTv13UA62snwGNaHnCtlMGrR4QYEv9HW4
sGCdzbI94oAeRP62am4cPsg8zH7z6A2a1T6PObSSrPjN/imBFj+Yt2KmygY8LPAo
j26TlnywgNnclHqfQJ4E3SECwbhNEW5cmLezZ4uky7TnLvzXUG+0Xv13h9v3coOm
LnHXC6QBAFFizgA8ntfo9rwtTHp7asUxoe0+qXS/XDBhK+2calGYS5VA+58hESOz
QP9Zdj/Qu3YlWaz3sThEECePNmU2KZI9yNWKjywr8EIXIncgsEKGfM7TDzXmPE3p
+KBS9yv6KzShSBUGpXEv8ZK7K8RQyieIBWy9AljJzWVndejd5yEgoRJPJNpYZOd3
Tp5bbRRedLio277bMR+FOj571nnSALOIRWS/IuY3KaE/UPGbf7qjSxR5II1i3Bwb
ZD6Ub215L0tIeUAkF3JHiJfSBIPRuCgBqq6Ga7NIb3rWP1QOnHEE+37kx7w76txf
hzmJygl/2gxIW+2YGyRynbR4BgcHx1xsJqbdlxaZfb9RSLi2VRE=
=KrDp
-----END PGP SIGNATURE-----

```

---


