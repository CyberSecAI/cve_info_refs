=== Content from trac.mplayerhq.hu_a5ad9b83_20250114_191646.html ===


[![MPlayer - The Movie Player](https://mplayerhq.hu/mplayer-logo.png)](https://mplayerhq.hu/)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/query)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ← [Previous Ticket](/ticket/2397 "Ticket #2397")
* [Next Ticket](/ticket/2399 "Ticket #2399") →

---

Opened [2 years ago](/timeline?from=2022-08-23T07%3A51%3A02Z&precision=second "See timeline at Aug 23, 2022, 7:51:02 AM")

Closed [2 years ago](/timeline?from=2022-08-26T13%3A53%3A01Z&precision=second "See timeline at Aug 26, 2022, 1:53:01 PM")

Last modified [2 years ago](/timeline?from=2022-08-26T13%3A56%3A43Z&precision=second "See timeline at Aug 26, 2022, 1:56:43 PM")

## [#2398](/ticket/2398) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# A heap-buffer-overflow occurred in function asf\_init\_audio\_stream() of libmpdemux/asfheader.c

| Reported by: | [ylzs](/query?reporter=ylzs&status=!closed) | Owned by: | [beastd](/query?owner=beastd&status=!closed) |
| --- | --- | --- | --- |
| Priority: | [normal](/query?priority=normal&status=!closed) | Component: | [undetermined](/query?component=undetermined&status=!closed) |
| Version: | [HEAD](/query?status=!closed&version=HEAD) | Severity: | [major](/query?severity=major&status=!closed) |
| Keywords: |  | Cc: |  |
| Blocked By: |  | Blocking: |  |
| Reproduced by developer: | [no](/query?reproduced=0&status=!closed) | Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |

## Description

Version: SVN-r38374-13.0.1

Build command: ../configure --disable-ffmpeg\_a && make (compiling with asan)

Summary of the bug: An heap-buffer-overflow is found in fucnction asf\_init\_audio\_stream() which affects mplayer and mencoder. The attached file can reproduce this issue (ASAN-recompilation is needed).

How to reproduce:

1.Command: ./mplayer testcase

2.Result:

```
MPlayer SVN-r38374-13.0.1 (C) 2000-2022 MPlayer Team

Playing
libavformat version 58.29.100 (external)
ASF file format detected.
[asfheader] Audio stream found, -aid 21
=================================================================
==6235==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x615000000261 at pc 0x559f0c51f2c2 bp 0x7ffcb2476300 sp 0x7ffcb24762f8
READ of size 1 at 0x615000000261 thread T0
    #0 0x559f0c51f2c1 in asf_init_audio_stream /home/jlx/good_mplayer/mplayer/libmpdemux/asfheader.c:359:24

0x615000000261 is located 0 bytes to the right of 481-byte region [0x615000000080,0x615000000261)
allocated by thread T0 here:
    #0 0x559f0c1e01cd in malloc (/home/jlx/good_mplayer/asan_mplayer/mplayer+0x3431cd)
    #1 0x559f0c51a6e0 in read_asf_header /home/jlx/good_mplayer/mplayer/libmpdemux/asfheader.c:406:9
    #2 0x559f0c549e53 in demux_open_asf /home/jlx/good_mplayer/mplayer/libmpdemux/demux_asf.c:629:10

SUMMARY: AddressSanitizer: heap-buffer-overflow /home/jlx/good_mplayer/mplayer/libmpdemux/asfheader.c:359:24 in asf_init_audio_stream
Shadow bytes around the buggy address:
  0x0c2a7fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c2a7fff8000: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c2a7fff8010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c2a7fff8020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c2a7fff8030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x0c2a7fff8040: 00 00 00 00 00 00 00 00 00 00 00 00[01]fa fa fa
  0x0c2a7fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c2a7fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c2a7fff8070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c2a7fff8080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c2a7fff8090: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==6235==ABORTING

```

### Attachments (1)

[testcase](/attachment/ticket/2398/testcase "View attachment")[​](/raw-attachment/ticket/2398/testcase "Download")
(569 bytes
) - added by ylzs [2 years ago](/timeline?from=2022-08-23T07%3A52%3A41Z&precision=second "See timeline at Aug 23, 2022, 7:52:41 AM").

Download all attachments as:
[.zip](/zip-attachment/ticket/2398/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (4)

### by ylzs, [2 years ago](/timeline?from=2022-08-23T07%3A52%3A41Z&precision=second "See timeline at Aug 23, 2022, 7:52:41 AM")

| Attachment: | [*testcase*](/attachment/ticket/2398/testcase)[​](/raw-attachment/ticket/2398/testcase "Download") added |
| --- | --- |

### [comment:1](#comment:1) by ylzs, [2 years ago](/timeline?from=2022-08-23T08%3A25%3A38Z&precision=second "See timeline at Aug 23, 2022, 8:25:38 AM")

| Severity: | critical → major |
| --- | --- |

### [comment:2](#comment:2) by reimar, [2 years ago](/timeline?from=2022-08-26T13%3A53%3A01Z&precision=second "See timeline at Aug 26, 2022, 1:53:01 PM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

Seems fixed by r38380.

### [comment:3](#comment:3) by reimar, [2 years ago](/timeline?from=2022-08-26T13%3A56%3A43Z&precision=second "See timeline at Aug 26, 2022, 1:56:43 PM")

Minor note: When reporting this many issues it might make sense to give different priority or severity to invalid reads a short distance after the buffer vs other issue including invalid writes.

While there multiple issues here, this specific one could likely only read at most 5 bytes over the buffer, which limits its severity.

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/2398?format=rss)
* [Comma-delimited Text](/ticket/2398?format=csv)
* [Tab-delimited Text](/ticket/2398?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


