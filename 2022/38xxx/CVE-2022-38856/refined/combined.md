=== Content from trac.mplayerhq.hu_20005a8e_20250114_211845.html ===


[![MPlayer - The Movie Player](https://mplayerhq.hu/mplayer-logo.png)](https://mplayerhq.hu/)

Search:

* [Login](/login)
* [Preferences](/prefs)
* [Help/Guide](/wiki/TracGuide)
* [About Trac](/about)
* [Register](/register)
* [Forgot your password?](/reset_password)

* [Wiki](/wiki)
* [Timeline](/timeline)
* [View Tickets](/query)
* [Search](/search)
* [Tags](/tags)

## Context Navigation

* ← [Previous Ticket](/ticket/2394 "Ticket #2394")
* [Next Ticket](/ticket/2396 "Ticket #2396") →

---

Opened [2 years ago](/timeline?from=2022-08-23T06%3A52%3A18Z&precision=second "See timeline at Aug 23, 2022, 6:52:18 AM")

Closed [2 years ago](/timeline?from=2022-09-01T18%3A25%3A04Z&precision=second "See timeline at Sep 1, 2022, 6:25:04 PM")

## [#2395](/ticket/2395) [closed](/query?status=closed) [defect](/query?status=!closed&type=defect) ([fixed](/query?resolution=fixed&status=closed))

# A heap-buffer-overflow occurred in function mov\_build\_index() of libmpdemux/demux\_mov.c

| Reported by: | [ylzs](/query?reporter=ylzs&status=!closed) | Owned by: | [beastd](/query?owner=beastd&status=!closed) |
| --- | --- | --- | --- |
| Priority: | [normal](/query?priority=normal&status=!closed) | Component: | [undetermined](/query?component=undetermined&status=!closed) |
| Version: | [HEAD](/query?status=!closed&version=HEAD) | Severity: | [major](/query?severity=major&status=!closed) |
| Keywords: |  | Cc: |  |
| Blocked By: |  | Blocking: |  |
| Reproduced by developer: | [no](/query?reproduced=0&status=!closed) | Analyzed by developer: | [no](/query?analyzed=0&status=!closed) |

## Description [(last modified by ylzs)](/ticket/2395?action=diff&version=1 "2022-08-23 07:56:34.775753+00:00")

Version: SVN-r38374-13.0.1

Build command: ../configure --disable-ffmpeg\_a && make (compiling with asan)

Summary of the bug: An heap-buffer-overflow is found in fucnction mov\_build\_index () which affects mplayer and mencoder. The attached file can reproduce this issue (ASAN-recompilation is needed).

How to reproduce:

1.Command: ./mplayer testcase

2.Result:

```
MPlayer SVN-r38374-13.0.1 (C) 2000-2022 MPlayer Team

Playing
libavformat version 58.29.100 (external)
libavformat file format detected.
[mov,mp4,m4a,3gp,3g2,mj2 @ 0x7f665a275600]Version 22 is not implemented. Update your FFmpeg version to the newest one from Git. If the problem still occurs, it means that your file has a feature which has not been implemented.                                                                                                                                                    [mov,mp4,m4a,3gp,3g2,mj2 @ 0x7f665a275600]If you want to help, upload a sample of this file to ftp://upload.ffmpeg.org/incoming/ and contact the ffmpeg-devel mailing list. (ffmpeg-devel@ffmpeg.org)                                                                                                                                                                                 [mov,mp4,m4a,3gp,3g2,mj2 @ 0x7f665a275600]error reading header
LAVF_header: av_open_input_stream() failed
ISO: File Type Major Brand: Original QuickTime
Quicktime/MOV file format detected.
[mov] Video stream found, -vid 0
Warning! pts=-285211648  length=2048
MOV: durmap and chunkmap sample count differ (1 vs 2)
=================================================================
==24664==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x603000014580 at pc 0x563d661312e5 bp 0x7ffecfcd0050 sp 0x7ffecfcd0048
READ of size 4 at 0x603000014580 thread T0
    #0 0x563d661312e4 in mov_build_index /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:302:110
    #1 0x563d661312e4 in lschunks /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:1333:6
    #2 0x563d6611c88c in mov_read_header /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:1961:5

0x603000014580 is located 0 bytes to the right of 32-byte region [0x603000014560,0x603000014580)
allocated by thread T0 here:
    #0 0x563d65d5a362 in __interceptor_calloc (/home/jlx/good_mplayer/asan_mplayer/mplayer+0x343362)
    #1 0x563d661263f0 in lschunks_intrak /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:1820:25
    #2 0x563d661263f0 in lschunks /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:1305:8
    #3 0x563d66123576 in lschunks_intrak /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c
    #4 0x563d66123576 in lschunks /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:1305:8
    #5 0x563d66123576 in lschunks_intrak /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c
    #6 0x563d66123576 in lschunks /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:1305:8
    #7 0x563d66123576 in lschunks_intrak /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c
    #8 0x563d66123576 in lschunks /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:1305:8
    #9 0x563d66124068 in lschunks /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:1332:6
    #10 0x563d6611c88c in mov_read_header /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:1961:5
                                                                                                                                                                                                                                                                                                                                                                                      SUMMARY: AddressSanitizer: heap-buffer-overflow /home/jlx/good_mplayer/mplayer/libmpdemux/demux_mov.c:302:110 in mov_build_index                                                                                                                                                                                                                                                      Shadow bytes around the buggy address:
  0x0c067fffa860: 00 fa fa fa fd fd fd fd fa fa fd fd fd fd fa fa
  0x0c067fffa870: fd fd fd fd fa fa fd fd fd fd fa fa fd fd fd fd
  0x0c067fffa880: fa fa fd fd fd fa fa fa fd fd fd fa fa fa fd fd
  0x0c067fffa890: fd fd fa fa fd fd fd fd fa fa 00 00 00 04 fa fa
  0x0c067fffa8a0: 00 00 00 fa fa fa 00 00 00 04 fa fa 00 00 00 00
=>0x0c067fffa8b0:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c067fffa8c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c067fffa8d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c067fffa8e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c067fffa8f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c067fffa900: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==24664==ABORTING

```

### Attachments (1)

[testcase](/attachment/ticket/2395/testcase "View attachment")[​](/raw-attachment/ticket/2395/testcase "Download")
(1.5 KB
) - added by ylzs [2 years ago](/timeline?from=2022-08-31T01%3A59%3A28Z&precision=second "See timeline at Aug 31, 2022, 1:59:28 AM").

Download all attachments as:
[.zip](/zip-attachment/ticket/2395/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (7)

### [comment:1](#comment:1) by ylzs, [2 years ago](/timeline?from=2022-08-23T07%3A56%3A34Z&precision=second "See timeline at Aug 23, 2022, 7:56:34 AM")

| Description: | modified ([diff](/ticket/2395?action=diff&version=1)) |
| --- | --- |

### [comment:2](#comment:2) by ylzs, [2 years ago](/timeline?from=2022-08-23T08%3A26%3A50Z&precision=second "See timeline at Aug 23, 2022, 8:26:50 AM")

| Severity: | critical → major |
| --- | --- |

### [comment:3](#comment:3) by reimar, [2 years ago](/timeline?from=2022-08-26T15%3A20%3A42Z&precision=second "See timeline at Aug 26, 2022, 3:20:42 PM")

Did you forget to attach the testcase?

### [comment:4](#comment:4) by reimar, [2 years ago](/timeline?from=2022-08-26T15%3A48%3A29Z&precision=second "See timeline at Aug 26, 2022, 3:48:29 PM")

Looks the same as the other demux\_mov report though

### by ylzs, [2 years ago](/timeline?from=2022-08-31T01%3A59%3A28Z&precision=second "See timeline at Aug 31, 2022, 1:59:28 AM")

| Attachment: | [*testcase*](/attachment/ticket/2395/testcase)[​](/raw-attachment/ticket/2395/testcase "Download") added |
| --- | --- |

### [comment:5](#comment:5) by ylzs, [2 years ago](/timeline?from=2022-08-31T02%3A00%3A03Z&precision=second "See timeline at Aug 31, 2022, 2:00:03 AM")

I've added the testcase.

Last edited [2 years ago](/timeline?from=2022-08-31T02%3A00%3A29Z&precision=second "See timeline at Aug 31, 2022, 2:00:29 AM") by ylzs ([previous](/ticket/2395?cnum_hist=5&cversion=0#comment:5))
([diff](/ticket/2395?action=comment-diff&cnum=5&version=1))

### [comment:6](#comment:6) by reimar, [2 years ago](/timeline?from=2022-09-01T18%3A25%3A04Z&precision=second "See timeline at Sep 1, 2022, 6:25:04 PM")

| Resolution: | → fixed |
| --- | --- |
| Status: | new → closed |

Seems to have been fixed by the other fixes.

**Note:**
See [TracTickets](/wiki/TracTickets)
for help on using tickets.

### Download in other formats:

* [RSS Feed](/ticket/2395?format=rss)
* [Comma-delimited Text](/ticket/2395?format=csv)
* [Tab-delimited Text](/ticket/2395?format=tab)

---

[![Trac Powered](/chrome/common/trac_logo_mini.png)](https://trac.edgewall.org/)

Powered by [**Trac 1.6**](/about)

By [Edgewall Software](http://www.edgewall.org/)
.

Visit the Trac open source project at
<http://trac.edgewall.org/>


