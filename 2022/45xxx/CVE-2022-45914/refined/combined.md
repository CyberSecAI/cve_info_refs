=== Content from seclists.org_7bb41f63_20250115_093258.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](5)
[By Date](date.html#6)
[![Next](/images/right-icon-16x16.png)](7)

[![Previous](/images/left-icon-16x16.png)](5)
[By Thread](index.html#6)
[![Next](/images/right-icon-16x16.png)](7)

![](/shared/images/nst-icons.svg#search)

# SEC Consult SA-20221201-0 :: Replay attacks & Displaying arbitrary contents in Zhuhai Suny Technology ESL Tag / ETAG-TECH protocol (electronic shelf labels)

---

*From*: "SEC Consult Vulnerability Lab, Research via Fulldisclosure" <fulldisclosure () seclists org>

*Date*: Thu, 1 Dec 2022 10:34:06 +0000

---

```
SEC Consult Vulnerability Lab Security Advisory < 20221201-0 >
=======================================================================
               title: Replay attacks & Displaying arbitrary contents
             product: Zhuhai Suny Technology ESL Tag / ETAG-TECH protocol
                      (electronic shelf labels)
  vulnerable version: All
       fixed version: -
          CVE number: CVE-2022-45914
              impact: critical
            homepage: <http://www.zhsuny.com/>
               found: 2022-05-27
                  by: Steffen Robertz (Office Vienna)
                      SEC Consult Vulnerability Lab

                      An integrated part of SEC Consult, an Atos company
                      Europe | Asia | North America

                      <https://www.sec-consult.com>

=======================================================================

Vendor description:
-------------------
"Zhuhai Suny Technology Co., Ltd, founded in 2016 and located in Zhuhai
Guangdong, is the manufacturer of electronic shelf labels and Alibaba
Super Key Account Gold Supplier specializing in ESL with over 10 years’
experiences focusing on helping customers reduce cost and boost sales.

Since its founding, Suny has attached great importance to exploring
both international and domestic markets, thus becoming China’s top 1
manufacturer of electronic shelf labels. Its products have been widely
applied in supermarkets, retail stores, pharmacies, warehouses,
exhibitions, etc. We has currently provided services to customers from
more than 180 countries, and total sales in 2020 have exceeded
15 million US dollars."

Source: <http://www.zhsuny.com/profile/>

Business recommendation:
------------------------
The vendor did not respond to our communication attempts, there is no patch
available. In case you are using the product, contact the vendor and urge
them to fix the security vulnerabilities.

SEC Consult highly recommends to perform a thorough security review of the
product conducted by security professionals to identify and resolve potential
further security issues.

The research has also been presented at various security conferences such as
hardwear.io, named "Self-labeling electronic shelf labels".

Vulnerability overview/description:
-----------------------------------
1) Replay Attack
The displayed information on the price tag can be updated via a 433 MHz
custom protocol (called ETAG-TECH). An attacker can record transmitted
RF samples and replay them later to cause the same action. Thus, it is
possible to restore an older price on the tag without the need for any
information about the protocol or tag.

2) Forging ETAG-TECH protocol messages to display arbitrary content (CVE-2022-45914)
The ETAG-TECH protocol was reverse engineered. It was noted, that no
authentication is existent. Hence, one can display arbitrary content
on the electronic tag by simply transmitting messages according to the
protocol.

Proof of concept:
-----------------
1) Replay Attack
The tag and base station communicate at 433.264 MHz. Thus, the following
HackRF command can be used to record a transmission:
hackrf_transfer -r /tmp/old_price -f 433264000 -s 4000000 -a 1 -x 43 -l 16 -g 20

The following command was used in order to replay the signal:
hackrf_transfer -t /tmp/old_price -f 433264000 -s 4000000 -a 1 -x 43 -l 16 -g 20

A video of the attack has been published here: <https://youtu.be/hj_ao25HU1E>

2) Forging ETAG-TECH protocol messages to display arbitrary content (CVE-2022-45914)
The base station will transmit a compressed image to the tag. Thus,
any content can be displayed.

Following steps will have to happen:
    I) Send wake-up frames to the tag.
   II) Compress the picture that should be displayed.
  III) Wrap the compressed picture into the picture data structure.
   IV) Split the data structure into the image frames.
    V) Listen for the tag's response.

I) The Wake-up Frame:
The CRC is calculated over the whole frame, starting with the frame length
field. The frame counter is counting down to zero. Every unique frame
(=unique frame counter) is sent five times. The frame is transmitted at
175 kBaud.

|     Preamble     | Sync Header | Frame Length | Tag ID | Fixed Value | Frame Counter | Fixed Value | CRC16 |
|------------------|-------------|--------------|--------|-------------|---------------|-------------|-------|
| AAAAAAAAAAAAAAAA |  D391D391   |      08      | 065302 |     0000    |      0398     |      0A     | CRC   |

II) The Compression Algorithm:
Runlength encoding is used as compression algorithm. The image is read in
rows. An "a" stands for either a 1 or 0, depending on if it's a run of
ones or zeros that is being encoded. A "c" stands for the length of the
run.

There are four different cases:

Case 1: Less than 8 consecutive bits
0b1aaaaaaa
Case 2: Less than 32 consecutive bits
0b0acccccc
Case 3: Less than 256 consecutive bits
0b1a000000 0bcccccccc
Case 4: Less than 2^16 consecutive bits
0b0a000000 0bcccccccc 0bcccccccc

III) The picture data structure
The compression header indicates the color channel:
FC00000000 = black
FC80000000 = red

|   LED   | Batch Code | Fixed Value | LED Time | Compression header | Display Height | Display Width | Compressed
Image Data   |
|---------|------------|-------------|----------|--------------------|----------------|---------------|-------------------------|
|   0700  |    BF75    |     00ED    |   000A   |      FC00000000    |      007F      |      0127     | <Compressed
Image Data> |

IV) The Image Frames
Image frames can only hold 54 Bytes of data. Thus the previously generated
image data structure is split into chunks of 54 bytes or less.
The CRC is calculated over the whole frame, starting with the frame length
field. The frame counter indicates frame 1 out of 9. The frame is transmitted
at 100 kBaud.

|     Preamble     | Sync Header | Frame Length | Tag ID | Frame Counter | Fixed Value |         Payload        | CRC16
|
|------------------|-------------|--------------|--------|---------------|-------------|------------------------|-------|
| AAAAAAAAAAAAAAAA |  D391D391   |      08      | 065302 |      0901     |      33     | <Image Data Structure> |  CRC
|

V) The Tag's Response
The frame is transmitted at 100 kBaud and repeated three times.

|     Preamble     | Sync Header | Frame Length | Tag ID | Battery Voltage |    RSSI     | Temperature | CRC16 |
|------------------|-------------|--------------|--------|-----------------|-------------|-------------|-------|
| AAAAAAAAAAAAAAAA |  D391D391   |      07      | 065302 |    1D = 2.9V    |    2068     |  E9 = 23.3C |  CRC  |

Following these steps, custom images can be sent over the ETAG-TECH protocol.
The only required information is the tag ID which is printed on the tag.
Otherwise it can be sniffed by listening to the RF interface and waiting for base
station communication. Thus, the tag can be fully controlled by an attacker.

Videos of the attack have been published here:
* Displaying arbitrary tag contents: <https://youtu.be/028Gn4VC8yE>
* Receiving arbitrary ESL-TECH messages: <https://youtu.be/x7t0QViu2gU>

Vulnerable / tested versions:
-----------------------------
No version information could be identified for this product.

Vendor contact timeline:
------------------------
2022-08-14: Contacting vendor through info () zhsuny com cn and zhsuny () yeah net
             No response.
2022-08-27: Contacting vendor through st () zhsuny com cn, no response.
2022-09-12: Contacting vendor again, communicating public release for October
             No response.
2022-12-01: Public release of security advisory.

Solution:
---------
The vendor did not respond to our communication attempts, there is no patch
available. In case you are using the product, contact the vendor and urge them
to fix the security vulnerabilities.

Workaround:
-----------
None

Advisory URL:
-------------
<https://sec-consult.com/vulnerability-lab/>

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

SEC Consult Vulnerability Lab

SEC Consult, an Atos company
Europe | Asia | North America

About SEC Consult Vulnerability Lab
The SEC Consult Vulnerability Lab is an integrated part of SEC Consult, an
Atos company. It ensures the continued knowledge gain of SEC Consult in the
field of network and application security to stay ahead of the attacker. The
SEC Consult Vulnerability Lab supports high-quality penetration testing and
the evaluation of new offensive and defensive technologies for our customers.
Hence our customers obtain the most current information about vulnerabilities
and valid recommendation about the risk profile of new technologies.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Interested to work with the experts of SEC Consult?
Send us your application <https://sec-consult.com/career/>

Interested in improving your cyber security with the experts of SEC Consult?
Contact our local offices <https://sec-consult.com/contact/>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Mail: security-research at sec-consult dot com
Web: <https://www.sec-consult.com>
Blog: <http://blog.sec-consult.com>
Twitter: <https://twitter.com/sec_consult>

EOF S. Robertz / @2022
_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <https://seclists.org/fulldisclosure/>
```

---

[![Previous](/images/left-icon-16x16.png)](5)
[By Date](date.html#6)
[![Next](/images/right-icon-16x16.png)](7)

[![Previous](/images/left-icon-16x16.png)](5)
[By Thread](index.html#6)
[![Next](/images/right-icon-16x16.png)](7)

### Current thread:

* **SEC Consult SA-20221201-0 :: Replay attacks & Displaying arbitrary contents in Zhuhai Suny Technology ESL Tag / ETAG-TECH protocol (electronic shelf labels)** *SEC Consult Vulnerability Lab, Research via Fulldisclosure (Dec 08)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from www.youtube.com_6f7034d7_20250115_093259.html ===
[00:02] over to you
[00:04] all right
[00:06] so thank you um welcome to my
[00:08] presentation about self-labeling
[00:10] electronic shelf labels uh pawning the
[00:12] next big thing in retail
[00:14] my name is stefan roberts and i work as
[00:16] a security consultant for
[00:18] second salt which is based in austria
[00:22] and this uh work has been conducted in
[00:24] the second side vulnerability lab where
[00:26] we just have a look at new interesting
[00:28] topics
[00:29] that could have security relevant impact
[00:32] and
[00:32] start to dig into it try to figure out
[00:34] any new vulnerabilities there
[00:37] so what even is an esl tech a esl tag is
[00:40] depicted in the lower right hand corner
[00:42] here uh
[00:44] comes in different sizes i have some
[00:45] model in the seven inch or like a four
[00:47] or five inch one
[00:50] and pretty much consists out of a
[00:51] display
[00:52] usually this is an ink display but
[00:54] there's also some
[00:56] that are lcd displays
[01:00] it's usually battery powered and has
[01:02] supposed to have a runtime of multiple
[01:03] years since it's usually used as price
[01:06] tag or shelf label tag in the store
[01:10] and of course you need to have some form
[01:12] of communication usually a wireless form
[01:14] of communication so you can change
[01:16] what's depicted on the screen
[01:18] so in most cases there's either
[01:19] bluetooth low energy
[01:21] there are some ones that use nfc and
[01:23] there are some that use a custom
[01:25] proprietary 433 megahertz protocol
[01:29] and of course then you need a matching
[01:30] transceiver for a computer so you can
[01:32] just change the content of the display
[01:34] from your regular computer
[01:38] so when we looked into uh into the esl
[01:41] text at the first we're wondering if
[01:43] this is actually something that's being
[01:44] used because we saw it in couple
[01:46] austrian supermarket chains
[01:48] and we were looking into it is it
[01:50] actually a thing that could become big
[01:51] in the next years so we found a couple
[01:53] studies that were showing that last year
[01:56] the market worth was about 855 million
[01:58] u.s dollars
[02:00] but it's estimated to be 980 million u.s
[02:02] dollars already this year and then
[02:04] within the next uh 10 years it's
[02:07] supposed to be up to 5.2 billion u.s
[02:09] dollars so quite a rapid growth there
[02:13] this is mostly due to
[02:14] the convenient price changes that are
[02:16] possible with esotex can just change
[02:18] prices every minute or every day you
[02:20] don't have to change any stickers you
[02:22] just go into your computer system and
[02:24] change the prices for the whole store
[02:26] however you want and therefore you're
[02:28] better able to compete with online
[02:29] marketing
[02:32] also you're it's possible that you have
[02:34] promotional offers that are quite easily
[02:37] depictable on the on the
[02:40] esl text
[02:41] as usually they come with an led and can
[02:43] flash and blink as a customer and
[02:45] therefore draw the attention to a
[02:47] specific offer or specific product in
[02:49] the store
[02:51] so here a couple pictures how the esl
[02:53] tags are commonly commonly used
[02:55] so in the upper left hand corner or the
[02:57] upper row you can say the see the
[03:00] classic use case as just the price tag
[03:02] in the store
[03:03] but there are also a couple more
[03:04] interesting cases that we got from the
[03:06] supplier
[03:07] where the
[03:08] tags are used in a fashion that we
[03:10] didn't see in the first place
[03:13] so in the lower left-hand corner
[03:14] actually you see a hospital storage unit
[03:17] where they are using the shelf tags in
[03:19] order to organize their storage and to
[03:22] find the right products when they need
[03:23] for it there's actually a different
[03:25] version of the
[03:27] of the station because the shelves have
[03:29] all these little light columns
[03:30] and with the light columns the right
[03:32] shelf will start blinking if you're
[03:34] searching for something
[03:36] same kind of thing
[03:37] is on the right hand side there's
[03:39] actually a
[03:40] chord document storage room in china
[03:43] and it's being using the e-cell text in
[03:45] order to organize the documents so
[03:47] actually you have some more impact here
[03:48] besides just changing a price you could
[03:51] actually
[03:52] um
[03:53] change
[03:54] where documents are being stored and
[03:56] make it hard for people to find the
[03:57] right chord documents and therefore
[03:58] prolonging court cases which is an
[04:00] impact we didn't really think was
[04:02] possible in the beginning
[04:05] so what are the classic attack scenarios
[04:07] you could think of
[04:08] well the classic one would just be to
[04:11] obstruct the retailer
[04:12] and hence blackmailed for ransom because
[04:14] he could see that customer would get
[04:16] annoyed if they can't see the price for
[04:18] product and might just go visit a
[04:19] different supermarket
[04:21] we also thought about that phishing
[04:23] might be very possible because you could
[04:25] just set up a malicious qr code and a
[04:27] lot of people probably scanned it in the
[04:29] store because they would see
[04:32] a regular price tag think that's a valid
[04:33] one or it would be some special offer or
[04:36] discount if they scan the code
[04:38] and you funnel them through your
[04:40] malicious website then and then the last
[04:42] case is actually for the maker community
[04:45] these displays run very very cheap and
[04:47] you get a nice seven inch display with
[04:50] like multiple your battery storage on
[04:52] there
[04:53] so our own id was actually question if
[04:55] we could just use them
[04:57] as this place for our meeting rooms and
[04:58] just depict the schedule for the
[05:01] specific meeting room on it
[05:03] so maybe there's a lot more applications
[05:05] we could look into
[05:08] so the specific model i checked out
[05:10] uh is from a common chinese isl tech
[05:12] supplier that you can find on alibaba
[05:14] and aliexpress
[05:16] um it comes with the base station that's
[05:18] depicted here in the middle
[05:20] the base station will convert the
[05:22] ethernet protocol into a 433 from a
[05:26] megahertz proprietary protocol that the
[05:27] esl tags will speak
[05:30] then i adjust my row of testing e-cell
[05:31] tags laying around and then two hacker
[05:34] f's one used as a receiver one used as a
[05:37] transmitter since they have to flex
[05:39] which are controlled by the attacker in
[05:40] my case
[05:44] so whenever you want to change the price
[05:46] there is a
[05:47] esl design tool
[05:49] this tool you would pretty much just
[05:50] select the size of the display that you
[05:53] want to change for
[05:54] and then you can create a pixel graphic
[05:57] by either writing text or
[05:59] uploading a picture in this case it's
[06:00] the hardware logo
[06:03] then you just have this field where you
[06:06] write down the tag id so each tag comes
[06:08] with an own id on it
[06:10] you add the id there that's the tag that
[06:12] you will change
[06:14] and then there's a status box in the
[06:15] lower right hand corner which will
[06:16] depict the changes
[06:19] and the responses from the tag
[06:21] there's also the net sdk available
[06:23] from the manufacturer which you can use
[06:25] to write your own software for this
[06:28] and there's also a point of sales
[06:29] integration
[06:30] so you're actually able to hook this up
[06:32] right to a cash register and if you
[06:34] change the price in the cash register it
[06:35] will reflect right on the price tags in
[06:37] the store
[06:41] so let's get to the interesting start
[06:42] which is the hardware the first thing i
[06:44] looked at
[06:46] so here's a close-up of the regular tag
[06:48] because he is pretty basic it just has a
[06:50] display in this type it's an ink display
[06:53] it has a little hole which is an rgb led
[06:56] and then it has a
[06:58] code which is just the tag id
[07:00] stored as a barcode
[07:02] which you can just read and this is
[07:05] this id that you will use if you want to
[07:07] identify the tag that you want to change
[07:09] so this casing was actually
[07:11] ultrasonically welded so i had to dremel
[07:12] it open
[07:14] but germany open you finally get to the
[07:16] pcb
[07:17] you can see again in blue they mark the
[07:19] rgb led
[07:21] then in yellow this is the rf
[07:23] transceiver chip
[07:25] marked with ov8 0 e934 802
[07:29] um however we couldn't find any
[07:31] information for that ship no idea what
[07:33] it actually is who manufactured this we
[07:35] couldn't find any markings on it
[07:37] whatsoever so if anybody knows oh he has
[07:40] no idea feel free to give me a hint
[07:43] what it is
[07:44] then marked in red we have a regular spi
[07:47] flash memory manufactured by pouya and
[07:50] then in orange there is the
[07:52] microcontroller which is labeled etag m1
[07:55] so also non
[07:57] off the shelf labeling we didn't know
[07:59] what this actually is
[08:02] if you flip the pcb around you'll see an
[08:05] orange mark the battery connector that's
[08:07] just where the battery pack will press
[08:08] against to form the connection it's
[08:10] powered by a three volt battery cell and
[08:13] then there's the four pin header which
[08:15] usually doesn't have anything soldered
[08:17] to it but
[08:18] it looked very obvious that this is some
[08:20] sort of debug access port that we're
[08:22] gonna look into further later on
[08:26] so first i started by just dumping the
[08:28] spi flash memory since this is pretty
[08:29] easy and straightforward approach
[08:31] it was a two megabyte storage of flash
[08:34] and if you start comparing flash dumps
[08:36] from multiple tags that have different
[08:39] pictures you know that only one specific
[08:42] uh address area starts to change and
[08:44] that's everything that's following
[08:46] 0x13100
[08:49] so this is obviously where the image
[08:51] data is being stored
[08:53] it's depicted as just
[08:56] an area of ones and zeros you should
[08:58] start with a the black color channel and
[09:00] the red color channel because these
[09:01] displays are actually multi-color they
[09:03] can display pretty much off
[09:05] black or red for each pixel
[09:09] they just start by going in rows so you
[09:12] just on the upper left hand corner and
[09:13] just select by rows
[09:15] where you encode the pixel if one is on
[09:16] and the zero is off
[09:20] and the beginning of uh and director of
[09:22] the python script for this uh which we
[09:24] will make available later on in the
[09:25] second site github
[09:28] uh but the beginning of the flash
[09:30] contains something else and as you can
[09:31] clearly see by the entropy it's nothing
[09:33] that's encrypted it's very likely that
[09:35] this is actually firmware uh from the
[09:37] looks of it unfortunately i didn't have
[09:39] enough time in the end to uh try to
[09:41] decompile it but i'm fairly certain that
[09:44] you'll be able to find the correct
[09:46] firmware there just in the beginning i
[09:48] didn't have i had the time for it but
[09:50] then i didn't know the architecture
[09:51] being used and couldn't figure it out
[09:53] since it wasn't a standard arm
[09:54] architecture and then in the end i had
[09:57] so much other things found that i didn't
[09:58] have enough time to come back to this
[10:00] again
[10:02] so when we looked at the microcontroller
[10:04] which was labeled the etag m1 and we
[10:06] couldn't find any information about it i
[10:07] just start by continuity testing and
[10:10] trying to figure out
[10:11] uh the pin out of this microcontroller
[10:13] so just look what are the different pins
[10:15] hooked up to on the pcb
[10:17] so most of them were unknown a couple
[10:19] were the rf interface a couple with the
[10:22] display
[10:23] so a couple were spi
[10:25] but the very interesting pins are
[10:27] obviously gnd and vcc
[10:29] and then the oscillator that was
[10:31] connected on the board because usually
[10:33] with those pins you got enough pin
[10:35] characteristics to try and look at
[10:37] common uh
[10:38] commonly used mic controllers and try to
[10:40] find just one that has a matching pin
[10:42] node and they'll just be like alright
[10:43] they're relabeled with microcontroller
[10:45] and actually some scm device
[10:47] unfortunately we were not able to find
[10:49] anything that had a matching pin out
[10:52] available so this didn't really bring us
[10:55] any further
[10:56] what did then
[10:58] is that we used this chip and boiled in
[11:00] 95 percent concentrated sulfuric acid
[11:02] and therefore d layer uh
[11:05] therefore removed the epoxy packaging
[11:07] and gather a die shot of the picture
[11:10] after that we cleaned the ic with a
[11:12] isopropanol just to clean it up nicely
[11:15] and you can see that some edges chipped
[11:18] because i tried to get a really nice and
[11:20] clean picture so i used multiple
[11:22] rounds of boiling the chip in the acid
[11:24] and unfortunately i was using metal
[11:26] tweezers which chip the brittle silicon
[11:30] so not for myself we use plastic
[11:32] tweezers next time
[11:36] but
[11:37] what we were able to achieve was
[11:39] actually we found a marking on the die
[11:41] itself so you can clearly see that the
[11:43] marking there is from sd micro
[11:45] electronics so we're looking at the my
[11:47] sd micro electronic micro controller
[11:50] produced or designed in 2010 because
[11:53] that's most likely what this number
[11:55] stands for there's another internal
[11:57] number that we couldn't reference the
[11:59] r758r which might be some sort of
[12:02] internal sd number that we don't have
[12:04] access to
[12:05] but now we are pretty close and
[12:07] guessing what architecture is being used
[12:09] because stm is usually stm v8 or stm32
[12:13] which would be arm
[12:15] so now we are very limited at what we
[12:17] could look at
[12:19] so next i came back to the debug access
[12:21] on the back so remember those four pins
[12:23] that we found there
[12:25] by tracing those we figured out that pin
[12:27] one of the debug port would go to the
[12:29] microcontrollers pin 2 pin 2 would go to
[12:32] ground pin 3 would go to mic controllers
[12:34] pin 1 pin 4
[12:36] went to vdd by knowing that we have an
[12:38] scm device i was now able to just think
[12:41] in my head oh what could this be
[12:43] it doesn't really look like jtag so i
[12:46] remembered that there is a four pin
[12:47] debug header for the stm v8
[12:50] and turns out this is the stm v8 swim
[12:53] debug connector and the printout looks
[12:55] very very similar and turns out they
[12:57] just uh changed where they count the pin
[12:59] one from and marked it on the opposite
[13:01] side
[13:02] so actually the pin one on the debug
[13:04] header is the reset pin and the pin 3 is
[13:07] the data or swim pin and i was able to
[13:09] confirm this by sending
[13:11] a new price update and while the tags
[13:13] refreshing you'll see we'll see the
[13:15] display flashing and it just pulls the
[13:16] reset pin to ground and it stopped
[13:18] immediately and i removed the bridge to
[13:20] ground and the text started back up and
[13:22] the price was finally depicted correctly
[13:25] so this confirmed that it actually reset
[13:26] pin being shorted
[13:29] so to ultimately confirm this i
[13:31] gained access to the st with using
[13:34] st-link v2 using the stm8 flash software
[13:36] that's just using the swim protocol as a
[13:38] debug interface
[13:40] however you have to specify what chip to
[13:42] use
[13:43] but we still didn't know besides it's
[13:45] most likely an sdm v8 right now we
[13:47] didn't know which one or which the exact
[13:49] model number being used so just decided
[13:52] to use the largest one because all the
[13:54] flash and drum and eprom areas always
[13:56] map the same address
[13:58] so i use the
[14:00] stm8s um which has 128 kilobytes of
[14:03] storage
[14:05] and i
[14:06] then just wrote this little command to
[14:08] dump this area
[14:10] into a dump file and looked at this in a
[14:12] hex view
[14:14] and the hex view indicated that after 64
[14:17] kilobytes
[14:18] the readout was changing from 0x71
[14:22] to just
[14:23] 0x00 so something is changing here most
[14:26] likely the flash memory
[14:28] is finished and we have 64 kilobytes of
[14:30] flash memory only there
[14:33] and the 0x71 seems to be the default
[14:36] that's being read if an sdm v8 is
[14:38] actually with readout protection enabled
[14:41] so we have readout protection enabled
[14:43] but we still gained information that we
[14:45] have an stm v8 using 64 kilobytes of
[14:47] flash you can do the same approach for
[14:49] the eprom section and you'll turn out we
[14:51] have two kilobytes of eprom so now we
[14:52] know we have an sdm v8 we have 64
[14:55] kilobytes of flash and 2 kilobytes of
[14:57] eprom further limiting what options we
[14:59] have available here
[15:03] so there wasn't something like a chip id
[15:05] or something that would tell you
[15:06] information about what model this chip
[15:08] is however there is a unique id for the
[15:10] sdmba series
[15:12] if you look up the unique id how it's
[15:14] set up
[15:15] you will find this table
[15:17] where pretty much the unique value of
[15:19] each chip consists of the lot number
[15:21] that it was produced in the wafer number
[15:23] and the x and y coordinates of your chip
[15:25] on the actual wafer and therefore is
[15:27] unique
[15:29] so by looking at different at the data
[15:31] sheets it turns out that there's only a
[15:32] common common register used in stm v8s
[15:36] where they store those information this
[15:38] is 0x4 0x4acd0x4865
[15:41] and
[15:42] 0x4926
[15:44] by just reading from these addresses and
[15:46] figuring out if the data there matches
[15:48] this table
[15:49] i was able to find matching data as
[15:52] 0x4926
[15:54] that would fit the format and hence our
[15:56] chip actually is from lot number g904379
[16:01] with wafer number 22 y coordinate 58 and
[16:04] x coordinate 31.
[16:06] so this now actually gives us fully
[16:08] identification of the chip
[16:10] we unfortunately were not able to tell
[16:12] what model this now is however st is you
[16:15] are probably able to use the slot number
[16:17] to tell us what actually chip was
[16:18] produced in the slot however they didn't
[16:20] get back to us with an answer we
[16:23] requested it
[16:25] uh in case anybody has good connection
[16:27] and wants to request it again or has
[16:29] access to this databases uh i would be
[16:32] very interested knowing what actually
[16:34] this is
[16:35] but we had one other little bit more of
[16:37] information left because address
[16:40] 0x4926 where we found this information
[16:43] seems to only be uniquely used by stmv8l
[16:46] which is a low power series of fcm
[16:48] devices
[16:49] so now we know we have an stm8 from the
[16:52] low power family and can pretty much
[16:55] um know already enough about this chip
[16:59] furthermore we did some ocean because we
[17:01] didn't find any matching
[17:04] pin outs for this ship so we're thinking
[17:06] maybe they actually rebound the chip and
[17:09] and made a custom pin out and that's why
[17:11] we can't find anything that matches our
[17:12] pin out that we figured out
[17:15] so when you order something from alibaba
[17:17] and the company is large enough on
[17:19] alibaba
[17:20] like ours was then it's a alibaba gold
[17:22] plus supplied
[17:24] supplier
[17:25] and alibaba will actually produce an
[17:26] independent production line assessment
[17:28] which will tell you what all devices
[17:31] this company owns and about the state of
[17:33] it and this report included that an
[17:36] ultrasonic fuse
[17:38] so there's two theories now what this is
[17:40] either this actually is an ultrasonic
[17:42] wire binder and they do make a custom
[17:44] wire bond and therefore we can't find
[17:46] matching pin outs
[17:48] or the more likely more boring version
[17:50] of it is the ultrasonic fuse is the
[17:53] ultrasonic welding machine that's used
[17:54] to weld down the
[17:57] casings around the pcb
[17:59] we
[18:00] couldn't figure out which exactly it is
[18:03] unless we actually know the device
[18:05] number
[18:09] so the next thing i took a look at was
[18:11] the rf protocol because obviously if you
[18:13] want to attack this chip it's a lot more
[18:15] interesting if you can attack it
[18:16] remotely for uh through the rf
[18:18] interfaces
[18:20] so first i started by looking at the ssc
[18:23] filings because that's usually where you
[18:24] start if you have a knife protocol to
[18:26] look at
[18:27] so remember that we have the base
[18:29] station and the tag themselves so we
[18:31] have two different fcc files for those
[18:33] and by comparing them you see that the
[18:35] base station and the tag both are
[18:37] reported to run at 433.92 megahertz and
[18:40] only have one channel available
[18:42] however when you look at the modulation
[18:44] type marked red here you'll see that the
[18:47] base station is supposed to have fsk
[18:49] with a gaussian filter before just to
[18:51] limit out of band noise
[18:53] while the esl tag is supposed to have a
[18:55] use ask which amplitude shift keying and
[18:58] this doesn't really make sense to me
[18:59] because why would two devices that
[19:01] communicate with each other are supposed
[19:02] to use different modulation
[19:05] and we still didn't find any reason for
[19:07] this
[19:08] because it turns out this is not the
[19:11] case and there's just some weird things
[19:12] going on the ftc files here
[19:17] because the manual is also talking about
[19:21] anti-jamming frequency hopping
[19:23] technology being involved this was
[19:24] however never
[19:26] seen and also would be clear violation
[19:28] to the statement that's only using one
[19:30] channel and uh that the channels fixed
[19:32] at one frequency
[19:34] so something is very very fishy about
[19:36] this fcc filings as well
[19:39] further intensified when i looked into
[19:42] the frequency and it turned out it's not
[19:43] running at 433.92 megahertz but it's
[19:46] running at
[19:47] 433.254 megahertz so it's also a little
[19:50] bit offset to where it's supposed to be
[19:53] very very weird findings here
[19:57] so then
[19:58] the first thing i did
[20:00] to further
[20:02] figure out if this is vulnerable to any
[20:03] sort of rf attack was to just run a
[20:06] replay attack where
[20:09] i started to um
[20:13] where started to just record all the rf
[20:15] traffic while i was changing the text
[20:18] picture so i changed the price on my
[20:20] text picture to five dollars
[20:23] tag shall show up any second here
[20:26] and you will see that the tag will now
[20:28] start
[20:29] to refresh and display the price at this
[20:31] time i stopped the recording of the rf
[20:34] samples
[20:36] and we'll just wait for the price to
[20:38] disappear finally we have the price of
[20:40] five dollar set so now i could imagine
[20:41] it's the next day the store owner
[20:43] decides this product is now more
[20:45] expensive
[20:46] and i want to charge seven dollars for
[20:48] it so the store owner goes and change
[20:50] the price to something else for example
[20:52] the seven dollars
[20:53] this will always take a little while
[20:55] because uh you can't change the prices
[20:56] too fast they need about 30 seconds
[20:58] before you're able to change them again
[21:02] as soon as this is sent
[21:04] it takes just a little while
[21:11] and the price is being depicted as seven
[21:13] dollars now on the tag
[21:15] however we as hackers one don't want to
[21:17] pay the new seven dollars and remember
[21:19] that we have still samples collected of
[21:21] the image that was transmitted for five
[21:23] dollar price so we think hey what could
[21:26] be the easiest way to change this back
[21:27] is we just transmit all the f samples we
[21:29] copied from the five dollar price and
[21:31] replayed it with just being an image uh
[21:33] being sent without any further measures
[21:35] then this should just work out of the
[21:37] box so all we do is change the parameter
[21:40] to transmit
[21:41] send the rf frames
[21:45] and we see
[21:56] and we see that the price is being
[21:57] changed back to five dollars without
[22:00] any usage of the original software or
[22:03] the base station
[22:07] so this indicates that actually replay
[22:09] attacks are possible and there's no
[22:11] elaborate security scheme in place that
[22:13] will prevent this
[22:19] so in order to look
[22:21] so this caused me to go deeper into the
[22:24] protocol and figure out how this
[22:26] protocol actually works
[22:28] since already everything else was wrong
[22:30] in the fcc files
[22:31] i always and there was this weird clash
[22:33] of the right modulation schemes i
[22:35] decided to just look at it from scratch
[22:37] again so this is a waveform display on
[22:40] the y-axis you have the frequency
[22:43] on the x-axis of the time so clearly you
[22:45] can see multiple packets being
[22:46] transmitted here
[22:48] and the color then encodes the intensity
[22:50] or the amplitude of the signal
[22:52] and as you can clearly see you have
[22:53] those red lines
[22:55] one at zero but you also have a red line
[22:57] at a negative offset and one of the
[22:59] positive offset which just indicates
[23:01] that it is fsk being used and that's a
[23:03] frequency shift modulation
[23:06] uh in place here
[23:08] so i then use the tool in spectrum to
[23:11] further look into the signal because it
[23:13] allows you to manually decode those
[23:14] frames when you have no idea about the
[23:16] signal what's going on and it was very
[23:18] convenient to use actually
[23:20] so when you have the fft plot up there
[23:23] you can just right click into there and
[23:25] add a drive plot in this example since
[23:27] it's an fsk scheme i decided to
[23:30] add a frequency derived plot which is
[23:33] this medium plot
[23:35] and then you can right click into that
[23:37] again add another derived plot which
[23:39] will just be everything that's going
[23:40] below zero is a zero everything above
[23:42] zero is a one which then gives you a
[23:44] final plot back of ones and zeros with
[23:46] just a
[23:48] regular bit stream that you can use to
[23:50] decode information
[23:52] you can then also just add those cursors
[23:54] which are very convenient because you
[23:55] just mark one sample time with the
[23:57] cursor um and the sample will always be
[24:00] taken right in between both of these
[24:02] cursors
[24:03] so once you mark once a full symbol
[24:05] period you can just increase the amount
[24:07] of samples you want in my case for this
[24:09] frame it was 184 symbols in here so then
[24:12] a bunch of cursors is being added you
[24:14] can just right click in there again and
[24:15] copy the right bit stream convert it to
[24:18] hex
[24:18] values and suddenly you have your hex
[24:21] button stream that you can use for
[24:22] further analyzers
[24:24] i did this for a couple frames just to
[24:27] get a feeling for the different type of
[24:29] frames
[24:30] and came up with three distinct frame
[24:32] types that are available in this
[24:34] protocol
[24:35] the first one is the wake up frame
[24:36] that's being used from the base station
[24:38] to wake up the tag
[24:40] uh since attack usually is a low powered
[24:42] state where it's sleeping but then it
[24:44] will wake up randomly listen to the
[24:46] channel and if it finds a valid attack
[24:48] for himself it will stay awake and
[24:49] actually wait for the image data so base
[24:51] stations start spamming about four and a
[24:53] half thousand frames in the beginning in
[24:54] the
[24:55] first like 30 seconds
[24:58] where um that are used to wake up the
[25:00] frame those are transmitted at 175
[25:02] kiloboard
[25:04] and consists of a preamble which does
[25:05] aas so it's a one zero one zero one zero
[25:08] one zero pattern and so on uh you use
[25:10] that for timing recovery actually
[25:12] because your systems are not
[25:14] timed correctly to each other
[25:17] you then have a sync header which in
[25:18] this case is d391 d391 you use that to
[25:22] determine that the frame is correct and
[25:23] you know where to start it then follows
[25:25] the frame length that does actually not
[25:27] include the crc at the end so you always
[25:29] have to add the two bytes for the crc to
[25:31] the frame length
[25:33] then you have the tag id which is the
[25:34] number that's printed on the casing of
[25:36] the tag that's used to identify the
[25:38] right one
[25:40] uh some fixed value that i never seen
[25:42] anything else besides the zero zero in
[25:43] it
[25:44] and then you just have a frame counter
[25:46] this is the 920 in hex and it will just
[25:48] count down with each frame
[25:51] then another fixed value and the end is
[25:52] crc16
[25:54] for error correction reasons
[25:58] so spamming this tag will actually wake
[26:00] up the frame later on
[26:03] after the tag wakes up we'll transmit
[26:05] the image data
[26:07] the image data frame is looking very
[26:09] very similar to the wake up frame in
[26:11] that you have the same preamble the same
[26:13] sync header the frame length the tag id
[26:16] but then the next new field is the frame
[26:17] counter so the zero nine zero one
[26:20] actually stands for you'll send nine
[26:22] total frames this one is currently frame
[26:24] one out of the nine
[26:26] then you have a fixed value and then the
[26:28] payload field the payload can hold up to
[26:30] 54
[26:31] bytes
[26:32] and everything else after that will be
[26:34] sent in a new separate frame and then
[26:36] the end here of the crc again
[26:41] however how i can imagine if you have
[26:43] this larger seven inch one or ten inch
[26:46] one
[26:47] uh a hundred for 256
[26:50] frames will not be able to hold all the
[26:52] pixel information in here
[26:54] so that's why there is some weird
[26:56] patched on adjustment for this
[26:58] where they just decided to
[27:01] use the frame counter full 16 bit in the
[27:04] first frame to indicate how many frames
[27:06] are totally going to send and then they
[27:08] just start counting up starting with the
[27:10] second frame at id 0 and just start
[27:13] counting up from there until the first
[27:15] value that they transmitted so kind of
[27:17] really bold on adjustment to allow for
[27:19] larger text sizes that they probably
[27:21] added later after protocol was already
[27:23] done
[27:27] so in the payload fields there's
[27:29] actually the image data being sent
[27:32] so
[27:33] the image data structure actually starts
[27:35] with uh some additional headers
[27:38] so you remember that there is an led on
[27:40] the tag so the first image structure
[27:42] starts with the led the zero seven zero
[27:45] zero for example turns off the led while
[27:47] the zero seven zero seven turns on the
[27:49] led so most likely a one is just
[27:52] enabling one color channel because uh
[27:54] zero seven turned it to white so it's
[27:56] probably one bit per um color channel
[27:59] here
[28:00] you have a batch code because there's
[28:01] like a batch mode where you can update
[28:03] multiple texts at once they just always
[28:05] will have the same batch code set for
[28:06] all of those
[28:08] uh the led time is just a timer because
[28:10] you can make the led blink and this is
[28:12] just the time interval to use default i
[28:14] think is one second
[28:16] and then there's a compression header
[28:18] where the fc and then all zeros
[28:20] indicates a black color channel and the
[28:22] fc8 and then all zeros indicates the red
[28:24] color channel because remember that our
[28:25] displays are actually e ink displays but
[28:28] with multiple color supports so black
[28:29] and red are possible
[28:33] after the compression header
[28:34] or like a color channel header
[28:37] we'll have the display height and
[28:38] display width and then actually the
[28:40] image payload data
[28:44] however when i looked at these
[28:46] samples that i had
[28:48] it turned quickly out that way too
[28:50] little data is being transmitted
[28:52] especially for the larger displays
[28:54] especially since we know that three
[28:55] colors are supported we know that we
[28:57] need at least two bits per pixel to
[28:59] encode this information
[29:01] uh in the storage it was just one a one
[29:04] to turn the pixel on and a zero to turn
[29:06] it off however this didn't seem to hold
[29:08] true because the
[29:09] actual image payload was way too little
[29:11] so some compression was being used
[29:14] it turned out to not be a standard
[29:16] compression algorithm like a gzip one or
[29:18] something else
[29:19] so
[29:20] the quickest way into this was to
[29:22] download the net sdk and just have a
[29:24] look into the net
[29:25] files and figure out how they start to
[29:28] compress the image data
[29:30] and it turns out that it's a very basic
[29:32] run length encoding per color channel
[29:35] so pretty much if your image consists of
[29:37] a lot of ones for one color
[29:39] if it's less than eight ones in a row
[29:42] you'll just have the first case of your
[29:44] image data structure where the first one
[29:47] and the msb will indicate this case one
[29:50] and then you'll just have the seven
[29:52] bits depending on if you run
[29:55] in case two it's if you have less than
[29:57] uh 32 consecutive bits so you start with
[30:00] indicating case two by having a zero in
[30:02] the msb
[30:03] then you have one bit that will say if
[30:06] it's a run of once or a run of zeros and
[30:08] then just the count so up here we could
[30:10] have for example 20 encode lower six
[30:12] bits to say we have twenty ones or
[30:15] twenty zeros in one row coming
[30:17] case three is kind of similar to this
[30:19] again we indicate that case three we
[30:21] indicate if it's a run of ones or run of
[30:22] zeros and then we just add one byte to
[30:25] the whole payload where the whole last
[30:27] byte will indicate how many times this
[30:29] is repeated
[30:30] same holds up for case four case four is
[30:32] marked again we'll indicate if it's a
[30:34] run of ones or a run of zeros and then
[30:36] we have two bytes added where both bytes
[30:39] together will indicate if it's
[30:41] how many times this one or zero is being
[30:44] repeated in the image
[30:45] therefore we can compress especially
[30:47] images like this with just uh two lines
[30:50] very much down into very little bits
[30:53] and
[30:54] that's the reason for the very limited
[30:56] data payloads
[31:00] so the tags actually also respond to
[31:02] data which is also gfsk
[31:05] and the tag response contains some
[31:07] interesting information
[31:08] they're repeated three times each so
[31:10] that the base station definitely hears
[31:12] one of them as some form of error
[31:14] correction
[31:16] has the same
[31:17] structure again of the the sync header
[31:20] and the frame length tag id and then it
[31:22] will report its battery voltage which is
[31:24] actually just the battery voltage
[31:26] multiplied by 10.
[31:27] uh an rssi value where i really didn't
[31:29] understand how it's being calculated of
[31:31] those two bytes that are being sent
[31:34] and then the ambient temperature which
[31:35] is also just multiplied by 10 in order
[31:37] to encode it correctly
[31:41] so i then thought let's build a new
[31:43] radio flowchart for this and i'm by no
[31:45] means an f engineer i just had some
[31:47] classes in university about this so i
[31:49] decided would be fun to do and a lot
[31:51] better than manually encoding all these
[31:53] frames
[31:54] all the time
[31:56] so the float chart
[31:58] will actually just start with the hacker
[32:00] f uh being used as a source i then uh
[32:03] decimated the sample rate
[32:05] uh or i was able to shift it with this
[32:07] block
[32:08] after that i have a low pass filter to
[32:10] filter out some of the noise i was
[32:11] receiving
[32:13] a correlation estimator to to match the
[32:15] preamble the zero one zero ones
[32:18] and then i use the creditor d mod block
[32:20] to demodulate
[32:22] the signal
[32:23] the signal then is samples that are
[32:26] between
[32:27] minus one and uh negative one and one
[32:30] however the the gartner timing
[32:32] correction needed them to be either
[32:34] really zero one negative one or one
[32:37] therefore i use this threshold block
[32:39] which shifts them again between zero and
[32:40] one and then just uh some weird magic of
[32:43] adding constant and uh
[32:45] multiplying to shift them back to either
[32:48] negative one or one
[32:49] then i did some timing correction in
[32:51] case the
[32:52] higher qrf is not really synchronized in
[32:54] time
[32:56] the output of this is fed into the
[32:58] binary slicer which will
[33:00] make a byte stream out of this and then
[33:02] there's the packaging framework block
[33:03] which i found on github and just ported
[33:05] to the newer radio version
[33:08] the packet reframer block then listens
[33:10] for the d309 uh the 309 is in the
[33:13] beginning
[33:14] we'll find the length field
[33:17] and then just uh
[33:19] carve a packet out of this and send it
[33:21] on actually to a udp client so i could
[33:24] just use regular python and have my
[33:25] co-workers work with me on this one
[33:30] so i then developed a python script
[33:32] that's actually able to decode every
[33:34] picture i send here
[33:37] the python script is being run in the
[33:39] lower hand window and the upend window
[33:41] will be the new radio script running and
[33:43] the right hand side you see the regular
[33:45] store owner just sending a picture
[33:48] so running this whole sketch
[33:51] we'll take a little because
[33:53] the wake up frames are being sent first
[33:55] for the first 30 seconds so this will
[33:57] take a little bit
[33:59] until the tank wakes up
[34:00] and until the baud rate has changed the
[34:02] 100 kilobar that my sketch is running at
[34:04] but now we see all the images
[34:06] all the frames are being received and
[34:08] actually i'm able to render the picture
[34:10] perfectly that's being sent to the tag
[34:15] so
[34:16] receiving data is
[34:18] fun but what's even better is now that
[34:21] we're able to send all the data with new
[34:22] radio and create our own tags without
[34:25] any access to those interfaces
[34:27] in order to make this possible the
[34:29] hardest thing to come around was the
[34:30] wake up
[34:32] and
[34:33] to the two different modulators the two
[34:35] different baud rates because the wake up
[34:36] is running at 175 kilowatt while the
[34:39] image data and the responses are run at
[34:41] 100 kilo board
[34:43] so i wrote my own source block you'll
[34:46] just feed an image into it tell us the
[34:48] display size that you want to use
[34:49] because the image is being scaled to the
[34:50] right display size
[34:52] um you give it a sample rate that would
[34:54] work
[34:55] the best is if it's an
[34:57] if it's divisible by both of the baud
[35:01] rates so in my case 2.1 mega samples
[35:03] work great
[35:04] and you just give
[35:06] the tag id
[35:07] and it will then take care of
[35:09] interpolating or the signal
[35:11] correctly so that um
[35:13] you won't have a baud rate of 175
[35:15] kiloboard for the wake up and 100 killer
[35:18] board for the
[35:20] regular image data
[35:21] then i have an interpolating fir filter
[35:24] which does the gaussian filter here to
[35:26] limit the out of band noise you don't
[35:28] actually have to use it you can
[35:29] deactivate it in case your computer
[35:30] can't handle too much uh calculation
[35:32] power anymore
[35:33] after that you have the frequency mod
[35:35] block
[35:36] which will uh just do the fsk modulation
[35:38] radio and then you just feed that out to
[35:40] the hackerf to send it
[35:46] so
[35:47] running this
[35:53] you'll see that first all the wake up
[35:54] frames are being generated then all the
[35:56] image frames are being generated
[35:58] and they're being sent now and now you
[35:59] should see on the multimeter the tag is
[36:01] turning on and starts to take power
[36:09] and now the tag should refresh and shows
[36:13] our customer logo
[36:21] and after the logo is finally applied
[36:24] the tag will power back down
[36:39] right so to conclude we were
[36:42] able to identify the unknown
[36:43] microcontroller we gained access to the
[36:45] debug uh port on the back
[36:48] we confirmed that the replay
[36:49] vulnerability is available and doesn't
[36:51] make sense to dive deeper into the
[36:53] actual protocol i then reverse
[36:55] engineered the if protocol and gain the
[36:56] ability to send and receive correct
[36:58] frames by generating the right csc
[37:00] checksums
[37:02] whether then able to
[37:04] receive and decode the esl price updates
[37:06] and display them we are able to change
[37:08] the tag contents now
[37:10] to arbitrary information and the kind of
[37:11] interesting part about this is as well
[37:13] that the range theoretically is only
[37:15] limited by rf power so you might be able
[37:17] to stand pretty far away from the actual
[37:19] attack and send it because you are not
[37:21] depending on any response from the tag
[37:23] the tag only needs to be able to hear
[37:25] you to change it so
[37:27] if we don't care about any regulations
[37:29] and pump just a bunch of if power out
[37:31] we're able to probably stand uh further
[37:33] away from the store as we want
[37:37] so lessons learned here is the protocol
[37:40] does not contain any security measure
[37:41] which is always just very bad practice
[37:44] and just because you're using a custom
[37:45] 433 megahertz protocol does not mean you
[37:48] increase security just make it harder
[37:50] for people to look into it because they
[37:51] need to know some rf basics
[37:54] to actually decode this protocol but
[37:56] once you know all this information a
[37:58] regular c1101 from texas instrument was
[38:01] about two dollars will be good enough to
[38:02] actually go into the store and change
[38:04] your prices so this is not protection at
[38:06] all
[38:08] also the protocol robustness could have
[38:10] been greatly improved from what i know
[38:11] from my university classes without
[38:14] having any real term experience here but
[38:16] there was no real error correction
[38:18] available
[38:19] so
[38:20] if one bit flip is in your image data
[38:22] the whole
[38:23] refresh of the image data will fail and
[38:25] you have to start over however just
[38:27] adding an error correction algorithm
[38:29] here would probably save you especially
[38:30] in the big tanks that send hundreds of
[38:32] frames
[38:33] and make it possible to correct any of
[38:35] the bit flips and thus
[38:37] have way better reliability in your
[38:40] in the pricing changes
[38:43] also relaying a microcontroller does not
[38:45] protect you against finding out what uh
[38:47] the microcontroller family is used
[38:50] because you can always build an asset
[38:52] figure out who the manufacturer is
[38:54] especially if it's regular
[38:56] big term manufacturers that mark their
[38:58] chips
[39:00] all code will be released on github
[39:01] unfortunately i wasn't able to yet but
[39:03] uh i'll make sure to upload everything
[39:05] all the custom blocks made for new radio
[39:07] and the sketches and and firmware dumps
[39:09] i have so if anybody wants to further
[39:11] dig into this uh feel free to
[39:16] if any further questions
[39:18] good
[39:22] thank you
[39:24] so it looked like a lot of your research
[39:26] was
[39:27] targeted at changing just the image on
[39:29] the actual display
[39:31] did any of your research look at using
[39:33] the display to reach back to the host
[39:35] computer with the application no i did
[39:37] not look into that
[39:39] do you think that's a possibility of
[39:41] using that display the rf to communicate
[39:43] back to the computer maybe
[39:46] um
[39:46] somehow
[39:48] in theory yeah that would be something
[39:50] very interesting to look further into
[39:51] yeah
[39:52] okay
[39:53] i just had a quick look at the base
[39:55] station but nothing too much was using
[39:57] stm32 so
[39:59] very easy to look further from there i
[40:01] guess probably not better secured at all
[40:03] either
[40:04] so
[40:06] it might be a good idea to have a look
[40:08] in this involved
[40:11] any other questions
[40:15] okay thank you stefan thank you

=== Content from packetstormsecurity.com_fd045c91_20250115_093257.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)


