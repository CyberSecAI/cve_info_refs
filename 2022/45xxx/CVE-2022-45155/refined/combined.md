=== Content from bugzilla.suse.com_facd5904_20250114_185711.html ===


| Bugzilla – Bug 1201138 | VUL-0: CVE-2022-45155: obs-service-go\_modules: arbitrary directory delete | Last modified: 2023-03-03 09:47:18 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1201138)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1201138**](show_bug.cgi?id=1201138)
(CVE-2022-45155)
- VUL-0: CVE-2022-45155: obs-service-go\_modules: arbitrary directory delete

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2022-45155: obs-service-go\_modules: arbitrary directory delete

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2022-45155 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Jeff Kowalczyk | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1200193](show_bug.cgi?id=1200193 "RESOLVED FIXED") | |  | Show dependency [tree](showdependencytree.cgi?id=1201138&hide_resolved=1) / [graph](showdependencygraph.cgi?id=1201138) | |  | | Reported: | 2022-07-04 08:39 UTC by Thomas Leroy | | --- | --- | | Modified: | 2023-03-03 09:47 UTC ([History](show_activity.cgi?id=1201138)) | | CC List: | 7 users (show)  anicka eich FSchreiner jkowalczyk jsegitz mrueckert thomas.leroy | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1201138) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1201138&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1201138&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1201138#c0)  Thomas Leroy   2022-07-04 08:39:09 UTC  ``` +++ This bug was initially created as a clone of [Bug #1200193](show_bug.cgi?id=1200193 "RESOLVED FIXED") +++  # Arbitrary directory delete  ## The problem  In `go_modules`, to clean the work environment after having extracted the package archive, the script deletes the extracted directory:  ```python         # remove extracted Go application source         try:             to_remove = os.path.join(outdir, basename) # *** 1 ***             log.info(f"Cleaning up working dir {to_remove}")             shutil.rmtree(to_remove)         except FileNotFoundError:             log.error(f"Could not remove directory not found {to_remove}") ```  The problem is that both `outdir` and `basename` are set by the command line arguments, without any sanitation. Allowing the user to set an arbitrary outdir is a dangerous feature (and we'll come back to it later), but at least here, extracting files at an arbitrary location on disk is not very relevant because it's possible by design.  The problem here is that the script allows the user to set a fully controllable `to_move` variable. Moreover, it's not checked whether the given archive is really an archive. No file type check is done. And when trying to uncompress the given archive, no `exit()` call is performed if the extraction fails. This makes  the program still going:  ```python def extract(filename, outdir):     log.info(f"Extracting {filename} to {outdir}")      cwd = os.getcwd()      # make path absolute so we can switch away from the current working directory     filename = os.path.join(cwd, filename)      log.info(f"Switching to {outdir}")     os.chdir(outdir)      try:         libarchive.extract_file(filename)     except libarchive.exception.ArchiveError as archive_error:         log.error(archive_error) # *** 2 *** should exit here      os.chdir(cwd) ```  Finally, the `basename` value is set by removing the possible compression extension to the `archive` name. If the value  passed to `archive` doesn't contain any compression extension, nothing happens.  With all these circumstances, we can run:  ```bash [~/SUSE/Audits/obs-service-go-modules/obs-service-go_modules]$ mkdir ../passwd                                                                                                                                                                              *[master] [~/SUSE/Audits/obs-service-go-modules/obs-service-go_modules]$ ./go_modules --outdir ../ --archive passwd                                                                                                                                                   *[master] INFO:obs-service-go_modules:Running OBS Source Service: obs-service-go_modules INFO:obs-service-go_modules:Using archive passwd INFO:obs-service-go_modules:Extracting passwd to ../ INFO:obs-service-go_modules:Switching to ../ ERROR:obs-service-go_modules:Failed to open '/home/tleroy/SUSE/Audits/obs-service-go-modules/obs-service-go_modules/passwd' (errno=2, retcode=-30, archive_p=94480200548544) INFO:obs-service-go_modules:Using go.mod found at ../SUSE:SLE-12:Update:Products:ManagerToolsBeta:Update/grafana-7.5.12/go.mod INFO:obs-service-go_modules:go mod download INFO:obs-service-go_modules:go mod vendor INFO:obs-service-go_modules:go mod verify INFO:obs-service-go_modules:Vendor go.mod dependencies to vendor.tar.gz INFO:obs-service-go_modules:Cleaning up working dir ../passwd [~/SUSE/Audits/obs-service-go-modules/obs-service-go_modules]$ ll ..                                                                                                                                                                                        *[master] total 8.0K drwxr-xr-x 1 tleroy users   96 Jun 23 13:50 obs-service-go_modules drwxr-xr-x 1 tleroy users   76 Jun 22 15:59 SUSE:SLE-12:Update:Products:ManagerToolsBeta:Update ```  If the script is badly or maliciously used with (even without) privileges, this can lead to severe issues. Therefore, I would rate this issue as `major`.   ## The fix  Stopping the execution in the exception handler of the `extract` function, would partially solve the problem.  But I think the best way to solve this is to forbid the user to choose the extraction directory, ie. removing the `outdir` parameter. This would also remove `to_remove = os.path.join(outdir, basename)` call, that always fails if the user chooses an archive that is in a nested directory. I don't know if the use cases of `go_modules` allows this, but extracting the archive and creating the vendor in the  archive's directory is much safer to be honest. Combined with an execution stop if the decompression fails, it would be secure. ``` [Comment 2](show_bug.cgi?id=1201138#c2)  Johannes Segitz   2023-02-28 09:15:31 UTC  ``` Please use CVE-2022-45155 for this ``` [Comment 3](show_bug.cgi?id=1201138#c3)  Thomas Leroy   2023-02-28 09:26:45 UTC  ``` Thanks for your submission in OBS Jeff. However, could you please add the references to these VUL bugs and this CVE in the changes file ([bsc#1201138](http://bugzilla.suse.com/show_bug.cgi?id=1201138) CVE-2022-45155 and [bsc#1201140](http://bugzilla.suse.com/show_bug.cgi?id=1201140))? As far as I can see, they are currently missing :) ``` [Comment 4](show_bug.cgi?id=1201138#c4)  Thomas Leroy   2023-03-02 13:49:22 UTC  ``` public ``` [Comment 5](show_bug.cgi?id=1201138#c5)  OBSbugzilla Bot   2023-03-02 16:35:02 UTC  ``` This is an autogenerated message for OBS integration: This bug (1201138) was mentioned in <https://build.opensuse.org/request/show/1068974> Factory / obs-service-go_modules ``` [Comment 6](show_bug.cgi?id=1201138#c6)  Thomas Leroy   2023-03-03 09:47:18 UTC  ``` Landed in Factory. Thanks to everyone involved! Closing ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1201138)
* - [XML](show_bug.cgi?ctype=xml&id=1201138)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1201138)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1201138)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)



=== Content from build.opensuse.org_1f1809df_20250115_113440.html ===

[![](https://build.opensuse.org/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsibWVzc2FnZSI6IkJBaHBCZz09IiwiZXhwIjpudWxsLCJwdXIiOiJibG9iX2lkIn19--aa5cb6f11b842d915c34968e0a4de823d259dcc0/openSUSEBuildService.png)](/)

[Sign Up](https://idp-portal.suse.com/univention/self-service/#page=createaccount)

Log In

[![](/assets/favicon-eb1d8ba2a269175c910cae3ae95a5d0dca90274b90db45c8efe0988ec9efd85d.svg)](/)Log In

---

or

[Sign Up](https://idp-portal.suse.com/univention/self-service/#page=createaccount)

##### Places

* [All Projects](/project "All Projects")
* [Status Monitor](/monitor "Status Monitor")

* Collapse sidebar

1. Request 1068974

This request supersedes:
[request 1068652](/request/show/1068652)
([Show diff](/request/show/1068974?diff_to_superseded=1068652))

##### Overview

### Request 1068974 accepted

(CVE-2022-45155, bsc#1201138, bsc#1201140). (forwarded request 1068711 from eeich)

* Created by
  [jfkw](/users/jfkw)
  almost 2 years ago
* In state
  [accepted](/request/show/1068974#request-history)
* Supersedes
  [1068652](/request/show/1068652)

* [Submit obs-service-go\_modules](#Submit_obs-service-go_modules2814015)

Loading...

* [Comments for request 1068974
  0](#comments)

*No comments available*

##### Request History

![Jeff Kowalczyk's avatar](https://www.gravatar.com/avatar/bedc297d1b1ac6bcbcf64f0154abae7d?s=38&d=robohash "Jeff Kowalczyk")

[jfkw](/users/jfkw)
created request
[almost 2 years ago](#request-creation "2023-03-02 15:57 UTC")

(CVE-2022-45155, bsc#1201138, bsc#1201140). (forwarded request 1068711 from eeich)

---

![Factory Auto's avatar](https://www.gravatar.com/avatar/3be6bec62ce4af49b4b555cbd8bd3b9d?s=38&d=robohash "Factory Auto")

[factory-auto](/users/factory-auto)
added opensuse-review-team as a reviewer
[almost 2 years ago](#status-history-16103436 "2023-03-02 16:01 UTC")

Please review sources

---

![Factory Auto's avatar](https://www.gravatar.com/avatar/3be6bec62ce4af49b4b555cbd8bd3b9d?s=38&d=robohash "Factory Auto")

[factory-auto](/users/factory-auto)
accepted review
[almost 2 years ago](#status-history-16103439 "2023-03-02 16:01 UTC")

Check script succeeded

---

![Staging Bot's avatar](https://www.gravatar.com/avatar/d41b2f36932f8e2d3648816d60497bb9?s=38&d=robohash "Staging Bot")

[staging-bot](/users/staging-bot)
added openSUSE:Factory:Staging:adi:27 as a reviewer
[almost 2 years ago](#status-history-16103445 "2023-03-02 16:03 UTC")

Being evaluated by staging project "openSUSE:Factory:Staging:adi:27"

---

![Staging Bot's avatar](https://www.gravatar.com/avatar/d41b2f36932f8e2d3648816d60497bb9?s=38&d=robohash "Staging Bot")

[staging-bot](/users/staging-bot)
accepted review
[almost 2 years ago](#status-history-16103448 "2023-03-02 16:03 UTC")

Picked "openSUSE:Factory:Staging:adi:27"

---

![Saul Goodman's avatar](https://www.gravatar.com/avatar/ffc053e2eedefdebcd8cbbc514d9dc11?s=38&d=robohash "Saul Goodman")

[licensedigger](/users/licensedigger)
accepted review
[almost 2 years ago](#status-history-16103451 "2023-03-02 16:05 UTC")

ok

---

![Dominique Leuenberger's avatar](https://www.gravatar.com/avatar/5cdd10d836bdda3796cf6bc1ab2d5a78?s=38&d=robohash "Dominique Leuenberger")

[dimstar](/users/dimstar)
accepted review
[almost 2 years ago](#status-history-16103481 "2023-03-02 16:16 UTC")

---

![Dominique Leuenberger's avatar](https://www.gravatar.com/avatar/58018ece4601a5b60720b91442e2612d?s=38&d=robohash "Dominique Leuenberger")

[dimstar\_suse](/users/dimstar_suse)
accepted review
[almost 2 years ago](#status-history-16114887 "2023-03-02 22:04 UTC")

Staging Project openSUSE:Factory:Staging:adi:27 got accepted.

---

![Dominique Leuenberger's avatar](https://www.gravatar.com/avatar/58018ece4601a5b60720b91442e2612d?s=38&d=robohash "Dominique Leuenberger")

[dimstar\_suse](/users/dimstar_suse)
approved review
[almost 2 years ago](#status-history-16114890 "2023-03-02 22:04 UTC")

Staging Project openSUSE:Factory:Staging:adi:27 got accepted.

---

![Dominique Leuenberger's avatar](https://www.gravatar.com/avatar/58018ece4601a5b60720b91442e2612d?s=38&d=robohash "Dominique Leuenberger")

[dimstar\_suse](/users/dimstar_suse)
accepted request
[almost 2 years ago](#status-history-16114893 "2023-03-02 22:04 UTC")

Staging Project openSUSE:Factory:Staging:adi:27 got accepted.

##### Package Maintainers

OK

**Locations**

* [Projects](/project)
* [Search](/search)
* [Status Monitor](/monitor)

**Help**

* [OpenBuildService.org](https://openbuildservice.org/)
* [Documentation](https://openbuildservice.org/help/manuals/)
* [API Documentation](/apidocs/index)
* [Code of Conduct](/code_of_conduct)

**Contact**

* [Support](https://openbuildservice.org/support/)
* [@OBShq](https://fosstodon.org/%40obshq)
* [Terms](https://en.opensuse.org/Terms_of_site)

openSUSE Build Service is sponsored by
[![](/assets/icons/sponsor_suse-92006bbd693f5f675ccab53afe3e9c858aada01882b490fa784d8cc8a9f4f080.png)](http://www.suse.com "Enterprise Linux you can rely on.")

[![](/assets/icons/sponsor_amd-5ec958d97e60089cad23346048c0b79d2144408deda3d0495fe023bf29ec0d7b.png)](http://www.amd.com/ "Enabling today. Inspiring tomorrow.")

[![](/assets/icons/sponsor_b1-systems-a5bc5a49e7fc7854f9a688f873b074330a68bf7d286c4fda6bd0dd2e592752da.png)](http://www.b1-systems.de/en/homepage/ "Linux / Open Source Consulting, Training, Development & Support")

[![](/assets/icons/sponsor_heinlein-dc9ce64ab5cb25a15c4fd9a1b743f7886867932283f1dace07f0599a663a222a.png)](https://www.heinlein-support.de/ "We provide Knowledge and Experience")

[![](/assets/icons/sponsor_apm-1a5a654e5e7ed3df9d4717a1d68f6c4593096304173961c8b486a3ff3bddde75.png)](https://www.apm.com "Build the future of ARMv8 on Applied Micro")

The Open Build Service is an
[openSUSE project](https://www.opensuse.org).

* [Sign Up](https://idp-portal.suse.com/univention/self-service/#page=createaccount)
* Log In
* Places

##### Places

* [All Projects](/project "All Projects")
* [Status Monitor](/monitor "Status Monitor")


