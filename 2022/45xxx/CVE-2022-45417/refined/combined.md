=== Content from bugzilla.mozilla.org_e280eeb6_20250114_210437.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1794508)
* [XML](/show_bug.cgi?ctype=xml&id=1794508)

Closed
[Bug 1794508](/show_bug.cgi?id=1794508)
(CVE-2022-45417)

Opened 2 years ago
Closed 2 years ago

# `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

`GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode

## Categories

### (Core :: DOM: Service Workers, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Service%20Workers#DOM%3A%20Service%20Workers)

DOM: Service Workers
▾

Core :: DOM: Service Workers
This component covers the [Service Worker](https://github.com/slightlyoff/ServiceWorker/) implementation in Gecko.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Service%20Workers&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Service%20Workers&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Service%20Workers)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Firefox 104

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

108 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=unaffected) |
| firefox105 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=wontfix) |
| firefox106 | [+](/buglist.cgi?f1=cf_tracking_firefox106&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=wontfix) |
| firefox107 | --- | [verified](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=verified) |
| firefox108 | --- | [verified](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 |  | unaffected |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox105 |  | wontfix |
| firefox106 | + | wontfix |
| firefox107 |  | verified |
| firefox108 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: saschanaz, Assigned: saschanaz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/bfbb1b40a40aa4b5b3e877686791ccc6?d=mm&size=40)  [saschanaz](/user_profile?user_id=473060)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/bfbb1b40a40aa4b5b3e877686791ccc6?d=mm&size=40)  [saschanaz](/user_profile?user_id=473060)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

### (Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[1776109](/show_bug.cgi?id=1776109 "RESOLVED FIXED - Try hiding caches/indexedDB/serviceWorker in PBMode")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main107+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-45417

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main107+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth](/attachment.cgi?id=9297913)  [2 years ago](#c1)  [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)   48 bytes, text/x-phabricator-request | dmeehan : [approval-mozilla-beta+](#c11 "2 years ago")  pascalc : [approval-mozilla-release-](#a1978251_24572 "2 years ago")  tjr : [sec-approval+](#c7 "2 years ago") | [Details](/attachment.cgi?id=9297913&action=edit) | [Review](/attachment.cgi?id=9297913) |
| --- | --- | --- |
| [Bug 1794508 - Add tests r=asuth](/attachment.cgi?id=9301617)  [2 years ago](#c14)  [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9301617&action=edit) | [Review](/attachment.cgi?id=9301617) |
| [advisory.txt](/attachment.cgi?id=9302922)  [2 years ago](#c19)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   407 bytes, text/plain |  | [Details](/attachment.cgi?id=9302922&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1794508#c0)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1794508&comment_id=16106293 "1 revision") |
|  | |

`ePartitionForeignOrDeny` can appear in some third party iframes and thus cause detection failure.

We'll have to update `dom/serviceworkers/test/test_privateBrowsing.html` to cover that.

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a17_473060)• 2 years ago |

Component: DOM: Core & HTML → DOM: Service Workers

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a73_473060)• 2 years ago |

Summary: `ServiceWorkersEnabled() == ePrivateBrowsing` does not always detect private browsing mode → `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1794508#c1)• 2 years ago |
|  | |

Attached file
[Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth](attachment.cgi?id=9297913)
— [Details](attachment.cgi?id=9297913&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a947_600971)• 2 years ago |

Assignee: nobody → krosylightStatus: NEW → ASSIGNED

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1794508#c2)• 2 years ago |
|  | |

Comment on [attachment 9297913](/attachment.cgi?id=9297913 "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") [[details]](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth")

[Bug 1794508](/show_bug.cgi?id=1794508 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode") - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: The patch changes how we detect private browsing. The previous way was faulty but it's not clear from the code how those two are different.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: 104
* **If not all supported branches, which bug introduced the flaw?**: [Bug 1776109](/show_bug.cgi?id=1776109 "RESOLVED FIXED - Try hiding caches/indexedDB/serviceWorker in PBMode")
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: This just reverts the change from [bug 1776109](/show_bug.cgi?id=1776109 "RESOLVED FIXED - Try hiding caches/indexedDB/serviceWorker in PBMode") part 2 patch, which was a refactoring without new features. And its child patch is already reverted, so any regression is not likely.
* **Is Android affected?**: Yes
[Attachment #9297913](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") -
Flags: sec-approval?

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1794508#c3)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1794508&comment_id=16106450 "1 revision") |
|  | |

I'm going to attempt to summarize this situation which is discussed and investigated in much greater depth at <https://mozilla.slack.com/archives/C4S6616E9/p1665422205062729> (although there's a process of discovery there).

:pascalc I see you are listed as the release owner for Firefox 106 at <https://fx-trains.herokuapp.com/release/?version=106> so I wanted to bring this to your attention as it seems like if we don't land <https://phabricator.services.mozilla.com/D159002> into the beta we may want it to be able to get into a dot release.

### General Problem Statement

On release, beta, and nightly, it's possible for ServiceWorkers to be persisted to disk in private browsing mode for origins where [ePartitionForeignOrDeny or ePartitionTrackersOrDeny](https://searchfox.org/mozilla-central/rev/ffa4d00965c5281def6d3ddcbcdf6259d38c9b9a/toolkit/components/antitracking/StorageAccess.h#32-37) are returned from the [StorageAllowedFor\* methods in StorageAccess.h](https://searchfox.org/mozilla-central/source/toolkit/components/antitracking/StorageAccess.h). I don't fully understand what situations these are, but ideally :timhuang can help contextualize when this would be, I've set a needinfo.

The concern is that we have never intended to allow ServiceWorkers to be persisted to disk in private browsing mode because our threat model has generally been "data does not get written to disk in private browsing mode"[1]. When this happens, an origin the user has indirectly visited will have its name written to disk in the clear as well as the first-party top-level origin name and any data related to the script will be written in the clear, albeit compressed. It seems likely that the ServiceWorker would fail to be able to write any data to the Cache API storage though, so it should be just the ServiceWorker that gets installed.

This bug should stop new ServiceWorkers from being installed.

### What happens to profiles where the bug happened? / Follow-ups

It's quite possible that ServiceWorkers installed via this mechanism will not be cleaned up and will stick around until the user cleans them up.

Specifically, as I understand it, Private Browsing cleanup happens via the ["last-pb-context-exited"](https://searchfox.org/mozilla-central/search?q=%22last-pb-context-exited%22&path=&case=false&regexp=false) observer notification. I do not currently see any connective linkage between this observer notification and nsIClearDataService or sanitizer.jsm which could serve as a back-stop, but I hopefully am missing something[2]. Such glue would potentially look like a call to [nsIClearDataService.deleteDataFromOriginAttributesPattern](https://searchfox.org/mozilla-central/rev/ffa4d00965c5281def6d3ddcbcdf6259d38c9b9a/toolkit/components/cleardata/nsIClearDataService.idl#127-134) specifying a pattern specifying [privateBrowsingId: 1](https://searchfox.org/mozilla-central/rev/ffa4d00965c5281def6d3ddcbcdf6259d38c9b9a/dom/chrome-webidl/ChromeUtils.webidl#887). This would potentially be a reasonable thing for us to add if it's not already there. In particular, this should clean up the origin directory as well as the registration.

In terms of the simplest way to clean this up, we can add logic [similar to the web-extension ServiceWorker purging logic](https://searchfox.org/mozilla-central/rev/ffa4d00965c5281def6d3ddcbcdf6259d38c9b9a/dom/serviceworkers/ServiceWorkerManager.cpp#1511-1523) we already implement which ensures that we ignore registrations we don't want and purge their related cache. I think there is actually an oversight in that logic, however, in that I think we're failing to call [MaybeSendUnregister](https://searchfox.org/mozilla-central/rev/ffa4d00965c5281def6d3ddcbcdf6259d38c9b9a/dom/serviceworkers/ServiceWorkerManager.cpp#3305) which will actually cause the registration to be dropped from the ServiceWorkerRegistrar's copy of the registrations. Without that, although we won't show the registration in about:serviceworkers, it would still be persistent on disk. This will remove the serviceworker but I do not believe it will be sufficient to clear the QuotaManager-managed origin directory.

An option to ensure that the origin directory gets cleaned up (separate from the registration) is to ensure that QuotaManager's initialization notices any directories with a private browsing id and purges them. This would not be sufficient to remove the registration from the `serviceworker.txt` file on its own.

Arguably implementing either of these clean-ups does make it more clear what's going on, so it might make sense for clean-up logic to land in a second set of fixes in the future if we're concerned about bad actors intentionally trying to install ServiceWorkers in private browsing mode. It's not clear if this is actually a concern though, compared to cleaning up the private browsing byproducts on disk. That said, the reversion in <https://phabricator.services.mozilla.com/D159002> is extremely straightforward and safe to land and uplift all over the place, whereas most of these potential cleanup fixes want testing, etc. that we don't have ready to go yet.

1: Note that we are moving towards allowing encrypted data to be written to disk as long as all file paths also obscure the origins at play.

2: Like how does our IndexedDB private-browsing support clean up?

Flags: needinfo?(tihuang)Flags: needinfo?(pascalc)

|  | [Tim Huang[:timhuang]](/user_profile?user_id=547199) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1794508#c4)• 2 years ago |
|  | |

The `ePrivateBrowsing` storage access represents that the storage is allowed to access in the private browsing context. So, if the context has storage access, we will return `ePrivateBrowsing`.

However, we don't have a concept that storage is partitioned in private browsing context. So, the `StorageAllowedFor*` methods will return `ePartition*` when the third-party iframe doesn't have storage access regardless of whether it's in the private window. So, we might need to introduce this concept so that storage can handle partitioning in the private window correctly, then we can use storage access as the single source of truth. But, before we get to that point, we should still rely on the existing private window checks to decide the storage behavior in private windows.

FWIW, I think we should add tests to make sure this won't happen again. :)

Flags: needinfo?(tihuang)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a62041_406194)• 2 years ago |

Group: core-security → dom-core-security

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a62086_75935)• 2 years ago |

[status-firefox105](/buglist.cgi?f1=cf_status_firefox105&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=wontfix)
[status-firefox106](/buglist.cgi?f1=cf_status_firefox106&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=affected)
[status-firefox107](/buglist.cgi?f1=cf_status_firefox107&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=unaffected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a62108_75935)• 2 years ago |

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Regressed by: [1776109](/show_bug.cgi?id=1776109 "RESOLVED FIXED - Try hiding caches/indexedDB/serviceWorker in PBMode")

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1794508#c5)• 2 years ago |
|  | |

I've been following up with the user who brought this to my attention and they indicated that there are indeed byproducts left on disk after Firefox shuts down because there is not an explicit sweep for permanent private browsing mode. Specific examples they gave from their testing:

```
PROFILE/storage/default/https+++learn-pwa-sw-registration.glitch.me^privateBrowsingId=1&partitionKey=%28https%2Cweb.dev%29
PROFILE/storage/default/https+++faststrip.apester.com^privateBrowsingId=1&partitionKey=%28https%2Cfilm.tv%29
PROFILE/storage/default/https+++vuiws.csb.app^privateBrowsingId=1&partitionKey=%28https%2Ccodesandbox.io%29

```

The 3rd (and I think 1st too? the 2nd is from their initial report) is from the reproduction they provided (and I posted in the slack thread) of <https://codesandbox.io/s/vuiws?file=/src/index.js> which when I attempted to reproduce on Firefox nightly I found that:

1. We 100% attempted to install the ServiceWorker
2. It failed to install because the SW through an exception which may have been due to an attempt to use the DOM Cache API which would fail due to a back-stop. However, the directory still gets created on disk.
3. I ended up with both the 1st and 3rd directories on my disk but no entries in serviceworker.txt or about:serviceworkers

We will definitely need cleanup logic in ServiceWorkerManager (SWM) and QuotaManager (QM) to ensure cleanups happen. In particular, the QM logic is necessary because serviceworker.txt did not end up with with registrations and also because even with the SWM deleting the cache for the script, it would not be sufficient to guarantee the QM directory gets wiped. These will be slightly larger fixes, but not huge; I could probably do them not on a sec-bug and avoid painting a super-obvious target as I think there is existing logic for both SWM and QM to remove things in this case that could be generalized and made to seem like a speculative backstop, but the patch would fundamentally need to reference privateBrowsingId to work.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1794508#c6)• 2 years ago |
|  | |

### Privacy Implications

Elaborating on the implications of [comment 5](/show_bug.cgi?id=1794508#c5 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode") (and [comment 3](/show_bug.cgi?id=1794508#c3 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode")):

* Users using private browsing mode with tracking protection enabled to perform partitioning could have directories in their profile that contain both the origin name of the first-party / top-level site (as the `partitionKey`) they were visiting as well as the third-party site that triggered the attempted ServiceWorker installation.
* These directories will persist until the user takes explicit action to either [clear the data for the sites on a per-site basis](https://support.mozilla.org/en-US/kb/clear-cookies-and-site-data-firefox#w_clear-cookies-for-any-website) or [clears all data](https://support.mozilla.org/en-US/kb/clear-cookies-and-site-data-firefox#w_clear-all-cookies-site-data-and-cache). OR until we land cleanup fixes.
  + To reiterate, private browsing mode currently does not perform any failsafe cleanup pass via Sanitizer.jsm/nsIClearDataService as it assumes no data was written in the first place, so it is not trying to clear this data.

The intent behind private browsing mode is that we do not leave anything on disk that indicates the user's browsing history, whereas this does indicate parts of the user's browsing history, so this does need to be fixed with high priority.

Severity: -- → S2Priority: -- → P1

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a165015_1689)• 2 years ago |

Keywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)Version: unspecified → Firefox 104

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1794508#c7)• 2 years ago |
|  | |

Comment on [attachment 9297913](/attachment.cgi?id=9297913 "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") [[details]](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth")

[Bug 1794508](/show_bug.cgi?id=1794508 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode") - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth

Approved to land and uplift after beta branches

[Attachment #9297913](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") -
Flags: sec-approval? → sec-approval+

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1794508#c8)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1794508&comment_id=16117965 "3 revisions") |
|  | |

Comment on [attachment 9297913](/attachment.cgi?id=9297913 "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") [[details]](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth")

[Bug 1794508](/show_bug.cgi?id=1794508 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode") - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth

### Beta/Release Uplift Approval Request

* **User impact if declined**: Certain partitioned iframes can allow writing the name of the websites a user visited in Private Browsing Mode to the disk permanently. [Comment #3](/show_bug.cgi?id=1794508#c3 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode") for more details.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: 1. Access <https://codesandbox.io/s/vuiws?file=/src/index.js> in Private Browsing mode

2. Check the page is correctly loaded and the console has some messages. (It should show an error at `navigator.serviceWorker`)
3. Check whether `(profile directory)/storage/default` got a directory with `privateBrowsingId` in its name. This currently must not happen.
4. `about:serviceworkers` should not show anything about `codesandbox.io` and `*.csb.app`

(Automatic tests will follow as a separate patch)

* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This just reverts the change from [bug 1776109](/show_bug.cgi?id=1776109 "RESOLVED FIXED - Try hiding caches/indexedDB/serviceWorker in PBMode") part 2 patch, which was a refactoring without new features. And its child patch is already reverted, so any regression is not likely.
* **String changes made/needed**:
* **Is Android affected?**: Yes
[Attachment #9297913](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") -
Flags: approval-mozilla-release?
[Attachment #9297913](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") -
Flags: approval-mozilla-beta?

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a583519_473060)• 2 years ago |

Flags: qe-verify+

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1794508#c9)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1794508&comment_id=16118034 "1 revision") |
|  | |

We might want to add a temporary cleaner as I already see directories with `^privateBrowsingId=1` from MDN and TripAdvisor in my profile. Thoughts?

Flags: needinfo?(bugmail)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1794508#c10)• 2 years ago |
|  | |

Replace GetStorageAccess with IsInPrivateBrowsing r=asuth

<https://hg.mozilla.org/integration/autoland/rev/a41265da4a2a475ed7cde77c9aa285ecdf413f3b>

<https://hg.mozilla.org/mozilla-central/rev/a41265da4a2a>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 2 years ago
[status-firefox108](/buglist.cgi?f1=cf_status_firefox108&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 108 Branch

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1794508#c11)• 2 years ago |
|  | |

Comment on [attachment 9297913](/attachment.cgi?id=9297913 "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") [[details]](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth")

[Bug 1794508](/show_bug.cgi?id=1794508 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode") - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth

Approved for 107.0b2.

[Attachment #9297913](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1794508#c12)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/cdce62059a85>

[status-firefox107](/buglist.cgi?f1=cf_status_firefox107&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=fixed)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a718591_553429)• 2 years ago |

QA Whiteboard: [qa-triaged]

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1794508#c13)• 2 years ago |
|  | |

Reproduced the bug using STR from [comment 8](/show_bug.cgi?id=1794508#c8 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode"), on an affected Nightly build (2022-10-10).

This is verified as fixed on latest Beta 107.0b2 and Nightly 108.0a1 (2022-10-19), across platforms: Win 10 x64, macOS 11 and Ubuntu 18.04 x64.

Status: RESOLVED → VERIFIED
[status-firefox107](/buglist.cgi?f1=cf_status_firefox107&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=verified)
[status-firefox108](/buglist.cgi?f1=cf_status_firefox108&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=verified)Flags: qe-verify+

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a999198_24572)• 2 years ago |

[tracking-firefox106](/buglist.cgi?f1=cf_tracking_firefox106&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox106&o1=equals&v1=%2B)Flags: needinfo?(pascalc)

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1794508#c14)• 2 years ago |
|  | |

Attached file
[Bug 1794508 - Add tests r=asuth](attachment.cgi?id=9301617)
— [Details](attachment.cgi?id=9301617&action=edit)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1794508#c15)• 2 years ago |
|  | |

We build our RC build on Monday, so that will be for 107.

[status-firefox106](/buglist.cgi?f1=cf_status_firefox106&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=wontfix)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a1978251_24572)• 2 years ago |

[Attachment #9297913](/attachment.cgi?id=9297913&action=edit "Bug 1794508 - Replace GetStorageAccess with IsInPrivateBrowsing r=asuth") -
Flags: approval-mozilla-release? → approval-mozilla-release-

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1794508#c16)• 2 years ago |
|  | |

A patch has been attached on this bug, which was already closed. Filing a separate bug will ensure better tracking. If this was not by mistake and further action is needed, please alert the appropriate party. (Or: if the patch doesn't change behavior -- e.g. landing a test case, or fixing a typo -- then feel free to disregard this message)

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1794508#c17)• 2 years ago |
|  | |

I think it's okay for security issues to have patches separately landed, or am I wrong?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1794508#c18)• 2 years ago |
|  | |

(In reply to Kagami :saschanaz from [comment #17](/show_bug.cgi?id=1794508#c17 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode"))

> I think it's okay for security issues to have patches separately landed, or am I wrong?

Yes, this is a situation where it's fine so long as you remember to land the test eventually :)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a2652655_578488)• 2 years ago |

Whiteboard: [adv-main107+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1794508#c19)• 2 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9302922)
— [Details](attachment.cgi?id=9302922&action=edit)

It would be great if you could double-check this description.

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1794508#c20)• 2 years ago |
|  | |

I (and :asuth) haven't succeeded reproducing a living service worker being written to disk. "they would run again" in the second sentence may imply that they ever could run, and this is unconfirmed. I suggest omitting "again" there. (See also [comment #5](/show_bug.cgi?id=1794508#c5 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode").)

"Service Workers being written" also sounds like that to me. Perhaps just "files being written", or "directories with domain names" if it can be more specific.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a3003913_578488)• 2 years ago |

Alias: CVE-2022-45417

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1794508#c21)• 2 years ago |
|  | |

(In reply to Kagami [:saschanaz] from [comment #9](/show_bug.cgi?id=1794508#c9 "VERIFIED FIXED - `GetStorageAccess() == ePrivateBrowsing` in ServiceWorkersEnabled() does not always detect private browsing mode"))

> We might want to add a temporary cleaner as I already see directories with `^privateBrowsingId=1` from MDN and TripAdvisor in my profile. Thoughts?

I believe we ended up letting the falling edge of the normal PB exited observer notification clean these up with <https://phabricator.services.mozilla.com/D175123> providing test coverage.

Flags: needinfo?(bugmail)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1794508#a21194232_1689)• 2 years ago |

Group: core-security-release

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1794508#c22)• 2 years ago |
|  | |

Pushed by krosylight@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/65a3b0af04d2>
Add tests r=asuth,anti-tracking-reviewers,pbz

|  | [Serban Stanca [:SerbanS]](/user_profile?user_id=713502) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1794508#c23)• 2 years ago |
| bugherder | |

<https://hg.mozilla.org/mozilla-central/rev/65a3b0af04d2>

You need to [log in](/show_bug.cgi?id=1794508&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_18bdcdd2_20250114_210438.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-47

## Security Vulnerabilities fixed in Firefox 107

Announced
November 15, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 107

This advisory was updated December 13, 2022 to add CVE-2022-46882 and CVE-2022-46883. Both fixes were included in the original release of Firefox 107, but did not appear in the advisory published at that time.

#### [#CVE-2022-45403: Service Workers might have learned size of cross-origin media files](#CVE-2022-45403)

Reporter
Anne van Kesteren and Karl Tomlinson
Impact
high
##### Description

Service Workers should not be able to infer information about opaque cross-origin responses; but timing information for cross-origin media combined with Range requests might have allowed them to determine the presence or length of a media file.

##### References

* [Bug 1762078](https://bugzilla.mozilla.org/show_bug.cgi?id=1762078)

#### [#CVE-2022-45404: Fullscreen notification bypass](#CVE-2022-45404)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Through a series of popup and `window.print()` calls, an attacker can cause a window to go fullscreen without the user seeing the notification prompt, resulting in potential user confusion or spoofing attacks.

##### References

* [Bug 1790815](https://bugzilla.mozilla.org/show_bug.cgi?id=1790815)

#### [#CVE-2022-45405: Use-after-free in InputStream implementation](#CVE-2022-45405)

Reporter
Atte Kettunen
Impact
high
##### Description

Freeing arbitrary `nsIInputStream`'s on a different thread than creation could have led to a use-after-free and potentially exploitable crash.

##### References

* [Bug 1791314](https://bugzilla.mozilla.org/show_bug.cgi?id=1791314)

#### [#CVE-2022-45406: Use-after-free of a JavaScript Realm](#CVE-2022-45406)

Reporter
Samuel Groß
Impact
high
##### Description

If an out-of-memory condition occurred when creating a JavaScript global, a JavaScript realm may be deleted while references to it lived on in a BaseShape. This could lead to a use-after-free causing a potentially exploitable crash.

##### References

* [Bug 1791975](https://bugzilla.mozilla.org/show_bug.cgi?id=1791975)

#### [#CVE-2022-45407: Loading fonts on workers was not thread-safe](#CVE-2022-45407)

Reporter
Armin Ebert
Impact
high
##### Description

If an attacker loaded a font using `FontFace()` on a background worker, a use-after-free could have occurred, leading to a potentially exploitable crash.

##### References

* [Bug 1793314](https://bugzilla.mozilla.org/show_bug.cgi?id=1793314)

#### [#CVE-2022-45408: Fullscreen notification bypass via windowName](#CVE-2022-45408)

Reporter
Irvan Kurniawan
Impact
high
##### Description

Through a series of popups that reuse windowName, an attacker can cause a window to go fullscreen without the user seeing the notification prompt, resulting in potential user confusion or spoofing attacks.

##### References

* [Bug 1793829](https://bugzilla.mozilla.org/show_bug.cgi?id=1793829)

#### [#CVE-2022-45409: Use-after-free in Garbage Collection](#CVE-2022-45409)

Reporter
Gary Kwong
Impact
high
##### Description

The garbage collector could have been aborted in several states and zones and `GCRuntime::finishCollection` may not have been called, leading to a use-after-free and potentially exploitable crash

##### References

* [Bug 1796901](https://bugzilla.mozilla.org/show_bug.cgi?id=1796901)

#### [#CVE-2022-45410: ServiceWorker-intercepted requests bypassed SameSite cookie policy](#CVE-2022-45410)

Reporter
Dongsung Kim
Impact
moderate
##### Description

When a ServiceWorker intercepted a request with `FetchEvent`, the origin of the request was lost after the ServiceWorker took ownership of it. This had the effect of negating SameSite cookie protections. This was addressed in the spec and then in browsers.

##### References

* [Bug 1658869](https://bugzilla.mozilla.org/show_bug.cgi?id=1658869)

#### [#CVE-2022-45411: Cross-Site Tracing was possible via non-standard override headers](#CVE-2022-45411)

Reporter
scarlet
Impact
moderate
##### Description

Cross-Site Tracing occurs when a server will echo a request back via the Trace method, allowing an XSS attack to access to authorization headers and cookies inaccessible to JavaScript (such as cookies protected by HTTPOnly). To mitigate this attack, browsers placed limits on `fetch()` and XMLHttpRequest; however some webservers have implemented non-standard headers such as `X-Http-Method-Override` that override the HTTP method, and made this attack possible again. Firefox has applied the same mitigations to the use of this and similar headers.

##### References

* [Bug 1790311](https://bugzilla.mozilla.org/show_bug.cgi?id=1790311)

#### [#CVE-2022-45412: Symlinks may resolve to partially uninitialized buffers](#CVE-2022-45412)

Reporter
Armin Ebert
Impact
moderate
##### Description

When resolving a symlink such as `file:///proc/self/fd/1`, an error message may be produced where the symlink was resolved to a string containing unitialized memory in the buffer.
*This bug only affects Firefox on Unix-based operated systems (Android, Linux, MacOS). Windows is unaffected.*

##### References

* [Bug 1791029](https://bugzilla.mozilla.org/show_bug.cgi?id=1791029)

#### [#CVE-2022-45413: SameSite=Strict cookies could have been sent cross-site via intent URLs](#CVE-2022-45413)

Reporter
Axel Chong
Impact
moderate
##### Description

Using the `S.browser_fallback_url parameter` parameter, an attacker could redirect a user to a URL and cause SameSite=Strict cookies to be sent.
*This issue only affects Firefox for Android. Other operating systems are not affected.*

##### References

* [Bug 1791201](https://bugzilla.mozilla.org/show_bug.cgi?id=1791201)

#### [#CVE-2022-40674: Use-after-free vulnerability in expat](#CVE-2022-40674)

Reporter
Rhodri James
Impact
moderate
##### Description

A flaw in XML parsing could have led to a use-after-free causing a potentially exploitable crash.
*In official releases of Firefox this vulnerability is mitigated by wasm sandboxing; versions managed by Linux distributions may have other settings.*

##### References

* [Bug 1791598](https://bugzilla.mozilla.org/show_bug.cgi?id=1791598)

#### [#CVE-2022-45415: Downloaded file may have been saved with malicious extension](#CVE-2022-45415)

Reporter
Jefferson Scher and Jayateertha Guruprasad
Impact
moderate
##### Description

When downloading an HTML file, if the title of the page was formatted as a filename with a malicious extension, Firefox may have saved the file with that extension, leading to possible system compromise if the downloaded file was later ran.

##### References

* [Bug 1793551](https://bugzilla.mozilla.org/show_bug.cgi?id=1793551)

#### [#CVE-2022-45416: Keystroke Side-Channel Leakage](#CVE-2022-45416)

Reporter
Erik Kraft, Martin Schwarzl, and Andrew McCreight
Impact
moderate
##### Description

Keyboard events reference strings like "KeyA" that were at fixed, known, and widely-spread addresses. Cache-based timing attacks such as Prime+Probe could have possibly figured out which keys were being pressed.

##### References

* [Bug 1793676](https://bugzilla.mozilla.org/show_bug.cgi?id=1793676)

#### [#CVE-2022-45417: Service Workers in Private Browsing Mode may have been written to disk](#CVE-2022-45417)

Reporter
Kagami
Impact
moderate
##### Description

Service Workers did not detect Private Browsing Mode correctly in all cases, which could have led to Service Workers being written to disk for websites visited in Private Browsing Mode. This would not have persisted them in a state where they would run again, but it would have leaked Private Browsing Mode details to disk.

##### References

* [Bug 1794508](https://bugzilla.mozilla.org/show_bug.cgi?id=1794508)

#### [#CVE-2022-45418: Custom mouse cursor could have been drawn over browser UI](#CVE-2022-45418)

Reporter
Hafiizh
Impact
moderate
##### Description

If a custom mouse cursor is specified in CSS, under certain circumstances the cursor could have been drawn over the browser UI, resulting in potential user confusion or spoofing attacks.

##### References

* [Bug 1795815](https://bugzilla.mozilla.org/show_bug.cgi?id=1795815)

#### [#CVE-2022-46882: Use-after-free in WebGL](#CVE-2022-46882)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

A use-after-free in WebGL extensions could have led to a potentially exploitable crash.

##### References

* [Bug 1789371](https://bugzilla.mozilla.org/show_bug.cgi?id=1789371)

#### [#CVE-2022-45419: Deleting a security exception did not take effect immediately](#CVE-2022-45419)

Reporter
Ronald Crane
Impact
low
##### Description

If the user added a security exception for an invalid TLS certificate, opened an ongoing TLS connection with a server that used that certificate, and then deleted the exception, Firefox would have kept the connection alive, making it seem like the certificate was still trusted.

##### References

* [Bug 1716082](https://bugzilla.mozilla.org/show_bug.cgi?id=1716082)

#### [#CVE-2022-45420: Iframe contents could be rendered outside the iframe](#CVE-2022-45420)

Reporter
Suhwan Song of SNU CompSec Lab
Impact
low
##### Description

Using tables inside of an iframe, an attacker could have caused iframe contents to be rendered outside the boundaries of the iframe, resulting in potential user confusion or spoofing attacks.

##### References

* [Bug 1792643](https://bugzilla.mozilla.org/show_bug.cgi?id=1792643)

#### [#CVE-2022-45421: Memory safety bugs fixed in Firefox 107 and Firefox ESR 102.5](#CVE-2022-45421)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Andrew McCreight and Gabriele Svelto reported memory safety bugs present in Firefox 106 and Firefox ESR 102.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 107 and Firefox ESR 102.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1767920%2C1789808%2C1794061)

#### [#CVE-2022-46883: Memory safety bugs fixed in Firefox 107](#CVE-2022-46883)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Gabriele Svelto, Yulia Startsev, Andrew McCreight and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 106. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 107](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1584674%2C1791152%2C1792241%2C1792984%2C1793127%2C1794645)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


