=== Content from github.com_e510782c_20250114_193213.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsheredom%2Fjson.h%2Fissues%2F97)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsheredom%2Fjson.h%2Fissues%2F97)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=sheredom%2Fjson.h)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sheredom](/sheredom)
/
**[json.h](/sheredom/json.h)**
Public

* [Notifications](/login?return_to=%2Fsheredom%2Fjson.h) You must be signed in to change notification settings
* [Fork
  83](/login?return_to=%2Fsheredom%2Fjson.h)
* [Star
   729](/login?return_to=%2Fsheredom%2Fjson.h)

* [Code](/sheredom/json.h)
* [Issues
  4](/sheredom/json.h/issues)
* [Pull requests
  1](/sheredom/json.h/pulls)
* [Actions](/sheredom/json.h/actions)
* [Security](/sheredom/json.h/security)
* [Insights](/sheredom/json.h/pulse)

Additional navigation options

* [Code](/sheredom/json.h)
* [Issues](/sheredom/json.h/issues)
* [Pull requests](/sheredom/json.h/pulls)
* [Actions](/sheredom/json.h/actions)
* [Security](/sheredom/json.h/security)
* [Insights](/sheredom/json.h/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsheredom%2Fjson.h%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsheredom%2Fjson.h%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Another Heap OOB in json\_parse\_object() #97

Closed

[hyrathon](/hyrathon) opened this issue
Nov 14, 2022
· 0 comments
 · Fixed by [#98](https://github.com/sheredom/json.h/pull/98)

Closed

# [Another Heap OOB in json\_parse\_object()](#top) #97

[hyrathon](/hyrathon) opened this issue
Nov 14, 2022
· 0 comments
 · Fixed by [#98](https://github.com/sheredom/json.h/pull/98)

## Comments

[![@hyrathon](https://avatars.githubusercontent.com/u/1890309?s=80&u=e4ae1e4b22eb1cf7662faef1ef6fd2fab0e8c715&v=4)](/hyrathon)

Copy link

### **[hyrathon](/hyrathon)** commented [Nov 14, 2022](#issue-1447531997)

| Another Heap OOB in json\_parse\_object() In `json_parse_object()`, there is a heap out-of-bound write. The bug can be triggered with an invocation of `json_parse_ex()` with specific flags combination. The root cause of this vulnerability is that the parameter `object` transferred to `json_parse_obect()` is not properly sanitized, and it is pointed to out-of-bound position assigned by upper layer function.  Here is the output of Google ASAN when the vulnerability is triggerred:  ``` The flags is 0x5fd6d7d6d6247bdf ================================================================= ==5354==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61a000000550 at pc 0x557f8e3323e7 bp 0x7ffd29216ab0 sp 0x7ffd29216aa8 WRITE of size 8 at 0x61a000000550 thread T0     #0 0x557f8e3323e6 in json_parse_object /home/hyrathon/Desktop/jsonh/./json.h:1670:21     #1 0x557f8e334ad9 in json_parse_value /home/hyrathon/Desktop/jsonh/./json.h:1955:7     #2 0x557f8e3338f0 in json_parse_object /home/hyrathon/Desktop/jsonh/./json.h:1719:5     #3 0x557f8e334ad9 in json_parse_value /home/hyrathon/Desktop/jsonh/./json.h:1955:7     #4 0x557f8e3338f0 in json_parse_object /home/hyrathon/Desktop/jsonh/./json.h:1719:5     #5 0x557f8e334ad9 in json_parse_value /home/hyrathon/Desktop/jsonh/./json.h:1955:7     #6 0x557f8e338d4b in json_parse_array /home/hyrathon/Desktop/jsonh/./json.h:1809:5     #7 0x557f8e334ed5 in json_parse_value /home/hyrathon/Desktop/jsonh/./json.h:1962:7     #8 0x557f8e3338f0 in json_parse_object /home/hyrathon/Desktop/jsonh/./json.h:1719:5     #9 0x557f8e3341c8 in json_parse_value /home/hyrathon/Desktop/jsonh/./json.h:1940:5     #10 0x557f8e33cc85 in json_parse_ex /home/hyrathon/Desktop/jsonh/./json.h:2129:3     #11 0x557f8e353192 in main /home/hyrathon/Desktop/jsonh/fuzz.c:29:5     #12 0x7fae53ff9d8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16     #13 0x7fae53ff9e3f in __libc_start_main csu/../csu/libc-start.c:392:3     #14 0x557f8e261314 in _start (/home/hyrathon/Desktop/jsonh/san+0x33314) (BuildId: a0e983e1c9c38a8763824dc5481f79d22fe8c82a)  0x61a000000550 is located 0 bytes to the right of 1232-byte region [0x61a000000080,0x61a000000550) allocated by thread T0 here:     #0 0x557f8e2e415e in __interceptor_malloc (/home/hyrathon/Desktop/jsonh/san+0xb615e) (BuildId: a0e983e1c9c38a8763824dc5481f79d22fe8c82a)     #1 0x557f8e33bf15 in json_parse_ex /home/hyrathon/Desktop/jsonh/./json.h:2088:18     #2 0x557f8e353192 in main /home/hyrathon/Desktop/jsonh/fuzz.c:29:5     #3 0x7fae53ff9d8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16  SUMMARY: AddressSanitizer: heap-buffer-overflow /home/hyrathon/Desktop/jsonh/./json.h:1670:21 in json_parse_object Shadow bytes around the buggy address:   0x0c347fff8050: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c347fff8060: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c347fff8070: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c347fff8080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c347fff8090: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c347fff80a0: 00 00 00 00 00 00 00 00 00 00[fa]fa fa fa fa fa   0x0c347fff80b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c347fff80c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c347fff80d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c347fff80e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c347fff80f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==5354==ABORTING  ```  The input to trigger this bug is attached. The first 8 bytes are the flags for `json_parse_ex()` and the rest is the content(src). Please use address sanitizer to reproduce the bug, as non-crash overflow is hard to detect or locate without shadow memory.  Version: latest commit ([bdcf2e1](https://github.com/sheredom/json.h/commit/bdcf2e1912aa4c0127f755f5f6271c539d6cbf9f)) [crash-input.zip](https://github.com/sheredom/json.h/files/10000514/crash-input.zip) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[sheredom](/sheredom)
added a commit
that referenced
this issue
[Nov 14, 2022](#ref-commit-b6a03f5)
[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)

`[Fix a buffer overrun with NaN processing.](/sheredom/json.h/commit/b6a03f5eed0c186d20753fff48127a7cc12000ae "Fix a buffer overrun with NaN processing.

The issue was caused by \"NaNE1\" - EG. I was accidentally accepting the 'E' as being valid after a NaN was processed, which it wasn't.

Fixes #92.
Fixes #93.
Fixes #94.
Fixes #95.
Fixes #96.
Fixes #97.")`
…

`[b6a03f5](/sheredom/json.h/commit/b6a03f5eed0c186d20753fff48127a7cc12000ae)`

```
The issue was caused by "NaNE1" - EG. I was accidentally accepting the 'E' as being valid after a NaN was processed, which it wasn't.

Fixes [#92](https://github.com/sheredom/json.h/issues/92).
Fixes [#93](https://github.com/sheredom/json.h/issues/93).
Fixes [#94](https://github.com/sheredom/json.h/issues/94).
Fixes [#95](https://github.com/sheredom/json.h/issues/95).
Fixes [#96](https://github.com/sheredom/json.h/issues/96).
Fixes [#97](https://github.com/sheredom/json.h/issues/97).
```

[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)
[sheredom](/sheredom)
mentioned this issue
[Nov 14, 2022](#ref-pullrequest-1448257174)

[Fix a buffer overrun with NaN processing.
#98](/sheredom/json.h/pull/98)
 Merged

[sheredom](/sheredom)
added a commit
that referenced
this issue
[Nov 14, 2022](#ref-commit-0825301)
[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)

`[Fix a buffer overrun with NaN processing.](/sheredom/json.h/commit/0825301a07cbf51653882bf2b153cc81fdadf415 "Fix a buffer overrun with NaN processing.

The issue was caused by \"NaNE1\" - EG. I was accidentally accepting the 'E' as being valid after a NaN was processed, which it wasn't.

Fixes #92.
Fixes #93.
Fixes #94.
Fixes #95.
Fixes #96.
Fixes #97.")`
…

`[0825301](/sheredom/json.h/commit/0825301a07cbf51653882bf2b153cc81fdadf415)`

```
The issue was caused by "NaNE1" - EG. I was accidentally accepting the 'E' as being valid after a NaN was processed, which it wasn't.

Fixes [#92](https://github.com/sheredom/json.h/issues/92).
Fixes [#93](https://github.com/sheredom/json.h/issues/93).
Fixes [#94](https://github.com/sheredom/json.h/issues/94).
Fixes [#95](https://github.com/sheredom/json.h/issues/95).
Fixes [#96](https://github.com/sheredom/json.h/issues/96).
Fixes [#97](https://github.com/sheredom/json.h/issues/97).
```

[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)
[sheredom](/sheredom)
closed this as [completed](/sheredom/json.h/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[692679a](/sheredom/json.h/commit/692679a34c1957db47ebd6852a76c8cfca4a56e4)`
[Nov 14, 2022](#event-7806129945)

[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)
[sheredom](/sheredom)
closed this as [completed](/sheredom/json.h/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#98](/sheredom/json.h/pull/98)
[Nov 14, 2022](#event-7806129958)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsheredom%2Fjson.h%2Fissues%2F97)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Fix a buffer overrun with NaN processing.](/sheredom/json.h/pull/98)
 [sheredom/json.h](/sheredom/json.h)

1 participant

[![@hyrathon](https://avatars.githubusercontent.com/u/1890309?s=52&v=4)](/hyrathon)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_40b62b57_20250114_193211.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsheredom%2Fjson.h%2Fissues%2F93)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsheredom%2Fjson.h%2Fissues%2F93)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=sheredom%2Fjson.h)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sheredom](/sheredom)
/
**[json.h](/sheredom/json.h)**
Public

* [Notifications](/login?return_to=%2Fsheredom%2Fjson.h) You must be signed in to change notification settings
* [Fork
  83](/login?return_to=%2Fsheredom%2Fjson.h)
* [Star
   729](/login?return_to=%2Fsheredom%2Fjson.h)

* [Code](/sheredom/json.h)
* [Issues
  4](/sheredom/json.h/issues)
* [Pull requests
  1](/sheredom/json.h/pulls)
* [Actions](/sheredom/json.h/actions)
* [Security](/sheredom/json.h/security)
* [Insights](/sheredom/json.h/pulse)

Additional navigation options

* [Code](/sheredom/json.h)
* [Issues](/sheredom/json.h/issues)
* [Pull requests](/sheredom/json.h/pulls)
* [Actions](/sheredom/json.h/actions)
* [Security](/sheredom/json.h/security)
* [Insights](/sheredom/json.h/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsheredom%2Fjson.h%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsheredom%2Fjson.h%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Heap Overflow in json\_parse\_object() #93

Closed

[hyrathon](/hyrathon) opened this issue
Nov 14, 2022
· 0 comments
 · Fixed by [#98](https://github.com/sheredom/json.h/pull/98)

Closed

# [Heap Overflow in json\_parse\_object()](#top) #93

[hyrathon](/hyrathon) opened this issue
Nov 14, 2022
· 0 comments
 · Fixed by [#98](https://github.com/sheredom/json.h/pull/98)

## Comments

[![@hyrathon](https://avatars.githubusercontent.com/u/1890309?s=80&u=e4ae1e4b22eb1cf7662faef1ef6fd2fab0e8c715&v=4)](/hyrathon)

Copy link

### **[hyrathon](/hyrathon)** commented [Nov 14, 2022](#issue-1447529698)

| Heap Overflow in json\_parse\_object() In `json_parse_object()`, there is a heap out-of-bound write. The bug can be triggered with an invocation of `json_parse_ex()` with specific flags combination. The root cause of this vulnerability is that the parser use value directly taken from `state->dom` as `value_ex`, while doesn't validate the bound of `state->dom`  ```     if (json_parse_flags_allow_location_information & flags_bitset) {       struct json_value_ex_s *value_ex = (struct json_value_ex_s *)state->dom;       state->dom += sizeof(struct json_value_ex_s);        value_ex->offset = state->offset;       value_ex->line_no = state->line_no;       value_ex->row_no = state->offset - state->line_offset; ```  Similar situation can also be found at:  ```     if (json_parse_flags_allow_location_information & flags_bitset) {       struct json_string_ex_s *string_ex =           (struct json_string_ex_s *)state->dom;       state->dom += sizeof(struct json_string_ex_s);        string_ex->offset = state->offset;       string_ex->line_no = state->line_no;       string_ex->row_no = state->offset - state->line_offset; ```  Here is the output of Google ASAN when the vulnerability is triggerred:  ``` The flags is 0x5fd628d6d6247bff ================================================================= ==4959==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6130000001b8 at pc 0x55f27037a5df bp 0x7fff30738e90 sp 0x7fff30738e88 WRITE of size 8 at 0x6130000001b8 thread T0     #0 0x55f27037a5de in json_parse_object /home/hyrathon/Desktop/jsonh/./json.h:1709:24     #1 0x55f27037b1c8 in json_parse_value /home/hyrathon/Desktop/jsonh/./json.h:1940:5     #2 0x55f270383c85 in json_parse_ex /home/hyrathon/Desktop/jsonh/./json.h:2129:3     #3 0x55f27039a192 in main /home/hyrathon/Desktop/jsonh/fuzz.c:29:5     #4 0x7f555df76d8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16     #5 0x7f555df76e3f in __libc_start_main csu/../csu/libc-start.c:392:3     #6 0x55f2702a8314 in _start (/home/hyrathon/Desktop/jsonh/san+0x33314) (BuildId: a0e983e1c9c38a8763824dc5481f79d22fe8c82a)  0x6130000001b9 is located 0 bytes to the right of 377-byte region [0x613000000040,0x6130000001b9) allocated by thread T0 here:     #0 0x55f27032b15e in __interceptor_malloc (/home/hyrathon/Desktop/jsonh/san+0xb615e) (BuildId: a0e983e1c9c38a8763824dc5481f79d22fe8c82a)     #1 0x55f270382f15 in json_parse_ex /home/hyrathon/Desktop/jsonh/./json.h:2088:18     #2 0x55f27039a192 in main /home/hyrathon/Desktop/jsonh/fuzz.c:29:5     #3 0x7f555df76d8f in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16  SUMMARY: AddressSanitizer: heap-buffer-overflow /home/hyrathon/Desktop/jsonh/./json.h:1709:24 in json_parse_object Shadow bytes around the buggy address:   0x0c267fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c267fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c267fff8000: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00   0x0c267fff8010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c267fff8020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c267fff8030: 00 00 00 00 00 00 00[01]fa fa fa fa fa fa fa fa   0x0c267fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c267fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c267fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c267fff8070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c267fff8080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==4959==ABORTING  ```  The input to trigger this bug is attached. The first 8 bytes are the flags for `json_parse_ex()` and the rest is the content(src). Please use address sanitizer to reproduce the bug, as non-crash overflow is hard to detect or locate without shadow memory.  I also attach the input that can cause the other overflow I mentioned.  [crash1.zip](https://github.com/sheredom/json.h/files/10000497/crash1.zip) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[sheredom](/sheredom)
added a commit
that referenced
this issue
[Nov 14, 2022](#ref-commit-b6a03f5)
[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)

`[Fix a buffer overrun with NaN processing.](/sheredom/json.h/commit/b6a03f5eed0c186d20753fff48127a7cc12000ae "Fix a buffer overrun with NaN processing.

The issue was caused by \"NaNE1\" - EG. I was accidentally accepting the 'E' as being valid after a NaN was processed, which it wasn't.

Fixes #92.
Fixes #93.
Fixes #94.
Fixes #95.
Fixes #96.
Fixes #97.")`
…

`[b6a03f5](/sheredom/json.h/commit/b6a03f5eed0c186d20753fff48127a7cc12000ae)`

```
The issue was caused by "NaNE1" - EG. I was accidentally accepting the 'E' as being valid after a NaN was processed, which it wasn't.

Fixes [#92](https://github.com/sheredom/json.h/issues/92).
Fixes [#93](https://github.com/sheredom/json.h/issues/93).
Fixes [#94](https://github.com/sheredom/json.h/issues/94).
Fixes [#95](https://github.com/sheredom/json.h/issues/95).
Fixes [#96](https://github.com/sheredom/json.h/issues/96).
Fixes [#97](https://github.com/sheredom/json.h/issues/97).
```

[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)
[sheredom](/sheredom)
mentioned this issue
[Nov 14, 2022](#ref-pullrequest-1448257174)

[Fix a buffer overrun with NaN processing.
#98](/sheredom/json.h/pull/98)
 Merged

[sheredom](/sheredom)
added a commit
that referenced
this issue
[Nov 14, 2022](#ref-commit-0825301)
[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)

`[Fix a buffer overrun with NaN processing.](/sheredom/json.h/commit/0825301a07cbf51653882bf2b153cc81fdadf415 "Fix a buffer overrun with NaN processing.

The issue was caused by \"NaNE1\" - EG. I was accidentally accepting the 'E' as being valid after a NaN was processed, which it wasn't.

Fixes #92.
Fixes #93.
Fixes #94.
Fixes #95.
Fixes #96.
Fixes #97.")`
…

`[0825301](/sheredom/json.h/commit/0825301a07cbf51653882bf2b153cc81fdadf415)`

```
The issue was caused by "NaNE1" - EG. I was accidentally accepting the 'E' as being valid after a NaN was processed, which it wasn't.

Fixes [#92](https://github.com/sheredom/json.h/issues/92).
Fixes [#93](https://github.com/sheredom/json.h/issues/93).
Fixes [#94](https://github.com/sheredom/json.h/issues/94).
Fixes [#95](https://github.com/sheredom/json.h/issues/95).
Fixes [#96](https://github.com/sheredom/json.h/issues/96).
Fixes [#97](https://github.com/sheredom/json.h/issues/97).
```

[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)
[sheredom](/sheredom)
closed this as [completed](/sheredom/json.h/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#98](/sheredom/json.h/pull/98)
[Nov 14, 2022](#event-7806129727)

[![@sheredom](https://avatars.githubusercontent.com/u/611171?s=40&u=84c8e1ed512cf9fb7d7c554ba2430f94c5e8883a&v=4)](/sheredom)
[sheredom](/sheredom)
closed this as [completed](/sheredom/json.h/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[692679a](/sheredom/json.h/commit/692679a34c1957db47ebd6852a76c8cfca4a56e4)`
[Nov 14, 2022](#event-7806129772)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsheredom%2Fjson.h%2Fissues%2F93)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Fix a buffer overrun with NaN processing.](/sheredom/json.h/pull/98)
 [sheredom/json.h](/sheredom/json.h)

1 participant

[![@hyrathon](https://avatars.githubusercontent.com/u/1890309?s=52&v=4)](/hyrathon)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d043a077_20250114_193208.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsheredom%2Fjson.h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsheredom%2Fjson.h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=sheredom%2Fjson.h)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sheredom](/sheredom)
/
**[json.h](/sheredom/json.h)**
Public

* [Notifications](/login?return_to=%2Fsheredom%2Fjson.h) You must be signed in to change notification settings
* [Fork
  83](/login?return_to=%2Fsheredom%2Fjson.h)
* [Star
   729](/login?return_to=%2Fsheredom%2Fjson.h)

🗄️ single header json parser for C and C++

### License

[Unlicense license](/sheredom/json.h/blob/master/LICENSE)

[729
stars](/sheredom/json.h/stargazers) [83
forks](/sheredom/json.h/forks) [Branches](/sheredom/json.h/branches) [Tags](/sheredom/json.h/tags) [Activity](/sheredom/json.h/activity)
 [Star](/login?return_to=%2Fsheredom%2Fjson.h)

 [Notifications](/login?return_to=%2Fsheredom%2Fjson.h) You must be signed in to change notification settings

* [Code](/sheredom/json.h)
* [Issues
  4](/sheredom/json.h/issues)
* [Pull requests
  1](/sheredom/json.h/pulls)
* [Actions](/sheredom/json.h/actions)
* [Security](/sheredom/json.h/security)
* [Insights](/sheredom/json.h/pulse)

Additional navigation options

* [Code](/sheredom/json.h)
* [Issues](/sheredom/json.h/issues)
* [Pull requests](/sheredom/json.h/pulls)
* [Actions](/sheredom/json.h/actions)
* [Security](/sheredom/json.h/security)
* [Insights](/sheredom/json.h/pulse)

# sheredom/json.h

    master[Branches](/sheredom/json.h/branches)[Tags](/sheredom/json.h/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[162 Commits](/sheredom/json.h/commits/master/) | | |
| [.github](/sheredom/json.h/tree/master/.github ".github") | | [.github](/sheredom/json.h/tree/master/.github ".github") |  |  |
| [test](/sheredom/json.h/tree/master/test "test") | | [test](/sheredom/json.h/tree/master/test "test") |  |  |
| [.gitignore](/sheredom/json.h/blob/master/.gitignore ".gitignore") | | [.gitignore](/sheredom/json.h/blob/master/.gitignore ".gitignore") |  |  |
| [LICENSE](/sheredom/json.h/blob/master/LICENSE "LICENSE") | | [LICENSE](/sheredom/json.h/blob/master/LICENSE "LICENSE") |  |  |
| [README.md](/sheredom/json.h/blob/master/README.md "README.md") | | [README.md](/sheredom/json.h/blob/master/README.md "README.md") |  |  |
| [appveyor.yml](/sheredom/json.h/blob/master/appveyor.yml "appveyor.yml") | | [appveyor.yml](/sheredom/json.h/blob/master/appveyor.yml "appveyor.yml") |  |  |
| [json.h](/sheredom/json.h/blob/master/json.h "json.h") | | [json.h](/sheredom/json.h/blob/master/json.h "json.h") |  |  |
| View all files | | |

## Repository files navigation

* README
* Unlicense license
# 🗄️ json.h

[![Actions Status](https://github.com/sheredom/json.h/workflows/CMake/badge.svg)](https://github.com/sheredom/json.h/actions)
[![Build status](https://camo.githubusercontent.com/d3fd78dc9c5f7ad0e79fe55d9815c944c78f2f64154f744c49b2d45e0699066e/68747470733a2f2f63692e6170707665796f722e636f6d2f6170692f70726f6a656374732f7374617475732f7069656c6c366863726c7772637870393f7376673d74727565)](https://ci.appveyor.com/project/sheredom/json-h)
[![Sponsor](https://camo.githubusercontent.com/56888a007662592d351c40399d881634ce84b4f0eae5d09dc943cb2dc8e57b24/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2546302539462539322539432d73706f6e736f722d626c756576696f6c6574)](https://github.com/sponsors/sheredom)

A simple single header solution to parsing JSON in C and C++.

JSON is parsed into a read-only, single allocation buffer.

The current supported compilers are gcc, clang and msvc.

The current supported platforms are Windows, mac OS and Linux.

## Usage

Just `#include "json.h"` in your code!

### json\_parse

Parse a json string into a DOM.

```
struct json_value_s *json_parse(
    const void *src,
    size_t src_size);
```

* `src` - a utf-8 json string to parse.
* `src_size` - the size of `src` in bytes.

Returns a `struct json_value_s*` pointing the root of the json DOM.

### struct json\_value\_s

The main struct for interacting with a parsed JSON Document Object Model (DOM)
is the `struct json_value_s`.

```
struct json_value_s {
  void *payload;
  size_t type;
};
```

* `payload` - a pointer to the contents of the value.
* `type` - the type of struct `payload` points to, one of `json_type_e`. Note:
  if type is `json_type_true`, `json_type_false`, or `json_type_null`, payload
  will be NULL.

### json\_parse\_ex

Extended parse a json string into a DOM.

```
struct json_value_s *json_parse_ex(
    const void *src,
    size_t src_size,
    size_t flags_bitset,
    void*(*alloc_func_ptr)(void *, size_t),
    void *user_data,
    struct json_parse_result_s *result);
```

* `src` - a utf-8 json string to parse.
* `src_size` - the size of `src` in bytes.
* `flags_bitset` - extra parsing flags, a bitset of flags specified in
  `enum json_parse_flags_e`.
* `alloc_func_ptr` - a callback function to use for doing the single allocation.
  If NULL, `malloc()` is used.
* `user_data` - user data to be passed as the first argument to
  `alloc_func_ptr`.
* `result` - the result of the parsing. If a parsing error occurred this will
  contain what type of error, and where in the source it occurred. Can be NULL.

Returns a `struct json_value_s*` pointing the root of the json DOM.

### enum json\_parse\_flags\_e

The extra parsing flags that can be specified to `json_parse_ex()` are as
follows:

```
enum json_parse_flags_e {
  json_parse_flags_default = 0,
  json_parse_flags_allow_trailing_comma = 0x1,
  json_parse_flags_allow_unquoted_keys = 0x2,
  json_parse_flags_allow_global_object = 0x4,
  json_parse_flags_allow_equals_in_object = 0x8,
  json_parse_flags_allow_no_commas = 0x10,
  json_parse_flags_allow_c_style_comments = 0x20,
  json_parse_flags_deprecated = 0x40,
  json_parse_flags_allow_location_information = 0x80,
  json_parse_flags_allow_single_quoted_strings = 0x100,
  json_parse_flags_allow_hexadecimal_numbers = 0x200,
  json_parse_flags_allow_leading_plus_sign = 0x400,
  json_parse_flags_allow_leading_or_trailing_decimal_point = 0x800,
  json_parse_flags_allow_inf_and_nan = 0x1000,
  json_parse_flags_allow_multi_line_strings = 0x2000,
  json_parse_flags_allow_simplified_json =
      (json_parse_flags_allow_trailing_comma |
       json_parse_flags_allow_unquoted_keys |
       json_parse_flags_allow_global_object |
       json_parse_flags_allow_equals_in_object |
       json_parse_flags_allow_no_commas),
  json_parse_flags_allow_json5 =
      (json_parse_flags_allow_trailing_comma |
       json_parse_flags_allow_unquoted_keys |
       json_parse_flags_allow_c_style_comments |
       json_parse_flags_allow_single_quoted_strings |
       json_parse_flags_allow_hexadecimal_numbers |
       json_parse_flags_allow_leading_plus_sign |
       json_parse_flags_allow_leading_or_trailing_decimal_point |
       json_parse_flags_allow_inf_and_nan |
       json_parse_flags_allow_multi_line_strings)
};
```

* `json_parse_flags_default` - the default, no special behaviour is enabled.
* `json_parse_flags_allow_trailing_comma` - allow trailing commas in objects and
  arrays. For example, both `[true,]` and `{"a" : null,}` would be allowed with
  this option on.
* `json_parse_flags_allow_unquoted_keys` - allow unquoted keys for objects. For
  example, `{a : null}` would be allowed with this option on.
* `json_parse_flags_allow_global_object` - allow a global unbracketed object. For
  example, `a : null, b : true, c : {}` would be allowed with this option on.
* `json_parse_flags_allow_equals_in_object` - allow objects to use '=' as well as
  ':' between key/value pairs. For example, `{"a" = null, "b" : true}` would be
  allowed with this option on.
* `json_parse_flags_allow_no_commas` - allow that objects don't have to have
  comma separators between key/value pairs. For example,
  `{"a" : null "b" : true}` would be allowed with this option on.
* `json_parse_flags_allow_c_style_comments` - allow c-style comments (`//` or
  `/* */`) to be ignored in the input JSON file.
* `json_parse_flags_deprecated` - a deprecated option.
* `json_parse_flags_allow_location_information` - allow location information to
  be tracked for where values are in the input JSON. Useful for alerting users to
  errors with precise location information pertaining to the original source.
  When this option is enabled, all `json_value_s*`'s can be casted to
  `json_value_ex_s*`, and the `json_string_s*` of `json_object_element_s*`'s
  name member can be casted to `json_string_ex_s*` to retrieve specific
  locations on all the values and keys. Note this option will increase the
  memory budget required for the DOM used to record the JSON.
* `json_parse_flags_allow_single_quoted_strings` - allows strings to be in
  `'single quotes'`.
* `json_parse_flags_allow_hexadecimal_numbers` - allows hexadecimal numbers to
  be used `0x42`.
* `json_parse_flags_allow_leading_plus_sign` - allows a leading '+' sign on
  numbers `+42`.
* `json_parse_flags_allow_leading_or_trailing_decimal_point` - allows decimal
  points to be lead or trailed by 0 digits `.42` or `42.`.
* `json_parse_flags_allow_inf_and_nan` - allows using infinity and NaN
  identifiers `Infinity` or `NaN`.
* `json_parse_flags_allow_multi_line_strings` - allows strings to span multiple
  lines.
* `json_parse_flags_allow_simplified_json` - allow simplified JSON to be parsed.
  Simplified JSON is an enabling of a set of other parsing options.
  [See the Bitsquid blog introducing this here.](http://bitsquid.blogspot.com/2009/10/simplified-json-notation.html)
* `json_parse_flags_allow_json5` - allow JSON5 to be parsed. JSON5 is an
  enabling of a set of other parsing options.
  [See the website defining this extension here.](https://json5.org)

## Examples

### Parsing with `json_parse`

Lets say we had the JSON string *'{"a" : true, "b" : [false, null, "foo"]}'*.
To get to each part of the parsed JSON we'd do:

```
const char json[] = "{\"a\" : true, \"b\" : [false, null, \"foo\"]}";
struct json_value_s* root = json_parse(json, strlen(json));
assert(root->type == json_type_object);

struct json_object_s* object = (struct json_object_s*)root->payload;
assert(object->length == 2);

struct json_object_element_s* a = object->start;

struct json_string_s* a_name = a->name;
assert(0 == strcmp(a_name->string, "a"));
assert(a_name->string_size == strlen("a"));

struct json_value_s* a_value = a->value;
assert(a_value->type == json_type_true);
assert(a_value->payload == NULL);

struct json_object_element_s* b = a->next;
assert(b->next == NULL);

struct json_string_s* b_name = b->name;
assert(0 == strcmp(b_name->string, "b"));
assert(b_name->string_size == strlen("b"));

struct json_value_s* b_value = b->value;
assert(b_value->type == json_type_array);

struct json_array_s* array = (struct json_array_s*)b_value->payload;
assert(array->length == 3);

struct json_array_element_s* b_1st = array->start;

struct json_value_s* b_1st_value = b_1st->value;
assert(b_1st_value->type == json_type_false);
assert(b_1st_value->payload == NULL);

struct json_array_element_s* b_2nd = b_1st->next;

struct json_value_s* b_2nd_value = b_2nd->value;
assert(b_2nd_value->type == json_type_null);
assert(b_2nd_value->payload == NULL);

struct json_array_element_s* b_3rd = b_2nd->next;
assert(b_3rd->next == NULL);

struct json_value_s* b_3rd_value = b_3rd->value;
assert(b_3rd_value->type == json_type_string);

struct json_string_s* string = (struct json_string_s*)b_3rd_value->payload;
assert(0 == strcmp(string->string, "foo"));
assert(string->string_size == strlen("foo"));

/* Don't forget to free the one allocation! */
free(root);
```

### Iterator Helpers

There are some functions that serve no purpose other than to make it nicer to
iterate through the produced JSON DOM:

* `json_value_as_string` - returns a value as a string, or null if it wasn't a
  string.
* `json_value_as_number` - returns a value as a number, or null if it wasn't a
  number.
* `json_value_as_object` - returns a value as an object, or null if it wasn't an
  object.
* `json_value_as_array` - returns a value as an array, or null if it wasn't an
  array.
* `json_value_is_true` - returns non-zero is a value was true, zero otherwise.
* `json_value_is_false` - returns non-zero is a value was false, zero otherwise.
* `json_value_is_null` - returns non-zero is a value was null, zero otherwise.

Lets look at the same example from above but using these helper iterators
instead:

```
const char json[] = "{\"a\" : true, \"b\" : [false, null, \"foo\"]}";
struct json_value_s* root = json_parse(json, strlen(json));

struct json_object_s* object = json_value_as_object(root);
assert(object != NULL);
assert(object->length == 2);

struct json_object_element_s* a = object->start;

struct json_string_s* a_name = a->name;
assert(0 == strcmp(a_name->string, "a"));
assert(a_name->string_size == strlen("a"));

struct json_value_s* a_value = a->value;
assert(json_value_is_true(a_value));

struct json_object_element_s* b = a->next;
assert(b->next == NULL);

struct json_string_s* b_name = b->name;
assert(0 == strcmp(b_name->string, "b"));
assert(b_name->string_size == strlen("b"));

struct json_array_s* array = json_value_as_array(b->value);
assert(array->length == 3);

struct json_array_element_s* b_1st = array->start;

struct json_value_s* b_1st_value = b_1st->value;
assert(json_value_is_false(b_1st_value));

struct json_array_element_s* b_2nd = b_1st->next;

struct json_value_s* b_2nd_value = b_2nd->value;
assert(json_value_is_null(b_2nd_value));

struct json_array_element_s* b_3rd = b_2nd->next;
assert(b_3rd->next == NULL);

struct json_string_s* string = json_value_as_string(b_3rd->value);
assert(string != NULL);
assert(0 == strcmp(string->string, "foo"));
assert(string->string_size == strlen("foo"));

/* Don't forget to free the one allocation! */
free(root);
```

As you can see it makes iterating through the DOM a little more pleasant.

### Extracting a Value from a DOM

If you want to extract a value from a DOM into a new allocation then
`json_extract_value` and `json_extract_value_ex` are you friends. These
functions let you take any value and its subtree from a DOM and clone it
into a new allocation - either a single `malloc` or a user-provided
allocation region.

```
const char json[] = "{\"foo\" : { \"bar\" : [123, false, null, true], \"haz\" : \"haha\" }}";
struct json_value_s* root = json_parse(json, strlen(json));
assert(root);

struct json_value_s* foo = json_value_as_object(root)->start->value;
assert(foo);

struct json_value_s* extracted = json_extract_value(foo);

/* We can free root now because we've got a new allocation for extracted! */
free(root);

assert(json_value_as_object(extracted));

/* Don't forget to free the one allocation! */
free(extracted);
```

## Design

The json\_parse function calls malloc once, and then slices up this single
allocation to support all the weird and wonderful JSON structures you can
imagine!

The structure of the data is always the JSON structs first (which encode the
structure of the original JSON), followed by the data.

## Todo

* Add debug output to specify why the printer failed (as suggested by
  [@hugin84](https://twitter.com/hugin84) in
  <https://twitter.com/hugin84/status/668506811595677696>).

## License

This is free and unencumbered software released into the public domain.

Anyone is free to copy, modify, publish, use, compile, sell, or
distribute this software, either in source code form or as a compiled
binary, for any purpose, commercial or non-commercial, and by any
means.

In jurisdictions that recognize copyright laws, the author or authors
of this software dedicate any and all copyright interest in the
software to the public domain. We make this dedication for the benefit
of the public at large and to the detriment of our heirs and
successors. We intend this dedication to be an overt act of
relinquishment in perpetuity of all present and future rights to this
software under copyright law.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR
OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.

For more information, please refer to <http://unlicense.org/>

## About

🗄️ single header json parser for C and C++

### Topics

[c](/topics/c "Topic: c")
[json](/topics/json "Topic: json")
[parsing](/topics/parsing "Topic: parsing")
[cpp](/topics/cpp "Topic: cpp")
[json-api](/topics/json-api "Topic: json-api")

### Resources

[Readme](#readme-ov-file)
### License

[Unlicense license](#Unlicense-1-ov-file)

[Activity](/sheredom/json.h/activity)
### Stars

[**729**
stars](/sheredom/json.h/stargazers)
### Watchers

[**25**
watching](/sheredom/json.h/watchers)
### Forks

[**83**
forks](/sheredom/json.h/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fsheredom%2Fjson.h&report=sheredom+%28user%29)

## Sponsor this project

## [Contributors 11](/sheredom/json.h/graphs/contributors)

* [![@sheredom](https://avatars.githubusercontent.com/u/611171?s=64&v=4)](https://github.com/sheredom)
* [![@ocornut](https://avatars.githubusercontent.com/u/8225057?s=64&v=4)](https://github.com/ocornut)
* [![@fireice-uk](https://avatars.githubusercontent.com/u/5392418?s=64&v=4)](https://github.com/fireice-uk)
* [![@syntelos](https://avatars.githubusercontent.com/u/156092?s=64&v=4)](https://github.com/syntelos)
* [![@zodf0055980](https://avatars.githubusercontent.com/u/25863161?s=64&v=4)](https://github.com/zodf0055980)
* [![@kwikwag](https://avatars.githubusercontent.com/u/392199?s=64&v=4)](https://github.com/kwikwag)
* [![@r-lyeh-archived](https://avatars.githubusercontent.com/u/878187?s=64&v=4)](https://github.com/r-lyeh-archived)
* [![@plzombie](https://avatars.githubusercontent.com/u/1690651?s=64&v=4)](https://github.com/plzombie)
* [![@codemonkey-uk](https://avatars.githubusercontent.com/u/5190910?s=64&v=4)](https://github.com/codemonkey-uk)
* [![@xxxbxxx](https://avatars.githubusercontent.com/u/5260269?s=64&v=4)](https://github.com/xxxbxxx)
* [![@timgates42](https://avatars.githubusercontent.com/u/47873678?s=64&v=4)](https://github.com/timgates42)

## Languages

* [C++
  72.9%](/sheredom/json.h/search?l=c%2B%2B)
* [C
  26.0%](/sheredom/json.h/search?l=c)
* [CMake
  1.1%](/sheredom/json.h/search?l=cmake)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1c2152d7_20250114_193205.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhyrathon%2Ftrophies%2Fsecurity%2Fadvisories%2FGHSA-wvpq-p7pp-cj6m)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhyrathon%2Ftrophies%2Fsecurity%2Fadvisories%2FGHSA-wvpq-p7pp-cj6m)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=hyrathon%2Ftrophies)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hyrathon](/hyrathon)
/
**[trophies](/hyrathon/trophies)**
Public

* [Notifications](/login?return_to=%2Fhyrathon%2Ftrophies) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fhyrathon%2Ftrophies)
* [Star
   0](/login?return_to=%2Fhyrathon%2Ftrophies)

* [Code](/hyrathon/trophies)
* [Issues
  0](/hyrathon/trophies/issues)
* [Pull requests
  0](/hyrathon/trophies/pulls)
* [Actions](/hyrathon/trophies/actions)
* [Projects
  0](/hyrathon/trophies/projects)
* [Security](/hyrathon/trophies/security)
* [Insights](/hyrathon/trophies/pulse)

Additional navigation options

* [Code](/hyrathon/trophies)
* [Issues](/hyrathon/trophies/issues)
* [Pull requests](/hyrathon/trophies/pulls)
* [Actions](/hyrathon/trophies/actions)
* [Projects](/hyrathon/trophies/projects)
* [Security](/hyrathon/trophies/security)
* [Insights](/hyrathon/trophies/pulse)

# Heap Overflow in json.h(json\_parse\_object())

Moderate

[hyrathon](/hyrathon)
published
GHSA-wvpq-p7pp-cj6m
Dec 30, 2022

## Package

json.h

## Affected versions

before 692679a34c1957db47ebd6852a76c8cfca4a56e4

## Patched versions

692679a34c1957db47ebd6852a76c8cfca4a56e4

## Description

Heap Overflow in json\_parse\_object()

In json\_parse\_object(), there is a heap out-of-bound write. The bug can be triggered with an invocation of json\_parse\_ex() with specific flags combination. The root cause of this vulnerability is that the parser use value directly taken from state->dom as value\_ex, while doesn't validate the bound of state->dom

```
if (json_parse_flags_allow_location_information & flags_bitset) {
  struct json_value_ex_s *value_ex = (struct json_value_ex_s *)state->dom;
  state->dom += sizeof(struct json_value_ex_s);

  value_ex->offset = state->offset;
  value_ex->line_no = state->line_no;
  value_ex->row_no = state->offset - state->line_offset;

```

Similar situation can also be found at:

```
if (json_parse_flags_allow_location_information & flags_bitset) {
  struct json_string_ex_s *string_ex =
      (struct json_string_ex_s *)state->dom;
  state->dom += sizeof(struct json_string_ex_s);

  string_ex->offset = state->offset;
  string_ex->line_no = state->line_no;
  string_ex->row_no = state->offset - state->line_offset;

```

Here is the output of Google ASAN when the vulnerability is triggerred:

# The flags is 0x5fd628d6d6247bff

==4959==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6130000001b8 at pc 0x55f27037a5df bp 0x7fff30738e90 sp 0x7fff30738e88

WRITE of size 8 at 0x6130000001b8 thread T0

#0 0x55f27037a5de in json\_parse\_object /home/hyrathon/Desktop/jsonh/./json.h:1709:24

#1 0x55f27037b1c8 in json\_parse\_value /home/hyrathon/Desktop/jsonh/./json.h:1940:5

#2 0x55f270383c85 in json\_parse\_ex /home/hyrathon/Desktop/jsonh/./json.h:2129:3

#3 0x55f27039a192 in main /home/hyrathon/Desktop/jsonh/fuzz.c:29:5

#4 0x7f555df76d8f in \_\_libc\_start\_call\_main csu/../sysdeps/nptl/libc\_start\_call\_main.h:58:16

#5 0x7f555df76e3f in \_\_libc\_start\_main csu/../csu/libc-start.c:392:3

#6 0x55f2702a8314 in \_start (/home/hyrathon/Desktop/jsonh/san+0x33314) (BuildId: a0e983e1c9c38a8763824dc5481f79d22fe8c82a)

0x6130000001b9 is located 0 bytes to the right of 377-byte region [0x613000000040,0x6130000001b9)

allocated by thread T0 here:

#0 0x55f27032b15e in \_\_interceptor\_malloc (/home/hyrathon/Desktop/jsonh/san+0xb615e) (BuildId: a0e983e1c9c38a8763824dc5481f79d22fe8c82a)

#1 0x55f270382f15 in json\_parse\_ex /home/hyrathon/Desktop/jsonh/./json.h:2088:18

#2 0x55f27039a192 in main /home/hyrathon/Desktop/jsonh/fuzz.c:29:5

#3 0x7f555df76d8f in \_\_libc\_start\_call\_main csu/../sysdeps/nptl/libc\_start\_call\_main.h:58:16

SUMMARY: AddressSanitizer: heap-buffer-overflow /home/hyrathon/Desktop/jsonh/./json.h:1709:24 in json\_parse\_object

Shadow bytes around the buggy address:

0x0c267fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

0x0c267fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

0x0c267fff8000: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00

0x0c267fff8010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

0x0c267fff8020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

=>0x0c267fff8030: 00 00 00 00 00 00 00[01]fa fa fa fa fa fa fa fa

0x0c267fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa

0x0c267fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa

0x0c267fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa

0x0c267fff8070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa

0x0c267fff8080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa

Shadow byte legend (one shadow byte represents 8 application bytes):

Addressable: 00

Partially addressable: 01 02 03 04 05 06 07

Heap left redzone: fa

Freed heap region: fd

Stack left redzone: f1

Stack mid redzone: f2

Stack right redzone: f3

Stack after return: f5

Stack use after scope: f8

Global redzone: f9

Global init order: f6

Poisoned by user: f7

Container overflow: fc

Array cookie: ac

Intra object redzone: bb

ASan internal: fe

Left alloca redzone: ca

Right alloca redzone: cb

==4959==ABORTING

The input to trigger this bug is attached. The first 8 bytes are the flags for json\_parse\_ex() and the rest is the content(src). Please use address sanitizer to reproduce the bug, as non-crash overflow is hard to detect or locate without shadow memory.

I also attach the input that can cause the other overflow I mentioned.

[crash1.zip](https://github.com/sheredom/json.h/files/10000497/crash1.zip)

### Severity

Moderate

### CVE ID

CVE-2022-45494

### Weaknesses

[CWE-122](/advisories?query=cwe%3A122)

### Credits

* [![@hyrathon](https://avatars.githubusercontent.com/u/1890309?s=40&v=4)](/hyrathon)
  [hyrathon](/hyrathon)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


