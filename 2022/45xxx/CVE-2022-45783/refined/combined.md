=== Content from github.com_232355b8_20250115_114541.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FdotCMS%2Fcore%2Fblob%2Frelease-21.04%2FdotCMS%2Fsrc%2Fmain%2Fjava%2Fcom%2Fdotcms%2Fintegritycheckers%2FIntegrityUtil.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FdotCMS%2Fcore%2Fblob%2Frelease-21.04%2FdotCMS%2Fsrc%2Fmain%2Fjava%2Fcom%2Fdotcms%2Fintegritycheckers%2FIntegrityUtil.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=dotCMS%2Fcore)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dotCMS](/dotCMS)
/
**[core](/dotCMS/core)**
Public

* [Notifications](/login?return_to=%2FdotCMS%2Fcore) You must be signed in to change notification settings
* [Fork
  467](/login?return_to=%2FdotCMS%2Fcore)
* [Star
   867](/login?return_to=%2FdotCMS%2Fcore)

* [Code](/dotCMS/core/tree/release-21.04)
* [Issues
  951](/dotCMS/core/issues)
* [Pull requests
  33](/dotCMS/core/pulls)
* [Discussions](/dotCMS/core/discussions)
* [Actions](/dotCMS/core/actions)
* [Projects
  1](/dotCMS/core/projects)
* [Security](/dotCMS/core/security)
* [Insights](/dotCMS/core/pulse)

Additional navigation options

* [Code](/dotCMS/core/tree/release-21.04)
* [Issues](/dotCMS/core/issues)
* [Pull requests](/dotCMS/core/pulls)
* [Discussions](/dotCMS/core/discussions)
* [Actions](/dotCMS/core/actions)
* [Projects](/dotCMS/core/projects)
* [Security](/dotCMS/core/security)
* [Insights](/dotCMS/core/pulse)

## Files

 release-21.04
## Breadcrumbs

1. [core](/dotCMS/core/tree/release-21.04)
2. /[dotCMS](/dotCMS/core/tree/release-21.04/dotCMS)
3. /[src](/dotCMS/core/tree/release-21.04/dotCMS/src)
4. /[main](/dotCMS/core/tree/release-21.04/dotCMS/src/main)
5. /[java](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java)
6. /[com](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com)
7. /[dotcms](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com/dotcms)
8. /[integritycheckers](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers)
/
# IntegrityUtil.java

Copy path Blame  Blame
## Latest commit

## History

[History](/dotCMS/core/commits/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers/IntegrityUtil.java)847 lines (744 loc) · 34.6 KB release-21.04
## Breadcrumbs

1. [core](/dotCMS/core/tree/release-21.04)
2. /[dotCMS](/dotCMS/core/tree/release-21.04/dotCMS)
3. /[src](/dotCMS/core/tree/release-21.04/dotCMS/src)
4. /[main](/dotCMS/core/tree/release-21.04/dotCMS/src/main)
5. /[java](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java)
6. /[com](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com)
7. /[dotcms](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com/dotcms)
8. /[integritycheckers](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers)
/
# IntegrityUtil.java

Top
## File metadata and controls

* Code
* Blame

847 lines (744 loc) · 34.6 KB[Raw](https://github.com/dotCMS/core/raw/refs/heads/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers/IntegrityUtil.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847package com.dotcms.integritycheckers;
import com.dotcms.business.WrapInTransaction;import com.dotcms.http.DotExecutionException;import com.dotcms.repackage.com.csvreader.CsvReader;import com.dotcms.repackage.com.csvreader.CsvWriter;import com.dotcms.rest.IntegrityResource;import com.dotmarketing.business.APILocator;import com.dotmarketing.common.db.DotConnect;import com.dotmarketing.db.DbConnectionFactory;import com.dotmarketing.db.FlushCacheRunnable;import com.dotmarketing.db.HibernateUtil;import com.dotmarketing.exception.DotDataException;import com.dotmarketing.exception.DotSecurityException;import com.dotmarketing.util.ConfigUtils;import com.dotmarketing.util.Logger;import com.dotmarketing.util.MaintenanceUtil;import com.dotmarketing.util.UtilMethods;import org.apache.commons.lang3.StringUtils;
import java.io.\*;import java.math.BigDecimal;import java.nio.charset.Charset;import java.nio.file.Files;import java.nio.file.Paths;import java.sql.Connection;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.sql.SQLException;import java.util.ArrayList;import java.util.List;import java.util.Map;import java.util.Optional;import java.util.Properties;import java.util.function.BiConsumer;import java.util.zip.ZipEntry;import java.util.zip.ZipInputStream;import java.util.zip.ZipOutputStream;
/\*\* \* During the push publish process, user structures such as Folders, Content \* Types (f.k.a Structures), Schemes, Legacy Pages, or Content Pages, might \* already exist in a given receiver environment. This will cause the publishing \* process to fail given that the structures seem to be the same, BUT the \* identifier is different compared to each other. \* <p> \* This utility class provides a mechanism to check and resolve situations where \* one or more of those user structures have conflicts. The solution is to \* generate a list of conflicts for the users the check it out, and make a \* decision. If they want to fix the conflicts, the system will make sure the \* user structures have the same Identifier (and sometimes the Inode) in both \* sender and receiver servers. \* </p> \* <p> \* The {@link IntegrityResource} class exposes the main methods of this class as \* REST services. \* </p> \* \* @author Daniel Silva \* @version 1.5 \* @since 06-23-2014 \* \*/public class IntegrityUtil {
 public static final String INTEGRITY\_DATA\_STATUS = "status"; public static final String INTEGRITY\_DATA\_ERROR\_MESSAGE = "error\_message"; public static final String INTEGRITY\_DATA\_TO\_CHECK\_ZIP\_FILENAME = "DataToCheck.zip"; public static final String INTEGRITY\_DATA\_TO\_FIX\_ZIP\_FILENAME = "DataToFix.zip"; public static final String INTEGRITY\_DATA\_STATUS\_FILENAME = "DataStatus.properties"; public static final String REQUESTER\_KEY = "requesterKey"; public static final String INTEGRITY\_DATA\_REQUEST\_ID = "integrityDataRequestId";
 private File generateDataToFixCSV(String outputPath, String endpointId, IntegrityType type) throws DotDataException, IOException { File csvFile; CsvWriter writer = null;
 try { final String outputFile = outputPath + File.separator + type.getDataToFixCSVName(); csvFile = new File(outputFile); writer = new CsvWriter(new FileWriter(csvFile, true), '|');
 final String resultsTable = type.getResultsTableName(); if (!type.hasResultsTable()) { throw new DotDataException("Integrity type =[" + type + "] does not support this method, because results table is not available."); }
 final StringBuilder sbSelectTempTable = new StringBuilder(); switch(type) { case HTMLPAGES: case FILEASSETS: sbSelectTempTable.append("select ").append(type.getFirstDisplayColumnLabel()).append( ", remote\_working\_inode, local\_working\_inode, remote\_live\_inode, local\_live\_inode, remote\_identifier, local\_identifier, language\_id from " ); break; case FOLDERS: sbSelectTempTable.append( "select remote\_inode, local\_inode, remote\_identifier, local\_identifier from " ); break; case CMS\_ROLES: sbSelectTempTable.append( "select name, role\_key, remote\_role\_id, local\_role\_id, local\_role\_fqn, remote\_role\_fqn from " ); break; default: sbSelectTempTable.append("select remote\_inode, local\_inode from "); break; } sbSelectTempTable.append(resultsTable).append(" where endpoint\_id = ?");  final Connection conn = DbConnectionFactory.getConnection(); final PreparedStatement statement = conn.prepareStatement(sbSelectTempTable.toString()); statement.setString(1, endpointId); try (final ResultSet rs = statement.executeQuery()) { int count = 0;
 while (rs.next()) { if (type == IntegrityType.CMS\_ROLES) { writer.write(rs.getString("name")); writer.write(rs.getString("role\_key"));
 writer.write(rs.getString("remote\_role\_id")); writer.write(rs.getString("local\_role\_id")); writer.write(rs.getString("remote\_role\_fqn")); writer.write(rs.getString("local\_role\_fqn"));
 } else if (type == IntegrityType.HTMLPAGES || type == IntegrityType.FILEASSETS) { writer.write(rs.getString("remote\_working\_inode")); writer.write(rs.getString("local\_working\_inode")); writer.write(rs.getString("remote\_live\_inode")); writer.write(rs.getString("local\_live\_inode"));  writer.write(rs.getString("remote\_identifier")); writer.write(rs.getString("local\_identifier"));  writer.write(rs.getString(type.getFirstDisplayColumnLabel())); writer.write(rs.getString("language\_id")); } else { writer.write(rs.getString("remote\_inode")); writer.write(rs.getString("local\_inode")); }
 if (type == IntegrityType.FOLDERS) { writer.write(rs.getString("remote\_identifier")); writer.write(rs.getString("local\_identifier")); }
 writer.endRecord(); count++;
 if (count == 1000) { writer.flush(); count = 0; } } } finally { try { statement.close(); } catch (Exception e) {} } } catch (final SQLException e) { throw new DotDataException(String.format("An error occurred when generating the Data-To-Fix CSV file for " + "type '%s' in Endpoint '%s': %s", type.getLabel(), endpointId, e.getMessage()), e); } finally { if (writer != null) writer.close(); }
 return csvFile; }
 private static void addToZipFile(String fileName, ZipOutputStream zos, String zipEntryName) throws Exception { try { Logger.info(IntegrityUtil.class, "Writing '" + fileName + "' to zip file");
 File file = new File(fileName); try (InputStream fis = Files.newInputStream(file.toPath())) { ZipEntry zipEntry = new ZipEntry(zipEntryName); zos.putNextEntry(zipEntry);
 byte[] bytes = new byte[1024]; int length; while ((length = fis.read(bytes)) >= 0) { zos.write(bytes, 0, length); }
 zos.closeEntry(); } catch (FileNotFoundException f) { Logger.error(IntegrityUtil.class, "Could not find file " + fileName, f); throw new Exception("Could not find file " + fileName, f); } catch (IOException e) { Logger.error(IntegrityUtil.class, "Error writing file to zip: " + fileName, e); throw new Exception("Error writing file to zip: " + fileName, e); } } catch (NullPointerException npe) { Logger.error(IntegrityUtil.class, "File name cannot be NULL", npe); throw new Exception("File name cannot be NULL", npe); } }
 public static void unzipFile(final InputStream zipFile, final String outputDir) throws Exception { final File dir = new File(outputDir);
 // if file doesn't exists, then create it if (!dir.exists()) { dir.mkdir(); }  ZipInputStream zin = null; OutputStream os = null; ZipEntry ze = null; try {
 zin = new ZipInputStream(zipFile); while ((ze = zin.getNextEntry()) != null) {  // for each entry to be extracted int bytesRead; final byte[] buf = new byte[1024];  Logger.info(IntegrityUtil.class, "Unzipping " + ze.getName());
 os = Files.newOutputStream(Paths.get(outputDir + File.separator + ze.getName()));
 while ( (bytesRead = zin.read( buf, 0, 1024 )) > -1 ) os.write( buf, 0, bytesRead ); try { if ( null != os ) { os.close(); } } catch ( Exception e ) { Logger.warn( IntegrityUtil.class, "Error Closing Stream.", e ); } } } catch (final IOException e) { final String errorMsg = String.format("Error while unzipping Integrity Data in file '%s': %s", null != ze ? ze.getName() : "", e.getMessage()); Logger.error(IntegrityUtil.class, errorMsg, e); throw new Exception(errorMsg, e); } finally { // close your streams if ( zin != null ) { try { zin.close(); } catch ( IOException e ) { Logger.warn( IntegrityUtil.class, "Error Closing Stream.", e ); } } if ( os != null ) { try { os.close(); } catch ( IOException e ) { Logger.warn( IntegrityUtil.class, "Error Closing Stream.", e ); } } } }
 /\*\* \* Resolves the integrity data path based on provided endpoint id. \* \* @param endpointId endpoint if \* @return integrity data path as a string \*/ public static String getIntegrityDataPath(final String endpointId) { return ConfigUtils.getIntegrityPath() + File.separator + endpointId; }
 /\*\* \* Generated the integrity data file path based on provided endpointId and the file name. \* File names to be used: DataToCheck.zip, DataToFix.zip and DataStatus.properties. \* \* @param endpointId endpoint gid \* @param dataFile data filename \* @return path to filename \*/ public static String getIntegrityDataFilePath(final String endpointId, final String dataFile) { return getIntegrityDataPath(endpointId) + File.separator + dataFile; }
 /\*\* \* Tells whether a integrity file exists based on provided endpointId and the file name. \* \* @param endpointId endpoint id \* @param dataFile data filename \* @return path to filename \*/ public static boolean doesIntegrityDataFileExist(final String endpointId, final String dataFile) { return new File(getIntegrityDataFilePath(endpointId, dataFile)).exists(); }
 /\*\* \* Gets a {@link IntegrityDataExecutionMetadata} instance based on provided endpoint id which contains metadata of the \* integrity data generation execution. \* \* @param requesterKey endpoint id \* @return Optional wrapping the integrity generation metadata \*/ public static Optional<IntegrityDataExecutionMetadata> getIntegrityMetadata(final String requesterKey) { final File statusFile = new File(getIntegrityDataFilePath(requesterKey, INTEGRITY\_DATA\_STATUS\_FILENAME)); if (!statusFile.exists()) { return Optional.empty(); }
 final Properties statusData = new Properties(); try { statusData.load(new FileInputStream(statusFile)); } catch (IOException e) { Logger.error( IntegrityUtil.class, String.format("Could load status from %s", statusFile.getAbsolutePath()), e); return Optional.empty(); }
 return Optional.of(new IntegrityDataExecutionMetadata( statusData.getProperty(REQUESTER\_KEY), statusData.getProperty(INTEGRITY\_DATA\_REQUEST\_ID), statusData.getProperty(INTEGRITY\_DATA\_STATUS), statusData.getProperty(INTEGRITY\_DATA\_ERROR\_MESSAGE))); }
 /\*\* \* Removes any file leftovers from other integrity checks at the location based on the endpoint id. \* That will be any data check and status files. \* \* @param endpointId endpoint id \*/ public static void cleanUpIntegrityData(String endpointId) { final BiConsumer<String, String> resetConsumer = (id, filename) -> { final File file = new File(getIntegrityDataFilePath(id, filename)); if (file.exists()) { file.delete(); } };
 resetConsumer.accept(endpointId, INTEGRITY\_DATA\_STATUS\_FILENAME); resetConsumer.accept(endpointId, INTEGRITY\_DATA\_TO\_CHECK\_ZIP\_FILENAME); }
 /\*\* \* Saves a integrity data generation metadata in a to-be-discovered location so it can be read by concurrent parts \* that need to know what is the status of the integrity data generation. \* The data is saved as {@link Properties} file. \* \* @param integrityDataExecutionMetadata execution metadata \*/ private static void saveIntegrityDataStatus(IntegrityDataExecutionMetadata integrityDataExecutionMetadata) { final String endpointId = integrityDataExecutionMetadata.getEndpointId(); final File integrityDir = new File(getIntegrityDataPath(endpointId)); if (!integrityDir.exists()) { integrityDir.mkdir(); }
 final File statusFile = new File(getIntegrityDataFilePath(endpointId, INTEGRITY\_DATA\_STATUS\_FILENAME)); /\*if (statusFile.exists()) { statusFile.delete(); }\*/
 final Properties statusData = new Properties(); final BiConsumer<String, String> addData = (data, name) -> { if (StringUtils.isNotBlank(data)) { statusData.setProperty(name, data); } };
 addData.accept(endpointId, REQUESTER\_KEY); addData.accept(integrityDataExecutionMetadata.getRequestId(), INTEGRITY\_DATA\_REQUEST\_ID); statusData.setProperty(INTEGRITY\_DATA\_STATUS, integrityDataExecutionMetadata.getProcessStatus().toString().toUpperCase()); addData.accept(integrityDataExecutionMetadata.getErrorMessage(), INTEGRITY\_DATA\_ERROR\_MESSAGE);
 try (FileOutputStream output = new FileOutputStream(statusFile)) { statusData.store(output, null); } catch (IOException e) { throw new DotExecutionException( String.format("Could not save status to %s", statusFile.getAbsolutePath()), e); } }
 /\*\* \* Saves a integrity data generation metadata in a to-be-discovered location so it can be read by concurrent parts \* that need to know what is the status of the integrity data generation. \* Individual parameters are used to create a {@link IntegrityDataExecutionMetadata}. \* \* @param endpointId endpoint id \* @param requestId request id \* @param processStatus {@link IntegrityResource.ProcessStatus} instance to reflect the current status \* @param errorMessage error message associated to detected error \*/ public static void saveIntegrityDataStatus(final String endpointId, final String requestId, final IntegrityResource.ProcessStatus processStatus, final String errorMessage) { saveIntegrityDataStatus(new IntegrityDataExecutionMetadata(endpointId, requestId, processStatus, errorMessage)); }
 /\*\* \* Saves a integrity data generation metadata in a to-be-discovered location so it can be read by concurrent parts \* that need to know what is the status of the integrity data generation. \* Individual parameters are used to create a {@link IntegrityDataExecutionMetadata}. \* \* @param endpointId endpoint id \* @param requestId request id \* @param processStatus {@link IntegrityResource.ProcessStatus} instance to reflect the current status \*/ public static void saveIntegrityDataStatus(final String endpointId, final String requestId, final IntegrityResource.ProcessStatus processStatus) { saveIntegrityDataStatus(endpointId, requestId, processStatus, null); }
 /\*\* \* Creates all the CSV from End Point database table and store them inside \* zip file. \* \* @param endpointId \* @throws Exception \*/ public static void generateDataToCheckZip(final String endpointId) { if (!UtilMethods.isSet(endpointId)) { Logger.error(IntegrityUtil.class, "Endpoint was not provided"); return; }
 Logger.info( IntegrityUtil.class, String.format("Starting integrity data generation job for endpoint %s", endpointId));
 File zipFile = null; try { final String outputPath = getIntegrityDataPath(endpointId); final File dir = new File(outputPath); // if file doesn't exist, create it if (!dir.exists()) { dir.mkdir(); }
 zipFile = new File(getIntegrityDataFilePath(endpointId, INTEGRITY\_DATA\_TO\_CHECK\_ZIP\_FILENAME)); try(OutputStream outputStream = Files.newOutputStream(zipFile.toPath()); ZipOutputStream zipOutputStream = new ZipOutputStream(outputStream)) { final IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { File fileToCheckCsvFile = null;
 try { fileToCheckCsvFile = integrityType.getIntegrityChecker().generateCSVFile(outputPath); addToZipFile(fileToCheckCsvFile.getAbsolutePath(), zipOutputStream, integrityType.getDataToCheckCSVName()); } finally { if (fileToCheckCsvFile != null && fileToCheckCsvFile.exists()) { fileToCheckCsvFile.delete(); } } } } } catch (Exception e) { if (zipFile != null && zipFile.exists()) { zipFile.delete(); }
 throw new DotExecutionException(e); } }
 public void generateDataToFixZip(final String endpointId, final IntegrityType type) { if (!UtilMethods.isSet(endpointId)) { return; }
 File dataToFixCsvFile = null; File zipFile = null; try { final String outputPath = getIntegrityDataPath(endpointId); final File dir = new File(outputPath); // if file doesn't exist, create it if (!dir.exists()) { dir.mkdir(); }
 zipFile = new File(getIntegrityDataFilePath(endpointId, INTEGRITY\_DATA\_TO\_FIX\_ZIP\_FILENAME)); try (OutputStream outputStream = Files.newOutputStream(zipFile.toPath()); ZipOutputStream zipOutputStream = new ZipOutputStream(outputStream)) { // create Folders CSV dataToFixCsvFile = generateDataToFixCSV(outputPath, endpointId, type);
 addToZipFile(dataToFixCsvFile.getAbsolutePath(), zipOutputStream, type.getDataToFixCSVName()); } } catch (Exception e) { Logger.error(getClass(), "Error generating fix for remote", e); if (zipFile != null && zipFile.exists()) zipFile.delete(); } finally { if (dataToFixCsvFile != null && dataToFixCsvFile.exists()) dataToFixCsvFile.delete(); } }
 public static void dropTempTables(final String endpointId) throws DotDataException { DotConnect dc = new DotConnect(); try { IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { for(String tempTableName : integrityType.getIntegrityChecker().getTempTableNames(endpointId)) { if (doesTableExist(tempTableName)) { dc.executeStatement("truncate table " + tempTableName); dc.executeStatement("drop table " + tempTableName); }else if (DbConnectionFactory.isMySql()){ dc.executeStatement("drop table if exists " + tempTableName); } else if (DbConnectionFactory.isMsSql()){ dc.executeStatement("IF OBJECT\_ID('tempdb.dbo." + tempTableName + "', 'U') IS NOT NULL" + " DROP TABLE " + tempTableName); } } } } catch (SQLException e) { Logger.error(IntegrityResource.class, "Error dropping Temp tables"); throw new DotDataException("Error dropping Temp tables", e); } }
 public List<Map<String, Object>> getIntegrityConflicts(String endpointId, IntegrityType type) throws Exception { try { DotConnect dc = new DotConnect();
 final String resultsTableName = type.getResultsTableName(); if (!type.hasResultsTable() || !doesTableExist(resultsTableName)) { return new ArrayList<Map<String, Object>>(); }
 dc.setSQL("select \* from " + resultsTableName + " where endpoint\_id = ? ORDER BY " + type.getFirstDisplayColumnLabel()); dc.addParam(endpointId);
 return dc.loadObjectResults();
 } catch (Exception e) { throw new Exception("Error running the " + type.name() + " Integrity Check", e); } }
 /\*\* \* Un-zips the file containing the information of the specified type. The \* data of the records that will be fixed in the destination end point will \* be stored in a results table, which is unique for every type of integrity \* fix. \*  \* @param dataToFix \* - The {@link InputStream} containing the data to fix. \* @param key \* - The ID of the end point where the data will be fixed. \* @param type \* - The type of object (Content Page, Folder, Content Type, \* etc.) that will be fixed. \* @throws Exception \* An error occurred during the integrity fix process. The \* results table must be wiped out. \*/ @WrapInTransaction public void fixConflicts(InputStream dataToFix, String key, IntegrityType type) throws Exception { final String outputDir = ConfigUtils.getIntegrityPath() + File.separator + key;
 // lets first unzip the given file unzipFile(dataToFix, outputDir);
 // lets generate the tables with the data to be fixed generateDataToFixTable(key, type); fixConflicts(key, type);
 HibernateUtil.addCommitListener(new FlushCacheRunnable() { @Override public void run() {
 IntegrityUtil.this.flushAllCache(); } });
 }
 /\*\* \* Flush all caches \* @throws DotDataException \*/ public void flushAllCache() {
 try { MaintenanceUtil.flushCache(); APILocator.getPermissionAPI().resetAllPermissionReferences(); } catch (Exception e) { Logger.error(this, e.getMessage(), e); } }
 /\*\* \* Takes the information from the .ZIP file and stores it in the results \* table so that the process to fix records begins. Every type of object \* (Content Page, Folder, Content Type, etc.) has its own results table \* which indicates what records <b>MUST</b> be changed in the specified end \* point. \*  \* @param key \* - The ID of the end point where the data will be fixed. \* @param type \* - The type of object (Content Page, Folder, Content Type, \* etc.) that will be fixed. \* @throws Exception \* An error occurred during the integrity fix process. \*/ public void generateDataToFixTable(String key, IntegrityType type) throws Exception {
 try { final CsvReader csvFile = new CsvReader(ConfigUtils.getIntegrityPath() + File.separator + key + File.separator + type.getDataToFixCSVName(), '|', Charset.forName("UTF-8"));
 final String resultsTable = type.getResultsTableName(); if (!type.hasResultsTable()) { throw new DotDataException("Integrity type =[" + type + "] does not support this method, because results table is not available."); }
 // Create insert query for temporary table final StringBuilder sbInsertTempTable = new StringBuilder("insert into ").append(resultsTable); switch(type) { case HTMLPAGES: case FILEASSETS: sbInsertTempTable.append( " (local\_working\_inode, remote\_working\_inode, local\_live\_inode, remote\_live\_inode, local\_identifier, remote\_identifier, " ).append(type.getFirstDisplayColumnLabel()).append(", endpoint\_id, language\_id) values(?,?,?,?,?,?,?,?,?)"); break; case FOLDERS: sbInsertTempTable.append(" (local\_inode, remote\_inode, local\_identifier, remote\_identifier, endpoint\_id) values(?,?,?,?,?)"); break; case CMS\_ROLES: sbInsertTempTable.append(" (name, role\_key, local\_role\_id, remote\_role\_id, local\_role\_fqn, remote\_role\_fqn, endpoint\_id) values(?,?,?,?,?,?,?)"); break; default: sbInsertTempTable.append(" (local\_inode, remote\_inode, endpoint\_id) values(?,?,?)"); break; } final String INSERT\_TEMP\_TABLE = sbInsertTempTable.toString();
 DotConnect dc = new DotConnect(); while (csvFile.readRecord()) { // TODO: FIX THE INDEXES FOR // HTMLPAGES dc.setSQL(INSERT\_TEMP\_TABLE);
 if (type == IntegrityType.CMS\_ROLES) { dc.addParam(csvFile.get(0)); // name dc.addParam(csvFile.get(1)); // role\_key dc.addParam(csvFile.get(2)); // local\_role\_id dc.addParam(csvFile.get(3)); // remote\_role\_id dc.addParam(csvFile.get(4)); // local\_role\_fqn dc.addParam(csvFile.get(5)); // remote\_role\_fqn } else { dc.addParam(csvFile.get(0)); // localWorkingInode dc.addParam(csvFile.get(1)); // remoteWorkingInode
 if (type == IntegrityType.HTMLPAGES || type == IntegrityType.FILEASSETS) { dc.addParam(csvFile.get(2)); // localLiveInode dc.addParam(csvFile.get(3)); // remoteLiveInode dc.addParam(csvFile.get(4)); // localIdentifier dc.addParam(csvFile.get(5)); // remoteIdentifier dc.addParam(csvFile.get(6)); // contentletAssetName } else if (type == IntegrityType.FOLDERS) { dc.addParam(csvFile.get(2)); // localIdentifier dc.addParam(csvFile.get(3)); // remoteIdentifier } }
 dc.addParam(key);
 if (type == IntegrityType.HTMLPAGES || type == IntegrityType.FILEASSETS) { dc.addParam(new Long(csvFile.get(7))); // languageId }
 dc.loadResult(); }
 } catch (final Exception e) { throw new Exception(String.format("An error occurred when generating data to fix for type '%s' in " + "Endpoint '%s': %s", type.getLabel(), key, e.getMessage()), e); } }
 public boolean doesIntegrityConflictsDataExist(String endpointId) throws Exception { boolean conflictsDataExist = false;
 IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { if (integrityType.getIntegrityChecker().doesIntegrityConflictsDataExist(endpointId)) { conflictsDataExist = true; break; } }
 return conflictsDataExist; }
 private static boolean doesTableExist(String tableName) throws DotDataException { DotConnect dc = new DotConnect();
 if (DbConnectionFactory.isOracle()) { dc.setSQL("SELECT COUNT(\*) as exist FROM user\_tables WHERE table\_name='" + tableName.toUpperCase() + "'"); BigDecimal existTable = (BigDecimal) dc.loadObjectResults().get(0).get("exist"); return existTable.longValue() > 0; } else if (DbConnectionFactory.isPostgres() || DbConnectionFactory.isMySql()) { dc.setSQL("SELECT COUNT(table\_name) as exist FROM information\_schema.tables WHERE Table\_Name = '" + tableName + "' "); long existTable = (Long) dc.loadObjectResults().get(0).get("exist"); return existTable > 0; } else if (DbConnectionFactory.isMsSql()) { dc.setSQL("SELECT COUNT(\*) as exist FROM sysobjects WHERE name = '" + tableName + "'"); int existTable = (Integer) dc.loadObjectResults().get(0).get("exist"); return existTable > 0; } else if (DbConnectionFactory.isH2()) { dc.setSQL("SELECT COUNT(1) as exist FROM information\_schema.tables WHERE Table\_Name = '" + tableName.toUpperCase() + "' "); long existTable = (Long) dc.loadObjectResults().get(0).get("exist"); return existTable > 0; }
 return false; }
 /\*\* \* Executes the integrity fix process according to the specified type. \*  \* @param key \* - The ID of the end point where the data will be fixed. \* @param type \* - The type of object (Content Page, Folder, Content Type, \* etc.) that will be fixed. \* @throws DotDataException \* An error occurred when interacting with the database. \* @throws DotSecurityException \* The specified user does not have permissions to perform the \* action. \*/ @WrapInTransaction public void fixConflicts(final String key, IntegrityType type) throws DotDataException, DotSecurityException { type.getIntegrityChecker().executeFix(key); }
 /\*\* \* Discard conflicts from a integrity type in a specific endpoint. \*  \* @param endpointId \* @param type \* indicates the integrity type \* @throws DotDataException \*/ public void discardConflicts(final String endpointId, IntegrityType type) throws DotDataException { type.getIntegrityChecker().discardConflicts(endpointId); }
 /\*\* \* Discard conflicts from each integrity type in {@link IntegrityType} enum \* by passing a specific endpoint. \*  \* @param endpointId \* @throws DotDataException \* @throws Exception \*/ @WrapInTransaction public static void completeDiscardConflicts(final String endpointId) throws DotDataException {
 IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { integrityType.getIntegrityChecker().discardConflicts(endpointId); } }
 /\*\* \* Check integrity from each integrity type in {@link IntegrityType} enum by \* passing a specific endpoint. Also, it generates and fill the results \* table to view results \*  \* @param endpointId \* @return is there is at least one conflict returns true, otherwise false \* @throws Exception \*/ @WrapInTransaction public static boolean completeCheckIntegrity(final String endpointId) throws Exception { boolean existConflicts = false;
 IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { existConflicts |= integrityType.getIntegrityChecker() .generateIntegrityResults(endpointId); }
 return existConflicts; }
 /\*\* \* Integrity data generation metadata bean to be saved. \*/ public static class IntegrityDataExecutionMetadata implements Serializable {
 private final String endpointId; private final String requestId; private final IntegrityResource.ProcessStatus processStatus; private final String errorMessage;
 public IntegrityDataExecutionMetadata(String endpointId, String requestId, IntegrityResource.ProcessStatus processStatus, String errorMessage) { this.endpointId = endpointId; this.requestId = requestId; this.processStatus = processStatus; this.errorMessage = errorMessage; }
 public IntegrityDataExecutionMetadata(String endpointId, String requestId, String status, String errorMessage) { this(endpointId, requestId, IntegrityResource.ProcessStatus.valueOf(status.toUpperCase()), errorMessage); }
 public String getEndpointId() { return endpointId; }
 public String getRequestId() { return requestId; }
 public IntegrityResource.ProcessStatus getProcessStatus() { return processStatus; }
 public String getErrorMessage() { return errorMessage; }
 }
}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c36fb36d_20250115_114545.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FdotCMS%2Fcore%2Fblob%2Frelease-21.04%2FdotCMS%2Fsrc%2Fmain%2Fjava%2Fcom%2Fdotcms%2Frest%2FIntegrityResource.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FdotCMS%2Fcore%2Fblob%2Frelease-21.04%2FdotCMS%2Fsrc%2Fmain%2Fjava%2Fcom%2Fdotcms%2Frest%2FIntegrityResource.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=dotCMS%2Fcore)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dotCMS](/dotCMS)
/
**[core](/dotCMS/core)**
Public

* [Notifications](/login?return_to=%2FdotCMS%2Fcore) You must be signed in to change notification settings
* [Fork
  467](/login?return_to=%2FdotCMS%2Fcore)
* [Star
   867](/login?return_to=%2FdotCMS%2Fcore)

* [Code](/dotCMS/core/tree/release-21.04)
* [Issues
  951](/dotCMS/core/issues)
* [Pull requests
  33](/dotCMS/core/pulls)
* [Discussions](/dotCMS/core/discussions)
* [Actions](/dotCMS/core/actions)
* [Projects
  1](/dotCMS/core/projects)
* [Security](/dotCMS/core/security)
* [Insights](/dotCMS/core/pulse)

Additional navigation options

* [Code](/dotCMS/core/tree/release-21.04)
* [Issues](/dotCMS/core/issues)
* [Pull requests](/dotCMS/core/pulls)
* [Discussions](/dotCMS/core/discussions)
* [Actions](/dotCMS/core/actions)
* [Projects](/dotCMS/core/projects)
* [Security](/dotCMS/core/security)
* [Insights](/dotCMS/core/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.snyk.io_51bc8fc6_20250115_114542.html ===
[![Homepage](/_nuxt/header-logo.Dk_X-iWD.svg)](/)
# Zip Slip Vulnerability

Zip Slip is a widespread arbitrary file overwrite critical vulnerability, which typically results in remote command execution. It was discovered and responsibly disclosed by the Snyk Security team ahead of a public disclosure on 5th June 2018, and affects thousands of projects, including ones from HP, Amazon, Apache, Pivotal and  [many more (CVEs and full list here).](https://github.com/snyk/zip-slip-vulnerability)  Of course, this type of vulnerability has existed before, but recently it has manifested itself in a much larger number of projects and libraries.

![Zip Slip](https://res.cloudinary.com/snyk/image/upload/f_auto,q_auto,c_thumb,h_225,w_225/v1527156415/research/zipslip.png)

The vulnerability has been found in multiple ecosystems, including JavaScript, Ruby, .NET and Go, but is especially prevalent in Java, where there is no central library offering high level processing of archive (e.g. zip) files. The lack of such a library led to vulnerable code snippets being hand crafted and shared among developer communities such as  [StackOverflow.](https://stackoverflow.com/questions/981578/how-to-unzip-files-recursively-in-java)

The vulnerability is exploited using a specially crafted archive that holds directory traversal filenames (e.g. ../../evil.sh). The Zip Slip vulnerability can affect numerous archive formats, including tar, jar, war, cpio, apk, rar and 7z. If you’d like the information on this page in a downloadable technical white paper, click the button below.

 [Download Technical White Paper](https://res.cloudinary.com/snyk/image/upload/v1528192501/zip-slip-vulnerability/technical-whitepaper.pdf)

Zip Slip is a form of directory traversal that can be exploited by extracting files from an archive. The premise of the directory traversal vulnerability is that an attacker can gain access to parts of the file system outside of the target folder in which they should reside. The attacker can then overwrite executable files and either invoke them remotely or wait for the system or user to call them, thus achieving remote command execution on the victim’s machine. The vulnerability can also cause damage by overwriting configuration files or other sensitive resources, and can be exploited on both client (user) machines and servers.

##### Exploitable Application Flow

The two parts required to exploit this vulnerability is a malicious archive and extraction code that does not perform validation checking. Let’s look through each of these in turn. First of all, the contents of the zip file needs to have one or more files that break out of the target directory when extracted. In the example below, we can see the contents of a zip file. It has two files, a good.sh file which would be extracted into the target directory and an evil.sh file which is trying to traverse up the directory tree to hit the root and then add a file into the tmp directory. When you attempt to cd .. in the root directory, you still find yourself in the root directory, so a malicious path could contain many levels of ../ to stand a better chance of reaching the root directory, before trying to traverse to sensitive files.

```
  5 Tue Jun 5 11:04:29 BST 2018 good.sh 20 Tue Jun 5 11:04:42 BST 2018 ../../../../../../../../tmp/evil.sh
```

The contents of this zip file have to be hand crafted. Archive creation tools don’t typically allow users to add files with these paths, despite the zip specification allowing it. However, with the right tools, it’s easy to create files with these paths.

 The second thing you’ll need to exploit this vulnerability is to extract the archive, either using your own code or a library. The vulnerability exists when the extraction code omits validation on the file paths in the archive. An example of a vulnerable code snippet (example shown in Java) can be seen below.

```
  1   Enumeration<ZipEntry>entries = zip.getEntries();
  2   while (entries.hasMoreElements()) {
  3       ZipEntry e = entries.nextElement();
  4       File f = new File(destinationDir, e.getName());
  5       InputStream input = zip.getInputStream(e);
  6       IOUtils.copy(input, write(f));
  7   }
```

You can see on line 4, e.getName() is concatenated with the target directory, dir, without being validated. At this point, when our zip archive gets to our evil.sh, it will append the full path (including every ../) of the zip entry to the target directory resulting in evil.sh being written outside of the target directory.

 To see Zip Slip in action,  [watch us exploit the vulnerable java-goof application](https://www.youtube.com/watch?v=l1MT5lr4p9o)  , a sample application used to show many known vulnerabilities.

##### Are you Vulnerable?

You are vulnerable if you are either using a library which contains the Zip Slip vulnerability or your project directly contains vulnerable code, which extracts files from an archive without the necessary directory traversal validation. Snyk is maintaining a [GitHub repository listing all](https://github.com/snyk/zip-slip-vulnerability) projects that have been found vulnerable to Zip Slip and have been responsibly disclosed to, including fix dates and versions. The repository is open to contributions from the wider community to ensure it holds the most up to date status.s.

##### What action should you take?

Here are some steps you can take to check if your project’s dependencies of code contain the Zip Slip vulnerability:

##### 1. Search through your projects for vulnerable code.

JavaGroovyJavaScript.NETGoRuby & Python
##### 2. Add Zip Slip Security Testing to your application build pipeline

If you’d prefer not to search through your direct and transitive dependencies (of which you likely have hundreds) to determine if you’re using a vulnerable library, you can choose a dependency vulnerability scanning tool, like Snyk. It’s a good practice to add security testing into your development lifecycle stages, such as during development, CI, deployment and production. You can test your own projects (all the ecosystems mentioned above are supported) to determine if they are vulnerable to Zip Slip.

##### Other vulnerable projects

Vulnerable projects include projects in various ecosystems that either use the libraries mentioned above or directly include vulnerable code. Of the many thousands of projects that have contained similar vulnerable code samples or accessed vulnerable libraries, the most significant include: Oracle, Amazon, Spring/Pivotal, Linkedin, Twitter, Alibaba, Jenkinsci, Eclipse, OWASP, SonarQube, OpenTable, Arduino, ElasticSearch, Selenium, JetBrains and Google.

##### Thank you!

The Snyk security team would like for thank all the vendors, project owners and the community members that helped raise awareness, find and fix vulnerabilities in projects across many ecosystems.

### Do your applications use this vulnerable package?

In a few clicks we can analyze your entire application and see what components are vulnerable in your application, and suggest you quick fixes.

[Test your applications](https://app.snyk.io/login?cta=sign-up&loc=banner&page=vuln-vuln)
##### Zip Slip Disclosure Timeline

This disclosure timeline details our actions from the first private disclosure on April 15th 2018.

| Date | Events |
| --- | --- |
| Apr 15th 2018 | Initial private disclosure to codehous/plexus-archiver, zip4j, adm-zip, unzipper, mholt/archiver |
| Apr 15th 2018 | Confirmed codehous/plexus-archiver, zip4j, mholt/archiver |
| Apr 17th 2018 | Confirmed adm-zip |
| Apr 17th 2018 | unzipper fix released, v0.8.13, (CVE-2018-1002203} |
| Apr 17th 2018 | Snyk submitted a fix to mholt/archiver and unzipper |
| Apr 17th 2018 | mholt/archiver fix released (CVE-2018-1002207} |
| Apr 18th 2018 | Private disclosure to ZeroTurnaround zt-zip |
| view more | |
| --- | --- |

[Report a new vulnerability](https://snyk.io/vulnerability-disclosure/) [Found a mistake?](https://support.snyk.io/s/contactsupport)
### Product

* [Snyk Open Source](https://snyk.io/product/open-source-security-management/)
* [Snyk Code](https://snyk.io/product/snyk-code/)
* [Snyk Container](https://snyk.io/product/container-vulnerability-management/)
* [Snyk Infrastructure as Code](https://snyk.io/product/infrastructure-as-code-security/)
* [Snyk AppRisk](https://snyk.io/product/snyk-apprisk/)
### Resources

* [Vulnerability DB](https://security.snyk.io/)
* [Documentation](https://docs.snyk.io/)
* [Disclosed Vulnerabilities](/disclosed-vulnerabilities)
* [Blog](https://snyk.io/blog/)
* [FAQs](https://support.snyk.io/)
### Company

* [About](https://snyk.io/about)
* [Jobs](https://snyk.io/careers/)
* Contact
* [Policies](https://snyk.io/policies/terms-of-service/)
* [Do Not Sell My Personal Information](https://preferences.snyk.io/dont_sell)
### Contact Us

* Support
* [Report a new vuln](https://snyk.io/vulnerability-disclosure)
* [Events](https://snyk.io/events)
### Find us online

### Track our development

[![DevSecOps Community Podcast](data:image/svg+xml;base64...)](https://www.devseccon.com/the-secure-developer-podcast/)

© 2025 Snyk Limited

Registered in England and Wales. Company number: 09677925

Registered address: Highlands House, Basingstoke Road, Spencers Wood, Reading, Berkshire, RG7 1NT.



=== Content from www.dotcms.com_79b7e63a_20250115_114546.html ===


[![dotCMS](/contentAsset/image/95bd9e09-b678-4665-95aa-9639826a3559/fileAsset)
Docs](https://www.dotcms.com)
Search dotCMS Documentation

**[APIs](web-apis)**
**[Releases](current-releases)**
[Get dotCMS](/download/)

[APIs](web-apis)
[Releases](current-releases)
[Changelogs](changelogs)
[Support](https://www.dotcms.com/services/professional-services/)
[Careers](https://www.dotcms.com/company/careers/)
[GitHub](https://github.com/dotCMS/)
[Get dotCMS](https://www.dotcms.com/)

* [Docs Home](/docs/latest/table-of-contents)
* [Platform](/docs/latest/platform)
* [Features](/docs/latest/features)
* [Authoring Content](/docs/latest/authoring-content)
* [Developing](/docs/latest/developing-and-apis)
* [Administration](/docs/latest/administration)
* [Security and Privacy](/docs/latest/security-and-privacy)
  + [Privacy Policy](/docs/latest/privacy-policy)
  + [GDPR and CCPA Compliance Support](/docs/latest/gdpr-and-ccpa-compliance-support)
  + [Known Security Issues](/docs/latest/known-security-issues)
  + [Responsible Disclosure Policy](/docs/latest/responsible-disclosure-policy)
  + [Security Best Practices](/docs/latest/security-best-practices)
  + [Privacy Best Practices](/docs/latest/privacy-best-practices)
  + [Login and Session Security](/docs/latest/login-and-session-security)
  + [Cookie Use](/docs/latest/cookie-use)
  + [XSS Prevention](/docs/latest/xss-prevention)
* [Product Versions](/docs/latest/product-versions)
* [Help and Support](/docs/latest/help)

* [![Documentation Home](/documentation/images/home.png)](table-of-contents)  /* [Security and Privacy](/docs/latest/security-and-privacy)  /
  * XSS Prevention

# XSS Prevention

Last Updated:
Nov 2, 2020

 documentation for the dotCMS Content Management System

## XSS PROTECTION FOR ADMIN SCREENS

As of version 5.2, dotCMS has shipped with a filter that is designed to minimize XSS and CSRF vunerabilities in the administrative console. To do this, dotCMS blocks direct access to all files under the administrative directories, e.g. `/html`, `/dotAdmin` … unless dotCMS is sent a valid referer (or Origin) header.

Prior to dotCMS 5.2, a similar protection was enabled using a plugin known as the `CSRFFilter` plugin, **which is no longer needed**.

The XSS prevention behavior is enabled globally by default and can be turned off globally by this property:

```
XSS_PROTECTION_ENABLED=false

```

The paths (regexes) that are protected default to the list found here:

* [https://github.com​/dotCMS​​/core​/blob​/main​/dotCMS​/src​/main​/java​/com​/dotcms​/filters​/interceptor​/dotcms​/XSSPreventionWebInterceptor​.java#L26](https://github.com/dotCMS/core/blob/main/dotCMS/src/main/java/com/dotcms/filters/interceptor/dotcms/XSSPreventionWebInterceptor.java#L26)

They can be overridden if needed by this comma separate property:

```
XSS_PROTECTED_PATHS=\\A/html/,\\A/c/,\\A/servlets/

```

With XSS protection, dotCMS expects a valid `referer` or `Origin` header. The `Origin` Header is checked first and if it is not present, dotCMS will fall back to check the `referer` header. For a request to be valid, one of the following must be true:

* The Origin/referer is the same host name as the request url (normally, this is the case).
* The Origin/referer header has a value equal to a site or alias defined in the site manager (not normal, but maybe).
* The Origin/referer header has a value equal to the “Portal Url” as defined on the Configuration Screen.
* The request is for a \*.css file (css @import statements do not set a referer).

If none of these conditions are met and you have a case where you need to allow non-refered access to an administrative file or folder
you can add uris and paths to ignore to a config property `IGNORE_REFERER_FOR_PATHS`, as comma separated values. dotCMS will ignore all matching uris or, if it ends with an astrick, then all uris that begin with the value, e.g.

```
# IGNORE_REFERER_FOR_PATHS=/html/common/css.jsp,/html/my-plugin/*

```

### On this page

FLAG FOR REVIEW

×
## We Dig Feedback

#### Selected excerpt:

CLEAR COMMENT
Submit

×
##

OK

![](/dA/aa725c6611/fileAsset/adding-feedback.gif)

1. Highlight a passage you'd like to flag for review
2. Optionally describe your recommendations or concerns
3. Submit your feedback; our team will review it and make any necessary changes

**Note:** We cannot directly respond to feedback submitted this way; if you require a response, please see our [dotCMS User Group](https://groups.google.com/g/dotcms).

* [![Connect with dotCMS on Facebook](/application/themes/dotcms/img/icons/facebook-wh.svg)](https://www.facebook.com/dotCMS/)
* [![Connect with dotCMS on LinkedIn](/application/themes/dotcms/img/icons/linkedin-wh.svg)](https://www.linkedin.com/company/dotcms/)
* [![Follow dotCMS on Twitter](/application/themes/dotcms/img/icons/twitter-wh.svg)](https://twitter.com/dotcms)
* [![Subscribe on YouTube](/application/themes/dotcms/img/icons/youtube-wh.svg)](https://www.youtube.com/user/javacms/videos)

Copyright © 2011-2025 dotCMS, LLC All rights reserved.

[Privacy](/company/policies/privacy-policy) |
[GDPR Support](/docs/latest/gdpr-compliance-support) |
Cookie Settings

Ask

X

X



=== Content from github.com_005f499e_20250115_114544.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FdotCMS%2Fcore%2Fblob%2Frelease-21.04%2FdotCMS%2Fsrc%2Fmain%2Fjava%2Fcom%2Fdotcms%2Fintegritycheckers%2FIntegrityUtil.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FdotCMS%2Fcore%2Fblob%2Frelease-21.04%2FdotCMS%2Fsrc%2Fmain%2Fjava%2Fcom%2Fdotcms%2Fintegritycheckers%2FIntegrityUtil.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=dotCMS%2Fcore)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dotCMS](/dotCMS)
/
**[core](/dotCMS/core)**
Public

* [Notifications](/login?return_to=%2FdotCMS%2Fcore) You must be signed in to change notification settings
* [Fork
  467](/login?return_to=%2FdotCMS%2Fcore)
* [Star
   867](/login?return_to=%2FdotCMS%2Fcore)

* [Code](/dotCMS/core/tree/release-21.04)
* [Issues
  951](/dotCMS/core/issues)
* [Pull requests
  33](/dotCMS/core/pulls)
* [Discussions](/dotCMS/core/discussions)
* [Actions](/dotCMS/core/actions)
* [Projects
  1](/dotCMS/core/projects)
* [Security](/dotCMS/core/security)
* [Insights](/dotCMS/core/pulse)

Additional navigation options

* [Code](/dotCMS/core/tree/release-21.04)
* [Issues](/dotCMS/core/issues)
* [Pull requests](/dotCMS/core/pulls)
* [Discussions](/dotCMS/core/discussions)
* [Actions](/dotCMS/core/actions)
* [Projects](/dotCMS/core/projects)
* [Security](/dotCMS/core/security)
* [Insights](/dotCMS/core/pulse)

## Files

 release-21.04
## Breadcrumbs

1. [core](/dotCMS/core/tree/release-21.04)
2. /[dotCMS](/dotCMS/core/tree/release-21.04/dotCMS)
3. /[src](/dotCMS/core/tree/release-21.04/dotCMS/src)
4. /[main](/dotCMS/core/tree/release-21.04/dotCMS/src/main)
5. /[java](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java)
6. /[com](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com)
7. /[dotcms](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com/dotcms)
8. /[integritycheckers](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers)
/
# IntegrityUtil.java

Copy path Blame  Blame
## Latest commit

## History

[History](/dotCMS/core/commits/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers/IntegrityUtil.java)847 lines (744 loc) · 34.6 KB release-21.04
## Breadcrumbs

1. [core](/dotCMS/core/tree/release-21.04)
2. /[dotCMS](/dotCMS/core/tree/release-21.04/dotCMS)
3. /[src](/dotCMS/core/tree/release-21.04/dotCMS/src)
4. /[main](/dotCMS/core/tree/release-21.04/dotCMS/src/main)
5. /[java](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java)
6. /[com](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com)
7. /[dotcms](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com/dotcms)
8. /[integritycheckers](/dotCMS/core/tree/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers)
/
# IntegrityUtil.java

Top
## File metadata and controls

* Code
* Blame

847 lines (744 loc) · 34.6 KB[Raw](https://github.com/dotCMS/core/raw/refs/heads/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers/IntegrityUtil.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847package com.dotcms.integritycheckers;
import com.dotcms.business.WrapInTransaction;import com.dotcms.http.DotExecutionException;import com.dotcms.repackage.com.csvreader.CsvReader;import com.dotcms.repackage.com.csvreader.CsvWriter;import com.dotcms.rest.IntegrityResource;import com.dotmarketing.business.APILocator;import com.dotmarketing.common.db.DotConnect;import com.dotmarketing.db.DbConnectionFactory;import com.dotmarketing.db.FlushCacheRunnable;import com.dotmarketing.db.HibernateUtil;import com.dotmarketing.exception.DotDataException;import com.dotmarketing.exception.DotSecurityException;import com.dotmarketing.util.ConfigUtils;import com.dotmarketing.util.Logger;import com.dotmarketing.util.MaintenanceUtil;import com.dotmarketing.util.UtilMethods;import org.apache.commons.lang3.StringUtils;
import java.io.\*;import java.math.BigDecimal;import java.nio.charset.Charset;import java.nio.file.Files;import java.nio.file.Paths;import java.sql.Connection;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.sql.SQLException;import java.util.ArrayList;import java.util.List;import java.util.Map;import java.util.Optional;import java.util.Properties;import java.util.function.BiConsumer;import java.util.zip.ZipEntry;import java.util.zip.ZipInputStream;import java.util.zip.ZipOutputStream;
/\*\* \* During the push publish process, user structures such as Folders, Content \* Types (f.k.a Structures), Schemes, Legacy Pages, or Content Pages, might \* already exist in a given receiver environment. This will cause the publishing \* process to fail given that the structures seem to be the same, BUT the \* identifier is different compared to each other. \* <p> \* This utility class provides a mechanism to check and resolve situations where \* one or more of those user structures have conflicts. The solution is to \* generate a list of conflicts for the users the check it out, and make a \* decision. If they want to fix the conflicts, the system will make sure the \* user structures have the same Identifier (and sometimes the Inode) in both \* sender and receiver servers. \* </p> \* <p> \* The {@link IntegrityResource} class exposes the main methods of this class as \* REST services. \* </p> \* \* @author Daniel Silva \* @version 1.5 \* @since 06-23-2014 \* \*/public class IntegrityUtil {
 public static final String INTEGRITY\_DATA\_STATUS = "status"; public static final String INTEGRITY\_DATA\_ERROR\_MESSAGE = "error\_message"; public static final String INTEGRITY\_DATA\_TO\_CHECK\_ZIP\_FILENAME = "DataToCheck.zip"; public static final String INTEGRITY\_DATA\_TO\_FIX\_ZIP\_FILENAME = "DataToFix.zip"; public static final String INTEGRITY\_DATA\_STATUS\_FILENAME = "DataStatus.properties"; public static final String REQUESTER\_KEY = "requesterKey"; public static final String INTEGRITY\_DATA\_REQUEST\_ID = "integrityDataRequestId";
 private File generateDataToFixCSV(String outputPath, String endpointId, IntegrityType type) throws DotDataException, IOException { File csvFile; CsvWriter writer = null;
 try { final String outputFile = outputPath + File.separator + type.getDataToFixCSVName(); csvFile = new File(outputFile); writer = new CsvWriter(new FileWriter(csvFile, true), '|');
 final String resultsTable = type.getResultsTableName(); if (!type.hasResultsTable()) { throw new DotDataException("Integrity type =[" + type + "] does not support this method, because results table is not available."); }
 final StringBuilder sbSelectTempTable = new StringBuilder(); switch(type) { case HTMLPAGES: case FILEASSETS: sbSelectTempTable.append("select ").append(type.getFirstDisplayColumnLabel()).append( ", remote\_working\_inode, local\_working\_inode, remote\_live\_inode, local\_live\_inode, remote\_identifier, local\_identifier, language\_id from " ); break; case FOLDERS: sbSelectTempTable.append( "select remote\_inode, local\_inode, remote\_identifier, local\_identifier from " ); break; case CMS\_ROLES: sbSelectTempTable.append( "select name, role\_key, remote\_role\_id, local\_role\_id, local\_role\_fqn, remote\_role\_fqn from " ); break; default: sbSelectTempTable.append("select remote\_inode, local\_inode from "); break; } sbSelectTempTable.append(resultsTable).append(" where endpoint\_id = ?");  final Connection conn = DbConnectionFactory.getConnection(); final PreparedStatement statement = conn.prepareStatement(sbSelectTempTable.toString()); statement.setString(1, endpointId); try (final ResultSet rs = statement.executeQuery()) { int count = 0;
 while (rs.next()) { if (type == IntegrityType.CMS\_ROLES) { writer.write(rs.getString("name")); writer.write(rs.getString("role\_key"));
 writer.write(rs.getString("remote\_role\_id")); writer.write(rs.getString("local\_role\_id")); writer.write(rs.getString("remote\_role\_fqn")); writer.write(rs.getString("local\_role\_fqn"));
 } else if (type == IntegrityType.HTMLPAGES || type == IntegrityType.FILEASSETS) { writer.write(rs.getString("remote\_working\_inode")); writer.write(rs.getString("local\_working\_inode")); writer.write(rs.getString("remote\_live\_inode")); writer.write(rs.getString("local\_live\_inode"));  writer.write(rs.getString("remote\_identifier")); writer.write(rs.getString("local\_identifier"));  writer.write(rs.getString(type.getFirstDisplayColumnLabel())); writer.write(rs.getString("language\_id")); } else { writer.write(rs.getString("remote\_inode")); writer.write(rs.getString("local\_inode")); }
 if (type == IntegrityType.FOLDERS) { writer.write(rs.getString("remote\_identifier")); writer.write(rs.getString("local\_identifier")); }
 writer.endRecord(); count++;
 if (count == 1000) { writer.flush(); count = 0; } } } finally { try { statement.close(); } catch (Exception e) {} } } catch (final SQLException e) { throw new DotDataException(String.format("An error occurred when generating the Data-To-Fix CSV file for " + "type '%s' in Endpoint '%s': %s", type.getLabel(), endpointId, e.getMessage()), e); } finally { if (writer != null) writer.close(); }
 return csvFile; }
 private static void addToZipFile(String fileName, ZipOutputStream zos, String zipEntryName) throws Exception { try { Logger.info(IntegrityUtil.class, "Writing '" + fileName + "' to zip file");
 File file = new File(fileName); try (InputStream fis = Files.newInputStream(file.toPath())) { ZipEntry zipEntry = new ZipEntry(zipEntryName); zos.putNextEntry(zipEntry);
 byte[] bytes = new byte[1024]; int length; while ((length = fis.read(bytes)) >= 0) { zos.write(bytes, 0, length); }
 zos.closeEntry(); } catch (FileNotFoundException f) { Logger.error(IntegrityUtil.class, "Could not find file " + fileName, f); throw new Exception("Could not find file " + fileName, f); } catch (IOException e) { Logger.error(IntegrityUtil.class, "Error writing file to zip: " + fileName, e); throw new Exception("Error writing file to zip: " + fileName, e); } } catch (NullPointerException npe) { Logger.error(IntegrityUtil.class, "File name cannot be NULL", npe); throw new Exception("File name cannot be NULL", npe); } }
 public static void unzipFile(final InputStream zipFile, final String outputDir) throws Exception { final File dir = new File(outputDir);
 // if file doesn't exists, then create it if (!dir.exists()) { dir.mkdir(); }  ZipInputStream zin = null; OutputStream os = null; ZipEntry ze = null; try {
 zin = new ZipInputStream(zipFile); while ((ze = zin.getNextEntry()) != null) {  // for each entry to be extracted int bytesRead; final byte[] buf = new byte[1024];  Logger.info(IntegrityUtil.class, "Unzipping " + ze.getName());
 os = Files.newOutputStream(Paths.get(outputDir + File.separator + ze.getName()));
 while ( (bytesRead = zin.read( buf, 0, 1024 )) > -1 ) os.write( buf, 0, bytesRead ); try { if ( null != os ) { os.close(); } } catch ( Exception e ) { Logger.warn( IntegrityUtil.class, "Error Closing Stream.", e ); } } } catch (final IOException e) { final String errorMsg = String.format("Error while unzipping Integrity Data in file '%s': %s", null != ze ? ze.getName() : "", e.getMessage()); Logger.error(IntegrityUtil.class, errorMsg, e); throw new Exception(errorMsg, e); } finally { // close your streams if ( zin != null ) { try { zin.close(); } catch ( IOException e ) { Logger.warn( IntegrityUtil.class, "Error Closing Stream.", e ); } } if ( os != null ) { try { os.close(); } catch ( IOException e ) { Logger.warn( IntegrityUtil.class, "Error Closing Stream.", e ); } } } }
 /\*\* \* Resolves the integrity data path based on provided endpoint id. \* \* @param endpointId endpoint if \* @return integrity data path as a string \*/ public static String getIntegrityDataPath(final String endpointId) { return ConfigUtils.getIntegrityPath() + File.separator + endpointId; }
 /\*\* \* Generated the integrity data file path based on provided endpointId and the file name. \* File names to be used: DataToCheck.zip, DataToFix.zip and DataStatus.properties. \* \* @param endpointId endpoint gid \* @param dataFile data filename \* @return path to filename \*/ public static String getIntegrityDataFilePath(final String endpointId, final String dataFile) { return getIntegrityDataPath(endpointId) + File.separator + dataFile; }
 /\*\* \* Tells whether a integrity file exists based on provided endpointId and the file name. \* \* @param endpointId endpoint id \* @param dataFile data filename \* @return path to filename \*/ public static boolean doesIntegrityDataFileExist(final String endpointId, final String dataFile) { return new File(getIntegrityDataFilePath(endpointId, dataFile)).exists(); }
 /\*\* \* Gets a {@link IntegrityDataExecutionMetadata} instance based on provided endpoint id which contains metadata of the \* integrity data generation execution. \* \* @param requesterKey endpoint id \* @return Optional wrapping the integrity generation metadata \*/ public static Optional<IntegrityDataExecutionMetadata> getIntegrityMetadata(final String requesterKey) { final File statusFile = new File(getIntegrityDataFilePath(requesterKey, INTEGRITY\_DATA\_STATUS\_FILENAME)); if (!statusFile.exists()) { return Optional.empty(); }
 final Properties statusData = new Properties(); try { statusData.load(new FileInputStream(statusFile)); } catch (IOException e) { Logger.error( IntegrityUtil.class, String.format("Could load status from %s", statusFile.getAbsolutePath()), e); return Optional.empty(); }
 return Optional.of(new IntegrityDataExecutionMetadata( statusData.getProperty(REQUESTER\_KEY), statusData.getProperty(INTEGRITY\_DATA\_REQUEST\_ID), statusData.getProperty(INTEGRITY\_DATA\_STATUS), statusData.getProperty(INTEGRITY\_DATA\_ERROR\_MESSAGE))); }
 /\*\* \* Removes any file leftovers from other integrity checks at the location based on the endpoint id. \* That will be any data check and status files. \* \* @param endpointId endpoint id \*/ public static void cleanUpIntegrityData(String endpointId) { final BiConsumer<String, String> resetConsumer = (id, filename) -> { final File file = new File(getIntegrityDataFilePath(id, filename)); if (file.exists()) { file.delete(); } };
 resetConsumer.accept(endpointId, INTEGRITY\_DATA\_STATUS\_FILENAME); resetConsumer.accept(endpointId, INTEGRITY\_DATA\_TO\_CHECK\_ZIP\_FILENAME); }
 /\*\* \* Saves a integrity data generation metadata in a to-be-discovered location so it can be read by concurrent parts \* that need to know what is the status of the integrity data generation. \* The data is saved as {@link Properties} file. \* \* @param integrityDataExecutionMetadata execution metadata \*/ private static void saveIntegrityDataStatus(IntegrityDataExecutionMetadata integrityDataExecutionMetadata) { final String endpointId = integrityDataExecutionMetadata.getEndpointId(); final File integrityDir = new File(getIntegrityDataPath(endpointId)); if (!integrityDir.exists()) { integrityDir.mkdir(); }
 final File statusFile = new File(getIntegrityDataFilePath(endpointId, INTEGRITY\_DATA\_STATUS\_FILENAME)); /\*if (statusFile.exists()) { statusFile.delete(); }\*/
 final Properties statusData = new Properties(); final BiConsumer<String, String> addData = (data, name) -> { if (StringUtils.isNotBlank(data)) { statusData.setProperty(name, data); } };
 addData.accept(endpointId, REQUESTER\_KEY); addData.accept(integrityDataExecutionMetadata.getRequestId(), INTEGRITY\_DATA\_REQUEST\_ID); statusData.setProperty(INTEGRITY\_DATA\_STATUS, integrityDataExecutionMetadata.getProcessStatus().toString().toUpperCase()); addData.accept(integrityDataExecutionMetadata.getErrorMessage(), INTEGRITY\_DATA\_ERROR\_MESSAGE);
 try (FileOutputStream output = new FileOutputStream(statusFile)) { statusData.store(output, null); } catch (IOException e) { throw new DotExecutionException( String.format("Could not save status to %s", statusFile.getAbsolutePath()), e); } }
 /\*\* \* Saves a integrity data generation metadata in a to-be-discovered location so it can be read by concurrent parts \* that need to know what is the status of the integrity data generation. \* Individual parameters are used to create a {@link IntegrityDataExecutionMetadata}. \* \* @param endpointId endpoint id \* @param requestId request id \* @param processStatus {@link IntegrityResource.ProcessStatus} instance to reflect the current status \* @param errorMessage error message associated to detected error \*/ public static void saveIntegrityDataStatus(final String endpointId, final String requestId, final IntegrityResource.ProcessStatus processStatus, final String errorMessage) { saveIntegrityDataStatus(new IntegrityDataExecutionMetadata(endpointId, requestId, processStatus, errorMessage)); }
 /\*\* \* Saves a integrity data generation metadata in a to-be-discovered location so it can be read by concurrent parts \* that need to know what is the status of the integrity data generation. \* Individual parameters are used to create a {@link IntegrityDataExecutionMetadata}. \* \* @param endpointId endpoint id \* @param requestId request id \* @param processStatus {@link IntegrityResource.ProcessStatus} instance to reflect the current status \*/ public static void saveIntegrityDataStatus(final String endpointId, final String requestId, final IntegrityResource.ProcessStatus processStatus) { saveIntegrityDataStatus(endpointId, requestId, processStatus, null); }
 /\*\* \* Creates all the CSV from End Point database table and store them inside \* zip file. \* \* @param endpointId \* @throws Exception \*/ public static void generateDataToCheckZip(final String endpointId) { if (!UtilMethods.isSet(endpointId)) { Logger.error(IntegrityUtil.class, "Endpoint was not provided"); return; }
 Logger.info( IntegrityUtil.class, String.format("Starting integrity data generation job for endpoint %s", endpointId));
 File zipFile = null; try { final String outputPath = getIntegrityDataPath(endpointId); final File dir = new File(outputPath); // if file doesn't exist, create it if (!dir.exists()) { dir.mkdir(); }
 zipFile = new File(getIntegrityDataFilePath(endpointId, INTEGRITY\_DATA\_TO\_CHECK\_ZIP\_FILENAME)); try(OutputStream outputStream = Files.newOutputStream(zipFile.toPath()); ZipOutputStream zipOutputStream = new ZipOutputStream(outputStream)) { final IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { File fileToCheckCsvFile = null;
 try { fileToCheckCsvFile = integrityType.getIntegrityChecker().generateCSVFile(outputPath); addToZipFile(fileToCheckCsvFile.getAbsolutePath(), zipOutputStream, integrityType.getDataToCheckCSVName()); } finally { if (fileToCheckCsvFile != null && fileToCheckCsvFile.exists()) { fileToCheckCsvFile.delete(); } } } } } catch (Exception e) { if (zipFile != null && zipFile.exists()) { zipFile.delete(); }
 throw new DotExecutionException(e); } }
 public void generateDataToFixZip(final String endpointId, final IntegrityType type) { if (!UtilMethods.isSet(endpointId)) { return; }
 File dataToFixCsvFile = null; File zipFile = null; try { final String outputPath = getIntegrityDataPath(endpointId); final File dir = new File(outputPath); // if file doesn't exist, create it if (!dir.exists()) { dir.mkdir(); }
 zipFile = new File(getIntegrityDataFilePath(endpointId, INTEGRITY\_DATA\_TO\_FIX\_ZIP\_FILENAME)); try (OutputStream outputStream = Files.newOutputStream(zipFile.toPath()); ZipOutputStream zipOutputStream = new ZipOutputStream(outputStream)) { // create Folders CSV dataToFixCsvFile = generateDataToFixCSV(outputPath, endpointId, type);
 addToZipFile(dataToFixCsvFile.getAbsolutePath(), zipOutputStream, type.getDataToFixCSVName()); } } catch (Exception e) { Logger.error(getClass(), "Error generating fix for remote", e); if (zipFile != null && zipFile.exists()) zipFile.delete(); } finally { if (dataToFixCsvFile != null && dataToFixCsvFile.exists()) dataToFixCsvFile.delete(); } }
 public static void dropTempTables(final String endpointId) throws DotDataException { DotConnect dc = new DotConnect(); try { IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { for(String tempTableName : integrityType.getIntegrityChecker().getTempTableNames(endpointId)) { if (doesTableExist(tempTableName)) { dc.executeStatement("truncate table " + tempTableName); dc.executeStatement("drop table " + tempTableName); }else if (DbConnectionFactory.isMySql()){ dc.executeStatement("drop table if exists " + tempTableName); } else if (DbConnectionFactory.isMsSql()){ dc.executeStatement("IF OBJECT\_ID('tempdb.dbo." + tempTableName + "', 'U') IS NOT NULL" + " DROP TABLE " + tempTableName); } } } } catch (SQLException e) { Logger.error(IntegrityResource.class, "Error dropping Temp tables"); throw new DotDataException("Error dropping Temp tables", e); } }
 public List<Map<String, Object>> getIntegrityConflicts(String endpointId, IntegrityType type) throws Exception { try { DotConnect dc = new DotConnect();
 final String resultsTableName = type.getResultsTableName(); if (!type.hasResultsTable() || !doesTableExist(resultsTableName)) { return new ArrayList<Map<String, Object>>(); }
 dc.setSQL("select \* from " + resultsTableName + " where endpoint\_id = ? ORDER BY " + type.getFirstDisplayColumnLabel()); dc.addParam(endpointId);
 return dc.loadObjectResults();
 } catch (Exception e) { throw new Exception("Error running the " + type.name() + " Integrity Check", e); } }
 /\*\* \* Un-zips the file containing the information of the specified type. The \* data of the records that will be fixed in the destination end point will \* be stored in a results table, which is unique for every type of integrity \* fix. \*  \* @param dataToFix \* - The {@link InputStream} containing the data to fix. \* @param key \* - The ID of the end point where the data will be fixed. \* @param type \* - The type of object (Content Page, Folder, Content Type, \* etc.) that will be fixed. \* @throws Exception \* An error occurred during the integrity fix process. The \* results table must be wiped out. \*/ @WrapInTransaction public void fixConflicts(InputStream dataToFix, String key, IntegrityType type) throws Exception { final String outputDir = ConfigUtils.getIntegrityPath() + File.separator + key;
 // lets first unzip the given file unzipFile(dataToFix, outputDir);
 // lets generate the tables with the data to be fixed generateDataToFixTable(key, type); fixConflicts(key, type);
 HibernateUtil.addCommitListener(new FlushCacheRunnable() { @Override public void run() {
 IntegrityUtil.this.flushAllCache(); } });
 }
 /\*\* \* Flush all caches \* @throws DotDataException \*/ public void flushAllCache() {
 try { MaintenanceUtil.flushCache(); APILocator.getPermissionAPI().resetAllPermissionReferences(); } catch (Exception e) { Logger.error(this, e.getMessage(), e); } }
 /\*\* \* Takes the information from the .ZIP file and stores it in the results \* table so that the process to fix records begins. Every type of object \* (Content Page, Folder, Content Type, etc.) has its own results table \* which indicates what records <b>MUST</b> be changed in the specified end \* point. \*  \* @param key \* - The ID of the end point where the data will be fixed. \* @param type \* - The type of object (Content Page, Folder, Content Type, \* etc.) that will be fixed. \* @throws Exception \* An error occurred during the integrity fix process. \*/ public void generateDataToFixTable(String key, IntegrityType type) throws Exception {
 try { final CsvReader csvFile = new CsvReader(ConfigUtils.getIntegrityPath() + File.separator + key + File.separator + type.getDataToFixCSVName(), '|', Charset.forName("UTF-8"));
 final String resultsTable = type.getResultsTableName(); if (!type.hasResultsTable()) { throw new DotDataException("Integrity type =[" + type + "] does not support this method, because results table is not available."); }
 // Create insert query for temporary table final StringBuilder sbInsertTempTable = new StringBuilder("insert into ").append(resultsTable); switch(type) { case HTMLPAGES: case FILEASSETS: sbInsertTempTable.append( " (local\_working\_inode, remote\_working\_inode, local\_live\_inode, remote\_live\_inode, local\_identifier, remote\_identifier, " ).append(type.getFirstDisplayColumnLabel()).append(", endpoint\_id, language\_id) values(?,?,?,?,?,?,?,?,?)"); break; case FOLDERS: sbInsertTempTable.append(" (local\_inode, remote\_inode, local\_identifier, remote\_identifier, endpoint\_id) values(?,?,?,?,?)"); break; case CMS\_ROLES: sbInsertTempTable.append(" (name, role\_key, local\_role\_id, remote\_role\_id, local\_role\_fqn, remote\_role\_fqn, endpoint\_id) values(?,?,?,?,?,?,?)"); break; default: sbInsertTempTable.append(" (local\_inode, remote\_inode, endpoint\_id) values(?,?,?)"); break; } final String INSERT\_TEMP\_TABLE = sbInsertTempTable.toString();
 DotConnect dc = new DotConnect(); while (csvFile.readRecord()) { // TODO: FIX THE INDEXES FOR // HTMLPAGES dc.setSQL(INSERT\_TEMP\_TABLE);
 if (type == IntegrityType.CMS\_ROLES) { dc.addParam(csvFile.get(0)); // name dc.addParam(csvFile.get(1)); // role\_key dc.addParam(csvFile.get(2)); // local\_role\_id dc.addParam(csvFile.get(3)); // remote\_role\_id dc.addParam(csvFile.get(4)); // local\_role\_fqn dc.addParam(csvFile.get(5)); // remote\_role\_fqn } else { dc.addParam(csvFile.get(0)); // localWorkingInode dc.addParam(csvFile.get(1)); // remoteWorkingInode
 if (type == IntegrityType.HTMLPAGES || type == IntegrityType.FILEASSETS) { dc.addParam(csvFile.get(2)); // localLiveInode dc.addParam(csvFile.get(3)); // remoteLiveInode dc.addParam(csvFile.get(4)); // localIdentifier dc.addParam(csvFile.get(5)); // remoteIdentifier dc.addParam(csvFile.get(6)); // contentletAssetName } else if (type == IntegrityType.FOLDERS) { dc.addParam(csvFile.get(2)); // localIdentifier dc.addParam(csvFile.get(3)); // remoteIdentifier } }
 dc.addParam(key);
 if (type == IntegrityType.HTMLPAGES || type == IntegrityType.FILEASSETS) { dc.addParam(new Long(csvFile.get(7))); // languageId }
 dc.loadResult(); }
 } catch (final Exception e) { throw new Exception(String.format("An error occurred when generating data to fix for type '%s' in " + "Endpoint '%s': %s", type.getLabel(), key, e.getMessage()), e); } }
 public boolean doesIntegrityConflictsDataExist(String endpointId) throws Exception { boolean conflictsDataExist = false;
 IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { if (integrityType.getIntegrityChecker().doesIntegrityConflictsDataExist(endpointId)) { conflictsDataExist = true; break; } }
 return conflictsDataExist; }
 private static boolean doesTableExist(String tableName) throws DotDataException { DotConnect dc = new DotConnect();
 if (DbConnectionFactory.isOracle()) { dc.setSQL("SELECT COUNT(\*) as exist FROM user\_tables WHERE table\_name='" + tableName.toUpperCase() + "'"); BigDecimal existTable = (BigDecimal) dc.loadObjectResults().get(0).get("exist"); return existTable.longValue() > 0; } else if (DbConnectionFactory.isPostgres() || DbConnectionFactory.isMySql()) { dc.setSQL("SELECT COUNT(table\_name) as exist FROM information\_schema.tables WHERE Table\_Name = '" + tableName + "' "); long existTable = (Long) dc.loadObjectResults().get(0).get("exist"); return existTable > 0; } else if (DbConnectionFactory.isMsSql()) { dc.setSQL("SELECT COUNT(\*) as exist FROM sysobjects WHERE name = '" + tableName + "'"); int existTable = (Integer) dc.loadObjectResults().get(0).get("exist"); return existTable > 0; } else if (DbConnectionFactory.isH2()) { dc.setSQL("SELECT COUNT(1) as exist FROM information\_schema.tables WHERE Table\_Name = '" + tableName.toUpperCase() + "' "); long existTable = (Long) dc.loadObjectResults().get(0).get("exist"); return existTable > 0; }
 return false; }
 /\*\* \* Executes the integrity fix process according to the specified type. \*  \* @param key \* - The ID of the end point where the data will be fixed. \* @param type \* - The type of object (Content Page, Folder, Content Type, \* etc.) that will be fixed. \* @throws DotDataException \* An error occurred when interacting with the database. \* @throws DotSecurityException \* The specified user does not have permissions to perform the \* action. \*/ @WrapInTransaction public void fixConflicts(final String key, IntegrityType type) throws DotDataException, DotSecurityException { type.getIntegrityChecker().executeFix(key); }
 /\*\* \* Discard conflicts from a integrity type in a specific endpoint. \*  \* @param endpointId \* @param type \* indicates the integrity type \* @throws DotDataException \*/ public void discardConflicts(final String endpointId, IntegrityType type) throws DotDataException { type.getIntegrityChecker().discardConflicts(endpointId); }
 /\*\* \* Discard conflicts from each integrity type in {@link IntegrityType} enum \* by passing a specific endpoint. \*  \* @param endpointId \* @throws DotDataException \* @throws Exception \*/ @WrapInTransaction public static void completeDiscardConflicts(final String endpointId) throws DotDataException {
 IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { integrityType.getIntegrityChecker().discardConflicts(endpointId); } }
 /\*\* \* Check integrity from each integrity type in {@link IntegrityType} enum by \* passing a specific endpoint. Also, it generates and fill the results \* table to view results \*  \* @param endpointId \* @return is there is at least one conflict returns true, otherwise false \* @throws Exception \*/ @WrapInTransaction public static boolean completeCheckIntegrity(final String endpointId) throws Exception { boolean existConflicts = false;
 IntegrityType[] types = IntegrityType.values(); for (IntegrityType integrityType : types) { existConflicts |= integrityType.getIntegrityChecker() .generateIntegrityResults(endpointId); }
 return existConflicts; }
 /\*\* \* Integrity data generation metadata bean to be saved. \*/ public static class IntegrityDataExecutionMetadata implements Serializable {
 private final String endpointId; private final String requestId; private final IntegrityResource.ProcessStatus processStatus; private final String errorMessage;
 public IntegrityDataExecutionMetadata(String endpointId, String requestId, IntegrityResource.ProcessStatus processStatus, String errorMessage) { this.endpointId = endpointId; this.requestId = requestId; this.processStatus = processStatus; this.errorMessage = errorMessage; }
 public IntegrityDataExecutionMetadata(String endpointId, String requestId, String status, String errorMessage) { this(endpointId, requestId, IntegrityResource.ProcessStatus.valueOf(status.toUpperCase()), errorMessage); }
 public String getEndpointId() { return endpointId; }
 public String getRequestId() { return requestId; }
 public IntegrityResource.ProcessStatus getProcessStatus() { return processStatus; }
 public String getErrorMessage() { return errorMessage; }
 }
}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.dotcms.com_1ddf5d62_20250114_192856.html ===

[![dotCMS Universal CMS](/dA/c746682d-495e/dotcms.svg)](/)

Search
[Hybrid CMSRequest a Demo](https://www.dotcms.com/demo-req)

### [Issues](/security/known-issues.dot) » Directory Traversal with RCE

| Issue: | SI-67 |
| --- | --- |
| Date: | Dec 15, 2022, 11:15:00 AM |
| Severity: | Medium |
| Requires Admin Access: | Yes |
| Fix Version: | 22.12+, LTS 21.06.12+, LTS 22.03.4+ |
| Credit: | Christos - Minas Mathas |
| Description: | An authenticated directory traversal vulnerability in dotCMS API can lead to RCE. A zip file at the "*/api/integrity/\_fixconflictsfromremote*" endpoint is accepted and extracted without performing path traversal check. This can be exploited by sending a specially crafted zip file which contains directory traversal characters in the file content names (/../../xyz.sh). This allows for the contents to be extracted at an arbitrary path inside the system.  This vulnerability requires Admin privileges to exploit. |
| Mitigation: | * Upgrade to one of the versions of dotCMS listed above:   + 22.12   + LTS 21.06.12   + LTS 22.03.4 * Use a WAF to prevent POSTs to the */api/integrity/\_fixconflictsfromremote* |
| References | * <https://security.snyk.io/research/zip-slip-vulnerability> * <https://www.dotcms.com/docs/latest/xss-prevention> * CVE-2022-45783 * The rest api endpoint method calls the method fixConflicts:   <https://github.com/dotCMS/core/blob/release-21.04/dotCMS/src/main/java/com/dotcms/rest/IntegrityResource.java#L835> * The fixConflicts method calls the unzipFile method:   <https://github.com/dotCMS/core/blob/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers/IntegrityUtil.java#L567> * The unzipFile method unzips the file without the proper checks in place:   <https://github.com/dotCMS/core/blob/release-21.04/dotCMS/src/main/java/com/dotcms/integritycheckers/IntegrityUtil.java#L205> |

## Highly Rated and Recommended

We're rated Excellent **4.2/5 stars** on G2 - with 95+ verified reviews

[![dotCMS is a leader in Enterprise Digital Experience Platforms (DXP) on G2](https://images.g2crowd.com/uploads/report_medal/image/1005150/medal.svg)](https://www.g2.com/products/dotcms/reviews?utm_source=rewards-badge "dotCMS is a leader in Enterprise Digital Experience Platforms (DXP) on G2")
[![dotCMS is a leader in Enterprise Digital Experience Platforms (DXP) on G2](https://images.g2crowd.com/uploads/report_medal/image/1005138/medal.svg)](https://www.g2.com/products/dotcms/reviews?utm_source=rewards-badge "dotCMS is a leader in Enterprise Digital Experience Platforms (DXP) on G2")
[![dotCMS is a leader in Mid-Market Digital Experience Platforms (DXP) on G2](https://images.g2crowd.com/uploads/report_medal/image/1005189/medal.svg)](https://www.g2.com/products/dotcms/reviews?utm_source=rewards-badge "dotCMS is a leader in Mid-Market Digital Experience Platforms (DXP) on G2")
[![dotCMS is a leader in Digital Experience Platforms (DXP) on G2](https://images.g2crowd.com/uploads/report_medal/image/1005135/medal.svg)](https://www.g2.com/products/dotcms/reviews?utm_source=rewards-badge "dotCMS is a leader in Digital Experience Platforms (DXP) on G2")
[![dotCMS is a leader in Mid-Market Digital Experience Platforms (DXP) on G2](https://images.g2crowd.com/uploads/report_medal/image/1005193/medal.svg)](https://www.g2.com/products/dotcms/reviews?utm_source=rewards-badge "dotCMS is a leader in Mid-Market Digital Experience Platforms (DXP) on G2")
[![dotCMS is a leader in Mid-Market Digital Experience Platforms (DXP) on G2](https://images.g2crowd.com/uploads/report_medal/image/1005153/medal.svg)](https://www.g2.com/products/dotcms/reviews?utm_source=rewards-badge "dotCMS is a leader in Mid-Market Digital Experience Platforms (DXP) on G2")
[![dotCMS is a leader in Small-Business Web Content Management on G2](https://images.g2crowd.com/uploads/report_medal/image/1005168/medal.svg)](https://www.g2.com/products/dotcms/reviews?utm_source=rewards-badge "dotCMS is a leader in Small-Business Web Content Management on G2")

## dotCMS Content Management System

dotCMS is designed to deliver content-driven applications at scale. Whether you're building a network of global websites, an employee intranet, customer portal, or single page web application, dotCMS helps you manage content, images, and assets in one centralized location and deliver them to any channel.

## Product

* [dotCMS Cloud](/product/dotcms-cloud)
* [Pricing](/pricing/)
* [Request a Demo](/demo/demo-request)
* [Feature List](/product/features/feature-list)

## Solutions

* [Content Management](/product/features/content-management-system)
* [Headless/APIs](/solutions/headless-cms)
* [Asset Management](/solutions/digital-asset-management)
* [Agile E-Commerce](/solutions/ecommerce-cms)
* [Intranets & Extranets](/solutions/intranet-portal)

## Resources

* [Documentation](/docs/latest/table-of-contents)
* [Community](/forum/)
* [Videos](/videos/)
* [Partners](/partners/)
* [Trust Report](https://security.dotcms.com/)

## Company

* [Events](/company/events/)
* [Careers](/company/careers/)
* [News Room](/company/news/)
* [Contact Us](/contact-us/)

[![SOC2 Type 2](/dA/4eec53370adb68c9e34530a35dffc097/SOC-NonCPAA.png)](https://security.dotcms.com/)
[![ISO 27001](/dA/625f37715a06333caa2ebe8f0ab8dee8/f0277c7b-0a4f-40b5-820c-87aa131de803/iso_27001_02.png)](https://security.dotcms.com/)

* [![Connect with dotCMS on Facebook](/application/themes/dotcms/img/icons/facebook-wh.svg)](https://www.facebook.com/dotCMS/)
* [![Connect with dotCMS on LinkedIn](/application/themes/dotcms/img/icons/linkedin-wh.svg)](https://www.linkedin.com/company/dotcms/)
* [![Follow dotCMS on Twitter](/application/themes/dotcms/img/icons/twitter-wh.svg)](https://twitter.com/dotcms)
* [![Subscribe on YouTube](/application/themes/dotcms/img/icons/youtube-wh.svg)](https://www.youtube.com/user/javacms/videos)

Copyright © 2011-2025 dotCMS, LLC All rights reserved.

[Privacy](/company/policies/privacy) |
[Accessibility Statement](/accessibility-statement) |
[GDPR Support](/docs/latest/gdpr-compliance-support) |
Cookie Settings

Ask AI

Search:
All Sources
Documentation

Type:
AI Chat
Keyword

Question ideas
What are the key features?
Is multilingual content supported?
What support and documentation is provide?
What training options are available?
What is the pricing model?

Question ideas
How do you install dotCMS?
What frameworks are support?
What are the hosting requirement?
What APIs are available?
Is there a command line interface?

X

X


