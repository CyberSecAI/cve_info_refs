=== Content from cert-portal.siemens.com_2476823d_20250115_080106.html ===
Siemens Security Advisory by Siemens ProductCERT

SSA-333517: Multiple Vulnerabilities in SCALANCE SC-600 Family
before V3.0

Publication Date:
Last Update:
Current Version:
CVSS v3.1 Base Score: 7.8

2022-12-13
2022-12-13
V1.0

SUMMARY

Multiple vulnerabilities affecting various third-party components of the SCALANCE SC-600 family could
allow an attacker to cause a denial of service condition, corrupt memory or potentially execute custom
code.

Siemens has released updates for the affected products and recommends to update to the latest versions.

AFFECTED PRODUCTS AND SOLUTION

Affected Product and Versions

Remediation

SC622-2C (6GK5622-2GS00-

SCALANCE
2AC2):
All versions < V3.0

Update to V3.0 or later version
https://support.industry.siemens.com/cs/ww/en/
view/109814276/

SC626-2C (6GK5626-2GS00-

SCALANCE
2AC2):
All versions < V3.0

Update to V3.0 or later version
https://support.industry.siemens.com/cs/ww/en/
view/109814276/

SC632-2C (6GK5632-2GS00-

SCALANCE
2AC2):
All versions < V3.0

Update to V3.0 or later version
https://support.industry.siemens.com/cs/ww/en/
view/109814276/

SC636-2C (6GK5636-2GS00-

SCALANCE
2AC2):
All versions < V3.0

Update to V3.0 or later version
https://support.industry.siemens.com/cs/ww/en/
view/109814276/

SC642-2C (6GK5642-2GS00-

SCALANCE
2AC2):
All versions < V3.0

Update to V3.0 or later version
https://support.industry.siemens.com/cs/ww/en/
view/109814276/

SC646-2C (6GK5646-2GS00-

SCALANCE
2AC2):
All versions < V3.0

Update to V3.0 or later version
https://support.industry.siemens.com/cs/ww/en/
view/109814276/

WORKAROUNDS AND MITIGATIONS

Product-speciﬁc remediations or mitigations can be found in the section Affected Products and Solution.
Please follow the General Security Recommendations.

SSA-333517

© Siemens 2022

Page 1 of 3

Siemens Security Advisory by Siemens ProductCERT

GENERAL SECURITY RECOMMENDATIONS

As a general security measure, Siemens strongly recommends to protect network access to devices
with appropriate mechanisms. In order to operate the devices in a protected IT environment, Siemens
recommends to conﬁgure the environment according to Siemens’ operational guidelines for Industrial
Security (Download: https://www.siemens.com/cert/operational-guidelines-industrial-security), and to
follow the recommendations in the product manuals.

Additional information on Industrial Security by Siemens can be found at: https://www.siemens.com/
industrialsecurity

PRODUCT DESCRIPTION

SCALANCE SC-600 devices (SC622-2C, SC626-2C, SC632-2C, SC636-2C, SC642-2C, SC646-2C) are
used to protect trusted industrial networks from untrusted networks. They allow ﬁltering incoming and
outgoing network connections in different ways.

VULNERABILITY CLASSIFICATION

The vulnerability classiﬁcation has been performed by using the CVSS scoring system in version 3.1
(CVSS v3.1) (https://www.ﬁrst.org/cvss/). The CVSS environmental score is speciﬁc to the customer’s
environment and will impact the overall CVSS score. The environmental score should therefore be
individually deﬁned by the customer to accomplish ﬁnal scoring.

An additional classiﬁcation has been performed using the CWE classiﬁcation, a community-developed list
of common software security weaknesses. This serves as a common language and as a baseline for
weakness identiﬁcation, mitigation, and prevention efforts. A detailed list of CWE classes can be found at:
https://cwe.mitre.org/.

Vulnerability CVE-2018-25032

zlib before 1.2.12 allows memory corruption when deﬂating (i.e., when compressing) if the input has
many distant matches.

CVSS v3.1 Base Score
CVSS Vector
CWE

7.5
CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H/E:P/RL:O/RC:C
CWE-787: Out-of-bounds Write

Vulnerability CVE-2022-30065

A use-after-free in Busybox 1.35-x’s awk applet leads to denial of service and possibly code execution
when processing a crafted awk pattern in the copyvar function.

CVSS v3.1 Base Score
CVSS Vector
CWE

7.8
CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H/E:P/RL:O/RC:C
CWE-416: Use After Free

SSA-333517

© Siemens 2022

Page 2 of 3

Siemens Security Advisory by Siemens ProductCERT

Vulnerability CVE-2022-32205

A malicious server can serve excessive amounts of “Set-Cookie:” headers in a HTTP response to curl
and curl < 7.84.0 stores all of them. A sufﬁciently large amount of (big) cookies make subsequent
HTTP requests to this, or other servers to which the cookies match, create requests that become
larger than the threshold that curl uses internally to avoid sending crazy large requests (1048576
bytes) and instead returns an error.This denial state might remain for as long as the same cookies
are kept, match and haven’t expired. Due to cookie matching rules, a server on “foo.example.com”
can set cookies that also would match for “bar.example.com”, making it it possible for a “sister server”
to effectively cause a denial of service for a sibling site on the same second level domain using this
method.

CVSS v3.1 Base Score
CVSS Vector
CWE

4.3
CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:L/E:P/RL:O/RC:C
CWE-770: Allocation of Resources Without Limits or Throttling

Vulnerability CVE-2022-32206

curl < 7.84.0 supports “chained” HTTP compression algorithms, meaning that a serverresponse can
be compressed multiple times and potentially with different algorithms. The number of acceptable
“links” in this “decompression chain” was unbounded, allowing a malicious server to insert a virtually
unlimited number of compression steps.The use of such a decompression chain could result in a
“malloc bomb”, makingcurl end up spending enormous amounts of allocated heap memory, or trying
toand returning out of memory errors.

CVSS v3.1 Base Score
CVSS Vector
CWE

6.5
CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:H/E:P/RL:O/RC:C
CWE-770: Allocation of Resources Without Limits or Throttling

ADDITIONAL INFORMATION

For further inquiries on security vulnerabilities in Siemens products and solutions, please contact the
Siemens ProductCERT:

https://www.siemens.com/cert/advisories

HISTORY DATA

V1.0 (2022-12-13):

Publication Date

TERMS OF USE

Siemens Security Advisories are subject to the terms and conditions contained in Siemens’ underlying
license terms or other applicable agreements previously agreed to with Siemens (hereinafter "License
Terms"). To the extent applicable to information, software or documentation made available in or through
a Siemens Security Advisory, the Terms of Use of Siemens’ Global Website (https://www.siemens.com/
terms_of_use, hereinafter "Terms of Use"), in particular Sections 8-10 of the Terms of Use, shall apply
additionally. In case of conﬂicts, the License Terms shall prevail over the Terms of Use.

SSA-333517

© Siemens 2022

Page 3 of 3



=== Content from bugs.busybox.net_1675399a_20250115_080105.html ===


Bugzilla – Bug 14781
A use-after-free in Busybox's awk applet leads to denial of service and possibly code execution when processing a crafted awk pattern in the copyvar function
Last modified: 2022-07-29 02:24:00 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](docs/en/html/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=14781&GoAheadAndLogIn=1)

  Remember

  [x]
* |
  [Forgot Password](show_bug.cgi?id=14781&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 14781**](show_bug.cgi?id=14781)
- A use-after-free in Busybox's awk applet leads to denial of service and possibly code execution when processing a crafted awk pattern in the copyvar function

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
A use-after-free in Busybox's awk applet leads to denial of service and possi...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Busybox | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Busybox "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Standard Compliance ([show other bugs](buglist.cgi?component=Standard%20Compliance&product=Busybox&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 1.35.x | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | P5 major | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | unassigned | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2022-04-27 06:31 UTC by Taolaw | | --- | --- | | Modified: | 2022-07-29 02:24 UTC ([History](show_activity.cgi?id=14781)) | | CC List: | 4 users (show)  busybox-cvs guenther.wannenmacher mark.esler steve.beattie | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Host:](page.cgi?id=fields.html#cf_host "The system where the compiled code runs. e.g. you compiled busybox on your desktop to run on an ARM host -- ARM is the host.") |  | | [Target:](page.cgi?id=fields.html#cf_target "Used when building cross-compilers. This is the system your cross-compiler for which code is generated.") |  | | [Build:](page.cgi?id=fields.html#cf_build "The system where you compile. e.g. you compiled busybox on your x86 desktop.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**poc**](attachment.cgi?id=9301 "View the content of the attachment") (24 bytes, application/octet-stream)  [2022-04-27 06:31 UTC](#attach_9301 "Go to the comment associated with the attachment"), Taolaw | [Details](attachment.cgi?id=9301&action=edit) | | [Add an attachment](attachment.cgi?bugid=14781&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=14781&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=14781#c0)  Taolaw    2022-04-27 06:31:51 UTC  ``` Created [attachment 9301](attachment.cgi?id=9301 "poc") [[details]](attachment.cgi?id=9301&action=edit "poc") poc  Discoverer: Taolaw@Vlab of Vecentek  command: ./busybox_unstripped awk -f crash2 1.txt  ================================================================= ==716531==ERROR: AddressSanitizer: heap-use-after-free on address 0x606000001d60 at pc 0x55df2f6b595d bp 0x7fffc8cf08a0 sp 0x7fffc8cf0890 READ of size 4 at 0x606000001d60 thread T0     #0 0x55df2f6b595c in copyvar editors/awk.c:1051  0x606000001d60 is located 0 bytes inside of 64-byte region [0x606000001d60,0x606000001da0) freed by thread T0 here:     #0 0x7f7b1aeec40f in __interceptor_free ../../../../src/libsanitizer/asan/asan_malloc_linux.cc:122     #1 0x55df2f6bf305 in nvfree editors/awk.c:1840     #2 0x55df2f95bdff  (/home/test/fuzz/busybox-ASAN/busybox_unstripped+0x1044dff)  previously allocated by thread T0 here:     #0 0x7f7b1aeec808 in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cc:144     #1 0x55df2f1b24a5 in xmalloc libbb/xfuncs_printf.c:50     #2 0x55df2f95bdff  (/home/test/fuzz/busybox-ASAN/busybox_unstripped+0x1044dff)  SUMMARY: AddressSanitizer: heap-use-after-free editors/awk.c:1051 in copyvar Shadow bytes around the buggy address:   0x0c0c7fff8350: fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff8360: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa   0x0c0c7fff8370: fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd   0x0c0c7fff8380: fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff8390: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa =>0x0c0c7fff83a0: fd fd fd fd fd fd fd fd fa fa fa fa[fd]fd fd fd   0x0c0c7fff83b0: fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff83c0: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa   0x0c0c7fff83d0: fd fd fd fd fd fd fd fd fa fa fa fa fd fd fd fd   0x0c0c7fff83e0: fd fd fd fd fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff83f0: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==716531==ABORTING ```  [Comment 1](show_bug.cgi?id=14781#c1)  Steve Beattie    2022-05-20 05:31:58 UTC  ``` This issue was assigned CVE-2022-30065 (<https://nvd.nist.gov/vuln/detail/CVE-2022-30065>). ```  [Comment 2](show_bug.cgi?id=14781#c2)  Natanael Copa    2022-06-07 18:32:17 UTC  ``` I'm trying to reproduce this here. What is the content of `1.txt`? ```  [Comment 3](show_bug.cgi?id=14781#c3)  Natanael Copa    2022-06-07 18:40:38 UTC  ``` It does not crash here but valgrind detects it and various other use after free:  $ echo foo | valgrind ./busybox_unstripped awk '$3i$3in$9=$r||$9=i6/6-9f' ==3430== Memcheck, a memory error detector ==3430== Copyright (C) 2002-2022, and GNU GPL'd, by Julian Seward et al. ==3430== Using Valgrind-3.19.0 and LibVEX; rerun with -h for copyright info ==3430== Command: ./busybox_unstripped awk $3i$3in$9=$r||$9=i6/6-9f ==3430==  ==3430== Invalid read of size 4 ==3430==    at 0x195B74: copyvar (awk.c:1064) ==3430==    by 0x196ED1: evaluate (awk.c:3141) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b7510 is 0 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x19698C: evaluate (awk.c:2923) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x19698C: evaluate (awk.c:2923) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid read of size 8 ==3430==    at 0x195B76: copyvar (awk.c:1066) ==3430==    by 0x196ED1: evaluate (awk.c:3141) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b7520 is 16 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x19698C: evaluate (awk.c:2923) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x19698C: evaluate (awk.c:2923) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid read of size 8 ==3430==    at 0x195B7B: copyvar (awk.c:1067) ==3430==    by 0x196ED1: evaluate (awk.c:3141) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b7518 is 8 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x19698C: evaluate (awk.c:2923) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x19698C: evaluate (awk.c:2923) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid read of size 4 ==3430==    at 0x1947E6: getvar_i (awk.c:1023) ==3430==    by 0x194869: is_numeric (awk.c:1082) ==3430==    by 0x194869: istrue (awk.c:1089) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b6c10 is 0 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid write of size 8 ==3430==    at 0x1947EF: getvar_i (awk.c:1024) ==3430==    by 0x194869: is_numeric (awk.c:1082) ==3430==    by 0x194869: istrue (awk.c:1089) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b6c20 is 16 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid read of size 8 ==3430==    at 0x1947F7: getvar_i (awk.c:1025) ==3430==    by 0x194869: is_numeric (awk.c:1082) ==3430==    by 0x194869: istrue (awk.c:1089) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b6c18 is 8 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid write of size 4 ==3430==    at 0x194839: getvar_i (awk.c:1039) ==3430==    by 0x194869: is_numeric (awk.c:1082) ==3430==    by 0x194869: istrue (awk.c:1089) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b6c10 is 0 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid read of size 4 ==3430==    at 0x19483B: getvar_i (awk.c:1041) ==3430==    by 0x194869: is_numeric (awk.c:1082) ==3430==    by 0x194869: istrue (awk.c:1089) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b6c10 is 0 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid read of size 8 ==3430==    at 0x194841: getvar_i (awk.c:1044) ==3430==    by 0x194869: is_numeric (awk.c:1082) ==3430==    by 0x194869: istrue (awk.c:1089) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b6c20 is 16 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid read of size 4 ==3430==    at 0x19486A: is_numeric (awk.c:1083) ==3430==    by 0x19486A: istrue (awk.c:1089) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b6c10 is 0 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430== Invalid read of size 8 ==3430==    at 0x19488D: istrue (awk.c:1091) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Address 0x48b6c18 is 8 bytes inside a block of size 64 free'd ==3430==    at 0x48A4B0D: free (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x1974EA: evaluate (awk.c:3537) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  Block was alloc'd at ==3430==    at 0x48A26D5: malloc (in /usr/libexec/valgrind/vgpreload_memcheck-amd64-linux.so) ==3430==    by 0x117287: xmalloc (xfuncs_printf.c:50) ==3430==    by 0x1172BC: xzalloc (xfuncs_printf.c:71) ==3430==    by 0x1968F6: nvalloc (awk.c:1825) ==3430==    by 0x1968F6: evaluate (awk.c:2877) ==3430==    by 0x1983EB: ptest (awk.c:2227) ==3430==    by 0x196A25: evaluate (awk.c:2951) ==3430==    by 0x19885A: awk_main (awk.c:3713) ==3430==    by 0x11600D: run_applet_no_and_exit (appletlib.c:967) ==3430==    by 0x116331: run_applet_and_exit (appletlib.c:986) ==3430==    by 0x116314: busybox_main (appletlib.c:917) ==3430==    by 0x116314: run_applet_and_exit (appletlib.c:979) ==3430==    by 0x1163AA: main (appletlib.c:1126) ==3430==  ==3430==  ==3430== HEAP SUMMARY: ==3430==     in use at exit: 11,033 bytes in 174 blocks ==3430==   total heap usage: 204 allocs, 30 frees, 13,028 bytes allocated ==3430==  ==3430== LEAK SUMMARY: ==3430==    definitely lost: 0 bytes in 0 blocks ==3430==    indirectly lost: 0 bytes in 0 blocks ==3430==      possibly lost: 11,033 bytes in 174 blocks ==3430==    still reachable: 0 bytes in 0 blocks ==3430==         suppressed: 0 bytes in 0 blocks ==3430== Rerun with --leak-check=full to see details of leaked memory ==3430==  ==3430== For lists of detected and suppressed errors, rerun with: -s ==3430== ERROR SUMMARY: 12 errors from 11 contexts (suppressed: 0 from 0) ```  [Comment 4](show_bug.cgi?id=14781#c4)  Natanael Copa    2022-06-07 18:49:18 UTC  ``` simpler way to reproduce it:  echo "foo" | valgrind ./busybox_unstripped awk '$1$1=0' ```  [Comment 5](show_bug.cgi?id=14781#c5)  Natanael Copa    2022-06-07 19:14:25 UTC  ``` This change makes it segfault early:  $ git diff diff --git a/editors/awk.c b/editors/awk.c index 079d0bde5..840f2595f 100644 --- a/editors/awk.c +++ b/editors/awk.c @@ -55,7 +55,7 @@  /* If you comment out one of these below, it will be #defined later   * to perform debug printfs to stderr: */  #define debug_printf_walker(...)  do {} while (0) -#define debug_printf_eval(...)  do {} while (0) +//#define debug_printf_eval(...)  do {} while (0)  #define debug_printf_parse(...)  do {} while (0)    #ifndef debug_printf_walker @@ -2922,7 +2922,7 @@ static var *evaluate(node *op, var *res)                 if (opinfo & OF_RES2) {                         R.v = evaluate(op->r.n, TMPVAR1);                         //TODO: L.v may be invalid now, set L.v to NULL to catch bugs? -                       //L.v = NULL; +                       L.v = NULL;                         if (opinfo & OF_STR2) {                                 R.s = getvar_s(R.v);                                 debug_printf_eval("R.s:'%s'\n", R.s); $ echo "foo" | ./busybox_unstripped awk '$1$1=0' fsrealloc: xrealloc(0, 512) fsrealloc: Fields=0x7f6dbda05030..0x7f6dbda0522f getvar_i: 0.000000 getvar_i: 1.000000 entered awk_getline() returning from awk_getline(): 1 getvar_i: 0.000000 getvar_i: 0.000000 entered evaluate() opinfo:00000300 opn:00000000 switch(0x3) NEWSOURCE opinfo:00000d00 opn:00000000 switch(0xd) TEST entered evaluate() opinfo:4a031f00 opn:00000000 entered evaluate() opinfo:230f1500 opn:00000000 entered evaluate() opinfo:05021700 opn:00000000 entered evaluate() opinfo:00002700 opn:00000000 switch(0x27) VAR returning from evaluate(): 0x7f6dbda03410 switch(0x17) FIELD getvar_i: 1.000000 returning from evaluate(): 0x7f6dbda05030 L.s:'foo' entered evaluate() opinfo:05021700 opn:00000000 entered evaluate() opinfo:00002700 opn:00000000 switch(0x27) VAR returning from evaluate(): 0x7f6dbda034d0 switch(0x17) FIELD getvar_i: 1.000000 returning from evaluate(): 0x7f6dbda05030 R.s:'foo' switch(0x15) CONCAT / COMMA returning from evaluate(): 0x7f6dbda04bb0 entered evaluate() opinfo:00002700 opn:00000000 switch(0x27) VAR returning from evaluate(): 0x7f6dbda03560 switch(0x1f) MOVE Segmentation fault ```  [Comment 6](show_bug.cgi?id=14781#c6)  Natanael Copa    2022-06-07 19:31:09 UTC  ``` Possible fix:  diff --git a/editors/awk.c b/editors/awk.c index 079d0bde5..d68b8d4bc 100644 --- a/editors/awk.c +++ b/editors/awk.c @@ -2922,7 +2922,7 @@ static var *evaluate(node *op, var *res)                 if (opinfo & OF_RES2) {                         R.v = evaluate(op->r.n, TMPVAR1);                         //TODO: L.v may be invalid now, set L.v to NULL to catch bugs? -                       //L.v = NULL; +                       L.v = NULL;                         if (opinfo & OF_STR2) {                                 R.s = getvar_s(R.v);                                 debug_printf_eval("R.s:'%s'\n", R.s); @@ -3128,6 +3128,8 @@ static var *evaluate(node *op, var *res)                   case XC( OC_MOVE ):                         debug_printf_eval("MOVE\n"); +                       if (L.v == NULL) +                               syntax_error(EMSG_POSSIBLE_ERROR);                         /* if source is a temporary string, jusk relink it to dest */                         if (R.v == TMPVAR1                          && !(R.v->type & VF_NUMBER) ```  [Comment 7](show_bug.cgi?id=14781#c7)  Natanael Copa    2022-06-17 09:49:42 UTC  ``` (In reply to Natanael Copa from [comment #6](show_bug.cgi?id=14781#c6))  Setting L.v to null does not work. it breaks other stuff.  This might work and ./runtests awk passes:  diff --git a/editors/awk.c b/editors/awk.c index 079d0bde5..acdc50e32 100644 --- a/editors/awk.c +++ b/editors/awk.c @@ -3128,6 +3128,9 @@ static var *evaluate(node *op, var *res)                   case XC( OC_MOVE ):                         debug_printf_eval("MOVE\n"); +                       /* make sure that we never return a temp var */ +                       if (L.v == TMPVAR0) +                               L.v = res;                         /* if source is a temporary string, jusk relink it to dest */                         if (R.v == TMPVAR1                          && !(R.v->type & VF_NUMBER) ```  [Comment 8](show_bug.cgi?id=14781#c8)  Denys Vlasenko    2022-07-11 23:30:06 UTC  ``` Fixed in git ```  [Comment 9](show_bug.cgi?id=14781#c9)  xiechengliang    2022-07-29 02:24:00 UTC  ``` Does the vulnerability affect versions 1.32.1 and 1.34.1？ ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=14781)
* - [XML](show_bug.cgi?ctype=xml&id=14781)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=14781)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](docs/en/html/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=14781&GoAheadAndLogIn=1)

    Remember

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=14781&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


