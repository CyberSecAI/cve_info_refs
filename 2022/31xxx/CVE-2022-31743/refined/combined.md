=== Content from www.mozilla.org_b68de4a0_20250115_083745.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-20

## Security Vulnerabilities fixed in Firefox 101

Announced
May 31, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 101

#### [#CVE-2022-31736: Cross-Origin resource's length leaked](#CVE-2022-31736)

Reporter
Luan Herrera
Impact
high
##### Description

A malicious website could have learned the size of a cross-origin resource that supported Range requests.

##### References

* [Bug 1735923](https://bugzilla.mozilla.org/show_bug.cgi?id=1735923)

#### [#CVE-2022-31737: Heap buffer overflow in WebGL](#CVE-2022-31737)

Reporter
Atte Kettunen
Impact
high
##### Description

A malicious webpage could have caused an out-of-bounds write in WebGL, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1743767](https://bugzilla.mozilla.org/show_bug.cgi?id=1743767)

#### [#CVE-2022-31738: Browser window spoof using fullscreen mode](#CVE-2022-31738)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When exiting fullscreen mode, an iframe could have confused the browser about the current state of fullscreen, resulting in potential user confusion or spoofing attacks.

##### References

* [Bug 1756388](https://bugzilla.mozilla.org/show_bug.cgi?id=1756388)

#### [#CVE-2022-31739: Attacker-influenced path traversal when saving downloaded files](#CVE-2022-31739)

Reporter
Chaobin Zhang
Impact
high
##### Description

When downloading files on Windows, the % character was not escaped, which could have lead to a download incorrectly being saved to attacker-influenced paths that used variables such as %HOMEPATH% or %APPDATA%.
*This bug only affects Firefox for Windows. Other operating systems are unaffected.*

##### References

* [Bug 1765049](https://bugzilla.mozilla.org/show_bug.cgi?id=1765049)

#### [#CVE-2022-31740: Register allocation problem in WASM on arm64](#CVE-2022-31740)

Reporter
Gary Kwong
Impact
high
##### Description

On arm64, WASM code could have resulted in incorrect assembly generation leading to a register allocation problem, and a potentially exploitable crash.

##### References

* [Bug 1766806](https://bugzilla.mozilla.org/show_bug.cgi?id=1766806)

#### [#CVE-2022-31741: Uninitialized variable leads to invalid memory read](#CVE-2022-31741)

Reporter
Cybeats PSI Team
Impact
high
##### Description

A crafted CMS message could have been processed incorrectly, leading to an invalid memory read, and potentially further memory corruption.

##### References

* [Bug 1767590](https://bugzilla.mozilla.org/show_bug.cgi?id=1767590)

#### [#CVE-2022-31742: Querying a WebAuthn token with a large number of allowCredential entries may have leaked cross-origin information](#CVE-2022-31742)

Reporter
Michal
Impact
moderate
##### Description

An attacker could have exploited a timing attack by sending a large number of allowCredential entries and detecting the difference between invalid key handles and cross-origin key handles. This could have led to cross-origin account linking in violation of WebAuthn goals.

##### References

* [Bug 1730434](https://bugzilla.mozilla.org/show_bug.cgi?id=1730434)

#### [#CVE-2022-31743: HTML Parsing incorrectly ended HTML comments prematurely](#CVE-2022-31743)

Reporter
Linus Särud
Impact
moderate
##### Description

Firefox's HTML parser did not correctly interpret HTML comment tags, resulting in an incongruity with other browsers. This could have been used to escape HTML comments on pages that put user-controlled data in them.

##### References

* [Bug 1747388](https://bugzilla.mozilla.org/show_bug.cgi?id=1747388)

#### [#CVE-2022-31744: CSP bypass enabling stylesheet injection](#CVE-2022-31744)

Reporter
Gertjan
Impact
moderate
##### Description

An attacker could have injected CSS into stylesheets accessible via internal URIs, such as resource:, and in doing so bypass a page's Content Security Policy.

##### References

* [Bug 1757604](https://bugzilla.mozilla.org/show_bug.cgi?id=1757604)

#### [#CVE-2022-31745: Incorrect Assertion caused by unoptimized array shift operations](#CVE-2022-31745)

Reporter
Lukas Bernhard
Impact
moderate
##### Description

If array shift operations are not used, the Garbage Collector may have become confused about valid objects.

##### References

* [Bug 1760944](https://bugzilla.mozilla.org/show_bug.cgi?id=1760944)

#### [#CVE-2022-1919: Memory Corruption when manipulating webp images](#CVE-2022-1919)

Reporter
Irvan Kurniawan
Impact
low
##### Description

An attacker could have caused an uninitialized variable on the stack to be mistakenly freed, causing a potentially exploitable crash.

##### References

* [Bug 1761275](https://bugzilla.mozilla.org/show_bug.cgi?id=1761275)

#### [#CVE-2022-31747: Memory safety bugs fixed in Firefox 101 and Firefox ESR 91.10](#CVE-2022-31747)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Andrew McCreight, Nicolas B. Pierron, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 100 and Firefox ESR 91.9. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 101 and Firefox ESR 91.10](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1760765%2C1765610%2C1766283%2C1767365%2C1768559%2C1768734)

#### [#CVE-2022-31748: Memory safety bugs fixed in Firefox 101](#CVE-2022-31748)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Gabriele Svelto, Timothy Nikkel, Randell Jesup, Jon Coppeard, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 100. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 101](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1713773%2C1762201%2C1762469%2C1762770%2C1764878%2C1765226%2C1765782%2C1765973%2C1767177%2C1767181%2C1768232%2C1768251%2C1769869)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_372bf90d_20250115_083743.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1747388)
* [XML](/show_bug.cgi?ctype=xml&id=1747388)

Closed
[Bug 1747388](/show_bug.cgi?id=1747388)
(CVE-2022-31743)

Opened 3 years ago
Closed 3 years ago

# Able to escape HTML comments by using a comment within a comment

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Able to escape HTML comments by using a comment within a comment

## Categories

### (Core :: DOM: HTML Parser, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20HTML%20Parser#DOM%3A%20HTML%20Parser)

DOM: HTML Parser
▾

Core :: DOM: HTML Parser
This system consumes content from the web, parses, validates and builds a content model (document)
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20HTML%20Parser)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

102 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox | --- | [-](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=-) |
| firefox-esr91 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=unaffected) |
| firefox100 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix) |
| firefox101 | [+](/buglist.cgi?f1=cf_tracking_firefox101&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=verified) |
| firefox102 | [+](/buglist.cgi?f1=cf_tracking_firefox102&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | - |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr91 |  | unaffected |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox100 |  | wontfix |
| firefox101 | + | verified |
| firefox102 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bugzilla, Assigned: hsivonen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0030426a5e04e85c33fe02480bc4ca81?d=mm&size=40)  [hsivonen](/user_profile?user_id=5490)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5ec38912565f5590cb0b936392667686?d=mm&size=40)  [bugzilla](/user_profile?user_id=633944)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b89a42ca4c4d59c27f33c399bb1ecc7b?d=mm&size=40)  [farre](/user_profile?user_id=566192)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-other, reporter-external, sec-moderate, Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main101+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-31743

[Keywords:](/describekeywords.cgi)

[csectype-other](/buglist.cgi?keywords=csectype-other&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main101+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a11944496_1689 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [Tokenizer tests](/attachment.cgi?id=9275171)  [3 years ago](#c6)  [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)   2.70 KB, text/plain |  | [Details](/attachment.cgi?id=9275171&action=edit) |
| --- | --- | --- |
| [Tree builder tests](/attachment.cgi?id=9275172)  [3 years ago](#c7)  [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)   1.64 KB, text/plain |  | [Details](/attachment.cgi?id=9275172&action=edit) |
| [Bug 1747388.](/attachment.cgi?id=9275176)  [3 years ago](#c8)  [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#c21 "3 years ago")  tjr : [sec-approval+](#c13 "3 years ago") | [Details](/attachment.cgi?id=9275176&action=edit) | [Review](/attachment.cgi?id=9275176) |
| [advisory.txt](/attachment.cgi?id=9278199)  [3 years ago](#c25)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   288 bytes, text/plain |  | [Details](/attachment.cgi?id=9278199&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Linus Särud](/user_profile?user_id=633944)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1747388#c0)• 3 years ago |
|  | |

I just used the following trick to fool a parser and got an XSS on a Bug Bounty-target. Firefox parsing differ from Chrome and Safari.

POC: <https://playground.zulln.se/poc/firefox/commentwithincomment.html>

Source code of POC:

```
Visible in all browsers.  <!-- <br>Not visible in any browser <!--k-> <br>Visible in Firefox. --> <br> Visible in all browsers.

```

The letter k within the comment in the middle of the poc can be any character.

Flags: sec-bounty?

|  | [Sergey Galich [:serg]](/user_profile?user_id=691597) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a13465_691597)• 3 years ago |

Group: firefox-core-security → core-securityComponent: Security → DOM: HTML ParserProduct: Firefox → Core

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a21211_406194)• 3 years ago |

Group: core-security → dom-core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a331352_1689)• 3 years ago |

Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1747388#c1)• 3 years ago |
|  | |

I seem to recall we had a similar issue with comment parsing, but can't find the exact issue.

Anyhow, it seems that other browsers require a whitespace after the "<!--" and we do not?

Henri, is that a known difference?

Flags: needinfo?(hsivonen)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1747388#c2)• 3 years ago |
|  | |

(In reply to Frederik Braun [:freddy] - out until Jan 4th. from [comment #1](/show_bug.cgi?id=1747388#c1 "VERIFIED FIXED - Able to escape HTML comments by using a comment within a comment"))

> I seem to recall we had a similar issue with comment parsing, but can't find the exact issue.
>
> Anyhow, it seems that other browsers require a whitespace after the "<!--" and we do not?
>
> Henri, is that a known difference?

Not a known difference. An actual bug. Reporter, thanks for reporting!

Our "Comment less-than sign bang dash dash state" differs from the one in the spec. In general, our comment states inline some transitions into the state being transitioned from instead of reconsuming in another state. In this case, we don't appear to perform the inlining as if "k" got reconsumed the way it's supposed to.

Assignee: nobody → hsivonenStatus: NEW → ASSIGNEDFlags: needinfo?(hsivonen)

|  | [Edgar Chen [:edgar]](/user_profile?user_id=455480) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a1025345_455480)• 3 years ago |

Severity: -- → S3Priority: -- → P2

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a1160439_1689)• 3 years ago |

Keywords: [csectype-other](/buglist.cgi?keywords=csectype-other&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1747388#c3)• 3 years ago |
|  | |

Henri, any updates here? It has been a few months. Thanks.

Flags: needinfo?(hsivonen)

|  | [Linus Särud](/user_profile?user_id=633944)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1747388#c4)• 3 years ago |
|  | |

The bug is still in place, it has been some time now so just want to make sure it is not forgotten about.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1747388#c5)• 3 years ago |
|  | |

I have not forgotten about this, but there are more tests to write (and to figure out how to disclose) than just the reported case, because I found similar instances of adjacent brokenness.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1747388#c6)• 3 years ago |
|  | |

Attached file
[Tokenizer tests](attachment.cgi?id=9275171)
— [Details](attachment.cgi?id=9275171&action=edit)

Attaching tokenizer tests, to be upstreamed after the fix has been disclosed.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1747388#c7)• 3 years ago |
|  | |

Attached file
[Tree builder tests](attachment.cgi?id=9275172)
— [Details](attachment.cgi?id=9275172&action=edit)

Attaching the same tests as tree builder tests tests, because WPT doesn't run tokenizer tests. To be upstreamed after the fix has been disclosed.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1747388#c8)• 3 years ago |
|  | |

Attached file
[Bug 1747388.](attachment.cgi?id=9275176)
— [Details](attachment.cgi?id=9275176&action=edit)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1747388#c9)• 3 years ago |
|  | |

CCing sideshowbarker for opinion on what disclosure/advisory steps are necessary on the Java side.

Flags: needinfo?(hsivonen) → needinfo?(mike)

|  | [Michael[tm] Smith [:sideshowbarker]](/user_profile?user_id=319983) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1747388#c10)• 3 years ago |
|  | |

(In reply to Henri Sivonen (:hsivonen) from [comment #9](/show_bug.cgi?id=1747388#c9 "VERIFIED FIXED - Able to escape HTML comments by using a comment within a comment"))

> CCing sideshowbarker for opinion on what disclosure/advisory steps are necessary on the Java side.

I don’t recall ever before having a case where we needed to publish a disclosure/advisory for the Java parser or the validator, or to do a security release. But I suppose for the Java parser and the validator, we should wait until Firefox release management does whatever announcement and release they’ll be doing for this, and then for the Java parser and validator, we can follow with a release and some announcement.

Flags: needinfo?(mike)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1747388#c11)• 3 years ago |
|  | |

This bug being rated sec-moderate and externally reported means we will issue a CVE once this goes to release, which will be June 28, 2022 if this patch makes into the current Nightly cycle.

If there's any extra urgency, we can of course consider uplifting to the beta branch (i.e., going to release 4 weeks earlier).

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1747388#c12)• 3 years ago |
|  | |

Comment on [attachment 9275176](/attachment.cgi?id=9275176 "Bug 1747388.") [[details]](/attachment.cgi?id=9275176&action=edit "Bug 1747388.")

[Bug 1747388](/show_bug.cgi?id=1747388 "VERIFIED FIXED - Able to escape HTML comments by using a comment within a comment").

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Extremely easily. (Which is why I'm requesting sec-approval just to be sure, even though this has been rated as sec-moderate.)
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: Release, beta
* **If not all supported branches, which bug introduced the flaw?**: [Bug 1319410](/show_bug.cgi?id=1319410 "RESOLVED FIXED - View source: don't error-highlight comments with dashes")
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: I expect the same patch to apply.
* **How likely is this patch to cause regressions; how much testing does it need?**: Relatively unlikely.
* **Is Android affected?**: Yes
[Attachment #9275176](/attachment.cgi?id=9275176&action=edit "Bug 1747388.") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1747388#c13)• 3 years ago |
|  | |

Comment on [attachment 9275176](/attachment.cgi?id=9275176 "Bug 1747388.") [[details]](/attachment.cgi?id=9275176&action=edit "Bug 1747388.")

[Bug 1747388](/show_bug.cgi?id=1747388 "VERIFIED FIXED - Able to escape HTML comments by using a comment within a comment").

Approved to land and consider for uplift

[Attachment #9275176](/attachment.cgi?id=9275176&action=edit "Bug 1747388.") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a11860568_578488)• 3 years ago |

[relnote-firefox](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=%3F)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a11882856_75935)• 3 years ago |

[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix)
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=affected)
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=unaffected)
[tracking-firefox101](/buglist.cgi?f1=cf_tracking_firefox101&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox101&o1=equals&v1=%2B)
[tracking-firefox102](/buglist.cgi?f1=cf_tracking_firefox102&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox102&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1747388#c14)• 3 years ago |
|  | |

Can you please suggest what you'd want a relnote to look like for this bug?

Flags: needinfo?(tom)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1747388#c15)• 3 years ago |
|  | |

I've never done a relnote before, but it seemed like this could possibly be a developer note like 'Parsing of HTML comments, and specifically beginning comment tags inside of a comment tag, was aligned with the implementation of other browsers.'? I don't feel strongly that it should be a relnote, I just saw a reminder recently to set the flag :)

Flags: needinfo?(tom)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1747388#c16)• 3 years ago |
|  | |

I think this doesn't need a relnote, since this doesn't typically affect end users or Web developers, but I think this should go into a security advisory instead.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1747388#c17)• 3 years ago |
|  | |

(In reply to Henri Sivonen (:hsivonen) from [comment #16](/show_bug.cgi?id=1747388#c16 "VERIFIED FIXED - Able to escape HTML comments by using a comment within a comment"))

> I think this doesn't need a relnote, since this doesn't typically affect end users or Web developers, but I think this should go into a security advisory instead.

Agreed.

[relnote-firefox](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=-)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1747388#c18)• 3 years ago |
|  | |

r=smaug

<https://hg.mozilla.org/integration/autoland/rev/0794b6683ca59b39a521be2799116a6c174c43dd>

<https://hg.mozilla.org/mozilla-central/rev/0794b6683ca5>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 102 Branch

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a11944496_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1747388#c19)• 3 years ago |
|  | |

Please nominate this for Beta approval when you're comfortable doing so.

Flags: needinfo?(hsivonen)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1747388#c20)• 3 years ago |
|  | |

Comment on [attachment 9275176](/attachment.cgi?id=9275176 "Bug 1747388.") [[details]](/attachment.cgi?id=9275176&action=edit "Bug 1747388.")

[Bug 1747388](/show_bug.cgi?id=1747388 "VERIFIED FIXED - Able to escape HTML comments by using a comment within a comment").

### Beta/Release Uplift Approval Request

* **User impact if declined**: XSS in case a site doesn't remove attacker-provided HTML comments but passes them through to the browser in attacker-provided content.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The fix is assumed to be low-risk, because the fix adheres to the expected structure of the tokenizer and has been tested (albeit outside our CI).
* **String changes made/needed**: None
* **Is Android affected?**: Yes
Flags: needinfo?(hsivonen)
[Attachment #9275176](/attachment.cgi?id=9275176&action=edit "Bug 1747388.") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1747388#c21)• 3 years ago |
|  | |

Comment on [attachment 9275176](/attachment.cgi?id=9275176 "Bug 1747388.") [[details]](/attachment.cgi?id=9275176&action=edit "Bug 1747388.")

[Bug 1747388](/show_bug.cgi?id=1747388 "VERIFIED FIXED - Able to escape HTML comments by using a comment within a comment").

Approved for 101.0b6.

[Attachment #9275176](/attachment.cgi?id=9275176&action=edit "Bug 1747388.") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1747388#c22)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/8e251b5c5ceb>

[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=fixed)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a12188304_553429)• 3 years ago |

Flags: qe-verify+Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a12418187_553429)• 3 years ago |

QA Whiteboard: [qa-triaged]

|  | [Hani Yacoub, Desktop QA](/user_profile?user_id=583007) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1747388#c23)• 3 years ago |
|  | |

Verified as fixed on Windows 10 x64, Ubuntu 20.04 x64 and on macOS 11.6.

Status: RESOLVED → VERIFIEDQA Whiteboard: [qa-triaged]
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=verified)
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=verified)Flags: qe-verify+

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1747388#c24)• 3 years ago |
|  | |

<https://github.com/validator/htmlparser/commit/0d330112715f5d1bc8b206c08d2a64a2aab6fd82>

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a13234450_578488)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage][adv-main101+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1747388#c25)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9278199)
— [Details](attachment.cgi?id=9278199&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a13320938_578488)• 3 years ago |

Alias: CVE-2022-31743

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a33666192_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1747388#a76828053_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1747388&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


