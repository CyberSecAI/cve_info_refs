```json
{
  "vulnerability": {
    "CVE": "CVE-2022-31627",
    "details": "A heap-based buffer overflow vulnerability exists in the `finfo_buffer` function of PHP versions 8.1.x prior to 8.1.8. This occurs when processing specially crafted input data. ",
    "affected_components": [
      "PHP versions 8.1.x prior to 8.1.8"
    ],
    "root_cause": "The vulnerability is due to a memory management issue when reallocating memory in the fileinfo extension's `finfo_buffer` function. Specifically, the function attempts to reallocate memory that has previously been allocated using a different allocator (`malloc` instead of `emalloc`). This results in a heap buffer overflow.",
    "vulnerabilities": [
      "Heap-based buffer overflow",
      "Memory corruption"
    ],
    "impact": "Successful exploitation of this vulnerability could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).",
     "attack_vectors": [
      "Sending specially crafted input data to the vulnerable `finfo_buffer` function."
    ],
    "attacker_capabilities": "The attacker needs to be able to provide specially crafted input data to the `finfo_buffer` function. No authentication is required and the vulnerability is remotely exploitable.",
      "additional_information": "The vulnerability stems from incorrect memory allocation within the libmagic library, specifically when a patch of libmagic 5.40 incorrectly mixes `malloc()` and `erealloc()`, leading to heap corruption and buffer overflow.\n\nThe affected versions of PHP use an embedded libmagic library. The issue is resolved by updating libmagic and ensuring consistent memory allocation using emalloc and efree."
  },
  "related_items": [
    {
      "type": "NetApp Advisory",
      "id": "NTAP-20220826-0008",
       "summary": "Multiple NetApp products incorporate PHP. PHP versions 8.1.x prior to 8.1.8 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).",
      "status": "Final",
      "affected_products": [
        "None"
      ],
       "workarounds": "None at this time.",
      "remediation": "None at this time. Software fixes will be made available through the NetApp Support website in the Software Download section."
    },
    {
      "type": "Gentoo Security Advisory",
      "id": "GLSA 202209-20",
      "summary": "Multiple vulnerabilities have been discovered in PHP, the worst of which could result in local root privilege escalation.",
       "affected_packages": [
          "dev-lang/php < 7.4.30",
          "dev-lang/php < 8.0.23",
          "dev-lang/php < 8.1.8"
        ],
      "impact": "Review the referenced CVE identifiers for details.",
      "resolution": "Upgrade to the latest version of PHP"
    },
    {
     "type": "PHP Bug Report",
     "id": "#81723",
     "summary": "Heap buffer overflow in finfo_buffer",
     "description": "The following content is causing a heap-based buffer overflow in finfo_buffer.\nTested against PHP >= 8.1. ASAN output, test script and expected/actual results provided.",
     "status": "Closed",
       "patches": "A patch that addresses the memory corruption by using `emalloc` and `efree` has been created and commited."
    },
    {
       "type": "GitHub Commit",
        "id": "ca6d511fa54b34d5b75bf120a86482a1b9e1e686",
        "summary": "Fix #81723: Memory corruption in finfo_buffer()",
        "description":"We need to use the same memory allocator throughout.",
         "changes": [
           "ext/fileinfo/libmagic.patch",
           "ext/fileinfo/libmagic/softmagic.c",
           "ext/fileinfo/tests/bug81723.phpt"
         ]
    }
    ,
    {
       "type": "GitHub Gist",
       "id": "90aba3c8ff8d42c5598e31846d259aa7",
        "summary": "Proposed patch for PHP bug #81723",
         "description":"Proposed patch for PHP bug #81723.\nIncludes changes to ext/fileinfo/libmagic.patch and libmagic/softmagic.c, and addition of tests/bug81723.phpt"
    }
  ]
}
```