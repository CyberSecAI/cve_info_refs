=== Content from github.com_34f4f122_20250115_101821.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fsecurity%2Fadvisories%2FGHSA-hm37-9xh2-q499)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fsecurity%2Fadvisories%2FGHSA-hm37-9xh2-q499)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=scottcwang%2Fopenssh_key_parser)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[scottcwang](/scottcwang)
/
**[openssh\_key\_parser](/scottcwang/openssh_key_parser)**
Public

* [Notifications](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser) You must be signed in to change notification settings
* [Fork
  5](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)
* [Star
   20](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)

* [Code](/scottcwang/openssh_key_parser)
* [Issues
  0](/scottcwang/openssh_key_parser/issues)
* [Pull requests
  0](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects
  0](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

Additional navigation options

* [Code](/scottcwang/openssh_key_parser)
* [Issues](/scottcwang/openssh_key_parser/issues)
* [Pull requests](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

# Possible leak of key's raw field if declared length is incorrect

High

[scottcwang](/scottcwang)
published
GHSA-hm37-9xh2-q499
Jul 6, 2022

## Package

pip

openssh-key-parser
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<0.0.5

## Patched versions

0.0.6

## Description

### Impact

If a field of a key is shorter than it is declared to be, the parser raises an error with a message containing the raw field value. An attacker able to modify the declared length of a key's sensitive field can thus expose the raw value of that field.

### Patches

Upgrade to version 0.0.6, which no longer includes the raw field value in the error message.

### Workarounds

N/A

### References

N/A

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [openssh\_key\_parser](https://github.com/scottcwang/openssh_key_parser)

### Severity

High

7.7

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N

### CVE ID

CVE-2022-31124

### Weaknesses

[CWE-126](/advisories?query=cwe%3A126)

### Credits

* [![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=40&v=4)](/mike-arnica)
  [mike-arnica](/mike-arnica)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_889d9cdf_20250115_101816.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fcommit%2Fd5b53b4b7e76c5b666fc657019dbf864fb04076c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fcommit%2Fd5b53b4b7e76c5b666fc657019dbf864fb04076c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=scottcwang%2Fopenssh_key_parser)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[scottcwang](/scottcwang)
/
**[openssh\_key\_parser](/scottcwang/openssh_key_parser)**
Public

* [Notifications](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser) You must be signed in to change notification settings
* [Fork
  5](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)
* [Star
   20](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)

* [Code](/scottcwang/openssh_key_parser)
* [Issues
  0](/scottcwang/openssh_key_parser/issues)
* [Pull requests
  0](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects
  0](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

Additional navigation options

* [Code](/scottcwang/openssh_key_parser)
* [Issues](/scottcwang/openssh_key_parser/issues)
* [Pull requests](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

## Commit

[Permalink](/scottcwang/openssh_key_parser/commit/d5b53b4b7e76c5b666fc657019dbf864fb04076c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Improved error handling to prevent unhandled exceptions in calling code.

[Browse files](/scottcwang/openssh_key_parser/tree/d5b53b4b7e76c5b666fc657019dbf864fb04076c)
Browse the repository at this point in the history

* Loading branch information

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=40&v=4)](/mike-arnica)

[mike-arnica](/scottcwang/openssh_key_parser/commits?author=mike-arnica "View all commits by mike-arnica")
committed
Jun 22, 2022

1 parent
[26e0a47](/scottcwang/openssh_key_parser/commit/26e0a471e9fdb23e635bc3014cf4cbd2323a08d3)

commit d5b53b4

Showing
**1 changed file**
with
**95 additions**
and
**86 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

181 changes: 95 additions & 86 deletions

181
[openssh\_key/private\_key\_list.py](#diff-8ef0a57dde7bf143dfe9321c8e23224d86900efdfb7ed9755eb840f67c4b1fd9 "openssh_key/private_key_list.py")

Show comments

[View file](/scottcwang/openssh_key_parser/blob/d5b53b4b7e76c5b666fc657019dbf864fb04076c/openssh_key/private_key_list.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -221,118 +221,127 @@ def from\_bytes( |
|  |  |  |
|  |  | Raises: |
|  |  | ValueError: The provided byte string is not an ``openssh-key-v1`` |
|  |  | key list or the declared key count is negative. |
|  |  | key list, when the declared key count is negative, or when an |
|  |  | EOF is found while parsing the key. |
|  |  |  |
|  |  | UserWarning: The check numbers in the decrypted private byte string |
|  |  | do not match (likely due to an incorrect passphrase), the key |
|  |  | type or parameter values of a private key do not match that of |
|  |  | the corresponding public key in the list, or the padding bytes |
|  |  | at the end of the decrypted private byte string are not as |
|  |  | expected. |
|  |  | """ |
|  |  | byte\_stream = PascalStyleByteStream(byte\_string) |
|  |  | try: |
|  |  | byte\_stream = PascalStyleByteStream(byte\_string) |
|  |  |  |
|  |  | header = byte\_stream.read\_from\_format\_instructions\_dict( |
|  |  | cls.HEADER\_FORMAT\_INSTRUCTIONS\_DICT |
|  |  | ) |
|  |  | header = byte\_stream.read\_from\_format\_instructions\_dict( |
|  |  | cls.HEADER\_FORMAT\_INSTRUCTIONS\_DICT |
|  |  | ) |
|  |  |  |
|  |  | if header['auth\_magic'] != b'openssh-key-v1\x00': |
|  |  | raise ValueError('Not an openssh-key-v1 key') |
|  |  |  |
|  |  | if header['auth\_magic'] != b'openssh-key-v1\x00': |
|  |  | raise ValueError('Not an openssh-key-v1 key') |
|  |  | num\_keys = header['num\_keys'] |
|  |  |  |
|  |  | num\_keys = header['num\_keys'] |
|  |  | if num\_keys < 0: |
|  |  | raise ValueError('Cannot parse negative number of keys') |
|  |  |  |
|  |  | if num\_keys < 0: |
|  |  | raise ValueError('Cannot parse negative number of keys') |
|  |  | public\_key\_list = [] |
|  |  | for i in range(num\_keys): |
|  |  | public\_key\_bytes = byte\_stream.read\_from\_format\_instruction( |
|  |  | PascalStyleFormatInstruction.BYTES |
|  |  | ) |
|  |  | public\_key\_list.append( |
|  |  | PublicKey.from\_bytes(public\_key\_bytes) |
|  |  | ) |
|  |  |  |
|  |  | public\_key\_list = [] |
|  |  | for i in range(num\_keys): |
|  |  | public\_key\_bytes = byte\_stream.read\_from\_format\_instruction( |
|  |  | cipher\_bytes = byte\_stream.read\_from\_format\_instruction( |
|  |  | PascalStyleFormatInstruction.BYTES |
|  |  | ) |
|  |  | public\_key\_list.append( |
|  |  | PublicKey.from\_bytes(public\_key\_bytes) |
|  |  | ) |
|  |  |  |
|  |  | cipher\_bytes = byte\_stream.read\_from\_format\_instruction( |
|  |  | PascalStyleFormatInstruction.BYTES |
|  |  | ) |
|  |  |  |
|  |  | kdf\_class = get\_kdf\_options\_class(header['kdf']) |
|  |  | kdf\_options = kdf\_class( |
|  |  | PascalStyleByteStream( |
|  |  | header['kdf\_options'] |
|  |  | ).read\_from\_format\_instructions\_dict( |
|  |  | kdf\_class.FORMAT\_INSTRUCTIONS\_DICT |
|  |  | kdf\_class = get\_kdf\_options\_class(header['kdf']) |
|  |  | kdf\_options = kdf\_class( |
|  |  | PascalStyleByteStream( |
|  |  | header['kdf\_options'] |
|  |  | ).read\_from\_format\_instructions\_dict( |
|  |  | kdf\_class.FORMAT\_INSTRUCTIONS\_DICT |
|  |  | ) |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | cipher\_class = get\_cipher\_class(header['cipher']) |
|  |  | cipher\_class = get\_cipher\_class(header['cipher']) |
|  |  |  |
|  |  | if kdf\_class == NoneKDFOptions: |
|  |  | passphrase = '' |
|  |  | elif passphrase is None: |
|  |  | passphrase = getpass.getpass('Key passphrase: ') |
|  |  | if kdf\_class == NoneKDFOptions: |
|  |  | passphrase = '' |
|  |  | elif passphrase is None: |
|  |  | passphrase = getpass.getpass('Key passphrase: ') |
|  |  |  |
|  |  | if issubclass(cipher\_class, ConfidentialityIntegrityCipher): |
|  |  | cipher\_bytes += byte\_stream.read\_fixed\_bytes( |
|  |  | cipher\_class.TAG\_LENGTH |
|  |  | ) |
|  |  |  |
|  |  | decipher\_bytes = cipher\_class.decrypt( |
|  |  | kdf\_class(kdf\_options), |
|  |  | passphrase, |
|  |  | cipher\_bytes |
|  |  | ) |
|  |  |  |
|  |  | decipher\_byte\_stream = PascalStyleByteStream(decipher\_bytes) |
|  |  | if issubclass(cipher\_class, ConfidentialityIntegrityCipher): |
|  |  | cipher\_bytes += byte\_stream.read\_fixed\_bytes( |
|  |  | cipher\_class.TAG\_LENGTH |
|  |  | ) |
|  |  |  |
|  |  | decipher\_bytes\_header = \ |
|  |  | decipher\_byte\_stream.read\_from\_format\_instructions\_dict( |
|  |  | cls.DECIPHER\_BYTES\_HEADER\_FORMAT\_INSTRUCTIONS\_DICT |
|  |  | decipher\_bytes = cipher\_class.decrypt( |
|  |  | kdf\_class(kdf\_options), |
|  |  | passphrase, |
|  |  | cipher\_bytes |
|  |  | ) |
|  |  |  |
|  |  | if decipher\_bytes\_header['check\_int\_1'] \ |
|  |  | != decipher\_bytes\_header['check\_int\_2']: |
|  |  | warnings.warn('Cipher header check numbers do not match') |
|  |  | decipher\_byte\_stream = PascalStyleByteStream(decipher\_bytes) |
|  |  |  |
|  |  | initlist = [] |
|  |  | for i in range(num\_keys): |
|  |  | initlist.append( |
|  |  | PublicPrivateKeyPair( |
|  |  | public\_key\_list[i], |
|  |  | PrivateKey.from\_byte\_stream(decipher\_byte\_stream) |
|  |  | ) |
|  |  | ) |
|  |  | if initlist[i].public.header['key\_type'] \ |
|  |  | != initlist[i].private.header['key\_type']: |
|  |  | warnings.warn( |
|  |  | f'Inconsistency between private and public ' |
|  |  | f'key types for key {i}' |
|  |  | decipher\_bytes\_header = \ |
|  |  | decipher\_byte\_stream.read\_from\_format\_instructions\_dict( |
|  |  | cls.DECIPHER\_BYTES\_HEADER\_FORMAT\_INSTRUCTIONS\_DICT |
|  |  | ) |
|  |  | if not all( |
|  |  | ( |
|  |  | initlist[i].public.params[k] == |
|  |  | initlist[i].private.params[k] |
|  |  | ) for k in ( |
|  |  | initlist[i].public.params.keys() & |
|  |  | initlist[i].private.params.keys() |
|  |  |  |
|  |  | if decipher\_bytes\_header['check\_int\_1'] \ |
|  |  | != decipher\_bytes\_header['check\_int\_2']: |
|  |  | warnings.warn('Cipher header check numbers do not match') |
|  |  |  |
|  |  | initlist = [] |
|  |  | for i in range(num\_keys): |
|  |  | initlist.append( |
|  |  | PublicPrivateKeyPair( |
|  |  | public\_key\_list[i], |
|  |  | PrivateKey.from\_byte\_stream(decipher\_byte\_stream) |
|  |  | ) |
|  |  | ) |
|  |  | if initlist[i].public.header['key\_type'] \ |
|  |  | != initlist[i].private.header['key\_type']: |
|  |  | warnings.warn( |
|  |  | f'Inconsistency between private and public ' |
|  |  | f'key types for key {i}' |
|  |  | ) |
|  |  | if not all( |
|  |  | ( |
|  |  | initlist[i].public.params[k] == |
|  |  | initlist[i].private.params[k] |
|  |  | ) for k in ( |
|  |  | initlist[i].public.params.keys() & |
|  |  | initlist[i].private.params.keys() |
|  |  | ) |
|  |  | ): |
|  |  | warnings.warn( |
|  |  | f'Inconsistency between private and public ' |
|  |  | f'values for key {i}' |
|  |  | ) |
|  |  |  |
|  |  | decipher\_padding = decipher\_byte\_stream.read() |
|  |  |  |
|  |  | if ( |
|  |  | len(decipher\_byte\_stream.getvalue()) % |
|  |  | cipher\_class.BLOCK\_SIZE != 0 |
|  |  | ) or not ( |
|  |  | bytes( |
|  |  | range(1, 1 + cipher\_class.BLOCK\_SIZE) |
|  |  | ).startswith(decipher\_padding) |
|  |  | ): |
|  |  | warnings.warn( |
|  |  | f'Inconsistency between private and public ' |
|  |  | f'values for key {i}' |
|  |  | ) |
|  |  |  |
|  |  | decipher\_padding = decipher\_byte\_stream.read() |
|  |  |  |
|  |  | if ( |
|  |  | len(decipher\_byte\_stream.getvalue()) % |
|  |  | cipher\_class.BLOCK\_SIZE != 0 |
|  |  | ) or not ( |
|  |  | bytes( |
|  |  | range(1, 1 + cipher\_class.BLOCK\_SIZE) |
|  |  | ).startswith(decipher\_padding) |
|  |  | ): |
|  |  | warnings.warn('Incorrect padding at end of ciphertext') |
|  |  | warnings.warn('Incorrect padding at end of ciphertext') |
|  |  | except ValueError as e: |
|  |  | raise e |
|  |  | except EOFError as e: |
|  |  | raise ValueError('Premature EOF detected while parsing key.') |
|  |  | except e: |
|  |  | raise ValueError('Unexpected error condition reached.') |
|  |  |  |
|  |  | return cls( |
|  |  | initlist, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d5b53b4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fcommit%2Fd5b53b4b7e76c5b666fc657019dbf864fb04076c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3a02fbca_20250115_101813.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fcommit%2F274447f91b4037b7050ae634879b657554523b39)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fcommit%2F274447f91b4037b7050ae634879b657554523b39)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=scottcwang%2Fopenssh_key_parser)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[scottcwang](/scottcwang)
/
**[openssh\_key\_parser](/scottcwang/openssh_key_parser)**
Public

* [Notifications](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser) You must be signed in to change notification settings
* [Fork
  5](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)
* [Star
   20](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)

* [Code](/scottcwang/openssh_key_parser)
* [Issues
  0](/scottcwang/openssh_key_parser/issues)
* [Pull requests
  0](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects
  0](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

Additional navigation options

* [Code](/scottcwang/openssh_key_parser)
* [Issues](/scottcwang/openssh_key_parser/issues)
* [Pull requests](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

## Commit

[Permalink](/scottcwang/openssh_key_parser/commit/274447f91b4037b7050ae634879b657554523b39)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#5](https://github.com/scottcwang/openssh_key_parser/pull/5) from mike-arnica/security-review

[Browse files](/scottcwang/openssh_key_parser/tree/274447f91b4037b7050ae634879b657554523b39)
Browse the repository at this point in the history

```
Fix insecure/undeclared raised errors; initial commit of scripts for atheris fuzzer
```

* Loading branch information

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=40&v=4)](/scottcwang)

[scottcwang](/scottcwang/openssh_key_parser/commits?author=scottcwang "View all commits by scottcwang")
authored
Jun 25, 2022

2 parents
[69fe5b7](/scottcwang/openssh_key_parser/commit/69fe5b7addc21d3f39626ae93c6961811aea9d4c)
+
[ae4d131](/scottcwang/openssh_key_parser/commit/ae4d131d1cd8fe06325bfd6b749305aca60873bf)

commit 274447f

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**151 additions**
and
**87 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* openssh\_key

  + openssh\_key/pascal\_style\_byte\_stream.py
    [pascal\_style\_byte\_stream.py](#diff-f7d0259db3b168d6cc26484b1e67eb0b239556295b4b40d6c854daa9afbd7e62)
  + openssh\_key/private\_key\_list.py
    [private\_key\_list.py](#diff-8ef0a57dde7bf143dfe9321c8e23224d86900efdfb7ed9755eb840f67c4b1fd9)
* tests/fuzzer

  + tests/fuzzer/fuzz\_b64.py
    [fuzz\_b64.py](#diff-96318c1e640ee7a80981be82b6edbcff0bc947414078b956f5f9837ca40169a1)
  + tests/fuzzer/fuzz\_valid\_magic.py
    [fuzz\_valid\_magic.py](#diff-2cfaa9ad7210fc9958d13f5cc57b8db2be8cc3dbdd2ce86dc97787401926fd94)
  + tests/fuzzer/requirements.txt
    [requirements.txt](#diff-a4814156b28cf6301141ac1883c5349c989705c0676d5200b239c455e22db4a2)

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[openssh\_key/pascal\_style\_byte\_stream.py](#diff-f7d0259db3b168d6cc26484b1e67eb0b239556295b4b40d6c854daa9afbd7e62 "openssh_key/pascal_style_byte_stream.py")

Show comments

[View file](/scottcwang/openssh_key_parser/blob/274447f91b4037b7050ae634879b657554523b39/openssh_key/pascal_style_byte_stream.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -236,7 +236,8 @@ def read\_fixed\_bytes(self, num\_bytes: int) -> bytes: |
|  |  | """ |
|  |  | read\_bytes = self.read(num\_bytes) |
|  |  | if len(read\_bytes) < num\_bytes: |
|  |  | raise EOFError(read\_bytes) |
|  |  | raise EOFError("Fewer than 'num\_bytes' bytes remaining in the " |
|  |  | "underlying bytestream") |
|  |  | return read\_bytes |
|  |  |  |
|  |  | def read\_pascal\_bytes(self, string\_length\_size: int) -> bytes: |
| Expand Down | |  |

181 changes: 95 additions & 86 deletions

181
[openssh\_key/private\_key\_list.py](#diff-8ef0a57dde7bf143dfe9321c8e23224d86900efdfb7ed9755eb840f67c4b1fd9 "openssh_key/private_key_list.py")

Show comments

[View file](/scottcwang/openssh_key_parser/blob/274447f91b4037b7050ae634879b657554523b39/openssh_key/private_key_list.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -221,118 +221,127 @@ def from\_bytes( |
|  |  |  |
|  |  | Raises: |
|  |  | ValueError: The provided byte string is not an ``openssh-key-v1`` |
|  |  | key list or the declared key count is negative. |
|  |  | key list, when the declared key count is negative, or when an |
|  |  | EOF is found while parsing the key. |
|  |  |  |
|  |  | UserWarning: The check numbers in the decrypted private byte string |
|  |  | do not match (likely due to an incorrect passphrase), the key |
|  |  | type or parameter values of a private key do not match that of |
|  |  | the corresponding public key in the list, or the padding bytes |
|  |  | at the end of the decrypted private byte string are not as |
|  |  | expected. |
|  |  | """ |
|  |  | byte\_stream = PascalStyleByteStream(byte\_string) |
|  |  | try: |
|  |  | byte\_stream = PascalStyleByteStream(byte\_string) |
|  |  |  |
|  |  | header = byte\_stream.read\_from\_format\_instructions\_dict( |
|  |  | cls.HEADER\_FORMAT\_INSTRUCTIONS\_DICT |
|  |  | ) |
|  |  | header = byte\_stream.read\_from\_format\_instructions\_dict( |
|  |  | cls.HEADER\_FORMAT\_INSTRUCTIONS\_DICT |
|  |  | ) |
|  |  |  |
|  |  | if header['auth\_magic'] != b'openssh-key-v1\x00': |
|  |  | raise ValueError('Not an openssh-key-v1 key') |
|  |  |  |
|  |  | if header['auth\_magic'] != b'openssh-key-v1\x00': |
|  |  | raise ValueError('Not an openssh-key-v1 key') |
|  |  | num\_keys = header['num\_keys'] |
|  |  |  |
|  |  | num\_keys = header['num\_keys'] |
|  |  | if num\_keys < 0: |
|  |  | raise ValueError('Cannot parse negative number of keys') |
|  |  |  |
|  |  | if num\_keys < 0: |
|  |  | raise ValueError('Cannot parse negative number of keys') |
|  |  | public\_key\_list = [] |
|  |  | for i in range(num\_keys): |
|  |  | public\_key\_bytes = byte\_stream.read\_from\_format\_instruction( |
|  |  | PascalStyleFormatInstruction.BYTES |
|  |  | ) |
|  |  | public\_key\_list.append( |
|  |  | PublicKey.from\_bytes(public\_key\_bytes) |
|  |  | ) |
|  |  |  |
|  |  | public\_key\_list = [] |
|  |  | for i in range(num\_keys): |
|  |  | public\_key\_bytes = byte\_stream.read\_from\_format\_instruction( |
|  |  | cipher\_bytes = byte\_stream.read\_from\_format\_instruction( |
|  |  | PascalStyleFormatInstruction.BYTES |
|  |  | ) |
|  |  | public\_key\_list.append( |
|  |  | PublicKey.from\_bytes(public\_key\_bytes) |
|  |  | ) |
|  |  |  |
|  |  | cipher\_bytes = byte\_stream.read\_from\_format\_instruction( |
|  |  | PascalStyleFormatInstruction.BYTES |
|  |  | ) |
|  |  |  |
|  |  | kdf\_class = get\_kdf\_options\_class(header['kdf']) |
|  |  | kdf\_options = kdf\_class( |
|  |  | PascalStyleByteStream( |
|  |  | header['kdf\_options'] |
|  |  | ).read\_from\_format\_instructions\_dict( |
|  |  | kdf\_class.FORMAT\_INSTRUCTIONS\_DICT |
|  |  | kdf\_class = get\_kdf\_options\_class(header['kdf']) |
|  |  | kdf\_options = kdf\_class( |
|  |  | PascalStyleByteStream( |
|  |  | header['kdf\_options'] |
|  |  | ).read\_from\_format\_instructions\_dict( |
|  |  | kdf\_class.FORMAT\_INSTRUCTIONS\_DICT |
|  |  | ) |
|  |  | ) |
|  |  | ) |
|  |  |  |
|  |  | cipher\_class = get\_cipher\_class(header['cipher']) |
|  |  | cipher\_class = get\_cipher\_class(header['cipher']) |
|  |  |  |
|  |  | if kdf\_class == NoneKDFOptions: |
|  |  | passphrase = '' |
|  |  | elif passphrase is None: |
|  |  | passphrase = getpass.getpass('Key passphrase: ') |
|  |  | if kdf\_class == NoneKDFOptions: |
|  |  | passphrase = '' |
|  |  | elif passphrase is None: |
|  |  | passphrase = getpass.getpass('Key passphrase: ') |
|  |  |  |
|  |  | if issubclass(cipher\_class, ConfidentialityIntegrityCipher): |
|  |  | cipher\_bytes += byte\_stream.read\_fixed\_bytes( |
|  |  | cipher\_class.TAG\_LENGTH |
|  |  | ) |
|  |  |  |
|  |  | decipher\_bytes = cipher\_class.decrypt( |
|  |  | kdf\_class(kdf\_options), |
|  |  | passphrase, |
|  |  | cipher\_bytes |
|  |  | ) |
|  |  |  |
|  |  | decipher\_byte\_stream = PascalStyleByteStream(decipher\_bytes) |
|  |  | if issubclass(cipher\_class, ConfidentialityIntegrityCipher): |
|  |  | cipher\_bytes += byte\_stream.read\_fixed\_bytes( |
|  |  | cipher\_class.TAG\_LENGTH |
|  |  | ) |
|  |  |  |
|  |  | decipher\_bytes\_header = \ |
|  |  | decipher\_byte\_stream.read\_from\_format\_instructions\_dict( |
|  |  | cls.DECIPHER\_BYTES\_HEADER\_FORMAT\_INSTRUCTIONS\_DICT |
|  |  | decipher\_bytes = cipher\_class.decrypt( |
|  |  | kdf\_class(kdf\_options), |
|  |  | passphrase, |
|  |  | cipher\_bytes |
|  |  | ) |
|  |  |  |
|  |  | if decipher\_bytes\_header['check\_int\_1'] \ |
|  |  | != decipher\_bytes\_header['check\_int\_2']: |
|  |  | warnings.warn('Cipher header check numbers do not match') |
|  |  | decipher\_byte\_stream = PascalStyleByteStream(decipher\_bytes) |
|  |  |  |
|  |  | initlist = [] |
|  |  | for i in range(num\_keys): |
|  |  | initlist.append( |
|  |  | PublicPrivateKeyPair( |
|  |  | public\_key\_list[i], |
|  |  | PrivateKey.from\_byte\_stream(decipher\_byte\_stream) |
|  |  | ) |
|  |  | ) |
|  |  | if initlist[i].public.header['key\_type'] \ |
|  |  | != initlist[i].private.header['key\_type']: |
|  |  | warnings.warn( |
|  |  | f'Inconsistency between private and public ' |
|  |  | f'key types for key {i}' |
|  |  | decipher\_bytes\_header = \ |
|  |  | decipher\_byte\_stream.read\_from\_format\_instructions\_dict( |
|  |  | cls.DECIPHER\_BYTES\_HEADER\_FORMAT\_INSTRUCTIONS\_DICT |
|  |  | ) |
|  |  | if not all( |
|  |  | ( |
|  |  | initlist[i].public.params[k] == |
|  |  | initlist[i].private.params[k] |
|  |  | ) for k in ( |
|  |  | initlist[i].public.params.keys() & |
|  |  | initlist[i].private.params.keys() |
|  |  |  |
|  |  | if decipher\_bytes\_header['check\_int\_1'] \ |
|  |  | != decipher\_bytes\_header['check\_int\_2']: |
|  |  | warnings.warn('Cipher header check numbers do not match') |
|  |  |  |
|  |  | initlist = [] |
|  |  | for i in range(num\_keys): |
|  |  | initlist.append( |
|  |  | PublicPrivateKeyPair( |
|  |  | public\_key\_list[i], |
|  |  | PrivateKey.from\_byte\_stream(decipher\_byte\_stream) |
|  |  | ) |
|  |  | ) |
|  |  | if initlist[i].public.header['key\_type'] \ |
|  |  | != initlist[i].private.header['key\_type']: |
|  |  | warnings.warn( |
|  |  | f'Inconsistency between private and public ' |
|  |  | f'key types for key {i}' |
|  |  | ) |
|  |  | if not all( |
|  |  | ( |
|  |  | initlist[i].public.params[k] == |
|  |  | initlist[i].private.params[k] |
|  |  | ) for k in ( |
|  |  | initlist[i].public.params.keys() & |
|  |  | initlist[i].private.params.keys() |
|  |  | ) |
|  |  | ): |
|  |  | warnings.warn( |
|  |  | f'Inconsistency between private and public ' |
|  |  | f'values for key {i}' |
|  |  | ) |
|  |  |  |
|  |  | decipher\_padding = decipher\_byte\_stream.read() |
|  |  |  |
|  |  | if ( |
|  |  | len(decipher\_byte\_stream.getvalue()) % |
|  |  | cipher\_class.BLOCK\_SIZE != 0 |
|  |  | ) or not ( |
|  |  | bytes( |
|  |  | range(1, 1 + cipher\_class.BLOCK\_SIZE) |
|  |  | ).startswith(decipher\_padding) |
|  |  | ): |
|  |  | warnings.warn( |
|  |  | f'Inconsistency between private and public ' |
|  |  | f'values for key {i}' |
|  |  | ) |
|  |  |  |
|  |  | decipher\_padding = decipher\_byte\_stream.read() |
|  |  |  |
|  |  | if ( |
|  |  | len(decipher\_byte\_stream.getvalue()) % |
|  |  | cipher\_class.BLOCK\_SIZE != 0 |
|  |  | ) or not ( |
|  |  | bytes( |
|  |  | range(1, 1 + cipher\_class.BLOCK\_SIZE) |
|  |  | ).startswith(decipher\_padding) |
|  |  | ): |
|  |  | warnings.warn('Incorrect padding at end of ciphertext') |
|  |  | warnings.warn('Incorrect padding at end of ciphertext') |
|  |  | except ValueError as e: |
|  |  | raise e |
|  |  | except EOFError as e: |
|  |  | raise ValueError('Premature EOF detected while parsing key.') |
|  |  | except e: |
|  |  | raise ValueError('Unexpected error condition reached.') |
|  |  |  |
|  |  | return cls( |
|  |  | initlist, |
| Expand Down | |  |

23 changes: 23 additions & 0 deletions

23
[tests/fuzzer/fuzz\_b64.py](#diff-96318c1e640ee7a80981be82b6edbcff0bc947414078b956f5f9837ca40169a1 "tests/fuzzer/fuzz_b64.py")

Show comments

[View file](/scottcwang/openssh_key_parser/blob/274447f91b4037b7050ae634879b657554523b39/tests/fuzzer/fuzz_b64.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,23 @@ |
|  |  | #!/usr/bin/env python3.10 |
|  |  |  |
|  |  | import atheris,sys |
|  |  | import sys |
|  |  | with atheris.instrument\_imports(): |
|  |  | #import openssh\_key |
|  |  | from openssh\_key.private\_key\_list import PrivateKeyList |
|  |  |  |
|  |  | @atheris.instrument\_func |
|  |  | def TestOneInput(data): |
|  |  | key = bytes("-----BEGIN OPENSSH PRIVATE KEY-----\nopenssh-key-v1", 'utf-8') \ |
|  |  | + data \ |
|  |  | + bytes("\n-----END OPENSSH PRIVATE KEY-----\n", 'utf-8') |
|  |  | try: |
|  |  | parsed = PrivateKeyList.from\_string(key, None) |
|  |  | except ValueError as e: |
|  |  | if e.args[0] == "Not an openssh private key": |
|  |  | pass |
|  |  |  |
|  |  |  |
|  |  | if \_\_name\_\_ == "\_\_main\_\_": |
|  |  | atheris.Setup(sys.argv, TestOneInput) |
|  |  | atheris.Fuzz() |

27 changes: 27 additions & 0 deletions

27
[tests/fuzzer/fuzz\_valid\_magic.py](#diff-2cfaa9ad7210fc9958d13f5cc57b8db2be8cc3dbdd2ce86dc97787401926fd94 "tests/fuzzer/fuzz_valid_magic.py")

Show comments

[View file](/scottcwang/openssh_key_parser/blob/274447f91b4037b7050ae634879b657554523b39/tests/fuzzer/fuzz_valid_magic.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,27 @@ |
|  |  | #!/usr/bin/env python3.10 |
|  |  |  |
|  |  | import atheris |
|  |  | import sys, re |
|  |  | from base64 import b64encode |
|  |  |  |
|  |  | with atheris.instrument\_imports(): |
|  |  | #import openssh\_key |
|  |  | from openssh\_key.private\_key\_list import PrivateKeyList |
|  |  |  |
|  |  | @atheris.instrument\_func |
|  |  | def TestOneInput(data): |
|  |  | headered\_data = bytes("openssh-key-v1", 'utf-8') |
|  |  | b = bytes("-----BEGIN OPENSSH PRIVATE KEY-----\n", 'utf-8') \ |
|  |  | + re.sub(b"(.{70})", b"\\1\n", b64encode(headered\_data), 0, re.DOTALL) \ |
|  |  | + bytes("\n-----END OPENSSH PRIVATE KEY-----\n", 'utf-8') |
|  |  | key = b.decode("utf-8") |
|  |  | try: |
|  |  | parsed = PrivateKeyList.from\_string(key, None) |
|  |  | except ValueError as e: |
|  |  | if not e.args[0] == "Unexpected error condition reached.": |
|  |  | pass |
|  |  |  |
|  |  |  |
|  |  | if \_\_name\_\_ == "\_\_main\_\_": |
|  |  | atheris.Setup(sys.argv, TestOneInput) |
|  |  | atheris.Fuzz() |

4 changes: 4 additions & 0 deletions

4
[tests/fuzzer/requirements.txt](#diff-a4814156b28cf6301141ac1883c5349c989705c0676d5200b239c455e22db4a2 "tests/fuzzer/requirements.txt")

Show comments

[View file](/scottcwang/openssh_key_parser/blob/274447f91b4037b7050ae634879b657554523b39/tests/fuzzer/requirements.txt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,4 @@ |
|  |  | bcrypt@3.2.2 |
|  |  | cffi@1.15.0 |
|  |  | pycparser@2.21 |
|  |  | atheris@2.0.11 |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `274447f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fcommit%2F274447f91b4037b7050ae634879b657554523b39) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_bdbbb62a_20250115_101810.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fcommit%2F26e0a471e9fdb23e635bc3014cf4cbd2323a08d3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fcommit%2F26e0a471e9fdb23e635bc3014cf4cbd2323a08d3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=scottcwang%2Fopenssh_key_parser)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[scottcwang](/scottcwang)
/
**[openssh\_key\_parser](/scottcwang/openssh_key_parser)**
Public

* [Notifications](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser) You must be signed in to change notification settings
* [Fork
  5](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)
* [Star
   20](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)

* [Code](/scottcwang/openssh_key_parser)
* [Issues
  0](/scottcwang/openssh_key_parser/issues)
* [Pull requests
  0](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects
  0](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

Additional navigation options

* [Code](/scottcwang/openssh_key_parser)
* [Issues](/scottcwang/openssh_key_parser/issues)
* [Pull requests](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

## Commit

[Permalink](/scottcwang/openssh_key_parser/commit/26e0a471e9fdb23e635bc3014cf4cbd2323a08d3)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Changed an exception message to prevent possible disclosures of keyin…

[Browse files](/scottcwang/openssh_key_parser/tree/26e0a471e9fdb23e635bc3014cf4cbd2323a08d3)
Browse the repository at this point in the history

```
…g material.
```

* Loading branch information

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=40&v=4)](/mike-arnica)

[mike-arnica](/scottcwang/openssh_key_parser/commits?author=mike-arnica "View all commits by mike-arnica")
committed
Jun 22, 2022

1 parent
[69fe5b7](/scottcwang/openssh_key_parser/commit/69fe5b7addc21d3f39626ae93c6961811aea9d4c)

commit 26e0a47

Showing
**1 changed file**
with
**2 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[openssh\_key/pascal\_style\_byte\_stream.py](#diff-f7d0259db3b168d6cc26484b1e67eb0b239556295b4b40d6c854daa9afbd7e62 "openssh_key/pascal_style_byte_stream.py")

Show comments

[View file](/scottcwang/openssh_key_parser/blob/26e0a471e9fdb23e635bc3014cf4cbd2323a08d3/openssh_key/pascal_style_byte_stream.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -236,7 +236,8 @@ def read\_fixed\_bytes(self, num\_bytes: int) -> bytes: |
|  |  | """ |
|  |  | read\_bytes = self.read(num\_bytes) |
|  |  | if len(read\_bytes) < num\_bytes: |
|  |  | raise EOFError(read\_bytes) |
|  |  | raise EOFError("Fewer than 'num\_bytes' bytes remaining in the " |
|  |  | "underlying bytestream") |
|  |  | return read\_bytes |
|  |  |  |
|  |  | def read\_pascal\_bytes(self, string\_length\_size: int) -> bytes: |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `26e0a47`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fcommit%2F26e0a471e9fdb23e635bc3014cf4cbd2323a08d3) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c7a34444_20250115_101820.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fpull%2F5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fpull%2F5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=scottcwang%2Fopenssh_key_parser)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[scottcwang](/scottcwang)
/
**[openssh\_key\_parser](/scottcwang/openssh_key_parser)**
Public

* [Notifications](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser) You must be signed in to change notification settings
* [Fork
  5](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)
* [Star
   20](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser)

* [Code](/scottcwang/openssh_key_parser)
* [Issues
  0](/scottcwang/openssh_key_parser/issues)
* [Pull requests
  0](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects
  0](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

Additional navigation options

* [Code](/scottcwang/openssh_key_parser)
* [Issues](/scottcwang/openssh_key_parser/issues)
* [Pull requests](/scottcwang/openssh_key_parser/pulls)
* [Actions](/scottcwang/openssh_key_parser/actions)
* [Projects](/scottcwang/openssh_key_parser/projects)
* [Security](/scottcwang/openssh_key_parser/security)
* [Insights](/scottcwang/openssh_key_parser/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fscottcwang%2Fopenssh_key_parser%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fscottcwang%2Fopenssh_key_parser%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Security review #5

 Merged

[scottcwang](/scottcwang)
merged 4 commits into
[scottcwang:master](/scottcwang/openssh_key_parser/tree/master "scottcwang/openssh_key_parser:master")
from
[mike-arnica:security-review](/mike-arnica/openssh_key_parser/tree/security-review "mike-arnica/openssh_key_parser:security-review")

Jun 25, 2022

 Merged

# [Security review](#top) #5

[scottcwang](/scottcwang)
merged 4 commits into
[scottcwang:master](/scottcwang/openssh_key_parser/tree/master "scottcwang/openssh_key_parser:master")
from
[mike-arnica:security-review](/mike-arnica/openssh_key_parser/tree/security-review "mike-arnica/openssh_key_parser:security-review")

Jun 25, 2022

[Conversation
14](/scottcwang/openssh_key_parser/pull/5)
[Commits
4](/scottcwang/openssh_key_parser/pull/5/commits)
[Checks
0](/scottcwang/openssh_key_parser/pull/5/checks)
[Files changed](/scottcwang/openssh_key_parser/pull/5/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=60&v=4)](/mike-arnica)

Copy link

Contributor

### @mike-arnica **[mike-arnica](/mike-arnica)** commented [Jun 22, 2022](#issue-1280328822)

Hi Scott!

My name is Mike Doyle and I head up security research for Arnica. I was looking at openssh-key-parser for inclusion in one of my products when I noticed your very helpful disclaimer about the library not having been security reviewed.

Security review of cryptography systems is a skill that I possess. Arnica is an Open Software Security Foundation member, and we believe in paying back to the folks who dedicate their time to building the open-source software that we depend on.

I’ve gone ahead and taken the time to review the code for openssh-key-parser and I’ve produced three commits for your consideration in this pull review.

The first changes the content of a raised exception to prevent a possible leak of key material. At present, the parser raises an EOFError when a pascal-style string’s stated length doesn’t agree with the number of bytes read from the keystream. While this condition would be rare under normal operating conditions, there are a few interesting ways that this could happen. One way is that an attacker who can’t read the key but can somehow manipulate its contents either at rest or in transit could corrupt the value of the string length, making it a much larger number than the size of the file. This would raise your EOFError on line 239 of pascal\_style\_byte\_stream.py, which uses the bytes read as the error message.

It's important that I mention that I didn’t find anywhere in your codebase that an attacker could cause the corruption of this value. Such a condition would have to happen elsewhere in the system that uses your parser.

Anyway, the security implication of how this is implemented currently is that if such an attacker can somehow read the exception message, (for instance if the larger system logs unhandled exceptions to a place the attacker can read them,) the error message will contain the remains of the file which naturally includes the keying material in the file.

From here the attacker could use that keying material (which may or may not be passphrase protected) to produce an identical key by merely recreating the header data.

My first commit has a simple fix: it replaces the error message with the same text you use in the docstring. This prevents disclosure of the keying material.

I’ve checked the rest of the code for similar potential disclosures and did not find any.

My second commit adds comprehensive exception handling to PrivateKeyList.from\_bytes. This method’s docstring states that it will raise a ValueError under a few conditions but doesn’t mention the EOFExceptions raised by other methods that from\_bytes calls. I’ve added exception handlers which catch the EOFException and raise a corresponding ValueException to the calling code, and have updated the docstring accordingly. Also, despite there not being any other type of exceptions raised, I’ve added a blanket handler for any other condition which may occur. I think this is a good future-proving step.

Unhandled exceptions are typically more of an operational risk than a security risk, but they can have security implications. See [CVE-2019-11177](https://github.com/advisories/GHSA-695w-cgfw-4hf5 "CVE-2019-11177") for just one example.

I had considered just changing the docstring to declare that from\_bytes might raise an EOFException, but that would create more work for the end user without providing a lot of additional value as best I can tell. The user either wants a parsed key or an error; there’s really little they can do knowing that their key was somehow truncated or contains an internal size disagreement.

I’ve checked the rest of the code and see that you raise NotImplementedErrors in a few places. I’ll let you decide if these should be caught, documented, or left as-is.

My third commit is a bit of a leave-behind. I used the Atheris fuzzer to perform some of this security review and want to contribute the scaffolding that integrates Atheris with your codebase. This can be developed and matured by myself or others in the future.

I hope this helps. Please feel free to reach out to me here on GitHub with any questions or concerns.

Mike Doyle

Head of Security Research, Arnica.io

Sorry, something went wrong.

All reactions

 [mike-arnica](/mike-arnica)
added 3 commits
[June 22, 2022 10:49](#commits-pushed-26e0a47)

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=40&v=4)](/mike-arnica)

`[Changed an exception message to prevent possible disclosures of keyin…](/scottcwang/openssh_key_parser/pull/5/commits/26e0a471e9fdb23e635bc3014cf4cbd2323a08d3 "Changed an exception message to prevent possible disclosures of keying material.")`
 …

`[26e0a47](/scottcwang/openssh_key_parser/pull/5/commits/26e0a471e9fdb23e635bc3014cf4cbd2323a08d3)`

```
…g material.
```

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=40&v=4)](/mike-arnica)

`[Improved error handling to prevent unhandled exceptions in calling code.](/scottcwang/openssh_key_parser/pull/5/commits/d5b53b4b7e76c5b666fc657019dbf864fb04076c "Improved error handling to prevent unhandled exceptions in calling code.")`

`[d5b53b4](/scottcwang/openssh_key_parser/pull/5/commits/d5b53b4b7e76c5b666fc657019dbf864fb04076c)`

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=40&v=4)](/mike-arnica)

`[Added fuzzing scripts](/scottcwang/openssh_key_parser/pull/5/commits/2349be4d4080043a1a76483759429fc89a15fbef "Added fuzzing scripts")`

`[2349be4](/scottcwang/openssh_key_parser/pull/5/commits/2349be4d4080043a1a76483759429fc89a15fbef)`

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=80&v=4)](/scottcwang)

Copy link

Owner

### **[scottcwang](/scottcwang)** commented [Jun 23, 2022](#issuecomment-1163844787)

| Hello Mike,  Thank you for stopping by. I'm quite flattered by your interest, and very grateful indeed for your having taken the time to do a security review on my library.  I gladly accept your contributions and appreciate your corrections to my careless exception handling.  As you suggest, the places where I raise NotImplementedError do need attention -- I've used it to mean variously "todo", "abstract method", or "ValueError", and I will definitely need to be less haphazard.  Thanks for referring me to the Atheris fuzzer; it's new to me, so I'll accept it and put it on my todo list to understand better. In your proposed fuzzer requirements.txt, I see you pinned the openssh-key-parser version to 0.0.2, but the main branch is currently at 0.0.5. Do you see any issues with pinning it to 0.0.5 instead?  More generally, if there's anything you'd be willing to share about your plans for using this library, I'd love to hear it. I admit that this is a side project, sidelined at the moment in favour of a different shiny new toy; but I'd always welcome any general feedback and feature requests for me to prioritise once I eventually turn my attention back here. For example, it's on my todo list to add a new module containing wrappers around signing and verifying ssh signatures, and I'd be interested to know whether this would be part of your use case.  Thanks again,  Scott |
| --- |

 ❤️
1
 eran-medan reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

[![scottcwang](https://avatars.githubusercontent.com/u/8662758?s=60&v=4)](/scottcwang)

**[scottcwang](/scottcwang)**
reviewed
[Jun 23, 2022](#pullrequestreview-1016249019)

 [View reviewed changes](/scottcwang/openssh_key_parser/pull/5/files/2349be4d4080043a1a76483759429fc89a15fbef)

[tests/fuzzer/requirements.txt](/scottcwang/openssh_key_parser/pull/5/files/2349be4d4080043a1a76483759429fc89a15fbef#diff-a4814156b28cf6301141ac1883c5349c989705c0676d5200b239c455e22db4a2)
Outdated

|  |  | @@ -0,0 +1,5 @@ | |
| --- | --- | --- | --- |
|  |  | bcrypt@3.2.2 |
|  |  | cffi@1.15.0 |
|  |  | openssh-key-parser@0.0.2 |

Copy link

Owner

### @scottcwang **[scottcwang](/scottcwang)** [Jun 23, 2022](#discussion_r904456258)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Did you have a reason to pin the library under test to 0.0.2 rather than 0.0.5?

Suggested change

|  | openssh-key-parser@0.0.2 |
| --- | --- |
|  | openssh-key-parser@0.0.5 |

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @mike-arnica **[mike-arnica](/mike-arnica)** [Jun 23, 2022](#discussion_r905441101)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I had a reason during research but not that I think about it, since this file is now included in openssh-key-parser, the inclusion of any version of the package in this requirements file is probably not useful. I would just delete the line entirely.

Sorry, something went wrong.

All reactions

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=80&v=4)](/mike-arnica)

Copy link

Contributor

Author

### **[mike-arnica](/mike-arnica)** commented [Jun 23, 2022](#issuecomment-1164858516)

| Thank you for stopping by. I'm quite flattered by your interest, and very grateful indeed for your having taken the time to do a security review on my library.  You're welcome. I should be grateful that you took the time to develop and share the parser.  I gladly accept your contributions and appreciate your corrections to my careless exception handling.  As you suggest, the places where I raise NotImplementedError do need attention -- I've used it to mean variously "todo", "abstract method", or "ValueError", and I will definitely need to be less haphazard.  Thanks for referring me to the Atheris fuzzer; it's new to me, so I'll accept it and put it on my todo list to understand better.  Atheris took me a little time to learn but I think it's worth it. It is based on the same LibFuzzer that openssh uses.  In your proposed fuzzer requirements.txt, I see you pinned the openssh-key-parser version to 0.0.2, but the main branch is currently at 0.0.5. Do you see any issues with pinning it to 0.0.5 instead?  No issues, in fact now that the file belongs to the project, you probably shouldn't pin it at all. I had originally pinned it to 0.0.2 because, I believe, that's what pypi was giving me by default, but now I see pypi is looking at 0.0.5.  More generally, if there's anything you'd be willing to share about your plans for using this library, I'd love to hear it. I admit that this is a side project, sidelined at the moment in favour of a different shiny new toy; but I'd always welcome any general feedback and feature requests for me to prioritise once I eventually turn my attention back here. For example, it's on my todo list to add a new module containing wrappers around signing and verifying ssh signatures, and I'd be interested to know whether this would be part of your use case.  Sure thing. One of the things we do at Arnica is we search customer repositories for secrets, including OpenSSH private keys. I want the ability to provide additional context to my customers, for example let them know whether their keys are passphrase protected. Python's default cryptography package doesn't give access to this sort of metadata, (as I'm sure you are aware), but I can use your parser to infer this information.  Additionally, I'll be blogging about my approach to this security review because it is illustrative of software supply chain security issues.  Thanks,  Mike Doyle Head of Security Research, Arnica.io |
| --- |

All reactions

Sorry, something went wrong.

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=40&v=4)](/scottcwang)

`[Remove openssh-key-parser](/scottcwang/openssh_key_parser/pull/5/commits/ae4d131d1cd8fe06325bfd6b749305aca60873bf "Remove openssh-key-parser")`

`[ae4d131](/scottcwang/openssh_key_parser/pull/5/commits/ae4d131d1cd8fe06325bfd6b749305aca60873bf)`

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=40&v=4)](/scottcwang)
[scottcwang](/scottcwang)
merged commit [`274447f`](/scottcwang/openssh_key_parser/commit/274447f91b4037b7050ae634879b657554523b39)
into
scottcwang:master

[Jun 25, 2022](https://github.com/scottcwang/openssh_key_parser/pull/5#event-6878311731)

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=80&v=4)](/scottcwang)

Copy link

Owner

### **[scottcwang](/scottcwang)** commented [Jun 25, 2022](#issuecomment-1166184968)

| Thanks Mike! Merged.  I'd definitely be very interested in reading your blog post -- please do pingback here once it's ready.  Scott |
| --- |

All reactions

Sorry, something went wrong.

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=80&v=4)](/mike-arnica)

Copy link

Contributor

Author

### **[mike-arnica](/mike-arnica)** commented [Jun 28, 2022](#issuecomment-1169051389)

| I'll send you a link to it once it's written. By the way, you should advance the version number and maybe edit the disclaimer now ;-) |
| --- |

All reactions

Sorry, something went wrong.

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=80&v=4)](/scottcwang)

Copy link

Owner

### **[scottcwang](/scottcwang)** commented [Jun 30, 2022](#issuecomment-1170769468)

| Hi Mike,  Definitely. I'm doing a bit of general TLC and will release 0.0.6, and I'll credit you in the readme.   1. It turns out that the remainder of the bytes in the `EOFError` raised by `PascalStyleByteStream`'s `read_fixed_bytes` method are being used [here](https://github.com/scottcwang/openssh_key_parser/blob/26e0a471e9fdb23e635bc3014cf4cbd2323a08d3/openssh_key/pascal_style_byte_stream.py#L219=); the parser of arbitrary-length lists of strings needs to know whether the bytestream is exhausted to conclude it has reached the end of the list. I'm making the `EOFError` include a `True`/`False` indication to show whether the bytestream is empty. I don't think an attacker would find this tiny bit of information to be particularly useful -- let me know if you disagree. 2. Just FYI, since I didn't realise this about Python either ... this PR had the catch-all exception handler written as `except e:` [here](https://github.com/scottcwang/openssh_key_parser/pull/5/files#diff-8ef0a57dde7bf143dfe9321c8e23224d86900efdfb7ed9755eb840f67c4b1fd9R343). This actually isn't correct syntax, since the `e` would be parsed as the type of the error to catch, as opposed to a variable name. What we needed was `except BaseException as e:`. 3. One side-effect of having as many `NotImplementedError`s as I did is that they are ignored in the coverage report. So as I replace the `NotImplementedError`s with `ValueError`s, I'm going to need to add some more unit tests :)   Scott |
| --- |

All reactions

Sorry, something went wrong.

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=80&v=4)](/mike-arnica)

Copy link

Contributor

Author

### **[mike-arnica](/mike-arnica)** commented [Jun 30, 2022](#issuecomment-1171529368)

| 1. I agree that the true/false indicator is not particularly useful. 2. You're right, BaseException is the better way to go. Python exception handling can be confusing for me. 3. Sounds right.   Since you're bumping the version it might be good etiquette to produce a [security advisory](https://docs.github.com/en/code-security/repository-security-advisories/about-github-security-advisories-for-repositories) for v0.0.5 and prior. Let me know if you'd like me to write it up for you. |
| --- |

All reactions

Sorry, something went wrong.

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=80&v=4)](/scottcwang)

Copy link

Owner

### **[scottcwang](/scottcwang)** commented [Jul 1, 2022](#issuecomment-1172627118)

| That's a good idea. I took a first stab at writing it up. How's [this](https://github.com/scottcwang/openssh_key_parser/security/advisories/GHSA-hm37-9xh2-q499)? I'd appreciate your advice particularly on the scoring, which I'm not familiar with. |
| --- |

All reactions

Sorry, something went wrong.

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=80&v=4)](/mike-arnica)

Copy link

Contributor

Author

### **[mike-arnica](/mike-arnica)** commented [Jul 5, 2022](#issuecomment-1175138783)

| That's a pretty good advisory write up. You provide a decent amount of detail.  Scoring this issue is difficult. CVSS is made to score vulnerabilities in complete systems, not individual libraries. For example we have to assume that an attacker can stomp on a field length, even though there's no place in *your* code where they could do that. The easiest way to pull off the attack is to modify the field length of the cipher name. It comes right after the AUTH\_MAGIC which is always the same string and always Base-64s the same. If you can execute this regex substitution against the key file, or all the files in the file system:  s/^b3BlbnNzaC1rZXktdjEAA/b3BlbnNzaC1rZXktdjEA8/  you can exploit it. It's one of those things where if it isn't impossible, it's trivial. Similarly, reading the keying material out of the exception log is either impossible or trivial. For this reason, attack complexity is low, even though finding the bug took a lot of effort ;-).  The integrity and availability impacts are none. Technically, if a hypothetical attacker got a key they can impact the integrity and availability of whatever systems that key can log in to, but CVSS just looks at one link in the chain, which here are the keys being parsed. But CVSS sort of recognizes the fact that the key can be used to get to other resources with the "Scope" metric, which here we should set to "Changed" rather than "Unchanged" to accurately reflect this aspect. Since you can get all the keying material, though, the confidentiality is high rather than low.  Everything else looks good.  I've made the appropriate scoring changes to the advisory. Let me know what you think. |
| --- |

All reactions

Sorry, something went wrong.

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=80&v=4)](/mike-arnica)

Copy link

Contributor

Author

### **[mike-arnica](/mike-arnica)** commented [Jul 5, 2022](#issuecomment-1175245529)

| On further review, the attacker would, in all likelihood, need low privileges to read the exception and write to files they can't read. I've updated the score. |
| --- |

All reactions

Sorry, something went wrong.

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=80&v=4)](/scottcwang)

Copy link

Owner

### **[scottcwang](/scottcwang)** commented [Jul 6, 2022](#issuecomment-1175749399)

| Awesome! Your very thorough explanation makes sense and I'm very glad to have your help.  I've gone ahead and published the advisory. Thanks once again! |
| --- |

All reactions

Sorry, something went wrong.

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=80&v=4)](/mike-arnica)

Copy link

Contributor

Author

### **[mike-arnica](/mike-arnica)** commented [Jul 6, 2022](#issuecomment-1176425414)

| Thanks Scott! Here's a link to the blog post: <https://www.arnica.io/blog/hacking-upstream-finding-a-0-day-in-an-openssh-key-parser-library> |
| --- |

All reactions

Sorry, something went wrong.

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=80&v=4)](/scottcwang)

Copy link

Owner

### **[scottcwang](/scottcwang)** commented [Jul 7, 2022](#issuecomment-1176974490)

| Awesome! I'll put a link on the readme.  This has been a productive and wonderful learning experience for me, so I mustn't neglect to tell you how much I've appreciated your leadership of, and support for, my little project and the wider open-source community.  I hope you enjoy using it at Arnica -- please let me know of any new issues you come across. And when in the future I release new functionality that interests you, feel free to come back and pick it apart again. |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fscottcwang%2Fopenssh_key_parser%2Fpull%2F5)

Reviewers

[![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=40&v=4)](/scottcwang) [scottcwang](/scottcwang)

scottcwang left review comments

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@mike-arnica](https://avatars.githubusercontent.com/u/98784212?s=52&v=4)](/mike-arnica) [![@scottcwang](https://avatars.githubusercontent.com/u/8662758?s=52&v=4)](/scottcwang)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


