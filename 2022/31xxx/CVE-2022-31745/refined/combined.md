=== Content from www.mozilla.org_b68de4a0_20250114_201106.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-20

## Security Vulnerabilities fixed in Firefox 101

Announced
May 31, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 101

#### [#CVE-2022-31736: Cross-Origin resource's length leaked](#CVE-2022-31736)

Reporter
Luan Herrera
Impact
high
##### Description

A malicious website could have learned the size of a cross-origin resource that supported Range requests.

##### References

* [Bug 1735923](https://bugzilla.mozilla.org/show_bug.cgi?id=1735923)

#### [#CVE-2022-31737: Heap buffer overflow in WebGL](#CVE-2022-31737)

Reporter
Atte Kettunen
Impact
high
##### Description

A malicious webpage could have caused an out-of-bounds write in WebGL, leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1743767](https://bugzilla.mozilla.org/show_bug.cgi?id=1743767)

#### [#CVE-2022-31738: Browser window spoof using fullscreen mode](#CVE-2022-31738)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When exiting fullscreen mode, an iframe could have confused the browser about the current state of fullscreen, resulting in potential user confusion or spoofing attacks.

##### References

* [Bug 1756388](https://bugzilla.mozilla.org/show_bug.cgi?id=1756388)

#### [#CVE-2022-31739: Attacker-influenced path traversal when saving downloaded files](#CVE-2022-31739)

Reporter
Chaobin Zhang
Impact
high
##### Description

When downloading files on Windows, the % character was not escaped, which could have lead to a download incorrectly being saved to attacker-influenced paths that used variables such as %HOMEPATH% or %APPDATA%.
*This bug only affects Firefox for Windows. Other operating systems are unaffected.*

##### References

* [Bug 1765049](https://bugzilla.mozilla.org/show_bug.cgi?id=1765049)

#### [#CVE-2022-31740: Register allocation problem in WASM on arm64](#CVE-2022-31740)

Reporter
Gary Kwong
Impact
high
##### Description

On arm64, WASM code could have resulted in incorrect assembly generation leading to a register allocation problem, and a potentially exploitable crash.

##### References

* [Bug 1766806](https://bugzilla.mozilla.org/show_bug.cgi?id=1766806)

#### [#CVE-2022-31741: Uninitialized variable leads to invalid memory read](#CVE-2022-31741)

Reporter
Cybeats PSI Team
Impact
high
##### Description

A crafted CMS message could have been processed incorrectly, leading to an invalid memory read, and potentially further memory corruption.

##### References

* [Bug 1767590](https://bugzilla.mozilla.org/show_bug.cgi?id=1767590)

#### [#CVE-2022-31742: Querying a WebAuthn token with a large number of allowCredential entries may have leaked cross-origin information](#CVE-2022-31742)

Reporter
Michal
Impact
moderate
##### Description

An attacker could have exploited a timing attack by sending a large number of allowCredential entries and detecting the difference between invalid key handles and cross-origin key handles. This could have led to cross-origin account linking in violation of WebAuthn goals.

##### References

* [Bug 1730434](https://bugzilla.mozilla.org/show_bug.cgi?id=1730434)

#### [#CVE-2022-31743: HTML Parsing incorrectly ended HTML comments prematurely](#CVE-2022-31743)

Reporter
Linus Särud
Impact
moderate
##### Description

Firefox's HTML parser did not correctly interpret HTML comment tags, resulting in an incongruity with other browsers. This could have been used to escape HTML comments on pages that put user-controlled data in them.

##### References

* [Bug 1747388](https://bugzilla.mozilla.org/show_bug.cgi?id=1747388)

#### [#CVE-2022-31744: CSP bypass enabling stylesheet injection](#CVE-2022-31744)

Reporter
Gertjan
Impact
moderate
##### Description

An attacker could have injected CSS into stylesheets accessible via internal URIs, such as resource:, and in doing so bypass a page's Content Security Policy.

##### References

* [Bug 1757604](https://bugzilla.mozilla.org/show_bug.cgi?id=1757604)

#### [#CVE-2022-31745: Incorrect Assertion caused by unoptimized array shift operations](#CVE-2022-31745)

Reporter
Lukas Bernhard
Impact
moderate
##### Description

If array shift operations are not used, the Garbage Collector may have become confused about valid objects.

##### References

* [Bug 1760944](https://bugzilla.mozilla.org/show_bug.cgi?id=1760944)

#### [#CVE-2022-1919: Memory Corruption when manipulating webp images](#CVE-2022-1919)

Reporter
Irvan Kurniawan
Impact
low
##### Description

An attacker could have caused an uninitialized variable on the stack to be mistakenly freed, causing a potentially exploitable crash.

##### References

* [Bug 1761275](https://bugzilla.mozilla.org/show_bug.cgi?id=1761275)

#### [#CVE-2022-31747: Memory safety bugs fixed in Firefox 101 and Firefox ESR 91.10](#CVE-2022-31747)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Andrew McCreight, Nicolas B. Pierron, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 100 and Firefox ESR 91.9. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 101 and Firefox ESR 91.10](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1760765%2C1765610%2C1766283%2C1767365%2C1768559%2C1768734)

#### [#CVE-2022-31748: Memory safety bugs fixed in Firefox 101](#CVE-2022-31748)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Gabriele Svelto, Timothy Nikkel, Randell Jesup, Jon Coppeard, and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 100. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 101](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1713773%2C1762201%2C1762469%2C1762770%2C1764878%2C1765226%2C1765782%2C1765973%2C1767177%2C1767181%2C1768232%2C1768251%2C1769869)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_d1cee2c2_20250114_201104.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1760944)
* [XML](/show_bug.cgi?ctype=xml&id=1760944)

Closed
[Bug 1760944](/show_bug.cgi?id=1760944)
(CVE-2022-31745)

Opened 3 years ago
Closed 3 years ago

# Disabling shift optimization asserts in js::jit::AssertValidObjectPtr

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Disabling shift optimization asserts in js::jit::AssertValidObjectPtr

## Categories

### (Core :: JavaScript: GC, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%3A%20GC#JavaScript%3A%20GC)

JavaScript: GC
▾

Core :: JavaScript: GC
File bugs here for issues involving the garbage collector (crashes, leaks, etc.), where the issue is *not* one caused by failure to use the JSAPI correctly.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%3A%20GC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%3A%20GC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%3A%20GC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

101 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | [100+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=100%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix) |
| firefox98 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=wontfix) |
| firefox99 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox99&o1=equals&v1=wontfix) |
| firefox100 | [+](/buglist.cgi?f1=cf_tracking_firefox100&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix) |
| firefox101 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr91 | 100+ | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox98 |  | wontfix |
| firefox99 |  | wontfix |
| firefox100 | + | wontfix |
| firefox101 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: lukas.bernhard, Assigned: jandem)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/709c5feed942bf99f098bb24aa1cc86f?d=mm&size=40)  [jandem](/user_profile?user_id=375297)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/59307c6d3ba87d521f5443530ecf72a9?d=mm&size=40)  [lukas.bernhard](/user_profile?user_id=656084)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[l11d-js-fuzzing](/show_bug.cgi?id=1758541 "NEW - [meta] Lukas JavaScript engine Fuzzing")

Dependency [tree](/showdependencytree.cgi?id=1760944&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1760944)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, Whiteboard: [post-critsmash-triage][adv-main101+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-31745

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main101+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [btot](/user_profile?user_id=553429) | [qe-verify](#a1655978_553429 "3 years ago") | - |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Bug 1760944 - Update array length in ArrayShiftMoveElements. r?iain!,jonco!](/attachment.cgi?id=9269223)  [3 years ago](#c6)  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9269223&action=edit) | [Review](/attachment.cgi?id=9269223) |
| --- | --- | --- |
| [advisory.txt](/attachment.cgi?id=9278228)  [3 years ago](#c14)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   191 bytes, text/plain |  | [Details](/attachment.cgi?id=9278228&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [lukas.bernhard](/user_profile?user_id=656084)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1760944#c0)• 3 years ago |
|  | |

Steps to reproduce:

In a non-vanilla version of spidermonkey, I discovered an assertion violation. This bug is filed as the modification to spidermonkey is probably not the root-cause but instead exposes an underlying issue affecting the vanilla engine as well.

When disabling the array shift optimizations in `NativeObject::{tryShiftDenseElements,tryUnshiftDenseElements}` by letting these two function immediately return false, one of the jit-tests (js/src/jit-test/tests/basic/shifted-elements6.js) crashes in `js::jit::AssertValidObjectPtr`.

The crash happens in a small percentage of executions only, hence reproducing the issue might require some repetition.

As @iain pointed out: reproducing the issue in rr is possible if the rr flag --chaos is used.

|  | [lukas.bernhard](/user_profile?user_id=656084)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a67_656084)• 3 years ago |

Group: firefox-core-security → core-securityComponent: Untriaged → JavaScript: GCProduct: Firefox → Core

|  | [Iain Ireland [:iain]](/user_profile?user_id=623993) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1760944#c1)• 3 years ago |
|  | |

Looked into this. I've worked out what's happening, but somebody who knows the GC better than I do will have to figure out the fix.

We fill an array with objects. In a loop, we call shift on the array to remove the objects one by one.

At some point in this loop:

* we start a new major gc
* we pop the array from the mark stack and start marking its children
* with a single child left to mark, our budget runs out
* we push a range (start: 146, end: 147) onto the mark stack
* we return to scripted code and call shift again
* in moveDenseElements, we shift everything over by one (emitting pre-barriers on all elements *except* the last)
* we decrement the initialized length by 1, to 146
* we call GCSlice
* we pop the range off the mark stack
* there are no elements after 146 left to mark, so we skip the range
* the last element is never marked.
* eventually we finalize and poison the last element
* later on we try accessing the poisoned element and crash.

This normally doesn't happen because the shifted elements optimization kicks in instead.

I think the bug is probably in [moveDenseElements](https://searchfox.org/mozilla-central/rev/1659f76981610c1b06437e0a34c0c232b48f4c93/js/src/vm/NativeObject-inl.h#241-267)?

|  | [lukas.bernhard](/user_profile?user_id=656084)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a10913_656084)• 3 years ago |

Blocks: [l11d-js-fuzzing](/show_bug.cgi?id=1758541 "NEW - [meta] Lukas JavaScript engine Fuzzing")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a21048_75935)• 3 years ago |

Group: core-security → javascript-core-security

|  | [Jon Coppeard (:jonco)](/user_profile?user_id=443194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1760944#c2)• 3 years ago |
|  | |

(In reply to Iain Ireland [:iain] from [comment #1](/show_bug.cgi?id=1760944#c1 "RESOLVED FIXED - Disabling shift optimization asserts in js::jit::AssertValidObjectPtr"))

Thanks for the analysis.

> * in moveDenseElements, we shift everything over by one (emitting pre-barriers on all elements *except* the last)

This is a classic incremental marking bug. We move a pointer behind the marking wavefront but don't trigger a barrier on the previous location.

|  | [Jon Coppeard (:jonco)](/user_profile?user_id=443194) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1760944#c3)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1760944&comment_id=15827145 "1 revision") |
|  | |

(In reply to Iain Ireland [:iain] from [comment #1](/show_bug.cgi?id=1760944#c1 "RESOLVED FIXED - Disabling shift optimization asserts in js::jit::AssertValidObjectPtr"))

> * we decrement the initialized length by 1, to 146

Looking at the code, this should trigger the required barrier - NativeObject::setDenseInitializedLengthInternal calls prepareElementRangeForOverwrite. I wonder what's going wrong?

|  | [Iain Ireland [:iain]](/user_profile?user_id=623993) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1760944#c4)• 3 years ago |
|  | |

Oh, I might know the answer to that. In this case, the dense initialized length is [only being updated after we return to jit code](https://searchfox.org/mozilla-central/source/js/src/jit/MacroAssembler.cpp#4472-4475).

|  | [Jon Coppeard (:jonco)](/user_profile?user_id=443194) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1760944#c5)• 3 years ago |
|  | |

(In reply to Iain Ireland [:iain] from [comment #4](/show_bug.cgi?id=1760944#c4 "RESOLVED FIXED - Disabling shift optimization asserts in js::jit::AssertValidObjectPtr"))

Aha, that looks like the problem.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a51426_1689)• 3 years ago |

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a105834_375297)• 3 years ago |

Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a108276_375297)• 3 years ago |

Assignee: nobody → jdemooijStatus: NEW → ASSIGNED

|  | [Steven DeTar [:sdetar]](/user_profile?user_id=607698) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a108507_607698)• 3 years ago |

Severity: -- → S3Priority: -- → P1

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1760944#c6)• 3 years ago |
|  | |

Attached file
[Bug 1760944 - Update array length in ArrayShiftMoveElements. r?iain!,jonco!](attachment.cgi?id=9269223)
— [Details](attachment.cgi?id=9269223&action=edit)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1760944#c7)• 3 years ago |
|  | |

Comment on [attachment 9269223](/attachment.cgi?id=9269223 "Bug 1760944 - Update array length in ArrayShiftMoveElements. r?iain!,jonco!") [[details]](/attachment.cgi?id=9269223&action=edit "Bug 1760944 - Update array length in ArrayShiftMoveElements. r?iain!,jonco!")

[Bug 1760944](/show_bug.cgi?id=1760944 "RESOLVED FIXED - Disabling shift optimization asserts in js::jit::AssertValidObjectPtr") - Update array length in ArrayShiftMoveElements. r?iain!,jonco!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: This fixes some code that was incorrect but this was hidden by a different code path. I think this issue isn't exploitable at the moment.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: All
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: Should apply
* **How likely is this patch to cause regressions; how much testing does it need?**: Low risk
Flags: needinfo?(jdemooij)
[Attachment #9269223](/attachment.cgi?id=9269223&action=edit "Bug 1760944 - Update array length in ArrayShiftMoveElements. r?iain!,jonco!") -
Flags: sec-approval?

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1760944#c8)• 3 years ago |
|  | |

The severity field for this bug is set to S3. However, the bug is flagged with the `sec-high` keyword.

:jandem, could you consider increasing the severity of this security bug?

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#severity_high_security.py).

Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1760944#c9)• 3 years ago |
|  | |

The buggy code path is only reachable if `initializedLength == 1` and that case is barriered in JIT code, so I think this is a sec-moderate rather than a sec-high.

Flags: needinfo?(jdemooij)Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---) → [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a814621_75935)• 3 years ago |

[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=affected)
[status-firefox98](/buglist.cgi?f1=cf_status_firefox98&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=wontfix)
[status-firefox99](/buglist.cgi?f1=cf_status_firefox99&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox99&o1=equals&v1=wontfix)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)
[tracking-firefox100](/buglist.cgi?f1=cf_tracking_firefox100&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox100&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [100+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=100%2B)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1760944#c10)• 3 years ago |
|  | |

Comment on [attachment 9269223](/attachment.cgi?id=9269223 "Bug 1760944 - Update array length in ArrayShiftMoveElements. r?iain!,jonco!") [[details]](/attachment.cgi?id=9269223&action=edit "Bug 1760944 - Update array length in ArrayShiftMoveElements. r?iain!,jonco!")

[Bug 1760944](/show_bug.cgi?id=1760944 "RESOLVED FIXED - Disabling shift optimization asserts in js::jit::AssertValidObjectPtr") - Update array length in ArrayShiftMoveElements. r?iain!,jonco!

sec-approval not needed for moderate

[Attachment #9269223](/attachment.cgi?id=9269223&action=edit "Bug 1760944 - Update array length in ArrayShiftMoveElements. r?iain!,jonco!") -
Flags: sec-approval?

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1760944#c11)• 3 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/5424da694d9274f37d8a6c9777fa9e29bf98389e>

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1760944#c12)• 3 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/5424da694d92>

Group: javascript-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 101 Branch

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1760944#c13)• 3 years ago |
|  | |

This can ride the trains.

[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=wontfix)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a1655978_553429)• 3 years ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a5478919_578488)• 3 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main101+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1760944#c14)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9278228)
— [Details](attachment.cgi?id=9278228&action=edit)

Really not sure how to write this one up....

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a5565544_578488)• 3 years ago |

Alias: CVE-2022-31745

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1760944#a25910783_1689)• 2 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1760944&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


