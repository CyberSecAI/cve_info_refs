=== Content from github.com_eb83c0ee_20250114_202717.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fcommit%2F56e76049185bbd87c994128a9d77735ad7af0199)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fcommit%2F56e76049185bbd87c994128a9d77735ad7af0199)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=DSpace%2FDSpace)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[DSpace](/DSpace)
/
**[DSpace](/DSpace/DSpace)**
Public

* [Notifications](/login?return_to=%2FDSpace%2FDSpace) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2FDSpace%2FDSpace)
* [Star
   919](/login?return_to=%2FDSpace%2FDSpace)

* [Code](/DSpace/DSpace)
* [Issues
  591](/DSpace/DSpace/issues)
* [Pull requests
  164](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects
  0](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

Additional navigation options

* [Code](/DSpace/DSpace)
* [Issues](/DSpace/DSpace/issues)
* [Pull requests](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

## Commit

[Permalink](/DSpace/DSpace/commit/56e76049185bbd87c994128a9d77735ad7af0199)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[DS-4131] Better path handling in ItemImport zips

[Browse files](/DSpace/DSpace/tree/56e76049185bbd87c994128a9d77735ad7af0199)
Browse the repository at this point in the history

* Loading branch information

[![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=40&v=4)](/kshepherd)

[kshepherd](/DSpace/DSpace/commits?author=kshepherd "View all commits by kshepherd")
committed
Jul 26, 2022

1 parent
[73cdff2](/DSpace/DSpace/commit/73cdff26fdc40bb022e21dcfdeefebf28057cde7)

commit 56e7604

Showing
**1 changed file**
with
**30 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

36 changes: 30 additions & 6 deletions

36
[dspace-api/src/main/java/org/dspace/app/itemimport/ItemImport.java](#diff-ea4bbab48bdc48cdae85df0a903e7fbe33ae8b8ff969c537392641cf740fbc85 "dspace-api/src/main/java/org/dspace/app/itemimport/ItemImport.java")

Show comments

[View file](/DSpace/DSpace/blob/56e76049185bbd87c994128a9d77735ad7af0199/dspace-api/src/main/java/org/dspace/app/itemimport/ItemImport.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2003,22 +2003,30 @@ public static String unzip(File zipfile, String destDir) throws IOException { |
|  |  | if (destinationDir == null){ |
|  |  | destinationDir = tempWorkDir; |
|  |  | } |
|  |  | log.debug("Using directory " + destinationDir + " for zip extraction. (destDir arg is " + destDir + |
|  |  | ", tempWorkDir is " + tempWorkDir + ")"); |
|  |  |  |
|  |  | File tempdir = new File(destinationDir); |
|  |  | if (!tempdir.isDirectory()) |
|  |  | { |
|  |  | log.error("'" + ConfigurationManager.getProperty("org.dspace.app.itemexport.work.dir") + |
|  |  | "' as defined by the key 'org.dspace.app.itemexport.work.dir' in dspace.cfg " + |
|  |  | log.error("'" + ConfigurationManager.getProperty("org.dspace.app.batchitemimport.work.dir") + |
|  |  | "' as defined by the key 'org.dspace.app.batchitemimport.work.dir' in dspace.cfg " + |
|  |  | "is not a valid directory"); |
|  |  | } |
|  |  |  |
|  |  | if (!tempdir.exists() && !tempdir.mkdirs()) |
|  |  | { |
|  |  | log.error("Unable to create temporary directory: " + tempdir.getAbsolutePath()); |
|  |  | } |
|  |  | String sourcedir = destinationDir + System.getProperty("file.separator") + zipfile.getName(); |
|  |  | String zipDir = destinationDir + System.getProperty("file.separator") + zipfile.getName() + System.getProperty("file.separator"); |
|  |  |  |
|  |  | if(!destinationDir.endsWith(System.getProperty("file.separator"))) { |
|  |  | destinationDir += System.getProperty("file.separator"); |
|  |  | } |
|  |  |  |
|  |  | String sourcedir = destinationDir + zipfile.getName(); |
|  |  | String zipDir = destinationDir + zipfile.getName() + System.getProperty("file.separator"); |
|  |  |  |
|  |  | log.debug("zip directory to use is " + zipDir); |
|  |  |  |
|  |  | // 3 |
|  |  | String sourceDirForZip = sourcedir; |
| Expand All | | @@ -2028,11 +2036,26 @@ public static String unzip(File zipfile, String destDir) throws IOException { |
|  |  | while (entries.hasMoreElements()) |
|  |  | { |
|  |  | entry = entries.nextElement(); |
|  |  | // Check that the true path to extract files is never outside allowed temp directories |
|  |  | // without creating any actual files on disk |
|  |  | log.debug("Inspecting entry name: " + entry.getName() + " for path traversal security"); |
|  |  | File potentialExtract = new File(zipDir + entry.getName()); |
|  |  | String canonicalPath = potentialExtract.getCanonicalPath(); |
|  |  | log.debug("Canonical path to potential File is " + canonicalPath); |
|  |  | if(!canonicalPath.startsWith(zipDir)) { |
|  |  | log.error("Rejecting zip file: " + zipfile.getName() + " as it contains an entry that would be extracted " + |
|  |  | "outside the temporary unzip directory: " + canonicalPath); |
|  |  | throw new IOException("Error extracting " + zipfile + ": Canonical path of zip entry: " + |
|  |  | entry.getName() + " (" + canonicalPath + ") does not start with permissible temp " + |
|  |  | "unzip directory (" + destinationDir + ")"); |
|  |  | } |
|  |  | if (entry.isDirectory()) |
|  |  | { |
|  |  | if (!new File(zipDir + entry.getName()).mkdir()) |
|  |  | { |
|  |  | // Log error and throw IOException if a directory entry could not be created |
|  |  | File newDir = new File(zipDir + entry.getName()); |
|  |  | if (!newDir.mkdirs()) { |
|  |  | log.error("Unable to create contents directory: " + zipDir + entry.getName()); |
|  |  | throw new IOException("Unable to create contents directory: " + zipDir + entry.getName()); |
|  |  | } |
|  |  | } |
|  |  | else |
| Expand Down  Expand Up | | @@ -2074,6 +2097,7 @@ public static String unzip(File zipfile, String destDir) throws IOException { |
|  |  | byte[] buffer = new byte[1024]; |
|  |  | int len; |
|  |  | InputStream in = zf.getInputStream(entry); |
|  |  | log.debug("Reading " + zipDir + entry.getName() + " into InputStream"); |
|  |  | BufferedOutputStream out = new BufferedOutputStream( |
|  |  | new FileOutputStream(zipDir + entry.getName())); |
|  |  | while((len = in.read(buffer)) >= 0) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `56e7604`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fcommit%2F56e76049185bbd87c994128a9d77735ad7af0199) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e62a271b_20250114_202720.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fsecurity%2Fadvisories%2FGHSA-8rmh-55h4-93h5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fsecurity%2Fadvisories%2FGHSA-8rmh-55h4-93h5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=DSpace%2FDSpace)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[DSpace](/DSpace)
/
**[DSpace](/DSpace/DSpace)**
Public

* [Notifications](/login?return_to=%2FDSpace%2FDSpace) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2FDSpace%2FDSpace)
* [Star
   919](/login?return_to=%2FDSpace%2FDSpace)

* [Code](/DSpace/DSpace)
* [Issues
  591](/DSpace/DSpace/issues)
* [Pull requests
  164](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects
  0](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

Additional navigation options

* [Code](/DSpace/DSpace)
* [Issues](/DSpace/DSpace/issues)
* [Pull requests](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

# Path traversal vulnerability in Simple Archive Format package import (ItemImportService API)

High

[tdonohue](/tdonohue)
published
GHSA-8rmh-55h4-93h5
Jul 29, 2022

## Package

maven

dspace-api
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

4.0 <= 6.3

## Patched versions

6.4, 5.11

## Description

### Impact

ItemImportServiceImpl is vulnerable to a path traversal vulnerability. This means a malicious SAF (simple archive format) package could cause a file/directory to be created anywhere the Tomcat/DSpace user can write to on the server. However, this path traversal vulnerability is only possible by a user with special privileges (either Administrators or someone with command-line access to the server). This vulnerability impacts the XMLUI, JSPUI and command-line.

*This vulnerability does NOT impact 7.x.*

### Patches

*DSpace 6.x:*

* Fixed in 6.4 via commit: [7af52a0](https://github.com/DSpace/DSpace/commit/7af52a0883a9dbc475cf3001f04ed11b24c8a4c0)
* 6.x patch file: <https://github.com/DSpace/DSpace/commit/7af52a0883a9dbc475cf3001f04ed11b24c8a4c0.patch> (may be applied manually if an immediate upgrade to 6.4 or 7.x is not possible)

*DSpace 5.x:*

* Fixed in 5.11 via commit: [56e7604](https://github.com/DSpace/DSpace/commit/56e76049185bbd87c994128a9d77735ad7af0199)
* 5.x patch file: <https://github.com/DSpace/DSpace/commit/56e76049185bbd87c994128a9d77735ad7af0199.patch> (may be applied manually if an immediate upgrade to 5.11 or 6.4 or 7.x is not possible)

#### Apply the patch to your DSpace

If at all possible, we recommend upgrading your DSpace site based on the upgrade instructions. However, if you are unable to do so, you can manually apply the above patches as follows:

1. Download the appropriate patch file to the machine where DSpace is running
2. From the `[dspace-src]` folder, apply the patch, e.g. `git apply [name-of-file].patch`
3. Now, update your DSpace site (based loosely on the Upgrade instructions). This generally involves three steps:
   1. Rebuild DSpace, e.g. `mvn -U clean package` (This will recompile all DSpace code)
   2. Redeploy DSpace, e.g. `ant update` (This will copy all updated WARs / configs to your installation directory). Depending on your setup you also may need to copy the updated WARs over to your Tomcat webapps folder.
   3. Restart Tomcat

### Workarounds

As a basic workaround, you may block all access to the following URL paths:

* If you are using the XMLUI, block all access to `/admin/batchimport` path (this is the URL of the Admin Batch Import tool). Keep in mind, if your site uses the path "/xmlui", then you'd need to block access to `/xmlui/admin/batchimport`.
* If you are using the JSPUI, block all access to `/dspace-admin/batchimport` path (this is the URL of the Admin Batch Import tool). Keep in mind, if your site uses the path "/jspui", then you'd need to block access to `/jspui/dspace-admin/batchimport`.

Keep in mind, only an Administrative user or a user with command-line access to the server is able to import/upload SAF packages. Therefore, assuming those users do not blindly upload untrusted SAF packages, then it is unlikely your site could be impacted by this vulnerability.

### References

Discovered & reported by Johannes Moritz of Ripstech

### For more information

If you have any questions or comments about this advisory:

* Email us at security@dspace.org

### Severity

High

### CVE ID

CVE-2022-31195

### Weaknesses

[CWE-22](/advisories?query=cwe%3A22)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a1f790c8_20250114_202719.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fcommit%2F7af52a0883a9dbc475cf3001f04ed11b24c8a4c0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fcommit%2F7af52a0883a9dbc475cf3001f04ed11b24c8a4c0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=DSpace%2FDSpace)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[DSpace](/DSpace)
/
**[DSpace](/DSpace/DSpace)**
Public

* [Notifications](/login?return_to=%2FDSpace%2FDSpace) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2FDSpace%2FDSpace)
* [Star
   919](/login?return_to=%2FDSpace%2FDSpace)

* [Code](/DSpace/DSpace)
* [Issues
  591](/DSpace/DSpace/issues)
* [Pull requests
  164](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects
  0](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

Additional navigation options

* [Code](/DSpace/DSpace)
* [Issues](/DSpace/DSpace/issues)
* [Pull requests](/DSpace/DSpace/pulls)
* [Actions](/DSpace/DSpace/actions)
* [Projects](/DSpace/DSpace/projects)
* [Security](/DSpace/DSpace/security)
* [Insights](/DSpace/DSpace/pulse)

## Commit

[Permalink](/DSpace/DSpace/commit/7af52a0883a9dbc475cf3001f04ed11b24c8a4c0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[DS-4131] Fix zip import handling to avoid path traversal exploit

[Browse files](/DSpace/DSpace/tree/7af52a0883a9dbc475cf3001f04ed11b24c8a4c0)
Browse the repository at this point in the history

* Loading branch information

[![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=40&v=4)](/kshepherd)

[kshepherd](/DSpace/DSpace/commits?author=kshepherd "View all commits by kshepherd")
committed
Jan 14, 2022

1 parent
[f775845](/DSpace/DSpace/commit/f7758457b7ec3489d525e39aa753cc70809d9ad9)

commit 7af52a0

Showing
**1 changed file**
with
**36 additions**
and
**7 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

43 changes: 36 additions & 7 deletions

43
[dspace-api/src/main/java/org/dspace/app/itemimport/ItemImportServiceImpl.java](#diff-a0724d699b630d0010fffeeb48184642558c117fe3f194e12942531e1fce325e "dspace-api/src/main/java/org/dspace/app/itemimport/ItemImportServiceImpl.java")

Show comments

[View file](/DSpace/DSpace/blob/7af52a0883a9dbc475cf3001f04ed11b24c8a4c0/dspace-api/src/main/java/org/dspace/app/itemimport/ItemImportServiceImpl.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -55,6 +55,8 @@ |
|  |  | import javax.xml.transform.TransformerException; |
|  |  | import java.io.\*; |
|  |  | import java.net.URL; |
|  |  | import java.nio.file.Path; |
|  |  | import java.nio.file.Paths; |
|  |  | import java.sql.SQLException; |
|  |  | import java.text.SimpleDateFormat; |
|  |  | import java.util.\*; |
| Expand Down  Expand Up | | @@ -1630,26 +1632,36 @@ public String unzip(File zipfile, String destDir) throws IOException { |
|  |  | { |
|  |  | log.error("Zip file '" + zipfile.getAbsolutePath() + "' does not exist, or is not readable."); |
|  |  | } |
|  |  | log.debug("Extracting zip at " + zipfile.getAbsolutePath()); |
|  |  |  |
|  |  | String destinationDir = destDir; |
|  |  | if (destinationDir == null){ |
|  |  | destinationDir = tempWorkDir; |
|  |  | } |
|  |  | log.debug("Using directory " + destinationDir + " for zip extraction. (destDir arg is " + destDir + |
|  |  | ", tempWorkDir is " + tempWorkDir + ")"); |
|  |  |  |
|  |  | File tempdir = new File(destinationDir); |
|  |  | if (!tempdir.isDirectory()) |
|  |  | { |
|  |  | log.error("'" + ConfigurationManager.getProperty("org.dspace.app.itemexport.work.dir") + |
|  |  | "' as defined by the key 'org.dspace.app.itemexport.work.dir' in dspace.cfg " + |
|  |  | log.error("'" + ConfigurationManager.getProperty("org.dspace.app.batchitemexport.work.dir") + |
|  |  | "' as defined by the key 'org.dspace.app.batchitemexport.work.dir' in dspace.cfg " + |
|  |  | "is not a valid directory"); |
|  |  | } |
|  |  |  |
|  |  | if (!tempdir.exists() && !tempdir.mkdirs()) |
|  |  | { |
|  |  | log.error("Unable to create temporary directory: " + tempdir.getAbsolutePath()); |
|  |  | } |
|  |  | String sourcedir = destinationDir + System.getProperty("file.separator") + zipfile.getName(); |
|  |  | String zipDir = destinationDir + System.getProperty("file.separator") + zipfile.getName() + System.getProperty("file.separator"); |
|  |  |  |
|  |  | if(!destinationDir.endsWith(System.getProperty("file.separator"))) { |
|  |  | destinationDir += System.getProperty("file.separator"); |
|  |  | } |
|  |  |  |
|  |  | String sourcedir = destinationDir + zipfile.getName(); |
|  |  | String zipDir = destinationDir + zipfile.getName() + System.getProperty("file.separator"); |
|  |  |  |
|  |  | log.debug("zip directory to use is " + zipDir); |
|  |  |  |
|  |  |  |
|  |  | // 3 |
| Expand All | | @@ -1660,11 +1672,27 @@ public String unzip(File zipfile, String destDir) throws IOException { |
|  |  | while (entries.hasMoreElements()) |
|  |  | { |
|  |  | entry = entries.nextElement(); |
|  |  | // Check that the true path to extract files is never outside allowed temp directories |
|  |  | // without creating any actual files on disk |
|  |  | log.debug("Inspecting entry name: " + entry.getName() + " for path traversal security"); |
|  |  | File potentialExtract = new File(zipDir + entry.getName()); |
|  |  | String canonicalPath = potentialExtract.getCanonicalPath(); |
|  |  | log.debug("Canonical path to potential File is " + canonicalPath); |
|  |  | if(!canonicalPath.startsWith(zipDir)) { |
|  |  | log.error("Rejecting zip file: " + zipfile.getName() + " as it contains an entry that would be extracted " + |
|  |  | "outside the temporary unzip directory: " + canonicalPath); |
|  |  | throw new IOException("Error extracting " + zipfile + ": Canonical path of zip entry: " + |
|  |  | entry.getName() + " (" + canonicalPath + ") does not start with permissible temp unzip directory (" + destinationDir + |
|  |  | ")"); |
|  |  | } |
|  |  |  |
|  |  | if (entry.isDirectory()) |
|  |  | { |
|  |  | if (!new File(zipDir + entry.getName()).mkdir()) |
|  |  | { |
|  |  | // Log error and throw IOException if a directory entry could not be created |
|  |  | File newDir = new File(zipDir + entry.getName()); |
|  |  | if (!newDir.mkdirs()) { |
|  |  | log.error("Unable to create contents directory: " + zipDir + entry.getName()); |
|  |  | throw new IOException("Unable to create contents directory: " + zipDir + entry.getName()); |
|  |  | } |
|  |  | } |
|  |  | else |
| Expand All | | @@ -1673,6 +1701,7 @@ public String unzip(File zipfile, String destDir) throws IOException { |
|  |  | log.info("Extracting file: " + entry.getName()); |
|  |  |  |
|  |  | int index = entry.getName().lastIndexOf('/'); |
|  |  | log.debug("Index of " + entry.getName() + " is " + index); |
|  |  | if (index == -1) |
|  |  | { |
|  |  | // Was it created on Windows instead? |
| Expand Down  Expand Up | | @@ -1701,11 +1730,11 @@ public String unzip(File zipfile, String destDir) throws IOException { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | } |
|  |  | byte[] buffer = new byte[1024]; |
|  |  | int len; |
|  |  | InputStream in = zf.getInputStream(entry); |
|  |  | log.debug("Reading " + zipDir + entry.getName() + " into InputStream"); |
|  |  | BufferedOutputStream out = new BufferedOutputStream( |
|  |  | new FileOutputStream(zipDir + entry.getName())); |
|  |  | while((len = in.read(buffer)) >= 0) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 2 comments on commit `7af52a0`

[![@eulereadgbe](https://avatars.githubusercontent.com/u/1877581?s=80&v=4)](/eulereadgbe)

Copy link

### @eulereadgbe **[eulereadgbe](/eulereadgbe)** commented on `[7af52a0](/DSpace/DSpace/commit/7af52a0883a9dbc475cf3001f04ed11b24c8a4c0)` [Dec 6, 2023](#commitcomment-134289172)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It seems that this commit doesn't work in a Windows environment. I just tested this in a fresh install of Windows and the import failed. The log shows this:

`ERROR org.dspace.app.itemimport.ItemImportServiceImpl @ Rejecting zip file: SimpleArchiveFormat.zip as it contains an entry that would be extracted outside the temporary unzip directory: C:\DSpace\imports\SimpleArchiveFormat.zip\SimpleArchiveFormat`

From the command line, it returns this error:

```
java.io.IOException: Error extracting C:\Users\enemiz\Documents\SimpleArchiveFormat.zip: Canonical path of zip entry: SimpleArchiveFormat/ (C:\DSpace\imports\SimpleArchiveFormat.zip\SimpleArchiveFormat) does not start with permissible temp unzip directory (C:\DSpace/imports\)
        at org.dspace.app.itemimport.ItemImportServiceImpl.unzip(ItemImportServiceImpl.java:1685)
        at org.dspace.app.itemimport.ItemImportServiceImpl.unzip(ItemImportServiceImpl.java:1624)
        at org.dspace.app.itemimport.ItemImportServiceImpl.unzip(ItemImportServiceImpl.java:1764)
        at org.dspace.app.itemimport.ItemImportCLITool.main(ItemImportCLITool.java:368)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
        at java.lang.reflect.Method.invoke(Unknown Source)
        at org.dspace.app.launcher.ScriptLauncher.runOneCommand(ScriptLauncher.java:229)
        at org.dspace.app.launcher.ScriptLauncher.main(ScriptLauncher.java:81) java.io.IOException: Error extracting C:\Users\enemiz\Documents\SimpleArchiveFormat.zip: Canonical path of zip entry: SimpleArchiveFormat/ (C:\DSpace\imports\SimpleArchiveFormat.zip\SimpleArchiveFormat) does not start with permissible temp unzip directory (C:\DSpace/imports\)

```

The Batch Import (ZIP) in the web UI doesn't also work.

Using the same zip file, the import was successful when I tested this on a fresh install of Ubuntu.

Sorry, something went wrong.

All reactions

[![@kshepherd](https://avatars.githubusercontent.com/u/194773?s=80&v=4)](/kshepherd)

Copy link

Member

Author

### @kshepherd **[kshepherd](/kshepherd)** commented on `[7af52a0](/DSpace/DSpace/commit/7af52a0883a9dbc475cf3001f04ed11b24c8a4c0)` [Dec 6, 2023](#commitcomment-134289258)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks [@eulereadgbe](https://github.com/eulereadgbe) , I suspect either `System.getProperty("file.separator")` didn't do what we expect for windows, or we're not using it consistently to construct the path

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDSpace%2FDSpace%2Fcommit%2F7af52a0883a9dbc475cf3001f04ed11b24c8a4c0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


