- **Root cause of vulnerability:** The `CILogonOAuthenticator` in `oauthenticator` package verifies user authorization based on the domain of the email address provided by CILogon, but it does not verify the identity provider used by the user. This allows users to log in using a different identity provider (e.g., GitHub) with an email address that matches the allowed domain, even if their access to the intended institution's IdP has been revoked.
- **Weaknesses/vulnerabilities present:**
    - Inadequate verification of the identity provider used for authentication.
    - Trusting user-provided email domains without verifying the origin of the email.
- **Impact of exploitation:** An attacker can bypass the intended authorization mechanism and gain access to JupyterHub by using an arbitrary identity provider (e.g., GitHub) and a matching email domain.
- **Attack vectors:**
    - Attacker creates an account on a different Identity Provider than intended, using an email address within the allowed domain.
    - Attacker uses this account to authenticate with CILogon and gain access to the JupyterHub.
- **Required attacker capabilities/position:**
    - Attacker needs an account with an identity provider supported by CILogon.
    - Attacker needs to be able to set an email address that has a domain that is listed in `allowed_idps`.