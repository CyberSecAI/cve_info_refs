=== Content from next-auth.js.org_35b17149_20250114_225958.html ===

Skip to main contentNextAuth.js is becoming Auth.js! ðŸŽ‰ We're creating Authentication for the Web. Everyone included. You are looking at the NextAuth.js (v4) documentation. For the new documentation go to [authjs.dev](https://authjs.dev).[![NextAuth Logo](/img/logo/logo-xs.png)![NextAuth Logo](/img/logo/logo-xs.png)**NextAuth.js**](/)[Documentation](/getting-started/introduction)[Tutorials](/tutorials)[FAQ](/faq)[Security](/security)[v4](/getting-started/introduction)

* [v4](/configuration/options)
* [v3](/v3/configuration/options)
* [All Releases](https://github.com/nextauthjs/next-auth/releases)
[npm](https://www.npmjs.com/package/next-auth)[GitHub](https://github.com/nextauthjs/next-auth)Search

* [Getting Started](/getting-started/introduction)
  + [Introduction](/getting-started/introduction)
  + [Getting Started](/getting-started/example)
  + [Client API](/getting-started/client)
  + [REST API](/getting-started/rest-api)
  + [TypeScript](/getting-started/typescript)
  + [Upgrade Guide (v4)](/getting-started/upgrade-v4)
* [Configuration](/configuration/initialization)
  + [Initialization](/configuration/initialization)
  + [Options](/configuration/options)
  + [Providers](/configuration/providers/oauth)
  + [Databases](/configuration/databases)
  + [Pages](/configuration/pages)
  + [Callbacks](/configuration/callbacks)
  + [Events](/configuration/events)
  + [Next.js](/configuration/nextjs)
* [Providers](/providers/)
* [Adapters](/adapters)
* [Warnings](/warnings)
* [Errors](/errors)
* [Deployment](/deployment)
* [Guides](/guides/)
* SponsoredLooking for a
  hosted alternative?[Try Clerk â†’](https://go.clerk.com/DefS1u4)

* Configuration
* Options
Version: v4On this page
# Options

## Environment Variables[â€‹](#environment-variables "Direct link to heading")

### NEXTAUTH\_URL[â€‹](#nextauth_url "Direct link to heading")

When deploying to production, set the `NEXTAUTH_URL` environment variable to the canonical URL of your site.

```
NEXTAUTH_URL=https://example.com

```

If your Next.js application uses a custom base path, specify the route to the API endpoint in full. More information about the usage of custom base path [here](/getting-started/client#custom-base-path).

*e.g. `NEXTAUTH_URL=https://example.com/custom-route/api/auth`*

tip

When you're using a custom base path, you will need to pass the `basePath` page prop to the `<SessionProvider>`. More information [here](/getting-started/client#custom-base-path).

note

Using [System Environment Variables](https://vercel.com/docs/concepts/projects/environment-variables#system-environment-variables) we automatically detect when you deploy to [Vercel](https://vercel.com) so you don't have to define this variable. Make sure **Automatically expose System Environment Variables** is checked in your Project Settings.

### NEXTAUTH\_SECRET[â€‹](#nextauth_secret "Direct link to heading")

Used to encrypt the NextAuth.js JWT, and to hash [email verification tokens](https://authjs.dev/guides/creating-a-database-adapter#verification-tokens). This is the default value for the `secret` option in [NextAuth](/configuration/options#secret) and [Middleware](/configuration/nextjs#secret). Alternatively, you can also set `AUTH_SECRET`, which is an alias, and is the preferred naming going forward.

tip

You can run `npx auth secret` - our [CLI](https://cli.authjs.dev) - in your project's root, and it will autogenerate a random value and put it in your `.env.local` file.

### NEXTAUTH\_URL\_INTERNAL[â€‹](#nextauth_url_internal "Direct link to heading")

If provided, server-side calls will use this instead of `NEXTAUTH_URL`. Useful in environments when the server doesn't have access to the canonical URL of your site. Defaults to `NEXTAUTH_URL`.

```
NEXTAUTH_URL_INTERNAL=http://10.240.8.16

```

---

## Options[â€‹](#options "Direct link to heading")

Options are passed to NextAuth.js when initializing it in an API route.

### providers[â€‹](#providers "Direct link to heading")

* **Default value**: `[]`
* **Required**: *Yes*

#### Description[â€‹](#description "Direct link to heading")

An array of authentication providers for signing in (e.g. Google, Facebook, Twitter, GitHub, Email, etc) in any order. This can be one of the built-in providers or an object with a custom provider.

See the [providers documentation](/configuration/providers/oauth) for a list of supported providers and how to use them.

---

### secret[â€‹](#secret "Direct link to heading")

* **Default value**: `string` (*SHA hash of the "options" object*) in development, no default in production.
* **Required**: *Yes, in production!*

#### Description[â€‹](#description-1 "Direct link to heading")

A random string is used to hash tokens, sign/encrypt cookies and generate cryptographic keys.

If you set [`NEXTAUTH_SECRET`](#nextauth_secret) as an environment variable, you don't have to define this option.

If no value is specified in development (and there is no `NEXTAUTH_SECRET` variable either), it uses a hash for all configuration options, including OAuth Client ID / Secrets for entropy.

danger

Not providing any `secret` or `NEXTAUTH_SECRET` will throw [an error](/errors#no_secret) in production.

You can quickly create a good value on the command line via this `openssl` command.

```
$ openssl rand -base64 32

```
tip

If you rely on the default secret generation in development, you might notice JWT decryption errors, since the secret changes whenever you change your configuration. Defining an explicit secret will make this problem go away. We will likely make this option mandatory, even in development, in the future.

---

### session[â€‹](#session "Direct link to heading")

* **Default value**: `object`
* **Required**: *No*

#### Description[â€‹](#description-2 "Direct link to heading")

The `session` object and all properties on it are optional.

Default values for this option are shown below:

```
session: {
  // Choose how you want to save the user session.
  // The default is `"jwt"`, an encrypted JWT (JWE) stored in the session cookie.
  // If you use an `adapter` however, we default it to `"database"` instead.
  // You can still force a JWT session by explicitly defining `"jwt"`.
  // When using `"database"`, the session cookie will only contain a `sessionToken` value,
  // which is used to look up the session in the database.
  strategy: "database",

  // Seconds - How long until an idle session expires and is no longer valid.
  maxAge: 30 * 24 * 60 * 60, // 30 days

  // Seconds - Throttle how frequently to write to database to extend a session.
  // Use it to limit write operations. Set to 0 to always update the database.
  // Note: This option is ignored if using JSON Web Tokens
  updateAge: 24 * 60 * 60, // 24 hours

  // The session token is usually either a random UUID or string, however if you
  // need a more customized session token string, you can define your own generate function.
  generateSessionToken: () => {
    return randomUUID?.() ?? randomBytes(32).toString("hex")
  }
}

```

---

### jwt[â€‹](#jwt "Direct link to heading")

* **Default value**: `object`
* **Required**: *No*

#### Description[â€‹](#description-3 "Direct link to heading")

JSON Web Tokens can be used for session tokens if enabled with `session: { strategy: "jwt" }` option. JSON Web Tokens are enabled by default if you have not specified an adapter. JSON Web Tokens are encrypted (JWE) by default. We recommend you keep this behaviour. See the [Override JWT `encode` and `decode` methods](#override-jwt-encode-and-decode-methods) advanced option.

#### JSON Web Token Options[â€‹](#json-web-token-options "Direct link to heading")

```
jwt: {
  // The maximum age of the NextAuth.js issued JWT in seconds.
  // Defaults to `session.maxAge`.
  maxAge: 60 * 60 * 24 * 30,
  // You can define your own encode/decode functions for signing and encryption
  async encode() {},
  async decode() {},
}

```

An example JSON Web Token contains a payload like this:

```
{
  name: 'Iain Collins',
  email: 'me@iaincollins.com',
  picture: 'https://example.com/image.jpg',
  iat: 1594601838,
  exp: 1597193838
}

```
#### JWT Helper[â€‹](#jwt-helper "Direct link to heading")

You can use the built-in `getToken()` helper method to verify and decrypt the token, like this:

```
import { getToken } from "next-auth/jwt"

const secret = process.env.NEXTAUTH_SECRET

export default async function handler(req, res) {
  // if using `NEXTAUTH_SECRET` env variable, we detect it, and you won't actually need to `secret`
  // const token = await getToken({ req })
  const token = await getToken({ req, secret })
  console.log("JSON Web Token", token)
  res.end()
}

```

*For convenience, this helper function is also able to read and decode tokens passed from the `Authorization: 'Bearer token'` HTTP header.*

**Required**

The getToken() helper requires the following options:

* `req` - (object) Request object
* `secret` - (string) JWT Secret. Use `NEXTAUTH_SECRET` instead.

You must also pass *any options configured on the `jwt` option* to the helper.

e.g. Including custom session `maxAge` and custom signing and/or encryption keys or options

**Optional**

It also supports the following options:

* `secureCookie` - (boolean) Use secure prefixed cookie name

  By default, the helper function will attempt to determine if it should use the secure prefixed cookie (e.g. `true` in production and `false` in development, unless NEXTAUTH\_URL contains an HTTPS URL).
* `cookieName` - (string) Session token cookie name

  The `secureCookie` option is ignored if `cookieName` is explicitly specified.
* `raw` - (boolean) Get raw token (not decoded)

  If set to `true` returns the raw token without decrypting or verifying it.

tip

When using a custom session token `cookieName`, the same name should also be provided to `getToken`. If you are using the Next.js [`withAuth`](/configuration/nextjs#middleware) middleware, you will also need to configure this using the same `cookieName`.

note

The JWT is stored in the Session Token cookie, the same cookie used for tokens with database sessions.

---

### pages[â€‹](#pages "Direct link to heading")

* **Default value**: `{}`
* **Required**: *No*

#### Description[â€‹](#description-4 "Direct link to heading")

Specify URLs to be used if you want to create custom sign in, sign out and error pages.

Pages specified will override the corresponding built-in page.

*For example:*

```
pages: {
  signIn: '/auth/signin',
  signOut: '/auth/signout',
  error: '/auth/error', // Error code passed in query string as ?error=
  verifyRequest: '/auth/verify-request', // (used for check email message)
  newUser: '/auth/new-user' // New users will be directed here on first sign in (leave the property out if not of interest)
}

```
note

When using this configuration, ensure that these pages actually exist. For example `error: '/auth/error'` refers to a page file at `pages/auth/error.js`.

See the documentation for the [pages option](/configuration/pages) for more information.

---

### callbacks[â€‹](#callbacks "Direct link to heading")

* **Default value**: `object`
* **Required**: *No*

#### Description[â€‹](#description-5 "Direct link to heading")

Callbacks are asynchronous functions you can use to control what happens when an action is performed.

Callbacks are extremely powerful, especially in scenarios involving JSON Web Tokens as they allow you to implement access controls without a database and to integrate with external databases or APIs.

You can specify a handler for any of the callbacks below.

```
callbacks: {
  async signIn({ user, account, profile, email, credentials }) {
    return true
  },
  async redirect({ url, baseUrl }) {
    return baseUrl
  },
  async session({ session, token, user }) {
    return session
  },
  async jwt({ token, user, account, profile, isNewUser }) {
    return token
  }
}

```

See the [callbacks documentation](/configuration/callbacks) for more information on how to use the callback functions.

---

### events[â€‹](#events "Direct link to heading")

* **Default value**: `object`
* **Required**: *No*

#### Description[â€‹](#description-6 "Direct link to heading")

Events are asynchronous functions that do not return a response, they are useful for audit logging.

You can specify a handler for any of these events below - e.g. for debugging or to create an audit log.

The content of the message object varies depending on the flow (e.g. OAuth or Email authentication flow, JWT or database sessions, etc). See the [events documentation](/configuration/events) for more information on the form of each message object and how to use the events functions.

```
events: {
  async signIn(message) { /* on successful sign in */ },
  async signOut(message) { /* on signout */ },
  async createUser(message) { /* user created */ },
  async updateUser(message) { /* user updated - e.g. their email was verified */ },
  async linkAccount(message) { /* account (e.g. Twitter) linked to a user */ },
  async session(message) { /* session is active */ },
}

```

---

### adapter[â€‹](#adapter "Direct link to heading")

* **Default value**: none
* **Required**: *No*

#### Description[â€‹](#description-7 "Direct link to heading")

By default NextAuth.js does not include an adapter any longer. If you would like to persist user / account data, please install one of the many available adapters. More information can be found in the [adapter documentation](https://authjs.dev/getting-started/database).

---

### debug[â€‹](#debug "Direct link to heading")

* **Default value**: `false`
* **Required**: *No*

#### Description[â€‹](#description-8 "Direct link to heading")

Set debug to `true` to enable debug messages for authentication and database operations.

---

### logger[â€‹](#logger "Direct link to heading")

* **Default value**: `console`
* **Required**: *No*

#### Description[â€‹](#description-9 "Direct link to heading")

Override any of the logger levels (`undefined` levels will use the built-in logger), and intercept logs in NextAuth.js. You can use this to send NextAuth.js logs to a third-party logging service.

The `code` parameter for `error` and `warn` are explained in the [Warnings](/warnings) and [Errors](/errors) pages respectively.

Example:

/pages/api/auth/[...nextauth].js
```
import log from "logging-service"

export default NextAuth({
  ...
  logger: {
    error(code, metadata) {
      log.error(code, metadata)
    },
    warn(code) {
      log.warn(code)
    },
    debug(code, metadata) {
      log.debug(code, metadata)
    }
  }
  ...
})

```
note

If the `debug` level is defined by the user, it will be called regardless of the `debug: false` [option](#debug).

---

### theme[â€‹](#theme "Direct link to heading")

* **Default value**: `object`
* **Required**: *No*

#### Description[â€‹](#description-10 "Direct link to heading")

Changes the color scheme theme of [pages](/configuration/pages) as well as allows some minor customization. Set `theme.colorScheme` to `"light"`, if you want to force pages to always be light. Set to `"dark"`, if you want to force pages to always be dark. Set to `"auto"`, (or leave this option out) if you want the pages to follow the preferred system theme. (Uses the [prefers-color-scheme](https://developer.mozilla.org/en-US/docs/Web/CSS/%40media/prefers-color-scheme) media query.)

In addition, you can define a logo URL in `theme.logo` which will be rendered above the main card in the default signin/signout/error/verify-request pages, as well as a `theme.brandColor` which will affect the accent color of these pages.

The sign-in button's background color will match the `brandColor` and defaults to `"#346df1"`. The text color is `#fff` by default, but if your brand color gives a weak contrast, correct it with the `buttonText` color option.

```
theme: {
  colorScheme: "auto", // "auto" | "dark" | "light"
  brandColor: "", // Hex color code
  logo: "", // Absolute URL to image
  buttonText: "" // Hex color code
}

```

---

## Advanced Options[â€‹](#advanced-options "Direct link to heading")

Advanced options are passed the same way as basic options, but may have complex implications or side effects. You should try to avoid using advanced options unless you are very comfortable using them.

---

### useSecureCookies[â€‹](#usesecurecookies "Direct link to heading")

* **Default value**: `true` for HTTPS sites / `false` for HTTP sites
* **Required**: *No*

#### Description[â€‹](#description-11 "Direct link to heading")

When set to `true` (the default for all site URLs that start with `https://`) then all cookies set by NextAuth.js will only be accessible from HTTPS URLs.

This option defaults to `false` on URLs that start with `http://` (e.g. `http://localhost:3000`) for developer convenience.

note

Properties on any custom `cookies` that are specified override this option.

danger

Setting this option to *false* in production is a security risk and may allow sessions to be hijacked if used in production. It is intended to support development and testing. Using this option is not recommended.

---

### cookies[â€‹](#cookies "Direct link to heading")

* **Default value**: `{}`
* **Required**: *No*

#### Description[â€‹](#description-12 "Direct link to heading")

Cookies in NextAuth.js are chunked by default, meaning that once they reach the 4kb limit, we will create a new cookie with the `.{number}` suffix and reassemble the cookies in the correct order when parsing / reading them. This was introduced to avoid size constraints which can occur when users want to store additional data in their sessionToken, for example.

You can override the default cookie names and options for any of the cookies used by NextAuth.js.

This is an advanced option and using it is not recommended as you may break authentication or introduce security flaws into your application.

You can specify one or more cookies with custom properties, but if you specify custom options for a cookie you must provide all the options for that cookie.

If you use this feature, you will likely want to create conditional behaviour to support setting different cookies policies in development and production builds, as you will be opting out of the built-in dynamic policy.

tip

An example of a use case for this option is to support sharing session tokens across subdomains.

#### Example[â€‹](#example "Direct link to heading")

```
cookies: {
  sessionToken: {
    name: `__Secure-next-auth.session-token`,
    options: {
      httpOnly: true,
      sameSite: 'lax',
      path: '/',
      secure: true
    }
  },
  callbackUrl: {
    name: `__Secure-next-auth.callback-url`,
    options: {
      sameSite: 'lax',
      path: '/',
      secure: true
    }
  },
  csrfToken: {
    name: `__Host-next-auth.csrf-token`,
    options: {
      httpOnly: true,
      sameSite: 'lax',
      path: '/',
      secure: true
    }
  },
  pkceCodeVerifier: {
    name: `${cookiePrefix}next-auth.pkce.code_verifier`,
    options: {
      httpOnly: true,
      sameSite: 'lax',
      path: '/',
      secure: true,
      maxAge: 900
    }
  },
  state: {
    name: `${cookiePrefix}next-auth.state`,
    options: {
      httpOnly: true,
      sameSite: "lax",
      path: "/",
      secure: true,
      maxAge: 900
    },
  },
  nonce: {
    name: `${cookiePrefix}next-auth.nonce`,
    options: {
      httpOnly: true,
      sameSite: "lax",
      path: "/",
      secure: true,
    },
  },
}

```
danger

Using a custom cookie policy may introduce security flaws into your application and is intended as an option for advanced users who understand the implications. Using this option is not recommended.

---

### Override JWT `encode` and `decode` methods[â€‹](#override-jwt-encode-and-decode-methods "Direct link to heading")

NextAuth.js uses encrypted JSON Web Tokens ([JWE](https://datatracker.ietf.org/doc/html/rfc7516)) by default. Unless you have a good reason, we recommend keeping this behaviour. Although you can override this using the `encode` and `decode` methods. Both methods must be defined at the same time.

**IMPORTANT: If you use middleware to protect routes, make sure the same method is also set in the [`_middleware.ts` options](/configuration/nextjs#custom-jwt-decode-method)**

```
jwt: {
  async encode(params: {
    token: JWT
    secret: string
    maxAge: number
  }): Promise<string> {
    // return a custom encoded JWT string
    return "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
  },
  async decode(params: {
    token: string
    secret: string
  }): Promise<JWT | null> {
    // return a `JWT` object, or `null` if decoding failed
    return {}
  },
}

```
[Edit this page](https://github.com/nextauthjs/next-auth/edit/v4/docs/docs/configuration/options.md)Last updated on **Oct 24, 2024** by **BalÃ¡zs OrbÃ¡n**[PreviousInitialization](/configuration/initialization)[NextOAuth](/configuration/providers/oauth)

* [Environment Variables](#environment-variables)
  + [NEXTAUTH\_URL](#nextauth_url)
  + [NEXTAUTH\_SECRET](#nextauth_secret)
  + [NEXTAUTH\_URL\_INTERNAL](#nextauth_url_internal)
* [Options](#options)
  + [providers](#providers)
  + [secret](#secret)
  + [session](#session)
  + [jwt](#jwt)
  + [pages](#pages)
  + [callbacks](#callbacks)
  + [events](#events)
  + [adapter](#adapter)
  + [debug](#debug)
  + [logger](#logger)
  + [theme](#theme)
* [Advanced Options](#advanced-options)
  + [useSecureCookies](#usesecurecookies)
  + [cookies](#cookies)
  + [Override JWT `encode` and `decode` methods](#override-jwt-encode-and-decode-methods)
About NextAuth.js

* [Introduction](/getting-started/introduction)
Download

* [GitHub](https://github.com/nextauthjs/next-auth)
* [NPM](https://www.npmjs.com/package/next-auth)
Acknowledgements

* [Contributors](/contributors)
* [Sponsors](/sponsors)
* [Images by unDraw](https://undraw.co/)
NextAuth.js Â© Iain Collins 2025



=== Content from next-auth.js.org_e227f704_20250114_225958.html ===

Skip to main contentNextAuth.js is becoming Auth.js! ðŸŽ‰ We're creating Authentication for the Web. Everyone included. You are looking at the NextAuth.js (v4) documentation. For the new documentation go to [authjs.dev](https://authjs.dev).[![NextAuth Logo](/img/logo/logo-xs.png)![NextAuth Logo](/img/logo/logo-xs.png)**NextAuth.js**](/)[Documentation](/getting-started/introduction)[Tutorials](/tutorials)[FAQ](/faq)[Security](/security)[v4](/getting-started/introduction)

* [v4](/getting-started/upgrade-v4)
* [v3](/v3/getting-started/introduction)
* [All Releases](https://github.com/nextauthjs/next-auth/releases)
[npm](https://www.npmjs.com/package/next-auth)[GitHub](https://github.com/nextauthjs/next-auth)Search

* [Getting Started](/getting-started/introduction)
  + [Introduction](/getting-started/introduction)
  + [Getting Started](/getting-started/example)
  + [Client API](/getting-started/client)
  + [REST API](/getting-started/rest-api)
  + [TypeScript](/getting-started/typescript)
  + [Upgrade Guide (v4)](/getting-started/upgrade-v4)
* [Configuration](/configuration/initialization)
* [Providers](/providers/)
* [Adapters](/adapters)
* [Warnings](/warnings)
* [Errors](/errors)
* [Deployment](/deployment)
* [Guides](/guides/)
* SponsoredLooking for a
  hosted alternative?[Try Clerk â†’](https://go.clerk.com/DefS1u4)

* Getting Started
* Upgrade Guide (v4)
Version: v4On this page
# Upgrade Guide (v4)

NextAuth.js version 4 includes a few breaking changes from the last major version (3.x). So we're here to help you upgrade your applications as smoothly as possible. It should be possible to upgrade from any version of 3.x to the latest 4 release by following the next few migration steps.

note

Version 4 has been released to GA ðŸš¨

We encourage users to try it out and report any and all issues they come across.

You can upgrade to the new version by running:

* npm
* yarn
* pnpm

```
npm install next-auth
```
```
yarn add next-auth
```
```
pnpm add next-auth
```
## `next-auth/jwt`[â€‹](#next-authjwt "Direct link to heading")

We no longer have a default export in `next-auth/jwt`.
To comply with this, change the following:

```
- import jwt from "next-auth/jwt"
+ import { getToken } from "next-auth/jwt"

```
## `next-auth/react`[â€‹](#next-authreact "Direct link to heading")

We've renamed the client-side import source to `next-auth/react`. To comply with this change, you will simply have to rename anywhere you were using `next-auth/client`.

For example:

```
- import { useSession } from "next-auth/client"
+ import { useSession } from "next-auth/react"

```

We've also made the following changes to the names of the exports:

* `setOptions`: Not exposed anymore, use [`SessionProvider` props](https://next-auth.js.org/getting-started/client#options)
* `options`: Not exposed anymore, [use `SessionProvider` props](https://next-auth.js.org/getting-started/client#options)
* `session`: Renamed to `getSession`
* `providers`: Renamed to `getProviders`
* `csrfToken`: Renamed to `getCsrfToken`
* `signin`: Renamed to `signIn`
* `signout`: Renamed to `signOut`
* `Provider`: Renamed to `SessionProvider`

Introduced in <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.12>

## `SessionProvider`[â€‹](#sessionprovider "Direct link to heading")

Version 4 makes using the `SessionProvider` mandatory. This means that you will have to wrap any part of your application using `useSession` in this provider, if you were not doing so already. The `SessionProvider` has also undergone a few further changes:

* `Provider` is renamed to `SessionProvider`
* The options prop is now flattened as the props of SessionProvider.
* `keepAlive` has been renamed to `refetchInterval`.
* `clientMaxAge` has been removed in favor of `refetchInterval`, as they overlap in functionality, with the difference that `refetchInterval` will keep re-fetching the session periodically in the background.

The best practice for wrapping your app in Providers is to do so in your `pages/_app.jsx` file.

An example use-case with these new changes:

```
import { SessionProvider } from "next-auth/react"

export default function App({
  Component,
  pageProps: { session, ...pageProps },
}) {
  return (
    // `session` comes from `getServerSideProps` or `getInitialProps`.
    // Avoids flickering/session loading on first load.
    <SessionProvider session={session} refetchInterval={5 * 60}>
      <Component {...pageProps} />
    </SessionProvider>
  )
}

```

Introduced in <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.12>

## Providers[â€‹](#providers "Direct link to heading")

Providers now need to be imported individually.

```
- import Provider from "next-auth/providers"
- Providers.Auth0({...})
- Providers.Google({...})
+ import Auth0Provider from "next-auth/providers/auth0"
+ import GoogleProvider from "next-auth/providers/google"
+ Auth0Provider({...})
+ GoogleProvider({...})

```

1. The `AzureADB2C` provider has been renamed `AzureAD`.
2. The `Basecamp` provider has been removed, see explanation [here](https://github.com/basecamp/api/blob/master/sections/authentication.md#on-authenticating-users-via-oauth).
3. The GitHub provider by default now will not request full write access to user profiles. If you need this scope, please add `user` to the scope option manually.

The following new options are available when defining your Providers in the configuration:

1. `authorization` (replaces `authorizationUrl`, `authorizationParams`, `scope`)
2. `token` replaces (`accessTokenUrl`, `headers`, `params`)
3. `userinfo` (replaces `profileUrl`)
4. `issuer`(replaces `domain`)

For more details on their usage, please see [options](/configuration/providers/oauth#options) section of the OAuth Provider documentation.

When submitting a new OAuth provider to the repository, the `profile` callback is expected to only return these fields from now on: `id`, `name`, `email`, and `image`. If any of these are missing values, they should be set to `null`.

Also worth noting is that `id` is expected to be returned as a `string` type (For example if your provider returns it as a number, you can cast it by using the `.toString()` method). This makes the returned profile object comply across all providers/accounts/adapters, and hopefully cause less confusion in the future.

Implemented in: [#2411](https://github.com/nextauthjs/next-auth/pull/2411)
Introduced in <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.20>

## `useSession` Hook[â€‹](#usesession-hook "Direct link to heading")

The `useSession` hook has been updated to return an object. This allows you to test states much more cleanly with the new `status` option.

```
- const [ session, loading ] = useSession()
+ const { data: session, status } = useSession()
+ const loading = status === "loading"

```

[Check the docs](https://next-auth.js.org/getting-started/client#usesession) for the possible values of both `session.status` and `session.data`.

Introduced in <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.18>

## Named Parameters[â€‹](#named-parameters "Direct link to heading")

We have changed the arguments to our callbacks to the named parameters pattern. This way you don't have to use dummy `_` placeholders or other tricks.

### Callbacks[â€‹](#callbacks "Direct link to heading")

The signatures for the callback methods now look like this:

```
- signIn(user, account, profileOrEmailOrCredentials)
+ signIn({ user, account, profile, email, credentials })

```
```
- redirect(url, baseUrl)
+ redirect({ url, baseUrl })

```
```
- session(session, tokenOrUser)
+ session({ session, token, user })

```
```
- jwt(token, user, account, OAuthProfile, isNewUser)
+ jwt({ token, user, account, profile, isNewUser })

```

Introduced in <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.17>

### Events[â€‹](#events "Direct link to heading")

Two event signatures have changed to also use the named parameters pattern, `signOut` and `updateUser`.

```
// [...nextauth].js
...
events: {
- signOut(tokenOrSession),
+ signOut({ token, session }), // token if using JWT, session if DB persisted sessions.
- updateUser(user)
+ updateUser({ user })
}

```

Introduced in <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.20>

## JWT configuration[â€‹](#jwt-configuration "Direct link to heading")

We have removed some of the [configuration options](/configuration/options) when using JSON Web Tokens, [here's the PR](https://github.com/nextauthjs/next-auth/pull/3039) for more context.

```
export default NextAuth({
  // ...
  jwt: {
    secret,
    maxAge,
-   encryptionKey
-   signingKey
-   encryptionKey
-   verificationOptions
    encode({
        token
        secret
        maxAge
-       signingKey
-       signingOptions
-       encryptionKey
-       encryptionOptions
-       encryption
    }) {},
    decode({
        token
        secret
-       maxAge
-       signingKey
-       verificationKey
-       verificationOptions
-       encryptionKey
-       decryptionKey
-       decryptionOptions
-       encryption
    }) {}
  }
})

```
## Logger API[â€‹](#logger-api "Direct link to heading")

The logger API has been simplified to use at most two parameters, where the second is usually an object (`metadata`) containing an `error` object. If you are not using the logger settings you can ignore this change.

```
// [...nextauth.js]
import log from "some-logger-service"
...
logger: {
- error(code, ...message) {},
+ error(code, metadata) {},
- warn(code, ...message) {},
+ warn(code) {}
- debug(code, ...message) {}
+ debug(code, metadata) {}
}

```

Introduced in <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.19>

## `nodemailer`[â€‹](#nodemailer "Direct link to heading")

Like `typeorm` and `prisma`, [`nodemailer`](https://npmjs.com/package/nodemailer) is no longer included as a dependency by default. If you are using the Email provider you must install it in your project manually, or use any other Email library in the [`sendVerificationRequest`](/configuration/providers/email#options-1#:~:text=sendVerificationRequest) callback. This reduces bundle size for those not actually using the Email provider. Remember, when using the Email provider, it is mandatory to also use a database adapter due to the fact that verification tokens need to be persisted longer term for the magic link functionality to work.

Introduced in <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.2>

## Theme[â€‹](#theme "Direct link to heading")

We have added some basic customization options to our built-in pages like `signin`, `signout`, etc.

These can be set under the `theme` configuration key. This used to be a string which only controlled the color scheme option. Now it is an object with the following options:

```
theme: {
  colorScheme: "auto", // "auto" | "dark" | "light"
  brandColor: "", // Hex color value
  logo: "" // Absolute URL to logo image
}

```

The hope is that with some minimal configuration / customization options, users won't immediately feel the need to replace the built-in pages with their own.

More details and screenshots of the new theme options can be found under [configuration/pages](https://next-auth.js.org/configuration/pages#theming).

Introduced in [#2788](https://github.com/nextauthjs/next-auth/pull/2788)

## Session[â€‹](#session "Direct link to heading")

The `session.jwt: boolean` option has been renamed to `session.strategy: "jwt" | "database"`. The goal is to make the user's options more intuitive:

1. No adapter, `strategy: "jwt"`: This is the default. The session is saved in a cookie and never persisted anywhere.
2. With Adapter, `strategy: "database"`: If an Adapter is defined, this will be the implicit setting. No user config is needed.
3. With Adapter, `strategy: "jwt"`: The user can explicitly instruct `next-auth` to use JWT even if a database is available. This can result in faster lookups in compromise of lowered security. Read more about: <https://next-auth.js.org/faq#json-web-tokens>

Example:

```
session: {
- jwt: true,
+ strategy: "jwt",
}

```

Introduced in [#3144](https://github.com/nextauthjs/next-auth/pull/3144)

## Adapters[â€‹](#adapters "Direct link to heading")

Most importantly, the core `next-auth` package no longer ships with `typeorm` or any other database adapter by default. This brings the default bundle size down significantly for those not needing to persist user data to a database.

You can find the official Adapters in the `packages` directory in the primary monorepo ([nextauthjs/next-auth](https://github.com/nextauthjs/next-auth)). Although you can still [create your own](/tutorials/creating-a-database-adapter) with a new, [simplified Adapter API](https://github.com/nextauthjs/next-auth/pull/2361).

If you have a database that was created with a `3.x.x` or earlier version of NextAuth.js, you will need to run a migration to update the schema to the new version 4 database model. See the bottom of this migration guide for database specific migration examples.

1. If you use the built-in TypeORM or Prisma adapters, these have been removed from the core `next-auth` package. Thankfully the migration is easy; you just need to install the external packages for your database and change the import in your `[...nextauth].js`.

The `database` option has been removed, you must now do the following instead:

```
// [...nextauth].js
import NextAuth from "next-auth"
+ import { TypeORMLegacyAdapter } from "@next-auth/typeorm-legacy-adapter"

...
export default NextAuth({
-  database: "yourconnectionstring",
+  adapter: TypeORMLegacyAdapter("yourconnectionstring")
})

```

2. The `prisma-legacy` adapter has been removed, please use the [`@next-auth/prisma-adapter`](https://npmjs.com/package/%40next-auth/prisma-adapter) instead.
3. The `typeorm-legacy` adapter has been upgraded to use the newer adapter API, but has retained the `typeorm-legacy` name. We aim to migrate this to individual lighter weight adapters for each database type in the future, or switch out `typeorm`.
4. MongoDB has been moved to its own adapter under `@next-auth/mongodb-adapter`. See the [MongoDB Adapter docs](https://authjs.dev/getting-started/adapters/mongodb).

Introduced in <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.8> and [#2361](https://github.com/nextauthjs/next-auth/pull/2361)

### Adapter API[â€‹](#adapter-api "Direct link to heading")

**This does not require any changes from the user - these are adapter specific changes only**

The Adapter API has been rewritten and significantly simplified in NextAuth.js v4. The adapters now have less work to do as some functionality has been migrated to the core of NextAuth, like hashing the [verification token](https://authjs.dev/concepts/database-models#verificationtoken).

If you are an adapter maintainer or are interested in writing your own adapter, you can find more information about this change in [#2361](https://github.com/nextauthjs/next-auth/pull/2361) and release <https://github.com/nextauthjs/next-auth/releases/tag/v4.0.0-next.22>.

### Schema changes[â€‹](#schema-changes "Direct link to heading")

The way we save data with adapters have slightly changed. With the new Adapter API, we wanted to make it easier to extend your database with additional fields. For example if your User needs an extra `phone` field, it should be enough to add that to your database's schema, and no changes will be necessary in your adapter.

* `created_at`/`createdAt` and `updated_at`/`updatedAt` fields are removed from all Models.
* `user_id`/`userId` consistently named `userId`.
* `compound_id`/`compoundId` is removed from Account.
* `access_token`/`accessToken` is removed from Session.
* `email_verified`/`emailVerified` on User is consistently named `emailVerified`.
* `provider_id`/`providerId` renamed to `provider` on Account
* `provider_type`/`providerType` renamed to `type` on Account
* `provider_account_id`/`providerAccountId` on Account is consistently named `providerAccountId`
* `access_token_expires`/`accessTokenExpires` on Account renamed to `expires_at`
* New fields on Account: `token_type`, `scope`, `id_token`, `session_state`
* `verification_requests` table has been renamed to `verification_tokens`

See the changes
```

```
User {
  id
  name
  email
+ emailVerified
- email_verified
  image
-  created_at
-  updated_at
}

Account {
  id
- compound_id
- user_id
+ userId
-  provider_type
+ type
- provider_id
+ provider
- provider_account_id
+ providerAccountId
  refresh_token
  access_token
- access_token_expires
+ expires_in
+ expires_at
+ token_type
+ scope
+ id_token
+ session_state
- created_at
- updated_at
}

Session {
  id
  userId
  expires
  sessionToken
- access_token
- created_at
- updated_at
}

VerificationToken {
  id
  token
  expires
  identifier
-  created_at
-  updated_at
}

```

```

For more info, see the [Models page](https://authjs.dev/concepts/database-models).

### Database migration[â€‹](#database-migration "Direct link to heading")

NextAuth.js v4 has a slightly different database schema compared to v3. If you're using any of our adapters and want to upgrade, you can use on of the below schemas.

They are designed to be run directly against the database itself. So instead of having one in Prisma syntax, one in TypeORM syntax, etc. we've decided to just make one for each underlying database type. i.e. one for Postgres, one for MySQL, one for MongoDB, etc.

#### MySQL[â€‹](#mysql "Direct link to heading")

```
/* ACCOUNT */
ALTER TABLE accounts
CHANGE "access_token_expires" "expires_at" int
CHANGE "user_id" "userId" varchar(255)
ADD CONSTRAINT fk_user_id FOREIGN KEY (userId) REFERENCES users(id)
RENAME COLUMN "provider_id" "provider"
RENAME COLUMN "provider_account_id" "providerAccountId"
DROP COLUMN "provider_type"
DROP COLUMN "compound_id"
/* The following two timestamp columns have never been necessary for NextAuth.js to function, but can be kept if you want */
DROP COLUMN "created_at"
DROP COLUMN "updated_at"

ADD COLUMN "token_type" varchar(255) NULL
ADD COLUMN "scope" varchar(255) NULL
ADD COLUMN "id_token" varchar(255) NULL
ADD COLUMN "session_state" varchar(255) NULL

/* Note: These are only needed if you're going to be using the old Twitter OAuth 1.0 provider. */
ADD COLUMN "oauth_token_secret" varchar(255) NULL
ADD COLUMN "oauth_token" varchar(255) NULL

/* USER */
ALTER TABLE users
RENAME COLUMN "email_verified" "emailVerified"
/* The following two timestamp columns have never been necessary for NextAuth.js to function, but can be kept if you want */
DROP COLUMN "created_at"
DROP COLUMN "updated_at"

/* SESSION */
ALTER TABLE sessions
RENAME COLUMN "session_token" "sessionToken"
CHANGE "user_id" "userId" varchar(255)
ADD CONSTRAINT fk_user_id FOREIGN KEY (userId) REFERENCES users(id)
DROP COLUMN "access_token"
/* The following two timestamp columns have never been necessary for NextAuth.js to function, but can be kept if you want */
DROP COLUMN "created_at"
DROP COLUMN "updated_at"

/* VERIFICATION REQUESTS */
ALTER TABLE verification_requests RENAME verification_tokens
ALTER TABLE verification_tokens
DROP COLUMN id
/* The following two timestamp columns have never been necessary for NextAuth.js to function, but can be kept if you want */
DROP COLUMN "created_at"
DROP COLUMN "updated_at"

```
#### Postgres[â€‹](#postgres "Direct link to heading")

```
/* ACCOUNT */
ALTER TABLE accounts RENAME COLUMN "user_id" TO "userId";
ALTER TABLE accounts RENAME COLUMN "provider_id" TO "provider";
ALTER TABLE accounts RENAME COLUMN "provider_account_id" TO "providerAccountId";
ALTER TABLE accounts RENAME COLUMN "access_token_expires" TO "expires_at";
ALTER TABLE accounts RENAME COLUMN "provider_type" TO "type";

/* Do conversion of TIMESTAMPTZ to BIGINT */
ALTER TABLE accounts ALTER COLUMN "expires_at" TYPE TEXT USING CAST(extract(epoch FROM "expires_at") AS BIGINT)*1000;

/* Keep id as SERIAL with autoincrement when using ORM. Using new v4 uuid format won't work because of incompatibility */
/* ALTER TABLE accounts ALTER COLUMN "id" TYPE TEXT; */
/* ALTER TABLE accounts ALTER COLUMN "userId" TYPE TEXT; */
ALTER TABLE accounts ALTER COLUMN "type" TYPE TEXT;
ALTER TABLE accounts ALTER COLUMN "provider" TYPE TEXT;
ALTER TABLE accounts ALTER COLUMN "providerAccountId" TYPE TEXT;

ALTER TABLE accounts ADD CONSTRAINT fk_user_id FOREIGN KEY ("userId") REFERENCES users(id);
ALTER TABLE accounts
DROP COLUMN IF EXISTS "compound_id";
/* The following two timestamp columns have never been necessary for NextAuth.js to function, but can be kept if you want */
ALTER TABLE accounts
DROP COLUMN IF EXISTS "created_at",
DROP COLUMN IF EXISTS "updated_at";

ALTER TABLE accounts
ADD COLUMN IF NOT EXISTS "token_type" TEXT NULL,
ADD COLUMN IF NOT EXISTS "scope" TEXT NULL,
ADD COLUMN IF NOT EXISTS "id_token" TEXT NULL,
ADD COLUMN IF NOT EXISTS "session_state" TEXT NULL;
/* Note: These are only needed if you're going to be using the old Twitter OAuth 1.0 provider. */
/* ALTER TABLE accounts
ADD COLUMN IF NOT EXISTS "oauth_token_secret" TEXT NULL,
ADD COLUMN IF NOT EXISTS "oauth_token" TEXT NULL; */

/* USER */
ALTER TABLE users RENAME COLUMN "email_verified" TO "emailVerified";

/* Keep id as SERIAL with autoincrement when using ORM. Using new v4 uuid format won't work because of incompatibility */
/* ALTER TABLE users ALTER COLUMN "id" TYPE TEXT; */
ALTER TABLE users ALTER COLUMN "name" TYPE TEXT;
ALTER TABLE users ALTER COLUMN "email" TYPE TEXT;
ALTER TABLE users ALTER COLUMN "image" TYPE TEXT;
/* Do conversion of TIMESTAMPTZ to BIGINT and then TEXT */
ALTER TABLE users ALTER COLUMN "emailVerified" TYPE TEXT USING CAST(CAST(extract(epoch FROM "emailVerified") AS BIGINT)*1000 AS TEXT);
/* The following two timestamp columns have never been necessary for NextAuth.js to function, but can be kept if you want */
ALTER TABLE users
DROP COLUMN IF EXISTS "created_at",
DROP COLUMN IF EXISTS "updated_at";

/* SESSION */
ALTER TABLE sessions RENAME COLUMN "session_token" TO "sessionToken";
ALTER TABLE sessions RENAME COLUMN "user_id" TO "userId";

/* Keep id as SERIAL with autoincrement when using ORM. Using new v4 uuid format won't work because of incompatibility */
/* ALTER TABLE sessions ALTER COLUMN "id" TYPE TEXT; */
/* ALTER TABLE sessions ALTER COLUMN "userId" TYPE TEXT; */
ALTER TABLE sessions ALTER COLUMN "sessionToken" TYPE TEXT;
ALTER TABLE sessions ADD CONSTRAINT fk_user_id FOREIGN KEY ("userId") REFERENCES users(id);
/* Do conversion of TIMESTAMPTZ to BIGINT and then TEXT */
ALTER TABLE sessions ALTER COLUMN "expires" TYPE TEXT USING CAST(CAST(extract(epoch FROM "expires") AS BIGINT)*1000 AS TEXT);
ALTER TABLE sessions DROP COLUMN IF EXISTS "access_token";
/* The following two timestamp columns have never been necessary for NextAuth.js to function, but can be kept if you want */
ALTER TABLE sessions
DROP COLUMN IF EXISTS "created_at",
DROP COLUMN IF EXISTS "updated_at";

/* VERIFICATION REQUESTS */
ALTER TABLE verification_requests RENAME TO verification_tokens;
/* Keep id as ORM needs it */
/* ALTER TABLE verification_tokens DROP COLUMN IF EXISTS id; */
ALTER TABLE verification_tokens ALTER COLUMN "identifier" TYPE TEXT;
ALTER TABLE verification_tokens ALTER COLUMN "token" TYPE TEXT;
/* Do conversion of TIMESTAMPTZ to BIGINT and then TEXT */
ALTER TABLE verification_tokens ALTER COLUMN "expires" TYPE TEXT USING CAST(CAST(extract(epoch FROM "expires") AS BIGINT)*1000 AS TEXT);
/* The following two timestamp columns have never been necessary for NextAuth.js to function, but can be kept if you want */
ALTER TABLE verification_tokens
DROP COLUMN IF EXISTS "created_at",
DROP COLUMN IF EXISTS "updated_at";

```
#### MongoDB[â€‹](#mongodb "Direct link to heading")

MongoDB is a document database and as such new fields will be automatically populated. You do, however, need to update the names of existing fields which are going to be reused.

```
db.getCollection('accounts').updateMany({}, {
  $rename: {
    "provider_id": "provider",
    "provider_account_id": "providerAccountId",
    "user_id": "userId",
    "access_token_expires": "expires_at"
  }
})
db.getCollection('users').updateMany({}, {
  $rename: {
    "email_verified": "emailVerified"
  }
})
db.getCollection('sessions').updateMany({}, {
  $rename: {
    "session_token": "sessionToken",
    "user_id": "userId"
  }
})

```
## Missing `secret`[â€‹](#missing-secret "Direct link to heading")

NextAuth.js used to generate a secret for convenience, when the user did not define one. This might have been useful in development, but can be a concern in production. We have always been clear about that in the docs, but from now on, if you forget to define a `secret` property in production, we will show the user an error page. Read more about this option [here](https://next-auth.js.org/configuration/options#secret)

You can generate a secret to be placed in the `secret` configuration option via the following command:

```
$ openssl rand -base64 32

```

Therefore, your NextAuth.js config should look something like this:

/pages/api/auth/[...nextauth].js
```
...
export default NextAuth({
  ...
  providers: [...],
  secret: "LlKq6ZtYbr+hTC073mAmAh9/h2HwMfsFo4hrfCx5mLg=",
  ...
})

```

Introduced in [#3143](https://github.com/nextauthjs/next-auth/issues/3143)

## Session `strategy`[â€‹](#session-strategy "Direct link to heading")

We have always supported two different session strategies. The first being our most popular and default strategy - the JWT based one. The second is the database adapter persisted session strategy. Both have their advantages/disadvantages, you can learn more about them on the [FAQ](https://next-auth.js.org/faq) page.

Previously, the way you configured this was through the `jwt: boolean` flag in the `session` option. The names `session` and `jwt` might have been a bit overused in the options, and so for a clearer message, we renamed this option to `strategy: "jwt" | "database"`, it is still in the `session` object. This will hopefully better indicate the purpose of this option as well as make very explicit which type of session you are going to use.

See the [`session` option docs](https://next-auth.js.org/configuration/options#session) for more details.

Introduced in [#3144](https://github.com/nextauthjs/next-auth/pull/3144)

## Summary[â€‹](#summary "Direct link to heading")

We hope this migration goes smoothly for each and every one of you! If you have any questions or get stuck anywhere, feel free to create [a new issue](https://github.com/nextauthjs/next-auth/issues/new) on GitHub.

[Edit this page](https://github.com/nextauthjs/next-auth/edit/v4/docs/docs/getting-started/upgrade-to-v4.md)Last updated on **Oct 24, 2024** by **BalÃ¡zs OrbÃ¡n**[PreviousTypeScript](/getting-started/typescript)[NextInitialization](/configuration/initialization)

* [`next-auth/jwt`](#next-authjwt)
* [`next-auth/react`](#next-authreact)
* [`SessionProvider`](#sessionprovider)
* [Providers](#providers)
* [`useSession` Hook](#usesession-hook)
* [Named Parameters](#named-parameters)
  + [Callbacks](#callbacks)
  + [Events](#events)
* [JWT configuration](#jwt-configuration)
* [Logger API](#logger-api)
* [`nodemailer`](#nodemailer)
* [Theme](#theme)
* [Session](#session)
* [Adapters](#adapters)
  + [Adapter API](#adapter-api)
  + [Schema changes](#schema-changes)
  + [Database migration](#database-migration)
* [Missing `secret`](#missing-secret)
* [Session `strategy`](#session-strategy)
* [Summary](#summary)
About NextAuth.js

* [Introduction](/getting-started/introduction)
Download

* [GitHub](https://github.com/nextauthjs/next-auth)
* [NPM](https://www.npmjs.com/package/next-auth)
Acknowledgements

* [Contributors](/contributors)
* [Sponsors](/sponsors)
* [Images by unDraw](https://undraw.co/)
NextAuth.js Â© Iain Collins 2025



=== Content from next-auth.js.org_07577de7_20250114_225959.html ===

Skip to main contentNextAuth.js is becoming Auth.js! ðŸŽ‰ We're creating Authentication for the Web. Everyone included. You are looking at the NextAuth.js (v4) documentation. For the new documentation go to [authjs.dev](https://authjs.dev).[![NextAuth Logo](/img/logo/logo-xs.png)![NextAuth Logo](/img/logo/logo-xs.png)**NextAuth.js**](/)[Documentation](/getting-started/introduction)[Tutorials](/tutorials)[FAQ](/faq)[Security](/security)[v4](/getting-started/introduction)

* [v4](/warnings)
* [v3](/v3/warnings)
* [All Releases](https://github.com/nextauthjs/next-auth/releases)
[npm](https://www.npmjs.com/package/next-auth)[GitHub](https://github.com/nextauthjs/next-auth)Search

* [Getting Started](/getting-started/introduction)
  + [Introduction](/getting-started/introduction)
  + [Getting Started](/getting-started/example)
  + [Client API](/getting-started/client)
  + [REST API](/getting-started/rest-api)
  + [TypeScript](/getting-started/typescript)
  + [Upgrade Guide (v4)](/getting-started/upgrade-v4)
* [Configuration](/configuration/initialization)
* [Providers](/providers/)
* [Adapters](/adapters)
* [Warnings](/warnings)
* [Errors](/errors)
* [Deployment](/deployment)
* [Guides](/guides/)
* SponsoredLooking for a
  hosted alternative?[Try Clerk â†’](https://go.clerk.com/DefS1u4)

* Warnings
Version: v4On this page
# Warnings

This is a list of warning output from NextAuth.js.

All warnings indicate things which you should take a look at, but do not inhibit normal operation.

---

## Client[â€‹](#client "Direct link to heading")

#### NEXTAUTH\_URL[â€‹](#nextauth_url "Direct link to heading")

Environment variable `NEXTAUTH_URL` missing. Please set it in your `.env` file.

note

On [Vercel](https://vercel.com) deployments, we will read the `VERCEL_URL` environment variable, so you won't need to define `NEXTAUTH_URL`.

---

## Server[â€‹](#server "Direct link to heading")

These warnings are displayed on the terminal.

#### NO\_SECRET[â€‹](#no_secret "Direct link to heading")

In development, we generate a `secret` based on your configuration for convenience. This is volatile and will throw an error in production. [Read more](https://next-auth.js.org/configuration/options#secret)

#### TWITTER\_OAUTH\_2\_BETA[â€‹](#twitter_oauth_2_beta "Direct link to heading")

Twitter OAuth 2.0 is currently in beta as certain changes might still be necessary. This is not covered by semver. See the docs <https://next-auth.js.org/providers/twitter#oauth-2>

#### EXPERIMENTAL\_API[â€‹](#experimental_api "Direct link to heading")

Some APIs are still experimental; they may be changed or removed in the future. Use at your own risk.

#### DEBUG\_ENABLED[â€‹](#debug_enabled "Direct link to heading")

You have enabled the `debug` option. It is meant for development only, to help you catch issues in your authentication flow and you should consider removing this option when deploying to production. One way of only allowing debugging while not in production is to set `debug: process.env.NODE_ENV !== "production"`, so you can commit this without needing to change the value.

If you want to log debug messages during production anyway, we recommend setting the [`logger` option](/configuration/options#logger) with proper sanitization of potentially sensitive user information.

## Adapter[â€‹](#adapter "Direct link to heading")

### ADAPTER\_TYPEORM\_UPDATING\_ENTITIES[â€‹](#adapter_typeorm_updating_entities "Direct link to heading")

This warning occurs when typeorm finds that the provided entities differ from the database entities. By default while not in `production` the typeorm adapter will always synchronize changes made to the entities codefiles.

Disable this warning by setting `synchronize: false` in your typeorm config

Example:

/pages/api/auth/[...nextauth].js
```
adapter: TypeORMLegacyAdapter({
  type: 'mysql',
  username: process.env.DATABASE_USERNAME,
  password: process.env.DATABASE_PASSWORD,
  host: process.env.DATABASE_HOST,
  database: process.env.DATABASE_DB,
  synchronize: false
}),

```
[Edit this page](https://github.com/nextauthjs/next-auth/edit/v4/docs/docs/warnings.md)Last updated on **Oct 24, 2024** by **BalÃ¡zs OrbÃ¡n**[PreviousAdapters](/adapters)[NextErrors](/errors)

* [Client](#client)
* [Server](#server)
* [Adapter](#adapter)
  + [ADAPTER\_TYPEORM\_UPDATING\_ENTITIES](#adapter_typeorm_updating_entities)
About NextAuth.js

* [Introduction](/getting-started/introduction)
Download

* [GitHub](https://github.com/nextauthjs/next-auth)
* [NPM](https://www.npmjs.com/package/next-auth)
Acknowledgements

* [Contributors](/contributors)
* [Sponsors](/sponsors)
* [Images by unDraw](https://undraw.co/)
NextAuth.js Â© Iain Collins 2025



=== Content from github.com_6edd3947_20250114_225957.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextauthjs%2Fnext-auth%2Fsecurity%2Fadvisories%2FGHSA-p6mm-27gq-9v3p)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnextauthjs%2Fnext-auth%2Fsecurity%2Fadvisories%2FGHSA-p6mm-27gq-9v3p)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=nextauthjs%2Fnext-auth)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nextauthjs](/nextauthjs)
/
**[next-auth](/nextauthjs/next-auth)**
Public

* [Notifications](/login?return_to=%2Fnextauthjs%2Fnext-auth) You must be signed in to change notification settings
* [Fork
  3.6k](/login?return_to=%2Fnextauthjs%2Fnext-auth)
* [Star
   25.6k](/login?return_to=%2Fnextauthjs%2Fnext-auth)

* [Code](/nextauthjs/next-auth)
* [Issues
  308](/nextauthjs/next-auth/issues)
* [Pull requests
  99](/nextauthjs/next-auth/pulls)
* [Discussions](/nextauthjs/next-auth/discussions)
* [Actions](/nextauthjs/next-auth/actions)
* [Projects
  0](/nextauthjs/next-auth/projects)
* [Security](/nextauthjs/next-auth/security)
* [Insights](/nextauthjs/next-auth/pulse)

Additional navigation options

* [Code](/nextauthjs/next-auth)
* [Issues](/nextauthjs/next-auth/issues)
* [Pull requests](/nextauthjs/next-auth/pulls)
* [Discussions](/nextauthjs/next-auth/discussions)
* [Actions](/nextauthjs/next-auth/actions)
* [Projects](/nextauthjs/next-auth/projects)
* [Security](/nextauthjs/next-auth/security)
* [Insights](/nextauthjs/next-auth/pulse)

# Leakage of excessive information into log in next-auth

Low

[balazsorban44](/balazsorban44)
published
GHSA-p6mm-27gq-9v3p
Jul 26, 2022

## Package

npm

next-auth
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<4.10.2, <3.29.9

## Patched versions

4.10.2, 3.29.9

## Description

### Impact

An information disclosure vulnerability in `next-auth` before `v4.10.2` and `v3.29.9` allows an attacker with log access privilege to obtain excessive information such as an identity provider's secret in the log (which is thrown during OAuth error handling) and use it to leverage further attacks on the system, like impersonating the client to ask for extensive permissions.

### Patches

We patched this vulnerability in `v4.10.2` and `v3.29.9` by moving the log for `provider` information to the debug level. In addition, we added a warning for having the `debug: true` option turned on in production and documented it [here](https://next-auth.js.org/warnings#debug_enabled).

> You have enabled the debug option. It is meant for development only, to help you catch issues in your authentication flow and you should consider removing this option when deploying to production. One way of only allowing debugging while not in production is to set debug: process.env.NODE\_ENV !== "production", so you can commit this without needing to change the value.
>
> If you want to log debug messages during production anyway, we recommend setting the [logger option](https://next-auth.js.org/configuration/options#logger) with proper sanitization of potentially sensitive user information.

To upgrade:

```
npm i next-auth@latest
# or
yarn add next-auth@latest
# or
pnpm add next-auth@latest
```

(This will update to the latest v4 version, but you can change `latest` to 3 if you want to stay on v3. This is not recommended. v3 is unmaintained.)

### Workarounds

If for some reason you cannot upgrade, you can user the `logger` configuration option by sanitizing the logs:

```
// Example
import log from "your-logging-service"
export const authOptions: NextAuthOptions = {
  debug: process.env.NODE_ENV !== "production",
  logger: {
    error: (code, metadata) => {
      if (!(metadata instanceof Error) &&  metadata.provider) {
        // redact the provider secret here
        delete metadata.provider
        log.error(code, metadata)
      } else {
        log.error(code, metadata)
      }
    }
  },
}
```
### References

Related documentation:

* <https://next-auth.js.org/warnings#debug_enabled>
* <https://next-auth.js.org/configuration/options#logger>
* <https://next-auth.js.org/getting-started/upgrade-v4>

### For more information

If you have any concerns, we request responsible disclosure, outlined here: <https://next-auth.js.org/security#reporting-a-vulnerability>

### Timeline

The issue was reported 18th of July, a response was sent out in less than 20 minutes and after identifying the issue a patch was published within a week.

### Severity

Low

3.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N

### CVE ID

CVE-2022-31186

### Weaknesses

[CWE-532](/advisories?query=cwe%3A532)

### Credits

* [![@ShuPink](https://avatars.githubusercontent.com/u/60080324?s=40&v=4)](/ShuPink)
  [ShuPink](/ShuPink)
  Analyst

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


