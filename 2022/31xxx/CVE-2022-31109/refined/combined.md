=== Content from portswigger.net_7425b643_20250114_185454.html ===


[Login](/users)

Products

Solutions

[Research](/research)
[Academy](/web-security)
Support

Company

[Customers](/customers)
[About](/about)
[Blog](/blog)
[Careers](/careers)
[Legal](/legal)
[Contact](/contact)
[Resellers](/support/reseller-faqs)

[My account](/users/youraccount)
[Customers](/customers)
[About](/about)
[Blog](/blog)
[Careers](/careers)
[Legal](/legal)
[Contact](/contact)
[Resellers](/support/reseller-faqs)
[![Burp Suite Enterprise Edition](/content/images/svg/icons/enterprise.svg)
**Burp Suite Enterprise Edition**
The enterprise-enabled dynamic web vulnerability scanner.](/burp/enterprise)
[![Burp Suite Professional](/content/images/svg/icons/professional.svg)
**Burp Suite Professional**
The world's #1 web penetration testing toolkit.](/burp/pro)
[![Burp Suite Community Edition](/content/images/svg/icons/community.svg)
**Burp Suite Community Edition**
The best manual tools to start web security testing.](/burp/communitydownload)
[![Dastardly, from Burp Suite](/mega-nav/images/dastardly.svg)
**Dastardly, from Burp Suite**
Free, lightweight web application security scanning for CI/CD.](/burp/dastardly)
[View all product editions](/burp)

[**Burp Scanner**

Burp Suite's web vulnerability scanner

![Burp Suite's web vulnerability scanner'](/mega-nav/images/burp-suite-scanner.jpg)](/burp/vulnerability-scanner)

[**Attack surface visibility**
Improve security posture, prioritize manual testing, free up time.](/solutions/attack-surface-visibility)
[**CI-driven scanning**
More proactive security - find and fix vulnerabilities earlier.](/solutions/ci-driven-scanning)
[**Application security testing**
See how our software enables the world to secure the web.](/solutions)
[**DevSecOps**
Catch critical bugs; ship more secure software, more quickly.](/solutions/devsecops)
[**Penetration testing**
Accelerate penetration testing - find more bugs, more quickly.](/solutions/penetration-testing)
[**Automated scanning**
Scale dynamic scanning. Reduce risk. Save time/money.](/solutions/automated-security-testing)
[**Bug bounty hunting**
Level up your hacking and earn more bug bounties.](/solutions/bug-bounty-hunting)
[**Compliance**
Enhance security monitoring to comply with confidence.](/solutions/compliance)

[View all solutions](/solutions)

[**Product comparison**

What's the difference between Pro and Enterprise Edition?

![Burp Suite Professional vs Burp Suite Enterprise Edition](/mega-nav/images/burp-suite.jpg)](/burp/enterprise/resources/enterprise-edition-vs-professional)

[**Support Center**
Get help and advice from our experts on all things Burp.](/support)
[**Documentation**
Tutorials and guides for Burp Suite.](/burp/documentation)
[**Get Started - Professional**
Get started with Burp Suite Professional.](/burp/documentation/desktop/getting-started)
[**Get Started - Enterprise**
Get started with Burp Suite Enterprise Edition.](/burp/documentation/enterprise/getting-started)
[**User Forum**
Get your questions answered in the User Forum.](https://forum.portswigger.net/)
[**Downloads**
Download the latest version of Burp Suite.](/burp/releases)

[Visit the Support Center](/support)

[**Downloads**

Download the latest version of Burp Suite.

![The latest version of Burp Suite software for download](/mega-nav/images/latest-burp-suite-software-download.jpg)](/burp/releases)

Academy home

* [Dashboard](https://portswigger.net/web-security/index.html)
* [Learning paths](https://portswigger.net/web-security/learning-paths)
* Latest topics

  [Web cache deception](/web-security/web-cache-deception)
  [Web LLM attacks](/web-security/llm-attacks)
  [API testing](/web-security/api-testing)
  [NoSQL injection](/web-security/nosql-injection)
  [Race conditions](/web-security/race-conditions)
  [View all topics](/web-security/all-topics)
* All content

  [All labs](/web-security/all-labs)
  [All topics](/web-security/all-topics)
  [Mystery labs](/web-security/mystery-lab-challenge)
* Hall of Fame

  [Leaderboard](https://portswigger.net/web-security/hall-of-fame)
  [Interview - Kamil Vavra](https://portswigger.net/web-security/getting-started/kamil-vavra/index.html)
  [Interview - Johnny Villarreal](https://portswigger.net/web-security/getting-started/johnny-villarreal/index.html)
  [Interview - Andres Rauschecker](https://portswigger.net/web-security/getting-started/andres-rauschecker/index.html)
* [Get started](https://portswigger.net/web-security/getting-started/index.html)
* Get certified

  [Get certified](https://portswigger.net/web-security/certification/index.html)
  [How to prepare](https://portswigger.net/web-security/certification/how-to-prepare/index.html)
  [How it works](https://portswigger.net/web-security/certification/how-it-works/index.html)
  [Practice exam](https://portswigger.net/web-security/certification/practice-exam/index.html)
  [Exam hints and guidance](https://portswigger.net/web-security/certification/exam-hints-and-guidance/index.html)
  [What the exam involves](https://portswigger.net/web-security/certification/how-it-works/index.html#what-the-exam-involves)
  [FAQs](https://portswigger.net/web-security/certification/frequently-asked-questions/index.html)
  [Validate your certification](https://portswigger.net/web-security/certification#validate-your-certification)

[Back to all topics](/web-security/all-topics)

### HTTP Host header attacks

* [What is the HTTP host header?](/web-security/host-header#what-is-the-http-host-header)
* [What is an HTTP Host header attack?](/web-security/host-header#what-is-an-http-host-header-attack)
* [How vulnerabilities arise](/web-security/host-header#how-do-http-host-header-vulnerabilities-arise)
* [Testing for vulnerabilities](/web-security/host-header/exploiting#how-to-test-for-vulnerabilities-using-the-http-host-header)

  + [Supply an arbitrary Host header](/web-security/host-header/exploiting#supply-an-arbitrary-host-header)
  + [Check for flawed validation](/web-security/host-header/exploiting#check-for-flawed-validation)
  + [Send ambiguous requests](/web-security/host-header/exploiting#send-ambiguous-requests)
  + [Inject host override headers](/web-security/host-header/exploiting#inject-host-override-headers)
* [Exploiting vulnerabilities](/web-security/host-header/exploiting#how-to-exploit-the-http-host-header)

  + [Password reset poisoning](/web-security/host-header/exploiting/password-reset-poisoning)

    - [How does a password reset work?](/web-security/host-header/exploiting/password-reset-poisoning#how-does-a-password-reset-work)
    - [Constructing an attack](/web-security/host-header/exploiting/password-reset-poisoning#how-to-construct-a-password-reset-poisoning-attack)
  + [Web cache poisoning](/web-security/host-header/exploiting#web-cache-poisoning-via-the-host-header)
  + [Exploiting classic server-side vulnerabilities](/web-security/host-header/exploiting#exploiting-classic-server-side-vulnerabilities)
  + [Bypassing authentication](/web-security/host-header/exploiting#accessing-restricted-functionality)
  + [Virtual host brute-forcing](/web-security/host-header/exploiting#accessing-internal-websites-with-virtual-host-brute-forcing)
  + [Routing-based SSRF](/web-security/host-header/exploiting#routing-based-ssrf)
  + [Connection state attacks](/web-security/host-header/exploiting#connection-state-attacks)
  + [SSRF via a malformed request line](/web-security/host-header/exploiting#ssrf-via-a-malformed-request-line)
* [Preventing vulnerabilities](/web-security/host-header#how-to-prevent-http-host-header-attacks)
* [View all HTTP Host header labs](/web-security/all-labs#http-host-header-attacks)

* [Web Security Academy](/web-security)
* [HTTP Host header attacks](/web-security/host-header)

# HTTP Host header attacks

In this section, we'll discuss how misconfigurations and flawed business logic can expose websites to a variety of attacks via the HTTP Host header. We'll outline the high-level methodology for identifying websites that are vulnerable to HTTP Host header attacks and demonstrate how you can exploit this for the following kinds of attacks:

* [Password reset poisoning](/web-security/host-header/exploiting/password-reset-poisoning) LABS
* [Web cache poisoning](/web-security/host-header/exploiting#web-cache-poisoning-via-the-host-header) LABS
* [Exploiting classic server-side vulnerabilities](/web-security/host-header/exploiting#exploiting-classic-server-side-vulnerabilities)
* [Bypassing authentication](/web-security/host-header/exploiting#accessing-restricted-functionality) LABS
* [Virtual host brute-forcing](/web-security/host-header/exploiting#accessing-internal-websites-with-virtual-host-brute-forcing)
* [Routing-based SSRF](/web-security/host-header/exploiting#routing-based-ssrf) LABS
* [Connection state attacks](/web-security/host-header/exploiting#connection-state-attacks) LABS

![Host header attack](/web-security/images/host-header-attacks.jpg)
#### Labs

If you're already familiar with the basic concepts behind HTTP Host header vulnerabilities and just want to practice exploiting them on some realistic, deliberately vulnerable targets, you can access all of the labs in this topic from the link below.

* [View all HTTP Host header labs](/web-security/all-labs#http-host-header-attacks)
## What is the HTTP Host header?

The HTTP Host header is a mandatory request header as of HTTP/1.1. It specifies the domain name that the client wants to access. For example, when a user visits `https://portswigger.net/web-security`, their browser will compose a request containing a Host header as follows:

`GET /web-security HTTP/1.1
Host: portswigger.net`

In some cases, such as when the request has been forwarded by an intermediary system, the Host value may be altered before it reaches the intended back-end component. We will discuss this scenario in more detail below.

## What is the purpose of the HTTP Host header?

The purpose of the HTTP Host header is to help identify which back-end component the client wants to communicate with. If requests didn't contain Host headers, or if the Host header was malformed in some way, this could lead to issues when routing incoming requests to the intended application.

Historically, this ambiguity didn't exist because each IP address would only host content for a single domain. Nowadays, largely due to the ever-growing trend for cloud-based solutions and outsourcing much of the related architecture, it is common for multiple websites and applications to be accessible at the same IP address. This approach has also increased in popularity partly as a result of IPv4 address exhaustion.

When multiple applications are accessible via the same IP address, this is most commonly a result of one of the following scenarios.

### Virtual hosting

One possible scenario is when a single web server hosts multiple websites or applications. This could be multiple websites with a single owner, but it is also possible for websites with different owners to be hosted on a single, shared platform. This is less common than it used to be, but still occurs with some cloud-based SaaS solutions.

In either case, although each of these distinct websites will have a different domain name, they all share a common IP address with the server. Websites hosted in this way on a single server are known as "virtual hosts".

To a normal user accessing the website, a virtual host is often indistinguishable from a website being hosted on its own dedicated server.

### Routing traffic via an intermediary

Another common scenario is when websites are hosted on distinct back-end servers, but all traffic between the client and servers is routed through an intermediary system. This could be a simple load balancer or a reverse proxy server of some kind. This setup is especially prevalent in cases where clients access the website via a content delivery network (CDN).

In this case, even though the websites are hosted on separate back-end servers, all of their domain names resolve to a single IP address of the intermediary component. This presents some of the same challenges as virtual hosting because the reverse proxy or load balancer needs to know the appropriate back-end to which it should route each request.

### How does the HTTP Host header solve this problem?

In both of these scenarios, the Host header is relied on to specify the intended recipient. A common analogy is the process of sending a letter to somebody who lives in an apartment building. The entire building has the same street address, but behind this street address there are many different apartments that each need to receive the correct mail somehow. One solution to this problem is simply to include the apartment number or the recipient's name in the address. In the case of HTTP messages, the Host header serves a similar purpose.

When a browser sends the request, the target URL will resolve to the IP address of a particular server. When this server receives the request, it refers to the Host header to determine the intended back-end and forwards the request accordingly.

## What is an HTTP Host header attack?

HTTP Host header attacks exploit vulnerable websites that handle the value of the Host header in an unsafe way. If the server implicitly trusts the Host header, and fails to validate or escape it properly, an attacker may be able to use this input to inject harmful payloads that manipulate server-side behavior. Attacks that involve injecting a payload directly into the Host header are often known as "Host header injection" attacks.

Off-the-shelf web applications typically don't know what domain they are deployed on unless it is manually specified in a configuration file during setup. When they need to know the current domain, for example, to generate an absolute URL included in an email, they may resort to retrieving the domain from the Host header:

`<a href="https://_SERVER['HOST']/support">Contact support</a>`

The header value may also be used in a variety of interactions between different systems of the website's infrastructure.

As the Host header is in fact user controllable, this practice can lead to a number of issues. If the input is not properly escaped or validated, the Host header is a potential vector for exploiting a range of other vulnerabilities, most notably:

* Web cache poisoning
* Business logic flaws in specific functionality
* Routing-based SSRF
* Classic server-side vulnerabilities, such as SQL injection

## How do HTTP Host header vulnerabilities arise?

HTTP Host header vulnerabilities typically arise due to the flawed assumption that the header is not user controllable. This creates implicit trust in the Host header and results in inadequate validation or escaping of its value, even though an attacker can easily modify this using tools like Burp Proxy.

Even if the Host header itself is handled more securely, depending on the configuration of the servers that deal with incoming requests, the Host can potentially be overridden by injecting other headers. Sometimes website owners are unaware that these headers are supported by default and, as a result, they may not be treated with the same level of scrutiny.

In fact, many of these vulnerabilities arise not because of insecure coding but because of insecure configuration of one or more components in the related infrastructure. These configuration issues can occur because websites integrate third-party technologies into their architecture without necessarily understanding the configuration options and their security implications.

## Exploiting HTTP Host header vulnerabilities

By now, you should have a good understanding of what the HTTP Host header is. For pentesters and bug bounty hunters, we've created some additional guidance on how you can identify and exploit these kinds of vulnerabilities for yourself. We've also provided some deliberately vulnerable LABS so that you can practice some of these techniques.

#### Read more

* [How to identify and exploit HTTP Host header vulnerabilities](/web-security/host-header/exploiting)
## How to prevent HTTP Host header attacks

To prevent HTTP Host header attacks, the simplest approach is to avoid using the Host header altogether in server-side code. Double-check whether each URL really needs to be absolute. You will often find that you can just use a relative URL instead. This simple change can help you prevent web cache poisoning vulnerabilities in particular.

Other ways to prevent HTTP Host header attacks include:

##### Protect absolute URLs

When you have to use absolute URLs, you should require the current domain to be manually specified in a configuration file and refer to this value instead of the Host header. This approach would eliminate the threat of password reset poisoning, for example.

##### Validate the Host header

If you must use the Host header, make sure you validate it properly. This should involve checking it against a whitelist of permitted domains and rejecting or redirecting any requests for unrecognized hosts. You should consult the documentation of your framework for guidance on how to do this. For example, the Django framework provides the `ALLOWED_HOSTS` option in the settings file. This approach will reduce your exposure to Host header injection attacks.

##### Don't support Host override headers

It is also important to check that you do not support additional headers that may be used to construct these attacks, in particular `X-Forwarded-Host`. Remember that these may be supported by default.

##### Whitelist permitted domains

To prevent routing-based attacks on internal infrastructure, you should configure your load balancer or any reverse proxies to forward requests only to a whitelist of permitted domains.

##### Be careful with internal-only virtual hosts

When using virtual hosting, you should avoid hosting internal-only websites and applications on the same server as public-facing content. Otherwise, attackers may be able to access internal domains via Host header manipulation.

## Register for free to track your learning progress

![The benefits of working through PortSwigger's Web Security Academy](/content/images/vulnerabilities/web-security-academy-footer.png)

* Practise exploiting vulnerabilities on realistic targets.
* Record your progression from Apprentice to Expert.
* See where you rank in our Hall of Fame.

REGISTER

As we use reCAPTCHA, you need to be able to access Google's servers to use this function.

Already got an account?
[Login here](https://portswigger.net/users)

Want to track your progress and have a more personalized learning experience? (It's free!)

[Sign up](/users/register)
[Login](/users?returnurl=%2fweb-security%2fhost-header)

![Try Burp Suite for Free](/content/images/logos/burp-suite-icon.svg)
#### Find HTTP Host header vulnerabilities using Burp Suite

[Try for free](https://portswigger.net/burp)

Burp Suite

[Web vulnerability scanner](/burp/vulnerability-scanner)
[Burp Suite Editions](/burp)
[Release Notes](/burp/releases)

Vulnerabilities

[Cross-site scripting (XSS)](/web-security/cross-site-scripting)
[SQL injection](/web-security/sql-injection)
[Cross-site request forgery](/web-security/csrf)
[XML external entity injection](/web-security/xxe)
[Directory traversal](/web-security/file-path-traversal)
[Server-side request forgery](/web-security/ssrf)

Customers

[Organizations](/organizations)
[Testers](/testers)
[Developers](/developers)

Company

[About](/about)
[Careers](/careers)
[Contact](/about/contact)
[Legal](/legal)
[Privacy Notice](/privacy)

Insights

[Web Security Academy](/web-security)
[Blog](/blog)
[Research](/research)

[![PortSwigger Logo](/content/images/logos/portswigger-logo.svg)](/)
 [Follow us](https://twitter.com/Burp_Suite)

© 2025 PortSwigger Ltd.



=== Content from github.com_63141e9e_20250114_185454.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flaminas%2Flaminas-diactoros%2Fsecurity%2Fadvisories%2FGHSA-8274-h5jp-97vr)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flaminas%2Flaminas-diactoros%2Fsecurity%2Fadvisories%2FGHSA-8274-h5jp-97vr)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=laminas%2Flaminas-diactoros)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[laminas](/laminas)
/
**[laminas-diactoros](/laminas/laminas-diactoros)**
Public

* [Notifications](/login?return_to=%2Flaminas%2Flaminas-diactoros) You must be signed in to change notification settings
* [Fork
  64](/login?return_to=%2Flaminas%2Flaminas-diactoros)
* [Star
   498](/login?return_to=%2Flaminas%2Flaminas-diactoros)

* [Code](/laminas/laminas-diactoros)
* [Issues
  20](/laminas/laminas-diactoros/issues)
* [Pull requests
  7](/laminas/laminas-diactoros/pulls)
* [Actions](/laminas/laminas-diactoros/actions)
* [Projects
  0](/laminas/laminas-diactoros/projects)
* [Security](/laminas/laminas-diactoros/security)
* [Insights](/laminas/laminas-diactoros/pulse)

Additional navigation options

* [Code](/laminas/laminas-diactoros)
* [Issues](/laminas/laminas-diactoros/issues)
* [Pull requests](/laminas/laminas-diactoros/pulls)
* [Actions](/laminas/laminas-diactoros/actions)
* [Projects](/laminas/laminas-diactoros/projects)
* [Security](/laminas/laminas-diactoros/security)
* [Insights](/laminas/laminas-diactoros/pulse)

# HTTP Host Header Attack Vulnerability

High

[weierophinney](/weierophinney)
published
GHSA-8274-h5jp-97vr
Jul 25, 2022

## Package

composer

laminas/laminas-diactoros
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

<=2.11.0

## Patched versions

2.11.1

## Description

### Impact

Applications that use Diactoros, and are either not behind a proxy, or can be accessed via untrusted proxies, can potentially have the host, protocol, and/or port of a `Laminas\Diactoros\Uri` instance associated with the incoming server request modified to reflect values from `X-Forwarded-*` headers. Such changes can potentially lead to XSS attacks (if a fully-qualified URL is used in links) and/or URL poisoning.

### Patches

Any version after 2.11.0.

Starting in laminas/laminas-diactoros 2.11.1, we have added `Laminas\Diactoros\ServerRequestFilter\FilterServerRequestInterface`, which defines the single method `__invoke(Psr\Http\Message\ServerRequestInterface $request): Psr\Http\Message\ServerRequestInterface`. Filters implementing this interface allow modifying and returning a generated `ServerRequest`.

The primary use case of the interface is to allow modifying the generated URI based on the presence of headers such as `X-Forwarded-Host`. When operating behind a reverse proxy, the `Host` header is often rewritten to the name of the node to which the request is being forwarded, and an `X-Forwarded-Host` header is generated with the original `Host` value to allow the server to determine the original host the request was intended for. (We have always examined the `X-Forwarded-Proto` header; as of Diactoros 2.11.1, we also examine the `X-Forwarded-Port` header.) To accommodate this use case, we created Laminas\Diactoros\ServerRequestFilter\FilterUsingXForwardedHeaders.

Due to potential security issues, it is generally best to only accept these headers if you trust the reverse proxy that has initiated the request.

(This value is found in `$_SERVER['REMOTE_ADDR']`, which is present as `$request->getServerParams()['REMOTE_ADDR']` within PSR-7 implementations.) `FilterUsingXForwardedHeaders` provides named constructors to allow you to trust these headers from any source (which has been the default behavior of Diactoros since the beginning), or to specify specific IP addresses or CIDR subnets to trust, along with which headers are trusted.

`Laminas\Diactoros\ServerRequestFactory::fromGlobals()` was updated to accept a `FilterServerRequestInterface` as an additional, optional argument. Since the `X-Forwarded-*` headers do have valid use cases, particularly in clustered environments using a load balancer, to prevent backwards compatibility breaks, if no filter is provided, we generate an instance via `FilterUsingXForwardedHeaders::trustReservedSubnets()`, which generates an instance marked to trust only proxies on private subnets.

### Workarounds

Infrastructure or DevOps can configure web servers to reject `X-Forwarded-*` headers at the web server level.

Users of laminas/laminas-diactoros can make use of the `Laminas\Diactoros\RequestFilter\RequestFilterInterface` functionality in order to either (a) disable usage of the `X-Forwarded-*` headers entirely, (b) opt-in to it, or (c) opt-in to the usage for configured proxy servers.

### References

* [HTTP Host Header Attacks](https://portswigger.net/web-security/host-header)

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [laminas/laminas-diactoros](https://github.com/laminas/laminas-diactoros/)
* Email us

### Severity

High

### CVE ID

CVE-2022-31109

### Weaknesses

No CWEs

### Credits

* [![@MaximilianKresse](https://avatars.githubusercontent.com/u/545671?s=40&v=4)](/MaximilianKresse)
  [MaximilianKresse](/MaximilianKresse)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_fc71e357_20250114_185453.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flaminas%2Flaminas-diactoros%2Fcommit%2F25b11d422c2e5dad868f68619888763b30f91e2d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flaminas%2Flaminas-diactoros%2Fcommit%2F25b11d422c2e5dad868f68619888763b30f91e2d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=laminas%2Flaminas-diactoros)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[laminas](/laminas)
/
**[laminas-diactoros](/laminas/laminas-diactoros)**
Public

* [Notifications](/login?return_to=%2Flaminas%2Flaminas-diactoros) You must be signed in to change notification settings
* [Fork
  64](/login?return_to=%2Flaminas%2Flaminas-diactoros)
* [Star
   498](/login?return_to=%2Flaminas%2Flaminas-diactoros)

* [Code](/laminas/laminas-diactoros)
* [Issues
  20](/laminas/laminas-diactoros/issues)
* [Pull requests
  7](/laminas/laminas-diactoros/pulls)
* [Actions](/laminas/laminas-diactoros/actions)
* [Projects
  0](/laminas/laminas-diactoros/projects)
* [Security](/laminas/laminas-diactoros/security)
* [Insights](/laminas/laminas-diactoros/pulse)

Additional navigation options

* [Code](/laminas/laminas-diactoros)
* [Issues](/laminas/laminas-diactoros/issues)
* [Pull requests](/laminas/laminas-diactoros/pulls)
* [Actions](/laminas/laminas-diactoros/actions)
* [Projects](/laminas/laminas-diactoros/projects)
* [Security](/laminas/laminas-diactoros/security)
* [Insights](/laminas/laminas-diactoros/pulse)

## Commit

[Permalink](/laminas/laminas-diactoros/commit/25b11d422c2e5dad868f68619888763b30f91e2d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-8274-h5jp-97vr](https://github.com/advisories/GHSA-8274-h5jp-97vr "GHSA-8274-h5jp-97vr")

[Browse files](/laminas/laminas-diactoros/tree/25b11d422c2e5dad868f68619888763b30f91e2d)
Browse the repository at this point in the history

```
Security/x forwarded header trust
```

* Loading branch information

[![@weierophinney](https://avatars.githubusercontent.com/u/25943?s=40&v=4)](/weierophinney)

[weierophinney](/laminas/laminas-diactoros/commits?author=weierophinney "View all commits by weierophinney")
authored
Jun 28, 2022

2 parents
[d1bc565](/laminas/laminas-diactoros/commit/d1bc565b23c2040fafde398a8a5db083c47928c0)
+
[4b5d1ad](/laminas/laminas-diactoros/commit/4b5d1adb5bc6571ba4834793fc13f4eb46e7dc50)

commit 25b11d4

 Show file tree

 Hide file tree

Showing
**20 changed files**
with
**1,522 additions**
and
**190 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* composer.lock
  [composer.lock](#diff-f37acfaa6b11f575a9a6f41a75fa73a61d0f8ebc2c9b8cddc215d8aca10e44f5)
* docs/book/v2

  + docs/book/v2/api.md
    [api.md](#diff-4a3c896c88b983224c800a2a5bd000327f3228e0cba7c65d5a5624304e3ca2bd)
  + docs/book/v2/forward-migration.md
    [forward-migration.md](#diff-65462390bdd9ebc4aac894bc0f37725f5ba3231585655066158b334c425c1470)
  + docs/book/v2/server-request-filters.md
    [server-request-filters.md](#diff-173530ce0dacc9612182d38ad7aec28f664ff15deda1a2496ce06361479705a0)
* mkdocs.yml
  [mkdocs.yml](#diff-98d0f806abc9af24e6a7c545d3d77e8f9ad57643e27211d7a7b896113e420ed2)
* psalm-baseline.xml
  [psalm-baseline.xml](#diff-3208225af5a3ef0c924761633ad6b04cbfa5eab3d3bafcc49c79441e89257ee7)
* psalm.xml.dist
  [psalm.xml.dist](#diff-2d20a98059390e83ae58234d4bda07fe9319b822009ce8c4479e0f3ae1943fbf)
* src

  + src/ConfigProvider.php
    [ConfigProvider.php](#diff-f0a2f25e61573ecaca3a489ef6fca6a6106b7f825ef5599ec374f5387db58f82)
  + Exception

    - src/Exception/InvalidForwardedHeaderNameException.php
      [InvalidForwardedHeaderNameException.php](#diff-a42461cb8f82097343f456faa06fee76e8042190068cbe40d8694170f8f80706)
    - src/Exception/InvalidProxyAddressException.php
      [InvalidProxyAddressException.php](#diff-9ccffd8a37363776cb2106fe5b28b32633103be3da9fbb872c44a059ad023df4)
  + src/ServerRequestFactory.php
    [ServerRequestFactory.php](#diff-1515535a888b38d47cd28b3278ff4373ea3ce5d5b7ea4d909ab13de380060818)
  + ServerRequestFilter

    - src/ServerRequestFilter/DoNotFilter.php
      [DoNotFilter.php](#diff-f43f8bcc5c9be2b41817dbbbe82027b733a3a90f889fb6d769c71fc718b52b35)
    - src/ServerRequestFilter/FilterServerRequestInterface.php
      [FilterServerRequestInterface.php](#diff-4863ebf5015e087fd27ba454b84b8d41a44dcf63735b26828944acbfdb709b52)
    - src/ServerRequestFilter/FilterUsingXForwardedHeaders.php
      [FilterUsingXForwardedHeaders.php](#diff-0dd5fd954dbf44366a2542dc3e73dd431ab6256a196a81fee9bff93f31ffb297)
    - src/ServerRequestFilter/IPRange.php
      [IPRange.php](#diff-95cbc0abcbd3db51d53c91a0e045d069cd04e0ea40db13b8c3550e3c5b98fe25)
  + functions

    - src/functions/marshal\_uri\_from\_sapi.php
      [marshal\_uri\_from\_sapi.php](#diff-e5acf70a427ed065a7b5df86fd79f5adf1859c78506aa6d19b3e43b3a052cca9)
* test

  + test/ServerRequestFactoryTest.php
    [ServerRequestFactoryTest.php](#diff-a3b5b3af3f7518ca38238d7d612e18d517368a189a54a114e3abeca76143c411)
  + ServerRequestFilter

    - test/ServerRequestFilter/DoNotFilterTest.php
      [DoNotFilterTest.php](#diff-a64f5ca1b0c57df2befbf176bfd73aaff6664fba186b8c513baf6499ba1ab225)
    - test/ServerRequestFilter/FilterUsingXForwardedHeadersTest.php
      [FilterUsingXForwardedHeadersTest.php](#diff-c250ff1d94aeb8537e99fd692cac325dd2f4b7b394342925d4ba2d0f7e889d30)
    - test/ServerRequestFilter/IPRangeTest.php
      [IPRangeTest.php](#diff-6b3edf13bd946104e15fb60ce1f58c0d5e0273f5afabc3f112c7373425814b7d)

## There are no files selected for viewing

359 changes: 182 additions & 177 deletions

359
[composer.lock](#diff-f37acfaa6b11f575a9a6f41a75fa73a61d0f8ebc2c9b8cddc215d8aca10e44f5 "composer.lock")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/composer.lock)
Edit file

Delete file

Load diff

Large diffs are not rendered by default.

Oops, something went wrong.

Retry

28 changes: 22 additions & 6 deletions

28
[docs/book/v2/api.md](#diff-4a3c896c88b983224c800a2a5bd000327f3228e0cba7c65d5a5624304e3ca2bd "docs/book/v2/api.md")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/docs/book/v2/api.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -104,10 +104,10 @@ $jsonResponse = new JsonResponse($data, 422, [ |
|  |  |  |
|  |  | ## ServerRequestFactory |
|  |  |  |
|  |  | This static class can be used to marshal a `ServerRequest` instance from the PHP environment. The |
|  |  | primary entry point is `Laminas\Diactoros\ServerRequestFactory::fromGlobals(array $server, array |
|  |  | $query, array $body, array $cookies, array $files)`. This method will create a new `ServerRequest` |
|  |  | instance with the data provided. Examples of usage are: |
|  |  | This static class can be used to marshal a `ServerRequest` instance from the PHP environment. |
|  |  | The primary entry point is `Laminas\Diactoros\ServerRequestFactory::fromGlobals(array $server, array $query, array $body, array $cookies, array $files, ?Laminas\Diactoros\ServerRequestFilter\FilterServerRequestInterface $requestFilter)`. |
|  |  | This method will create a new `ServerRequest` instance with the data provided. |
|  |  | Examples of usage are: |
|  |  |  |
|  |  | ```php |
|  |  | // Returns new ServerRequest instance, using values from superglobals: |
| Expand All | | @@ -124,8 +124,22 @@ $request = ServerRequestFactory::fromGlobals( |
|  |  | $\_COOKIE, |
|  |  | $\_FILES |
|  |  | ); |
|  |  |  |
|  |  | ### Request Filters |
|  |  |  |
|  |  | Since version 2.11.1, this method takes the additional optional argument `$requestFilter`. |
|  |  | This should be a `null` value, or an instance of [`Laminas\Diactoros\ServerRequestFilter\FilterServerRequestInterface`](server-request-filters.md). |
|  |  | For version 2 releases, if a `null` is provided, internally the method will assign a [`Laminas\Diactoros\ServerRequestFilter\FilerUsingXForwardedHeaders`](server-request-filters.md#filterusingxforwardedheaders) instance configured as follows: |
|  |  |  |
|  |  | ```php |
|  |  | $requestFilter = $requestFilter ?: FilterUsingXForwardedHeaders::trustReservedSubnets(); |
|  |  | ``` |
|  |  |  |
|  |  | The request filter is called on the generated server request instance, and its result is returned from `fromGlobals()`. |
|  |  |  |
|  |  | \*\*For version 3 releases, this method will switch to using a `Laminas\Diactoros\ServerRequestFilter\DoNotFilter` by default.\*\* |
|  |  | If you are using this factory method directly, please be aware and update your code accordingly. |
|  |  |  |
|  |  | ### ServerRequestFactory Helper Functions |
|  |  |  |
|  |  | In order to create the various artifacts required by a `ServerRequest` instance, |
| Expand All | | @@ -137,8 +151,10 @@ and even the `Cookie` header. These include: |
|  |  | (its main purpose is to aggregate the `Authorization` header in the SAPI params |
|  |  | when under Apache) |
|  |  | - `Laminas\Diactoros\marshalProtocolVersionFromSapi(array $server) : string` |
|  |  | - `Laminas\Diactoros\marshalMethodFromSapi(array $server) : string` |
|  |  | - `Laminas\Diactoros\marshalUriFromSapi(array $server, array $headers) : Uri` |
|  |  | - `Laminas\Diactoros\marshalMethodFromSapi(array $server) : string`. |
|  |  | - `Laminas\Diactoros\marshalUriFromSapi(array $server, array $headers) : Uri`. |
|  |  | Please note: \*\*this function is deprecated as of version 2.11.1\*\*, and no longer used in `ServerRequestFactory::fromGlobals()`. |
|  |  | Use `ServerRequestFactory::fromGlobals()` instead. |
|  |  | - `Laminas\Diactoros\marshalHeadersFromSapi(array $server) : array` |
|  |  | - `Laminas\Diactoros\parseCookieHeader(string $header) : array` |
|  |  | - `Laminas\Diactoros\createUploadedFile(array $spec) : UploadedFile` (creates the |
| Expand Down | |  |

20 changes: 20 additions & 0 deletions

20
[docs/book/v2/forward-migration.md](#diff-65462390bdd9ebc4aac894bc0f37725f5ba3231585655066158b334c425c1470 "docs/book/v2/forward-migration.md")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/docs/book/v2/forward-migration.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,20 @@ |
|  |  | # Preparing for Version 3 |
|  |  |  |
|  |  | ## ServerRequestFilterInterface defaults |
|  |  |  |
|  |  | Introduced in version 2.11.1, the `Laminas\Diactoros\ServerRequestFilter\FilterServerRequestInterface` is used by `ServerRequestFactory::fromGlobals()` to allow modifying the generated `ServerRequest` instance prior to returning it. |
|  |  | The primary use case is to allow modifying the generated URI based on the presence of headers such as `X-Forwarded-Host`. |
|  |  | When operating behind a reverse proxy, the `Host` header is often rewritten to the name of the node to which the request is being forwarded, and an `X-Forwarded-Host` header is generated with the original `Host` value to allow the server to determine the original host the request was intended for. |
|  |  | (We have always examined the `X-Forwarded-Proto` header; as of 2.11.1, we also examine the `X-Forwarded-Port` header.) |
|  |  |  |
|  |  | To accommodate this use case, we created `Laminas\Diactoros\ServerRequestFilter\FilterUsingXForwardedHeaders`. |
|  |  |  |
|  |  | Due to potential security issues, it is generally best to only accept these headers if you trust the reverse proxy that has initiated the request. |
|  |  | (This value is found in `$\_SERVER['REMOTE\_ADDR']`, which is present as `$request->getServerParams()['REMOTE\_ADDR']` within PSR-7 implementations.) |
|  |  | `FilterUsingXForwardedHeaders` provides named constructors to allow you to trust these headers from any source (which has been the default behavior of Diactoros since the beginning), or to specify specific IP addresses or CIDR subnets to trust, along with which headers are trusted. |
|  |  | To prevent backwards compatibility breaks, we use this filter by default, marked to trust \*\*only proxies on private subnets\*\*. |
|  |  |  |
|  |  | Features will be added to the 3.11.0 version of [mezzio/mezzio](https://github.com/mezzio/mezzio) that will allow configuring the `Laminas\Diactoros\ServerRequestFilter\FilterServerRequestInterface` instance, and we recommend explicitly configuring this to utilize the `FilterUsingXForwardedHeaders` if you depend on this functionality. |
|  |  | If you \*\*do not\*\* need the functionality, we recommend specifying `Laminas\Diactoros\ServerRequestFilter\DoNotFilter` as the configured `FilterServerRequestInterface` in your application immediately. |
|  |  |  |
|  |  | We will update this documentation with a link to the related functionality in mezzio/mezzio when it is published. |

112 changes: 112 additions & 0 deletions

112
[docs/book/v2/server-request-filters.md](#diff-173530ce0dacc9612182d38ad7aec28f664ff15deda1a2496ce06361479705a0 "docs/book/v2/server-request-filters.md")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/docs/book/v2/server-request-filters.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,112 @@ |
|  |  | # Server Request Filters |
|  |  |  |
|  |  | INFO: \*\*New Feature\*\* |
|  |  | Available since version 2.11.1 |
|  |  |  |
|  |  | Server request filters allow you to modify the initial state of a generated `ServerRequest` instance as returned from `Laminas\Diactoros\ServerRequestFactory::fromGlobals()`. |
|  |  | Common use cases include: |
|  |  |  |
|  |  | - Generating and injecting a request ID. |
|  |  | - Modifying the request URI based on headers provided (e.g., based on the `X-Forwarded-Host` or `X-Forwarded-Proto` headers). |
|  |  |  |
|  |  | ## FilerServerRequestInterface |
|  |  |  |
|  |  | A request filter implements `Laminas\Diactoros\ServerRequestFilter\FilterServerRequestInterface`: |
|  |  |  |
|  |  | ```php |
|  |  | namespace Laminas\Diactoros\ServerRequestFilter; |
|  |  |  |
|  |  | use Psr\Http\Message\ServerRequestInterface; |
|  |  |  |
|  |  | interface FilterServerRequestInterface |
|  |  | { |
|  |  | public function \_\_invoke(ServerRequestInterface $request): ServerRequestInterface; |
|  |  | } |
|  |  | ``` |
|  |  |  |
|  |  | ## Implementations |
|  |  |  |
|  |  | We provide the following implementations: |
|  |  |  |
|  |  | - `DoNotFilter`: returns the provided `$request` verbatim. |
|  |  | - `FilterUsingXForwardedHeaders`: if the originating request comes from a trusted proxy, examines the `X-Forwarded-\*` headers, and returns the request instance with a URI instance that reflects those headers. |
|  |  |  |
|  |  | ### DoNotFilter |
|  |  |  |
|  |  | This filter returns the `$request` argument back verbatim when invoked. |
|  |  |  |
|  |  | ### FilterUsingXForwardedHeaders |
|  |  |  |
|  |  | Servers behind a reverse proxy need mechanisms to determine the original URL requested. |
|  |  | As such, reverse proxies have provided a number of mechanisms for delivering this information, with the use of `X-Forwarded-\*` headers being the most prevalant. |
|  |  | These include: |
|  |  |  |
|  |  | - `X-Forwarded-Host`: the original `Host` header value. |
|  |  | - `X-Forwarded-Port`: the original port included in the `Host` header value. |
|  |  | - `X-Forwarded-Proto`: the original URI scheme used to make the request (e.g., "http" or "https"). |
|  |  |  |
|  |  | `Laminas\Diactoros\ServerRequestFilter\FilterUsingXForwardedHeaders` provides named constructors for choosing whether to never trust proxies, always trust proxies, or choose wich proxies and/or headers to trust in order to modify the URI composed in the request instance to match the original request. |
|  |  | These named constructors are: |
|  |  |  |
|  |  | - `FilterUsingXForwardedHeadersFactory::trustProxies(string[] $proxyCIDRList, string[] $trustedHeaders = FilterUsingXForwardedHeaders::X\_FORWARDED\_HEADERS): void`: when this method is called, only requests originating from the trusted proxy/ies will be considered, as well as only the headers specified. |
|  |  | Proxies may be specified by IP address, or using [CIDR notation](https://en.wikipedia.org/wiki/Classless\_Inter-Domain\_Routing) for subnets; both IPv4 and IPv6 are accepted. |
|  |  | The special string "\*" will be translated to two entries, `0.0.0.0/0` and `::/0`. |
|  |  | - `FilterUsingXForwardedHeaders::trustAny(): void`: when this method is called, the filter will trust requests from any origin, and use any of the above headers to modify the URI instance. |
|  |  | It is functionally equivalent to `FilterUsingXForwardedHeaders::trustProxies(['\*'])`. |
|  |  | - `FilterUsingXForwardedHeaders::trustReservedSubnets(): void`: when this method is called, the filter will trust requests made from reserved, private subnets. |
|  |  | It is functionally equivalent to `FilterUsingXForwardedHeaders::trustProxies()` with the following elements in the `$proxyCIDRList`: |
|  |  | - 10.0.0.0/8 |
|  |  | - 127.0.0.0/8 |
|  |  | - 172.16.0.0/12 |
|  |  | - 192.168.0.0/16 |
|  |  | - ::1/128 (IPv6 localhost) |
|  |  | - fc00::/7 (IPv6 private networks) |
|  |  | - fe80::/10 (IPv6 local-link addresses) |
|  |  |  |
|  |  | Internally, the filter checks the `REMOTE\_ADDR` server parameter (as retrieved from `getServerParams()`) and compares it against each proxy listed; the first to match indicates trust. |
|  |  |  |
|  |  | #### Constants |
|  |  |  |
|  |  | The `FilterUsingXForwardedHeaders` defines the following constants for use in specifying various headers: |
|  |  |  |
|  |  | - `HEADER\_HOST`: corresponds to `X-Forwarded-Host`. |
|  |  | - `HEADER\_PORT`: corresponds to `X-Forwarded-Port`. |
|  |  | - `HEADER\_PROTO`: corresponds to `X-Forwarded-Proto`. |
|  |  |  |
|  |  | #### Example usage |
|  |  |  |
|  |  | Trusting all `X-Forwarded-\*` headers from any source: |
|  |  |  |
|  |  | ```php |
|  |  | $filter = FilterUsingXForwardedHeaders::trustAny(); |
|  |  | ``` |
|  |  |  |
|  |  | Trusting only the `X-Forwarded-Host` header from any source: |
|  |  |  |
|  |  | ```php |
|  |  | $filter = FilterUsingXForwardedHeaders::trustProxies('0.0.0.0/0', [FilterUsingXForwardedHeaders::HEADER\_HOST]); |
|  |  | ``` |
|  |  |  |
|  |  | Trusting the `X-Forwarded-Host` and `X-Forwarded-Proto` headers from a single Class C subnet: |
|  |  |  |
|  |  | ```php |
|  |  | $filter = FilterUsingXForwardedHeaders::trustProxies( |
|  |  | '192.168.1.0/24', |
|  |  | [FilterUsingXForwardedHeaders::HEADER\_HOST, FilterUsingXForwardedHeaders::HEADER\_PROTO] |
|  |  | ); |
|  |  | ``` |
|  |  |  |
|  |  | Trusting the `X-Forwarded-Host` header from either a Class A or a Class C subnet: |
|  |  |  |
|  |  | ```php |
|  |  | $filter = FilterUsingXForwardedHeaders::trustProxies( |
|  |  | ['10.1.1.0/16', '192.168.1.0/24'], |
|  |  | [FilterUsingXForwardedHeaders::HEADER\_HOST, FilterUsingXForwardedHeaders::HEADER\_PROTO] |
|  |  | ); |
|  |  | ``` |
|  |  |  |
|  |  | Trusting any `X-Forwarded-\*` header from any private subnet: |
|  |  |  |
|  |  | ```php |
|  |  | $filter = FilterUsingXForwardedHeaders::trustReservedSubnets(); |
|  |  | ``` |

2 changes: 2 additions & 0 deletions

2
[mkdocs.yml](#diff-98d0f806abc9af24e6a7c545d3d77e8f9ad57643e27211d7a7b896113e420ed2 "mkdocs.yml")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/mkdocs.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,11 +14,13 @@ nav: |
|  |  | - Usage: v2/usage.md |
|  |  | - Reference: |
|  |  | - Factories: v2/factories.md |
|  |  | - "Server Request Filters": v2/server-request-filters.md |
|  |  | - "Custom Responses": v2/custom-responses.md |
|  |  | - Serialization: v2/serialization.md |
|  |  | - API: v2/api.md |
|  |  | - Migration: |
|  |  | - "Migration to Version 2": v2/migration.md |
|  |  | - "Preparing for Version 3": v2/forward-migration.md |
|  |  | - v1: |
|  |  | - Overview: v1/overview.md |
|  |  | - Installation: v1/install.md |
| Expand Down | |  |

34 changes: 33 additions & 1 deletion

34
[psalm-baseline.xml](#diff-3208225af5a3ef0c924761633ad6b04cbfa5eab3d3bafcc49c79441e89257ee7 "psalm-baseline.xml")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/psalm-baseline.xml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,5 @@ |
|  |  | <?xml version="1.0" encoding="UTF-8"?> |
|  |  | <files psalm-version="4.21.0@d8bec4c7aaee111a532daec32fb09de5687053d1"> |
|  |  | <files psalm-version="4.23.0@f1fe6ff483bf325c803df9f510d09a03fd796f88"> |
|  |  | <file src="src/CallbackStream.php"> |
|  |  | <ImplementedReturnTypeMismatch occurrences="1"> |
|  |  | <code>null|callable</code> |
| Expand Down  Expand Up | | @@ -242,13 +242,45 @@ |
|  |  | </ParamNameMismatch> |
|  |  | </file> |
|  |  | <file src="src/ServerRequestFactory.php"> |
|  |  | <LessSpecificReturnStatement occurrences="1"/> |
|  |  | <MixedArgument occurrences="1"> |
|  |  | <code>$headers['cookie']</code> |
|  |  | </MixedArgument> |
|  |  | <MixedAssignment occurrences="3"> |
|  |  | <code>$iisUrlRewritten</code> |
|  |  | <code>$requestUri</code> |
|  |  | <code>$unencodedUrl</code> |
|  |  | </MixedAssignment> |
|  |  | <MixedInferredReturnType occurrences="1"> |
|  |  | <code>array{string, int|null}</code> |
|  |  | </MixedInferredReturnType> |
|  |  | <MixedReturnStatement occurrences="1"> |
|  |  | <code>$defaults</code> |
|  |  | </MixedReturnStatement> |
|  |  | <MoreSpecificReturnType occurrences="1"> |
|  |  | <code>ServerRequest</code> |
|  |  | </MoreSpecificReturnType> |
|  |  | <RedundantConditionGivenDocblockType occurrences="1"> |
|  |  | <code>is\_callable(self::$apacheRequestHeaders)</code> |
|  |  | </RedundantConditionGivenDocblockType> |
|  |  | </file> |
|  |  | <file src="src/ServerRequestFilter/FilterUsingXForwardedHeaders.php"> |
|  |  | <ImpureMethodCall occurrences="7"> |
|  |  | <code>getHeaderLine</code> |
|  |  | <code>getServerParams</code> |
|  |  | <code>getUri</code> |
|  |  | <code>withHost</code> |
|  |  | <code>withPort</code> |
|  |  | <code>withScheme</code> |
|  |  | <code>withUri</code> |
|  |  | </ImpureMethodCall> |
|  |  | <LessSpecificReturnStatement occurrences="1"> |
|  |  | <code>$proxyCIDRList</code> |
|  |  | </LessSpecificReturnStatement> |
|  |  | <MoreSpecificReturnType occurrences="1"> |
|  |  | <code>list&lt;non-empty-string&gt;</code> |
|  |  | </MoreSpecificReturnType> |
|  |  | </file> |
|  |  | <file src="src/Stream.php"> |
|  |  | <InvalidArgument occurrences="1"/> |
|  |  | <MixedInferredReturnType occurrences="1"> |
| Expand Down | |  |

15 changes: 15 additions & 0 deletions

15
[psalm.xml.dist](#diff-2d20a98059390e83ae58234d4bda07fe9319b822009ce8c4479e0f3ae1943fbf "psalm.xml.dist")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/psalm.xml.dist)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,11 +15,26 @@ |
|  |  | </projectFiles> |
|  |  |  |
|  |  | <issueHandlers> |
|  |  | <DeprecatedFunction> |
|  |  | <errorLevel type="suppress"> |
|  |  | <referencedFunction name="laminas\diactoros\marshalurifromsapi"/> |
|  |  | </errorLevel> |
|  |  | </DeprecatedFunction> |
|  |  |  |
|  |  | <InternalClass> |
|  |  | <errorLevel type="suppress"> |
|  |  | <referencedClass name="Laminas\Diactoros\ServerRequestFilter\IPRange"/> |
|  |  | </errorLevel> |
|  |  | </InternalClass> |
|  |  |  |
|  |  | <InternalMethod> |
|  |  | <errorLevel type="suppress"> |
|  |  | <referencedMethod name="PHPUnit\Framework\MockObject\Builder\InvocationMocker::method"/> |
|  |  | <referencedMethod name="PHPUnit\Framework\MockObject\Builder\InvocationMocker::willReturn"/> |
|  |  | <referencedMethod name="PHPUnit\Framework\MockObject\Builder\InvocationMocker::with"/> |
|  |  | <referencedMethod name="Laminas\Diactoros\ServerRequestFilter\IPRange::matches"/> |
|  |  | <referencedMethod name="Laminas\Diactoros\ServerRequestFilter\IPRange::matchesIPv4"/> |
|  |  | <referencedMethod name="Laminas\Diactoros\ServerRequestFilter\IPRange::matchesIPv6"/> |
|  |  | </errorLevel> |
|  |  | </InternalMethod> |
|  |  |  |
| Expand Down | |  |

18 changes: 18 additions & 0 deletions

18
[src/ConfigProvider.php](#diff-f0a2f25e61573ecaca3a489ef6fca6a6106b7f825ef5599ec374f5387db58f82 "src/ConfigProvider.php")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/src/ConfigProvider.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,6 +13,11 @@ |
|  |  |  |
|  |  | class ConfigProvider |
|  |  | { |
|  |  | public const CONFIG\_KEY = 'laminas-diactoros'; |
|  |  | public const X\_FORWARDED = 'x-forwarded-request-filter'; |
|  |  | public const X\_FORWARDED\_TRUSTED\_PROXIES = 'trusted-proxies'; |
|  |  | public const X\_FORWARDED\_TRUSTED\_HEADERS = 'trusted-headers'; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Retrieve configuration for laminas-diactoros. |
|  |  | \* |
| Expand All | | @@ -22,6 +27,7 @@ public function \_\_invoke() : array |
|  |  | { |
|  |  | return [ |
|  |  | 'dependencies' => $this->getDependencies(), |
|  |  | self::CONFIG\_KEY => $this->getComponentConfig(), |
|  |  | ]; |
|  |  | } |
|  |  |  |
| Expand All | | @@ -31,6 +37,7 @@ public function \_\_invoke() : array |
|  |  | \*/ |
|  |  | public function getDependencies() : array |
|  |  | { |
|  |  | // @codingStandardsIgnoreStart |
|  |  | return [ |
|  |  | 'invokables' => [ |
|  |  | RequestFactoryInterface::class => RequestFactory::class, |
| Expand All | | @@ -41,5 +48,16 @@ public function getDependencies() : array |
|  |  | UriFactoryInterface::class => UriFactory::class |
|  |  | ], |
|  |  | ]; |
|  |  | // @codingStandardsIgnoreEnd |
|  |  | } |
|  |  |  |
|  |  | public function getComponentConfig(): array |
|  |  | { |
|  |  | return [ |
|  |  | self::X\_FORWARDED => [ |
|  |  | self::X\_FORWARDED\_TRUSTED\_PROXIES => '', |
|  |  | self::X\_FORWARDED\_TRUSTED\_HEADERS => [], |
|  |  | ], |
|  |  | ]; |
|  |  | } |
|  |  | } |

24 changes: 24 additions & 0 deletions

24
[src/Exception/InvalidForwardedHeaderNameException.php](#diff-a42461cb8f82097343f456faa06fee76e8042190068cbe40d8694170f8f80706 "src/Exception/InvalidForwardedHeaderNameException.php")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/src/Exception/InvalidForwardedHeaderNameException.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,24 @@ |
|  |  | <?php |
|  |  |  |
|  |  | declare(strict\_types=1); |
|  |  |  |
|  |  | namespace Laminas\Diactoros\Exception; |
|  |  |  |
|  |  | use Laminas\Diactoros\ServerRequestFilter\FilterUsingXForwardedHeaders; |
|  |  |  |
|  |  | class InvalidForwardedHeaderNameException extends RuntimeException implements ExceptionInterface |
|  |  | { |
|  |  | /\*\* @param mixed $name \*/ |
|  |  | public static function forHeader($name): self |
|  |  | { |
|  |  | if (! is\_string($name)) { |
|  |  | $name = sprintf('(value of type %s)', is\_object($name) ? get\_class($name) : gettype($name)); |
|  |  | } |
|  |  |  |
|  |  | return new self(sprintf( |
|  |  | 'Invalid X-Forwarded-\* header name "%s" provided to %s', |
|  |  | $name, |
|  |  | FilterUsingXForwardedHeaders::class |
|  |  | )); |
|  |  | } |
|  |  | } |

29 changes: 29 additions & 0 deletions

29
[src/Exception/InvalidProxyAddressException.php](#diff-9ccffd8a37363776cb2106fe5b28b32633103be3da9fbb872c44a059ad023df4 "src/Exception/InvalidProxyAddressException.php")

Show comments

[View file](/laminas/laminas-diactoros/blob/25b11d422c2e5dad868f68619888763b30f91e2d/src/Exception/InvalidProxyAddressException.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,29 @@ |
|  |  | <?php |
|  |  |  |
|  |  | declare(strict\_types=1); |
|  |  |  |
|  |  | namespace Laminas\Diactoros\Exception; |
|  |  |  |
|  |  | class InvalidProxyAddressException extends RuntimeException implements ExceptionInterface |
|  |  | { |
|  |  | /\*\* @param mixed $proxy \*/ |
|  |  | public static function forInvalidProxyArgument($proxy): self |
|  |  | { |
|  |  | $type = is\_object($proxy) ? get\_class($proxy) : gettype($proxy); |
|  |  | return new self(sprintf( |
|  |  | 'Invalid proxy of type "%s" provided;' |
|  |  | . ' must be a valid IPv4 or IPv6 address, optionally with a subnet mask provided' |
|  |  | . ' or an array of such values', |
|  |  | $type, |
|  |  | )); |
|  |  | } |
|  |  |  |
|  |  | public static function forAddress(string $address): self |
|  |  | { |
|  |  | return new self(sprintf( |
|  |  | 'Invalid proxy address "%s" provided;' |
|  |  | . ' must be a valid IPv4 or IPv6 address, optionally with a subnet mask provided', |
|  |  | $address, |
|  |  | )); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `25b11d4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flaminas%2Flaminas-diactoros%2Fcommit%2F25b11d422c2e5dad868f68619888763b30f91e2d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


