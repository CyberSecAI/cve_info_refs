=== Content from github.com_873d7570_20250114_183057.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Freleases%2Ftag%2Fv2.7.2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Freleases%2Ftag%2Fv2.7.2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow/tree/v2.7.2)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow/tree/v2.7.2)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

1. [Releases](/tensorflow/tensorflow/releases)
2. [v2.7.2](/tensorflow/tensorflow/releases/tag/v2.7.2)

# TensorFlow 2.7.2

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/tensorflow/tensorflow/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.7.2)

 Loading

[View all tags](/tensorflow/tensorflow/tags)

![@tensorflow-jenkins](https://avatars.githubusercontent.com/u/16359713?s=40&v=4)
[tensorflow-jenkins](/tensorflow-jenkins)
released this
16 May 17:44

·
[147 commits](/tensorflow/tensorflow/compare/v2.7.2...r2.7)
to r2.7
since this release

[v2.7.2](/tensorflow/tensorflow/tree/v2.7.2)

[`dd7b8a3`](/tensorflow/tensorflow/commit/dd7b8a3c1714d0052ce4b4a2fd8dcef927439a24)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

# Release 2.7.2

This releases introduces several vulnerability fixes:

* Fixes a code injection in `saved_model_cli` ([CVE-2022-29216](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29216))
* Fixes a missing validation which causes `TensorSummaryV2` to crash ([CVE-2022-29193](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29193))
* Fixes a missing validation which crashes `QuantizeAndDequantizeV4Grad` ([CVE-2022-29192](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29192))
* Fixes a missing validation which causes denial of service via `DeleteSessionTensor` ([CVE-2022-29194](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29194))
* Fixes a missing validation which causes denial of service via `GetSessionTensor` ([CVE-2022-29191](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29191))
* Fixes a missing validation which causes denial of service via `StagePeek` ([CVE-2022-29195](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29195))
* Fixes a missing validation which causes denial of service via `UnsortedSegmentJoin` ([CVE-2022-29197](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29197))
* Fixes a missing validation which causes denial of service via `LoadAndRemapMatrix` ([CVE-2022-29199](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29199))
* Fixes a missing validation which causes denial of service via `SparseTensorToCSRSparseMatrix` ([CVE-2022-29198](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29198))
* Fixes a missing validation which causes denial of service via `LSTMBlockCell` ([CVE-2022-29200](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29200))
* Fixes a missing validation which causes denial of service via `Conv3DBackpropFilterV2` ([CVE-2022-29196](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29196))
* Fixes a `CHECK` failure in depthwise ops via overflows ([CVE-2021-41197](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41197))
* Fixes issues arising from undefined behavior stemming from users supplying invalid resource handles ([CVE-2022-29207](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29207))
* Fixes a segfault due to missing support for quantized types ([CVE-2022-29205](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29205))
* Fixes a missing validation which results in undefined behavior in `SparseTensorDenseAdd` ([CVE-2022-29206](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29206))
* Fixes a missing validation which results in undefined behavior in `QuantizedConv2D` ([CVE-2022-29201](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29201))
* Fixes an integer overflow in `SpaceToBatchND` ([CVE-2022-29203](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29203))
* Fixes a segfault and OOB write due to incomplete validation in `EditDistance` ([CVE-2022-29208](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29208))
* Fixes a missing validation which causes denial of service via `Conv3DBackpropFilterV2` ([CVE-2022-29204](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29204))
* Fixes a denial of service in `tf.ragged.constant` due to lack of validation ([CVE-2022-29202](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29202))
* Fixes a segfault when `tf.histogram_fixed_width` is called with NaN values ([CVE-2022-29211](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29211))
* Fixes a core dump when loading TFLite models with quantization ([CVE-2022-29212](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29212))
* Fixes crashes stemming from incomplete validation in signal ops ([CVE-2022-29213](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29213))
* Fixes a type confusion leading to `CHECK`-failure based denial of service ([CVE-2022-29209](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29209))
* Updates `curl` to `7.83.1` to handle ([CVE-2022-22576](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-22576), ([CVE-2022-27774](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27774), ([CVE-2022-27775](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27775), ([CVE-2022-27776](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27776), ([CVE-2022-27778](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27778), ([CVE-2022-27779](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27779), ([CVE-2022-27780](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27780), ([CVE-2022-27781](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27781), ([CVE-2022-27782](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27782) and ([CVE-2022-30115](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-30115)
* Updates `zlib` to `1.2.12` after `1.2.11` was pulled due to [security issue](https://www.openwall.com/lists/oss-security/2022/03/28/1)

 Assets
2

 Loading

 👍
1
 u7484835 reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

 1 person reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8745fae7_20250114_183059.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Freleases%2Ftag%2Fv2.9.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Freleases%2Ftag%2Fv2.9.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow/tree/v2.9.0)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow/tree/v2.9.0)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

1. [Releases](/tensorflow/tensorflow/releases)
2. [v2.9.0](/tensorflow/tensorflow/releases/tag/v2.9.0)

# TensorFlow 2.9.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/tensorflow/tensorflow/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.9.0)

 Loading

[View all tags](/tensorflow/tensorflow/tags)

![@tensorflow-jenkins](https://avatars.githubusercontent.com/u/16359713?s=40&v=4)
[tensorflow-jenkins](/tensorflow-jenkins)
released this
16 May 21:12

·
[257 commits](/tensorflow/tensorflow/compare/v2.9.0...r2.9)
to r2.9
since this release

[v2.9.0](/tensorflow/tensorflow/tree/v2.9.0)

[`8a20d54`](/tensorflow/tensorflow/commit/8a20d54a3c1bfa38c03ea99a2ad3c1b0a45dfa95)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

# Release 2.9.0

# Breaking Changes

* Due to security issues in TF 2.8, all boosted trees code has now been removed (after being deprecated in TF 2.8). Users should switch to [TensorFlow Decision Forests](https://github.com/tensorflow/decision-forests).
* Build, Compilation and Packaging
  + TensorFlow is now compiled with `_GLIBCXX_USE_CXX11_ABI=1`. Downstream projects that encounter `std::__cxx11` or `[abi:cxx11]` linker errors will need to adopt this compiler option. See [the GNU C++ Library docs on Dual ABI](https://gcc.gnu.org/onlinedocs/libstdc%2B%2B/manual/using_dual_abi.html).
  + TensorFlow Python wheels now specifically conform to [manylinux2014](https://peps.python.org/pep-0599/), an upgrade from manylinux2010. The minimum Pip version supporting manylinux2014 is Pip 19.3 (see [pypa/manylinux](https://github.com/pypa/manylinux). This change may affect you if you have been using TensorFlow on a very old platform equivalent to CentOS 6, as manylinux2014 targets CentOS 7 as a compatibility base. Note that TensorFlow does not officially support either platform.
  + Discussion for these changes can be found on SIG Build's [TensorFlow Community Forum thread](https://discuss.tensorflow.org/t/tensorflow-linux-wheels-are-being-upgraded-to-manylinux2014/8339)
* The `tf.keras.mixed_precision.experimental` API has been removed. The non-experimental symbols under `tf.keras.mixed_precision` have been available since TensorFlow 2.4 and should be used instead.
  + The non-experimental API has some minor differences from the experimental API. In most cases, you only need to make three minor changes:
    - Remove the word "experimental" from `tf.keras.mixed_precision` symbols. E.g., replace `tf.keras.mixed_precision.experimental.global_policy` with `tf.keras.mixed_precision.global_policy`.
    - Replace `tf.keras.mixed_precision.experimental.set_policy` with `tf.keras.mixed_precision.set_global_policy`. The experimental symbol `set_policy` was renamed to `set_global_policy` in the non-experimental API.
    - Replace `LossScaleOptimizer(opt, "dynamic")` with `LossScaleOptimizer(opt)`. If you pass anything other than `"dynamic"` to the second argument, see (1) of the next section.
  + In the following rare cases, you need to make more changes when switching to the non-experimental API:
    - If you passed anything other than `"dynamic"` to the `loss_scale` argument (the second argument) of `LossScaleOptimizer`:
      * The LossScaleOptimizer constructor takes in different arguments. See the [TF 2.7 documentation of tf.keras.mixed\_precision.experimental.LossScaleOptimizer](https://www.tensorflow.org/versions/r2.7/api_docs/python/tf/keras/mixed_precision/experimental/LossScaleOptimizer) for details on the differences, which has examples on how to convert to the non-experimental LossScaleOptimizer.
    - If you passed a value to the `loss_scale` argument (the second argument) of `Policy`:
      * The experimental version of `Policy` optionally took in a `tf.compat.v1.mixed_precision.LossScale` in the constructor, which defaulted to a dynamic loss scale for the `"mixed_float16"` policy and no loss scale for other policies. In `Model.compile`, if the model's policy had a loss scale, the optimizer would be wrapped with a `LossScaleOptimizer`. With the non-experimental `Policy`, there is no loss scale associated with the `Policy`, and `Model.compile` wraps the optimizer with a `LossScaleOptimizer` if and only if the policy is a `"mixed_float16"` policy. If you previously passed a `LossScale` to the experimental `Policy`, consider just removing it, as the default loss scaling behavior is usually what you want. If you really want to customize the loss scaling behavior, you can wrap your optimizer with a `LossScaleOptimizer` before passing it to `Model.compile`.
    - If you use the very rarely-used function `tf.keras.mixed_precision.experimental.get_layer_policy`:
      * Replace `tf.keras.mixed_precision.experimental.get_layer_policy(layer)` with `layer.dtype_policy`.
* `tf.mixed_precision.experimental.LossScale` and its subclasses have been removed from the TF2 namespace. This symbols were very rarely used and were only useful in TF2 for use in the now-removed `tf.keras.mixed_precision.experimental` API. The symbols are still available under `tf.compat.v1.mixed_precision`.
* The `experimental_relax_shapes` heuristic for `tf.function` has been deprecated and replaced with `reduce_retracing` which encompasses broader heuristics to reduce the number of retraces (see below)

# Major Features and Improvements

* `tf.keras`:

  + Added `tf.keras.applications.resnet_rs` models. This includes the `ResNetRS50`, `ResNetRS101`, `ResNetRS152`, `ResNetRS200`, `ResNetRS270`, `ResNetRS350` and `ResNetRS420` model architectures. The ResNetRS models are based on the architecture described in [Revisiting ResNets: Improved Training and Scaling Strategies](https://arxiv.org/pdf/2103.07579.pdf)
  + Added `tf.keras.optimizers.experimental.Optimizer`. The reworked optimizer gives more control over different phases of optimizer calls, and is easier to customize. We provide Adam, SGD, Adadelta, AdaGrad and RMSprop optimizers based on `tf.keras.optimizers.experimental.Optimizer`. Generally the new optimizers work in the same way as the old ones, but support new constructor arguments. In the future, the symbols `tf.keras.optimizers.Optimizer`/`Adam`/etc will point to the new optimizers, and the previous generation of optimizers will be moved to `tf.keras.optimizers.legacy.Optimizer`/`Adam`/etc.
  + Added L2 unit normalization layer `tf.keras.layers.UnitNormalization`.
  + Added `tf.keras.regularizers.OrthogonalRegularizer`, a new regularizer that encourages orthogonality between the rows (or columns) or a weight matrix.
  + Added `tf.keras.layers.RandomBrightness` layer for image preprocessing.
  + Added APIs for switching between interactive logging and absl logging. By default, Keras always writes the logs to stdout. However, this is not optimal in a non-interactive environment, where you don't have access to stdout, but can only view the logs. You can use `tf.keras.utils.disable_interactive_logging()` to write the logs to ABSL logging. You can also use `tf.keras.utils.enable_interactive_logging()` to change it back to stdout, or `tf.keras.utils.is_interactive_logging_enabled()` to check if interactive logging is enabled.
  + Changed default value for the `verbose` argument of `Model.evaluate()` and `Model.predict()` to `"auto"`, which defaults to `verbose=1` for most cases and defaults to `verbose=2` when used with `ParameterServerStrategy` or with interactive logging disabled.
  + Argument `jit_compile` in `Model.compile()` now applies to `Model.evaluate()` and `Model.predict()`. Setting `jit_compile=True` in `compile()` compiles the model's training, evaluation, and inference steps to [XLA](https://www.tensorflow.org/xla). Note that `jit_compile=True` may not necessarily work for all models.
  + Added DTensor-related Keras APIs under `tf.keras.dtensor` namespace. The APIs are still classified as experimental. You are welcome to try it out. Please check the tutoral and guide on <https://www.tensorflow.org/> for more details about DTensor.
* `tf.lite`:

  + Added TFLite builtin op support for the following TF ops:
    - `tf.math.argmin`/`tf.math.argmax` for input data type `tf.bool` on CPU.
    - `tf.nn.gelu` op for output data type `tf.float32` and quantization on CPU.
  + Add nominal support for unsigned 16-bit integer tensor types. Note that very few TFLite kernels support this type natively, so its use in mobile ML authoring is generally discouraged.
  + Add support for unsigned 16-bit integer tensor types in cast op.
  + Experimental support for lowering `list_ops.tensor_list_set_item` with `DynamicUpdateSlice`.
  + Enabled a new MLIR-based dynamic range quantization backend by default
    - The new backend is used for post-training int8 dynamic range quantization and post-training float16 quantization.
    - Set `experimental_new_dynamic_range_quantizer` in tf.lite.TFLiteConverter to False to disable this change
  + Native TF Lite variables are now enabled during conversion by default on all v2 TfLiteConverter entry points. `experimental_enable_resource_variables` on tf.lite.TFLiteConverter is now True by default and will be removed in the future.
* `tf.function`:

  + Custom classes used as arguments for `tf.function` can now specify rules regarding when retracing needs to occur by implementing the Tracing Protocol available through `tf.types.experimental.SupportsTracingProtocol`.
  + `TypeSpec` classes (as associated with `ExtensionTypes`) also implement the Tracing Protocol which can be overriden if necessary.
  + The newly introduced `reduce_retracing` option also uses the Tracing Protocol to proactively generate generalized traces similar to `experimental_relax_shapes` (which has now been deprecated).
* Unified eager and `tf.function` execution:

  + Eager mode can now execute each op as a `tf.function`, allowing for more consistent feature support in future releases.
  + It is available for immediate use.
    - See the `TF_RUN_EAGER_OP_AS_FUNCTION` environment variable in [eager context](https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/eager/context.py).
    - Eager performance should be similar with this feature enabled.
      * A roughly 5us per-op overhead may be observed when running many small functions.
      * Note a [known issue](https://github.com/tensorflow/tensorflow/issues/55414) with GPU performance.
    - The behavior of `tf.function` itself is unaffected.
  + Note: This feature will be enabled by default in an upcoming version of TensorFlow.
* `tf.experimental.dtensor`: Added DTensor, an extension to TensorFlow for large-scale modeling with minimal changes to user code. You are welcome to try it out, though be aware that the DTensor API is experimental and up-to backward-incompatible changes. DTensor and Keras integration is published under `tf.keras.dtensor` in this release (refer to the `tf.keras` entry). The tutoral and guide for DTensor will be published on <https://www.tensorflow.org/>. Please stay tuned.
* [oneDNN CPU performance optimizations](https://github.com/tensorflow/community/blob/master/rfcs/20210930-enable-onednn-ops.md) are available in Linux x86, Windows x86, and Linux aarch64 packages.

  + **Linux x86 packages:**
    - oneDNN optimizations are *enabled by default* on CPUs with neural-network-focused hardware features such as AVX512\_VNNI, AVX512\_BF16, AMX, etc. ([Intel Cascade Lake](https://www.intel.com/content/www/us/en/products/platforms/details/cascade-lake.html) and newer CPUs.)
      * [Example performance speedups.](https://medium.com/intel-analytics-software/leverage-intel-deep-learning-optimizations-in-tensorflow-129faa80ee07)
    - For older CPUs, oneDNN optimizations are disabled by default.
  + **Windows x86 package:** oneDNN optimizations are disabled by default.
  + **Linux aach64 (`--config=mkl_aarch64`) package:**
    - Experimental oneDNN optimizations are disabled by default.
    - If you experience issues with oneDNN optimizations on, we recommend turning them off.
  + To explicitly enable or disable oneDNN optimizations, set the environment variable `TF_ENABLE_ONEDNN_OPTS` to `1` (enable) or `0` (disable) before running TensorFlow. (The variable is checked during `import tensorflow`.) To fall back to default settings, unset the environment variable.
  + These optimizations can yield slightly different numerical results from when they are off due to floating-point round-off errors from different computation approaches and orders.
  + To verify that the optimizations are on, look for a message with *"oneDNN custom operations are on"* in the log. If the exact phrase is not there, it means they are off.

# Bug Fixes and Other Changes

* `tf.data`:

  + Fixed bug in `tf.data.experimental.parse_example_dataset` when `tf.io.RaggedFeatures` would specify `value_key` but no `partitions`. Before the fix, setting `value_key` but no `partitions` would result in the feature key being replaced by the value key, e.g. `{'value_key': <RaggedTensor>}` instead of `{'key': <RaggedTensor>}`. Now the correct feature key will be used. This aligns the behavior of `tf.data.experimental.parse_example_dataset` to match the behavior of `tf.io.parse_example`.
  + Added a new field, `filter_parallelization`, to `tf.data.experimental.OptimizationOptions`. If it is set to `True`, tf.data will run `Filter` transformation with multiple threads. Its default value is `False` if not specified.
* `tf.keras`:

  + Fixed bug in optimizers that prevented them from properly checkpointing slot variables when they are `ShardedVariable`s (used for training with `tf.distribute.experimental.ParameterServerStrategy`).
* `tf.random`:

  + Added `tf.random.experimental.index_shuffle`, for shuffling a sequence without materializing the sequence in memory.
* `tf.RaggedTensor`:

  + Introduced `tf.experimental.RowPartition`, which encodes how one dimension in a RaggedTensor relates to another, into the public API.
  + Introduced `tf.experimental.DynamicRaggedShape`, which represents the shape of a RaggedTensor.

## Security

* Fixes a code injection in `saved_model_cli` ([CVE-2022-29216](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29216))
* Fixes a missing validation which causes `TensorSummaryV2` to crash ([CVE-2022-29193](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29193))
* Fixes a missing validation which crashes `QuantizeAndDequantizeV4Grad` ([CVE-2022-29192](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29192))
* Fixes a missing validation which causes denial of service via `DeleteSessionTensor` ([CVE-2022-29194](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29194))
* Fixes a missing validation which causes denial of service via `GetSessionTensor` ([CVE-2022-29191](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29191))
* Fixes a missing validation which causes denial of service via `StagePeek` ([CVE-2022-29195](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29195))
* Fixes a missing validation which causes denial of service via `UnsortedSegmentJoin` ([CVE-2022-29197](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29197))
* Fixes a missing validation which causes denial of service via `LoadAndRemapMatrix` ([CVE-2022-29199](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29199))
* Fixes a missing validation which causes denial of service via `SparseTensorToCSRSparseMatrix` ([CVE-2022-29198](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29198))
* Fixes a missing validation which causes denial of service via `LSTMBlockCell` ([CVE-2022-29200](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29200))
* Fixes a missing validation which causes denial of service via `Conv3DBackpropFilterV2` ([CVE-2022-29196](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29196))
* Fixes a `CHECK` failure in depthwise ops via overflows ([CVE-2021-41197](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41197))
* Fixes issues arising from undefined behavior stemming from users supplying invalid resource handles ([CVE-2022-29207](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29207))
* Fixes a segfault due to missing support for quantized types ([CVE-2022-29205](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29205))
* Fixes a missing validation which results in undefined behavior in `SparseTensorDenseAdd` ([CVE-2022-29206](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29206))
* Fixes a missing validation which results in undefined behavior in `QuantizedConv2D` ([CVE-2022-29201](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29201))
* Fixes an integer overflow in `SpaceToBatchND` ([CVE-2022-29203](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29203))
* Fixes a segfault and OOB write due to incomplete validation in `EditDistance` ([CVE-2022-29208](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29208))
* Fixes a missing validation which causes denial of service via `Conv3DBackpropFilterV2` ([CVE-2022-29204](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29204))
* Fixes a denial of service in `tf.ragged.constant` due to lack of validation ([CVE-2022-29202](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29202))
* Fixes a segfault when `tf.histogram_fixed_width` is called with NaN values ([CVE-2022-29211](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29211))
* Fixes a core dump when loading TFLite models with quantization ([CVE-2022-29212](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29212))
* Fixes crashes stemming from incomplete validation in signal ops ([CVE-2022-29213](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29213))
* Fixes a type confusion leading to `CHECK`-failure based denial of service ([CVE-2022-29209](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29209))
* Fixes a heap buffer overflow due to incorrect hash function ([CVE-2022-29210](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29210))
* Updates `curl` to `7.83.1` to handle ([CVE-2022-22576](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-22576), ([CVE-2022-27774](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27774), ([CVE-2022-27775](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27775), ([CVE-2022-27776](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27776), ([CVE-2022-27778](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27778), ([CVE-2022-27779](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27779), ([CVE-2022-27780](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27780), ([CVE-2022-27781](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27781), ([CVE-2022-27782](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27782) and ([CVE-2022-30115](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-30115)
* Updates `zlib` to `1.2.12` after `1.2.11` was pulled due to [security issue](https://www.openwall.com/lists/oss-security/2022/03/28/1)

# Thanks to our Contributors

This release contains contributions from many people at Google, as well as:

Aaron Debattista, Abel Soares Siqueira, Abhishek Varma, Andrei Ivanov, andreii, Andrew Goodbody, apeltop, Arnab Dutta, Ashiq Imran, Banikumar Maiti (Intel Aipg), Ben Greiner, Benjamin Peterson, bhack, Christopher Bate, chunduriv, Copybara-Service, DEKHTIARJonathan, Deven Desai, Duncan Riach, Eric Kunze, Everton Constantino, Faruk D, Fredrik Knutsson, gadagashwini, Gauri1 Deshpande, gtiHibGele, Guozhong Zhuang, Islem-Esi, Ivanov Viktor, Jason Furmanek, Jason Zaman, Jim, Jinzhe Zeng, John Laxson, Jonas Eschle, Jonas Eschle 'Mayou36, Jonathan Dekhtiar, Kaixi Hou, Kanvi Khanna, KaurkerDevourer, Koan-Sin Tan, kushanam, Laramie Leavitt, Li-Wen Chang, lipracer, Louis Sugy, Lu Teng, Mahmoud Abuzaina, Malcolm Slaney, Malik Shahzad Muzaffar, Marek Šuppa, Matt Conley, Michael Melesse, Milos Puzovic, mohantym, Nathan John Sircombe, Nathan Luehr, Nilesh Agarwalla, Patrice Vignola, peterjc123, Philip Turner, Rajeshwar Reddy T, Robert Kalmar, Rodrigo Formigone, Rohit Santhanam, rui, Sachin Muradi, Saduf2019, sandip, Scott Leishman, Serge Panev, Shi,Guangyong, Srinivasan Narayanamoorthy, stanley, Steven I Reeves, stevenireeves, sushreebarsa, Tamas Bela Feher, Tao He, Thomas Schmeyer, Tiago Almeida, Trevor Morris, Uday Bondhugula, Uwe L. Korn, Varghese, Jojimon, Vishnuvardhan Janapati, William Muir, William Raveane, xutianming, Yasuhiro Matsumoto, Yimei Sun, Yong Tang, Yu Feng, Yuriy Chernyshov, zhaozheng09

 Assets
2

 Loading

 👍
42
 sergiud, valentingol, njzjz, jeongukjae, DachuanZhao, CamiloYate09, mehadi92, NiwakaDev, EarlGeorge, robinthibaut, and 32 more reacted with thumbs up emoji
 🎉
6
 EarlGeorge, ranpafin, xin-hao-2025, sushreebarsa, xtianxy, and QuantHao reacted with hooray emoji
 ❤️
14
 pineapplejuice233, jeongukjae, kotAPI, VAIBHAV0526, ruancomelli, T-Almeida, sa-y-an, ranpafin, xin-hao-2025, Manu254rce, and 4 more reacted with heart emoji
 🚀
13
 faizan-m, hitenkoku, jeongukjae, EarlGeorge, Nikronic, T-Almeida, jf17, markmcd, ranpafin, xin-hao-2025, and 3 more reacted with rocket emoji
 👀
3
 Davi-ldc, xin-hao-2025, and QuantHao reacted with eyes emoji

All reactions

* 👍
  42 reactions
* 🎉
  6 reactions
* ❤️
  14 reactions
* 🚀
  13 reactions
* 👀
  3 reactions

 58 people reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0c182122_20250114_183056.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Freleases%2Ftag%2Fv2.6.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Freleases%2Ftag%2Fv2.6.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow/tree/v2.6.4)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow/tree/v2.6.4)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

1. [Releases](/tensorflow/tensorflow/releases)
2. [v2.6.4](/tensorflow/tensorflow/releases/tag/v2.6.4)

# TensorFlow 2.6.4

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/tensorflow/tensorflow/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.6.4)

 Loading

[View all tags](/tensorflow/tensorflow/tags)

![@tensorflow-jenkins](https://avatars.githubusercontent.com/u/16359713?s=40&v=4)
[tensorflow-jenkins](/tensorflow-jenkins)
released this
16 May 17:44

·
[9 commits](/tensorflow/tensorflow/compare/v2.6.4...r2.6)
to r2.6
since this release

[v2.6.4](/tensorflow/tensorflow/tree/v2.6.4)

[`33ed2b1`](/tensorflow/tensorflow/commit/33ed2b11cb8e879d86c371700e6573db1814a69e)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

# Release 2.6.4

This releases introduces several vulnerability fixes:

* Fixes a code injection in `saved_model_cli` ([CVE-2022-29216](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29216))
* Fixes a missing validation which causes `TensorSummaryV2` to crash ([CVE-2022-29193](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29193))
* Fixes a missing validation which crashes `QuantizeAndDequantizeV4Grad` ([CVE-2022-29192](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29192))
* Fixes a missing validation which causes denial of service via `DeleteSessionTensor` ([CVE-2022-29194](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29194))
* Fixes a missing validation which causes denial of service via `GetSessionTensor` ([CVE-2022-29191](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29191))
* Fixes a missing validation which causes denial of service via `StagePeek` ([CVE-2022-29195](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29195))
* Fixes a missing validation which causes denial of service via `UnsortedSegmentJoin` ([CVE-2022-29197](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29197))
* Fixes a missing validation which causes denial of service via `LoadAndRemapMatrix` ([CVE-2022-29199](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29199))
* Fixes a missing validation which causes denial of service via `SparseTensorToCSRSparseMatrix` ([CVE-2022-29198](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29198))
* Fixes a missing validation which causes denial of service via `LSTMBlockCell` ([CVE-2022-29200](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29200))
* Fixes a missing validation which causes denial of service via `Conv3DBackpropFilterV2` ([CVE-2022-29196](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29196))
* Fixes a `CHECK` failure in depthwise ops via overflows ([CVE-2021-41197](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41197))
* Fixes issues arising from undefined behavior stemming from users supplying invalid resource handles ([CVE-2022-29207](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29207))
* Fixes a segfault due to missing support for quantized types ([CVE-2022-29205](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29205))
* Fixes a missing validation which results in undefined behavior in `SparseTensorDenseAdd` ([CVE-2022-29206](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29206))
* Fixes a missing validation which results in undefined behavior in `QuantizedConv2D` ([CVE-2022-29201](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29201))
* Fixes an integer overflow in `SpaceToBatchND` ([CVE-2022-29203](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29203))
* Fixes a segfault and OOB write due to incomplete validation in `EditDistance` ([CVE-2022-29208](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29208))
* Fixes a missing validation which causes denial of service via `Conv3DBackpropFilterV2` ([CVE-2022-29204](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29204))
* Fixes a denial of service in `tf.ragged.constant` due to lack of validation ([CVE-2022-29202](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29202))
* Fixes a segfault when `tf.histogram_fixed_width` is called with NaN values ([CVE-2022-29211](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29211))
* Fixes a core dump when loading TFLite models with quantization ([CVE-2022-29212](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29212))
* Fixes crashes stemming from incomplete validation in signal ops ([CVE-2022-29213](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29213))
* Fixes a type confusion leading to `CHECK`-failure based denial of service ([CVE-2022-29209](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29209))
* Updates `curl` to `7.83.1` to handle ([CVE-2022-22576](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-22576), ([CVE-2022-27774](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27774), ([CVE-2022-27775](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27775), ([CVE-2022-27776](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27776), ([CVE-2022-27778](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27778), ([CVE-2022-27779](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27779), ([CVE-2022-27780](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27780), ([CVE-2022-27781](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27781), ([CVE-2022-27782](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27782) and ([CVE-2022-30115](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-30115)
* Updates `zlib` to `1.2.12` after `1.2.11` was pulled due to [security issue](https://www.openwall.com/lists/oss-security/2022/03/28/1)

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1eb61d1f_20250114_183058.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Freleases%2Ftag%2Fv2.8.1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Freleases%2Ftag%2Fv2.8.1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow/tree/v2.8.1)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow/tree/v2.8.1)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

1. [Releases](/tensorflow/tensorflow/releases)
2. [v2.8.1](/tensorflow/tensorflow/releases/tag/v2.8.1)

# TensorFlow 2.8.1

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/tensorflow/tensorflow/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.8.1)

 Loading

[View all tags](/tensorflow/tensorflow/tags)

![@tensorflow-jenkins](https://avatars.githubusercontent.com/u/16359713?s=40&v=4)
[tensorflow-jenkins](/tensorflow-jenkins)
released this
16 May 17:44

·
[230 commits](/tensorflow/tensorflow/compare/v2.8.1...r2.8)
to r2.8
since this release

[v2.8.1](/tensorflow/tensorflow/tree/v2.8.1)

[`0516d4d`](/tensorflow/tensorflow/commit/0516d4d8bced506cae97dc3cb45dbd2fe4311f26)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

# Release 2.8.1

This releases introduces several vulnerability fixes:

* Fixes a code injection in `saved_model_cli` ([CVE-2022-29216](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29216))
* Fixes a missing validation which causes `TensorSummaryV2` to crash ([CVE-2022-29193](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29193))
* Fixes a missing validation which crashes `QuantizeAndDequantizeV4Grad` ([CVE-2022-29192](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29192))
* Fixes a missing validation which causes denial of service via `DeleteSessionTensor` ([CVE-2022-29194](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29194))
* Fixes a missing validation which causes denial of service via `GetSessionTensor` ([CVE-2022-29191](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29191))
* Fixes a missing validation which causes denial of service via `StagePeek` ([CVE-2022-29195](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29195))
* Fixes a missing validation which causes denial of service via `UnsortedSegmentJoin` ([CVE-2022-29197](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29197))
* Fixes a missing validation which causes denial of service via `LoadAndRemapMatrix` ([CVE-2022-29199](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29199))
* Fixes a missing validation which causes denial of service via `SparseTensorToCSRSparseMatrix` ([CVE-2022-29198](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29198))
* Fixes a missing validation which causes denial of service via `LSTMBlockCell` ([CVE-2022-29200](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29200))
* Fixes a missing validation which causes denial of service via `Conv3DBackpropFilterV2` ([CVE-2022-29196](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29196))
* Fixes a `CHECK` failure in depthwise ops via overflows ([CVE-2021-41197](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41197))
* Fixes issues arising from undefined behavior stemming from users supplying invalid resource handles ([CVE-2022-29207](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29207))
* Fixes a segfault due to missing support for quantized types ([CVE-2022-29205](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29205))
* Fixes a missing validation which results in undefined behavior in `SparseTensorDenseAdd` ([CVE-2022-29206](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29206))
* Fixes a missing validation which results in undefined behavior in `QuantizedConv2D` ([CVE-2022-29201](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29201))
* Fixes an integer overflow in `SpaceToBatchND` ([CVE-2022-29203](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29203))
* Fixes a segfault and OOB write due to incomplete validation in `EditDistance` ([CVE-2022-29208](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29208))
* Fixes a missing validation which causes denial of service via `Conv3DBackpropFilterV2` ([CVE-2022-29204](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29204))
* Fixes a denial of service in `tf.ragged.constant` due to lack of validation ([CVE-2022-29202](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29202))
* Fixes a segfault when `tf.histogram_fixed_width` is called with NaN values ([CVE-2022-29211](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29211))
* Fixes a core dump when loading TFLite models with quantization ([CVE-2022-29212](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29212))
* Fixes crashes stemming from incomplete validation in signal ops ([CVE-2022-29213](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29213))
* Fixes a type confusion leading to `CHECK`-failure based denial of service ([CVE-2022-29209](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29209))
* Fixes a heap buffer overflow due to incorrect hash function ([CVE-2022-29210](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29210))
* Updates `curl` to `7.83.1` to handle ([CVE-2022-22576](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-22576), ([CVE-2022-27774](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27774), ([CVE-2022-27775](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27775), ([CVE-2022-27776](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27776), ([CVE-2022-27778](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27778), ([CVE-2022-27779](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27779), ([CVE-2022-27780](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27780), ([CVE-2022-27781](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27781), ([CVE-2022-27782](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-27782) and ([CVE-2022-30115](https://cve.mitre.org/cgi-bin/cvename.cgi?name=VE-2022-30115)
* Updates `zlib` to `1.2.12` after `1.2.11` was pulled due to [security issue](https://www.openwall.com/lists/oss-security/2022/03/28/1)

 Assets
2

 Loading

 👍
3
 robinthibaut, sa-y-an, and rikenm1 reacted with thumbs up emoji
 ❤️
3
 sa-y-an, trydzynski-zen, and rikenm1 reacted with heart emoji

All reactions

* 👍
  3 reactions
* ❤️
  3 reactions

 4 people reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_10cac30b_20250114_183053.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fblob%2Ff3b9bf4c3c0597563b289c0512e98d4ce81f886e%2Ftensorflow%2Fpython%2Feager%2Fpywrap_tfe_src.cc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fblob%2Ff3b9bf4c3c0597563b289c0512e98d4ce81f886e%2Ftensorflow%2Fpython%2Feager%2Fpywrap_tfe_src.cc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Files

 f3b9bf4
## Breadcrumbs

1. [tensorflow](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e)
2. /[tensorflow](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow)
3. /[python](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python)
4. /[eager](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager)
/
# pywrap\_tfe\_src.cc

Copy path Blame  Blame
## Latest commit

## History

[History](/tensorflow/tensorflow/commits/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager/pywrap_tfe_src.cc)4205 lines (3789 loc) · 148 KB f3b9bf4
## Breadcrumbs

1. [tensorflow](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e)
2. /[tensorflow](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow)
3. /[python](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python)
4. /[eager](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager)
/
# pywrap\_tfe\_src.cc

Top
## File metadata and controls

* Code
* Blame

4205 lines (3789 loc) · 148 KB[Raw](https://github.com/tensorflow/tensorflow/raw/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager/pywrap_tfe_src.cc)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000/\* Copyright 2017 The TensorFlow Authors. All Rights Reserved.
Licensed under the Apache License, Version 2.0 (the "License");you may not use this file except in compliance with the License.You may obtain a copy of the License at
 http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an "AS IS" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.==============================================================================\*/
#include <atomic>#include <cstring>#include <unordered\_map>
#include "absl/debugging/leak\_check.h"#include "absl/strings/str\_cat.h"#include "absl/strings/str\_replace.h"#include "absl/types/variant.h"#include "tensorflow/c/c\_api.h"#include "tensorflow/c/c\_api\_internal.h"#include "tensorflow/c/eager/c\_api.h"#include "tensorflow/c/eager/c\_api\_internal.h"#include "tensorflow/c/eager/tape.h"#include "tensorflow/c/eager/tfe\_context\_internal.h"#include "tensorflow/c/eager/tfe\_op\_internal.h"#include "tensorflow/c/eager/tfe\_tensorhandle\_internal.h"#include "tensorflow/c/tf\_status.h"#include "tensorflow/core/framework/types.pb.h"#include "tensorflow/core/lib/core/errors.h"#include "tensorflow/core/lib/gtl/cleanup.h"#include "tensorflow/core/lib/gtl/compactptrset.h"#include "tensorflow/core/lib/gtl/flatmap.h"#include "tensorflow/core/lib/gtl/flatset.h"#include "tensorflow/core/lib/strings/strcat.h"#include "tensorflow/core/lib/strings/stringprintf.h"#include "tensorflow/core/platform/casts.h"#include "tensorflow/core/platform/errors.h"#include "tensorflow/core/platform/mutex.h"#include "tensorflow/core/platform/protobuf.h"#include "tensorflow/core/platform/status.h"#include "tensorflow/core/platform/statusor.h"#include "tensorflow/core/platform/types.h"#include "tensorflow/core/profiler/lib/traceme.h"#include "tensorflow/core/util/managed\_stack\_trace.h"#include "tensorflow/python/eager/pywrap\_gradient\_exclusions.h"#include "tensorflow/python/eager/pywrap\_tensor.h"#include "tensorflow/python/eager/pywrap\_tfe.h"#include "tensorflow/python/lib/core/py\_util.h"#include "tensorflow/python/lib/core/safe\_ptr.h"#include "tensorflow/python/util/stack\_trace.h"#include "tensorflow/python/util/util.h"
using tensorflow::Status;using tensorflow::string;using tensorflow::strings::Printf;
namespace {// NOTE: Items are retrieved from and returned to these unique\_ptrs, and they// act as arenas. This is important if the same thread requests 2 items without// releasing one.// The following sequence of events on the same thread will still succeed:// - GetOp <- Returns existing.// - GetOp <- Allocates and returns a new pointer.// - ReleaseOp <- Sets the item in the unique\_ptr.// - ReleaseOp <- Sets the item in the unique\_ptr, deleting the old one.// This occurs when a PyFunc kernel is run. This behavior makes it safe in that// case, as well as the case where python decides to reuse the underlying// C++ thread in 2 python threads case.struct OpDeleter { void operator()(TFE\_Op\* op) const { TFE\_DeleteOp(op); }};thread\_local std::unordered\_map<TFE\_Context\*, std::unique\_ptr<TFE\_Op, OpDeleter>> thread\_local\_eager\_operation\_map; // NOLINTthread\_local std::unique\_ptr<TF\_Status> thread\_local\_tf\_status = // NOLINT nullptr;
std::unique\_ptr<TFE\_Op, OpDeleter> ReleaseThreadLocalOp(TFE\_Context\* ctx) { auto it = thread\_local\_eager\_operation\_map.find(ctx); if (it == thread\_local\_eager\_operation\_map.end()) { return nullptr; } return std::move(it->second);}
TFE\_Op\* GetOp(TFE\_Context\* ctx, const char\* op\_or\_function\_name, const char\* raw\_device\_name, TF\_Status\* status) { auto op = ReleaseThreadLocalOp(ctx); if (!op) { op.reset(tensorflow::wrap(tensorflow::unwrap(ctx)->CreateOperation())); } status->status = tensorflow::unwrap(op.get())->Reset(op\_or\_function\_name, raw\_device\_name); if (!status->status.ok()) { op.reset(); } return op.release();}
void ReturnOp(TFE\_Context\* ctx, TFE\_Op\* op) { if (op) { tensorflow::unwrap(op)->Clear(); thread\_local\_eager\_operation\_map[ctx].reset(op); }}
TF\_Status\* ReleaseThreadLocalStatus() { if (thread\_local\_tf\_status == nullptr) { return nullptr; } return thread\_local\_tf\_status.release();}
struct InputInfo { InputInfo(int i, bool is\_list) : i(i), is\_list(is\_list) {}
 int i; bool is\_list = false;};
// Takes in output gradients, returns input gradients.typedef std::function<PyObject\*(PyObject\*, const std::vector<int64\_t>&)> PyBackwardFunction;
using AttrToInputsMap = tensorflow::gtl::FlatMap<string, tensorflow::gtl::InlinedVector<InputInfo, 4>>;
tensorflow::gtl::FlatMap<string, AttrToInputsMap\*>\* GetAllAttrToInputsMaps() { static auto\* all\_attr\_to\_input\_maps = new tensorflow::gtl::FlatMap<string, AttrToInputsMap\*>; return all\_attr\_to\_input\_maps;}
// This function doesn't use a lock, since we depend on the GIL directly.AttrToInputsMap\* GetAttrToInputsMapHoldingGIL(const tensorflow::OpDef& op\_def) {#if PY\_MAJOR\_VERSION >= 3 && PY\_MINOR\_VERSION >= 4 DCHECK(PyGILState\_Check()) << "This function needs to hold the GIL when called.";#endif auto\* all\_attr\_to\_input\_maps = GetAllAttrToInputsMaps(); auto\* output = tensorflow::gtl::FindPtrOrNull(\*all\_attr\_to\_input\_maps, op\_def.name()); if (output != nullptr) { return output; }
 std::unique\_ptr<AttrToInputsMap> m(new AttrToInputsMap);
 // Store a list of InputIndex -> List of corresponding inputs. for (int i = 0; i < op\_def.input\_arg\_size(); i++) { if (!op\_def.input\_arg(i).type\_attr().empty()) { auto it = m->find(op\_def.input\_arg(i).type\_attr()); if (it == m->end()) { it = m->insert({op\_def.input\_arg(i).type\_attr(), {}}).first; } it->second.emplace\_back(i, !op\_def.input\_arg(i).number\_attr().empty()); } }
 auto\* retval = m.get(); (\*all\_attr\_to\_input\_maps)[op\_def.name()] = m.release();
 return retval;}
// This function doesn't use a lock, since we depend on the GIL directly.tensorflow::gtl::FlatMap< string, tensorflow::gtl::FlatMap<string, tensorflow::DataType>\*>\*GetAllAttrToDefaultsMaps() { static auto\* all\_attr\_to\_defaults\_maps = new tensorflow::gtl::FlatMap< string, tensorflow::gtl::FlatMap<string, tensorflow::DataType>\*>; return all\_attr\_to\_defaults\_maps;}
tensorflow::gtl::FlatMap<string, tensorflow::DataType>\*GetAttrToDefaultsMapHoldingGIL(const tensorflow::OpDef& op\_def) {#if PY\_MAJOR\_VERSION >= 3 && PY\_MINOR\_VERSION >= 4 DCHECK(PyGILState\_Check()) << "This function needs to hold the GIL when called.";#endif auto\* all\_attr\_to\_defaults\_maps = GetAllAttrToDefaultsMaps(); auto\* output = tensorflow::gtl::FindPtrOrNull(\*all\_attr\_to\_defaults\_maps, op\_def.name()); if (output != nullptr) { return output; }
 auto\* new\_map = new tensorflow::gtl::FlatMap<string, tensorflow::DataType>;
 for (const auto& attr : op\_def.attr()) { if (attr.type() == "type" && attr.has\_default\_value()) { new\_map->insert({attr.name(), attr.default\_value().type()}); } }
 (\*all\_attr\_to\_defaults\_maps)[op\_def.name()] = new\_map;
 return new\_map;}
struct FastPathOpExecInfo { TFE\_Context\* ctx; const char\* device\_name;
 bool run\_callbacks; bool run\_post\_exec\_callbacks; bool run\_gradient\_callback;
 // The op name of the main op being executed. PyObject\* name; // The op type name of the main op being executed. PyObject\* op\_name; PyObject\* callbacks;
 // All the args passed into the FastPathOpExecInfo. PyObject\* args;
 // DTypes can come from another input that has the same attr. So build that // map. const AttrToInputsMap\* attr\_to\_inputs\_map; const tensorflow::gtl::FlatMap<string, tensorflow::DataType>\* default\_dtypes; tensorflow::gtl::FlatMap<string, tensorflow::DataType> cached\_dtypes;};
#define PARSE\_VALUE(fn\_name, type, check\_fn, parse\_fn) \ bool fn\_name(const string& key, PyObject\* py\_value, TF\_Status\* status, \ type\* value) { \ if (check\_fn(py\_value)) { \ \*value = static\_cast<type>(parse\_fn(py\_value)); \ return true; \ } else { \ TF\_SetStatus(status, TF\_INVALID\_ARGUMENT, \ tensorflow::strings::StrCat( \ "Expecting " #type " value for attr ", key, ", got ", \ py\_value->ob\_type->tp\_name) \ .c\_str()); \ return false; \ } \ }
#if PY\_MAJOR\_VERSION >= 3PARSE\_VALUE(ParseIntValue, int, PyLong\_Check, PyLong\_AsLong)PARSE\_VALUE(ParseInt64Value, int64\_t, PyLong\_Check, PyLong\_AsLongLong)#elsePARSE\_VALUE(ParseIntValue, int, PyInt\_Check, PyInt\_AsLong)#endifPARSE\_VALUE(ParseFloatValue, float, PyFloat\_Check, PyFloat\_AsDouble)#undef PARSE\_VALUE
#if PY\_MAJOR\_VERSION < 3bool ParseInt64Value(const string& key, PyObject\* py\_value, TF\_Status\* status, int64\_t\* value) { if (PyInt\_Check(py\_value)) { \*value = static\_cast<int64\_t>(PyInt\_AsLong(py\_value)); return true; } else if (PyLong\_Check(py\_value)) { \*value = static\_cast<int64\_t>(PyLong\_AsLong(py\_value)); return true; } TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting int or long value for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false;}#endif
Py\_ssize\_t TensorShapeNumDims(PyObject\* value) { const auto size = PySequence\_Size(value); if (size == -1) { // TensorShape.\_\_len\_\_ raises an error in the scenario where the shape is an // unknown, which needs to be cleared. // TODO(nareshmodi): ensure that this is actually a TensorShape. PyErr\_Clear(); } return size;}
bool IsInteger(PyObject\* py\_value) {#if PY\_MAJOR\_VERSION >= 3 return PyLong\_Check(py\_value);#else return PyInt\_Check(py\_value) || PyLong\_Check(py\_value);#endif}
// This function considers a Dimension.\_value of None to be valid, and sets the// value to be -1 in that case.bool ParseDimensionValue(const string& key, PyObject\* py\_value, TF\_Status\* status, int64\_t\* value) { if (IsInteger(py\_value)) { return ParseInt64Value(key, py\_value, status, value); }
 tensorflow::Safe\_PyObjectPtr dimension\_value( PyObject\_GetAttrString(py\_value, "\_value")); if (dimension\_value == nullptr) { PyErr\_Clear(); TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting a Dimension for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false; }
 if (dimension\_value.get() == Py\_None) { \*value = -1; return true; }
 return ParseInt64Value(key, dimension\_value.get(), status, value);}
bool ParseStringValue(const string& key, PyObject\* py\_value, TF\_Status\* status, tensorflow::StringPiece\* value) { if (PyBytes\_Check(py\_value)) { Py\_ssize\_t size = 0; char\* buf = nullptr; if (PyBytes\_AsStringAndSize(py\_value, &buf, &size) < 0) return false; \*value = tensorflow::StringPiece(buf, size); return true; }#if PY\_MAJOR\_VERSION >= 3 if (PyUnicode\_Check(py\_value)) { Py\_ssize\_t size = 0; const char\* buf = PyUnicode\_AsUTF8AndSize(py\_value, &size); if (buf == nullptr) return false; \*value = tensorflow::StringPiece(buf, size); return true; }#endif TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting a string value for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false;}
bool ParseBoolValue(const string& key, PyObject\* py\_value, TF\_Status\* status, unsigned char\* value) { if (PyBool\_Check(py\_value)) { \*value = PyObject\_IsTrue(py\_value); return true; } TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting bool value for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false;}
// The passed in py\_value is expected to be an object of the python type// dtypes.DType or an int.bool ParseTypeValue(const string& key, PyObject\* py\_value, TF\_Status\* status, int\* value) { if (IsInteger(py\_value)) { return ParseIntValue(key, py\_value, status, value); }
 tensorflow::Safe\_PyObjectPtr py\_type\_enum( PyObject\_GetAttrString(py\_value, "\_type\_enum")); if (py\_type\_enum == nullptr) { PyErr\_Clear(); TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting a DType.dtype for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false; }
 return ParseIntValue(key, py\_type\_enum.get(), status, value);}
bool SetOpAttrList(TFE\_Context\* ctx, TFE\_Op\* op, const char\* key, PyObject\* py\_list, TF\_AttrType type, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { if (!PySequence\_Check(py\_list)) { TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting sequence value for attr ", key, ", got ", py\_list->ob\_type->tp\_name) .c\_str()); return false; } const int num\_values = PySequence\_Size(py\_list); if (attr\_list\_sizes != nullptr) (\*attr\_list\_sizes)[key] = num\_values;
#define PARSE\_LIST(c\_type, parse\_fn) \ std::unique\_ptr<c\_type[]> values(new c\_type[num\_values]); \ for (int i = 0; i < num\_values; ++i) { \ tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); \ if (!parse\_fn(key, py\_value.get(), status, &values[i])) return false; \ }
 if (type == TF\_ATTR\_STRING) { std::unique\_ptr<const void\*[]> values(new const void\*[num\_values]); std::unique\_ptr<size\_t[]> lengths(new size\_t[num\_values]); for (int i = 0; i < num\_values; ++i) { tensorflow::StringPiece value; tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); if (!ParseStringValue(key, py\_value.get(), status, &value)) return false; values[i] = value.data(); lengths[i] = value.size(); } TFE\_OpSetAttrStringList(op, key, values.get(), lengths.get(), num\_values); } else if (type == TF\_ATTR\_INT) { PARSE\_LIST(int64\_t, ParseInt64Value); TFE\_OpSetAttrIntList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_FLOAT) { PARSE\_LIST(float, ParseFloatValue); TFE\_OpSetAttrFloatList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_BOOL) { PARSE\_LIST(unsigned char, ParseBoolValue); TFE\_OpSetAttrBoolList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_TYPE) { PARSE\_LIST(int, ParseTypeValue); TFE\_OpSetAttrTypeList(op, key, reinterpret\_cast<const TF\_DataType\*>(values.get()), num\_values); } else if (type == TF\_ATTR\_SHAPE) { // Make one pass through the input counting the total number of // dims across all the input lists. int total\_dims = 0; for (int i = 0; i < num\_values; ++i) { tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); if (py\_value.get() != Py\_None) { if (!PySequence\_Check(py\_value.get())) { TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat( "Expecting None or sequence value for element", i, " of attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false; } const auto size = TensorShapeNumDims(py\_value.get()); if (size >= 0) { total\_dims += size; } } } // Allocate a buffer that can fit all of the dims together. std::unique\_ptr<int64\_t[]> buffer(new int64\_t[total\_dims]); // Copy the input dims into the buffer and set dims to point to // the start of each list's dims. std::unique\_ptr<const int64\_t\*[]> dims(new const int64\_t\*[num\_values]); std::unique\_ptr<int[]> num\_dims(new int[num\_values]); int64\_t\* offset = buffer.get(); for (int i = 0; i < num\_values; ++i) { tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); if (py\_value.get() == Py\_None) { dims[i] = nullptr; num\_dims[i] = -1; } else { const auto size = TensorShapeNumDims(py\_value.get()); if (size == -1) { dims[i] = nullptr; num\_dims[i] = -1; continue; } dims[i] = offset; num\_dims[i] = size; for (int j = 0; j < size; ++j) { tensorflow::Safe\_PyObjectPtr inner\_py\_value( PySequence\_ITEM(py\_value.get(), j)); if (inner\_py\_value.get() == Py\_None) { \*offset = -1; } else if (!ParseDimensionValue(key, inner\_py\_value.get(), status, offset)) { return false; } ++offset; } } } TFE\_OpSetAttrShapeList(op, key, dims.get(), num\_dims.get(), num\_values, status); if (!status->status.ok()) return false; } else if (type == TF\_ATTR\_FUNC) { std::unique\_ptr<const TFE\_Op\*[]> funcs(new const TFE\_Op\*[num\_values]); for (int i = 0; i < num\_values; ++i) { tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); // Allow: // (1) String function name, OR // (2) A Python object with a .name attribute // (A crude test for being a // tensorflow.python.framework.function.\_DefinedFunction) // (which is what the various "defun" or "Defun" decorators do). // And in the future also allow an object that can encapsulate // the function name and its attribute values. tensorflow::StringPiece func\_name; if (!ParseStringValue(key, py\_value.get(), status, &func\_name)) { PyObject\* name\_attr = PyObject\_GetAttrString(py\_value.get(), "name"); if (name\_attr == nullptr || !ParseStringValue(key, name\_attr, status, &func\_name)) { TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat( "unable to set function value attribute from a ", py\_value.get()->ob\_type->tp\_name, " object. If you think this is an error, please file an " "issue at " "https://github.com/tensorflow/tensorflow/issues/new") .c\_str()); return false; } } funcs[i] = TFE\_NewOp(ctx, func\_name.data(), status); if (!status->status.ok()) return false; } TFE\_OpSetAttrFunctionList(op, key, funcs.get(), num\_values); if (!status->status.ok()) return false; } else { TF\_SetStatus(status, TF\_UNIMPLEMENTED, tensorflow::strings::StrCat("Attr ", key, " has unhandled list type ", type) .c\_str()); return false; }#undef PARSE\_LIST return true;}
TFE\_Op\* GetFunc(TFE\_Context\* ctx, const tensorflow::NameAttrList& func, TF\_Status\* status) { TFE\_Op\* func\_op = TFE\_NewOp(ctx, func.name().data(), status); for (const auto& attr : func.attr()) { if (!status->status.ok()) return nullptr; SetOpAttrValueScalar(ctx, func\_op, attr.second, attr.first.data(), status); if (!status->status.ok()) return nullptr; } return func\_op;}
void SetOpAttrListDefault( TFE\_Context\* ctx, TFE\_Op\* op, const tensorflow::OpDef::AttrDef& attr, const char\* key, TF\_AttrType type, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { if (type == TF\_ATTR\_STRING) { int num\_values = attr.default\_value().list().s\_size(); std::unique\_ptr<const void\*[]> values(new const void\*[num\_values]); std::unique\_ptr<size\_t[]> lengths(new size\_t[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { const string& v = attr.default\_value().list().s(i); values[i] = v.data(); lengths[i] = v.size(); } TFE\_OpSetAttrStringList(op, key, values.get(), lengths.get(), num\_values); } else if (type == TF\_ATTR\_INT) { int num\_values = attr.default\_value().list().i\_size(); std::unique\_ptr<int64\_t[]> values(new int64\_t[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { values[i] = attr.default\_value().list().i(i); } TFE\_OpSetAttrIntList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_FLOAT) { int num\_values = attr.default\_value().list().f\_size(); std::unique\_ptr<float[]> values(new float[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { values[i] = attr.default\_value().list().f(i); } TFE\_OpSetAttrFloatList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_BOOL) { int num\_values = attr.default\_value().list().b\_size(); std::unique\_ptr<unsigned char[]> values(new unsigned char[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { values[i] = attr.default\_value().list().b(i); } TFE\_OpSetAttrBoolList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_TYPE) { int num\_values = attr.default\_value().list().type\_size(); std::unique\_ptr<int[]> values(new int[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { values[i] = attr.default\_value().list().type(i); } TFE\_OpSetAttrTypeList(op, key, reinterpret\_cast<const TF\_DataType\*>(values.get()), attr.default\_value().list().type\_size()); } else if (type == TF\_ATTR\_SHAPE) { int num\_values = attr.default\_value().list().shape\_size(); (\*attr\_list\_sizes)[key] = num\_values; int total\_dims = 0; for (int i = 0; i < num\_values; ++i) { if (!attr.default\_value().list().shape(i).unknown\_rank()) { total\_dims += attr.default\_value().list().shape(i).dim\_size(); } } // Allocate a buffer that can fit all of the dims together. std::unique\_ptr<int64\_t[]> buffer(new int64\_t[total\_dims]); // Copy the input dims into the buffer and set dims to point to // the start of each list's dims. std::unique\_ptr<const int64\_t\*[]> dims(new const int64\_t\*[num\_values]); std::unique\_ptr<int[]> num\_dims(new int[num\_values]); int64\_t\* offset = buffer.get(); for (int i = 0; i < num\_values; ++i) { const auto& shape = attr.default\_value().list().shape(i); if (shape.unknown\_rank()) { dims[i] = nullptr; num\_dims[i] = -1; } else { for (int j = 0; j < shape.dim\_size(); j++) { \*offset = shape.dim(j).size(); ++offset; } } } TFE\_OpSetAttrShapeList(op, key, dims.get(), num\_dims.get(), num\_values, status); } else if (type == TF\_ATTR\_FUNC) { int num\_values = attr.default\_value().list().func\_size(); (\*attr\_list\_sizes)[key] = num\_values; std::unique\_ptr<const TFE\_Op\*[]> funcs(new const TFE\_Op\*[num\_values]); for (int i = 0; i < num\_values; i++) { funcs[i] = GetFunc(ctx, attr.default\_value().list().func(i), status); } TFE\_OpSetAttrFunctionList(op, key, funcs.get(), num\_values); } else { TF\_SetStatus(status, TF\_UNIMPLEMENTED, "Lists of tensors are not yet implemented for default valued " "attributes for an operation."); }}
bool SetOpAttrScalar(TFE\_Context\* ctx, TFE\_Op\* op, const char\* key, PyObject\* py\_value, TF\_AttrType type, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { if (type == TF\_ATTR\_STRING) { tensorflow::StringPiece value; if (!ParseStringValue(key, py\_value, status, &value)) return false; TFE\_OpSetAttrString(op, key, value.data(), value.size()); } else if (type == TF\_ATTR\_INT) { int64\_t value; if (!ParseInt64Value(key, py\_value, status, &value)) return false; TFE\_OpSetAttrInt(op, key, value); // attr\_list\_sizes is set for all int attributes (since at this point we are // not aware if that attribute might be used to calculate the size of an // output list or not). if (attr\_list\_sizes != nullptr) (\*attr\_list\_sizes)[key] = value; } else if (type == TF\_ATTR\_FLOAT) { float value; if (!ParseFloatValue(key, py\_value, status, &value)) return false; TFE\_OpSetAttrFloat(op, key, value); } else if (type == TF\_ATTR\_BOOL) { unsigned char value; if (!ParseBoolValue(key, py\_value, status, &value)) return false; TFE\_OpSetAttrBool(op, key, value); } else if (type == TF\_ATTR\_TYPE) { int value; if (!ParseTypeValue(key, py\_value, status, &value)) return false; TFE\_OpSetAttrType(op, key, static\_cast<TF\_DataType>(value)); } else if (type == TF\_ATTR\_SHAPE) { if (py\_value == Py\_None) { TFE\_OpSetAttrShape(op, key, nullptr, -1, status); } else { if (!PySequence\_Check(py\_value)) { TF\_SetStatus(status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat( "Expecting None or sequence value for attr", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false; } const auto num\_dims = TensorShapeNumDims(py\_value); if (num\_dims == -1) { TFE\_OpSetAttrShape(op, key, nullptr, -1, status); return true; } std::unique\_ptr<int64\_t[]> dims(new int64\_t[num\_dims]); for (int i = 0; i < num\_dims; ++i) { tensorflow::Safe\_PyObjectPtr inner\_py\_value( PySequence\_ITEM(py\_value, i)); if (inner\_py\_value.get() == Py\_None) { dims[i] = -1; } else if (!ParseDimensionValue(key, inner\_py\_value.get(), status, &dims[i])) { return false; } } TFE\_OpSetAttrShape(op, key, dims.get(), num\_dims, status); } if (!status->status.ok()) return false; } else if (type == TF\_ATTR\_FUNC) { // Allow: // (1) String function name, OR // (2) A Python object with a .name attribute // (A crude test for being a // tensorflow.python.framework.function.\_DefinedFunction) // (which is what the various "defun" or "Defun" decorators do). // And in the future also allow an object that can encapsulate // the function name and its attribute values. tensorflow::StringPiece func\_name; if (!ParseStringValue(key, py\_value, status, &func\_name)) { PyObject\* name\_attr = PyObject\_GetAttrString(py\_value, "name"); if (name\_attr == nullptr || !ParseStringValue(key, name\_attr, status, &func\_name)) { TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat( "unable to set function value attribute from a ", py\_value->ob\_type->tp\_name, " object. If you think this is an error, please file an issue " "at https://github.com/tensorflow/tensorflow/issues/new") .c\_str()); return false; } } TF\_SetStatus(status, TF\_OK, ""); TFE\_OpSetAttrFunctionName(op, key, func\_name.data(), func\_name.size()); } else { TF\_SetStatus( status, TF\_UNIMPLEMENTED, tensorflow::strings::StrCat("Attr ", key, " has unhandled type ", type) .c\_str()); return false; } return true;}
void SetOpAttrScalarDefault( TFE\_Context\* ctx, TFE\_Op\* op, const tensorflow::AttrValue& default\_value, const char\* attr\_name, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { SetOpAttrValueScalar(ctx, op, default\_value, attr\_name, status); if (default\_value.value\_case() == tensorflow::AttrValue::kI) { (\*attr\_list\_sizes)[attr\_name] = default\_value.i(); }}
// start\_index is the index at which the Tuple/List attrs will start getting// processed.void SetOpAttrs(TFE\_Context\* ctx, TFE\_Op\* op, PyObject\* attrs, int start\_index, TF\_Status\* out\_status) { if (attrs == Py\_None) return; Py\_ssize\_t len = PyTuple\_GET\_SIZE(attrs) - start\_index; if ((len & 1) != 0) { TF\_SetStatus(out\_status, TF\_INVALID\_ARGUMENT, "Expecting attrs tuple to have even length."); return; } // Parse attrs for (Py\_ssize\_t i = 0; i < len; i += 2) { PyObject\* py\_key = PyTuple\_GET\_ITEM(attrs, start\_index + i); PyObject\* py\_value = PyTuple\_GET\_ITEM(attrs, start\_index + i + 1);#if PY\_MAJOR\_VERSION >= 3 const char\* key = PyBytes\_Check(py\_key) ? PyBytes\_AsString(py\_key) : PyUnicode\_AsUTF8(py\_key);#else const char\* key = PyBytes\_AsString(py\_key);#endif unsigned char is\_list = 0; const TF\_AttrType type = TFE\_OpGetAttrType(op, key, &is\_list, out\_status); if (!out\_status->status.ok()) return; if (is\_list != 0) { if (!SetOpAttrList(ctx, op, key, py\_value, type, nullptr, out\_status)) return; } else { if (!SetOpAttrScalar(ctx, op, key, py\_value, type, nullptr, out\_status)) return; } }}
// This function will set the op attrs required. If an attr has the value of// None, then it will read the AttrDef to get the default value and set that// instead. Any failure in this function will simply fall back to the slow// path.void SetOpAttrWithDefaults( TFE\_Context\* ctx, TFE\_Op\* op, const tensorflow::OpDef::AttrDef& attr, const char\* attr\_name, PyObject\* attr\_value, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { unsigned char is\_list = 0; const TF\_AttrType type = TFE\_OpGetAttrType(op, attr\_name, &is\_list, status); if (!status->status.ok()) return; if (attr\_value == Py\_None) { if (is\_list != 0) { SetOpAttrListDefault(ctx, op, attr, attr\_name, type, attr\_list\_sizes, status); } else { SetOpAttrScalarDefault(ctx, op, attr.default\_value(), attr\_name, attr\_list\_sizes, status); } } else { if (is\_list != 0) { SetOpAttrList(ctx, op, attr\_name, attr\_value, type, attr\_list\_sizes, status); } else { SetOpAttrScalar(ctx, op, attr\_name, attr\_value, type, attr\_list\_sizes, status); } }}
PyObject\* GetPythonObjectFromInt(int num) {#if PY\_MAJOR\_VERSION >= 3 return PyLong\_FromLong(num);#else return PyInt\_FromLong(num);#endif}
// Python subclass of Exception that is created on not ok Status.tensorflow::mutex exception\_class\_mutex(tensorflow::LINKER\_INITIALIZED);PyObject\* exception\_class TF\_GUARDED\_BY(exception\_class\_mutex) = nullptr;
// Python subclass of Exception that is created to signal fallback.PyObject\* fallback\_exception\_class = nullptr;
// Python function that returns input gradients given output gradients.PyObject\* gradient\_function = nullptr;
// Python function that returns output gradients given input gradients.PyObject\* forward\_gradient\_function = nullptr;
static std::atomic<int64\_t> \_uid;
// This struct is responsible for marking thread\_local storage as destroyed.// Access to the `alive` field in already-destroyed ThreadLocalDestructionMarker// is safe because it's a trivial type, so long as nobody creates a new// thread\_local in the space where now-destroyed marker used to be.// Hopefully creating new thread\_locals while destructing a thread is rare.struct ThreadLocalDestructionMarker { ~ThreadLocalDestructionMarker() { alive = false; } bool alive = true;};
} // namespace
TF\_Status\* GetStatus() { TF\_Status\* maybe\_status = ReleaseThreadLocalStatus(); if (maybe\_status) { TF\_SetStatus(maybe\_status, TF\_OK, ""); return maybe\_status; } else { return TF\_NewStatus(); }}
void ReturnStatus(TF\_Status\* status) { TF\_SetStatus(status, TF\_OK, ""); thread\_local\_tf\_status.reset(status);}
void TFE\_Py\_Execute(TFE\_Context\* ctx, const char\* device\_name, const char\* op\_name, TFE\_InputTensorHandles\* inputs, PyObject\* attrs, TFE\_OutputTensorHandles\* outputs, TF\_Status\* out\_status) { TFE\_Py\_ExecuteCancelable(ctx, device\_name, op\_name, inputs, attrs, /\*cancellation\_manager=\*/nullptr, outputs, out\_status);}
void TFE\_Py\_ExecuteCancelable(TFE\_Context\* ctx, const char\* device\_name, const char\* op\_name, TFE\_InputTensorHandles\* inputs, PyObject\* attrs, TFE\_CancellationManager\* cancellation\_manager, TFE\_OutputTensorHandles\* outputs, TF\_Status\* out\_status) { tensorflow::profiler::TraceMe activity( "TFE\_Py\_ExecuteCancelable", tensorflow::profiler::TraceMeLevel::kInfo);
 TFE\_Op\* op = GetOp(ctx, op\_name, device\_name, out\_status);
 auto cleaner = tensorflow::gtl::MakeCleanup([ctx, op] { ReturnOp(ctx, op); }); if (!out\_status->status.ok()) return;
 tensorflow::unwrap(op)->SetStackTrace(tensorflow::GetStackTrace( tensorflow::StackTrace::kStackTraceInitialSize));
 for (int i = 0; i < inputs->size() && out\_status->status.ok(); ++i) { TFE\_OpAddInput(op, inputs->at(i), out\_status); } if (cancellation\_manager && out\_status->status.ok()) { TFE\_OpSetCancellationManager(op, cancellation\_manager, out\_status); } if (out\_status->status.ok()) { SetOpAttrs(ctx, op, attrs, 0, out\_status); } Py\_BEGIN\_ALLOW\_THREADS;
 int num\_outputs = outputs->size();
 if (out\_status->status.ok()) { TFE\_Execute(op, outputs->data(), &num\_outputs, out\_status); }
 if (out\_status->status.ok()) { outputs->resize(num\_outputs); } else { TF\_SetStatus(out\_status, TF\_GetCode(out\_status), tensorflow::strings::StrCat(TF\_Message(out\_status), " [Op:", op\_name, "]") .c\_str()); }
 Py\_END\_ALLOW\_THREADS;}
PyObject\* TFE\_Py\_RegisterExceptionClass(PyObject\* e) { tensorflow::mutex\_lock l(exception\_class\_mutex); if (exception\_class != nullptr) { Py\_DECREF(exception\_class); } if (PyObject\_IsSubclass(e, PyExc\_Exception) <= 0) { exception\_class = nullptr; PyErr\_SetString(PyExc\_TypeError, "TFE\_Py\_RegisterExceptionClass: " "Registered class should be subclass of Exception."); return nullptr; }
 Py\_INCREF(e); exception\_class = e; Py\_RETURN\_NONE;}
PyObject\* TFE\_Py\_RegisterFallbackExceptionClass(PyObject\* e) { if (fallback\_exception\_class != nullptr) { Py\_DECREF(fallback\_exception\_class); } if (PyObject\_IsSubclass(e, PyExc\_Exception) <= 0) { fallback\_exception\_class = nullptr; PyErr\_SetString(PyExc\_TypeError, "TFE\_Py\_RegisterFallbackExceptionClass: " "Registered class should be subclass of Exception."); return nullptr; } else { Py\_INCREF(e); fallback\_exception\_class = e; Py\_RETURN\_NONE; }}
PyObject\* TFE\_Py\_RegisterGradientFunction(PyObject\* e) { if (gradient\_function != nullptr) { Py\_DECREF(gradient\_function); } if (!PyCallable\_Check(e)) { gradient\_function = nullptr; PyErr\_SetString(PyExc\_TypeError, "TFE\_Py\_RegisterGradientFunction: " "Registered object should be function."); return nullptr; } else { Py\_INCREF(e); gradient\_function = e; Py\_RETURN\_NONE; }}
PyObject\* TFE\_Py\_RegisterJVPFunction(PyObject\* e) { if (forward\_gradient\_function != nullptr) { Py\_DECREF(forward\_gradient\_function); } if (!PyCallable\_Check(e)) { forward\_gradient\_function = nullptr; PyErr\_SetString(PyExc\_TypeError, "TFE\_Py\_RegisterJVPFunction: " "Registered object should be function."); return nullptr; } else { Py\_INCREF(e); forward\_gradient\_function = e; Py\_RETURN\_NONE; }}
void RaiseFallbackException(const char\* message) { if (fallback\_exception\_class != nullptr) { PyErr\_SetString(fallback\_exception\_class, message); return; }
 PyErr\_SetString( PyExc\_RuntimeError, tensorflow::strings::StrCat( "Fallback exception type not set, attempting to fallback due to ", message) .data());}[View remainder of file in raw view](https://github.com/tensorflow/tensorflow/raw/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager/pywrap_tfe_src.cc)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7e684a9f_20250114_183049.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fblob%2Ff3b9bf4c3c0597563b289c0512e98d4ce81f886e%2Ftensorflow%2Fpython%2Feager%2Fpywrap_tfe_src.cc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fblob%2Ff3b9bf4c3c0597563b289c0512e98d4ce81f886e%2Ftensorflow%2Fpython%2Feager%2Fpywrap_tfe_src.cc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Files

 f3b9bf4
## Breadcrumbs

1. [tensorflow](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e)
2. /[tensorflow](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow)
3. /[python](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python)
4. /[eager](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager)
/
# pywrap\_tfe\_src.cc

Copy path Blame  Blame
## Latest commit

## History

[History](/tensorflow/tensorflow/commits/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager/pywrap_tfe_src.cc)4205 lines (3789 loc) · 148 KB f3b9bf4
## Breadcrumbs

1. [tensorflow](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e)
2. /[tensorflow](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow)
3. /[python](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python)
4. /[eager](/tensorflow/tensorflow/tree/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager)
/
# pywrap\_tfe\_src.cc

Top
## File metadata and controls

* Code
* Blame

4205 lines (3789 loc) · 148 KB[Raw](https://github.com/tensorflow/tensorflow/raw/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager/pywrap_tfe_src.cc)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000/\* Copyright 2017 The TensorFlow Authors. All Rights Reserved.
Licensed under the Apache License, Version 2.0 (the "License");you may not use this file except in compliance with the License.You may obtain a copy of the License at
 http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an "AS IS" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.==============================================================================\*/
#include <atomic>#include <cstring>#include <unordered\_map>
#include "absl/debugging/leak\_check.h"#include "absl/strings/str\_cat.h"#include "absl/strings/str\_replace.h"#include "absl/types/variant.h"#include "tensorflow/c/c\_api.h"#include "tensorflow/c/c\_api\_internal.h"#include "tensorflow/c/eager/c\_api.h"#include "tensorflow/c/eager/c\_api\_internal.h"#include "tensorflow/c/eager/tape.h"#include "tensorflow/c/eager/tfe\_context\_internal.h"#include "tensorflow/c/eager/tfe\_op\_internal.h"#include "tensorflow/c/eager/tfe\_tensorhandle\_internal.h"#include "tensorflow/c/tf\_status.h"#include "tensorflow/core/framework/types.pb.h"#include "tensorflow/core/lib/core/errors.h"#include "tensorflow/core/lib/gtl/cleanup.h"#include "tensorflow/core/lib/gtl/compactptrset.h"#include "tensorflow/core/lib/gtl/flatmap.h"#include "tensorflow/core/lib/gtl/flatset.h"#include "tensorflow/core/lib/strings/strcat.h"#include "tensorflow/core/lib/strings/stringprintf.h"#include "tensorflow/core/platform/casts.h"#include "tensorflow/core/platform/errors.h"#include "tensorflow/core/platform/mutex.h"#include "tensorflow/core/platform/protobuf.h"#include "tensorflow/core/platform/status.h"#include "tensorflow/core/platform/statusor.h"#include "tensorflow/core/platform/types.h"#include "tensorflow/core/profiler/lib/traceme.h"#include "tensorflow/core/util/managed\_stack\_trace.h"#include "tensorflow/python/eager/pywrap\_gradient\_exclusions.h"#include "tensorflow/python/eager/pywrap\_tensor.h"#include "tensorflow/python/eager/pywrap\_tfe.h"#include "tensorflow/python/lib/core/py\_util.h"#include "tensorflow/python/lib/core/safe\_ptr.h"#include "tensorflow/python/util/stack\_trace.h"#include "tensorflow/python/util/util.h"
using tensorflow::Status;using tensorflow::string;using tensorflow::strings::Printf;
namespace {// NOTE: Items are retrieved from and returned to these unique\_ptrs, and they// act as arenas. This is important if the same thread requests 2 items without// releasing one.// The following sequence of events on the same thread will still succeed:// - GetOp <- Returns existing.// - GetOp <- Allocates and returns a new pointer.// - ReleaseOp <- Sets the item in the unique\_ptr.// - ReleaseOp <- Sets the item in the unique\_ptr, deleting the old one.// This occurs when a PyFunc kernel is run. This behavior makes it safe in that// case, as well as the case where python decides to reuse the underlying// C++ thread in 2 python threads case.struct OpDeleter { void operator()(TFE\_Op\* op) const { TFE\_DeleteOp(op); }};thread\_local std::unordered\_map<TFE\_Context\*, std::unique\_ptr<TFE\_Op, OpDeleter>> thread\_local\_eager\_operation\_map; // NOLINTthread\_local std::unique\_ptr<TF\_Status> thread\_local\_tf\_status = // NOLINT nullptr;
std::unique\_ptr<TFE\_Op, OpDeleter> ReleaseThreadLocalOp(TFE\_Context\* ctx) { auto it = thread\_local\_eager\_operation\_map.find(ctx); if (it == thread\_local\_eager\_operation\_map.end()) { return nullptr; } return std::move(it->second);}
TFE\_Op\* GetOp(TFE\_Context\* ctx, const char\* op\_or\_function\_name, const char\* raw\_device\_name, TF\_Status\* status) { auto op = ReleaseThreadLocalOp(ctx); if (!op) { op.reset(tensorflow::wrap(tensorflow::unwrap(ctx)->CreateOperation())); } status->status = tensorflow::unwrap(op.get())->Reset(op\_or\_function\_name, raw\_device\_name); if (!status->status.ok()) { op.reset(); } return op.release();}
void ReturnOp(TFE\_Context\* ctx, TFE\_Op\* op) { if (op) { tensorflow::unwrap(op)->Clear(); thread\_local\_eager\_operation\_map[ctx].reset(op); }}
TF\_Status\* ReleaseThreadLocalStatus() { if (thread\_local\_tf\_status == nullptr) { return nullptr; } return thread\_local\_tf\_status.release();}
struct InputInfo { InputInfo(int i, bool is\_list) : i(i), is\_list(is\_list) {}
 int i; bool is\_list = false;};
// Takes in output gradients, returns input gradients.typedef std::function<PyObject\*(PyObject\*, const std::vector<int64\_t>&)> PyBackwardFunction;
using AttrToInputsMap = tensorflow::gtl::FlatMap<string, tensorflow::gtl::InlinedVector<InputInfo, 4>>;
tensorflow::gtl::FlatMap<string, AttrToInputsMap\*>\* GetAllAttrToInputsMaps() { static auto\* all\_attr\_to\_input\_maps = new tensorflow::gtl::FlatMap<string, AttrToInputsMap\*>; return all\_attr\_to\_input\_maps;}
// This function doesn't use a lock, since we depend on the GIL directly.AttrToInputsMap\* GetAttrToInputsMapHoldingGIL(const tensorflow::OpDef& op\_def) {#if PY\_MAJOR\_VERSION >= 3 && PY\_MINOR\_VERSION >= 4 DCHECK(PyGILState\_Check()) << "This function needs to hold the GIL when called.";#endif auto\* all\_attr\_to\_input\_maps = GetAllAttrToInputsMaps(); auto\* output = tensorflow::gtl::FindPtrOrNull(\*all\_attr\_to\_input\_maps, op\_def.name()); if (output != nullptr) { return output; }
 std::unique\_ptr<AttrToInputsMap> m(new AttrToInputsMap);
 // Store a list of InputIndex -> List of corresponding inputs. for (int i = 0; i < op\_def.input\_arg\_size(); i++) { if (!op\_def.input\_arg(i).type\_attr().empty()) { auto it = m->find(op\_def.input\_arg(i).type\_attr()); if (it == m->end()) { it = m->insert({op\_def.input\_arg(i).type\_attr(), {}}).first; } it->second.emplace\_back(i, !op\_def.input\_arg(i).number\_attr().empty()); } }
 auto\* retval = m.get(); (\*all\_attr\_to\_input\_maps)[op\_def.name()] = m.release();
 return retval;}
// This function doesn't use a lock, since we depend on the GIL directly.tensorflow::gtl::FlatMap< string, tensorflow::gtl::FlatMap<string, tensorflow::DataType>\*>\*GetAllAttrToDefaultsMaps() { static auto\* all\_attr\_to\_defaults\_maps = new tensorflow::gtl::FlatMap< string, tensorflow::gtl::FlatMap<string, tensorflow::DataType>\*>; return all\_attr\_to\_defaults\_maps;}
tensorflow::gtl::FlatMap<string, tensorflow::DataType>\*GetAttrToDefaultsMapHoldingGIL(const tensorflow::OpDef& op\_def) {#if PY\_MAJOR\_VERSION >= 3 && PY\_MINOR\_VERSION >= 4 DCHECK(PyGILState\_Check()) << "This function needs to hold the GIL when called.";#endif auto\* all\_attr\_to\_defaults\_maps = GetAllAttrToDefaultsMaps(); auto\* output = tensorflow::gtl::FindPtrOrNull(\*all\_attr\_to\_defaults\_maps, op\_def.name()); if (output != nullptr) { return output; }
 auto\* new\_map = new tensorflow::gtl::FlatMap<string, tensorflow::DataType>;
 for (const auto& attr : op\_def.attr()) { if (attr.type() == "type" && attr.has\_default\_value()) { new\_map->insert({attr.name(), attr.default\_value().type()}); } }
 (\*all\_attr\_to\_defaults\_maps)[op\_def.name()] = new\_map;
 return new\_map;}
struct FastPathOpExecInfo { TFE\_Context\* ctx; const char\* device\_name;
 bool run\_callbacks; bool run\_post\_exec\_callbacks; bool run\_gradient\_callback;
 // The op name of the main op being executed. PyObject\* name; // The op type name of the main op being executed. PyObject\* op\_name; PyObject\* callbacks;
 // All the args passed into the FastPathOpExecInfo. PyObject\* args;
 // DTypes can come from another input that has the same attr. So build that // map. const AttrToInputsMap\* attr\_to\_inputs\_map; const tensorflow::gtl::FlatMap<string, tensorflow::DataType>\* default\_dtypes; tensorflow::gtl::FlatMap<string, tensorflow::DataType> cached\_dtypes;};
#define PARSE\_VALUE(fn\_name, type, check\_fn, parse\_fn) \ bool fn\_name(const string& key, PyObject\* py\_value, TF\_Status\* status, \ type\* value) { \ if (check\_fn(py\_value)) { \ \*value = static\_cast<type>(parse\_fn(py\_value)); \ return true; \ } else { \ TF\_SetStatus(status, TF\_INVALID\_ARGUMENT, \ tensorflow::strings::StrCat( \ "Expecting " #type " value for attr ", key, ", got ", \ py\_value->ob\_type->tp\_name) \ .c\_str()); \ return false; \ } \ }
#if PY\_MAJOR\_VERSION >= 3PARSE\_VALUE(ParseIntValue, int, PyLong\_Check, PyLong\_AsLong)PARSE\_VALUE(ParseInt64Value, int64\_t, PyLong\_Check, PyLong\_AsLongLong)#elsePARSE\_VALUE(ParseIntValue, int, PyInt\_Check, PyInt\_AsLong)#endifPARSE\_VALUE(ParseFloatValue, float, PyFloat\_Check, PyFloat\_AsDouble)#undef PARSE\_VALUE
#if PY\_MAJOR\_VERSION < 3bool ParseInt64Value(const string& key, PyObject\* py\_value, TF\_Status\* status, int64\_t\* value) { if (PyInt\_Check(py\_value)) { \*value = static\_cast<int64\_t>(PyInt\_AsLong(py\_value)); return true; } else if (PyLong\_Check(py\_value)) { \*value = static\_cast<int64\_t>(PyLong\_AsLong(py\_value)); return true; } TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting int or long value for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false;}#endif
Py\_ssize\_t TensorShapeNumDims(PyObject\* value) { const auto size = PySequence\_Size(value); if (size == -1) { // TensorShape.\_\_len\_\_ raises an error in the scenario where the shape is an // unknown, which needs to be cleared. // TODO(nareshmodi): ensure that this is actually a TensorShape. PyErr\_Clear(); } return size;}
bool IsInteger(PyObject\* py\_value) {#if PY\_MAJOR\_VERSION >= 3 return PyLong\_Check(py\_value);#else return PyInt\_Check(py\_value) || PyLong\_Check(py\_value);#endif}
// This function considers a Dimension.\_value of None to be valid, and sets the// value to be -1 in that case.bool ParseDimensionValue(const string& key, PyObject\* py\_value, TF\_Status\* status, int64\_t\* value) { if (IsInteger(py\_value)) { return ParseInt64Value(key, py\_value, status, value); }
 tensorflow::Safe\_PyObjectPtr dimension\_value( PyObject\_GetAttrString(py\_value, "\_value")); if (dimension\_value == nullptr) { PyErr\_Clear(); TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting a Dimension for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false; }
 if (dimension\_value.get() == Py\_None) { \*value = -1; return true; }
 return ParseInt64Value(key, dimension\_value.get(), status, value);}
bool ParseStringValue(const string& key, PyObject\* py\_value, TF\_Status\* status, tensorflow::StringPiece\* value) { if (PyBytes\_Check(py\_value)) { Py\_ssize\_t size = 0; char\* buf = nullptr; if (PyBytes\_AsStringAndSize(py\_value, &buf, &size) < 0) return false; \*value = tensorflow::StringPiece(buf, size); return true; }#if PY\_MAJOR\_VERSION >= 3 if (PyUnicode\_Check(py\_value)) { Py\_ssize\_t size = 0; const char\* buf = PyUnicode\_AsUTF8AndSize(py\_value, &size); if (buf == nullptr) return false; \*value = tensorflow::StringPiece(buf, size); return true; }#endif TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting a string value for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false;}
bool ParseBoolValue(const string& key, PyObject\* py\_value, TF\_Status\* status, unsigned char\* value) { if (PyBool\_Check(py\_value)) { \*value = PyObject\_IsTrue(py\_value); return true; } TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting bool value for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false;}
// The passed in py\_value is expected to be an object of the python type// dtypes.DType or an int.bool ParseTypeValue(const string& key, PyObject\* py\_value, TF\_Status\* status, int\* value) { if (IsInteger(py\_value)) { return ParseIntValue(key, py\_value, status, value); }
 tensorflow::Safe\_PyObjectPtr py\_type\_enum( PyObject\_GetAttrString(py\_value, "\_type\_enum")); if (py\_type\_enum == nullptr) { PyErr\_Clear(); TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting a DType.dtype for attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false; }
 return ParseIntValue(key, py\_type\_enum.get(), status, value);}
bool SetOpAttrList(TFE\_Context\* ctx, TFE\_Op\* op, const char\* key, PyObject\* py\_list, TF\_AttrType type, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { if (!PySequence\_Check(py\_list)) { TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat("Expecting sequence value for attr ", key, ", got ", py\_list->ob\_type->tp\_name) .c\_str()); return false; } const int num\_values = PySequence\_Size(py\_list); if (attr\_list\_sizes != nullptr) (\*attr\_list\_sizes)[key] = num\_values;
#define PARSE\_LIST(c\_type, parse\_fn) \ std::unique\_ptr<c\_type[]> values(new c\_type[num\_values]); \ for (int i = 0; i < num\_values; ++i) { \ tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); \ if (!parse\_fn(key, py\_value.get(), status, &values[i])) return false; \ }
 if (type == TF\_ATTR\_STRING) { std::unique\_ptr<const void\*[]> values(new const void\*[num\_values]); std::unique\_ptr<size\_t[]> lengths(new size\_t[num\_values]); for (int i = 0; i < num\_values; ++i) { tensorflow::StringPiece value; tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); if (!ParseStringValue(key, py\_value.get(), status, &value)) return false; values[i] = value.data(); lengths[i] = value.size(); } TFE\_OpSetAttrStringList(op, key, values.get(), lengths.get(), num\_values); } else if (type == TF\_ATTR\_INT) { PARSE\_LIST(int64\_t, ParseInt64Value); TFE\_OpSetAttrIntList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_FLOAT) { PARSE\_LIST(float, ParseFloatValue); TFE\_OpSetAttrFloatList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_BOOL) { PARSE\_LIST(unsigned char, ParseBoolValue); TFE\_OpSetAttrBoolList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_TYPE) { PARSE\_LIST(int, ParseTypeValue); TFE\_OpSetAttrTypeList(op, key, reinterpret\_cast<const TF\_DataType\*>(values.get()), num\_values); } else if (type == TF\_ATTR\_SHAPE) { // Make one pass through the input counting the total number of // dims across all the input lists. int total\_dims = 0; for (int i = 0; i < num\_values; ++i) { tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); if (py\_value.get() != Py\_None) { if (!PySequence\_Check(py\_value.get())) { TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat( "Expecting None or sequence value for element", i, " of attr ", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false; } const auto size = TensorShapeNumDims(py\_value.get()); if (size >= 0) { total\_dims += size; } } } // Allocate a buffer that can fit all of the dims together. std::unique\_ptr<int64\_t[]> buffer(new int64\_t[total\_dims]); // Copy the input dims into the buffer and set dims to point to // the start of each list's dims. std::unique\_ptr<const int64\_t\*[]> dims(new const int64\_t\*[num\_values]); std::unique\_ptr<int[]> num\_dims(new int[num\_values]); int64\_t\* offset = buffer.get(); for (int i = 0; i < num\_values; ++i) { tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); if (py\_value.get() == Py\_None) { dims[i] = nullptr; num\_dims[i] = -1; } else { const auto size = TensorShapeNumDims(py\_value.get()); if (size == -1) { dims[i] = nullptr; num\_dims[i] = -1; continue; } dims[i] = offset; num\_dims[i] = size; for (int j = 0; j < size; ++j) { tensorflow::Safe\_PyObjectPtr inner\_py\_value( PySequence\_ITEM(py\_value.get(), j)); if (inner\_py\_value.get() == Py\_None) { \*offset = -1; } else if (!ParseDimensionValue(key, inner\_py\_value.get(), status, offset)) { return false; } ++offset; } } } TFE\_OpSetAttrShapeList(op, key, dims.get(), num\_dims.get(), num\_values, status); if (!status->status.ok()) return false; } else if (type == TF\_ATTR\_FUNC) { std::unique\_ptr<const TFE\_Op\*[]> funcs(new const TFE\_Op\*[num\_values]); for (int i = 0; i < num\_values; ++i) { tensorflow::Safe\_PyObjectPtr py\_value(PySequence\_ITEM(py\_list, i)); // Allow: // (1) String function name, OR // (2) A Python object with a .name attribute // (A crude test for being a // tensorflow.python.framework.function.\_DefinedFunction) // (which is what the various "defun" or "Defun" decorators do). // And in the future also allow an object that can encapsulate // the function name and its attribute values. tensorflow::StringPiece func\_name; if (!ParseStringValue(key, py\_value.get(), status, &func\_name)) { PyObject\* name\_attr = PyObject\_GetAttrString(py\_value.get(), "name"); if (name\_attr == nullptr || !ParseStringValue(key, name\_attr, status, &func\_name)) { TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat( "unable to set function value attribute from a ", py\_value.get()->ob\_type->tp\_name, " object. If you think this is an error, please file an " "issue at " "https://github.com/tensorflow/tensorflow/issues/new") .c\_str()); return false; } } funcs[i] = TFE\_NewOp(ctx, func\_name.data(), status); if (!status->status.ok()) return false; } TFE\_OpSetAttrFunctionList(op, key, funcs.get(), num\_values); if (!status->status.ok()) return false; } else { TF\_SetStatus(status, TF\_UNIMPLEMENTED, tensorflow::strings::StrCat("Attr ", key, " has unhandled list type ", type) .c\_str()); return false; }#undef PARSE\_LIST return true;}
TFE\_Op\* GetFunc(TFE\_Context\* ctx, const tensorflow::NameAttrList& func, TF\_Status\* status) { TFE\_Op\* func\_op = TFE\_NewOp(ctx, func.name().data(), status); for (const auto& attr : func.attr()) { if (!status->status.ok()) return nullptr; SetOpAttrValueScalar(ctx, func\_op, attr.second, attr.first.data(), status); if (!status->status.ok()) return nullptr; } return func\_op;}
void SetOpAttrListDefault( TFE\_Context\* ctx, TFE\_Op\* op, const tensorflow::OpDef::AttrDef& attr, const char\* key, TF\_AttrType type, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { if (type == TF\_ATTR\_STRING) { int num\_values = attr.default\_value().list().s\_size(); std::unique\_ptr<const void\*[]> values(new const void\*[num\_values]); std::unique\_ptr<size\_t[]> lengths(new size\_t[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { const string& v = attr.default\_value().list().s(i); values[i] = v.data(); lengths[i] = v.size(); } TFE\_OpSetAttrStringList(op, key, values.get(), lengths.get(), num\_values); } else if (type == TF\_ATTR\_INT) { int num\_values = attr.default\_value().list().i\_size(); std::unique\_ptr<int64\_t[]> values(new int64\_t[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { values[i] = attr.default\_value().list().i(i); } TFE\_OpSetAttrIntList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_FLOAT) { int num\_values = attr.default\_value().list().f\_size(); std::unique\_ptr<float[]> values(new float[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { values[i] = attr.default\_value().list().f(i); } TFE\_OpSetAttrFloatList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_BOOL) { int num\_values = attr.default\_value().list().b\_size(); std::unique\_ptr<unsigned char[]> values(new unsigned char[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { values[i] = attr.default\_value().list().b(i); } TFE\_OpSetAttrBoolList(op, key, values.get(), num\_values); } else if (type == TF\_ATTR\_TYPE) { int num\_values = attr.default\_value().list().type\_size(); std::unique\_ptr<int[]> values(new int[num\_values]); (\*attr\_list\_sizes)[key] = num\_values; for (int i = 0; i < num\_values; i++) { values[i] = attr.default\_value().list().type(i); } TFE\_OpSetAttrTypeList(op, key, reinterpret\_cast<const TF\_DataType\*>(values.get()), attr.default\_value().list().type\_size()); } else if (type == TF\_ATTR\_SHAPE) { int num\_values = attr.default\_value().list().shape\_size(); (\*attr\_list\_sizes)[key] = num\_values; int total\_dims = 0; for (int i = 0; i < num\_values; ++i) { if (!attr.default\_value().list().shape(i).unknown\_rank()) { total\_dims += attr.default\_value().list().shape(i).dim\_size(); } } // Allocate a buffer that can fit all of the dims together. std::unique\_ptr<int64\_t[]> buffer(new int64\_t[total\_dims]); // Copy the input dims into the buffer and set dims to point to // the start of each list's dims. std::unique\_ptr<const int64\_t\*[]> dims(new const int64\_t\*[num\_values]); std::unique\_ptr<int[]> num\_dims(new int[num\_values]); int64\_t\* offset = buffer.get(); for (int i = 0; i < num\_values; ++i) { const auto& shape = attr.default\_value().list().shape(i); if (shape.unknown\_rank()) { dims[i] = nullptr; num\_dims[i] = -1; } else { for (int j = 0; j < shape.dim\_size(); j++) { \*offset = shape.dim(j).size(); ++offset; } } } TFE\_OpSetAttrShapeList(op, key, dims.get(), num\_dims.get(), num\_values, status); } else if (type == TF\_ATTR\_FUNC) { int num\_values = attr.default\_value().list().func\_size(); (\*attr\_list\_sizes)[key] = num\_values; std::unique\_ptr<const TFE\_Op\*[]> funcs(new const TFE\_Op\*[num\_values]); for (int i = 0; i < num\_values; i++) { funcs[i] = GetFunc(ctx, attr.default\_value().list().func(i), status); } TFE\_OpSetAttrFunctionList(op, key, funcs.get(), num\_values); } else { TF\_SetStatus(status, TF\_UNIMPLEMENTED, "Lists of tensors are not yet implemented for default valued " "attributes for an operation."); }}
bool SetOpAttrScalar(TFE\_Context\* ctx, TFE\_Op\* op, const char\* key, PyObject\* py\_value, TF\_AttrType type, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { if (type == TF\_ATTR\_STRING) { tensorflow::StringPiece value; if (!ParseStringValue(key, py\_value, status, &value)) return false; TFE\_OpSetAttrString(op, key, value.data(), value.size()); } else if (type == TF\_ATTR\_INT) { int64\_t value; if (!ParseInt64Value(key, py\_value, status, &value)) return false; TFE\_OpSetAttrInt(op, key, value); // attr\_list\_sizes is set for all int attributes (since at this point we are // not aware if that attribute might be used to calculate the size of an // output list or not). if (attr\_list\_sizes != nullptr) (\*attr\_list\_sizes)[key] = value; } else if (type == TF\_ATTR\_FLOAT) { float value; if (!ParseFloatValue(key, py\_value, status, &value)) return false; TFE\_OpSetAttrFloat(op, key, value); } else if (type == TF\_ATTR\_BOOL) { unsigned char value; if (!ParseBoolValue(key, py\_value, status, &value)) return false; TFE\_OpSetAttrBool(op, key, value); } else if (type == TF\_ATTR\_TYPE) { int value; if (!ParseTypeValue(key, py\_value, status, &value)) return false; TFE\_OpSetAttrType(op, key, static\_cast<TF\_DataType>(value)); } else if (type == TF\_ATTR\_SHAPE) { if (py\_value == Py\_None) { TFE\_OpSetAttrShape(op, key, nullptr, -1, status); } else { if (!PySequence\_Check(py\_value)) { TF\_SetStatus(status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat( "Expecting None or sequence value for attr", key, ", got ", py\_value->ob\_type->tp\_name) .c\_str()); return false; } const auto num\_dims = TensorShapeNumDims(py\_value); if (num\_dims == -1) { TFE\_OpSetAttrShape(op, key, nullptr, -1, status); return true; } std::unique\_ptr<int64\_t[]> dims(new int64\_t[num\_dims]); for (int i = 0; i < num\_dims; ++i) { tensorflow::Safe\_PyObjectPtr inner\_py\_value( PySequence\_ITEM(py\_value, i)); if (inner\_py\_value.get() == Py\_None) { dims[i] = -1; } else if (!ParseDimensionValue(key, inner\_py\_value.get(), status, &dims[i])) { return false; } } TFE\_OpSetAttrShape(op, key, dims.get(), num\_dims, status); } if (!status->status.ok()) return false; } else if (type == TF\_ATTR\_FUNC) { // Allow: // (1) String function name, OR // (2) A Python object with a .name attribute // (A crude test for being a // tensorflow.python.framework.function.\_DefinedFunction) // (which is what the various "defun" or "Defun" decorators do). // And in the future also allow an object that can encapsulate // the function name and its attribute values. tensorflow::StringPiece func\_name; if (!ParseStringValue(key, py\_value, status, &func\_name)) { PyObject\* name\_attr = PyObject\_GetAttrString(py\_value, "name"); if (name\_attr == nullptr || !ParseStringValue(key, name\_attr, status, &func\_name)) { TF\_SetStatus( status, TF\_INVALID\_ARGUMENT, tensorflow::strings::StrCat( "unable to set function value attribute from a ", py\_value->ob\_type->tp\_name, " object. If you think this is an error, please file an issue " "at https://github.com/tensorflow/tensorflow/issues/new") .c\_str()); return false; } } TF\_SetStatus(status, TF\_OK, ""); TFE\_OpSetAttrFunctionName(op, key, func\_name.data(), func\_name.size()); } else { TF\_SetStatus( status, TF\_UNIMPLEMENTED, tensorflow::strings::StrCat("Attr ", key, " has unhandled type ", type) .c\_str()); return false; } return true;}
void SetOpAttrScalarDefault( TFE\_Context\* ctx, TFE\_Op\* op, const tensorflow::AttrValue& default\_value, const char\* attr\_name, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { SetOpAttrValueScalar(ctx, op, default\_value, attr\_name, status); if (default\_value.value\_case() == tensorflow::AttrValue::kI) { (\*attr\_list\_sizes)[attr\_name] = default\_value.i(); }}
// start\_index is the index at which the Tuple/List attrs will start getting// processed.void SetOpAttrs(TFE\_Context\* ctx, TFE\_Op\* op, PyObject\* attrs, int start\_index, TF\_Status\* out\_status) { if (attrs == Py\_None) return; Py\_ssize\_t len = PyTuple\_GET\_SIZE(attrs) - start\_index; if ((len & 1) != 0) { TF\_SetStatus(out\_status, TF\_INVALID\_ARGUMENT, "Expecting attrs tuple to have even length."); return; } // Parse attrs for (Py\_ssize\_t i = 0; i < len; i += 2) { PyObject\* py\_key = PyTuple\_GET\_ITEM(attrs, start\_index + i); PyObject\* py\_value = PyTuple\_GET\_ITEM(attrs, start\_index + i + 1);#if PY\_MAJOR\_VERSION >= 3 const char\* key = PyBytes\_Check(py\_key) ? PyBytes\_AsString(py\_key) : PyUnicode\_AsUTF8(py\_key);#else const char\* key = PyBytes\_AsString(py\_key);#endif unsigned char is\_list = 0; const TF\_AttrType type = TFE\_OpGetAttrType(op, key, &is\_list, out\_status); if (!out\_status->status.ok()) return; if (is\_list != 0) { if (!SetOpAttrList(ctx, op, key, py\_value, type, nullptr, out\_status)) return; } else { if (!SetOpAttrScalar(ctx, op, key, py\_value, type, nullptr, out\_status)) return; } }}
// This function will set the op attrs required. If an attr has the value of// None, then it will read the AttrDef to get the default value and set that// instead. Any failure in this function will simply fall back to the slow// path.void SetOpAttrWithDefaults( TFE\_Context\* ctx, TFE\_Op\* op, const tensorflow::OpDef::AttrDef& attr, const char\* attr\_name, PyObject\* attr\_value, tensorflow::gtl::FlatMap<string, int64\_t>\* attr\_list\_sizes, TF\_Status\* status) { unsigned char is\_list = 0; const TF\_AttrType type = TFE\_OpGetAttrType(op, attr\_name, &is\_list, status); if (!status->status.ok()) return; if (attr\_value == Py\_None) { if (is\_list != 0) { SetOpAttrListDefault(ctx, op, attr, attr\_name, type, attr\_list\_sizes, status); } else { SetOpAttrScalarDefault(ctx, op, attr.default\_value(), attr\_name, attr\_list\_sizes, status); } } else { if (is\_list != 0) { SetOpAttrList(ctx, op, attr\_name, attr\_value, type, attr\_list\_sizes, status); } else { SetOpAttrScalar(ctx, op, attr\_name, attr\_value, type, attr\_list\_sizes, status); } }}
PyObject\* GetPythonObjectFromInt(int num) {#if PY\_MAJOR\_VERSION >= 3 return PyLong\_FromLong(num);#else return PyInt\_FromLong(num);#endif}
// Python subclass of Exception that is created on not ok Status.tensorflow::mutex exception\_class\_mutex(tensorflow::LINKER\_INITIALIZED);PyObject\* exception\_class TF\_GUARDED\_BY(exception\_class\_mutex) = nullptr;
// Python subclass of Exception that is created to signal fallback.PyObject\* fallback\_exception\_class = nullptr;
// Python function that returns input gradients given output gradients.PyObject\* gradient\_function = nullptr;
// Python function that returns output gradients given input gradients.PyObject\* forward\_gradient\_function = nullptr;
static std::atomic<int64\_t> \_uid;
// This struct is responsible for marking thread\_local storage as destroyed.// Access to the `alive` field in already-destroyed ThreadLocalDestructionMarker// is safe because it's a trivial type, so long as nobody creates a new// thread\_local in the space where now-destroyed marker used to be.// Hopefully creating new thread\_locals while destructing a thread is rare.struct ThreadLocalDestructionMarker { ~ThreadLocalDestructionMarker() { alive = false; } bool alive = true;};
} // namespace
TF\_Status\* GetStatus() { TF\_Status\* maybe\_status = ReleaseThreadLocalStatus(); if (maybe\_status) { TF\_SetStatus(maybe\_status, TF\_OK, ""); return maybe\_status; } else { return TF\_NewStatus(); }}
void ReturnStatus(TF\_Status\* status) { TF\_SetStatus(status, TF\_OK, ""); thread\_local\_tf\_status.reset(status);}
void TFE\_Py\_Execute(TFE\_Context\* ctx, const char\* device\_name, const char\* op\_name, TFE\_InputTensorHandles\* inputs, PyObject\* attrs, TFE\_OutputTensorHandles\* outputs, TF\_Status\* out\_status) { TFE\_Py\_ExecuteCancelable(ctx, device\_name, op\_name, inputs, attrs, /\*cancellation\_manager=\*/nullptr, outputs, out\_status);}
void TFE\_Py\_ExecuteCancelable(TFE\_Context\* ctx, const char\* device\_name, const char\* op\_name, TFE\_InputTensorHandles\* inputs, PyObject\* attrs, TFE\_CancellationManager\* cancellation\_manager, TFE\_OutputTensorHandles\* outputs, TF\_Status\* out\_status) { tensorflow::profiler::TraceMe activity( "TFE\_Py\_ExecuteCancelable", tensorflow::profiler::TraceMeLevel::kInfo);
 TFE\_Op\* op = GetOp(ctx, op\_name, device\_name, out\_status);
 auto cleaner = tensorflow::gtl::MakeCleanup([ctx, op] { ReturnOp(ctx, op); }); if (!out\_status->status.ok()) return;
 tensorflow::unwrap(op)->SetStackTrace(tensorflow::GetStackTrace( tensorflow::StackTrace::kStackTraceInitialSize));
 for (int i = 0; i < inputs->size() && out\_status->status.ok(); ++i) { TFE\_OpAddInput(op, inputs->at(i), out\_status); } if (cancellation\_manager && out\_status->status.ok()) { TFE\_OpSetCancellationManager(op, cancellation\_manager, out\_status); } if (out\_status->status.ok()) { SetOpAttrs(ctx, op, attrs, 0, out\_status); } Py\_BEGIN\_ALLOW\_THREADS;
 int num\_outputs = outputs->size();
 if (out\_status->status.ok()) { TFE\_Execute(op, outputs->data(), &num\_outputs, out\_status); }
 if (out\_status->status.ok()) { outputs->resize(num\_outputs); } else { TF\_SetStatus(out\_status, TF\_GetCode(out\_status), tensorflow::strings::StrCat(TF\_Message(out\_status), " [Op:", op\_name, "]") .c\_str()); }
 Py\_END\_ALLOW\_THREADS;}
PyObject\* TFE\_Py\_RegisterExceptionClass(PyObject\* e) { tensorflow::mutex\_lock l(exception\_class\_mutex); if (exception\_class != nullptr) { Py\_DECREF(exception\_class); } if (PyObject\_IsSubclass(e, PyExc\_Exception) <= 0) { exception\_class = nullptr; PyErr\_SetString(PyExc\_TypeError, "TFE\_Py\_RegisterExceptionClass: " "Registered class should be subclass of Exception."); return nullptr; }
 Py\_INCREF(e); exception\_class = e; Py\_RETURN\_NONE;}
PyObject\* TFE\_Py\_RegisterFallbackExceptionClass(PyObject\* e) { if (fallback\_exception\_class != nullptr) { Py\_DECREF(fallback\_exception\_class); } if (PyObject\_IsSubclass(e, PyExc\_Exception) <= 0) { fallback\_exception\_class = nullptr; PyErr\_SetString(PyExc\_TypeError, "TFE\_Py\_RegisterFallbackExceptionClass: " "Registered class should be subclass of Exception."); return nullptr; } else { Py\_INCREF(e); fallback\_exception\_class = e; Py\_RETURN\_NONE; }}
PyObject\* TFE\_Py\_RegisterGradientFunction(PyObject\* e) { if (gradient\_function != nullptr) { Py\_DECREF(gradient\_function); } if (!PyCallable\_Check(e)) { gradient\_function = nullptr; PyErr\_SetString(PyExc\_TypeError, "TFE\_Py\_RegisterGradientFunction: " "Registered object should be function."); return nullptr; } else { Py\_INCREF(e); gradient\_function = e; Py\_RETURN\_NONE; }}
PyObject\* TFE\_Py\_RegisterJVPFunction(PyObject\* e) { if (forward\_gradient\_function != nullptr) { Py\_DECREF(forward\_gradient\_function); } if (!PyCallable\_Check(e)) { forward\_gradient\_function = nullptr; PyErr\_SetString(PyExc\_TypeError, "TFE\_Py\_RegisterJVPFunction: " "Registered object should be function."); return nullptr; } else { Py\_INCREF(e); forward\_gradient\_function = e; Py\_RETURN\_NONE; }}
void RaiseFallbackException(const char\* message) { if (fallback\_exception\_class != nullptr) { PyErr\_SetString(fallback\_exception\_class, message); return; }
 PyErr\_SetString( PyExc\_RuntimeError, tensorflow::strings::StrCat( "Fallback exception type not set, attempting to fallback due to ", message) .data());}[View remainder of file in raw view](https://github.com/tensorflow/tensorflow/raw/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager/pywrap_tfe_src.cc)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a5b527ee_20250114_183100.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fsecurity%2Fadvisories%2FGHSA-54ch-gjq5-4976)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fsecurity%2Fadvisories%2FGHSA-54ch-gjq5-4976)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

# Segfault due to missing support for quantized types

Low

[mihaimaruseac](/mihaimaruseac)
published
GHSA-54ch-gjq5-4976
May 17, 2022

## Package

pip

tensorflow, tensorflow-cpu, tensorflow-gpu
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 2.9.0

## Patched versions

2.6.4, 2.7.2, 2.8.1, 2.9.0

## Description

### Impact

There is a potential for segfault / denial of service in TensorFlow by calling `tf.compat.v1.*` ops which don't yet have support for quantized types (added after migration to TF 2.x):

```
import numpy as np
import tensorflow as tf

tf.compat.v1.placeholder_with_default(input=np.array([2]),shape=tf.constant(dtype=tf.qint8, value=np.array([1])))
```

In these scenarios, since the kernel is missing, a [`nullptr` value is passed](https://github.com/tensorflow/tensorflow/blob/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager/pywrap_tfe_src.cc#L480-L482) to [`ParseDimensionValue`](https://github.com/tensorflow/tensorflow/blob/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/python/eager/pywrap_tfe_src.cc#L296-L320) for the `py_value` argument. Then, this is dereferenced, resulting in segfault.

### Patches

We have patched the issue in GitHub commit [237822b59fc504dda2c564787f5d3ad9c4aa62d9](https://github.com/tensorflow/tensorflow/commit/237822b59fc504dda2c564787f5d3ad9c4aa62d9).

The fix will be included in TensorFlow 2.9.0. We will also cherrypick this commit on TensorFlow 2.8.1, TensorFlow 2.7.2, and TensorFlow 2.6.4, as these are also affected and still in supported range.

### For more information

Please consult [our security guide](https://github.com/tensorflow/tensorflow/blob/master/SECURITY.md) for more information regarding the security model and how to contact us with issues and questions.

### Attribution

This vulnerability has been reported by Hong Jin from Singapore Management University.

### Severity

Low

### CVE ID

CVE-2022-29205

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7700e105_20250114_183055.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F237822b59fc504dda2c564787f5d3ad9c4aa62d9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F237822b59fc504dda2c564787f5d3ad9c4aa62d9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tensorflow%2Ftensorflow)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tensorflow](/tensorflow)
/
**[tensorflow](/tensorflow/tensorflow)**
Public

* [Notifications](/login?return_to=%2Ftensorflow%2Ftensorflow) You must be signed in to change notification settings
* [Fork
  74.4k](/login?return_to=%2Ftensorflow%2Ftensorflow)
* [Star
   187k](/login?return_to=%2Ftensorflow%2Ftensorflow)

* [Code](/tensorflow/tensorflow)
* [Issues
  826](/tensorflow/tensorflow/issues)
* [Pull requests
  5k+](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects
  2](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

Additional navigation options

* [Code](/tensorflow/tensorflow)
* [Issues](/tensorflow/tensorflow/issues)
* [Pull requests](/tensorflow/tensorflow/pulls)
* [Actions](/tensorflow/tensorflow/actions)
* [Projects](/tensorflow/tensorflow/projects)
* [Security](/tensorflow/tensorflow/security)
* [Insights](/tensorflow/tensorflow/pulse)

## Commit

[Permalink](/tensorflow/tensorflow/commit/237822b59fc504dda2c564787f5d3ad9c4aa62d9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix tf.compat.v1.placeholder\_with\_default vulnerability with quantize…

[Browse files](/tensorflow/tensorflow/tree/237822b59fc504dda2c564787f5d3ad9c4aa62d9)
Browse the repository at this point in the history

```
…d types.

When iterating through the tensor to extract shape values, an underlying missing kernel
(`StridedSlice` for quantized types) causes an error, which then results in a `nullptr`
being passed to `ParseDimensionValue()`, causing a segfault.

The `nullptr` check allows the missing kernel error to propagate.
Adding the missing kernel registrations allows the shape values
to be extracted successfully.

PiperOrigin-RevId: 445045957
```

* Loading branch information

[![@cantonios](https://avatars.githubusercontent.com/u/2538739?s=40&v=4)](/cantonios) [![@tensorflower-gardener](https://avatars.githubusercontent.com/u/17151892?s=40&v=4)](/tensorflower-gardener)

[cantonios](/tensorflow/tensorflow/commits?author=cantonios "View all commits by cantonios")
authored and
[tensorflower-gardener](/tensorflow/tensorflow/commits?author=tensorflower-gardener "View all commits by tensorflower-gardener")
committed
Apr 28, 2022

1 parent
[527a612](/tensorflow/tensorflow/commit/527a612a873dcf56e9b787623ae7edfe5f6e5250)

commit 237822b

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**6 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* tensorflow

  + core/kernels

    - tensorflow/core/kernels/strided\_slice\_op.cc
      [strided\_slice\_op.cc](#diff-9197616fce63fd96604f418a9ae9ababb6e80f0adb0eb74c121ed2f89d7ec706)
    - tensorflow/core/kernels/strided\_slice\_op\_impl.h
      [strided\_slice\_op\_impl.h](#diff-880818f8ae16f90cb5de85b0763c4c686e241dc83049082894fbc73f121754d4)
  + python/eager

    - tensorflow/python/eager/pywrap\_tfe\_src.cc
      [pywrap\_tfe\_src.cc](#diff-9743b1789c6ef49f08c6ef3b506511a86dad37d2de2583b1903d0a719ce88fab)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[tensorflow/core/kernels/strided\_slice\_op.cc](#diff-9197616fce63fd96604f418a9ae9ababb6e80f0adb0eb74c121ed2f89d7ec706 "tensorflow/core/kernels/strided_slice_op.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/237822b59fc504dda2c564787f5d3ad9c4aa62d9/tensorflow/core/kernels/strided_slice_op.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -431,6 +431,7 @@ class StridedSliceAssignOp : public OpKernel { |
|  |  | StridedSliceAssignOp<CPUDevice, type, true>) |
|  |  |  |
|  |  | TF\_CALL\_ALL\_TYPES(REGISTER\_STRIDED\_SLICE); |
|  |  | TF\_CALL\_QUANTIZED\_TYPES(REGISTER\_STRIDED\_SLICE); |
|  |  |  |
|  |  | #undef REGISTER\_STRIDED\_SLICE |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[tensorflow/core/kernels/strided\_slice\_op\_impl.h](#diff-880818f8ae16f90cb5de85b0763c4c686e241dc83049082894fbc73f121754d4 "tensorflow/core/kernels/strided_slice_op_impl.h")

Show comments

[View file](/tensorflow/tensorflow/blob/237822b59fc504dda2c564787f5d3ad9c4aa62d9/tensorflow/core/kernels/strided_slice_op_impl.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -292,7 +292,7 @@ TF\_CALL\_GPU\_ALL\_TYPES(DECLARE\_FOR\_N\_GPU); |
|  |  | #endif // END GOOGLE\_CUDA || TENSORFLOW\_USE\_ROCM |
|  |  |  |
|  |  | TF\_CALL\_ALL\_TYPES(DECLARE\_FOR\_N\_CPU); |
|  |  |  |
|  |  | TF\_CALL\_QUANTIZED\_TYPES(DECLARE\_FOR\_N\_CPU); |
|  |  |  |
|  |  | #undef INSTANTIATE |
|  |  | #undef DECLARE\_FOR\_N\_CPU |
| Expand Down | |  |

5 changes: 4 additions & 1 deletion

5
[tensorflow/python/eager/pywrap\_tfe\_src.cc](#diff-9743b1789c6ef49f08c6ef3b506511a86dad37d2de2583b1903d0a719ce88fab "tensorflow/python/eager/pywrap_tfe_src.cc")

Show comments

[View file](/tensorflow/tensorflow/blob/237822b59fc504dda2c564787f5d3ad9c4aa62d9/tensorflow/python/eager/pywrap_tfe_src.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -688,9 +688,12 @@ bool SetOpAttrScalar(TFE\_Context\* ctx, TFE\_Op\* op, const char\* key, |
|  |  | for (int i = 0; i < num\_dims; ++i) { |
|  |  | tensorflow::Safe\_PyObjectPtr inner\_py\_value( |
|  |  | PySequence\_ITEM(py\_value, i)); |
|  |  | // If an error is generated when iterating through object, we can |
|  |  | // sometimes get a nullptr. |
|  |  | if (inner\_py\_value.get() == Py\_None) { |
|  |  | dims[i] = -1; |
|  |  | } else if (!ParseDimensionValue(key, inner\_py\_value.get(), status, |
|  |  | } else if (inner\_py\_value.get() == nullptr || |
|  |  | !ParseDimensionValue(key, inner\_py\_value.get(), status, |
|  |  | &dims[i])) { |
|  |  | return false; |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `237822b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftensorflow%2Ftensorflow%2Fcommit%2F237822b59fc504dda2c564787f5d3ad9c4aa62d9) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


