=== Content from github.com_162b744b_20250114_190302.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP%2Fcommit%2F0108f1bde2117ac5c1e28d124128f60c8bb09a8e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP%2Fcommit%2F0108f1bde2117ac5c1e28d124128f60c8bb09a8e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=MISP%2FMISP)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MISP](/MISP)
/
**[MISP](/MISP/MISP)**
Public

* [Notifications](/login?return_to=%2FMISP%2FMISP) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2FMISP%2FMISP)
* [Star
   5.5k](/login?return_to=%2FMISP%2FMISP)

* [Code](/MISP/MISP)
* [Issues
  2.5k](/MISP/MISP/issues)
* [Pull requests
  89](/MISP/MISP/pulls)
* [Discussions](/MISP/MISP/discussions)
* [Actions](/MISP/MISP/actions)
* [Projects
  1](/MISP/MISP/projects)
* [Wiki](/MISP/MISP/wiki)
* [Security](/MISP/MISP/security)
* [Insights](/MISP/MISP/pulse)

Additional navigation options

* [Code](/MISP/MISP)
* [Issues](/MISP/MISP/issues)
* [Pull requests](/MISP/MISP/pulls)
* [Discussions](/MISP/MISP/discussions)
* [Actions](/MISP/MISP/actions)
* [Projects](/MISP/MISP/projects)
* [Wiki](/MISP/MISP/wiki)
* [Security](/MISP/MISP/security)
* [Insights](/MISP/MISP/pulse)

## Commit

[Permalink](/MISP/MISP/commit/0108f1bde2117ac5c1e28d124128f60c8bb09a8e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: [security] unregister phar from stream wrappers globally for all…

[Browse files](/MISP/MISP/tree/0108f1bde2117ac5c1e28d124128f60c8bb09a8e)
Browse the repository at this point in the history

```
… Model code

- blanket protection against phar deserialization vulnerabilities

- as reported by Dawid Czarnecki of Zigrin Security
```

* Loading branch information

[![@iglocska](https://avatars.githubusercontent.com/u/3668672?s=40&v=4)](/iglocska)

[iglocska](/MISP/MISP/commits?author=iglocska "View all commits by iglocska")
committed
Apr 17, 2022

1 parent
[3dc5090](/MISP/MISP/commit/3dc5090b59de7602f6b76092f2cc521c1afdbb73)

commit 0108f1b

Showing
**1 changed file**
with
**3 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[app/Model/AppModel.php](#diff-f5612e5237fac98d81298f75cf21487e0930c39f1ded9da2f44eaf520f6957fc "app/Model/AppModel.php")

Show comments

[View file](/MISP/MISP/blob/0108f1bde2117ac5c1e28d124128f60c8bb09a8e/app/Model/AppModel.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,6 +51,9 @@ public function \_\_construct($id = false, $table = null, $ds = null) |
|  |  | { |
|  |  | parent::\_\_construct($id, $table, $ds); |
|  |  | $this->findMethods['column'] = true; |
|  |  | if (in\_array('phar', stream\_get\_wrappers())) { |
|  |  | stream\_wrapper\_unregister('phar'); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // deprecated, use $db\_changes |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0108f1b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP%2Fcommit%2F0108f1bde2117ac5c1e28d124128f60c8bb09a8e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b156e610_20250114_190306.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP%2Fcompare%2Fv2.4.157...v2.4.158)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP%2Fcompare%2Fv2.4.157...v2.4.158)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcompare%2Fshow&source=header-repo&source_repo=MISP%2FMISP)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MISP](/MISP)
/
**[MISP](/MISP/MISP)**
Public

* [Notifications](/login?return_to=%2FMISP%2FMISP) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2FMISP%2FMISP)
* [Star
   5.5k](/login?return_to=%2FMISP%2FMISP)

* [Code](/MISP/MISP)
* [Issues
  2.5k](/MISP/MISP/issues)
* [Pull requests
  89](/MISP/MISP/pulls)
* [Discussions](/MISP/MISP/discussions)
* [Actions](/MISP/MISP/actions)
* [Projects
  1](/MISP/MISP/projects)
* [Wiki](/MISP/MISP/wiki)
* [Security](/MISP/MISP/security)
* [Insights](/MISP/MISP/pulse)

Additional navigation options

* [Code](/MISP/MISP)
* [Issues](/MISP/MISP/issues)
* [Pull requests](/MISP/MISP/pulls)
* [Discussions](/MISP/MISP/discussions)
* [Actions](/MISP/MISP/actions)
* [Projects](/MISP/MISP/projects)
* [Wiki](/MISP/MISP/wiki)
* [Security](/MISP/MISP/security)
* [Insights](/MISP/MISP/pulse)

[Permalink](https://github.com/MISP/MISP/compare/MISP%3Af4e390a...MISP%3A9f1a239)
# Comparing changes

 Choose two branches to see what’s changed or to start a new pull request.
If you need to, you can also  compare across forks
 or
[learn more about diff comparisons](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

# Open a pull request

 Create a new pull request by comparing changes across two branches. If you need to, you can also  compare across forks
.
[Learn more about diff comparisons here](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

*base repository:*
MISP/MISP

Failed to load repositories. Confirm that selected base ref is valid, then try again.

 Loading

*base:*
v2.4.157

Choose a base ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/MISP/MISP/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.4.158)

Could not load tags

Nothing to show

[{{ refName }}
default](/MISP/MISP/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.4.158)

 Loading

...

*head repository:*
MISP/MISP

Failed to load repositories. Confirm that selected head ref is valid, then try again.

 Loading

*compare:*
v2.4.158

Choose a head ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/MISP/MISP/compare/v2.4.157...%7B%7B%20urlEncodedRefName%20%7D%7D)

Could not load tags

Nothing to show

[{{ refName }}
default](/MISP/MISP/compare/v2.4.157...%7B%7B%20urlEncodedRefName%20%7D%7D)

 Loading

10
contributors

[Commits
171](#commits_bucket)
[Files changed
135](#files_bucket)

 Loading

 Loading

### This comparison is taking too long to generate.

Unfortunately it looks like we can’t render this comparison for you right now. It might be too big, or there might be something weird with your repository.

You can try running this command locally to see the comparison on your machine:

`git diff v2.4.157...v2.4.158`

  Retry

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from zigrin.com_93a4d411_20250114_190317.html ===


* contact@zigrin.com

We are reliable, trustworthy, and ready for challenges! [Hire Us](/contact)

[Linkedin-in](https://www.linkedin.com/company/zigrin-security/)

[Github](https://github.com/Zigrin-Security)

[![Web Application Security Testing](https://zigrin.com/wp-content/uploads/2021/11/logo.png)](https://zigrin.com/)

* Company
  + [About Us](https://zigrin.com/about-us/)
  + [Why Should You Trust Us](https://zigrin.com/why-should-you-trust-us/)
  + [Frequently Asked Questions](https://zigrin.com/faq/)
* [Services](https://zigrin.com/services/)
  + [Web Application Security Testing](https://zigrin.com/services/web-application-security-testing/)
  + [Cybersecurity research](https://zigrin.com/services/cybersecurity-research/)
  + [Network Penetration Testing](https://zigrin.com/services/network-penetration-testing/)
  + [Vulnerability assessment](https://zigrin.com/services/vulnerability-assessment/)
  + [Red Teaming](https://zigrin.com/services/red-teaming/)
  + [Mobile Application Penetration Testing](https://zigrin.com/services/mobile-penetration-testing/)
  + [Source Code Review](https://zigrin.com/services/source-code-review/)
* [Case study](https://zigrin.com/casestudy/)
  + [Critical vulnerability discovered in MISP](https://zigrin.com/case-study/vulnerability-discovery-in-misp/)
  + [Securing company’s main website](https://zigrin.com/case-study/securing-companys-main-website/)
  + [SaaS Penetration Testing Resulting in Closing the Deal](https://zigrin.com/case-study/saas-penetration-testing-resulting-in-closing-the-deal/)
  + [Special delivery for request](https://zigrin.com/case-study/special-delivery-for-request/)
* [Advisories](https://zigrin.com/advisories/)
* [Blog](https://zigrin.com/blog/)
* [Tools](https://zigrin.com/tools/)
  + [Cake Fuzzer](https://zigrin.com/tools/cake-fuzzer/)
  + [HTTP2WebSocket](https://zigrin.com/tools/http2websocket/)
* [Talks](https://zigrin.com/talks/)
* [Contact](https://zigrin.com/contact/)

Search for:

### [Have Any Questions?](https://zigrin.com/contact/)

Contact our expert

[![Web Application Security Testing](https://zigrin.com/wp-content/uploads/2021/11/logo.png)](https://zigrin.com/)

Search for:

* Company
  + [About Us](https://zigrin.com/about-us/)
  + [Why Should You Trust Us](https://zigrin.com/why-should-you-trust-us/)
  + [Frequently Asked Questions](https://zigrin.com/faq/)
* [Services](https://zigrin.com/services/)
  + [Web Application Security Testing](https://zigrin.com/services/web-application-security-testing/)
  + [Cybersecurity research](https://zigrin.com/services/cybersecurity-research/)
  + [Network Penetration Testing](https://zigrin.com/services/network-penetration-testing/)
  + [Vulnerability assessment](https://zigrin.com/services/vulnerability-assessment/)
  + [Red Teaming](https://zigrin.com/services/red-teaming/)
  + [Mobile Application Penetration Testing](https://zigrin.com/services/mobile-penetration-testing/)
  + [Source Code Review](https://zigrin.com/services/source-code-review/)
* [Case study](https://zigrin.com/casestudy/)
  + [Critical vulnerability discovered in MISP](https://zigrin.com/case-study/vulnerability-discovery-in-misp/)
  + [Securing company’s main website](https://zigrin.com/case-study/securing-companys-main-website/)
  + [SaaS Penetration Testing Resulting in Closing the Deal](https://zigrin.com/case-study/saas-penetration-testing-resulting-in-closing-the-deal/)
  + [Special delivery for request](https://zigrin.com/case-study/special-delivery-for-request/)
* [Advisories](https://zigrin.com/advisories/)
* [Blog](https://zigrin.com/blog/)
* [Tools](https://zigrin.com/tools/)
  + [Cake Fuzzer](https://zigrin.com/tools/cake-fuzzer/)
  + [HTTP2WebSocket](https://zigrin.com/tools/http2websocket/)
* [Talks](https://zigrin.com/talks/)
* [Contact](https://zigrin.com/contact/)

[![Web Application Security Testing](https://engitech.s3.amazonaws.com/images/logo.svg)](https://zigrin.com/)

Over 10 years we help companies reach their financial and branding goals. Engitech is a values-driven technology agency dedicated.

#### Gallery

#### Contacts

411 University St, Seattle, USA

engitech@oceanthemes.net

+1 -800-456-478-23

Twitter

Facebook-f

Pinterest-p

Instagram

# Zigrin Blog

* [Home](https://zigrin.com)
* [Blog](https://zigrin.com/blog/)
* [Web Application Security Testing](https://zigrin.com/category/web-application-security-testing/)
* CakePHP Application Cybersecurity Research – Exploring the PHAR Deserialization PHP Vulnerability: A White Box Testing Example

[Web Application Security Testing](https://zigrin.com/category/web-application-security-testing/) ![white box testing example](https://zigrin.com/wp-content/uploads/2023/04/white-box-testing-example.jpg)
\_ [May 17, 2023](https://zigrin.com/cakephp-application-cybersecurity-research-exploring-the-phar-deserialization-php-vulnerability-a-white-box-testing-example/)\_ [Ulaş Deniz İlhan](https://zigrin.com/author/deniz/)\_ [0 Comments](https://zigrin.com/cakephp-application-cybersecurity-research-exploring-the-phar-deserialization-php-vulnerability-a-white-box-testing-example/#respond)
# CakePHP Application Cybersecurity Research – Exploring the PHAR Deserialization PHP Vulnerability: A White Box Testing Example

In this article, we are going to explore the topic of PHAR deserialization php vulnerability that [Dawid](https://www.linkedin.com/in/dawid-czarnecki/) found in a white box testing. Before we continue, let’s talk about PHAR a little bit and after that what is the PHAR deserialization php vulnerability.

!**This** **is the **sixth article in the “CakePHP Application Cybersecurity Research” series where I describe the impact of PHAR Deserialization vulnerability**.** **Here you can find the other ones dedicated to this topic:**

* **[Be Careful with Reflections For Your Web Application Security](https://zigrin.com/cakephp-application-cybersecurity-research-be-careful-with-reflections-for-your-web-application-security/)**
* **[Protect Your Website from Stored XSS Attacks: Understanding and Preventing Vulnerabilities in Open-source Applications](https://zigrin.com/cakephp-application-cybersecurity-research-protect-your-website-from-stored-xss-attacks-understanding-and-preventing-vulnerabilities-in-open-source-applications/)**
* **[The Impact of a PHP Vulnerability: Exploring the Password Confirmation Bypass in MISP](https://zigrin.com/cakephp-application-cybersecurity-research-the-impact-of-a-php-vulnerability-exploring-the-password-confirmation-bypass-in-misp/)**
* **[Hiding in Plain Sight: The Hidden Danger of SQL Injection in Input Field Names](https://zigrin.com/cakephp-application-cybersecurity-research-hiding-in-plain-sight-the-hidden-danger-of-sql-injection-in-input-field-names/)**
* **[Bypassing security mechanisms in CakePHP vulnerability scanning](https://zigrin.com/cakephp-application-cybersecurity-research-bypassing-security-mechanisms-in-cakephp-vulnerability-scanning/)**
* **[Attack surface in CakePHP web application penetration testing](https://zigrin.com/cakephp-application-cybersecurity-research-attack-surface-in-cakephp-web-application-penetration-testing/)**
* **[White box penetration testing in action](https://zigrin.com/cakephp-application-cybersecurity-research-white-box-penetration-testing-in-action/)**

**In this article you will find:**

* **[What is PHAR?](#What-is-PHAR?)**
* **[What is PHAR Deserialization PHP vulnerability?](#What-is-PHAR-Deserialization-PHP-vulnerability?)**
* **[When should you worry?](http://When-should-you-worry)**
* **[How does the exploitation of this php vulnerability look like?](#How-does-the-exploitation-of-this-php-vulnerability-look-like?)**
* **[What exactly we found?](#What-exactly-we-found?)**
* **[Example scenario: Kafka integration exploitation case](#Example-scenario:-Kafka-integration-exploitation-case)**
* **[What is the impact of this php vulnerability?](#What-is-the-impact-of-this-php-vulnerability?)**
* **[To prevent this vulnerability, organizations can take several steps](#To-prevent-this-vulnerability,-organizations-can-take-several-steps:)**
* **[Conclusion](#Conclusion)**

## **What is PHAR?**

PHP Archive (in short PHAR) is a functionality that allows putting several PHP files into a single archive file for easy distribution and installation. This is similar functionality to the one provided by JAR files in the Java ecosystem. In addition, the PHP engine implements a “phar://” stream wrapper to access specific files within a PHP Archive. For example, to load the **file.php** from the **myphar.phar** file, you can use the following PHP code:

![phar code example](https://zigrin.com/wp-content/uploads/2023/04/phar-code-example.png)

Multiple default PHP functions that operate on files can parse PHP Archives and extract the desired PHP file. Examples of such functions **include**, **file\_exists**, and **fopen**.

## **What is PHAR Deserialization PHP vulnerability?**

When the PHP interpreter finds a phar wrapper in one of those functions, it loads the archive. Subsequently, the PHP interpreter deserializes the phar archive, which may result in executing a potentially dangerous action. Deserialization is the process of creating a PHP object from a stored representation. It allows translating a string or a file in a specific format to a PHP object. The deserialization process can be used in attacks when an attacker’s-controlled input is being deserialized. If the application does not implement sufficient protections, the attacker can craft the serialized object in a way to exploit the object instantiation and autoloading mechanisms of the PHP interpreter. This results in executing arbitrary PHP code on the vulnerable web application.

![PHAR deserialization PHP vulnerability](https://zigrin.com/wp-content/uploads/2023/04/PHAR-deserialization-PHP-vulnerability.gif)
## **When should you worry?**

A phar deserialization vulnerability occurs when mainly the following conditions are met:

* An application uses PHP functions operating on files with user-controlled input.
* The user controls the beginning part of the file path.
* The user can upload arbitrary files on the server.
* The user knows the absolute path of the uploaded file.
* The phar wrapper has not been unregistered.
* The attacker has internal knowledge about existing classes, which allows him to construct specific serialized objects.

## **How does the exploitation of this php vulnerability look like?**

The following steps describe the typical exploitation process:

* The attacker learns about the classes loaded by the application. This happens either by reading the source code of the application if possible or by understanding what libraries or frameworks are used by the application. Another way would be to try classes of typical libraries that are used by other applications.
* The attacker crafts a malicious phar file and uploads it to the server.
* The attacker locates the absolute path of the previously uploaded file.
* The attacker sends the absolute path to the uploaded file prepended with the “phar://” prefix to the vulnerable application endpoint.
* The application uses the user-supplied path with the “phar://” prefix to conduct operations on the file such as checking if the file exists with the function “**file\_exists**”.
* The PHP interpreter unpacks the phar file and reads its metadata.
* The PHP interpreter deserializes the metadata crafted by the adversary.
* During the instantiation, autoloading, or destruction of the object, the PHP interpreter conducts malicious actions based on the adversary’s-controlled data such as executing code on the operating system.

The exploitation of this vulnerability very often leads to remote code execution on the application’s server. This impacts the confidentiality, integrity, and availability of the application as the attacker gains internal access to the application’s operating system.

## **What exactly we found?**

During the White box testing security assessment that we conducted for MISP open-source threat intelligence application, we discovered multiple areas of the application vulnerable to “phar deserialization”. The following table highlights these areas:

![phar deserialization vulnerable areas](https://zigrin.com/wp-content/uploads/2023/04/phar-deserialization-vulnerable-areas.png)

Another place vulnerable to “phar deserialization” was the **CertAuth** plugin. The method *getRestUser* of the class *CertificateAuthenticate* in the file “*app/Plugin/CertAuth/Controller/Component/Auth/CertificateAuthenticate.php*” at line *262* seems to load a file from an URL. This URL is provided in the configuration variable at line *223*. The configuration variable could be potentially modified by an administrator, which could lead to the exploitation of this vulnerability.

## **Example scenario: Kafka integration exploitation case**

If you’re familiar with MISP, you may have heard that there is a plugin for publishing events to Apache Kafka. But here’s something you may not know: if this certain plugin is enabled, a rogue MISP administrator could potentially use it to execute malicious code on the operating system.

Let’s break this down a bit to exploit this vulnerability before diving in to exploitation:

1. Generate a malicious phar file.
2. Upload phar file to the server.
3. Enable Apache Kafka plugin in MISP.
4. Provide a path to the uploaded phar plugin.
5. Setup a listener.
6. Publish any event.

**Step 1 – Generating a malicious phar file**

To generate the malicious phar file we used the [PHPGGC](https://github.com/ambionics/phpggc) software:

![generating malicious phar file](https://zigrin.com/wp-content/uploads/2023/04/generating-malicious-phar-file.png)

The command included in the “exploit.phar” file will initiate a reverse shell connection on port **1111,** host **dawid**, which should be considered as a machine controlled by the adversary.

Note, the CLI php.ini file on the host where generation occurs needs to have the following line:

![CLI php.ini file line](https://zigrin.com/wp-content/uploads/2023/04/CLI-php.ini-file-line.png)

**Step 2 – Uploading the generated phar file**

During this white box security example, we choose to upload our malicious file as an organization logo. This can be done under the following URL: http://<MISP-SERVER>/admin/organisations/edit/1

![uploading the generated phar file](https://zigrin.com/wp-content/uploads/2023/04/uploading-the-generated-phar-file.png)

**Step 3 – Enabling the Kafka plugin in MISP**

To enable the Kafka plugin, we conducted the following actions:

* Go to https://<MISP-SERVER>/servers/serverSettings/Plugin
* Expand the „Kafka” section.

![enabling Kafka plugin](https://zigrin.com/wp-content/uploads/2023/04/Enabling-Kafka-plugin-1.png)

* Enable the following settings:

o Plugin.Kafka\_enable

![enabling Kafka plugin](https://zigrin.com/wp-content/uploads/2023/04/Enabling-Kafka-plugin-1.png)

o Plugin.Kafka\_event\_publish\_notifications\_enable

![enabling kafka plugin](https://zigrin.com/wp-content/uploads/2023/04/enabling-the-kafka-plugin-2.png)

**Step 4 – Setting the correct Kafka config path**

The uploaded phar file was available under the URL: http://<MISP-SERVER>/img/orgs/1.png

MISP was installed under the default filesystem path. Because of that, the organization image was uploaded to the following absolute server path: **phar:///var/www/MISP/app/webroot/img/orgs/1.png** We provided this path in the following Kafka setting: **Plugin.Kafka\_rdkafka\_config**

**Step 5 – Setting up a listener**

To receive the connection from the server, we started listener on the attacker’s machine called **dawid** using the netcat command:

![setting up listener](https://zigrin.com/wp-content/uploads/2023/04/setting-up-listener.png)

**Step 6 – Publishing an event**

We created an empty event in the *Event Actions* > *Add events* and published it using the “Publish Event” link in the event’s view.

As a result, the connection was established and we were granted shell access to the operating system where the MISP application was installed:

![publishing event phar desarialization](https://zigrin.com/wp-content/uploads/2023/04/publishing-event-phar-desarialization.png)

The source code file **MISP/app/Model/AppModel.php** is vulnerable in line **2590** (method **getKafkaPubTool**):

![kafka code](https://zigrin.com/wp-content/uploads/2023/04/kafka-code.png)
##### **What is the impact of this php vulnerability?**

It is very important to note that, the vulnerability can be exploited by MISP administrators only. This alone lower the severity of this vulnerability.

However, a similar vulnerability was discovered by Ianis Bernard from NATO Cyber Security Centre that can be exploited by non-administrator users. You can find more information under this [link](https://zigrin.com/advisories/misp-phar-deserialization/).

The impact of the MISP vulnerability is severe. As a critical application for threat intelligence sharing and collaboration, MISP is widely used by organizations and agencies in various industries including government, finance, healthcare, and defense. The vulnerability may allow attackers to gain unauthorized access to sensitive information stored in MISP, including details of ongoing investigations, vulnerabilities, and other sensitive data.

This php vulnerability might lead attackers to execute arbitrary code remotely, which can result in a complete compromise of the MISP instance and potentially lead to the compromise of other systems and networks connected to it. This can include the theft of confidential data, installation of malware or backdoors, and disruption of critical systems and services.

Moreover, the nature of MISP as a collaborative platform for sharing threat intelligence means that the impact of a compromise can extend beyond a single organization. If an attacker gains access to a MISP instance, they can potentially access and exfiltrate sensitive data from other organizations sharing information on the platform. This could have serious consequences for national security, public safety, and the privacy of individuals.

What can happen if your application is vulnerable to PHAR deserialization? Here I compose the list of impacts:

* Remote code execution: If an attacker exploits PHAR deserialization vulnerability, they can execute arbitrary code remotely on the vulnerable system. This could result in the attacker gaining control of the system, stealing sensitive data, or using the system to launch further attacks on other systems.
* Denial of service: Attackers can also use PHAR deserialization vulnerability to launch denial of service attacks. By exploiting this vulnerability, attackers can cause the system to crash or become unresponsive, rendering it unusable for legitimate users.
* Data theft: PHAR deserialization vulnerability can also lead to data theft, where attackers can gain access to sensitive data stored on the system, such as user credentials, credit card numbers, and other personally identifiable information depending on the target system.
* Malware infection: Attackers can use PHAR deserialization vulnerability to inject malware into the system, which can then be used to perform other malicious activities, such as spying on users, stealing data, or launching further attacks.
* Reputation damage: A successful attack on the system can lead to significant reputation damage for the affected organization. This can result in a loss of customers, revenue, and credibility.

## **To prevent this vulnerability, organizations can take several steps:**

* Deregistering PHAR wrapper: To prevent potential security vulnerabilities, consider deregistering the PHAR wrapper if it’s not in use. This can be done using the **stream\_wrapper\_unregister()** function.
* Limit access to PHAR files: Restrict access to PHAR files, both from the file system and the application code. Make sure that only trusted users can read and modify PHAR archives.
* Use only the base name of the path as input: When opening a PHAR archive, only use the base name of the path as input, rather than the entire path. This helps prevent directory traversal attacks and ensures that the PHAR archive is only opened from a known location.
* Prepend the path with a fixed string: Prepend the path to the PHAR archive with a fixed string to make sure it is opened from the correct location. This can also help prevent directory traversal attacks.
* Whitelist the path/URL extensions provided by the user: Whitelist the path or URL extensions provided by the user to ensure that only valid PHAR archives are opened. This helps prevent attackers from exploiting the application by injecting malicious payloads in the PHAR archive’s metadata.
* Keep software up to date: Always keep the software and all libraries used in the application up-to-date, as new patches and security updates are released regularly to address vulnerabilities like this.
* Monitor application logs: Monitor application logs to detect any suspicious activity, such as unauthorized attempts to access PHAR files or unusual use of the **unserialize()** function.
* Conduct regular security assessments: Regular security assessments can help identify vulnerabilities in the system and address them before attackers can exploit them. Organizations should conduct periodic security assessments of their applications to ensure that they are secure and up to date.

By implementing these measures or disabling the PHAR stream wrapper, organizations can significantly reduce the risk of attackers exploiting this vulnerability and gaining unauthorized access to their sensitive information. Organizations need to take a proactive approach to security and implement a comprehensive security strategy to protect their critical applications and data.

## **Conclusion**

In conclusion, this vulnerability is a serious issue that needs to be addressed by organizations using web applications based on PHP. It has the possibility of attackers gaining unauthorized access to sensitive data and potentially causing significant damage. It is important to mention that this kind of php vulnerability is not something we face every time we conduct white box testing examples or real-life tests.

To prevent such attacks, it is essential to keep applications up to date with the latest security patches and follow best practices for secure deployment. Organizations should also regularly audit their systems to ensure that there are no vulnerabilities that could be exploited by attackers. Finally, it is important to have a robust incident response plan in place to quickly identify and respond to any potential attacks.

!**Th**e next article is going to be about** [**a Stored XSS vulnerability we found in MISP open-source threat analysis application.**](https://zigrin.com/cakephp-application-cybersecurity-research-protect-your-website-from-stored-xss-attacks-understanding-and-preventing-vulnerabilities-in-open-source-applications/)**

![](https://zigrin.com/wp-content/uploads/2022/07/Tlo_poziome.png)

**Let’s talk about conducting cybersecurity research of your web application.**

### Book a chat with a cybersecurity expert

19+21=?

Submit

**Is this article helpful to you? Share it with your friends**.

* [Facebook](https://www.facebook.com/sharer.php?u=https://zigrin.com/cakephp-application-cybersecurity-research-exploring-the-phar-deserialization-php-vulnerability-a-white-box-testing-example/)
* [LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https://zigrin.com/cakephp-application-cybersecurity-research-exploring-the-phar-deserialization-php-vulnerability-a-white-box-testing-example/)
* [Twitter](https://twitter.com/intent/tweet?url=https://zigrin.com/cakephp-application-cybersecurity-research-exploring-the-phar-deserialization-php-vulnerability-a-white-box-testing-example/&text=CakePHP%20Application%20Cybersecurity%20Research%20-%20Exploring%20the%20PHAR%20Deserialization%20PHP%20Vulnerability:%20A%20White%20Box%20Testing%20Example)

[Cake PHP security](https://zigrin.com/tag/cake-php-security/) [cybersecurity research](https://zigrin.com/tag/cybersecurity-research/)[♥100](https://zigrin.com/wp-admin/admin-ajax.php?action=process_simple_like&post_id=11247&nonce=8866b67bec&is_comment=0&disabled=true "Like")
![](https://secure.gravatar.com/avatar/e5de921645a7b3fe2b264f5a2efc0794?s=250&d=mm&r=g)

Author

###### Ulaş Deniz İlhan

 [###### CakePHP Application Cybersecurity Research – The Impact of a PHP Vulnerability: Exploring the Password Confirmation Bypass in MISP

April 26, 2023](https://zigrin.com/cakephp-application-cybersecurity-research-the-impact-of-a-php-vulnerability-exploring-the-password-confirmation-bypass-in-misp/)[###### CakePHP Application Cybersecurity Research – Protect Your Website from Stored XSS Attacks: Understanding and Preventing Vulnerabilities in Open-source Applications

June 7, 2023](https://zigrin.com/cakephp-application-cybersecurity-research-protect-your-website-from-stored-xss-attacks-understanding-and-preventing-vulnerabilities-in-open-source-applications/)

Search for:

![Dawid Czarnecki](https://zigrin.com/wp-content/uploads/2022/02/Dawid-Czarnecki-Zigrin-2.jpg)

##### Dawid Czarnecki

CEO of Zigrin Security and security researcher.

##### Categories

Categories
Select Category
Cybersecurity  (1)
Web Application Security Testing  (31)

##### Recent Posts

* [![what hackers do with your data](https://zigrin.com/wp-content/uploads/2023/10/what-hackers-do-with-your-data-150x150.png)](https://zigrin.com/what-do-cyber-threat-actors-do-with-your-information/)

  ###### [What do Cyber Threat Actors do with your information?](https://zigrin.com/what-do-cyber-threat-actors-do-with-your-information/)

  October 11, 2023
* [![AI penetration testing](https://zigrin.com/wp-content/uploads/2023/09/AI-penetration-testing-150x150.jpg)](https://zigrin.com/as-an-ai-language-model-please-have-mercy-on-me/)

  ###### [As an AI Language Model, Please Have Mercy on Me](https://zigrin.com/as-an-ai-language-model-please-have-mercy-on-me/)

  September 13, 2023
* [![types of penetration testing](https://zigrin.com/wp-content/uploads/2023/08/types-of-penetration-testing-150x150.jpg)](https://zigrin.com/black-box-vs-grey-box-vs-white-box-which-penetration-test-is-right-for-you/)

  ###### [Black-box vs. Grey-box vs. White-box: Which Penetration Test Is Right for You?](https://zigrin.com/black-box-vs-grey-box-vs-white-box-which-penetration-test-is-right-for-you/)

  August 9, 2023
##### Tags

[AI](https://zigrin.com/tag/ai/)
[backup security](https://zigrin.com/tag/backup-security/)
[Cake PHP security](https://zigrin.com/tag/cake-php-security/)
[centralized logging](https://zigrin.com/tag/centralized-logging/)
[cybersecurity](https://zigrin.com/tag/cybersecurity/)
[cybersecurity for startups](https://zigrin.com/tag/cybersecurity-for-startups/)
[cybersecurity research](https://zigrin.com/tag/cybersecurity-research/)
[data protection solutions](https://zigrin.com/tag/data-protection-solutions/)
[data security](https://zigrin.com/tag/data-security/)
[edge security](https://zigrin.com/tag/edge-security/)
[http security headers](https://zigrin.com/tag/http-security-headers/)
[password mangers](https://zigrin.com/tag/password-mangers/)
[penetration testing](https://zigrin.com/tag/penetration-testing/)
[pentest report](https://zigrin.com/tag/pentest-report/)
[secure containerization](https://zigrin.com/tag/secure-containerization/)
[secure software development](https://zigrin.com/tag/secure-software-development/)
[security patches](https://zigrin.com/tag/security-patches/)
[software development best practices](https://zigrin.com/tag/software-development-best-practices/)
[sse security](https://zigrin.com/tag/sse-security/)
[startup](https://zigrin.com/tag/startup/)
[tips](https://zigrin.com/tag/tips/)
[two-factor authentication](https://zigrin.com/tag/two-factor-authentication/)
[vulnerability patching](https://zigrin.com/tag/vulnerability-patching/)
[web application security](https://zigrin.com/tag/web-application-security/)
[white box](https://zigrin.com/tag/white-box/)
[XSS](https://zigrin.com/tag/xss/)
[![cybersecurity contact](https://zigrin.com/wp-content/uploads/2022/07/cybersecurity-contact-737x1024.png)](https://zigrin.com/contact/)

![](https://zigrin.com/wp-content/uploads/2022/01/logo-zigrin-security-biale-300x135.png)

### contact@zigrin.com

Our mailbox

### [GPG Key](https://zigrin.com/wp-content/uploads/2022/01/gpg.txt)

Contact us securely

* [Home](https://zigrin.com/)
* [Services](https://zigrin.com/services/)
* [Case study](https://zigrin.com/casestudy/)
* [Advisories](https://zigrin.com/advisories/)
* [Career](https://zigrin.com/career/)
* [Security Policy](https://zigrin.com/security-policy/)
* [Privacy Policy](https://zigrin.com/privacy-policy/)
* [Contact](https://zigrin.com/contact/)

Copyright © 2021 Zigrin Security. All Rights Reserved.

[Linkedin-in](https://www.linkedin.com/company/zigrin-security/)

[Github](https://github.com/Zigrin-Security)

We use cookies on our website to give you the most relevant experience by remembering your preferences and repeat visits. By clicking “Accept All”, you consent to the use of ALL the cookies. However, you may visit "Cookie Settings" to provide a controlled consent. Here you can find our [privacy policy](/privacy-policy/) Cookie SettingsAccept AllManage consent

Close

#### Privacy Overview

This website uses cookies to improve your experience while you navigate through the website. Out of these, the cookies that are categorized as necessary are stored on your browser as they are essential for the working of basic functionalities of the website. We also use third-party cookies that help us analyze and understand how you use this website. These cookies will be stored in your browser only with your consent. You also have the option to opt-out of these cookies. But opting out of some of these cookies may affect your browsing experience.

Necessary

Necessary

Always Enabled

Necessary cookies are absolutely essential for the website to function properly. These cookies ensure basic functionalities and security features of the website, anonymously.

| Cookie | Duration | Description |
| --- | --- | --- |
| cookielawinfo-checkbox-analytics | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookie is used to store the user consent for the cookies in the category "Analytics". |
| cookielawinfo-checkbox-functional | 11 months | The cookie is set by GDPR cookie consent to record the user consent for the cookies in the category "Functional". |
| cookielawinfo-checkbox-necessary | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookies is used to store the user consent for the cookies in the category "Necessary". |
| cookielawinfo-checkbox-others | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookie is used to store the user consent for the cookies in the category "Other. |
| cookielawinfo-checkbox-performance | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookie is used to store the user consent for the cookies in the category "Performance". |
| viewed\_cookie\_policy | 11 months | The cookie is set by the GDPR Cookie Consent plugin and is used to store whether or not user has consented to the use of cookies. It does not store any personal data. |

Functional

Functional

Functional cookies help to perform certain functionalities like sharing the content of the website on social media platforms, collect feedbacks, and other third-party features.

Performance

Performance

Performance cookies are used to understand and analyze the key performance indexes of the website which helps in delivering a better user experience for the visitors.

Analytics

Analytics

Analytical cookies are used to understand how visitors interact with the website. These cookies help provide information on metrics the number of visitors, bounce rate, traffic source, etc.

Advertisement

Advertisement

Advertisement cookies are used to provide visitors with relevant ads and marketing campaigns. These cookies track visitors across websites and collect information to provide customized ads.

Others

Others

Other uncategorized cookies are those that are being analyzed and have not been classified into a category as yet.

SAVE & ACCEPT



=== Content from zigrin.com_1e5a78d4_20250114_190314.html ===


* contact@zigrin.com

We are reliable, trustworthy, and ready for challenges! [Hire Us](/contact)

[Linkedin-in](https://www.linkedin.com/company/zigrin-security/)

[Github](https://github.com/Zigrin-Security)

[![Web Application Security Testing](https://zigrin.com/wp-content/uploads/2021/11/logo.png)](https://zigrin.com/)

* Company
  + [About Us](https://zigrin.com/about-us/)
  + [Why Should You Trust Us](https://zigrin.com/why-should-you-trust-us/)
  + [Frequently Asked Questions](https://zigrin.com/faq/)
* [Services](https://zigrin.com/services/)
  + [Web Application Security Testing](https://zigrin.com/services/web-application-security-testing/)
  + [Cybersecurity research](https://zigrin.com/services/cybersecurity-research/)
  + [Network Penetration Testing](https://zigrin.com/services/network-penetration-testing/)
  + [Vulnerability assessment](https://zigrin.com/services/vulnerability-assessment/)
  + [Red Teaming](https://zigrin.com/services/red-teaming/)
  + [Mobile Application Penetration Testing](https://zigrin.com/services/mobile-penetration-testing/)
  + [Source Code Review](https://zigrin.com/services/source-code-review/)
* [Case study](https://zigrin.com/casestudy/)
  + [Critical vulnerability discovered in MISP](https://zigrin.com/case-study/vulnerability-discovery-in-misp/)
  + [Securing company’s main website](https://zigrin.com/case-study/securing-companys-main-website/)
  + [SaaS Penetration Testing Resulting in Closing the Deal](https://zigrin.com/case-study/saas-penetration-testing-resulting-in-closing-the-deal/)
  + [Special delivery for request](https://zigrin.com/case-study/special-delivery-for-request/)
* [Advisories](https://zigrin.com/advisories/)
* [Blog](https://zigrin.com/blog/)
* [Tools](https://zigrin.com/tools/)
  + [Cake Fuzzer](https://zigrin.com/tools/cake-fuzzer/)
  + [HTTP2WebSocket](https://zigrin.com/tools/http2websocket/)
* [Talks](https://zigrin.com/talks/)
* [Contact](https://zigrin.com/contact/)

Search for:

### [Have Any Questions?](https://zigrin.com/contact/)

Contact our expert

[![Web Application Security Testing](https://zigrin.com/wp-content/uploads/2021/11/logo.png)](https://zigrin.com/)

Search for:

* Company
  + [About Us](https://zigrin.com/about-us/)
  + [Why Should You Trust Us](https://zigrin.com/why-should-you-trust-us/)
  + [Frequently Asked Questions](https://zigrin.com/faq/)
* [Services](https://zigrin.com/services/)
  + [Web Application Security Testing](https://zigrin.com/services/web-application-security-testing/)
  + [Cybersecurity research](https://zigrin.com/services/cybersecurity-research/)
  + [Network Penetration Testing](https://zigrin.com/services/network-penetration-testing/)
  + [Vulnerability assessment](https://zigrin.com/services/vulnerability-assessment/)
  + [Red Teaming](https://zigrin.com/services/red-teaming/)
  + [Mobile Application Penetration Testing](https://zigrin.com/services/mobile-penetration-testing/)
  + [Source Code Review](https://zigrin.com/services/source-code-review/)
* [Case study](https://zigrin.com/casestudy/)
  + [Critical vulnerability discovered in MISP](https://zigrin.com/case-study/vulnerability-discovery-in-misp/)
  + [Securing company’s main website](https://zigrin.com/case-study/securing-companys-main-website/)
  + [SaaS Penetration Testing Resulting in Closing the Deal](https://zigrin.com/case-study/saas-penetration-testing-resulting-in-closing-the-deal/)
  + [Special delivery for request](https://zigrin.com/case-study/special-delivery-for-request/)
* [Advisories](https://zigrin.com/advisories/)
* [Blog](https://zigrin.com/blog/)
* [Tools](https://zigrin.com/tools/)
  + [Cake Fuzzer](https://zigrin.com/tools/cake-fuzzer/)
  + [HTTP2WebSocket](https://zigrin.com/tools/http2websocket/)
* [Talks](https://zigrin.com/talks/)
* [Contact](https://zigrin.com/contact/)

[![Web Application Security Testing](https://engitech.s3.amazonaws.com/images/logo.svg)](https://zigrin.com/)

Over 10 years we help companies reach their financial and branding goals. Engitech is a values-driven technology agency dedicated.

#### Gallery

#### Contacts

411 University St, Seattle, USA

engitech@oceanthemes.net

+1 -800-456-478-23

Twitter

Facebook-f

Pinterest-p

Instagram

# MISP – PHAR deserialization

* [Home](https://zigrin.com)
* [Advisories](https://zigrin.com/advisories/)
* MISP – PHAR deserialization

DATE

20.04.2022

Affected Vendor

CIRCL – Computer Incident Response Center Luxembourg

Affected Product

MISP – Open Source Threat Intelligence Platform & Open Standards For Threat Information Sharing – <https://www.misp-project.org/>

Vulnerable version

2.4.157

Fixed version

2.4.158

CVSS

9.8 Critical [CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

Recommendations

Update to MISP version 2.4.158

Vulnerability details

An issue was discovered in MISP before 2.4.158. PHAR deserialization can occur allowing authenticated users to execute code on the MISP operating system.

This vulnerability includes multiple phar deserialization occurrences that could be exploited in various places.

The most dangerous occurrence was fixed in version 2.4.157.

CVE

CVE-2022-29528

Credits

Dawid Czarnecki
Ianis Bernard from NATO Cyber Security Centre

References

* [https://github.com/MISP/MISP/compare/v2.4.157…v2.4.158](https://github.com/MISP/MISP/compare/v2.4.157...v2.4.158)
* <https://github.com/MISP/MISP/commit/0108f1bde2117ac5c1e28d124128f6>
* [https://www.misp-project.org/2022/04/20/MISP.2.4.158.released.html/](https://www.misp-project.org/2022/04/20/MISP.2.4.158.released.html/#announcement-of-a-silent-fix-of-phar-deserialisation-rce-in-a-previous-release-v24156)
* <https://nvd.nist.gov/vuln/detail/CVE-2022-29528>

Do you think the security of your data might be lacking? Let's find the best approach together.
 Once you contact us, we will ask you about the project you want to secure.

## NEED A CONSULTATION?

[Contact Us](https://zigrin.com/contact/)

![](https://zigrin.com/wp-content/uploads/2022/01/logo-zigrin-security-biale-300x135.png)

### contact@zigrin.com

Our mailbox

### [GPG Key](https://zigrin.com/wp-content/uploads/2022/01/gpg.txt)

Contact us securely

* [Home](https://zigrin.com/)
* [Services](https://zigrin.com/services/)
* [Case study](https://zigrin.com/casestudy/)
* [Advisories](https://zigrin.com/advisories/)
* [Career](https://zigrin.com/career/)
* [Security Policy](https://zigrin.com/security-policy/)
* [Privacy Policy](https://zigrin.com/privacy-policy/)
* [Contact](https://zigrin.com/contact/)

Copyright © 2021 Zigrin Security. All Rights Reserved.

[Linkedin-in](https://www.linkedin.com/company/zigrin-security/)

[Github](https://github.com/Zigrin-Security)

We use cookies on our website to give you the most relevant experience by remembering your preferences and repeat visits. By clicking “Accept All”, you consent to the use of ALL the cookies. However, you may visit "Cookie Settings" to provide a controlled consent. Here you can find our [privacy policy](/privacy-policy/) Cookie SettingsAccept AllManage consent

Close

#### Privacy Overview

This website uses cookies to improve your experience while you navigate through the website. Out of these, the cookies that are categorized as necessary are stored on your browser as they are essential for the working of basic functionalities of the website. We also use third-party cookies that help us analyze and understand how you use this website. These cookies will be stored in your browser only with your consent. You also have the option to opt-out of these cookies. But opting out of some of these cookies may affect your browsing experience.

Necessary

Necessary

Always Enabled

Necessary cookies are absolutely essential for the website to function properly. These cookies ensure basic functionalities and security features of the website, anonymously.

| Cookie | Duration | Description |
| --- | --- | --- |
| cookielawinfo-checkbox-analytics | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookie is used to store the user consent for the cookies in the category "Analytics". |
| cookielawinfo-checkbox-functional | 11 months | The cookie is set by GDPR cookie consent to record the user consent for the cookies in the category "Functional". |
| cookielawinfo-checkbox-necessary | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookies is used to store the user consent for the cookies in the category "Necessary". |
| cookielawinfo-checkbox-others | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookie is used to store the user consent for the cookies in the category "Other. |
| cookielawinfo-checkbox-performance | 11 months | This cookie is set by GDPR Cookie Consent plugin. The cookie is used to store the user consent for the cookies in the category "Performance". |
| viewed\_cookie\_policy | 11 months | The cookie is set by the GDPR Cookie Consent plugin and is used to store whether or not user has consented to the use of cookies. It does not store any personal data. |

Functional

Functional

Functional cookies help to perform certain functionalities like sharing the content of the website on social media platforms, collect feedbacks, and other third-party features.

Performance

Performance

Performance cookies are used to understand and analyze the key performance indexes of the website which helps in delivering a better user experience for the visitors.

Analytics

Analytics

Analytical cookies are used to understand how visitors interact with the website. These cookies help provide information on metrics the number of visitors, bounce rate, traffic source, etc.

Advertisement

Advertisement

Advertisement cookies are used to provide visitors with relevant ads and marketing campaigns. These cookies track visitors across websites and collect information to provide customized ads.

Others

Others

Other uncategorized cookies are those that are being analyzed and have not been classified into a category as yet.

SAVE & ACCEPT



=== Content from github.com_a1cedf7c_20250114_190306.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP%2Fcommit%2F93821c0de6a7dd32262ce62212773f43136ca66e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP%2Fcommit%2F93821c0de6a7dd32262ce62212773f43136ca66e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=MISP%2FMISP)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[MISP](/MISP)
/
**[MISP](/MISP/MISP)**
Public

* [Notifications](/login?return_to=%2FMISP%2FMISP) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2FMISP%2FMISP)
* [Star
   5.5k](/login?return_to=%2FMISP%2FMISP)

* [Code](/MISP/MISP)
* [Issues
  2.5k](/MISP/MISP/issues)
* [Pull requests
  89](/MISP/MISP/pulls)
* [Discussions](/MISP/MISP/discussions)
* [Actions](/MISP/MISP/actions)
* [Projects
  1](/MISP/MISP/projects)
* [Wiki](/MISP/MISP/wiki)
* [Security](/MISP/MISP/security)
* [Insights](/MISP/MISP/pulse)

Additional navigation options

* [Code](/MISP/MISP)
* [Issues](/MISP/MISP/issues)
* [Pull requests](/MISP/MISP/pulls)
* [Discussions](/MISP/MISP/discussions)
* [Actions](/MISP/MISP/actions)
* [Projects](/MISP/MISP/projects)
* [Wiki](/MISP/MISP/wiki)
* [Security](/MISP/MISP/security)
* [Insights](/MISP/MISP/pulse)

## Commit

[Permalink](/MISP/MISP/commit/93821c0de6a7dd32262ce62212773f43136ca66e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: [security] Sanitise paths for several file interactions

[Browse files](/MISP/MISP/tree/93821c0de6a7dd32262ce62212773f43136ca66e)
Browse the repository at this point in the history

```
- remove :// anywhere we don't expect a protocol to be supplied
- remove phar:// in certauth plugin's fetcher

- as reported by Dawid Czarnecki of Zigrin Security
```

* Loading branch information

[![@iglocska](https://avatars.githubusercontent.com/u/3668672?s=40&v=4)](/iglocska)

[iglocska](/MISP/MISP/commits?author=iglocska "View all commits by iglocska")
committed
Apr 17, 2022

1 parent
[0108f1b](/MISP/MISP/commit/0108f1bde2117ac5c1e28d124128f60c8bb09a8e)

commit 93821c0

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**256 additions**
and
**252 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app

  + Model

    - app/Model/AppModel.php
      [AppModel.php](#diff-f5612e5237fac98d81298f75cf21487e0930c39f1ded9da2f44eaf520f6957fc)
    - app/Model/Feed.php
      [Feed.php](#diff-5cefe591146fbe1d1a50c25b06ab06232d0269b53cdfe8a72527fa6e3f2e1191)
  + Plugin/CertAuth/Controller/Component/Auth

    - app/Plugin/CertAuth/Controller/Component/Auth/CertificateAuthenticate.php
      [CertificateAuthenticate.php](#diff-269f40a3d67a5b727d01ed2d441fd273cfd713b63348b53363bb89ce7ccf6952)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[app/Model/AppModel.php](#diff-f5612e5237fac98d81298f75cf21487e0930c39f1ded9da2f44eaf520f6957fc "app/Model/AppModel.php")

Show comments

[View file](/MISP/MISP/blob/93821c0de6a7dd32262ce62212773f43136ca66e/app/Model/AppModel.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2588,6 +2588,7 @@ public function getKafkaPubTool() |
|  |  | App::uses('KafkaPubTool', 'Tools'); |
|  |  | $kafkaPubTool = new KafkaPubTool(); |
|  |  | $rdkafkaIni = Configure::read('Plugin.Kafka\_rdkafka\_config'); |
|  |  | $rdkafkaIni = mb\_ereg\_replace("/\:\/\//", '', $rdkafkaIni); |
|  |  | $kafkaConf = array(); |
|  |  | if (!empty($rdkafkaIni)) { |
|  |  | $kafkaConf = parse\_ini\_file($rdkafkaIni); |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[app/Model/Feed.php](#diff-5cefe591146fbe1d1a50c25b06ab06232d0269b53cdfe8a72527fa6e3f2e1191 "app/Model/Feed.php")

Show comments

[View file](/MISP/MISP/blob/93821c0de6a7dd32262ce62212773f43136ca66e/app/Model/Feed.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -126,12 +126,13 @@ public function validateInputSource($fields) |
|  |  | public function urlOrExistingFilepath($fields) |
|  |  | { |
|  |  | if ($this->isFeedLocal($this->data)) { |
|  |  | $path = mb\_ereg\_replace("/\:\/\//", '', $this->data['Feed']['url']); |
|  |  | if ($this->data['Feed']['source\_format'] == 'misp') { |
|  |  | if (!is\_dir($this->data['Feed']['url'])) { |
|  |  | if (!is\_dir($path)) { |
|  |  | return 'For MISP type local feeds, please specify the containing directory.'; |
|  |  | } |
|  |  | } else { |
|  |  | if (!file\_exists($this->data['Feed']['url'])) { |
|  |  | if (!file\_exists($path)) { |
|  |  | return 'Invalid path or file not found. Make sure that the path points to an existing file that is readable and watch out for typos.'; |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -1929,6 +1930,7 @@ private function downloadAndParseEventFromFeed($feed, $eventUuid, HttpSocket $Ht |
|  |  | private function feedGetUri($feed, $uri, HttpSocket $HttpSocket = null) |
|  |  | { |
|  |  | if ($this->isFeedLocal($feed)) { |
|  |  | $uri = mb\_ereg\_replace("/\:\/\//", '', $uri); |
|  |  | if (file\_exists($uri)) { |
|  |  | return FileAccessTool::readFromFile($uri); |
|  |  | } else { |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `93821c0`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FMISP%2FMISP%2Fcommit%2F93821c0de6a7dd32262ce62212773f43136ca66e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


