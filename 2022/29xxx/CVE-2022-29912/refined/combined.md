=== Content from www.mozilla.org_6cb0cbee_20250115_090733.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-18

## Security Vulnerabilities fixed in Thunderbird 91.9

Announced
May 3, 2022
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 91.9

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2022-1520: Incorrect security status shown after viewing an attached email](#CVE-2022-1520)

Reporter
Thunderbird team
Impact
low
##### Description

When viewing an email message A, which contains an attached message B, where B is encrypted or digitally signed or both, Thunderbird may show an incorrect encryption or signature status. After opening and viewing the attached message B, when returning to the display of message A, the message A might be shown with the security status of message B.

##### References

* [Bug 1745019](https://bugzilla.mozilla.org/show_bug.cgi?id=1745019)

#### [#CVE-2022-29914: Fullscreen notification bypass using popups](#CVE-2022-29914)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When reusing existing popups Thunderbird would allow them to cover the fullscreen notification UI, which could enable browser spoofing attacks.

##### References

* [Bug 1746448](https://bugzilla.mozilla.org/show_bug.cgi?id=1746448)

#### [#CVE-2022-29909: Bypassing permission prompt in nested browsing contexts](#CVE-2022-29909)

Reporter
Armin Ebert
Impact
high
##### Description

Documents in deeply-nested cross-origin browsing contexts could obtain permissions granted to the top-level origin, bypassing the existing prompt and wrongfully inheriting the top-level permissions.

##### References

* [Bug 1755081](https://bugzilla.mozilla.org/show_bug.cgi?id=1755081)

#### [#CVE-2022-29916: Leaking browser history with CSS variables](#CVE-2022-29916)

Reporter
Mateusz Sionkowski
Impact
high
##### Description

Thunderbird would behave slightly differently for already known resources, when loading CSS resources through resolving CSS variables. This could be used to probe the browser history.

##### References

* [Bug 1760674](https://bugzilla.mozilla.org/show_bug.cgi?id=1760674)

#### [#CVE-2022-29911: iframe sandbox bypass](#CVE-2022-29911)

Reporter
Trung Pham
Impact
high
##### Description

An improper implementation of the new iframe sandbox keyword `allow-top-navigation-by-user-activation` could lead to script execution without `allow-scripts` being present.

##### References

* [Bug 1761981](https://bugzilla.mozilla.org/show_bug.cgi?id=1761981)

#### [#CVE-2022-29912: Reader mode bypassed SameSite cookies](#CVE-2022-29912)

Reporter
Matheus Vrech
Impact
moderate
##### Description

Requests initiated through reader mode did not properly omit cookies with a SameSite attribute.

##### References

* [Bug 1692655](https://bugzilla.mozilla.org/show_bug.cgi?id=1692655)

#### [#CVE-2022-29913: Speech Synthesis feature not properly disabled](#CVE-2022-29913)

Reporter
Andrew McCreight
Impact
moderate
##### Description

The parent process would not properly check whether the Speech Synthesis feature is enabled, when receiving instructions from a child process.

##### References

* [Bug 1764778](https://bugzilla.mozilla.org/show_bug.cgi?id=1764778)

#### [#CVE-2022-29917: Memory safety bugs fixed in Thunderbird 91.9](#CVE-2022-29917)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Gabriele Svelto, Tom Ritter and the Mozilla Fuzzing Team reported memory safety bugs present in Thunderbird 91.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 91.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1684739%2C1706441%2C1753298%2C1762614%2C1762620)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_affb0dd0_20250115_090732.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-17

## Security Vulnerabilities fixed in Firefox ESR 91.9

Announced
May 3, 2022
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 91.9

#### [#CVE-2022-29914: Fullscreen notification bypass using popups](#CVE-2022-29914)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When reusing existing popups Firefox would have allowed them to cover the fullscreen notification UI, which could have enabled browser spoofing attacks.

##### References

* [Bug 1746448](https://bugzilla.mozilla.org/show_bug.cgi?id=1746448)

#### [#CVE-2022-29909: Bypassing permission prompt in nested browsing contexts](#CVE-2022-29909)

Reporter
Armin Ebert
Impact
high
##### Description

Documents in deeply-nested cross-origin browsing contexts could have obtained permissions granted to the top-level origin, bypassing the existing prompt and wrongfully inheriting the top-level permissions.

##### References

* [Bug 1755081](https://bugzilla.mozilla.org/show_bug.cgi?id=1755081)

#### [#CVE-2022-29916: Leaking browser history with CSS variables](#CVE-2022-29916)

Reporter
Mateusz Sionkowski
Impact
high
##### Description

Firefox behaved slightly differently for already known resources when loading CSS resources involving CSS variables. This could have been used to probe the browser history.

##### References

* [Bug 1760674](https://bugzilla.mozilla.org/show_bug.cgi?id=1760674)

#### [#CVE-2022-29911: iframe Sandbox bypass](#CVE-2022-29911)

Reporter
Trung Pham
Impact
high
##### Description

An improper implementation of the new iframe sandbox keyword `allow-top-navigation-by-user-activation` could lead to script execution without `allow-scripts` being present.

##### References

* [Bug 1761981](https://bugzilla.mozilla.org/show_bug.cgi?id=1761981)

#### [#CVE-2022-29912: Reader mode bypassed SameSite cookies](#CVE-2022-29912)

Reporter
Matheus Vrech
Impact
moderate
##### Description

Requests initiated through reader mode did not properly omit cookies with a SameSite attribute.

##### References

* [Bug 1692655](https://bugzilla.mozilla.org/show_bug.cgi?id=1692655)

#### [#CVE-2022-29917: Memory safety bugs fixed in Firefox 100 and Firefox ESR 91.9](#CVE-2022-29917)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Andrew McCreight, Gabriele Svelto, Tom Ritter and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 99 and Firefox ESR 91.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 100 and Firefox ESR 91.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1684739%2C1706441%2C1753298%2C1762614%2C1762620%2C1764778)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_bbc5fff1_20250115_090730.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1692655)
* [XML](/show_bug.cgi?ctype=xml&id=1692655)

Closed
[Bug 1692655](/show_bug.cgi?id=1692655)
(CVE-2022-29912)

Opened 4 years ago
Closed 3 years ago

# SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect

## Categories

### (Toolkit :: Reader Mode, defect, P2)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Reader%20Mode#Reader%20Mode)

Reader Mode
▾

Toolkit :: Reader Mode
The component for displaying pages in a special reader mode. Includes about:reader page and Readability article-parsing library.
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Reader%20Mode&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Reader%20Mode&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Reader%20Mode)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Desktop

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S4

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

100 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr78 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix) |
| firefox-esr91 | [100+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=100%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=verified) |
| firefox85 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=wontfix) |
| firefox86 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=wontfix) |
| firefox87 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=wontfix) |
| firefox88 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=wontfix) |
| firefox98 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=wontfix) |
| firefox99 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox99&o1=equals&v1=wontfix) |
| firefox100 | [+](/buglist.cgi?f1=cf_tracking_firefox100&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr78 |  | wontfix |
| firefox-esr91 | 100+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox85 |  | wontfix |
| firefox86 |  | wontfix |
| firefox87 |  | wontfix |
| firefox88 |  | wontfix |
| firefox98 |  | wontfix |
| firefox99 |  | wontfix |
| firefox100 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: whoismath, Assigned: Gijs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/f7f1cd76380018fa42fdbfe35b9367c3?d=mm&size=40)  [whoismath](/user_profile?user_id=648941)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

### ( [URL](https://abrasax.club/readcookie.html "https://abrasax.club/readcookie.html") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1760602](/show_bug.cgi?id=1760602 "RESOLVED FIXED - Land tests for reader mode samesite cookie redirect issue")

Dependency [tree](/showdependencytree.cgi?id=1692655&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1692655)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1692654](/show_bug.cgi?id=1692654 "RESOLVED DUPLICATE - SameSite cookie Reader View bypass")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[abrasax.club/readcookie.html](https://abrasax.club/readcookie.html "https://abrasax.club/readcookie.html")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, sec-moderate, Whiteboard: [reporter-external] [client-bounty-form][post-critsmash-triage][adv-main100+][adv-esr91.9+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-29912

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form][post-critsmash-triage][adv-main100+][adv-esr91.9+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a26312038_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 1 obsolete file)

| [files.zip](/attachment.cgi?id=9203028)  [4 years ago](#c1)  [Matheus Vrech](/user_profile?user_id=648941)   1.50 KB, application/zip |  | [Details](/attachment.cgi?id=9203028&action=edit) |
| --- | --- | --- |
| [Bug 1692655 - ensure loading reader mode in windows with an opener relationship creates a new BC, r?nika](/attachment.cgi?id=9243812)  [3 years ago](#c25)  [:Gijs (he/him)](/user_profile?user_id=159069)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9243812&action=edit) | [Review](/attachment.cgi?id=9243812) |
| [Bug 1692655, r?nika!,mtigley!](/attachment.cgi?id=9268258)  [3 years ago](#c39)  [:Gijs (he/him)](/user_profile?user_id=159069)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9268258&action=edit) | [Review](/attachment.cgi?id=9268258) |
| [Bug 1692655 - tests, r?mtigley](/attachment.cgi?id=9268259)  [3 years ago](#c40)  [:Gijs (he/him)](/user_profile?user_id=159069)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9268259&action=edit) | [Review](/attachment.cgi?id=9268259) |
| [Bug 1692655 - esr](/attachment.cgi?id=9273705)  [3 years ago](#c52)  [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-esr91+](#c54 "3 years ago") | [Details](/attachment.cgi?id=9273705&action=edit) | [Review](/attachment.cgi?id=9273705) |
| [advisory.txt](/attachment.cgi?id=9274258)  [3 years ago](#c57)  [Frederik Braun [:freddy]](/user_profile?user_id=428608)   152 bytes, text/plain |  | [Details](/attachment.cgi?id=9274258&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1692655#c0)• 4 years ago |
|  | |

User Agent: Mozilla/5.0 (X11; Linux x86\_64; rv:85.0) Gecko/20100101 Firefox/85.0

Steps to reproduce:

1. Go to <https://abrasax.club/readcookie.html>
2. Click anywhere in the page to open another tab.
3. Click in Reader View icon.
4. Wait 15 seconds until the new tab is redirected to about:blank
5. Wait 4 seconds more to be redirected back to Reader View.
6. Reader View will render meta redirect page and SameSite cookie will be bypassed.

Actual results:

SameSite cookie is sent when Reader View is reloaded with a meta redirect.

Expected results:

SameSite cookie not sent.

Flags: sec-bounty?

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1692655#c1)• 4 years ago |
|  | |

Attached file
[files.zip](attachment.cgi?id=9203028)
— [Details](attachment.cgi?id=9203028&action=edit)

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1692655#c2)• 4 years ago |
|  | |

Sorry, i forgot to tell to open <https://poc.dup.house/pocs/setcookie.php> to set samesite cookie before the first step

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1692655#c4)• 4 years ago |
|  | |

I see "not working :(" rendered in reader mode (tested with 86 beta, having opened both the cookie setting and reading pages in the same private browsing window), so it doesn't seem to work for me.

It'd help if you described in more detail:

* what the role of each of the 3-4 pages involved is
* why reader mode matters here
* what page is supposed to meta redirect to what
* why the exploit needs the history manipulation on the opened webpage
Flags: needinfo?(whoismath)

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1692655#c5)• 4 years ago |
|  | |

Hi Gijs, I'm sorry about the duplicate. I think I double-clicked the submission form. I just tested this issue in Firefox Nightly 87.0a1 (2021-02-11) (64-bit) for archlinux, and it seems to be working. I also tested Firefox 85.0.2 in Windows, and it worked too. In order to make it clear, I also annexed a video to this report.

The attack relies upon the fact that if you have a page "victim.com" with a SameSite cookies set, and then open the attacker's page containing a meta redirect to victim.com on Reader View, if you reload the page inside the Reader View, you get redirected to "victim.com", which sends the request with the user's cookies (including the cookies with SameSIte=Strict).

* what the role of each of the 3-4 pages involved is

  The first page (<https://abrasax.club/readcookie.html>) is the attacker-controlled website containing the meta redirect and Reader Mode available. The page (<http://poc.dup.house/pocs/samesite.php>) is the targeted page with SameSite cookies defined. The goal is to trick the user into opening <https://abrasax.club/readcookie.html> in Reader View, then I reload (or wait for the user to do it by himself). When it happens, the request is sent with the SameSite cookies.
* why reader mode matters here:

  Reader Mode matters because the bug seems to rely on the fact that if you open a page with meta refresh on Reader Mode and reload it inside the Reader Mode, the page is redirected to the meta tag page, and the request is sent with the SameSite cookies.
* what page is supposed to meta redirect to what

  In this scenario, the attacker's page redirects the user with a meta redirect to the targeted page (<http://poc.dup.house/pocs/samesite.php>), which has SameSite cookies defined and should not be sent. If you wait for 50 seconds, as defined in <https://abrasax.club/readcookie.html> meta redirect: meta http-equiv="refresh" content="50; url=[https://poc.dup.house/pocs/samesite.php">](https://poc.dup.house/pocs/samesite.php%22%3E) You should see a message saying: not working, since the SameSite cookie won't be sent. But when you open this page in reader mode and reload the page with Ctrl + R you get the message "same site policy bypassed".
* why the exploit needs the history manipulation on the opened webpage

  This isn't strictly needed. But since the bug occurs when the user reloads the page in Firefox Reader View, I manipulated the history to automate this stage in the PoC, so it wouldn't be necessary further user interaction to do it.
Flags: needinfo?(whoismath)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1692655#c6)• 4 years ago |
|  | |

OK, I tried again and this time reproduction worked - not entirely sure why it didn't work before. I can't see a video - did you mean to attach one or link to one?

I'm a bit skeptical about what this can be used for - you cannot extract any content this way (you have no access to the reader mode page / document as it's not same origin), and reader mode only does GET requests, so I'm not sure how you'd abuse the samesite cookie presence, in addition to needing the user to enter reader mode? But perhaps I'm not creative enough... :-)

I'm also not 100% sure how to fix this. Christoph, when reader mode is invoked without a document but with just a URL, it has to fetch the content itself. It's using XHR for that (in order to parse the returned HTML doc) and [manually follows meta redirects](https://searchfox.org/mozilla-central/rev/951a0342d600a1db263cac35ac85dbd4b3305aeb/toolkit/components/reader/ReaderMode.jsm#296). Is there some way we can communicate to the second XHR that is following the meta redirect, ie that it's a redirect chain, such that we wouldn't send samesite cookies?

I'm also curious if we could just stop history navigation for cross-protocol principals (ie if `https://example.com/` may not link to `file:///` or `about:reader?...` or `chrome://...` then using `windowRef.history.back()` or whatever to navigate there also seems like it should be disallowed)... on the one hand that is more generic, on the other the benefit is probably limited in practice (ie there's not a lot of other cases where that restriction would make a difference, though it'd make some user-interaction-required attacks harder to execute). Anne, thoughts on that?

Status: UNCONFIRMED → NEWType: task → defect
[status-firefox85](/buglist.cgi?f1=cf_status_firefox85&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox85&o1=equals&v1=wontfix)
[status-firefox86](/buglist.cgi?f1=cf_status_firefox86&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox86&o1=equals&v1=wontfix)
[status-firefox87](/buglist.cgi?f1=cf_status_firefox87&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=affected)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=%3F)Component: Security → Reader ModeEver confirmed: trueFlags: needinfo?(ckerschb)Flags: needinfo?(annevk)OS: Unspecified → AllProduct: Firefox → ToolkitHardware: Unspecified → DesktopSummary: SameSite cookie Reader View bypass → SameSite cookie bypass when using history navigation via a window reference to reload reader mode page

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a33702_159069)• 4 years ago |

Summary: SameSite cookie bypass when using history navigation via a window reference to reload reader mode page → SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1692655#c7)• 4 years ago |
|  | |

Hi Gijs, the attack scenario would be to exploit Cross Site Request Forgery in websites that implements samesite cookies in strict mode. By the way, about the video, I couldn't upload it here due to the size, can i create a private link on youtube?

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1692655#c8)• 4 years ago |
|  | |

(In reply to Matheus Vrech from [comment #7](/show_bug.cgi?id=1692655#c7 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Hi Gijs, the attack scenario would be to exploit Cross Site Request Forgery in websites that implements samesite cookies in strict mode.

A CSRF on a GET request, which is only secured against by using samesite cookies? That feels like it has other issues... (do people just not use CSRF tokens, or at least use POST/PUT/DELETE for operations that modify state, origin verification, custom request headers, or any other [defense mechanisms](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html) anymore?). Older versions of IE, Edge, android webview, and even current Safari all have incomplete support for the SameSite attribute... :-(

> By the way, about the video, I couldn't upload it here due to the size, can i create a private link on youtube?

Yes, that should be fine.

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1692655#c9)• 4 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #8](/show_bug.cgi?id=1692655#c8 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> (In reply to Matheus Vrech from [comment #7](/show_bug.cgi?id=1692655#c7 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))
>
> > Hi Gijs, the attack scenario would be to exploit Cross Site Request Forgery in websites that implements samesite cookies in strict mode.
>
> A CSRF on a GET request, which is only secured against by using samesite cookies? That feels like it has other issues... (do people just not use CSRF tokens, or at least use POST/PUT/DELETE for operations that modify state, origin verification, custom request headers, or any other [defense mechanisms](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html) anymore?). Older versions of IE, Edge, android webview, and even current Safari all have incomplete support for the SameSite attribute... :-(
>
> > By the way, about the video, I couldn't upload it here due to the size, can i create a private link on youtube?
>
> Yes, that should be fine.

video poc: <https://youtu.be/cVz2XgrXcjA>

Although people should use other methods to protect against CSRF I don't think we should just rely on that and ignore that this is still a samesite strict bypass. Samesite cookies is becoming an important protection against CSRF attacks and we should secure it well. I also disagree that we should consider it less important or lower due to other browsers implementations since Firefox has a well-working implementation and some people may be relying on it.

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1692655#c10)• 4 years ago |
|  | |

Yeah, I think isolating history more makes a lot of sense. We've had some discussion about this in <https://github.com/whatwg/html/issues/6356> with regards to explicit user navigations and entering reader view should definitely count as well I think. We might also want to enforce the internal equivalent of COOP for reader view so once something goes into that view it appears closed to anyone who had a reference to that window.

(Adding Steven, since this is about cookies.)

Flags: needinfo?(annevk)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1692655#c11)• 4 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #6](/show_bug.cgi?id=1692655#c6 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> I'm also not 100% sure how to fix this. Christoph, when reader mode is invoked without a document but with just a URL, it has to fetch the content itself. It's using XHR for that (in order to parse the returned HTML doc) and [manually follows meta redirects](https://searchfox.org/mozilla-central/rev/951a0342d600a1db263cac35ac85dbd4b3305aeb/toolkit/components/reader/ReaderMode.jsm#296). Is there some way we can communicate to the second XHR that is following the meta redirect, ie that it's a redirect chain, such that we wouldn't send samesite cookies?

The same-site cookie code checks for cross-origin redirects within [IsSameSiteForeign](https://searchfox.org/mozilla-central/source/netwerk/cookie/CookieCommons.cpp#544-558). So we could potentially query the loadinfo from the XHR request and fake a redirectEntry using `loadinfo->appendRedirectHistoryEntry()` so that `IsSameSiteForeign` can do it's job. I guess that could work.

Flags: needinfo?(ckerschb)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1692655#c12)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1692655&comment_id=15267620 "2 revisions") |
|  | |

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #11](/show_bug.cgi?id=1692655#c11 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> (In reply to :Gijs (he/him) from [comment #6](/show_bug.cgi?id=1692655#c6 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))
>
> > I'm also not 100% sure how to fix this. Christoph, when reader mode is invoked without a document but with just a URL, it has to fetch the content itself. It's using XHR for that (in order to parse the returned HTML doc) and [manually follows meta redirects](https://searchfox.org/mozilla-central/rev/951a0342d600a1db263cac35ac85dbd4b3305aeb/toolkit/components/reader/ReaderMode.jsm#296). Is there some way we can communicate to the second XHR that is following the meta redirect, ie that it's a redirect chain, such that we wouldn't send samesite cookies?
>
> The same-site cookie code checks for cross-origin redirects within [IsSameSiteForeign](https://searchfox.org/mozilla-central/source/netwerk/cookie/CookieCommons.cpp#544-558). So we could potentially query the loadinfo from the XHR request and fake a redirectEntry using `loadinfo->appendRedirectHistoryEntry()` so that `IsSameSiteForeign` can do it's job. I guess that could work.

Doesn't look like there are any JS consumers that create `nsIRedirectHistoryEntry` instances outside of tests. How safe is creating a JS "mock" one - `nsIRedirectHistoryEntry` isn't marked as builtinclass, but it feels pretty scary to pass a (mainthread only) JS thing into an API like that to leave it attached to the loadinfo and just hope nobody touches it away from the main thread... am I missing something?

Edit: also, what does "internal" [redirect] in the code comment at <https://searchfox.org/mozilla-central/rev/a23e65c5d69a821f61d14c8ec1f69a120e3f77d1/netwerk/base/nsILoadInfo.idl#852> mean?

Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1692655#c13)• 4 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #12](/show_bug.cgi?id=1692655#c12 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Doesn't look like there are any JS consumers that create `nsIRedirectHistoryEntry` instances outside of tests. How safe is creating a JS "mock" one - `nsIRedirectHistoryEntry` isn't marked as builtinclass, but it feels pretty scary to pass a (mainthread only) JS thing into an API like that to leave it attached to the loadinfo and just hope nobody touches it away from the main thread... am I missing something?

Yeah that is true and probably is, as you said, scary. We could always add an additional bit on the loadinfo, something like `treatAsForeign` and then update `IsSameSiteForeign` to account for it.

> Edit: also, what does "internal" [redirect] in the code comment at <https://searchfox.org/mozilla-central/rev/a23e65c5d69a821f61d14c8ec1f69a120e3f77d1/netwerk/base/nsILoadInfo.idl#852> mean?

Internal redirects are e.g in case of CSP `upgrade-insecure-requests` or also `HSTS` - basically everything that is implementation specific to Firefox. In contrast a `302 redirect` is an actual redirect caused by a web server.

Flags: needinfo?(ckerschb)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1692655#c14)• 4 years ago |
|  | |

I'll try to find time for at least the fix from [comment #11](/show_bug.cgi?id=1692655#c11 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect") / [comment #13](/show_bug.cgi?id=1692655#c13 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect") in the coming cycle, but it's tricky with proton at the same time.

(In reply to Anne (:annevk) from [comment #10](/show_bug.cgi?id=1692655#c10 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Yeah, I think isolating history more makes a lot of sense. We've had some discussion about this in <https://github.com/whatwg/html/issues/6356> with regards to explicit user navigations and entering reader view should definitely count as well I think. We might also want to enforce the internal equivalent of COOP for reader view so once something goes into that view it appears closed to anyone who had a reference to that window.

What is "the internal equivalent of COOP" right now and how would I do that? That is, is the "make this window appear closed and immutable to a caller" mechanism already available in DOM code?

Assignee: nobody → gijskruitbosch+bugsStatus: NEW → ASSIGNEDFlags: needinfo?(annevk)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1692655#c15)• 4 years ago |
|  | |

Tom can probably answer that question (see [comment 14](/show_bug.cgi?id=1692655#c14 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect")).

Flags: needinfo?(annevk) → needinfo?(ttung)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a401754_1689)• 4 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Tom Tung [:tt, :ttung]](/user_profile?user_id=552411) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1692655#c16)• 4 years ago |
|  | |

Hmm, I don't know if the "make this window appear closed and immutable to a caller" mechanism already available in DOM code and where it is? So, redirect this question to Nika.

In COOP and COEP, we isolate windows by putting them into different BrowsingContext/document groups to restrict the access if it's needed.

Flags: needinfo?(ttung) → needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1692655#c17)• 4 years ago |
|  | |

Unfortunately we probably don't want to use the exact same strategy we use for COOP with about:reader tabs right now. When switching into and out of about:reader, we currently have some optimizations which traverse session history instead of performing a fresh load, which means that when viewing an about:reader page, the original page is likely in the bfcache, and after leaving the about:reader page, it probably ends up in the bfcache and can be quickly re-opened. Until the bfcache-fission rework in [bug 1671510](/show_bug.cgi?id=1671510 "NEW - [meta] Make BFCache work for Fission") is ready, and we switch to SHIP everywhere, bfcache is disabled for navigations which switch BrowsingContexts, and exiting or entering reader-mode would always lead to a fresh load.

We could potentially avoid the worst of this by only performing a COOP-like load if the about:reader tab has opener relationships, so we would keep bfcache in the majority of cases where no opener relationships are present.

(In reply to :Gijs (he/him) from [comment #14](/show_bug.cgi?id=1692655#c14 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> What is "the internal equivalent of COOP" right now and how would I do that? That is, is the "make this window appear closed and immutable to a caller" mechanism already available in DOM code?

It's handled as part of how we perform potentially-process-switching navigations in `DocumentLoadListener`, during the `MaybeTriggerProcessSwitch` function. If we wanted to do a replace-load for about:reader tabs which share a BCG, it'd probably end up looking something like this (untested):

```
diff --git a/netwerk/ipc/DocumentLoadListener.cpp b/netwerk/ipc/DocumentLoadListener.cpp
index 25acb263d48bf..b03f0ad2dc725 100644
--- a/netwerk/ipc/DocumentLoadListener.cpp
+++ b/netwerk/ipc/DocumentLoadListener.cpp
@@ -1584,6 +1584,23 @@ bool DocumentLoadListener::MaybeTriggerProcessSwitch(
     }
   }

+  // If loading an about:reader page in a BrowsingContext which shares a
+  // BrowsingContextGroup with other toplevel documents, replace the
+  // BrowsingContext to destroy any references.
+  //
+  // FIXME: Ideally we'd do this for all loads to or from about:reader
+  // documents, but we limit it to documents with opener relationships for now
+  // to avoid unnecessary bfcache evictions. Once SHIP bfcache is complete, we
+  // should change this.
+  if (!parentWindow && browsingContext->Group()->Toplevels().Length() > 1) {
+    nsAutoCString filePath;
+    if (resultPrincipal->SchemeIs("about") &&
+        NS_SUCCEEDED(resultPrincipal->GetFilePath(filePath)) &&
+        filePath == "reader"_ns) {
+      replaceBrowsingContext = true;
+    }
+  }
+
   LOG(
       ("DocumentLoadListener GetRemoteTypeForPrincipal "
        "[this=%p, contentParent=%s, preferredRemoteType=%s]",

```
Flags: needinfo?(nika)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1692655#c18)• 4 years ago |
|  | |

I have been absolutely swamped with other work, so I haven't gotten to this yet. I hope to have time sometime in the next month.

Severity: -- → S4
[status-firefox87](/buglist.cgi?f1=cf_status_firefox87&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox87&o1=equals&v1=wontfix)
[status-firefox88](/buglist.cgi?f1=cf_status_firefox88&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=affected)Priority: -- → P2

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1692655#c19)• 3 years ago |
|  | |

Hey, friendly ping!

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1692655#c20)• 3 years ago |
|  | |

(In reply to Matheus Vrech from [comment #19](/show_bug.cgi?id=1692655#c19 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Hey, friendly ping!

Yeah, I'm very sorry, the delay here has been ridiculous. This has been on my list but it keeps getting bumped...

I was OOO last week and I'm about to go out of office on Friday for another 2 weeks though, and I doubt I'm going to be able to squeeze this in today or tomorrow, either. Hopefully later in September, unless someone on the DOM team has more availability - the fix will need to live mostly in the DOM/loadinfo code, with probably a line or 2 of JS in the about:reader code to invoke the right API. Nika? :-(

Flags: needinfo?(nika)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1692655#c21)• 3 years ago |
|  | |

(In reply to Matheus Vrech from [comment #0](/show_bug.cgi?id=1692655#c0 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> User Agent: Mozilla/5.0 (X11; Linux x86\_64; rv:85.0) Gecko/20100101 Firefox/85.0
>
> Steps to reproduce:
>
> 1. Go to <https://abrasax.club/readcookie.html>

FWIW, the https site no longer loads in either chrome or Firefox (Firefox says SSL\_ERROR\_RX\_RECORD\_TOO\_LONG, Chrome says "ERR\_SSL\_PROTOCOL\_ERROR"). The http version says:

```
404

NotFoundError: Not Found
    at /src/dist/app.js:181:33
    at Layer.handle [as handle_request] (/src/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/src/node_modules/express/lib/router/index.js:317:13)
    at /src/node_modules/express/lib/router/index.js:284:7
    at Function.process_params (/src/node_modules/express/lib/router/index.js:335:12)
    at next (/src/node_modules/express/lib/router/index.js:275:10)
    at /src/node_modules/express/lib/router/index.js:635:15
    at next (/src/node_modules/express/lib/router/index.js:260:14)
    at Function.handle (/src/node_modules/express/lib/router/index.js:174:3)
    at router (/src/node_modules/express/lib/router/index.js:47:12)
    at Layer.handle [as handle_request] (/src/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/src/node_modules/express/lib/router/index.js:317:13)
    at /src/node_modules/express/lib/router/index.js:284:7
    at Function.process_params (/src/node_modules/express/lib/router/index.js:335:12)
    at next (/src/node_modules/express/lib/router/index.js:275:10)
    at urlencodedParser (/src/node_modules/body-parser/lib/types/urlencoded.js:91:7)

```

I'll try running the poc locally but it'd be useful to have this hosted to ensure there's no mistakes in me trying to reproduce the same environment, and to help with QA verification once there is a fix. Is it possible to get the PoC back up?

Flags: needinfo?(nika) → needinfo?(whoismath)

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1692655#c22)• 3 years ago |
|  | |

I'm sorry, I had to use this address to another PoC but I'll fix it tonight. Until then you can use <https://l4t.cc/readcookie.html> in the same way, just remember to set cookies in <http://poc.dup.house/pocs/samesite.php> before testing.

Steps:

* Set cookies in poc.dup.house <https://poc.dup.house/pocs/setcookie.php>;
* go to l4t.cc <https://l4t.cc/readcookie.html>;
* click anywhere in the page. It will open a new window;
* view this window in reader mode;
* wait around 15 seconds when this page is redirected to <https://poc.dup.house/pocs/samesite.php> showing that samesite cookies were sent.

Please let me know if you had any issue reproducing in this environment.

Flags: needinfo?(whoismath)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1692655#c23)• 3 years ago |
|  | |

(In reply to Matheus Vrech from [comment #22](/show_bug.cgi?id=1692655#c22 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> I'm sorry, I had to use this address to another PoC but I'll fix it tonight.

No worries! I'm aware it's been an embarrassingly long time since there was much traction from our side.

> Until then you can use <https://l4t.cc/readcookie.html> in the same way, just remember to set cookies in <http://poc.dup.house/pocs/samesite.php>

<https://poc.dup.house/pocs/setcookie.php> right?

> before testing.

Thanks. I also got it to work locally, I think, so I should be OK for now at least for the fixes being written.

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1692655#c24)• 3 years ago |
|  | |

Yes! I meant to set it in setcookie to configure the environment (<https://poc.dup.house/pocs/setcookie.php>), sorry.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1692655#c25)• 3 years ago |
|  | |

Attached file
[Bug 1692655 - ensure loading reader mode in windows with an opener relationship creates a new BC, r?nika](attachment.cgi?id=9243812)
— [Details](attachment.cgi?id=9243812&action=edit)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1692655#c26)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1692655&comment_id=15592533 "1 revision") |
|  | |

I have a working patch based on Nika's suggestion, with a test. This breaks the exploit because about:reader creates its own BC, severing the `opener` relationship, so the attacker can't navigate away from or back into reader mode.

However, I would prefer also to fix at least 1 other part of the problem here, namely how reader mode itself deals with redirects, ie:

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #11](/show_bug.cgi?id=1692655#c11 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> (In reply to :Gijs (he/him) from [comment #6](/show_bug.cgi?id=1692655#c6 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))
>
> > I'm also not 100% sure how to fix this. Christoph, when reader mode is invoked without a document but with just a URL, it has to fetch the content itself. It's using XHR for that (in order to parse the returned HTML doc) and [manually follows meta redirects](https://searchfox.org/mozilla-central/rev/951a0342d600a1db263cac35ac85dbd4b3305aeb/toolkit/components/reader/ReaderMode.jsm#296). Is there some way we can communicate to the second XHR that is following the meta redirect, ie that it's a redirect chain, such that we wouldn't send samesite cookies?
>
> The same-site cookie code checks for cross-origin redirects within [IsSameSiteForeign](https://searchfox.org/mozilla-central/source/netwerk/cookie/CookieCommons.cpp#544-558). So we could potentially query the loadinfo from the XHR request and fake a redirectEntry using `loadinfo->appendRedirectHistoryEntry()` so that `IsSameSiteForeign` can do it's job. I guess that could work.

Unfortunately, I hit a bit of a wall here - for other security reasons, it's important we update the toplevel URL when following a meta redirect (cf [bug 1182778](/show_bug.cgi?id=1182778 "RESOLVED FIXED - Passive script execution on about:reader via SVG animations (affects: Firefox, NoScript, CSP; impact: spoofing, phishing)")), ie we don't want to have a case where the document loaded is `about:reader?url=foo.com` and actually the content shown is from `bar.com` rather than `foo.com`. To do this, we actually navigate to a new about:reader?url=... page when following the redirect. This means that by the time we run the XHR for the second load, the original info for the first redirect is gone. Because the navigation to the new page happens as a pretty simple assignment to window.location, it's not obvious how we add more info - short of adding a bunch of other URL parameters. That feels yucky, will likely mean auditing all the current URI consumers to check nobody is relying on there not being any other URL parameters, and is also a bit annoying in terms of the API surface that nsILoadInfo exposes. Specifically, when I looked at that, I realized that all the current consumers do the same thing to determine the arguments to the nsIRedirectHistoryEntry constructor: they inspect the "old" channel. So I have a patch to push that logic into the AppendRedirectHistoryEntry code itself (which is net code removal, yay!), and taking an `nsIChannel` argument instead -- but that makes it harder to add information passing for reader mode. :-\

My next thought was to use `history.replaceState` to fake the navigation, so that we do this immediately when the initial XHR fails, but unfortunately (a) we fail [here](https://searchfox.org/mozilla-central/rev/7539ad54ddc720a0553efd07ca681b9a409f9887/docshell/base/nsDocShell.cpp#11097-11099) because we can't get a userpass info for the magical about: URL, but even if we fix that, no `about:reader` url is ever same origin with another as far as `nsIScriptSecurityManager::CheckSameOriginURL` is concerned, because you can't QI those URLs to `nsIStandardURL`. I am... not convinced we want to open that can of worms. :-\

Christoph or Freddy, do you have any clever ideas here? Am I missing something obvious? If not, how would we feel about "only" shipping the BC separation to address this, rather than also fixing reader mode to pass more accurate info for the redirect? Or do you think I should just bite the bullet and start adding more URL params, or changing how CheckSameOriginURL works for about: URLs? 😓

Flags: needinfo?(fbraun)Flags: needinfo?(ckerschb)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1692655#c27)• 3 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #26](/show_bug.cgi?id=1692655#c26 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> I have a working patch based on Nika's suggestion, with a test. This breaks the exploit because about:reader creates its own BC, severing the `opener` relationship, so the attacker can't navigate away from or back into reader mode.
>
> However, I would prefer also to fix at least 1 other part of the problem here, namely how reader mode itself deals with redirects, ie:
>
> (In reply to Christoph Kerschbaumer [:ckerschb] from [comment #11](/show_bug.cgi?id=1692655#c11 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))
>
> > (In reply to :Gijs (he/him) from [comment #6](/show_bug.cgi?id=1692655#c6 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))
> >
> > > I'm also not 100% sure how to fix this. Christoph, when reader mode is invoked without a document but with just a URL, it has to fetch the content itself. It's using XHR for that (in order to parse the returned HTML doc) and [manually follows meta redirects](https://searchfox.org/mozilla-central/rev/951a0342d600a1db263cac35ac85dbd4b3305aeb/toolkit/components/reader/ReaderMode.jsm#296). Is there some way we can communicate to the second XHR that is following the meta redirect, ie that it's a redirect chain, such that we wouldn't send samesite cookies?

If the 2nd request was indeed another XHR, then we could set a loadflag, but it seems that the redirect target URI is being fed into the `reject()` callback of that promise and then propagates through various outside [callers up to the parent code in aboutreader.jsm](https://searchfox.org/mozilla-central/rev/75e9d727ce5ba2c14653cf8fb0f1367f085271b7/toolkit/components/reader/AboutReader.jsm#774-776), which redirects using something like `location.replace()`. I'm not really sure how we can do this in a JavaScript-triggered redirect from one about:reader page to another about:reader page. One might be able to hack this redirect info into the subsequent about:reader-URL and then call the following XHR differently, but that seems icky. Leaving the needinfo for Christoph, to see if he has a better idea.

Flags: needinfo?(fbraun)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1692655#c28)• 3 years ago |
|  | |

There's a r+ patch which didn't land and no activity in this bug for 2 weeks.

:Gijs, could you have a look please?

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#not_landed.py).

Flags: needinfo?(nika)Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1692655#c29)• 3 years ago |
|  | |

I am painfully aware of this patch and the fact that I need to figure out whether we can either do something reasonable to pass previous channel info for the new reader mode load, or rip out the meta-redirect-following completely, or "only" land the r+ patch -- thanks, reviewbot...

As I discussed with Nika last week, it's not clear to me whether trying to manually hack together a way to pass the redirect info to the XHR is going to be a case of whack-a-mole where we have to keep updating it to pass more and more other information which may also impact security, and having to effectively build a second path for this kind of redirect to happen (trying to mimic a "real" meta redirect and all its indirections as closely as possible) is pretty unattractive. I haven't made a decision yet; any and all suggestions still gratefully received...

Flags: needinfo?(nika)Flags: needinfo?(gijskruitbosch+bugs)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a26312038_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1692655#c30)• 3 years ago |
|  | |

Niklas/Micah, do you have thoughts here? In particular, I'm wondering if we can just remove the `<meta>` redirect handling code entirely. AFAIK it's only needed for cases where you want to manually use `about:reader?url=...`, as we should just be grabbing the current document otherwise. Does that sound reasonable?

Flags: needinfo?(nbaumgardner)Flags: needinfo?(mtigley)

|  | [Micah [:mtigley] (she/her)](/user_profile?user_id=618808) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1692655#c31)• 3 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #30](/show_bug.cgi?id=1692655#c30 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Niklas/Micah, do you have thoughts here? In particular, I'm wondering if we can just remove the `<meta>` redirect handling code entirely. AFAIK it's only needed for cases where you want to manually use `about:reader?url=...`, as we should just be grabbing the current document otherwise. Does that sound reasonable?

I'm not entirely sure why we'd need to have the [redirect](https://searchfox.org/mozilla-central/rev/4615b544a0f7166233c409c619b426c4025467a7/toolkit/components/reader/ReaderMode.jsm#315-356) for `about:reader` urls, so I think it's fine if that's removed!

Flags: needinfo?(mtigley)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1692655#c32)• 3 years ago |
|  | |

(In reply to Micah [:mtigley] (she/her) from [comment #31](/show_bug.cgi?id=1692655#c31 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> (In reply to :Gijs (he/him) from [comment #30](/show_bug.cgi?id=1692655#c30 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))
>
> > Niklas/Micah, do you have thoughts here? In particular, I'm wondering if we can just remove the `<meta>` redirect handling code entirely. AFAIK it's only needed for cases where you want to manually use `about:reader?url=...`, as we should just be grabbing the current document otherwise. Does that sound reasonable?
>
> I'm not entirely sure why we'd need to have the [redirect](https://searchfox.org/mozilla-central/rev/4615b544a0f7166233c409c619b426c4025467a7/toolkit/components/reader/ReaderMode.jsm#315-356) for `about:reader` urls, so I think it's fine if that's removed!

Having just looked at this, I realized that if we remove all the redirection logic we end up re-creating [bug 1195976](/show_bug.cgi?id=1195976 "VERIFIED FIXED - URL spoofing in reader mode") and/or [bug 1182778](/show_bug.cgi?id=1182778 "RESOLVED FIXED - Passive script execution on about:reader via SVG animations (affects: Firefox, NoScript, CSP; impact: spoofing, phishing)"). :-\

Nika, am I missing a more "obvious" solution here? Basically we want to be able to navigate from `about:reader?url=foo` to `about:reader?url=bar`, but the resulting load in `about:reader?url=bar` that fetches `bar` should preserve whatever characteristics a navigation from `foo` to `bar` would have had, esp. from a security/usercontextid/(same-site)cookies/private-browsing/etc. perspective.

Flags: needinfo?(nbaumgardner) → needinfo?(nika)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1692655#c33)• 3 years ago |
|  | |

FWIW, The current redirect uses `location.replace()`, which is basically like a new, context-less top-level navigation.

It looks like what we need is something that looks like a server-side redirect. I know that we have various instance of this problem, but so far we've usually created a new channel which copied things out of the previous channel. Unfortunately, that is known to be error-prone and often times missing various bits of important context (CSP, OriginAttributes etc etc etc.).

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1692655#c34)• 3 years ago |
|  | |

IIRC the redirect which it's trying to mimic isn't a server-side redirect, but rather a client-side refresh using a `<meta http-equiv=refresh>` tag. We definitely want to keep around the logic for updating the URL bar after a server-side redirect. I'm not convinced that [bug 1195976](/show_bug.cgi?id=1195976 "VERIFIED FIXED - URL spoofing in reader mode") would reoccur if we removed support for meta refresh tags as the source of that redirect was an HTTP 302, which is handled seperately: <https://searchfox.org/mozilla-central/rev/4615b544a0f7166233c409c619b426c4025467a7/toolkit/components/reader/ReaderMode.jsm#375>

I'm not entirely sure I understand why [bug 1182778](/show_bug.cgi?id=1182778 "RESOLVED FIXED - Passive script execution on about:reader via SVG animations (affects: Firefox, NoScript, CSP; impact: spoofing, phishing)") would be re-created if we remove this check so I may be missing something there.

I don't think we want to make meta refresh tags act like server-side redirects under the hood, as that's also not how they act for document loads (they're triggered as new toplevel loads after the specified delay but with a few extra flags set).

If we wanted to make how about:reader loads URIs reflect how documents are loaded as accurately as possible, our main option would probably to make it act like how we handle view-source: URIs (with all of the complexity everywhere which comes with that, which I'm guessing is why the feature was not built that way to begin with), and then to have reader-mode for documents with meta refresh tags generate their own tags internally when rendering (as view-source doesn't respect meta refresh tags itself).

TL;DR: If the bug here only has to do with meta refresh tags and not with server-side redirects, I think the easiest solution is to rip out the `meta` tag handling here: <https://searchfox.org/mozilla-central/rev/4615b544a0f7166233c409c619b426c4025467a7/toolkit/components/reader/ReaderMode.jsm#315-356>, which I don't *think* will lead to any new or existing security issues, as we won't render the target of the refresh on the wrong page, we'll just render the refresh page itself. If we also have problems with server-side redirects, we may need to do more.

Flags: needinfo?(nika) → needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1692655#c35)• 3 years ago |
|  | |

(In reply to Nika Layzell [:nika] (ni? for response) from [comment #34](/show_bug.cgi?id=1692655#c34 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> IIRC the redirect which it's trying to mimic isn't a server-side redirect, but rather a client-side refresh using a `<meta http-equiv=refresh>` tag. We definitely want to keep around the logic for updating the URL bar after a server-side redirect. I'm not convinced that [bug 1195976](/show_bug.cgi?id=1195976 "VERIFIED FIXED - URL spoofing in reader mode") would reoccur if we removed support for meta refresh tags as the source of that redirect was an HTTP 302, which is handled seperately: <https://searchfox.org/mozilla-central/rev/4615b544a0f7166233c409c619b426c4025467a7/toolkit/components/reader/ReaderMode.jsm#375>
>
> I'm not entirely sure I understand why [bug 1182778](/show_bug.cgi?id=1182778 "RESOLVED FIXED - Passive script execution on about:reader via SVG animations (affects: Firefox, NoScript, CSP; impact: spoofing, phishing)") would be re-created if we remove this check so I may be missing something there.

No, you are correct - I think I got confused. The reason for my confusion was that in terms of the reader mode implementation, the handling is almost identical - we do an XHR, and if either the response URL is different from the request URL, or we get a meta refresh in the resulting document, we bubble up to the parent that we need to load the target page instead. (Note that reader mode doesn't actually honour the delay at all, which is a separate, non-security bug...)

But in the meta redirect case, we can render the original document, whereas in the 302 case the XHR just finishes the redirect for us and provides us with the post-redirect document, so the only alternative is rendering a blank page or similar.

Back to this bug rather than the old spoofing issue: Because in the attack proposed in [comment 0](/show_bug.cgi?id=1692655#c0 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect") / [comment 5](/show_bug.cgi?id=1692655#c5 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"), both the attacking page and the page that provides the meta redirect are under attacker control, I expect that you could do the same thing with a 302. At the moment the page with the meta redirect is static, so it'd be more involved: you'd need the client-side to communicate to the server-side that the next time it gets a request for this page, it should return the 302, so that when the original attacking page forces a reload of the reader mode page, the request gets a 302, and we "manually" tell the parent to open the target page instead. But that seems pretty doable, as all these pages (except the target) are attacker-controlled. You might even be able to combine with a service worker and do it that way; I'm not sure.

> I don't think we want to make meta refresh tags act like server-side redirects under the hood, as that's also not how they act for document loads (they're triggered as new toplevel loads after the specified delay but with a few extra flags set).
>
> If we wanted to make how about:reader loads URIs reflect how documents are loaded as accurately as possible, our main option would probably to make it act like how we handle view-source: URIs (with all of the complexity everywhere which comes with that, which I'm guessing is why the feature was not built that way to begin with), and then to have reader-mode for documents with meta refresh tags generate their own tags internally when rendering (as view-source doesn't respect meta refresh tags itself).

Yeeeeaahhh. To paraphrase Marie Kondo, `view-source` does not bring me joy. It'd be a pretty big project to redo all the URL surface for reader mode so that it was its own protocol, and then ensure that it gets the same handling/complexity that you describe. I can file a separate bug for that if you think it's worth it?

> TL;DR: If the bug here only has to do with meta refresh tags and not with server-side redirects, I think the easiest solution is to rip out the `meta` tag handling here: <https://searchfox.org/mozilla-central/rev/4615b544a0f7166233c409c619b426c4025467a7/toolkit/components/reader/ReaderMode.jsm#315-356>, which I don't *think* will lead to any new or existing security issues, as we won't render the target of the refresh on the wrong page, we'll just render the refresh page itself. If we also have problems with server-side redirects, we may need to do more.

Right, so, here's what I think I would propose, which is a little different but hopefully still doable and less work than the view-source route (I think):

1. rip out the meta refresh tag handling, but leave the 302 handling [for now]
2. make history.push/replaceState work for unlinkable about: URIs. I don't think we need to jump all the way to having `nsStandardURL` for `about:`, but we should be able to make the security checks pass if the bits before `?` and/or `#` are the same. This is also worthwhile for other projects that frontend is considering - the fact that `about` URIs can't use this API is annoying in other about: pages too and restricts the options frontend has for various kinds of UI. (I've just been asked for a new page to have opening a "dialog" within that page add a back button entry, and although I could do it with just `#foo` hash manipulation, they are pretty ugly...)
3. use that instead of `location.replace()` for the 302 handling. That way we leave the XHR code to handle the redirect, which means all the network code will be handled appropriately, instead of making it all up ourselves.

Does that seem like a reasonable alternative to going whole-hog for the `view-source`-like option?

Flags: needinfo?(gijskruitbosch+bugs) → needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1692655#c36)• 3 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #35](/show_bug.cgi?id=1692655#c35 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Yeeeeaahhh. To paraphrase Marie Kondo, `view-source` does not bring me joy. It'd be a pretty big project to redo all the URL surface for reader mode so that it was its own protocol, and then ensure that it gets the same handling/complexity that you describe. I can file a separate bug for that if you think it's worth it?

I don't love the idea of switching to using `view-source` if we can avoid it, as it comes hand-in-hand with a lot of complexity which I'd prefer to avoid expanding upon, so if we can find a good solution I'd prefer not to switch to that strategy.

> Right, so, here's what I think I would propose, which is a little different but hopefully still doable and less work than the view-source route (I think):
>
> 1. rip out the meta refresh tag handling, but leave the 302 handling [for now]
> 2. make history.push/replaceState work for unlinkable about: URIs. I don't think we need to jump all the way to having `nsStandardURL` for `about:`, but we should be able to make the security checks pass if the bits before `?` and/or `#` are the same. This is also worthwhile for other projects that frontend is considering - the fact that `about` URIs can't use this API is annoying in other about: pages too and restricts the options frontend has for various kinds of UI. (I've just been asked for a new page to have opening a "dialog" within that page add a back button entry, and although I could do it with just `#foo` hash manipulation, they are pretty ugly...)
> 3. use that instead of `location.replace()` for the 302 handling. That way we leave the XHR code to handle the redirect, which means all the network code will be handled appropriately, instead of making it all up ourselves.
>
> Does that seem like a reasonable alternative to going whole-hog for the `view-source`-like option?

Using that approach unfortunately means that we wouldn't be able to re-do process selection for the post-redirect URI as we're not doing a fresh load of the about:reader URI, and we have special-case logic to isolate about:reader URIs based on their origin, so I think I'd prefer to continue to handle things similar to how we're handing them right now when it comes to doing independent `about:reader` loads.

I think a better solution might actually be to be more clever about how we handle redirects in the ReaderMode code. Theoretically we could cache the response which we get from the redirect, which we've already performed when we get the response back in `_downloadDocument`. Conveniently we already have a system for holding onto a response while we wait for the URI to load in a potentially different process using the `gCachedArticles` map (<https://searchfox.org/mozilla-central/rev/a17011de808c24f015ad03debe7a157c1b43b602/browser/actors/AboutReaderParent.jsm#40-43>), so potentially we could change ReaderMode to perform the redirect by pushing the article data into the parent process, storing it in that map, and then navigating to the new `about:reader` page. We'd then use the `Reader:GetCachedArticle` codepath to fetch the cached article and it wouldn't be re-loaded after the redirect.

Does that seem like a practical approach to take?

Flags: needinfo?(nika) → needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1692655#c37)• 3 years ago |
|  | |

(In reply to Nika Layzell [:nika] (ni? for response) from [comment #36](/show_bug.cgi?id=1692655#c36 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Does that seem like a practical approach to take?

Yes, this seems like it should work. I'll see if I can find time to put up a patch this week.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1692655#c38)• 3 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #37](/show_bug.cgi?id=1692655#c37 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> (In reply to Nika Layzell [:nika] (ni? for response) from [comment #36](/show_bug.cgi?id=1692655#c36 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))
>
> > Does that seem like a practical approach to take?
>
> Yes, this seems like it should work. I'll see if I can find time to put up a patch this week.

We had a [0-day](https://www.mozilla.org/en-US/security/advisories/mfsa2022-09/) and some other high prio work come up so I didn't finish doing this - I do have a patch that does this now, I think, but I need to find time to create an automated test.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1692655#c39)• 3 years ago |
|  | |

Attached file
[Bug 1692655, r?nika!,mtigley!](attachment.cgi?id=9268258)
— [Details](attachment.cgi?id=9268258&action=edit)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1692655#c40)• 3 years ago |
|  | |

Attached file
[Bug 1692655 - tests, r?mtigley](attachment.cgi?id=9268259) (obsolete)
— [Details](attachment.cgi?id=9268259&action=edit)

Depends on D141359

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1692655#c41)• 3 years ago |
|  | |

Well, it took way too long, but patches are finally up, at least...

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a34672566_159069)• 3 years ago |

Blocks: [1760602](/show_bug.cgi?id=1760602 "RESOLVED FIXED - Land tests for reader mode samesite cookie redirect issue")

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1692655#c42)• 3 years ago |
|  | |

Comment on [attachment 9268259](/attachment.cgi?id=9268259 "Bug 1692655 - tests, r?mtigley") [[details]](/attachment.cgi?id=9268259&action=edit "Bug 1692655 - tests, r?mtigley")

[Bug 1692655](/show_bug.cgi?id=1692655 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect") - tests, r?mtigley

Revision D141360 was moved to [bug 1760602](/show_bug.cgi?id=1760602 "RESOLVED FIXED - Land tests for reader mode samesite cookie redirect issue"). Setting [attachment 9268259](/attachment.cgi?id=9268259 "Bug 1692655 - tests, r?mtigley") [[details]](/attachment.cgi?id=9268259&action=edit "Bug 1692655 - tests, r?mtigley") to obsolete.

[Attachment #9268259](/attachment.cgi?id=9268259&action=edit "Bug 1692655 - tests, r?mtigley") -
Attachment is obsolete: true

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1692655#c43)• 3 years ago |
|  | |

Nika, do you think we should also land the opener relationship patch from 6 months ago?

Flags: needinfo?(ckerschb) → needinfo?(nika)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1692655#c44)• 3 years ago |
|  | |

Landed: <https://hg.mozilla.org/integration/autoland/rev/37f58bd49a56f6e2633d04a77895b6954abc6bcb>

Backed out for causing linting failure:

<https://hg.mozilla.org/integration/autoland/rev/8641c2aa19f12c80939776ed9ec2ea37b4f43ab9>

Push with failure: <https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry&revision=37f58bd49a56f6e2633d04a77895b6954abc6bcb&selectedTaskRun=ailCzzGrTuuo8XXAYj_vww.0>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=371764620&repo=autoland>

```
TEST-UNEXPECTED-ERROR | /builds/worker/checkouts/gecko/toolkit/components/reader/ReaderMode.jsm:284:7 | Expected an error object to be thrown. (no-throw-literal)

```
Flags: needinfo?(gijskruitbosch+bugs)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1692655#c45)• 3 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #43](/show_bug.cgi?id=1692655#c43 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Nika, do you think we should also land the opener relationship patch from 6 months ago?

Sure, shouldn't hurt. Took a quick look over it again, and I think the feedback I posted back then is still relevant, but with that fixed it should be landable.

Flags: needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1692655#c46)• 3 years ago |
|  | |

(In reply to Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout) from [comment #44](/show_bug.cgi?id=1692655#c44 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> ```
> TEST-UNEXPECTED-ERROR | /builds/worker/checkouts/gecko/toolkit/components/reader/ReaderMode.jsm:284:7 | Expected an error object to be thrown. (no-throw-literal)
>
> ```

That's a fun one :-)

Perhaps we should just return from that method as well & just return an object, because IIRC the caller is the one which catches the exception anyway?

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1692655#c47)• 3 years ago |
|  | |

(In reply to Nika Layzell [:nika] (ni? for response) from [comment #46](/show_bug.cgi?id=1692655#c46 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> (In reply to Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout) from [comment #44](/show_bug.cgi?id=1692655#c44 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))
>
> > ```
> > TEST-UNEXPECTED-ERROR | /builds/worker/checkouts/gecko/toolkit/components/reader/ReaderMode.jsm:284:7 | Expected an error object to be thrown. (no-throw-literal)
> >
> > ```
>
> That's a fun one :-)
>
> Perhaps we should just return from that method as well & just return an object, because IIRC the caller is the one which catches the exception anyway?

Either that or return a `Promise.reject()` which I had toyed with doing anyway. Will look more in my morning.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a34932934_159069)• 3 years ago |

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1692655#c48)• 3 years ago |
|  | |

(In reply to Nika Layzell [:nika] (ni? for response) from [comment #45](/show_bug.cgi?id=1692655#c45 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> (In reply to :Gijs (he/him) from [comment #43](/show_bug.cgi?id=1692655#c43 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))
>
> > Nika, do you think we should also land the opener relationship patch from 6 months ago?
>
> Sure, shouldn't hurt. Took a quick look over it again, and I think the feedback I posted back then is still relevant, but with that fixed it should be landable.

I'm a bit confused - I think I did address the SHIP check, and you r+'d that without further comments. Was there something else?

Flags: needinfo?(nika)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1692655#c49)• 3 years ago |
|  | |

You're right, nevermind. I think I had misunderstood what my comment was trying to say.

Flags: needinfo?(nika)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1692655#c50)• 3 years ago |
|  | |

r=nika,mtigley,smaug

<https://hg.mozilla.org/integration/autoland/rev/f7ffaf8f64eb94dbe40df50d78fd9de92bb48b06>

<https://hg.mozilla.org/mozilla-central/rev/f7ffaf8f64eb>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 3 years ago
[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 100 Branch

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a34963230_159069)• 3 years ago |

[status-firefox88](/buglist.cgi?f1=cf_status_firefox88&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox88&o1=equals&v1=wontfix)
[status-firefox98](/buglist.cgi?f1=cf_status_firefox98&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox98&o1=equals&v1=wontfix)
[status-firefox99](/buglist.cgi?f1=cf_status_firefox99&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox99&o1=equals&v1=wontfix)
[status-firefox-esr78](/buglist.cgi?f1=cf_status_firefox_esr78&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=%3F) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr78&o1=equals&v1=wontfix)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1692655#c51)• 3 years ago |
|  | |

ensure loading reader mode in windows with an opener relationship creates a new BC, r=nika

<https://hg.mozilla.org/integration/autoland/rev/26d9410c112bc9e857954158146fdee6638889cc>

<https://hg.mozilla.org/mozilla-central/rev/26d9410c112b>

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a35351359_553429)• 3 years ago |

Flags: qe-verify+Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1692655#c52)• 3 years ago |
|  | |

Attached file
[Bug 1692655 - esr](attachment.cgi?id=9273705)
— [Details](attachment.cgi?id=9273705&action=edit)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1692655#c53)• 3 years ago |
|  | |

Comment on [attachment 9273705](/attachment.cgi?id=9273705 "Bug 1692655 - esr") [[details]](/attachment.cgi?id=9273705&action=edit "Bug 1692655 - esr")

[Bug 1692655](/show_bug.cgi?id=1692655 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect") - esr

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: sending of samesite cookie when it shouldn't be sent using readermode
* **User impact if declined**: Potential samesite strict bypass when using readermode
* **Fix Landed on Version**: 100
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The change is fairly straightforward, and has already landed on nightly
[Attachment #9273705](/attachment.cgi?id=9273705&action=edit "Bug 1692655 - esr") -
Flags: approval-mozilla-esr91?

|  | [Camelia Badau [:cbadau], Desktop Test Engineering](/user_profile?user_id=500622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a37763287_500622)• 3 years ago |

QA Whiteboard: [qa-triaged]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1692655#c54)• 3 years ago |
|  | |

Comment on [attachment 9273705](/attachment.cgi?id=9273705 "Bug 1692655 - esr") [[details]](/attachment.cgi?id=9273705&action=edit "Bug 1692655 - esr")

[Bug 1692655](/show_bug.cgi?id=1692655 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect") - esr

Approved for 91.9esr.

[Attachment #9273705](/attachment.cgi?id=9273705&action=edit "Bug 1692655 - esr") -
Flags: approval-mozilla-esr91? → approval-mozilla-esr91+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1692655#c55)• 3 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr91/rev/f191afdbef72>

[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)
[tracking-firefox100](/buglist.cgi?f1=cf_tracking_firefox100&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox100&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [100+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=100%2B)

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1692655#c56)• 3 years ago |
|  | |

Hi Matheus!

I've tried to reproduce this bug using an affected Nightly build (2021-02-12) Win 10 x64, but it seems that I'm having some hard time reproducing the initial problem. After I set the samesite cookie before the first step, and clicking anywhere on the `index.html` page, I'm redirected to `https://abrasax.club/readcookie.html`, which is unavailable ("Hmm. We’re having trouble finding that site." warning is displayed in Firefox). I'm doing something wrong here, maybe that page is missing from the poc file posted in [comment 1](/show_bug.cgi?id=1692655#c1 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect")?

Could you please take a look at this, or if you think that would be easier, you can also verify the fix on [Esr91.9](https://archive.mozilla.org/pub/firefox/candidates/91.9.0esr-candidates/) and [Firefox 100](https://archive.mozilla.org/pub/firefox/candidates/100.0-candidates/), since you understand better this bug?

Flags: needinfo?(whoismath)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a37944250_428608)• 3 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage] → [reporter-external] [client-bounty-form][post-critsmash-triage][adv-main100+][adv-esr91.9+]

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1692655#c57)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9274258)
— [Details](attachment.cgi?id=9274258&action=edit)

|  | [Matheus Vrech](/user_profile?user_id=648941)  Reporter |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1692655#c58)• 3 years ago |
|  | |

(In reply to Ciprian Georgiu [:ciprian\_georgiu], Release Desktop QA from [comment #56](/show_bug.cgi?id=1692655#c56 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Hi Matheus!
>
> I've tried to reproduce this bug using an affected Nightly build (2021-02-12) Win 10 x64, but it seems that I'm having some hard time reproducing the initial problem. After I set the samesite cookie before the first step, and clicking anywhere on the `index.html` page, I'm redirected to `https://abrasax.club/readcookie.html`, which is unavailable ("Hmm. We’re having trouble finding that site." warning is displayed in Firefox). I'm doing something wrong here, maybe that page is missing from the poc file posted in [comment 1](/show_bug.cgi?id=1692655#c1 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect")?
>
> Could you please take a look at this, or if you think that would be easier, you can also verify the fix on [Esr91.9](https://archive.mozilla.org/pub/firefox/candidates/91.9.0esr-candidates/) and [Firefox 100](https://archive.mozilla.org/pub/firefox/candidates/100.0-candidates/), since you understand better this bug?

Hello Ciprian!

I couldn't reproduce the bug anymore (Version: 101.0a1, Build ID: 20220428214715, User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:101.0) Gecko/20100101 Firefox/101.0). Please, feel free to test it again under the addresses: <https://dup.house/vrechson-bug-1692655/setcookie.php>, <https://dup.house/vrechson-bug-1692655/samesite.php>, and <https://l4t.cc/readcookie.html>.

Flags: needinfo?(whoismath)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a38020196_428608)• 3 years ago |

Alias: CVE-2022-29912

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1692655#c59)• 3 years ago |
|  | |

Nika, did you intentionally not uplift (or ask for uplift for) the opener relationship patch for ESR? QA picked this up when verifying the bug.

Flags: needinfo?(nika)

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1692655#c60)• 3 years ago |
|  | |

Thanks Gijs and Matheus! I was able to reproduce the bug using the updated test pages from [comment 58](/show_bug.cgi?id=1692655#c58 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"), on an affected Nightly build (99.0a1, Build ID 20220303190240).

The exploit is not reproducing anymore on the fixed builds, 91.9.0 Esr and 100.0 RC2. Tested across platforms, Win 10 x64, macOS 10.15 and Ubuntu 18.04 x64. The remaining patch (mentioned in [comment 59](/show_bug.cgi?id=1692655#c59 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect")) will be verified separately, if it gets uplifted in an upcoming ESR.

Status: RESOLVED → VERIFIED
[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=verified)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=verified)Flags: qe-verify+

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1692655#c61)• 3 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #59](/show_bug.cgi?id=1692655#c59 "VERIFIED FIXED - SameSite cookie bypass when using history navigation via a window reference to reload reader mode page containing a meta redirect"))

> Nika, did you intentionally not uplift (or ask for uplift for) the opener relationship patch for ESR? QA picked this up when verifying the bug.

I intentionally didn't ask for uplift on that patch because the code for process selection has changed so much since 91 (`ProcessIsolation.cpp` didn't even exist), that porting it would be a large hassle, and it's technically not necessary for the bugfix, mostly a defense-in-depth strategy thing.

Flags: needinfo?(nika)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a48465856_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1692655#a103890607_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1692655&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Matheus Vrech](/user_profile?user_id=648941)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_223a0e60_20250115_090731.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2022-16

## Security Vulnerabilities fixed in Firefox 100

Announced
May 3, 2022
Impact
high
Products
Firefox
Fixed in

* Firefox 100

#### [#CVE-2022-29914: Fullscreen notification bypass using popups](#CVE-2022-29914)

Reporter
Irvan Kurniawan
Impact
high
##### Description

When reusing existing popups Firefox would have allowed them to cover the fullscreen notification UI, which could have enabled browser spoofing attacks.

##### References

* [Bug 1746448](https://bugzilla.mozilla.org/show_bug.cgi?id=1746448)

#### [#CVE-2022-29909: Bypassing permission prompt in nested browsing contexts](#CVE-2022-29909)

Reporter
Armin Ebert
Impact
high
##### Description

Documents in deeply-nested cross-origin browsing contexts could have obtained permissions granted to the top-level origin, bypassing the existing prompt and wrongfully inheriting the top-level permissions.

##### References

* [Bug 1755081](https://bugzilla.mozilla.org/show_bug.cgi?id=1755081)

#### [#CVE-2022-29916: Leaking browser history with CSS variables](#CVE-2022-29916)

Reporter
Mateusz Sionkowski
Impact
high
##### Description

Firefox behaved slightly differently for already known resources when loading CSS resources involving CSS variables. This could have been used to probe the browser history.

##### References

* [Bug 1760674](https://bugzilla.mozilla.org/show_bug.cgi?id=1760674)

#### [#CVE-2022-29911: iframe Sandbox bypass](#CVE-2022-29911)

Reporter
Trung Pham
Impact
high
##### Description

An improper implementation of the new iframe sandbox keyword `allow-top-navigation-by-user-activation` could lead to script execution without `allow-scripts` being present.

##### References

* [Bug 1761981](https://bugzilla.mozilla.org/show_bug.cgi?id=1761981)

#### [#CVE-2022-29912: Reader mode bypassed SameSite cookies](#CVE-2022-29912)

Reporter
Matheus Vrech
Impact
moderate
##### Description

Requests initiated through reader mode did not properly omit cookies with a SameSite attribute.

##### References

* [Bug 1692655](https://bugzilla.mozilla.org/show_bug.cgi?id=1692655)

#### [#CVE-2022-29910: Firefox for Android forgot HTTP Strict Transport Security settings](#CVE-2022-29910)

Reporter
Mark B
Impact
moderate
##### Description

When closed or sent to the background, Firefox for Android would not properly record and persist HSTS settings.
*Note: This issue only affected Firefox for Android. Other operating systems are unaffected.*

##### References

* [Bug 1757138](https://bugzilla.mozilla.org/show_bug.cgi?id=1757138)

#### [#CVE-2022-29915: Leaking cross-origin redirect through the Performance API](#CVE-2022-29915)

Reporter
Sohom Datta
Impact
low
##### Description

The Performance API did not properly hide the fact whether a request cross-origin resource has observed redirects.

##### References

* [Bug 1751678](https://bugzilla.mozilla.org/show_bug.cgi?id=1751678)

#### [#CVE-2022-29917: Memory safety bugs fixed in Firefox 100 and Firefox ESR 91.9](#CVE-2022-29917)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Andrew McCreight, Gabriele Svelto, Tom Ritter and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 99 and Firefox ESR 91.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 100 and Firefox ESR 91.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1684739%2C1706441%2C1753298%2C1762614%2C1762620%2C1764778)

#### [#CVE-2022-29918: Memory safety bugs fixed in Firefox 100](#CVE-2022-29918)

Reporter
Mozilla developers
Impact
high
##### Description

Mozilla developers Gabriele Svelto, Randell Jesup and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 99. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 100](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1744043%2C1747178%2C1753535%2C1754017%2C1755847%2C1756172%2C1757477%2C1758223%2C1760160%2C1761481%2C1761771)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


